function S_e(n,t){for(var s=0;s<t.length;s++){const a=t[s];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var oE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function DE(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var g2={exports:{}},ew={},_2={exports:{}},gr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a$;function b_e(){if(a$)return gr;a$=1;var n=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),f=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),A=Symbol.iterator;function N(Te){return Te===null||typeof Te!="object"?null:(Te=A&&Te[A]||Te["@@iterator"],typeof Te=="function"?Te:null)}var V={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j=Object.assign,B={};function H(Te,be,Ae){this.props=Te,this.context=be,this.refs=B,this.updater=Ae||V}H.prototype.isReactComponent={},H.prototype.setState=function(Te,be){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,be,"setState")},H.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function J(){}J.prototype=H.prototype;function $(Te,be,Ae){this.props=Te,this.context=be,this.refs=B,this.updater=Ae||V}var te=$.prototype=new J;te.constructor=$,j(te,H.prototype),te.isPureReactComponent=!0;var ce=Array.isArray,oe=Object.prototype.hasOwnProperty,_e={current:null},ne={key:!0,ref:!0,__self:!0,__source:!0};function ee(Te,be,Ae){var Ue,Ge={},Qe=null,tt=null;if(be!=null)for(Ue in be.ref!==void 0&&(tt=be.ref),be.key!==void 0&&(Qe=""+be.key),be)oe.call(be,Ue)&&!ne.hasOwnProperty(Ue)&&(Ge[Ue]=be[Ue]);var dt=arguments.length-2;if(dt===1)Ge.children=Ae;else if(1<dt){for(var Ze=Array(dt),wt=0;wt<dt;wt++)Ze[wt]=arguments[wt+2];Ge.children=Ze}if(Te&&Te.defaultProps)for(Ue in dt=Te.defaultProps,dt)Ge[Ue]===void 0&&(Ge[Ue]=dt[Ue]);return{$$typeof:n,type:Te,key:Qe,ref:tt,props:Ge,_owner:_e.current}}function Q(Te,be){return{$$typeof:n,type:Te.type,key:be,ref:Te.ref,props:Te.props,_owner:Te._owner}}function se(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===n}function pe(Te){var be={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(Ae){return be[Ae]})}var fe=/\/+/g;function ue(Te,be){return typeof Te=="object"&&Te!==null&&Te.key!=null?pe(""+Te.key):be.toString(36)}function Me(Te,be,Ae,Ue,Ge){var Qe=typeof Te;(Qe==="undefined"||Qe==="boolean")&&(Te=null);var tt=!1;if(Te===null)tt=!0;else switch(Qe){case"string":case"number":tt=!0;break;case"object":switch(Te.$$typeof){case n:case t:tt=!0}}if(tt)return tt=Te,Ge=Ge(tt),Te=Ue===""?"."+ue(tt,0):Ue,ce(Ge)?(Ae="",Te!=null&&(Ae=Te.replace(fe,"$&/")+"/"),Me(Ge,be,Ae,"",function(wt){return wt})):Ge!=null&&(se(Ge)&&(Ge=Q(Ge,Ae+(!Ge.key||tt&&tt.key===Ge.key?"":(""+Ge.key).replace(fe,"$&/")+"/")+Te)),be.push(Ge)),1;if(tt=0,Ue=Ue===""?".":Ue+":",ce(Te))for(var dt=0;dt<Te.length;dt++){Qe=Te[dt];var Ze=Ue+ue(Qe,dt);tt+=Me(Qe,be,Ae,Ze,Ge)}else if(Ze=N(Te),typeof Ze=="function")for(Te=Ze.call(Te),dt=0;!(Qe=Te.next()).done;)Qe=Qe.value,Ze=Ue+ue(Qe,dt++),tt+=Me(Qe,be,Ae,Ze,Ge);else if(Qe==="object")throw be=String(Te),Error("Objects are not valid as a React child (found: "+(be==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":be)+"). If you meant to render a collection of children, use an array instead.");return tt}function He(Te,be,Ae){if(Te==null)return Te;var Ue=[],Ge=0;return Me(Te,Ue,"","",function(Qe){return be.call(Ae,Qe,Ge++)}),Ue}function nt(Te){if(Te._status===-1){var be=Te._result;be=be(),be.then(function(Ae){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=Ae)},function(Ae){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=Ae)}),Te._status===-1&&(Te._status=0,Te._result=be)}if(Te._status===1)return Te._result.default;throw Te._result}var we={current:null},Ce={transition:null},ve={ReactCurrentDispatcher:we,ReactCurrentBatchConfig:Ce,ReactCurrentOwner:_e};function Ne(){throw Error("act(...) is not supported in production builds of React.")}return gr.Children={map:He,forEach:function(Te,be,Ae){He(Te,function(){be.apply(this,arguments)},Ae)},count:function(Te){var be=0;return He(Te,function(){be++}),be},toArray:function(Te){return He(Te,function(be){return be})||[]},only:function(Te){if(!se(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}},gr.Component=H,gr.Fragment=s,gr.Profiler=l,gr.PureComponent=$,gr.StrictMode=a,gr.Suspense=v,gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ve,gr.act=Ne,gr.cloneElement=function(Te,be,Ae){if(Te==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Te+".");var Ue=j({},Te.props),Ge=Te.key,Qe=Te.ref,tt=Te._owner;if(be!=null){if(be.ref!==void 0&&(Qe=be.ref,tt=_e.current),be.key!==void 0&&(Ge=""+be.key),Te.type&&Te.type.defaultProps)var dt=Te.type.defaultProps;for(Ze in be)oe.call(be,Ze)&&!ne.hasOwnProperty(Ze)&&(Ue[Ze]=be[Ze]===void 0&&dt!==void 0?dt[Ze]:be[Ze])}var Ze=arguments.length-2;if(Ze===1)Ue.children=Ae;else if(1<Ze){dt=Array(Ze);for(var wt=0;wt<Ze;wt++)dt[wt]=arguments[wt+2];Ue.children=dt}return{$$typeof:n,type:Te.type,key:Ge,ref:Qe,props:Ue,_owner:tt}},gr.createContext=function(Te){return Te={$$typeof:f,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Te.Provider={$$typeof:d,_context:Te},Te.Consumer=Te},gr.createElement=ee,gr.createFactory=function(Te){var be=ee.bind(null,Te);return be.type=Te,be},gr.createRef=function(){return{current:null}},gr.forwardRef=function(Te){return{$$typeof:E,render:Te}},gr.isValidElement=se,gr.lazy=function(Te){return{$$typeof:w,_payload:{_status:-1,_result:Te},_init:nt}},gr.memo=function(Te,be){return{$$typeof:b,type:Te,compare:be===void 0?null:be}},gr.startTransition=function(Te){var be=Ce.transition;Ce.transition={};try{Te()}finally{Ce.transition=be}},gr.unstable_act=Ne,gr.useCallback=function(Te,be){return we.current.useCallback(Te,be)},gr.useContext=function(Te){return we.current.useContext(Te)},gr.useDebugValue=function(){},gr.useDeferredValue=function(Te){return we.current.useDeferredValue(Te)},gr.useEffect=function(Te,be){return we.current.useEffect(Te,be)},gr.useId=function(){return we.current.useId()},gr.useImperativeHandle=function(Te,be,Ae){return we.current.useImperativeHandle(Te,be,Ae)},gr.useInsertionEffect=function(Te,be){return we.current.useInsertionEffect(Te,be)},gr.useLayoutEffect=function(Te,be){return we.current.useLayoutEffect(Te,be)},gr.useMemo=function(Te,be){return we.current.useMemo(Te,be)},gr.useReducer=function(Te,be,Ae){return we.current.useReducer(Te,be,Ae)},gr.useRef=function(Te){return we.current.useRef(Te)},gr.useState=function(Te){return we.current.useState(Te)},gr.useSyncExternalStore=function(Te,be,Ae){return we.current.useSyncExternalStore(Te,be,Ae)},gr.useTransition=function(){return we.current.useTransition()},gr.version="18.3.1",gr}var c$;function Au(){return c$||(c$=1,_2.exports=b_e()),_2.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$;function T_e(){if(l$)return ew;l$=1;var n=Au(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function f(E,v,b){var w,A={},N=null,V=null;b!==void 0&&(N=""+b),v.key!==void 0&&(N=""+v.key),v.ref!==void 0&&(V=v.ref);for(w in v)a.call(v,w)&&!d.hasOwnProperty(w)&&(A[w]=v[w]);if(E&&E.defaultProps)for(w in v=E.defaultProps,v)A[w]===void 0&&(A[w]=v[w]);return{$$typeof:t,type:E,key:N,ref:V,props:A,_owner:l.current}}return ew.Fragment=s,ew.jsx=f,ew.jsxs=f,ew}var u$;function w_e(){return u$||(u$=1,g2.exports=T_e()),g2.exports}var C=w_e(),D=Au();const si=DE(D),d$=S_e({__proto__:null,default:si},[D]);var $P={},E2={exports:{}},qc={},y2={exports:{}},v2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h$;function R_e(){return h$||(h$=1,function(n){function t(Ce,ve){var Ne=Ce.length;Ce.push(ve);e:for(;0<Ne;){var Te=Ne-1>>>1,be=Ce[Te];if(0<l(be,ve))Ce[Te]=ve,Ce[Ne]=be,Ne=Te;else break e}}function s(Ce){return Ce.length===0?null:Ce[0]}function a(Ce){if(Ce.length===0)return null;var ve=Ce[0],Ne=Ce.pop();if(Ne!==ve){Ce[0]=Ne;e:for(var Te=0,be=Ce.length,Ae=be>>>1;Te<Ae;){var Ue=2*(Te+1)-1,Ge=Ce[Ue],Qe=Ue+1,tt=Ce[Qe];if(0>l(Ge,Ne))Qe<be&&0>l(tt,Ge)?(Ce[Te]=tt,Ce[Qe]=Ne,Te=Qe):(Ce[Te]=Ge,Ce[Ue]=Ne,Te=Ue);else if(Qe<be&&0>l(tt,Ne))Ce[Te]=tt,Ce[Qe]=Ne,Te=Qe;else break e}}return ve}function l(Ce,ve){var Ne=Ce.sortIndex-ve.sortIndex;return Ne!==0?Ne:Ce.id-ve.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var f=Date,E=f.now();n.unstable_now=function(){return f.now()-E}}var v=[],b=[],w=1,A=null,N=3,V=!1,j=!1,B=!1,H=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function te(Ce){for(var ve=s(b);ve!==null;){if(ve.callback===null)a(b);else if(ve.startTime<=Ce)a(b),ve.sortIndex=ve.expirationTime,t(v,ve);else break;ve=s(b)}}function ce(Ce){if(B=!1,te(Ce),!j)if(s(v)!==null)j=!0,nt(oe);else{var ve=s(b);ve!==null&&we(ce,ve.startTime-Ce)}}function oe(Ce,ve){j=!1,B&&(B=!1,J(ee),ee=-1),V=!0;var Ne=N;try{for(te(ve),A=s(v);A!==null&&(!(A.expirationTime>ve)||Ce&&!pe());){var Te=A.callback;if(typeof Te=="function"){A.callback=null,N=A.priorityLevel;var be=Te(A.expirationTime<=ve);ve=n.unstable_now(),typeof be=="function"?A.callback=be:A===s(v)&&a(v),te(ve)}else a(v);A=s(v)}if(A!==null)var Ae=!0;else{var Ue=s(b);Ue!==null&&we(ce,Ue.startTime-ve),Ae=!1}return Ae}finally{A=null,N=Ne,V=!1}}var _e=!1,ne=null,ee=-1,Q=5,se=-1;function pe(){return!(n.unstable_now()-se<Q)}function fe(){if(ne!==null){var Ce=n.unstable_now();se=Ce;var ve=!0;try{ve=ne(!0,Ce)}finally{ve?ue():(_e=!1,ne=null)}}else _e=!1}var ue;if(typeof $=="function")ue=function(){$(fe)};else if(typeof MessageChannel<"u"){var Me=new MessageChannel,He=Me.port2;Me.port1.onmessage=fe,ue=function(){He.postMessage(null)}}else ue=function(){H(fe,0)};function nt(Ce){ne=Ce,_e||(_e=!0,ue())}function we(Ce,ve){ee=H(function(){Ce(n.unstable_now())},ve)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ce){Ce.callback=null},n.unstable_continueExecution=function(){j||V||(j=!0,nt(oe))},n.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<Ce?Math.floor(1e3/Ce):5},n.unstable_getCurrentPriorityLevel=function(){return N},n.unstable_getFirstCallbackNode=function(){return s(v)},n.unstable_next=function(Ce){switch(N){case 1:case 2:case 3:var ve=3;break;default:ve=N}var Ne=N;N=ve;try{return Ce()}finally{N=Ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ce,ve){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var Ne=N;N=Ce;try{return ve()}finally{N=Ne}},n.unstable_scheduleCallback=function(Ce,ve,Ne){var Te=n.unstable_now();switch(typeof Ne=="object"&&Ne!==null?(Ne=Ne.delay,Ne=typeof Ne=="number"&&0<Ne?Te+Ne:Te):Ne=Te,Ce){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=Ne+be,Ce={id:w++,callback:ve,priorityLevel:Ce,startTime:Ne,expirationTime:be,sortIndex:-1},Ne>Te?(Ce.sortIndex=Ne,t(b,Ce),s(v)===null&&Ce===s(b)&&(B?(J(ee),ee=-1):B=!0,we(ce,Ne-Te))):(Ce.sortIndex=be,t(v,Ce),j||V||(j=!0,nt(oe))),Ce},n.unstable_shouldYield=pe,n.unstable_wrapCallback=function(Ce){var ve=N;return function(){var Ne=N;N=ve;try{return Ce.apply(this,arguments)}finally{N=Ne}}}}(v2)),v2}var p$;function C_e(){return p$||(p$=1,y2.exports=R_e()),y2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$;function I_e(){if(f$)return qc;f$=1;var n=Au(),t=C_e();function s(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,T=1;T<arguments.length;T++)g+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)a.add(g[p])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w={},A={};function N(p){return v.call(A,p)?!0:v.call(w,p)?!1:b.test(p)?A[p]=!0:(w[p]=!0,!1)}function V(p,g,T,O){if(T!==null&&T.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return O?!1:T!==null?!T.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function j(p,g,T,O){if(g===null||typeof g>"u"||V(p,g,T,O))return!0;if(O)return!1;if(T!==null)switch(T.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function B(p,g,T,O,M,G,ae){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=O,this.attributeNamespace=M,this.mustUseProperty=T,this.propertyName=p,this.type=g,this.sanitizeURL=G,this.removeEmptyString=ae}var H={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){H[p]=new B(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];H[g]=new B(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){H[p]=new B(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){H[p]=new B(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){H[p]=new B(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){H[p]=new B(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){H[p]=new B(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){H[p]=new B(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){H[p]=new B(p,5,!1,p.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function $(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(J,$);H[g]=new B(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(J,$);H[g]=new B(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(J,$);H[g]=new B(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){H[p]=new B(p,1,!1,p.toLowerCase(),null,!1,!1)}),H.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){H[p]=new B(p,1,!1,p.toLowerCase(),null,!0,!0)});function te(p,g,T,O){var M=H.hasOwnProperty(g)?H[g]:null;(M!==null?M.type!==0:O||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(j(g,T,M,O)&&(T=null),O||M===null?N(g)&&(T===null?p.removeAttribute(g):p.setAttribute(g,""+T)):M.mustUseProperty?p[M.propertyName]=T===null?M.type===3?!1:"":T:(g=M.attributeName,O=M.attributeNamespace,T===null?p.removeAttribute(g):(M=M.type,T=M===3||M===4&&T===!0?"":""+T,O?p.setAttributeNS(O,g,T):p.setAttribute(g,T))))}var ce=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,oe=Symbol.for("react.element"),_e=Symbol.for("react.portal"),ne=Symbol.for("react.fragment"),ee=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),se=Symbol.for("react.provider"),pe=Symbol.for("react.context"),fe=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),Me=Symbol.for("react.suspense_list"),He=Symbol.for("react.memo"),nt=Symbol.for("react.lazy"),we=Symbol.for("react.offscreen"),Ce=Symbol.iterator;function ve(p){return p===null||typeof p!="object"?null:(p=Ce&&p[Ce]||p["@@iterator"],typeof p=="function"?p:null)}var Ne=Object.assign,Te;function be(p){if(Te===void 0)try{throw Error()}catch(T){var g=T.stack.trim().match(/\n( *(at )?)/);Te=g&&g[1]||""}return`
`+Te+p}var Ae=!1;function Ue(p,g){if(!p||Ae)return"";Ae=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(rt){var O=rt}Reflect.construct(p,[],g)}else{try{g.call()}catch(rt){O=rt}p.call(g.prototype)}else{try{throw Error()}catch(rt){O=rt}p()}}catch(rt){if(rt&&O&&typeof rt.stack=="string"){for(var M=rt.stack.split(`
`),G=O.stack.split(`
`),ae=M.length-1,Ie=G.length-1;1<=ae&&0<=Ie&&M[ae]!==G[Ie];)Ie--;for(;1<=ae&&0<=Ie;ae--,Ie--)if(M[ae]!==G[Ie]){if(ae!==1||Ie!==1)do if(ae--,Ie--,0>Ie||M[ae]!==G[Ie]){var xe=`
`+M[ae].replace(" at new "," at ");return p.displayName&&xe.includes("<anonymous>")&&(xe=xe.replace("<anonymous>",p.displayName)),xe}while(1<=ae&&0<=Ie);break}}}finally{Ae=!1,Error.prepareStackTrace=T}return(p=p?p.displayName||p.name:"")?be(p):""}function Ge(p){switch(p.tag){case 5:return be(p.type);case 16:return be("Lazy");case 13:return be("Suspense");case 19:return be("SuspenseList");case 0:case 2:case 15:return p=Ue(p.type,!1),p;case 11:return p=Ue(p.type.render,!1),p;case 1:return p=Ue(p.type,!0),p;default:return""}}function Qe(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case ne:return"Fragment";case _e:return"Portal";case Q:return"Profiler";case ee:return"StrictMode";case ue:return"Suspense";case Me:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case pe:return(p.displayName||"Context")+".Consumer";case se:return(p._context.displayName||"Context")+".Provider";case fe:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case He:return g=p.displayName||null,g!==null?g:Qe(p.type)||"Memo";case nt:g=p._payload,p=p._init;try{return Qe(p(g))}catch{}}return null}function tt(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qe(g);case 8:return g===ee?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function dt(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Ze(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function wt(p){var g=Ze(p)?"checked":"value",T=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),O=""+p[g];if(!p.hasOwnProperty(g)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var M=T.get,G=T.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return M.call(this)},set:function(ae){O=""+ae,G.call(this,ae)}}),Object.defineProperty(p,g,{enumerable:T.enumerable}),{getValue:function(){return O},setValue:function(ae){O=""+ae},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function un(p){p._valueTracker||(p._valueTracker=wt(p))}function xt(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var T=g.getValue(),O="";return p&&(O=Ze(p)?p.checked?"true":"false":p.value),p=O,p!==T?(g.setValue(p),!0):!1}function tn(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function kn(p,g){var T=g.checked;return Ne({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??p._wrapperState.initialChecked})}function $t(p,g){var T=g.defaultValue==null?"":g.defaultValue,O=g.checked!=null?g.checked:g.defaultChecked;T=dt(g.value!=null?g.value:T),p._wrapperState={initialChecked:O,initialValue:T,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function zn(p,g){g=g.checked,g!=null&&te(p,"checked",g,!1)}function Bt(p,g){zn(p,g);var T=dt(g.value),O=g.type;if(T!=null)O==="number"?(T===0&&p.value===""||p.value!=T)&&(p.value=""+T):p.value!==""+T&&(p.value=""+T);else if(O==="submit"||O==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?Fe(p,g.type,T):g.hasOwnProperty("defaultValue")&&Fe(p,g.type,dt(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function Re(p,g,T){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var O=g.type;if(!(O!=="submit"&&O!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,T||g===p.value||(p.value=g),p.defaultValue=g}T=p.name,T!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,T!==""&&(p.name=T)}function Fe(p,g,T){(g!=="number"||tn(p.ownerDocument)!==p)&&(T==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+T&&(p.defaultValue=""+T))}var We=Array.isArray;function ot(p,g,T,O){if(p=p.options,g){g={};for(var M=0;M<T.length;M++)g["$"+T[M]]=!0;for(T=0;T<p.length;T++)M=g.hasOwnProperty("$"+p[T].value),p[T].selected!==M&&(p[T].selected=M),M&&O&&(p[T].defaultSelected=!0)}else{for(T=""+dt(T),g=null,M=0;M<p.length;M++){if(p[M].value===T){p[M].selected=!0,O&&(p[M].defaultSelected=!0);return}g!==null||p[M].disabled||(g=p[M])}g!==null&&(g.selected=!0)}}function Et(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(s(91));return Ne({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function yt(p,g){var T=g.value;if(T==null){if(T=g.children,g=g.defaultValue,T!=null){if(g!=null)throw Error(s(92));if(We(T)){if(1<T.length)throw Error(s(93));T=T[0]}g=T}g==null&&(g=""),T=g}p._wrapperState={initialValue:dt(T)}}function zt(p,g){var T=dt(g.value),O=dt(g.defaultValue);T!=null&&(T=""+T,T!==p.value&&(p.value=T),g.defaultValue==null&&p.defaultValue!==T&&(p.defaultValue=T)),O!=null&&(p.defaultValue=""+O)}function pn(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function xn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cn(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?xn(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var dr,pa=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,T,O,M){MSApp.execUnsafeLocalFunction(function(){return p(g,T,O,M)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(dr=dr||document.createElement("div"),dr.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=dr.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function Vt(p,g){if(g){var T=p.firstChild;if(T&&T===p.lastChild&&T.nodeType===3){T.nodeValue=g;return}}p.textContent=g}var on={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Mi=["Webkit","ms","Moz","O"];Object.keys(on).forEach(function(p){Mi.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),on[g]=on[p]})});function fs(p,g,T){return g==null||typeof g=="boolean"||g===""?"":T||typeof g!="number"||g===0||on.hasOwnProperty(p)&&on[p]?(""+g).trim():g+"px"}function Ls(p,g){p=p.style;for(var T in g)if(g.hasOwnProperty(T)){var O=T.indexOf("--")===0,M=fs(T,g[T],O);T==="float"&&(T="cssFloat"),O?p.setProperty(T,M):p[T]=M}}var Zr=Ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Pt(p,g){if(g){if(Zr[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(s(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(s(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(s(61))}if(g.style!=null&&typeof g.style!="object")throw Error(s(62))}}function wn(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ir=null;function Oi(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var _c=null,is=null,fa=null;function _o(p){if(p=tm(p)){if(typeof _c!="function")throw Error(s(280));var g=p.stateNode;g&&(g=nm(g),_c(p.stateNode,p.type,g))}}function ma(p){is?fa?fa.push(p):fa=[p]:is=p}function ga(){if(is){var p=is,g=fa;if(fa=is=null,_o(p),g)for(p=0;p<g.length;p++)_o(g[p])}}function to(p,g){return p(g)}function ms(){}var ss=!1;function Do(p,g,T){if(ss)return p(g,T);ss=!0;try{return to(p,g,T)}finally{ss=!1,(is!==null||fa!==null)&&(ms(),ga())}}function Ui(p,g){var T=p.stateNode;if(T===null)return null;var O=nm(T);if(O===null)return null;T=O[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(p=p.type,O=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!O;break e;default:p=!1}if(p)return null;if(T&&typeof T!="function")throw Error(s(231,g,typeof T));return T}var gs=!1;if(E)try{var qa={};Object.defineProperty(qa,"passive",{get:function(){gs=!0}}),window.addEventListener("test",qa,qa),window.removeEventListener("test",qa,qa)}catch{gs=!1}function Lu(p,g,T,O,M,G,ae,Ie,xe){var rt=Array.prototype.slice.call(arguments,3);try{g.apply(T,rt)}catch(At){this.onError(At)}}var Ec=!1,_a=null,Ea=!1,Ld=null,kg={onError:function(p){Ec=!0,_a=p}};function xu(p,g,T,O,M,G,ae,Ie,xe){Ec=!1,_a=null,Lu.apply(kg,arguments)}function op(p,g,T,O,M,G,ae,Ie,xe){if(xu.apply(this,arguments),Ec){if(Ec){var rt=_a;Ec=!1,_a=null}else throw Error(s(198));Ea||(Ea=!0,Ld=rt)}}function $s(p){var g=p,T=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(T=g.return),p=g.return;while(p)}return g.tag===3?T:null}function Mu(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function ya(p){if($s(p)!==p)throw Error(s(188))}function xd(p){var g=p.alternate;if(!g){if(g=$s(p),g===null)throw Error(s(188));return g!==p?null:p}for(var T=p,O=g;;){var M=T.return;if(M===null)break;var G=M.alternate;if(G===null){if(O=M.return,O!==null){T=O;continue}break}if(M.child===G.child){for(G=M.child;G;){if(G===T)return ya(M),p;if(G===O)return ya(M),g;G=G.sibling}throw Error(s(188))}if(T.return!==O.return)T=M,O=G;else{for(var ae=!1,Ie=M.child;Ie;){if(Ie===T){ae=!0,T=M,O=G;break}if(Ie===O){ae=!0,O=M,T=G;break}Ie=Ie.sibling}if(!ae){for(Ie=G.child;Ie;){if(Ie===T){ae=!0,T=G,O=M;break}if(Ie===O){ae=!0,O=G,T=M;break}Ie=Ie.sibling}if(!ae)throw Error(s(189))}}if(T.alternate!==O)throw Error(s(190))}if(T.tag!==3)throw Error(s(188));return T.stateNode.current===T?p:g}function Md(p){return p=xd(p),p!==null?Ya(p):null}function Ya(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=Ya(p);if(g!==null)return g;p=p.sibling}return null}var Ud=t.unstable_scheduleCallback,Uu=t.unstable_cancelCallback,Lo=t.unstable_shouldYield,Vd=t.unstable_requestPaint,Br=t.unstable_now,gi=t.unstable_getCurrentPriorityLevel,yc=t.unstable_ImmediatePriority,ll=t.unstable_UserBlockingPriority,va=t.unstable_NormalPriority,ap=t.unstable_LowPriority,Fd=t.unstable_IdlePriority,Fl=null,Eo=null;function jf(p){if(Eo&&typeof Eo.onCommitFiberRoot=="function")try{Eo.onCommitFiberRoot(Fl,p,void 0,(p.current.flags&128)===128)}catch{}}var no=Math.clz32?Math.clz32:jd,cp=Math.log,ul=Math.LN2;function jd(p){return p>>>=0,p===0?32:31-(cp(p)/ul|0)|0}var Bd=64,fr=4194304;function jl(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Bl(p,g){var T=p.pendingLanes;if(T===0)return 0;var O=0,M=p.suspendedLanes,G=p.pingedLanes,ae=T&268435455;if(ae!==0){var Ie=ae&~M;Ie!==0?O=jl(Ie):(G&=ae,G!==0&&(O=jl(G)))}else ae=T&~M,ae!==0?O=jl(ae):G!==0&&(O=jl(G));if(O===0)return 0;if(g!==0&&g!==O&&(g&M)===0&&(M=O&-O,G=g&-g,M>=G||M===16&&(G&4194240)!==0))return g;if((O&4)!==0&&(O|=T&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=O;0<g;)T=31-no(g),M=1<<T,O|=p[T],g&=~M;return O}function Vu(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xa(p,g){for(var T=p.suspendedLanes,O=p.pingedLanes,M=p.expirationTimes,G=p.pendingLanes;0<G;){var ae=31-no(G),Ie=1<<ae,xe=M[ae];xe===-1?((Ie&T)===0||(Ie&O)!==0)&&(M[ae]=Vu(Ie,g)):xe<=g&&(p.expiredLanes|=Ie),G&=~Ie}}function xo(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Fu(){var p=Bd;return Bd<<=1,(Bd&4194240)===0&&(Bd=64),p}function dl(p){for(var g=[],T=0;31>T;T++)g.push(p);return g}function Wl(p,g,T){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-no(g),p[g]=T}function Hr(p,g){var T=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var O=p.eventTimes;for(p=p.expirationTimes;0<T;){var M=31-no(T),G=1<<M;g[M]=0,O[M]=-1,p[M]=-1,T&=~G}}function Ja(p,g){var T=p.entangledLanes|=g;for(p=p.entanglements;T;){var O=31-no(T),M=1<<O;M&g|p[O]&g&&(p[O]|=g),T&=~M}}var sr=0;function vc(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var Bf,zl,Wd,lp,Wf,up=!1,Mo=[],os=null,Uo=null,Vo=null,Gl=new Map,Fo=new Map,jo=[],zf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(p,g){switch(p){case"focusin":case"focusout":os=null;break;case"dragenter":case"dragleave":Uo=null;break;case"mouseover":case"mouseout":Vo=null;break;case"pointerover":case"pointerout":Gl.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fo.delete(g.pointerId)}}function _s(p,g,T,O,M,G){return p===null||p.nativeEvent!==G?(p={blockedOn:g,domEventName:T,eventSystemFlags:O,nativeEvent:G,targetContainers:[M]},g!==null&&(g=tm(g),g!==null&&zl(g)),p):(p.eventSystemFlags|=O,g=p.targetContainers,M!==null&&g.indexOf(M)===-1&&g.push(M),p)}function ju(p,g,T,O,M){switch(g){case"focusin":return os=_s(os,p,g,T,O,M),!0;case"dragenter":return Uo=_s(Uo,p,g,T,O,M),!0;case"mouseover":return Vo=_s(Vo,p,g,T,O,M),!0;case"pointerover":var G=M.pointerId;return Gl.set(G,_s(Gl.get(G)||null,p,g,T,O,M)),!0;case"gotpointercapture":return G=M.pointerId,Fo.set(G,_s(Fo.get(G)||null,p,g,T,O,M)),!0}return!1}function dp(p){var g=yp(p.target);if(g!==null){var T=$s(g);if(T!==null){if(g=T.tag,g===13){if(g=Mu(T),g!==null){p.blockedOn=g,Wf(p.priority,function(){Wd(T)});return}}else if(g===3&&T.stateNode.current.memoizedState.isDehydrated){p.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}p.blockedOn=null}function hl(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var T=yr(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(T===null){T=p.nativeEvent;var O=new T.constructor(T.type,T);ir=O,T.target.dispatchEvent(O),ir=null}else return g=tm(T),g!==null&&zl(g),p.blockedOn=T,!1;g.shift()}return!0}function Hl(p,g,T){hl(p)&&T.delete(g)}function Gf(){up=!1,os!==null&&hl(os)&&(os=null),Uo!==null&&hl(Uo)&&(Uo=null),Vo!==null&&hl(Vo)&&(Vo=null),Gl.forEach(Hl),Fo.forEach(Hl)}function Sa(p,g){p.blockedOn===g&&(p.blockedOn=null,up||(up=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Gf)))}function ba(p){function g(M){return Sa(M,p)}if(0<Mo.length){Sa(Mo[0],p);for(var T=1;T<Mo.length;T++){var O=Mo[T];O.blockedOn===p&&(O.blockedOn=null)}}for(os!==null&&Sa(os,p),Uo!==null&&Sa(Uo,p),Vo!==null&&Sa(Vo,p),Gl.forEach(g),Fo.forEach(g),T=0;T<jo.length;T++)O=jo[T],O.blockedOn===p&&(O.blockedOn=null);for(;0<jo.length&&(T=jo[0],T.blockedOn===null);)dp(T),T.blockedOn===null&&jo.shift()}var pl=ce.ReactCurrentBatchConfig,Se=!0;function De(p,g,T,O){var M=sr,G=pl.transition;pl.transition=null;try{sr=1,Yt(p,g,T,O)}finally{sr=M,pl.transition=G}}function et(p,g,T,O){var M=sr,G=pl.transition;pl.transition=null;try{sr=4,Yt(p,g,T,O)}finally{sr=M,pl.transition=G}}function Yt(p,g,T,O){if(Se){var M=yr(p,g,T,O);if(M===null)YE(p,g,O,qn,T),Sc(p,O);else if(ju(M,p,g,T,O))O.stopPropagation();else if(Sc(p,O),g&4&&-1<zf.indexOf(p)){for(;M!==null;){var G=tm(M);if(G!==null&&Bf(G),G=yr(p,g,T,O),G===null&&YE(p,g,O,qn,T),G===M)break;M=G}M!==null&&O.stopPropagation()}else YE(p,g,O,null,T)}}var qn=null;function yr(p,g,T,O){if(qn=null,p=Oi(O),p=yp(p),p!==null)if(g=$s(p),g===null)p=null;else if(T=g.tag,T===13){if(p=Mu(g),p!==null)return p;p=null}else if(T===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return qn=p,null}function Wr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gi()){case yc:return 1;case ll:return 4;case va:case ap:return 16;case Fd:return 536870912;default:return 16}default:return 16}}var ln=null,xr=null,_i=null;function xs(){if(_i)return _i;var p,g=xr,T=g.length,O,M="value"in ln?ln.value:ln.textContent,G=M.length;for(p=0;p<T&&g[p]===M[p];p++);var ae=T-p;for(O=1;O<=ae&&g[T-O]===M[G-O];O++);return _i=M.slice(p,1<O?1-O:void 0)}function Bo(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function Wo(){return!0}function Bu(){return!1}function Xi(p){function g(T,O,M,G,ae){this._reactName=T,this._targetInst=M,this.type=O,this.nativeEvent=G,this.target=ae,this.currentTarget=null;for(var Ie in p)p.hasOwnProperty(Ie)&&(T=p[Ie],this[Ie]=T?T(G):G[Ie]);return this.isDefaultPrevented=(G.defaultPrevented!=null?G.defaultPrevented:G.returnValue===!1)?Wo:Bu,this.isPropagationStopped=Bu,this}return Ne(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=Wo)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=Wo)},persist:function(){},isPersistent:Wo}),g}var fl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zd=Xi(fl),bc=Ne({},fl,{view:0,detail:0}),Ng=Xi(bc),Hf,Wu,zo,$l=Ne({},bc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==zo&&(zo&&p.type==="mousemove"?(Hf=p.screenX-zo.screenX,Wu=p.screenY-zo.screenY):Wu=Hf=0,zo=p),Hf)},movementY:function(p){return"movementY"in p?p.movementY:Wu}}),$f=Xi($l),Dg=Ne({},$l,{dataTransfer:0}),BE=Xi(Dg),Kf=Ne({},bc,{relatedTarget:0}),qf=Xi(Kf),zu=Ne({},fl,{animationName:0,elapsedTime:0,pseudoElement:0}),Gu=Xi(zu),Hu=Ne({},fl,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Lg=Xi(Hu),WE=Ne({},fl,{data:0}),Vn=Xi(WE),Yf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Go={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function GE(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=zE[p])?!!g[p]:!1}function Tc(){return GE}var I=Ne({},bc,{key:function(p){if(p.key){var g=Yf[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=Bo(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Go[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tc,charCode:function(p){return p.type==="keypress"?Bo(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Bo(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),W=Xi(I),Z=Ne({},$l,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),me=Xi(Z),Ke=Ne({},bc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tc}),at=Xi(Ke),Mt=Ne({},fl,{propertyName:0,elapsedTime:0,pseudoElement:0}),$r=Xi(Mt),ai=Ne({},$l,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),vr=Xi(ai),Ks=[9,13,27,32],Es=E&&"CompositionEvent"in window,Qa=null;E&&"documentMode"in document&&(Qa=document.documentMode);var Ho=E&&"TextEvent"in window&&!Qa,hp=E&&(!Es||Qa&&8<Qa&&11>=Qa),Xf=" ",Za=!1;function aC(p,g){switch(p){case"keyup":return Ks.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cC(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var Jf=!1;function H1(p,g){switch(p){case"compositionend":return cC(g);case"keypress":return g.which!==32?null:(Za=!0,Xf);case"textInput":return p=g.data,p===Xf&&Za?null:p;default:return null}}function lC(p,g){if(Jf)return p==="compositionend"||!Es&&aC(p,g)?(p=xs(),_i=xr=ln=null,Jf=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return hp&&g.locale!=="ko"?null:g.data;default:return null}}var $1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uC(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!$1[p.type]:g==="textarea"}function V0(p,g,T,O){ma(O),g=XE(g,"onChange"),0<g.length&&(T=new zd("onChange","change",null,T,O),p.push({event:T,listeners:g}))}var pp=null,xg=null;function K1(p){H0(p,0)}function fp(p){var g=vp(p);if(xt(g))return p}function q1(p,g){if(p==="change")return g}var dC=!1;if(E){var F0;if(E){var wc="oninput"in document;if(!wc){var hC=document.createElement("div");hC.setAttribute("oninput","return;"),wc=typeof hC.oninput=="function"}F0=wc}else F0=!1;dC=F0&&(!document.documentMode||9<document.documentMode)}function pC(){pp&&(pp.detachEvent("onpropertychange",Ta),xg=pp=null)}function Ta(p){if(p.propertyName==="value"&&fp(xg)){var g=[];V0(g,xg,p,Oi(p)),Do(K1,g)}}function Y1(p,g,T){p==="focusin"?(pC(),pp=g,xg=T,pp.attachEvent("onpropertychange",Ta)):p==="focusout"&&pC()}function X1(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return fp(xg)}function J1(p,g){if(p==="click")return fp(g)}function Q1(p,g){if(p==="input"||p==="change")return fp(g)}function fC(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var ml=typeof Object.is=="function"?Object.is:fC;function Mg(p,g){if(ml(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var T=Object.keys(p),O=Object.keys(g);if(T.length!==O.length)return!1;for(O=0;O<T.length;O++){var M=T[O];if(!v.call(g,M)||!ml(p[M],g[M]))return!1}return!0}function mC(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function j0(p,g){var T=mC(p);p=0;for(var O;T;){if(T.nodeType===3){if(O=p+T.textContent.length,p<=g&&O>=g)return{node:T,offset:g-p};p=O}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=mC(T)}}function gC(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?gC(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function _C(){for(var p=window,g=tn();g instanceof p.HTMLIFrameElement;){try{var T=typeof g.contentWindow.location.href=="string"}catch{T=!1}if(T)p=g.contentWindow;else break;g=tn(p.document)}return g}function Ug(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function B0(p){var g=_C(),T=p.focusedElem,O=p.selectionRange;if(g!==T&&T&&T.ownerDocument&&gC(T.ownerDocument.documentElement,T)){if(O!==null&&Ug(T)){if(g=O.start,p=O.end,p===void 0&&(p=g),"selectionStart"in T)T.selectionStart=g,T.selectionEnd=Math.min(p,T.value.length);else if(p=(g=T.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var M=T.textContent.length,G=Math.min(O.start,M);O=O.end===void 0?G:Math.min(O.end,M),!p.extend&&G>O&&(M=O,O=G,G=M),M=j0(T,G);var ae=j0(T,O);M&&ae&&(p.rangeCount!==1||p.anchorNode!==M.node||p.anchorOffset!==M.offset||p.focusNode!==ae.node||p.focusOffset!==ae.offset)&&(g=g.createRange(),g.setStart(M.node,M.offset),p.removeAllRanges(),G>O?(p.addRange(g),p.extend(ae.node,ae.offset)):(g.setEnd(ae.node,ae.offset),p.addRange(g)))}}for(g=[],p=T;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<g.length;T++)p=g[T],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var Z1=E&&"documentMode"in document&&11>=document.documentMode,st=null,W0=null,Vg=null,z0=!1;function EC(p,g,T){var O=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;z0||st==null||st!==tn(O)||(O=st,"selectionStart"in O&&Ug(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),Vg&&Mg(Vg,O)||(Vg=O,O=XE(W0,"onSelect"),0<O.length&&(g=new zd("onSelect","select",null,g,T),p.push({event:g,listeners:O}),g.target=st)))}function HE(p,g){var T={};return T[p.toLowerCase()]=g.toLowerCase(),T["Webkit"+p]="webkit"+g,T["Moz"+p]="moz"+g,T}var Qf={animationend:HE("Animation","AnimationEnd"),animationiteration:HE("Animation","AnimationIteration"),animationstart:HE("Animation","AnimationStart"),transitionend:HE("Transition","TransitionEnd")},G0={},yC={};E&&(yC=document.createElement("div").style,"AnimationEvent"in window||(delete Qf.animationend.animation,delete Qf.animationiteration.animation,delete Qf.animationstart.animation),"TransitionEvent"in window||delete Qf.transitionend.transition);function mp(p){if(G0[p])return G0[p];if(!Qf[p])return p;var g=Qf[p],T;for(T in g)if(g.hasOwnProperty(T)&&T in yC)return G0[p]=g[T];return p}var gp=mp("animationend"),vC=mp("animationiteration"),SC=mp("animationstart"),bC=mp("transitionend"),TC=new Map,$E="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Gd(p,g){TC.set(p,g),d(g,[p])}for(var KE=0;KE<$E.length;KE++){var ec=$E[KE],eN=ec.toLowerCase(),Fg=ec[0].toUpperCase()+ec.slice(1);Gd(eN,"on"+Fg)}Gd(gp,"onAnimationEnd"),Gd(vC,"onAnimationIteration"),Gd(SC,"onAnimationStart"),Gd("dblclick","onDoubleClick"),Gd("focusin","onFocus"),Gd("focusout","onBlur"),Gd(bC,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tN=new Set("cancel close invalid load scroll toggle".split(" ").concat(jg));function wC(p,g,T){var O=p.type||"unknown-event";p.currentTarget=T,op(O,g,void 0,p),p.currentTarget=null}function H0(p,g){g=(g&4)!==0;for(var T=0;T<p.length;T++){var O=p[T],M=O.event;O=O.listeners;e:{var G=void 0;if(g)for(var ae=O.length-1;0<=ae;ae--){var Ie=O[ae],xe=Ie.instance,rt=Ie.currentTarget;if(Ie=Ie.listener,xe!==G&&M.isPropagationStopped())break e;wC(M,Ie,rt),G=xe}else for(ae=0;ae<O.length;ae++){if(Ie=O[ae],xe=Ie.instance,rt=Ie.currentTarget,Ie=Ie.listener,xe!==G&&M.isPropagationStopped())break e;wC(M,Ie,rt),G=xe}}}if(Ea)throw p=Ld,Ea=!1,Ld=null,p}function wi(p,g){var T=g[Gg];T===void 0&&(T=g[Gg]=new Set);var O=p+"__bubble";T.has(O)||(RC(g,p,2,!1),T.add(O))}function $0(p,g,T){var O=0;g&&(O|=4),RC(T,p,O,g)}var qE="_reactListening"+Math.random().toString(36).slice(2);function _p(p){if(!p[qE]){p[qE]=!0,a.forEach(function(T){T!=="selectionchange"&&(tN.has(T)||$0(T,!1,p),$0(T,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[qE]||(g[qE]=!0,$0("selectionchange",!1,g))}}function RC(p,g,T,O){switch(Wr(g)){case 1:var M=De;break;case 4:M=et;break;default:M=Yt}T=M.bind(null,g,T,p),M=void 0,!gs||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(M=!0),O?M!==void 0?p.addEventListener(g,T,{capture:!0,passive:M}):p.addEventListener(g,T,!0):M!==void 0?p.addEventListener(g,T,{passive:M}):p.addEventListener(g,T,!1)}function YE(p,g,T,O,M){var G=O;if((g&1)===0&&(g&2)===0&&O!==null)e:for(;;){if(O===null)return;var ae=O.tag;if(ae===3||ae===4){var Ie=O.stateNode.containerInfo;if(Ie===M||Ie.nodeType===8&&Ie.parentNode===M)break;if(ae===4)for(ae=O.return;ae!==null;){var xe=ae.tag;if((xe===3||xe===4)&&(xe=ae.stateNode.containerInfo,xe===M||xe.nodeType===8&&xe.parentNode===M))return;ae=ae.return}for(;Ie!==null;){if(ae=yp(Ie),ae===null)return;if(xe=ae.tag,xe===5||xe===6){O=G=ae;continue e}Ie=Ie.parentNode}}O=O.return}Do(function(){var rt=G,At=Oi(T),Ot=[];e:{var Ct=TC.get(p);if(Ct!==void 0){var Kt=zd,Zt=p;switch(p){case"keypress":if(Bo(T)===0)break e;case"keydown":case"keyup":Kt=W;break;case"focusin":Zt="focus",Kt=qf;break;case"focusout":Zt="blur",Kt=qf;break;case"beforeblur":case"afterblur":Kt=qf;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Kt=$f;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Kt=BE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Kt=at;break;case gp:case vC:case SC:Kt=Gu;break;case bC:Kt=$r;break;case"scroll":Kt=Ng;break;case"wheel":Kt=vr;break;case"copy":case"cut":case"paste":Kt=Lg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Kt=me}var en=(g&4)!==0,Qi=!en&&p==="scroll",Ye=en?Ct!==null?Ct+"Capture":null:Ct;en=[];for(var Ve=rt,Je;Ve!==null;){Je=Ve;var Nt=Je.stateNode;if(Je.tag===5&&Nt!==null&&(Je=Nt,Ye!==null&&(Nt=Ui(Ve,Ye),Nt!=null&&en.push(Zf(Ve,Nt,Je)))),Qi)break;Ve=Ve.return}0<en.length&&(Ct=new Kt(Ct,Zt,null,T,At),Ot.push({event:Ct,listeners:en}))}}if((g&7)===0){e:{if(Ct=p==="mouseover"||p==="pointerover",Kt=p==="mouseout"||p==="pointerout",Ct&&T!==ir&&(Zt=T.relatedTarget||T.fromElement)&&(yp(Zt)||Zt[Rc]))break e;if((Kt||Ct)&&(Ct=At.window===At?At:(Ct=At.ownerDocument)?Ct.defaultView||Ct.parentWindow:window,Kt?(Zt=T.relatedTarget||T.toElement,Kt=rt,Zt=Zt?yp(Zt):null,Zt!==null&&(Qi=$s(Zt),Zt!==Qi||Zt.tag!==5&&Zt.tag!==6)&&(Zt=null)):(Kt=null,Zt=rt),Kt!==Zt)){if(en=$f,Nt="onMouseLeave",Ye="onMouseEnter",Ve="mouse",(p==="pointerout"||p==="pointerover")&&(en=me,Nt="onPointerLeave",Ye="onPointerEnter",Ve="pointer"),Qi=Kt==null?Ct:vp(Kt),Je=Zt==null?Ct:vp(Zt),Ct=new en(Nt,Ve+"leave",Kt,T,At),Ct.target=Qi,Ct.relatedTarget=Je,Nt=null,yp(At)===rt&&(en=new en(Ye,Ve+"enter",Zt,T,At),en.target=Je,en.relatedTarget=Qi,Nt=en),Qi=Nt,Kt&&Zt)t:{for(en=Kt,Ye=Zt,Ve=0,Je=en;Je;Je=Ep(Je))Ve++;for(Je=0,Nt=Ye;Nt;Nt=Ep(Nt))Je++;for(;0<Ve-Je;)en=Ep(en),Ve--;for(;0<Je-Ve;)Ye=Ep(Ye),Je--;for(;Ve--;){if(en===Ye||Ye!==null&&en===Ye.alternate)break t;en=Ep(en),Ye=Ep(Ye)}en=null}else en=null;Kt!==null&&Bg(Ot,Ct,Kt,en,!1),Zt!==null&&Qi!==null&&Bg(Ot,Qi,Zt,en,!0)}}e:{if(Ct=rt?vp(rt):window,Kt=Ct.nodeName&&Ct.nodeName.toLowerCase(),Kt==="select"||Kt==="input"&&Ct.type==="file")var nn=q1;else if(uC(Ct))if(dC)nn=Q1;else{nn=X1;var fn=Y1}else(Kt=Ct.nodeName)&&Kt.toLowerCase()==="input"&&(Ct.type==="checkbox"||Ct.type==="radio")&&(nn=J1);if(nn&&(nn=nn(p,rt))){V0(Ot,nn,T,At);break e}fn&&fn(p,Ct,rt),p==="focusout"&&(fn=Ct._wrapperState)&&fn.controlled&&Ct.type==="number"&&Fe(Ct,"number",Ct.value)}switch(fn=rt?vp(rt):window,p){case"focusin":(uC(fn)||fn.contentEditable==="true")&&(st=fn,W0=rt,Vg=null);break;case"focusout":Vg=W0=st=null;break;case"mousedown":z0=!0;break;case"contextmenu":case"mouseup":case"dragend":z0=!1,EC(Ot,T,At);break;case"selectionchange":if(Z1)break;case"keydown":case"keyup":EC(Ot,T,At)}var En;if(Es)e:{switch(p){case"compositionstart":var Nn="onCompositionStart";break e;case"compositionend":Nn="onCompositionEnd";break e;case"compositionupdate":Nn="onCompositionUpdate";break e}Nn=void 0}else Jf?aC(p,T)&&(Nn="onCompositionEnd"):p==="keydown"&&T.keyCode===229&&(Nn="onCompositionStart");Nn&&(hp&&T.locale!=="ko"&&(Jf||Nn!=="onCompositionStart"?Nn==="onCompositionEnd"&&Jf&&(En=xs()):(ln=At,xr="value"in ln?ln.value:ln.textContent,Jf=!0)),fn=XE(rt,Nn),0<fn.length&&(Nn=new Vn(Nn,p,null,T,At),Ot.push({event:Nn,listeners:fn}),En?Nn.data=En:(En=cC(T),En!==null&&(Nn.data=En)))),(En=Ho?H1(p,T):lC(p,T))&&(rt=XE(rt,"onBeforeInput"),0<rt.length&&(At=new Vn("onBeforeInput","beforeinput",null,T,At),Ot.push({event:At,listeners:rt}),At.data=En))}H0(Ot,g)})}function Zf(p,g,T){return{instance:p,listener:g,currentTarget:T}}function XE(p,g){for(var T=g+"Capture",O=[];p!==null;){var M=p,G=M.stateNode;M.tag===5&&G!==null&&(M=G,G=Ui(p,T),G!=null&&O.unshift(Zf(p,G,M)),G=Ui(p,g),G!=null&&O.push(Zf(p,G,M))),p=p.return}return O}function Ep(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function Bg(p,g,T,O,M){for(var G=g._reactName,ae=[];T!==null&&T!==O;){var Ie=T,xe=Ie.alternate,rt=Ie.stateNode;if(xe!==null&&xe===O)break;Ie.tag===5&&rt!==null&&(Ie=rt,M?(xe=Ui(T,G),xe!=null&&ae.unshift(Zf(T,xe,Ie))):M||(xe=Ui(T,G),xe!=null&&ae.push(Zf(T,xe,Ie)))),T=T.return}ae.length!==0&&p.push({event:g,listeners:ae})}var nN=/\r\n?/g,rN=/\u0000|\uFFFD/g;function CC(p){return(typeof p=="string"?p:""+p).replace(nN,`
`).replace(rN,"")}function JE(p,g,T){if(g=CC(g),CC(p)!==g&&T)throw Error(s(425))}function QE(){}var ZE=null,Wg=null;function K0(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var zg=typeof setTimeout=="function"?setTimeout:void 0,iN=typeof clearTimeout=="function"?clearTimeout:void 0,IC=typeof Promise=="function"?Promise:void 0,sN=typeof queueMicrotask=="function"?queueMicrotask:typeof IC<"u"?function(p){return IC.resolve(null).then(p).catch(oN)}:zg;function oN(p){setTimeout(function(){throw p})}function q0(p,g){var T=g,O=0;do{var M=T.nextSibling;if(p.removeChild(T),M&&M.nodeType===8)if(T=M.data,T==="/$"){if(O===0){p.removeChild(M),ba(g);return}O--}else T!=="$"&&T!=="$?"&&T!=="$!"||O++;T=M}while(T);ba(g)}function Hd(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function AC(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var T=p.data;if(T==="$"||T==="$!"||T==="$?"){if(g===0)return p;g--}else T==="/$"&&g++}p=p.previousSibling}return null}var em=Math.random().toString(36).slice(2),Kl="__reactFiber$"+em,$d="__reactProps$"+em,Rc="__reactContainer$"+em,Gg="__reactEvents$"+em,aN="__reactListeners$"+em,cN="__reactHandles$"+em;function yp(p){var g=p[Kl];if(g)return g;for(var T=p.parentNode;T;){if(g=T[Rc]||T[Kl]){if(T=g.alternate,g.child!==null||T!==null&&T.child!==null)for(p=AC(p);p!==null;){if(T=p[Kl])return T;p=AC(p)}return g}p=T,T=p.parentNode}return null}function tm(p){return p=p[Kl]||p[Rc],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function vp(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(s(33))}function nm(p){return p[$d]||null}var Y0=[],rm=-1;function Cc(p){return{current:p}}function Ri(p){0>rm||(p.current=Y0[rm],Y0[rm]=null,rm--)}function Ei(p,g){rm++,Y0[rm]=p.current,p.current=g}var Kd={},yo=Cc(Kd),wa=Cc(!1),Sp=Kd;function bp(p,g){var T=p.type.contextTypes;if(!T)return Kd;var O=p.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===g)return O.__reactInternalMemoizedMaskedChildContext;var M={},G;for(G in T)M[G]=g[G];return O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=M),M}function Ra(p){return p=p.childContextTypes,p!=null}function ey(){Ri(wa),Ri(yo)}function PC(p,g,T){if(yo.current!==Kd)throw Error(s(168));Ei(yo,g),Ei(wa,T)}function ty(p,g,T){var O=p.stateNode;if(g=g.childContextTypes,typeof O.getChildContext!="function")return T;O=O.getChildContext();for(var M in O)if(!(M in g))throw Error(s(108,tt(p)||"Unknown",M));return Ne({},T,O)}function ny(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Kd,Sp=yo.current,Ei(yo,p),Ei(wa,wa.current),!0}function OC(p,g,T){var O=p.stateNode;if(!O)throw Error(s(169));T?(p=ty(p,g,Sp),O.__reactInternalMemoizedMergedChildContext=p,Ri(wa),Ri(yo),Ei(yo,p)):Ri(wa),Ei(wa,T)}var Ic=null,ry=!1,X0=!1;function kC(p){Ic===null?Ic=[p]:Ic.push(p)}function lN(p){ry=!0,kC(p)}function qd(){if(!X0&&Ic!==null){X0=!0;var p=0,g=sr;try{var T=Ic;for(sr=1;p<T.length;p++){var O=T[p];do O=O(!0);while(O!==null)}Ic=null,ry=!1}catch(M){throw Ic!==null&&(Ic=Ic.slice(p+1)),Ud(yc,qd),M}finally{sr=g,X0=!1}}return null}var im=[],$u=0,Hg=null,iy=0,Ac=[],tc=0,Tp=null,Ku=1,qu="";function Yu(p,g){im[$u++]=iy,im[$u++]=Hg,Hg=p,iy=g}function sy(p,g,T){Ac[tc++]=Ku,Ac[tc++]=qu,Ac[tc++]=Tp,Tp=p;var O=Ku;p=qu;var M=32-no(O)-1;O&=~(1<<M),T+=1;var G=32-no(g)+M;if(30<G){var ae=M-M%5;G=(O&(1<<ae)-1).toString(32),O>>=ae,M-=ae,Ku=1<<32-no(g)+M|T<<M|O,qu=G+p}else Ku=1<<G|T<<M|O,qu=p}function oy(p){p.return!==null&&(Yu(p,1),sy(p,1,0))}function $g(p){for(;p===Hg;)Hg=im[--$u],im[$u]=null,iy=im[--$u],im[$u]=null;for(;p===Tp;)Tp=Ac[--tc],Ac[tc]=null,qu=Ac[--tc],Ac[tc]=null,Ku=Ac[--tc],Ac[tc]=null}var Ca=null,Ia=null,ci=!1,$o=null;function NC(p,g){var T=ic(5,null,null,0);T.elementType="DELETED",T.stateNode=g,T.return=p,g=p.deletions,g===null?(p.deletions=[T],p.flags|=16):g.push(T)}function DC(p,g){switch(p.tag){case 5:var T=p.type;return g=g.nodeType!==1||T.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,Ca=p,Ia=Hd(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,Ca=p,Ia=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(T=Tp!==null?{id:Ku,overflow:qu}:null,p.memoizedState={dehydrated:g,treeContext:T,retryLane:1073741824},T=ic(18,null,null,0),T.stateNode=g,T.return=p,p.child=T,Ca=p,Ia=null,!0):!1;default:return!1}}function ay(p){return(p.mode&1)!==0&&(p.flags&128)===0}function J0(p){if(ci){var g=Ia;if(g){var T=g;if(!DC(p,g)){if(ay(p))throw Error(s(418));g=Hd(T.nextSibling);var O=Ca;g&&DC(p,g)?NC(O,T):(p.flags=p.flags&-4097|2,ci=!1,Ca=p)}}else{if(ay(p))throw Error(s(418));p.flags=p.flags&-4097|2,ci=!1,Ca=p}}}function LC(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;Ca=p}function Kg(p){if(p!==Ca)return!1;if(!ci)return LC(p),ci=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!K0(p.type,p.memoizedProps)),g&&(g=Ia)){if(ay(p))throw xC(),Error(s(418));for(;g;)NC(p,g),g=Hd(g.nextSibling)}if(LC(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var T=p.data;if(T==="/$"){if(g===0){Ia=Hd(p.nextSibling);break e}g--}else T!=="$"&&T!=="$!"&&T!=="$?"||g++}p=p.nextSibling}Ia=null}}else Ia=Ca?Hd(p.stateNode.nextSibling):null;return!0}function xC(){for(var p=Ia;p;)p=Hd(p.nextSibling)}function sm(){Ia=Ca=null,ci=!1}function Q0(p){$o===null?$o=[p]:$o.push(p)}var uN=ce.ReactCurrentBatchConfig;function qg(p,g,T){if(p=T.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(s(309));var O=T.stateNode}if(!O)throw Error(s(147,p));var M=O,G=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===G?g.ref:(g=function(ae){var Ie=M.refs;ae===null?delete Ie[G]:Ie[G]=ae},g._stringRef=G,g)}if(typeof p!="string")throw Error(s(284));if(!T._owner)throw Error(s(290,p))}return p}function cy(p,g){throw p=Object.prototype.toString.call(g),Error(s(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function Z0(p){var g=p._init;return g(p._payload)}function Yd(p){function g(Ye,Ve){if(p){var Je=Ye.deletions;Je===null?(Ye.deletions=[Ve],Ye.flags|=16):Je.push(Ve)}}function T(Ye,Ve){if(!p)return null;for(;Ve!==null;)g(Ye,Ve),Ve=Ve.sibling;return null}function O(Ye,Ve){for(Ye=new Map;Ve!==null;)Ve.key!==null?Ye.set(Ve.key,Ve):Ye.set(Ve.index,Ve),Ve=Ve.sibling;return Ye}function M(Ye,Ve){return Ye=rd(Ye,Ve),Ye.index=0,Ye.sibling=null,Ye}function G(Ye,Ve,Je){return Ye.index=Je,p?(Je=Ye.alternate,Je!==null?(Je=Je.index,Je<Ve?(Ye.flags|=2,Ve):Je):(Ye.flags|=2,Ve)):(Ye.flags|=1048576,Ve)}function ae(Ye){return p&&Ye.alternate===null&&(Ye.flags|=2),Ye}function Ie(Ye,Ve,Je,Nt){return Ve===null||Ve.tag!==6?(Ve=Mb(Je,Ye.mode,Nt),Ve.return=Ye,Ve):(Ve=M(Ve,Je),Ve.return=Ye,Ve)}function xe(Ye,Ve,Je,Nt){var nn=Je.type;return nn===ne?At(Ye,Ve,Je.props.children,Nt,Je.key):Ve!==null&&(Ve.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===nt&&Z0(nn)===Ve.type)?(Nt=M(Ve,Je.props),Nt.ref=qg(Ye,Ve,Je),Nt.return=Ye,Nt):(Nt=qy(Je.type,Je.key,Je.props,null,Ye.mode,Nt),Nt.ref=qg(Ye,Ve,Je),Nt.return=Ye,Nt)}function rt(Ye,Ve,Je,Nt){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==Je.containerInfo||Ve.stateNode.implementation!==Je.implementation?(Ve=Ub(Je,Ye.mode,Nt),Ve.return=Ye,Ve):(Ve=M(Ve,Je.children||[]),Ve.return=Ye,Ve)}function At(Ye,Ve,Je,Nt,nn){return Ve===null||Ve.tag!==7?(Ve=xp(Je,Ye.mode,Nt,nn),Ve.return=Ye,Ve):(Ve=M(Ve,Je),Ve.return=Ye,Ve)}function Ot(Ye,Ve,Je){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Ve=Mb(""+Ve,Ye.mode,Je),Ve.return=Ye,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case oe:return Je=qy(Ve.type,Ve.key,Ve.props,null,Ye.mode,Je),Je.ref=qg(Ye,null,Ve),Je.return=Ye,Je;case _e:return Ve=Ub(Ve,Ye.mode,Je),Ve.return=Ye,Ve;case nt:var Nt=Ve._init;return Ot(Ye,Nt(Ve._payload),Je)}if(We(Ve)||ve(Ve))return Ve=xp(Ve,Ye.mode,Je,null),Ve.return=Ye,Ve;cy(Ye,Ve)}return null}function Ct(Ye,Ve,Je,Nt){var nn=Ve!==null?Ve.key:null;if(typeof Je=="string"&&Je!==""||typeof Je=="number")return nn!==null?null:Ie(Ye,Ve,""+Je,Nt);if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case oe:return Je.key===nn?xe(Ye,Ve,Je,Nt):null;case _e:return Je.key===nn?rt(Ye,Ve,Je,Nt):null;case nt:return nn=Je._init,Ct(Ye,Ve,nn(Je._payload),Nt)}if(We(Je)||ve(Je))return nn!==null?null:At(Ye,Ve,Je,Nt,null);cy(Ye,Je)}return null}function Kt(Ye,Ve,Je,Nt,nn){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Ye=Ye.get(Je)||null,Ie(Ve,Ye,""+Nt,nn);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case oe:return Ye=Ye.get(Nt.key===null?Je:Nt.key)||null,xe(Ve,Ye,Nt,nn);case _e:return Ye=Ye.get(Nt.key===null?Je:Nt.key)||null,rt(Ve,Ye,Nt,nn);case nt:var fn=Nt._init;return Kt(Ye,Ve,Je,fn(Nt._payload),nn)}if(We(Nt)||ve(Nt))return Ye=Ye.get(Je)||null,At(Ve,Ye,Nt,nn,null);cy(Ve,Nt)}return null}function Zt(Ye,Ve,Je,Nt){for(var nn=null,fn=null,En=Ve,Nn=Ve=0,Ts=null;En!==null&&Nn<Je.length;Nn++){En.index>Nn?(Ts=En,En=null):Ts=En.sibling;var Sr=Ct(Ye,En,Je[Nn],Nt);if(Sr===null){En===null&&(En=Ts);break}p&&En&&Sr.alternate===null&&g(Ye,En),Ve=G(Sr,Ve,Nn),fn===null?nn=Sr:fn.sibling=Sr,fn=Sr,En=Ts}if(Nn===Je.length)return T(Ye,En),ci&&Yu(Ye,Nn),nn;if(En===null){for(;Nn<Je.length;Nn++)En=Ot(Ye,Je[Nn],Nt),En!==null&&(Ve=G(En,Ve,Nn),fn===null?nn=En:fn.sibling=En,fn=En);return ci&&Yu(Ye,Nn),nn}for(En=O(Ye,En);Nn<Je.length;Nn++)Ts=Kt(En,Ye,Nn,Je[Nn],Nt),Ts!==null&&(p&&Ts.alternate!==null&&En.delete(Ts.key===null?Nn:Ts.key),Ve=G(Ts,Ve,Nn),fn===null?nn=Ts:fn.sibling=Ts,fn=Ts);return p&&En.forEach(function(oh){return g(Ye,oh)}),ci&&Yu(Ye,Nn),nn}function en(Ye,Ve,Je,Nt){var nn=ve(Je);if(typeof nn!="function")throw Error(s(150));if(Je=nn.call(Je),Je==null)throw Error(s(151));for(var fn=nn=null,En=Ve,Nn=Ve=0,Ts=null,Sr=Je.next();En!==null&&!Sr.done;Nn++,Sr=Je.next()){En.index>Nn?(Ts=En,En=null):Ts=En.sibling;var oh=Ct(Ye,En,Sr.value,Nt);if(oh===null){En===null&&(En=Ts);break}p&&En&&oh.alternate===null&&g(Ye,En),Ve=G(oh,Ve,Nn),fn===null?nn=oh:fn.sibling=oh,fn=oh,En=Ts}if(Sr.done)return T(Ye,En),ci&&Yu(Ye,Nn),nn;if(En===null){for(;!Sr.done;Nn++,Sr=Je.next())Sr=Ot(Ye,Sr.value,Nt),Sr!==null&&(Ve=G(Sr,Ve,Nn),fn===null?nn=Sr:fn.sibling=Sr,fn=Sr);return ci&&Yu(Ye,Nn),nn}for(En=O(Ye,En);!Sr.done;Nn++,Sr=Je.next())Sr=Kt(En,Ye,Nn,Sr.value,Nt),Sr!==null&&(p&&Sr.alternate!==null&&En.delete(Sr.key===null?Nn:Sr.key),Ve=G(Sr,Ve,Nn),fn===null?nn=Sr:fn.sibling=Sr,fn=Sr);return p&&En.forEach(function(CN){return g(Ye,CN)}),ci&&Yu(Ye,Nn),nn}function Qi(Ye,Ve,Je,Nt){if(typeof Je=="object"&&Je!==null&&Je.type===ne&&Je.key===null&&(Je=Je.props.children),typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case oe:e:{for(var nn=Je.key,fn=Ve;fn!==null;){if(fn.key===nn){if(nn=Je.type,nn===ne){if(fn.tag===7){T(Ye,fn.sibling),Ve=M(fn,Je.props.children),Ve.return=Ye,Ye=Ve;break e}}else if(fn.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===nt&&Z0(nn)===fn.type){T(Ye,fn.sibling),Ve=M(fn,Je.props),Ve.ref=qg(Ye,fn,Je),Ve.return=Ye,Ye=Ve;break e}T(Ye,fn);break}else g(Ye,fn);fn=fn.sibling}Je.type===ne?(Ve=xp(Je.props.children,Ye.mode,Nt,Je.key),Ve.return=Ye,Ye=Ve):(Nt=qy(Je.type,Je.key,Je.props,null,Ye.mode,Nt),Nt.ref=qg(Ye,Ve,Je),Nt.return=Ye,Ye=Nt)}return ae(Ye);case _e:e:{for(fn=Je.key;Ve!==null;){if(Ve.key===fn)if(Ve.tag===4&&Ve.stateNode.containerInfo===Je.containerInfo&&Ve.stateNode.implementation===Je.implementation){T(Ye,Ve.sibling),Ve=M(Ve,Je.children||[]),Ve.return=Ye,Ye=Ve;break e}else{T(Ye,Ve);break}else g(Ye,Ve);Ve=Ve.sibling}Ve=Ub(Je,Ye.mode,Nt),Ve.return=Ye,Ye=Ve}return ae(Ye);case nt:return fn=Je._init,Qi(Ye,Ve,fn(Je._payload),Nt)}if(We(Je))return Zt(Ye,Ve,Je,Nt);if(ve(Je))return en(Ye,Ve,Je,Nt);cy(Ye,Je)}return typeof Je=="string"&&Je!==""||typeof Je=="number"?(Je=""+Je,Ve!==null&&Ve.tag===6?(T(Ye,Ve.sibling),Ve=M(Ve,Je),Ve.return=Ye,Ye=Ve):(T(Ye,Ve),Ve=Mb(Je,Ye.mode,Nt),Ve.return=Ye,Ye=Ve),ae(Ye)):T(Ye,Ve)}return Qi}var om=Yd(!0),MC=Yd(!1),ly=Cc(null),Yg=null,am=null,uy=null;function eb(){uy=am=Yg=null}function tb(p){var g=ly.current;Ri(ly),p._currentValue=g}function nb(p,g,T){for(;p!==null;){var O=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,O!==null&&(O.childLanes|=g)):O!==null&&(O.childLanes&g)!==g&&(O.childLanes|=g),p===T)break;p=p.return}}function Xu(p,g){Yg=p,uy=am=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(Pa=!0),p.firstContext=null)}function Pc(p){var g=p._currentValue;if(uy!==p)if(p={context:p,memoizedValue:g,next:null},am===null){if(Yg===null)throw Error(s(308));am=p,Yg.dependencies={lanes:0,firstContext:p}}else am=am.next=p;return g}var wp=null;function rb(p){wp===null?wp=[p]:wp.push(p)}function UC(p,g,T,O){var M=g.interleaved;return M===null?(T.next=T,rb(g)):(T.next=M.next,M.next=T),g.interleaved=T,Ju(p,O)}function Ju(p,g){p.lanes|=g;var T=p.alternate;for(T!==null&&(T.lanes|=g),T=p,p=p.return;p!==null;)p.childLanes|=g,T=p.alternate,T!==null&&(T.childLanes|=g),T=p,p=p.return;return T.tag===3?T.stateNode:null}var Xd=!1;function Xg(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function VC(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function ql(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function Jd(p,g,T){var O=p.updateQueue;if(O===null)return null;if(O=O.shared,(Cr&2)!==0){var M=O.pending;return M===null?g.next=g:(g.next=M.next,M.next=g),O.pending=g,Ju(p,T)}return M=O.interleaved,M===null?(g.next=g,rb(O)):(g.next=M.next,M.next=g),O.interleaved=g,Ju(p,T)}function Jg(p,g,T){if(g=g.updateQueue,g!==null&&(g=g.shared,(T&4194240)!==0)){var O=g.lanes;O&=p.pendingLanes,T|=O,g.lanes=T,Ja(p,T)}}function FC(p,g){var T=p.updateQueue,O=p.alternate;if(O!==null&&(O=O.updateQueue,T===O)){var M=null,G=null;if(T=T.firstBaseUpdate,T!==null){do{var ae={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};G===null?M=G=ae:G=G.next=ae,T=T.next}while(T!==null);G===null?M=G=g:G=G.next=g}else M=G=g;T={baseState:O.baseState,firstBaseUpdate:M,lastBaseUpdate:G,shared:O.shared,effects:O.effects},p.updateQueue=T;return}p=T.lastBaseUpdate,p===null?T.firstBaseUpdate=g:p.next=g,T.lastBaseUpdate=g}function dy(p,g,T,O){var M=p.updateQueue;Xd=!1;var G=M.firstBaseUpdate,ae=M.lastBaseUpdate,Ie=M.shared.pending;if(Ie!==null){M.shared.pending=null;var xe=Ie,rt=xe.next;xe.next=null,ae===null?G=rt:ae.next=rt,ae=xe;var At=p.alternate;At!==null&&(At=At.updateQueue,Ie=At.lastBaseUpdate,Ie!==ae&&(Ie===null?At.firstBaseUpdate=rt:Ie.next=rt,At.lastBaseUpdate=xe))}if(G!==null){var Ot=M.baseState;ae=0,At=rt=xe=null,Ie=G;do{var Ct=Ie.lane,Kt=Ie.eventTime;if((O&Ct)===Ct){At!==null&&(At=At.next={eventTime:Kt,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var Zt=p,en=Ie;switch(Ct=g,Kt=T,en.tag){case 1:if(Zt=en.payload,typeof Zt=="function"){Ot=Zt.call(Kt,Ot,Ct);break e}Ot=Zt;break e;case 3:Zt.flags=Zt.flags&-65537|128;case 0:if(Zt=en.payload,Ct=typeof Zt=="function"?Zt.call(Kt,Ot,Ct):Zt,Ct==null)break e;Ot=Ne({},Ot,Ct);break e;case 2:Xd=!0}}Ie.callback!==null&&Ie.lane!==0&&(p.flags|=64,Ct=M.effects,Ct===null?M.effects=[Ie]:Ct.push(Ie))}else Kt={eventTime:Kt,lane:Ct,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},At===null?(rt=At=Kt,xe=Ot):At=At.next=Kt,ae|=Ct;if(Ie=Ie.next,Ie===null){if(Ie=M.shared.pending,Ie===null)break;Ct=Ie,Ie=Ct.next,Ct.next=null,M.lastBaseUpdate=Ct,M.shared.pending=null}}while(!0);if(At===null&&(xe=Ot),M.baseState=xe,M.firstBaseUpdate=rt,M.lastBaseUpdate=At,g=M.shared.interleaved,g!==null){M=g;do ae|=M.lane,M=M.next;while(M!==g)}else G===null&&(M.shared.lanes=0);Op|=ae,p.lanes=ae,p.memoizedState=Ot}}function jC(p,g,T){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var O=p[g],M=O.callback;if(M!==null){if(O.callback=null,O=T,typeof M!="function")throw Error(s(191,M));M.call(O)}}}var Qg={},Yl=Cc(Qg),Zg=Cc(Qg),cm=Cc(Qg);function Rp(p){if(p===Qg)throw Error(s(174));return p}function ib(p,g){switch(Ei(cm,g),Ei(Zg,p),Ei(Yl,Qg),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:cn(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=cn(g,p)}Ri(Yl),Ei(Yl,g)}function Cp(){Ri(Yl),Ri(Zg),Ri(cm)}function BC(p){Rp(cm.current);var g=Rp(Yl.current),T=cn(g,p.type);g!==T&&(Ei(Zg,p),Ei(Yl,T))}function lm(p){Zg.current===p&&(Ri(Yl),Ri(Zg))}var ki=Cc(0);function Qd(p){for(var g=p;g!==null;){if(g.tag===13){var T=g.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var sb=[];function ob(){for(var p=0;p<sb.length;p++)sb[p]._workInProgressVersionPrimary=null;sb.length=0}var hy=ce.ReactCurrentDispatcher,ab=ce.ReactCurrentBatchConfig,Xl=0,Vi=null,ys=null,vs=null,um=!1,e_=!1,t_=0,dN=0;function vo(){throw Error(s(321))}function cb(p,g){if(g===null)return!1;for(var T=0;T<g.length&&T<p.length;T++)if(!ml(p[T],g[T]))return!1;return!0}function dm(p,g,T,O,M,G){if(Xl=G,Vi=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,hy.current=p===null||p.memoizedState===null?fN:QC,p=T(O,M),e_){G=0;do{if(e_=!1,t_=0,25<=G)throw Error(s(301));G+=1,vs=ys=null,g.updateQueue=null,hy.current=mN,p=T(O,M)}while(e_)}if(hy.current=gy,g=ys!==null&&ys.next!==null,Xl=0,vs=ys=Vi=null,um=!1,g)throw Error(s(300));return p}function lb(){var p=t_!==0;return t_=0,p}function Ko(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vs===null?Vi.memoizedState=vs=p:vs=vs.next=p,vs}function Aa(){if(ys===null){var p=Vi.alternate;p=p!==null?p.memoizedState:null}else p=ys.next;var g=vs===null?Vi.memoizedState:vs.next;if(g!==null)vs=g,ys=p;else{if(p===null)throw Error(s(310));ys=p,p={memoizedState:ys.memoizedState,baseState:ys.baseState,baseQueue:ys.baseQueue,queue:ys.queue,next:null},vs===null?Vi.memoizedState=vs=p:vs=vs.next=p}return vs}function Zd(p,g){return typeof g=="function"?g(p):g}function Ip(p){var g=Aa(),T=g.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=p;var O=ys,M=O.baseQueue,G=T.pending;if(G!==null){if(M!==null){var ae=M.next;M.next=G.next,G.next=ae}O.baseQueue=M=G,T.pending=null}if(M!==null){G=M.next,O=O.baseState;var Ie=ae=null,xe=null,rt=G;do{var At=rt.lane;if((Xl&At)===At)xe!==null&&(xe=xe.next={lane:0,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null}),O=rt.hasEagerState?rt.eagerState:p(O,rt.action);else{var Ot={lane:At,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null};xe===null?(Ie=xe=Ot,ae=O):xe=xe.next=Ot,Vi.lanes|=At,Op|=At}rt=rt.next}while(rt!==null&&rt!==G);xe===null?ae=O:xe.next=Ie,ml(O,g.memoizedState)||(Pa=!0),g.memoizedState=O,g.baseState=ae,g.baseQueue=xe,T.lastRenderedState=O}if(p=T.interleaved,p!==null){M=p;do G=M.lane,Vi.lanes|=G,Op|=G,M=M.next;while(M!==p)}else M===null&&(T.lanes=0);return[g.memoizedState,T.dispatch]}function hm(p){var g=Aa(),T=g.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=p;var O=T.dispatch,M=T.pending,G=g.memoizedState;if(M!==null){T.pending=null;var ae=M=M.next;do G=p(G,ae.action),ae=ae.next;while(ae!==M);ml(G,g.memoizedState)||(Pa=!0),g.memoizedState=G,g.baseQueue===null&&(g.baseState=G),T.lastRenderedState=G}return[G,O]}function WC(){}function ub(p,g){var T=Vi,O=Aa(),M=g(),G=!ml(O.memoizedState,M);if(G&&(O.memoizedState=M,Pa=!0),O=O.queue,Oc(GC.bind(null,T,O,p),[p]),O.getSnapshot!==g||G||vs!==null&&vs.memoizedState.tag&1){if(T.flags|=2048,n_(9,db.bind(null,T,O,M,g),void 0,null),qs===null)throw Error(s(349));(Xl&30)!==0||zC(T,g,M)}return M}function zC(p,g,T){p.flags|=16384,p={getSnapshot:g,value:T},g=Vi.updateQueue,g===null?(g={lastEffect:null,stores:null},Vi.updateQueue=g,g.stores=[p]):(T=g.stores,T===null?g.stores=[p]:T.push(p))}function db(p,g,T,O){g.value=T,g.getSnapshot=O,HC(g)&&py(p)}function GC(p,g,T){return T(function(){HC(g)&&py(p)})}function HC(p){var g=p.getSnapshot;p=p.value;try{var T=g();return!ml(p,T)}catch{return!0}}function py(p){var g=Ju(p,1);g!==null&&Lc(g,p,1,-1)}function fy(p){var g=Ko();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zd,lastRenderedState:p},g.queue=p,p=p.dispatch=pN.bind(null,Vi,p),[g.memoizedState,p]}function n_(p,g,T,O){return p={tag:p,create:g,destroy:T,deps:O,next:null},g=Vi.updateQueue,g===null?(g={lastEffect:null,stores:null},Vi.updateQueue=g,g.lastEffect=p.next=p):(T=g.lastEffect,T===null?g.lastEffect=p.next=p:(O=T.next,T.next=p,p.next=O,g.lastEffect=p)),p}function $C(){return Aa().memoizedState}function r_(p,g,T,O){var M=Ko();Vi.flags|=p,M.memoizedState=n_(1|g,T,void 0,O===void 0?null:O)}function pm(p,g,T,O){var M=Aa();O=O===void 0?null:O;var G=void 0;if(ys!==null){var ae=ys.memoizedState;if(G=ae.destroy,O!==null&&cb(O,ae.deps)){M.memoizedState=n_(g,T,G,O);return}}Vi.flags|=p,M.memoizedState=n_(1|g,T,G,O)}function KC(p,g){return r_(8390656,8,p,g)}function Oc(p,g){return pm(2048,8,p,g)}function Ap(p,g){return pm(4,2,p,g)}function eh(p,g){return pm(4,4,p,g)}function hb(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function pb(p,g,T){return T=T!=null?T.concat([p]):null,pm(4,4,hb.bind(null,g,p),T)}function Qu(){}function my(p,g){var T=Aa();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&cb(g,O[1])?O[0]:(T.memoizedState=[p,g],p)}function qC(p,g){var T=Aa();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&cb(g,O[1])?O[0]:(p=p(),T.memoizedState=[p,g],p)}function fb(p,g,T){return(Xl&21)===0?(p.baseState&&(p.baseState=!1,Pa=!0),p.memoizedState=T):(ml(T,g)||(T=Fu(),Vi.lanes|=T,Op|=T,p.baseState=!0),g)}function hN(p,g){var T=sr;sr=T!==0&&4>T?T:4,p(!0);var O=ab.transition;ab.transition={};try{p(!1),g()}finally{sr=T,ab.transition=O}}function mb(){return Aa().memoizedState}function YC(p,g,T){var O=Dc(p);if(T={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null},Zu(p))XC(g,T);else if(T=UC(p,g,T,O),T!==null){var M=so();Lc(T,p,O,M),JC(T,g,O)}}function pN(p,g,T){var O=Dc(p),M={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null};if(Zu(p))XC(g,M);else{var G=p.alternate;if(p.lanes===0&&(G===null||G.lanes===0)&&(G=g.lastRenderedReducer,G!==null))try{var ae=g.lastRenderedState,Ie=G(ae,T);if(M.hasEagerState=!0,M.eagerState=Ie,ml(Ie,ae)){var xe=g.interleaved;xe===null?(M.next=M,rb(g)):(M.next=xe.next,xe.next=M),g.interleaved=M;return}}catch{}finally{}T=UC(p,g,M,O),T!==null&&(M=so(),Lc(T,p,O,M),JC(T,g,O))}}function Zu(p){var g=p.alternate;return p===Vi||g!==null&&g===Vi}function XC(p,g){e_=um=!0;var T=p.pending;T===null?g.next=g:(g.next=T.next,T.next=g),p.pending=g}function JC(p,g,T){if((T&4194240)!==0){var O=g.lanes;O&=p.pendingLanes,T|=O,g.lanes=T,Ja(p,T)}}var gy={readContext:Pc,useCallback:vo,useContext:vo,useEffect:vo,useImperativeHandle:vo,useInsertionEffect:vo,useLayoutEffect:vo,useMemo:vo,useReducer:vo,useRef:vo,useState:vo,useDebugValue:vo,useDeferredValue:vo,useTransition:vo,useMutableSource:vo,useSyncExternalStore:vo,useId:vo,unstable_isNewReconciler:!1},fN={readContext:Pc,useCallback:function(p,g){return Ko().memoizedState=[p,g===void 0?null:g],p},useContext:Pc,useEffect:KC,useImperativeHandle:function(p,g,T){return T=T!=null?T.concat([p]):null,r_(4194308,4,hb.bind(null,g,p),T)},useLayoutEffect:function(p,g){return r_(4194308,4,p,g)},useInsertionEffect:function(p,g){return r_(4,2,p,g)},useMemo:function(p,g){var T=Ko();return g=g===void 0?null:g,p=p(),T.memoizedState=[p,g],p},useReducer:function(p,g,T){var O=Ko();return g=T!==void 0?T(g):g,O.memoizedState=O.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},O.queue=p,p=p.dispatch=YC.bind(null,Vi,p),[O.memoizedState,p]},useRef:function(p){var g=Ko();return p={current:p},g.memoizedState=p},useState:fy,useDebugValue:Qu,useDeferredValue:function(p){return Ko().memoizedState=p},useTransition:function(){var p=fy(!1),g=p[0];return p=hN.bind(null,p[1]),Ko().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,T){var O=Vi,M=Ko();if(ci){if(T===void 0)throw Error(s(407));T=T()}else{if(T=g(),qs===null)throw Error(s(349));(Xl&30)!==0||zC(O,g,T)}M.memoizedState=T;var G={value:T,getSnapshot:g};return M.queue=G,KC(GC.bind(null,O,G,p),[p]),O.flags|=2048,n_(9,db.bind(null,O,G,T,g),void 0,null),T},useId:function(){var p=Ko(),g=qs.identifierPrefix;if(ci){var T=qu,O=Ku;T=(O&~(1<<32-no(O)-1)).toString(32)+T,g=":"+g+"R"+T,T=t_++,0<T&&(g+="H"+T.toString(32)),g+=":"}else T=dN++,g=":"+g+"r"+T.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},QC={readContext:Pc,useCallback:my,useContext:Pc,useEffect:Oc,useImperativeHandle:pb,useInsertionEffect:Ap,useLayoutEffect:eh,useMemo:qC,useReducer:Ip,useRef:$C,useState:function(){return Ip(Zd)},useDebugValue:Qu,useDeferredValue:function(p){var g=Aa();return fb(g,ys.memoizedState,p)},useTransition:function(){var p=Ip(Zd)[0],g=Aa().memoizedState;return[p,g]},useMutableSource:WC,useSyncExternalStore:ub,useId:mb,unstable_isNewReconciler:!1},mN={readContext:Pc,useCallback:my,useContext:Pc,useEffect:Oc,useImperativeHandle:pb,useInsertionEffect:Ap,useLayoutEffect:eh,useMemo:qC,useReducer:hm,useRef:$C,useState:function(){return hm(Zd)},useDebugValue:Qu,useDeferredValue:function(p){var g=Aa();return ys===null?g.memoizedState=p:fb(g,ys.memoizedState,p)},useTransition:function(){var p=hm(Zd)[0],g=Aa().memoizedState;return[p,g]},useMutableSource:WC,useSyncExternalStore:ub,useId:mb,unstable_isNewReconciler:!1};function nc(p,g){if(p&&p.defaultProps){g=Ne({},g),p=p.defaultProps;for(var T in p)g[T]===void 0&&(g[T]=p[T]);return g}return g}function _y(p,g,T,O){g=p.memoizedState,T=T(O,g),T=T==null?g:Ne({},g,T),p.memoizedState=T,p.lanes===0&&(p.updateQueue.baseState=T)}var Ey={isMounted:function(p){return(p=p._reactInternals)?$s(p)===p:!1},enqueueSetState:function(p,g,T){p=p._reactInternals;var O=so(),M=Dc(p),G=ql(O,M);G.payload=g,T!=null&&(G.callback=T),g=Jd(p,G,M),g!==null&&(Lc(g,p,M,O),Jg(g,p,M))},enqueueReplaceState:function(p,g,T){p=p._reactInternals;var O=so(),M=Dc(p),G=ql(O,M);G.tag=1,G.payload=g,T!=null&&(G.callback=T),g=Jd(p,G,M),g!==null&&(Lc(g,p,M,O),Jg(g,p,M))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var T=so(),O=Dc(p),M=ql(T,O);M.tag=2,g!=null&&(M.callback=g),g=Jd(p,M,O),g!==null&&(Lc(g,p,O,T),Jg(g,p,O))}};function gb(p,g,T,O,M,G,ae){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(O,G,ae):g.prototype&&g.prototype.isPureReactComponent?!Mg(T,O)||!Mg(M,G):!0}function ZC(p,g,T){var O=!1,M=Kd,G=g.contextType;return typeof G=="object"&&G!==null?G=Pc(G):(M=Ra(g)?Sp:yo.current,O=g.contextTypes,G=(O=O!=null)?bp(p,M):Kd),g=new g(T,G),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Ey,p.stateNode=g,g._reactInternals=p,O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=M,p.__reactInternalMemoizedMaskedChildContext=G),g}function eI(p,g,T,O){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(T,O),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(T,O),g.state!==p&&Ey.enqueueReplaceState(g,g.state,null)}function _b(p,g,T,O){var M=p.stateNode;M.props=T,M.state=p.memoizedState,M.refs={},Xg(p);var G=g.contextType;typeof G=="object"&&G!==null?M.context=Pc(G):(G=Ra(g)?Sp:yo.current,M.context=bp(p,G)),M.state=p.memoizedState,G=g.getDerivedStateFromProps,typeof G=="function"&&(_y(p,g,G,T),M.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(g=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),g!==M.state&&Ey.enqueueReplaceState(M,M.state,null),dy(p,T,M,O),M.state=p.memoizedState),typeof M.componentDidMount=="function"&&(p.flags|=4194308)}function fm(p,g){try{var T="",O=g;do T+=Ge(O),O=O.return;while(O);var M=T}catch(G){M=`
Error generating stack: `+G.message+`
`+G.stack}return{value:p,source:g,stack:M,digest:null}}function Eb(p,g,T){return{value:p,source:null,stack:T??null,digest:g??null}}function yb(p,g){try{console.error(g.value)}catch(T){setTimeout(function(){throw T})}}var gN=typeof WeakMap=="function"?WeakMap:Map;function vb(p,g,T){T=ql(-1,T),T.tag=3,T.payload={element:null};var O=g.value;return T.callback=function(){My||(My=!0,kb=O),yb(p,g)},T}function ed(p,g,T){T=ql(-1,T),T.tag=3;var O=p.type.getDerivedStateFromError;if(typeof O=="function"){var M=g.value;T.payload=function(){return O(M)},T.callback=function(){yb(p,g)}}var G=p.stateNode;return G!==null&&typeof G.componentDidCatch=="function"&&(T.callback=function(){yb(p,g),typeof O!="function"&&(th===null?th=new Set([this]):th.add(this));var ae=g.stack;this.componentDidCatch(g.value,{componentStack:ae!==null?ae:""})}),T}function tI(p,g,T){var O=p.pingCache;if(O===null){O=p.pingCache=new gN;var M=new Set;O.set(g,M)}else M=O.get(g),M===void 0&&(M=new Set,O.set(g,M));M.has(T)||(M.add(T),p=RI.bind(null,p,g,T),g.then(p,p))}function nI(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function rI(p,g,T,O,M){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(g=ql(-1,1),g.tag=2,Jd(T,g,1))),T.lanes|=1),p):(p.flags|=65536,p.lanes=M,p)}var _N=ce.ReactCurrentOwner,Pa=!1;function qo(p,g,T,O){g.child=p===null?MC(g,null,T,O):om(g,p.child,T,O)}function yy(p,g,T,O,M){T=T.render;var G=g.ref;return Xu(g,M),O=dm(p,g,T,O,G,M),T=lb(),p!==null&&!Pa?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~M,Jl(p,g,M)):(ci&&T&&oy(g),g.flags|=1,qo(p,g,O,M),g.child)}function iI(p,g,T,O,M){if(p===null){var G=T.type;return typeof G=="function"&&!rh(G)&&G.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(g.tag=15,g.type=G,sI(p,g,G,O,M)):(p=qy(T.type,null,O,g,g.mode,M),p.ref=g.ref,p.return=g,g.child=p)}if(G=p.child,(p.lanes&M)===0){var ae=G.memoizedProps;if(T=T.compare,T=T!==null?T:Mg,T(ae,O)&&p.ref===g.ref)return Jl(p,g,M)}return g.flags|=1,p=rd(G,O),p.ref=g.ref,p.return=g,g.child=p}function sI(p,g,T,O,M){if(p!==null){var G=p.memoizedProps;if(Mg(G,O)&&p.ref===g.ref)if(Pa=!1,g.pendingProps=O=G,(p.lanes&M)!==0)(p.flags&131072)!==0&&(Pa=!0);else return g.lanes=p.lanes,Jl(p,g,M)}return Sb(p,g,T,O,M)}function oI(p,g,T){var O=g.pendingProps,M=O.children,G=p!==null?p.memoizedState:null;if(O.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ei(gl,rc),rc|=T;else{if((T&1073741824)===0)return p=G!==null?G.baseLanes|T:T,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,Ei(gl,rc),rc|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=G!==null?G.baseLanes:T,Ei(gl,rc),rc|=O}else G!==null?(O=G.baseLanes|T,g.memoizedState=null):O=T,Ei(gl,rc),rc|=O;return qo(p,g,M,T),g.child}function aI(p,g){var T=g.ref;(p===null&&T!==null||p!==null&&p.ref!==T)&&(g.flags|=512,g.flags|=2097152)}function Sb(p,g,T,O,M){var G=Ra(T)?Sp:yo.current;return G=bp(g,G),Xu(g,M),T=dm(p,g,T,O,G,M),O=lb(),p!==null&&!Pa?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~M,Jl(p,g,M)):(ci&&O&&oy(g),g.flags|=1,qo(p,g,T,M),g.child)}function cI(p,g,T,O,M){if(Ra(T)){var G=!0;ny(g)}else G=!1;if(Xu(g,M),g.stateNode===null)Ry(p,g),ZC(g,T,O),_b(g,T,O,M),O=!0;else if(p===null){var ae=g.stateNode,Ie=g.memoizedProps;ae.props=Ie;var xe=ae.context,rt=T.contextType;typeof rt=="object"&&rt!==null?rt=Pc(rt):(rt=Ra(T)?Sp:yo.current,rt=bp(g,rt));var At=T.getDerivedStateFromProps,Ot=typeof At=="function"||typeof ae.getSnapshotBeforeUpdate=="function";Ot||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==O||xe!==rt)&&eI(g,ae,O,rt),Xd=!1;var Ct=g.memoizedState;ae.state=Ct,dy(g,O,ae,M),xe=g.memoizedState,Ie!==O||Ct!==xe||wa.current||Xd?(typeof At=="function"&&(_y(g,T,At,O),xe=g.memoizedState),(Ie=Xd||gb(g,T,Ie,O,Ct,xe,rt))?(Ot||typeof ae.UNSAFE_componentWillMount!="function"&&typeof ae.componentWillMount!="function"||(typeof ae.componentWillMount=="function"&&ae.componentWillMount(),typeof ae.UNSAFE_componentWillMount=="function"&&ae.UNSAFE_componentWillMount()),typeof ae.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=O,g.memoizedState=xe),ae.props=O,ae.state=xe,ae.context=rt,O=Ie):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),O=!1)}else{ae=g.stateNode,VC(p,g),Ie=g.memoizedProps,rt=g.type===g.elementType?Ie:nc(g.type,Ie),ae.props=rt,Ot=g.pendingProps,Ct=ae.context,xe=T.contextType,typeof xe=="object"&&xe!==null?xe=Pc(xe):(xe=Ra(T)?Sp:yo.current,xe=bp(g,xe));var Kt=T.getDerivedStateFromProps;(At=typeof Kt=="function"||typeof ae.getSnapshotBeforeUpdate=="function")||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==Ot||Ct!==xe)&&eI(g,ae,O,xe),Xd=!1,Ct=g.memoizedState,ae.state=Ct,dy(g,O,ae,M);var Zt=g.memoizedState;Ie!==Ot||Ct!==Zt||wa.current||Xd?(typeof Kt=="function"&&(_y(g,T,Kt,O),Zt=g.memoizedState),(rt=Xd||gb(g,T,rt,O,Ct,Zt,xe)||!1)?(At||typeof ae.UNSAFE_componentWillUpdate!="function"&&typeof ae.componentWillUpdate!="function"||(typeof ae.componentWillUpdate=="function"&&ae.componentWillUpdate(O,Zt,xe),typeof ae.UNSAFE_componentWillUpdate=="function"&&ae.UNSAFE_componentWillUpdate(O,Zt,xe)),typeof ae.componentDidUpdate=="function"&&(g.flags|=4),typeof ae.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ae.componentDidUpdate!="function"||Ie===p.memoizedProps&&Ct===p.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&Ct===p.memoizedState||(g.flags|=1024),g.memoizedProps=O,g.memoizedState=Zt),ae.props=O,ae.state=Zt,ae.context=xe,O=rt):(typeof ae.componentDidUpdate!="function"||Ie===p.memoizedProps&&Ct===p.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&Ct===p.memoizedState||(g.flags|=1024),O=!1)}return vy(p,g,T,O,G,M)}function vy(p,g,T,O,M,G){aI(p,g);var ae=(g.flags&128)!==0;if(!O&&!ae)return M&&OC(g,T,!1),Jl(p,g,G);O=g.stateNode,_N.current=g;var Ie=ae&&typeof T.getDerivedStateFromError!="function"?null:O.render();return g.flags|=1,p!==null&&ae?(g.child=om(g,p.child,null,G),g.child=om(g,null,Ie,G)):qo(p,g,Ie,G),g.memoizedState=O.state,M&&OC(g,T,!0),g.child}function bb(p){var g=p.stateNode;g.pendingContext?PC(p,g.pendingContext,g.pendingContext!==g.context):g.context&&PC(p,g.context,!1),ib(p,g.containerInfo)}function lI(p,g,T,O,M){return sm(),Q0(M),g.flags|=256,qo(p,g,T,O),g.child}var Tb={dehydrated:null,treeContext:null,retryLane:0};function mm(p){return{baseLanes:p,cachePool:null,transitions:null}}function Sy(p,g,T){var O=g.pendingProps,M=ki.current,G=!1,ae=(g.flags&128)!==0,Ie;if((Ie=ae)||(Ie=p!==null&&p.memoizedState===null?!1:(M&2)!==0),Ie?(G=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(M|=1),Ei(ki,M&1),p===null)return J0(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ae=O.children,p=O.fallback,G?(O=g.mode,G=g.child,ae={mode:"hidden",children:ae},(O&1)===0&&G!==null?(G.childLanes=0,G.pendingProps=ae):G=ih(ae,O,0,null),p=xp(p,O,T,null),G.return=g,p.return=g,G.sibling=p,g.child=G,g.child.memoizedState=mm(T),g.memoizedState=Tb,p):by(g,ae));if(M=p.memoizedState,M!==null&&(Ie=M.dehydrated,Ie!==null))return uI(p,g,ae,O,Ie,M,T);if(G){G=O.fallback,ae=g.mode,M=p.child,Ie=M.sibling;var xe={mode:"hidden",children:O.children};return(ae&1)===0&&g.child!==M?(O=g.child,O.childLanes=0,O.pendingProps=xe,g.deletions=null):(O=rd(M,xe),O.subtreeFlags=M.subtreeFlags&14680064),Ie!==null?G=rd(Ie,G):(G=xp(G,ae,T,null),G.flags|=2),G.return=g,O.return=g,O.sibling=G,g.child=O,O=G,G=g.child,ae=p.child.memoizedState,ae=ae===null?mm(T):{baseLanes:ae.baseLanes|T,cachePool:null,transitions:ae.transitions},G.memoizedState=ae,G.childLanes=p.childLanes&~T,g.memoizedState=Tb,O}return G=p.child,p=G.sibling,O=rd(G,{mode:"visible",children:O.children}),(g.mode&1)===0&&(O.lanes=T),O.return=g,O.sibling=null,p!==null&&(T=g.deletions,T===null?(g.deletions=[p],g.flags|=16):T.push(p)),g.child=O,g.memoizedState=null,O}function by(p,g){return g=ih({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function Pp(p,g,T,O){return O!==null&&Q0(O),om(g,p.child,null,T),p=by(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function uI(p,g,T,O,M,G,ae){if(T)return g.flags&256?(g.flags&=-257,O=Eb(Error(s(422))),Pp(p,g,ae,O)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(G=O.fallback,M=g.mode,O=ih({mode:"visible",children:O.children},M,0,null),G=xp(G,M,ae,null),G.flags|=2,O.return=g,G.return=g,O.sibling=G,g.child=O,(g.mode&1)!==0&&om(g,p.child,null,ae),g.child.memoizedState=mm(ae),g.memoizedState=Tb,G);if((g.mode&1)===0)return Pp(p,g,ae,null);if(M.data==="$!"){if(O=M.nextSibling&&M.nextSibling.dataset,O)var Ie=O.dgst;return O=Ie,G=Error(s(419)),O=Eb(G,O,void 0),Pp(p,g,ae,O)}if(Ie=(ae&p.childLanes)!==0,Pa||Ie){if(O=qs,O!==null){switch(ae&-ae){case 4:M=2;break;case 16:M=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:M=32;break;case 536870912:M=268435456;break;default:M=0}M=(M&(O.suspendedLanes|ae))!==0?0:M,M!==0&&M!==G.retryLane&&(G.retryLane=M,Ju(p,M),Lc(O,p,M,-1))}return Lb(),O=Eb(Error(s(421))),Pp(p,g,ae,O)}return M.data==="$?"?(g.flags|=128,g.child=p.child,g=Hy.bind(null,p),M._reactRetry=g,null):(p=G.treeContext,Ia=Hd(M.nextSibling),Ca=g,ci=!0,$o=null,p!==null&&(Ac[tc++]=Ku,Ac[tc++]=qu,Ac[tc++]=Tp,Ku=p.id,qu=p.overflow,Tp=g),g=by(g,O.children),g.flags|=4096,g)}function dI(p,g,T){p.lanes|=g;var O=p.alternate;O!==null&&(O.lanes|=g),nb(p.return,g,T)}function Ty(p,g,T,O,M){var G=p.memoizedState;G===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:O,tail:T,tailMode:M}:(G.isBackwards=g,G.rendering=null,G.renderingStartTime=0,G.last=O,G.tail=T,G.tailMode=M)}function wy(p,g,T){var O=g.pendingProps,M=O.revealOrder,G=O.tail;if(qo(p,g,O.children,T),O=ki.current,(O&2)!==0)O=O&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&dI(p,T,g);else if(p.tag===19)dI(p,T,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}O&=1}if(Ei(ki,O),(g.mode&1)===0)g.memoizedState=null;else switch(M){case"forwards":for(T=g.child,M=null;T!==null;)p=T.alternate,p!==null&&Qd(p)===null&&(M=T),T=T.sibling;T=M,T===null?(M=g.child,g.child=null):(M=T.sibling,T.sibling=null),Ty(g,!1,M,T,G);break;case"backwards":for(T=null,M=g.child,g.child=null;M!==null;){if(p=M.alternate,p!==null&&Qd(p)===null){g.child=M;break}p=M.sibling,M.sibling=T,T=M,M=p}Ty(g,!0,T,null,G);break;case"together":Ty(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Ry(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function Jl(p,g,T){if(p!==null&&(g.dependencies=p.dependencies),Op|=g.lanes,(T&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(s(153));if(g.child!==null){for(p=g.child,T=rd(p,p.pendingProps),g.child=T,T.return=g;p.sibling!==null;)p=p.sibling,T=T.sibling=rd(p,p.pendingProps),T.return=g;T.sibling=null}return g.child}function hI(p,g,T){switch(g.tag){case 3:bb(g),sm();break;case 5:BC(g);break;case 1:Ra(g.type)&&ny(g);break;case 4:ib(g,g.stateNode.containerInfo);break;case 10:var O=g.type._context,M=g.memoizedProps.value;Ei(ly,O._currentValue),O._currentValue=M;break;case 13:if(O=g.memoizedState,O!==null)return O.dehydrated!==null?(Ei(ki,ki.current&1),g.flags|=128,null):(T&g.child.childLanes)!==0?Sy(p,g,T):(Ei(ki,ki.current&1),p=Jl(p,g,T),p!==null?p.sibling:null);Ei(ki,ki.current&1);break;case 19:if(O=(T&g.childLanes)!==0,(p.flags&128)!==0){if(O)return wy(p,g,T);g.flags|=128}if(M=g.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),Ei(ki,ki.current),O)break;return null;case 22:case 23:return g.lanes=0,oI(p,g,T)}return Jl(p,g,T)}var pI,Cy,wb,fI;pI=function(p,g){for(var T=g.child;T!==null;){if(T.tag===5||T.tag===6)p.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===g)break;for(;T.sibling===null;){if(T.return===null||T.return===g)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},Cy=function(){},wb=function(p,g,T,O){var M=p.memoizedProps;if(M!==O){p=g.stateNode,Rp(Yl.current);var G=null;switch(T){case"input":M=kn(p,M),O=kn(p,O),G=[];break;case"select":M=Ne({},M,{value:void 0}),O=Ne({},O,{value:void 0}),G=[];break;case"textarea":M=Et(p,M),O=Et(p,O),G=[];break;default:typeof M.onClick!="function"&&typeof O.onClick=="function"&&(p.onclick=QE)}Pt(T,O);var ae;T=null;for(rt in M)if(!O.hasOwnProperty(rt)&&M.hasOwnProperty(rt)&&M[rt]!=null)if(rt==="style"){var Ie=M[rt];for(ae in Ie)Ie.hasOwnProperty(ae)&&(T||(T={}),T[ae]="")}else rt!=="dangerouslySetInnerHTML"&&rt!=="children"&&rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&rt!=="autoFocus"&&(l.hasOwnProperty(rt)?G||(G=[]):(G=G||[]).push(rt,null));for(rt in O){var xe=O[rt];if(Ie=M!=null?M[rt]:void 0,O.hasOwnProperty(rt)&&xe!==Ie&&(xe!=null||Ie!=null))if(rt==="style")if(Ie){for(ae in Ie)!Ie.hasOwnProperty(ae)||xe&&xe.hasOwnProperty(ae)||(T||(T={}),T[ae]="");for(ae in xe)xe.hasOwnProperty(ae)&&Ie[ae]!==xe[ae]&&(T||(T={}),T[ae]=xe[ae])}else T||(G||(G=[]),G.push(rt,T)),T=xe;else rt==="dangerouslySetInnerHTML"?(xe=xe?xe.__html:void 0,Ie=Ie?Ie.__html:void 0,xe!=null&&Ie!==xe&&(G=G||[]).push(rt,xe)):rt==="children"?typeof xe!="string"&&typeof xe!="number"||(G=G||[]).push(rt,""+xe):rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&(l.hasOwnProperty(rt)?(xe!=null&&rt==="onScroll"&&wi("scroll",p),G||Ie===xe||(G=[])):(G=G||[]).push(rt,xe))}T&&(G=G||[]).push("style",T);var rt=G;(g.updateQueue=rt)&&(g.flags|=4)}},fI=function(p,g,T,O){T!==O&&(g.flags|=4)};function i_(p,g){if(!ci)switch(p.tailMode){case"hidden":g=p.tail;for(var T=null;g!==null;)g.alternate!==null&&(T=g),g=g.sibling;T===null?p.tail=null:T.sibling=null;break;case"collapsed":T=p.tail;for(var O=null;T!==null;)T.alternate!==null&&(O=T),T=T.sibling;O===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:O.sibling=null}}function So(p){var g=p.alternate!==null&&p.alternate.child===p.child,T=0,O=0;if(g)for(var M=p.child;M!==null;)T|=M.lanes|M.childLanes,O|=M.subtreeFlags&14680064,O|=M.flags&14680064,M.return=p,M=M.sibling;else for(M=p.child;M!==null;)T|=M.lanes|M.childLanes,O|=M.subtreeFlags,O|=M.flags,M.return=p,M=M.sibling;return p.subtreeFlags|=O,p.childLanes=T,g}function Iy(p,g,T){var O=g.pendingProps;switch($g(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return So(g),null;case 1:return Ra(g.type)&&ey(),So(g),null;case 3:return O=g.stateNode,Cp(),Ri(wa),Ri(yo),ob(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(p===null||p.child===null)&&(Kg(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,$o!==null&&(By($o),$o=null))),Cy(p,g),So(g),null;case 5:lm(g);var M=Rp(cm.current);if(T=g.type,p!==null&&g.stateNode!=null)wb(p,g,T,O,M),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!O){if(g.stateNode===null)throw Error(s(166));return So(g),null}if(p=Rp(Yl.current),Kg(g)){O=g.stateNode,T=g.type;var G=g.memoizedProps;switch(O[Kl]=g,O[$d]=G,p=(g.mode&1)!==0,T){case"dialog":wi("cancel",O),wi("close",O);break;case"iframe":case"object":case"embed":wi("load",O);break;case"video":case"audio":for(M=0;M<jg.length;M++)wi(jg[M],O);break;case"source":wi("error",O);break;case"img":case"image":case"link":wi("error",O),wi("load",O);break;case"details":wi("toggle",O);break;case"input":$t(O,G),wi("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!G.multiple},wi("invalid",O);break;case"textarea":yt(O,G),wi("invalid",O)}Pt(T,G),M=null;for(var ae in G)if(G.hasOwnProperty(ae)){var Ie=G[ae];ae==="children"?typeof Ie=="string"?O.textContent!==Ie&&(G.suppressHydrationWarning!==!0&&JE(O.textContent,Ie,p),M=["children",Ie]):typeof Ie=="number"&&O.textContent!==""+Ie&&(G.suppressHydrationWarning!==!0&&JE(O.textContent,Ie,p),M=["children",""+Ie]):l.hasOwnProperty(ae)&&Ie!=null&&ae==="onScroll"&&wi("scroll",O)}switch(T){case"input":un(O),Re(O,G,!0);break;case"textarea":un(O),pn(O);break;case"select":case"option":break;default:typeof G.onClick=="function"&&(O.onclick=QE)}O=M,g.updateQueue=O,O!==null&&(g.flags|=4)}else{ae=M.nodeType===9?M:M.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=xn(T)),p==="http://www.w3.org/1999/xhtml"?T==="script"?(p=ae.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof O.is=="string"?p=ae.createElement(T,{is:O.is}):(p=ae.createElement(T),T==="select"&&(ae=p,O.multiple?ae.multiple=!0:O.size&&(ae.size=O.size))):p=ae.createElementNS(p,T),p[Kl]=g,p[$d]=O,pI(p,g,!1,!1),g.stateNode=p;e:{switch(ae=wn(T,O),T){case"dialog":wi("cancel",p),wi("close",p),M=O;break;case"iframe":case"object":case"embed":wi("load",p),M=O;break;case"video":case"audio":for(M=0;M<jg.length;M++)wi(jg[M],p);M=O;break;case"source":wi("error",p),M=O;break;case"img":case"image":case"link":wi("error",p),wi("load",p),M=O;break;case"details":wi("toggle",p),M=O;break;case"input":$t(p,O),M=kn(p,O),wi("invalid",p);break;case"option":M=O;break;case"select":p._wrapperState={wasMultiple:!!O.multiple},M=Ne({},O,{value:void 0}),wi("invalid",p);break;case"textarea":yt(p,O),M=Et(p,O),wi("invalid",p);break;default:M=O}Pt(T,M),Ie=M;for(G in Ie)if(Ie.hasOwnProperty(G)){var xe=Ie[G];G==="style"?Ls(p,xe):G==="dangerouslySetInnerHTML"?(xe=xe?xe.__html:void 0,xe!=null&&pa(p,xe)):G==="children"?typeof xe=="string"?(T!=="textarea"||xe!=="")&&Vt(p,xe):typeof xe=="number"&&Vt(p,""+xe):G!=="suppressContentEditableWarning"&&G!=="suppressHydrationWarning"&&G!=="autoFocus"&&(l.hasOwnProperty(G)?xe!=null&&G==="onScroll"&&wi("scroll",p):xe!=null&&te(p,G,xe,ae))}switch(T){case"input":un(p),Re(p,O,!1);break;case"textarea":un(p),pn(p);break;case"option":O.value!=null&&p.setAttribute("value",""+dt(O.value));break;case"select":p.multiple=!!O.multiple,G=O.value,G!=null?ot(p,!!O.multiple,G,!1):O.defaultValue!=null&&ot(p,!!O.multiple,O.defaultValue,!0);break;default:typeof M.onClick=="function"&&(p.onclick=QE)}switch(T){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return So(g),null;case 6:if(p&&g.stateNode!=null)fI(p,g,p.memoizedProps,O);else{if(typeof O!="string"&&g.stateNode===null)throw Error(s(166));if(T=Rp(cm.current),Rp(Yl.current),Kg(g)){if(O=g.stateNode,T=g.memoizedProps,O[Kl]=g,(G=O.nodeValue!==T)&&(p=Ca,p!==null))switch(p.tag){case 3:JE(O.nodeValue,T,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&JE(O.nodeValue,T,(p.mode&1)!==0)}G&&(g.flags|=4)}else O=(T.nodeType===9?T:T.ownerDocument).createTextNode(O),O[Kl]=g,g.stateNode=O}return So(g),null;case 13:if(Ri(ki),O=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(ci&&Ia!==null&&(g.mode&1)!==0&&(g.flags&128)===0)xC(),sm(),g.flags|=98560,G=!1;else if(G=Kg(g),O!==null&&O.dehydrated!==null){if(p===null){if(!G)throw Error(s(318));if(G=g.memoizedState,G=G!==null?G.dehydrated:null,!G)throw Error(s(317));G[Kl]=g}else sm(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;So(g),G=!1}else $o!==null&&(By($o),$o=null),G=!0;if(!G)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=T,g):(O=O!==null,O!==(p!==null&&p.memoizedState!==null)&&O&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(ki.current&1)!==0?bs===0&&(bs=3):Lb())),g.updateQueue!==null&&(g.flags|=4),So(g),null);case 4:return Cp(),Cy(p,g),p===null&&_p(g.stateNode.containerInfo),So(g),null;case 10:return tb(g.type._context),So(g),null;case 17:return Ra(g.type)&&ey(),So(g),null;case 19:if(Ri(ki),G=g.memoizedState,G===null)return So(g),null;if(O=(g.flags&128)!==0,ae=G.rendering,ae===null)if(O)i_(G,!1);else{if(bs!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(ae=Qd(p),ae!==null){for(g.flags|=128,i_(G,!1),O=ae.updateQueue,O!==null&&(g.updateQueue=O,g.flags|=4),g.subtreeFlags=0,O=T,T=g.child;T!==null;)G=T,p=O,G.flags&=14680066,ae=G.alternate,ae===null?(G.childLanes=0,G.lanes=p,G.child=null,G.subtreeFlags=0,G.memoizedProps=null,G.memoizedState=null,G.updateQueue=null,G.dependencies=null,G.stateNode=null):(G.childLanes=ae.childLanes,G.lanes=ae.lanes,G.child=ae.child,G.subtreeFlags=0,G.deletions=null,G.memoizedProps=ae.memoizedProps,G.memoizedState=ae.memoizedState,G.updateQueue=ae.updateQueue,G.type=ae.type,p=ae.dependencies,G.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),T=T.sibling;return Ei(ki,ki.current&1|2),g.child}p=p.sibling}G.tail!==null&&Br()>Em&&(g.flags|=128,O=!0,i_(G,!1),g.lanes=4194304)}else{if(!O)if(p=Qd(ae),p!==null){if(g.flags|=128,O=!0,T=p.updateQueue,T!==null&&(g.updateQueue=T,g.flags|=4),i_(G,!0),G.tail===null&&G.tailMode==="hidden"&&!ae.alternate&&!ci)return So(g),null}else 2*Br()-G.renderingStartTime>Em&&T!==1073741824&&(g.flags|=128,O=!0,i_(G,!1),g.lanes=4194304);G.isBackwards?(ae.sibling=g.child,g.child=ae):(T=G.last,T!==null?T.sibling=ae:g.child=ae,G.last=ae)}return G.tail!==null?(g=G.tail,G.rendering=g,G.tail=g.sibling,G.renderingStartTime=Br(),g.sibling=null,T=ki.current,Ei(ki,O?T&1|2:T&1),g):(So(g),null);case 22:case 23:return h_(),O=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==O&&(g.flags|=8192),O&&(g.mode&1)!==0?(rc&1073741824)!==0&&(So(g),g.subtreeFlags&6&&(g.flags|=8192)):So(g),null;case 24:return null;case 25:return null}throw Error(s(156,g.tag))}function EN(p,g){switch($g(g),g.tag){case 1:return Ra(g.type)&&ey(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return Cp(),Ri(wa),Ri(yo),ob(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return lm(g),null;case 13:if(Ri(ki),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(s(340));sm()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return Ri(ki),null;case 4:return Cp(),null;case 10:return tb(g.type._context),null;case 22:case 23:return h_(),null;case 24:return null;default:return null}}var Ay=!1,bo=!1,mI=typeof WeakSet=="function"?WeakSet:Set,Jt=null;function gm(p,g){var T=p.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(O){Fi(p,g,O)}else T.current=null}function s_(p,g,T){try{T()}catch(O){Fi(p,g,O)}}var gI=!1;function Rb(p,g){if(ZE=Se,p=_C(),Ug(p)){if("selectionStart"in p)var T={start:p.selectionStart,end:p.selectionEnd};else e:{T=(T=p.ownerDocument)&&T.defaultView||window;var O=T.getSelection&&T.getSelection();if(O&&O.rangeCount!==0){T=O.anchorNode;var M=O.anchorOffset,G=O.focusNode;O=O.focusOffset;try{T.nodeType,G.nodeType}catch{T=null;break e}var ae=0,Ie=-1,xe=-1,rt=0,At=0,Ot=p,Ct=null;t:for(;;){for(var Kt;Ot!==T||M!==0&&Ot.nodeType!==3||(Ie=ae+M),Ot!==G||O!==0&&Ot.nodeType!==3||(xe=ae+O),Ot.nodeType===3&&(ae+=Ot.nodeValue.length),(Kt=Ot.firstChild)!==null;)Ct=Ot,Ot=Kt;for(;;){if(Ot===p)break t;if(Ct===T&&++rt===M&&(Ie=ae),Ct===G&&++At===O&&(xe=ae),(Kt=Ot.nextSibling)!==null)break;Ot=Ct,Ct=Ot.parentNode}Ot=Kt}T=Ie===-1||xe===-1?null:{start:Ie,end:xe}}else T=null}T=T||{start:0,end:0}}else T=null;for(Wg={focusedElem:p,selectionRange:T},Se=!1,Jt=g;Jt!==null;)if(g=Jt,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,Jt=p;else for(;Jt!==null;){g=Jt;try{var Zt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Zt!==null){var en=Zt.memoizedProps,Qi=Zt.memoizedState,Ye=g.stateNode,Ve=Ye.getSnapshotBeforeUpdate(g.elementType===g.type?en:nc(g.type,en),Qi);Ye.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:var Je=g.stateNode.containerInfo;Je.nodeType===1?Je.textContent="":Je.nodeType===9&&Je.documentElement&&Je.removeChild(Je.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Nt){Fi(g,g.return,Nt)}if(p=g.sibling,p!==null){p.return=g.return,Jt=p;break}Jt=g.return}return Zt=gI,gI=!1,Zt}function o_(p,g,T){var O=g.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var M=O=O.next;do{if((M.tag&p)===p){var G=M.destroy;M.destroy=void 0,G!==void 0&&s_(g,T,G)}M=M.next}while(M!==O)}}function a_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var T=g=g.next;do{if((T.tag&p)===p){var O=T.create;T.destroy=O()}T=T.next}while(T!==g)}}function Cb(p){var g=p.ref;if(g!==null){var T=p.stateNode;switch(p.tag){case 5:p=T;break;default:p=T}typeof g=="function"?g(p):g.current=p}}function _I(p){var g=p.alternate;g!==null&&(p.alternate=null,_I(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[Kl],delete g[$d],delete g[Gg],delete g[aN],delete g[cN])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function Ib(p){return p.tag===5||p.tag===3||p.tag===4}function EI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||Ib(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function Ab(p,g,T){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?T.nodeType===8?T.parentNode.insertBefore(p,g):T.insertBefore(p,g):(T.nodeType===8?(g=T.parentNode,g.insertBefore(p,T)):(g=T,g.appendChild(p)),T=T._reactRootContainer,T!=null||g.onclick!==null||(g.onclick=QE));else if(O!==4&&(p=p.child,p!==null))for(Ab(p,g,T),p=p.sibling;p!==null;)Ab(p,g,T),p=p.sibling}function Py(p,g,T){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?T.insertBefore(p,g):T.appendChild(p);else if(O!==4&&(p=p.child,p!==null))for(Py(p,g,T),p=p.sibling;p!==null;)Py(p,g,T),p=p.sibling}var ro=null,kc=!1;function Ql(p,g,T){for(T=T.child;T!==null;)yI(p,g,T),T=T.sibling}function yI(p,g,T){if(Eo&&typeof Eo.onCommitFiberUnmount=="function")try{Eo.onCommitFiberUnmount(Fl,T)}catch{}switch(T.tag){case 5:bo||gm(T,g);case 6:var O=ro,M=kc;ro=null,Ql(p,g,T),ro=O,kc=M,ro!==null&&(kc?(p=ro,T=T.stateNode,p.nodeType===8?p.parentNode.removeChild(T):p.removeChild(T)):ro.removeChild(T.stateNode));break;case 18:ro!==null&&(kc?(p=ro,T=T.stateNode,p.nodeType===8?q0(p.parentNode,T):p.nodeType===1&&q0(p,T),ba(p)):q0(ro,T.stateNode));break;case 4:O=ro,M=kc,ro=T.stateNode.containerInfo,kc=!0,Ql(p,g,T),ro=O,kc=M;break;case 0:case 11:case 14:case 15:if(!bo&&(O=T.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){M=O=O.next;do{var G=M,ae=G.destroy;G=G.tag,ae!==void 0&&((G&2)!==0||(G&4)!==0)&&s_(T,g,ae),M=M.next}while(M!==O)}Ql(p,g,T);break;case 1:if(!bo&&(gm(T,g),O=T.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=T.memoizedProps,O.state=T.memoizedState,O.componentWillUnmount()}catch(Ie){Fi(T,g,Ie)}Ql(p,g,T);break;case 21:Ql(p,g,T);break;case 22:T.mode&1?(bo=(O=bo)||T.memoizedState!==null,Ql(p,g,T),bo=O):Ql(p,g,T);break;default:Ql(p,g,T)}}function vI(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var T=p.stateNode;T===null&&(T=p.stateNode=new mI),g.forEach(function(O){var M=CI.bind(null,p,O);T.has(O)||(T.add(O),O.then(M,M))})}}function Yo(p,g){var T=g.deletions;if(T!==null)for(var O=0;O<T.length;O++){var M=T[O];try{var G=p,ae=g,Ie=ae;e:for(;Ie!==null;){switch(Ie.tag){case 5:ro=Ie.stateNode,kc=!1;break e;case 3:ro=Ie.stateNode.containerInfo,kc=!0;break e;case 4:ro=Ie.stateNode.containerInfo,kc=!0;break e}Ie=Ie.return}if(ro===null)throw Error(s(160));yI(G,ae,M),ro=null,kc=!1;var xe=M.alternate;xe!==null&&(xe.return=null),M.return=null}catch(rt){Fi(M,g,rt)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Pb(g,p),g=g.sibling}function Pb(p,g){var T=p.alternate,O=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Yo(g,p),Oa(p),O&4){try{o_(3,p,p.return),a_(3,p)}catch(en){Fi(p,p.return,en)}try{o_(5,p,p.return)}catch(en){Fi(p,p.return,en)}}break;case 1:Yo(g,p),Oa(p),O&512&&T!==null&&gm(T,T.return);break;case 5:if(Yo(g,p),Oa(p),O&512&&T!==null&&gm(T,T.return),p.flags&32){var M=p.stateNode;try{Vt(M,"")}catch(en){Fi(p,p.return,en)}}if(O&4&&(M=p.stateNode,M!=null)){var G=p.memoizedProps,ae=T!==null?T.memoizedProps:G,Ie=p.type,xe=p.updateQueue;if(p.updateQueue=null,xe!==null)try{Ie==="input"&&G.type==="radio"&&G.name!=null&&zn(M,G),wn(Ie,ae);var rt=wn(Ie,G);for(ae=0;ae<xe.length;ae+=2){var At=xe[ae],Ot=xe[ae+1];At==="style"?Ls(M,Ot):At==="dangerouslySetInnerHTML"?pa(M,Ot):At==="children"?Vt(M,Ot):te(M,At,Ot,rt)}switch(Ie){case"input":Bt(M,G);break;case"textarea":zt(M,G);break;case"select":var Ct=M._wrapperState.wasMultiple;M._wrapperState.wasMultiple=!!G.multiple;var Kt=G.value;Kt!=null?ot(M,!!G.multiple,Kt,!1):Ct!==!!G.multiple&&(G.defaultValue!=null?ot(M,!!G.multiple,G.defaultValue,!0):ot(M,!!G.multiple,G.multiple?[]:"",!1))}M[$d]=G}catch(en){Fi(p,p.return,en)}}break;case 6:if(Yo(g,p),Oa(p),O&4){if(p.stateNode===null)throw Error(s(162));M=p.stateNode,G=p.memoizedProps;try{M.nodeValue=G}catch(en){Fi(p,p.return,en)}}break;case 3:if(Yo(g,p),Oa(p),O&4&&T!==null&&T.memoizedState.isDehydrated)try{ba(g.containerInfo)}catch(en){Fi(p,p.return,en)}break;case 4:Yo(g,p),Oa(p);break;case 13:Yo(g,p),Oa(p),M=p.child,M.flags&8192&&(G=M.memoizedState!==null,M.stateNode.isHidden=G,!G||M.alternate!==null&&M.alternate.memoizedState!==null||(xy=Br())),O&4&&vI(p);break;case 22:if(At=T!==null&&T.memoizedState!==null,p.mode&1?(bo=(rt=bo)||At,Yo(g,p),bo=rt):Yo(g,p),Oa(p),O&8192){if(rt=p.memoizedState!==null,(p.stateNode.isHidden=rt)&&!At&&(p.mode&1)!==0)for(Jt=p,At=p.child;At!==null;){for(Ot=Jt=At;Jt!==null;){switch(Ct=Jt,Kt=Ct.child,Ct.tag){case 0:case 11:case 14:case 15:o_(4,Ct,Ct.return);break;case 1:gm(Ct,Ct.return);var Zt=Ct.stateNode;if(typeof Zt.componentWillUnmount=="function"){O=Ct,T=Ct.return;try{g=O,Zt.props=g.memoizedProps,Zt.state=g.memoizedState,Zt.componentWillUnmount()}catch(en){Fi(O,T,en)}}break;case 5:gm(Ct,Ct.return);break;case 22:if(Ct.memoizedState!==null){c_(Ot);continue}}Kt!==null?(Kt.return=Ct,Jt=Kt):c_(Ot)}At=At.sibling}e:for(At=null,Ot=p;;){if(Ot.tag===5){if(At===null){At=Ot;try{M=Ot.stateNode,rt?(G=M.style,typeof G.setProperty=="function"?G.setProperty("display","none","important"):G.display="none"):(Ie=Ot.stateNode,xe=Ot.memoizedProps.style,ae=xe!=null&&xe.hasOwnProperty("display")?xe.display:null,Ie.style.display=fs("display",ae))}catch(en){Fi(p,p.return,en)}}}else if(Ot.tag===6){if(At===null)try{Ot.stateNode.nodeValue=rt?"":Ot.memoizedProps}catch(en){Fi(p,p.return,en)}}else if((Ot.tag!==22&&Ot.tag!==23||Ot.memoizedState===null||Ot===p)&&Ot.child!==null){Ot.child.return=Ot,Ot=Ot.child;continue}if(Ot===p)break e;for(;Ot.sibling===null;){if(Ot.return===null||Ot.return===p)break e;At===Ot&&(At=null),Ot=Ot.return}At===Ot&&(At=null),Ot.sibling.return=Ot.return,Ot=Ot.sibling}}break;case 19:Yo(g,p),Oa(p),O&4&&vI(p);break;case 21:break;default:Yo(g,p),Oa(p)}}function Oa(p){var g=p.flags;if(g&2){try{e:{for(var T=p.return;T!==null;){if(Ib(T)){var O=T;break e}T=T.return}throw Error(s(160))}switch(O.tag){case 5:var M=O.stateNode;O.flags&32&&(Vt(M,""),O.flags&=-33);var G=EI(p);Py(p,G,M);break;case 3:case 4:var ae=O.stateNode.containerInfo,Ie=EI(p);Ab(p,Ie,ae);break;default:throw Error(s(161))}}catch(xe){Fi(p,p.return,xe)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function _m(p,g,T){Jt=p,Ob(p)}function Ob(p,g,T){for(var O=(p.mode&1)!==0;Jt!==null;){var M=Jt,G=M.child;if(M.tag===22&&O){var ae=M.memoizedState!==null||Ay;if(!ae){var Ie=M.alternate,xe=Ie!==null&&Ie.memoizedState!==null||bo;Ie=Ay;var rt=bo;if(Ay=ae,(bo=xe)&&!rt)for(Jt=M;Jt!==null;)ae=Jt,xe=ae.child,ae.tag===22&&ae.memoizedState!==null?SI(M):xe!==null?(xe.return=ae,Jt=xe):SI(M);for(;G!==null;)Jt=G,Ob(G),G=G.sibling;Jt=M,Ay=Ie,bo=rt}Oy(p)}else(M.subtreeFlags&8772)!==0&&G!==null?(G.return=M,Jt=G):Oy(p)}}function Oy(p){for(;Jt!==null;){var g=Jt;if((g.flags&8772)!==0){var T=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:bo||a_(5,g);break;case 1:var O=g.stateNode;if(g.flags&4&&!bo)if(T===null)O.componentDidMount();else{var M=g.elementType===g.type?T.memoizedProps:nc(g.type,T.memoizedProps);O.componentDidUpdate(M,T.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var G=g.updateQueue;G!==null&&jC(g,G,O);break;case 3:var ae=g.updateQueue;if(ae!==null){if(T=null,g.child!==null)switch(g.child.tag){case 5:T=g.child.stateNode;break;case 1:T=g.child.stateNode}jC(g,ae,T)}break;case 5:var Ie=g.stateNode;if(T===null&&g.flags&4){T=Ie;var xe=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":xe.autoFocus&&T.focus();break;case"img":xe.src&&(T.src=xe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var rt=g.alternate;if(rt!==null){var At=rt.memoizedState;if(At!==null){var Ot=At.dehydrated;Ot!==null&&ba(Ot)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}bo||g.flags&512&&Cb(g)}catch(Ct){Fi(g,g.return,Ct)}}if(g===p){Jt=null;break}if(T=g.sibling,T!==null){T.return=g.return,Jt=T;break}Jt=g.return}}function c_(p){for(;Jt!==null;){var g=Jt;if(g===p){Jt=null;break}var T=g.sibling;if(T!==null){T.return=g.return,Jt=T;break}Jt=g.return}}function SI(p){for(;Jt!==null;){var g=Jt;try{switch(g.tag){case 0:case 11:case 15:var T=g.return;try{a_(4,g)}catch(xe){Fi(g,T,xe)}break;case 1:var O=g.stateNode;if(typeof O.componentDidMount=="function"){var M=g.return;try{O.componentDidMount()}catch(xe){Fi(g,M,xe)}}var G=g.return;try{Cb(g)}catch(xe){Fi(g,G,xe)}break;case 5:var ae=g.return;try{Cb(g)}catch(xe){Fi(g,ae,xe)}}}catch(xe){Fi(g,g.return,xe)}if(g===p){Jt=null;break}var Ie=g.sibling;if(Ie!==null){Ie.return=g.return,Jt=Ie;break}Jt=g.return}}var yN=Math.ceil,ky=ce.ReactCurrentDispatcher,Ny=ce.ReactCurrentOwner,Nc=ce.ReactCurrentBatchConfig,Cr=0,qs=null,Ji=null,Ss=0,rc=0,gl=Cc(0),bs=0,io=null,Op=0,Dy=0,Ly=0,l_=null,Xo=null,xy=0,Em=1/0,Zl=null,My=!1,kb=null,th=null,ym=!1,eu=null,Uy=0,kp=0,Nb=null,u_=-1,Vy=0;function so(){return(Cr&6)!==0?Br():u_!==-1?u_:u_=Br()}function Dc(p){return(p.mode&1)===0?1:(Cr&2)!==0&&Ss!==0?Ss&-Ss:uN.transition!==null?(Vy===0&&(Vy=Fu()),Vy):(p=sr,p!==0||(p=window.event,p=p===void 0?16:Wr(p.type)),p)}function Lc(p,g,T,O){if(50<kp)throw kp=0,Nb=null,Error(s(185));Wl(p,T,O),((Cr&2)===0||p!==qs)&&(p===qs&&((Cr&2)===0&&(Dy|=T),bs===4&&td(p,Ss)),To(p,O),T===1&&Cr===0&&(g.mode&1)===0&&(Em=Br()+500,ry&&qd()))}function To(p,g){var T=p.callbackNode;Xa(p,g);var O=Bl(p,p===qs?Ss:0);if(O===0)T!==null&&Uu(T),p.callbackNode=null,p.callbackPriority=0;else if(g=O&-O,p.callbackPriority!==g){if(T!=null&&Uu(T),g===1)p.tag===0?lN(Np.bind(null,p)):kC(Np.bind(null,p)),sN(function(){(Cr&6)===0&&qd()}),T=null;else{switch(vc(O)){case 1:T=yc;break;case 4:T=ll;break;case 16:T=va;break;case 536870912:T=Fd;break;default:T=va}T=p_(T,Fy.bind(null,p))}p.callbackPriority=g,p.callbackNode=T}}function Fy(p,g){if(u_=-1,Vy=0,(Cr&6)!==0)throw Error(s(327));var T=p.callbackNode;if(vm()&&p.callbackNode!==T)return null;var O=Bl(p,p===qs?Ss:0);if(O===0)return null;if((O&30)!==0||(O&p.expiredLanes)!==0||g)g=tu(p,O);else{g=O;var M=Cr;Cr|=2;var G=bI();(qs!==p||Ss!==g)&&(Zl=null,Em=Br()+500,nh(p,g));do try{vN();break}catch(Ie){Db(p,Ie)}while(!0);eb(),ky.current=G,Cr=M,Ji!==null?g=0:(qs=null,Ss=0,g=bs)}if(g!==0){if(g===2&&(M=xo(p),M!==0&&(O=M,g=jy(p,M))),g===1)throw T=io,nh(p,0),td(p,O),To(p,Br()),T;if(g===6)td(p,O);else{if(M=p.current.alternate,(O&30)===0&&!Wy(M)&&(g=tu(p,O),g===2&&(G=xo(p),G!==0&&(O=G,g=jy(p,G))),g===1))throw T=io,nh(p,0),td(p,O),To(p,Br()),T;switch(p.finishedWork=M,p.finishedLanes=O,g){case 0:case 1:throw Error(s(345));case 2:Dp(p,Xo,Zl);break;case 3:if(td(p,O),(O&130023424)===O&&(g=xy+500-Br(),10<g)){if(Bl(p,0)!==0)break;if(M=p.suspendedLanes,(M&O)!==O){so(),p.pingedLanes|=p.suspendedLanes&M;break}p.timeoutHandle=zg(Dp.bind(null,p,Xo,Zl),g);break}Dp(p,Xo,Zl);break;case 4:if(td(p,O),(O&4194240)===O)break;for(g=p.eventTimes,M=-1;0<O;){var ae=31-no(O);G=1<<ae,ae=g[ae],ae>M&&(M=ae),O&=~G}if(O=M,O=Br()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*yN(O/1960))-O,10<O){p.timeoutHandle=zg(Dp.bind(null,p,Xo,Zl),O);break}Dp(p,Xo,Zl);break;case 5:Dp(p,Xo,Zl);break;default:throw Error(s(329))}}}return To(p,Br()),p.callbackNode===T?Fy.bind(null,p):null}function jy(p,g){var T=l_;return p.current.memoizedState.isDehydrated&&(nh(p,g).flags|=256),p=tu(p,g),p!==2&&(g=Xo,Xo=T,g!==null&&By(g)),p}function By(p){Xo===null?Xo=p:Xo.push.apply(Xo,p)}function Wy(p){for(var g=p;;){if(g.flags&16384){var T=g.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var O=0;O<T.length;O++){var M=T[O],G=M.getSnapshot;M=M.value;try{if(!ml(G(),M))return!1}catch{return!1}}}if(T=g.child,g.subtreeFlags&16384&&T!==null)T.return=g,g=T;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function td(p,g){for(g&=~Ly,g&=~Dy,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var T=31-no(g),O=1<<T;p[T]=-1,g&=~O}}function Np(p){if((Cr&6)!==0)throw Error(s(327));vm();var g=Bl(p,0);if((g&1)===0)return To(p,Br()),null;var T=tu(p,g);if(p.tag!==0&&T===2){var O=xo(p);O!==0&&(g=O,T=jy(p,O))}if(T===1)throw T=io,nh(p,0),td(p,g),To(p,Br()),T;if(T===6)throw Error(s(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,Dp(p,Xo,Zl),To(p,Br()),null}function d_(p,g){var T=Cr;Cr|=1;try{return p(g)}finally{Cr=T,Cr===0&&(Em=Br()+500,ry&&qd())}}function nd(p){eu!==null&&eu.tag===0&&(Cr&6)===0&&vm();var g=Cr;Cr|=1;var T=Nc.transition,O=sr;try{if(Nc.transition=null,sr=1,p)return p()}finally{sr=O,Nc.transition=T,Cr=g,(Cr&6)===0&&qd()}}function h_(){rc=gl.current,Ri(gl)}function nh(p,g){p.finishedWork=null,p.finishedLanes=0;var T=p.timeoutHandle;if(T!==-1&&(p.timeoutHandle=-1,iN(T)),Ji!==null)for(T=Ji.return;T!==null;){var O=T;switch($g(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&ey();break;case 3:Cp(),Ri(wa),Ri(yo),ob();break;case 5:lm(O);break;case 4:Cp();break;case 13:Ri(ki);break;case 19:Ri(ki);break;case 10:tb(O.type._context);break;case 22:case 23:h_()}T=T.return}if(qs=p,Ji=p=rd(p.current,null),Ss=rc=g,bs=0,io=null,Ly=Dy=Op=0,Xo=l_=null,wp!==null){for(g=0;g<wp.length;g++)if(T=wp[g],O=T.interleaved,O!==null){T.interleaved=null;var M=O.next,G=T.pending;if(G!==null){var ae=G.next;G.next=M,O.next=ae}T.pending=O}wp=null}return p}function Db(p,g){do{var T=Ji;try{if(eb(),hy.current=gy,um){for(var O=Vi.memoizedState;O!==null;){var M=O.queue;M!==null&&(M.pending=null),O=O.next}um=!1}if(Xl=0,vs=ys=Vi=null,e_=!1,t_=0,Ny.current=null,T===null||T.return===null){bs=1,io=g,Ji=null;break}e:{var G=p,ae=T.return,Ie=T,xe=g;if(g=Ss,Ie.flags|=32768,xe!==null&&typeof xe=="object"&&typeof xe.then=="function"){var rt=xe,At=Ie,Ot=At.tag;if((At.mode&1)===0&&(Ot===0||Ot===11||Ot===15)){var Ct=At.alternate;Ct?(At.updateQueue=Ct.updateQueue,At.memoizedState=Ct.memoizedState,At.lanes=Ct.lanes):(At.updateQueue=null,At.memoizedState=null)}var Kt=nI(ae);if(Kt!==null){Kt.flags&=-257,rI(Kt,ae,Ie,G,g),Kt.mode&1&&tI(G,rt,g),g=Kt,xe=rt;var Zt=g.updateQueue;if(Zt===null){var en=new Set;en.add(xe),g.updateQueue=en}else Zt.add(xe);break e}else{if((g&1)===0){tI(G,rt,g),Lb();break e}xe=Error(s(426))}}else if(ci&&Ie.mode&1){var Qi=nI(ae);if(Qi!==null){(Qi.flags&65536)===0&&(Qi.flags|=256),rI(Qi,ae,Ie,G,g),Q0(fm(xe,Ie));break e}}G=xe=fm(xe,Ie),bs!==4&&(bs=2),l_===null?l_=[G]:l_.push(G),G=ae;do{switch(G.tag){case 3:G.flags|=65536,g&=-g,G.lanes|=g;var Ye=vb(G,xe,g);FC(G,Ye);break e;case 1:Ie=xe;var Ve=G.type,Je=G.stateNode;if((G.flags&128)===0&&(typeof Ve.getDerivedStateFromError=="function"||Je!==null&&typeof Je.componentDidCatch=="function"&&(th===null||!th.has(Je)))){G.flags|=65536,g&=-g,G.lanes|=g;var Nt=ed(G,Ie,g);FC(G,Nt);break e}}G=G.return}while(G!==null)}wI(T)}catch(nn){g=nn,Ji===T&&T!==null&&(Ji=T=T.return);continue}break}while(!0)}function bI(){var p=ky.current;return ky.current=gy,p===null?gy:p}function Lb(){(bs===0||bs===3||bs===2)&&(bs=4),qs===null||(Op&268435455)===0&&(Dy&268435455)===0||td(qs,Ss)}function tu(p,g){var T=Cr;Cr|=2;var O=bI();(qs!==p||Ss!==g)&&(Zl=null,nh(p,g));do try{TI();break}catch(M){Db(p,M)}while(!0);if(eb(),Cr=T,ky.current=O,Ji!==null)throw Error(s(261));return qs=null,Ss=0,bs}function TI(){for(;Ji!==null;)zy(Ji)}function vN(){for(;Ji!==null&&!Lo();)zy(Ji)}function zy(p){var g=$y(p.alternate,p,rc);p.memoizedProps=p.pendingProps,g===null?wI(p):Ji=g,Ny.current=null}function wI(p){var g=p;do{var T=g.alternate;if(p=g.return,(g.flags&32768)===0){if(T=Iy(T,g,rc),T!==null){Ji=T;return}}else{if(T=EN(T,g),T!==null){T.flags&=32767,Ji=T;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{bs=6,Ji=null;return}}if(g=g.sibling,g!==null){Ji=g;return}Ji=g=p}while(g!==null);bs===0&&(bs=5)}function Dp(p,g,T){var O=sr,M=Nc.transition;try{Nc.transition=null,sr=1,SN(p,g,T,O)}finally{Nc.transition=M,sr=O}return null}function SN(p,g,T,O){do vm();while(eu!==null);if((Cr&6)!==0)throw Error(s(327));T=p.finishedWork;var M=p.finishedLanes;if(T===null)return null;if(p.finishedWork=null,p.finishedLanes=0,T===p.current)throw Error(s(177));p.callbackNode=null,p.callbackPriority=0;var G=T.lanes|T.childLanes;if(Hr(p,G),p===qs&&(Ji=qs=null,Ss=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||ym||(ym=!0,p_(va,function(){return vm(),null})),G=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||G){G=Nc.transition,Nc.transition=null;var ae=sr;sr=1;var Ie=Cr;Cr|=4,Ny.current=null,Rb(p,T),Pb(T,p),B0(Wg),Se=!!ZE,Wg=ZE=null,p.current=T,_m(T),Vd(),Cr=Ie,sr=ae,Nc.transition=G}else p.current=T;if(ym&&(ym=!1,eu=p,Uy=M),G=p.pendingLanes,G===0&&(th=null),jf(T.stateNode),To(p,Br()),g!==null)for(O=p.onRecoverableError,T=0;T<g.length;T++)M=g[T],O(M.value,{componentStack:M.stack,digest:M.digest});if(My)throw My=!1,p=kb,kb=null,p;return(Uy&1)!==0&&p.tag!==0&&vm(),G=p.pendingLanes,(G&1)!==0?p===Nb?kp++:(kp=0,Nb=p):kp=0,qd(),null}function vm(){if(eu!==null){var p=vc(Uy),g=Nc.transition,T=sr;try{if(Nc.transition=null,sr=16>p?16:p,eu===null)var O=!1;else{if(p=eu,eu=null,Uy=0,(Cr&6)!==0)throw Error(s(331));var M=Cr;for(Cr|=4,Jt=p.current;Jt!==null;){var G=Jt,ae=G.child;if((Jt.flags&16)!==0){var Ie=G.deletions;if(Ie!==null){for(var xe=0;xe<Ie.length;xe++){var rt=Ie[xe];for(Jt=rt;Jt!==null;){var At=Jt;switch(At.tag){case 0:case 11:case 15:o_(8,At,G)}var Ot=At.child;if(Ot!==null)Ot.return=At,Jt=Ot;else for(;Jt!==null;){At=Jt;var Ct=At.sibling,Kt=At.return;if(_I(At),At===rt){Jt=null;break}if(Ct!==null){Ct.return=Kt,Jt=Ct;break}Jt=Kt}}}var Zt=G.alternate;if(Zt!==null){var en=Zt.child;if(en!==null){Zt.child=null;do{var Qi=en.sibling;en.sibling=null,en=Qi}while(en!==null)}}Jt=G}}if((G.subtreeFlags&2064)!==0&&ae!==null)ae.return=G,Jt=ae;else e:for(;Jt!==null;){if(G=Jt,(G.flags&2048)!==0)switch(G.tag){case 0:case 11:case 15:o_(9,G,G.return)}var Ye=G.sibling;if(Ye!==null){Ye.return=G.return,Jt=Ye;break e}Jt=G.return}}var Ve=p.current;for(Jt=Ve;Jt!==null;){ae=Jt;var Je=ae.child;if((ae.subtreeFlags&2064)!==0&&Je!==null)Je.return=ae,Jt=Je;else e:for(ae=Ve;Jt!==null;){if(Ie=Jt,(Ie.flags&2048)!==0)try{switch(Ie.tag){case 0:case 11:case 15:a_(9,Ie)}}catch(nn){Fi(Ie,Ie.return,nn)}if(Ie===ae){Jt=null;break e}var Nt=Ie.sibling;if(Nt!==null){Nt.return=Ie.return,Jt=Nt;break e}Jt=Ie.return}}if(Cr=M,qd(),Eo&&typeof Eo.onPostCommitFiberRoot=="function")try{Eo.onPostCommitFiberRoot(Fl,p)}catch{}O=!0}return O}finally{sr=T,Nc.transition=g}}return!1}function Gy(p,g,T){g=fm(T,g),g=vb(p,g,1),p=Jd(p,g,1),g=so(),p!==null&&(Wl(p,1,g),To(p,g))}function Fi(p,g,T){if(p.tag===3)Gy(p,p,T);else for(;g!==null;){if(g.tag===3){Gy(g,p,T);break}else if(g.tag===1){var O=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(th===null||!th.has(O))){p=fm(T,p),p=ed(g,p,1),g=Jd(g,p,1),p=so(),g!==null&&(Wl(g,1,p),To(g,p));break}}g=g.return}}function RI(p,g,T){var O=p.pingCache;O!==null&&O.delete(g),g=so(),p.pingedLanes|=p.suspendedLanes&T,qs===p&&(Ss&T)===T&&(bs===4||bs===3&&(Ss&130023424)===Ss&&500>Br()-xy?nh(p,0):Ly|=T),To(p,g)}function xb(p,g){g===0&&((p.mode&1)===0?g=1:(g=fr,fr<<=1,(fr&130023424)===0&&(fr=4194304)));var T=so();p=Ju(p,g),p!==null&&(Wl(p,g,T),To(p,T))}function Hy(p){var g=p.memoizedState,T=0;g!==null&&(T=g.retryLane),xb(p,T)}function CI(p,g){var T=0;switch(p.tag){case 13:var O=p.stateNode,M=p.memoizedState;M!==null&&(T=M.retryLane);break;case 19:O=p.stateNode;break;default:throw Error(s(314))}O!==null&&O.delete(g),xb(p,T)}var $y;$y=function(p,g,T){if(p!==null)if(p.memoizedProps!==g.pendingProps||wa.current)Pa=!0;else{if((p.lanes&T)===0&&(g.flags&128)===0)return Pa=!1,hI(p,g,T);Pa=(p.flags&131072)!==0}else Pa=!1,ci&&(g.flags&1048576)!==0&&sy(g,iy,g.index);switch(g.lanes=0,g.tag){case 2:var O=g.type;Ry(p,g),p=g.pendingProps;var M=bp(g,yo.current);Xu(g,T),M=dm(null,g,O,p,M,T);var G=lb();return g.flags|=1,typeof M=="object"&&M!==null&&typeof M.render=="function"&&M.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Ra(O)?(G=!0,ny(g)):G=!1,g.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,Xg(g),M.updater=Ey,g.stateNode=M,M._reactInternals=g,_b(g,O,p,T),g=vy(null,g,O,!0,G,T)):(g.tag=0,ci&&G&&oy(g),qo(null,g,M,T),g=g.child),g;case 16:O=g.elementType;e:{switch(Ry(p,g),p=g.pendingProps,M=O._init,O=M(O._payload),g.type=O,M=g.tag=Lp(O),p=nc(O,p),M){case 0:g=Sb(null,g,O,p,T);break e;case 1:g=cI(null,g,O,p,T);break e;case 11:g=yy(null,g,O,p,T);break e;case 14:g=iI(null,g,O,nc(O.type,p),T);break e}throw Error(s(306,O,""))}return g;case 0:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:nc(O,M),Sb(p,g,O,M,T);case 1:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:nc(O,M),cI(p,g,O,M,T);case 3:e:{if(bb(g),p===null)throw Error(s(387));O=g.pendingProps,G=g.memoizedState,M=G.element,VC(p,g),dy(g,O,null,T);var ae=g.memoizedState;if(O=ae.element,G.isDehydrated)if(G={element:O,isDehydrated:!1,cache:ae.cache,pendingSuspenseBoundaries:ae.pendingSuspenseBoundaries,transitions:ae.transitions},g.updateQueue.baseState=G,g.memoizedState=G,g.flags&256){M=fm(Error(s(423)),g),g=lI(p,g,O,T,M);break e}else if(O!==M){M=fm(Error(s(424)),g),g=lI(p,g,O,T,M);break e}else for(Ia=Hd(g.stateNode.containerInfo.firstChild),Ca=g,ci=!0,$o=null,T=MC(g,null,O,T),g.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(sm(),O===M){g=Jl(p,g,T);break e}qo(p,g,O,T)}g=g.child}return g;case 5:return BC(g),p===null&&J0(g),O=g.type,M=g.pendingProps,G=p!==null?p.memoizedProps:null,ae=M.children,K0(O,M)?ae=null:G!==null&&K0(O,G)&&(g.flags|=32),aI(p,g),qo(p,g,ae,T),g.child;case 6:return p===null&&J0(g),null;case 13:return Sy(p,g,T);case 4:return ib(g,g.stateNode.containerInfo),O=g.pendingProps,p===null?g.child=om(g,null,O,T):qo(p,g,O,T),g.child;case 11:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:nc(O,M),yy(p,g,O,M,T);case 7:return qo(p,g,g.pendingProps,T),g.child;case 8:return qo(p,g,g.pendingProps.children,T),g.child;case 12:return qo(p,g,g.pendingProps.children,T),g.child;case 10:e:{if(O=g.type._context,M=g.pendingProps,G=g.memoizedProps,ae=M.value,Ei(ly,O._currentValue),O._currentValue=ae,G!==null)if(ml(G.value,ae)){if(G.children===M.children&&!wa.current){g=Jl(p,g,T);break e}}else for(G=g.child,G!==null&&(G.return=g);G!==null;){var Ie=G.dependencies;if(Ie!==null){ae=G.child;for(var xe=Ie.firstContext;xe!==null;){if(xe.context===O){if(G.tag===1){xe=ql(-1,T&-T),xe.tag=2;var rt=G.updateQueue;if(rt!==null){rt=rt.shared;var At=rt.pending;At===null?xe.next=xe:(xe.next=At.next,At.next=xe),rt.pending=xe}}G.lanes|=T,xe=G.alternate,xe!==null&&(xe.lanes|=T),nb(G.return,T,g),Ie.lanes|=T;break}xe=xe.next}}else if(G.tag===10)ae=G.type===g.type?null:G.child;else if(G.tag===18){if(ae=G.return,ae===null)throw Error(s(341));ae.lanes|=T,Ie=ae.alternate,Ie!==null&&(Ie.lanes|=T),nb(ae,T,g),ae=G.sibling}else ae=G.child;if(ae!==null)ae.return=G;else for(ae=G;ae!==null;){if(ae===g){ae=null;break}if(G=ae.sibling,G!==null){G.return=ae.return,ae=G;break}ae=ae.return}G=ae}qo(p,g,M.children,T),g=g.child}return g;case 9:return M=g.type,O=g.pendingProps.children,Xu(g,T),M=Pc(M),O=O(M),g.flags|=1,qo(p,g,O,T),g.child;case 14:return O=g.type,M=nc(O,g.pendingProps),M=nc(O.type,M),iI(p,g,O,M,T);case 15:return sI(p,g,g.type,g.pendingProps,T);case 17:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:nc(O,M),Ry(p,g),g.tag=1,Ra(O)?(p=!0,ny(g)):p=!1,Xu(g,T),ZC(g,O,M),_b(g,O,M,T),vy(null,g,O,!0,p,T);case 19:return wy(p,g,T);case 22:return oI(p,g,T)}throw Error(s(156,g.tag))};function p_(p,g){return Ud(p,g)}function Ky(p,g,T,O){this.tag=p,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ic(p,g,T,O){return new Ky(p,g,T,O)}function rh(p){return p=p.prototype,!(!p||!p.isReactComponent)}function Lp(p){if(typeof p=="function")return rh(p)?1:0;if(p!=null){if(p=p.$$typeof,p===fe)return 11;if(p===He)return 14}return 2}function rd(p,g){var T=p.alternate;return T===null?(T=ic(p.tag,g,p.key,p.mode),T.elementType=p.elementType,T.type=p.type,T.stateNode=p.stateNode,T.alternate=p,p.alternate=T):(T.pendingProps=g,T.type=p.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=p.flags&14680064,T.childLanes=p.childLanes,T.lanes=p.lanes,T.child=p.child,T.memoizedProps=p.memoizedProps,T.memoizedState=p.memoizedState,T.updateQueue=p.updateQueue,g=p.dependencies,T.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},T.sibling=p.sibling,T.index=p.index,T.ref=p.ref,T}function qy(p,g,T,O,M,G){var ae=2;if(O=p,typeof p=="function")rh(p)&&(ae=1);else if(typeof p=="string")ae=5;else e:switch(p){case ne:return xp(T.children,M,G,g);case ee:ae=8,M|=8;break;case Q:return p=ic(12,T,g,M|2),p.elementType=Q,p.lanes=G,p;case ue:return p=ic(13,T,g,M),p.elementType=ue,p.lanes=G,p;case Me:return p=ic(19,T,g,M),p.elementType=Me,p.lanes=G,p;case we:return ih(T,M,G,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case se:ae=10;break e;case pe:ae=9;break e;case fe:ae=11;break e;case He:ae=14;break e;case nt:ae=16,O=null;break e}throw Error(s(130,p==null?p:typeof p,""))}return g=ic(ae,T,g,M),g.elementType=p,g.type=O,g.lanes=G,g}function xp(p,g,T,O){return p=ic(7,p,O,g),p.lanes=T,p}function ih(p,g,T,O){return p=ic(22,p,O,g),p.elementType=we,p.lanes=T,p.stateNode={isHidden:!1},p}function Mb(p,g,T){return p=ic(6,p,null,g),p.lanes=T,p}function Ub(p,g,T){return g=ic(4,p.children!==null?p.children:[],p.key,g),g.lanes=T,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function bN(p,g,T,O,M){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=dl(0),this.expirationTimes=dl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=dl(0),this.identifierPrefix=O,this.onRecoverableError=M,this.mutableSourceEagerHydrationData=null}function Vb(p,g,T,O,M,G,ae,Ie,xe){return p=new bN(p,g,T,Ie,xe),g===1?(g=1,G===!0&&(g|=8)):g=0,G=ic(3,null,null,g),p.current=G,G.stateNode=p,G.memoizedState={element:O,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},Xg(G),p}function TN(p,g,T){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_e,key:O==null?null:""+O,children:p,containerInfo:g,implementation:T}}function II(p){if(!p)return Kd;p=p._reactInternals;e:{if($s(p)!==p||p.tag!==1)throw Error(s(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Ra(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(s(171))}if(p.tag===1){var T=p.type;if(Ra(T))return ty(p,T,g)}return g}function Yy(p,g,T,O,M,G,ae,Ie,xe){return p=Vb(T,O,!0,p,M,G,ae,Ie,xe),p.context=II(null),T=p.current,O=so(),M=Dc(T),G=ql(O,M),G.callback=g??null,Jd(T,G,M),p.current.lanes=M,Wl(p,M,O),To(p,O),p}function f_(p,g,T,O){var M=g.current,G=so(),ae=Dc(M);return T=II(T),g.context===null?g.context=T:g.pendingContext=T,g=ql(G,ae),g.payload={element:p},O=O===void 0?null:O,O!==null&&(g.callback=O),p=Jd(M,g,ae),p!==null&&(Lc(p,M,ae,G),Jg(p,M,ae)),ae}function Xy(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function Fb(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var T=p.retryLane;p.retryLane=T!==0&&T<g?T:g}}function jb(p,g){Fb(p,g),(p=p.alternate)&&Fb(p,g)}function m_(){return null}var _l=typeof reportError=="function"?reportError:function(p){console.error(p)};function Jy(p){this._internalRoot=p}Qy.prototype.render=Jy.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(s(409));f_(p,g,null,null)},Qy.prototype.unmount=Jy.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;nd(function(){f_(null,p,null,null)}),g[Rc]=null}};function Qy(p){this._internalRoot=p}Qy.prototype.unstable_scheduleHydration=function(p){if(p){var g=lp();p={blockedOn:null,target:p,priority:g};for(var T=0;T<jo.length&&g!==0&&g<jo[T].priority;T++);jo.splice(T,0,p),T===0&&dp(p)}};function Bb(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Sm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function Wb(){}function wN(p,g,T,O,M){if(M){if(typeof O=="function"){var G=O;O=function(){var rt=Xy(ae);G.call(rt)}}var ae=Yy(g,O,p,0,null,!1,!1,"",Wb);return p._reactRootContainer=ae,p[Rc]=ae.current,_p(p.nodeType===8?p.parentNode:p),nd(),ae}for(;M=p.lastChild;)p.removeChild(M);if(typeof O=="function"){var Ie=O;O=function(){var rt=Xy(xe);Ie.call(rt)}}var xe=Vb(p,0,!1,null,null,!1,!1,"",Wb);return p._reactRootContainer=xe,p[Rc]=xe.current,_p(p.nodeType===8?p.parentNode:p),nd(function(){f_(g,xe,T,O)}),xe}function Mp(p,g,T,O,M){var G=T._reactRootContainer;if(G){var ae=G;if(typeof M=="function"){var Ie=M;M=function(){var xe=Xy(ae);Ie.call(xe)}}f_(g,ae,p,M)}else ae=wN(T,g,p,M,O);return Xy(ae)}Bf=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var T=jl(g.pendingLanes);T!==0&&(Ja(g,T|1),To(g,Br()),(Cr&6)===0&&(Em=Br()+500,qd()))}break;case 13:nd(function(){var O=Ju(p,1);if(O!==null){var M=so();Lc(O,p,1,M)}}),jb(p,1)}},zl=function(p){if(p.tag===13){var g=Ju(p,134217728);if(g!==null){var T=so();Lc(g,p,134217728,T)}jb(p,134217728)}},Wd=function(p){if(p.tag===13){var g=Dc(p),T=Ju(p,g);if(T!==null){var O=so();Lc(T,p,g,O)}jb(p,g)}},lp=function(){return sr},Wf=function(p,g){var T=sr;try{return sr=p,g()}finally{sr=T}},_c=function(p,g,T){switch(g){case"input":if(Bt(p,T),g=T.name,T.type==="radio"&&g!=null){for(T=p;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<T.length;g++){var O=T[g];if(O!==p&&O.form===p.form){var M=nm(O);if(!M)throw Error(s(90));xt(O),Bt(O,M)}}}break;case"textarea":zt(p,T);break;case"select":g=T.value,g!=null&&ot(p,!!T.multiple,g,!1)}},to=d_,ms=nd;var sh={usingClientEntryPoint:!1,Events:[tm,vp,nm,ma,ga,d_]},id={findFiberByHostInstance:yp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},RN={bundleType:id.bundleType,version:id.version,rendererPackageName:id.rendererPackageName,rendererConfig:id.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ce.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Md(p),p===null?null:p.stateNode},findFiberByHostInstance:id.findFiberByHostInstance||m_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zy.isDisabled&&Zy.supportsFiber)try{Fl=Zy.inject(RN),Eo=Zy}catch{}}return qc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sh,qc.createPortal=function(p,g){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bb(g))throw Error(s(200));return TN(p,g,null,T)},qc.createRoot=function(p,g){if(!Bb(p))throw Error(s(299));var T=!1,O="",M=_l;return g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(O=g.identifierPrefix),g.onRecoverableError!==void 0&&(M=g.onRecoverableError)),g=Vb(p,1,!1,null,null,T,!1,O,M),p[Rc]=g.current,_p(p.nodeType===8?p.parentNode:p),new Jy(g)},qc.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(s(188)):(p=Object.keys(p).join(","),Error(s(268,p)));return p=Md(g),p=p===null?null:p.stateNode,p},qc.flushSync=function(p){return nd(p)},qc.hydrate=function(p,g,T){if(!Sm(g))throw Error(s(200));return Mp(null,p,g,!0,T)},qc.hydrateRoot=function(p,g,T){if(!Bb(p))throw Error(s(405));var O=T!=null&&T.hydratedSources||null,M=!1,G="",ae=_l;if(T!=null&&(T.unstable_strictMode===!0&&(M=!0),T.identifierPrefix!==void 0&&(G=T.identifierPrefix),T.onRecoverableError!==void 0&&(ae=T.onRecoverableError)),g=Yy(g,null,p,1,T??null,M,!1,G,ae),p[Rc]=g.current,_p(p),O)for(p=0;p<O.length;p++)T=O[p],M=T._getVersion,M=M(T._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[T,M]:g.mutableSourceEagerHydrationData.push(T,M);return new Qy(g)},qc.render=function(p,g,T){if(!Sm(g))throw Error(s(200));return Mp(null,p,g,!1,T)},qc.unmountComponentAtNode=function(p){if(!Sm(p))throw Error(s(40));return p._reactRootContainer?(nd(function(){Mp(null,null,p,!1,function(){p._reactRootContainer=null,p[Rc]=null})}),!0):!1},qc.unstable_batchedUpdates=d_,qc.unstable_renderSubtreeIntoContainer=function(p,g,T,O){if(!Sm(T))throw Error(s(200));if(p==null||p._reactInternals===void 0)throw Error(s(38));return Mp(p,g,T,!1,O)},qc.version="18.3.1-next-f1338f8080-20240426",qc}var m$;function zJ(){if(m$)return E2.exports;m$=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),E2.exports=I_e(),E2.exports}var g$;function A_e(){if(g$)return $P;g$=1;var n=zJ();return $P.createRoot=n.createRoot,$P.hydrateRoot=n.hydrateRoot,$P}var P_e=A_e();const O_e=DE(P_e);function k_e(n,t,s,a){return n.addEventListener(t,s,a),()=>{n.removeEventListener(t,s,a)}}function zk(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function N_e(){return!!(globalThis!=null&&globalThis.document)}function GJ(n){return n.parentElement&&GJ(n.parentElement)?!0:n.hidden}function D_e(n){const t=n.getAttribute("contenteditable");return t!=="false"&&t!=null}function L_e(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function x_e(n){var t;return((t=HJ(n))==null?void 0:t.defaultView)??window}function HJ(n){return zk(n)?n.ownerDocument:document}function M_e(n){return n.view??window}function U_e(n){return HJ(n).activeElement}function V_e(n){const t=M_e(n);return typeof t.PointerEvent<"u"&&n instanceof t.PointerEvent?n.pointerType==="mouse":n instanceof t.MouseEvent}function $J(n){return!!n.touches}function F_e(n){return $J(n)&&n.touches.length>1}function j_e(n,t="page"){const s=n.touches[0]||n.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function B_e(n,t="page"){return{x:n[`${t}X`],y:n[`${t}Y`]}}function KJ(n,t="page"){return $J(n)?j_e(n,t):B_e(n,t)}function W_e(n){return t=>{const s=V_e(t);(!s||s&&t.button===0)&&n(t)}}function z_e(n,t=!1){function s(l){n(l,{point:KJ(l)})}return t?W_e(s):s}function SO(n,t,s,a){return k_e(n,t,z_e(s,t==="pointerdown"),a)}function G_e(n,...t){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const s={...n};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in s&&delete s[l],s[l]=a[l]);return s}const Xn=n=>n?"":void 0,DS=n=>n?!0:void 0;function H_e(n){return Array.isArray(n)}function Cu(n){const t=typeof n;return n!=null&&(t==="object"||t==="function")&&!H_e(n)}function $_e(n){const t=n==null?0:n.length;return t?n[t-1]:void 0}function K_e(n){const t=parseFloat(n.toString()),s=n.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}}function zM(n){if(n==null)return n;const{unitless:t}=K_e(n);return t||typeof n=="number"?`${n}px`:n}const qJ=(n,t)=>parseInt(n[1],10)>parseInt(t[1],10)?1:-1,CV=n=>Object.fromEntries(Object.entries(n).sort(qJ));function _$(n){const t=CV(n);return Object.assign(Object.values(t),t)}function q_e(n){const t=Object.keys(CV(n));return new Set(t)}function E$(n){if(!n)return n;n=zM(n)??n;const t=-.02;return typeof n=="number"?`${n+t}`:n.replace(/(\d+\.?\d*)/u,s=>`${parseFloat(s)+t}`)}function vw(n,t){const s=["@media screen"];return n&&s.push("and",`(min-width: ${zM(n)})`),t&&s.push("and",`(max-width: ${zM(t)})`),s.join(" ")}function Y_e(n){if(!n)return null;n.base=n.base??"0px";const t=_$(n),s=Object.entries(n).sort(qJ).map(([d,f],E,v)=>{let[,b]=v[E+1]??[];return b=parseFloat(b)>0?E$(b):void 0,{_minW:E$(f),breakpoint:d,minW:f,maxW:b,maxWQuery:vw(null,b),minWQuery:vw(f),minMaxQuery:vw(f,b)}}),a=q_e(n),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const f=Object.keys(d);return f.length>0&&f.every(E=>a.has(E))},asObject:CV(n),asArray:_$(n),details:s,get(d){return s.find(f=>f.breakpoint===d)},media:[null,...t.map(d=>vw(d)).slice(1)],toArrayValue(d){if(!Cu(d))throw new Error("toArrayValue: value must be an object");const f=l.map(E=>d[E]??null);for(;$_e(f)===null;)f.pop();return f},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((f,E,v)=>{const b=l[v];return b!=null&&E!=null&&(f[b]=E),f},{})}}}function YJ(...n){return function(...s){n.forEach(a=>a==null?void 0:a(...s))}}function er(...n){return function(s){n.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}function IV(n){return D.Children.toArray(n).filter(t=>D.isValidElement(t))}function Gk(n){const t=Object.assign({},n);for(let s in t)t[s]===void 0&&delete t[s];return t}function X_e(n,t){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Li(n={}){const{name:t,strict:s=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:f}=n,E=D.createContext(f);E.displayName=t;function v(){var w;const b=D.useContext(E);if(!b&&s){const A=new Error(d??X_e(a,l));throw A.name="ContextError",(w=Error.captureStackTrace)==null||w.call(Error,A,v),A}return b}return[E.Provider,v,E]}const hn=(...n)=>n.filter(Boolean).join(" "),XJ=n=>n.hasAttribute("tabindex"),J_e=n=>XJ(n)&&n.tabIndex===-1;function tk(n){if(!zk(n)||GJ(n)||L_e(n))return!1;const{localName:t}=n;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return t in a?a[t]():D_e(n)?!0:XJ(n)}function Q_e(n){return n?zk(n)&&tk(n)&&!J_e(n):!1}const Z_e=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],eEe=Z_e.join(),tEe=n=>n.offsetWidth>0&&n.offsetHeight>0;function JJ(n){const t=Array.from(n.querySelectorAll(eEe));return t.unshift(n),t.filter(s=>tk(s)&&tEe(s))}function nEe(n,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?s:n}const rEe=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=n(a,l,d,f);return E.set(l,v),v}},QJ=rEe(nEe),iEe=n=>n.default||n;function AV(n){const{wasSelected:t,enabled:s,isSelected:a,mode:l="unmount"}=n;return!!(!s||a||l==="keepMounted"&&t)}function sEe(n){const t=parseFloat(n);return typeof t!="number"||Number.isNaN(t)?0:t}function oEe(n,t){let s=sEe(n);const a=10**(t??10);return s=Math.round(s*a)/a,t?s.toFixed(t):s.toString()}function aEe(n){if(!Number.isFinite(n))return 0;let t=1,s=0;for(;Math.round(n*t)/t!==n;)t*=10,s+=1;return s}function y$(n,t,s){return(n-t)*100/(s-t)}function cEe(n,t,s){return(s-t)*n+t}function v$(n,t,s){const a=Math.round((n-t)/s)*s+t,l=aEe(s);return oEe(a,l)}function S2(n,t,s){return n==null?n:(s<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,t),s))}function b0(n,t=[]){const s=Object.assign({},n);for(const a of t)a in s&&delete s[a];return s}function ZJ(n,t){const s={};for(const a of t)a in n&&(s[a]=n[a]);return s}function PV(n,t){return Array.isArray(n)?n.map(s=>s===null?null:t(s)):Cu(n)?Object.keys(n).reduce((s,a)=>(s[a]=t(n[a]),s),{}):n!=null?t(n):null}const lEe=n=>typeof n=="function";function el(n,...t){return lEe(n)?n(...t):n}function uEe(n){const t=n.ownerDocument.defaultView||window,{overflow:s,overflowX:a,overflowY:l}=t.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(s+l+a)}function dEe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function eQ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:zk(n)&&uEe(n)?n:eQ(dEe(n))}function hEe(n,t){const s={},a={};for(const[l,d]of Object.entries(n))t.includes(l)?s[l]=d:a[l]=d;return[s,a]}function pEe(n,...t){const s=Object.getOwnPropertyDescriptors(n),a=Object.keys(s),l=f=>{const E={};for(let v=0;v<f.length;v++){const b=f[v];s[b]&&(Object.defineProperty(E,b,s[b]),delete s[b])}return E},d=f=>l(Array.isArray(f)?f:a.filter(f));return t.map(d).concat(l(a))}function S$(n,t,s={}){const{stop:a,getKey:l}=s;function d(f,E=[]){if(Cu(f)||Array.isArray(f)){const v={};for(const[b,w]of Object.entries(f)){const A=(l==null?void 0:l(b))??b,N=[...E,A];if(a!=null&&a(f,N))return t(f,E);v[A]=d(w,N)}return v}return t(f,E)}return d(n)}var Sw={exports:{}};Sw.exports;var b$;function fEe(){return b$||(b$=1,function(n,t){var s=200,a="__lodash_hash_undefined__",l=800,d=16,f=9007199254740991,E="[object Arguments]",v="[object Array]",b="[object AsyncFunction]",w="[object Boolean]",A="[object Date]",N="[object Error]",V="[object Function]",j="[object GeneratorFunction]",B="[object Map]",H="[object Number]",J="[object Null]",$="[object Object]",te="[object Proxy]",ce="[object RegExp]",oe="[object Set]",_e="[object String]",ne="[object Undefined]",ee="[object WeakMap]",Q="[object ArrayBuffer]",se="[object DataView]",pe="[object Float32Array]",fe="[object Float64Array]",ue="[object Int8Array]",Me="[object Int16Array]",He="[object Int32Array]",nt="[object Uint8Array]",we="[object Uint8ClampedArray]",Ce="[object Uint16Array]",ve="[object Uint32Array]",Ne=/[\\^$.*+?()[\]{}|]/g,Te=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,Ae={};Ae[pe]=Ae[fe]=Ae[ue]=Ae[Me]=Ae[He]=Ae[nt]=Ae[we]=Ae[Ce]=Ae[ve]=!0,Ae[E]=Ae[v]=Ae[Q]=Ae[w]=Ae[se]=Ae[A]=Ae[N]=Ae[V]=Ae[B]=Ae[H]=Ae[$]=Ae[ce]=Ae[oe]=Ae[_e]=Ae[ee]=!1;var Ue=typeof oE=="object"&&oE&&oE.Object===Object&&oE,Ge=typeof self=="object"&&self&&self.Object===Object&&self,Qe=Ue||Ge||Function("return this")(),tt=t&&!t.nodeType&&t,dt=tt&&!0&&n&&!n.nodeType&&n,Ze=dt&&dt.exports===tt,wt=Ze&&Ue.process,un=function(){try{var Se=dt&&dt.require&&dt.require("util").types;return Se||wt&&wt.binding&&wt.binding("util")}catch{}}(),xt=un&&un.isTypedArray;function tn(Se,De,et){switch(et.length){case 0:return Se.call(De);case 1:return Se.call(De,et[0]);case 2:return Se.call(De,et[0],et[1]);case 3:return Se.call(De,et[0],et[1],et[2])}return Se.apply(De,et)}function kn(Se,De){for(var et=-1,Yt=Array(Se);++et<Se;)Yt[et]=De(et);return Yt}function $t(Se){return function(De){return Se(De)}}function zn(Se,De){return Se==null?void 0:Se[De]}function Bt(Se,De){return function(et){return Se(De(et))}}var Re=Array.prototype,Fe=Function.prototype,We=Object.prototype,ot=Qe["__core-js_shared__"],Et=Fe.toString,yt=We.hasOwnProperty,zt=function(){var Se=/[^.]+$/.exec(ot&&ot.keys&&ot.keys.IE_PROTO||"");return Se?"Symbol(src)_1."+Se:""}(),pn=We.toString,xn=Et.call(Object),cn=RegExp("^"+Et.call(yt).replace(Ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),dr=Ze?Qe.Buffer:void 0,pa=Qe.Symbol,Vt=Qe.Uint8Array;dr&&dr.allocUnsafe;var on=Bt(Object.getPrototypeOf,Object),Mi=Object.create,fs=We.propertyIsEnumerable,Ls=Re.splice,Zr=pa?pa.toStringTag:void 0,Pt=function(){try{var Se=Xa(Object,"defineProperty");return Se({},"",{}),Se}catch{}}(),wn=dr?dr.isBuffer:void 0,ir=Math.max,Oi=Date.now,_c=Xa(Qe,"Map"),is=Xa(Object,"create"),fa=function(){function Se(){}return function(De){if(!Sc(De))return{};if(Mi)return Mi(De);Se.prototype=De;var et=new Se;return Se.prototype=void 0,et}}();function _o(Se){var De=-1,et=Se==null?0:Se.length;for(this.clear();++De<et;){var Yt=Se[De];this.set(Yt[0],Yt[1])}}function ma(){this.__data__=is?is(null):{},this.size=0}function ga(Se){var De=this.has(Se)&&delete this.__data__[Se];return this.size-=De?1:0,De}function to(Se){var De=this.__data__;if(is){var et=De[Se];return et===a?void 0:et}return yt.call(De,Se)?De[Se]:void 0}function ms(Se){var De=this.__data__;return is?De[Se]!==void 0:yt.call(De,Se)}function ss(Se,De){var et=this.__data__;return this.size+=this.has(Se)?0:1,et[Se]=is&&De===void 0?a:De,this}_o.prototype.clear=ma,_o.prototype.delete=ga,_o.prototype.get=to,_o.prototype.has=ms,_o.prototype.set=ss;function Do(Se){var De=-1,et=Se==null?0:Se.length;for(this.clear();++De<et;){var Yt=Se[De];this.set(Yt[0],Yt[1])}}function Ui(){this.__data__=[],this.size=0}function gs(Se){var De=this.__data__,et=Vd(De,Se);if(et<0)return!1;var Yt=De.length-1;return et==Yt?De.pop():Ls.call(De,et,1),--this.size,!0}function qa(Se){var De=this.__data__,et=Vd(De,Se);return et<0?void 0:De[et][1]}function Lu(Se){return Vd(this.__data__,Se)>-1}function Ec(Se,De){var et=this.__data__,Yt=Vd(et,Se);return Yt<0?(++this.size,et.push([Se,De])):et[Yt][1]=De,this}Do.prototype.clear=Ui,Do.prototype.delete=gs,Do.prototype.get=qa,Do.prototype.has=Lu,Do.prototype.set=Ec;function _a(Se){var De=-1,et=Se==null?0:Se.length;for(this.clear();++De<et;){var Yt=Se[De];this.set(Yt[0],Yt[1])}}function Ea(){this.size=0,this.__data__={hash:new _o,map:new(_c||Do),string:new _o}}function Ld(Se){var De=Vu(this,Se).delete(Se);return this.size-=De?1:0,De}function kg(Se){return Vu(this,Se).get(Se)}function xu(Se){return Vu(this,Se).has(Se)}function op(Se,De){var et=Vu(this,Se),Yt=et.size;return et.set(Se,De),this.size+=et.size==Yt?0:1,this}_a.prototype.clear=Ea,_a.prototype.delete=Ld,_a.prototype.get=kg,_a.prototype.has=xu,_a.prototype.set=op;function $s(Se){var De=this.__data__=new Do(Se);this.size=De.size}function Mu(){this.__data__=new Do,this.size=0}function ya(Se){var De=this.__data__,et=De.delete(Se);return this.size=De.size,et}function xd(Se){return this.__data__.get(Se)}function Md(Se){return this.__data__.has(Se)}function Ya(Se,De){var et=this.__data__;if(et instanceof Do){var Yt=et.__data__;if(!_c||Yt.length<s-1)return Yt.push([Se,De]),this.size=++et.size,this;et=this.__data__=new _a(Yt)}return et.set(Se,De),this.size=et.size,this}$s.prototype.clear=Mu,$s.prototype.delete=ya,$s.prototype.get=xd,$s.prototype.has=Md,$s.prototype.set=Ya;function Ud(Se,De){var et=Uo(Se),Yt=!et&&os(Se),qn=!et&&!Yt&&Fo(Se),yr=!et&&!Yt&&!qn&&dp(Se),Wr=et||Yt||qn||yr,ln=Wr?kn(Se.length,String):[],xr=ln.length;for(var _i in Se)Wr&&(_i=="length"||qn&&(_i=="offset"||_i=="parent")||yr&&(_i=="buffer"||_i=="byteLength"||_i=="byteOffset")||dl(_i,xr))||ln.push(_i);return ln}function Uu(Se,De,et){(et!==void 0&&!Mo(Se[De],et)||et===void 0&&!(De in Se))&&Br(Se,De,et)}function Lo(Se,De,et){var Yt=Se[De];(!(yt.call(Se,De)&&Mo(Yt,et))||et===void 0&&!(De in Se))&&Br(Se,De,et)}function Vd(Se,De){for(var et=Se.length;et--;)if(Mo(Se[et][0],De))return et;return-1}function Br(Se,De,et){De=="__proto__"&&Pt?Pt(Se,De,{configurable:!0,enumerable:!0,value:et,writable:!0}):Se[De]=et}var gi=Bl();function yc(Se){return Se==null?Se===void 0?ne:J:Zr&&Zr in Object(Se)?xo(Se):Bf(Se)}function ll(Se){return _s(Se)&&yc(Se)==E}function va(Se){if(!Sc(Se)||Ja(Se))return!1;var De=jo(Se)?cn:Te;return De.test(up(Se))}function ap(Se){return _s(Se)&&zf(Se.length)&&!!Ae[yc(Se)]}function Fd(Se){if(!Sc(Se))return vc(Se);var De=sr(Se),et=[];for(var Yt in Se)Yt=="constructor"&&(De||!yt.call(Se,Yt))||et.push(Yt);return et}function Fl(Se,De,et,Yt,qn){Se!==De&&gi(De,function(yr,Wr){if(qn||(qn=new $s),Sc(yr))Eo(Se,De,Wr,et,Fl,Yt,qn);else{var ln=Yt?Yt(Wd(Se,Wr),yr,Wr+"",Se,De,qn):void 0;ln===void 0&&(ln=yr),Uu(Se,Wr,ln)}},Hl)}function Eo(Se,De,et,Yt,qn,yr,Wr){var ln=Wd(Se,et),xr=Wd(De,et),_i=Wr.get(xr);if(_i){Uu(Se,et,_i);return}var xs=yr?yr(ln,xr,et+"",Se,De,Wr):void 0,Bo=xs===void 0;if(Bo){var Wo=Uo(xr),Bu=!Wo&&Fo(xr),Xi=!Wo&&!Bu&&dp(xr);xs=xr,Wo||Bu||Xi?Uo(ln)?xs=ln:Gl(ln)?xs=Bd(ln):Bu?(Bo=!1,xs=cp(xr)):Xi?(Bo=!1,xs=jd(xr)):xs=[]:ju(xr)||os(xr)?(xs=ln,os(ln)?xs=hl(ln):(!Sc(ln)||jo(ln))&&(xs=Fu(xr))):Bo=!1}Bo&&(Wr.set(xr,xs),qn(xs,xr,Yt,yr,Wr),Wr.delete(xr)),Uu(Se,et,xs)}function jf(Se,De){return lp(zl(Se,De,ba),Se+"")}var no=Pt?function(Se,De){return Pt(Se,"toString",{configurable:!0,enumerable:!1,value:Sa(De),writable:!0})}:ba;function cp(Se,De){return Se.slice()}function ul(Se){var De=new Se.constructor(Se.byteLength);return new Vt(De).set(new Vt(Se)),De}function jd(Se,De){var et=ul(Se.buffer);return new Se.constructor(et,Se.byteOffset,Se.length)}function Bd(Se,De){var et=-1,Yt=Se.length;for(De||(De=Array(Yt));++et<Yt;)De[et]=Se[et];return De}function fr(Se,De,et,Yt){var qn=!et;et||(et={});for(var yr=-1,Wr=De.length;++yr<Wr;){var ln=De[yr],xr=void 0;xr===void 0&&(xr=Se[ln]),qn?Br(et,ln,xr):Lo(et,ln,xr)}return et}function jl(Se){return jf(function(De,et){var Yt=-1,qn=et.length,yr=qn>1?et[qn-1]:void 0,Wr=qn>2?et[2]:void 0;for(yr=Se.length>3&&typeof yr=="function"?(qn--,yr):void 0,Wr&&Wl(et[0],et[1],Wr)&&(yr=qn<3?void 0:yr,qn=1),De=Object(De);++Yt<qn;){var ln=et[Yt];ln&&Se(De,ln,Yt,yr)}return De})}function Bl(Se){return function(De,et,Yt){for(var qn=-1,yr=Object(De),Wr=Yt(De),ln=Wr.length;ln--;){var xr=Wr[++qn];if(et(yr[xr],xr,yr)===!1)break}return De}}function Vu(Se,De){var et=Se.__data__;return Hr(De)?et[typeof De=="string"?"string":"hash"]:et.map}function Xa(Se,De){var et=zn(Se,De);return va(et)?et:void 0}function xo(Se){var De=yt.call(Se,Zr),et=Se[Zr];try{Se[Zr]=void 0;var Yt=!0}catch{}var qn=pn.call(Se);return Yt&&(De?Se[Zr]=et:delete Se[Zr]),qn}function Fu(Se){return typeof Se.constructor=="function"&&!sr(Se)?fa(on(Se)):{}}function dl(Se,De){var et=typeof Se;return De=De??f,!!De&&(et=="number"||et!="symbol"&&be.test(Se))&&Se>-1&&Se%1==0&&Se<De}function Wl(Se,De,et){if(!Sc(et))return!1;var Yt=typeof De;return(Yt=="number"?Vo(et)&&dl(De,et.length):Yt=="string"&&De in et)?Mo(et[De],Se):!1}function Hr(Se){var De=typeof Se;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Se!=="__proto__":Se===null}function Ja(Se){return!!zt&&zt in Se}function sr(Se){var De=Se&&Se.constructor,et=typeof De=="function"&&De.prototype||We;return Se===et}function vc(Se){var De=[];if(Se!=null)for(var et in Object(Se))De.push(et);return De}function Bf(Se){return pn.call(Se)}function zl(Se,De,et){return De=ir(De===void 0?Se.length-1:De,0),function(){for(var Yt=arguments,qn=-1,yr=ir(Yt.length-De,0),Wr=Array(yr);++qn<yr;)Wr[qn]=Yt[De+qn];qn=-1;for(var ln=Array(De+1);++qn<De;)ln[qn]=Yt[qn];return ln[De]=et(Wr),tn(Se,this,ln)}}function Wd(Se,De){if(!(De==="constructor"&&typeof Se[De]=="function")&&De!="__proto__")return Se[De]}var lp=Wf(no);function Wf(Se){var De=0,et=0;return function(){var Yt=Oi(),qn=d-(Yt-et);if(et=Yt,qn>0){if(++De>=l)return arguments[0]}else De=0;return Se.apply(void 0,arguments)}}function up(Se){if(Se!=null){try{return Et.call(Se)}catch{}try{return Se+""}catch{}}return""}function Mo(Se,De){return Se===De||Se!==Se&&De!==De}var os=ll(function(){return arguments}())?ll:function(Se){return _s(Se)&&yt.call(Se,"callee")&&!fs.call(Se,"callee")},Uo=Array.isArray;function Vo(Se){return Se!=null&&zf(Se.length)&&!jo(Se)}function Gl(Se){return _s(Se)&&Vo(Se)}var Fo=wn||pl;function jo(Se){if(!Sc(Se))return!1;var De=yc(Se);return De==V||De==j||De==b||De==te}function zf(Se){return typeof Se=="number"&&Se>-1&&Se%1==0&&Se<=f}function Sc(Se){var De=typeof Se;return Se!=null&&(De=="object"||De=="function")}function _s(Se){return Se!=null&&typeof Se=="object"}function ju(Se){if(!_s(Se)||yc(Se)!=$)return!1;var De=on(Se);if(De===null)return!0;var et=yt.call(De,"constructor")&&De.constructor;return typeof et=="function"&&et instanceof et&&Et.call(et)==xn}var dp=xt?$t(xt):ap;function hl(Se){return fr(Se,Hl(Se))}function Hl(Se){return Vo(Se)?Ud(Se):Fd(Se)}var Gf=jl(function(Se,De,et,Yt){Fl(Se,De,et,Yt)});function Sa(Se){return function(){return Se}}function ba(Se){return Se}function pl(){return!1}n.exports=Gf}(Sw,Sw.exports)),Sw.exports}var mEe=fEe();const Vh=DE(mEe);function tl(n,t=[]){const s=D.useRef(n);return D.useEffect(()=>{s.current=n}),D.useCallback((...a)=>{var l;return(l=s.current)==null?void 0:l.call(s,...a)},t)}function LS(n,t,s,a){const l=tl(s);return D.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!s||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,n,a,l,s]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(t,l,a)}}function tQ(n){const{isOpen:t,ref:s}=n,[a,l]=D.useState(t),[d,f]=D.useState(!1);return D.useEffect(()=>{d||(l(t),f(!0))},[t,d,a]),LS(()=>s.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var w;const v=x_e(s.current),b=new v.CustomEvent("animationend",{bubbles:!0});(w=s.current)==null||w.dispatchEvent(b)}}}var b2,T$;function gEe(){return T$||(T$=1,b2=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var t=document.activeElement,s=[],a=0;a<n.rangeCount;a++)s.push(n.getRangeAt(a));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||s.forEach(function(l){n.addRange(l)}),t&&t.focus()}}),b2}var T2,w$;function _Ee(){if(w$)return T2;w$=1;var n=gEe(),t={"text/plain":"Text","text/html":"Url",default:"Text"},s="Copy to clipboard: #{key}, Enter";function a(d){var f=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return d.replace(/#{\s*key\s*}/g,f)}function l(d,f){var E,v,b,w,A,N,V=!1;f||(f={}),E=f.debug||!1;try{b=n(),w=document.createRange(),A=document.getSelection(),N=document.createElement("span"),N.textContent=d,N.ariaHidden="true",N.style.all="unset",N.style.position="fixed",N.style.top=0,N.style.clip="rect(0, 0, 0, 0)",N.style.whiteSpace="pre",N.style.webkitUserSelect="text",N.style.MozUserSelect="text",N.style.msUserSelect="text",N.style.userSelect="text",N.addEventListener("copy",function(B){if(B.stopPropagation(),f.format)if(B.preventDefault(),typeof B.clipboardData>"u"){E&&console.warn("unable to use e.clipboardData"),E&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var H=t[f.format]||t.default;window.clipboardData.setData(H,d)}else B.clipboardData.clearData(),B.clipboardData.setData(f.format,d);f.onCopy&&(B.preventDefault(),f.onCopy(B.clipboardData))}),document.body.appendChild(N),w.selectNodeContents(N),A.addRange(w);var j=document.execCommand("copy");if(!j)throw new Error("copy command was unsuccessful");V=!0}catch(B){E&&console.error("unable to copy using execCommand: ",B),E&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(f.format||"text",d),f.onCopy&&f.onCopy(window.clipboardData),V=!0}catch(H){E&&console.error("unable to copy using clipboardData: ",H),E&&console.error("falling back to prompt"),v=a("message"in f?f.message:s),window.prompt(v,d)}}finally{A&&(typeof A.removeRange=="function"?A.removeRange(w):A.removeAllRanges()),N&&document.body.removeChild(N),b()}return V}return T2=l,T2}var EEe=_Ee();const R$=DE(EEe);function C$(n,t={}){const[s,a]=D.useState(!1),[l,d]=D.useState(n);D.useEffect(()=>d(n),[n]);const{timeout:f=1500,...E}=typeof t=="number"?{timeout:t}:t,v=D.useCallback(b=>{const w=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(w).then(()=>a(!0)).catch(()=>a(R$(w,E))):a(R$(w,E))},[l,E]);return D.useEffect(()=>{let b=null;return s&&(b=window.setTimeout(()=>{a(!1)},f)),()=>{b&&window.clearTimeout(b)}},[f,s]),{value:l,setValue:d,onCopy:v,hasCopied:s}}function nQ(n){const{value:t,defaultValue:s,onChange:a,shouldUpdate:l=(N,V)=>N!==V}=n,d=tl(a),f=tl(l),[E,v]=D.useState(s),b=t!==void 0,w=b?t:E,A=tl(N=>{const j=typeof N=="function"?N(w):N;f(w,j)&&(b||v(j),d(j))},[b,d,w,f]);return[w,A]}function If(n={}){const{onClose:t,onOpen:s,isOpen:a,id:l}=n,d=tl(s),f=tl(t),[E,v]=D.useState(n.defaultIsOpen||!1),b=a!==void 0?a:E,w=a!==void 0,A=D.useId(),N=l??`disclosure-${A}`,V=D.useCallback(()=>{w||v(!1),f==null||f()},[w,f]),j=D.useCallback(()=>{w||v(!0),d==null||d()},[w,d]),B=D.useCallback(()=>{b?V():j()},[b,j,V]);function H($={}){return{...$,"aria-expanded":b,"aria-controls":N,onClick(te){var ce;(ce=$.onClick)==null||ce.call($,te),B()}}}function J($={}){return{...$,hidden:!b,id:N}}return{isOpen:b,onOpen:j,onClose:V,onToggle:B,isControlled:w,getButtonProps:H,getDisclosureProps:J}}const yf=globalThis!=null&&globalThis.document?D.useLayoutEffect:D.useEffect,fg=(n,t)=>{const s=D.useRef(!1),a=D.useRef(!1);D.useEffect(()=>{if(s.current&&a.current)return n();a.current=!0},t),D.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[])};function yEe(n){const t=n.current;if(!t)return!1;const s=U_e(t);return!s||t.contains(s)?!1:!!Q_e(s)}function rQ(n,t){const{shouldFocus:s,visible:a,focusRef:l}=t,d=s&&!a;fg(()=>{if(!d||yEe(n))return;const f=(l==null?void 0:l.current)||n.current;let E;if(f)return E=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(E)}},[d,n,l])}const vEe={preventScroll:!0,shouldFocus:!1};function SEe(n,t=vEe){const{focusRef:s,preventScroll:a,shouldFocus:l,visible:d}=t,f=bEe(n)?n.current:n,E=l&&d,v=D.useRef(E),b=D.useRef(d);yf(()=>{!b.current&&d&&(v.current=E),b.current=d},[d,E]);const w=D.useCallback(()=>{if(!(!d||!f||!v.current)&&(v.current=!1,!f.contains(document.activeElement)))if(s!=null&&s.current)requestAnimationFrame(()=>{var A;(A=s.current)==null||A.focus({preventScroll:a})});else{const A=JJ(f);A.length>0&&requestAnimationFrame(()=>{A[0].focus({preventScroll:a})})}},[d,a,f,s]);fg(()=>{w()},[w]),LS(f,"transitionend",w)}function bEe(n){return"current"in n}function TEe(n){return"current"in n}const iQ=()=>typeof window<"u";function wEe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const REe=n=>iQ()&&n.test(navigator.vendor),CEe=n=>iQ()&&n.test(wEe()),IEe=()=>CEe(/mac|iphone|ipad|ipod/i),AEe=()=>IEe()&&REe(/apple/i);function PEe(n){const{ref:t,elements:s,enabled:a}=n,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};LS(l,"pointerdown",d=>{var b,w;if(!AEe()||!a)return;const f=((w=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:w[0])??d.target,v=(s??[t]).some(A=>{const N=TEe(A)?A.current:A;return(N==null?void 0:N.contains(f))||N===f});l().activeElement!==f&&v&&(d.preventDefault(),f.focus())})}function OEe(n,t){const s=D.useId();return D.useMemo(()=>n||[t,s].filter(Boolean).join("-"),[n,t,s])}function kEe(n,...t){const s=OEe(n);return D.useMemo(()=>t.map(a=>`${a}-${s}`),[s,t])}function sQ(n){const t=D.useRef(null);return t.current=n,t}function NEe(n,t){if(n!=null){if(typeof n=="function"){n(t);return}try{n.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${n}'`)}}}function ns(...n){return t=>{n.forEach(s=>{NEe(s,t)})}}function DEe(...n){return D.useMemo(()=>ns(...n),n)}function oQ(n){const{ref:t,handler:s,enabled:a=!0}=n,l=tl(s),f=D.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;D.useEffect(()=>{if(!a)return;const E=A=>{w2(A,t)&&(f.isPointerDown=!0)},v=A=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&s&&w2(A,t)&&(f.isPointerDown=!1,l(A))},b=A=>{f.ignoreEmulatedMouseEvents=!0,s&&f.isPointerDown&&w2(A,t)&&(f.isPointerDown=!1,l(A))},w=aQ(t.current);return w.addEventListener("mousedown",E,!0),w.addEventListener("mouseup",v,!0),w.addEventListener("touchstart",E,!0),w.addEventListener("touchend",b,!0),()=>{w.removeEventListener("mousedown",E,!0),w.removeEventListener("mouseup",v,!0),w.removeEventListener("touchstart",E,!0),w.removeEventListener("touchend",b,!0)}},[s,t,l,f,a])}function w2(n,t){var a,l;const s=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return s&&!aQ(s).contains(s)?!1:!((l=t.current)!=null&&l.contains(s))}function aQ(n){return(n==null?void 0:n.ownerDocument)??document}function LEe(n,t){const s=tl(n);D.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{s()},t),()=>{a&&window.clearTimeout(a)}},[t,s])}const cQ=1/60*1e3,xEe=typeof performance<"u"?()=>performance.now():()=>Date.now(),lQ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(xEe()),cQ);function MEe(n){let t=[],s=[],a=0,l=!1,d=!1;const f=new WeakSet,E={schedule:(v,b=!1,w=!1)=>{const A=w&&l,N=A?t:s;return b&&f.add(v),N.indexOf(v)===-1&&(N.push(v),A&&l&&(a=t.length)),v},cancel:v=>{const b=s.indexOf(v);b!==-1&&s.splice(b,1),f.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[t,s]=[s,t],s.length=0,a=t.length,a)for(let b=0;b<a;b++){const w=t[b];w(v),f.has(w)&&(E.schedule(w),n())}l=!1,d&&(d=!1,E.process(v))}};return E}const UEe=40;let GM=!0,sR=!1,HM=!1;const xS={delta:0,timestamp:0},NR=["read","update","preRender","render","postRender"],Hk=NR.reduce((n,t)=>(n[t]=MEe(()=>sR=!0),n),{}),VEe=NR.reduce((n,t)=>{const s=Hk[t];return n[t]=(a,l=!1,d=!1)=>(sR||BEe(),s.schedule(a,l,d)),n},{}),FEe=NR.reduce((n,t)=>(n[t]=Hk[t].cancel,n),{});NR.reduce((n,t)=>(n[t]=()=>Hk[t].process(xS),n),{});const jEe=n=>Hk[n].process(xS),uQ=n=>{sR=!1,xS.delta=GM?cQ:Math.max(Math.min(n-xS.timestamp,UEe),1),xS.timestamp=n,HM=!0,NR.forEach(jEe),HM=!1,sR&&(GM=!1,lQ(uQ))},BEe=()=>{sR=!0,GM=!0,HM||lQ(uQ)},I$=()=>xS;var WEe=Object.defineProperty,zEe=(n,t,s)=>t in n?WEe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,Sd=(n,t,s)=>(zEe(n,typeof t!="symbol"?t+"":t,s),s);class GEe{constructor(t,s,a){if(Sd(this,"history",[]),Sd(this,"startEvent",null),Sd(this,"lastEvent",null),Sd(this,"lastEventInfo",null),Sd(this,"handlers",{}),Sd(this,"removeListeners",()=>{}),Sd(this,"threshold",3),Sd(this,"win"),Sd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const E=R2(this.lastEventInfo,this.history),v=this.startEvent!==null,b=qEe(E.offset,{x:0,y:0})>=this.threshold;if(!v&&!b)return;const{timestamp:w}=I$();this.history.push({...E.point,timestamp:w});const{onStart:A,onMove:N}=this.handlers;v||(A==null||A(this.lastEvent,E),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,E)}),Sd(this,"onPointerMove",(E,v)=>{this.lastEvent=E,this.lastEventInfo=v,VEe.update(this.updatePoint,!0)}),Sd(this,"onPointerUp",(E,v)=>{const b=R2(v,this.history),{onEnd:w,onSessionEnd:A}=this.handlers;A==null||A(E,b),this.end(),!(!w||!this.startEvent)&&(w==null||w(E,b))}),this.win=t.view??window,F_e(t))return;this.handlers=s,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:KJ(t)},{timestamp:d}=I$();this.history=[{...l.point,timestamp:d}];const{onSessionStart:f}=s;f==null||f(t,R2(l,this.history)),this.removeListeners=KEe(SO(this.win,"pointermove",this.onPointerMove),SO(this.win,"pointerup",this.onPointerUp),SO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),FEe.update(this.updatePoint)}}function A$(n,t){return{x:n.x-t.x,y:n.y-t.y}}function R2(n,t){return{point:n.point,delta:A$(n.point,t[t.length-1]),offset:A$(n.point,t[0]),velocity:$Ee(t,.1)}}const HEe=n=>n*1e3;function $Ee(n,t){if(n.length<2)return{x:0,y:0};let s=n.length-1,a=null;const l=n[n.length-1];for(;s>=0&&(a=n[s],!(l.timestamp-a.timestamp>HEe(t)));)s--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function KEe(...n){return t=>n.reduce((s,a)=>a(s),t)}function C2(n,t){return Math.abs(n-t)}function P$(n){return"x"in n&&"y"in n}function qEe(n,t){if(typeof n=="number"&&typeof t=="number")return C2(n,t);if(P$(n)&&P$(t)){const s=C2(n.x,t.x),a=C2(n.y,t.y);return Math.sqrt(s**2+a**2)}return 0}function YEe(n,t){const{onPan:s,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:f,threshold:E}=t,v=!!(s||a||l||d||f),b=D.useRef(null),w=sQ({onSessionStart:d,onSessionEnd:f,onStart:a,onMove:s,onEnd(A,N){b.current=null,l==null||l(A,N)}});D.useEffect(()=>{var A;(A=b.current)==null||A.updateHandlers(w.current)}),D.useEffect(()=>{const A=n.current;if(!A||!v)return;function N(V){b.current=new GEe(V,w.current,E)}return SO(A,"pointerdown",N)},[n,v,w,E]),D.useEffect(()=>()=>{var A;(A=b.current)==null||A.end(),b.current=null},[])}const ho={open:(n,t)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${t}`,closed:(n,t)=>`${n}[data-closed], ${n}[data-state=closed] ${t}`,hover:(n,t)=>`${n}:hover ${t}, ${n}[data-hover] ${t}`,focus:(n,t)=>`${n}:focus ${t}, ${n}[data-focus] ${t}`,focusVisible:(n,t)=>`${n}:focus-visible ${t}`,focusWithin:(n,t)=>`${n}:focus-within ${t}`,active:(n,t)=>`${n}:active ${t}, ${n}[data-active] ${t}`,disabled:(n,t)=>`${n}:disabled ${t}, ${n}[data-disabled] ${t}`,invalid:(n,t)=>`${n}:invalid ${t}, ${n}[data-invalid] ${t}`,checked:(n,t)=>`${n}:checked ${t}, ${n}[data-checked] ${t}`,placeholderShown:(n,t)=>`${n}:placeholder-shown ${t}`},Ah=n=>dQ(t=>n(t,"&"),"[role=group]","[data-group]",".group"),nf=n=>dQ(t=>n(t,"~ &"),"[data-peer]",".peer"),dQ=(n,...t)=>t.map(n).join(", "),MS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Ah(ho.open),_groupClosed:Ah(ho.closed),_groupHover:Ah(ho.hover),_peerHover:nf(ho.hover),_groupFocus:Ah(ho.focus),_peerFocus:nf(ho.focus),_groupFocusVisible:Ah(ho.focusVisible),_peerFocusVisible:nf(ho.focusVisible),_groupActive:Ah(ho.active),_peerActive:nf(ho.active),_groupDisabled:Ah(ho.disabled),_peerDisabled:nf(ho.disabled),_groupInvalid:Ah(ho.invalid),_peerInvalid:nf(ho.invalid),_groupChecked:Ah(ho.checked),_peerChecked:nf(ho.checked),_groupFocusWithin:Ah(ho.focusWithin),_peerFocusWithin:nf(ho.focusWithin),_peerPlaceholderShown:nf(ho.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},hQ=Object.keys(MS),XEe=n=>/!(important)?$/.test(n),O$=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,JEe=(n,t)=>s=>{const a=String(t),l=XEe(a),d=O$(a),f=n?`${n}.${d}`:d;let E=Cu(s.__cssMap)&&f in s.__cssMap?s.__cssMap[f].varRef:t;return E=O$(E),l?`${E} !important`:E};function OV(n){const{scale:t,transform:s,compose:a}=n;return(d,f)=>{const E=JEe(t,d)(f);let v=(s==null?void 0:s(E,f))??E;return a&&(v=a(v,f)),v}}const KP=(...n)=>t=>n.reduce((s,a)=>a(s),t);function vu(n,t){return s=>{const a={property:s,scale:n};return a.transform=OV({scale:n,transform:t}),a}}const QEe=({rtl:n,ltr:t})=>s=>s.direction==="rtl"?n:t;function ZEe(n){const{property:t,scale:s,transform:a}=n;return{scale:s,property:QEe(t),transform:s?OV({scale:s,compose:a}):a}}const pQ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function eye(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...pQ].join(" ")}function tye(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...pQ].join(" ")}const nye={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},rye={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function iye(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const sye={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},$M={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},oye=new Set(Object.values($M)),KM=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),aye=n=>n.trim();function cye(n,t){if(n==null||KM.has(n))return n;if(!(qM(n)||KM.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!d||!f)return n;const E=d.includes("-gradient")?d:`${d}-gradient`,[v,...b]=f.split(",").map(aye).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const w=v in $M?$M[v]:v;b.unshift(w);const A=b.map(N=>{if(oye.has(N))return N;const V=N.indexOf(" "),[j,B]=V!==-1?[N.substr(0,V),N.substr(V+1)]:[N],H=qM(B)?B:B&&B.split(" "),J=`colors.${j}`,$=J in t.__cssMap?t.__cssMap[J].varRef:j;return H?[$,...Array.isArray(H)?H:[H]].join(" "):$});return`${E}(${A.join(", ")})`}const qM=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),lye=(n,t)=>cye(n,t??{});function uye(n){return/^var\(--.+\)$/.test(n)}const dye=n=>{const t=parseFloat(n.toString()),s=n.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}},Ph=n=>t=>`${n}(${t})`,Or={filter(n){return n!=="auto"?n:nye},backdropFilter(n){return n!=="auto"?n:rye},ring(n){return iye(Or.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?eye():n==="auto-gpu"?tye():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:t}=dye(n);return t||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,t){const s={left:"right",right:"left"};return t.direction==="rtl"?s[n]:n},degree(n){if(uye(n)||n==null)return n;const t=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||t?`${n}deg`:n},gradient:lye,blur:Ph("blur"),opacity:Ph("opacity"),brightness:Ph("brightness"),contrast:Ph("contrast"),dropShadow:Ph("drop-shadow"),grayscale:Ph("grayscale"),hueRotate:n=>Ph("hue-rotate")(Or.degree(n)),invert:Ph("invert"),saturate:Ph("saturate"),sepia:Ph("sepia"),bgImage(n){return n==null||qM(n)||KM.has(n)?n:`url(${n})`},outline(n){const t=String(n)==="0"||String(n)==="none";return n!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:t,divide:s}=sye[n]??{},a={flexDirection:n};return t&&(a[t]=1),s&&(a[s]=1),a}},Be={borderWidths:vu("borderWidths"),borderStyles:vu("borderStyles"),colors:vu("colors"),borders:vu("borders"),gradients:vu("gradients",Or.gradient),radii:vu("radii",Or.px),space:vu("space",KP(Or.vh,Or.px)),spaceT:vu("space",KP(Or.vh,Or.px)),degreeT(n){return{property:n,transform:Or.degree}},prop(n,t,s){return{property:n,scale:t,...t&&{transform:OV({scale:t,transform:s})}}},propT(n,t){return{property:n,transform:t}},sizes:vu("sizes",KP(Or.vh,Or.px)),sizesT:vu("sizes",KP(Or.vh,Or.fraction)),shadows:vu("shadows"),logical:ZEe,blur:vu("blur",Or.blur)},bO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Or.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:Or.bgClip}};Object.assign(bO,{bgImage:bO.backgroundImage,bgImg:bO.backgroundImage});const qr={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(qr,{rounded:qr.borderRadius,roundedTop:qr.borderTopRadius,roundedTopLeft:qr.borderTopLeftRadius,roundedTopRight:qr.borderTopRightRadius,roundedTopStart:qr.borderStartStartRadius,roundedTopEnd:qr.borderStartEndRadius,roundedBottom:qr.borderBottomRadius,roundedBottomLeft:qr.borderBottomLeftRadius,roundedBottomRight:qr.borderBottomRightRadius,roundedBottomStart:qr.borderEndStartRadius,roundedBottomEnd:qr.borderEndEndRadius,roundedLeft:qr.borderLeftRadius,roundedRight:qr.borderRightRadius,roundedStart:qr.borderInlineStartRadius,roundedEnd:qr.borderInlineEndRadius,borderStart:qr.borderInlineStart,borderEnd:qr.borderInlineEnd,borderTopStartRadius:qr.borderStartStartRadius,borderTopEndRadius:qr.borderStartEndRadius,borderBottomStartRadius:qr.borderEndStartRadius,borderBottomEndRadius:qr.borderEndEndRadius,borderStartRadius:qr.borderInlineStartRadius,borderEndRadius:qr.borderInlineEndRadius,borderStartWidth:qr.borderInlineStartWidth,borderEndWidth:qr.borderInlineEndWidth,borderStartColor:qr.borderInlineStartColor,borderEndColor:qr.borderInlineEndColor,borderStartStyle:qr.borderInlineStartStyle,borderEndStyle:qr.borderInlineEndStyle});const hye={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},nk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Or.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(nk,{flexDir:nk.flexDirection});const Tu={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",Or.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Tu,{w:Tu.width,h:Tu.height,minW:Tu.minWidth,maxW:Tu.maxWidth,minH:Tu.minHeight,maxH:Tu.maxHeight,overscroll:Tu.overscrollBehavior,overscrollX:Tu.overscrollBehaviorX,overscrollY:Tu.overscrollBehaviorY});const pye={filter:{transform:Or.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",Or.brightness),contrast:Be.propT("--chakra-contrast",Or.contrast),hueRotate:Be.propT("--chakra-hue-rotate",Or.hueRotate),invert:Be.propT("--chakra-invert",Or.invert),saturate:Be.propT("--chakra-saturate",Or.saturate),dropShadow:Be.propT("--chakra-drop-shadow",Or.dropShadow),backdropFilter:{transform:Or.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",Or.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",Or.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",Or.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",Or.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",Or.saturate)},fye={ring:{transform:Or.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},mye={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Or.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},fQ={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function gye(n,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?s:n}const _ye=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=n(a,l,d,f);return E.set(l,v),v}},Eye=_ye(gye),yye={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},vye={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},I2=(n,t,s)=>{const a={},l=Eye(n,t,{});for(const d in l)d in s&&s[d]!=null||(a[d]=l[d]);return a},Sye={srOnly:{transform(n){return n===!0?yye:n==="focusable"?vye:{}}},layerStyle:{processResult:!0,transform:(n,t,s)=>I2(t,`layerStyles.${n}`,s)},textStyle:{processResult:!0,transform:(n,t,s)=>I2(t,`textStyles.${n}`,s)},apply:{processResult:!0,transform:(n,t,s)=>I2(t,n,s)}},Vw={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Vw,{insetStart:Vw.insetInlineStart,insetEnd:Vw.insetInlineEnd});const YM={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign(YM,{shadow:YM.boxShadow});const Hi={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(Hi,{m:Hi.margin,mt:Hi.marginTop,mr:Hi.marginRight,me:Hi.marginInlineEnd,marginEnd:Hi.marginInlineEnd,mb:Hi.marginBottom,ml:Hi.marginLeft,ms:Hi.marginInlineStart,marginStart:Hi.marginInlineStart,mx:Hi.marginX,my:Hi.marginY,p:Hi.padding,pt:Hi.paddingTop,py:Hi.paddingY,px:Hi.paddingX,pb:Hi.paddingBottom,pl:Hi.paddingLeft,ps:Hi.paddingInlineStart,paddingStart:Hi.paddingInlineStart,pr:Hi.paddingRight,pe:Hi.paddingInlineEnd,paddingEnd:Hi.paddingInlineEnd});const bye={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},Tye={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",Or.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},wye={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},Rye={clipPath:!0,transform:Be.propT("transform",Or.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},Cye={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},Iye={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},kV=Vh({},bO,qr,hye,nk,Tu,pye,fye,mye,fQ,Sye,Vw,YM,Hi,bye,Tye,wye,Rye,Cye,Iye),Aye=Object.assign({},Hi,Tu,nk,fQ,Vw),Pye=Object.keys(Aye),Oye=[...Object.keys(kV),...hQ],kye={...kV,...MS},Nye=n=>n in kye,Dye=n=>t=>{if(!t.__breakpoints)return n;const{isResponsive:s,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const f in n){let E=el(n[f],t);if(E==null)continue;if(E=Cu(E)&&s(E)?a(E):E,!Array.isArray(E)){d[f]=E;continue}const v=E.slice(0,l.length).length;for(let b=0;b<v;b+=1){const w=l==null?void 0:l[b];if(!w){d[f]=E[b];continue}d[w]=d[w]||{},E[b]!=null&&(d[w][f]=E[b])}}return d};function Lye(n){const t=[];let s="",a=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(a=!0,s+=d):d===")"?(a=!1,s+=d):d===","&&!a?(t.push(s),s=""):s+=d}return s=s.trim(),s&&t.push(s),t}function xye(n){return/^var\(--.+\)$/.test(n)}const Mye=(n,t)=>n.startsWith("--")&&typeof t=="string"&&!xye(t),Uye=(n,t)=>{if(t==null)return t;const s=f=>{var E,v;return(v=(E=n.__cssMap)==null?void 0:E[f])==null?void 0:v.varRef},a=f=>s(f)??f,[l,d]=Lye(t);return t=s(l)??a(d)??a(t),t};function Vye(n){const{configs:t={},pseudos:s={},theme:a}=n,l=(d,f=!1)=>{var w;const E=el(d,a),v=Dye(E)(a);let b={};for(let A in v){const N=v[A];let V=el(N,a);A in s&&(A=s[A]),Mye(A,V)&&(V=Uye(a,V));let j=t[A];if(j===!0&&(j={property:A}),Cu(V)){b[A]=b[A]??{},b[A]=Vh({},b[A],l(V,!0));continue}let B=((w=j==null?void 0:j.transform)==null?void 0:w.call(j,V,a,E))??V;B=j!=null&&j.processResult?l(B,!0):B;const H=el(j==null?void 0:j.property,a);if(!f&&(j!=null&&j.static)){const J=el(j.static,a);b=Vh({},b,J)}if(H&&Array.isArray(H)){for(const J of H)b[J]=B;continue}if(H){H==="&"&&Cu(B)?b=Vh({},b,B):b[H]=B;continue}if(Cu(B)){b=Vh({},b,B);continue}b[A]=B}return b};return l}const mQ=n=>t=>Vye({theme:t,pseudos:MS,configs:kV})(n);function S8e(n){return n}function b8e(n){return n}function xi(n){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:n,...t}}}}function Fye(n,t,s){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${t}.${s}`])==null?void 0:l.varRef)??s}function jye(n,t){if(Array.isArray(n))return n;if(Cu(n))return t(n);if(n!=null)return[n]}function Bye(n,t){for(let s=t+1;s<n.length;s++)if(n[s]!=null)return s;return-1}function Wye(n){const t=n.__breakpoints;return function(a,l,d,f){var N,V;if(!t)return;const E={},v=jye(d,t.toArrayValue);if(!v)return E;const b=v.length,w=b===1,A=!!a.parts;for(let j=0;j<b;j++){const B=t.details[j],H=t.details[Bye(v,j)],J=vw(B.minW,H==null?void 0:H._minW),$=el((N=a[l])==null?void 0:N[v[j]],f);if($){if(A){(V=a.parts)==null||V.forEach(te=>{Vh(E,{[te]:w?$[te]:{[J]:$[te]}})});continue}if(!A){w?Vh(E,$):E[J]=$;continue}E[J]=$}}return E}}function zye(n){return t=>{const{variant:s,size:a,theme:l}=t,d=Wye(l);return Vh({},el(n.baseStyle??{},t),d(n,"sizes",a,t),d(n,"variants",s,t))}}function Yi(n){return b0(n,["styleConfig","size","variant","colorScheme"])}function gQ(n){return Cu(n)&&n.reference?n.reference:String(n)}const $k=(n,...t)=>t.map(gQ).join(` ${n} `).replace(/calc/g,""),k$=(...n)=>`calc(${$k("+",...n)})`,N$=(...n)=>`calc(${$k("-",...n)})`,XM=(...n)=>`calc(${$k("*",...n)})`,D$=(...n)=>`calc(${$k("/",...n)})`,L$=n=>{const t=gQ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:XM(t,-1)},cf=Object.assign(n=>({add:(...t)=>cf(k$(n,...t)),subtract:(...t)=>cf(N$(n,...t)),multiply:(...t)=>cf(XM(n,...t)),divide:(...t)=>cf(D$(n,...t)),negate:()=>cf(L$(n)),toString:()=>n.toString()}),{add:k$,subtract:N$,multiply:XM,divide:D$,negate:L$});function Gye(n,t="-"){return n.replace(/\s+/g,t)}function Hye(n){const t=Gye(n.toString());return Kye($ye(t))}function $ye(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function Kye(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function qye(n,t=""){return[t,n].filter(Boolean).join("-")}function Yye(n,t){return`var(${n}${t?`, ${t}`:""})`}function Xye(n,t=""){return Hye(`--${qye(n,t)}`)}function On(n,t,s){const a=Xye(n,s);return{variable:a,reference:Yye(a,t)}}function Jye(n,t){const s={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;s[l]=On(`${n}-${l}`,d);continue}s[a]=On(`${n}-${a}`)}return s}const Qye=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Zye(n){return ZJ(n,Qye)}function eve(n){return n.semanticTokens}function tve(n){const{__cssMap:t,__cssVars:s,__breakpoints:a,...l}=n;return l}function nve(n){const t=Zye(n),s=eve(n),a=d=>hQ.includes(d)||d==="default",l={};return S$(t,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!1,value:d})}),S$(s,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function x$(n,t){return On(String(n).replace(/\./g,"-"),void 0,t)}function rve(n){var f;const t=nve(n),s=(f=n.config)==null?void 0:f.cssVarPrefix;let a={};const l={};function d(E,v){const w=[String(E).split(".")[0],v].join(".");if(!t[w])return v;const{reference:N}=x$(w,s);return N}for(const[E,v]of Object.entries(t)){const{isSemantic:b,value:w}=v,{variable:A,reference:N}=x$(E,s);if(!b){if(E.startsWith("space")){const j=E.split("."),[B,...H]=j,J=`${B}.-${H.join(".")}`,$=cf.negate(w),te=cf.negate(N);l[J]={value:$,var:A,varRef:te}}a[A]=w,l[E]={value:w,var:A,varRef:N};continue}const V=Cu(w)?w:{default:w};a=Vh(a,Object.entries(V).reduce((j,[B,H])=>{if(!H)return j;const J=d(E,`${H}`);if(B==="default")return j[A]=J,j;const $=(MS==null?void 0:MS[B])??B;return j[$]={[A]:J},j},{})),l[E]={value:N,var:A,varRef:N}}return{cssVars:a,cssMap:l}}function ive(n){const t=tve(n),{cssMap:s,cssVars:a}=rve(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:s,__breakpoints:Y_e(t.breakpoints)}),t}function Qr(n,t={}){let s=!1;function a(){if(!s){s=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...w){a();for(const A of w)t[A]=v(A);return Qr(n,t)}function d(...w){for(const A of w)A in t||(t[A]=v(A));return Qr(n,t)}function f(){return Object.fromEntries(Object.entries(t).map(([A,N])=>[A,N.selector]))}function E(){return Object.fromEntries(Object.entries(t).map(([A,N])=>[A,N.className]))}function v(w){const V=`chakra-${(["container","root"].includes(w??"")?[n]:[n,w]).filter(Boolean).join("__")}`;return{className:V,selector:`.${V}`,toString:()=>w}}return{parts:l,toPart:v,extend:d,selectors:f,classnames:E,get keys(){return Object.keys(t)},__type:{}}}const sve=Qr("accordion").parts("root","container","button","panel","icon"),ove=Qr("alert").parts("title","description","container","icon","spinner"),ave=Qr("avatar").parts("label","badge","container","excessLabel","group"),cve=Qr("breadcrumb").parts("link","item","container","separator");Qr("button").parts();const lve=Qr("checkbox").parts("control","icon","container","label");Qr("progress").parts("track","filledTrack","label");const uve=Qr("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),dve=Qr("editable").parts("preview","input","textarea"),hve=Qr("form").parts("container","requiredIndicator","helperText"),pve=Qr("formError").parts("text","icon"),fve=Qr("input").parts("addon","field","element","group"),mve=Qr("list").parts("container","item","icon"),gve=Qr("menu").parts("button","list","item","groupTitle","icon","command","divider"),_ve=Qr("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),Eve=Qr("numberinput").parts("root","field","stepperGroup","stepper");Qr("pininput").parts("field");const yve=Qr("popover").parts("content","header","body","footer","popper","arrow","closeButton"),vve=Qr("progress").parts("label","filledTrack","track"),Sve=Qr("radio").parts("container","control","label"),bve=Qr("select").parts("field","icon"),Tve=Qr("slider").parts("container","track","thumb","filledTrack","mark"),wve=Qr("stat").parts("container","label","helpText","number","icon"),Rve=Qr("switch").parts("container","track","thumb","label"),Cve=Qr("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),Ive=Qr("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),Ave=Qr("tag").parts("container","label","closeButton"),Pve=Qr("card").parts("container","header","body","footer");Qr("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:Ove,defineMultiStyleConfig:kve}=xi(sve.keys),Nve={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},Dve={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},Lve={pt:"2",px:"4",pb:"5"},xve={fontSize:"1.25em"},Mve=Ove({container:Nve,button:Dve,panel:Lve,icon:xve}),Uve=kve({baseStyle:Mve});function aE(n,t,s){return Math.min(Math.max(n,s),t)}class Vve extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var bw=Vve;function NV(n){if(typeof n!="string")throw new bw(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=n.trim();t=$ve.test(n)?Bve(n):n;const s=Wve.exec(t);if(s){const f=Array.from(s).slice(1);return[...f.slice(0,3).map(E=>parseInt(oR(E,2),16)),parseInt(oR(f[3]||"f",2),16)/255]}const a=zve.exec(t);if(a){const f=Array.from(a).slice(1);return[...f.slice(0,3).map(E=>parseInt(E,16)),parseInt(f[3]||"ff",16)/255]}const l=Gve.exec(t);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(E=>parseInt(E,10)),parseFloat(f[3]||"1")]}const d=Hve.exec(t);if(d){const[f,E,v,b]=Array.from(d).slice(1).map(parseFloat);if(aE(0,100,E)!==E)throw new bw(n);if(aE(0,100,v)!==v)throw new bw(n);return[...Kve(f,E,v),Number.isNaN(b)?1:b]}throw new bw(n)}function Fve(n){let t=5381,s=n.length;for(;s;)t=t*33^n.charCodeAt(--s);return(t>>>0)%2341}const M$=n=>parseInt(n.replace(/_/g,""),36),jve="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,t)=>{const s=M$(t.substring(0,3)),a=M$(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return n[s]=`${l}${a}`,n},{});function Bve(n){const t=n.toLowerCase().trim(),s=jve[Fve(t)];if(!s)throw new bw(n);return`#${s}`}const oR=(n,t)=>Array.from(Array(t)).map(()=>n).join(""),Wve=new RegExp(`^#${oR("([a-f0-9])",3)}([a-f0-9])?$`,"i"),zve=new RegExp(`^#${oR("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Gve=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${oR(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),Hve=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,$ve=/^[a-z]+$/i,U$=n=>Math.round(n*255),Kve=(n,t,s)=>{let a=s/100;if(t===0)return[a,a,a].map(U$);const l=(n%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),f=d*(1-Math.abs(l%2-1));let E=0,v=0,b=0;l>=0&&l<1?(E=d,v=f):l>=1&&l<2?(E=f,v=d):l>=2&&l<3?(v=d,b=f):l>=3&&l<4?(v=f,b=d):l>=4&&l<5?(E=f,b=d):l>=5&&l<6&&(E=d,b=f);const w=a-d/2,A=E+w,N=v+w,V=b+w;return[A,N,V].map(U$)};function qve(n,t,s,a){return`rgba(${aE(0,255,n).toFixed()}, ${aE(0,255,t).toFixed()}, ${aE(0,255,s).toFixed()}, ${parseFloat(aE(0,1,a).toFixed(3))})`}function Yve(n,t){const[s,a,l,d]=NV(n);return qve(s,a,l,d-t)}function Xve(n){const[t,s,a,l]=NV(n);let d=f=>{const E=aE(0,255,f).toString(16);return E.length===1?`0${E}`:E};return`#${d(t)}${d(s)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const Jve=n=>Object.keys(n).length===0;function Qve(n,t,s,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)n=n?n[t[a]]:l;return n===l?s:n}const pc=(n,t,s)=>{const a=Qve(n,`colors.${t}`,t);try{return Xve(a),a}catch{return s??"#000000"}},Zve=n=>{const[t,s,a]=NV(n);return(t*299+s*587+a*114)/1e3},eSe=n=>t=>{const s=pc(t,n);return Zve(s)<128?"dark":"light"},tSe=n=>t=>eSe(n)(t)==="dark",QS=(n,t)=>s=>{const a=pc(s,n);return Yve(a,1-t)};function V$(n="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const nSe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function rSe(n){const t=nSe();return!n||Jve(n)?t:n.string&&n.colors?sSe(n.string,n.colors):n.string&&!n.colors?iSe(n.string):n.colors&&!n.string?oSe(n.colors):t}function iSe(n){let t=0;if(n.length===0)return t.toString();for(let a=0;a<n.length;a+=1)t=n.charCodeAt(a)+((t<<5)-t),t=t&t;let s="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;s+=`00${l.toString(16)}`.substr(-2)}return s}function sSe(n,t){let s=0;if(n.length===0)return t[0];for(let a=0;a<n.length;a+=1)s=n.charCodeAt(a)+((s<<5)-s),s=s&s;return s=(s%t.length+t.length)%t.length,t[s]}function oSe(n){return n[Math.floor(Math.random()*n.length)]}function Pn(n,t){return s=>s.colorMode==="dark"?t:n}function DV(n){const{orientation:t,vertical:s,horizontal:a}=n;return t?t==="vertical"?s:a:{}}function _Q(n){return Cu(n)&&n.reference?n.reference:String(n)}const Kk=(n,...t)=>t.map(_Q).join(` ${n} `).replace(/calc/g,""),F$=(...n)=>`calc(${Kk("+",...n)})`,j$=(...n)=>`calc(${Kk("-",...n)})`,JM=(...n)=>`calc(${Kk("*",...n)})`,B$=(...n)=>`calc(${Kk("/",...n)})`,W$=n=>{const t=_Q(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:JM(t,-1)},lf=Object.assign(n=>({add:(...t)=>lf(F$(n,...t)),subtract:(...t)=>lf(j$(n,...t)),multiply:(...t)=>lf(JM(n,...t)),divide:(...t)=>lf(B$(n,...t)),negate:()=>lf(W$(n)),toString:()=>n.toString()}),{add:F$,subtract:j$,multiply:JM,divide:B$,negate:W$});function aSe(n){return!Number.isInteger(parseFloat(n.toString()))}function cSe(n,t="-"){return n.replace(/\s+/g,t)}function EQ(n){const t=cSe(n.toString());return t.includes("\\.")?n:aSe(n)?t.replace(".","\\."):n}function lSe(n,t=""){return[t,EQ(n)].filter(Boolean).join("-")}function uSe(n,t){return`var(${EQ(n)}${t?`, ${t}`:""})`}function dSe(n,t=""){return`--${lSe(n,t)}`}function go(n,t){const s=dSe(n,t==null?void 0:t.prefix);return{variable:s,reference:uSe(s,hSe(t==null?void 0:t.fallback))}}function hSe(n){return n==null?void 0:n.reference}const{definePartsStyle:DR,defineMultiStyleConfig:pSe}=xi(ove.keys),Ll=On("alert-fg"),Af=On("alert-bg"),fSe=DR({container:{bg:Af.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Ll.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Ll.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function LV(n){const{theme:t,colorScheme:s}=n,a=QS(`${s}.200`,.16)(t);return{light:`colors.${s}.100`,dark:a}}const mSe=DR(n=>{const{colorScheme:t}=n,s=LV(n);return{container:{[Ll.variable]:`colors.${t}.600`,[Af.variable]:s.light,_dark:{[Ll.variable]:`colors.${t}.200`,[Af.variable]:s.dark}}}}),gSe=DR(n=>{const{colorScheme:t}=n,s=LV(n);return{container:{[Ll.variable]:`colors.${t}.600`,[Af.variable]:s.light,_dark:{[Ll.variable]:`colors.${t}.200`,[Af.variable]:s.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Ll.reference}}}),_Se=DR(n=>{const{colorScheme:t}=n,s=LV(n);return{container:{[Ll.variable]:`colors.${t}.600`,[Af.variable]:s.light,_dark:{[Ll.variable]:`colors.${t}.200`,[Af.variable]:s.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Ll.reference}}}),ESe=DR(n=>{const{colorScheme:t}=n;return{container:{[Ll.variable]:"colors.white",[Af.variable]:`colors.${t}.600`,_dark:{[Ll.variable]:"colors.gray.900",[Af.variable]:`colors.${t}.200`},color:Ll.reference}}}),ySe={subtle:mSe,"left-accent":gSe,"top-accent":_Se,solid:ESe},vSe=pSe({baseStyle:fSe,variants:ySe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),yQ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},SSe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},bSe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},vQ={...yQ,...SSe,container:bSe},TSe=n=>typeof n=="function";function fc(n,...t){return TSe(n)?n(...t):n}const{definePartsStyle:SQ,defineMultiStyleConfig:wSe}=xi(ave.keys),US=On("avatar-border-color"),Fw=On("avatar-bg"),aR=On("avatar-font-size"),ZS=On("avatar-size"),RSe={borderRadius:"full",border:"0.2em solid",borderColor:US.reference,[US.variable]:"white",_dark:{[US.variable]:"colors.gray.800"}},CSe={bg:Fw.reference,fontSize:aR.reference,width:ZS.reference,height:ZS.reference,lineHeight:"1",[Fw.variable]:"colors.gray.200",_dark:{[Fw.variable]:"colors.whiteAlpha.400"}},ISe=n=>{const{name:t,theme:s}=n,a=t?rSe({string:t}):"colors.gray.400",l=tSe(a)(s);let d="white";return l||(d="gray.800"),{bg:Fw.reference,fontSize:aR.reference,color:d,borderColor:US.reference,verticalAlign:"top",width:ZS.reference,height:ZS.reference,"&:not([data-loaded])":{[Fw.variable]:a},[US.variable]:"colors.white",_dark:{[US.variable]:"colors.gray.800"}}},ASe={fontSize:aR.reference,lineHeight:"1"},PSe=SQ(n=>({badge:fc(RSe,n),excessLabel:fc(CSe,n),container:fc(ISe,n),label:ASe}));function Km(n){const t=n!=="100%"?vQ[n]:void 0;return SQ({container:{[ZS.variable]:t??n,[aR.variable]:`calc(${t??n} / 2.5)`},excessLabel:{[ZS.variable]:t??n,[aR.variable]:`calc(${t??n} / 2.5)`}})}const OSe={"2xs":Km(4),xs:Km(6),sm:Km(8),md:Km(12),lg:Km(16),xl:Km(24),"2xl":Km(32),full:Km("100%")},kSe=wSe({baseStyle:PSe,sizes:OSe,defaultProps:{size:"md"}}),Gs=Jye("badge",["bg","color","shadow"]),NSe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Gs.bg.reference,color:Gs.color.reference,boxShadow:Gs.shadow.reference},DSe=n=>{const{colorScheme:t,theme:s}=n,a=QS(`${t}.500`,.6)(s);return{[Gs.bg.variable]:`colors.${t}.500`,[Gs.color.variable]:"colors.white",_dark:{[Gs.bg.variable]:a,[Gs.color.variable]:"colors.whiteAlpha.800"}}},LSe=n=>{const{colorScheme:t,theme:s}=n,a=QS(`${t}.200`,.16)(s);return{[Gs.bg.variable]:`colors.${t}.100`,[Gs.color.variable]:`colors.${t}.800`,_dark:{[Gs.bg.variable]:a,[Gs.color.variable]:`colors.${t}.200`}}},xSe=n=>{const{colorScheme:t,theme:s}=n,a=QS(`${t}.200`,.8)(s);return{[Gs.color.variable]:`colors.${t}.500`,_dark:{[Gs.color.variable]:a},[Gs.shadow.variable]:`inset 0 0 0px 1px ${Gs.color.reference}`}},MSe={solid:DSe,subtle:LSe,outline:xSe},jw={baseStyle:NSe,variants:MSe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:USe,definePartsStyle:VSe}=xi(cve.keys),A2=On("breadcrumb-link-decor"),FSe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:A2.reference,[A2.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[A2.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},jSe=VSe({link:FSe}),BSe=USe({baseStyle:jSe}),WSe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},bQ=n=>{const{colorScheme:t,theme:s}=n;if(t==="gray")return{color:Pn("gray.800","whiteAlpha.900")(n),_hover:{bg:Pn("gray.100","whiteAlpha.200")(n)},_active:{bg:Pn("gray.200","whiteAlpha.300")(n)}};const a=QS(`${t}.200`,.12)(s),l=QS(`${t}.200`,.24)(s);return{color:Pn(`${t}.600`,`${t}.200`)(n),bg:"transparent",_hover:{bg:Pn(`${t}.50`,a)(n)},_active:{bg:Pn(`${t}.100`,l)(n)}}},zSe=n=>{const{colorScheme:t}=n,s=Pn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:t==="gray"?s:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...fc(bQ,n)}},GSe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},HSe=n=>{const{colorScheme:t}=n;if(t==="gray"){const E=Pn("gray.100","whiteAlpha.200")(n);return{bg:E,color:Pn("gray.800","whiteAlpha.900")(n),_hover:{bg:Pn("gray.200","whiteAlpha.300")(n),_disabled:{bg:E}},_active:{bg:Pn("gray.300","whiteAlpha.400")(n)}}}const{bg:s=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=GSe[t]??{},f=Pn(s,`${t}.200`)(n);return{bg:f,color:Pn(a,"gray.800")(n),_hover:{bg:Pn(l,`${t}.300`)(n),_disabled:{bg:f}},_active:{bg:Pn(d,`${t}.400`)(n)}}},$Se=n=>{const{colorScheme:t}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Pn(`${t}.500`,`${t}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Pn(`${t}.700`,`${t}.500`)(n)}}},KSe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},qSe={ghost:bQ,outline:zSe,solid:HSe,link:$Se,unstyled:KSe},YSe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},XSe={baseStyle:WSe,variants:qSe,sizes:YSe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:dE,defineMultiStyleConfig:JSe}=xi(Pve.keys),rk=On("card-bg"),vf=On("card-padding"),TQ=On("card-shadow"),TO=On("card-radius"),wQ=On("card-border-width","0"),RQ=On("card-border-color"),QSe=dE({container:{[rk.variable]:"colors.chakra-body-bg",backgroundColor:rk.reference,boxShadow:TQ.reference,borderRadius:TO.reference,color:"chakra-body-text",borderWidth:wQ.reference,borderColor:RQ.reference},body:{padding:vf.reference,flex:"1 1 0%"},header:{padding:vf.reference},footer:{padding:vf.reference}}),ZSe={sm:dE({container:{[TO.variable]:"radii.base",[vf.variable]:"space.3"}}),md:dE({container:{[TO.variable]:"radii.md",[vf.variable]:"space.5"}}),lg:dE({container:{[TO.variable]:"radii.xl",[vf.variable]:"space.7"}})},e0e={elevated:dE({container:{[TQ.variable]:"shadows.base",_dark:{[rk.variable]:"colors.gray.700"}}}),outline:dE({container:{[wQ.variable]:"1px",[RQ.variable]:"colors.chakra-border-color"}}),filled:dE({container:{[rk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[vf.variable]:0},header:{[vf.variable]:0},footer:{[vf.variable]:0}}},t0e=JSe({baseStyle:QSe,variants:e0e,sizes:ZSe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:wO,defineMultiStyleConfig:n0e}=xi(lve.keys),Bw=On("checkbox-size"),r0e=n=>{const{colorScheme:t}=n;return{w:Bw.reference,h:Bw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Pn(`${t}.500`,`${t}.200`)(n),borderColor:Pn(`${t}.500`,`${t}.200`)(n),color:Pn("white","gray.900")(n),_hover:{bg:Pn(`${t}.600`,`${t}.300`)(n),borderColor:Pn(`${t}.600`,`${t}.300`)(n)},_disabled:{borderColor:Pn("gray.200","transparent")(n),bg:Pn("gray.200","whiteAlpha.300")(n),color:Pn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Pn(`${t}.500`,`${t}.200`)(n),borderColor:Pn(`${t}.500`,`${t}.200`)(n),color:Pn("white","gray.900")(n)},_disabled:{bg:Pn("gray.100","whiteAlpha.100")(n),borderColor:Pn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Pn("red.500","red.300")(n)}}},i0e={_disabled:{cursor:"not-allowed"}},s0e={userSelect:"none",_disabled:{opacity:.4}},o0e={transitionProperty:"transform",transitionDuration:"normal"},a0e=wO(n=>({icon:o0e,container:i0e,control:fc(r0e,n),label:s0e})),c0e={sm:wO({control:{[Bw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:wO({control:{[Bw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:wO({control:{[Bw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},Qm=n0e({baseStyle:a0e,sizes:c0e,defaultProps:{size:"md",colorScheme:"blue"}}),Ww=go("close-button-size"),tw=go("close-button-bg"),l0e={w:[Ww.reference],h:[Ww.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[tw.variable]:"colors.blackAlpha.100",_dark:{[tw.variable]:"colors.whiteAlpha.100"}},_active:{[tw.variable]:"colors.blackAlpha.200",_dark:{[tw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:tw.reference},u0e={lg:{[Ww.variable]:"sizes.10",fontSize:"md"},md:{[Ww.variable]:"sizes.8",fontSize:"xs"},sm:{[Ww.variable]:"sizes.6",fontSize:"2xs"}},d0e={baseStyle:l0e,sizes:u0e,defaultProps:{size:"md"}},{variants:h0e,defaultProps:p0e}=jw,f0e={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Gs.bg.reference,color:Gs.color.reference,boxShadow:Gs.shadow.reference},m0e={baseStyle:f0e,variants:h0e,defaultProps:p0e},g0e={w:"100%",mx:"auto",maxW:"prose",px:"4"},_0e={baseStyle:g0e},E0e={opacity:.6,borderColor:"inherit"},y0e={borderStyle:"solid"},v0e={borderStyle:"dashed"},S0e={solid:y0e,dashed:v0e},b0e={baseStyle:E0e,variants:S0e,defaultProps:{variant:"solid"}},{definePartsStyle:QM,defineMultiStyleConfig:T0e}=xi(uve.keys),P2=On("drawer-bg"),O2=On("drawer-box-shadow");function rS(n){return QM(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const w0e={bg:"blackAlpha.600",zIndex:"modal"},R0e={display:"flex",zIndex:"modal",justifyContent:"center"},C0e=n=>{const{isFullHeight:t}=n;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[P2.variable]:"colors.white",[O2.variable]:"shadows.lg",_dark:{[P2.variable]:"colors.gray.700",[O2.variable]:"shadows.dark-lg"},bg:P2.reference,boxShadow:O2.reference}},I0e={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},A0e={position:"absolute",top:"2",insetEnd:"3"},P0e={px:"6",py:"2",flex:"1",overflow:"auto"},O0e={px:"6",py:"4"},k0e=QM(n=>({overlay:w0e,dialogContainer:R0e,dialog:fc(C0e,n),header:I0e,closeButton:A0e,body:P0e,footer:O0e})),N0e={xs:rS("xs"),sm:rS("md"),md:rS("lg"),lg:rS("2xl"),xl:rS("4xl"),full:rS("full")},D0e=T0e({baseStyle:k0e,sizes:N0e,defaultProps:{size:"xs"}}),{definePartsStyle:L0e,defineMultiStyleConfig:x0e}=xi(dve.keys),M0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},U0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},V0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},F0e=L0e({preview:M0e,input:U0e,textarea:V0e}),j0e=x0e({baseStyle:F0e}),{definePartsStyle:B0e,defineMultiStyleConfig:W0e}=xi(hve.keys),VS=On("form-control-color"),z0e={marginStart:"1",[VS.variable]:"colors.red.500",_dark:{[VS.variable]:"colors.red.300"},color:VS.reference},G0e={mt:"2",[VS.variable]:"colors.gray.600",_dark:{[VS.variable]:"colors.whiteAlpha.600"},color:VS.reference,lineHeight:"normal",fontSize:"sm"},H0e=B0e({container:{width:"100%",position:"relative"},requiredIndicator:z0e,helperText:G0e}),$0e=W0e({baseStyle:H0e}),{definePartsStyle:K0e,defineMultiStyleConfig:q0e}=xi(pve.keys),FS=On("form-error-color"),Y0e={[FS.variable]:"colors.red.500",_dark:{[FS.variable]:"colors.red.300"},color:FS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},X0e={marginEnd:"0.5em",[FS.variable]:"colors.red.500",_dark:{[FS.variable]:"colors.red.300"},color:FS.reference},J0e=K0e({text:Y0e,icon:X0e}),Q0e=q0e({baseStyle:J0e}),Z0e={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},ebe={baseStyle:Z0e},tbe={fontFamily:"heading",fontWeight:"bold"},nbe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},rbe={baseStyle:tbe,sizes:nbe,defaultProps:{size:"xl"}},{definePartsStyle:df,defineMultiStyleConfig:ibe}=xi(fve.keys),_S=On("input-height"),ES=On("input-font-size"),yS=On("input-padding"),vS=On("input-border-radius"),sbe=df({addon:{height:_S.reference,fontSize:ES.reference,px:yS.reference,borderRadius:vS.reference},field:{width:"100%",height:_S.reference,fontSize:ES.reference,px:yS.reference,borderRadius:vS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),qm={lg:{[ES.variable]:"fontSizes.lg",[yS.variable]:"space.4",[vS.variable]:"radii.md",[_S.variable]:"sizes.12"},md:{[ES.variable]:"fontSizes.md",[yS.variable]:"space.4",[vS.variable]:"radii.md",[_S.variable]:"sizes.10"},sm:{[ES.variable]:"fontSizes.sm",[yS.variable]:"space.3",[vS.variable]:"radii.sm",[_S.variable]:"sizes.8"},xs:{[ES.variable]:"fontSizes.xs",[yS.variable]:"space.2",[vS.variable]:"radii.sm",[_S.variable]:"sizes.6"}},obe={lg:df({field:qm.lg,group:qm.lg}),md:df({field:qm.md,group:qm.md}),sm:df({field:qm.sm,group:qm.sm}),xs:df({field:qm.xs,group:qm.xs})};function xV(n){const{focusBorderColor:t,errorBorderColor:s}=n;return{focusBorderColor:t||Pn("blue.500","blue.300")(n),errorBorderColor:s||Pn("red.500","red.300")(n)}}const abe=df(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=xV(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Pn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:pc(t,a),boxShadow:`0 0 0 1px ${pc(t,a)}`},_focusVisible:{zIndex:1,borderColor:pc(t,s),boxShadow:`0 0 0 1px ${pc(t,s)}`}},addon:{border:"1px solid",borderColor:Pn("inherit","whiteAlpha.50")(n),bg:Pn("gray.100","whiteAlpha.300")(n)}}}),cbe=df(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=xV(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Pn("gray.100","whiteAlpha.50")(n),_hover:{bg:Pn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:pc(t,a)},_focusVisible:{bg:"transparent",borderColor:pc(t,s)}},addon:{border:"2px solid",borderColor:"transparent",bg:Pn("gray.100","whiteAlpha.50")(n)}}}),lbe=df(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=xV(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:pc(t,a),boxShadow:`0px 1px 0px 0px ${pc(t,a)}`},_focusVisible:{borderColor:pc(t,s),boxShadow:`0px 1px 0px 0px ${pc(t,s)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),ube=df({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),dbe={outline:abe,filled:cbe,flushed:lbe,unstyled:ube},Jr=ibe({baseStyle:sbe,sizes:obe,variants:dbe,defaultProps:{size:"md",variant:"outline"}}),k2=On("kbd-bg"),hbe={[k2.variable]:"colors.gray.100",_dark:{[k2.variable]:"colors.whiteAlpha.100"},bg:k2.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},pbe={baseStyle:hbe},fbe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},mbe={baseStyle:fbe},{defineMultiStyleConfig:gbe,definePartsStyle:_be}=xi(mve.keys),Ebe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},ybe=_be({icon:Ebe}),vbe=gbe({baseStyle:ybe}),{defineMultiStyleConfig:Sbe,definePartsStyle:bbe}=xi(gve.keys),Oh=On("menu-bg"),N2=On("menu-shadow"),Tbe={[Oh.variable]:"#fff",[N2.variable]:"shadows.sm",_dark:{[Oh.variable]:"colors.gray.700",[N2.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Oh.reference,boxShadow:N2.reference},wbe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Oh.variable]:"colors.gray.100",_dark:{[Oh.variable]:"colors.whiteAlpha.100"}},_active:{[Oh.variable]:"colors.gray.200",_dark:{[Oh.variable]:"colors.whiteAlpha.200"}},_expanded:{[Oh.variable]:"colors.gray.100",_dark:{[Oh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Oh.reference},Rbe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},Cbe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},Ibe={opacity:.6},Abe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},Pbe={transitionProperty:"common",transitionDuration:"normal"},Obe=bbe({button:Pbe,list:Tbe,item:wbe,groupTitle:Rbe,icon:Cbe,command:Ibe,divider:Abe}),kbe=Sbe({baseStyle:Obe}),{defineMultiStyleConfig:Nbe,definePartsStyle:ZM}=xi(_ve.keys),D2=On("modal-bg"),L2=On("modal-shadow"),Dbe={bg:"blackAlpha.600",zIndex:"modal"},Lbe=n=>{const{isCentered:t,scrollBehavior:s}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:s==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},xbe=n=>{const{isCentered:t,scrollBehavior:s}=n;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:s==="inside"?"calc(100% - 7.5rem)":void 0,[D2.variable]:"colors.white",[L2.variable]:"shadows.lg",_dark:{[D2.variable]:"colors.gray.700",[L2.variable]:"shadows.dark-lg"},bg:D2.reference,boxShadow:L2.reference}},Mbe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Ube={position:"absolute",top:"2",insetEnd:"3"},Vbe=n=>{const{scrollBehavior:t}=n;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},Fbe={px:"6",py:"4"},jbe=ZM(n=>({overlay:Dbe,dialogContainer:fc(Lbe,n),dialog:fc(xbe,n),header:Mbe,closeButton:Ube,body:fc(Vbe,n),footer:Fbe}));function bd(n){return ZM(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const Bbe={xs:bd("xs"),sm:bd("sm"),md:bd("md"),lg:bd("lg"),xl:bd("xl"),"2xl":bd("2xl"),"3xl":bd("3xl"),"4xl":bd("4xl"),"5xl":bd("5xl"),"6xl":bd("6xl"),full:bd("full")},Wbe=Nbe({baseStyle:jbe,sizes:Bbe,defaultProps:{size:"md"}}),CQ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:zbe,definePartsStyle:IQ}=xi(Eve.keys),MV=go("number-input-stepper-width"),AQ=go("number-input-input-padding"),Gbe=lf(MV).add("0.5rem").toString(),x2=go("number-input-bg"),M2=go("number-input-color"),U2=go("number-input-border-color"),Hbe={[MV.variable]:"sizes.6",[AQ.variable]:Gbe},$be=n=>{var t;return((t=fc(Jr.baseStyle,n))==null?void 0:t.field)??{}},Kbe={width:MV.reference},qbe={borderStart:"1px solid",borderStartColor:U2.reference,color:M2.reference,bg:x2.reference,[M2.variable]:"colors.chakra-body-text",[U2.variable]:"colors.chakra-border-color",_dark:{[M2.variable]:"colors.whiteAlpha.800",[U2.variable]:"colors.whiteAlpha.300"},_active:{[x2.variable]:"colors.gray.200",_dark:{[x2.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},Ybe=IQ(n=>({root:Hbe,field:fc($be,n)??{},stepperGroup:Kbe,stepper:qbe}));function qP(n){var d,f;const t=(d=Jr.sizes)==null?void 0:d[n],s={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((f=t.field)==null?void 0:f.fontSize)??"md",l=CQ.fontSizes[a];return IQ({field:{...t.field,paddingInlineEnd:AQ.reference,verticalAlign:"top"},stepper:{fontSize:lf(l).multiply(.75).toString(),_first:{borderTopEndRadius:s[n]},_last:{borderBottomEndRadius:s[n],mt:"-1px",borderTopWidth:1}}})}const Xbe={xs:qP("xs"),sm:qP("sm"),md:qP("md"),lg:qP("lg")},Jbe=zbe({baseStyle:Ybe,sizes:Xbe,variants:Jr.variants,defaultProps:Jr.defaultProps});var CJ;const Qbe={...(CJ=Jr.baseStyle)==null?void 0:CJ.field,textAlign:"center"},Zbe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var IJ;const eTe={outline:n=>{var t,s;return((s=fc((t=Jr.variants)==null?void 0:t.outline,n))==null?void 0:s.field)??{}},flushed:n=>{var t,s;return((s=fc((t=Jr.variants)==null?void 0:t.flushed,n))==null?void 0:s.field)??{}},filled:n=>{var t,s;return((s=fc((t=Jr.variants)==null?void 0:t.filled,n))==null?void 0:s.field)??{}},unstyled:((IJ=Jr.variants)==null?void 0:IJ.unstyled.field)??{}},tTe={baseStyle:Qbe,sizes:Zbe,variants:eTe,defaultProps:Jr.defaultProps},{defineMultiStyleConfig:nTe,definePartsStyle:rTe}=xi(yve.keys),YP=go("popper-bg"),iTe=go("popper-arrow-bg"),z$=go("popper-arrow-shadow-color"),sTe={zIndex:"popover"},oTe={[YP.variable]:"colors.white",bg:YP.reference,[iTe.variable]:YP.reference,[z$.variable]:"colors.gray.200",_dark:{[YP.variable]:"colors.gray.700",[z$.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},aTe={px:3,py:2,borderBottomWidth:"1px"},cTe={px:3,py:2},lTe={px:3,py:2,borderTopWidth:"1px"},uTe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},dTe=rTe({popper:sTe,content:oTe,header:aTe,body:cTe,footer:lTe,closeButton:uTe}),hTe=nTe({baseStyle:dTe}),{defineMultiStyleConfig:pTe,definePartsStyle:Tw}=xi(vve.keys),fTe=n=>{const{colorScheme:t,theme:s,isIndeterminate:a,hasStripe:l}=n,d=Pn(V$(),V$("1rem","rgba(0,0,0,0.1)"))(n),f=Pn(`${t}.500`,`${t}.200`)(n),E=`linear-gradient(
    to right,
    transparent 0%,
    ${pc(s,f)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:E}:{bgColor:f}}},mTe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},gTe=n=>({bg:Pn("gray.100","whiteAlpha.300")(n)}),_Te=n=>({transitionProperty:"common",transitionDuration:"slow",...fTe(n)}),ETe=Tw(n=>({label:mTe,filledTrack:_Te(n),track:gTe(n)})),yTe={xs:Tw({track:{h:"1"}}),sm:Tw({track:{h:"2"}}),md:Tw({track:{h:"3"}}),lg:Tw({track:{h:"4"}})},vTe=pTe({sizes:yTe,baseStyle:ETe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:STe,definePartsStyle:RO}=xi(Sve.keys),bTe=n=>{var s;const t=(s=fc(Qm.baseStyle,n))==null?void 0:s.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},TTe=RO(n=>{var t,s;return{label:(t=Qm.baseStyle)==null?void 0:t.call(Qm,n).label,container:(s=Qm.baseStyle)==null?void 0:s.call(Qm,n).container,control:bTe(n)}}),wTe={md:RO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:RO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:RO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},RTe=STe({baseStyle:TTe,sizes:wTe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:CTe,definePartsStyle:ITe}=xi(bve.keys),XP=On("select-bg");var AJ;const ATe={...(AJ=Jr.baseStyle)==null?void 0:AJ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:XP.reference,[XP.variable]:"colors.white",_dark:{[XP.variable]:"colors.gray.700"},"> option, > optgroup":{bg:XP.reference}},PTe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},OTe=ITe({field:ATe,icon:PTe}),JP={paddingInlineEnd:"8"};var PJ,OJ,kJ,NJ,DJ,LJ,xJ,MJ;const kTe={lg:{...(PJ=Jr.sizes)==null?void 0:PJ.lg,field:{...(OJ=Jr.sizes)==null?void 0:OJ.lg.field,...JP}},md:{...(kJ=Jr.sizes)==null?void 0:kJ.md,field:{...(NJ=Jr.sizes)==null?void 0:NJ.md.field,...JP}},sm:{...(DJ=Jr.sizes)==null?void 0:DJ.sm,field:{...(LJ=Jr.sizes)==null?void 0:LJ.sm.field,...JP}},xs:{...(xJ=Jr.sizes)==null?void 0:xJ.xs,field:{...(MJ=Jr.sizes)==null?void 0:MJ.xs.field,...JP},icon:{insetEnd:"1"}}},NTe=CTe({baseStyle:OTe,sizes:kTe,variants:Jr.variants,defaultProps:Jr.defaultProps}),V2=On("skeleton-start-color"),F2=On("skeleton-end-color"),DTe={[V2.variable]:"colors.gray.100",[F2.variable]:"colors.gray.400",_dark:{[V2.variable]:"colors.gray.800",[F2.variable]:"colors.gray.600"},background:V2.reference,borderColor:F2.reference,opacity:.7,borderRadius:"sm"},LTe={baseStyle:DTe},j2=On("skip-link-bg"),xTe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[j2.variable]:"colors.white",_dark:{[j2.variable]:"colors.gray.700"},bg:j2.reference}},MTe={baseStyle:xTe},{defineMultiStyleConfig:UTe,definePartsStyle:qk}=xi(Tve.keys),vE=On("slider-thumb-size"),cR=On("slider-track-size"),Zm=On("slider-bg"),VTe=n=>{const{orientation:t}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...DV({orientation:t,vertical:{h:"100%",px:cf(vE.reference).divide(2).toString()},horizontal:{w:"100%",py:cf(vE.reference).divide(2).toString()}})}},FTe=n=>({...DV({orientation:n.orientation,horizontal:{h:cR.reference},vertical:{w:cR.reference}}),overflow:"hidden",borderRadius:"sm",[Zm.variable]:"colors.gray.200",_dark:{[Zm.variable]:"colors.whiteAlpha.200"},_disabled:{[Zm.variable]:"colors.gray.300",_dark:{[Zm.variable]:"colors.whiteAlpha.300"}},bg:Zm.reference}),jTe=n=>{const{orientation:t}=n;return{...DV({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:vE.reference,h:vE.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},BTe=n=>{const{colorScheme:t}=n;return{width:"inherit",height:"inherit",[Zm.variable]:`colors.${t}.500`,_dark:{[Zm.variable]:`colors.${t}.200`},bg:Zm.reference}},WTe=qk(n=>({container:VTe(n),track:FTe(n),thumb:jTe(n),filledTrack:BTe(n)})),zTe=qk({container:{[vE.variable]:"sizes.4",[cR.variable]:"sizes.1"}}),GTe=qk({container:{[vE.variable]:"sizes.3.5",[cR.variable]:"sizes.1"}}),HTe=qk({container:{[vE.variable]:"sizes.2.5",[cR.variable]:"sizes.0.5"}}),$Te={lg:zTe,md:GTe,sm:HTe},KTe=UTe({baseStyle:WTe,sizes:$Te,defaultProps:{size:"md",colorScheme:"blue"}}),sE=go("spinner-size"),qTe={width:[sE.reference],height:[sE.reference]},YTe={xs:{[sE.variable]:"sizes.3"},sm:{[sE.variable]:"sizes.4"},md:{[sE.variable]:"sizes.6"},lg:{[sE.variable]:"sizes.8"},xl:{[sE.variable]:"sizes.12"}},XTe={baseStyle:qTe,sizes:YTe,defaultProps:{size:"md"}},{defineMultiStyleConfig:JTe,definePartsStyle:PQ}=xi(wve.keys),QTe={fontWeight:"medium"},ZTe={opacity:.8,marginBottom:"2"},ewe={verticalAlign:"baseline",fontWeight:"semibold"},twe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},nwe=PQ({container:{},label:QTe,helpText:ZTe,number:ewe,icon:twe}),rwe={md:PQ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},iwe=JTe({baseStyle:nwe,sizes:rwe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:swe,definePartsStyle:ww}=xi(["stepper","step","title","description","indicator","separator","icon","number"]),uf=On("stepper-indicator-size"),SS=On("stepper-icon-size"),bS=On("stepper-title-font-size"),Rw=On("stepper-description-font-size"),nw=On("stepper-accent-color"),owe=ww(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[nw.variable]:`colors.${n}.500`,_dark:{[nw.variable]:`colors.${n}.200`}},title:{fontSize:bS.reference,fontWeight:"medium"},description:{fontSize:Rw.reference,color:"chakra-subtle-text"},number:{fontSize:bS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:SS.reference,height:SS.reference},indicator:{flexShrink:0,borderRadius:"full",width:uf.reference,height:uf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:nw.reference},"&[data-status=complete]":{bg:nw.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:nw.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${uf.reference} - 8px)`,top:`calc(${uf.reference} + 4px)`,insetStart:`calc(${uf.reference} / 2 - 1px)`}}})),awe=swe({baseStyle:owe,sizes:{xs:ww({stepper:{[uf.variable]:"sizes.4",[SS.variable]:"sizes.3",[bS.variable]:"fontSizes.xs",[Rw.variable]:"fontSizes.xs"}}),sm:ww({stepper:{[uf.variable]:"sizes.6",[SS.variable]:"sizes.4",[bS.variable]:"fontSizes.sm",[Rw.variable]:"fontSizes.xs"}}),md:ww({stepper:{[uf.variable]:"sizes.8",[SS.variable]:"sizes.5",[bS.variable]:"fontSizes.md",[Rw.variable]:"fontSizes.sm"}}),lg:ww({stepper:{[uf.variable]:"sizes.10",[SS.variable]:"sizes.6",[bS.variable]:"fontSizes.lg",[Rw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:cwe,definePartsStyle:CO}=xi(Rve.keys),zw=go("switch-track-width"),hE=go("switch-track-height"),B2=go("switch-track-diff"),lwe=lf.subtract(zw,hE),eU=go("switch-thumb-x"),rw=go("switch-bg"),uwe=n=>{const{colorScheme:t}=n;return{borderRadius:"full",p:"0.5",width:[zw.reference],height:[hE.reference],transitionProperty:"common",transitionDuration:"fast",[rw.variable]:"colors.gray.300",_dark:{[rw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[rw.variable]:`colors.${t}.500`,_dark:{[rw.variable]:`colors.${t}.200`}},bg:rw.reference}},dwe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[hE.reference],height:[hE.reference],_checked:{transform:`translateX(${eU.reference})`}},hwe=CO(n=>({container:{[B2.variable]:lwe,[eU.variable]:B2.reference,_rtl:{[eU.variable]:lf(B2).negate().toString()}},track:uwe(n),thumb:dwe})),pwe={sm:CO({container:{[zw.variable]:"1.375rem",[hE.variable]:"sizes.3"}}),md:CO({container:{[zw.variable]:"1.875rem",[hE.variable]:"sizes.4"}}),lg:CO({container:{[zw.variable]:"2.875rem",[hE.variable]:"sizes.6"}})},fwe=cwe({baseStyle:hwe,sizes:pwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:mwe,definePartsStyle:jS}=xi(Cve.keys),gwe=jS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),ik={"&[data-is-numeric=true]":{textAlign:"end"}},_we=jS(n=>{const{colorScheme:t}=n;return{th:{color:Pn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(n),...ik},td:{borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(n),...ik},caption:{color:Pn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Ewe=jS(n=>{const{colorScheme:t}=n;return{th:{color:Pn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(n),...ik},td:{borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(n),...ik},caption:{color:Pn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(n)},td:{background:Pn(`${t}.100`,`${t}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),ywe={simple:_we,striped:Ewe,unstyled:{}},vwe={sm:jS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:jS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:jS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},Swe=mwe({baseStyle:gwe,variants:ywe,sizes:vwe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Qc=On("tabs-color"),Rd=On("tabs-bg"),QP=On("tabs-border-color"),{defineMultiStyleConfig:bwe,definePartsStyle:Wh}=xi(Ive.keys),Twe=n=>{const{orientation:t}=n;return{display:t==="vertical"?"flex":"block"}},wwe=n=>{const{isFitted:t}=n;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},Rwe=n=>{const{align:t="start",orientation:s}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:s==="vertical"?"column":"row"}},Cwe={p:4},Iwe=Wh(n=>({root:Twe(n),tab:wwe(n),tablist:Rwe(n),tabpanel:Cwe})),Awe={sm:Wh({tab:{py:1,px:4,fontSize:"sm"}}),md:Wh({tab:{fontSize:"md",py:2,px:4}}),lg:Wh({tab:{fontSize:"lg",py:3,px:4}})},Pwe=Wh(n=>{const{colorScheme:t,orientation:s}=n,a=s==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[Qc.variable]:`colors.${t}.600`,_dark:{[Qc.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[Rd.variable]:"colors.gray.200",_dark:{[Rd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Qc.reference,bg:Rd.reference}}}),Owe=Wh(n=>{const{colorScheme:t}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[QP.variable]:"transparent",_selected:{[Qc.variable]:`colors.${t}.600`,[QP.variable]:"colors.white",_dark:{[Qc.variable]:`colors.${t}.300`,[QP.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:QP.reference},color:Qc.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),kwe=Wh(n=>{const{colorScheme:t}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Rd.variable]:"colors.gray.50",_dark:{[Rd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Rd.variable]:"colors.white",[Qc.variable]:`colors.${t}.600`,_dark:{[Rd.variable]:"colors.gray.800",[Qc.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Qc.reference,bg:Rd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),Nwe=Wh(n=>{const{colorScheme:t,theme:s}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:pc(s,`${t}.700`),bg:pc(s,`${t}.100`)}}}}),Dwe=Wh(n=>{const{colorScheme:t}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[Qc.variable]:"colors.gray.600",_dark:{[Qc.variable]:"inherit"},_selected:{[Qc.variable]:"colors.white",[Rd.variable]:`colors.${t}.600`,_dark:{[Qc.variable]:"colors.gray.800",[Rd.variable]:`colors.${t}.300`}},color:Qc.reference,bg:Rd.reference}}}),Lwe=Wh({}),xwe={line:Pwe,enclosed:Owe,"enclosed-colored":kwe,"soft-rounded":Nwe,"solid-rounded":Dwe,unstyled:Lwe},Mwe=bwe({baseStyle:Iwe,sizes:Awe,variants:xwe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:Uwe,definePartsStyle:pE}=xi(Ave.keys),G$=On("tag-bg"),H$=On("tag-color"),W2=On("tag-shadow"),IO=On("tag-min-height"),AO=On("tag-min-width"),PO=On("tag-font-size"),OO=On("tag-padding-inline"),Vwe={fontWeight:"medium",lineHeight:1.2,outline:0,[H$.variable]:Gs.color.reference,[G$.variable]:Gs.bg.reference,[W2.variable]:Gs.shadow.reference,color:H$.reference,bg:G$.reference,boxShadow:W2.reference,borderRadius:"md",minH:IO.reference,minW:AO.reference,fontSize:PO.reference,px:OO.reference,_focusVisible:{[W2.variable]:"shadows.outline"}},Fwe={lineHeight:1.2,overflow:"visible"},jwe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},Bwe=pE({container:Vwe,label:Fwe,closeButton:jwe}),Wwe={sm:pE({container:{[IO.variable]:"sizes.5",[AO.variable]:"sizes.5",[PO.variable]:"fontSizes.xs",[OO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:pE({container:{[IO.variable]:"sizes.6",[AO.variable]:"sizes.6",[PO.variable]:"fontSizes.sm",[OO.variable]:"space.2"}}),lg:pE({container:{[IO.variable]:"sizes.8",[AO.variable]:"sizes.8",[PO.variable]:"fontSizes.md",[OO.variable]:"space.3"}})},zwe={subtle:pE(n=>{var t;return{container:(t=jw.variants)==null?void 0:t.subtle(n)}}),solid:pE(n=>{var t;return{container:(t=jw.variants)==null?void 0:t.solid(n)}}),outline:pE(n=>{var t;return{container:(t=jw.variants)==null?void 0:t.outline(n)}})},Gwe=Uwe({variants:zwe,baseStyle:Bwe,sizes:Wwe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var UJ;const Hwe={...(UJ=Jr.baseStyle)==null?void 0:UJ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var VJ;const $we={outline:n=>{var t;return((t=Jr.variants)==null?void 0:t.outline(n).field)??{}},flushed:n=>{var t;return((t=Jr.variants)==null?void 0:t.flushed(n).field)??{}},filled:n=>{var t;return((t=Jr.variants)==null?void 0:t.filled(n).field)??{}},unstyled:((VJ=Jr.variants)==null?void 0:VJ.unstyled.field)??{}};var FJ,jJ,BJ,WJ;const Kwe={xs:((FJ=Jr.sizes)==null?void 0:FJ.xs.field)??{},sm:((jJ=Jr.sizes)==null?void 0:jJ.sm.field)??{},md:((BJ=Jr.sizes)==null?void 0:BJ.md.field)??{},lg:((WJ=Jr.sizes)==null?void 0:WJ.lg.field)??{}},qwe={baseStyle:Hwe,sizes:Kwe,variants:$we,defaultProps:{size:"md",variant:"outline"}},ZP=go("tooltip-bg"),z2=go("tooltip-fg"),Ywe=go("popper-arrow-bg"),Xwe={bg:ZP.reference,color:z2.reference,[ZP.variable]:"colors.gray.700",[z2.variable]:"colors.whiteAlpha.900",_dark:{[ZP.variable]:"colors.gray.300",[z2.variable]:"colors.gray.900"},[Ywe.variable]:ZP.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},Jwe={baseStyle:Xwe},Qwe={Accordion:Uve,Alert:vSe,Avatar:kSe,Badge:jw,Breadcrumb:BSe,Button:XSe,Checkbox:Qm,CloseButton:d0e,Code:m0e,Container:_0e,Divider:b0e,Drawer:D0e,Editable:j0e,Form:$0e,FormError:Q0e,FormLabel:ebe,Heading:rbe,Input:Jr,Kbd:pbe,Link:mbe,List:vbe,Menu:kbe,Modal:Wbe,NumberInput:Jbe,PinInput:tTe,Popover:hTe,Progress:vTe,Radio:RTe,Select:NTe,Skeleton:LTe,SkipLink:MTe,Slider:KTe,Spinner:XTe,Stat:iwe,Switch:fwe,Table:Swe,Tabs:Mwe,Tag:Gwe,Textarea:qwe,Tooltip:Jwe,Card:t0e,Stepper:awe},Zwe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},eRe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},tRe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},nRe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},rRe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},iRe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},sRe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},oRe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},aRe={property:iRe,easing:sRe,duration:oRe},cRe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},lRe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},uRe={breakpoints:eRe,zIndices:cRe,radii:nRe,blur:lRe,colors:tRe,...CQ,sizes:vQ,shadows:rRe,space:yQ,borders:Zwe,transition:aRe},dRe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},hRe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},pRe="ltr",fRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},mRe={semanticTokens:dRe,direction:pRe,...uRe,components:Qwe,styles:hRe,config:fRe};function gRe(n){if(n.sheet)return n.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===n)return document.styleSheets[t]}function _Re(n){var t=document.createElement("style");return t.setAttribute("data-emotion",n.key),n.nonce!==void 0&&t.setAttribute("nonce",n.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var ERe=function(){function n(s){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=s.speedy===void 0?!0:s.speedy,this.tags=[],this.ctr=0,this.nonce=s.nonce,this.key=s.key,this.container=s.container,this.prepend=s.prepend,this.insertionPoint=s.insertionPoint,this.before=null}var t=n.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(_Re(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=gRe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),Fa="-ms-",sk="-moz-",Yr="-webkit-",OQ="comm",UV="rule",VV="decl",yRe="@import",kQ="@keyframes",vRe="@layer",SRe=Math.abs,Yk=String.fromCharCode,bRe=Object.assign;function TRe(n,t){return oa(n,0)^45?(((t<<2^oa(n,0))<<2^oa(n,1))<<2^oa(n,2))<<2^oa(n,3):0}function NQ(n){return n.trim()}function wRe(n,t){return(n=t.exec(n))?n[0]:n}function Xr(n,t,s){return n.replace(t,s)}function tU(n,t){return n.indexOf(t)}function oa(n,t){return n.charCodeAt(t)|0}function lR(n,t,s){return n.slice(t,s)}function Dh(n){return n.length}function FV(n){return n.length}function eO(n,t){return t.push(n),n}function RRe(n,t){return n.map(t).join("")}var Xk=1,e0=1,DQ=0,il=0,Qs=0,T0="";function Jk(n,t,s,a,l,d,f){return{value:n,root:t,parent:s,type:a,props:l,children:d,line:Xk,column:e0,length:f,return:""}}function iw(n,t){return bRe(Jk("",null,null,"",null,null,0),n,{length:-n.length},t)}function CRe(){return Qs}function IRe(){return Qs=il>0?oa(T0,--il):0,e0--,Qs===10&&(e0=1,Xk--),Qs}function xl(){return Qs=il<DQ?oa(T0,il++):0,e0++,Qs===10&&(e0=1,Xk++),Qs}function zh(){return oa(T0,il)}function kO(){return il}function LR(n,t){return lR(T0,n,t)}function uR(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function LQ(n){return Xk=e0=1,DQ=Dh(T0=n),il=0,[]}function xQ(n){return T0="",n}function NO(n){return NQ(LR(il-1,nU(n===91?n+2:n===40?n+1:n)))}function ARe(n){for(;(Qs=zh())&&Qs<33;)xl();return uR(n)>2||uR(Qs)>3?"":" "}function PRe(n,t){for(;--t&&xl()&&!(Qs<48||Qs>102||Qs>57&&Qs<65||Qs>70&&Qs<97););return LR(n,kO()+(t<6&&zh()==32&&xl()==32))}function nU(n){for(;xl();)switch(Qs){case n:return il;case 34:case 39:n!==34&&n!==39&&nU(Qs);break;case 40:n===41&&nU(n);break;case 92:xl();break}return il}function ORe(n,t){for(;xl()&&n+Qs!==57;)if(n+Qs===84&&zh()===47)break;return"/*"+LR(t,il-1)+"*"+Yk(n===47?n:xl())}function kRe(n){for(;!uR(zh());)xl();return LR(n,il)}function NRe(n){return xQ(DO("",null,null,null,[""],n=LQ(n),0,[0],n))}function DO(n,t,s,a,l,d,f,E,v){for(var b=0,w=0,A=f,N=0,V=0,j=0,B=1,H=1,J=1,$=0,te="",ce=l,oe=d,_e=a,ne=te;H;)switch(j=$,$=xl()){case 40:if(j!=108&&oa(ne,A-1)==58){tU(ne+=Xr(NO($),"&","&\f"),"&\f")!=-1&&(J=-1);break}case 34:case 39:case 91:ne+=NO($);break;case 9:case 10:case 13:case 32:ne+=ARe(j);break;case 92:ne+=PRe(kO()-1,7);continue;case 47:switch(zh()){case 42:case 47:eO(DRe(ORe(xl(),kO()),t,s),v);break;default:ne+="/"}break;case 123*B:E[b++]=Dh(ne)*J;case 125*B:case 59:case 0:switch($){case 0:case 125:H=0;case 59+w:J==-1&&(ne=Xr(ne,/\f/g,"")),V>0&&Dh(ne)-A&&eO(V>32?K$(ne+";",a,s,A-1):K$(Xr(ne," ","")+";",a,s,A-2),v);break;case 59:ne+=";";default:if(eO(_e=$$(ne,t,s,b,w,l,E,te,ce=[],oe=[],A),d),$===123)if(w===0)DO(ne,t,_e,_e,ce,d,A,E,oe);else switch(N===99&&oa(ne,3)===110?100:N){case 100:case 108:case 109:case 115:DO(n,_e,_e,a&&eO($$(n,_e,_e,0,0,l,E,te,l,ce=[],A),oe),l,oe,A,E,a?ce:oe);break;default:DO(ne,_e,_e,_e,[""],oe,0,E,oe)}}b=w=V=0,B=J=1,te=ne="",A=f;break;case 58:A=1+Dh(ne),V=j;default:if(B<1){if($==123)--B;else if($==125&&B++==0&&IRe()==125)continue}switch(ne+=Yk($),$*B){case 38:J=w>0?1:(ne+="\f",-1);break;case 44:E[b++]=(Dh(ne)-1)*J,J=1;break;case 64:zh()===45&&(ne+=NO(xl())),N=zh(),w=A=Dh(te=ne+=kRe(kO())),$++;break;case 45:j===45&&Dh(ne)==2&&(B=0)}}return d}function $$(n,t,s,a,l,d,f,E,v,b,w){for(var A=l-1,N=l===0?d:[""],V=FV(N),j=0,B=0,H=0;j<a;++j)for(var J=0,$=lR(n,A+1,A=SRe(B=f[j])),te=n;J<V;++J)(te=NQ(B>0?N[J]+" "+$:Xr($,/&\f/g,N[J])))&&(v[H++]=te);return Jk(n,t,s,l===0?UV:E,v,b,w)}function DRe(n,t,s){return Jk(n,t,s,OQ,Yk(CRe()),lR(n,2,-2),0)}function K$(n,t,s,a){return Jk(n,t,s,VV,lR(n,0,a),lR(n,a+1,-1),a)}function BS(n,t){for(var s="",a=FV(n),l=0;l<a;l++)s+=t(n[l],l,n,t)||"";return s}function LRe(n,t,s,a){switch(n.type){case vRe:if(n.children.length)break;case yRe:case VV:return n.return=n.return||n.value;case OQ:return"";case kQ:return n.return=n.value+"{"+BS(n.children,a)+"}";case UV:n.value=n.props.join(",")}return Dh(s=BS(n.children,a))?n.return=n.value+"{"+s+"}":""}function xRe(n){var t=FV(n);return function(s,a,l,d){for(var f="",E=0;E<t;E++)f+=n[E](s,a,l,d)||"";return f}}function MRe(n){return function(t){t.root||(t=t.return)&&n(t)}}var q$=function(t){var s=new WeakMap;return function(a){if(s.has(a))return s.get(a);var l=t(a);return s.set(a,l),l}};function MQ(n){var t=Object.create(null);return function(s){return t[s]===void 0&&(t[s]=n(s)),t[s]}}var URe=function(t,s,a){for(var l=0,d=0;l=d,d=zh(),l===38&&d===12&&(s[a]=1),!uR(d);)xl();return LR(t,il)},VRe=function(t,s){var a=-1,l=44;do switch(uR(l)){case 0:l===38&&zh()===12&&(s[a]=1),t[a]+=URe(il-1,s,a);break;case 2:t[a]+=NO(l);break;case 4:if(l===44){t[++a]=zh()===58?"&\f":"",s[a]=t[a].length;break}default:t[a]+=Yk(l)}while(l=xl());return t},FRe=function(t,s){return xQ(VRe(LQ(t),s))},Y$=new WeakMap,jRe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var s=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&s.charCodeAt(0)!==58&&!Y$.get(a))&&!l){Y$.set(t,!0);for(var d=[],f=FRe(s,d),E=a.props,v=0,b=0;v<f.length;v++)for(var w=0;w<E.length;w++,b++)t.props[b]=d[v]?f[v].replace(/&\f/g,E[w]):E[w]+" "+f[v]}}},BRe=function(t){if(t.type==="decl"){var s=t.value;s.charCodeAt(0)===108&&s.charCodeAt(2)===98&&(t.return="",t.value="")}};function UQ(n,t){switch(TRe(n,t)){case 5103:return Yr+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Yr+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return Yr+n+sk+n+Fa+n+n;case 6828:case 4268:return Yr+n+Fa+n+n;case 6165:return Yr+n+Fa+"flex-"+n+n;case 5187:return Yr+n+Xr(n,/(\w+).+(:[^]+)/,Yr+"box-$1$2"+Fa+"flex-$1$2")+n;case 5443:return Yr+n+Fa+"flex-item-"+Xr(n,/flex-|-self/,"")+n;case 4675:return Yr+n+Fa+"flex-line-pack"+Xr(n,/align-content|flex-|-self/,"")+n;case 5548:return Yr+n+Fa+Xr(n,"shrink","negative")+n;case 5292:return Yr+n+Fa+Xr(n,"basis","preferred-size")+n;case 6060:return Yr+"box-"+Xr(n,"-grow","")+Yr+n+Fa+Xr(n,"grow","positive")+n;case 4554:return Yr+Xr(n,/([^-])(transform)/g,"$1"+Yr+"$2")+n;case 6187:return Xr(Xr(Xr(n,/(zoom-|grab)/,Yr+"$1"),/(image-set)/,Yr+"$1"),n,"")+n;case 5495:case 3959:return Xr(n,/(image-set\([^]*)/,Yr+"$1$`$1");case 4968:return Xr(Xr(n,/(.+:)(flex-)?(.*)/,Yr+"box-pack:$3"+Fa+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Yr+n+n;case 4095:case 3583:case 4068:case 2532:return Xr(n,/(.+)-inline(.+)/,Yr+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Dh(n)-1-t>6)switch(oa(n,t+1)){case 109:if(oa(n,t+4)!==45)break;case 102:return Xr(n,/(.+:)(.+)-([^]+)/,"$1"+Yr+"$2-$3$1"+sk+(oa(n,t+3)==108?"$3":"$2-$3"))+n;case 115:return~tU(n,"stretch")?UQ(Xr(n,"stretch","fill-available"),t)+n:n}break;case 4949:if(oa(n,t+1)!==115)break;case 6444:switch(oa(n,Dh(n)-3-(~tU(n,"!important")&&10))){case 107:return Xr(n,":",":"+Yr)+n;case 101:return Xr(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Yr+(oa(n,14)===45?"inline-":"")+"box$3$1"+Yr+"$2$3$1"+Fa+"$2box$3")+n}break;case 5936:switch(oa(n,t+11)){case 114:return Yr+n+Fa+Xr(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return Yr+n+Fa+Xr(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return Yr+n+Fa+Xr(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return Yr+n+Fa+n+n}return n}var WRe=function(t,s,a,l){if(t.length>-1&&!t.return)switch(t.type){case VV:t.return=UQ(t.value,t.length);break;case kQ:return BS([iw(t,{value:Xr(t.value,"@","@"+Yr)})],l);case UV:if(t.length)return RRe(t.props,function(d){switch(wRe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return BS([iw(t,{props:[Xr(d,/:(read-\w+)/,":"+sk+"$1")]})],l);case"::placeholder":return BS([iw(t,{props:[Xr(d,/:(plac\w+)/,":"+Yr+"input-$1")]}),iw(t,{props:[Xr(d,/:(plac\w+)/,":"+sk+"$1")]}),iw(t,{props:[Xr(d,/:(plac\w+)/,Fa+"input-$1")]})],l)}return""})}},zRe=[WRe],GRe=function(t){var s=t.key;if(s==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(B){var H=B.getAttribute("data-emotion");H.indexOf(" ")!==-1&&(document.head.appendChild(B),B.setAttribute("data-s",""))})}var l=t.stylisPlugins||zRe,d={},f,E=[];f=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+s+' "]'),function(B){for(var H=B.getAttribute("data-emotion").split(" "),J=1;J<H.length;J++)d[H[J]]=!0;E.push(B)});var v,b=[jRe,BRe];{var w,A=[LRe,MRe(function(B){w.insert(B)})],N=xRe(b.concat(l,A)),V=function(H){return BS(NRe(H),N)};v=function(H,J,$,te){w=$,V(H?H+"{"+J.styles+"}":J.styles),te&&(j.inserted[J.name]=!0)}}var j={key:s,sheet:new ERe({key:s,container:f,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:v};return j.sheet.hydrate(E),j};function SE(){return SE=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(n[a]=s[a])}return n},SE.apply(null,arguments)}var G2={exports:{}},ii={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X$;function HRe(){if(X$)return ii;X$=1;var n=typeof Symbol=="function"&&Symbol.for,t=n?Symbol.for("react.element"):60103,s=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,E=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,w=n?Symbol.for("react.forward_ref"):60112,A=n?Symbol.for("react.suspense"):60113,N=n?Symbol.for("react.suspense_list"):60120,V=n?Symbol.for("react.memo"):60115,j=n?Symbol.for("react.lazy"):60116,B=n?Symbol.for("react.block"):60121,H=n?Symbol.for("react.fundamental"):60117,J=n?Symbol.for("react.responder"):60118,$=n?Symbol.for("react.scope"):60119;function te(oe){if(typeof oe=="object"&&oe!==null){var _e=oe.$$typeof;switch(_e){case t:switch(oe=oe.type,oe){case v:case b:case a:case d:case l:case A:return oe;default:switch(oe=oe&&oe.$$typeof,oe){case E:case w:case j:case V:case f:return oe;default:return _e}}case s:return _e}}}function ce(oe){return te(oe)===b}return ii.AsyncMode=v,ii.ConcurrentMode=b,ii.ContextConsumer=E,ii.ContextProvider=f,ii.Element=t,ii.ForwardRef=w,ii.Fragment=a,ii.Lazy=j,ii.Memo=V,ii.Portal=s,ii.Profiler=d,ii.StrictMode=l,ii.Suspense=A,ii.isAsyncMode=function(oe){return ce(oe)||te(oe)===v},ii.isConcurrentMode=ce,ii.isContextConsumer=function(oe){return te(oe)===E},ii.isContextProvider=function(oe){return te(oe)===f},ii.isElement=function(oe){return typeof oe=="object"&&oe!==null&&oe.$$typeof===t},ii.isForwardRef=function(oe){return te(oe)===w},ii.isFragment=function(oe){return te(oe)===a},ii.isLazy=function(oe){return te(oe)===j},ii.isMemo=function(oe){return te(oe)===V},ii.isPortal=function(oe){return te(oe)===s},ii.isProfiler=function(oe){return te(oe)===d},ii.isStrictMode=function(oe){return te(oe)===l},ii.isSuspense=function(oe){return te(oe)===A},ii.isValidElementType=function(oe){return typeof oe=="string"||typeof oe=="function"||oe===a||oe===b||oe===d||oe===l||oe===A||oe===N||typeof oe=="object"&&oe!==null&&(oe.$$typeof===j||oe.$$typeof===V||oe.$$typeof===f||oe.$$typeof===E||oe.$$typeof===w||oe.$$typeof===H||oe.$$typeof===J||oe.$$typeof===$||oe.$$typeof===B)},ii.typeOf=te,ii}var J$;function $Re(){return J$||(J$=1,G2.exports=HRe()),G2.exports}var H2,Q$;function KRe(){if(Q$)return H2;Q$=1;var n=$Re(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=a,d[n.Memo]=l;function f(j){return n.isMemo(j)?l:d[j.$$typeof]||t}var E=Object.defineProperty,v=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,A=Object.getPrototypeOf,N=Object.prototype;function V(j,B,H){if(typeof B!="string"){if(N){var J=A(B);J&&J!==N&&V(j,J,H)}var $=v(B);b&&($=$.concat(b(B)));for(var te=f(j),ce=f(B),oe=0;oe<$.length;++oe){var _e=$[oe];if(!s[_e]&&!(H&&H[_e])&&!(ce&&ce[_e])&&!(te&&te[_e])){var ne=w(B,_e);try{E(j,_e,ne)}catch{}}}}return j}return H2=V,H2}KRe();var qRe=!0;function VQ(n,t,s){var a="";return s.split(" ").forEach(function(l){n[l]!==void 0?t.push(n[l]+";"):l&&(a+=l+" ")}),a}var jV=function(t,s,a){var l=t.key+"-"+s.name;(a===!1||qRe===!1)&&t.registered[l]===void 0&&(t.registered[l]=s.styles)},BV=function(t,s,a){jV(t,s,a);var l=t.key+"-"+s.name;if(t.inserted[s.name]===void 0){var d=s;do t.insert(s===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function YRe(n){for(var t=0,s,a=0,l=n.length;l>=4;++a,l-=4)s=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,s=(s&65535)*1540483477+((s>>>16)*59797<<16),s^=s>>>24,t=(s&65535)*1540483477+((s>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(n.charCodeAt(a+2)&255)<<16;case 2:t^=(n.charCodeAt(a+1)&255)<<8;case 1:t^=n.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var XRe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},JRe=/[A-Z]|^ms/g,QRe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,FQ=function(t){return t.charCodeAt(1)===45},Z$=function(t){return t!=null&&typeof t!="boolean"},$2=MQ(function(n){return FQ(n)?n:n.replace(JRe,"-$&").toLowerCase()}),eK=function(t,s){switch(t){case"animation":case"animationName":if(typeof s=="string")return s.replace(QRe,function(a,l,d){return Lh={name:l,styles:d,next:Lh},l})}return XRe[t]!==1&&!FQ(t)&&typeof s=="number"&&s!==0?s+"px":s};function dR(n,t,s){if(s==null)return"";var a=s;if(a.__emotion_styles!==void 0)return a;switch(typeof s){case"boolean":return"";case"object":{var l=s;if(l.anim===1)return Lh={name:l.name,styles:l.styles,next:Lh},l.name;var d=s;if(d.styles!==void 0){var f=d.next;if(f!==void 0)for(;f!==void 0;)Lh={name:f.name,styles:f.styles,next:Lh},f=f.next;var E=d.styles+";";return E}return ZRe(n,t,s)}case"function":{if(n!==void 0){var v=Lh,b=s(n);return Lh=v,dR(n,t,b)}break}}var w=s;if(t==null)return w;var A=t[w];return A!==void 0?A:w}function ZRe(n,t,s){var a="";if(Array.isArray(s))for(var l=0;l<s.length;l++)a+=dR(n,t,s[l])+";";else for(var d in s){var f=s[d];if(typeof f!="object"){var E=f;t!=null&&t[E]!==void 0?a+=d+"{"+t[E]+"}":Z$(E)&&(a+=$2(d)+":"+eK(d,E)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(t==null||t[f[0]]===void 0))for(var v=0;v<f.length;v++)Z$(f[v])&&(a+=$2(d)+":"+eK(d,f[v])+";");else{var b=dR(n,t,f);switch(d){case"animation":case"animationName":{a+=$2(d)+":"+b+";";break}default:a+=d+"{"+b+"}"}}}return a}var tK=/label:\s*([^\s;{]+)\s*(;|$)/g,Lh;function Qk(n,t,s){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";Lh=void 0;var d=n[0];if(d==null||d.raw===void 0)a=!1,l+=dR(s,t,d);else{var f=d;l+=f[0]}for(var E=1;E<n.length;E++)if(l+=dR(s,t,n[E]),a){var v=d;l+=v[E]}tK.lastIndex=0;for(var b="",w;(w=tK.exec(l))!==null;)b+="-"+w[1];var A=YRe(l)+b;return{name:A,styles:l,next:Lh}}var eCe=function(t){return t()},jQ=d$.useInsertionEffect?d$.useInsertionEffect:!1,BQ=jQ||eCe,nK=jQ||D.useLayoutEffect,WV=D.createContext(typeof HTMLElement<"u"?GRe({key:"css"}):null);WV.Provider;var tCe=function(){return D.useContext(WV)},zV=function(t){return D.forwardRef(function(s,a){var l=D.useContext(WV);return t(s,l,a)})},t0=D.createContext({}),nCe=function(t,s){if(typeof s=="function"){var a=s(t);return a}return SE({},t,s)},rCe=q$(function(n){return q$(function(t){return nCe(n,t)})}),iCe=function(t){var s=D.useContext(t0);return t.theme!==s&&(s=rCe(s)(t.theme)),D.createElement(t0.Provider,{value:s},t.children)},GV={}.hasOwnProperty,rU="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",sCe=function(t,s){var a={};for(var l in s)GV.call(s,l)&&(a[l]=s[l]);return a[rU]=t,a},oCe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return jV(s,a,l),BQ(function(){return BV(s,a,l)}),null},aCe=zV(function(n,t,s){var a=n.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=n[rU],d=[a],f="";typeof n.className=="string"?f=VQ(t.registered,d,n.className):n.className!=null&&(f=n.className+" ");var E=Qk(d,void 0,D.useContext(t0));f+=t.key+"-"+E.name;var v={};for(var b in n)GV.call(n,b)&&b!=="css"&&b!==rU&&(v[b]=n[b]);return v.className=f,s&&(v.ref=s),D.createElement(D.Fragment,null,D.createElement(oCe,{cache:t,serialized:E,isStringTag:typeof l=="string"}),D.createElement(l,v))}),cCe=aCe,rK=function(t,s){var a=arguments;if(s==null||!GV.call(s,"css"))return D.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=cCe,d[1]=sCe(t,s);for(var f=2;f<l;f++)d[f]=a[f];return D.createElement.apply(null,d)};(function(n){var t;t||(t=n.JSX||(n.JSX={}))})(rK||(rK={}));var Zk=zV(function(n,t){var s=n.styles,a=Qk([s],void 0,D.useContext(t0)),l=D.useRef();return nK(function(){var d=t.key+"-global",f=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),E=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(f.before=t.sheet.tags[0]),v!==null&&(E=!0,v.setAttribute("data-emotion",d),f.hydrate([v])),l.current=[f,E],function(){f.flush()}},[t]),nK(function(){var d=l.current,f=d[0],E=d[1];if(E){d[1]=!1;return}if(a.next!==void 0&&BV(t,a.next,!0),f.tags.length){var v=f.tags[f.tags.length-1].nextElementSibling;f.before=v,f.flush()}t.insert("",a,f,!1)},[t,a.name]),null});function lCe(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return Qk(t)}function xR(){var n=lCe.apply(void 0,arguments),t="animation-"+n.name;return{name:t,styles:"@keyframes "+t+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const HV=D.createContext({});HV.displayName="ColorModeContext";function e1(){const n=D.useContext(HV);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function uCe(n,t){const{colorMode:s}=e1();return s==="dark"?t:n}const tO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function dCe(n={}){const{preventTransition:t=!0,nonce:s}=n,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?tO.dark:tO.light),document.body.classList.remove(l?tO.light:tO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),f=E=>{l(E.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(f):d.addEventListener("change",f),()=>{typeof d.removeListener=="function"?d.removeListener(f):d.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),s!==void 0&&(l.nonce=s),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const hCe="chakra-ui-color-mode";function pCe(n){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let s;try{s=localStorage.getItem(n)||t}catch{}return s||t},set(t){try{localStorage.setItem(n,t)}catch{}}}}const fCe=pCe(hCe),iK=()=>{},mCe=N_e()?D.useLayoutEffect:D.useEffect;function sK(n,t){return n.type==="cookie"&&n.ssr?n.get(t):t}const WQ=function(t){const{value:s,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:f}={},colorModeManager:E=fCe}=t,v=tCe(),b=d==="dark"?"dark":"light",[w,A]=D.useState(()=>sK(E,b)),[N,V]=D.useState(()=>sK(E)),{getSystemTheme:j,setClassName:B,setDataset:H,addListener:J}=D.useMemo(()=>dCe({preventTransition:f,nonce:v==null?void 0:v.nonce}),[f,v==null?void 0:v.nonce]),$=d==="system"&&!w?N:w,te=D.useCallback(_e=>{const ne=_e==="system"?j():_e;A(ne),B(ne==="dark"),H(ne),E.set(ne)},[E,j,B,H]);mCe(()=>{d==="system"&&V(j())},[]),D.useEffect(()=>{const _e=E.get();if(_e){te(_e);return}if(d==="system"){te("system");return}te(b)},[E,b,d,te]);const ce=D.useCallback(()=>{te($==="dark"?"light":"dark")},[$,te]);D.useEffect(()=>{if(l)return J(te)},[l,J,te]);const oe=D.useMemo(()=>({colorMode:s??$,toggleColorMode:s?iK:ce,setColorMode:s?iK:te,forced:s!==void 0}),[$,ce,te,s]);return C.jsx(HV.Provider,{value:oe,children:a})};WQ.displayName="ColorModeProvider";const zQ=String.raw,GQ=zQ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,gCe=()=>C.jsx(Zk,{styles:GQ}),_Ce=({scope:n=""})=>C.jsx(Zk,{styles:zQ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${GQ}
    `});function ECe(n){const{cssVarsRoot:t,theme:s,children:a}=n,l=D.useMemo(()=>ive(s),[s]);return C.jsxs(iCe,{theme:l,children:[C.jsx(yCe,{root:t}),a]})}function yCe({root:n=":host, :root"}){const t=[n,"[data-theme]"].join(",");return C.jsx(Zk,{styles:s=>({[t]:s.__cssVars})})}Li({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function vCe(){const{colorMode:n}=e1();return C.jsx(Zk,{styles:t=>{const s=QJ(t,"styles.global"),a=el(s,{theme:t,colorMode:n});return a?mQ(a)(t):void 0}})}const[SCe,bCe]=Li({strict:!1,name:"PortalManagerContext"});function $V(n){const{children:t,zIndex:s}=n;return C.jsx(SCe,{value:{zIndex:s},children:t})}$V.displayName="PortalManager";const KV=D.createContext({getDocument(){return document},getWindow(){return window}});KV.displayName="EnvironmentContext";function TCe({defer:n}={}){const[,t]=D.useReducer(s=>s+1,0);return yf(()=>{n&&t()},[n]),D.useContext(KV)}function HQ(n){const{children:t,environment:s,disabled:a}=n,l=D.useRef(null),d=D.useMemo(()=>s||{getDocument:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument)??document},getWindow:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument.defaultView)??window}},[s]),f=!a||!s;return C.jsxs(KV.Provider,{value:d,children:[t,f&&C.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}HQ.displayName="EnvironmentProvider";const wCe=n=>{const{children:t,colorModeManager:s,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:f={},environment:E,cssVarsRoot:v,disableEnvironment:b,disableGlobalStyle:w}=n,A=C.jsx(HQ,{environment:E,disabled:b,children:t});return C.jsx(ECe,{theme:f,cssVarsRoot:v,children:C.jsxs(WQ,{colorModeManager:s,options:f.config,children:[d?C.jsx(_Ce,{scope:l}):C.jsx(gCe,{}),!w&&C.jsx(vCe,{}),a?C.jsx($V,{zIndex:a,children:A}):A]})})},qV=D.createContext({});function YV(n){const t=D.useRef(null);return t.current===null&&(t.current=n()),t.current}const MR=D.createContext(null),XV=D.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class RCe extends D.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function CCe({children:n,isPresent:t}){const s=D.useId(),a=D.useRef(null),l=D.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=D.useContext(XV);return D.useInsertionEffect(()=>{const{width:f,height:E,top:v,left:b}=l.current;if(t||!a.current||!f||!E)return;a.current.dataset.motionPopId=s;const w=document.createElement("style");return d&&(w.nonce=d),document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${E}px !important;
            top: ${v}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[t]),C.jsx(RCe,{isPresent:t,childRef:a,sizeRef:l,children:D.cloneElement(n,{ref:a})})}const ICe=({children:n,initial:t,isPresent:s,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:f})=>{const E=YV(ACe),v=D.useId(),b=D.useCallback(A=>{E.set(A,!0);for(const N of E.values())if(!N)return;a&&a()},[E,a]),w=D.useMemo(()=>({id:v,initial:t,isPresent:s,custom:l,onExitComplete:b,register:A=>(E.set(A,!1),()=>E.delete(A))}),d?[Math.random(),b]:[s,b]);return D.useMemo(()=>{E.forEach((A,N)=>E.set(N,!1))},[s]),D.useEffect(()=>{!s&&!E.size&&a&&a()},[s]),f==="popLayout"&&(n=C.jsx(CCe,{isPresent:s,children:n})),C.jsx(MR.Provider,{value:w,children:n})};function ACe(){return new Map}function JV(n=!0){const t=D.useContext(MR);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:l}=t,d=D.useId();D.useEffect(()=>{n&&l(d)},[n]);const f=D.useCallback(()=>n&&a&&a(d),[d,a,n]);return!s&&a?[!1,f]:[!0]}function PCe(){return OCe(D.useContext(MR))}function OCe(n){return n===null?!0:n.isPresent}const nO=n=>n.key||"";function oK(n){const t=[];return D.Children.forEach(n,s=>{D.isValidElement(s)&&t.push(s)}),t}const QV=typeof window<"u",$Q=QV?D.useLayoutEffect:D.useEffect,w0=({children:n,custom:t,initial:s=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:f=!1})=>{const[E,v]=JV(f),b=D.useMemo(()=>oK(n),[n]),w=f&&!E?[]:b.map(nO),A=D.useRef(!0),N=D.useRef(b),V=YV(()=>new Map),[j,B]=D.useState(b),[H,J]=D.useState(b);$Q(()=>{A.current=!1,N.current=b;for(let ce=0;ce<H.length;ce++){const oe=nO(H[ce]);w.includes(oe)?V.delete(oe):V.get(oe)!==!0&&V.set(oe,!1)}},[H,w.length,w.join("-")]);const $=[];if(b!==j){let ce=[...b];for(let oe=0;oe<H.length;oe++){const _e=H[oe],ne=nO(_e);w.includes(ne)||(ce.splice(oe,0,_e),$.push(_e))}d==="wait"&&$.length&&(ce=$),J(oK(ce)),B(b);return}const{forceRender:te}=D.useContext(qV);return C.jsx(C.Fragment,{children:H.map(ce=>{const oe=nO(ce),_e=f&&!E?!1:b===H||w.includes(oe),ne=()=>{if(V.has(oe))V.set(oe,!0);else return;let ee=!0;V.forEach(Q=>{Q||(ee=!1)}),ee&&(te==null||te(),J(N.current),f&&(v==null||v()),a&&a())};return C.jsx(ICe,{isPresent:_e,initial:!A.current||s?void 0:!1,custom:_e?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:_e?void 0:ne,children:ce},oe)})})},Ml=n=>n;let KQ=Ml;function ZV(n){let t;return()=>(t===void 0&&(t=n()),t)}const n0=(n,t,s)=>{const a=t-n;return a===0?1:(s-n)/a},Sf=n=>n*1e3,bf=n=>n/1e3,kCe={useManualTiming:!1};function NCe(n){let t=new Set,s=new Set,a=!1,l=!1;const d=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function E(b){d.has(b)&&(v.schedule(b),n()),b(f)}const v={schedule:(b,w=!1,A=!1)=>{const V=A&&a?t:s;return w&&d.add(b),V.has(b)||V.add(b),b},cancel:b=>{s.delete(b),d.delete(b)},process:b=>{if(f=b,a){l=!0;return}a=!0,[t,s]=[s,t],t.forEach(E),t.clear(),a=!1,l&&(l=!1,v.process(b))}};return v}const rO=["read","resolveKeyframes","update","preRender","render","postRender"],DCe=40;function qQ(n,t){let s=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>s=!0,f=rO.reduce((J,$)=>(J[$]=NCe(d),J),{}),{read:E,resolveKeyframes:v,update:b,preRender:w,render:A,postRender:N}=f,V=()=>{const J=performance.now();s=!1,l.delta=a?1e3/60:Math.max(Math.min(J-l.timestamp,DCe),1),l.timestamp=J,l.isProcessing=!0,E.process(l),v.process(l),b.process(l),w.process(l),A.process(l),N.process(l),l.isProcessing=!1,s&&t&&(a=!1,n(V))},j=()=>{s=!0,a=!0,l.isProcessing||n(V)};return{schedule:rO.reduce((J,$)=>{const te=f[$];return J[$]=(ce,oe=!1,_e=!1)=>(s||j(),te.schedule(ce,oe,_e)),J},{}),cancel:J=>{for(let $=0;$<rO.length;$++)f[rO[$]].cancel(J)},state:l,steps:f}}const{schedule:qi,cancel:mg,state:ia,steps:K2}=qQ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ml,!0),YQ=D.createContext({strict:!1}),aK={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},r0={};for(const n in aK)r0[n]={isEnabled:t=>aK[n].some(s=>!!t[s])};function LCe(n){for(const t in n)r0[t]={...r0[t],...n[t]}}const xCe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ok(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||xCe.has(n)}let XQ=n=>!ok(n);function MCe(n){n&&(XQ=t=>t.startsWith("on")?!ok(t):n(t))}try{MCe(require("@emotion/is-prop-valid").default)}catch{}function UCe(n,t,s){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(XQ(l)||s===!0&&ok(l)||!t&&!ok(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function VCe(n){if(typeof Proxy>"u")return n;const t=new Map,s=(...a)=>n(...a);return new Proxy(s,{get:(a,l)=>l==="create"?n:(t.has(l)||t.set(l,n(l)),t.get(l))})}const t1=D.createContext({});function hR(n){return typeof n=="string"||Array.isArray(n)}function n1(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const eF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],tF=["initial",...eF];function r1(n){return n1(n.animate)||tF.some(t=>hR(n[t]))}function JQ(n){return!!(r1(n)||n.variants)}function FCe(n,t){if(r1(n)){const{initial:s,animate:a}=n;return{initial:s===!1||hR(s)?s:void 0,animate:hR(a)?a:void 0}}return n.inherit!==!1?t:{}}function jCe(n){const{initial:t,animate:s}=FCe(n,D.useContext(t1));return D.useMemo(()=>({initial:t,animate:s}),[cK(t),cK(s)])}function cK(n){return Array.isArray(n)?n.join(" "):n}const BCe=Symbol.for("motionComponentSymbol");function TS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function WCe(n,t,s){return D.useCallback(a=>{a&&n.onMount&&n.onMount(a),t&&(a?t.mount(a):t.unmount()),s&&(typeof s=="function"?s(a):TS(s)&&(s.current=a))},[t])}const nF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),zCe="framerAppearId",QQ="data-"+nF(zCe),{schedule:rF}=qQ(queueMicrotask,!1),ZQ=D.createContext({});function GCe(n,t,s,a,l){var d,f;const{visualElement:E}=D.useContext(t1),v=D.useContext(YQ),b=D.useContext(MR),w=D.useContext(XV).reducedMotion,A=D.useRef(null);a=a||v.renderer,!A.current&&a&&(A.current=a(n,{visualState:t,parent:E,props:s,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:w}));const N=A.current,V=D.useContext(ZQ);N&&!N.projection&&l&&(N.type==="html"||N.type==="svg")&&HCe(A.current,s,l,V);const j=D.useRef(!1);D.useInsertionEffect(()=>{N&&j.current&&N.update(s,b)});const B=s[QQ],H=D.useRef(!!B&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,B))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,B)));return $Q(()=>{N&&(j.current=!0,window.MotionIsMounted=!0,N.updateFeatures(),rF.render(N.render),H.current&&N.animationState&&N.animationState.animateChanges())}),D.useEffect(()=>{N&&(!H.current&&N.animationState&&N.animationState.animateChanges(),H.current&&(queueMicrotask(()=>{var J;(J=window.MotionHandoffMarkAsComplete)===null||J===void 0||J.call(window,B)}),H.current=!1))}),N}function HCe(n,t,s,a){const{layoutId:l,layout:d,drag:f,dragConstraints:E,layoutScroll:v,layoutRoot:b}=t;n.projection=new s(n.latestValues,t["data-framer-portal-id"]?void 0:eZ(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!f||E&&TS(E),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:b})}function eZ(n){if(n)return n.options.allowProjection!==!1?n.projection:eZ(n.parent)}function $Ce({preloadedFeatures:n,createVisualElement:t,useRender:s,useVisualState:a,Component:l}){var d,f;n&&LCe(n);function E(b,w){let A;const N={...D.useContext(XV),...b,layoutId:KCe(b)},{isStatic:V}=N,j=jCe(b),B=a(b,V);if(!V&&QV){qCe();const H=YCe(N);A=H.MeasureLayout,j.visualElement=GCe(l,B,N,t,H.ProjectionNode)}return C.jsxs(t1.Provider,{value:j,children:[A&&j.visualElement?C.jsx(A,{visualElement:j.visualElement,...N}):null,s(l,b,WCe(B,j.visualElement,w),B,V,j.visualElement)]})}E.displayName=`motion.${typeof l=="string"?l:`create(${(f=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&f!==void 0?f:""})`}`;const v=D.forwardRef(E);return v[BCe]=l,v}function KCe({layoutId:n}){const t=D.useContext(qV).id;return t&&n!==void 0?t+"-"+n:n}function qCe(n,t){D.useContext(YQ).strict}function YCe(n){const{drag:t,layout:s}=r0;if(!t&&!s)return{};const a={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(n)||s!=null&&s.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const XCe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function iF(n){return typeof n!="string"||n.includes("-")?!1:!!(XCe.indexOf(n)>-1||/[A-Z]/u.test(n))}function lK(n){const t=[{},{}];return n==null||n.values.forEach((s,a)=>{t[0][a]=s.get(),t[1][a]=s.getVelocity()}),t}function sF(n,t,s,a){if(typeof t=="function"){const[l,d]=lK(a);t=t(s!==void 0?s:n.custom,l,d)}if(typeof t=="string"&&(t=n.variants&&n.variants[t]),typeof t=="function"){const[l,d]=lK(a);t=t(s!==void 0?s:n.custom,l,d)}return t}const iU=n=>Array.isArray(n),JCe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),QCe=n=>iU(n)?n[n.length-1]||0:n,Ga=n=>!!(n&&n.getVelocity);function LO(n){const t=Ga(n)?n.get():n;return JCe(t)?t.toValue():t}function ZCe({scrapeMotionValuesFromProps:n,createRenderState:t,onUpdate:s},a,l,d){const f={latestValues:eIe(a,l,d,n),renderState:t()};return s&&(f.onMount=E=>s({props:a,current:E,...f}),f.onUpdate=E=>s(E)),f}const tZ=n=>(t,s)=>{const a=D.useContext(t1),l=D.useContext(MR),d=()=>ZCe(n,t,a,l);return s?d():YV(d)};function eIe(n,t,s,a){const l={},d=a(n,{});for(const N in d)l[N]=LO(d[N]);let{initial:f,animate:E}=n;const v=r1(n),b=JQ(n);t&&b&&!v&&n.inherit!==!1&&(f===void 0&&(f=t.initial),E===void 0&&(E=t.animate));let w=s?s.initial===!1:!1;w=w||f===!1;const A=w?E:f;if(A&&typeof A!="boolean"&&!n1(A)){const N=Array.isArray(A)?A:[A];for(let V=0;V<N.length;V++){const j=sF(n,N[V]);if(j){const{transitionEnd:B,transition:H,...J}=j;for(const $ in J){let te=J[$];if(Array.isArray(te)){const ce=w?te.length-1:0;te=te[ce]}te!==null&&(l[$]=te)}for(const $ in B)l[$]=B[$]}}}return l}const R0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],LE=new Set(R0),nZ=n=>t=>typeof t=="string"&&t.startsWith(n),rZ=nZ("--"),tIe=nZ("var(--"),oF=n=>tIe(n)?nIe.test(n.split("/*")[0].trim()):!1,nIe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,iZ=(n,t)=>t&&typeof n=="number"?t.transform(n):n,Pf=(n,t,s)=>s>t?t:s<n?n:s,C0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},pR={...C0,transform:n=>Pf(0,1,n)},iO={...C0,default:1},UR=n=>({test:t=>typeof t=="string"&&t.endsWith(n)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${n}`}),Xm=UR("deg"),Gh=UR("%"),Mn=UR("px"),rIe=UR("vh"),iIe=UR("vw"),uK={...Gh,parse:n=>Gh.parse(n)/100,transform:n=>Gh.transform(n*100)},sIe={borderWidth:Mn,borderTopWidth:Mn,borderRightWidth:Mn,borderBottomWidth:Mn,borderLeftWidth:Mn,borderRadius:Mn,radius:Mn,borderTopLeftRadius:Mn,borderTopRightRadius:Mn,borderBottomRightRadius:Mn,borderBottomLeftRadius:Mn,width:Mn,maxWidth:Mn,height:Mn,maxHeight:Mn,top:Mn,right:Mn,bottom:Mn,left:Mn,padding:Mn,paddingTop:Mn,paddingRight:Mn,paddingBottom:Mn,paddingLeft:Mn,margin:Mn,marginTop:Mn,marginRight:Mn,marginBottom:Mn,marginLeft:Mn,backgroundPositionX:Mn,backgroundPositionY:Mn},oIe={rotate:Xm,rotateX:Xm,rotateY:Xm,rotateZ:Xm,scale:iO,scaleX:iO,scaleY:iO,scaleZ:iO,skew:Xm,skewX:Xm,skewY:Xm,distance:Mn,translateX:Mn,translateY:Mn,translateZ:Mn,x:Mn,y:Mn,z:Mn,perspective:Mn,transformPerspective:Mn,opacity:pR,originX:uK,originY:uK,originZ:Mn},dK={...C0,transform:Math.round},aF={...sIe,...oIe,zIndex:dK,size:Mn,fillOpacity:pR,strokeOpacity:pR,numOctaves:dK},aIe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},cIe=R0.length;function lIe(n,t,s){let a="",l=!0;for(let d=0;d<cIe;d++){const f=R0[d],E=n[f];if(E===void 0)continue;let v=!0;if(typeof E=="number"?v=E===(f.startsWith("scale")?1:0):v=parseFloat(E)===0,!v||s){const b=iZ(E,aF[f]);if(!v){l=!1;const w=aIe[f]||f;a+=`${w}(${b}) `}s&&(t[f]=b)}}return a=a.trim(),s?a=s(t,l?"":a):l&&(a="none"),a}function cF(n,t,s){const{style:a,vars:l,transformOrigin:d}=n;let f=!1,E=!1;for(const v in t){const b=t[v];if(LE.has(v)){f=!0;continue}else if(rZ(v)){l[v]=b;continue}else{const w=iZ(b,aF[v]);v.startsWith("origin")?(E=!0,d[v]=w):a[v]=w}}if(t.transform||(f||s?a.transform=lIe(t,n.transform,s):a.transform&&(a.transform="none")),E){const{originX:v="50%",originY:b="50%",originZ:w=0}=d;a.transformOrigin=`${v} ${b} ${w}`}}const uIe={offset:"stroke-dashoffset",array:"stroke-dasharray"},dIe={offset:"strokeDashoffset",array:"strokeDasharray"};function hIe(n,t,s=1,a=0,l=!0){n.pathLength=1;const d=l?uIe:dIe;n[d.offset]=Mn.transform(-a);const f=Mn.transform(t),E=Mn.transform(s);n[d.array]=`${f} ${E}`}function hK(n,t,s){return typeof n=="string"?n:Mn.transform(t+s*n)}function pIe(n,t,s){const a=hK(t,n.x,n.width),l=hK(s,n.y,n.height);return`${a} ${l}`}function lF(n,{attrX:t,attrY:s,attrScale:a,originX:l,originY:d,pathLength:f,pathSpacing:E=1,pathOffset:v=0,...b},w,A){if(cF(n,b,A),w){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:N,style:V,dimensions:j}=n;N.transform&&(j&&(V.transform=N.transform),delete N.transform),j&&(l!==void 0||d!==void 0||V.transform)&&(V.transformOrigin=pIe(j,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(N.x=t),s!==void 0&&(N.y=s),a!==void 0&&(N.scale=a),f!==void 0&&hIe(N,f,E,v,!1)}const uF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),sZ=()=>({...uF(),attrs:{}}),dF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function oZ(n,{style:t,vars:s},a,l){Object.assign(n.style,t,l&&l.getProjectionStyles(a));for(const d in s)n.style.setProperty(d,s[d])}const aZ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function cZ(n,t,s,a){oZ(n,t,void 0,a);for(const l in t.attrs)n.setAttribute(aZ.has(l)?l:nF(l),t.attrs[l])}const ak={};function fIe(n){Object.assign(ak,n)}function lZ(n,{layout:t,layoutId:s}){return LE.has(n)||n.startsWith("origin")||(t||s!==void 0)&&(!!ak[n]||n==="opacity")}function hF(n,t,s){var a;const{style:l}=n,d={};for(const f in l)(Ga(l[f])||t.style&&Ga(t.style[f])||lZ(f,n)||((a=s==null?void 0:s.getValue(f))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[f]=l[f]);return d}function uZ(n,t,s){const a=hF(n,t,s);for(const l in n)if(Ga(n[l])||Ga(t[l])){const d=R0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=n[l]}return a}function mIe(n,t){try{t.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const pK=["x","y","width","height","cx","cy","r"],gIe={useVisualState:tZ({scrapeMotionValuesFromProps:uZ,createRenderState:sZ,onUpdate:({props:n,prevProps:t,current:s,renderState:a,latestValues:l})=>{if(!s)return;let d=!!n.drag;if(!d){for(const E in l)if(LE.has(E)){d=!0;break}}if(!d)return;let f=!t;if(t)for(let E=0;E<pK.length;E++){const v=pK[E];n[v]!==t[v]&&(f=!0)}f&&qi.read(()=>{mIe(s,a),qi.render(()=>{lF(a,l,dF(s.tagName),n.transformTemplate),cZ(s,a)})})}})},_Ie={useVisualState:tZ({scrapeMotionValuesFromProps:hF,createRenderState:uF})};function dZ(n,t,s){for(const a in t)!Ga(t[a])&&!lZ(a,s)&&(n[a]=t[a])}function EIe({transformTemplate:n},t){return D.useMemo(()=>{const s=uF();return cF(s,t,n),Object.assign({},s.vars,s.style)},[t])}function yIe(n,t){const s=n.style||{},a={};return dZ(a,s,n),Object.assign(a,EIe(n,t)),a}function vIe(n,t){const s={},a=yIe(n,t);return n.drag&&n.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(s.tabIndex=0),s.style=a,s}function SIe(n,t,s,a){const l=D.useMemo(()=>{const d=sZ();return lF(d,t,dF(a),n.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(n.style){const d={};dZ(d,n.style,n),l.style={...d,...l.style}}return l}function bIe(n=!1){return(s,a,l,{latestValues:d},f)=>{const v=(iF(s)?SIe:vIe)(a,d,f,s),b=UCe(a,typeof s=="string",n),w=s!==D.Fragment?{...b,...v,ref:l}:{},{children:A}=a,N=D.useMemo(()=>Ga(A)?A.get():A,[A]);return D.createElement(s,{...w,children:N})}}function TIe(n,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...iF(a)?gIe:_Ie,preloadedFeatures:n,useRender:bIe(l),createVisualElement:t,Component:a};return $Ce(f)}}function hZ(n,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==n.length)return!1;for(let a=0;a<s;a++)if(t[a]!==n[a])return!1;return!0}function i1(n,t,s){const a=n.getProps();return sF(a,t,s!==void 0?s:a.custom,n)}const wIe=ZV(()=>window.ScrollTimeline!==void 0);class RIe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t,s){const a=this.animations.map(l=>{if(wIe()&&l.attachTimeline)return l.attachTimeline(t);if(typeof s=="function")return s(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class CIe extends RIe{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function pF(n,t){return n?n[t]||n.default||n:void 0}const sU=2e4;function pZ(n){let t=0;const s=50;let a=n.next(t);for(;!a.done&&t<sU;)t+=s,a=n.next(t);return t>=sU?1/0:t}function fF(n){return typeof n=="function"}function fK(n,t){n.timeline=t,n.onfinish=null}const mF=n=>Array.isArray(n)&&typeof n[0]=="number",IIe={linearEasing:void 0};function AIe(n,t){const s=ZV(n);return()=>{var a;return(a=IIe[t])!==null&&a!==void 0?a:s()}}const ck=AIe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),fZ=(n,t,s=10)=>{let a="";const l=Math.max(Math.round(t/s),2);for(let d=0;d<l;d++)a+=n(n0(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function mZ(n){return!!(typeof n=="function"&&ck()||!n||typeof n=="string"&&(n in oU||ck())||mF(n)||Array.isArray(n)&&n.every(mZ))}const Cw=([n,t,s,a])=>`cubic-bezier(${n}, ${t}, ${s}, ${a})`,oU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Cw([0,.65,.55,1]),circOut:Cw([.55,0,1,.45]),backIn:Cw([.31,.01,.66,-.59]),backOut:Cw([.33,1.53,.69,.99])};function gZ(n,t){if(n)return typeof n=="function"&&ck()?fZ(n,t):mF(n)?Cw(n):Array.isArray(n)?n.map(s=>gZ(s,t)||oU.easeOut):oU[n]}const wd={x:!1,y:!1};function _Z(){return wd.x||wd.y}function PIe(n,t,s){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function EZ(n,t){const s=PIe(n),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[s,l,()=>a.abort()]}function mK(n){return t=>{t.pointerType==="touch"||_Z()||n(t)}}function OIe(n,t,s={}){const[a,l,d]=EZ(n,s),f=mK(E=>{const{target:v}=E,b=t(E);if(typeof b!="function"||!v)return;const w=mK(A=>{b(A),v.removeEventListener("pointerleave",w)});v.addEventListener("pointerleave",w,l)});return a.forEach(E=>{E.addEventListener("pointerenter",f,l)}),d}const yZ=(n,t)=>t?n===t?!0:yZ(n,t.parentElement):!1,gF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,kIe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function NIe(n){return kIe.has(n.tagName)||n.tabIndex!==-1}const Iw=new WeakSet;function gK(n){return t=>{t.key==="Enter"&&n(t)}}function q2(n,t){n.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const DIe=(n,t)=>{const s=n.currentTarget;if(!s)return;const a=gK(()=>{if(Iw.has(s))return;q2(s,"down");const l=gK(()=>{q2(s,"up")}),d=()=>q2(s,"cancel");s.addEventListener("keyup",l,t),s.addEventListener("blur",d,t)});s.addEventListener("keydown",a,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),t)};function _K(n){return gF(n)&&!_Z()}function LIe(n,t,s={}){const[a,l,d]=EZ(n,s),f=E=>{const v=E.currentTarget;if(!_K(E)||Iw.has(v))return;Iw.add(v);const b=t(E),w=(V,j)=>{window.removeEventListener("pointerup",A),window.removeEventListener("pointercancel",N),!(!_K(V)||!Iw.has(v))&&(Iw.delete(v),typeof b=="function"&&b(V,{success:j}))},A=V=>{w(V,s.useGlobalTarget||yZ(v,V.target))},N=V=>{w(V,!1)};window.addEventListener("pointerup",A,l),window.addEventListener("pointercancel",N,l)};return a.forEach(E=>{!NIe(E)&&E.getAttribute("tabindex")===null&&(E.tabIndex=0),(s.useGlobalTarget?window:E).addEventListener("pointerdown",f,l),E.addEventListener("focus",b=>DIe(b,l),l)}),d}function xIe(n){return n==="x"||n==="y"?wd[n]?null:(wd[n]=!0,()=>{wd[n]=!1}):wd.x||wd.y?null:(wd.x=wd.y=!0,()=>{wd.x=wd.y=!1})}const vZ=new Set(["width","height","top","left","right","bottom",...R0]);let xO;function MIe(){xO=void 0}const Hh={now:()=>(xO===void 0&&Hh.set(ia.isProcessing||kCe.useManualTiming?ia.timestamp:performance.now()),xO),set:n=>{xO=n,queueMicrotask(MIe)}};function _F(n,t){n.indexOf(t)===-1&&n.push(t)}function EF(n,t){const s=n.indexOf(t);s>-1&&n.splice(s,1)}class yF{constructor(){this.subscriptions=[]}add(t){return _F(this.subscriptions,t),()=>EF(this.subscriptions,t)}notify(t,s,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,s,a);else for(let d=0;d<l;d++){const f=this.subscriptions[d];f&&f(t,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function SZ(n,t){return t?n*(1e3/t):0}const EK=30,UIe=n=>!isNaN(parseFloat(n));class VIe{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Hh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=Hh.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=UIe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new yF);const a=this.events[t].add(s);return t==="change"?()=>{a(),qi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Hh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>EK)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,EK);return SZ(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function fR(n,t){return new VIe(n,t)}function FIe(n,t,s){n.hasValue(t)?n.getValue(t).set(s):n.addValue(t,fR(s))}function jIe(n,t){const s=i1(n,t);let{transitionEnd:a={},transition:l={},...d}=s||{};d={...d,...a};for(const f in d){const E=QCe(d[f]);FIe(n,f,E)}}function BIe(n){return!!(Ga(n)&&n.add)}function aU(n,t){const s=n.getValue("willChange");if(BIe(s))return s.add(t)}function bZ(n){return n.props[QQ]}const TZ=(n,t,s)=>(((1-3*s+3*t)*n+(3*s-6*t))*n+3*t)*n,WIe=1e-7,zIe=12;function GIe(n,t,s,a,l){let d,f,E=0;do f=t+(s-t)/2,d=TZ(f,a,l)-n,d>0?s=f:t=f;while(Math.abs(d)>WIe&&++E<zIe);return f}function VR(n,t,s,a){if(n===t&&s===a)return Ml;const l=d=>GIe(d,0,1,n,s);return d=>d===0||d===1?d:TZ(l(d),t,a)}const wZ=n=>t=>t<=.5?n(2*t)/2:(2-n(2*(1-t)))/2,RZ=n=>t=>1-n(1-t),CZ=VR(.33,1.53,.69,.99),vF=RZ(CZ),IZ=wZ(vF),AZ=n=>(n*=2)<1?.5*vF(n):.5*(2-Math.pow(2,-10*(n-1))),SF=n=>1-Math.sin(Math.acos(n)),PZ=RZ(SF),OZ=wZ(SF),kZ=n=>/^0[^.\s]+$/u.test(n);function HIe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||kZ(n):!0}const Gw=n=>Math.round(n*1e5)/1e5,bF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function $Ie(n){return n==null}const KIe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,TF=(n,t)=>s=>!!(typeof s=="string"&&KIe.test(s)&&s.startsWith(n)||t&&!$Ie(s)&&Object.prototype.hasOwnProperty.call(s,t)),NZ=(n,t,s)=>a=>{if(typeof a!="string")return a;const[l,d,f,E]=a.match(bF);return{[n]:parseFloat(l),[t]:parseFloat(d),[s]:parseFloat(f),alpha:E!==void 0?parseFloat(E):1}},qIe=n=>Pf(0,255,n),Y2={...C0,transform:n=>Math.round(qIe(n))},cE={test:TF("rgb","red"),parse:NZ("red","green","blue"),transform:({red:n,green:t,blue:s,alpha:a=1})=>"rgba("+Y2.transform(n)+", "+Y2.transform(t)+", "+Y2.transform(s)+", "+Gw(pR.transform(a))+")"};function YIe(n){let t="",s="",a="",l="";return n.length>5?(t=n.substring(1,3),s=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(t=n.substring(1,2),s=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),t+=t,s+=s,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const cU={test:TF("#"),parse:YIe,transform:cE.transform},wS={test:TF("hsl","hue"),parse:NZ("hue","saturation","lightness"),transform:({hue:n,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(n)+", "+Gh.transform(Gw(t))+", "+Gh.transform(Gw(s))+", "+Gw(pR.transform(a))+")"},ja={test:n=>cE.test(n)||cU.test(n)||wS.test(n),parse:n=>cE.test(n)?cE.parse(n):wS.test(n)?wS.parse(n):cU.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?cE.transform(n):wS.transform(n)},XIe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function JIe(n){var t,s;return isNaN(n)&&typeof n=="string"&&(((t=n.match(bF))===null||t===void 0?void 0:t.length)||0)+(((s=n.match(XIe))===null||s===void 0?void 0:s.length)||0)>0}const DZ="number",LZ="color",QIe="var",ZIe="var(",yK="${}",eAe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function mR(n){const t=n.toString(),s=[],a={color:[],number:[],var:[]},l=[];let d=0;const E=t.replace(eAe,v=>(ja.test(v)?(a.color.push(d),l.push(LZ),s.push(ja.parse(v))):v.startsWith(ZIe)?(a.var.push(d),l.push(QIe),s.push(v)):(a.number.push(d),l.push(DZ),s.push(parseFloat(v))),++d,yK)).split(yK);return{values:s,split:E,indexes:a,types:l}}function xZ(n){return mR(n).values}function MZ(n){const{split:t,types:s}=mR(n),a=t.length;return l=>{let d="";for(let f=0;f<a;f++)if(d+=t[f],l[f]!==void 0){const E=s[f];E===DZ?d+=Gw(l[f]):E===LZ?d+=ja.transform(l[f]):d+=l[f]}return d}}const tAe=n=>typeof n=="number"?0:n;function nAe(n){const t=xZ(n);return MZ(n)(t.map(tAe))}const gg={test:JIe,parse:xZ,createTransformer:MZ,getAnimatableNone:nAe},rAe=new Set(["brightness","contrast","saturate","opacity"]);function iAe(n){const[t,s]=n.slice(0,-1).split("(");if(t==="drop-shadow")return n;const[a]=s.match(bF)||[];if(!a)return n;const l=s.replace(a,"");let d=rAe.has(t)?1:0;return a!==s&&(d*=100),t+"("+d+l+")"}const sAe=/\b([a-z-]*)\(.*?\)/gu,lU={...gg,getAnimatableNone:n=>{const t=n.match(sAe);return t?t.map(iAe).join(" "):n}},oAe={...aF,color:ja,backgroundColor:ja,outlineColor:ja,fill:ja,stroke:ja,borderColor:ja,borderTopColor:ja,borderRightColor:ja,borderBottomColor:ja,borderLeftColor:ja,filter:lU,WebkitFilter:lU},wF=n=>oAe[n];function UZ(n,t){let s=wF(n);return s!==lU&&(s=gg),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const aAe=new Set(["auto","none","0"]);function cAe(n,t,s){let a=0,l;for(;a<n.length&&!l;){const d=n[a];typeof d=="string"&&!aAe.has(d)&&mR(d).values.length&&(l=n[a]),a++}if(l&&s)for(const d of t)n[d]=UZ(s,l)}const vK=n=>n===C0||n===Mn,SK=(n,t)=>parseFloat(n.split(", ")[t]),bK=(n,t)=>(s,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return SK(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?SK(d[1],n):0}},lAe=new Set(["x","y","z"]),uAe=R0.filter(n=>!lAe.has(n));function dAe(n){const t=[];return uAe.forEach(s=>{const a=n.getValue(s);a!==void 0&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),t}const i0={width:({x:n},{paddingLeft:t="0",paddingRight:s="0"})=>n.max-n.min-parseFloat(t)-parseFloat(s),height:({y:n},{paddingTop:t="0",paddingBottom:s="0"})=>n.max-n.min-parseFloat(t)-parseFloat(s),top:(n,{top:t})=>parseFloat(t),left:(n,{left:t})=>parseFloat(t),bottom:({y:n},{top:t})=>parseFloat(t)+(n.max-n.min),right:({x:n},{left:t})=>parseFloat(t)+(n.max-n.min),x:bK(4,13),y:bK(5,14)};i0.translateX=i0.x;i0.translateY=i0.y;const fE=new Set;let uU=!1,dU=!1;function VZ(){if(dU){const n=Array.from(fE).filter(a=>a.needsMeasurement),t=new Set(n.map(a=>a.element)),s=new Map;t.forEach(a=>{const l=dAe(a);l.length&&(s.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=s.get(a);l&&l.forEach(([d,f])=>{var E;(E=a.getValue(d))===null||E===void 0||E.set(f)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}dU=!1,uU=!1,fE.forEach(n=>n.complete()),fE.clear()}function FZ(){fE.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(dU=!0)})}function hAe(){FZ(),VZ()}class RF{constructor(t,s,a,l,d,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=a,this.motionValue=l,this.element=d,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(fE.add(this),uU||(uU=!0,qi.read(FZ),qi.resolveKeyframes(VZ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const f=l==null?void 0:l.get(),E=t[t.length-1];if(f!==void 0)t[0]=f;else if(a&&s){const v=a.readValue(s,E);v!=null&&(t[0]=v)}t[0]===void 0&&(t[0]=E),l&&f===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),fE.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,fE.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const jZ=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),pAe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function fAe(n){const t=pAe.exec(n);if(!t)return[,];const[,s,a,l]=t;return[`--${s??a}`,l]}function BZ(n,t,s=1){const[a,l]=fAe(n);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const f=d.trim();return jZ(f)?parseFloat(f):f}return oF(l)?BZ(l,t,s+1):l}const WZ=n=>t=>t.test(n),mAe={test:n=>n==="auto",parse:n=>n},zZ=[C0,Mn,Gh,Xm,iIe,rIe,mAe],TK=n=>zZ.find(WZ(n));class GZ extends RF{constructor(t,s,a,l,d){super(t,s,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let b=t[v];if(typeof b=="string"&&(b=b.trim(),oF(b))){const w=BZ(b,s.current);w!==void 0&&(t[v]=w),v===t.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!vZ.has(a)||t.length!==2)return;const[l,d]=t,f=TK(l),E=TK(d);if(f!==E)if(vK(f)&&vK(E))for(let v=0;v<t.length;v++){const b=t[v];typeof b=="string"&&(t[v]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,a=[];for(let l=0;l<t.length;l++)HIe(t[l])&&a.push(l);a.length&&cAe(t,a,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=i0[a](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const l=s[s.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:s,name:a,unresolvedKeyframes:l}=this;if(!s||!s.current)return;const d=s.getValue(a);d&&d.jump(this.measuredOrigin,!1);const f=l.length-1,E=l[f];l[f]=i0[a](s.measureViewportBox(),window.getComputedStyle(s.current)),E!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=E),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([v,b])=>{s.getValue(v).set(b)}),this.resolveNoneKeyframes()}}const wK=(n,t)=>t==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(gg.test(n)||n==="0")&&!n.startsWith("url("));function gAe(n){const t=n[0];if(n.length===1)return!0;for(let s=0;s<n.length;s++)if(n[s]!==t)return!0}function _Ae(n,t,s,a){const l=n[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=n[n.length-1],f=wK(l,t),E=wK(d,t);return!f||!E?!1:gAe(n)||(s==="spring"||fF(s))&&a}const EAe=n=>n!==null;function s1(n,{repeat:t,repeatType:s="loop"},a){const l=n.filter(EAe),d=t&&s!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const yAe=40;class HZ{constructor({autoplay:t=!0,delay:s=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:f="loop",...E}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Hh.now(),this.options={autoplay:t,delay:s,type:a,repeat:l,repeatDelay:d,repeatType:f,...E},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>yAe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&hAe(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=Hh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:f,onComplete:E,onUpdate:v,isGenerator:b}=this.options;if(!b&&!_Ae(t,a,l,d))if(f)this.options.duration=0;else{v&&v(s1(t,this.options,s)),E&&E(),this.resolveFinishedPromise();return}const w=this.initPlayback(t,s);w!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...w},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const hs=(n,t,s)=>n+(t-n)*s;function X2(n,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?n+(t-n)*6*s:s<1/2?t:s<2/3?n+(t-n)*(2/3-s)*6:n}function vAe({hue:n,saturation:t,lightness:s,alpha:a}){n/=360,t/=100,s/=100;let l=0,d=0,f=0;if(!t)l=d=f=s;else{const E=s<.5?s*(1+t):s+t-s*t,v=2*s-E;l=X2(v,E,n+1/3),d=X2(v,E,n),f=X2(v,E,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(f*255),alpha:a}}function lk(n,t){return s=>s>0?t:n}const J2=(n,t,s)=>{const a=n*n,l=s*(t*t-a)+a;return l<0?0:Math.sqrt(l)},SAe=[cU,cE,wS],bAe=n=>SAe.find(t=>t.test(n));function RK(n){const t=bAe(n);if(!t)return!1;let s=t.parse(n);return t===wS&&(s=vAe(s)),s}const CK=(n,t)=>{const s=RK(n),a=RK(t);if(!s||!a)return lk(n,t);const l={...s};return d=>(l.red=J2(s.red,a.red,d),l.green=J2(s.green,a.green,d),l.blue=J2(s.blue,a.blue,d),l.alpha=hs(s.alpha,a.alpha,d),cE.transform(l))},TAe=(n,t)=>s=>t(n(s)),FR=(...n)=>n.reduce(TAe),hU=new Set(["none","hidden"]);function wAe(n,t){return hU.has(n)?s=>s<=0?n:t:s=>s>=1?t:n}function RAe(n,t){return s=>hs(n,t,s)}function CF(n){return typeof n=="number"?RAe:typeof n=="string"?oF(n)?lk:ja.test(n)?CK:AAe:Array.isArray(n)?$Z:typeof n=="object"?ja.test(n)?CK:CAe:lk}function $Z(n,t){const s=[...n],a=s.length,l=n.map((d,f)=>CF(d)(d,t[f]));return d=>{for(let f=0;f<a;f++)s[f]=l[f](d);return s}}function CAe(n,t){const s={...n,...t},a={};for(const l in s)n[l]!==void 0&&t[l]!==void 0&&(a[l]=CF(n[l])(n[l],t[l]));return l=>{for(const d in a)s[d]=a[d](l);return s}}function IAe(n,t){var s;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const f=t.types[d],E=n.indexes[f][l[f]],v=(s=n.values[E])!==null&&s!==void 0?s:0;a[d]=v,l[f]++}return a}const AAe=(n,t)=>{const s=gg.createTransformer(t),a=mR(n),l=mR(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?hU.has(n)&&!l.values.length||hU.has(t)&&!a.values.length?wAe(n,t):FR($Z(IAe(a,l),l.values),s):lk(n,t)};function KZ(n,t,s){return typeof n=="number"&&typeof t=="number"&&typeof s=="number"?hs(n,t,s):CF(n)(n,t)}const PAe=5;function qZ(n,t,s){const a=Math.max(t-PAe,0);return SZ(s-n(a),t-a)}const ks={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},IK=.001;function OAe({duration:n=ks.duration,bounce:t=ks.bounce,velocity:s=ks.velocity,mass:a=ks.mass}){let l,d,f=1-t;f=Pf(ks.minDamping,ks.maxDamping,f),n=Pf(ks.minDuration,ks.maxDuration,bf(n)),f<1?(l=b=>{const w=b*f,A=w*n,N=w-s,V=pU(b,f),j=Math.exp(-A);return IK-N/V*j},d=b=>{const A=b*f*n,N=A*s+s,V=Math.pow(f,2)*Math.pow(b,2)*n,j=Math.exp(-A),B=pU(Math.pow(b,2),f);return(-l(b)+IK>0?-1:1)*((N-V)*j)/B}):(l=b=>{const w=Math.exp(-b*n),A=(b-s)*n+1;return-.001+w*A},d=b=>{const w=Math.exp(-b*n),A=(s-b)*(n*n);return w*A});const E=5/n,v=NAe(l,d,E);if(n=Sf(n),isNaN(v))return{stiffness:ks.stiffness,damping:ks.damping,duration:n};{const b=Math.pow(v,2)*a;return{stiffness:b,damping:f*2*Math.sqrt(a*b),duration:n}}}const kAe=12;function NAe(n,t,s){let a=s;for(let l=1;l<kAe;l++)a=a-n(a)/t(a);return a}function pU(n,t){return n*Math.sqrt(1-t*t)}const DAe=["duration","bounce"],LAe=["stiffness","damping","mass"];function AK(n,t){return t.some(s=>n[s]!==void 0)}function xAe(n){let t={velocity:ks.velocity,stiffness:ks.stiffness,damping:ks.damping,mass:ks.mass,isResolvedFromDuration:!1,...n};if(!AK(n,LAe)&&AK(n,DAe))if(n.visualDuration){const s=n.visualDuration,a=2*Math.PI/(s*1.2),l=a*a,d=2*Pf(.05,1,1-(n.bounce||0))*Math.sqrt(l);t={...t,mass:ks.mass,stiffness:l,damping:d}}else{const s=OAe(n);t={...t,...s,mass:ks.mass},t.isResolvedFromDuration=!0}return t}function YZ(n=ks.visualDuration,t=ks.bounce){const s=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:t}:n;let{restSpeed:a,restDelta:l}=s;const d=s.keyframes[0],f=s.keyframes[s.keyframes.length-1],E={done:!1,value:d},{stiffness:v,damping:b,mass:w,duration:A,velocity:N,isResolvedFromDuration:V}=xAe({...s,velocity:-bf(s.velocity||0)}),j=N||0,B=b/(2*Math.sqrt(v*w)),H=f-d,J=bf(Math.sqrt(v/w)),$=Math.abs(H)<5;a||(a=$?ks.restSpeed.granular:ks.restSpeed.default),l||(l=$?ks.restDelta.granular:ks.restDelta.default);let te;if(B<1){const oe=pU(J,B);te=_e=>{const ne=Math.exp(-B*J*_e);return f-ne*((j+B*J*H)/oe*Math.sin(oe*_e)+H*Math.cos(oe*_e))}}else if(B===1)te=oe=>f-Math.exp(-J*oe)*(H+(j+J*H)*oe);else{const oe=J*Math.sqrt(B*B-1);te=_e=>{const ne=Math.exp(-B*J*_e),ee=Math.min(oe*_e,300);return f-ne*((j+B*J*H)*Math.sinh(ee)+oe*H*Math.cosh(ee))/oe}}const ce={calculatedDuration:V&&A||null,next:oe=>{const _e=te(oe);if(V)E.done=oe>=A;else{let ne=0;B<1&&(ne=oe===0?Sf(j):qZ(te,oe,_e));const ee=Math.abs(ne)<=a,Q=Math.abs(f-_e)<=l;E.done=ee&&Q}return E.value=E.done?f:_e,E},toString:()=>{const oe=Math.min(pZ(ce),sU),_e=fZ(ne=>ce.next(oe*ne).value,oe,30);return oe+"ms "+_e}};return ce}function PK({keyframes:n,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:f,min:E,max:v,restDelta:b=.5,restSpeed:w}){const A=n[0],N={done:!1,value:A},V=ee=>E!==void 0&&ee<E||v!==void 0&&ee>v,j=ee=>E===void 0?v:v===void 0||Math.abs(E-ee)<Math.abs(v-ee)?E:v;let B=s*t;const H=A+B,J=f===void 0?H:f(H);J!==H&&(B=J-A);const $=ee=>-B*Math.exp(-ee/a),te=ee=>J+$(ee),ce=ee=>{const Q=$(ee),se=te(ee);N.done=Math.abs(Q)<=b,N.value=N.done?J:se};let oe,_e;const ne=ee=>{V(N.value)&&(oe=ee,_e=YZ({keyframes:[N.value,j(N.value)],velocity:qZ(te,ee,N.value),damping:l,stiffness:d,restDelta:b,restSpeed:w}))};return ne(0),{calculatedDuration:null,next:ee=>{let Q=!1;return!_e&&oe===void 0&&(Q=!0,ce(ee),ne(ee)),oe!==void 0&&ee>=oe?_e.next(ee-oe):(!Q&&ce(ee),N)}}}const MAe=VR(.42,0,1,1),UAe=VR(0,0,.58,1),XZ=VR(.42,0,.58,1),VAe=n=>Array.isArray(n)&&typeof n[0]!="number",FAe={linear:Ml,easeIn:MAe,easeInOut:XZ,easeOut:UAe,circIn:SF,circInOut:OZ,circOut:PZ,backIn:vF,backInOut:IZ,backOut:CZ,anticipate:AZ},OK=n=>{if(mF(n)){KQ(n.length===4);const[t,s,a,l]=n;return VR(t,s,a,l)}else if(typeof n=="string")return FAe[n];return n};function jAe(n,t,s){const a=[],l=s||KZ,d=n.length-1;for(let f=0;f<d;f++){let E=l(n[f],n[f+1]);if(t){const v=Array.isArray(t)?t[f]||Ml:t;E=FR(v,E)}a.push(E)}return a}function BAe(n,t,{clamp:s=!0,ease:a,mixer:l}={}){const d=n.length;if(KQ(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const f=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),t=[...t].reverse());const E=jAe(t,a,l),v=E.length,b=w=>{if(f&&w<n[0])return t[0];let A=0;if(v>1)for(;A<n.length-2&&!(w<n[A+1]);A++);const N=n0(n[A],n[A+1],w);return E[A](N)};return s?w=>b(Pf(n[0],n[d-1],w)):b}function WAe(n,t){const s=n[n.length-1];for(let a=1;a<=t;a++){const l=n0(0,t,a);n.push(hs(s,1,l))}}function zAe(n){const t=[0];return WAe(t,n.length-1),t}function GAe(n,t){return n.map(s=>s*t)}function HAe(n,t){return n.map(()=>t||XZ).splice(0,n.length-1)}function uk({duration:n=300,keyframes:t,times:s,ease:a="easeInOut"}){const l=VAe(a)?a.map(OK):OK(a),d={done:!1,value:t[0]},f=GAe(s&&s.length===t.length?s:zAe(t),n),E=BAe(f,t,{ease:Array.isArray(l)?l:HAe(t,l)});return{calculatedDuration:n,next:v=>(d.value=E(v),d.done=v>=n,d)}}const $Ae=n=>{const t=({timestamp:s})=>n(s);return{start:()=>qi.update(t,!0),stop:()=>mg(t),now:()=>ia.isProcessing?ia.timestamp:Hh.now()}},KAe={decay:PK,inertia:PK,tween:uk,keyframes:uk,spring:YZ},qAe=n=>n/100;class IF extends HZ{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:s,motionValue:a,element:l,keyframes:d}=this.options,f=(l==null?void 0:l.KeyframeResolver)||RF,E=(v,b)=>this.onKeyframesResolved(v,b);this.resolver=new f(d,E,s,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:f=0}=this.options,E=fF(s)?s:KAe[s]||uk;let v,b;E!==uk&&typeof t[0]!="number"&&(v=FR(qAe,KZ(t[0],t[1])),t=[0,100]);const w=E({...this.options,keyframes:t});d==="mirror"&&(b=E({...this.options,keyframes:[...t].reverse(),velocity:-f})),w.calculatedDuration===null&&(w.calculatedDuration=pZ(w));const{calculatedDuration:A}=w,N=A+l,V=N*(a+1)-l;return{generator:w,mirroredGenerator:b,mapPercentToKeyframes:v,calculatedDuration:A,resolvedDuration:N,totalDuration:V}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:a}=this;if(!a){const{keyframes:ee}=this.options;return{done:!0,value:ee[ee.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:f,mapPercentToKeyframes:E,keyframes:v,calculatedDuration:b,totalDuration:w,resolvedDuration:A}=a;if(this.startTime===null)return d.next(0);const{delay:N,repeat:V,repeatType:j,repeatDelay:B,onUpdate:H}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-w/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const J=this.currentTime-N*(this.speed>=0?1:-1),$=this.speed>=0?J<0:J>w;this.currentTime=Math.max(J,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=w);let te=this.currentTime,ce=d;if(V){const ee=Math.min(this.currentTime,w)/A;let Q=Math.floor(ee),se=ee%1;!se&&ee>=1&&(se=1),se===1&&Q--,Q=Math.min(Q,V+1),!!(Q%2)&&(j==="reverse"?(se=1-se,B&&(se-=B/A)):j==="mirror"&&(ce=f)),te=Pf(0,1,se)*A}const oe=$?{done:!1,value:v[0]}:ce.next(te);E&&(oe.value=E(oe.value));let{done:_e}=oe;!$&&b!==null&&(_e=this.speed>=0?this.currentTime>=w:this.currentTime<=0);const ne=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&_e);return ne&&l!==void 0&&(oe.value=s1(v,this.options,l)),H&&H(oe.value),ne&&this.finish(),oe}get duration(){const{resolved:t}=this;return t?bf(t.calculatedDuration):0}get time(){return bf(this.currentTime)}set time(t){t=Sf(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=bf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=$Ae,onPlay:s,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),s&&s();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const YAe=new Set(["opacity","clipPath","filter","transform"]);function XAe(n,t,s,{delay:a=0,duration:l=300,repeat:d=0,repeatType:f="loop",ease:E="easeInOut",times:v}={}){const b={[t]:s};v&&(b.offset=v);const w=gZ(E,l);return Array.isArray(w)&&(b.easing=w),n.animate(b,{delay:a,duration:l,easing:Array.isArray(w)?"linear":w,fill:"both",iterations:d+1,direction:f==="reverse"?"alternate":"normal"})}const JAe=ZV(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),dk=10,QAe=2e4;function ZAe(n){return fF(n.type)||n.type==="spring"||!mZ(n.ease)}function ePe(n,t){const s=new IF({...t,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let d=0;for(;!a.done&&d<QAe;)a=s.sample(d),l.push(a.value),d+=dk;return{times:void 0,keyframes:l,duration:d-dk,ease:"linear"}}const JZ={anticipate:AZ,backInOut:IZ,circInOut:OZ};function tPe(n){return n in JZ}class kK extends HZ{constructor(t){super(t);const{name:s,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new GZ(d,(f,E)=>this.onKeyframesResolved(f,E),s,a,l),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:a=300,times:l,ease:d,type:f,motionValue:E,name:v,startTime:b}=this.options;if(!E.owner||!E.owner.current)return!1;if(typeof d=="string"&&ck()&&tPe(d)&&(d=JZ[d]),ZAe(this.options)){const{onComplete:A,onUpdate:N,motionValue:V,element:j,...B}=this.options,H=ePe(t,B);t=H.keyframes,t.length===1&&(t[1]=t[0]),a=H.duration,l=H.times,d=H.ease,f="keyframes"}const w=XAe(E.owner.current,v,t,{...this.options,duration:a,times:l,ease:d});return w.startTime=b??this.calcStartTime(),this.pendingTimeline?(fK(w,this.pendingTimeline),this.pendingTimeline=void 0):w.onfinish=()=>{const{onComplete:A}=this.options;E.set(s1(t,this.options,s)),A&&A(),this.cancel(),this.resolveFinishedPromise()},{animation:w,duration:a,times:l,type:f,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return bf(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return bf(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.currentTime=Sf(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return Ml;const{animation:a}=s;fK(a,t)}return Ml}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:a,duration:l,type:d,ease:f,times:E}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:w,onComplete:A,element:N,...V}=this.options,j=new IF({...V,keyframes:a,duration:l,type:d,ease:f,times:E,isGenerator:!0}),B=Sf(this.time);b.setWithVelocity(j.sample(B-dk).value,j.sample(B).value,dk)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:a,repeatDelay:l,repeatType:d,damping:f,type:E}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:b}=s.owner.getProps();return JAe()&&a&&YAe.has(a)&&!v&&!b&&!l&&d!=="mirror"&&f!==0&&E!=="inertia"}}const nPe={type:"spring",stiffness:500,damping:25,restSpeed:10},rPe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),iPe={type:"keyframes",duration:.8},sPe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},oPe=(n,{keyframes:t})=>t.length>2?iPe:LE.has(n)?n.startsWith("scale")?rPe(t[1]):nPe:sPe;function aPe({when:n,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:f,repeatDelay:E,from:v,elapsed:b,...w}){return!!Object.keys(w).length}const AF=(n,t,s,a={},l,d)=>f=>{const E=pF(a,n)||{},v=E.delay||a.delay||0;let{elapsed:b=0}=a;b=b-Sf(v);let w={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...E,delay:-b,onUpdate:N=>{t.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{f(),E.onComplete&&E.onComplete()},name:n,motionValue:t,element:d?void 0:l};aPe(E)||(w={...w,...oPe(n,w)}),w.duration&&(w.duration=Sf(w.duration)),w.repeatDelay&&(w.repeatDelay=Sf(w.repeatDelay)),w.from!==void 0&&(w.keyframes[0]=w.from);let A=!1;if((w.type===!1||w.duration===0&&!w.repeatDelay)&&(w.duration=0,w.delay===0&&(A=!0)),A&&!d&&t.get()!==void 0){const N=s1(w.keyframes,E);if(N!==void 0)return qi.update(()=>{w.onUpdate(N),w.onComplete()}),new CIe([])}return!d&&kK.supports(w)?new kK(w):new IF(w)};function cPe({protectedKeys:n,needsAnimating:t},s){const a=n.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,a}function QZ(n,t,{delay:s=0,transitionOverride:a,type:l}={}){var d;let{transition:f=n.getDefaultTransition(),transitionEnd:E,...v}=t;a&&(f=a);const b=[],w=l&&n.animationState&&n.animationState.getState()[l];for(const A in v){const N=n.getValue(A,(d=n.latestValues[A])!==null&&d!==void 0?d:null),V=v[A];if(V===void 0||w&&cPe(w,A))continue;const j={delay:s,...pF(f||{},A)};let B=!1;if(window.MotionHandoffAnimation){const J=bZ(n);if(J){const $=window.MotionHandoffAnimation(J,A,qi);$!==null&&(j.startTime=$,B=!0)}}aU(n,A),N.start(AF(A,N,V,n.shouldReduceMotion&&vZ.has(A)?{type:!1}:j,n,B));const H=N.animation;H&&b.push(H)}return E&&Promise.all(b).then(()=>{qi.update(()=>{E&&jIe(n,E)})}),b}function fU(n,t,s={}){var a;const l=i1(n,t,s.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};s.transitionOverride&&(d=s.transitionOverride);const f=l?()=>Promise.all(QZ(n,l,s)):()=>Promise.resolve(),E=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:w=0,staggerChildren:A,staggerDirection:N}=d;return lPe(n,t,w+b,A,N,s)}:()=>Promise.resolve(),{when:v}=d;if(v){const[b,w]=v==="beforeChildren"?[f,E]:[E,f];return b().then(()=>w())}else return Promise.all([f(),E(s.delay)])}function lPe(n,t,s=0,a=0,l=1,d){const f=[],E=(n.variantChildren.size-1)*a,v=l===1?(b=0)=>b*a:(b=0)=>E-b*a;return Array.from(n.variantChildren).sort(uPe).forEach((b,w)=>{b.notify("AnimationStart",t),f.push(fU(b,t,{...d,delay:s+v(w)}).then(()=>b.notify("AnimationComplete",t)))}),Promise.all(f)}function uPe(n,t){return n.sortNodePosition(t)}function dPe(n,t,s={}){n.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>fU(n,d,s));a=Promise.all(l)}else if(typeof t=="string")a=fU(n,t,s);else{const l=typeof t=="function"?i1(n,t,s.custom):t;a=Promise.all(QZ(n,l,s))}return a.then(()=>{n.notify("AnimationComplete",t)})}const hPe=tF.length;function ZZ(n){if(!n)return;if(!n.isControllingVariants){const s=n.parent?ZZ(n.parent)||{}:{};return n.props.initial!==void 0&&(s.initial=n.props.initial),s}const t={};for(let s=0;s<hPe;s++){const a=tF[s],l=n.props[a];(hR(l)||l===!1)&&(t[a]=l)}return t}const pPe=[...eF].reverse(),fPe=eF.length;function mPe(n){return t=>Promise.all(t.map(({animation:s,options:a})=>dPe(n,s,a)))}function gPe(n){let t=mPe(n),s=NK(),a=!0;const l=v=>(b,w)=>{var A;const N=i1(n,w,v==="exit"?(A=n.presenceContext)===null||A===void 0?void 0:A.custom:void 0);if(N){const{transition:V,transitionEnd:j,...B}=N;b={...b,...B,...j}}return b};function d(v){t=v(n)}function f(v){const{props:b}=n,w=ZZ(n.parent)||{},A=[],N=new Set;let V={},j=1/0;for(let H=0;H<fPe;H++){const J=pPe[H],$=s[J],te=b[J]!==void 0?b[J]:w[J],ce=hR(te),oe=J===v?$.isActive:null;oe===!1&&(j=H);let _e=te===w[J]&&te!==b[J]&&ce;if(_e&&a&&n.manuallyAnimateOnMount&&(_e=!1),$.protectedKeys={...V},!$.isActive&&oe===null||!te&&!$.prevProp||n1(te)||typeof te=="boolean")continue;const ne=_Pe($.prevProp,te);let ee=ne||J===v&&$.isActive&&!_e&&ce||H>j&&ce,Q=!1;const se=Array.isArray(te)?te:[te];let pe=se.reduce(l(J),{});oe===!1&&(pe={});const{prevResolvedValues:fe={}}=$,ue={...fe,...pe},Me=we=>{ee=!0,N.has(we)&&(Q=!0,N.delete(we)),$.needsAnimating[we]=!0;const Ce=n.getValue(we);Ce&&(Ce.liveStyle=!1)};for(const we in ue){const Ce=pe[we],ve=fe[we];if(V.hasOwnProperty(we))continue;let Ne=!1;iU(Ce)&&iU(ve)?Ne=!hZ(Ce,ve):Ne=Ce!==ve,Ne?Ce!=null?Me(we):N.add(we):Ce!==void 0&&N.has(we)?Me(we):$.protectedKeys[we]=!0}$.prevProp=te,$.prevResolvedValues=pe,$.isActive&&(V={...V,...pe}),a&&n.blockInitialAnimation&&(ee=!1),ee&&(!(_e&&ne)||Q)&&A.push(...se.map(we=>({animation:we,options:{type:J}})))}if(N.size){const H={};N.forEach(J=>{const $=n.getBaseTarget(J),te=n.getValue(J);te&&(te.liveStyle=!0),H[J]=$??null}),A.push({animation:H})}let B=!!A.length;return a&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(B=!1),a=!1,B?t(A):Promise.resolve()}function E(v,b){var w;if(s[v].isActive===b)return Promise.resolve();(w=n.variantChildren)===null||w===void 0||w.forEach(N=>{var V;return(V=N.animationState)===null||V===void 0?void 0:V.setActive(v,b)}),s[v].isActive=b;const A=f(v);for(const N in s)s[N].protectedKeys={};return A}return{animateChanges:f,setActive:E,setAnimateFunction:d,getState:()=>s,reset:()=>{s=NK(),a=!0}}}function _Pe(n,t){return typeof t=="string"?t!==n:Array.isArray(t)?!hZ(t,n):!1}function Z_(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function NK(){return{animate:Z_(!0),whileInView:Z_(),whileHover:Z_(),whileTap:Z_(),whileDrag:Z_(),whileFocus:Z_(),exit:Z_()}}class Rg{constructor(t){this.isMounted=!1,this.node=t}update(){}}class EPe extends Rg{constructor(t){super(t),t.animationState||(t.animationState=gPe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();n1(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let yPe=0;class vPe extends Rg{constructor(){super(...arguments),this.id=yPe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);s&&!t&&l.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const SPe={animation:{Feature:EPe},exit:{Feature:vPe}};function gR(n,t,s,a={passive:!0}){return n.addEventListener(t,s,a),()=>n.removeEventListener(t,s)}function jR(n){return{point:{x:n.pageX,y:n.pageY}}}const bPe=n=>t=>gF(t)&&n(t,jR(t));function Hw(n,t,s,a){return gR(n,t,bPe(s),a)}const DK=(n,t)=>Math.abs(n-t);function TPe(n,t){const s=DK(n.x,t.x),a=DK(n.y,t.y);return Math.sqrt(s**2+a**2)}class eee{constructor(t,s,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const A=Z2(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,V=TPe(A.offset,{x:0,y:0})>=3;if(!N&&!V)return;const{point:j}=A,{timestamp:B}=ia;this.history.push({...j,timestamp:B});const{onStart:H,onMove:J}=this.handlers;N||(H&&H(this.lastMoveEvent,A),this.startEvent=this.lastMoveEvent),J&&J(this.lastMoveEvent,A)},this.handlePointerMove=(A,N)=>{this.lastMoveEvent=A,this.lastMoveEventInfo=Q2(N,this.transformPagePoint),qi.update(this.updatePoint,!0)},this.handlePointerUp=(A,N)=>{this.end();const{onEnd:V,onSessionEnd:j,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const H=Z2(A.type==="pointercancel"?this.lastMoveEventInfo:Q2(N,this.transformPagePoint),this.history);this.startEvent&&V&&V(A,H),j&&j(A,H)},!gF(t))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=a,this.contextWindow=l||window;const f=jR(t),E=Q2(f,this.transformPagePoint),{point:v}=E,{timestamp:b}=ia;this.history=[{...v,timestamp:b}];const{onSessionStart:w}=s;w&&w(t,Z2(E,this.history)),this.removeListeners=FR(Hw(this.contextWindow,"pointermove",this.handlePointerMove),Hw(this.contextWindow,"pointerup",this.handlePointerUp),Hw(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),mg(this.updatePoint)}}function Q2(n,t){return t?{point:t(n.point)}:n}function LK(n,t){return{x:n.x-t.x,y:n.y-t.y}}function Z2({point:n},t){return{point:n,delta:LK(n,tee(t)),offset:LK(n,wPe(t)),velocity:RPe(t,.1)}}function wPe(n){return n[0]}function tee(n){return n[n.length-1]}function RPe(n,t){if(n.length<2)return{x:0,y:0};let s=n.length-1,a=null;const l=tee(n);for(;s>=0&&(a=n[s],!(l.timestamp-a.timestamp>Sf(t)));)s--;if(!a)return{x:0,y:0};const d=bf(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const nee=1e-4,CPe=1-nee,IPe=1+nee,ree=.01,APe=0-ree,PPe=0+ree;function Ul(n){return n.max-n.min}function OPe(n,t,s){return Math.abs(n-t)<=s}function xK(n,t,s,a=.5){n.origin=a,n.originPoint=hs(t.min,t.max,n.origin),n.scale=Ul(s)/Ul(t),n.translate=hs(s.min,s.max,n.origin)-n.originPoint,(n.scale>=CPe&&n.scale<=IPe||isNaN(n.scale))&&(n.scale=1),(n.translate>=APe&&n.translate<=PPe||isNaN(n.translate))&&(n.translate=0)}function $w(n,t,s,a){xK(n.x,t.x,s.x,a?a.originX:void 0),xK(n.y,t.y,s.y,a?a.originY:void 0)}function MK(n,t,s){n.min=s.min+t.min,n.max=n.min+Ul(t)}function kPe(n,t,s){MK(n.x,t.x,s.x),MK(n.y,t.y,s.y)}function UK(n,t,s){n.min=t.min-s.min,n.max=n.min+Ul(t)}function Kw(n,t,s){UK(n.x,t.x,s.x),UK(n.y,t.y,s.y)}function NPe(n,{min:t,max:s},a){return t!==void 0&&n<t?n=a?hs(t,n,a.min):Math.max(n,t):s!==void 0&&n>s&&(n=a?hs(s,n,a.max):Math.min(n,s)),n}function VK(n,t,s){return{min:t!==void 0?n.min+t:void 0,max:s!==void 0?n.max+s-(n.max-n.min):void 0}}function DPe(n,{top:t,left:s,bottom:a,right:l}){return{x:VK(n.x,s,l),y:VK(n.y,t,a)}}function FK(n,t){let s=t.min-n.min,a=t.max-n.max;return t.max-t.min<n.max-n.min&&([s,a]=[a,s]),{min:s,max:a}}function LPe(n,t){return{x:FK(n.x,t.x),y:FK(n.y,t.y)}}function xPe(n,t){let s=.5;const a=Ul(n),l=Ul(t);return l>a?s=n0(t.min,t.max-a,n.min):a>l&&(s=n0(n.min,n.max-l,t.min)),Pf(0,1,s)}function MPe(n,t){const s={};return t.min!==void 0&&(s.min=t.min-n.min),t.max!==void 0&&(s.max=t.max-n.min),s}const mU=.35;function UPe(n=mU){return n===!1?n=0:n===!0&&(n=mU),{x:jK(n,"left","right"),y:jK(n,"top","bottom")}}function jK(n,t,s){return{min:BK(n,t),max:BK(n,s)}}function BK(n,t){return typeof n=="number"?n:n[t]||0}const WK=()=>({translate:0,scale:1,origin:0,originPoint:0}),RS=()=>({x:WK(),y:WK()}),zK=()=>({min:0,max:0}),Bs=()=>({x:zK(),y:zK()});function wu(n){return[n("x"),n("y")]}function iee({top:n,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:n,max:a}}}function VPe({x:n,y:t}){return{top:t.min,right:n.max,bottom:t.max,left:n.min}}function FPe(n,t){if(!t)return n;const s=t({x:n.left,y:n.top}),a=t({x:n.right,y:n.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function eM(n){return n===void 0||n===1}function gU({scale:n,scaleX:t,scaleY:s}){return!eM(n)||!eM(t)||!eM(s)}function tE(n){return gU(n)||see(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function see(n){return GK(n.x)||GK(n.y)}function GK(n){return n&&n!=="0%"}function hk(n,t,s){const a=n-s,l=t*a;return s+l}function HK(n,t,s,a,l){return l!==void 0&&(n=hk(n,l,a)),hk(n,s,a)+t}function _U(n,t=0,s=1,a,l){n.min=HK(n.min,t,s,a,l),n.max=HK(n.max,t,s,a,l)}function oee(n,{x:t,y:s}){_U(n.x,t.translate,t.scale,t.originPoint),_U(n.y,s.translate,s.scale,s.originPoint)}const $K=.999999999999,KK=1.0000000000001;function jPe(n,t,s,a=!1){const l=s.length;if(!l)return;t.x=t.y=1;let d,f;for(let E=0;E<l;E++){d=s[E],f=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&IS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,oee(n,f)),a&&tE(d.latestValues)&&IS(n,d.latestValues))}t.x<KK&&t.x>$K&&(t.x=1),t.y<KK&&t.y>$K&&(t.y=1)}function CS(n,t){n.min=n.min+t,n.max=n.max+t}function qK(n,t,s,a,l=.5){const d=hs(n.min,n.max,l);_U(n,t,s,d,a)}function IS(n,t){qK(n.x,t.x,t.scaleX,t.scale,t.originX),qK(n.y,t.y,t.scaleY,t.scale,t.originY)}function aee(n,t){return iee(FPe(n.getBoundingClientRect(),t))}function BPe(n,t,s){const a=aee(n,s),{scroll:l}=t;return l&&(CS(a.x,l.offset.x),CS(a.y,l.offset.y)),a}const cee=({current:n})=>n?n.ownerDocument.defaultView:null,WPe=new WeakMap;class zPe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Bs(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=w=>{const{dragSnapToOrigin:A}=this.getProps();A?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(jR(w).point)},d=(w,A)=>{const{drag:N,dragPropagation:V,onDragStart:j}=this.getProps();if(N&&!V&&(this.openDragLock&&this.openDragLock(),this.openDragLock=xIe(N),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),wu(H=>{let J=this.getAxisMotionValue(H).get()||0;if(Gh.test(J)){const{projection:$}=this.visualElement;if($&&$.layout){const te=$.layout.layoutBox[H];te&&(J=Ul(te)*(parseFloat(J)/100))}}this.originPoint[H]=J}),j&&qi.postRender(()=>j(w,A)),aU(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},f=(w,A)=>{const{dragPropagation:N,dragDirectionLock:V,onDirectionLock:j,onDrag:B}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:H}=A;if(V&&this.currentDirection===null){this.currentDirection=GPe(H),this.currentDirection!==null&&j&&j(this.currentDirection);return}this.updateAxis("x",A.point,H),this.updateAxis("y",A.point,H),this.visualElement.render(),B&&B(w,A)},E=(w,A)=>this.stop(w,A),v=()=>wu(w=>{var A;return this.getAnimationState(w)==="paused"&&((A=this.getAxisMotionValue(w).animation)===null||A===void 0?void 0:A.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new eee(t,{onSessionStart:l,onStart:d,onMove:f,onSessionEnd:E,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:cee(this.visualElement)})}stop(t,s){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=s;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&qi.postRender(()=>d(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,a){const{drag:l}=this.getProps();if(!a||!sO(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let f=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(f=NPe(f,this.constraints[t],this.elastic[t])),d.set(f)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;s&&TS(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&l?this.constraints=DPe(l.layoutBox,s):this.constraints=!1,this.elastic=UPe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&wu(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=MPe(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!TS(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=BPe(a,l.root,this.visualElement.getTransformPagePoint());let f=LPe(l.layout.layoutBox,d);if(s){const E=s(VPe(f));this.hasMutatedConstraints=!!E,E&&(f=iee(E))}return f}startAnimation(t){const{drag:s,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:f,onDragTransitionEnd:E}=this.getProps(),v=this.constraints||{},b=wu(w=>{if(!sO(w,s,this.currentDirection))return;let A=v&&v[w]||{};f&&(A={min:0,max:0});const N=l?200:1e6,V=l?40:1e7,j={type:"inertia",velocity:a?t[w]:0,bounceStiffness:N,bounceDamping:V,timeConstant:750,restDelta:1,restSpeed:10,...d,...A};return this.startAxisValueAnimation(w,j)});return Promise.all(b).then(E)}startAxisValueAnimation(t,s){const a=this.getAxisMotionValue(t);return aU(this.visualElement,t),a.start(AF(t,a,0,s,this.visualElement,!1))}stopAnimation(){wu(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){wu(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[s];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){wu(s=>{const{drag:a}=this.getProps();if(!sO(s,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(s);if(l&&l.layout){const{min:f,max:E}=l.layout.layoutBox[s];d.set(t[s]-hs(f,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!TS(s)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};wu(f=>{const E=this.getAxisMotionValue(f);if(E&&this.constraints!==!1){const v=E.get();l[f]=xPe({min:v,max:v},this.constraints[f])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),wu(f=>{if(!sO(f,t,null))return;const E=this.getAxisMotionValue(f),{min:v,max:b}=this.constraints[f];E.set(hs(v,b,l[f]))})}addListeners(){if(!this.visualElement.current)return;WPe.set(this.visualElement,this);const t=this.visualElement.current,s=Hw(t,"pointerdown",v=>{const{drag:b,dragListener:w=!0}=this.getProps();b&&w&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();TS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),qi.read(a);const f=gR(window,"resize",()=>this.scalePositionWithinConstraints()),E=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:b})=>{this.isDragging&&b&&(wu(w=>{const A=this.getAxisMotionValue(w);A&&(this.originPoint[w]+=v[w].translate,A.set(A.get()+v[w].translate))}),this.visualElement.render())});return()=>{f(),s(),d(),E&&E()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:f=mU,dragMomentum:E=!0}=t;return{...t,drag:s,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:f,dragMomentum:E}}}function sO(n,t,s){return(t===!0||t===n)&&(s===null||s===n)}function GPe(n,t=10){let s=null;return Math.abs(n.y)>t?s="y":Math.abs(n.x)>t&&(s="x"),s}class HPe extends Rg{constructor(t){super(t),this.removeGroupControls=Ml,this.removeListeners=Ml,this.controls=new zPe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ml}unmount(){this.removeGroupControls(),this.removeListeners()}}const YK=n=>(t,s)=>{n&&qi.postRender(()=>n(t,s))};class $Pe extends Rg{constructor(){super(...arguments),this.removePointerDownListener=Ml}onPointerDown(t){this.session=new eee(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:cee(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:YK(t),onStart:YK(s),onMove:a,onEnd:(d,f)=>{delete this.session,l&&qi.postRender(()=>l(d,f))}}}mount(){this.removePointerDownListener=Hw(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const MO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function XK(n,t){return t.max===t.min?0:n/(t.max-t.min)*100}const sw={correct:(n,t)=>{if(!t.target)return n;if(typeof n=="string")if(Mn.test(n))n=parseFloat(n);else return n;const s=XK(n,t.target.x),a=XK(n,t.target.y);return`${s}% ${a}%`}},KPe={correct:(n,{treeScale:t,projectionDelta:s})=>{const a=n,l=gg.parse(n);if(l.length>5)return a;const d=gg.createTransformer(n),f=typeof l[0]!="number"?1:0,E=s.x.scale*t.x,v=s.y.scale*t.y;l[0+f]/=E,l[1+f]/=v;const b=hs(E,v,.5);return typeof l[2+f]=="number"&&(l[2+f]/=b),typeof l[3+f]=="number"&&(l[3+f]/=b),d(l)}};class qPe extends D.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;fIe(YPe),d&&(s.group&&s.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),MO.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:a,drag:l,isPresent:d}=this.props,f=a.projection;return f&&(f.isPresent=d,l||t.layoutDependency!==s||s===void 0?f.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?f.promote():f.relegate()||qi.postRender(()=>{const E=f.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),rF.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function lee(n){const[t,s]=JV(),a=D.useContext(qV);return C.jsx(qPe,{...n,layoutGroup:a,switchLayoutGroup:D.useContext(ZQ),isPresent:t,safeToRemove:s})}const YPe={borderRadius:{...sw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:sw,borderTopRightRadius:sw,borderBottomLeftRadius:sw,borderBottomRightRadius:sw,boxShadow:KPe};function XPe(n,t,s){const a=Ga(n)?n:fR(n);return a.start(AF("",a,t,s)),a.animation}function JPe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const QPe=(n,t)=>n.depth-t.depth;class ZPe{constructor(){this.children=[],this.isDirty=!1}add(t){_F(this.children,t),this.isDirty=!0}remove(t){EF(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(QPe),this.isDirty=!1,this.children.forEach(t)}}function eOe(n,t){const s=Hh.now(),a=({timestamp:l})=>{const d=l-s;d>=t&&(mg(a),n(d-t))};return qi.read(a,!0),()=>mg(a)}const uee=["TopLeft","TopRight","BottomLeft","BottomRight"],tOe=uee.length,JK=n=>typeof n=="string"?parseFloat(n):n,QK=n=>typeof n=="number"||Mn.test(n);function nOe(n,t,s,a,l,d){l?(n.opacity=hs(0,s.opacity!==void 0?s.opacity:1,rOe(a)),n.opacityExit=hs(t.opacity!==void 0?t.opacity:1,0,iOe(a))):d&&(n.opacity=hs(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,a));for(let f=0;f<tOe;f++){const E=`border${uee[f]}Radius`;let v=ZK(t,E),b=ZK(s,E);if(v===void 0&&b===void 0)continue;v||(v=0),b||(b=0),v===0||b===0||QK(v)===QK(b)?(n[E]=Math.max(hs(JK(v),JK(b),a),0),(Gh.test(b)||Gh.test(v))&&(n[E]+="%")):n[E]=b}(t.rotate||s.rotate)&&(n.rotate=hs(t.rotate||0,s.rotate||0,a))}function ZK(n,t){return n[t]!==void 0?n[t]:n.borderRadius}const rOe=dee(0,.5,PZ),iOe=dee(.5,.95,Ml);function dee(n,t,s){return a=>a<n?0:a>t?1:s(n0(n,t,a))}function eq(n,t){n.min=t.min,n.max=t.max}function Su(n,t){eq(n.x,t.x),eq(n.y,t.y)}function tq(n,t){n.translate=t.translate,n.scale=t.scale,n.originPoint=t.originPoint,n.origin=t.origin}function nq(n,t,s,a,l){return n-=t,n=hk(n,1/s,a),l!==void 0&&(n=hk(n,1/l,a)),n}function sOe(n,t=0,s=1,a=.5,l,d=n,f=n){if(Gh.test(t)&&(t=parseFloat(t),t=hs(f.min,f.max,t/100)-f.min),typeof t!="number")return;let E=hs(d.min,d.max,a);n===d&&(E-=t),n.min=nq(n.min,t,s,E,l),n.max=nq(n.max,t,s,E,l)}function rq(n,t,[s,a,l],d,f){sOe(n,t[s],t[a],t[l],t.scale,d,f)}const oOe=["x","scaleX","originX"],aOe=["y","scaleY","originY"];function iq(n,t,s,a){rq(n.x,t,oOe,s?s.x:void 0,a?a.x:void 0),rq(n.y,t,aOe,s?s.y:void 0,a?a.y:void 0)}function sq(n){return n.translate===0&&n.scale===1}function hee(n){return sq(n.x)&&sq(n.y)}function oq(n,t){return n.min===t.min&&n.max===t.max}function cOe(n,t){return oq(n.x,t.x)&&oq(n.y,t.y)}function aq(n,t){return Math.round(n.min)===Math.round(t.min)&&Math.round(n.max)===Math.round(t.max)}function pee(n,t){return aq(n.x,t.x)&&aq(n.y,t.y)}function cq(n){return Ul(n.x)/Ul(n.y)}function lq(n,t){return n.translate===t.translate&&n.scale===t.scale&&n.originPoint===t.originPoint}class lOe{constructor(){this.members=[]}add(t){_F(this.members,t),t.scheduleRender()}remove(t){if(EF(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(l=>t===l);if(s===0)return!1;let a;for(let l=s;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,s){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,s&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:a}=t;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function uOe(n,t,s){let a="";const l=n.x.translate/t.x,d=n.y.translate/t.y,f=(s==null?void 0:s.z)||0;if((l||d||f)&&(a=`translate3d(${l}px, ${d}px, ${f}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:b,rotate:w,rotateX:A,rotateY:N,skewX:V,skewY:j}=s;b&&(a=`perspective(${b}px) ${a}`),w&&(a+=`rotate(${w}deg) `),A&&(a+=`rotateX(${A}deg) `),N&&(a+=`rotateY(${N}deg) `),V&&(a+=`skewX(${V}deg) `),j&&(a+=`skewY(${j}deg) `)}const E=n.x.scale*t.x,v=n.y.scale*t.y;return(E!==1||v!==1)&&(a+=`scale(${E}, ${v})`),a||"none"}const nE={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Aw=typeof window<"u"&&window.MotionDebug!==void 0,tM=["","X","Y","Z"],dOe={visibility:"hidden"},uq=1e3;let hOe=0;function nM(n,t,s,a){const{latestValues:l}=t;l[n]&&(s[n]=l[n],t.setStaticValue(n,0),a&&(a[n]=0))}function fee(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:t}=n.options;if(!t)return;const s=bZ(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(s,"transform",qi,!(l||d))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&fee(a)}function mee({attachResizeListener:n,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},E=t==null?void 0:t()){this.id=hOe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Aw&&(nE.totalNodes=nE.resolvedTargetDeltas=nE.recalculatedProjection=0),this.nodes.forEach(mOe),this.nodes.forEach(vOe),this.nodes.forEach(SOe),this.nodes.forEach(gOe),Aw&&window.MotionDebug.record(nE)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new ZPe)}addEventListener(f,E){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new yF),this.eventHandlers.get(f).add(E)}notifyListeners(f,...E){const v=this.eventHandlers.get(f);v&&v.notify(...E)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,E=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=JPe(f),this.instance=f;const{layoutId:v,layout:b,visualElement:w}=this.options;if(w&&!w.current&&w.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),E&&(b||v)&&(this.isLayoutDirty=!0),n){let A;const N=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,A&&A(),A=eOe(N,250),MO.hasAnimatedSinceResize&&(MO.hasAnimatedSinceResize=!1,this.nodes.forEach(hq))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&w&&(v||b)&&this.addEventListener("didUpdate",({delta:A,hasLayoutChanged:N,hasRelativeTargetChanged:V,layout:j})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||w.getDefaultTransition()||COe,{onLayoutAnimationStart:H,onLayoutAnimationComplete:J}=w.getProps(),$=!this.targetLayout||!pee(this.targetLayout,j)||V,te=!N&&V;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||te||N&&($||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(A,te);const ce={...pF(B,"layout"),onPlay:H,onComplete:J};(w.shouldReduceMotion||this.options.layoutRoot)&&(ce.delay=0,ce.type=!1),this.startAnimation(ce)}else N||hq(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=j})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,mg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(bOe),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&fee(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const A=this.path[w];A.shouldResetTransform=!0,A.updateScroll("snapshot"),A.options.layoutRoot&&A.willUpdate(!1)}const{layoutId:E,layout:v}=this.options;if(E===void 0&&!v)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(dq);return}this.isUpdating||this.nodes.forEach(EOe),this.isUpdating=!1,this.nodes.forEach(yOe),this.nodes.forEach(pOe),this.nodes.forEach(fOe),this.clearAllSnapshots();const E=Hh.now();ia.delta=Pf(0,1e3/60,E-ia.timestamp),ia.timestamp=E,ia.isProcessing=!0,K2.update.process(ia),K2.preRender.process(ia),K2.render.process(ia),ia.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,rF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(_Oe),this.sharedNodes.forEach(TOe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,qi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){qi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Bs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(E=!1),E){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:v,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!hee(this.projectionDelta),v=this.getTransformTemplate(),b=v?v(this.latestValues,""):void 0,w=b!==this.prevTransformTemplateValue;f&&(E||tE(this.latestValues)||w)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const E=this.measurePageBox();let v=this.removeElementScroll(E);return f&&(v=this.removeTransform(v)),IOe(v),{animationId:this.root.animationId,measuredBox:E,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:E}=this.options;if(!E)return Bs();const v=E.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(AOe))){const{scroll:w}=this.root;w&&(CS(v.x,w.offset.x),CS(v.y,w.offset.y))}return v}removeElementScroll(f){var E;const v=Bs();if(Su(v,f),!((E=this.scroll)===null||E===void 0)&&E.wasRoot)return v;for(let b=0;b<this.path.length;b++){const w=this.path[b],{scroll:A,options:N}=w;w!==this.root&&A&&N.layoutScroll&&(A.wasRoot&&Su(v,f),CS(v.x,A.offset.x),CS(v.y,A.offset.y))}return v}applyTransform(f,E=!1){const v=Bs();Su(v,f);for(let b=0;b<this.path.length;b++){const w=this.path[b];!E&&w.options.layoutScroll&&w.scroll&&w!==w.root&&IS(v,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),tE(w.latestValues)&&IS(v,w.latestValues)}return tE(this.latestValues)&&IS(v,this.latestValues),v}removeTransform(f){const E=Bs();Su(E,f);for(let v=0;v<this.path.length;v++){const b=this.path[v];if(!b.instance||!tE(b.latestValues))continue;gU(b.latestValues)&&b.updateSnapshot();const w=Bs(),A=b.measurePageBox();Su(w,A),iq(E,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,w)}return tE(this.latestValues)&&iq(E,this.latestValues),E}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ia.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var E;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==v;if(!(f||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((E=this.parent)===null||E===void 0)&&E.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:A,layoutId:N}=this.options;if(!(!this.layout||!(A||N))){if(this.resolvedRelativeTargetAt=ia.timestamp,!this.targetDelta&&!this.relativeTarget){const V=this.getClosestProjectingParent();V&&V.layout&&this.animationProgress!==1?(this.relativeParent=V,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Bs(),this.relativeTargetOrigin=Bs(),Kw(this.relativeTargetOrigin,this.layout.layoutBox,V.layout.layoutBox),Su(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Bs(),this.targetWithTransforms=Bs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),kPe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Su(this.target,this.layout.layoutBox),oee(this.target,this.targetDelta)):Su(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const V=this.getClosestProjectingParent();V&&!!V.resumingFrom==!!this.resumingFrom&&!V.options.layoutScroll&&V.target&&this.animationProgress!==1?(this.relativeParent=V,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Bs(),this.relativeTargetOrigin=Bs(),Kw(this.relativeTargetOrigin,this.target,V.target),Su(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Aw&&nE.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||gU(this.parent.latestValues)||see(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const E=this.getLead(),v=!!this.resumingFrom||this!==E;let b=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(b=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===ia.timestamp&&(b=!1),b)return;const{layout:w,layoutId:A}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||A))return;Su(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,V=this.treeScale.y;jPe(this.layoutCorrected,this.treeScale,this.path,v),E.layout&&!E.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(E.target=E.layout.layoutBox,E.targetWithTransforms=Bs());const{target:j}=E;if(!j){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(tq(this.prevProjectionDelta.x,this.projectionDelta.x),tq(this.prevProjectionDelta.y,this.projectionDelta.y)),$w(this.projectionDelta,this.layoutCorrected,j,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==V||!lq(this.projectionDelta.x,this.prevProjectionDelta.x)||!lq(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",j)),Aw&&nE.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var E;if((E=this.options.visualElement)===null||E===void 0||E.scheduleRender(),f){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=RS(),this.projectionDelta=RS(),this.projectionDeltaWithTransform=RS()}setAnimationOrigin(f,E=!1){const v=this.snapshot,b=v?v.latestValues:{},w={...this.latestValues},A=RS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=Bs(),V=v?v.source:void 0,j=this.layout?this.layout.source:void 0,B=V!==j,H=this.getStack(),J=!H||H.members.length<=1,$=!!(B&&!J&&this.options.crossfade===!0&&!this.path.some(ROe));this.animationProgress=0;let te;this.mixTargetDelta=ce=>{const oe=ce/1e3;pq(A.x,f.x,oe),pq(A.y,f.y,oe),this.setTargetDelta(A),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Kw(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),wOe(this.relativeTarget,this.relativeTargetOrigin,N,oe),te&&cOe(this.relativeTarget,te)&&(this.isProjectionDirty=!1),te||(te=Bs()),Su(te,this.relativeTarget)),B&&(this.animationValues=w,nOe(w,b,this.latestValues,oe,$,J)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=oe},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(mg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=qi.update(()=>{MO.hasAnimatedSinceResize=!0,this.currentAnimation=XPe(0,uq,{...f,onUpdate:E=>{this.mixTargetDelta(E),f.onUpdate&&f.onUpdate(E)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(uq),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:E,target:v,layout:b,latestValues:w}=f;if(!(!E||!v||!b)){if(this!==f&&this.layout&&b&&gee(this.options.animationType,this.layout.layoutBox,b.layoutBox)){v=this.target||Bs();const A=Ul(this.layout.layoutBox.x);v.x.min=f.target.x.min,v.x.max=v.x.min+A;const N=Ul(this.layout.layoutBox.y);v.y.min=f.target.y.min,v.y.max=v.y.min+N}Su(E,v),IS(E,w),$w(this.projectionDeltaWithTransform,this.layoutCorrected,E,w)}}registerSharedNode(f,E){this.sharedNodes.has(f)||this.sharedNodes.set(f,new lOe),this.sharedNodes.get(f).add(E);const b=E.options.initialPromotionConfig;E.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(E):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:E}=this.options;return E?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:E}=this.options;return E?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:E,preserveFollowOpacity:v}={}){const b=this.getStack();b&&b.promote(this,v),f&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let E=!1;const{latestValues:v}=f;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(E=!0),!E)return;const b={};v.z&&nM("z",f,b,this.animationValues);for(let w=0;w<tM.length;w++)nM(`rotate${tM[w]}`,f,b,this.animationValues),nM(`skew${tM[w]}`,f,b,this.animationValues);f.render();for(const w in b)f.setStaticValue(w,b[w]),this.animationValues&&(this.animationValues[w]=b[w]);f.scheduleRender()}getProjectionStyles(f){var E,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return dOe;const b={visibility:""},w=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=LO(f==null?void 0:f.pointerEvents)||"",b.transform=w?w(this.latestValues,""):"none",b;const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){const B={};return this.options.layoutId&&(B.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,B.pointerEvents=LO(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!tE(this.latestValues)&&(B.transform=w?w({},""):"none",this.hasProjected=!1),B}const N=A.animationValues||A.latestValues;this.applyTransformsToTarget(),b.transform=uOe(this.projectionDeltaWithTransform,this.treeScale,N),w&&(b.transform=w(N,b.transform));const{x:V,y:j}=this.projectionDelta;b.transformOrigin=`${V.origin*100}% ${j.origin*100}% 0`,A.animationValues?b.opacity=A===this?(v=(E=N.opacity)!==null&&E!==void 0?E:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:b.opacity=A===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const B in ak){if(N[B]===void 0)continue;const{correct:H,applyTo:J}=ak[B],$=b.transform==="none"?N[B]:H(N[B],A);if(J){const te=J.length;for(let ce=0;ce<te;ce++)b[J[ce]]=$}else b[B]=$}return this.options.layoutId&&(b.pointerEvents=A===this?LO(f==null?void 0:f.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var E;return(E=f.currentAnimation)===null||E===void 0?void 0:E.stop()}),this.root.nodes.forEach(dq),this.root.sharedNodes.clear()}}}function pOe(n){n.updateLayout()}function fOe(n){var t;const s=((t=n.resumeFrom)===null||t===void 0?void 0:t.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&s&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:d}=n.options,f=s.source!==n.layout.source;d==="size"?wu(A=>{const N=f?s.measuredBox[A]:s.layoutBox[A],V=Ul(N);N.min=a[A].min,N.max=N.min+V}):gee(d,s.layoutBox,a)&&wu(A=>{const N=f?s.measuredBox[A]:s.layoutBox[A],V=Ul(a[A]);N.max=N.min+V,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[A].max=n.relativeTarget[A].min+V)});const E=RS();$w(E,a,s.layoutBox);const v=RS();f?$w(v,n.applyTransform(l,!0),s.measuredBox):$w(v,a,s.layoutBox);const b=!hee(E);let w=!1;if(!n.resumeFrom){const A=n.getClosestProjectingParent();if(A&&!A.resumeFrom){const{snapshot:N,layout:V}=A;if(N&&V){const j=Bs();Kw(j,s.layoutBox,N.layoutBox);const B=Bs();Kw(B,a,V.layoutBox),pee(j,B)||(w=!0),A.options.layoutRoot&&(n.relativeTarget=B,n.relativeTargetOrigin=j,n.relativeParent=A)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:v,layoutDelta:E,hasLayoutChanged:b,hasRelativeTargetChanged:w})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function mOe(n){Aw&&nE.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function gOe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function _Oe(n){n.clearSnapshot()}function dq(n){n.clearMeasurements()}function EOe(n){n.isLayoutDirty=!1}function yOe(n){const{visualElement:t}=n.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),n.resetTransform()}function hq(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function vOe(n){n.resolveTargetDelta()}function SOe(n){n.calcProjection()}function bOe(n){n.resetSkewAndRotation()}function TOe(n){n.removeLeadSnapshot()}function pq(n,t,s){n.translate=hs(t.translate,0,s),n.scale=hs(t.scale,1,s),n.origin=t.origin,n.originPoint=t.originPoint}function fq(n,t,s,a){n.min=hs(t.min,s.min,a),n.max=hs(t.max,s.max,a)}function wOe(n,t,s,a){fq(n.x,t.x,s.x,a),fq(n.y,t.y,s.y,a)}function ROe(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const COe={duration:.45,ease:[.4,0,.1,1]},mq=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),gq=mq("applewebkit/")&&!mq("chrome/")?Math.round:Ml;function _q(n){n.min=gq(n.min),n.max=gq(n.max)}function IOe(n){_q(n.x),_q(n.y)}function gee(n,t,s){return n==="position"||n==="preserve-aspect"&&!OPe(cq(t),cq(s),.2)}function AOe(n){var t;return n!==n.root&&((t=n.scroll)===null||t===void 0?void 0:t.wasRoot)}const POe=mee({attachResizeListener:(n,t)=>gR(n,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rM={current:void 0},_ee=mee({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!rM.current){const n=new POe({});n.mount(window),n.setOptions({layoutScroll:!0}),rM.current=n}return rM.current},resetTransform:(n,t)=>{n.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),OOe={pan:{Feature:$Pe},drag:{Feature:HPe,ProjectionNode:_ee,MeasureLayout:lee}};function Eq(n,t,s){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",s==="Start");const l="onHover"+s,d=a[l];d&&qi.postRender(()=>d(t,jR(t)))}class kOe extends Rg{mount(){const{current:t}=this.node;t&&(this.unmount=OIe(t,s=>(Eq(this.node,s,"Start"),a=>Eq(this.node,a,"End"))))}unmount(){}}class NOe extends Rg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=FR(gR(this.node.current,"focus",()=>this.onFocus()),gR(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function yq(n,t,s){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",s==="Start");const l="onTap"+(s==="End"?"":s),d=a[l];d&&qi.postRender(()=>d(t,jR(t)))}class DOe extends Rg{mount(){const{current:t}=this.node;t&&(this.unmount=LIe(t,s=>(yq(this.node,s,"Start"),(a,{success:l})=>yq(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const EU=new WeakMap,iM=new WeakMap,LOe=n=>{const t=EU.get(n.target);t&&t(n)},xOe=n=>{n.forEach(LOe)};function MOe({root:n,...t}){const s=n||document;iM.has(s)||iM.set(s,{});const a=iM.get(s),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(xOe,{root:n,...t})),a[l]}function UOe(n,t,s){const a=MOe(t);return EU.set(n,s),a.observe(n),()=>{EU.delete(n),a.unobserve(n)}}const VOe={some:0,all:1};class FOe extends Rg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:a,amount:l="some",once:d}=t,f={root:s?s.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:VOe[l]},E=v=>{const{isIntersecting:b}=v;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:w,onViewportLeave:A}=this.node.getProps(),N=b?w:A;N&&N(v)};return UOe(this.node.current,f,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(jOe(t,s))&&this.startObserver()}unmount(){}}function jOe({viewport:n={}},{viewport:t={}}={}){return s=>n[s]!==t[s]}const BOe={inView:{Feature:FOe},tap:{Feature:DOe},focus:{Feature:NOe},hover:{Feature:kOe}},WOe={layout:{ProjectionNode:_ee,MeasureLayout:lee}},yU={current:null},Eee={current:!1};function zOe(){if(Eee.current=!0,!!QV)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),t=()=>yU.current=n.matches;n.addListener(t),t()}else yU.current=!1}const GOe=[...zZ,ja,gg],HOe=n=>GOe.find(WZ(n)),vq=new WeakMap;function $Oe(n,t,s){for(const a in t){const l=t[a],d=s[a];if(Ga(l))n.addValue(a,l);else if(Ga(d))n.addValue(a,fR(l,{owner:n}));else if(d!==l)if(n.hasValue(a)){const f=n.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(a);n.addValue(a,fR(f!==void 0?f:l,{owner:n}))}}for(const a in s)t[a]===void 0&&n.removeValue(a);return t}const Sq=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class KOe{scrapeMotionValuesFromProps(t,s,a){return{}}constructor({parent:t,props:s,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:f},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=RF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const V=Hh.now();this.renderScheduledAt<V&&(this.renderScheduledAt=V,qi.render(this.render,!1,!0))};const{latestValues:v,renderState:b,onUpdate:w}=f;this.onUpdate=w,this.latestValues=v,this.baseTarget={...v},this.initialValues=s.initial?{...v}:{},this.renderState=b,this.parent=t,this.props=s,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=E,this.blockInitialAnimation=!!d,this.isControllingVariants=r1(s),this.isVariantNode=JQ(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:A,...N}=this.scrapeMotionValuesFromProps(s,{},this);for(const V in N){const j=N[V];v[V]!==void 0&&Ga(j)&&j.set(v[V],!1)}}mount(t){this.current=t,vq.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,a)=>this.bindToMotionValue(a,s)),Eee.current||zOe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:yU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){vq.delete(this.current),this.projection&&this.projection.unmount(),mg(this.notifyUpdate),mg(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=LE.has(t),l=s.on("change",E=>{this.latestValues[t]=E,this.props.onUpdate&&qi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=s.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{l(),d(),f&&f(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in r0){const s=r0[t];if(!s)continue;const{isEnabled:a,Feature:l}=s;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Bs()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<Sq.length;a++){const l=Sq[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,f=t[d];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=$Oe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const a=this.values.get(t);s!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&s!==void 0&&(a=fR(s===null?void 0:s,{owner:this}),this.addValue(t,a)),a}readValue(t,s){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(jZ(l)||kZ(l))?l=parseFloat(l):!HOe(l)&&gg.test(s)&&(l=UZ(t,s)),this.setBaseTarget(t,Ga(l)?l.get():l)),Ga(l)?l.get():l}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const f=sF(this.props,a,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);f&&(l=f[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!Ga(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new yF),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class yee extends KOe{constructor(){super(...arguments),this.KeyframeResolver=GZ}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:a}){delete s[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Ga(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function qOe(n){return window.getComputedStyle(n)}class YOe extends yee{constructor(){super(...arguments),this.type="html",this.renderInstance=oZ}readValueFromInstance(t,s){if(LE.has(s)){const a=wF(s);return a&&a.default||0}else{const a=qOe(t),l=(rZ(s)?a.getPropertyValue(s):a[s])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:s}){return aee(t,s)}build(t,s,a){cF(t,s,a.transformTemplate)}scrapeMotionValuesFromProps(t,s,a){return hF(t,s,a)}}class XOe extends yee{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Bs}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(LE.has(s)){const a=wF(s);return a&&a.default||0}return s=aZ.has(s)?s:nF(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,a){return uZ(t,s,a)}build(t,s,a){lF(t,s,this.isSVGTag,a.transformTemplate)}renderInstance(t,s,a,l){cZ(t,s,a,l)}mount(t){this.isSVGTag=dF(t.tagName),super.mount(t)}}const JOe=(n,t)=>iF(n)?new XOe(t):new YOe(t,{allowProjection:n!==D.Fragment}),QOe=TIe({...SPe,...BOe,...OOe,...WOe},JOe),Mf=VCe(QOe),ZOe=(n,t)=>n.find(s=>s.id===t);function bq(n,t){const s=vee(n,t),a=s?n[s].findIndex(l=>l.id===t):-1;return{position:s,index:a}}function vee(n,t){for(const[s,a]of Object.entries(n))if(ZOe(a,t))return s}function eke(n){const t=n.includes("right"),s=n.includes("left");let a="center";return t&&(a="flex-end"),s&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function tke(n){const s=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:s,top:a,bottom:l,right:d,left:f}}var nke=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,rke=MQ(function(n){return nke.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),ike=rke,ske=function(t){return t!=="theme"},Tq=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?ike:ske},wq=function(t,s,a){var l;if(s){var d=s.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(f){return t.__emotion_forwardProp(f)&&d(f)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},oke=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return jV(s,a,l),BQ(function(){return BV(s,a,l)}),null},ake=function n(t,s){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,f;s!==void 0&&(d=s.label,f=s.target);var E=wq(t,s,a),v=E||Tq(l),b=!v("as");return function(){var w=arguments,A=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&A.push("label:"+d+";"),w[0]==null||w[0].raw===void 0)A.push.apply(A,w);else{var N=w[0];A.push(N[0]);for(var V=w.length,j=1;j<V;j++)A.push(w[j],N[j])}var B=zV(function(H,J,$){var te=b&&H.as||l,ce="",oe=[],_e=H;if(H.theme==null){_e={};for(var ne in H)_e[ne]=H[ne];_e.theme=D.useContext(t0)}typeof H.className=="string"?ce=VQ(J.registered,oe,H.className):H.className!=null&&(ce=H.className+" ");var ee=Qk(A.concat(oe),J.registered,_e);ce+=J.key+"-"+ee.name,f!==void 0&&(ce+=" "+f);var Q=b&&E===void 0?Tq(te):v,se={};for(var pe in H)b&&pe==="as"||Q(pe)&&(se[pe]=H[pe]);return se.className=ce,$&&(se.ref=$),D.createElement(D.Fragment,null,D.createElement(oke,{cache:J,serialized:ee,isStringTag:typeof te=="string"}),D.createElement(te,se))});return B.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",B.defaultProps=t.defaultProps,B.__emotion_real=B,B.__emotion_base=l,B.__emotion_styles=A,B.__emotion_forwardProp=E,Object.defineProperty(B,"toString",{value:function(){return"."+f}}),B.withComponent=function(H,J){var $=n(H,SE({},s,J,{shouldForwardProp:wq(B,J,!0)}));return $.apply(void 0,A)},B}},cke=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],vU=ake.bind(null);cke.forEach(function(n){vU[n]=vU(n)});const lke=new Set([...Oye,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),uke=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function dke(n){return(uke.has(n)||!lke.has(n))&&n[0]!=="_"}const hke=iEe(vU),pke=({baseStyle:n})=>t=>{const{theme:s,css:a,__css:l,sx:d,...f}=t,[E]=pEe(f,Nye),v=el(n,t),b=G_e({},l,v,Gk(E),d),w=mQ(b)(t.theme);return a?[w,a]:w};function sM(n,t){const{baseStyle:s,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=dke);const l=pke({baseStyle:s}),d=hke(n,a)(l);return D.forwardRef(function(v,b){const{children:w,...A}=v,{colorMode:N,forced:V}=e1(),j=V?N:void 0;return D.createElement(d,{ref:b,"data-theme":j,...A},w)})}function fke(){const n=new Map;return new Proxy(sM,{apply(t,s,a){return sM(...a)},get(t,s){return n.has(s)||n.set(s,sM(s)),n.get(s)}})}const Dt=fke(),mke={initial:n=>{const{position:t}=n,s=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[s]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},See=D.memo(n=>{const{id:t,message:s,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:f="bottom",duration:E=5e3,containerStyle:v,motionVariants:b=mke,toastSpacing:w="0.5rem"}=n,[A,N]=D.useState(E),V=PCe();fg(()=>{V||a==null||a()},[V]),fg(()=>{N(E)},[E]);const j=()=>N(null),B=()=>N(E),H=()=>{V&&l()};D.useEffect(()=>{V&&d&&l()},[V,d,l]),LEe(H,A);const J=D.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:w,...v}),[v,w]),$=D.useMemo(()=>eke(f),[f]);return C.jsx(Mf.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:j,onHoverEnd:B,custom:{position:f},style:$,children:C.jsx(Dt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:J,children:el(s,{id:t,onClose:H})})})});See.displayName="ToastComponent";function Gt(n){return D.forwardRef(n)}var oM,Rq;function gke(){if(Rq)return oM;Rq=1;var n=typeof Element<"u",t=typeof Map=="function",s=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,f){if(d===f)return!0;if(d&&f&&typeof d=="object"&&typeof f=="object"){if(d.constructor!==f.constructor)return!1;var E,v,b;if(Array.isArray(d)){if(E=d.length,E!=f.length)return!1;for(v=E;v--!==0;)if(!l(d[v],f[v]))return!1;return!0}var w;if(t&&d instanceof Map&&f instanceof Map){if(d.size!==f.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!f.has(v.value[0]))return!1;for(w=d.entries();!(v=w.next()).done;)if(!l(v.value[1],f.get(v.value[0])))return!1;return!0}if(s&&d instanceof Set&&f instanceof Set){if(d.size!==f.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!f.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(f)){if(E=d.length,E!=f.length)return!1;for(v=E;v--!==0;)if(d[v]!==f[v])return!1;return!0}if(d.constructor===RegExp)return d.source===f.source&&d.flags===f.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof f.valueOf=="function")return d.valueOf()===f.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof f.toString=="function")return d.toString()===f.toString();if(b=Object.keys(d),E=b.length,E!==Object.keys(f).length)return!1;for(v=E;v--!==0;)if(!Object.prototype.hasOwnProperty.call(f,b[v]))return!1;if(n&&d instanceof Element)return!1;for(v=E;v--!==0;)if(!((b[v]==="_owner"||b[v]==="__v"||b[v]==="__o")&&d.$$typeof)&&!l(d[b[v]],f[b[v]]))return!1;return!0}return d!==d&&f!==f}return oM=function(f,E){try{return l(f,E)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},oM}var _ke=gke();const Eke=DE(_ke);function I0(){const n=D.useContext(t0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function bee(){const n=e1(),t=I0();return{...n,theme:t}}function yke(n,t,s){if(t==null)return t;const a=l=>{var d,f;return(f=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:f.value};return a(t)??a(s)??s}function vke(n,t,s){const a=Array.isArray(t)?t:[t],l=Array.isArray(s)?s:[s];return d=>{const f=l.filter(Boolean),E=a.map((v,b)=>{const w=`${n}.${v}`;return yke(d,w,f[b]??v)});return Array.isArray(t)?E:E[0]}}function Tee(n,t={}){const{styleConfig:s,...a}=t,{theme:l,colorMode:d}=bee(),f=n?QJ(l,`components.${n}`):void 0,E=s||f,v=Vh({theme:l,colorMode:d},(E==null?void 0:E.defaultProps)??{},Gk(b0(a,["children"])),(w,A)=>w?void 0:A),b=D.useRef({});if(E){const A=zye(E)(v);Eke(b.current,A)||(b.current=A)}return b.current}function ku(n,t={}){return Tee(n,t)}function gc(n,t={}){return Tee(n,t)}const Cq={path:C.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[C.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),C.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),C.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Ln=Gt((n,t)=>{const{as:s,viewBox:a,color:l="currentColor",focusable:d=!1,children:f,className:E,__css:v,...b}=n,w=hn("chakra-icon",E),A=ku("Icon",n),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...A},V={ref:t,focusable:d,className:w,__css:N},j=a??Cq.viewBox;if(s&&typeof s!="string")return C.jsx(Dt.svg,{as:s,...V,...b});const B=f??Cq.path;return C.jsx(Dt.svg,{verticalAlign:"middle",viewBox:j,...V,...b,children:B})});Ln.displayName="Icon";function Ske(n){return C.jsx(Ln,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function bke(n){return C.jsx(Ln,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function Iq(n){return C.jsx(Ln,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const Tke=xR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),np=Gt((n,t)=>{const s=ku("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:f="transparent",className:E,...v}=Yi(n),b=hn("chakra-spinner",E),w={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${Tke} ${d} linear infinite`,...s};return C.jsx(Dt.div,{ref:t,__css:w,className:b,...v,children:a&&C.jsx(Dt.span,{srOnly:!0,children:a})})});np.displayName="Spinner";const[wke,PF]=Li({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[Rke,OF]=Li({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),wee={info:{icon:bke,colorScheme:"blue"},warning:{icon:Iq,colorScheme:"orange"},success:{icon:Ske,colorScheme:"green"},error:{icon:Iq,colorScheme:"red"},loading:{icon:np,colorScheme:"blue"}};function Cke(n){return wee[n].colorScheme}function Ike(n){return wee[n].icon}const hf=Gt(function(t,s){const{status:a="info",addRole:l=!0,...d}=Yi(t),f=t.colorScheme??Cke(a),E=gc("Alert",{...t,colorScheme:f}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...E.container};return C.jsx(wke,{value:{status:a},children:C.jsx(Rke,{value:E,children:C.jsx(Dt.div,{"data-status":a,role:l?"alert":void 0,ref:s,...d,className:hn("chakra-alert",t.className),__css:v})})})});hf.displayName="Alert";function pf(n){const{status:t}=PF(),s=Ike(t),a=OF(),l=t==="loading"?a.spinner:a.icon;return C.jsx(Dt.span,{display:"inherit","data-status":t,...n,className:hn("chakra-alert__icon",n.className),__css:l,children:n.children||C.jsx(s,{h:"100%",w:"100%"})})}pf.displayName="AlertIcon";const AS=Gt(function(t,s){const a=OF(),{status:l}=PF();return C.jsx(Dt.div,{ref:s,"data-status":l,...t,className:hn("chakra-alert__title",t.className),__css:a.title})});AS.displayName="AlertTitle";const PS=Gt(function(t,s){const{status:a}=PF(),l=OF(),d={display:"inline",...l.description};return C.jsx(Dt.div,{ref:s,"data-status":a,...t,className:hn("chakra-alert__desc",t.className),__css:d})});PS.displayName="AlertDescription";function Ake(n){return C.jsx(Ln,{focusable:"false","aria-hidden":!0,...n,children:C.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const kF=Gt(function(t,s){const a=ku("CloseButton",t),{children:l,isDisabled:d,__css:f,...E}=Yi(t),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return C.jsx(Dt.button,{type:"button","aria-label":"Close",ref:s,disabled:d,__css:{...v,...a,...f},...E,children:l||C.jsx(Ake,{width:"1em",height:"1em"})})});kF.displayName="CloseButton";const Pke=n=>{const{status:t,variant:s="solid",id:a,title:l,isClosable:d,onClose:f,description:E,colorScheme:v,icon:b}=n,w=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return C.jsxs(hf,{addRole:!1,status:t,variant:s,id:w==null?void 0:w.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[C.jsx(pf,{children:b}),C.jsxs(Dt.div,{flex:"1",maxWidth:"100%",children:[l&&C.jsx(AS,{id:w==null?void 0:w.title,children:l}),E&&C.jsx(PS,{id:w==null?void 0:w.description,display:"block",children:E})]}),d&&C.jsx(kF,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function Ree(n={}){const{render:t,toastComponent:s=Pke}=n;return l=>typeof t=="function"?t({...l,...n}):C.jsx(s,{...l,...n})}const Oke={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},xh=kke(Oke);function kke(n){let t=n;const s=new Set,a=l=>{t=l(t),s.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(s.add(l),()=>{a(()=>n),s.delete(l)}),removeToast:(l,d)=>{a(f=>({...f,[d]:f[d].filter(E=>E.id!=l)}))},notify:(l,d)=>{const f=Nke(l,d),{position:E,id:v}=f;return a(b=>{const A=E.includes("top")?[f,...b[E]??[]]:[...b[E]??[],f];return{...b,[E]:A}}),v},update:(l,d)=>{l&&a(f=>{const E={...f},{position:v,index:b}=bq(E,l);return v&&b!==-1&&(E[v][b]={...E[v][b],...d,message:Ree(d)}),E})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,b)=>(v[b]=d[b].map(w=>({...w,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const f=vee(d,l);return f?{...d,[f]:d[f].map(E=>E.id==l?{...E,requestClose:!0}:E)}:d})},isActive:l=>!!bq(xh.getState(),l).position}}let Aq=0;function Nke(n,t={}){Aq+=1;const s=t.id??Aq,a=t.position??"bottom";return{id:s,message:n,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>xh.removeToast(String(s),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var Cee=zJ();const[Iee,Dke]=Li({strict:!1,name:"PortalContext"}),NF="chakra-portal",Lke=".chakra-portal",xke=n=>C.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),Mke=n=>{const{appendToParentPortal:t,children:s}=n,[a,l]=D.useState(null),d=D.useRef(null),[,f]=D.useState({});D.useEffect(()=>f({}),[]);const E=Dke(),v=bCe();yf(()=>{if(!a)return;const w=a.ownerDocument,A=t?E??w.body:w.body;if(!A)return;d.current=w.createElement("div"),d.current.className=NF,A.appendChild(d.current),f({});const N=d.current;return()=>{A.contains(N)&&A.removeChild(N)}},[a]);const b=v!=null&&v.zIndex?C.jsx(xke,{zIndex:v==null?void 0:v.zIndex,children:s}):s;return d.current?Cee.createPortal(C.jsx(Iee,{value:d.current,children:b}),d.current):C.jsx("span",{ref:w=>{w&&l(w)}})},Uke=n=>{const{children:t,containerRef:s,appendToParentPortal:a}=n,l=s.current,d=l??(typeof window<"u"?document.body:void 0),f=D.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=NF),v},[l]),[,E]=D.useState({});return yf(()=>E({}),[]),yf(()=>{if(!(!f||!d))return d.appendChild(f),()=>{d.removeChild(f)}},[f,d]),d&&f?Cee.createPortal(C.jsx(Iee,{value:a?f:null,children:t}),f):null};function Nu(n){const t={appendToParentPortal:!0,...n},{containerRef:s,...a}=t;return s?C.jsx(Uke,{containerRef:s,...a}):C.jsx(Mke,{...a})}Nu.className=NF;Nu.selector=Lke;Nu.displayName="Portal";const[Vke,Fke]=Li({name:"ToastOptionsContext",strict:!1}),jke=n=>{const t=D.useSyncExternalStore(xh.subscribe,xh.getState,xh.getState),{motionVariants:s,component:a=See,portalProps:l,animatePresenceProps:d}=n,E=Object.keys(t).map(v=>{const b=t[v];return C.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:tke(v),children:C.jsx(w0,{...d,initial:!1,children:b.map(w=>C.jsx(a,{motionVariants:s,...w},w.id))})},v)});return C.jsx(Nu,{...l,children:E})},Bke=n=>function({children:s,theme:a=n,toastOptions:l,...d}){return C.jsxs(wCe,{theme:a,...d,children:[C.jsx(Vke,{value:l==null?void 0:l.defaultOptions,children:s}),C.jsx(jke,{...l})]})},Wke=Bke(mRe);function Pq(n){return n.sort((t,s)=>{const a=t.compareDocumentPosition(s);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const zke=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function Oq(n,t,s){let a=n+1;return s&&a>=t&&(a=0),a}function kq(n,t,s){let a=n-1;return s&&a<0&&(a=t),a}const aM=typeof window<"u"?D.useLayoutEffect:D.useEffect,Nq=n=>n;var Gke=Object.defineProperty,Hke=(n,t,s)=>t in n?Gke(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,Os=(n,t,s)=>(Hke(n,typeof t!="symbol"?t+"":t,s),s);class $ke{constructor(){Os(this,"descendants",new Map),Os(this,"register",t=>{if(t!=null)return zke(t)?this.registerNode(t):s=>{this.registerNode(s,t)}}),Os(this,"unregister",t=>{this.descendants.delete(t);const s=Pq(Array.from(this.descendants.keys()));this.assignIndex(s)}),Os(this,"destroy",()=>{this.descendants.clear()}),Os(this,"assignIndex",t=>{this.descendants.forEach(s=>{const a=t.indexOf(s.node);s.index=a,s.node.dataset.index=s.index.toString()})}),Os(this,"count",()=>this.descendants.size),Os(this,"enabledCount",()=>this.enabledValues().length),Os(this,"values",()=>Array.from(this.descendants.values()).sort((s,a)=>s.index-a.index)),Os(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),Os(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),Os(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),Os(this,"first",()=>this.item(0)),Os(this,"firstEnabled",()=>this.enabledItem(0)),Os(this,"last",()=>this.item(this.descendants.size-1)),Os(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),Os(this,"indexOf",t=>{var s;return t?((s=this.descendants.get(t))==null?void 0:s.index)??-1:-1}),Os(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(s=>s.node.isSameNode(t))),Os(this,"next",(t,s=!0)=>{const a=Oq(t,this.count(),s);return this.item(a)}),Os(this,"nextEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=Oq(l,this.enabledCount(),s);return this.enabledItem(d)}),Os(this,"prev",(t,s=!0)=>{const a=kq(t,this.count()-1,s);return this.item(a)}),Os(this,"prevEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=kq(l,this.enabledCount()-1,s);return this.enabledItem(d)}),Os(this,"registerNode",(t,s)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=Pq(a);s!=null&&s.disabled&&(s.disabled=!!s.disabled);const d={node:t,index:-1,...s};this.descendants.set(t,d),this.assignIndex(l)})}}function Aee(){const[n,t]=Li({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,t,()=>{const l=D.useRef(new $ke);return aM(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[f,E]=D.useState(-1),v=D.useRef(null);aM(()=>()=>{v.current&&d.unregister(v.current)},[]),aM(()=>{if(!v.current)return;const w=Number(v.current.dataset.index);f!=w&&!Number.isNaN(w)&&E(w)});const b=Nq(l?d.register(l):d.register);return{descendants:d,index:f,enabledIndex:d.enabledIndexOf(v.current),register:ns(b,v)}}]}const Dq={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},mE={enter:{duration:.2,ease:Dq.easeOut},exit:{duration:.1,ease:Dq.easeIn}},gE={enter:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.exit})},[Kke,qke]=Li({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function Yke(n){const t=n.trim().split(" "),s=t[0]??"",a=t.length>1?t[t.length-1]:"";return s&&a?`${s.charAt(0)}${a.charAt(0)}`:s.charAt(0)}function Pee(n){const{name:t,getInitials:s,...a}=n,l=qke();return C.jsx(Dt.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?s==null?void 0:s(t):null})}Pee.displayName="AvatarName";const Oee=n=>C.jsxs(Dt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[C.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),C.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function kee(n){const{loading:t,src:s,srcSet:a,onLoad:l,onError:d,crossOrigin:f,sizes:E,ignoreFallback:v}=n,[b,w]=D.useState("pending");D.useEffect(()=>{w(s?"loading":"pending")},[s]);const A=D.useRef(null),N=D.useCallback(()=>{if(!s)return;V();const j=new Image;j.src=s,f&&(j.crossOrigin=f),a&&(j.srcset=a),E&&(j.sizes=E),t&&(j.loading=t),j.onload=B=>{V(),w("loaded"),l==null||l(B)},j.onerror=B=>{V(),w("failed"),d==null||d(B)},A.current=j},[s,f,a,E,l,d,t]),V=()=>{A.current&&(A.current.onload=null,A.current.onerror=null,A.current=null)};return yf(()=>{if(!v)return b==="loading"&&N(),()=>{V()}},[b,N,v]),v?"loaded":b}const Xke=(n,t)=>n!=="loaded"&&t==="beforeLoadOrError"||n==="failed"&&t==="onError";function Nee(n){const{src:t,srcSet:s,onError:a,onLoad:l,getInitials:d,name:f,borderRadius:E,loading:v,iconLabel:b,icon:w=C.jsx(Oee,{}),ignoreFallback:A,referrerPolicy:N,crossOrigin:V}=n,B=kee({src:t,onError:a,crossOrigin:V,ignoreFallback:A})==="loaded";return!t||!B?f?C.jsx(Pee,{className:"chakra-avatar__initials",getInitials:d,name:f}):D.cloneElement(w,{role:"img","aria-label":b}):C.jsx(Dt.img,{src:t,srcSet:s,alt:f??b,onLoad:l,referrerPolicy:N,crossOrigin:V??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:E}})}Nee.displayName="AvatarImage";const Jke={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},Qh=Gt((n,t)=>{const s=gc("Avatar",n),[a,l]=D.useState(!1),{src:d,srcSet:f,name:E,showBorder:v,borderRadius:b="full",onError:w,onLoad:A,getInitials:N=Yke,icon:V=C.jsx(Oee,{}),iconLabel:j=" avatar",loading:B,children:H,borderColor:J,ignoreFallback:$,crossOrigin:te,referrerPolicy:ce,...oe}=Yi(n),_e={borderRadius:b,borderWidth:v?"2px":void 0,...Jke,...s.container};return J&&(_e.borderColor=J),C.jsx(Dt.span,{ref:t,...oe,className:hn("chakra-avatar",n.className),"data-loaded":Xn(a),__css:_e,children:C.jsxs(Kke,{value:s,children:[C.jsx(Nee,{src:d,srcSet:f,loading:B,onLoad:er(A,()=>{l(!0)}),onError:w,getInitials:N,name:E,borderRadius:b,icon:V,iconLabel:j,ignoreFallback:$,crossOrigin:te,referrerPolicy:ce}),H]})})});Qh.displayName="Avatar";const ff=Gt(function(t,s){const a=ku("Badge",t),{className:l,...d}=Yi(t);return C.jsx(Dt.span,{ref:s,className:hn("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});ff.displayName="Badge";const It=Dt("div");It.displayName="Box";const[w8e,Qke]=Li({strict:!1,name:"ButtonGroupContext"});function Pw(n){const{children:t,className:s,...a}=n,l=D.isValidElement(t)?D.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=hn("chakra-button__icon",s);return C.jsx(Dt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}Pw.displayName="ButtonIcon";function SU(n){const{label:t,placement:s,spacing:a="0.5rem",children:l=C.jsx(np,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:f,...E}=n,v=hn("chakra-button__spinner",d),b=s==="start"?"marginEnd":"marginStart",w=D.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[b]:t?a:0,fontSize:"1em",lineHeight:"normal",...f}),[f,t,b,a]);return C.jsx(Dt.div,{className:v,...E,__css:w,children:l})}SU.displayName="ButtonSpinner";function Zke(n){const[t,s]=D.useState(!n);return{ref:D.useCallback(d=>{d&&s(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const Ti=Gt((n,t)=>{const s=Qke(),a=ku("Button",{...s,...n}),{isDisabled:l=s==null?void 0:s.isDisabled,isLoading:d,isActive:f,children:E,leftIcon:v,rightIcon:b,loadingText:w,iconSpacing:A="0.5rem",type:N,spinner:V,spinnerPlacement:j="start",className:B,as:H,shouldWrapChildren:J,...$}=Yi(n),te=D.useMemo(()=>{const ne={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!s&&{_focus:ne}}},[a,s]),{ref:ce,type:oe}=Zke(H),_e={rightIcon:b,leftIcon:v,iconSpacing:A,children:E,shouldWrapChildren:J};return C.jsxs(Dt.button,{disabled:l||d,ref:DEe(t,ce),as:H,type:N??oe,"data-active":Xn(f),"data-loading":Xn(d),__css:te,className:hn("chakra-button",B),...$,children:[d&&j==="start"&&C.jsx(SU,{className:"chakra-button__spinner--start",label:w,placement:"start",spacing:A,children:V}),d?w||C.jsx(Dt.span,{opacity:0,children:C.jsx(Lq,{..._e})}):C.jsx(Lq,{..._e}),d&&j==="end"&&C.jsx(SU,{className:"chakra-button__spinner--end",label:w,placement:"end",spacing:A,children:V})]})});Ti.displayName="Button";function Lq(n){const{leftIcon:t,rightIcon:s,children:a,iconSpacing:l,shouldWrapChildren:d}=n;return d?C.jsxs("span",{style:{display:"contents"},children:[t&&C.jsx(Pw,{marginEnd:l,children:t}),a,s&&C.jsx(Pw,{marginStart:l,children:s})]}):C.jsxs(C.Fragment,{children:[t&&C.jsx(Pw,{marginEnd:l,children:t}),a,s&&C.jsx(Pw,{marginStart:l,children:s})]})}const No=Gt((n,t)=>{const{icon:s,children:a,isRound:l,"aria-label":d,...f}=n,E=s||a,v=D.isValidElement(E)?D.cloneElement(E,{"aria-hidden":!0,focusable:!1}):null;return C.jsx(Ti,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...f,children:v})});No.displayName="IconButton";const Dee=Dt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Dee.displayName="Center";const e1e={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Gt(function(t,s){const{axis:a="both",...l}=t;return C.jsx(Dt.div,{ref:s,__css:e1e[a],...l,position:"absolute"})});var t1e=()=>typeof document<"u",xq=!1,BR=null,bE=!1,bU=!1,TU=new Set;function DF(n,t){TU.forEach(s=>s(n,t))}var n1e=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function r1e(n){return!(n.metaKey||!n1e&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function Mq(n){bE=!0,r1e(n)&&(BR="keyboard",DF("keyboard",n))}function iS(n){if(BR="pointer",n.type==="mousedown"||n.type==="pointerdown"){bE=!0;const t=n.composedPath?n.composedPath()[0]:n.target;let s=!1;try{s=t.matches(":focus-visible")}catch{}if(s)return;DF("pointer",n)}}function i1e(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function s1e(n){i1e(n)&&(bE=!0,BR="virtual")}function o1e(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!bE&&!bU&&(BR="virtual",DF("virtual",n)),bE=!1,bU=!1)}function a1e(){bE=!1,bU=!0}function Uq(){return BR!=="pointer"}function c1e(){if(!t1e()||xq)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...s){bE=!0,n.apply(this,s)},document.addEventListener("keydown",Mq,!0),document.addEventListener("keyup",Mq,!0),document.addEventListener("click",s1e,!0),window.addEventListener("focus",o1e,!0),window.addEventListener("blur",a1e,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",iS,!0),document.addEventListener("pointermove",iS,!0),document.addEventListener("pointerup",iS,!0)):(document.addEventListener("mousedown",iS,!0),document.addEventListener("mousemove",iS,!0),document.addEventListener("mouseup",iS,!0)),xq=!0}function l1e(n){c1e(),n(Uq());const t=()=>n(Uq());return TU.add(t),()=>{TU.delete(t)}}const[u1e,Lee]=Li({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[d1e,A0]=Li({strict:!1,name:"FormControlContext"});function h1e(n){const{id:t,isRequired:s,isInvalid:a,isDisabled:l,isReadOnly:d,...f}=n,E=D.useId(),v=t||`field-${E}`,b=`${v}-label`,w=`${v}-feedback`,A=`${v}-helptext`,[N,V]=D.useState(!1),[j,B]=D.useState(!1),[H,J]=D.useState(!1),$=D.useCallback((ne={},ee=null)=>({id:A,...ne,ref:ns(ee,Q=>{Q&&B(!0)})}),[A]),te=D.useCallback((ne={},ee=null)=>({...ne,ref:ee,"data-focus":Xn(H),"data-disabled":Xn(l),"data-invalid":Xn(a),"data-readonly":Xn(d),id:ne.id!==void 0?ne.id:b,htmlFor:ne.htmlFor!==void 0?ne.htmlFor:v}),[v,l,H,a,d,b]),ce=D.useCallback((ne={},ee=null)=>({id:w,...ne,ref:ns(ee,Q=>{Q&&V(!0)}),"aria-live":"polite"}),[w]),oe=D.useCallback((ne={},ee=null)=>({...ne,...f,ref:ee,role:"group","data-focus":Xn(H),"data-disabled":Xn(l),"data-invalid":Xn(a),"data-readonly":Xn(d)}),[f,l,H,a,d]),_e=D.useCallback((ne={},ee=null)=>({...ne,ref:ee,role:"presentation","aria-hidden":!0,children:ne.children||"*"}),[]);return{isRequired:!!s,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!H,onFocus:()=>J(!0),onBlur:()=>J(!1),hasFeedbackText:N,setHasFeedbackText:V,hasHelpText:j,setHasHelpText:B,id:v,labelId:b,feedbackId:w,helpTextId:A,htmlProps:f,getHelpTextProps:$,getErrorMessageProps:ce,getRootProps:oe,getLabelProps:te,getRequiredIndicatorProps:_e}}const Ai=Gt(function(t,s){const a=gc("Form",t),l=Yi(t),{getRootProps:d,htmlProps:f,...E}=h1e(l),v=hn("chakra-form-control",t.className);return C.jsx(d1e,{value:E,children:C.jsx(u1e,{value:a,children:C.jsx(Dt.div,{...d({},s),className:v,__css:a.container})})})});Ai.displayName="FormControl";const wU=Gt(function(t,s){const a=A0(),l=Lee(),d=hn("chakra-form__helper-text",t.className);return C.jsx(Dt.div,{...a==null?void 0:a.getHelpTextProps(t,s),__css:l.helperText,className:d})});wU.displayName="FormHelperText";function LF(n){const{isDisabled:t,isInvalid:s,isReadOnly:a,isRequired:l,...d}=xee(n);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":DS(s),"aria-required":DS(l),"aria-readonly":DS(a)}}function xee(n){const t=A0(),{id:s,disabled:a,readOnly:l,required:d,isRequired:f,isInvalid:E,isReadOnly:v,isDisabled:b,onFocus:w,onBlur:A,...N}=n,V=n["aria-describedby"]?[n["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&V.push(t.feedbackId),t!=null&&t.hasHelpText&&V.push(t.helpTextId),{...N,"aria-describedby":V.join(" ")||void 0,id:s??(t==null?void 0:t.id),isDisabled:a??b??(t==null?void 0:t.isDisabled),isReadOnly:l??v??(t==null?void 0:t.isReadOnly),isRequired:d??f??(t==null?void 0:t.isRequired),isInvalid:E??(t==null?void 0:t.isInvalid),onFocus:er(t==null?void 0:t.onFocus,w),onBlur:er(t==null?void 0:t.onBlur,A)}}const p1e={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function f1e(n={}){const t=xee(n),{isDisabled:s,isReadOnly:a,isRequired:l,isInvalid:d,id:f,onBlur:E,onFocus:v,"aria-describedby":b}=t,{defaultChecked:w,isChecked:A,isFocusable:N,onChange:V,isIndeterminate:j,name:B,value:H,tabIndex:J=void 0,"aria-label":$,"aria-labelledby":te,"aria-invalid":ce,...oe}=n,_e=b0(oe,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),ne=tl(V),ee=tl(E),Q=tl(v),[se,pe]=D.useState(!1),[fe,ue]=D.useState(!1),[Me,He]=D.useState(!1),[nt,we]=D.useState(!1);D.useEffect(()=>l1e(pe),[]);const Ce=D.useRef(null),[ve,Ne]=D.useState(!0),[Te,be]=D.useState(!!w),Ae=A!==void 0,Ue=Ae?A:Te,Ge=D.useCallback($t=>{if(a||s){$t.preventDefault();return}Ae||be(Ue?$t.currentTarget.checked:j?!0:$t.currentTarget.checked),ne==null||ne($t)},[a,s,Ue,Ae,j,ne]);yf(()=>{Ce.current&&(Ce.current.indeterminate=!!j)},[j]),fg(()=>{s&&ue(!1)},[s,ue]),yf(()=>{const $t=Ce.current;if(!($t!=null&&$t.form))return;const zn=()=>{be(!!w)};return $t.form.addEventListener("reset",zn),()=>{var Bt;return(Bt=$t.form)==null?void 0:Bt.removeEventListener("reset",zn)}},[]);const Qe=s&&!N,tt=D.useCallback($t=>{$t.key===" "&&we(!0)},[we]),dt=D.useCallback($t=>{$t.key===" "&&we(!1)},[we]);yf(()=>{if(!Ce.current)return;Ce.current.checked!==Ue&&be(Ce.current.checked)},[Ce.current]);const Ze=D.useCallback(($t={},zn=null)=>{const Bt=Re=>{fe&&Re.preventDefault(),we(!0)};return{...$t,ref:zn,"data-active":Xn(nt),"data-hover":Xn(Me),"data-checked":Xn(Ue),"data-focus":Xn(fe),"data-focus-visible":Xn(fe&&se),"data-indeterminate":Xn(j),"data-disabled":Xn(s),"data-invalid":Xn(d),"data-readonly":Xn(a),"aria-hidden":!0,onMouseDown:er($t.onMouseDown,Bt),onMouseUp:er($t.onMouseUp,()=>we(!1)),onMouseEnter:er($t.onMouseEnter,()=>He(!0)),onMouseLeave:er($t.onMouseLeave,()=>He(!1))}},[nt,Ue,s,fe,se,Me,j,d,a]),wt=D.useCallback(($t={},zn=null)=>({...$t,ref:zn,"data-active":Xn(nt),"data-hover":Xn(Me),"data-checked":Xn(Ue),"data-focus":Xn(fe),"data-focus-visible":Xn(fe&&se),"data-indeterminate":Xn(j),"data-disabled":Xn(s),"data-invalid":Xn(d),"data-readonly":Xn(a)}),[nt,Ue,s,fe,se,Me,j,d,a]),un=D.useCallback(($t={},zn=null)=>({..._e,htmlFor:ve?f:void 0,...$t,ref:ns(zn,Bt=>{Bt&&Ne(Bt.tagName==="LABEL")}),onClick:er($t.onClick,()=>{var Bt;ve||((Bt=Ce.current)==null||Bt.click(),requestAnimationFrame(()=>{var Re;(Re=Ce.current)==null||Re.focus({preventScroll:!0})}))}),"data-disabled":Xn(s),"data-checked":Xn(Ue),"data-invalid":Xn(d)}),[_e,s,Ue,d,ve,f]),xt=D.useCallback(($t={},zn=null)=>({...$t,ref:ns(Ce,zn),type:"checkbox",name:B,value:H,id:f,tabIndex:J,onChange:er($t.onChange,Ge),onBlur:er($t.onBlur,ee,()=>ue(!1)),onFocus:er($t.onFocus,Q,()=>ue(!0)),onKeyDown:er($t.onKeyDown,tt),onKeyUp:er($t.onKeyUp,dt),required:l,checked:Ue,disabled:Qe,readOnly:a,"aria-label":$,"aria-labelledby":te,"aria-invalid":ce?!!ce:d,"aria-describedby":b,"aria-disabled":s,"aria-checked":j?"mixed":Ue,style:p1e}),[B,H,f,J,Ge,ee,Q,tt,dt,l,Ue,Qe,a,$,te,ce,d,b,s,j]),tn=D.useCallback(($t={},zn=null)=>({...$t,ref:zn,onMouseDown:er($t.onMouseDown,m1e),"data-disabled":Xn(s),"data-checked":Xn(Ue),"data-invalid":Xn(d)}),[Ue,s,d]);return{state:{isInvalid:d,isFocused:fe,isChecked:Ue,isActive:nt,isHovered:Me,isIndeterminate:j,isDisabled:s,isReadOnly:a,isRequired:l},getRootProps:un,getCheckboxProps:Ze,getIndicatorProps:wt,getInputProps:xt,getLabelProps:tn,htmlProps:_e}}function m1e(n){n.preventDefault(),n.stopPropagation()}const ag=Gt(function(t,s){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:f,borderWidth:E,borderStyle:v,borderColor:b,...w}=ku("Divider",t),{className:A,orientation:N="horizontal",__css:V,...j}=Yi(t),B={vertical:{borderLeftWidth:a||f||E||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||E||"1px",width:"100%"}};return C.jsx(Dt.hr,{ref:s,"aria-orientation":N,...j,__css:{...w,border:"0",borderColor:b,borderStyle:v,...B[N],...V},className:hn("chakra-divider",A)})});ag.displayName="Divider";const zs=Gt(function(t,s){const{direction:a,align:l,justify:d,wrap:f,basis:E,grow:v,shrink:b,...w}=t,A={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:f,flexBasis:E,flexGrow:v,flexShrink:b};return C.jsx(Dt.div,{ref:s,__css:A,...w})});zs.displayName="Flex";function g1e(n,t){if(n==null)return{};var s={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(t.indexOf(a)!==-1)continue;s[a]=n[a]}return s}var cM={exports:{}},lM,Vq;function _1e(){if(Vq)return lM;Vq=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return lM=n,lM}var uM,Fq;function E1e(){if(Fq)return uM;Fq=1;var n=_1e();function t(){}function s(){}return s.resetWarningCache=t,uM=function(){function a(f,E,v,b,w,A){if(A!==n){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:t};return d.PropTypes=d,d},uM}var jq;function y1e(){return jq||(jq=1,cM.exports=E1e()()),cM.exports}var v1e=y1e();const Lr=DE(v1e);var RU="data-focus-lock",Mee="data-focus-lock-disabled",S1e="data-no-focus-lock",b1e="data-autofocus-inside",T1e="data-no-autofocus";function dM(n,t){return typeof n=="function"?n(t):n&&(n.current=t),n}function w1e(n,t){var s=D.useState(function(){return{value:n,callback:t,facade:{get current(){return s.value},set current(a){var l=s.value;l!==a&&(s.value=a,s.callback(a,l))}}}})[0];return s.callback=t,s.facade}var R1e=typeof window<"u"?D.useLayoutEffect:D.useEffect,Bq=new WeakMap;function Uee(n,t){var s=w1e(null,function(a){return n.forEach(function(l){return dM(l,a)})});return R1e(function(){var a=Bq.get(s);if(a){var l=new Set(a),d=new Set(n),f=s.current;l.forEach(function(E){d.has(E)||dM(E,null)}),d.forEach(function(E){l.has(E)||dM(E,f)})}Bq.set(s,n)},[n]),s}var hM={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Mh=function(){return Mh=Object.assign||function(t){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(t[d]=s[d])}return t},Mh.apply(this,arguments)};function WR(n,t){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(s[a[l]]=n[a[l]]);return s}function C1e(n,t,s){if(s||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return n.concat(d||Array.prototype.slice.call(t))}function Vee(n){return n}function Fee(n,t){t===void 0&&(t=Vee);var s=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:n},useMedium:function(d){var f=t(d,a);return s.push(f),function(){s=s.filter(function(E){return E!==f})}},assignSyncMedium:function(d){for(a=!0;s.length;){var f=s;s=[],f.forEach(d)}s={push:function(E){return d(E)},filter:function(){return s}}},assignMedium:function(d){a=!0;var f=[];if(s.length){var E=s;s=[],E.forEach(d),f=s}var v=function(){var w=f;f=[],w.forEach(d)},b=function(){return Promise.resolve().then(v)};b(),s={push:function(w){f.push(w),b()},filter:function(w){return f=f.filter(w),s}}}};return l}function xF(n,t){return t===void 0&&(t=Vee),Fee(n,t)}function jee(n){n===void 0&&(n={});var t=Fee(null);return t.options=Mh({async:!0,ssr:!1},n),t}var Bee=function(n){var t=n.sideCar,s=WR(n,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return D.createElement(a,Mh({},s))};Bee.isSideCarExport=!0;function I1e(n,t){return n.useMedium(t),Bee}var Wee=xF({},function(n){var t=n.target,s=n.currentTarget;return{target:t,currentTarget:s}}),zee=xF(),A1e=xF(),P1e=jee({async:!0,ssr:typeof document<"u"}),O1e=D.createContext(void 0),k1e=[],MF=D.forwardRef(function(t,s){var a,l=D.useState(),d=l[0],f=l[1],E=D.useRef(),v=D.useRef(!1),b=D.useRef(null),w=D.useState({}),A=w[1],N=t.children,V=t.disabled,j=V===void 0?!1:V,B=t.noFocusGuards,H=B===void 0?!1:B,J=t.persistentFocus,$=J===void 0?!1:J,te=t.crossFrame,ce=te===void 0?!0:te,oe=t.autoFocus,_e=oe===void 0?!0:oe;t.allowTextSelection;var ne=t.group,ee=t.className,Q=t.whiteList,se=t.hasPositiveIndices,pe=t.shards,fe=pe===void 0?k1e:pe,ue=t.as,Me=ue===void 0?"div":ue,He=t.lockProps,nt=He===void 0?{}:He,we=t.sideCar,Ce=t.returnFocus,ve=Ce===void 0?!1:Ce,Ne=t.focusOptions,Te=t.onActivation,be=t.onDeactivation,Ae=D.useState({}),Ue=Ae[0],Ge=D.useCallback(function(zn){var Bt=zn.captureFocusRestore;if(!b.current){var Re,Fe=(Re=document)==null?void 0:Re.activeElement;b.current=Fe,Fe!==document.body&&(b.current=Bt(Fe))}E.current&&Te&&Te(E.current),v.current=!0,A()},[Te]),Qe=D.useCallback(function(){v.current=!1,be&&be(E.current),A()},[be]),tt=D.useCallback(function(zn){var Bt=b.current;if(Bt){var Re=(typeof Bt=="function"?Bt():Bt)||document.body,Fe=typeof ve=="function"?ve(Re):ve;if(Fe){var We=typeof Fe=="object"?Fe:void 0;b.current=null,zn?Promise.resolve().then(function(){return Re.focus(We)}):Re.focus(We)}}},[ve]),dt=D.useCallback(function(zn){v.current&&Wee.useMedium(zn)},[]),Ze=zee.useMedium,wt=D.useCallback(function(zn){E.current!==zn&&(E.current=zn,f(zn))},[]),un=SE((a={},a[Mee]=j&&"disabled",a[RU]=ne,a),nt),xt=H!==!0,tn=xt&&H!=="tail",kn=Uee([s,wt]),$t=D.useMemo(function(){return{observed:E,shards:fe,enabled:!j,active:v.current}},[j,v.current,fe,d]);return si.createElement(D.Fragment,null,xt&&[si.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:j?-1:0,style:hM}),se?si.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:j?-1:1,style:hM}):null],!j&&si.createElement(we,{id:Ue,sideCar:P1e,observed:d,disabled:j,persistentFocus:$,crossFrame:ce,autoFocus:_e,whiteList:Q,shards:fe,onActivation:Ge,onDeactivation:Qe,returnFocus:tt,focusOptions:Ne,noFocusGuards:H}),si.createElement(Me,SE({ref:kn},un,{className:ee,onBlur:Ze,onFocus:dt}),si.createElement(O1e.Provider,{value:$t},N)),tn&&si.createElement("div",{"data-focus-guard":!0,tabIndex:j?-1:0,style:hM}))});MF.propTypes={};function CU(n,t){return CU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},CU(n,t)}function N1e(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,CU(n,t)}function _R(n){"@babel/helpers - typeof";return _R=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_R(n)}function D1e(n,t){if(_R(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var a=s.call(n,t);if(_R(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function L1e(n){var t=D1e(n,"string");return _R(t)=="symbol"?t:t+""}function x1e(n,t,s){return(t=L1e(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function M1e(n,t){function s(a){return a.displayName||a.name||"Component"}return function(l){var d=[],f;function E(){f=n(d.map(function(b){return b.props})),t(f)}var v=function(b){N1e(w,b);function w(){return b.apply(this,arguments)||this}w.peek=function(){return f};var A=w.prototype;return A.componentDidMount=function(){d.push(this),E()},A.componentDidUpdate=function(){E()},A.componentWillUnmount=function(){var V=d.indexOf(this);d.splice(V,1),E()},A.render=function(){return si.createElement(l,this.props)},w}(D.PureComponent);return x1e(v,"displayName","SideEffect("+s(l)+")"),v}}var rp=function(n){for(var t=Array(n.length),s=0;s<n.length;++s)t[s]=n[s];return t},TE=function(n){return Array.isArray(n)?n:[n]},Gee=function(n){return Array.isArray(n)?n[0]:n},U1e=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(n,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},Hee=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},$ee=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},V1e=function(n){return n.hasAttribute("inert")},F1e=function(n,t){return!n||$ee(n)||!U1e(n)&&!V1e(n)&&t(Hee(n))},Kee=function(n,t){var s=n.get(t);if(s!==void 0)return s;var a=F1e(t,Kee.bind(void 0,n));return n.set(t,a),a},j1e=function(n,t){return n&&!$ee(n)?z1e(n)?t(Hee(n)):!1:!0},qee=function(n,t){var s=n.get(t);if(s!==void 0)return s;var a=j1e(t,qee.bind(void 0,n));return n.set(t,a),a},Yee=function(n){return n.dataset},B1e=function(n){return n.tagName==="BUTTON"},Xee=function(n){return n.tagName==="INPUT"},Jee=function(n){return Xee(n)&&n.type==="radio"},W1e=function(n){return!((Xee(n)||B1e(n))&&(n.type==="hidden"||n.disabled))},z1e=function(n){var t=n.getAttribute(T1e);return![!0,"true",""].includes(t)},UF=function(n){var t;return!!(n&&(!((t=Yee(n))===null||t===void 0)&&t.focusGuard))},IU=function(n){return!UF(n)},G1e=function(n){return!!n},H1e=function(n,t){var s=Math.max(0,n.tabIndex),a=Math.max(0,t.tabIndex),l=s-a,d=n.index-t.index;if(l){if(!s)return 1;if(!a)return-1}return l||d},$1e=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},VF=function(n,t,s){return rp(n).map(function(a,l){var d=$1e(a);return{node:a,index:l,tabIndex:s&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(H1e)},K1e=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],FF=K1e.join(","),q1e="".concat(FF,", [data-focus-guard]"),Qee=function(n,t){return rp((n.shadowRoot||n).children).reduce(function(s,a){return s.concat(a.matches(t?q1e:FF)?[a]:[],Qee(a))},[])},Y1e=function(n,t){var s;return n instanceof HTMLIFrameElement&&(!((s=n.contentDocument)===null||s===void 0)&&s.body)?s0([n.contentDocument.body],t):[n]},s0=function(n,t){return n.reduce(function(s,a){var l,d=Qee(a,t),f=(l=[]).concat.apply(l,d.map(function(E){return Y1e(E,t)}));return s.concat(f,a.parentNode?rp(a.parentNode.querySelectorAll(FF)).filter(function(E){return E===a}):[])},[])},X1e=function(n){var t=n.querySelectorAll("[".concat(b1e,"]"));return rp(t).map(function(s){return s0([s])}).reduce(function(s,a){return s.concat(a)},[])},jF=function(n,t){return rp(n).filter(function(s){return Kee(t,s)}).filter(function(s){return W1e(s)})},Wq=function(n,t){return t===void 0&&(t=new Map),rp(n).filter(function(s){return qee(t,s)})},BF=function(n,t,s){return VF(jF(s0(n,s),t),!0,s)},ER=function(n,t){return VF(jF(s0(n),t),!1)},J1e=function(n,t){return jF(X1e(n),t)},_E=function(n,t){return n.shadowRoot?_E(n.shadowRoot,t):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,t)?!0:rp(n.children).some(function(s){var a;if(s instanceof HTMLIFrameElement){var l=(a=s.contentDocument)===null||a===void 0?void 0:a.body;return l?_E(l,t):!1}return _E(s,t)})},Q1e=function(n){for(var t=new Set,s=n.length,a=0;a<s;a+=1)for(var l=a+1;l<s;l+=1){var d=n[a].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return n.filter(function(f,E){return!t.has(E)})},Zee=function(n){return n.parentNode?Zee(n.parentNode):n},WF=function(n){var t=TE(n);return t.filter(Boolean).reduce(function(s,a){var l=a.getAttribute(RU);return s.push.apply(s,l?Q1e(rp(Zee(a).querySelectorAll("[".concat(RU,'="').concat(l,'"]:not([').concat(Mee,'="disabled"])')))):[a]),s},[])},Z1e=function(n){try{return n()}catch{return}},yR=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var t=n.activeElement;return t.shadowRoot?yR(t.shadowRoot):t instanceof HTMLIFrameElement&&Z1e(function(){return t.contentWindow.document})?yR(t.contentWindow.document):t}},eNe=function(n,t){return n===t},tNe=function(n,t){return!!rp(n.querySelectorAll("iframe")).some(function(s){return eNe(s,t)})},ete=function(n,t){return t===void 0&&(t=yR(Gee(n).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:WF(n).some(function(s){return _E(s,t)||tNe(s,t)})},nNe=function(n){n===void 0&&(n=document);var t=yR(n);return t?rp(n.querySelectorAll("[".concat(S1e,"]"))).some(function(s){return _E(s,t)}):!1},rNe=function(n,t){return t.filter(Jee).filter(function(s){return s.name===n.name}).filter(function(s){return s.checked})[0]||n},zF=function(n,t){return Jee(n)&&n.name?rNe(n,t):n},iNe=function(n){var t=new Set;return n.forEach(function(s){return t.add(zF(s,n))}),n.filter(function(s){return t.has(s)})},zq=function(n){return n[0]&&n.length>1?zF(n[0],n):n[0]},Gq=function(n,t){return n.indexOf(zF(t,n))},AU="NEW_FOCUS",sNe=function(n,t,s,a,l){var d=n.length,f=n[0],E=n[d-1],v=UF(a);if(!(a&&n.indexOf(a)>=0)){var b=a!==void 0?s.indexOf(a):-1,w=l?s.indexOf(l):b,A=l?n.indexOf(l):-1;if(b===-1)return A!==-1?A:AU;if(A===-1)return AU;var N=b-w,V=s.indexOf(f),j=s.indexOf(E),B=iNe(s),H=a!==void 0?B.indexOf(a):-1,J=l?B.indexOf(l):H,$=B.filter(function(ee){return ee.tabIndex>=0}),te=a!==void 0?$.indexOf(a):-1,ce=l?$.indexOf(l):te,oe=te>=0&&ce>=0?ce-te:J-H;if(!N&&A>=0||t.length===0)return A;var _e=Gq(n,t[0]),ne=Gq(n,t[t.length-1]);if(b<=V&&v&&Math.abs(N)>1)return ne;if(b>=j&&v&&Math.abs(N)>1)return _e;if(N&&Math.abs(oe)>1)return A;if(b<=V)return ne;if(b>j)return _e;if(N)return Math.abs(N)>1?A:(d+A+N)%d}},oNe=function(n){return function(t){var s,a=(s=Yee(t))===null||s===void 0?void 0:s.autofocus;return t.autofocus||a!==void 0&&a!=="false"||n.indexOf(t)>=0}},Hq=function(n,t,s){var a=n.map(function(d){var f=d.node;return f}),l=Wq(a.filter(oNe(s)));return l&&l.length?zq(l):zq(Wq(t))},PU=function(n,t){return t===void 0&&(t=[]),t.push(n),n.parentNode&&PU(n.parentNode.host||n.parentNode,t),t},pM=function(n,t){for(var s=PU(n),a=PU(t),l=0;l<s.length;l+=1){var d=s[l];if(a.indexOf(d)>=0)return d}return!1},tte=function(n,t,s){var a=TE(n),l=TE(t),d=a[0],f=!1;return l.filter(Boolean).forEach(function(E){f=pM(f||E,E)||f,s.filter(Boolean).forEach(function(v){var b=pM(d,v);b&&(!f||_E(b,f)?f=b:f=pM(b,f))})}),f},$q=function(n,t){return n.reduce(function(s,a){return s.concat(J1e(a,t))},[])},aNe=function(n,t){var s=new Map;return t.forEach(function(a){return s.set(a.node,a)}),n.map(function(a){return s.get(a)}).filter(G1e)},cNe=function(n,t){var s=yR(TE(n).length>0?document:Gee(n).ownerDocument),a=WF(n).filter(IU),l=tte(s||n,n,a),d=new Map,f=ER(a,d),E=f.filter(function(j){var B=j.node;return IU(B)});if(E[0]){var v=ER([l],d).map(function(j){var B=j.node;return B}),b=aNe(v,E),w=b.map(function(j){var B=j.node;return B}),A=b.filter(function(j){var B=j.tabIndex;return B>=0}).map(function(j){var B=j.node;return B}),N=sNe(w,A,v,s,t);if(N===AU){var V=Hq(f,A,$q(a,d))||Hq(f,w,$q(a,d));if(V)return{node:V};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:b[N]}},lNe=function(n){var t=WF(n).filter(IU),s=tte(n,n,t),a=VF(s0([s],!0),!0,!0),l=s0(t,!1);return a.map(function(d){var f=d.node,E=d.index;return{node:f,index:E,lockItem:l.indexOf(f)>=0,guard:UF(f)}})},GF=function(n,t){n&&("focus"in n&&n.focus(t),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},fM=0,mM=!1,nte=function(n,t,s){s===void 0&&(s={});var a=cNe(n,t);if(!mM&&a){if(fM>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),mM=!0,setTimeout(function(){mM=!1},1);return}fM++,GF(a.node,s.focusOptions),fM--}};function ow(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var t=n?new WeakRef(n):null;return function(){return(t==null?void 0:t.deref())||null}}var uNe=function(n){if(!n)return null;for(var t=[],s=n;s&&s!==document.body;)t.push({current:ow(s),parent:ow(s.parentElement),left:ow(s.previousElementSibling),right:ow(s.nextElementSibling)}),s=s.parentElement;return{element:ow(n),stack:t,ownerDocument:n.ownerDocument}},dNe=function(n){var t,s,a,l,d;if(n)for(var f=n.stack,E=n.ownerDocument,v=new Map,b=0,w=f;b<w.length;b++){var A=w[b],N=(t=A.parent)===null||t===void 0?void 0:t.call(A);if(N&&E.contains(N)){for(var V=(s=A.left)===null||s===void 0?void 0:s.call(A),j=A.current(),B=N.contains(j)?j:void 0,H=(a=A.right)===null||a===void 0?void 0:a.call(A),J=BF([N],v),$=(d=(l=B??(V==null?void 0:V.nextElementSibling))!==null&&l!==void 0?l:H)!==null&&d!==void 0?d:V;$;){for(var te=0,ce=J;te<ce.length;te++){var oe=ce[te];if($!=null&&$.contains(oe.node))return oe.node}$=$.nextElementSibling}if(J.length)return J[0].node}}},rte=function(n){var t=uNe(n);return function(){return dNe(t)}},hNe=function(n,t,s){if(!n||!t)return console.error("no element or scope given"),{};var a=TE(t);if(a.every(function(f){return!_E(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=s?BF(a,new Map):ER(a,new Map),d=l.findIndex(function(f){var E=f.node;return E===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},pNe=function(n,t){var s=t?BF(TE(n),new Map):ER(TE(n),new Map);return{first:s[0],last:s[s.length-1]}},fNe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},ite=function(n,t,s){t===void 0&&(t={});var a=fNe(t),l=hNe(n,a.scope,a.onlyTabbable);if(l){var d=s(l,a.cycle);d&&GF(d.node,a.focusOptions)}},mNe=function(n,t){t===void 0&&(t={}),ite(n,t,function(s,a){var l=s.next,d=s.first;return l||a&&d})},gNe=function(n,t){t===void 0&&(t={}),ite(n,t,function(s,a){var l=s.prev,d=s.last;return l||a&&d})},ste=function(n,t,s){var a,l=pNe(n,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[s];d&&GF(d.node,t.focusOptions)},_Ne=function(n,t){t===void 0&&(t={}),ste(n,t,"first")},ENe=function(n,t){t===void 0&&(t={}),ste(n,t,"last")};function HF(n){setTimeout(n,1)}var yNe=function(t){return t&&"current"in t?t.current:t},ote=function(){return document&&document.activeElement===document.body},vNe=function(){return ote()||nNe()},WS=null,Yc=null,Kq=function(){return null},zS=null,vR=!1,$F=!1,SNe=function(){return!0},bNe=function(t){return(WS.whiteList||SNe)(t)},TNe=function(t,s){zS={observerNode:t,portaledElement:s}},wNe=function(t){return zS&&zS.portaledElement===t};function qq(n,t,s,a){var l=null,d=n;do{var f=a[d];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(d!==n)return;l=null}else break}while((d+=s)!==t);l&&(l.node.tabIndex=0)}var RNe=function(t){return t?!!vR:vR==="meanwhile"},CNe=function n(t,s,a){return s&&(s.host===t&&(!s.activeElement||a.contains(s.activeElement))||s.parentNode&&n(t,s.parentNode,a))},INe=function(t,s){return s.some(function(a){return CNe(t,a,a)})},ate=function(t){return ER(t,new Map)},ANe=function(t){return!ate([t.parentNode]).some(function(s){return s.node===t})},pk=function(){var t=!1;if(WS){var s=WS,a=s.observed,l=s.persistentFocus,d=s.autoFocus,f=s.shards,E=s.crossFrame,v=s.focusOptions,b=s.noFocusGuards,w=a||zS&&zS.portaledElement;if(ote()&&Yc&&Yc!==document.body&&(!document.body.contains(Yc)||ANe(Yc))){var A=Kq();A&&A.focus()}var N=document&&document.activeElement;if(w){var V=[w].concat(f.map(yNe).filter(Boolean)),j=function(){if(!RNe(E)||!b||!Yc||$F)return!1;var te=ate(V),ce=te.findIndex(function(oe){var _e=oe.node;return _e===Yc});return ce===0||ce===te.length-1};if((!N||bNe(N))&&(l||j()||!vNe()||!Yc&&d)&&(w&&!(ete(V)||N&&INe(N,V)||wNe(N))&&(document&&!Yc&&N&&!d?(N.blur&&N.blur(),document.body.focus()):(t=nte(V,Yc,{focusOptions:v}),zS={})),Yc=document&&document.activeElement,Yc!==document.body&&(Kq=rte(Yc)),vR=!1),document&&N!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var B=document&&document.activeElement,H=lNe(V),J=H.map(function($){var te=$.node;return te}).indexOf(B);J>-1&&(H.filter(function($){var te=$.guard,ce=$.node;return te&&ce.dataset.focusAutoGuard}).forEach(function($){var te=$.node;return te.removeAttribute("tabIndex")}),qq(J,H.length,1,H),qq(J,-1,-1,H))}}}return t},cte=function(t){pk()&&t&&(t.stopPropagation(),t.preventDefault())},KF=function(){return HF(pk)},PNe=function(t){var s=t.target,a=t.currentTarget;a.contains(s)||TNe(a,s)},ONe=function(){return null},lte=function(){$F=!0},ute=function(){$F=!1,vR="just",HF(function(){vR="meanwhile"})},kNe=function(){document.addEventListener("focusin",cte),document.addEventListener("focusout",KF),window.addEventListener("focus",lte),window.addEventListener("blur",ute)},NNe=function(){document.removeEventListener("focusin",cte),document.removeEventListener("focusout",KF),window.removeEventListener("focus",lte),window.removeEventListener("blur",ute)};function DNe(n){return n.filter(function(t){var s=t.disabled;return!s})}var dte={moveFocusInside:nte,focusInside:ete,focusNextElement:mNe,focusPrevElement:gNe,focusFirstElement:_Ne,focusLastElement:ENe,captureFocusRestore:rte};function LNe(n){var t=n.slice(-1)[0];t&&!WS&&kNe();var s=WS,a=s&&t&&t.id===s.id;WS=t,s&&!a&&(s.onDeactivation(),n.filter(function(l){var d=l.id;return d===s.id}).length||s.returnFocus(!t)),t?(Yc=null,(!a||s.observed!==t.observed)&&t.onActivation(dte),pk(),HF(pk)):(NNe(),Yc=null)}Wee.assignSyncMedium(PNe);zee.assignMedium(KF);A1e.assignMedium(function(n){return n(dte)});const xNe=M1e(DNe,LNe)(ONe);var OU=D.forwardRef(function(t,s){return si.createElement(MF,SE({sideCar:xNe,ref:s},t))}),hte=MF.propTypes||{};hte.sideCar;g1e(hte,["sideCar"]);OU.propTypes={};const MNe=OU.default??OU,pte=n=>{const{initialFocusRef:t,finalFocusRef:s,contentRef:a,restoreFocus:l,children:d,isDisabled:f,autoFocus:E,persistentFocus:v,lockFocusAcrossFrames:b}=n,w=D.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&JJ(a.current).length===0&&requestAnimationFrame(()=>{var j;(j=a.current)==null||j.focus()})},[t,a]),A=D.useCallback(()=>{var V;(V=s==null?void 0:s.current)==null||V.focus()},[s]),N=l&&!s;return C.jsx(MNe,{crossFrame:b,persistentFocus:v,autoFocus:E,disabled:f,onActivation:w,onDeactivation:A,returnFocus:N,children:d})};pte.displayName="FocusLock";const[UNe,VNe]=Li({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),af=Gt((n,t)=>{const s=gc("FormError",n),a=Yi(n),l=A0();return l!=null&&l.isInvalid?C.jsx(UNe,{value:s,children:C.jsx(Dt.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:hn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...s.text}})}):null});af.displayName="FormErrorMessage";const FNe=Gt((n,t)=>{const s=VNe(),a=A0();if(!(a!=null&&a.isInvalid))return null;const l=hn("chakra-form__error-icon",n.className);return C.jsx(Ln,{ref:t,"aria-hidden":!0,...n,__css:s.icon,className:l,children:C.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});FNe.displayName="FormErrorIcon";const Ba=Gt(function(t,s){const a=ku("FormLabel",t),l=Yi(t),{className:d,children:f,requiredIndicator:E=C.jsx(fte,{}),optionalIndicator:v=null,...b}=l,w=A0(),A=(w==null?void 0:w.getLabelProps(b,s))??{ref:s,...b};return C.jsxs(Dt.label,{...A,className:hn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[f,w!=null&&w.isRequired?E:v]})});Ba.displayName="FormLabel";const fte=Gt(function(t,s){const a=A0(),l=Lee();if(!(a!=null&&a.isRequired))return null;const d=hn("chakra-form__required-indicator",t.className);return C.jsx(Dt.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,s),__css:l.requiredIndicator,className:d})});fte.displayName="RequiredIndicator";const mte=Gt(function(t,s){const{templateAreas:a,gap:l,rowGap:d,columnGap:f,column:E,row:v,autoFlow:b,autoRows:w,templateRows:A,autoColumns:N,templateColumns:V,...j}=t,B={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:f,gridAutoColumns:N,gridColumn:E,gridRow:v,gridAutoFlow:b,gridAutoRows:w,gridTemplateRows:A,gridTemplateColumns:V};return C.jsx(Dt.div,{ref:s,__css:B,...j})});mte.displayName="Grid";const gte=Gt(function(t,s){const{columns:a,spacingX:l,spacingY:d,spacing:f,minChildWidth:E,...v}=t,b=I0(),w=E?BNe(E,b):WNe(a);return C.jsx(mte,{ref:s,gap:f,columnGap:l,rowGap:d,templateColumns:w,...v})});gte.displayName="SimpleGrid";function jNe(n){return typeof n=="number"?`${n}px`:n}function BNe(n,t){return PV(n,s=>{const a=vke("sizes",s,jNe(s))(t);return s===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function WNe(n){return PV(n,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function Cg(n){const{viewBox:t="0 0 24 24",d:s,displayName:a,defaultProps:l={}}=n,d=D.Children.toArray(n.path),f=Gt((E,v)=>C.jsx(Ln,{ref:v,viewBox:t,...l,...E,children:d.length?d:C.jsx("path",{fill:"currentColor",d:s})}));return f.displayName=a,f}const kU=Gt(function(t,s){const{htmlWidth:a,htmlHeight:l,alt:d,...f}=t;return C.jsx("img",{width:a,height:l,ref:s,alt:d,...f})});kU.displayName="NativeImage";const Fh=Gt(function(t,s){const{fallbackSrc:a,fallback:l,src:d,srcSet:f,align:E,fit:v,loading:b,ignoreFallback:w,crossOrigin:A,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:V,...j}=t,B=a!==void 0||l!==void 0,H=b!=null||w||!B,J=kee({...t,crossOrigin:A,ignoreFallback:H}),$=Xke(J,N),te={ref:s,objectFit:v,objectPosition:E,...H?j:b0(j,["onError","onLoad"])};return $?l||C.jsx(Dt.img,{as:kU,className:"chakra-image__placeholder",src:a,...te}):C.jsx(Dt.img,{as:kU,src:d,srcSet:f,crossOrigin:A,loading:b,referrerPolicy:V,className:"chakra-image",...te})});Fh.displayName="Image";const ds=Gt(function(t,s){const{htmlSize:a,...l}=t,d=gc("Input",l),f=Yi(l),E=LF(f),v=hn("chakra-input",t.className);return C.jsx(Dt.input,{size:a,...E,__css:d.field,ref:s,className:v})});ds.displayName="Input";ds.id="Input";const[zNe,GNe]=Li({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),GS=Gt(function(t,s){const a=gc("Input",t),{children:l,className:d,...f}=Yi(t),E=hn("chakra-input__group",d),v={},b=IV(l),w=a.field;b.forEach(N=>{a&&(w&&N.type.id==="InputLeftElement"&&(v.paddingStart=w.height??w.h),w&&N.type.id==="InputRightElement"&&(v.paddingEnd=w.height??w.h),N.type.id==="InputRightAddon"&&(v.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const A=b.map(N=>{var j,B;const V=Gk({size:((j=N.props)==null?void 0:j.size)||t.size,variant:((B=N.props)==null?void 0:B.variant)||t.variant});return N.type.id!=="Input"?D.cloneElement(N,V):D.cloneElement(N,Object.assign(V,v,N.props))});return C.jsx(Dt.div,{className:E,ref:s,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...f,children:C.jsx(zNe,{value:a,children:A})})});GS.displayName="InputGroup";const HNe=Dt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),o1=Gt(function(t,s){const{placement:a="left",...l}=t,d=GNe(),f=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...d.element};return C.jsx(HNe,{ref:s,__css:v,...l})});o1.id="InputElement";o1.displayName="InputElement";const qw=Gt(function(t,s){const{className:a,...l}=t,d=hn("chakra-input__left-element",a);return C.jsx(o1,{ref:s,placement:"left",className:d,...l})});qw.id="InputLeftElement";qw.displayName="InputLeftElement";const fk=Gt(function(t,s){const{className:a,...l}=t,d=hn("chakra-input__right-element",a);return C.jsx(o1,{ref:s,placement:"right",className:d,...l})});fk.id="InputRightElement";fk.displayName="InputRightElement";const Ru=Gt(function(t,s){const a=ku("Link",t),{className:l,isExternal:d,...f}=Yi(t);return C.jsx(Dt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:s,className:hn("chakra-link",l),...f,__css:a})});Ru.displayName="Link";function $Ne(n,t={}){const{ssr:s=!0,fallback:a}=t,{getWindow:l}=TCe(),d=Array.isArray(n)?n:[n];let f=Array.isArray(a)?a:[a];f=f.filter(b=>b!=null);const[E,v]=D.useState(()=>d.map((b,w)=>({media:b,matches:s?!!f[w]:l().matchMedia(b).matches})));return D.useEffect(()=>{const b=l();v(d.map(N=>({media:N,matches:b.matchMedia(N).matches})));const w=d.map(N=>b.matchMedia(N)),A=N=>{v(V=>V.slice().map(j=>j.media===N.media?{...j,matches:N.matches}:j))};return w.forEach(N=>{typeof N.addListener=="function"?N.addListener(A):N.addEventListener("change",A)}),()=>{w.forEach(N=>{typeof N.removeListener=="function"?N.removeListener(A):N.removeEventListener("change",A)})}},[l]),E.map(b=>b.matches)}function KNe(n,t,s,a){if(t==null)return a;if(!a)return n.find(f=>s(f).toLowerCase().startsWith(t.toLowerCase()));const l=n.filter(d=>s(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return a}function qNe(n){const{key:t}=n;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function YNe(n={}){const{timeout:t=300,preventDefault:s=()=>!0}=n,[a,l]=D.useState([]),d=D.useRef(void 0),f=()=>{d.current&&(clearTimeout(d.current),d.current=null)},E=()=>{f(),d.current=setTimeout(()=>{l([]),d.current=null},t)};D.useEffect(()=>f,[]);function v(b){return w=>{if(w.key==="Backspace"){const A=[...a];A.pop(),l(A);return}if(qNe(w)){const A=a.concat(w.key);s(w)&&(w.preventDefault(),w.stopPropagation()),l(A),b(A.join("")),E()}}}return v}var nl="top",Pu="bottom",Ou="right",rl="left",qF="auto",zR=[nl,Pu,Ou,rl],o0="start",SR="end",XNe="clippingParents",_te="viewport",aw="popper",JNe="reference",Yq=zR.reduce(function(n,t){return n.concat([t+"-"+o0,t+"-"+SR])},[]),Ete=[].concat(zR,[qF]).reduce(function(n,t){return n.concat([t,t+"-"+o0,t+"-"+SR])},[]),QNe="beforeRead",ZNe="read",eDe="afterRead",tDe="beforeMain",nDe="main",rDe="afterMain",iDe="beforeWrite",sDe="write",oDe="afterWrite",aDe=[QNe,ZNe,eDe,tDe,nDe,rDe,iDe,sDe,oDe];function Zh(n){return n?(n.nodeName||"").toLowerCase():null}function Vl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var t=n.ownerDocument;return t&&t.defaultView||window}return n}function wE(n){var t=Vl(n).Element;return n instanceof t||n instanceof Element}function Iu(n){var t=Vl(n).HTMLElement;return n instanceof t||n instanceof HTMLElement}function YF(n){if(typeof ShadowRoot>"u")return!1;var t=Vl(n).ShadowRoot;return n instanceof t||n instanceof ShadowRoot}function cDe(n){var t=n.state;Object.keys(t.elements).forEach(function(s){var a=t.styles[s]||{},l=t.attributes[s]||{},d=t.elements[s];!Iu(d)||!Zh(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(f){var E=l[f];E===!1?d.removeAttribute(f):d.setAttribute(f,E===!0?"":E)}))})}function lDe(n){var t=n.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},f=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:s[a]),E=f.reduce(function(v,b){return v[b]="",v},{});!Iu(l)||!Zh(l)||(Object.assign(l.style,E),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const uDe={name:"applyStyles",enabled:!0,phase:"write",fn:cDe,effect:lDe,requires:["computeStyles"]};function $h(n){return n.split("-")[0]}var EE=Math.max,mk=Math.min,a0=Math.round;function NU(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function yte(){return!/^((?!chrome|android).)*safari/i.test(NU())}function c0(n,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var a=n.getBoundingClientRect(),l=1,d=1;t&&Iu(n)&&(l=n.offsetWidth>0&&a0(a.width)/n.offsetWidth||1,d=n.offsetHeight>0&&a0(a.height)/n.offsetHeight||1);var f=wE(n)?Vl(n):window,E=f.visualViewport,v=!yte()&&s,b=(a.left+(v&&E?E.offsetLeft:0))/l,w=(a.top+(v&&E?E.offsetTop:0))/d,A=a.width/l,N=a.height/d;return{width:A,height:N,top:w,right:b+A,bottom:w+N,left:b,x:b,y:w}}function XF(n){var t=c0(n),s=n.offsetWidth,a=n.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:n.offsetLeft,y:n.offsetTop,width:s,height:a}}function vte(n,t){var s=t.getRootNode&&t.getRootNode();if(n.contains(t))return!0;if(s&&YF(s)){var a=t;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Of(n){return Vl(n).getComputedStyle(n)}function dDe(n){return["table","td","th"].indexOf(Zh(n))>=0}function Ig(n){return((wE(n)?n.ownerDocument:n.document)||window.document).documentElement}function a1(n){return Zh(n)==="html"?n:n.assignedSlot||n.parentNode||(YF(n)?n.host:null)||Ig(n)}function Xq(n){return!Iu(n)||Of(n).position==="fixed"?null:n.offsetParent}function hDe(n){var t=/firefox/i.test(NU()),s=/Trident/i.test(NU());if(s&&Iu(n)){var a=Of(n);if(a.position==="fixed")return null}var l=a1(n);for(YF(l)&&(l=l.host);Iu(l)&&["html","body"].indexOf(Zh(l))<0;){var d=Of(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function GR(n){for(var t=Vl(n),s=Xq(n);s&&dDe(s)&&Of(s).position==="static";)s=Xq(s);return s&&(Zh(s)==="html"||Zh(s)==="body"&&Of(s).position==="static")?t:s||hDe(n)||t}function JF(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function Yw(n,t,s){return EE(n,mk(t,s))}function pDe(n,t,s){var a=Yw(n,t,s);return a>s?s:a}function Ste(){return{top:0,right:0,bottom:0,left:0}}function bte(n){return Object.assign({},Ste(),n)}function Tte(n,t){return t.reduce(function(s,a){return s[a]=n,s},{})}var fDe=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,bte(typeof t!="number"?t:Tte(t,zR))};function mDe(n){var t,s=n.state,a=n.name,l=n.options,d=s.elements.arrow,f=s.modifiersData.popperOffsets,E=$h(s.placement),v=JF(E),b=[rl,Ou].indexOf(E)>=0,w=b?"height":"width";if(!(!d||!f)){var A=fDe(l.padding,s),N=XF(d),V=v==="y"?nl:rl,j=v==="y"?Pu:Ou,B=s.rects.reference[w]+s.rects.reference[v]-f[v]-s.rects.popper[w],H=f[v]-s.rects.reference[v],J=GR(d),$=J?v==="y"?J.clientHeight||0:J.clientWidth||0:0,te=B/2-H/2,ce=A[V],oe=$-N[w]-A[j],_e=$/2-N[w]/2+te,ne=Yw(ce,_e,oe),ee=v;s.modifiersData[a]=(t={},t[ee]=ne,t.centerOffset=ne-_e,t)}}function gDe(n){var t=n.state,s=n.options,a=s.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||vte(t.elements.popper,l)&&(t.elements.arrow=l))}const _De={name:"arrow",enabled:!0,phase:"main",fn:mDe,effect:gDe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function l0(n){return n.split("-")[1]}var EDe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function yDe(n,t){var s=n.x,a=n.y,l=t.devicePixelRatio||1;return{x:a0(s*l)/l||0,y:a0(a*l)/l||0}}function Jq(n){var t,s=n.popper,a=n.popperRect,l=n.placement,d=n.variation,f=n.offsets,E=n.position,v=n.gpuAcceleration,b=n.adaptive,w=n.roundOffsets,A=n.isFixed,N=f.x,V=N===void 0?0:N,j=f.y,B=j===void 0?0:j,H=typeof w=="function"?w({x:V,y:B}):{x:V,y:B};V=H.x,B=H.y;var J=f.hasOwnProperty("x"),$=f.hasOwnProperty("y"),te=rl,ce=nl,oe=window;if(b){var _e=GR(s),ne="clientHeight",ee="clientWidth";if(_e===Vl(s)&&(_e=Ig(s),Of(_e).position!=="static"&&E==="absolute"&&(ne="scrollHeight",ee="scrollWidth")),_e=_e,l===nl||(l===rl||l===Ou)&&d===SR){ce=Pu;var Q=A&&_e===oe&&oe.visualViewport?oe.visualViewport.height:_e[ne];B-=Q-a.height,B*=v?1:-1}if(l===rl||(l===nl||l===Pu)&&d===SR){te=Ou;var se=A&&_e===oe&&oe.visualViewport?oe.visualViewport.width:_e[ee];V-=se-a.width,V*=v?1:-1}}var pe=Object.assign({position:E},b&&EDe),fe=w===!0?yDe({x:V,y:B},Vl(s)):{x:V,y:B};if(V=fe.x,B=fe.y,v){var ue;return Object.assign({},pe,(ue={},ue[ce]=$?"0":"",ue[te]=J?"0":"",ue.transform=(oe.devicePixelRatio||1)<=1?"translate("+V+"px, "+B+"px)":"translate3d("+V+"px, "+B+"px, 0)",ue))}return Object.assign({},pe,(t={},t[ce]=$?B+"px":"",t[te]=J?V+"px":"",t.transform="",t))}function vDe(n){var t=n.state,s=n.options,a=s.gpuAcceleration,l=a===void 0?!0:a,d=s.adaptive,f=d===void 0?!0:d,E=s.roundOffsets,v=E===void 0?!0:E,b={placement:$h(t.placement),variation:l0(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Jq(Object.assign({},b,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:f,roundOffsets:v})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Jq(Object.assign({},b,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const SDe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:vDe,data:{}};var oO={passive:!0};function bDe(n){var t=n.state,s=n.instance,a=n.options,l=a.scroll,d=l===void 0?!0:l,f=a.resize,E=f===void 0?!0:f,v=Vl(t.elements.popper),b=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&b.forEach(function(w){w.addEventListener("scroll",s.update,oO)}),E&&v.addEventListener("resize",s.update,oO),function(){d&&b.forEach(function(w){w.removeEventListener("scroll",s.update,oO)}),E&&v.removeEventListener("resize",s.update,oO)}}const TDe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:bDe,data:{}};var wDe={left:"right",right:"left",bottom:"top",top:"bottom"};function UO(n){return n.replace(/left|right|bottom|top/g,function(t){return wDe[t]})}var RDe={start:"end",end:"start"};function Qq(n){return n.replace(/start|end/g,function(t){return RDe[t]})}function QF(n){var t=Vl(n),s=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:s,scrollTop:a}}function ZF(n){return c0(Ig(n)).left+QF(n).scrollLeft}function CDe(n,t){var s=Vl(n),a=Ig(n),l=s.visualViewport,d=a.clientWidth,f=a.clientHeight,E=0,v=0;if(l){d=l.width,f=l.height;var b=yte();(b||!b&&t==="fixed")&&(E=l.offsetLeft,v=l.offsetTop)}return{width:d,height:f,x:E+ZF(n),y:v}}function IDe(n){var t,s=Ig(n),a=QF(n),l=(t=n.ownerDocument)==null?void 0:t.body,d=EE(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=EE(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),E=-a.scrollLeft+ZF(n),v=-a.scrollTop;return Of(l||s).direction==="rtl"&&(E+=EE(s.clientWidth,l?l.clientWidth:0)-d),{width:d,height:f,x:E,y:v}}function ej(n){var t=Of(n),s=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+l+a)}function wte(n){return["html","body","#document"].indexOf(Zh(n))>=0?n.ownerDocument.body:Iu(n)&&ej(n)?n:wte(a1(n))}function Xw(n,t){var s;t===void 0&&(t=[]);var a=wte(n),l=a===((s=n.ownerDocument)==null?void 0:s.body),d=Vl(a),f=l?[d].concat(d.visualViewport||[],ej(a)?a:[]):a,E=t.concat(f);return l?E:E.concat(Xw(a1(f)))}function DU(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function ADe(n,t){var s=c0(n,!1,t==="fixed");return s.top=s.top+n.clientTop,s.left=s.left+n.clientLeft,s.bottom=s.top+n.clientHeight,s.right=s.left+n.clientWidth,s.width=n.clientWidth,s.height=n.clientHeight,s.x=s.left,s.y=s.top,s}function Zq(n,t,s){return t===_te?DU(CDe(n,s)):wE(t)?ADe(t,s):DU(IDe(Ig(n)))}function PDe(n){var t=Xw(a1(n)),s=["absolute","fixed"].indexOf(Of(n).position)>=0,a=s&&Iu(n)?GR(n):n;return wE(a)?t.filter(function(l){return wE(l)&&vte(l,a)&&Zh(l)!=="body"}):[]}function ODe(n,t,s,a){var l=t==="clippingParents"?PDe(n):[].concat(t),d=[].concat(l,[s]),f=d[0],E=d.reduce(function(v,b){var w=Zq(n,b,a);return v.top=EE(w.top,v.top),v.right=mk(w.right,v.right),v.bottom=mk(w.bottom,v.bottom),v.left=EE(w.left,v.left),v},Zq(n,f,a));return E.width=E.right-E.left,E.height=E.bottom-E.top,E.x=E.left,E.y=E.top,E}function Rte(n){var t=n.reference,s=n.element,a=n.placement,l=a?$h(a):null,d=a?l0(a):null,f=t.x+t.width/2-s.width/2,E=t.y+t.height/2-s.height/2,v;switch(l){case nl:v={x:f,y:t.y-s.height};break;case Pu:v={x:f,y:t.y+t.height};break;case Ou:v={x:t.x+t.width,y:E};break;case rl:v={x:t.x-s.width,y:E};break;default:v={x:t.x,y:t.y}}var b=l?JF(l):null;if(b!=null){var w=b==="y"?"height":"width";switch(d){case o0:v[b]=v[b]-(t[w]/2-s[w]/2);break;case SR:v[b]=v[b]+(t[w]/2-s[w]/2);break}}return v}function bR(n,t){t===void 0&&(t={});var s=t,a=s.placement,l=a===void 0?n.placement:a,d=s.strategy,f=d===void 0?n.strategy:d,E=s.boundary,v=E===void 0?XNe:E,b=s.rootBoundary,w=b===void 0?_te:b,A=s.elementContext,N=A===void 0?aw:A,V=s.altBoundary,j=V===void 0?!1:V,B=s.padding,H=B===void 0?0:B,J=bte(typeof H!="number"?H:Tte(H,zR)),$=N===aw?JNe:aw,te=n.rects.popper,ce=n.elements[j?$:N],oe=ODe(wE(ce)?ce:ce.contextElement||Ig(n.elements.popper),v,w,f),_e=c0(n.elements.reference),ne=Rte({reference:_e,element:te,placement:l}),ee=DU(Object.assign({},te,ne)),Q=N===aw?ee:_e,se={top:oe.top-Q.top+J.top,bottom:Q.bottom-oe.bottom+J.bottom,left:oe.left-Q.left+J.left,right:Q.right-oe.right+J.right},pe=n.modifiersData.offset;if(N===aw&&pe){var fe=pe[l];Object.keys(se).forEach(function(ue){var Me=[Ou,Pu].indexOf(ue)>=0?1:-1,He=[nl,Pu].indexOf(ue)>=0?"y":"x";se[ue]+=fe[He]*Me})}return se}function kDe(n,t){t===void 0&&(t={});var s=t,a=s.placement,l=s.boundary,d=s.rootBoundary,f=s.padding,E=s.flipVariations,v=s.allowedAutoPlacements,b=v===void 0?Ete:v,w=l0(a),A=w?E?Yq:Yq.filter(function(j){return l0(j)===w}):zR,N=A.filter(function(j){return b.indexOf(j)>=0});N.length===0&&(N=A);var V=N.reduce(function(j,B){return j[B]=bR(n,{placement:B,boundary:l,rootBoundary:d,padding:f})[$h(B)],j},{});return Object.keys(V).sort(function(j,B){return V[j]-V[B]})}function NDe(n){if($h(n)===qF)return[];var t=UO(n);return[Qq(n),t,Qq(t)]}function DDe(n){var t=n.state,s=n.options,a=n.name;if(!t.modifiersData[a]._skip){for(var l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,E=f===void 0?!0:f,v=s.fallbackPlacements,b=s.padding,w=s.boundary,A=s.rootBoundary,N=s.altBoundary,V=s.flipVariations,j=V===void 0?!0:V,B=s.allowedAutoPlacements,H=t.options.placement,J=$h(H),$=J===H,te=v||($||!j?[UO(H)]:NDe(H)),ce=[H].concat(te).reduce(function(Ue,Ge){return Ue.concat($h(Ge)===qF?kDe(t,{placement:Ge,boundary:w,rootBoundary:A,padding:b,flipVariations:j,allowedAutoPlacements:B}):Ge)},[]),oe=t.rects.reference,_e=t.rects.popper,ne=new Map,ee=!0,Q=ce[0],se=0;se<ce.length;se++){var pe=ce[se],fe=$h(pe),ue=l0(pe)===o0,Me=[nl,Pu].indexOf(fe)>=0,He=Me?"width":"height",nt=bR(t,{placement:pe,boundary:w,rootBoundary:A,altBoundary:N,padding:b}),we=Me?ue?Ou:rl:ue?Pu:nl;oe[He]>_e[He]&&(we=UO(we));var Ce=UO(we),ve=[];if(d&&ve.push(nt[fe]<=0),E&&ve.push(nt[we]<=0,nt[Ce]<=0),ve.every(function(Ue){return Ue})){Q=pe,ee=!1;break}ne.set(pe,ve)}if(ee)for(var Ne=j?3:1,Te=function(Ge){var Qe=ce.find(function(tt){var dt=ne.get(tt);if(dt)return dt.slice(0,Ge).every(function(Ze){return Ze})});if(Qe)return Q=Qe,"break"},be=Ne;be>0;be--){var Ae=Te(be);if(Ae==="break")break}t.placement!==Q&&(t.modifiersData[a]._skip=!0,t.placement=Q,t.reset=!0)}}const LDe={name:"flip",enabled:!0,phase:"main",fn:DDe,requiresIfExists:["offset"],data:{_skip:!1}};function eY(n,t,s){return s===void 0&&(s={x:0,y:0}),{top:n.top-t.height-s.y,right:n.right-t.width+s.x,bottom:n.bottom-t.height+s.y,left:n.left-t.width-s.x}}function tY(n){return[nl,Ou,Pu,rl].some(function(t){return n[t]>=0})}function xDe(n){var t=n.state,s=n.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,f=bR(t,{elementContext:"reference"}),E=bR(t,{altBoundary:!0}),v=eY(f,a),b=eY(E,l,d),w=tY(v),A=tY(b);t.modifiersData[s]={referenceClippingOffsets:v,popperEscapeOffsets:b,isReferenceHidden:w,hasPopperEscaped:A},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":A})}const MDe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:xDe};function UDe(n,t,s){var a=$h(n),l=[rl,nl].indexOf(a)>=0?-1:1,d=typeof s=="function"?s(Object.assign({},t,{placement:n})):s,f=d[0],E=d[1];return f=f||0,E=(E||0)*l,[rl,Ou].indexOf(a)>=0?{x:E,y:f}:{x:f,y:E}}function VDe(n){var t=n.state,s=n.options,a=n.name,l=s.offset,d=l===void 0?[0,0]:l,f=Ete.reduce(function(w,A){return w[A]=UDe(A,t.rects,d),w},{}),E=f[t.placement],v=E.x,b=E.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=v,t.modifiersData.popperOffsets.y+=b),t.modifiersData[a]=f}const FDe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:VDe};function jDe(n){var t=n.state,s=n.name;t.modifiersData[s]=Rte({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const BDe={name:"popperOffsets",enabled:!0,phase:"read",fn:jDe,data:{}};function WDe(n){return n==="x"?"y":"x"}function zDe(n){var t=n.state,s=n.options,a=n.name,l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,E=f===void 0?!1:f,v=s.boundary,b=s.rootBoundary,w=s.altBoundary,A=s.padding,N=s.tether,V=N===void 0?!0:N,j=s.tetherOffset,B=j===void 0?0:j,H=bR(t,{boundary:v,rootBoundary:b,padding:A,altBoundary:w}),J=$h(t.placement),$=l0(t.placement),te=!$,ce=JF(J),oe=WDe(ce),_e=t.modifiersData.popperOffsets,ne=t.rects.reference,ee=t.rects.popper,Q=typeof B=="function"?B(Object.assign({},t.rects,{placement:t.placement})):B,se=typeof Q=="number"?{mainAxis:Q,altAxis:Q}:Object.assign({mainAxis:0,altAxis:0},Q),pe=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,fe={x:0,y:0};if(_e){if(d){var ue,Me=ce==="y"?nl:rl,He=ce==="y"?Pu:Ou,nt=ce==="y"?"height":"width",we=_e[ce],Ce=we+H[Me],ve=we-H[He],Ne=V?-ee[nt]/2:0,Te=$===o0?ne[nt]:ee[nt],be=$===o0?-ee[nt]:-ne[nt],Ae=t.elements.arrow,Ue=V&&Ae?XF(Ae):{width:0,height:0},Ge=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:Ste(),Qe=Ge[Me],tt=Ge[He],dt=Yw(0,ne[nt],Ue[nt]),Ze=te?ne[nt]/2-Ne-dt-Qe-se.mainAxis:Te-dt-Qe-se.mainAxis,wt=te?-ne[nt]/2+Ne+dt+tt+se.mainAxis:be+dt+tt+se.mainAxis,un=t.elements.arrow&&GR(t.elements.arrow),xt=un?ce==="y"?un.clientTop||0:un.clientLeft||0:0,tn=(ue=pe==null?void 0:pe[ce])!=null?ue:0,kn=we+Ze-tn-xt,$t=we+wt-tn,zn=Yw(V?mk(Ce,kn):Ce,we,V?EE(ve,$t):ve);_e[ce]=zn,fe[ce]=zn-we}if(E){var Bt,Re=ce==="x"?nl:rl,Fe=ce==="x"?Pu:Ou,We=_e[oe],ot=oe==="y"?"height":"width",Et=We+H[Re],yt=We-H[Fe],zt=[nl,rl].indexOf(J)!==-1,pn=(Bt=pe==null?void 0:pe[oe])!=null?Bt:0,xn=zt?Et:We-ne[ot]-ee[ot]-pn+se.altAxis,cn=zt?We+ne[ot]+ee[ot]-pn-se.altAxis:yt,dr=V&&zt?pDe(xn,We,cn):Yw(V?xn:Et,We,V?cn:yt);_e[oe]=dr,fe[oe]=dr-We}t.modifiersData[a]=fe}}const GDe={name:"preventOverflow",enabled:!0,phase:"main",fn:zDe,requiresIfExists:["offset"]};function HDe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function $De(n){return n===Vl(n)||!Iu(n)?QF(n):HDe(n)}function KDe(n){var t=n.getBoundingClientRect(),s=a0(t.width)/n.offsetWidth||1,a=a0(t.height)/n.offsetHeight||1;return s!==1||a!==1}function qDe(n,t,s){s===void 0&&(s=!1);var a=Iu(t),l=Iu(t)&&KDe(t),d=Ig(t),f=c0(n,l,s),E={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!s)&&((Zh(t)!=="body"||ej(d))&&(E=$De(t)),Iu(t)?(v=c0(t,!0),v.x+=t.clientLeft,v.y+=t.clientTop):d&&(v.x=ZF(d))),{x:f.left+E.scrollLeft-v.x,y:f.top+E.scrollTop-v.y,width:f.width,height:f.height}}function YDe(n){var t=new Map,s=new Set,a=[];n.forEach(function(d){t.set(d.name,d)});function l(d){s.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(E){if(!s.has(E)){var v=t.get(E);v&&l(v)}}),a.push(d)}return n.forEach(function(d){s.has(d.name)||l(d)}),a}function XDe(n){var t=YDe(n);return aDe.reduce(function(s,a){return s.concat(t.filter(function(l){return l.phase===a}))},[])}function JDe(n){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(n())})})),t}}function QDe(n){var t=n.reduce(function(s,a){var l=s[a.name];return s[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,s},{});return Object.keys(t).map(function(s){return t[s]})}var nY={placement:"bottom",modifiers:[],strategy:"absolute"};function rY(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function ZDe(n){n===void 0&&(n={});var t=n,s=t.defaultModifiers,a=s===void 0?[]:s,l=t.defaultOptions,d=l===void 0?nY:l;return function(E,v,b){b===void 0&&(b=d);var w={placement:"bottom",orderedModifiers:[],options:Object.assign({},nY,d),modifiersData:{},elements:{reference:E,popper:v},attributes:{},styles:{}},A=[],N=!1,V={state:w,setOptions:function(J){var $=typeof J=="function"?J(w.options):J;B(),w.options=Object.assign({},d,w.options,$),w.scrollParents={reference:wE(E)?Xw(E):E.contextElement?Xw(E.contextElement):[],popper:Xw(v)};var te=XDe(QDe([].concat(a,w.options.modifiers)));return w.orderedModifiers=te.filter(function(ce){return ce.enabled}),j(),V.update()},forceUpdate:function(){if(!N){var J=w.elements,$=J.reference,te=J.popper;if(rY($,te)){w.rects={reference:qDe($,GR(te),w.options.strategy==="fixed"),popper:XF(te)},w.reset=!1,w.placement=w.options.placement,w.orderedModifiers.forEach(function(se){return w.modifiersData[se.name]=Object.assign({},se.data)});for(var ce=0;ce<w.orderedModifiers.length;ce++){if(w.reset===!0){w.reset=!1,ce=-1;continue}var oe=w.orderedModifiers[ce],_e=oe.fn,ne=oe.options,ee=ne===void 0?{}:ne,Q=oe.name;typeof _e=="function"&&(w=_e({state:w,options:ee,name:Q,instance:V})||w)}}}},update:JDe(function(){return new Promise(function(H){V.forceUpdate(),H(w)})}),destroy:function(){B(),N=!0}};if(!rY(E,v))return V;V.setOptions(b).then(function(H){!N&&b.onFirstUpdate&&b.onFirstUpdate(H)});function j(){w.orderedModifiers.forEach(function(H){var J=H.name,$=H.options,te=$===void 0?{}:$,ce=H.effect;if(typeof ce=="function"){var oe=ce({state:w,name:J,instance:V,options:te}),_e=function(){};A.push(oe||_e)}})}function B(){A.forEach(function(H){return H()}),A=[]}return V}}var eLe=[TDe,BDe,SDe,uDe,FDe,LDe,GDe,_De,MDe],tLe=ZDe({defaultModifiers:eLe});const sS=(n,t)=>({var:n,varRef:t?`var(${n}, ${t})`:`var(${n})`}),Zs={arrowShadowColor:sS("--popper-arrow-shadow-color"),arrowSize:sS("--popper-arrow-size","8px"),arrowSizeHalf:sS("--popper-arrow-size-half"),arrowBg:sS("--popper-arrow-bg"),transformOrigin:sS("--popper-transform-origin"),arrowOffset:sS("--popper-arrow-offset")};function nLe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const rLe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},iLe=n=>rLe[n],iY={scroll:!0,resize:!0};function sLe(n){let t;return typeof n=="object"?t={enabled:!0,options:{...iY,...n}}:t={enabled:n,options:iY},t}const oLe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const t=n.elements.reference;n.elements.popper.style.width=`${t.offsetWidth}px`}},aLe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{sY(n)},effect:({state:n})=>()=>{sY(n)}},sY=n=>{n.elements.popper.style.setProperty(Zs.transformOrigin.var,iLe(n.placement))},cLe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{lLe(n)}},lLe=n=>{var s;if(!n.placement)return;const t=uLe(n.placement);if((s=n.elements)!=null&&s.arrow&&t){Object.assign(n.elements.arrow.style,{[t.property]:t.value,width:Zs.arrowSize.varRef,height:Zs.arrowSize.varRef,zIndex:-1});const a={[Zs.arrowSizeHalf.var]:`calc(${Zs.arrowSize.varRef} / 2 - 1px)`,[Zs.arrowOffset.var]:`calc(${Zs.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},uLe=n=>{if(n.startsWith("top"))return{property:"bottom",value:Zs.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:Zs.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:Zs.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:Zs.arrowOffset.varRef}},dLe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{oY(n)},effect:({state:n})=>()=>{oY(n)}},oY=n=>{if(!n.elements.arrow)return;const t=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const s=nLe(n.placement);s&&t.style.setProperty("--popper-arrow-default-shadow",s),Object.assign(t.style,{transform:"rotate(45deg)",background:Zs.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},hLe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},pLe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function fLe(n,t="ltr"){var a;const s=((a=hLe[n])==null?void 0:a[t])||n;return t==="ltr"?s:pLe[n]??s}function tj(n={}){const{enabled:t=!0,modifiers:s,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:f=!0,offset:E,gutter:v=8,flip:b=!0,boundary:w="clippingParents",preventOverflow:A=!0,matchWidth:N,direction:V="ltr"}=n,j=D.useRef(null),B=D.useRef(null),H=D.useRef(null),J=fLe(a,V),$=D.useRef(()=>{}),te=D.useCallback(()=>{var se;!t||!j.current||!B.current||((se=$.current)==null||se.call($),H.current=tLe(j.current,B.current,{placement:J,modifiers:[dLe,cLe,aLe,{...oLe,enabled:!!N},{name:"eventListeners",...sLe(f)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:E??[0,v]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!A,options:{boundary:w}},...s??[]],strategy:l}),H.current.forceUpdate(),$.current=H.current.destroy)},[J,t,s,N,f,d,E,v,b,A,w,l]);D.useEffect(()=>()=>{var se;!j.current&&!B.current&&((se=H.current)==null||se.destroy(),H.current=null)},[]);const ce=D.useCallback(se=>{j.current=se,te()},[te]),oe=D.useCallback((se={},pe=null)=>({...se,ref:ns(ce,pe)}),[ce]),_e=D.useCallback(se=>{B.current=se,te()},[te]),ne=D.useCallback((se={},pe=null)=>({...se,ref:ns(_e,pe),style:{...se.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,_e,N]),ee=D.useCallback((se={},pe=null)=>{const{size:fe,shadowColor:ue,bg:Me,style:He,...nt}=se;return{...nt,ref:pe,"data-popper-arrow":"",style:mLe(se)}},[]),Q=D.useCallback((se={},pe=null)=>({...se,ref:pe,"data-popper-arrow-inner":""}),[]);return{update(){var se;(se=H.current)==null||se.update()},forceUpdate(){var se;(se=H.current)==null||se.forceUpdate()},transformOrigin:Zs.transformOrigin.varRef,referenceRef:ce,popperRef:_e,getPopperProps:ne,getArrowProps:ee,getArrowInnerProps:Q,getReferenceProps:oe}}function mLe(n){const{size:t,shadowColor:s,bg:a,style:l}=n,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),s&&(d["--popper-arrow-shadow-color"]=s),a&&(d["--popper-arrow-bg"]=a),d}function gLe(){const n=D.useRef(new Map),t=n.current,s=D.useCallback((l,d,f,E)=>{n.current.set(f,{type:d,el:l,options:E}),l.addEventListener(d,f,E)},[]),a=D.useCallback((l,d,f,E)=>{l.removeEventListener(d,f,E),n.current.delete(f)},[]);return D.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:s,remove:a}}function gM(n){var l,d;const t=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:s,isContentEditable:a}=t;return s!=="INPUT"&&s!=="TEXTAREA"&&a!==!0}function Cte(n={}){const{ref:t,isDisabled:s,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:f,onMouseUp:E,onClick:v,onKeyDown:b,onKeyUp:w,tabIndex:A,onMouseOver:N,onMouseLeave:V,...j}=n,[B,H]=D.useState(!0),[J,$]=D.useState(!1),te=gLe(),ce=we=>{we&&we.tagName!=="BUTTON"&&H(!1)},oe=B?A:A||0,_e=s&&!a,ne=D.useCallback(we=>{if(s){we.stopPropagation(),we.preventDefault();return}we.currentTarget.focus(),v==null||v(we)},[s,v]),ee=D.useCallback(we=>{J&&gM(we)&&(we.preventDefault(),we.stopPropagation(),$(!1),te.remove(document,"keyup",ee,!1))},[J,te]),Q=D.useCallback(we=>{if(b==null||b(we),s||we.defaultPrevented||we.metaKey||!gM(we.nativeEvent)||B)return;const Ce=l&&we.key==="Enter";d&&we.key===" "&&(we.preventDefault(),$(!0)),Ce&&(we.preventDefault(),we.currentTarget.click()),te.add(document,"keyup",ee,!1)},[s,B,b,l,d,te,ee]),se=D.useCallback(we=>{if(w==null||w(we),s||we.defaultPrevented||we.metaKey||!gM(we.nativeEvent)||B)return;d&&we.key===" "&&(we.preventDefault(),$(!1),we.currentTarget.click())},[d,B,s,w]),pe=D.useCallback(we=>{we.button===0&&($(!1),te.remove(document,"mouseup",pe,!1))},[te]),fe=D.useCallback(we=>{if(we.button!==0)return;if(s){we.stopPropagation(),we.preventDefault();return}B||$(!0),we.currentTarget.focus({preventScroll:!0}),te.add(document,"mouseup",pe,!1),f==null||f(we)},[s,B,f,te,pe]),ue=D.useCallback(we=>{we.button===0&&(B||$(!1),E==null||E(we))},[E,B]),Me=D.useCallback(we=>{if(s){we.preventDefault();return}N==null||N(we)},[s,N]),He=D.useCallback(we=>{J&&(we.preventDefault(),$(!1)),V==null||V(we)},[J,V]),nt=ns(t,ce);return B?{...j,ref:nt,type:"button","aria-disabled":_e?void 0:s,disabled:_e,onClick:ne,onMouseDown:f,onMouseUp:E,onKeyUp:w,onKeyDown:b,onMouseOver:N,onMouseLeave:V}:{...j,ref:nt,role:"button","data-active":Xn(J),"aria-disabled":s?"true":void 0,tabIndex:_e?void 0:oe,onClick:ne,onMouseDown:fe,onMouseUp:ue,onKeyUp:se,onKeyDown:Q,onMouseOver:Me,onMouseLeave:He}}const[_Le,ELe,yLe,vLe]=Aee(),[SLe,HR]=Li({strict:!1,name:"MenuContext"});function Ite(n){return(n==null?void 0:n.ownerDocument)??document}function bLe(n){return Ite(n).activeElement===n}function TLe(n={}){const{id:t,closeOnSelect:s=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:f,isOpen:E,defaultIsOpen:v,onClose:b,onOpen:w,placement:A="bottom-start",lazyBehavior:N="unmount",direction:V,computePositionOnMount:j=!1,...B}=n,H=D.useRef(null),J=D.useRef(null),$=D.useRef(!0),te=yLe(),ce=D.useCallback(()=>{requestAnimationFrame(()=>{var Ae;(Ae=H.current)==null||Ae.focus({preventScroll:!1})})},[]),oe=D.useCallback(()=>{const Ae=setTimeout(()=>{var Ue,Ge;if(l)(Ue=l.current)==null||Ue.focus();else if(!te.count())(Ge=H.current)==null||Ge.focus({preventScroll:!1});else{const Qe=te.firstEnabled();Qe&&Me(Qe.index)}});ve.current.add(Ae)},[te,l]),_e=D.useCallback(()=>{const Ae=setTimeout(()=>{var Ue;if(!te.count())(Ue=H.current)==null||Ue.focus({preventScroll:!1});else{const Ge=te.lastEnabled();Ge&&Me(Ge.index)}});ve.current.add(Ae)},[te]),ne=D.useCallback(()=>{w==null||w(),d?oe():ce()},[d,oe,ce,w]),{isOpen:ee,onOpen:Q,onClose:se,onToggle:pe}=If({isOpen:E,defaultIsOpen:v,onClose:b,onOpen:ne});oQ({enabled:ee&&a,ref:H,handler:Ae=>{var Ge,Qe,tt;const Ue=((Qe=(Ge=Ae.composedPath)==null?void 0:Ge.call(Ae))==null?void 0:Qe[0])??Ae.target;(tt=J.current)!=null&&tt.contains(Ue)||se()}});const fe=tj({...B,enabled:ee||j,placement:A,direction:V}),[ue,Me]=D.useState(-1);rQ(H,{focusRef:J,visible:ee,shouldFocus:!0});const He=tQ({isOpen:ee,ref:H}),[nt,we]=kEe(t,"menu-button","menu-list"),Ce=D.useCallback(()=>{Q(),ce()},[Q,ce]),ve=D.useRef(new Set([]));D.useEffect(()=>{const Ae=ve.current;return()=>{Ae.forEach(Ue=>clearTimeout(Ue)),Ae.clear()}},[]),fg(()=>{var Ae;ee||(Me(-1),(Ae=H.current)==null||Ae.scrollTo(0,0))},[ee]),fg(()=>{ee&&ue===-1&&ce()},[ue,ee]),D.useEffect(()=>{var Ue;if(!ee)return;const Ae=te.item(ue);(Ue=Ae==null?void 0:Ae.node)==null||Ue.focus({preventScroll:!$.current})},[te,ue,ee]);const Ne=D.useCallback(()=>{Q(),oe()},[oe,Q]),Te=D.useCallback(()=>{$.current=!0,Q(),_e()},[Q,_e]),be=D.useCallback(()=>{var tt,dt;const Ae=Ite(H.current),Ue=(tt=H.current)==null?void 0:tt.contains(Ae.activeElement);if(!(ee&&!Ue))return;const Qe=(dt=te.item(ue))==null?void 0:dt.node;Qe==null||Qe.focus({preventScroll:!$.current})},[ee,ue,te]);return{openAndFocusMenu:Ce,openAndFocusFirstItem:Ne,openAndFocusLastItem:Te,onTransitionEnd:be,unstable__animationState:He,descendants:te,popper:fe,buttonId:nt,menuId:we,forceUpdate:fe.forceUpdate,orientation:"vertical",isOpen:ee,onToggle:pe,onOpen:Q,onClose:se,menuRef:H,buttonRef:J,focusedIndex:ue,closeOnSelect:s,closeOnBlur:a,autoSelect:d,setFocusedIndex:Me,isLazy:f,lazyBehavior:N,initialFocusRef:l,scrollIntoViewRef:$}}function wLe(n={},t=null){const s=HR(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:f,scrollIntoViewRef:E}=s,v=D.useCallback(b=>{const w=b.key,N={Enter:d,ArrowDown:d,ArrowUp:f}[w];N&&(E.current=!0,b.preventDefault(),b.stopPropagation(),N(b))},[d,f,E]);return{...n,ref:ns(s.buttonRef,t,l.referenceRef),id:s.buttonId,"data-active":Xn(s.isOpen),"aria-expanded":s.isOpen,"aria-haspopup":"menu","aria-controls":s.menuId,onClick:er(n.onClick,a),onKeyDown:er(n.onKeyDown,v)}}function LU(n){var t;return ALe(n)&&!!((t=n==null?void 0:n.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function RLe(n={},t=null){const s=HR();if(!s)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:f,onClose:E,menuId:v,isLazy:b,lazyBehavior:w,scrollIntoViewRef:A,unstable__animationState:N}=s,V=ELe(),j=YNe({preventDefault:$=>$.key!==" "&&LU($.target)}),B=D.useCallback($=>{if(!$.currentTarget.contains($.target))return;const te=$.key,oe={Tab:ne=>ne.preventDefault(),Escape:ne=>{ne.stopPropagation(),E()},ArrowDown:()=>{A.current=!0;const ne=V.nextEnabled(a)??V.firstEnabled();ne&&l(ne.index)},ArrowUp:()=>{A.current=!0;const ne=V.prevEnabled(a)??V.firstEnabled();ne&&l(ne.index)}}[te];if(oe){$.preventDefault(),oe($);return}const _e=j(ne=>{const ee=KNe(V.values(),ne,Q=>{var se;return((se=Q==null?void 0:Q.node)==null?void 0:se.textContent)??""},V.item(a));if(ee){const Q=V.indexOf(ee.node);l(Q)}});LU($.target)&&_e($)},[V,a,j,E,l,A]),H=D.useRef(!1);f&&(H.current=!0);const J=AV({wasSelected:H.current,enabled:b,mode:w,isSelected:N.present});return{...n,ref:ns(d,t),children:J?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:er(n.onKeyDown,B)}}function CLe(n={}){const{popper:t,isOpen:s}=HR();return t.getPopperProps({...n,style:{visibility:s?"visible":"hidden",...n.style}})}function ILe(n={},t=null){const{onMouseEnter:s,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:f,isDisabled:E,isFocusable:v,closeOnSelect:b,type:w,...A}=n,N=HR(),{setFocusedIndex:V,focusedIndex:j,closeOnSelect:B,onClose:H,menuId:J,scrollIntoViewRef:$}=N,te=D.useRef(null),ce=`${J}-menuitem-${D.useId()}`,{index:oe,register:_e}=vLe({disabled:E&&!v}),ne=D.useCallback(Me=>{s==null||s(Me),!E&&($.current=!1,V(oe))},[V,oe,E,s,$]),ee=D.useCallback(Me=>{a==null||a(Me),te.current&&!bLe(te.current)&&ne(Me)},[ne,a]),Q=D.useCallback(Me=>{l==null||l(Me),!E&&V(-1)},[V,E,l]),se=D.useCallback(Me=>{d==null||d(Me),LU(Me.currentTarget)&&(b??B)&&H()},[H,d,B,b]),pe=D.useCallback(Me=>{f==null||f(Me),V(oe)},[V,f,oe]),fe=oe===j,ue=Cte({onClick:se,onFocus:pe,onMouseEnter:ne,onMouseMove:ee,onMouseLeave:Q,ref:ns(_e,te,t),isDisabled:E,isFocusable:v});return{...A,...ue,type:w??ue.type,id:ce,role:"menuitem",tabIndex:fe?0:-1}}function ALe(n){if(!PLe(n))return!1;const t=n.ownerDocument.defaultView??window;return n instanceof t.HTMLElement}function PLe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[OLe,P0]=Li({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),c1=n=>{const{children:t}=n,s=gc("Menu",n),a=Yi(n),{direction:l}=I0(),{descendants:d,...f}=TLe({...a,direction:l}),E=D.useMemo(()=>f,[f]),{isOpen:v,onClose:b,forceUpdate:w}=E;return C.jsx(_Le,{value:d,children:C.jsx(SLe,{value:E,children:C.jsx(OLe,{value:s,children:el(t,{isOpen:v,onClose:b,forceUpdate:w})})})})};c1.displayName="Menu";const kLe=Gt((n,t)=>{const s=P0();return C.jsx(Dt.button,{ref:t,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...s.button}})}),l1=Gt((n,t)=>{const{children:s,as:a,...l}=n,d=wLe(l,t),f=a||kLe;return C.jsx(f,{...d,className:hn("chakra-menu__menu-button",n.className),children:C.jsx(Dt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});l1.displayName="MenuButton";const Ate=Gt((n,t)=>{const s=P0();return C.jsx(Dt.span,{ref:t,...n,__css:s.command,className:"chakra-menu__command"})});Ate.displayName="MenuCommand";const Pte=n=>{const{className:t,...s}=n,a=P0();return C.jsx(Dt.hr,{"aria-orientation":"horizontal",className:hn("chakra-menu__divider",t),...s,__css:a.divider})};Pte.displayName="MenuDivider";const Ote=n=>{const{className:t,children:s,...a}=n,l=P0(),d=D.Children.only(s),f=D.isValidElement(d)?D.cloneElement(d,{focusable:"false","aria-hidden":!0,className:hn("chakra-menu__icon",d.props.className)}):null,E=hn("chakra-menu__icon-wrapper",t);return C.jsx(Dt.span,{className:E,...a,__css:l.icon,children:f})};Ote.displayName="MenuIcon";const NLe=Gt((n,t)=>{const{type:s,...a}=n,l=P0(),d=a.as||s?s??void 0:"button",f=D.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return C.jsx(Dt.button,{ref:t,type:d,...a,__css:f})}),HS=Gt((n,t)=>{const{icon:s,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:f,...E}=n,v=ILe(E,t),w=s||l?C.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return C.jsxs(NLe,{...v,className:hn("chakra-menu__menuitem",v.className),children:[s&&C.jsx(Ote,{fontSize:"0.8em",marginEnd:a,children:s}),w,l&&C.jsx(Ate,{marginStart:d,children:l})]})});HS.displayName="MenuItem";const DLe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},LLe=Dt(Mf.div),u1=Gt(function(t,s){var N;const{rootProps:a,motionProps:l,...d}=t,{isOpen:f,onTransitionEnd:E,unstable__animationState:v}=HR(),b=RLe(d,s),w=CLe(a),A=P0();return C.jsx(Dt.div,{...w,__css:{zIndex:t.zIndex??((N=A.list)==null?void 0:N.zIndex)},children:C.jsx(LLe,{variants:DLe,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...A.list},...l,...b,className:hn("chakra-menu__menu-list",b.className),onUpdate:E,onAnimationComplete:YJ(v.onComplete,b.onAnimationComplete)})})});u1.displayName="MenuList";var xLe=function(n){if(typeof document>"u")return null;var t=Array.isArray(n)?n[0]:n;return t.ownerDocument.body},oS=new WeakMap,aO=new WeakMap,cO={},_M=0,kte=function(n){return n&&(n.host||kte(n.parentNode))},MLe=function(n,t){return t.map(function(s){if(n.contains(s))return s;var a=kte(s);return a&&n.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",n,". Doing nothing"),null)}).filter(function(s){return!!s})},ULe=function(n,t,s,a){var l=MLe(t,Array.isArray(n)?n:[n]);cO[s]||(cO[s]=new WeakMap);var d=cO[s],f=[],E=new Set,v=new Set(l),b=function(A){!A||E.has(A)||(E.add(A),b(A.parentNode))};l.forEach(b);var w=function(A){!A||v.has(A)||Array.prototype.forEach.call(A.children,function(N){if(E.has(N))w(N);else try{var V=N.getAttribute(a),j=V!==null&&V!=="false",B=(oS.get(N)||0)+1,H=(d.get(N)||0)+1;oS.set(N,B),d.set(N,H),f.push(N),B===1&&j&&aO.set(N,!0),H===1&&N.setAttribute(s,"true"),j||N.setAttribute(a,"true")}catch(J){console.error("aria-hidden: cannot operate on ",N,J)}})};return w(t),E.clear(),_M++,function(){f.forEach(function(A){var N=oS.get(A)-1,V=d.get(A)-1;oS.set(A,N),d.set(A,V),N||(aO.has(A)||A.removeAttribute(a),aO.delete(A)),V||A.removeAttribute(s)}),_M--,_M||(oS=new WeakMap,oS=new WeakMap,aO=new WeakMap,cO={})}},VLe=function(n,t,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=xLe(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),ULe(a,l,s,"aria-hidden")):function(){return null}},FLe=Object.defineProperty,jLe=(n,t,s)=>t in n?FLe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,BLe=(n,t,s)=>(jLe(n,t+"",s),s);class WLe{constructor(){BLe(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const s=Array.from(this.modals)[this.modals.size-1];return t===s}}const xU=new WLe;function Nte(n,t){const[s,a]=D.useState(0);return D.useEffect(()=>{const l=n.current;if(l){if(t){const d=xU.add(l);a(d)}return()=>{xU.remove(l),a(0)}}},[t,n]),s}function zLe(n){const{isOpen:t,onClose:s,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:f=!0,onOverlayClick:E,onEsc:v}=n,b=D.useRef(null),w=D.useRef(null),[A,N,V]=HLe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");GLe(b,t&&f);const j=Nte(b,t),B=D.useRef(null),H=D.useCallback(Q=>{B.current=Q.target},[]),J=D.useCallback(Q=>{Q.key==="Escape"&&(Q.stopPropagation(),d&&(s==null||s()),v==null||v())},[d,s,v]),[$,te]=D.useState(!1),[ce,oe]=D.useState(!1),_e=D.useCallback((Q={},se=null)=>({role:"dialog",...Q,ref:ns(se,b),id:A,tabIndex:-1,"aria-modal":!0,"aria-labelledby":$?N:void 0,"aria-describedby":ce?V:void 0,onClick:er(Q.onClick,pe=>pe.stopPropagation())}),[V,ce,A,N,$]),ne=D.useCallback(Q=>{Q.stopPropagation(),B.current===Q.target&&xU.isTopModal(b.current)&&(l&&(s==null||s()),E==null||E())},[s,l,E]),ee=D.useCallback((Q={},se=null)=>({...Q,ref:ns(se,w),onClick:er(Q.onClick,ne),onKeyDown:er(Q.onKeyDown,J),onMouseDown:er(Q.onMouseDown,H)}),[J,H,ne]);return{isOpen:t,onClose:s,headerId:N,bodyId:V,setBodyMounted:oe,setHeaderMounted:te,dialogRef:b,overlayRef:w,getDialogProps:_e,getDialogContainerProps:ee,index:j}}function GLe(n,t){const s=n.current;D.useEffect(()=>{if(!(!n.current||!t))return VLe(n.current)},[t,n,s])}function HLe(n,...t){const s=D.useId(),a=n||s;return D.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[$Le,O0]=Li({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[KLe,RE]=Li({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),ca=n=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:s,children:a,autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:V,animatePresenceProps:j,onCloseComplete:B}=t,H=gc("Modal",t),$={...zLe(t),autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:V};return C.jsx(KLe,{value:$,children:C.jsx($Le,{value:H,children:C.jsx(w0,{...j,onExitComplete:B,children:$.isOpen&&C.jsx(Nu,{...s,children:a})})})})};ca.displayName="Modal";var VO="right-scroll-bar-position",FO="width-before-scroll-bar",qLe="with-scroll-bars-hidden",YLe="--removed-body-scroll-bar-size",Dte=jee(),EM=function(){},d1=D.forwardRef(function(n,t){var s=D.useRef(null),a=D.useState({onScrollCapture:EM,onWheelCapture:EM,onTouchMoveCapture:EM}),l=a[0],d=a[1],f=n.forwardProps,E=n.children,v=n.className,b=n.removeScrollBar,w=n.enabled,A=n.shards,N=n.sideCar,V=n.noIsolation,j=n.inert,B=n.allowPinchZoom,H=n.as,J=H===void 0?"div":H,$=n.gapMode,te=WR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ce=N,oe=Uee([s,t]),_e=Mh(Mh({},te),l);return D.createElement(D.Fragment,null,w&&D.createElement(ce,{sideCar:Dte,removeScrollBar:b,shards:A,noIsolation:V,inert:j,setCallbacks:d,allowPinchZoom:!!B,lockRef:s,gapMode:$}),f?D.cloneElement(D.Children.only(E),Mh(Mh({},_e),{ref:oe})):D.createElement(J,Mh({},_e,{className:v,ref:oe}),E))});d1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};d1.classNames={fullWidth:FO,zeroRight:VO};var XLe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function JLe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var t=XLe();return t&&n.setAttribute("nonce",t),n}function QLe(n,t){n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}function ZLe(n){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(n)}var exe=function(){var n=0,t=null;return{add:function(s){n==0&&(t=JLe())&&(QLe(t,s),ZLe(t)),n++},remove:function(){n--,!n&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},txe=function(){var n=exe();return function(t,s){D.useEffect(function(){return n.add(t),function(){n.remove()}},[t&&s])}},Lte=function(){var n=txe(),t=function(s){var a=s.styles,l=s.dynamic;return n(a,l),null};return t},nxe={left:0,top:0,right:0,gap:0},yM=function(n){return parseInt(n||"",10)||0},rxe=function(n){var t=window.getComputedStyle(document.body),s=t[n==="padding"?"paddingLeft":"marginLeft"],a=t[n==="padding"?"paddingTop":"marginTop"],l=t[n==="padding"?"paddingRight":"marginRight"];return[yM(s),yM(a),yM(l)]},ixe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return nxe;var t=rxe(n),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-s+t[2]-t[0])}},sxe=Lte(),$S="data-scroll-locked",oxe=function(n,t,s,a){var l=n.left,d=n.top,f=n.right,E=n.gap;return s===void 0&&(s="margin"),`
  .`.concat(qLe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(E,"px ").concat(a,`;
  }
  body[`).concat($S,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(E,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(E,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(VO,` {
    right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(FO,` {
    margin-right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(VO," .").concat(VO,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(FO," .").concat(FO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat($S,`] {
    `).concat(YLe,": ").concat(E,`px;
  }
`)},aY=function(){var n=parseInt(document.body.getAttribute($S)||"0",10);return isFinite(n)?n:0},axe=function(){D.useEffect(function(){return document.body.setAttribute($S,(aY()+1).toString()),function(){var n=aY()-1;n<=0?document.body.removeAttribute($S):document.body.setAttribute($S,n.toString())}},[])},cxe=function(n){var t=n.noRelative,s=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;axe();var d=D.useMemo(function(){return ixe(l)},[l]);return D.createElement(sxe,{styles:oxe(d,!t,l,s?"":"!important")})},MU=!1;if(typeof window<"u")try{var lO=Object.defineProperty({},"passive",{get:function(){return MU=!0,!0}});window.addEventListener("test",lO,lO),window.removeEventListener("test",lO,lO)}catch{MU=!1}var aS=MU?{passive:!1}:!1,lxe=function(n){return n.tagName==="TEXTAREA"},xte=function(n,t){if(!(n instanceof Element))return!1;var s=window.getComputedStyle(n);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!lxe(n)&&s[t]==="visible")},uxe=function(n){return xte(n,"overflowY")},dxe=function(n){return xte(n,"overflowX")},cY=function(n,t){var s=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=Mte(n,a);if(l){var d=Ute(n,a),f=d[1],E=d[2];if(f>E)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},hxe=function(n){var t=n.scrollTop,s=n.scrollHeight,a=n.clientHeight;return[t,s,a]},pxe=function(n){var t=n.scrollLeft,s=n.scrollWidth,a=n.clientWidth;return[t,s,a]},Mte=function(n,t){return n==="v"?uxe(t):dxe(t)},Ute=function(n,t){return n==="v"?hxe(t):pxe(t)},fxe=function(n,t){return n==="h"&&t==="rtl"?-1:1},mxe=function(n,t,s,a,l){var d=fxe(n,window.getComputedStyle(t).direction),f=d*a,E=s.target,v=t.contains(E),b=!1,w=f>0,A=0,N=0;do{var V=Ute(n,E),j=V[0],B=V[1],H=V[2],J=B-H-d*j;(j||J)&&Mte(n,E)&&(A+=J,N+=j),E instanceof ShadowRoot?E=E.host:E=E.parentNode}while(!v&&E!==document.body||v&&(t.contains(E)||t===E));return(w&&Math.abs(A)<1||!w&&Math.abs(N)<1)&&(b=!0),b},uO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},lY=function(n){return[n.deltaX,n.deltaY]},uY=function(n){return n&&"current"in n?n.current:n},gxe=function(n,t){return n[0]===t[0]&&n[1]===t[1]},_xe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},Exe=0,cS=[];function yxe(n){var t=D.useRef([]),s=D.useRef([0,0]),a=D.useRef(),l=D.useState(Exe++)[0],d=D.useState(Lte)[0],f=D.useRef(n);D.useEffect(function(){f.current=n},[n]),D.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var B=C1e([n.lockRef.current],(n.shards||[]).map(uY),!0).filter(Boolean);return B.forEach(function(H){return H.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),B.forEach(function(H){return H.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var E=D.useCallback(function(B,H){if("touches"in B&&B.touches.length===2||B.type==="wheel"&&B.ctrlKey)return!f.current.allowPinchZoom;var J=uO(B),$=s.current,te="deltaX"in B?B.deltaX:$[0]-J[0],ce="deltaY"in B?B.deltaY:$[1]-J[1],oe,_e=B.target,ne=Math.abs(te)>Math.abs(ce)?"h":"v";if("touches"in B&&ne==="h"&&_e.type==="range")return!1;var ee=cY(ne,_e);if(!ee)return!0;if(ee?oe=ne:(oe=ne==="v"?"h":"v",ee=cY(ne,_e)),!ee)return!1;if(!a.current&&"changedTouches"in B&&(te||ce)&&(a.current=oe),!oe)return!0;var Q=a.current||oe;return mxe(Q,H,B,Q==="h"?te:ce)},[]),v=D.useCallback(function(B){var H=B;if(!(!cS.length||cS[cS.length-1]!==d)){var J="deltaY"in H?lY(H):uO(H),$=t.current.filter(function(oe){return oe.name===H.type&&(oe.target===H.target||H.target===oe.shadowParent)&&gxe(oe.delta,J)})[0];if($&&$.should){H.cancelable&&H.preventDefault();return}if(!$){var te=(f.current.shards||[]).map(uY).filter(Boolean).filter(function(oe){return oe.contains(H.target)}),ce=te.length>0?E(H,te[0]):!f.current.noIsolation;ce&&H.cancelable&&H.preventDefault()}}},[]),b=D.useCallback(function(B,H,J,$){var te={name:B,delta:H,target:J,should:$,shadowParent:vxe(J)};t.current.push(te),setTimeout(function(){t.current=t.current.filter(function(ce){return ce!==te})},1)},[]),w=D.useCallback(function(B){s.current=uO(B),a.current=void 0},[]),A=D.useCallback(function(B){b(B.type,lY(B),B.target,E(B,n.lockRef.current))},[]),N=D.useCallback(function(B){b(B.type,uO(B),B.target,E(B,n.lockRef.current))},[]);D.useEffect(function(){return cS.push(d),n.setCallbacks({onScrollCapture:A,onWheelCapture:A,onTouchMoveCapture:N}),document.addEventListener("wheel",v,aS),document.addEventListener("touchmove",v,aS),document.addEventListener("touchstart",w,aS),function(){cS=cS.filter(function(B){return B!==d}),document.removeEventListener("wheel",v,aS),document.removeEventListener("touchmove",v,aS),document.removeEventListener("touchstart",w,aS)}},[]);var V=n.removeScrollBar,j=n.inert;return D.createElement(D.Fragment,null,j?D.createElement(d,{styles:_xe(l)}):null,V?D.createElement(cxe,{gapMode:n.gapMode}):null)}function vxe(n){for(var t=null;n!==null;)n instanceof ShadowRoot&&(t=n.host,n=n.host),n=n.parentNode;return t}const Sxe=I1e(Dte,yxe);var Vte=D.forwardRef(function(n,t){return D.createElement(d1,Mh({},n,{ref:t,sideCar:Sxe}))});Vte.classNames=d1.classNames;function bxe(n){const{autoFocus:t,trapFocus:s,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:f,finalFocusRef:E,returnFocusOnClose:v,preserveScrollBarGap:b,lockFocusAcrossFrames:w,isOpen:A}=RE(),[N,V]=JV();D.useEffect(()=>{!N&&V&&setTimeout(V)},[N,V]);const j=Nte(a,A);return C.jsx(pte,{autoFocus:t,isDisabled:!s,initialFocusRef:l,finalFocusRef:E,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:w,children:C.jsx(Vte,{removeScrollBar:!b,allowPinchZoom:f,enabled:j===1&&d,forwardProps:!0,children:n.children})})}const Txe={initial:({offsetX:n,offsetY:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:t,transition:(s==null?void 0:s.exit)??gE.exit(mE.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:t,delay:s})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??gE.enter(mE.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:n,offsetX:t,transition:s,transitionEnd:a,reverse:l,delay:d})=>{const f={x:t,y:n};return{opacity:0,transition:(s==null?void 0:s.exit)??gE.exit(mE.exit,d),...l?{...f,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...f,...a==null?void 0:a.exit}}}}},Ow={initial:"initial",animate:"enter",exit:"exit",variants:Txe},wxe=D.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,className:f,offsetX:E=0,offsetY:v=8,transition:b,transitionEnd:w,delay:A,animatePresenceProps:N,...V}=t,j=a?l&&a:!0,B=l||a?"enter":"exit",H={offsetX:E,offsetY:v,reverse:d,transition:b,transitionEnd:w,delay:A};return C.jsx(w0,{...N,custom:H,children:j&&C.jsx(Mf.div,{ref:s,className:hn("chakra-offset-slide",f),custom:H,...Ow,animate:B,...V})})});wxe.displayName="SlideFade";const Rxe={exit:({reverse:n,initialScale:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(s==null?void 0:s.exit)??gE.exit(mE.exit,l)}),enter:({transitionEnd:n,transition:t,delay:s})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??gE.enter(mE.enter,s),transitionEnd:n==null?void 0:n.enter})},Fte={initial:"exit",animate:"enter",exit:"exit",variants:Rxe},Cxe=D.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:f=.95,className:E,transition:v,transitionEnd:b,delay:w,animatePresenceProps:A,...N}=t,V=a?l&&a:!0,j=l||a?"enter":"exit",B={initialScale:f,reverse:d,transition:v,transitionEnd:b,delay:w};return C.jsx(w0,{...A,custom:B,children:V&&C.jsx(Mf.div,{ref:s,className:hn("chakra-offset-slide",E),...Fte,animate:j,custom:B,...N})})});Cxe.displayName="ScaleFade";const Ixe={slideInBottom:{...Ow,custom:{offsetY:16,reverse:!0}},slideInRight:{...Ow,custom:{offsetX:16,reverse:!0}},slideInTop:{...Ow,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Ow,custom:{offsetX:-16,reverse:!0}},scale:{...Fte,custom:{initialScale:.95,reverse:!0}},none:{}},Axe=Dt(Mf.section),Pxe=n=>Ixe[n||"none"],jte=D.forwardRef((n,t)=>{const{preset:s,motionProps:a=Pxe(s),...l}=n;return C.jsx(Axe,{ref:t,...a,...l})});jte.displayName="ModalTransition";const la=Gt((n,t)=>{const{className:s,children:a,containerProps:l,motionProps:d,...f}=n,{getDialogProps:E,getDialogContainerProps:v}=RE(),b=E(f,t),w=v(l),A=hn("chakra-modal__content",s),N=O0(),V={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},j={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:B}=RE();return C.jsx(bxe,{children:C.jsx(Dt.div,{...w,className:"chakra-modal__content-container",tabIndex:-1,__css:j,children:C.jsx(jte,{preset:B,motionProps:d,className:A,...b,__css:V,children:a})})})});la.displayName="ModalContent";const ua=Gt((n,t)=>{const{className:s,...a}=n,{bodyId:l,setBodyMounted:d}=RE();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=hn("chakra-modal__body",s),E=O0();return C.jsx(Dt.div,{ref:t,className:f,id:l,...a,__css:E.body})});ua.displayName="ModalBody";const Ha=Gt((n,t)=>{const{onClick:s,className:a,...l}=n,{onClose:d}=RE(),f=hn("chakra-modal__close-btn",a),E=O0();return C.jsx(kF,{ref:t,__css:E.closeButton,className:f,onClick:er(s,v=>{v.stopPropagation(),d()}),...l})});Ha.displayName="ModalCloseButton";const _g=Gt((n,t)=>{const{className:s,...a}=n,l=hn("chakra-modal__footer",s),d=O0(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return C.jsx(Dt.footer,{ref:t,...a,__css:f,className:l})});_g.displayName="ModalFooter";const sl=Gt((n,t)=>{const{className:s,...a}=n,{headerId:l,setHeaderMounted:d}=RE();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=hn("chakra-modal__header",s),E=O0(),v={flex:0,...E.header};return C.jsx(Dt.header,{ref:t,className:f,id:l,...a,__css:v})});sl.displayName="ModalHeader";const Oxe={enter:({transition:n,transitionEnd:t,delay:s}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??gE.enter(mE.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({transition:n,transitionEnd:t,delay:s}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??gE.exit(mE.exit,s),transitionEnd:t==null?void 0:t.exit})},Bte={initial:"exit",animate:"enter",exit:"exit",variants:Oxe},kxe=D.forwardRef(function(t,s){const{unmountOnExit:a,in:l,className:d,transition:f,transitionEnd:E,delay:v,animatePresenceProps:b,...w}=t,A=l||a?"enter":"exit",N=a?l&&a:!0,V={transition:f,transitionEnd:E,delay:v};return C.jsx(w0,{...b,custom:V,children:N&&C.jsx(Mf.div,{ref:s,className:hn("chakra-fade",d),custom:V,...Bte,animate:A,...w})})});kxe.displayName="Fade";const Nxe=Dt(Mf.div),da=Gt((n,t)=>{const{className:s,transition:a,motionProps:l,...d}=n,f=hn("chakra-modal__overlay",s),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...O0().overlay},{motionPreset:b}=RE(),A=l||(b==="none"?{}:Bte);return C.jsx(Nxe,{...A,__css:v,ref:t,className:f,...d})});da.displayName="ModalOverlay";function Dxe(n){const{leastDestructiveRef:t,...s}=n;return C.jsx(ca,{...s,initialFocusRef:t})}const Lxe=Gt((n,t)=>C.jsx(la,{ref:t,role:"alertdialog",...n})),[xxe,h1]=Li({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[Mxe,Wte]=Li({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),lS={click:"click",hover:"hover"};function Uxe(n={}){const{closeOnBlur:t=!0,closeOnEsc:s=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:f=!0,arrowSize:E,arrowShadowColor:v,trigger:b=lS.click,openDelay:w=200,closeDelay:A=200,isLazy:N,lazyBehavior:V="unmount",computePositionOnMount:j,...B}=n,{isOpen:H,onClose:J,onOpen:$,onToggle:te}=If(n),[ce,oe]=D.useState(d);D.useEffect(()=>oe(d),[d]);const _e=D.useRef(null),ne=D.useRef(null),ee=D.useRef(null),Q=D.useRef(!1),se=D.useRef(!1);H&&(se.current=!0);const[pe,fe]=D.useState(!1),[ue,Me]=D.useState(!1),He=D.useId(),nt=l??He,[we,Ce,ve,Ne]=["popover-trigger","popover-content","popover-header","popover-body"].map(Bt=>`${Bt}-${nt}`),{referenceRef:Te,getArrowProps:be,getPopperProps:Ae,getArrowInnerProps:Ue,forceUpdate:Ge}=tj({...B,enabled:H||!!j}),Qe=tQ({isOpen:H,ref:ee});PEe({enabled:H,ref:ne}),rQ(ee,{focusRef:ne,visible:H,shouldFocus:ce&&b===lS.click}),SEe(ee,{focusRef:a,visible:H,shouldFocus:f&&b===lS.click}),oQ({enabled:H&&t,ref:ee,handler(Bt){var Fe;const Re=((Fe=Bt.composedPath)==null?void 0:Fe.call(Bt)[0])??[Bt.target];dO(ne.current,Re)||(Re&&oe(!tk(Re)),J())}});const tt=AV({wasSelected:se.current,enabled:N,mode:V,isSelected:Qe.present}),dt=D.useCallback((Bt={},Re=null)=>{const Fe={...Bt,style:{...Bt.style,transformOrigin:Zs.transformOrigin.varRef,[Zs.arrowSize.var]:E?`${E}px`:void 0,[Zs.arrowShadowColor.var]:v},ref:ns(ee,Re),children:tt?Bt.children:null,id:Ce,tabIndex:-1,role:"dialog",onKeyDown:er(Bt.onKeyDown,We=>{We.nativeEvent.isComposing||s&&We.key==="Escape"&&(We.preventDefault(),We.stopPropagation(),J())}),onBlur:er(Bt.onBlur,We=>{const ot=dY(We),Et=dO(ee.current,ot),yt=dO(ne.current,ot),zt=!Et&&!yt;ot&&oe(!tk(ot)),H&&t&&zt&&J()}),"aria-labelledby":pe?ve:void 0,"aria-describedby":ue?Ne:void 0};return b===lS.hover&&(Fe.role="tooltip",Fe.onMouseEnter=er(Bt.onMouseEnter,()=>{Q.current=!0}),Fe.onMouseLeave=er(Bt.onMouseLeave,We=>{We.nativeEvent.relatedTarget!==null&&(Q.current=!1,setTimeout(()=>J(),A))})),Fe},[tt,Ce,pe,ve,ue,Ne,b,s,J,H,t,A,v,E]),Ze=D.useCallback((Bt={},Re=null)=>Ae({...Bt,style:{visibility:H?"visible":"hidden",...Bt.style}},Re),[H,Ae]),wt=D.useCallback((Bt,Re=null)=>({...Bt,ref:ns(Re,_e,Te)}),[_e,Te]),un=D.useRef(void 0),xt=D.useRef(void 0),tn=D.useCallback(Bt=>{_e.current==null&&Te(Bt)},[Te]),kn=D.useCallback((Bt={},Re=null)=>{const Fe={...Bt,ref:ns(ne,Re,tn),id:we,"aria-haspopup":"dialog","aria-expanded":H,"aria-controls":Ce};return b===lS.click&&(Fe.onClick=er(Bt.onClick,te)),b===lS.hover&&(Fe.onFocus=er(Bt.onFocus,()=>{un.current===void 0&&$()}),Fe.onBlur=er(Bt.onBlur,We=>{const ot=dY(We),Et=!dO(ee.current,ot);H&&t&&Et&&J()}),Fe.onKeyDown=er(Bt.onKeyDown,We=>{We.key==="Escape"&&J()}),Fe.onMouseEnter=er(Bt.onMouseEnter,()=>{Q.current=!0,un.current=window.setTimeout(()=>$(),w)}),Fe.onMouseLeave=er(Bt.onMouseLeave,()=>{Q.current=!1,un.current&&(clearTimeout(un.current),un.current=void 0),xt.current=window.setTimeout(()=>{Q.current===!1&&J()},A)})),Fe},[we,H,Ce,b,tn,te,$,t,J,w,A]);D.useEffect(()=>()=>{un.current&&clearTimeout(un.current),xt.current&&clearTimeout(xt.current)},[]);const $t=D.useCallback((Bt={},Re=null)=>({...Bt,id:ve,ref:ns(Re,Fe=>{fe(!!Fe)})}),[ve]),zn=D.useCallback((Bt={},Re=null)=>({...Bt,id:Ne,ref:ns(Re,Fe=>{Me(!!Fe)})}),[Ne]);return{forceUpdate:Ge,isOpen:H,onAnimationComplete:Qe.onComplete,onClose:J,getAnchorProps:wt,getArrowProps:be,getArrowInnerProps:Ue,getPopoverPositionerProps:Ze,getPopoverProps:dt,getTriggerProps:kn,getHeaderProps:$t,getBodyProps:zn}}function dO(n,t){return n===t||(n==null?void 0:n.contains(t))}function dY(n){const t=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??t}function zte(n){const t=gc("Popover",n),{children:s,...a}=Yi(n),l=I0(),d=Uxe({...a,direction:l.direction});return C.jsx(xxe,{value:d,children:C.jsx(Mxe,{value:t,children:el(s,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}zte.displayName="Popover";function Gte(n){var s;const t=D.version;return typeof t!="string"||t.startsWith("18.")?n==null?void 0:n.ref:(s=n==null?void 0:n.props)==null?void 0:s.ref}const Hte=Gt(function(t,s){const{getBodyProps:a}=h1(),l=Wte();return C.jsx(Dt.div,{...a(t,s),className:hn("chakra-popover__body",t.className),__css:l.body})});Hte.displayName="PopoverBody";function Vxe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const Fxe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},jxe=Dt(Mf.section),$te=Gt(function(t,s){const{variants:a=Fxe,...l}=t,{isOpen:d}=h1();return C.jsx(jxe,{ref:s,variants:Vxe(a),initial:!1,animate:d?"enter":"exit",...l})});$te.displayName="PopoverTransition";const Kte=Gt(function(t,s){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:f,getPopoverPositionerProps:E,onAnimationComplete:v}=h1(),b=Wte(),w={position:"relative",display:"flex",flexDirection:"column",...b.content};return C.jsx(Dt.div,{...E(a),__css:b.popper,className:"chakra-popover__popper",children:C.jsx($te,{...l,...f(d,s),onAnimationComplete:YJ(v,d.onAnimationComplete),className:hn("chakra-popover__content",t.className),__css:w})})});Kte.displayName="PopoverContent";function qte(n){const t=D.Children.only(n.children),{getTriggerProps:s}=h1();return C.jsx(C.Fragment,{children:D.cloneElement(t,s(t.props,Gte(t)))})}qte.displayName="PopoverTrigger";function Bxe(n,t,s){return(n-t)*100/(s-t)}xR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});xR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const Wxe=xR({"0%":{left:"-40%"},"100%":{left:"100%"}}),zxe=xR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function Gxe(n){const{value:t=0,min:s,max:a,valueText:l,getValueText:d,isIndeterminate:f,role:E="progressbar"}=n,v=Bxe(t,s,a);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":a,"aria-valuemin":s,"aria-valuenow":f?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,v):l})(),role:E},percent:v,value:t}}const[Hxe,$xe]=Li({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),Kxe=Gt((n,t)=>{const{min:s,max:a,value:l,isIndeterminate:d,role:f,...E}=n,v=Gxe({value:l,min:s,max:a,isIndeterminate:d,role:f}),w={height:"100%",...$xe().filledTrack};return C.jsx(Dt.div,{ref:t,style:{width:`${v.percent}%`,...E.style},...v.bind,...E,__css:w})}),u0=Gt((n,t)=>{var ne;const{value:s,min:a=0,max:l=100,hasStripe:d,isAnimated:f,children:E,borderRadius:v,isIndeterminate:b,"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,title:V,role:j,...B}=Yi(n),H=gc("Progress",n),J=v??((ne=H.track)==null?void 0:ne.borderRadius),$={animation:`${zxe} 1s linear infinite`},oe={...!b&&d&&f&&$,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${Wxe} 1s ease infinite normal none running`}},_e={overflow:"hidden",position:"relative",...H.track};return C.jsx(Dt.div,{ref:t,borderRadius:J,__css:_e,...B,children:C.jsxs(Hxe,{value:H,children:[C.jsx(Kxe,{"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,min:a,max:l,value:s,isIndeterminate:b,css:oe,borderRadius:J,title:V,role:j}),E]})})});u0.displayName="Progress";const Yte=Gt(function(t,s){const{children:a,placeholder:l,className:d,...f}=t;return C.jsxs(Dt.select,{...f,ref:s,className:hn("chakra-select",d),children:[l&&C.jsx("option",{value:"",children:l}),a]})});Yte.displayName="SelectField";const Xte=Gt((n,t)=>{var te;const s=gc("Select",n),{rootProps:a,placeholder:l,icon:d,color:f,height:E,h:v,minH:b,minHeight:w,iconColor:A,iconSize:N,...V}=Yi(n),[j,B]=hEe(V,Pye),H=LF(B),J={width:"100%",height:"fit-content",position:"relative",color:f},$={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(te=s.field)==null?void 0:te._focus}};return C.jsxs(Dt.div,{className:"chakra-select__wrapper",__css:J,...j,...a,children:[C.jsx(Yte,{ref:t,height:v??E,minH:b??w,placeholder:l,...H,__css:$,children:n.children}),C.jsx(Jte,{"data-disabled":Xn(H.disabled),...(A||f)&&{color:A||f},__css:s.icon,...N&&{fontSize:N},children:d})]})});Xte.displayName="Select";const qxe=n=>C.jsx("svg",{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Yxe=Dt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Jte=n=>{const{children:t=C.jsx(qxe,{}),...s}=n,a=D.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return C.jsx(Yxe,{...s,className:"chakra-select__icon-wrapper",children:D.isValidElement(t)?a:null})};Jte.displayName="SelectIcon";function vM(n){const{orientation:t,vertical:s,horizontal:a}=n;return t==="vertical"?s:a}function Xxe(n){const{orientation:t,thumbPercents:s,isReversed:a}=n,l=V=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...vM({orientation:t,vertical:{bottom:`calc(${s[V]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${s[V]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...vM({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},E=s.length===1,v=[0,a?100-s[0]:s[0]],b=E?v:s;let w=b[0];!E&&a&&(w=100-w);const A=Math.abs(b[b.length-1]-b[0]),N={...f,...vM({orientation:t,vertical:a?{height:`${A}%`,top:`${w}%`}:{height:`${A}%`,bottom:`${w}%`},horizontal:a?{width:`${A}%`,right:`${w}%`}:{width:`${A}%`,left:`${w}%`}})};return{trackStyle:f,innerTrackStyle:N,rootStyle:d,getThumbStyle:l}}function Jxe(n){const{isReversed:t,direction:s,orientation:a}=n;return s==="ltr"||a==="vertical"?t:!t}function Qxe(n){const{min:t=0,max:s=100,onChange:a,value:l,defaultValue:d,isReversed:f,direction:E="ltr",orientation:v="horizontal",id:b,isDisabled:w,isReadOnly:A,onChangeStart:N,onChangeEnd:V,step:j=1,getAriaValueText:B,"aria-valuetext":H,"aria-label":J,"aria-labelledby":$,name:te,focusThumbOnChange:ce=!0,...oe}=n,_e=tl(N),ne=tl(V),ee=tl(B),Q=Jxe({isReversed:f,direction:E,orientation:v}),[se,pe]=nQ({value:l,defaultValue:d??e2e(t,s),onChange:a}),[fe,ue]=D.useState(!1),[Me,He]=D.useState(!1),nt=!(w||A),we=(s-t)/10,Ce=j||(s-t)/100,ve=S2(se,t,s),Ne=s-ve+t,be=y$(Q?Ne:ve,t,s),Ae=v==="vertical",Ue=sQ({min:t,max:s,step:j,isDisabled:w,value:ve,isInteractive:nt,isReversed:Q,isVertical:Ae,eventSource:null,focusThumbOnChange:ce,orientation:v}),Ge=D.useRef(null),Qe=D.useRef(null),tt=D.useRef(null),dt=D.useId(),Ze=b??dt,[wt,un]=[`slider-thumb-${Ze}`,`slider-track-${Ze}`],xt=D.useCallback(Vt=>{var Oi;if(!Ge.current)return;const on=Ue.current;on.eventSource="pointer";const Mi=Ge.current.getBoundingClientRect(),{clientX:fs,clientY:Ls}=((Oi=Vt.touches)==null?void 0:Oi[0])??Vt,Zr=Ae?Mi.bottom-Ls:fs-Mi.left,Pt=Ae?Mi.height:Mi.width;let wn=Zr/Pt;Q&&(wn=1-wn);let ir=cEe(wn,on.min,on.max);return on.step&&(ir=parseFloat(v$(ir,on.min,on.step))),ir=S2(ir,on.min,on.max),ir},[Ae,Q,Ue]),tn=D.useCallback(Vt=>{const on=Ue.current;on.isInteractive&&(Vt=parseFloat(v$(Vt,on.min,Ce)),Vt=S2(Vt,on.min,on.max),pe(Vt))},[Ce,pe,Ue]),kn=D.useMemo(()=>({stepUp(Vt=Ce){const on=Q?ve-Vt:ve+Vt;tn(on)},stepDown(Vt=Ce){const on=Q?ve+Vt:ve-Vt;tn(on)},reset(){tn(d||0)},stepTo(Vt){tn(Vt)}}),[tn,Q,ve,Ce,d]),$t=D.useCallback(Vt=>{const on=Ue.current,fs={ArrowRight:()=>kn.stepUp(),ArrowUp:()=>kn.stepUp(),ArrowLeft:()=>kn.stepDown(),ArrowDown:()=>kn.stepDown(),PageUp:()=>kn.stepUp(we),PageDown:()=>kn.stepDown(we),Home:()=>tn(on.min),End:()=>tn(on.max)}[Vt.key];fs&&(Vt.preventDefault(),Vt.stopPropagation(),fs(Vt),on.eventSource="keyboard")},[kn,tn,we,Ue]),zn=(ee==null?void 0:ee(ve))??H,{getThumbStyle:Bt,rootStyle:Re,trackStyle:Fe,innerTrackStyle:We}=D.useMemo(()=>{const Vt=Ue.current;return Xxe({isReversed:Q,orientation:Vt.orientation,thumbPercents:[be]})},[Q,be,Ue]),ot=D.useCallback(()=>{Ue.current.focusThumbOnChange&&setTimeout(()=>{var on;return(on=Qe.current)==null?void 0:on.focus()})},[Ue]);fg(()=>{const Vt=Ue.current;ot(),Vt.eventSource==="keyboard"&&(ne==null||ne(Vt.value))},[ve,ne]);function Et(Vt){const on=xt(Vt);on!=null&&on!==Ue.current.value&&pe(on)}YEe(tt,{onPanSessionStart(Vt){const on=Ue.current;on.isInteractive&&(ue(!0),ot(),Et(Vt),_e==null||_e(on.value))},onPanSessionEnd(){const Vt=Ue.current;Vt.isInteractive&&(ue(!1),ne==null||ne(Vt.value))},onPan(Vt){Ue.current.isInteractive&&Et(Vt)}});const yt=D.useCallback((Vt={},on=null)=>({...Vt,...oe,ref:ns(on,tt),tabIndex:-1,"aria-disabled":DS(w),"data-focused":Xn(Me),style:{...Vt.style,...Re}}),[oe,w,Me,Re]),zt=D.useCallback((Vt={},on=null)=>({...Vt,ref:ns(on,Ge),id:un,"data-disabled":Xn(w),style:{...Vt.style,...Fe}}),[w,un,Fe]),pn=D.useCallback((Vt={},on=null)=>({...Vt,ref:on,style:{...Vt.style,...We}}),[We]),xn=D.useCallback((Vt={},on=null)=>({...Vt,ref:ns(on,Qe),role:"slider",tabIndex:nt?0:void 0,id:wt,"data-active":Xn(fe),"aria-valuetext":zn,"aria-valuemin":t,"aria-valuemax":s,"aria-valuenow":ve,"aria-orientation":v,"aria-disabled":DS(w),"aria-readonly":DS(A),"aria-label":J,"aria-labelledby":J?void 0:$,style:{...Vt.style,...Bt(0)},onKeyDown:er(Vt.onKeyDown,$t),onFocus:er(Vt.onFocus,()=>He(!0)),onBlur:er(Vt.onBlur,()=>He(!1))}),[nt,wt,fe,zn,t,s,ve,v,w,A,J,$,Bt,$t]),cn=D.useCallback((Vt,on=null)=>{const Mi=!(Vt.value<t||Vt.value>s),fs=ve>=Vt.value,Ls=y$(Vt.value,t,s),Zr={position:"absolute",pointerEvents:"none",...Zxe({orientation:v,vertical:{bottom:Q?`${100-Ls}%`:`${Ls}%`},horizontal:{left:Q?`${100-Ls}%`:`${Ls}%`}})};return{...Vt,ref:on,role:"presentation","aria-hidden":!0,"data-disabled":Xn(w),"data-invalid":Xn(!Mi),"data-highlighted":Xn(fs),style:{...Vt.style,...Zr}}},[w,Q,s,t,v,ve]),dr=D.useCallback((Vt={},on=null)=>({...Vt,ref:on,type:"hidden",value:ve,name:te}),[te,ve]);return{state:{value:ve,isFocused:Me,isDragging:fe},actions:kn,getRootProps:yt,getTrackProps:zt,getInnerTrackProps:pn,getThumbProps:xn,getMarkerProps:cn,getInputProps:dr}}function Zxe(n){const{orientation:t,vertical:s,horizontal:a}=n;return t==="vertical"?s:a}function e2e(n,t){return t<n?n:n+(t-n)/2}const[t2e,p1]=Li({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[n2e,f1]=Li({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),UU=Gt((n,t)=>{const s={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=gc("Slider",s),l=Yi(s),{direction:d}=I0();l.direction=d;const{getInputProps:f,getRootProps:E,...v}=Qxe(l),b=E(),w=f({},t);return C.jsx(t2e,{value:v,children:C.jsx(n2e,{value:a,children:C.jsxs(Dt.div,{...b,className:hn("chakra-slider",s.className),__css:a.container,children:[s.children,C.jsx("input",{...w})]})})})});UU.displayName="Slider";const VU=Gt((n,t)=>{const{getThumbProps:s}=p1(),a=f1(),l=s(n,t);return C.jsx(Dt.div,{...l,className:hn("chakra-slider__thumb",n.className),__css:a.thumb})});VU.displayName="SliderThumb";const FU=Gt((n,t)=>{const{getTrackProps:s}=p1(),a=f1(),l=s(n,t);return C.jsx(Dt.div,{...l,className:hn("chakra-slider__track",n.className),__css:a.track})});FU.displayName="SliderTrack";const jU=Gt((n,t)=>{const{getInnerTrackProps:s}=p1(),a=f1(),l=s(n,t);return C.jsx(Dt.div,{...l,className:hn("chakra-slider__filled-track",n.className),__css:a.filledTrack})});jU.displayName="SliderFilledTrack";const r2e=Gt((n,t)=>{const{getMarkerProps:s}=p1(),a=f1(),l=s(n,t);return C.jsx(Dt.div,{...l,className:hn("chakra-slider__marker",n.className),__css:a.mark})});r2e.displayName="SliderMark";const gk=Dt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});gk.displayName="Spacer";const Qte=n=>C.jsx(Dt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Qte.displayName="StackItem";function i2e(n){const{spacing:t,direction:s}=n,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":PV(s,l=>a[l])}}const nj=Gt((n,t)=>{const{isInline:s,direction:a,align:l,justify:d,spacing:f="0.5rem",wrap:E,children:v,divider:b,className:w,shouldWrapChildren:A,...N}=n,V=s?"row":a??"column",j=D.useMemo(()=>i2e({spacing:f,direction:V}),[f,V]),B=!!b,H=!A&&!B,J=D.useMemo(()=>{const te=IV(v);return H?te:te.map((ce,oe)=>{const _e=typeof ce.key<"u"?ce.key:oe,ne=oe+1===te.length,Q=A?C.jsx(Qte,{children:ce},_e):ce;if(!B)return Q;const se=D.cloneElement(b,{__css:j}),pe=ne?null:se;return C.jsxs(D.Fragment,{children:[Q,pe]},_e)})},[b,j,B,H,A,v]),$=hn("chakra-stack",w);return C.jsx(Dt.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:V,flexWrap:E,gap:B?void 0:f,className:$,...N,children:J})});nj.displayName="Stack";const fi=Gt((n,t)=>C.jsx(nj,{align:"center",...n,direction:"row",ref:t}));fi.displayName="HStack";const Di=Gt((n,t)=>C.jsx(nj,{align:"center",...n,direction:"column",ref:t}));Di.displayName="VStack";const Tf=Gt(function(t,s){const a=gc("Switch",t),{spacing:l="0.5rem",children:d,...f}=Yi(t),{getIndicatorProps:E,getInputProps:v,getCheckboxProps:b,getRootProps:w,getLabelProps:A}=f1e(f),N=D.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),V=D.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),j=D.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return C.jsxs(Dt.label,{...w(),className:hn("chakra-switch",t.className),__css:N,children:[C.jsx("input",{className:"chakra-switch__input",...v({},s)}),C.jsx(Dt.span,{...b(),className:"chakra-switch__track",__css:V,children:C.jsx(Dt.span,{__css:a.thumb,className:"chakra-switch__thumb",...E()})}),d&&C.jsx(Dt.span,{className:"chakra-switch__label",...A(),__css:j,children:d})]})});Tf.displayName="Switch";const[s2e,o2e,a2e,c2e]=Aee();function l2e(n){const{defaultIndex:t,onChange:s,index:a,isManual:l,isLazy:d,lazyBehavior:f="unmount",orientation:E="horizontal",direction:v="ltr",...b}=n,[w,A]=D.useState(t??0),[N,V]=nQ({defaultValue:t??0,value:a,onChange:s});D.useEffect(()=>{a!=null&&A(a)},[a]);const j=a2e(),B=D.useId();return{id:`tabs-${n.id??B}`,selectedIndex:N,focusedIndex:w,setSelectedIndex:V,setFocusedIndex:A,isManual:l,isLazy:d,lazyBehavior:f,orientation:E,descendants:j,direction:v,htmlProps:b}}const[u2e,m1]=Li({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function d2e(n){const{focusedIndex:t,orientation:s,direction:a}=m1(),l=o2e(),d=D.useCallback(f=>{const E=()=>{var te;const $=l.nextEnabled(t);$&&((te=$.node)==null||te.focus())},v=()=>{var te;const $=l.prevEnabled(t);$&&((te=$.node)==null||te.focus())},b=()=>{var te;const $=l.firstEnabled();$&&((te=$.node)==null||te.focus())},w=()=>{var te;const $=l.lastEnabled();$&&((te=$.node)==null||te.focus())},A=s==="horizontal",N=s==="vertical",V=f.key,j=a==="ltr"?"ArrowLeft":"ArrowRight",B=a==="ltr"?"ArrowRight":"ArrowLeft",J={[j]:()=>A&&v(),[B]:()=>A&&E(),ArrowDown:()=>N&&E(),ArrowUp:()=>N&&v(),Home:b,End:w}[V];J&&(f.preventDefault(),J(f))},[l,t,s,a]);return{...n,role:"tablist","aria-orientation":s,onKeyDown:er(n.onKeyDown,d)}}function h2e(n){const{isDisabled:t=!1,isFocusable:s=!1,...a}=n,{setSelectedIndex:l,isManual:d,id:f,setFocusedIndex:E,selectedIndex:v}=m1(),{index:b,register:w}=c2e({disabled:t&&!s}),A=b===v,N=()=>{l(b)},V=()=>{E(b),!d&&!(t&&s)&&l(b)};return{...Cte({...a,ref:ns(w,n.ref),isDisabled:t,isFocusable:s,onClick:er(n.onClick,N)}),id:Zte(f,b),role:"tab",tabIndex:A?0:-1,type:"button","aria-selected":A,"aria-controls":ene(f,b),onFocus:t?void 0:er(n.onFocus,V)}}const[p2e,f2e]=Li({});function m2e(n){const t=m1(),{id:s,selectedIndex:a}=t,d=IV(n.children).map((f,E)=>D.createElement(p2e,{key:f.key??E,value:{isSelected:E===a,id:ene(s,E),tabId:Zte(s,E),selectedIndex:a}},f));return{...n,children:d}}function g2e(n){const{children:t,...s}=n,{isLazy:a,lazyBehavior:l}=m1(),{isSelected:d,id:f,tabId:E}=f2e(),v=D.useRef(!1);d&&(v.current=!0);const b=AV({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...s,children:b?t:null,role:"tabpanel","aria-labelledby":E,hidden:!d,id:f}}function Zte(n,t){return`${n}--tab-${t}`}function ene(n,t){return`${n}--tabpanel-${t}`}const[_2e,g1]=Li({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),$R=Gt(function(t,s){const a=gc("Tabs",t),{children:l,className:d,...f}=Yi(t),{htmlProps:E,descendants:v,...b}=l2e(f),w=D.useMemo(()=>b,[b]),{isFitted:A,...N}=E,V={position:"relative",...a.root};return C.jsx(s2e,{value:v,children:C.jsx(u2e,{value:w,children:C.jsx(_2e,{value:a,children:C.jsx(Dt.div,{className:hn("chakra-tabs",d),ref:s,...N,__css:V,children:l})})})})});$R.displayName="Tabs";const hc=Gt(function(t,s){const a=g1(),l=h2e({...t,ref:s}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return C.jsx(Dt.button,{...l,className:hn("chakra-tabs__tab",t.className),__css:d})});hc.displayName="Tab";const KR=Gt(function(t,s){const a=d2e({...t,ref:s}),l=g1(),d={display:"flex",...l.tablist};return C.jsx(Dt.div,{...a,className:hn("chakra-tabs__tablist",t.className),__css:d})});KR.displayName="TabList";const Ol=Gt(function(t,s){const a=g2e({...t,ref:s}),l=g1();return C.jsx(Dt.div,{outline:"0",...a,className:hn("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});Ol.displayName="TabPanel";const _1=Gt(function(t,s){const a=m2e(t),l=g1();return C.jsx(Dt.div,{...a,width:"100%",ref:s,className:hn("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});_1.displayName="TabPanels";const[E2e,tne]=Li({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),nne=Gt((n,t)=>{const s=gc("Tag",n),a=Yi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...s.container};return C.jsx(E2e,{value:s,children:C.jsx(Dt.span,{ref:t,...a,__css:l})})});nne.displayName="Tag";const rne=Gt((n,t)=>{const s=tne();return C.jsx(Dt.span,{ref:t,noOfLines:1,...n,__css:s.label})});rne.displayName="TagLabel";const y2e=Gt((n,t)=>C.jsx(Ln,{ref:t,verticalAlign:"top",marginEnd:"0.5rem",...n}));y2e.displayName="TagLeftIcon";const v2e=Gt((n,t)=>C.jsx(Ln,{ref:t,verticalAlign:"top",marginStart:"0.5rem",...n}));v2e.displayName="TagRightIcon";const ine=n=>C.jsx(Ln,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:C.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});ine.displayName="TagCloseIcon";const sne=Gt((n,t)=>{const{isDisabled:s,children:a,...l}=n,f={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...tne().closeButton};return C.jsx(Dt.button,{ref:t,"aria-label":"close",...l,type:"button",disabled:s,__css:f,children:a||C.jsx(ine,{})})});sne.displayName="TagCloseButton";const S2e=["h","minH","height","minHeight"],one=Gt((n,t)=>{const s=ku("Textarea",n),{className:a,rows:l,...d}=Yi(n),f=LF(d),E=l?b0(s,S2e):s;return C.jsx(Dt.textarea,{ref:t,rows:l,...f,className:hn("chakra-textarea",a),__css:E})});one.displayName="Textarea";function b2e(n,t){const s=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[s];return(l==null?void 0:l[t])??s}function T2e(n,t){const s=l=>({...t,...l,position:b2e((l==null?void 0:l.position)??(t==null?void 0:t.position),n)}),a=l=>{const d=s(l),f=Ree(d);return xh.notify(f,d)};return a.update=(l,d)=>{xh.update(l,s(d))},a.promise=(l,d)=>{const f=a({...d.loading,status:"loading",duration:null});l.then(E=>a.update(f,{status:"success",duration:5e3,...el(d.success,E)})).catch(E=>a.update(f,{status:"error",duration:5e3,...el(d.error,E)}))},a.closeAll=xh.closeAll,a.close=xh.close,a.isActive=xh.isActive,a}function Du(n){const{theme:t}=bee(),s=Fke();return D.useMemo(()=>T2e(t.direction,{...s,...n}),[n,t.direction,s])}const w2e={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},BU=n=>{var t;return((t=n.current)==null?void 0:t.ownerDocument)||document},jO=n=>{var t,s;return((s=(t=n.current)==null?void 0:t.ownerDocument)==null?void 0:s.defaultView)||window};function R2e(n={}){const{openDelay:t=0,closeDelay:s=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:f=l,closeOnEsc:E=!0,onOpen:v,onClose:b,placement:w,id:A,isOpen:N,defaultIsOpen:V,arrowSize:j=10,arrowShadowColor:B,arrowPadding:H,modifiers:J,isDisabled:$,gutter:te,offset:ce,direction:oe,..._e}=n,{isOpen:ne,onOpen:ee,onClose:Q}=If({isOpen:N,defaultIsOpen:V,onOpen:v,onClose:b}),{referenceRef:se,getPopperProps:pe,getArrowInnerProps:fe,getArrowProps:ue}=tj({enabled:ne,placement:w,arrowPadding:H,modifiers:J,gutter:te,offset:ce,direction:oe}),Me=D.useId(),nt=`tooltip-${A??Me}`,we=D.useRef(null),Ce=D.useRef(void 0),ve=D.useCallback(()=>{Ce.current&&(clearTimeout(Ce.current),Ce.current=void 0)},[]),Ne=D.useRef(void 0),Te=D.useCallback(()=>{Ne.current&&(clearTimeout(Ne.current),Ne.current=void 0)},[]),be=D.useCallback(()=>{Te(),Q()},[Q,Te]),Ae=C2e(we,be),Ue=D.useCallback(()=>{if(!$&&!Ce.current){ne&&Ae();const xt=jO(we);Ce.current=xt.setTimeout(ee,t)}},[Ae,$,ne,ee,t]),Ge=D.useCallback(()=>{ve();const xt=jO(we);Ne.current=xt.setTimeout(be,s)},[s,be,ve]),Qe=D.useCallback(()=>{ne&&a&&Ge()},[a,Ge,ne]),tt=D.useCallback(()=>{ne&&f&&Ge()},[f,Ge,ne]),dt=D.useCallback(xt=>{ne&&xt.key==="Escape"&&Ge()},[ne,Ge]);LS(()=>BU(we),"keydown",E?dt:void 0),LS(()=>{if(!d)return null;const xt=we.current;if(!xt)return null;const tn=eQ(xt);return tn.localName==="body"?jO(we):tn},"scroll",()=>{ne&&d&&be()},{passive:!0,capture:!0}),D.useEffect(()=>{$&&(ve(),ne&&Q())},[$,ne,Q,ve]),D.useEffect(()=>()=>{ve(),Te()},[ve,Te]),LS(()=>we.current,"pointerleave",Ge);const Ze=D.useCallback((xt={},tn=null)=>({...xt,ref:ns(we,tn,se),onPointerEnter:er(xt.onPointerEnter,$t=>{$t.pointerType!=="touch"&&Ue()}),onClick:er(xt.onClick,Qe),onPointerDown:er(xt.onPointerDown,tt),onFocus:er(xt.onFocus,Ue),onBlur:er(xt.onBlur,Ge),"aria-describedby":ne?nt:void 0}),[Ue,Ge,tt,ne,nt,Qe,se]),wt=D.useCallback((xt={},tn=null)=>pe({...xt,style:{...xt.style,[Zs.arrowSize.var]:j?`${j}px`:void 0,[Zs.arrowShadowColor.var]:B}},tn),[pe,j,B]),un=D.useCallback((xt={},tn=null)=>{const kn={...xt.style,position:"relative",transformOrigin:Zs.transformOrigin.varRef};return{ref:tn,..._e,...xt,id:nt,role:"tooltip",style:kn}},[_e,nt]);return{isOpen:ne,show:Ue,hide:Ge,getTriggerProps:Ze,getTooltipProps:un,getTooltipPositionerProps:wt,getArrowProps:ue,getArrowInnerProps:fe}}const SM="chakra-ui:close-tooltip";function C2e(n,t){return D.useEffect(()=>{const s=BU(n);return s.addEventListener(SM,t),()=>s.removeEventListener(SM,t)},[t,n]),()=>{const s=BU(n),a=jO(n);s.dispatchEvent(new a.CustomEvent(SM))}}const I2e=Dt(Mf.div),wf=Gt((n,t)=>{const s=ku("Tooltip",n),a=Yi(n),l=I0(),{children:d,label:f,shouldWrapChildren:E,"aria-label":v,hasArrow:b,bg:w,portalProps:A,background:N,backgroundColor:V,bgColor:j,motionProps:B,animatePresenceProps:H,...J}=a,$=N??V??w??j;if($){s.bg=$;const se=Fye(l,"colors",$);s[Zs.arrowBg.var]=se}const te=R2e({...J,direction:l.direction}),ce=!D.isValidElement(d)||E;let oe;if(ce)oe=C.jsx(Dt.span,{display:"inline-block",tabIndex:0,...te.getTriggerProps(),children:d});else{const se=D.Children.only(d);oe=D.cloneElement(se,te.getTriggerProps(se.props,Gte(se)))}const _e=!!v,ne=te.getTooltipProps({},t),ee=_e?b0(ne,["role","id"]):ne,Q=ZJ(ne,["role","id"]);return f?C.jsxs(C.Fragment,{children:[oe,C.jsx(w0,{...H,children:te.isOpen&&C.jsx(Nu,{...A,children:C.jsx(Dt.div,{...te.getTooltipPositionerProps(),__css:{zIndex:s.zIndex,pointerEvents:"none"},children:C.jsxs(I2e,{variants:w2e,initial:"exit",animate:"enter",exit:"exit",...B,...ee,__css:s,children:[f,_e&&C.jsx(Dt.span,{srOnly:!0,...Q,children:v}),b&&C.jsx(Dt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:C.jsx(Dt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:s.bg}})})]})})})})]}):C.jsx(C.Fragment,{children:d})});wf.displayName="Tooltip";const _k=Gt(function(t,s){const a=ku("Heading",t),{className:l,...d}=Yi(t);return C.jsx(Dt.h2,{ref:s,className:hn("chakra-heading",t.className),...d,__css:a})});_k.displayName="Heading";const ht=Gt(function(t,s){const a=ku("Text",t),{className:l,align:d,decoration:f,casing:E,...v}=Yi(t),b=Gk({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return C.jsx(Dt.p,{ref:s,className:hn("chakra-text",t.className),...b,...v,__css:a})});ht.displayName="Text";const ane=Gt(function(t,s){const{spacing:a="0.5rem",spacingX:l,spacingY:d,children:f,justify:E,direction:v,align:b,className:w,shouldWrapChildren:A,...N}=t,V=D.useMemo(()=>A?D.Children.map(f,(j,B)=>C.jsx(rj,{children:j},B)):f,[f,A]);return C.jsx(Dt.div,{ref:s,className:hn("chakra-wrap",w),...N,children:C.jsx(Dt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:E,alignItems:b,flexDirection:v,listStyleType:"none",gap:a,columnGap:l,rowGap:d,padding:"0"},children:V})})});ane.displayName="Wrap";const rj=Gt(function(t,s){const{className:a,...l}=t;return C.jsx(Dt.li,{ref:s,__css:{display:"flex",alignItems:"flex-start"},className:hn("chakra-wrap__listitem",a),...l})});rj.displayName="WrapItem";const A2e="modulepreload",P2e=function(n,t){return new URL(n,t).href},hY={},bM=function(t,s,a){let l=Promise.resolve();if(s&&s.length>0){const f=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),v=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));l=Promise.allSettled(s.map(b=>{if(b=P2e(b,a),b in hY)return;hY[b]=!0;const w=b.endsWith(".css"),A=w?'[rel="stylesheet"]':"";if(!!a)for(let j=f.length-1;j>=0;j--){const B=f[j];if(B.href===b&&(!w||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${A}`))return;const V=document.createElement("link");if(V.rel=w?"stylesheet":A2e,w||(V.as="script"),V.crossOrigin="",V.href=b,v&&V.setAttribute("nonce",v),document.head.appendChild(V),w)return new Promise((j,B)=>{V.addEventListener("load",j),V.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(f){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=f,window.dispatchEvent(E),!E.defaultPrevented)throw f}return l.then(f=>{for(const E of f||[])E.status==="rejected"&&d(E.reason);return t().catch(d)})},hO=()=>{const n=new Date,t=n.getHours().toString().padStart(2,"0"),s=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${t}:${s}:${a}.${l}`},he={log:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.log(`[LOG] [${hO()}] `,...t)}},error:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.error(`[ERROR] [${hO()}] `,...t)}},warn:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.warn(`[WARN] [${hO()}]`,...t)}},trace:n=>{console.trace(`[TRACE] [${hO()}] ${n}`)}};async function O2e(n){let t;try{switch(n){case"default":t=await bM(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:t=await bM(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return t.default}catch(s){return he.error("Failed to load theme:",s),t=await bM(()=>import("./index.v0.9.22.js"),[],import.meta.url),t.default}}const k2e=()=>{};var pY={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cne=function(n){const t=[];let s=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?t[s++]=l:l<2048?(t[s++]=l>>6|192,t[s++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),t[s++]=l>>18|240,t[s++]=l>>12&63|128,t[s++]=l>>6&63|128,t[s++]=l&63|128):(t[s++]=l>>12|224,t[s++]=l>>6&63|128,t[s++]=l&63|128)}return t},N2e=function(n){const t=[];let s=0,a=0;for(;s<n.length;){const l=n[s++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[s++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[s++],f=n[s++],E=n[s++],v=((l&7)<<18|(d&63)<<12|(f&63)<<6|E&63)-65536;t[a++]=String.fromCharCode(55296+(v>>10)),t[a++]=String.fromCharCode(56320+(v&1023))}else{const d=n[s++],f=n[s++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|f&63)}}return t.join("")},lne={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const d=n[l],f=l+1<n.length,E=f?n[l+1]:0,v=l+2<n.length,b=v?n[l+2]:0,w=d>>2,A=(d&3)<<4|E>>4;let N=(E&15)<<2|b>>6,V=b&63;v||(V=64,f||(N=64)),a.push(s[w],s[A],s[N],s[V])}return a.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(cne(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):N2e(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const d=s[n.charAt(l++)],E=l<n.length?s[n.charAt(l)]:0;++l;const b=l<n.length?s[n.charAt(l)]:64;++l;const A=l<n.length?s[n.charAt(l)]:64;if(++l,d==null||E==null||b==null||A==null)throw new D2e;const N=d<<2|E>>4;if(a.push(N),b!==64){const V=E<<4&240|b>>2;if(a.push(V),A!==64){const j=b<<6&192|A;a.push(j)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class D2e extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const L2e=function(n){const t=cne(n);return lne.encodeByteArray(t,!0)},Ek=function(n){return L2e(n).replace(/\./g,"")},une=function(n){try{return lne.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x2e(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M2e=()=>x2e().__FIREBASE_DEFAULTS__,U2e=()=>{if(typeof process>"u"||typeof pY>"u")return;const n=pY.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},V2e=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&une(n[1]);return t&&JSON.parse(t)},E1=()=>{try{return k2e()||M2e()||U2e()||V2e()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},dne=n=>{var t,s;return(s=(t=E1())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[n]},hne=n=>{const t=dne(n);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(s+1),10);return t[0]==="["?[t.substring(1,s-1),a]:[t.substring(0,s),a]},pne=()=>{var n;return(n=E1())===null||n===void 0?void 0:n.config},fne=n=>{var t;return(t=E1())===null||t===void 0?void 0:t[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F2e{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mne(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=t||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Ek(JSON.stringify(s)),Ek(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $a(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function j2e(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($a())}function B2e(){var n;const t=(n=E1())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function W2e(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function z2e(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function G2e(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function H2e(){const n=$a();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function $2e(){return!B2e()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function K2e(){try{return typeof indexedDB=="object"}catch{return!1}}function q2e(){return new Promise((n,t)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),s||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{s=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y2e="FirebaseError";class ip extends Error{constructor(t,s,a){super(s),this.code=t,this.customData=a,this.name=Y2e,Object.setPrototypeOf(this,ip.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,qR.prototype.create)}}class qR{constructor(t,s,a){this.service=t,this.serviceName=s,this.errors=a}create(t,...s){const a=s[0]||{},l=`${this.service}/${t}`,d=this.errors[t],f=d?X2e(d,a):"Error",E=`${this.serviceName}: ${f} (${l}).`;return new ip(l,E,a)}}function X2e(n,t){return n.replace(J2e,(s,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const J2e=/\{\$([^}]+)}/g;function Q2e(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function kf(n,t){if(n===t)return!0;const s=Object.keys(n),a=Object.keys(t);for(const l of s){if(!a.includes(l))return!1;const d=n[l],f=t[l];if(fY(d)&&fY(f)){if(!kf(d,f))return!1}else if(d!==f)return!1}for(const l of a)if(!s.includes(l))return!1;return!0}function fY(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YR(n){const t=[];for(const[s,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function kw(n){const t={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function Nw(n){const t=n.indexOf("?");if(!t)return"";const s=n.indexOf("#",t);return n.substring(t,s>0?s:void 0)}function Z2e(n,t){const s=new eMe(n,t);return s.subscribe.bind(s)}class eMe{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,a){let l;if(t===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");tMe(t,["next","error","complete"])?l=t:l={next:t,error:s,complete:a},l.next===void 0&&(l.next=TM),l.error===void 0&&(l.error=TM),l.complete===void 0&&(l.complete=TM);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function tMe(n,t){if(typeof n!="object"||n===null)return!1;for(const s of t)if(s in n&&typeof n[s]=="function")return!0;return!1}function TM(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rs(n){return n&&n._delegate?n._delegate:n}class Eg{constructor(t,s,a){this.name=t,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rE="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nMe{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const a=new F2e;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:s});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(iMe(t))try{this.getOrInitializeService({instanceIdentifier:rE})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=rE){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=rE){return this.instances.has(t)}getOptions(t=rE){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[d,f]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(d);a===E&&f.resolve(l)}return l}onInit(t,s){var a;const l=this.normalizeInstanceIdentifier(s),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const f=this.instances.get(l);return f&&t(f,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,s){const a=this.onInitCallbacks.get(s);if(a)for(const l of a)try{l(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:rMe(t),options:s}),this.instances.set(t,a),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=rE){return this.component?this.component.multipleInstances?t:rE:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function rMe(n){return n===rE?void 0:n}function iMe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sMe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new nMe(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Tr||(Tr={}));const oMe={debug:Tr.DEBUG,verbose:Tr.VERBOSE,info:Tr.INFO,warn:Tr.WARN,error:Tr.ERROR,silent:Tr.SILENT},aMe=Tr.INFO,cMe={[Tr.DEBUG]:"log",[Tr.VERBOSE]:"log",[Tr.INFO]:"info",[Tr.WARN]:"warn",[Tr.ERROR]:"error"},lMe=(n,t,...s)=>{if(t<n.logLevel)return;const a=new Date().toISOString(),l=cMe[t];if(l)console[l](`[${a}]  ${n.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ij{constructor(t){this.name=t,this._logLevel=aMe,this._logHandler=lMe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Tr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?oMe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Tr.DEBUG,...t),this._logHandler(this,Tr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Tr.VERBOSE,...t),this._logHandler(this,Tr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Tr.INFO,...t),this._logHandler(this,Tr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Tr.WARN,...t),this._logHandler(this,Tr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Tr.ERROR,...t),this._logHandler(this,Tr.ERROR,...t)}}const uMe=(n,t)=>t.some(s=>n instanceof s);let mY,gY;function dMe(){return mY||(mY=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function hMe(){return gY||(gY=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const gne=new WeakMap,WU=new WeakMap,_ne=new WeakMap,wM=new WeakMap,sj=new WeakMap;function pMe(n){const t=new Promise((s,a)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",f)},d=()=>{s(cg(n.result)),l()},f=()=>{a(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",f)});return t.then(s=>{s instanceof IDBCursor&&gne.set(s,n)}).catch(()=>{}),sj.set(t,n),t}function fMe(n){if(WU.has(n))return;const t=new Promise((s,a)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",f),n.removeEventListener("abort",f)},d=()=>{s(),l()},f=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",f),n.addEventListener("abort",f)});WU.set(n,t)}let zU={get(n,t,s){if(n instanceof IDBTransaction){if(t==="done")return WU.get(n);if(t==="objectStoreNames")return n.objectStoreNames||_ne.get(n);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return cg(n[t])},set(n,t,s){return n[t]=s,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function mMe(n){zU=n(zU)}function gMe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const a=n.call(RM(this),t,...s);return _ne.set(a,t.sort?t.sort():[t]),cg(a)}:hMe().includes(n)?function(...t){return n.apply(RM(this),t),cg(gne.get(this))}:function(...t){return cg(n.apply(RM(this),t))}}function _Me(n){return typeof n=="function"?gMe(n):(n instanceof IDBTransaction&&fMe(n),uMe(n,dMe())?new Proxy(n,zU):n)}function cg(n){if(n instanceof IDBRequest)return pMe(n);if(wM.has(n))return wM.get(n);const t=_Me(n);return t!==n&&(wM.set(n,t),sj.set(t,n)),t}const RM=n=>sj.get(n);function EMe(n,t,{blocked:s,upgrade:a,blocking:l,terminated:d}={}){const f=indexedDB.open(n,t),E=cg(f);return a&&f.addEventListener("upgradeneeded",v=>{a(cg(f.result),v.oldVersion,v.newVersion,cg(f.transaction),v)}),s&&f.addEventListener("blocked",v=>s(v.oldVersion,v.newVersion,v)),E.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),E}const yMe=["get","getKey","getAll","getAllKeys","count"],vMe=["put","add","delete","clear"],CM=new Map;function _Y(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(CM.get(t))return CM.get(t);const s=t.replace(/FromIndex$/,""),a=t!==s,l=vMe.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(l||yMe.includes(s)))return;const d=async function(f,...E){const v=this.transaction(f,l?"readwrite":"readonly");let b=v.store;return a&&(b=b.index(E.shift())),(await Promise.all([b[s](...E),l&&v.done]))[0]};return CM.set(t,d),d}mMe(n=>({...n,get:(t,s,a)=>_Y(t,s)||n.get(t,s,a),has:(t,s)=>!!_Y(t,s)||n.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SMe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(bMe(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function bMe(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const GU="@firebase/app",EY="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nf=new ij("@firebase/app"),TMe="@firebase/app-compat",wMe="@firebase/analytics-compat",RMe="@firebase/analytics",CMe="@firebase/app-check-compat",IMe="@firebase/app-check",AMe="@firebase/auth",PMe="@firebase/auth-compat",OMe="@firebase/database",kMe="@firebase/data-connect",NMe="@firebase/database-compat",DMe="@firebase/functions",LMe="@firebase/functions-compat",xMe="@firebase/installations",MMe="@firebase/installations-compat",UMe="@firebase/messaging",VMe="@firebase/messaging-compat",FMe="@firebase/performance",jMe="@firebase/performance-compat",BMe="@firebase/remote-config",WMe="@firebase/remote-config-compat",zMe="@firebase/storage",GMe="@firebase/storage-compat",HMe="@firebase/firestore",$Me="@firebase/vertexai",KMe="@firebase/firestore-compat",qMe="firebase",YMe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HU="[DEFAULT]",XMe={[GU]:"fire-core",[TMe]:"fire-core-compat",[RMe]:"fire-analytics",[wMe]:"fire-analytics-compat",[IMe]:"fire-app-check",[CMe]:"fire-app-check-compat",[AMe]:"fire-auth",[PMe]:"fire-auth-compat",[OMe]:"fire-rtdb",[kMe]:"fire-data-connect",[NMe]:"fire-rtdb-compat",[DMe]:"fire-fn",[LMe]:"fire-fn-compat",[xMe]:"fire-iid",[MMe]:"fire-iid-compat",[UMe]:"fire-fcm",[VMe]:"fire-fcm-compat",[FMe]:"fire-perf",[jMe]:"fire-perf-compat",[BMe]:"fire-rc",[WMe]:"fire-rc-compat",[zMe]:"fire-gcs",[GMe]:"fire-gcs-compat",[HMe]:"fire-fst",[KMe]:"fire-fst-compat",[$Me]:"fire-vertex","fire-js":"fire-js",[qMe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yk=new Map,JMe=new Map,$U=new Map;function yY(n,t){try{n.container.addComponent(t)}catch(s){Nf.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,s)}}function CE(n){const t=n.name;if($U.has(t))return Nf.debug(`There were multiple attempts to register component ${t}.`),!1;$U.set(t,n);for(const s of yk.values())yY(s,n);for(const s of JMe.values())yY(s,n);return!0}function y1(n,t){const s=n.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),n.container.getProvider(t)}function kl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QMe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},lg=new qR("app","Firebase",QMe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZMe{constructor(t,s,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Eg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw lg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xE=YMe;function Ene(n,t={}){let s=n;typeof t!="object"&&(t={name:t});const a=Object.assign({name:HU,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw lg.create("bad-app-name",{appName:String(l)});if(s||(s=pne()),!s)throw lg.create("no-options");const d=yk.get(l);if(d){if(kf(s,d.options)&&kf(a,d.config))return d;throw lg.create("duplicate-app",{appName:l})}const f=new sMe(l);for(const v of $U.values())f.addComponent(v);const E=new ZMe(s,a,f);return yk.set(l,E),E}function oj(n=HU){const t=yk.get(n);if(!t&&n===HU&&pne())return Ene();if(!t)throw lg.create("no-app",{appName:n});return t}function Kh(n,t,s){var a;let l=(a=XMe[n])!==null&&a!==void 0?a:n;s&&(l+=`-${s}`);const d=l.match(/\s|\//),f=t.match(/\s|\//);if(d||f){const E=[`Unable to register library "${l}" with version "${t}":`];d&&E.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&f&&E.push("and"),f&&E.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Nf.warn(E.join(" "));return}CE(new Eg(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eUe="firebase-heartbeat-database",tUe=1,TR="firebase-heartbeat-store";let IM=null;function yne(){return IM||(IM=EMe(eUe,tUe,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(TR)}catch(s){console.warn(s)}}}}).catch(n=>{throw lg.create("idb-open",{originalErrorMessage:n.message})})),IM}async function nUe(n){try{const s=(await yne()).transaction(TR),a=await s.objectStore(TR).get(vne(n));return await s.done,a}catch(t){if(t instanceof ip)Nf.warn(t.message);else{const s=lg.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Nf.warn(s.message)}}}async function vY(n,t){try{const a=(await yne()).transaction(TR,"readwrite");await a.objectStore(TR).put(t,vne(n)),await a.done}catch(s){if(s instanceof ip)Nf.warn(s.message);else{const a=lg.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Nf.warn(a.message)}}}function vne(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rUe=1024,iUe=30;class sUe{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new aUe(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,s;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=SY();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(f=>f.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>iUe){const f=cUe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Nf.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=SY(),{heartbeatsToSend:a,unsentEntries:l}=oUe(this._heartbeatsCache.heartbeats),d=Ek(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(s){return Nf.warn(s),""}}}function SY(){return new Date().toISOString().substring(0,10)}function oUe(n,t=rUe){const s=[];let a=n.slice();for(const l of n){const d=s.find(f=>f.agent===l.agent);if(d){if(d.dates.push(l.date),bY(s)>t){d.dates.pop();break}}else if(s.push({agent:l.agent,dates:[l.date]}),bY(s)>t){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class aUe{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return K2e()?q2e().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await nUe(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return vY(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return vY(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function bY(n){return Ek(JSON.stringify({version:2,heartbeats:n})).length}function cUe(n){if(n.length===0)return-1;let t=0,s=n[0].date;for(let a=1;a<n.length;a++)n[a].date<s&&(s=n[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lUe(n){CE(new Eg("platform-logger",t=>new SMe(t),"PRIVATE")),CE(new Eg("heartbeat",t=>new sUe(t),"PRIVATE")),Kh(GU,EY,n),Kh(GU,EY,"esm2017"),Kh("fire-js","")}lUe("");function Sne(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const uUe=Sne,bne=new qR("auth","Firebase",Sne());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vk=new ij("@firebase/auth");function dUe(n,...t){vk.logLevel<=Tr.WARN&&vk.warn(`Auth (${xE}): ${n}`,...t)}function BO(n,...t){vk.logLevel<=Tr.ERROR&&vk.error(`Auth (${xE}): ${n}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Od(n,...t){throw aj(n,...t)}function qh(n,...t){return aj(n,...t)}function Tne(n,t,s){const a=Object.assign(Object.assign({},uUe()),{[t]:s});return new qR("auth","Firebase",a).create(t,{appName:n.name})}function Rf(n){return Tne(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function aj(n,...t){if(typeof n!="string"){const s=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(s,...a)}return bne.create(n,...t)}function Un(n,t,...s){if(!n)throw aj(t,...s)}function mf(n){const t="INTERNAL ASSERTION FAILED: "+n;throw BO(t),new Error(t)}function Df(n,t){n||mf(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KU(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function hUe(){return TY()==="http:"||TY()==="https:"}function TY(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pUe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(hUe()||z2e()||"connection"in navigator)?navigator.onLine:!0}function fUe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XR{constructor(t,s){this.shortDelay=t,this.longDelay=s,Df(s>t,"Short delay should be less than long delay!"),this.isMobile=j2e()||G2e()}get(){return pUe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cj(n,t){Df(n.emulator,"Emulator should always be set here");const{url:s}=n.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wne{static initialize(t,s,a){this.fetchImpl=t,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;mf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;mf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;mf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mUe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gUe=new XR(3e4,6e4);function Uf(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}async function Vf(n,t,s,a,l={}){return Rne(n,l,async()=>{let d={},f={};a&&(t==="GET"?f=a:d={body:JSON.stringify(a)});const E=YR(Object.assign({key:n.config.apiKey},f)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:t,headers:v},d);return W2e()||(b.referrerPolicy="no-referrer"),wne.fetch()(Cne(n,n.config.apiHost,s,E),b)})}async function Rne(n,t,s){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},mUe),t);try{const l=new EUe(n),d=await Promise.race([s(),l.promise]);l.clearNetworkTimeout();const f=await d.json();if("needConfirmation"in f)throw pO(n,"account-exists-with-different-credential",f);if(d.ok&&!("errorMessage"in f))return f;{const E=d.ok?f.errorMessage:f.error.message,[v,b]=E.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw pO(n,"credential-already-in-use",f);if(v==="EMAIL_EXISTS")throw pO(n,"email-already-in-use",f);if(v==="USER_DISABLED")throw pO(n,"user-disabled",f);const w=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw Tne(n,w,b);Od(n,w)}}catch(l){if(l instanceof ip)throw l;Od(n,"network-request-failed",{message:String(l)})}}async function JR(n,t,s,a,l={}){const d=await Vf(n,t,s,a,l);return"mfaPendingCredential"in d&&Od(n,"multi-factor-auth-required",{_serverResponse:d}),d}function Cne(n,t,s,a){const l=`${t}${s}?${a}`;return n.config.emulator?cj(n.config,l):`${n.config.apiScheme}://${l}`}function _Ue(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class EUe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(qh(this.auth,"network-request-failed")),gUe.get())})}}function pO(n,t,s){const a={appName:n.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const l=qh(n,t,a);return l.customData._tokenResponse=s,l}function wY(n){return n!==void 0&&n.enterprise!==void 0}class yUe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===t)return _Ue(s.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function vUe(n,t){return Vf(n,"GET","/v2/recaptchaConfig",Uf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SUe(n,t){return Vf(n,"POST","/v1/accounts:delete",t)}async function Ine(n,t){return Vf(n,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jw(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function bUe(n,t=!1){const s=rs(n),a=await s.getIdToken(t),l=lj(a);Un(l&&l.exp&&l.auth_time&&l.iat,s.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,f=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:Jw(AM(l.auth_time)),issuedAtTime:Jw(AM(l.iat)),expirationTime:Jw(AM(l.exp)),signInProvider:f||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function AM(n){return Number(n)*1e3}function lj(n){const[t,s,a]=n.split(".");if(t===void 0||s===void 0||a===void 0)return BO("JWT malformed, contained fewer than 3 sections"),null;try{const l=une(s);return l?JSON.parse(l):(BO("Failed to decode base64 JWT payload"),null)}catch(l){return BO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function RY(n){const t=lj(n);return Un(t,"internal-error"),Un(typeof t.exp<"u","internal-error"),Un(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wR(n,t,s=!1){if(s)return t;try{return await t}catch(a){throw a instanceof ip&&TUe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function TUe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wUe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qU{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=Jw(this.lastLoginAt),this.creationTime=Jw(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sk(n){var t;const s=n.auth,a=await n.getIdToken(),l=await wR(n,Ine(s,{idToken:a}));Un(l==null?void 0:l.users.length,s,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const f=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?Ane(d.providerUserInfo):[],E=CUe(n.providerData,f),v=n.isAnonymous,b=!(n.email&&d.passwordHash)&&!(E!=null&&E.length),w=v?b:!1,A={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:E,metadata:new qU(d.createdAt,d.lastLoginAt),isAnonymous:w};Object.assign(n,A)}async function RUe(n){const t=rs(n);await Sk(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function CUe(n,t){return[...n.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function Ane(n){return n.map(t=>{var{providerId:s}=t,a=WR(t,["providerId"]);return{providerId:s,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IUe(n,t){const s=await Rne(n,{},async()=>{const a=YR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,f=Cne(n,l,"/v1/token",`key=${d}`),E=await n._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",wne.fetch()(f,{method:"POST",headers:E,body:a})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function AUe(n,t){return Vf(n,"POST","/v2/accounts:revokeToken",Uf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Un(t.idToken,"internal-error"),Un(typeof t.idToken<"u","internal-error"),Un(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):RY(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){Un(t.length!==0,"internal-error");const s=RY(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Un(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:a,refreshToken:l,expiresIn:d}=await IUe(t,s);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,s,a){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,s){const{refreshToken:a,accessToken:l,expirationTime:d}=s,f=new KS;return a&&(Un(typeof a=="string","internal-error",{appName:t}),f.refreshToken=a),l&&(Un(typeof l=="string","internal-error",{appName:t}),f.accessToken=l),d&&(Un(typeof d=="number","internal-error",{appName:t}),f.expirationTime=d),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new KS,this.toJSON())}_performRefresh(){return mf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ym(n,t){Un(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class gf{constructor(t){var{uid:s,auth:a,stsTokenManager:l}=t,d=WR(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new wUe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new qU(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const s=await wR(this,this.stsTokenManager.getToken(this.auth,t));return Un(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return bUe(this,t)}reload(){return RUe(this)}_assign(t){this!==t&&(Un(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new gf(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){Un(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),s&&await Sk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(kl(this.auth.app))return Promise.reject(Rf(this.auth));const t=await this.getIdToken();return await wR(this,SUe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var a,l,d,f,E,v,b,w;const A=(a=s.displayName)!==null&&a!==void 0?a:void 0,N=(l=s.email)!==null&&l!==void 0?l:void 0,V=(d=s.phoneNumber)!==null&&d!==void 0?d:void 0,j=(f=s.photoURL)!==null&&f!==void 0?f:void 0,B=(E=s.tenantId)!==null&&E!==void 0?E:void 0,H=(v=s._redirectEventId)!==null&&v!==void 0?v:void 0,J=(b=s.createdAt)!==null&&b!==void 0?b:void 0,$=(w=s.lastLoginAt)!==null&&w!==void 0?w:void 0,{uid:te,emailVerified:ce,isAnonymous:oe,providerData:_e,stsTokenManager:ne}=s;Un(te&&ne,t,"internal-error");const ee=KS.fromJSON(this.name,ne);Un(typeof te=="string",t,"internal-error"),Ym(A,t.name),Ym(N,t.name),Un(typeof ce=="boolean",t,"internal-error"),Un(typeof oe=="boolean",t,"internal-error"),Ym(V,t.name),Ym(j,t.name),Ym(B,t.name),Ym(H,t.name),Ym(J,t.name),Ym($,t.name);const Q=new gf({uid:te,auth:t,email:N,emailVerified:ce,displayName:A,isAnonymous:oe,photoURL:j,phoneNumber:V,tenantId:B,stsTokenManager:ee,createdAt:J,lastLoginAt:$});return _e&&Array.isArray(_e)&&(Q.providerData=_e.map(se=>Object.assign({},se))),H&&(Q._redirectEventId=H),Q}static async _fromIdTokenResponse(t,s,a=!1){const l=new KS;l.updateFromServerResponse(s);const d=new gf({uid:s.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await Sk(d),d}static async _fromGetAccountInfoResponse(t,s,a){const l=s.users[0];Un(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?Ane(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),E=new KS;E.updateFromIdToken(a);const v=new gf({uid:l.localId,auth:t,stsTokenManager:E,isAnonymous:f}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new qU(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,b),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CY=new Map;function _f(n){Df(n instanceof Function,"Expected a class definition");let t=CY.get(n);return t?(Df(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,CY.set(n,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pne{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}Pne.type="NONE";const IY=Pne;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WO(n,t,s){return`firebase:${n}:${t}:${s}`}class qS{constructor(t,s,a){this.persistence=t,this.auth=s,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=WO(this.userKey,l.apiKey,d),this.fullPersistenceKey=WO("persistence",l.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?gf._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,a="authUser"){if(!s.length)return new qS(_f(IY),t,a);const l=(await Promise.all(s.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||_f(IY);const f=WO(a,t.config.apiKey,t.name);let E=null;for(const b of s)try{const w=await b._get(f);if(w){const A=gf._fromJSON(t,w);b!==d&&(E=A),d=b;break}}catch{}const v=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new qS(d,t,a):(d=v[0],E&&await d._set(f,E.toJSON()),await Promise.all(s.map(async b=>{if(b!==d)try{await b._remove(f)}catch{}})),new qS(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AY(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Dne(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(One(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(xne(t))return"Blackberry";if(Mne(t))return"Webos";if(kne(t))return"Safari";if((t.includes("chrome/")||Nne(t))&&!t.includes("edge/"))return"Chrome";if(Lne(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function One(n=$a()){return/firefox\//i.test(n)}function kne(n=$a()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Nne(n=$a()){return/crios\//i.test(n)}function Dne(n=$a()){return/iemobile/i.test(n)}function Lne(n=$a()){return/android/i.test(n)}function xne(n=$a()){return/blackberry/i.test(n)}function Mne(n=$a()){return/webos/i.test(n)}function uj(n=$a()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function PUe(n=$a()){var t;return uj(n)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function OUe(){return H2e()&&document.documentMode===10}function Une(n=$a()){return uj(n)||Lne(n)||Mne(n)||xne(n)||/windows phone/i.test(n)||Dne(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vne(n,t=[]){let s;switch(n){case"Browser":s=AY($a());break;case"Worker":s=`${AY($a())}-${n}`;break;default:s=n}const a=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${xE}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kUe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const a=d=>new Promise((f,E)=>{try{const v=t(d);f(v)}catch(v){E(v)}});a.onAbort=s,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const a of this.queue)await a(t),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const l of s)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NUe(n,t={}){return Vf(n,"GET","/v2/passwordPolicy",Uf(n,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DUe=6;class LUe{constructor(t){var s,a,l,d;const f=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=f.minPasswordLength)!==null&&s!==void 0?s:DUe,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,a,l,d,f,E;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,v),this.validatePasswordCharacterOptions(t,v),v.isValid&&(v.isValid=(s=v.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(f=v.containsNumericCharacter)!==null&&f!==void 0?f:!0),v.isValid&&(v.isValid=(E=v.containsNonAlphanumericCharacter)!==null&&E!==void 0?E:!0),v}validatePasswordLengthOptions(t,s){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=t.length>=a),l&&(s.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,s,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xUe{constructor(t,s,a,l){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new PY(this),this.idTokenSubscription=new PY(this),this.beforeStateQueue=new kUe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bne,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=_f(s)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await qS.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await Ine(this,{idToken:t}),a=await gf._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(kl(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(E=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(E,E))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,E=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(t);(!f||f===E)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Un(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await Sk(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=fUe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(kl(this.app))return Promise.reject(Rf(this));const s=t?rs(t):null;return s&&Un(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&Un(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return kl(this.app)?Promise.reject(Rf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return kl(this.app)?Promise.reject(Rf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(_f(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await NUe(this),s=new LUe(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new qR("auth","Firebase",t())}onAuthStateChanged(t,s,a){return this.registerStateListener(this.authStateSubscription,t,s,a)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,a){return this.registerStateListener(this.idTokenSubscription,t,s,a)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await AUe(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const a=await this.getOrInitRedirectPersistenceManager(s);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&_f(t)||this._popupRedirectResolver;Un(s,this,"argument-error"),this.redirectPersistenceManager=await qS.create(this,[_f(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,a,l){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s);let f=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(Un(E,this,"internal-error"),E.then(()=>{f||d(this.currentUser)}),typeof s=="function"){const v=t.addObserver(s,a,l);return()=>{f=!0,v()}}else{const v=t.addObserver(s);return()=>{f=!0,v()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Un(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Vne(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(s["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(s["X-Firebase-AppCheck"]=l),s}async _getAppCheckToken(){var t;if(kl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&dUe(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function Ag(n){return rs(n)}class PY{constructor(t){this.auth=t,this.observer=null,this.addObserver=Z2e(s=>this.observer=s)}get next(){return Un(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let v1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function MUe(n){v1=n}function Fne(n){return v1.loadJS(n)}function UUe(){return v1.recaptchaEnterpriseScript}function VUe(){return v1.gapiScript}function FUe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class jUe{constructor(){this.enterprise=new BUe}ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}class BUe{ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}const WUe="recaptcha-enterprise",jne="NO_RECAPTCHA";class zUe{constructor(t){this.type=WUe,this.auth=Ag(t)}async verify(t="verify",s=!1){async function a(d){if(!s){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(f,E)=>{vUe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const b=new yUe(v);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,f(b.siteKey)}}).catch(v=>{E(v)})})}function l(d,f,E){const v=window.grecaptcha;wY(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:t}).then(b=>{f(b)}).catch(()=>{f(jne)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new jUe().execute("siteKey",{action:"verify"}):new Promise((d,f)=>{a(this.auth).then(E=>{if(!s&&wY(window.grecaptcha))l(E,d,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let v=UUe();v.length!==0&&(v+=E),Fne(v).then(()=>{l(E,d,f)}).catch(b=>{f(b)})}}).catch(E=>{f(E)})})}}async function OY(n,t,s,a=!1,l=!1){const d=new zUe(n);let f;if(l)f=jne;else try{f=await d.verify(s)}catch{f=await d.verify(s,!0)}const E=Object.assign({},t);if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in E){const v=E.phoneEnrollmentInfo.phoneNumber,b=E.phoneEnrollmentInfo.recaptchaToken;Object.assign(E,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in E){const v=E.phoneSignInInfo.recaptchaToken;Object.assign(E,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return E}return a?Object.assign(E,{captchaResp:f}):Object.assign(E,{captchaResponse:f}),Object.assign(E,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(E,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E}async function bk(n,t,s,a,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await OY(n,t,s,s==="getOobCode");return a(n,f)}else return a(n,t).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const E=await OY(n,t,s,s==="getOobCode");return a(n,E)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GUe(n,t){const s=y1(n,"auth");if(s.isInitialized()){const l=s.getImmediate(),d=s.getOptions();if(kf(d,t??{}))return l;Od(l,"already-initialized")}return s.initialize({options:t})}function HUe(n,t){const s=(t==null?void 0:t.persistence)||[],a=(Array.isArray(s)?s:[s]).map(_f);t!=null&&t.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function $Ue(n,t,s){const a=Ag(n);Un(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=Bne(t),{host:f,port:E}=KUe(t),v=E===null?"":`:${E}`,b={url:`${d}//${f}${v}/`},w=Object.freeze({host:f,port:E,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Un(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Un(kf(b,a.config.emulator)&&kf(w,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=w,a.settings.appVerificationDisabledForTesting=!0,qUe()}function Bne(n){const t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function KUe(n){const t=Bne(n),s=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:kY(a.substr(d.length+1))}}else{const[d,f]=a.split(":");return{host:d,port:kY(f)}}}function kY(n){if(!n)return null;const t=Number(n);return isNaN(t)?null:t}function qUe(){function n(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dj{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return mf("not implemented")}_getIdTokenResponse(t){return mf("not implemented")}_linkToIdToken(t,s){return mf("not implemented")}_getReauthenticationResolver(t){return mf("not implemented")}}async function YUe(n,t){return Vf(n,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XUe(n,t){return JR(n,"POST","/v1/accounts:signInWithPassword",Uf(n,t))}async function Wne(n,t){return Vf(n,"POST","/v1/accounts:sendOobCode",Uf(n,t))}async function JUe(n,t){return Wne(n,t)}async function QUe(n,t){return Wne(n,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZUe(n,t){return JR(n,"POST","/v1/accounts:signInWithEmailLink",Uf(n,t))}async function eVe(n,t){return JR(n,"POST","/v1/accounts:signInWithEmailLink",Uf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR extends dj{constructor(t,s,a,l=null){super("password",a),this._email=t,this._password=s,this._tenantId=l}static _fromEmailAndPassword(t,s){return new RR(t,s,"password")}static _fromEmailAndCode(t,s,a=null){return new RR(t,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bk(t,s,"signInWithPassword",XUe);case"emailLink":return ZUe(t,{email:this._email,oobCode:this._password});default:Od(t,"internal-error")}}async _linkToIdToken(t,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bk(t,a,"signUpPassword",YUe);case"emailLink":return eVe(t,{idToken:s,email:this._email,oobCode:this._password});default:Od(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YS(n,t){return JR(n,"POST","/v1/accounts:signInWithIdp",Uf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tVe="http://localhost";class IE extends dj{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new IE(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):Od("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=s,d=WR(s,["providerId","signInMethod"]);if(!a||!l)return null;const f=new IE(a,l);return f.idToken=d.idToken||void 0,f.accessToken=d.accessToken||void 0,f.secret=d.secret,f.nonce=d.nonce,f.pendingToken=d.pendingToken||null,f}_getIdTokenResponse(t){const s=this.buildRequest();return YS(t,s)}_linkToIdToken(t,s){const a=this.buildRequest();return a.idToken=s,YS(t,a)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,YS(t,s)}buildRequest(){const t={requestUri:tVe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=YR(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nVe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function rVe(n){const t=kw(Nw(n)).link,s=t?kw(Nw(t)).deep_link_id:null,a=kw(Nw(n)).deep_link_id;return(a?kw(Nw(a)).link:null)||a||s||t||n}class hj{constructor(t){var s,a,l,d,f,E;const v=kw(Nw(t)),b=(s=v.apiKey)!==null&&s!==void 0?s:null,w=(a=v.oobCode)!==null&&a!==void 0?a:null,A=nVe((l=v.mode)!==null&&l!==void 0?l:null);Un(b&&w&&A,"argument-error"),this.apiKey=b,this.operation=A,this.code=w,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(f=v.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(E=v.tenantId)!==null&&E!==void 0?E:null}static parseLink(t){const s=rVe(t);try{return new hj(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(){this.providerId=k0.PROVIDER_ID}static credential(t,s){return RR._fromEmailAndPassword(t,s)}static credentialWithLink(t,s){const a=hj.parseLink(s);return Un(a,"argument-error"),RR._fromEmailAndCode(t,a.code,a.tenantId)}}k0.PROVIDER_ID="password";k0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";k0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zne{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QR extends zne{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eg extends QR{constructor(){super("facebook.com")}static credential(t){return IE._fromParams({providerId:eg.PROVIDER_ID,signInMethod:eg.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return eg.credentialFromTaggedObject(t)}static credentialFromError(t){return eg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return eg.credential(t.oauthAccessToken)}catch{return null}}}eg.FACEBOOK_SIGN_IN_METHOD="facebook.com";eg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg extends QR{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return IE._fromParams({providerId:tg.PROVIDER_ID,signInMethod:tg.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return tg.credentialFromTaggedObject(t)}static credentialFromError(t){return tg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:a}=t;if(!s&&!a)return null;try{return tg.credential(s,a)}catch{return null}}}tg.GOOGLE_SIGN_IN_METHOD="google.com";tg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng extends QR{constructor(){super("github.com")}static credential(t){return IE._fromParams({providerId:ng.PROVIDER_ID,signInMethod:ng.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ng.credentialFromTaggedObject(t)}static credentialFromError(t){return ng.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return ng.credential(t.oauthAccessToken)}catch{return null}}}ng.GITHUB_SIGN_IN_METHOD="github.com";ng.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rg extends QR{constructor(){super("twitter.com")}static credential(t,s){return IE._fromParams({providerId:rg.PROVIDER_ID,signInMethod:rg.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return rg.credentialFromTaggedObject(t)}static credentialFromError(t){return rg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=t;if(!s||!a)return null;try{return rg.credential(s,a)}catch{return null}}}rg.TWITTER_SIGN_IN_METHOD="twitter.com";rg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iVe(n,t){return JR(n,"POST","/v1/accounts:signUp",Uf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,a,l=!1){const d=await gf._fromIdTokenResponse(t,a,l),f=NY(a);return new AE({user:d,providerId:f,_tokenResponse:a,operationType:s})}static async _forOperation(t,s,a){await t._updateTokensIfNecessary(a,!0);const l=NY(a);return new AE({user:t,providerId:l,_tokenResponse:a,operationType:s})}}function NY(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk extends ip{constructor(t,s,a,l){var d;super(s.code,s.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,Tk.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,s,a,l){return new Tk(t,s,a,l)}}function Gne(n,t,s,a){return(t==="reauthenticate"?s._getReauthenticationResolver(n):s._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?Tk._fromErrorAndOperation(n,d,t,a):d})}async function sVe(n,t,s=!1){const a=await wR(n,t._linkToIdToken(n.auth,await n.getIdToken()),s);return AE._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oVe(n,t,s=!1){const{auth:a}=n;if(kl(a.app))return Promise.reject(Rf(a));const l="reauthenticate";try{const d=await wR(n,Gne(a,l,t,n),s);Un(d.idToken,a,"internal-error");const f=lj(d.idToken);Un(f,a,"internal-error");const{sub:E}=f;return Un(n.uid===E,a,"user-mismatch"),AE._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Od(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hne(n,t,s=!1){if(kl(n.app))return Promise.reject(Rf(n));const a="signIn",l=await Gne(n,a,t),d=await AE._fromIdTokenResponse(n,a,l);return s||await n._updateCurrentUser(d.user),d}async function aVe(n,t){return Hne(Ag(n),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $ne(n){const t=Ag(n);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function cVe(n,t,s){const a=Ag(n);await bk(a,{requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"},"getOobCode",QUe)}async function lVe(n,t,s){if(kl(n.app))return Promise.reject(Rf(n));const a=Ag(n),f=await bk(a,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",iVe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&$ne(n),v}),E=await AE._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(E.user),E}function uVe(n,t,s){return kl(n.app)?Promise.reject(Rf(n)):aVe(rs(n),k0.credential(t,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&$ne(n),a})}async function YU(n,t){const s=rs(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await JUe(s.auth,l);d!==n.email&&await n.reload()}function dVe(n,t,s,a){return rs(n).onIdTokenChanged(t,s,a)}function hVe(n,t,s){return rs(n).beforeAuthStateChanged(t,s)}function pVe(n,t,s,a){return rs(n).onAuthStateChanged(t,s,a)}function fVe(n){return rs(n).signOut()}const wk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kne{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(wk,"1"),this.storage.removeItem(wk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mVe=1e3,gVe=10;class qne extends Kne{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Une(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),l=this.localCache[s];a!==l&&t(s,l,a)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((f,E,v)=>{this.notifyListeners(f,v)});return}const a=t.key;s?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!s&&this.localCache[a]===f||this.notifyListeners(a,f)},d=this.storage.getItem(a);OUe()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,gVe):l()}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:a}),!0)})},mVe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}qne.type="LOCAL";const _Ve=qne;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yne extends Kne{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}Yne.type="SESSION";const Xne=Yne;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EVe(n){return Promise.all(n.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S1{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(l=>l.isListeningto(t));if(s)return s;const a=new S1(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:a,eventType:l,data:d}=s.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const E=Array.from(f).map(async b=>b(s.origin,d)),v=await EVe(E);s.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}S1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pj(n="",t=10){let s="";for(let a=0;a<t;a++)s+=Math.floor(Math.random()*10);return n+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yVe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,f;return new Promise((E,v)=>{const b=pj("",20);l.port1.start();const w=setTimeout(()=>{v(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(A){const N=A;if(N.data.eventId===b)switch(N.data.status){case"ack":clearTimeout(w),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),E(N.data.response);break;default:clearTimeout(w),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:t,eventId:b,data:s},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yh(){return window}function vVe(n){Yh().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jne(){return typeof Yh().WorkerGlobalScope<"u"&&typeof Yh().importScripts=="function"}async function SVe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function bVe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function TVe(){return Jne()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qne="firebaseLocalStorageDb",wVe=1,Rk="firebaseLocalStorage",Zne="fbase_key";class ZR{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function b1(n,t){return n.transaction([Rk],t?"readwrite":"readonly").objectStore(Rk)}function RVe(){const n=indexedDB.deleteDatabase(Qne);return new ZR(n).toPromise()}function XU(){const n=indexedDB.open(Qne,wVe);return new Promise((t,s)=>{n.addEventListener("error",()=>{s(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(Rk,{keyPath:Zne})}catch(l){s(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(Rk)?t(a):(a.close(),await RVe(),t(await XU()))})})}async function DY(n,t,s){const a=b1(n,!0).put({[Zne]:t,value:s});return new ZR(a).toPromise()}async function CVe(n,t){const s=b1(n,!1).get(t),a=await new ZR(s).toPromise();return a===void 0?null:a.value}function LY(n,t){const s=b1(n,!0).delete(t);return new ZR(s).toPromise()}const IVe=800,AVe=3;class ere{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await XU(),this.db)}async _withRetries(t){let s=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(s++>AVe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Jne()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=S1._getInstance(TVe()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await SVe(),!this.activeServiceWorker)return;this.sender=new yVe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((s=a[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||bVe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await XU();return await DY(t,wk,"1"),await LY(t,wk),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>DY(a,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(a=>CVe(a,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>LY(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=b1(l,!1).getAll();return new ZR(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),s.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),s.push(l));return s}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),IVe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ere.type="LOCAL";const PVe=ere;new XR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OVe(n,t){return t?_f(t):(Un(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fj extends dj{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return YS(t,this._buildIdpRequest())}_linkToIdToken(t,s){return YS(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return YS(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function kVe(n){return Hne(n.auth,new fj(n),n.bypassAuthState)}function NVe(n){const{auth:t,user:s}=n;return Un(s,t,"internal-error"),oVe(s,new fj(n),n.bypassAuthState)}async function DVe(n){const{auth:t,user:s}=n;return Un(s,t,"internal-error"),sVe(s,new fj(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tre{constructor(t,s,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:a,postBody:l,tenantId:d,error:f,type:E}=t;if(f){this.reject(f);return}const v={auth:this.auth,requestUri:s,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(v))}catch(b){this.reject(b)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return kVe;case"linkViaPopup":case"linkViaRedirect":return DVe;case"reauthViaPopup":case"reauthViaRedirect":return NVe;default:Od(this.auth,"internal-error")}}resolve(t){Df(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Df(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LVe=new XR(2e3,1e4);class OS extends tre{constructor(t,s,a,l,d){super(t,s,l,d),this.provider=a,this.authWindow=null,this.pollId=null,OS.currentPopupAction&&OS.currentPopupAction.cancel(),OS.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Un(t,this.auth,"internal-error"),t}async onExecution(){Df(this.filter.length===1,"Popup operations only handle one event");const t=pj();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(qh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(qh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,OS.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,a;if(!((a=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(qh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,LVe.get())};t()}}OS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xVe="pendingRedirect",zO=new Map;class MVe extends tre{constructor(t,s,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let t=zO.get(this.auth._key());if(!t){try{const a=await UVe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(s){t=()=>Promise.reject(s)}zO.set(this.auth._key(),t)}return this.bypassAuthState||zO.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function UVe(n,t){const s=jVe(t),a=FVe(n);if(!await a._isAvailable())return!1;const l=await a._get(s)==="true";return await a._remove(s),l}function VVe(n,t){zO.set(n._key(),t)}function FVe(n){return _f(n._redirectPersistence)}function jVe(n){return WO(xVe,n.config.apiKey,n.name)}async function BVe(n,t,s=!1){if(kl(n.app))return Promise.reject(Rf(n));const a=Ag(n),l=OVe(a,t),f=await new MVe(a,l,s).execute();return f&&!s&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,t)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WVe=10*60*1e3;class zVe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(s=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!GVe(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var a;if(t.error&&!nre(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";s.onError(qh(this.auth,l))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const a=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=WVe&&this.cachedEventUids.clear(),this.cachedEventUids.has(xY(t))}saveEventToCache(t){this.cachedEventUids.add(xY(t)),this.lastProcessedEventTime=Date.now()}}function xY(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function nre({type:n,error:t}){return n==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function GVe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nre(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HVe(n,t={}){return Vf(n,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Ve=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,KVe=/^https?/;async function qVe(n){if(n.config.emulator)return;const{authorizedDomains:t}=await HVe(n);for(const s of t)try{if(YVe(s))return}catch{}Od(n,"unauthorized-domain")}function YVe(n){const t=KU(),{protocol:s,hostname:a}=new URL(t);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&a===""?s==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&f.hostname===a}if(!KVe.test(s))return!1;if($Ve.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XVe=new XR(3e4,6e4);function MY(){const n=Yh().___jsl;if(n!=null&&n.H){for(const t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let s=0;s<n.CP.length;s++)n.CP[s]=null}}function JVe(n){return new Promise((t,s)=>{var a,l,d;function f(){MY(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{MY(),s(qh(n,"network-request-failed"))},timeout:XVe.get()})}if(!((l=(a=Yh().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=Yh().gapi)===null||d===void 0)&&d.load)f();else{const E=FUe("iframefcb");return Yh()[E]=()=>{gapi.load?f():s(qh(n,"network-request-failed"))},Fne(`${VUe()}?onload=${E}`).catch(v=>s(v))}}).catch(t=>{throw GO=null,t})}let GO=null;function QVe(n){return GO=GO||JVe(n),GO}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZVe=new XR(5e3,15e3),eFe="__/auth/iframe",tFe="emulator/auth/iframe",nFe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},rFe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function iFe(n){const t=n.config;Un(t.authDomain,n,"auth-domain-config-required");const s=t.emulator?cj(t,tFe):`https://${n.config.authDomain}/${eFe}`,a={apiKey:t.apiKey,appName:n.name,v:xE},l=rFe.get(n.config.apiHost);l&&(a.eid=l);const d=n._getFrameworks();return d.length&&(a.fw=d.join(",")),`${s}?${YR(a).slice(1)}`}async function sFe(n){const t=await QVe(n),s=Yh().gapi;return Un(s,n,"internal-error"),t.open({where:document.body,url:iFe(n),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:nFe,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const f=qh(n,"network-request-failed"),E=Yh().setTimeout(()=>{d(f)},ZVe.get());function v(){Yh().clearTimeout(E),l(a)}a.ping(v).then(v,()=>{d(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oFe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},aFe=500,cFe=600,lFe="_blank",uFe="http://localhost";class UY{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function dFe(n,t,s,a=aFe,l=cFe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let E="";const v=Object.assign(Object.assign({},oFe),{width:a.toString(),height:l.toString(),top:d,left:f}),b=$a().toLowerCase();s&&(E=Nne(b)?lFe:s),One(b)&&(t=t||uFe,v.scrollbars="yes");const w=Object.entries(v).reduce((N,[V,j])=>`${N}${V}=${j},`,"");if(PUe(b)&&E!=="_self")return hFe(t||"",E),new UY(null);const A=window.open(t||"",E,w);Un(A,n,"popup-blocked");try{A.focus()}catch{}return new UY(A)}function hFe(n,t){const s=document.createElement("a");s.href=n,s.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pFe="__/auth/handler",fFe="emulator/auth/handler",mFe=encodeURIComponent("fac");async function VY(n,t,s,a,l,d){Un(n.config.authDomain,n,"auth-domain-config-required"),Un(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:s,redirectUrl:a,v:xE,eventId:l};if(t instanceof zne){t.setDefaultLanguage(n.languageCode),f.providerId=t.providerId||"",Q2e(t.getCustomParameters())||(f.customParameters=JSON.stringify(t.getCustomParameters()));for(const[w,A]of Object.entries({}))f[w]=A}if(t instanceof QR){const w=t.getScopes().filter(A=>A!=="");w.length>0&&(f.scopes=w.join(","))}n.tenantId&&(f.tid=n.tenantId);const E=f;for(const w of Object.keys(E))E[w]===void 0&&delete E[w];const v=await n._getAppCheckToken(),b=v?`#${mFe}=${encodeURIComponent(v)}`:"";return`${gFe(n)}?${YR(E).slice(1)}${b}`}function gFe({config:n}){return n.emulator?cj(n,fFe):`https://${n.authDomain}/${pFe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PM="webStorageSupport";class _Fe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Xne,this._completeRedirectFn=BVe,this._overrideRedirectResult=VVe}async _openPopup(t,s,a,l){var d;Df((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const f=await VY(t,s,a,KU(),l);return dFe(t,f,pj())}async _openRedirect(t,s,a,l){await this._originValidation(t);const d=await VY(t,s,a,KU(),l);return vVe(d),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:l,promise:d}=this.eventManagers[s];return l?Promise.resolve(l):(Df(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(t){const s=await sFe(t),a=new zVe(t);return s.register("authEvent",l=>(Un(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=s,a}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(PM,{type:PM},l=>{var d;const f=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[PM];f!==void 0&&s(!!f),Od(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=qVe(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return Une()||kne()||uj()}}const EFe=_Fe;var FY="@firebase/auth",jY="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yFe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Un(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vFe(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function SFe(n){CE(new Eg("auth",(t,{options:s})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:f,authDomain:E}=a.options;Un(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:f,authDomain:E,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Vne(n)},b=new xUe(a,l,d,v);return HUe(b,s),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,a)=>{t.getProvider("auth-internal").initialize()})),CE(new Eg("auth-internal",t=>{const s=Ag(t.getProvider("auth").getImmediate());return(a=>new yFe(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),Kh(FY,jY,vFe(n)),Kh(FY,jY,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bFe=5*60,TFe=fne("authIdTokenMaxAge")||bFe;let BY=null;const wFe=n=>async t=>{const s=t&&await t.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>TFe)return;const l=s==null?void 0:s.token;BY!==l&&(BY=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function rre(n=oj()){const t=y1(n,"auth");if(t.isInitialized())return t.getImmediate();const s=GUe(n,{popupRedirectResolver:EFe,persistence:[PVe,_Ve,Xne]}),a=fne("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const f=wFe(d.toString());hVe(s,f,()=>f(s.currentUser)),dVe(s,E=>f(E))}}const l=dne("auth");return l&&$Ue(s,`http://${l}`),s}function RFe(){var n,t;return(t=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&t!==void 0?t:document}MUe({loadJS(n){return new Promise((t,s)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=t,a.onerror=l=>{const d=qh("internal-error");d.customData=l,s(d)},a.type="text/javascript",a.charset="UTF-8",RFe().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});SFe("Browser");var WY=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ug,ire;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(ne,ee){function Q(){}Q.prototype=ee.prototype,ne.D=ee.prototype,ne.prototype=new Q,ne.prototype.constructor=ne,ne.C=function(se,pe,fe){for(var ue=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)ue[Me-2]=arguments[Me];return ee.prototype[pe].apply(se,ue)}}function s(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,s),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(ne,ee,Q){Q||(Q=0);var se=Array(16);if(typeof ee=="string")for(var pe=0;16>pe;++pe)se[pe]=ee.charCodeAt(Q++)|ee.charCodeAt(Q++)<<8|ee.charCodeAt(Q++)<<16|ee.charCodeAt(Q++)<<24;else for(pe=0;16>pe;++pe)se[pe]=ee[Q++]|ee[Q++]<<8|ee[Q++]<<16|ee[Q++]<<24;ee=ne.g[0],Q=ne.g[1],pe=ne.g[2];var fe=ne.g[3],ue=ee+(fe^Q&(pe^fe))+se[0]+3614090360&4294967295;ee=Q+(ue<<7&4294967295|ue>>>25),ue=fe+(pe^ee&(Q^pe))+se[1]+3905402710&4294967295,fe=ee+(ue<<12&4294967295|ue>>>20),ue=pe+(Q^fe&(ee^Q))+se[2]+606105819&4294967295,pe=fe+(ue<<17&4294967295|ue>>>15),ue=Q+(ee^pe&(fe^ee))+se[3]+3250441966&4294967295,Q=pe+(ue<<22&4294967295|ue>>>10),ue=ee+(fe^Q&(pe^fe))+se[4]+4118548399&4294967295,ee=Q+(ue<<7&4294967295|ue>>>25),ue=fe+(pe^ee&(Q^pe))+se[5]+1200080426&4294967295,fe=ee+(ue<<12&4294967295|ue>>>20),ue=pe+(Q^fe&(ee^Q))+se[6]+2821735955&4294967295,pe=fe+(ue<<17&4294967295|ue>>>15),ue=Q+(ee^pe&(fe^ee))+se[7]+4249261313&4294967295,Q=pe+(ue<<22&4294967295|ue>>>10),ue=ee+(fe^Q&(pe^fe))+se[8]+1770035416&4294967295,ee=Q+(ue<<7&4294967295|ue>>>25),ue=fe+(pe^ee&(Q^pe))+se[9]+2336552879&4294967295,fe=ee+(ue<<12&4294967295|ue>>>20),ue=pe+(Q^fe&(ee^Q))+se[10]+4294925233&4294967295,pe=fe+(ue<<17&4294967295|ue>>>15),ue=Q+(ee^pe&(fe^ee))+se[11]+2304563134&4294967295,Q=pe+(ue<<22&4294967295|ue>>>10),ue=ee+(fe^Q&(pe^fe))+se[12]+1804603682&4294967295,ee=Q+(ue<<7&4294967295|ue>>>25),ue=fe+(pe^ee&(Q^pe))+se[13]+4254626195&4294967295,fe=ee+(ue<<12&4294967295|ue>>>20),ue=pe+(Q^fe&(ee^Q))+se[14]+2792965006&4294967295,pe=fe+(ue<<17&4294967295|ue>>>15),ue=Q+(ee^pe&(fe^ee))+se[15]+1236535329&4294967295,Q=pe+(ue<<22&4294967295|ue>>>10),ue=ee+(pe^fe&(Q^pe))+se[1]+4129170786&4294967295,ee=Q+(ue<<5&4294967295|ue>>>27),ue=fe+(Q^pe&(ee^Q))+se[6]+3225465664&4294967295,fe=ee+(ue<<9&4294967295|ue>>>23),ue=pe+(ee^Q&(fe^ee))+se[11]+643717713&4294967295,pe=fe+(ue<<14&4294967295|ue>>>18),ue=Q+(fe^ee&(pe^fe))+se[0]+3921069994&4294967295,Q=pe+(ue<<20&4294967295|ue>>>12),ue=ee+(pe^fe&(Q^pe))+se[5]+3593408605&4294967295,ee=Q+(ue<<5&4294967295|ue>>>27),ue=fe+(Q^pe&(ee^Q))+se[10]+38016083&4294967295,fe=ee+(ue<<9&4294967295|ue>>>23),ue=pe+(ee^Q&(fe^ee))+se[15]+3634488961&4294967295,pe=fe+(ue<<14&4294967295|ue>>>18),ue=Q+(fe^ee&(pe^fe))+se[4]+3889429448&4294967295,Q=pe+(ue<<20&4294967295|ue>>>12),ue=ee+(pe^fe&(Q^pe))+se[9]+568446438&4294967295,ee=Q+(ue<<5&4294967295|ue>>>27),ue=fe+(Q^pe&(ee^Q))+se[14]+3275163606&4294967295,fe=ee+(ue<<9&4294967295|ue>>>23),ue=pe+(ee^Q&(fe^ee))+se[3]+4107603335&4294967295,pe=fe+(ue<<14&4294967295|ue>>>18),ue=Q+(fe^ee&(pe^fe))+se[8]+1163531501&4294967295,Q=pe+(ue<<20&4294967295|ue>>>12),ue=ee+(pe^fe&(Q^pe))+se[13]+2850285829&4294967295,ee=Q+(ue<<5&4294967295|ue>>>27),ue=fe+(Q^pe&(ee^Q))+se[2]+4243563512&4294967295,fe=ee+(ue<<9&4294967295|ue>>>23),ue=pe+(ee^Q&(fe^ee))+se[7]+1735328473&4294967295,pe=fe+(ue<<14&4294967295|ue>>>18),ue=Q+(fe^ee&(pe^fe))+se[12]+2368359562&4294967295,Q=pe+(ue<<20&4294967295|ue>>>12),ue=ee+(Q^pe^fe)+se[5]+4294588738&4294967295,ee=Q+(ue<<4&4294967295|ue>>>28),ue=fe+(ee^Q^pe)+se[8]+2272392833&4294967295,fe=ee+(ue<<11&4294967295|ue>>>21),ue=pe+(fe^ee^Q)+se[11]+1839030562&4294967295,pe=fe+(ue<<16&4294967295|ue>>>16),ue=Q+(pe^fe^ee)+se[14]+4259657740&4294967295,Q=pe+(ue<<23&4294967295|ue>>>9),ue=ee+(Q^pe^fe)+se[1]+2763975236&4294967295,ee=Q+(ue<<4&4294967295|ue>>>28),ue=fe+(ee^Q^pe)+se[4]+1272893353&4294967295,fe=ee+(ue<<11&4294967295|ue>>>21),ue=pe+(fe^ee^Q)+se[7]+4139469664&4294967295,pe=fe+(ue<<16&4294967295|ue>>>16),ue=Q+(pe^fe^ee)+se[10]+3200236656&4294967295,Q=pe+(ue<<23&4294967295|ue>>>9),ue=ee+(Q^pe^fe)+se[13]+681279174&4294967295,ee=Q+(ue<<4&4294967295|ue>>>28),ue=fe+(ee^Q^pe)+se[0]+3936430074&4294967295,fe=ee+(ue<<11&4294967295|ue>>>21),ue=pe+(fe^ee^Q)+se[3]+3572445317&4294967295,pe=fe+(ue<<16&4294967295|ue>>>16),ue=Q+(pe^fe^ee)+se[6]+76029189&4294967295,Q=pe+(ue<<23&4294967295|ue>>>9),ue=ee+(Q^pe^fe)+se[9]+3654602809&4294967295,ee=Q+(ue<<4&4294967295|ue>>>28),ue=fe+(ee^Q^pe)+se[12]+3873151461&4294967295,fe=ee+(ue<<11&4294967295|ue>>>21),ue=pe+(fe^ee^Q)+se[15]+530742520&4294967295,pe=fe+(ue<<16&4294967295|ue>>>16),ue=Q+(pe^fe^ee)+se[2]+3299628645&4294967295,Q=pe+(ue<<23&4294967295|ue>>>9),ue=ee+(pe^(Q|~fe))+se[0]+4096336452&4294967295,ee=Q+(ue<<6&4294967295|ue>>>26),ue=fe+(Q^(ee|~pe))+se[7]+1126891415&4294967295,fe=ee+(ue<<10&4294967295|ue>>>22),ue=pe+(ee^(fe|~Q))+se[14]+2878612391&4294967295,pe=fe+(ue<<15&4294967295|ue>>>17),ue=Q+(fe^(pe|~ee))+se[5]+4237533241&4294967295,Q=pe+(ue<<21&4294967295|ue>>>11),ue=ee+(pe^(Q|~fe))+se[12]+1700485571&4294967295,ee=Q+(ue<<6&4294967295|ue>>>26),ue=fe+(Q^(ee|~pe))+se[3]+2399980690&4294967295,fe=ee+(ue<<10&4294967295|ue>>>22),ue=pe+(ee^(fe|~Q))+se[10]+4293915773&4294967295,pe=fe+(ue<<15&4294967295|ue>>>17),ue=Q+(fe^(pe|~ee))+se[1]+2240044497&4294967295,Q=pe+(ue<<21&4294967295|ue>>>11),ue=ee+(pe^(Q|~fe))+se[8]+1873313359&4294967295,ee=Q+(ue<<6&4294967295|ue>>>26),ue=fe+(Q^(ee|~pe))+se[15]+4264355552&4294967295,fe=ee+(ue<<10&4294967295|ue>>>22),ue=pe+(ee^(fe|~Q))+se[6]+2734768916&4294967295,pe=fe+(ue<<15&4294967295|ue>>>17),ue=Q+(fe^(pe|~ee))+se[13]+1309151649&4294967295,Q=pe+(ue<<21&4294967295|ue>>>11),ue=ee+(pe^(Q|~fe))+se[4]+4149444226&4294967295,ee=Q+(ue<<6&4294967295|ue>>>26),ue=fe+(Q^(ee|~pe))+se[11]+3174756917&4294967295,fe=ee+(ue<<10&4294967295|ue>>>22),ue=pe+(ee^(fe|~Q))+se[2]+718787259&4294967295,pe=fe+(ue<<15&4294967295|ue>>>17),ue=Q+(fe^(pe|~ee))+se[9]+3951481745&4294967295,ne.g[0]=ne.g[0]+ee&4294967295,ne.g[1]=ne.g[1]+(pe+(ue<<21&4294967295|ue>>>11))&4294967295,ne.g[2]=ne.g[2]+pe&4294967295,ne.g[3]=ne.g[3]+fe&4294967295}a.prototype.u=function(ne,ee){ee===void 0&&(ee=ne.length);for(var Q=ee-this.blockSize,se=this.B,pe=this.h,fe=0;fe<ee;){if(pe==0)for(;fe<=Q;)l(this,ne,fe),fe+=this.blockSize;if(typeof ne=="string"){for(;fe<ee;)if(se[pe++]=ne.charCodeAt(fe++),pe==this.blockSize){l(this,se),pe=0;break}}else for(;fe<ee;)if(se[pe++]=ne[fe++],pe==this.blockSize){l(this,se),pe=0;break}}this.h=pe,this.o+=ee},a.prototype.v=function(){var ne=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);ne[0]=128;for(var ee=1;ee<ne.length-8;++ee)ne[ee]=0;var Q=8*this.o;for(ee=ne.length-8;ee<ne.length;++ee)ne[ee]=Q&255,Q/=256;for(this.u(ne),ne=Array(16),ee=Q=0;4>ee;++ee)for(var se=0;32>se;se+=8)ne[Q++]=this.g[ee]>>>se&255;return ne};function d(ne,ee){var Q=E;return Object.prototype.hasOwnProperty.call(Q,ne)?Q[ne]:Q[ne]=ee(ne)}function f(ne,ee){this.h=ee;for(var Q=[],se=!0,pe=ne.length-1;0<=pe;pe--){var fe=ne[pe]|0;se&&fe==ee||(Q[pe]=fe,se=!1)}this.g=Q}var E={};function v(ne){return-128<=ne&&128>ne?d(ne,function(ee){return new f([ee|0],0>ee?-1:0)}):new f([ne|0],0>ne?-1:0)}function b(ne){if(isNaN(ne)||!isFinite(ne))return A;if(0>ne)return H(b(-ne));for(var ee=[],Q=1,se=0;ne>=Q;se++)ee[se]=ne/Q|0,Q*=4294967296;return new f(ee,0)}function w(ne,ee){if(ne.length==0)throw Error("number format error: empty string");if(ee=ee||10,2>ee||36<ee)throw Error("radix out of range: "+ee);if(ne.charAt(0)=="-")return H(w(ne.substring(1),ee));if(0<=ne.indexOf("-"))throw Error('number format error: interior "-" character');for(var Q=b(Math.pow(ee,8)),se=A,pe=0;pe<ne.length;pe+=8){var fe=Math.min(8,ne.length-pe),ue=parseInt(ne.substring(pe,pe+fe),ee);8>fe?(fe=b(Math.pow(ee,fe)),se=se.j(fe).add(b(ue))):(se=se.j(Q),se=se.add(b(ue)))}return se}var A=v(0),N=v(1),V=v(16777216);n=f.prototype,n.m=function(){if(B(this))return-H(this).m();for(var ne=0,ee=1,Q=0;Q<this.g.length;Q++){var se=this.i(Q);ne+=(0<=se?se:4294967296+se)*ee,ee*=4294967296}return ne},n.toString=function(ne){if(ne=ne||10,2>ne||36<ne)throw Error("radix out of range: "+ne);if(j(this))return"0";if(B(this))return"-"+H(this).toString(ne);for(var ee=b(Math.pow(ne,6)),Q=this,se="";;){var pe=ce(Q,ee).g;Q=J(Q,pe.j(ee));var fe=((0<Q.g.length?Q.g[0]:Q.h)>>>0).toString(ne);if(Q=pe,j(Q))return fe+se;for(;6>fe.length;)fe="0"+fe;se=fe+se}},n.i=function(ne){return 0>ne?0:ne<this.g.length?this.g[ne]:this.h};function j(ne){if(ne.h!=0)return!1;for(var ee=0;ee<ne.g.length;ee++)if(ne.g[ee]!=0)return!1;return!0}function B(ne){return ne.h==-1}n.l=function(ne){return ne=J(this,ne),B(ne)?-1:j(ne)?0:1};function H(ne){for(var ee=ne.g.length,Q=[],se=0;se<ee;se++)Q[se]=~ne.g[se];return new f(Q,~ne.h).add(N)}n.abs=function(){return B(this)?H(this):this},n.add=function(ne){for(var ee=Math.max(this.g.length,ne.g.length),Q=[],se=0,pe=0;pe<=ee;pe++){var fe=se+(this.i(pe)&65535)+(ne.i(pe)&65535),ue=(fe>>>16)+(this.i(pe)>>>16)+(ne.i(pe)>>>16);se=ue>>>16,fe&=65535,ue&=65535,Q[pe]=ue<<16|fe}return new f(Q,Q[Q.length-1]&-2147483648?-1:0)};function J(ne,ee){return ne.add(H(ee))}n.j=function(ne){if(j(this)||j(ne))return A;if(B(this))return B(ne)?H(this).j(H(ne)):H(H(this).j(ne));if(B(ne))return H(this.j(H(ne)));if(0>this.l(V)&&0>ne.l(V))return b(this.m()*ne.m());for(var ee=this.g.length+ne.g.length,Q=[],se=0;se<2*ee;se++)Q[se]=0;for(se=0;se<this.g.length;se++)for(var pe=0;pe<ne.g.length;pe++){var fe=this.i(se)>>>16,ue=this.i(se)&65535,Me=ne.i(pe)>>>16,He=ne.i(pe)&65535;Q[2*se+2*pe]+=ue*He,$(Q,2*se+2*pe),Q[2*se+2*pe+1]+=fe*He,$(Q,2*se+2*pe+1),Q[2*se+2*pe+1]+=ue*Me,$(Q,2*se+2*pe+1),Q[2*se+2*pe+2]+=fe*Me,$(Q,2*se+2*pe+2)}for(se=0;se<ee;se++)Q[se]=Q[2*se+1]<<16|Q[2*se];for(se=ee;se<2*ee;se++)Q[se]=0;return new f(Q,0)};function $(ne,ee){for(;(ne[ee]&65535)!=ne[ee];)ne[ee+1]+=ne[ee]>>>16,ne[ee]&=65535,ee++}function te(ne,ee){this.g=ne,this.h=ee}function ce(ne,ee){if(j(ee))throw Error("division by zero");if(j(ne))return new te(A,A);if(B(ne))return ee=ce(H(ne),ee),new te(H(ee.g),H(ee.h));if(B(ee))return ee=ce(ne,H(ee)),new te(H(ee.g),ee.h);if(30<ne.g.length){if(B(ne)||B(ee))throw Error("slowDivide_ only works with positive integers.");for(var Q=N,se=ee;0>=se.l(ne);)Q=oe(Q),se=oe(se);var pe=_e(Q,1),fe=_e(se,1);for(se=_e(se,2),Q=_e(Q,2);!j(se);){var ue=fe.add(se);0>=ue.l(ne)&&(pe=pe.add(Q),fe=ue),se=_e(se,1),Q=_e(Q,1)}return ee=J(ne,pe.j(ee)),new te(pe,ee)}for(pe=A;0<=ne.l(ee);){for(Q=Math.max(1,Math.floor(ne.m()/ee.m())),se=Math.ceil(Math.log(Q)/Math.LN2),se=48>=se?1:Math.pow(2,se-48),fe=b(Q),ue=fe.j(ee);B(ue)||0<ue.l(ne);)Q-=se,fe=b(Q),ue=fe.j(ee);j(fe)&&(fe=N),pe=pe.add(fe),ne=J(ne,ue)}return new te(pe,ne)}n.A=function(ne){return ce(this,ne).h},n.and=function(ne){for(var ee=Math.max(this.g.length,ne.g.length),Q=[],se=0;se<ee;se++)Q[se]=this.i(se)&ne.i(se);return new f(Q,this.h&ne.h)},n.or=function(ne){for(var ee=Math.max(this.g.length,ne.g.length),Q=[],se=0;se<ee;se++)Q[se]=this.i(se)|ne.i(se);return new f(Q,this.h|ne.h)},n.xor=function(ne){for(var ee=Math.max(this.g.length,ne.g.length),Q=[],se=0;se<ee;se++)Q[se]=this.i(se)^ne.i(se);return new f(Q,this.h^ne.h)};function oe(ne){for(var ee=ne.g.length+1,Q=[],se=0;se<ee;se++)Q[se]=ne.i(se)<<1|ne.i(se-1)>>>31;return new f(Q,ne.h)}function _e(ne,ee){var Q=ee>>5;ee%=32;for(var se=ne.g.length-Q,pe=[],fe=0;fe<se;fe++)pe[fe]=0<ee?ne.i(fe+Q)>>>ee|ne.i(fe+Q+1)<<32-ee:ne.i(fe+Q);return new f(pe,ne.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,ire=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=b,f.fromString=w,ug=f}).apply(typeof WY<"u"?WY:typeof self<"u"?self:typeof window<"u"?window:{});var fO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var sre,Dw,ore,HO,JU,are,cre,lre;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(I,W,Z){return I==Array.prototype||I==Object.prototype||(I[W]=Z.value),I};function s(I){I=[typeof globalThis=="object"&&globalThis,I,typeof window=="object"&&window,typeof self=="object"&&self,typeof fO=="object"&&fO];for(var W=0;W<I.length;++W){var Z=I[W];if(Z&&Z.Math==Math)return Z}throw Error("Cannot find global object")}var a=s(this);function l(I,W){if(W)e:{var Z=a;I=I.split(".");for(var me=0;me<I.length-1;me++){var Ke=I[me];if(!(Ke in Z))break e;Z=Z[Ke]}I=I[I.length-1],me=Z[I],W=W(me),W!=me&&W!=null&&t(Z,I,{configurable:!0,writable:!0,value:W})}}function d(I,W){I instanceof String&&(I+="");var Z=0,me=!1,Ke={next:function(){if(!me&&Z<I.length){var at=Z++;return{value:W(at,I[at]),done:!1}}return me=!0,{done:!0,value:void 0}}};return Ke[Symbol.iterator]=function(){return Ke},Ke}l("Array.prototype.values",function(I){return I||function(){return d(this,function(W,Z){return Z})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},E=this||self;function v(I){var W=typeof I;return W=W!="object"?W:I?Array.isArray(I)?"array":W:"null",W=="array"||W=="object"&&typeof I.length=="number"}function b(I){var W=typeof I;return W=="object"&&I!=null||W=="function"}function w(I,W,Z){return I.call.apply(I.bind,arguments)}function A(I,W,Z){if(!I)throw Error();if(2<arguments.length){var me=Array.prototype.slice.call(arguments,2);return function(){var Ke=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ke,me),I.apply(W,Ke)}}return function(){return I.apply(W,arguments)}}function N(I,W,Z){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:A,N.apply(null,arguments)}function V(I,W){var Z=Array.prototype.slice.call(arguments,1);return function(){var me=Z.slice();return me.push.apply(me,arguments),I.apply(this,me)}}function j(I,W){function Z(){}Z.prototype=W.prototype,I.aa=W.prototype,I.prototype=new Z,I.prototype.constructor=I,I.Qb=function(me,Ke,at){for(var Mt=Array(arguments.length-2),$r=2;$r<arguments.length;$r++)Mt[$r-2]=arguments[$r];return W.prototype[Ke].apply(me,Mt)}}function B(I){const W=I.length;if(0<W){const Z=Array(W);for(let me=0;me<W;me++)Z[me]=I[me];return Z}return[]}function H(I,W){for(let Z=1;Z<arguments.length;Z++){const me=arguments[Z];if(v(me)){const Ke=I.length||0,at=me.length||0;I.length=Ke+at;for(let Mt=0;Mt<at;Mt++)I[Ke+Mt]=me[Mt]}else I.push(me)}}class J{constructor(W,Z){this.i=W,this.j=Z,this.h=0,this.g=null}get(){let W;return 0<this.h?(this.h--,W=this.g,this.g=W.next,W.next=null):W=this.i(),W}}function $(I){return/^[\s\xa0]*$/.test(I)}function te(){var I=E.navigator;return I&&(I=I.userAgent)?I:""}function ce(I){return ce[" "](I),I}ce[" "]=function(){};var oe=te().indexOf("Gecko")!=-1&&!(te().toLowerCase().indexOf("webkit")!=-1&&te().indexOf("Edge")==-1)&&!(te().indexOf("Trident")!=-1||te().indexOf("MSIE")!=-1)&&te().indexOf("Edge")==-1;function _e(I,W,Z){for(const me in I)W.call(Z,I[me],me,I)}function ne(I,W){for(const Z in I)W.call(void 0,I[Z],Z,I)}function ee(I){const W={};for(const Z in I)W[Z]=I[Z];return W}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function se(I,W){let Z,me;for(let Ke=1;Ke<arguments.length;Ke++){me=arguments[Ke];for(Z in me)I[Z]=me[Z];for(let at=0;at<Q.length;at++)Z=Q[at],Object.prototype.hasOwnProperty.call(me,Z)&&(I[Z]=me[Z])}}function pe(I){var W=1;I=I.split(":");const Z=[];for(;0<W&&I.length;)Z.push(I.shift()),W--;return I.length&&Z.push(I.join(":")),Z}function fe(I){E.setTimeout(()=>{throw I},0)}function ue(){var I=ve;let W=null;return I.g&&(W=I.g,I.g=I.g.next,I.g||(I.h=null),W.next=null),W}class Me{constructor(){this.h=this.g=null}add(W,Z){const me=He.get();me.set(W,Z),this.h?this.h.next=me:this.g=me,this.h=me}}var He=new J(()=>new nt,I=>I.reset());class nt{constructor(){this.next=this.g=this.h=null}set(W,Z){this.h=W,this.g=Z,this.next=null}reset(){this.next=this.g=this.h=null}}let we,Ce=!1,ve=new Me,Ne=()=>{const I=E.Promise.resolve(void 0);we=()=>{I.then(Te)}};var Te=()=>{for(var I;I=ue();){try{I.h.call(I.g)}catch(Z){fe(Z)}var W=He;W.j(I),100>W.h&&(W.h++,I.next=W.g,W.g=I)}Ce=!1};function be(){this.s=this.s,this.C=this.C}be.prototype.s=!1,be.prototype.ma=function(){this.s||(this.s=!0,this.N())},be.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ae(I,W){this.type=I,this.g=this.target=W,this.defaultPrevented=!1}Ae.prototype.h=function(){this.defaultPrevented=!0};var Ue=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var I=!1,W=Object.defineProperty({},"passive",{get:function(){I=!0}});try{const Z=()=>{};E.addEventListener("test",Z,W),E.removeEventListener("test",Z,W)}catch{}return I}();function Ge(I,W){if(Ae.call(this,I?I.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,I){var Z=this.type=I.type,me=I.changedTouches&&I.changedTouches.length?I.changedTouches[0]:null;if(this.target=I.target||I.srcElement,this.g=W,W=I.relatedTarget){if(oe){e:{try{ce(W.nodeName);var Ke=!0;break e}catch{}Ke=!1}Ke||(W=null)}}else Z=="mouseover"?W=I.fromElement:Z=="mouseout"&&(W=I.toElement);this.relatedTarget=W,me?(this.clientX=me.clientX!==void 0?me.clientX:me.pageX,this.clientY=me.clientY!==void 0?me.clientY:me.pageY,this.screenX=me.screenX||0,this.screenY=me.screenY||0):(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0),this.button=I.button,this.key=I.key||"",this.ctrlKey=I.ctrlKey,this.altKey=I.altKey,this.shiftKey=I.shiftKey,this.metaKey=I.metaKey,this.pointerId=I.pointerId||0,this.pointerType=typeof I.pointerType=="string"?I.pointerType:Qe[I.pointerType]||"",this.state=I.state,this.i=I,I.defaultPrevented&&Ge.aa.h.call(this)}}j(Ge,Ae);var Qe={2:"touch",3:"pen",4:"mouse"};Ge.prototype.h=function(){Ge.aa.h.call(this);var I=this.i;I.preventDefault?I.preventDefault():I.returnValue=!1};var tt="closure_listenable_"+(1e6*Math.random()|0),dt=0;function Ze(I,W,Z,me,Ke){this.listener=I,this.proxy=null,this.src=W,this.type=Z,this.capture=!!me,this.ha=Ke,this.key=++dt,this.da=this.fa=!1}function wt(I){I.da=!0,I.listener=null,I.proxy=null,I.src=null,I.ha=null}function un(I){this.src=I,this.g={},this.h=0}un.prototype.add=function(I,W,Z,me,Ke){var at=I.toString();I=this.g[at],I||(I=this.g[at]=[],this.h++);var Mt=tn(I,W,me,Ke);return-1<Mt?(W=I[Mt],Z||(W.fa=!1)):(W=new Ze(W,this.src,at,!!me,Ke),W.fa=Z,I.push(W)),W};function xt(I,W){var Z=W.type;if(Z in I.g){var me=I.g[Z],Ke=Array.prototype.indexOf.call(me,W,void 0),at;(at=0<=Ke)&&Array.prototype.splice.call(me,Ke,1),at&&(wt(W),I.g[Z].length==0&&(delete I.g[Z],I.h--))}}function tn(I,W,Z,me){for(var Ke=0;Ke<I.length;++Ke){var at=I[Ke];if(!at.da&&at.listener==W&&at.capture==!!Z&&at.ha==me)return Ke}return-1}var kn="closure_lm_"+(1e6*Math.random()|0),$t={};function zn(I,W,Z,me,Ke){if(Array.isArray(W)){for(var at=0;at<W.length;at++)zn(I,W[at],Z,me,Ke);return null}return Z=pn(Z),I&&I[tt]?I.K(W,Z,b(me)?!!me.capture:!1,Ke):Bt(I,W,Z,!1,me,Ke)}function Bt(I,W,Z,me,Ke,at){if(!W)throw Error("Invalid event type");var Mt=b(Ke)?!!Ke.capture:!!Ke,$r=yt(I);if($r||(I[kn]=$r=new un(I)),Z=$r.add(W,Z,me,Mt,at),Z.proxy)return Z;if(me=Re(),Z.proxy=me,me.src=I,me.listener=Z,I.addEventListener)Ue||(Ke=Mt),Ke===void 0&&(Ke=!1),I.addEventListener(W.toString(),me,Ke);else if(I.attachEvent)I.attachEvent(ot(W.toString()),me);else if(I.addListener&&I.removeListener)I.addListener(me);else throw Error("addEventListener and attachEvent are unavailable.");return Z}function Re(){function I(Z){return W.call(I.src,I.listener,Z)}const W=Et;return I}function Fe(I,W,Z,me,Ke){if(Array.isArray(W))for(var at=0;at<W.length;at++)Fe(I,W[at],Z,me,Ke);else me=b(me)?!!me.capture:!!me,Z=pn(Z),I&&I[tt]?(I=I.i,W=String(W).toString(),W in I.g&&(at=I.g[W],Z=tn(at,Z,me,Ke),-1<Z&&(wt(at[Z]),Array.prototype.splice.call(at,Z,1),at.length==0&&(delete I.g[W],I.h--)))):I&&(I=yt(I))&&(W=I.g[W.toString()],I=-1,W&&(I=tn(W,Z,me,Ke)),(Z=-1<I?W[I]:null)&&We(Z))}function We(I){if(typeof I!="number"&&I&&!I.da){var W=I.src;if(W&&W[tt])xt(W.i,I);else{var Z=I.type,me=I.proxy;W.removeEventListener?W.removeEventListener(Z,me,I.capture):W.detachEvent?W.detachEvent(ot(Z),me):W.addListener&&W.removeListener&&W.removeListener(me),(Z=yt(W))?(xt(Z,I),Z.h==0&&(Z.src=null,W[kn]=null)):wt(I)}}}function ot(I){return I in $t?$t[I]:$t[I]="on"+I}function Et(I,W){if(I.da)I=!0;else{W=new Ge(W,this);var Z=I.listener,me=I.ha||I.src;I.fa&&We(I),I=Z.call(me,W)}return I}function yt(I){return I=I[kn],I instanceof un?I:null}var zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function pn(I){return typeof I=="function"?I:(I[zt]||(I[zt]=function(W){return I.handleEvent(W)}),I[zt])}function xn(){be.call(this),this.i=new un(this),this.M=this,this.F=null}j(xn,be),xn.prototype[tt]=!0,xn.prototype.removeEventListener=function(I,W,Z,me){Fe(this,I,W,Z,me)};function cn(I,W){var Z,me=I.F;if(me)for(Z=[];me;me=me.F)Z.push(me);if(I=I.M,me=W.type||W,typeof W=="string")W=new Ae(W,I);else if(W instanceof Ae)W.target=W.target||I;else{var Ke=W;W=new Ae(me,I),se(W,Ke)}if(Ke=!0,Z)for(var at=Z.length-1;0<=at;at--){var Mt=W.g=Z[at];Ke=dr(Mt,me,!0,W)&&Ke}if(Mt=W.g=I,Ke=dr(Mt,me,!0,W)&&Ke,Ke=dr(Mt,me,!1,W)&&Ke,Z)for(at=0;at<Z.length;at++)Mt=W.g=Z[at],Ke=dr(Mt,me,!1,W)&&Ke}xn.prototype.N=function(){if(xn.aa.N.call(this),this.i){var I=this.i,W;for(W in I.g){for(var Z=I.g[W],me=0;me<Z.length;me++)wt(Z[me]);delete I.g[W],I.h--}}this.F=null},xn.prototype.K=function(I,W,Z,me){return this.i.add(String(I),W,!1,Z,me)},xn.prototype.L=function(I,W,Z,me){return this.i.add(String(I),W,!0,Z,me)};function dr(I,W,Z,me){if(W=I.i.g[String(W)],!W)return!0;W=W.concat();for(var Ke=!0,at=0;at<W.length;++at){var Mt=W[at];if(Mt&&!Mt.da&&Mt.capture==Z){var $r=Mt.listener,ai=Mt.ha||Mt.src;Mt.fa&&xt(I.i,Mt),Ke=$r.call(ai,me)!==!1&&Ke}}return Ke&&!me.defaultPrevented}function pa(I,W,Z){if(typeof I=="function")Z&&(I=N(I,Z));else if(I&&typeof I.handleEvent=="function")I=N(I.handleEvent,I);else throw Error("Invalid listener argument");return 2147483647<Number(W)?-1:E.setTimeout(I,W||0)}function Vt(I){I.g=pa(()=>{I.g=null,I.i&&(I.i=!1,Vt(I))},I.l);const W=I.h;I.h=null,I.m.apply(null,W)}class on extends be{constructor(W,Z){super(),this.m=W,this.l=Z,this.h=null,this.i=!1,this.g=null}j(W){this.h=arguments,this.g?this.i=!0:Vt(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mi(I){be.call(this),this.h=I,this.g={}}j(Mi,be);var fs=[];function Ls(I){_e(I.g,function(W,Z){this.g.hasOwnProperty(Z)&&We(W)},I),I.g={}}Mi.prototype.N=function(){Mi.aa.N.call(this),Ls(this)},Mi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Zr=E.JSON.stringify,Pt=E.JSON.parse,wn=class{stringify(I){return E.JSON.stringify(I,void 0)}parse(I){return E.JSON.parse(I,void 0)}};function ir(){}ir.prototype.h=null;function Oi(I){return I.h||(I.h=I.i())}function _c(){}var is={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function fa(){Ae.call(this,"d")}j(fa,Ae);function _o(){Ae.call(this,"c")}j(_o,Ae);var ma={},ga=null;function to(){return ga=ga||new xn}ma.La="serverreachability";function ms(I){Ae.call(this,ma.La,I)}j(ms,Ae);function ss(I){const W=to();cn(W,new ms(W))}ma.STAT_EVENT="statevent";function Do(I,W){Ae.call(this,ma.STAT_EVENT,I),this.stat=W}j(Do,Ae);function Ui(I){const W=to();cn(W,new Do(W,I))}ma.Ma="timingevent";function gs(I,W){Ae.call(this,ma.Ma,I),this.size=W}j(gs,Ae);function qa(I,W){if(typeof I!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){I()},W)}function Lu(){this.g=!0}Lu.prototype.xa=function(){this.g=!1};function Ec(I,W,Z,me,Ke,at){I.info(function(){if(I.g)if(at)for(var Mt="",$r=at.split("&"),ai=0;ai<$r.length;ai++){var vr=$r[ai].split("=");if(1<vr.length){var Ks=vr[0];vr=vr[1];var Es=Ks.split("_");Mt=2<=Es.length&&Es[1]=="type"?Mt+(Ks+"="+vr+"&"):Mt+(Ks+"=redacted&")}}else Mt=null;else Mt=at;return"XMLHTTP REQ ("+me+") [attempt "+Ke+"]: "+W+`
`+Z+`
`+Mt})}function _a(I,W,Z,me,Ke,at,Mt){I.info(function(){return"XMLHTTP RESP ("+me+") [ attempt "+Ke+"]: "+W+`
`+Z+`
`+at+" "+Mt})}function Ea(I,W,Z,me){I.info(function(){return"XMLHTTP TEXT ("+W+"): "+kg(I,Z)+(me?" "+me:"")})}function Ld(I,W){I.info(function(){return"TIMEOUT: "+W})}Lu.prototype.info=function(){};function kg(I,W){if(!I.g)return W;if(!W)return null;try{var Z=JSON.parse(W);if(Z){for(I=0;I<Z.length;I++)if(Array.isArray(Z[I])){var me=Z[I];if(!(2>me.length)){var Ke=me[1];if(Array.isArray(Ke)&&!(1>Ke.length)){var at=Ke[0];if(at!="noop"&&at!="stop"&&at!="close")for(var Mt=1;Mt<Ke.length;Mt++)Ke[Mt]=""}}}}return Zr(Z)}catch{return W}}var xu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},op={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},$s;function Mu(){}j(Mu,ir),Mu.prototype.g=function(){return new XMLHttpRequest},Mu.prototype.i=function(){return{}},$s=new Mu;function ya(I,W,Z,me){this.j=I,this.i=W,this.l=Z,this.R=me||1,this.U=new Mi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new xd}function xd(){this.i=null,this.g="",this.h=!1}var Md={},Ya={};function Ud(I,W,Z){I.L=1,I.v=Ja(xo(W)),I.m=Z,I.P=!0,Uu(I,null)}function Uu(I,W){I.F=Date.now(),Br(I),I.A=xo(I.v);var Z=I.A,me=I.R;Array.isArray(me)||(me=[String(me)]),Gl(Z.i,"t",me),I.C=0,Z=I.j.J,I.h=new xd,I.g=WE(I.j,Z?W:null,!I.m),0<I.O&&(I.M=new on(N(I.Y,I,I.g),I.O)),W=I.U,Z=I.g,me=I.ca;var Ke="readystatechange";Array.isArray(Ke)||(Ke&&(fs[0]=Ke.toString()),Ke=fs);for(var at=0;at<Ke.length;at++){var Mt=zn(Z,Ke[at],me||W.handleEvent,!1,W.h||W);if(!Mt)break;W.g[Mt.key]=Mt}W=I.H?ee(I.H):{},I.m?(I.u||(I.u="POST"),W["Content-Type"]="application/x-www-form-urlencoded",I.g.ea(I.A,I.u,I.m,W)):(I.u="GET",I.g.ea(I.A,I.u,null,W)),ss(),Ec(I.i,I.u,I.A,I.l,I.R,I.m)}ya.prototype.ca=function(I){I=I.target;const W=this.M;W&&_i(I)==3?W.j():this.Y(I)},ya.prototype.Y=function(I){try{if(I==this.g)e:{const Es=_i(this.g);var W=this.g.Ba();const Qa=this.g.Z();if(!(3>Es)&&(Es!=3||this.g&&(this.h.h||this.g.oa()||xs(this.g)))){this.J||Es!=4||W==7||(W==8||0>=Qa?ss(3):ss(2)),yc(this);var Z=this.g.Z();this.X=Z;t:if(Lo(this)){var me=xs(this.g);I="";var Ke=me.length,at=_i(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){va(this),ll(this);var Mt="";break t}this.h.i=new E.TextDecoder}for(W=0;W<Ke;W++)this.h.h=!0,I+=this.h.i.decode(me[W],{stream:!(at&&W==Ke-1)});me.length=0,this.h.g+=I,this.C=0,Mt=this.h.g}else Mt=this.g.oa();if(this.o=Z==200,_a(this.i,this.u,this.A,this.l,this.R,Es,Z),this.o){if(this.T&&!this.K){t:{if(this.g){var $r,ai=this.g;if(($r=ai.g?ai.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$($r)){var vr=$r;break t}}vr=null}if(Z=vr)Ea(this.i,this.l,Z,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ap(this,Z);else{this.o=!1,this.s=3,Ui(12),va(this),ll(this);break e}}if(this.P){Z=!0;let Ho;for(;!this.J&&this.C<Mt.length;)if(Ho=Vd(this,Mt),Ho==Ya){Es==4&&(this.s=4,Ui(14),Z=!1),Ea(this.i,this.l,null,"[Incomplete Response]");break}else if(Ho==Md){this.s=4,Ui(15),Ea(this.i,this.l,Mt,"[Invalid Chunk]"),Z=!1;break}else Ea(this.i,this.l,Ho,null),ap(this,Ho);if(Lo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Es!=4||Mt.length!=0||this.h.h||(this.s=1,Ui(16),Z=!1),this.o=this.o&&Z,!Z)Ea(this.i,this.l,Mt,"[Invalid Chunked Response]"),va(this),ll(this);else if(0<Mt.length&&!this.W){this.W=!0;var Ks=this.j;Ks.g==this&&Ks.ba&&!Ks.M&&(Ks.j.info("Great, no buffering proxy detected. Bytes received: "+Mt.length),Dg(Ks),Ks.M=!0,Ui(11))}}else Ea(this.i,this.l,Mt,null),ap(this,Mt);Es==4&&va(this),this.o&&!this.J&&(Es==4?qf(this.j,this):(this.o=!1,Br(this)))}else Bo(this.g),Z==400&&0<Mt.indexOf("Unknown SID")?(this.s=3,Ui(12)):(this.s=0,Ui(13)),va(this),ll(this)}}}catch{}finally{}};function Lo(I){return I.g?I.u=="GET"&&I.L!=2&&I.j.Ca:!1}function Vd(I,W){var Z=I.C,me=W.indexOf(`
`,Z);return me==-1?Ya:(Z=Number(W.substring(Z,me)),isNaN(Z)?Md:(me+=1,me+Z>W.length?Ya:(W=W.slice(me,me+Z),I.C=me+Z,W)))}ya.prototype.cancel=function(){this.J=!0,va(this)};function Br(I){I.S=Date.now()+I.I,gi(I,I.I)}function gi(I,W){if(I.B!=null)throw Error("WatchDog timer not null");I.B=qa(N(I.ba,I),W)}function yc(I){I.B&&(E.clearTimeout(I.B),I.B=null)}ya.prototype.ba=function(){this.B=null;const I=Date.now();0<=I-this.S?(Ld(this.i,this.A),this.L!=2&&(ss(),Ui(17)),va(this),this.s=2,ll(this)):gi(this,this.S-I)};function ll(I){I.j.G==0||I.J||qf(I.j,I)}function va(I){yc(I);var W=I.M;W&&typeof W.ma=="function"&&W.ma(),I.M=null,Ls(I.U),I.g&&(W=I.g,I.g=null,W.abort(),W.ma())}function ap(I,W){try{var Z=I.j;if(Z.G!=0&&(Z.g==I||no(Z.h,I))){if(!I.K&&no(Z.h,I)&&Z.G==3){try{var me=Z.Da.g.parse(W)}catch{me=null}if(Array.isArray(me)&&me.length==3){var Ke=me;if(Ke[0]==0){e:if(!Z.u){if(Z.g)if(Z.g.F+3e3<I.F)Kf(Z),fl(Z);else break e;$f(Z),Ui(18)}}else Z.za=Ke[1],0<Z.za-Z.T&&37500>Ke[2]&&Z.F&&Z.v==0&&!Z.C&&(Z.C=qa(N(Z.Za,Z),6e3));if(1>=jf(Z.h)&&Z.ca){try{Z.ca()}catch{}Z.ca=void 0}}else Gu(Z,11)}else if((I.K||Z.g==I)&&Kf(Z),!$(W))for(Ke=Z.Da.g.parse(W),W=0;W<Ke.length;W++){let vr=Ke[W];if(Z.T=vr[0],vr=vr[1],Z.G==2)if(vr[0]=="c"){Z.K=vr[1],Z.ia=vr[2];const Ks=vr[3];Ks!=null&&(Z.la=Ks,Z.j.info("VER="+Z.la));const Es=vr[4];Es!=null&&(Z.Aa=Es,Z.j.info("SVER="+Z.Aa));const Qa=vr[5];Qa!=null&&typeof Qa=="number"&&0<Qa&&(me=1.5*Qa,Z.L=me,Z.j.info("backChannelRequestTimeoutMs_="+me)),me=Z;const Ho=I.g;if(Ho){const hp=Ho.g?Ho.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(hp){var at=me.h;at.g||hp.indexOf("spdy")==-1&&hp.indexOf("quic")==-1&&hp.indexOf("h2")==-1||(at.j=at.l,at.g=new Set,at.h&&(cp(at,at.h),at.h=null))}if(me.D){const Xf=Ho.g?Ho.g.getResponseHeader("X-HTTP-Session-Id"):null;Xf&&(me.ya=Xf,Hr(me.I,me.D,Xf))}}Z.G=3,Z.l&&Z.l.ua(),Z.ba&&(Z.R=Date.now()-I.F,Z.j.info("Handshake RTT: "+Z.R+"ms")),me=Z;var Mt=I;if(me.qa=Lg(me,me.J?me.ia:null,me.W),Mt.K){ul(me.h,Mt);var $r=Mt,ai=me.L;ai&&($r.I=ai),$r.B&&(yc($r),Br($r)),me.g=Mt}else $l(me);0<Z.i.length&&bc(Z)}else vr[0]!="stop"&&vr[0]!="close"||Gu(Z,7);else Z.G==3&&(vr[0]=="stop"||vr[0]=="close"?vr[0]=="stop"?Gu(Z,7):Xi(Z):vr[0]!="noop"&&Z.l&&Z.l.ta(vr),Z.v=0)}}ss(4)}catch{}}var Fd=class{constructor(I,W){this.g=I,this.map=W}};function Fl(I){this.l=I||10,E.PerformanceNavigationTiming?(I=E.performance.getEntriesByType("navigation"),I=0<I.length&&(I[0].nextHopProtocol=="hq"||I[0].nextHopProtocol=="h2")):I=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=I?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Eo(I){return I.h?!0:I.g?I.g.size>=I.j:!1}function jf(I){return I.h?1:I.g?I.g.size:0}function no(I,W){return I.h?I.h==W:I.g?I.g.has(W):!1}function cp(I,W){I.g?I.g.add(W):I.h=W}function ul(I,W){I.h&&I.h==W?I.h=null:I.g&&I.g.has(W)&&I.g.delete(W)}Fl.prototype.cancel=function(){if(this.i=jd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const I of this.g.values())I.cancel();this.g.clear()}};function jd(I){if(I.h!=null)return I.i.concat(I.h.D);if(I.g!=null&&I.g.size!==0){let W=I.i;for(const Z of I.g.values())W=W.concat(Z.D);return W}return B(I.i)}function Bd(I){if(I.V&&typeof I.V=="function")return I.V();if(typeof Map<"u"&&I instanceof Map||typeof Set<"u"&&I instanceof Set)return Array.from(I.values());if(typeof I=="string")return I.split("");if(v(I)){for(var W=[],Z=I.length,me=0;me<Z;me++)W.push(I[me]);return W}W=[],Z=0;for(me in I)W[Z++]=I[me];return W}function fr(I){if(I.na&&typeof I.na=="function")return I.na();if(!I.V||typeof I.V!="function"){if(typeof Map<"u"&&I instanceof Map)return Array.from(I.keys());if(!(typeof Set<"u"&&I instanceof Set)){if(v(I)||typeof I=="string"){var W=[];I=I.length;for(var Z=0;Z<I;Z++)W.push(Z);return W}W=[],Z=0;for(const me in I)W[Z++]=me;return W}}}function jl(I,W){if(I.forEach&&typeof I.forEach=="function")I.forEach(W,void 0);else if(v(I)||typeof I=="string")Array.prototype.forEach.call(I,W,void 0);else for(var Z=fr(I),me=Bd(I),Ke=me.length,at=0;at<Ke;at++)W.call(void 0,me[at],Z&&Z[at],I)}var Bl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Vu(I,W){if(I){I=I.split("&");for(var Z=0;Z<I.length;Z++){var me=I[Z].indexOf("="),Ke=null;if(0<=me){var at=I[Z].substring(0,me);Ke=I[Z].substring(me+1)}else at=I[Z];W(at,Ke?decodeURIComponent(Ke.replace(/\+/g," ")):"")}}}function Xa(I){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,I instanceof Xa){this.h=I.h,Fu(this,I.j),this.o=I.o,this.g=I.g,dl(this,I.s),this.l=I.l;var W=I.i,Z=new Mo;Z.i=W.i,W.g&&(Z.g=new Map(W.g),Z.h=W.h),Wl(this,Z),this.m=I.m}else I&&(W=String(I).match(Bl))?(this.h=!1,Fu(this,W[1]||"",!0),this.o=sr(W[2]||""),this.g=sr(W[3]||"",!0),dl(this,W[4]),this.l=sr(W[5]||"",!0),Wl(this,W[6]||"",!0),this.m=sr(W[7]||"")):(this.h=!1,this.i=new Mo(null,this.h))}Xa.prototype.toString=function(){var I=[],W=this.j;W&&I.push(vc(W,zl,!0),":");var Z=this.g;return(Z||W=="file")&&(I.push("//"),(W=this.o)&&I.push(vc(W,zl,!0),"@"),I.push(encodeURIComponent(String(Z)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),Z=this.s,Z!=null&&I.push(":",String(Z))),(Z=this.l)&&(this.g&&Z.charAt(0)!="/"&&I.push("/"),I.push(vc(Z,Z.charAt(0)=="/"?lp:Wd,!0))),(Z=this.i.toString())&&I.push("?",Z),(Z=this.m)&&I.push("#",vc(Z,up)),I.join("")};function xo(I){return new Xa(I)}function Fu(I,W,Z){I.j=Z?sr(W,!0):W,I.j&&(I.j=I.j.replace(/:$/,""))}function dl(I,W){if(W){if(W=Number(W),isNaN(W)||0>W)throw Error("Bad port number "+W);I.s=W}else I.s=null}function Wl(I,W,Z){W instanceof Mo?(I.i=W,jo(I.i,I.h)):(Z||(W=vc(W,Wf)),I.i=new Mo(W,I.h))}function Hr(I,W,Z){I.i.set(W,Z)}function Ja(I){return Hr(I,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),I}function sr(I,W){return I?W?decodeURI(I.replace(/%25/g,"%2525")):decodeURIComponent(I):""}function vc(I,W,Z){return typeof I=="string"?(I=encodeURI(I).replace(W,Bf),Z&&(I=I.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),I):null}function Bf(I){return I=I.charCodeAt(0),"%"+(I>>4&15).toString(16)+(I&15).toString(16)}var zl=/[#\/\?@]/g,Wd=/[#\?:]/g,lp=/[#\?]/g,Wf=/[#\?@]/g,up=/#/g;function Mo(I,W){this.h=this.g=null,this.i=I||null,this.j=!!W}function os(I){I.g||(I.g=new Map,I.h=0,I.i&&Vu(I.i,function(W,Z){I.add(decodeURIComponent(W.replace(/\+/g," ")),Z)}))}n=Mo.prototype,n.add=function(I,W){os(this),this.i=null,I=Fo(this,I);var Z=this.g.get(I);return Z||this.g.set(I,Z=[]),Z.push(W),this.h+=1,this};function Uo(I,W){os(I),W=Fo(I,W),I.g.has(W)&&(I.i=null,I.h-=I.g.get(W).length,I.g.delete(W))}function Vo(I,W){return os(I),W=Fo(I,W),I.g.has(W)}n.forEach=function(I,W){os(this),this.g.forEach(function(Z,me){Z.forEach(function(Ke){I.call(W,Ke,me,this)},this)},this)},n.na=function(){os(this);const I=Array.from(this.g.values()),W=Array.from(this.g.keys()),Z=[];for(let me=0;me<W.length;me++){const Ke=I[me];for(let at=0;at<Ke.length;at++)Z.push(W[me])}return Z},n.V=function(I){os(this);let W=[];if(typeof I=="string")Vo(this,I)&&(W=W.concat(this.g.get(Fo(this,I))));else{I=Array.from(this.g.values());for(let Z=0;Z<I.length;Z++)W=W.concat(I[Z])}return W},n.set=function(I,W){return os(this),this.i=null,I=Fo(this,I),Vo(this,I)&&(this.h-=this.g.get(I).length),this.g.set(I,[W]),this.h+=1,this},n.get=function(I,W){return I?(I=this.V(I),0<I.length?String(I[0]):W):W};function Gl(I,W,Z){Uo(I,W),0<Z.length&&(I.i=null,I.g.set(Fo(I,W),B(Z)),I.h+=Z.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const I=[],W=Array.from(this.g.keys());for(var Z=0;Z<W.length;Z++){var me=W[Z];const at=encodeURIComponent(String(me)),Mt=this.V(me);for(me=0;me<Mt.length;me++){var Ke=at;Mt[me]!==""&&(Ke+="="+encodeURIComponent(String(Mt[me]))),I.push(Ke)}}return this.i=I.join("&")};function Fo(I,W){return W=String(W),I.j&&(W=W.toLowerCase()),W}function jo(I,W){W&&!I.j&&(os(I),I.i=null,I.g.forEach(function(Z,me){var Ke=me.toLowerCase();me!=Ke&&(Uo(this,me),Gl(this,Ke,Z))},I)),I.j=W}function zf(I,W){const Z=new Lu;if(E.Image){const me=new Image;me.onload=V(_s,Z,"TestLoadImage: loaded",!0,W,me),me.onerror=V(_s,Z,"TestLoadImage: error",!1,W,me),me.onabort=V(_s,Z,"TestLoadImage: abort",!1,W,me),me.ontimeout=V(_s,Z,"TestLoadImage: timeout",!1,W,me),E.setTimeout(function(){me.ontimeout&&me.ontimeout()},1e4),me.src=I}else W(!1)}function Sc(I,W){const Z=new Lu,me=new AbortController,Ke=setTimeout(()=>{me.abort(),_s(Z,"TestPingServer: timeout",!1,W)},1e4);fetch(I,{signal:me.signal}).then(at=>{clearTimeout(Ke),at.ok?_s(Z,"TestPingServer: ok",!0,W):_s(Z,"TestPingServer: server error",!1,W)}).catch(()=>{clearTimeout(Ke),_s(Z,"TestPingServer: error",!1,W)})}function _s(I,W,Z,me,Ke){try{Ke&&(Ke.onload=null,Ke.onerror=null,Ke.onabort=null,Ke.ontimeout=null),me(Z)}catch{}}function ju(){this.g=new wn}function dp(I,W,Z){const me=Z||"";try{jl(I,function(Ke,at){let Mt=Ke;b(Ke)&&(Mt=Zr(Ke)),W.push(me+at+"="+encodeURIComponent(Mt))})}catch(Ke){throw W.push(me+"type="+encodeURIComponent("_badmap")),Ke}}function hl(I){this.l=I.Ub||null,this.j=I.eb||!1}j(hl,ir),hl.prototype.g=function(){return new Hl(this.l,this.j)},hl.prototype.i=function(I){return function(){return I}}({});function Hl(I,W){xn.call(this),this.D=I,this.o=W,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}j(Hl,xn),n=Hl.prototype,n.open=function(I,W){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=I,this.A=W,this.readyState=1,ba(this)},n.send=function(I){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const W={headers:this.u,method:this.B,credentials:this.m,cache:void 0};I&&(W.body=I),(this.D||E).fetch(new Request(this.A,W)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Sa(this)),this.readyState=0},n.Sa=function(I){if(this.g&&(this.l=I,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=I.headers,this.readyState=2,ba(this)),this.g&&(this.readyState=3,ba(this),this.g)))if(this.responseType==="arraybuffer")I.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in I){if(this.j=I.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Gf(this)}else I.text().then(this.Ra.bind(this),this.ga.bind(this))};function Gf(I){I.j.read().then(I.Pa.bind(I)).catch(I.ga.bind(I))}n.Pa=function(I){if(this.g){if(this.o&&I.value)this.response.push(I.value);else if(!this.o){var W=I.value?I.value:new Uint8Array(0);(W=this.v.decode(W,{stream:!I.done}))&&(this.response=this.responseText+=W)}I.done?Sa(this):ba(this),this.readyState==3&&Gf(this)}},n.Ra=function(I){this.g&&(this.response=this.responseText=I,Sa(this))},n.Qa=function(I){this.g&&(this.response=I,Sa(this))},n.ga=function(){this.g&&Sa(this)};function Sa(I){I.readyState=4,I.l=null,I.j=null,I.v=null,ba(I)}n.setRequestHeader=function(I,W){this.u.append(I,W)},n.getResponseHeader=function(I){return this.h&&this.h.get(I.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const I=[],W=this.h.entries();for(var Z=W.next();!Z.done;)Z=Z.value,I.push(Z[0]+": "+Z[1]),Z=W.next();return I.join(`\r
`)};function ba(I){I.onreadystatechange&&I.onreadystatechange.call(I)}Object.defineProperty(Hl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(I){this.m=I?"include":"same-origin"}});function pl(I){let W="";return _e(I,function(Z,me){W+=me,W+=":",W+=Z,W+=`\r
`}),W}function Se(I,W,Z){e:{for(me in Z){var me=!1;break e}me=!0}me||(Z=pl(Z),typeof I=="string"?Z!=null&&encodeURIComponent(String(Z)):Hr(I,W,Z))}function De(I){xn.call(this),this.headers=new Map,this.o=I||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}j(De,xn);var et=/^https?$/i,Yt=["POST","PUT"];n=De.prototype,n.Ha=function(I){this.J=I},n.ea=function(I,W,Z,me){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+I);W=W?W.toUpperCase():"GET",this.D=I,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():$s.g(),this.v=this.o?Oi(this.o):Oi($s),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(W,String(I),!0),this.B=!1}catch(at){qn(this,at);return}if(I=Z||"",Z=new Map(this.headers),me)if(Object.getPrototypeOf(me)===Object.prototype)for(var Ke in me)Z.set(Ke,me[Ke]);else if(typeof me.keys=="function"&&typeof me.get=="function")for(const at of me.keys())Z.set(at,me.get(at));else throw Error("Unknown input type for opt_headers: "+String(me));me=Array.from(Z.keys()).find(at=>at.toLowerCase()=="content-type"),Ke=E.FormData&&I instanceof E.FormData,!(0<=Array.prototype.indexOf.call(Yt,W,void 0))||me||Ke||Z.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[at,Mt]of Z)this.g.setRequestHeader(at,Mt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{xr(this),this.u=!0,this.g.send(I),this.u=!1}catch(at){qn(this,at)}};function qn(I,W){I.h=!1,I.g&&(I.j=!0,I.g.abort(),I.j=!1),I.l=W,I.m=5,yr(I),ln(I)}function yr(I){I.A||(I.A=!0,cn(I,"complete"),cn(I,"error"))}n.abort=function(I){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=I||7,cn(this,"complete"),cn(this,"abort"),ln(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ln(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Wr(this):this.bb())},n.bb=function(){Wr(this)};function Wr(I){if(I.h&&typeof f<"u"&&(!I.v[1]||_i(I)!=4||I.Z()!=2)){if(I.u&&_i(I)==4)pa(I.Ea,0,I);else if(cn(I,"readystatechange"),_i(I)==4){I.h=!1;try{const Mt=I.Z();e:switch(Mt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var W=!0;break e;default:W=!1}var Z;if(!(Z=W)){var me;if(me=Mt===0){var Ke=String(I.D).match(Bl)[1]||null;!Ke&&E.self&&E.self.location&&(Ke=E.self.location.protocol.slice(0,-1)),me=!et.test(Ke?Ke.toLowerCase():"")}Z=me}if(Z)cn(I,"complete"),cn(I,"success");else{I.m=6;try{var at=2<_i(I)?I.g.statusText:""}catch{at=""}I.l=at+" ["+I.Z()+"]",yr(I)}}finally{ln(I)}}}}function ln(I,W){if(I.g){xr(I);const Z=I.g,me=I.v[0]?()=>{}:null;I.g=null,I.v=null,W||cn(I,"ready");try{Z.onreadystatechange=me}catch{}}}function xr(I){I.I&&(E.clearTimeout(I.I),I.I=null)}n.isActive=function(){return!!this.g};function _i(I){return I.g?I.g.readyState:0}n.Z=function(){try{return 2<_i(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(I){if(this.g){var W=this.g.responseText;return I&&W.indexOf(I)==0&&(W=W.substring(I.length)),Pt(W)}};function xs(I){try{if(!I.g)return null;if("response"in I.g)return I.g.response;switch(I.H){case"":case"text":return I.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in I.g)return I.g.mozResponseArrayBuffer}return null}catch{return null}}function Bo(I){const W={};I=(I.g&&2<=_i(I)&&I.g.getAllResponseHeaders()||"").split(`\r
`);for(let me=0;me<I.length;me++){if($(I[me]))continue;var Z=pe(I[me]);const Ke=Z[0];if(Z=Z[1],typeof Z!="string")continue;Z=Z.trim();const at=W[Ke]||[];W[Ke]=at,at.push(Z)}ne(W,function(me){return me.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Wo(I,W,Z){return Z&&Z.internalChannelParams&&Z.internalChannelParams[I]||W}function Bu(I){this.Aa=0,this.i=[],this.j=new Lu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Wo("failFast",!1,I),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Wo("baseRetryDelayMs",5e3,I),this.cb=Wo("retryDelaySeedMs",1e4,I),this.Wa=Wo("forwardChannelMaxRetries",2,I),this.wa=Wo("forwardChannelRequestTimeoutMs",2e4,I),this.pa=I&&I.xmlHttpFactory||void 0,this.Xa=I&&I.Tb||void 0,this.Ca=I&&I.useFetchStreams||!1,this.L=void 0,this.J=I&&I.supportsCrossDomainXhr||!1,this.K="",this.h=new Fl(I&&I.concurrentRequestLimit),this.Da=new ju,this.P=I&&I.fastHandshake||!1,this.O=I&&I.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=I&&I.Rb||!1,I&&I.xa&&this.j.xa(),I&&I.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&I&&I.detectBufferingProxy||!1,this.ja=void 0,I&&I.longPollingTimeout&&0<I.longPollingTimeout&&(this.ja=I.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Bu.prototype,n.la=8,n.G=1,n.connect=function(I,W,Z,me){Ui(0),this.W=I,this.H=W||{},Z&&me!==void 0&&(this.H.OSID=Z,this.H.OAID=me),this.F=this.X,this.I=Lg(this,null,this.W),bc(this)};function Xi(I){if(zd(I),I.G==3){var W=I.U++,Z=xo(I.I);if(Hr(Z,"SID",I.K),Hr(Z,"RID",W),Hr(Z,"TYPE","terminate"),Wu(I,Z),W=new ya(I,I.j,W),W.L=2,W.v=Ja(xo(Z)),Z=!1,E.navigator&&E.navigator.sendBeacon)try{Z=E.navigator.sendBeacon(W.v.toString(),"")}catch{}!Z&&E.Image&&(new Image().src=W.v,Z=!0),Z||(W.g=WE(W.j,null),W.g.ea(W.v)),W.F=Date.now(),Br(W)}Hu(I)}function fl(I){I.g&&(Dg(I),I.g.cancel(),I.g=null)}function zd(I){fl(I),I.u&&(E.clearTimeout(I.u),I.u=null),Kf(I),I.h.cancel(),I.s&&(typeof I.s=="number"&&E.clearTimeout(I.s),I.s=null)}function bc(I){if(!Eo(I.h)&&!I.s){I.s=!0;var W=I.Ga;we||Ne(),Ce||(we(),Ce=!0),ve.add(W,I),I.B=0}}function Ng(I,W){return jf(I.h)>=I.h.j-(I.s?1:0)?!1:I.s?(I.i=W.D.concat(I.i),!0):I.G==1||I.G==2||I.B>=(I.Va?0:I.Wa)?!1:(I.s=qa(N(I.Ga,I,W),zu(I,I.B)),I.B++,!0)}n.Ga=function(I){if(this.s)if(this.s=null,this.G==1){if(!I){this.U=Math.floor(1e5*Math.random()),I=this.U++;const Ke=new ya(this,this.j,I);let at=this.o;if(this.S&&(at?(at=ee(at),se(at,this.S)):at=this.S),this.m!==null||this.O||(Ke.H=at,at=null),this.P)e:{for(var W=0,Z=0;Z<this.i.length;Z++){t:{var me=this.i[Z];if("__data__"in me.map&&(me=me.map.__data__,typeof me=="string")){me=me.length;break t}me=void 0}if(me===void 0)break;if(W+=me,4096<W){W=Z;break e}if(W===4096||Z===this.i.length-1){W=Z+1;break e}}W=1e3}else W=1e3;W=zo(this,Ke,W),Z=xo(this.I),Hr(Z,"RID",I),Hr(Z,"CVER",22),this.D&&Hr(Z,"X-HTTP-Session-Id",this.D),Wu(this,Z),at&&(this.O?W="headers="+encodeURIComponent(String(pl(at)))+"&"+W:this.m&&Se(Z,this.m,at)),cp(this.h,Ke),this.Ua&&Hr(Z,"TYPE","init"),this.P?(Hr(Z,"$req",W),Hr(Z,"SID","null"),Ke.T=!0,Ud(Ke,Z,null)):Ud(Ke,Z,W),this.G=2}}else this.G==3&&(I?Hf(this,I):this.i.length==0||Eo(this.h)||Hf(this))};function Hf(I,W){var Z;W?Z=W.l:Z=I.U++;const me=xo(I.I);Hr(me,"SID",I.K),Hr(me,"RID",Z),Hr(me,"AID",I.T),Wu(I,me),I.m&&I.o&&Se(me,I.m,I.o),Z=new ya(I,I.j,Z,I.B+1),I.m===null&&(Z.H=I.o),W&&(I.i=W.D.concat(I.i)),W=zo(I,Z,1e3),Z.I=Math.round(.5*I.wa)+Math.round(.5*I.wa*Math.random()),cp(I.h,Z),Ud(Z,me,W)}function Wu(I,W){I.H&&_e(I.H,function(Z,me){Hr(W,me,Z)}),I.l&&jl({},function(Z,me){Hr(W,me,Z)})}function zo(I,W,Z){Z=Math.min(I.i.length,Z);var me=I.l?N(I.l.Na,I.l,I):null;e:{var Ke=I.i;let at=-1;for(;;){const Mt=["count="+Z];at==-1?0<Z?(at=Ke[0].g,Mt.push("ofs="+at)):at=0:Mt.push("ofs="+at);let $r=!0;for(let ai=0;ai<Z;ai++){let vr=Ke[ai].g;const Ks=Ke[ai].map;if(vr-=at,0>vr)at=Math.max(0,Ke[ai].g-100),$r=!1;else try{dp(Ks,Mt,"req"+vr+"_")}catch{me&&me(Ks)}}if($r){me=Mt.join("&");break e}}}return I=I.i.splice(0,Z),W.D=I,me}function $l(I){if(!I.g&&!I.u){I.Y=1;var W=I.Fa;we||Ne(),Ce||(we(),Ce=!0),ve.add(W,I),I.v=0}}function $f(I){return I.g||I.u||3<=I.v?!1:(I.Y++,I.u=qa(N(I.Fa,I),zu(I,I.v)),I.v++,!0)}n.Fa=function(){if(this.u=null,BE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var I=2*this.R;this.j.info("BP detection timer enabled: "+I),this.A=qa(N(this.ab,this),I)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ui(10),fl(this),BE(this))};function Dg(I){I.A!=null&&(E.clearTimeout(I.A),I.A=null)}function BE(I){I.g=new ya(I,I.j,"rpc",I.Y),I.m===null&&(I.g.H=I.o),I.g.O=0;var W=xo(I.qa);Hr(W,"RID","rpc"),Hr(W,"SID",I.K),Hr(W,"AID",I.T),Hr(W,"CI",I.F?"0":"1"),!I.F&&I.ja&&Hr(W,"TO",I.ja),Hr(W,"TYPE","xmlhttp"),Wu(I,W),I.m&&I.o&&Se(W,I.m,I.o),I.L&&(I.g.I=I.L);var Z=I.g;I=I.ia,Z.L=1,Z.v=Ja(xo(W)),Z.m=null,Z.P=!0,Uu(Z,I)}n.Za=function(){this.C!=null&&(this.C=null,fl(this),$f(this),Ui(19))};function Kf(I){I.C!=null&&(E.clearTimeout(I.C),I.C=null)}function qf(I,W){var Z=null;if(I.g==W){Kf(I),Dg(I),I.g=null;var me=2}else if(no(I.h,W))Z=W.D,ul(I.h,W),me=1;else return;if(I.G!=0){if(W.o)if(me==1){Z=W.m?W.m.length:0,W=Date.now()-W.F;var Ke=I.B;me=to(),cn(me,new gs(me,Z)),bc(I)}else $l(I);else if(Ke=W.s,Ke==3||Ke==0&&0<W.X||!(me==1&&Ng(I,W)||me==2&&$f(I)))switch(Z&&0<Z.length&&(W=I.h,W.i=W.i.concat(Z)),Ke){case 1:Gu(I,5);break;case 4:Gu(I,10);break;case 3:Gu(I,6);break;default:Gu(I,2)}}}function zu(I,W){let Z=I.Ta+Math.floor(Math.random()*I.cb);return I.isActive()||(Z*=2),Z*W}function Gu(I,W){if(I.j.info("Error code "+W),W==2){var Z=N(I.fb,I),me=I.Xa;const Ke=!me;me=new Xa(me||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||Fu(me,"https"),Ja(me),Ke?zf(me.toString(),Z):Sc(me.toString(),Z)}else Ui(2);I.G=0,I.l&&I.l.sa(W),Hu(I),zd(I)}n.fb=function(I){I?(this.j.info("Successfully pinged google.com"),Ui(2)):(this.j.info("Failed to ping google.com"),Ui(1))};function Hu(I){if(I.G=0,I.ka=[],I.l){const W=jd(I.h);(W.length!=0||I.i.length!=0)&&(H(I.ka,W),H(I.ka,I.i),I.h.i.length=0,B(I.i),I.i.length=0),I.l.ra()}}function Lg(I,W,Z){var me=Z instanceof Xa?xo(Z):new Xa(Z);if(me.g!="")W&&(me.g=W+"."+me.g),dl(me,me.s);else{var Ke=E.location;me=Ke.protocol,W=W?W+"."+Ke.hostname:Ke.hostname,Ke=+Ke.port;var at=new Xa(null);me&&Fu(at,me),W&&(at.g=W),Ke&&dl(at,Ke),Z&&(at.l=Z),me=at}return Z=I.D,W=I.ya,Z&&W&&Hr(me,Z,W),Hr(me,"VER",I.la),Wu(I,me),me}function WE(I,W,Z){if(W&&!I.J)throw Error("Can't create secondary domain capable XhrIo object.");return W=I.Ca&&!I.pa?new De(new hl({eb:Z})):new De(I.pa),W.Ha(I.J),W}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Vn(){}n=Vn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Yf(){}Yf.prototype.g=function(I,W){return new Go(I,W)};function Go(I,W){xn.call(this),this.g=new Bu(W),this.l=I,this.h=W&&W.messageUrlParams||null,I=W&&W.messageHeaders||null,W&&W.clientProtocolHeaderRequired&&(I?I["X-Client-Protocol"]="webchannel":I={"X-Client-Protocol":"webchannel"}),this.g.o=I,I=W&&W.initMessageHeaders||null,W&&W.messageContentType&&(I?I["X-WebChannel-Content-Type"]=W.messageContentType:I={"X-WebChannel-Content-Type":W.messageContentType}),W&&W.va&&(I?I["X-WebChannel-Client-Profile"]=W.va:I={"X-WebChannel-Client-Profile":W.va}),this.g.S=I,(I=W&&W.Sb)&&!$(I)&&(this.g.m=I),this.v=W&&W.supportsCrossDomainXhr||!1,this.u=W&&W.sendRawJson||!1,(W=W&&W.httpSessionIdParam)&&!$(W)&&(this.g.D=W,I=this.h,I!==null&&W in I&&(I=this.h,W in I&&delete I[W])),this.j=new Tc(this)}j(Go,xn),Go.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Go.prototype.close=function(){Xi(this.g)},Go.prototype.o=function(I){var W=this.g;if(typeof I=="string"){var Z={};Z.__data__=I,I=Z}else this.u&&(Z={},Z.__data__=Zr(I),I=Z);W.i.push(new Fd(W.Ya++,I)),W.G==3&&bc(W)},Go.prototype.N=function(){this.g.l=null,delete this.j,Xi(this.g),delete this.g,Go.aa.N.call(this)};function zE(I){fa.call(this),I.__headers__&&(this.headers=I.__headers__,this.statusCode=I.__status__,delete I.__headers__,delete I.__status__);var W=I.__sm__;if(W){e:{for(const Z in W){I=Z;break e}I=void 0}(this.i=I)&&(I=this.i,W=W!==null&&I in W?W[I]:void 0),this.data=W}else this.data=I}j(zE,fa);function GE(){_o.call(this),this.status=1}j(GE,_o);function Tc(I){this.g=I}j(Tc,Vn),Tc.prototype.ua=function(){cn(this.g,"a")},Tc.prototype.ta=function(I){cn(this.g,new zE(I))},Tc.prototype.sa=function(I){cn(this.g,new GE)},Tc.prototype.ra=function(){cn(this.g,"b")},Yf.prototype.createWebChannel=Yf.prototype.g,Go.prototype.send=Go.prototype.o,Go.prototype.open=Go.prototype.m,Go.prototype.close=Go.prototype.close,lre=function(){return new Yf},cre=function(){return to()},are=ma,JU={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},xu.NO_ERROR=0,xu.TIMEOUT=8,xu.HTTP_ERROR=6,HO=xu,op.COMPLETE="complete",ore=op,_c.EventType=is,is.OPEN="a",is.CLOSE="b",is.ERROR="c",is.MESSAGE="d",xn.prototype.listen=xn.prototype.K,Dw=_c,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,sre=De}).apply(typeof fO<"u"?fO:typeof self<"u"?self:typeof window<"u"?window:{});const zY="@firebase/firestore",GY="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Wa.UNAUTHENTICATED=new Wa(null),Wa.GOOGLE_CREDENTIALS=new Wa("google-credentials-uid"),Wa.FIRST_PARTY=new Wa("first-party-uid"),Wa.MOCK_USER=new Wa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let N0="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PE=new ij("@firebase/firestore");function dS(){return PE.logLevel}function Qt(n,...t){if(PE.logLevel<=Tr.DEBUG){const s=t.map(mj);PE.debug(`Firestore (${N0}): ${n}`,...s)}}function Lf(n,...t){if(PE.logLevel<=Tr.ERROR){const s=t.map(mj);PE.error(`Firestore (${N0}): ${n}`,...s)}}function d0(n,...t){if(PE.logLevel<=Tr.WARN){const s=t.map(mj);PE.warn(`Firestore (${N0}): ${n}`,...s)}}function mj(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wn(n="Unexpected state"){const t=`FIRESTORE (${N0}) INTERNAL ASSERTION FAILED: `+n;throw Lf(t),new Error(t)}function oi(n,t){n||Wn()}function Jn(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class sn extends ip{constructor(t,s){super(t,s),this.code=t,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ure{constructor(t,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class CFe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,s){t.enqueueRetryable(()=>s(Wa.UNAUTHENTICATED))}shutdown(){}}class IFe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,s){this.changeListener=s,t.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class AFe{constructor(t){this.t=t,this.currentUser=Wa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,s){oi(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,s(v)):Promise.resolve();let d=new Cf;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Cf,t.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const v=d;t.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},E=v=>{Qt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(v=>E(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?E(v):(Qt("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Cf)}},0),f()}getToken(){const t=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(a=>this.i!==t?(Qt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(oi(typeof a.accessToken=="string"),new ure(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return oi(t===null||typeof t=="string"),new Wa(t)}}class PFe{constructor(t,s,a){this.l=t,this.h=s,this.P=a,this.type="FirstParty",this.user=Wa.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class OFe{constructor(t,s,a){this.l=t,this.h=s,this.P=a}getToken(){return Promise.resolve(new PFe(this.l,this.h,this.P))}start(t,s){t.enqueueRetryable(()=>s(Wa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class HY{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class kFe{constructor(t,s){this.A=s,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,kl(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,s){oi(this.o===void 0);const a=d=>{d.error!=null&&Qt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const f=d.token!==this.R;return this.R=d.token,Qt("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?s(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{Qt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):Qt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new HY(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(s=>s?(oi(typeof s.token=="string"),this.R=s.token,new HY(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NFe(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(s);else for(let a=0;a<n;a++)s[a]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dre(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hre{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=NFe(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<s&&(a+=t.charAt(l[d]%62))}return a}}function pr(n,t){return n<t?-1:n>t?1:0}function QU(n,t){let s=0;for(;s<n.length&&s<t.length;){const a=n.codePointAt(s),l=t.codePointAt(s);if(a!==l){if(a<128&&l<128)return pr(a,l);{const d=dre(),f=DFe(d.encode($Y(n,s)),d.encode($Y(t,s)));return f!==0?f:pr(a,l)}}s+=a>65535?2:1}return pr(n.length,t.length)}function $Y(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function DFe(n,t){for(let s=0;s<n.length&&s<t.length;++s)if(n[s]!==t[s])return pr(n[s],t[s]);return pr(n.length,t.length)}function h0(n,t,s){return n.length===t.length&&n.every((a,l)=>s(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KY=-62135596800,qY=1e6;class fo{static now(){return fo.fromMillis(Date.now())}static fromDate(t){return fo.fromMillis(t.getTime())}static fromMillis(t){const s=Math.floor(t/1e3),a=Math.floor((t-1e3*s)*qY);return new fo(s,a)}constructor(t,s){if(this.seconds=t,this.nanoseconds=s,s<0)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(t<KY)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/qY}_compareTo(t){return this.seconds===t.seconds?pr(this.nanoseconds,t.nanoseconds):pr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-KY;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{static fromTimestamp(t){return new Kn(t)}static min(){return new Kn(new fo(0,0))}static max(){return new Kn(new fo(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YY="__name__";class kh{constructor(t,s,a){s===void 0?s=0:s>t.length&&Wn(),a===void 0?a=t.length-s:a>t.length-s&&Wn(),this.segments=t,this.offset=s,this.len=a}get length(){return this.len}isEqual(t){return kh.comparator(this,t)===0}child(t){const s=this.segments.slice(this.offset,this.limit());return t instanceof kh?t.forEach(a=>{s.push(a)}):s.push(t),this.construct(s)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}forEach(t){for(let s=this.offset,a=this.limit();s<a;s++)t(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,s){const a=Math.min(t.length,s.length);for(let l=0;l<a;l++){const d=kh.compareSegments(t.get(l),s.get(l));if(d!==0)return d}return pr(t.length,s.length)}static compareSegments(t,s){const a=kh.isNumericId(t),l=kh.isNumericId(s);return a&&!l?-1:!a&&l?1:a&&l?kh.extractNumericId(t).compare(kh.extractNumericId(s)):QU(t,s)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ug.fromString(t.substring(4,t.length-2))}}class Ki extends kh{construct(t,s,a){return new Ki(t,s,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const s=[];for(const a of t){if(a.indexOf("//")>=0)throw new sn(Tt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);s.push(...a.split("/").filter(l=>l.length>0))}return new Ki(s)}static emptyPath(){return new Ki([])}}const LFe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class aa extends kh{construct(t,s,a){return new aa(t,s,a)}static isValidIdentifier(t){return LFe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),aa.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===YY}static keyField(){return new aa([YY])}static fromServerFormat(t){const s=[];let a="",l=0;const d=()=>{if(a.length===0)throw new sn(Tt.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(a),a=""};let f=!1;for(;l<t.length;){const E=t[l];if(E==="\\"){if(l+1===t.length)throw new sn(Tt.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const v=t[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new sn(Tt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=v,l+=2}else E==="`"?(f=!f,l++):E!=="."||f?(a+=E,l++):(d(),l++)}if(d(),f)throw new sn(Tt.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new aa(s)}static emptyPath(){return new aa([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(t){this.path=t}static fromPath(t){return new Sn(Ki.fromString(t))}static fromName(t){return new Sn(Ki.fromString(t).popFirst(5))}static empty(){return new Sn(Ki.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Ki.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,s){return Ki.comparator(t.path,s.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Sn(new Ki(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CR=-1;function xFe(n,t){const s=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=Kn.fromTimestamp(a===1e9?new fo(s+1,0):new fo(s,a));return new yg(l,Sn.empty(),t)}function MFe(n){return new yg(n.readTime,n.key,CR)}class yg{constructor(t,s,a){this.readTime=t,this.documentKey=s,this.largestBatchId=a}static min(){return new yg(Kn.min(),Sn.empty(),CR)}static max(){return new yg(Kn.max(),Sn.empty(),CR)}}function UFe(n,t){let s=n.readTime.compareTo(t.readTime);return s!==0?s:(s=Sn.comparator(n.documentKey,t.documentKey),s!==0?s:pr(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VFe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class FFe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D0(n){if(n.code!==Tt.FAILED_PRECONDITION||n.message!==VFe)throw n;Qt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(t){return this.next(void 0,t)}next(t,s){return this.callbackAttached&&Wn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(t,this.result):new bt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(s,d).next(a,l)}})}toPromise(){return new Promise((t,s)=>{this.next(t,s)})}wrapUserFunction(t){try{const s=t();return s instanceof bt?s:bt.resolve(s)}catch(s){return bt.reject(s)}}wrapSuccess(t,s){return t?this.wrapUserFunction(()=>t(s)):bt.resolve(s)}wrapFailure(t,s){return t?this.wrapUserFunction(()=>t(s)):bt.reject(s)}static resolve(t){return new bt((s,a)=>{s(t)})}static reject(t){return new bt((s,a)=>{a(t)})}static waitFor(t){return new bt((s,a)=>{let l=0,d=0,f=!1;t.forEach(E=>{++l,E.next(()=>{++d,f&&d===l&&s()},v=>a(v))}),f=!0,d===l&&s()})}static or(t){let s=bt.resolve(!1);for(const a of t)s=s.next(l=>l?bt.resolve(l):a());return s}static forEach(t,s){const a=[];return t.forEach((l,d)=>{a.push(s.call(this,l,d))}),this.waitFor(a)}static mapArray(t,s){return new bt((a,l)=>{const d=t.length,f=new Array(d);let E=0;for(let v=0;v<d;v++){const b=v;s(t[b]).next(w=>{f[b]=w,++E,E===d&&a(f)},w=>l(w))}})}static doWhile(t,s){return new bt((a,l)=>{const d=()=>{t()===!0?s().next(()=>{d()},l):a()};d()})}}function jFe(n){const t=n.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function L0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T1{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=a=>this.oe(a),this._e=a=>s.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}T1.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gj=-1;function w1(n){return n==null}function Ck(n){return n===0&&1/n==-1/0}function BFe(n){return typeof n=="number"&&Number.isInteger(n)&&!Ck(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pre="";function WFe(n){let t="";for(let s=0;s<n.length;s++)t.length>0&&(t=XY(t)),t=zFe(n.get(s),t);return XY(t)}function zFe(n,t){let s=t;const a=n.length;for(let l=0;l<a;l++){const d=n.charAt(l);switch(d){case"\0":s+="";break;case pre:s+="";break;default:s+=d}}return s}function XY(n){return n+pre+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JY(n){let t=0;for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t++;return t}function Pg(n,t){for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t(s,n[s])}function fre(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(t,s){this.comparator=t,this.root=s||sa.EMPTY}insert(t,s){return new ps(this.comparator,this.root.insert(t,s,this.comparator).copy(null,null,sa.BLACK,null,null))}remove(t){return new ps(this.comparator,this.root.remove(t,this.comparator).copy(null,null,sa.BLACK,null,null))}get(t){let s=this.root;for(;!s.isEmpty();){const a=this.comparator(t,s.key);if(a===0)return s.value;a<0?s=s.left:a>0&&(s=s.right)}return null}indexOf(t){let s=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return s+a.left.size;l<0?a=a.left:(s+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((s,a)=>(t(s,a),!1))}toString(){const t=[];return this.inorderTraversal((s,a)=>(t.push(`${s}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new mO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new mO(this.root,t,this.comparator,!1)}getReverseIterator(){return new mO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new mO(this.root,t,this.comparator,!0)}}class mO{constructor(t,s,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=s?a(t.key,s):1,s&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const s={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class sa{constructor(t,s,a,l,d){this.key=t,this.value=s,this.color=a??sa.RED,this.left=l??sa.EMPTY,this.right=d??sa.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,s,a,l,d){return new sa(t??this.key,s??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,s,a),null):d===0?l.copy(null,s,null,null,null):l.copy(null,null,null,null,l.right.insert(t,s,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return sa.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,s){let a,l=this;if(s(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,s),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),s(t,l.key)===0){if(l.right.isEmpty())return sa.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,s))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,sa.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,sa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Wn();const t=this.left.check();if(t!==this.right.check())throw Wn();return t+(this.isRed()?0:1)}}sa.EMPTY=null,sa.RED=!0,sa.BLACK=!1;sa.EMPTY=new class{constructor(){this.size=0}get key(){throw Wn()}get value(){throw Wn()}get color(){throw Wn()}get left(){throw Wn()}get right(){throw Wn()}copy(t,s,a,l,d){return this}insert(t,s,a){return new sa(t,s)}remove(t,s){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(t){this.comparator=t,this.data=new ps(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((s,a)=>(t(s),!1))}forEachInRange(t,s){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;s(l.key)}}forEachWhile(t,s){let a;for(a=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const s=this.data.getIteratorFrom(t);return s.hasNext()?s.getNext().key:null}getIterator(){return new QY(this.data.getIterator())}getIteratorFrom(t){return new QY(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let s=this;return s.size<t.size&&(s=t,t=this),t.forEach(a=>{s=s.add(a)}),s}isEqual(t){if(!(t instanceof mo)||this.size!==t.size)return!1;const s=this.data.getIterator(),a=t.data.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(s=>{t.push(s)}),t}toString(){const t=[];return this.forEach(s=>t.push(s)),"SortedSet("+t.toString()+")"}copy(t){const s=new mo(this.comparator);return s.data=t,s}}class QY{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl{constructor(t){this.fields=t,t.sort(aa.comparator)}static empty(){return new Nl([])}unionWith(t){let s=new mo(aa.comparator);for(const a of this.fields)s=s.add(a);for(const a of t)s=s.add(a);return new Nl(s.toArray())}covers(t){for(const s of this.fields)if(s.isPrefixOf(t))return!0;return!1}isEqual(t){return h0(this.fields,t.fields,(s,a)=>s.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mre extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(t){this.binaryString=t}static fromBase64String(t){const s=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new mre("Invalid base64 string: "+d):d}}(t);return new ha(s)}static fromUint8Array(t){const s=function(l){let d="";for(let f=0;f<l.length;++f)d+=String.fromCharCode(l[f]);return d}(t);return new ha(s)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return pr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ha.EMPTY_BYTE_STRING=new ha("");const GFe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vg(n){if(oi(!!n),typeof n=="string"){let t=0;const s=GFe.exec(n);if(oi(!!s),s[1]){let l=s[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:Ws(n.seconds),nanos:Ws(n.nanos)}}function Ws(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Sg(n){return typeof n=="string"?ha.fromBase64String(n):ha.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gre="server_timestamp",_re="__type__",Ere="__previous_value__",yre="__local_write_time__";function _j(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[_re])===null||s===void 0?void 0:s.stringValue)===gre}function R1(n){const t=n.mapValue.fields[Ere];return _j(t)?R1(t):t}function IR(n){const t=vg(n.mapValue.fields[yre].timestampValue);return new fo(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HFe{constructor(t,s,a,l,d,f,E,v,b){this.databaseId=t,this.appId=s,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=f,this.autoDetectLongPolling=E,this.longPollingOptions=v,this.useFetchStreams=b}}const Ik="(default)";class AR{constructor(t,s){this.projectId=t,this.database=s||Ik}static empty(){return new AR("","")}get isDefaultDatabase(){return this.database===Ik}isEqual(t){return t instanceof AR&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vre="__type__",$Fe="__max__",gO={mapValue:{}},Sre="__vector__",Ak="value";function bg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?_j(n)?4:qFe(n)?9007199254740991:KFe(n)?10:11:Wn()}function ep(n,t){if(n===t)return!0;const s=bg(n);if(s!==bg(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return IR(n).isEqual(IR(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const f=vg(l.timestampValue),E=vg(d.timestampValue);return f.seconds===E.seconds&&f.nanos===E.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(l,d){return Sg(l.bytesValue).isEqual(Sg(d.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(l,d){return Ws(l.geoPointValue.latitude)===Ws(d.geoPointValue.latitude)&&Ws(l.geoPointValue.longitude)===Ws(d.geoPointValue.longitude)}(n,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return Ws(l.integerValue)===Ws(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const f=Ws(l.doubleValue),E=Ws(d.doubleValue);return f===E?Ck(f)===Ck(E):isNaN(f)&&isNaN(E)}return!1}(n,t);case 9:return h0(n.arrayValue.values||[],t.arrayValue.values||[],ep);case 10:case 11:return function(l,d){const f=l.mapValue.fields||{},E=d.mapValue.fields||{};if(JY(f)!==JY(E))return!1;for(const v in f)if(f.hasOwnProperty(v)&&(E[v]===void 0||!ep(f[v],E[v])))return!1;return!0}(n,t);default:return Wn()}}function PR(n,t){return(n.values||[]).find(s=>ep(s,t))!==void 0}function p0(n,t){if(n===t)return 0;const s=bg(n),a=bg(t);if(s!==a)return pr(s,a);switch(s){case 0:case 9007199254740991:return 0;case 1:return pr(n.booleanValue,t.booleanValue);case 2:return function(d,f){const E=Ws(d.integerValue||d.doubleValue),v=Ws(f.integerValue||f.doubleValue);return E<v?-1:E>v?1:E===v?0:isNaN(E)?isNaN(v)?0:-1:1}(n,t);case 3:return ZY(n.timestampValue,t.timestampValue);case 4:return ZY(IR(n),IR(t));case 5:return QU(n.stringValue,t.stringValue);case 6:return function(d,f){const E=Sg(d),v=Sg(f);return E.compareTo(v)}(n.bytesValue,t.bytesValue);case 7:return function(d,f){const E=d.split("/"),v=f.split("/");for(let b=0;b<E.length&&b<v.length;b++){const w=pr(E[b],v[b]);if(w!==0)return w}return pr(E.length,v.length)}(n.referenceValue,t.referenceValue);case 8:return function(d,f){const E=pr(Ws(d.latitude),Ws(f.latitude));return E!==0?E:pr(Ws(d.longitude),Ws(f.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return eX(n.arrayValue,t.arrayValue);case 10:return function(d,f){var E,v,b,w;const A=d.fields||{},N=f.fields||{},V=(E=A[Ak])===null||E===void 0?void 0:E.arrayValue,j=(v=N[Ak])===null||v===void 0?void 0:v.arrayValue,B=pr(((b=V==null?void 0:V.values)===null||b===void 0?void 0:b.length)||0,((w=j==null?void 0:j.values)===null||w===void 0?void 0:w.length)||0);return B!==0?B:eX(V,j)}(n.mapValue,t.mapValue);case 11:return function(d,f){if(d===gO.mapValue&&f===gO.mapValue)return 0;if(d===gO.mapValue)return 1;if(f===gO.mapValue)return-1;const E=d.fields||{},v=Object.keys(E),b=f.fields||{},w=Object.keys(b);v.sort(),w.sort();for(let A=0;A<v.length&&A<w.length;++A){const N=QU(v[A],w[A]);if(N!==0)return N;const V=p0(E[v[A]],b[w[A]]);if(V!==0)return V}return pr(v.length,w.length)}(n.mapValue,t.mapValue);default:throw Wn()}}function ZY(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return pr(n,t);const s=vg(n),a=vg(t),l=pr(s.seconds,a.seconds);return l!==0?l:pr(s.nanos,a.nanos)}function eX(n,t){const s=n.values||[],a=t.values||[];for(let l=0;l<s.length&&l<a.length;++l){const d=p0(s[l],a[l]);if(d)return d}return pr(s.length,a.length)}function f0(n){return ZU(n)}function ZU(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(s){const a=vg(s);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(s){return Sg(s).toBase64()}(n.bytesValue):"referenceValue"in n?function(s){return Sn.fromName(s).toString()}(n.referenceValue):"geoPointValue"in n?function(s){return`geo(${s.latitude},${s.longitude})`}(n.geoPointValue):"arrayValue"in n?function(s){let a="[",l=!0;for(const d of s.values||[])l?l=!1:a+=",",a+=ZU(d);return a+"]"}(n.arrayValue):"mapValue"in n?function(s){const a=Object.keys(s.fields||{}).sort();let l="{",d=!0;for(const f of a)d?d=!1:l+=",",l+=`${f}:${ZU(s.fields[f])}`;return l+"}"}(n.mapValue):Wn()}function $O(n){switch(bg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=R1(n);return t?16+$O(t):16;case 5:return 2*n.stringValue.length;case 6:return Sg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+$O(d),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return Pg(a.fields,(d,f)=>{l+=d.length+$O(f)}),l}(n.mapValue);default:throw Wn()}}function tX(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function eV(n){return!!n&&"integerValue"in n}function Ej(n){return!!n&&"arrayValue"in n}function nX(n){return!!n&&"nullValue"in n}function rX(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function KO(n){return!!n&&"mapValue"in n}function KFe(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[vre])===null||s===void 0?void 0:s.stringValue)===Sre}function Qw(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return Pg(n.mapValue.fields,(s,a)=>t.mapValue.fields[s]=Qw(a)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(n.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=Qw(n.arrayValue.values[s]);return t}return Object.assign({},n)}function qFe(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===$Fe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc{constructor(t){this.value=t}static empty(){return new Zc({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let s=this.value;for(let a=0;a<t.length-1;++a)if(s=(s.mapValue.fields||{})[t.get(a)],!KO(s))return null;return s=(s.mapValue.fields||{})[t.lastSegment()],s||null}}set(t,s){this.getFieldsMap(t.popLast())[t.lastSegment()]=Qw(s)}setAll(t){let s=aa.emptyPath(),a={},l=[];t.forEach((f,E)=>{if(!s.isImmediateParentOf(E)){const v=this.getFieldsMap(s);this.applyChanges(v,a,l),a={},l=[],s=E.popLast()}f?a[E.lastSegment()]=Qw(f):l.push(E.lastSegment())});const d=this.getFieldsMap(s);this.applyChanges(d,a,l)}delete(t){const s=this.field(t.popLast());KO(s)&&s.mapValue.fields&&delete s.mapValue.fields[t.lastSegment()]}isEqual(t){return ep(this.value,t.value)}getFieldsMap(t){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=s.mapValue.fields[t.get(a)];KO(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},s.mapValue.fields[t.get(a)]=l),s=l}return s.mapValue.fields}applyChanges(t,s,a){Pg(s,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new Zc(Qw(this.value))}}function bre(n){const t=[];return Pg(n.fields,(s,a)=>{const l=new aa([s]);if(KO(a)){const d=bre(a.mapValue).fields;if(d.length===0)t.push(l);else for(const f of d)t.push(l.child(f))}else t.push(l)}),new Nl(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class za{constructor(t,s,a,l,d,f,E){this.key=t,this.documentType=s,this.version=a,this.readTime=l,this.createTime=d,this.data=f,this.documentState=E}static newInvalidDocument(t){return new za(t,0,Kn.min(),Kn.min(),Kn.min(),Zc.empty(),0)}static newFoundDocument(t,s,a,l){return new za(t,1,s,Kn.min(),a,l,0)}static newNoDocument(t,s){return new za(t,2,s,Kn.min(),Kn.min(),Zc.empty(),0)}static newUnknownDocument(t,s){return new za(t,3,s,Kn.min(),Kn.min(),Zc.empty(),2)}convertToFoundDocument(t,s){return!this.createTime.isEqual(Kn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Zc.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Zc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Kn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof za&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new za(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pk{constructor(t,s){this.position=t,this.inclusive=s}}function iX(n,t,s){let a=0;for(let l=0;l<n.position.length;l++){const d=t[l],f=n.position[l];if(d.field.isKeyField()?a=Sn.comparator(Sn.fromName(f.referenceValue),s.key):a=p0(f,s.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function sX(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let s=0;s<n.position.length;s++)if(!ep(n.position[s],t.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ok{constructor(t,s="asc"){this.field=t,this.dir=s}}function YFe(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tre{}class eo extends Tre{constructor(t,s,a){super(),this.field=t,this.op=s,this.value=a}static create(t,s,a){return t.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(t,s,a):new JFe(t,s,a):s==="array-contains"?new eje(t,a):s==="in"?new tje(t,a):s==="not-in"?new nje(t,a):s==="array-contains-any"?new rje(t,a):new eo(t,s,a)}static createKeyFieldInFilter(t,s,a){return s==="in"?new QFe(t,a):new ZFe(t,a)}matches(t){const s=t.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(p0(s,this.value)):s!==null&&bg(this.value)===bg(s)&&this.matchesComparison(p0(s,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Wn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class kd extends Tre{constructor(t,s){super(),this.filters=t,this.op=s,this.ce=null}static create(t,s){return new kd(t,s)}matches(t){return wre(this)?this.filters.find(s=>!s.matches(t))===void 0:this.filters.find(s=>s.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,s)=>t.concat(s.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function wre(n){return n.op==="and"}function Rre(n){return XFe(n)&&wre(n)}function XFe(n){for(const t of n.filters)if(t instanceof kd)return!1;return!0}function tV(n){if(n instanceof eo)return n.field.canonicalString()+n.op.toString()+f0(n.value);if(Rre(n))return n.filters.map(t=>tV(t)).join(",");{const t=n.filters.map(s=>tV(s)).join(",");return`${n.op}(${t})`}}function Cre(n,t){return n instanceof eo?function(a,l){return l instanceof eo&&a.op===l.op&&a.field.isEqual(l.field)&&ep(a.value,l.value)}(n,t):n instanceof kd?function(a,l){return l instanceof kd&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,f,E)=>d&&Cre(f,l.filters[E]),!0):!1}(n,t):void Wn()}function Ire(n){return n instanceof eo?function(s){return`${s.field.canonicalString()} ${s.op} ${f0(s.value)}`}(n):n instanceof kd?function(s){return s.op.toString()+" {"+s.getFilters().map(Ire).join(" ,")+"}"}(n):"Filter"}class JFe extends eo{constructor(t,s,a){super(t,s,a),this.key=Sn.fromName(a.referenceValue)}matches(t){const s=Sn.comparator(t.key,this.key);return this.matchesComparison(s)}}class QFe extends eo{constructor(t,s){super(t,"in",s),this.keys=Are("in",s)}matches(t){return this.keys.some(s=>s.isEqual(t.key))}}class ZFe extends eo{constructor(t,s){super(t,"not-in",s),this.keys=Are("not-in",s)}matches(t){return!this.keys.some(s=>s.isEqual(t.key))}}function Are(n,t){var s;return(((s=t.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(a=>Sn.fromName(a.referenceValue))}class eje extends eo{constructor(t,s){super(t,"array-contains",s)}matches(t){const s=t.data.field(this.field);return Ej(s)&&PR(s.arrayValue,this.value)}}class tje extends eo{constructor(t,s){super(t,"in",s)}matches(t){const s=t.data.field(this.field);return s!==null&&PR(this.value.arrayValue,s)}}class nje extends eo{constructor(t,s){super(t,"not-in",s)}matches(t){if(PR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=t.data.field(this.field);return s!==null&&!PR(this.value.arrayValue,s)}}class rje extends eo{constructor(t,s){super(t,"array-contains-any",s)}matches(t){const s=t.data.field(this.field);return!(!Ej(s)||!s.arrayValue.values)&&s.arrayValue.values.some(a=>PR(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ije{constructor(t,s=null,a=[],l=[],d=null,f=null,E=null){this.path=t,this.collectionGroup=s,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=f,this.endAt=E,this.le=null}}function oX(n,t=null,s=[],a=[],l=null,d=null,f=null){return new ije(n,t,s,a,l,d,f)}function yj(n){const t=Jn(n);if(t.le===null){let s=t.path.canonicalString();t.collectionGroup!==null&&(s+="|cg:"+t.collectionGroup),s+="|f:",s+=t.filters.map(a=>tV(a)).join(","),s+="|ob:",s+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),w1(t.limit)||(s+="|l:",s+=t.limit),t.startAt&&(s+="|lb:",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(a=>f0(a)).join(",")),t.endAt&&(s+="|ub:",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(a=>f0(a)).join(",")),t.le=s}return t.le}function vj(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!YFe(n.orderBy[s],t.orderBy[s]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if(!Cre(n.filters[s],t.filters[s]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!sX(n.startAt,t.startAt)&&sX(n.endAt,t.endAt)}function nV(n){return Sn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eC{constructor(t,s=null,a=[],l=[],d=null,f="F",E=null,v=null){this.path=t,this.collectionGroup=s,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=f,this.startAt=E,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function sje(n,t,s,a,l,d,f,E){return new eC(n,t,s,a,l,d,f,E)}function Sj(n){return new eC(n)}function aX(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Pre(n){return n.collectionGroup!==null}function Zw(n){const t=Jn(n);if(t.he===null){t.he=[];const s=new Set;for(const d of t.explicitOrderBy)t.he.push(d),s.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(f){let E=new mo(aa.comparator);return f.filters.forEach(v=>{v.getFlattenedFilters().forEach(b=>{b.isInequality()&&(E=E.add(b.field))})}),E})(t).forEach(d=>{s.has(d.canonicalString())||d.isKeyField()||t.he.push(new Ok(d,a))}),s.has(aa.keyField().canonicalString())||t.he.push(new Ok(aa.keyField(),a))}return t.he}function Xh(n){const t=Jn(n);return t.Pe||(t.Pe=oje(t,Zw(n))),t.Pe}function oje(n,t){if(n.limitType==="F")return oX(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new Ok(l.field,d)});const s=n.endAt?new Pk(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new Pk(n.startAt.position,n.startAt.inclusive):null;return oX(n.path,n.collectionGroup,t,n.filters,n.limit,s,a)}}function rV(n,t){const s=n.filters.concat([t]);return new eC(n.path,n.collectionGroup,n.explicitOrderBy.slice(),s,n.limit,n.limitType,n.startAt,n.endAt)}function iV(n,t,s){return new eC(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,s,n.startAt,n.endAt)}function C1(n,t){return vj(Xh(n),Xh(t))&&n.limitType===t.limitType}function Ore(n){return`${yj(Xh(n))}|lt:${n.limitType}`}function hS(n){return`Query(target=${function(s){let a=s.path.canonicalString();return s.collectionGroup!==null&&(a+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(a+=`, filters: [${s.filters.map(l=>Ire(l)).join(", ")}]`),w1(s.limit)||(a+=", limit: "+s.limit),s.orderBy.length>0&&(a+=`, orderBy: [${s.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),s.startAt&&(a+=", startAt: ",a+=s.startAt.inclusive?"b:":"a:",a+=s.startAt.position.map(l=>f0(l)).join(",")),s.endAt&&(a+=", endAt: ",a+=s.endAt.inclusive?"a:":"b:",a+=s.endAt.position.map(l=>f0(l)).join(",")),`Target(${a})`}(Xh(n))}; limitType=${n.limitType})`}function I1(n,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):Sn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(n,t)&&function(a,l){for(const d of Zw(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(n,t)&&function(a,l){return!(a.startAt&&!function(f,E,v){const b=iX(f,E,v);return f.inclusive?b<=0:b<0}(a.startAt,Zw(a),l)||a.endAt&&!function(f,E,v){const b=iX(f,E,v);return f.inclusive?b>=0:b>0}(a.endAt,Zw(a),l))}(n,t)}function aje(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function kre(n){return(t,s)=>{let a=!1;for(const l of Zw(n)){const d=cje(l,t,s);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function cje(n,t,s){const a=n.field.isKeyField()?Sn.comparator(t.key,s.key):function(d,f,E){const v=f.data.field(d),b=E.data.field(d);return v!==null&&b!==null?p0(v,b):Wn()}(n.field,t,s);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return Wn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ME{constructor(t,s){this.mapKeyFn=t,this.equalsFn=s,this.inner={},this.innerSize=0}get(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,s){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,s]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,s]);l.push([t,s]),this.innerSize++}delete(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[s]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){Pg(this.inner,(s,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return fre(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lje=new ps(Sn.comparator);function xf(){return lje}const Nre=new ps(Sn.comparator);function Lw(...n){let t=Nre;for(const s of n)t=t.insert(s.key,s);return t}function Dre(n){let t=Nre;return n.forEach((s,a)=>t=t.insert(s,a.overlayedDocument)),t}function lE(){return eR()}function Lre(){return eR()}function eR(){return new ME(n=>n.toString(),(n,t)=>n.isEqual(t))}const uje=new ps(Sn.comparator),dje=new mo(Sn.comparator);function wr(...n){let t=dje;for(const s of n)t=t.add(s);return t}const hje=new mo(pr);function pje(){return hje}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bj(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ck(t)?"-0":t}}function xre(n){return{integerValue:""+n}}function fje(n,t){return BFe(t)?xre(t):bj(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1{constructor(){this._=void 0}}function mje(n,t,s){return n instanceof kk?function(l,d){const f={fields:{[_re]:{stringValue:gre},[yre]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&_j(d)&&(d=R1(d)),d&&(f.fields[Ere]=d),{mapValue:f}}(s,t):n instanceof m0?Ure(n,t):n instanceof g0?Vre(n,t):function(l,d){const f=Mre(l,d),E=cX(f)+cX(l.Ie);return eV(f)&&eV(l.Ie)?xre(E):bj(l.serializer,E)}(n,t)}function gje(n,t,s){return n instanceof m0?Ure(n,t):n instanceof g0?Vre(n,t):s}function Mre(n,t){return n instanceof Nk?function(a){return eV(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class kk extends A1{}class m0 extends A1{constructor(t){super(),this.elements=t}}function Ure(n,t){const s=Fre(t);for(const a of n.elements)s.some(l=>ep(l,a))||s.push(a);return{arrayValue:{values:s}}}class g0 extends A1{constructor(t){super(),this.elements=t}}function Vre(n,t){let s=Fre(t);for(const a of n.elements)s=s.filter(l=>!ep(l,a));return{arrayValue:{values:s}}}class Nk extends A1{constructor(t,s){super(),this.serializer=t,this.Ie=s}}function cX(n){return Ws(n.integerValue||n.doubleValue)}function Fre(n){return Ej(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jre{constructor(t,s){this.field=t,this.transform=s}}function _je(n,t){return n.field.isEqual(t.field)&&function(a,l){return a instanceof m0&&l instanceof m0||a instanceof g0&&l instanceof g0?h0(a.elements,l.elements,ep):a instanceof Nk&&l instanceof Nk?ep(a.Ie,l.Ie):a instanceof kk&&l instanceof kk}(n.transform,t.transform)}class Eje{constructor(t,s){this.version=t,this.transformResults=s}}class Pd{constructor(t,s){this.updateTime=t,this.exists=s}static none(){return new Pd}static exists(t){return new Pd(void 0,t)}static updateTime(t){return new Pd(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function qO(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class P1{}function Bre(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new zre(n.key,Pd.none()):new tC(n.key,n.data,Pd.none());{const s=n.data,a=Zc.empty();let l=new mo(aa.comparator);for(let d of t.fields)if(!l.has(d)){let f=s.field(d);f===null&&d.length>1&&(d=d.popLast(),f=s.field(d)),f===null?a.delete(d):a.set(d,f),l=l.add(d)}return new Og(n.key,a,new Nl(l.toArray()),Pd.none())}}function yje(n,t,s){n instanceof tC?function(l,d,f){const E=l.value.clone(),v=uX(l.fieldTransforms,d,f.transformResults);E.setAll(v),d.convertToFoundDocument(f.version,E).setHasCommittedMutations()}(n,t,s):n instanceof Og?function(l,d,f){if(!qO(l.precondition,d))return void d.convertToUnknownDocument(f.version);const E=uX(l.fieldTransforms,d,f.transformResults),v=d.data;v.setAll(Wre(l)),v.setAll(E),d.convertToFoundDocument(f.version,v).setHasCommittedMutations()}(n,t,s):function(l,d,f){d.convertToNoDocument(f.version).setHasCommittedMutations()}(0,t,s)}function tR(n,t,s,a){return n instanceof tC?function(d,f,E,v){if(!qO(d.precondition,f))return E;const b=d.value.clone(),w=dX(d.fieldTransforms,v,f);return b.setAll(w),f.convertToFoundDocument(f.version,b).setHasLocalMutations(),null}(n,t,s,a):n instanceof Og?function(d,f,E,v){if(!qO(d.precondition,f))return E;const b=dX(d.fieldTransforms,v,f),w=f.data;return w.setAll(Wre(d)),w.setAll(b),f.convertToFoundDocument(f.version,w).setHasLocalMutations(),E===null?null:E.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(A=>A.field))}(n,t,s,a):function(d,f,E){return qO(d.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):E}(n,t,s)}function vje(n,t){let s=null;for(const a of n.fieldTransforms){const l=t.data.field(a.field),d=Mre(a.transform,l||null);d!=null&&(s===null&&(s=Zc.empty()),s.set(a.field,d))}return s||null}function lX(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&h0(a,l,(d,f)=>_je(d,f))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class tC extends P1{constructor(t,s,a,l=[]){super(),this.key=t,this.value=s,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Og extends P1{constructor(t,s,a,l,d=[]){super(),this.key=t,this.data=s,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function Wre(n){const t=new Map;return n.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const a=n.data.field(s);t.set(s,a)}}),t}function uX(n,t,s){const a=new Map;oi(n.length===s.length);for(let l=0;l<s.length;l++){const d=n[l],f=d.transform,E=t.data.field(d.field);a.set(d.field,gje(f,E,s[l]))}return a}function dX(n,t,s){const a=new Map;for(const l of n){const d=l.transform,f=s.data.field(l.field);a.set(l.field,mje(d,f,t))}return a}class zre extends P1{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Sje extends P1{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bje{constructor(t,s,a,l){this.batchId=t,this.localWriteTime=s,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,s){const a=s.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&yje(d,t,a[l])}}applyToLocalView(t,s){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(s=tR(a,t,s,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(s=tR(a,t,s,this.localWriteTime));return s}applyToLocalDocumentSet(t,s){const a=Lre();return this.mutations.forEach(l=>{const d=t.get(l.key),f=d.overlayedDocument;let E=this.applyToLocalView(f,d.mutatedFields);E=s.has(l.key)?null:E;const v=Bre(f,E);v!==null&&a.set(l.key,v),f.isValidDocument()||f.convertToNoDocument(Kn.min())}),a}keys(){return this.mutations.reduce((t,s)=>t.add(s.key),wr())}isEqual(t){return this.batchId===t.batchId&&h0(this.mutations,t.mutations,(s,a)=>lX(s,a))&&h0(this.baseMutations,t.baseMutations,(s,a)=>lX(s,a))}}class Tj{constructor(t,s,a,l){this.batch=t,this.commitVersion=s,this.mutationResults=a,this.docVersions=l}static from(t,s,a){oi(t.mutations.length===a.length);let l=function(){return uje}();const d=t.mutations;for(let f=0;f<d.length;f++)l=l.insert(d[f].key,a[f].version);return new Tj(t,s,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tje{constructor(t,s){this.largestBatchId=t,this.mutation=s}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wje{constructor(t,s){this.count=t,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xs,Dr;function Rje(n){switch(n){case Tt.OK:return Wn();case Tt.CANCELLED:case Tt.UNKNOWN:case Tt.DEADLINE_EXCEEDED:case Tt.RESOURCE_EXHAUSTED:case Tt.INTERNAL:case Tt.UNAVAILABLE:case Tt.UNAUTHENTICATED:return!1;case Tt.INVALID_ARGUMENT:case Tt.NOT_FOUND:case Tt.ALREADY_EXISTS:case Tt.PERMISSION_DENIED:case Tt.FAILED_PRECONDITION:case Tt.ABORTED:case Tt.OUT_OF_RANGE:case Tt.UNIMPLEMENTED:case Tt.DATA_LOSS:return!0;default:return Wn()}}function Gre(n){if(n===void 0)return Lf("GRPC error has no .code"),Tt.UNKNOWN;switch(n){case Xs.OK:return Tt.OK;case Xs.CANCELLED:return Tt.CANCELLED;case Xs.UNKNOWN:return Tt.UNKNOWN;case Xs.DEADLINE_EXCEEDED:return Tt.DEADLINE_EXCEEDED;case Xs.RESOURCE_EXHAUSTED:return Tt.RESOURCE_EXHAUSTED;case Xs.INTERNAL:return Tt.INTERNAL;case Xs.UNAVAILABLE:return Tt.UNAVAILABLE;case Xs.UNAUTHENTICATED:return Tt.UNAUTHENTICATED;case Xs.INVALID_ARGUMENT:return Tt.INVALID_ARGUMENT;case Xs.NOT_FOUND:return Tt.NOT_FOUND;case Xs.ALREADY_EXISTS:return Tt.ALREADY_EXISTS;case Xs.PERMISSION_DENIED:return Tt.PERMISSION_DENIED;case Xs.FAILED_PRECONDITION:return Tt.FAILED_PRECONDITION;case Xs.ABORTED:return Tt.ABORTED;case Xs.OUT_OF_RANGE:return Tt.OUT_OF_RANGE;case Xs.UNIMPLEMENTED:return Tt.UNIMPLEMENTED;case Xs.DATA_LOSS:return Tt.DATA_LOSS;default:return Wn()}}(Dr=Xs||(Xs={}))[Dr.OK=0]="OK",Dr[Dr.CANCELLED=1]="CANCELLED",Dr[Dr.UNKNOWN=2]="UNKNOWN",Dr[Dr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Dr[Dr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Dr[Dr.NOT_FOUND=5]="NOT_FOUND",Dr[Dr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Dr[Dr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Dr[Dr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Dr[Dr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Dr[Dr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Dr[Dr.ABORTED=10]="ABORTED",Dr[Dr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Dr[Dr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Dr[Dr.INTERNAL=13]="INTERNAL",Dr[Dr.UNAVAILABLE=14]="UNAVAILABLE",Dr[Dr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cje=new ug([4294967295,4294967295],0);function hX(n){const t=dre().encode(n),s=new ire;return s.update(t),new Uint8Array(s.digest())}function pX(n){const t=new DataView(n.buffer),s=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new ug([s,a],0),new ug([l,d],0)]}class wj{constructor(t,s,a){if(this.bitmap=t,this.padding=s,this.hashCount=a,s<0||s>=8)throw new xw(`Invalid padding: ${s}`);if(a<0)throw new xw(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new xw(`Invalid hash count: ${a}`);if(t.length===0&&s!==0)throw new xw(`Invalid padding when bitmap length is 0: ${s}`);this.Ee=8*t.length-s,this.de=ug.fromNumber(this.Ee)}Ae(t,s,a){let l=t.add(s.multiply(ug.fromNumber(a)));return l.compare(Cje)===1&&(l=new ug([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const s=hX(t),[a,l]=pX(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);if(!this.Re(f))return!1}return!0}static create(t,s,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),f=new wj(d,l,s);return a.forEach(E=>f.insert(E)),f}insert(t){if(this.Ee===0)return;const s=hX(t),[a,l]=pX(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);this.Ve(f)}}Ve(t){const s=Math.floor(t/8),a=t%8;this.bitmap[s]|=1<<a}}class xw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(t,s,a,l,d){this.snapshotVersion=t,this.targetChanges=s,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,s,a){const l=new Map;return l.set(t,nC.createSynthesizedTargetChangeForCurrentChange(t,s,a)),new O1(Kn.min(),l,new ps(pr),xf(),wr())}}class nC{constructor(t,s,a,l,d){this.resumeToken=t,this.current=s,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,s,a){return new nC(a,s,wr(),wr(),wr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YO{constructor(t,s,a,l){this.me=t,this.removedTargetIds=s,this.key=a,this.fe=l}}class Hre{constructor(t,s){this.targetId=t,this.ge=s}}class $re{constructor(t,s,a=ha.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=s,this.resumeToken=a,this.cause=l}}class fX{constructor(){this.pe=0,this.ye=mX(),this.we=ha.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(t){t.approximateByteSize()>0&&(this.be=!0,this.we=t)}Fe(){let t=wr(),s=wr(),a=wr();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:s=s.add(l);break;case 1:a=a.add(l);break;default:Wn()}}),new nC(this.we,this.Se,t,s,a)}Me(){this.be=!1,this.ye=mX()}xe(t,s){this.be=!0,this.ye=this.ye.insert(t,s)}Oe(t){this.be=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,oi(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class Ije{constructor(t){this.ke=t,this.qe=new Map,this.Qe=xf(),this.$e=_O(),this.Ue=_O(),this.Ke=new ps(pr)}We(t){for(const s of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(s,t.fe):this.ze(s,t.key,t.fe);for(const s of t.removedTargetIds)this.ze(s,t.key,t.fe)}je(t){this.forEachTarget(t,s=>{const a=this.He(s);switch(t.state){case 0:this.Je(s)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(s);break;case 3:this.Je(s)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(s)&&(this.Ye(s),a.Ce(t.resumeToken));break;default:Wn()}})}forEachTarget(t,s){t.targetIds.length>0?t.targetIds.forEach(s):this.qe.forEach((a,l)=>{this.Je(l)&&s(l)})}Ze(t){const s=t.targetId,a=t.ge.count,l=this.Xe(s);if(l){const d=l.target;if(nV(d))if(a===0){const f=new Sn(d.path);this.ze(s,f,za.newNoDocument(f,Kn.min()))}else oi(a===1);else{const f=this.et(s);if(f!==a){const E=this.tt(t),v=E?this.nt(E,t,f):1;if(v!==0){this.Ye(s);const b=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(s,b)}}}}}tt(t){const s=t.ge.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=s;let f,E;try{f=Sg(a).toUint8Array()}catch(v){if(v instanceof mre)return d0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{E=new wj(f,l,d)}catch(v){return d0(v instanceof xw?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return E.Ee===0?null:E}nt(t,s,a){return s.ge.count===a-this.st(t,s.targetId)?0:2}st(t,s){const a=this.ke.getRemoteKeysForTarget(s);let l=0;return a.forEach(d=>{const f=this.ke.it(),E=`projects/${f.projectId}/databases/${f.database}/documents/${d.path.canonicalString()}`;t.mightContain(E)||(this.ze(s,d,null),l++)}),l}ot(t){const s=new Map;this.qe.forEach((d,f)=>{const E=this.Xe(f);if(E){if(d.current&&nV(E.target)){const v=new Sn(E.target.path);this._t(v).has(f)||this.ut(f,v)||this.ze(f,v,za.newNoDocument(v,t))}d.ve&&(s.set(f,d.Fe()),d.Me())}});let a=wr();this.Ue.forEach((d,f)=>{let E=!0;f.forEachWhile(v=>{const b=this.Xe(v);return!b||b.purpose==="TargetPurposeLimboResolution"||(E=!1,!1)}),E&&(a=a.add(d))}),this.Qe.forEach((d,f)=>f.setReadTime(t));const l=new O1(t,s,this.Ke,this.Qe,a);return this.Qe=xf(),this.$e=_O(),this.Ue=_O(),this.Ke=new ps(pr),l}Ge(t,s){if(!this.Je(t))return;const a=this.ut(t,s.key)?2:0;this.He(t).xe(s.key,a),this.Qe=this.Qe.insert(s.key,s),this.$e=this.$e.insert(s.key,this._t(s.key).add(t)),this.Ue=this.Ue.insert(s.key,this.ct(s.key).add(t))}ze(t,s,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,s)?l.xe(s,1):l.Oe(s),this.Ue=this.Ue.insert(s,this.ct(s).delete(t)),this.Ue=this.Ue.insert(s,this.ct(s).add(t)),a&&(this.Qe=this.Qe.insert(s,a))}removeTarget(t){this.qe.delete(t)}et(t){const s=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+s.addedDocuments.size-s.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let s=this.qe.get(t);return s||(s=new fX,this.qe.set(t,s)),s}ct(t){let s=this.Ue.get(t);return s||(s=new mo(pr),this.Ue=this.Ue.insert(t,s)),s}_t(t){let s=this.$e.get(t);return s||(s=new mo(pr),this.$e=this.$e.insert(t,s)),s}Je(t){const s=this.Xe(t)!==null;return s||Qt("WatchChangeAggregator","Detected inactive target",t),s}Xe(t){const s=this.qe.get(t);return s&&s.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new fX),this.ke.getRemoteKeysForTarget(t).forEach(s=>{this.ze(t,s,null)})}ut(t,s){return this.ke.getRemoteKeysForTarget(t).has(s)}}function _O(){return new ps(Sn.comparator)}function mX(){return new ps(Sn.comparator)}const Aje={asc:"ASCENDING",desc:"DESCENDING"},Pje={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Oje={and:"AND",or:"OR"};class kje{constructor(t,s){this.databaseId=t,this.useProto3Json=s}}function sV(n,t){return n.useProto3Json||w1(t)?t:{value:t}}function Dk(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Kre(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Nje(n,t){return Dk(n,t.toTimestamp())}function Jh(n){return oi(!!n),Kn.fromTimestamp(function(s){const a=vg(s);return new fo(a.seconds,a.nanos)}(n))}function Rj(n,t){return oV(n,t).canonicalString()}function oV(n,t){const s=function(l){return new Ki(["projects",l.projectId,"databases",l.database])}(n).child("documents");return t===void 0?s:s.child(t)}function qre(n){const t=Ki.fromString(n);return oi(Zre(t)),t}function aV(n,t){return Rj(n.databaseId,t.path)}function OM(n,t){const s=qre(t);if(s.get(1)!==n.databaseId.projectId)throw new sn(Tt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+n.databaseId.projectId);if(s.get(3)!==n.databaseId.database)throw new sn(Tt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+n.databaseId.database);return new Sn(Xre(s))}function Yre(n,t){return Rj(n.databaseId,t)}function Dje(n){const t=qre(n);return t.length===4?Ki.emptyPath():Xre(t)}function cV(n){return new Ki(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Xre(n){return oi(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function gX(n,t,s){return{name:aV(n,t),fields:s.value.mapValue.fields}}function Lje(n,t){let s;if("targetChange"in t){t.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Wn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(b,w){return b.useProto3Json?(oi(w===void 0||typeof w=="string"),ha.fromBase64String(w||"")):(oi(w===void 0||w instanceof Buffer||w instanceof Uint8Array),ha.fromUint8Array(w||new Uint8Array))}(n,t.targetChange.resumeToken),f=t.targetChange.cause,E=f&&function(b){const w=b.code===void 0?Tt.UNKNOWN:Gre(b.code);return new sn(w,b.message||"")}(f);s=new $re(a,l,d,E||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=OM(n,a.document.name),d=Jh(a.document.updateTime),f=a.document.createTime?Jh(a.document.createTime):Kn.min(),E=new Zc({mapValue:{fields:a.document.fields}}),v=za.newFoundDocument(l,d,f,E),b=a.targetIds||[],w=a.removedTargetIds||[];s=new YO(b,w,v.key,v)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=OM(n,a.document),d=a.readTime?Jh(a.readTime):Kn.min(),f=za.newNoDocument(l,d),E=a.removedTargetIds||[];s=new YO([],E,f.key,f)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=OM(n,a.document),d=a.removedTargetIds||[];s=new YO([],d,l,null)}else{if(!("filter"in t))return Wn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,f=new wje(l,d),E=a.targetId;s=new Hre(E,f)}}return s}function xje(n,t){let s;if(t instanceof tC)s={update:gX(n,t.key,t.value)};else if(t instanceof zre)s={delete:aV(n,t.key)};else if(t instanceof Og)s={update:gX(n,t.key,t.data),updateMask:Gje(t.fieldMask)};else{if(!(t instanceof Sje))return Wn();s={verify:aV(n,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(a=>function(d,f){const E=f.transform;if(E instanceof kk)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(E instanceof m0)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:E.elements}};if(E instanceof g0)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:E.elements}};if(E instanceof Nk)return{fieldPath:f.field.canonicalString(),increment:E.Ie};throw Wn()}(0,a))),t.precondition.isNone||(s.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:Nje(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Wn()}(n,t.precondition)),s}function Mje(n,t){return n&&n.length>0?(oi(t!==void 0),n.map(s=>function(l,d){let f=l.updateTime?Jh(l.updateTime):Jh(d);return f.isEqual(Kn.min())&&(f=Jh(d)),new Eje(f,l.transformResults||[])}(s,t))):[]}function Uje(n,t){return{documents:[Yre(n,t.path)]}}function Vje(n,t){const s={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=Yre(n,l);const d=function(b){if(b.length!==0)return Qre(kd.create(b,"and"))}(t.filters);d&&(s.structuredQuery.where=d);const f=function(b){if(b.length!==0)return b.map(w=>function(N){return{field:pS(N.field),direction:Bje(N.dir)}}(w))}(t.orderBy);f&&(s.structuredQuery.orderBy=f);const E=sV(n,t.limit);return E!==null&&(s.structuredQuery.limit=E),t.startAt&&(s.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(t.startAt)),t.endAt&&(s.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(t.endAt)),{ht:s,parent:l}}function Fje(n){let t=Dje(n.parent);const s=n.structuredQuery,a=s.from?s.from.length:0;let l=null;if(a>0){oi(a===1);const w=s.from[0];w.allDescendants?l=w.collectionId:t=t.child(w.collectionId)}let d=[];s.where&&(d=function(A){const N=Jre(A);return N instanceof kd&&Rre(N)?N.getFilters():[N]}(s.where));let f=[];s.orderBy&&(f=function(A){return A.map(N=>function(j){return new Ok(fS(j.field),function(H){switch(H){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(N))}(s.orderBy));let E=null;s.limit&&(E=function(A){let N;return N=typeof A=="object"?A.value:A,w1(N)?null:N}(s.limit));let v=null;s.startAt&&(v=function(A){const N=!!A.before,V=A.values||[];return new Pk(V,N)}(s.startAt));let b=null;return s.endAt&&(b=function(A){const N=!A.before,V=A.values||[];return new Pk(V,N)}(s.endAt)),sje(t,l,f,d,E,"F",v,b)}function jje(n,t){const s=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Wn()}}(t.purpose);return s==null?null:{"goog-listen-tags":s}}function Jre(n){return n.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const a=fS(s.unaryFilter.field);return eo.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=fS(s.unaryFilter.field);return eo.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=fS(s.unaryFilter.field);return eo.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=fS(s.unaryFilter.field);return eo.create(f,"!=",{nullValue:"NULL_VALUE"});default:return Wn()}}(n):n.fieldFilter!==void 0?function(s){return eo.create(fS(s.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Wn()}}(s.fieldFilter.op),s.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(s){return kd.create(s.compositeFilter.filters.map(a=>Jre(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Wn()}}(s.compositeFilter.op))}(n):Wn()}function Bje(n){return Aje[n]}function Wje(n){return Pje[n]}function zje(n){return Oje[n]}function pS(n){return{fieldPath:n.canonicalString()}}function fS(n){return aa.fromServerFormat(n.fieldPath)}function Qre(n){return n instanceof eo?function(s){if(s.op==="=="){if(rX(s.value))return{unaryFilter:{field:pS(s.field),op:"IS_NAN"}};if(nX(s.value))return{unaryFilter:{field:pS(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(rX(s.value))return{unaryFilter:{field:pS(s.field),op:"IS_NOT_NAN"}};if(nX(s.value))return{unaryFilter:{field:pS(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pS(s.field),op:Wje(s.op),value:s.value}}}(n):n instanceof kd?function(s){const a=s.getFilters().map(l=>Qre(l));return a.length===1?a[0]:{compositeFilter:{op:zje(s.op),filters:a}}}(n):Wn()}function Gje(n){const t=[];return n.fields.forEach(s=>t.push(s.canonicalString())),{fieldPaths:t}}function Zre(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class og{constructor(t,s,a,l,d=Kn.min(),f=Kn.min(),E=ha.EMPTY_BYTE_STRING,v=null){this.target=t,this.targetId=s,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=E,this.expectedCount=v}withSequenceNumber(t){return new og(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,s){return new og(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new og(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new og(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hje{constructor(t){this.Tt=t}}function $je(n){const t=Fje({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?iV(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kje{constructor(){this.Tn=new qje}addToCollectionParentIndex(t,s){return this.Tn.add(s),bt.resolve()}getCollectionParents(t,s){return bt.resolve(this.Tn.getEntries(s))}addFieldIndex(t,s){return bt.resolve()}deleteFieldIndex(t,s){return bt.resolve()}deleteAllFieldIndexes(t){return bt.resolve()}createTargetIndexes(t,s){return bt.resolve()}getDocumentsMatchingTarget(t,s){return bt.resolve(null)}getIndexType(t,s){return bt.resolve(0)}getFieldIndexes(t,s){return bt.resolve([])}getNextCollectionGroupToUpdate(t){return bt.resolve(null)}getMinOffset(t,s){return bt.resolve(yg.min())}getMinOffsetFromCollectionGroup(t,s){return bt.resolve(yg.min())}updateCollectionGroup(t,s,a){return bt.resolve()}updateIndexEntries(t,s){return bt.resolve()}}class qje{constructor(){this.index={}}add(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s]||new mo(Ki.comparator),d=!l.has(a);return this.index[s]=l.add(a),d}has(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s];return l&&l.has(a)}getEntries(t){return(this.index[t]||new mo(Ki.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _X={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},eie=41943040;class Jc{static withCacheSize(t){return new Jc(t,Jc.DEFAULT_COLLECTION_PERCENTILE,Jc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,s,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Jc.DEFAULT_COLLECTION_PERCENTILE=10,Jc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Jc.DEFAULT=new Jc(eie,Jc.DEFAULT_COLLECTION_PERCENTILE,Jc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Jc.DISABLED=new Jc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Un(){return new _0(0)}static Kn(){return new _0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EX="LruGarbageCollector",Yje=1048576;function yX([n,t],[s,a]){const l=pr(n,s);return l===0?pr(t,a):l}class Xje{constructor(t){this.Hn=t,this.buffer=new mo(yX),this.Jn=0}Yn(){return++this.Jn}Zn(t){const s=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(s);else{const a=this.buffer.last();yX(s,a)<0&&(this.buffer=this.buffer.delete(a).add(s))}}get maxValue(){return this.buffer.last()[0]}}class Jje{constructor(t,s,a){this.garbageCollector=t,this.asyncQueue=s,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){Qt(EX,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){L0(s)?Qt(EX,"Ignoring IndexedDB error during garbage collection: ",s):await D0(s)}await this.er(3e5)})}}class Qje{constructor(t,s){this.tr=t,this.params=s}calculateTargetCount(t,s){return this.tr.nr(t).next(a=>Math.floor(s/100*a))}nthSequenceNumber(t,s){if(s===0)return bt.resolve(T1.ae);const a=new Xje(s);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,s,a){return this.tr.removeTargets(t,s,a)}removeOrphanedDocuments(t,s){return this.tr.removeOrphanedDocuments(t,s)}collect(t,s){return this.params.cacheSizeCollectionThreshold===-1?(Qt("LruGarbageCollector","Garbage collection skipped; disabled"),bt.resolve(_X)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(Qt("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),_X):this.ir(t,s))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,s){let a,l,d,f,E,v,b;const w=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(A=>(A>this.params.maximumSequenceNumbersToCollect?(Qt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${A}`),l=this.params.maximumSequenceNumbersToCollect):l=A,f=Date.now(),this.nthSequenceNumber(t,l))).next(A=>(a=A,E=Date.now(),this.removeTargets(t,a,s))).next(A=>(d=A,v=Date.now(),this.removeOrphanedDocuments(t,a))).next(A=>(b=Date.now(),dS()<=Tr.DEBUG&&Qt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-w}ms
	Determined least recently used ${l} in `+(E-f)+`ms
	Removed ${d} targets in `+(v-E)+`ms
	Removed ${A} documents in `+(b-v)+`ms
Total Duration: ${b-w}ms`),bt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:A})))}}function Zje(n,t){return new Qje(n,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4e{constructor(){this.changes=new ME(t=>t.toString(),(t,s)=>t.isEqual(s)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,s){this.assertNotApplied(),this.changes.set(t,za.newInvalidDocument(t).setReadTime(s))}getEntry(t,s){this.assertNotApplied();const a=this.changes.get(s);return a!==void 0?bt.resolve(a):this.getFromCache(t,s)}getEntries(t,s){return this.getAllFromCache(t,s)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4e{constructor(t,s){this.overlayedDocument=t,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4e{constructor(t,s,a,l){this.remoteDocumentCache=t,this.mutationQueue=s,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,s){let a=null;return this.documentOverlayCache.getOverlay(t,s).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,s))).next(l=>(a!==null&&tR(a.mutation,l,Nl.empty(),fo.now()),l))}getDocuments(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.getLocalViewOfDocuments(t,a,wr()).next(()=>a))}getLocalViewOfDocuments(t,s,a=wr()){const l=lE();return this.populateOverlays(t,l,s).next(()=>this.computeViews(t,s,l,a).next(d=>{let f=Lw();return d.forEach((E,v)=>{f=f.insert(E,v.overlayedDocument)}),f}))}getOverlayedDocuments(t,s){const a=lE();return this.populateOverlays(t,a,s).next(()=>this.computeViews(t,s,a,wr()))}populateOverlays(t,s,a){const l=[];return a.forEach(d=>{s.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((f,E)=>{s.set(f,E)})})}computeViews(t,s,a,l){let d=xf();const f=eR(),E=function(){return eR()}();return s.forEach((v,b)=>{const w=a.get(b.key);l.has(b.key)&&(w===void 0||w.mutation instanceof Og)?d=d.insert(b.key,b):w!==void 0?(f.set(b.key,w.mutation.getFieldMask()),tR(w.mutation,b,w.mutation.getFieldMask(),fo.now())):f.set(b.key,Nl.empty())}),this.recalculateAndSaveOverlays(t,d).next(v=>(v.forEach((b,w)=>f.set(b,w)),s.forEach((b,w)=>{var A;return E.set(b,new t4e(w,(A=f.get(b))!==null&&A!==void 0?A:null))}),E))}recalculateAndSaveOverlays(t,s){const a=eR();let l=new ps((f,E)=>f-E),d=wr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,s).next(f=>{for(const E of f)E.keys().forEach(v=>{const b=s.get(v);if(b===null)return;let w=a.get(v)||Nl.empty();w=E.applyToLocalView(b,w),a.set(v,w);const A=(l.get(E.batchId)||wr()).add(v);l=l.insert(E.batchId,A)})}).next(()=>{const f=[],E=l.getReverseIterator();for(;E.hasNext();){const v=E.getNext(),b=v.key,w=v.value,A=Lre();w.forEach(N=>{if(!d.has(N)){const V=Bre(s.get(N),a.get(N));V!==null&&A.set(N,V),d=d.add(N)}}),f.push(this.documentOverlayCache.saveOverlays(t,b,A))}return bt.waitFor(f)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,s,a,l){return function(f){return Sn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(t,s.path):Pre(s)?this.getDocumentsMatchingCollectionGroupQuery(t,s,a,l):this.getDocumentsMatchingCollectionQuery(t,s,a,l)}getNextDocuments(t,s,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,s,a,l).next(d=>{const f=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,s,a.largestBatchId,l-d.size):bt.resolve(lE());let E=CR,v=d;return f.next(b=>bt.forEach(b,(w,A)=>(E<A.largestBatchId&&(E=A.largestBatchId),d.get(w)?bt.resolve():this.remoteDocumentCache.getEntry(t,w).next(N=>{v=v.insert(w,N)}))).next(()=>this.populateOverlays(t,b,d)).next(()=>this.computeViews(t,v,b,wr())).next(w=>({batchId:E,changes:Dre(w)})))})}getDocumentsMatchingDocumentQuery(t,s){return this.getDocument(t,new Sn(s)).next(a=>{let l=Lw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,s,a,l){const d=s.collectionGroup;let f=Lw();return this.indexManager.getCollectionParents(t,d).next(E=>bt.forEach(E,v=>{const b=function(A,N){return new eC(N,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(s,v.child(d));return this.getDocumentsMatchingCollectionQuery(t,b,a,l).next(w=>{w.forEach((A,N)=>{f=f.insert(A,N)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(t,s,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,a.largestBatchId).next(f=>(d=f,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,a,d,l))).next(f=>{d.forEach((v,b)=>{const w=b.getKey();f.get(w)===null&&(f=f.insert(w,za.newInvalidDocument(w)))});let E=Lw();return f.forEach((v,b)=>{const w=d.get(v);w!==void 0&&tR(w.mutation,b,Nl.empty(),fo.now()),I1(s,b)&&(E=E.insert(v,b))}),E})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4e{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,s){return bt.resolve(this.dr.get(s))}saveBundleMetadata(t,s){return this.dr.set(s.id,function(l){return{id:l.id,version:l.version,createTime:Jh(l.createTime)}}(s)),bt.resolve()}getNamedQuery(t,s){return bt.resolve(this.Ar.get(s))}saveNamedQuery(t,s){return this.Ar.set(s.name,function(l){return{name:l.name,query:$je(l.bundledQuery),readTime:Jh(l.readTime)}}(s)),bt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i4e{constructor(){this.overlays=new ps(Sn.comparator),this.Rr=new Map}getOverlay(t,s){return bt.resolve(this.overlays.get(s))}getOverlays(t,s){const a=lE();return bt.forEach(s,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,s,a){return a.forEach((l,d)=>{this.Et(t,s,d)}),bt.resolve()}removeOverlaysForBatchId(t,s,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),bt.resolve()}getOverlaysForCollection(t,s,a){const l=lE(),d=s.length+1,f=new Sn(s.child("")),E=this.overlays.getIteratorFrom(f);for(;E.hasNext();){const v=E.getNext().value,b=v.getKey();if(!s.isPrefixOf(b.path))break;b.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return bt.resolve(l)}getOverlaysForCollectionGroup(t,s,a,l){let d=new ps((b,w)=>b-w);const f=this.overlays.getIterator();for(;f.hasNext();){const b=f.getNext().value;if(b.getKey().getCollectionGroup()===s&&b.largestBatchId>a){let w=d.get(b.largestBatchId);w===null&&(w=lE(),d=d.insert(b.largestBatchId,w)),w.set(b.getKey(),b)}}const E=lE(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((b,w)=>E.set(b,w)),!(E.size()>=l)););return bt.resolve(E)}Et(t,s,a){const l=this.overlays.get(a.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(a.key,new Tje(s,a));let d=this.Rr.get(s);d===void 0&&(d=wr(),this.Rr.set(s,d)),this.Rr.set(s,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s4e{constructor(){this.sessionToken=ha.EMPTY_BYTE_STRING}getSessionToken(t){return bt.resolve(this.sessionToken)}setSessionToken(t,s){return this.sessionToken=s,bt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cj{constructor(){this.Vr=new mo(ko.mr),this.gr=new mo(ko.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,s){const a=new ko(t,s);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,s){t.forEach(a=>this.addReference(a,s))}removeReference(t,s){this.wr(new ko(t,s))}Sr(t,s){t.forEach(a=>this.removeReference(a,s))}br(t){const s=new Sn(new Ki([])),a=new ko(s,t),l=new ko(s,t+1),d=[];return this.gr.forEachInRange([a,l],f=>{this.wr(f),d.push(f.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const s=new Sn(new Ki([])),a=new ko(s,t),l=new ko(s,t+1);let d=wr();return this.gr.forEachInRange([a,l],f=>{d=d.add(f.key)}),d}containsKey(t){const s=new ko(t,0),a=this.Vr.firstAfterOrEqual(s);return a!==null&&t.isEqual(a.key)}}class ko{constructor(t,s){this.key=t,this.Cr=s}static mr(t,s){return Sn.comparator(t.key,s.key)||pr(t.Cr,s.Cr)}static pr(t,s){return pr(t.Cr,s.Cr)||Sn.comparator(t.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o4e{constructor(t,s){this.indexManager=t,this.referenceDelegate=s,this.mutationQueue=[],this.Fr=1,this.Mr=new mo(ko.mr)}checkEmpty(t){return bt.resolve(this.mutationQueue.length===0)}addMutationBatch(t,s,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new bje(d,s,a,l);this.mutationQueue.push(f);for(const E of l)this.Mr=this.Mr.add(new ko(E.key,d)),this.indexManager.addToCollectionParentIndex(t,E.key.path.popLast());return bt.resolve(f)}lookupMutationBatch(t,s){return bt.resolve(this.Or(s))}getNextMutationBatchAfterBatchId(t,s){const a=s+1,l=this.Nr(a),d=l<0?0:l;return bt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return bt.resolve(this.mutationQueue.length===0?gj:this.Fr-1)}getAllMutationBatches(t){return bt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,s){const a=new ko(s,0),l=new ko(s,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],f=>{const E=this.Or(f.Cr);d.push(E)}),bt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,s){let a=new mo(pr);return s.forEach(l=>{const d=new ko(l,0),f=new ko(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,f],E=>{a=a.add(E.Cr)})}),bt.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,s){const a=s.path,l=a.length+1;let d=a;Sn.isDocumentKey(d)||(d=d.child(""));const f=new ko(new Sn(d),0);let E=new mo(pr);return this.Mr.forEachWhile(v=>{const b=v.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(E=E.add(v.Cr)),!0)},f),bt.resolve(this.Br(E))}Br(t){const s=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&s.push(l)}),s}removeMutationBatch(t,s){oi(this.Lr(s.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return bt.forEach(s.mutations,l=>{const d=new ko(l.key,s.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,s){const a=new ko(s,0),l=this.Mr.firstAfterOrEqual(a);return bt.resolve(s.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,bt.resolve()}Lr(t,s){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const s=this.Nr(t);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a4e{constructor(t){this.kr=t,this.docs=function(){return new ps(Sn.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,s){const a=s.key,l=this.docs.get(a),d=l?l.size:0,f=this.kr(s);return this.docs=this.docs.insert(a,{document:s.mutableCopy(),size:f}),this.size+=f-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const s=this.docs.get(t);s&&(this.docs=this.docs.remove(t),this.size-=s.size)}getEntry(t,s){const a=this.docs.get(s);return bt.resolve(a?a.document.mutableCopy():za.newInvalidDocument(s))}getEntries(t,s){let a=xf();return s.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():za.newInvalidDocument(l))}),bt.resolve(a)}getDocumentsMatchingQuery(t,s,a,l){let d=xf();const f=s.path,E=new Sn(f.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(E);for(;v.hasNext();){const{key:b,value:{document:w}}=v.getNext();if(!f.isPrefixOf(b.path))break;b.path.length>f.length+1||UFe(MFe(w),a)<=0||(l.has(w.key)||I1(s,w))&&(d=d.insert(w.key,w.mutableCopy()))}return bt.resolve(d)}getAllFromCollectionGroup(t,s,a,l){Wn()}qr(t,s){return bt.forEach(this.docs,a=>s(a))}newChangeBuffer(t){return new c4e(this)}getSize(t){return bt.resolve(this.size)}}class c4e extends e4e{constructor(t){super(),this.Ir=t}applyChanges(t){const s=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?s.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),bt.waitFor(s)}getFromCache(t,s){return this.Ir.getEntry(t,s)}getAllFromCache(t,s){return this.Ir.getEntries(t,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l4e{constructor(t){this.persistence=t,this.Qr=new ME(s=>yj(s),vj),this.lastRemoteSnapshotVersion=Kn.min(),this.highestTargetId=0,this.$r=0,this.Ur=new Cj,this.targetCount=0,this.Kr=_0.Un()}forEachTarget(t,s){return this.Qr.forEach((a,l)=>s(l)),bt.resolve()}getLastRemoteSnapshotVersion(t){return bt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return bt.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Kr.next(),bt.resolve(this.highestTargetId)}setTargetsMetadata(t,s,a){return a&&(this.lastRemoteSnapshotVersion=a),s>this.$r&&(this.$r=s),bt.resolve()}zn(t){this.Qr.set(t.target,t);const s=t.targetId;s>this.highestTargetId&&(this.Kr=new _0(s),this.highestTargetId=s),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,s){return this.zn(s),this.targetCount+=1,bt.resolve()}updateTargetData(t,s){return this.zn(s),bt.resolve()}removeTargetData(t,s){return this.Qr.delete(s.target),this.Ur.br(s.targetId),this.targetCount-=1,bt.resolve()}removeTargets(t,s,a){let l=0;const d=[];return this.Qr.forEach((f,E)=>{E.sequenceNumber<=s&&a.get(E.targetId)===null&&(this.Qr.delete(f),d.push(this.removeMatchingKeysForTargetId(t,E.targetId)),l++)}),bt.waitFor(d).next(()=>l)}getTargetCount(t){return bt.resolve(this.targetCount)}getTargetData(t,s){const a=this.Qr.get(s)||null;return bt.resolve(a)}addMatchingKeys(t,s,a){return this.Ur.yr(s,a),bt.resolve()}removeMatchingKeys(t,s,a){this.Ur.Sr(s,a);const l=this.persistence.referenceDelegate,d=[];return l&&s.forEach(f=>{d.push(l.markPotentiallyOrphaned(t,f))}),bt.waitFor(d)}removeMatchingKeysForTargetId(t,s){return this.Ur.br(s),bt.resolve()}getMatchingKeysForTargetId(t,s){const a=this.Ur.vr(s);return bt.resolve(a)}containsKey(t,s){return bt.resolve(this.Ur.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tie{constructor(t,s){this.Wr={},this.overlays={},this.Gr=new T1(0),this.zr=!1,this.zr=!0,this.jr=new s4e,this.referenceDelegate=t(this),this.Hr=new l4e(this),this.indexManager=new Kje,this.remoteDocumentCache=function(l){return new a4e(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new Hje(s),this.Yr=new r4e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let s=this.overlays[t.toKey()];return s||(s=new i4e,this.overlays[t.toKey()]=s),s}getMutationQueue(t,s){let a=this.Wr[t.toKey()];return a||(a=new o4e(s,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,s,a){Qt("MemoryPersistence","Starting transaction:",t);const l=new u4e(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,s){return bt.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,s)))}}class u4e extends FFe{constructor(t){super(),this.currentSequenceNumber=t}}class Ij{constructor(t){this.persistence=t,this.ti=new Cj,this.ni=null}static ri(t){return new Ij(t)}get ii(){if(this.ni)return this.ni;throw Wn()}addReference(t,s,a){return this.ti.addReference(a,s),this.ii.delete(a.toString()),bt.resolve()}removeReference(t,s,a){return this.ti.removeReference(a,s),this.ii.add(a.toString()),bt.resolve()}markPotentiallyOrphaned(t,s){return this.ii.add(s.toString()),bt.resolve()}removeTarget(t,s){this.ti.br(s.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,s.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,s))}Zr(){this.ni=new Set}Xr(t){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return bt.forEach(this.ii,a=>{const l=Sn.fromPath(a);return this.si(t,l).next(d=>{d||s.removeEntry(l,Kn.min())})}).next(()=>(this.ni=null,s.apply(t)))}updateLimboDocument(t,s){return this.si(t,s).next(a=>{a?this.ii.delete(s.toString()):this.ii.add(s.toString())})}Jr(t){return 0}si(t,s){return bt.or([()=>bt.resolve(this.ti.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(t,s),()=>this.persistence.ei(t,s)])}}class Lk{constructor(t,s){this.persistence=t,this.oi=new ME(a=>WFe(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=Zje(this,s)}static ri(t,s){return new Lk(t,s)}Zr(){}Xr(t){return bt.resolve()}forEachTarget(t,s){return this.persistence.getTargetCache().forEachTarget(t,s)}nr(t){const s=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>s.next(l=>a+l))}sr(t){let s=0;return this.rr(t,a=>{s++}).next(()=>s)}rr(t,s){return bt.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?bt.resolve():s(l)))}removeTargets(t,s,a){return this.persistence.getTargetCache().removeTargets(t,s,a)}removeOrphanedDocuments(t,s){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,f=>this.ar(t,f,s).next(E=>{E||(a++,d.removeEntry(f,Kn.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,s){return this.oi.set(s,t.currentSequenceNumber),bt.resolve()}removeTarget(t,s){const a=s.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),bt.resolve()}removeReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),bt.resolve()}updateLimboDocument(t,s){return this.oi.set(s,t.currentSequenceNumber),bt.resolve()}Jr(t){let s=t.key.toString().length;return t.isFoundDocument()&&(s+=$O(t.data.value)),s}ar(t,s,a){return bt.or([()=>this.persistence.ei(t,s),()=>this.persistence.getTargetCache().containsKey(t,s),()=>{const l=this.oi.get(s);return bt.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aj{constructor(t,s,a,l){this.targetId=t,this.fromCache=s,this.Hi=a,this.Ji=l}static Yi(t,s){let a=wr(),l=wr();for(const d of s.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new Aj(t,s.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return $2e()?8:jFe($a())>0?6:4}()}initialize(t,s){this.ns=t,this.indexManager=s,this.Zi=!0}getDocumentsMatchingQuery(t,s,a,l){const d={result:null};return this.rs(t,s).next(f=>{d.result=f}).next(()=>{if(!d.result)return this.ss(t,s,l,a).next(f=>{d.result=f})}).next(()=>{if(d.result)return;const f=new d4e;return this._s(t,s,f).next(E=>{if(d.result=E,this.Xi)return this.us(t,s,f,E.size)})}).next(()=>d.result)}us(t,s,a,l){return a.documentReadCount<this.es?(dS()<=Tr.DEBUG&&Qt("QueryEngine","SDK will not create cache indexes for query:",hS(s),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),bt.resolve()):(dS()<=Tr.DEBUG&&Qt("QueryEngine","Query:",hS(s),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(dS()<=Tr.DEBUG&&Qt("QueryEngine","The SDK decides to create cache indexes for query:",hS(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Xh(s))):bt.resolve())}rs(t,s){if(aX(s))return bt.resolve(null);let a=Xh(s);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(s.limit!==null&&l===1&&(s=iV(s,null,"F"),a=Xh(s)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const f=wr(...d);return this.ns.getDocuments(t,f).next(E=>this.indexManager.getMinOffset(t,a).next(v=>{const b=this.cs(s,E);return this.ls(s,b,f,v.readTime)?this.rs(t,iV(s,null,"F")):this.hs(t,b,s,v)}))})))}ss(t,s,a,l){return aX(s)||l.isEqual(Kn.min())?bt.resolve(null):this.ns.getDocuments(t,a).next(d=>{const f=this.cs(s,d);return this.ls(s,f,a,l)?bt.resolve(null):(dS()<=Tr.DEBUG&&Qt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),hS(s)),this.hs(t,f,s,xFe(l,CR)).next(E=>E))})}cs(t,s){let a=new mo(kre(t));return s.forEach((l,d)=>{I1(t,d)&&(a=a.add(d))}),a}ls(t,s,a,l){if(t.limit===null)return!1;if(a.size!==s.size)return!0;const d=t.limitType==="F"?s.last():s.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,s,a){return dS()<=Tr.DEBUG&&Qt("QueryEngine","Using full collection scan to execute query:",hS(s)),this.ns.getDocumentsMatchingQuery(t,s,yg.min(),a)}hs(t,s,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(s.forEach(f=>{d=d.insert(f.key,f)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pj="LocalStore",p4e=3e8;class f4e{constructor(t,s,a,l){this.persistence=t,this.Ps=s,this.serializer=l,this.Ts=new ps(pr),this.Is=new ME(d=>yj(d),vj),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new n4e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>t.collect(s,this.Ts))}}function m4e(n,t,s,a){return new f4e(n,t,s,a)}async function nie(n,t){const s=Jn(n);return await s.persistence.runTransaction("Handle user change","readonly",a=>{let l;return s.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,s.As(t),s.mutationQueue.getAllMutationBatches(a))).next(d=>{const f=[],E=[];let v=wr();for(const b of l){f.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}for(const b of d){E.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}return s.localDocuments.getDocuments(a,v).next(b=>({Rs:b,removedBatchIds:f,addedBatchIds:E}))})})}function g4e(n,t){const s=Jn(n);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=s.ds.newChangeBuffer({trackRemovals:!0});return function(E,v,b,w){const A=b.batch,N=A.keys();let V=bt.resolve();return N.forEach(j=>{V=V.next(()=>w.getEntry(v,j)).next(B=>{const H=b.docVersions.get(j);oi(H!==null),B.version.compareTo(H)<0&&(A.applyToRemoteDocument(B,b),B.isValidDocument()&&(B.setReadTime(b.commitVersion),w.addEntry(B)))})}),V.next(()=>E.mutationQueue.removeMutationBatch(v,A))}(s,a,t,d).next(()=>d.apply(a)).next(()=>s.mutationQueue.performConsistencyCheck(a)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(E){let v=wr();for(let b=0;b<E.mutationResults.length;++b)E.mutationResults[b].transformResults.length>0&&(v=v.add(E.batch.mutations[b].key));return v}(t))).next(()=>s.localDocuments.getDocuments(a,l))})}function rie(n){const t=Jn(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",s=>t.Hr.getLastRemoteSnapshotVersion(s))}function _4e(n,t){const s=Jn(n),a=t.snapshotVersion;let l=s.Ts;return s.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const f=s.ds.newChangeBuffer({trackRemovals:!0});l=s.Ts;const E=[];t.targetChanges.forEach((w,A)=>{const N=l.get(A);if(!N)return;E.push(s.Hr.removeMatchingKeys(d,w.removedDocuments,A).next(()=>s.Hr.addMatchingKeys(d,w.addedDocuments,A)));let V=N.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(A)!==null?V=V.withResumeToken(ha.EMPTY_BYTE_STRING,Kn.min()).withLastLimboFreeSnapshotVersion(Kn.min()):w.resumeToken.approximateByteSize()>0&&(V=V.withResumeToken(w.resumeToken,a)),l=l.insert(A,V),function(B,H,J){return B.resumeToken.approximateByteSize()===0||H.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=p4e?!0:J.addedDocuments.size+J.modifiedDocuments.size+J.removedDocuments.size>0}(N,V,w)&&E.push(s.Hr.updateTargetData(d,V))});let v=xf(),b=wr();if(t.documentUpdates.forEach(w=>{t.resolvedLimboDocuments.has(w)&&E.push(s.persistence.referenceDelegate.updateLimboDocument(d,w))}),E.push(E4e(d,f,t.documentUpdates).next(w=>{v=w.Vs,b=w.fs})),!a.isEqual(Kn.min())){const w=s.Hr.getLastRemoteSnapshotVersion(d).next(A=>s.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));E.push(w)}return bt.waitFor(E).next(()=>f.apply(d)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,v,b)).next(()=>v)}).then(d=>(s.Ts=l,d))}function E4e(n,t,s){let a=wr(),l=wr();return s.forEach(d=>a=a.add(d)),t.getEntries(n,a).next(d=>{let f=xf();return s.forEach((E,v)=>{const b=d.get(E);v.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(E)),v.isNoDocument()&&v.version.isEqual(Kn.min())?(t.removeEntry(E,v.readTime),f=f.insert(E,v)):!b.isValidDocument()||v.version.compareTo(b.version)>0||v.version.compareTo(b.version)===0&&b.hasPendingWrites?(t.addEntry(v),f=f.insert(E,v)):Qt(Pj,"Ignoring outdated watch update for ",E,". Current version:",b.version," Watch version:",v.version)}),{Vs:f,fs:l}})}function y4e(n,t){const s=Jn(n);return s.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=gj),s.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function v4e(n,t){const s=Jn(n);return s.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return s.Hr.getTargetData(a,t).next(d=>d?(l=d,bt.resolve(l)):s.Hr.allocateTargetId(a).next(f=>(l=new og(t,f,"TargetPurposeListen",a.currentSequenceNumber),s.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=s.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(s.Ts=s.Ts.insert(a.targetId,a),s.Is.set(t,a.targetId)),a})}async function lV(n,t,s){const a=Jn(n),l=a.Ts.get(t),d=s?"readwrite":"readwrite-primary";try{s||await a.persistence.runTransaction("Release target",d,f=>a.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!L0(f))throw f;Qt(Pj,`Failed to update sequence numbers for target ${t}: ${f}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function vX(n,t,s){const a=Jn(n);let l=Kn.min(),d=wr();return a.persistence.runTransaction("Execute query","readwrite",f=>function(v,b,w){const A=Jn(v),N=A.Is.get(w);return N!==void 0?bt.resolve(A.Ts.get(N)):A.Hr.getTargetData(b,w)}(a,f,Xh(t)).next(E=>{if(E)return l=E.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(f,E.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(f,t,s?l:Kn.min(),s?d:wr())).next(E=>(S4e(a,aje(t),E),{documents:E,gs:d})))}function S4e(n,t,s){let a=n.Es.get(t)||Kn.min();s.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),n.Es.set(t,a)}class SX{constructor(){this.activeTargetIds=pje()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}bs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class b4e{constructor(){this.ho=new SX,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,s,a){}addLocalQueryTarget(t,s=!0){return s&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,s,a){this.Po[t]=s}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new SX,Promise.resolve()}handleUserChange(t,s,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T4e{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bX="ConnectivityMonitor";class TX{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Qt(bX,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){Qt(bX,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let EO=null;function uV(){return EO===null?EO=function(){return 268435456+Math.round(2147483648*Math.random())}():EO++,"0x"+EO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kM="RestConnection",w4e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class R4e{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const s=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=s+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===Ik?`project_id=${a}`:`project_id=${a}&database_id=${l}`}So(t,s,a,l,d){const f=uV(),E=this.bo(t,s.toUriEncodedString());Qt(kM,`Sending RPC '${t}' ${f}:`,E,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(t,E,v,a).then(b=>(Qt(kM,`Received RPC '${t}' ${f}: `,b),b),b=>{throw d0(kM,`RPC '${t}' ${f} failed with error: `,b,"url: ",E,"request:",a),b})}Co(t,s,a,l,d,f){return this.So(t,s,a,l,d)}Do(t,s,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+N0}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}bo(t,s){const a=w4e[t];return`${this.po}/v1/${s}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C4e{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Uo(t){this.ko(t)}Ko(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Va="WebChannelConnection";class I4e extends R4e{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,s,a,l){const d=uV();return new Promise((f,E)=>{const v=new sre;v.setWithCredentials(!0),v.listenOnce(ore.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case HO.NO_ERROR:const w=v.getResponseJson();Qt(Va,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(w)),f(w);break;case HO.TIMEOUT:Qt(Va,`RPC '${t}' ${d} timed out`),E(new sn(Tt.DEADLINE_EXCEEDED,"Request time out"));break;case HO.HTTP_ERROR:const A=v.getStatus();if(Qt(Va,`RPC '${t}' ${d} failed with status:`,A,"response text:",v.getResponseText()),A>0){let N=v.getResponseJson();Array.isArray(N)&&(N=N[0]);const V=N==null?void 0:N.error;if(V&&V.status&&V.message){const j=function(H){const J=H.toLowerCase().replace(/_/g,"-");return Object.values(Tt).indexOf(J)>=0?J:Tt.UNKNOWN}(V.status);E(new sn(j,V.message))}else E(new sn(Tt.UNKNOWN,"Server responded with status "+v.getStatus()))}else E(new sn(Tt.UNAVAILABLE,"Connection failed."));break;default:Wn()}}finally{Qt(Va,`RPC '${t}' ${d} completed.`)}});const b=JSON.stringify(l);Qt(Va,`RPC '${t}' ${d} sending request:`,l),v.send(s,"POST",b,a,15)})}Wo(t,s,a){const l=uV(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],f=lre(),E=cre(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(v.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,s,a),v.encodeInitMessageHeaders=!0;const w=d.join("");Qt(Va,`Creating RPC '${t}' stream ${l}: ${w}`,v);const A=f.createWebChannel(w,v);let N=!1,V=!1;const j=new C4e({Fo:H=>{V?Qt(Va,`Not sending because RPC '${t}' stream ${l} is closed:`,H):(N||(Qt(Va,`Opening RPC '${t}' stream ${l} transport.`),A.open(),N=!0),Qt(Va,`RPC '${t}' stream ${l} sending:`,H),A.send(H))},Mo:()=>A.close()}),B=(H,J,$)=>{H.listen(J,te=>{try{$(te)}catch(ce){setTimeout(()=>{throw ce},0)}})};return B(A,Dw.EventType.OPEN,()=>{V||(Qt(Va,`RPC '${t}' stream ${l} transport opened.`),j.Qo())}),B(A,Dw.EventType.CLOSE,()=>{V||(V=!0,Qt(Va,`RPC '${t}' stream ${l} transport closed`),j.Uo())}),B(A,Dw.EventType.ERROR,H=>{V||(V=!0,d0(Va,`RPC '${t}' stream ${l} transport errored:`,H),j.Uo(new sn(Tt.UNAVAILABLE,"The operation could not be completed")))}),B(A,Dw.EventType.MESSAGE,H=>{var J;if(!V){const $=H.data[0];oi(!!$);const te=$,ce=(te==null?void 0:te.error)||((J=te[0])===null||J===void 0?void 0:J.error);if(ce){Qt(Va,`RPC '${t}' stream ${l} received error:`,ce);const oe=ce.status;let _e=function(Q){const se=Xs[Q];if(se!==void 0)return Gre(se)}(oe),ne=ce.message;_e===void 0&&(_e=Tt.INTERNAL,ne="Unknown error status: "+oe+" with message "+ce.message),V=!0,j.Uo(new sn(_e,ne)),A.close()}else Qt(Va,`RPC '${t}' stream ${l} received:`,$),j.Ko($)}}),B(E,are.STAT_EVENT,H=>{H.stat===JU.PROXY?Qt(Va,`RPC '${t}' stream ${l} detected buffering proxy`):H.stat===JU.NOPROXY&&Qt(Va,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{j.$o()},0),j}}function NM(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k1(n){return new kje(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iie{constructor(t,s,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=s,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const s=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,s-a);l>0&&Qt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${s} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wX="PersistentStream";class sie{constructor(t,s,a,l,d,f,E,v){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=E,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new iie(t,s)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,s){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():s&&s.code===Tt.RESOURCE_EXHAUSTED?(Lf(s.toString()),Lf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):s&&s.code===Tt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(s)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),s=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===s&&this.V_(a,l)},a=>{t(()=>{const l=new sn(Tt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,s){const a=this.R_(this.i_);this.stream=this.f_(t,s),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return Qt(wX,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return s=>{this.Ti.enqueueAndForget(()=>this.i_===t?s():(Qt(wX,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class A4e extends sie{constructor(t,s,a,l,d,f){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}f_(t,s){return this.connection.Wo("Listen",t,s)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const s=Lje(this.serializer,t),a=function(d){if(!("targetChange"in d))return Kn.min();const f=d.targetChange;return f.targetIds&&f.targetIds.length?Kn.min():f.readTime?Jh(f.readTime):Kn.min()}(t);return this.listener.p_(s,a)}y_(t){const s={};s.database=cV(this.serializer),s.addTarget=function(d,f){let E;const v=f.target;if(E=nV(v)?{documents:Uje(d,v)}:{query:Vje(d,v).ht},E.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){E.resumeToken=Kre(d,f.resumeToken);const b=sV(d,f.expectedCount);b!==null&&(E.expectedCount=b)}else if(f.snapshotVersion.compareTo(Kn.min())>0){E.readTime=Dk(d,f.snapshotVersion.toTimestamp());const b=sV(d,f.expectedCount);b!==null&&(E.expectedCount=b)}return E}(this.serializer,t);const a=jje(this.serializer,t);a&&(s.labels=a),this.I_(s)}w_(t){const s={};s.database=cV(this.serializer),s.removeTarget=t,this.I_(s)}}class P4e extends sie{constructor(t,s,a,l,d,f){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(t,s){return this.connection.Wo("Write",t,s)}g_(t){return oi(!!t.streamToken),this.lastStreamToken=t.streamToken,oi(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){oi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const s=Mje(t.writeResults,t.commitTime),a=Jh(t.commitTime);return this.listener.v_(a,s)}C_(){const t={};t.database=cV(this.serializer),this.I_(t)}b_(t){const s={streamToken:this.lastStreamToken,writes:t.map(a=>xje(this.serializer,a))};this.I_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4e{}class k4e extends O4e{constructor(t,s,a,l){super(),this.authCredentials=t,this.appCheckCredentials=s,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new sn(Tt.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,s,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,f])=>this.connection.So(t,oV(s,a),l,d,f)).catch(d=>{throw d.name==="FirebaseError"?(d.code===Tt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new sn(Tt.UNKNOWN,d.toString())})}Co(t,s,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,E])=>this.connection.Co(t,oV(s,a),l,f,E,d)).catch(f=>{throw f.name==="FirebaseError"?(f.code===Tt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new sn(Tt.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class N4e{constructor(t,s){this.asyncQueue=t,this.onlineStateHandler=s,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const s=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Lf(s),this.N_=!1):Qt("OnlineStateTracker",s)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE="RemoteStore";class D4e{constructor(t,s,a,l,d){this.localStore=t,this.datastore=s,this.asyncQueue=a,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(f=>{a.enqueueAndForget(async()=>{UE(this)&&(Qt(OE,"Restarting streams for network reachability change."),await async function(v){const b=Jn(v);b.W_.add(4),await rC(b),b.j_.set("Unknown"),b.W_.delete(4),await N1(b)}(this))})}),this.j_=new N4e(a,l)}}async function N1(n){if(UE(n))for(const t of n.G_)await t(!0)}async function rC(n){for(const t of n.G_)await t(!1)}function oie(n,t){const s=Jn(n);s.K_.has(t.targetId)||(s.K_.set(t.targetId,t),Dj(s)?Nj(s):x0(s).c_()&&kj(s,t))}function Oj(n,t){const s=Jn(n),a=x0(s);s.K_.delete(t),a.c_()&&aie(s,t),s.K_.size===0&&(a.c_()?a.P_():UE(s)&&s.j_.set("Unknown"))}function kj(n,t){if(n.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Kn.min())>0){const s=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}x0(n).y_(t)}function aie(n,t){n.H_.Ne(t),x0(n).w_(t)}function Nj(n){n.H_=new Ije({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>n.K_.get(t)||null,it:()=>n.datastore.serializer.databaseId}),x0(n).start(),n.j_.B_()}function Dj(n){return UE(n)&&!x0(n).u_()&&n.K_.size>0}function UE(n){return Jn(n).W_.size===0}function cie(n){n.H_=void 0}async function L4e(n){n.j_.set("Online")}async function x4e(n){n.K_.forEach((t,s)=>{kj(n,t)})}async function M4e(n,t){cie(n),Dj(n)?(n.j_.q_(t),Nj(n)):n.j_.set("Unknown")}async function U4e(n,t,s){if(n.j_.set("Online"),t instanceof $re&&t.state===2&&t.cause)try{await async function(l,d){const f=d.cause;for(const E of d.targetIds)l.K_.has(E)&&(await l.remoteSyncer.rejectListen(E,f),l.K_.delete(E),l.H_.removeTarget(E))}(n,t)}catch(a){Qt(OE,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await xk(n,a)}else if(t instanceof YO?n.H_.We(t):t instanceof Hre?n.H_.Ze(t):n.H_.je(t),!s.isEqual(Kn.min()))try{const a=await rie(n.localStore);s.compareTo(a)>=0&&await function(d,f){const E=d.H_.ot(f);return E.targetChanges.forEach((v,b)=>{if(v.resumeToken.approximateByteSize()>0){const w=d.K_.get(b);w&&d.K_.set(b,w.withResumeToken(v.resumeToken,f))}}),E.targetMismatches.forEach((v,b)=>{const w=d.K_.get(v);if(!w)return;d.K_.set(v,w.withResumeToken(ha.EMPTY_BYTE_STRING,w.snapshotVersion)),aie(d,v);const A=new og(w.target,v,b,w.sequenceNumber);kj(d,A)}),d.remoteSyncer.applyRemoteEvent(E)}(n,s)}catch(a){Qt(OE,"Failed to raise snapshot:",a),await xk(n,a)}}async function xk(n,t,s){if(!L0(t))throw t;n.W_.add(1),await rC(n),n.j_.set("Offline"),s||(s=()=>rie(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Qt(OE,"Retrying IndexedDB access"),await s(),n.W_.delete(1),await N1(n)})}function lie(n,t){return t().catch(s=>xk(n,s,t))}async function D1(n){const t=Jn(n),s=Tg(t);let a=t.U_.length>0?t.U_[t.U_.length-1].batchId:gj;for(;V4e(t);)try{const l=await y4e(t.localStore,a);if(l===null){t.U_.length===0&&s.P_();break}a=l.batchId,F4e(t,l)}catch(l){await xk(t,l)}uie(t)&&die(t)}function V4e(n){return UE(n)&&n.U_.length<10}function F4e(n,t){n.U_.push(t);const s=Tg(n);s.c_()&&s.S_&&s.b_(t.mutations)}function uie(n){return UE(n)&&!Tg(n).u_()&&n.U_.length>0}function die(n){Tg(n).start()}async function j4e(n){Tg(n).C_()}async function B4e(n){const t=Tg(n);for(const s of n.U_)t.b_(s.mutations)}async function W4e(n,t,s){const a=n.U_.shift(),l=Tj.from(a,t,s);await lie(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await D1(n)}async function z4e(n,t){t&&Tg(n).S_&&await async function(a,l){if(function(f){return Rje(f)&&f!==Tt.ABORTED}(l.code)){const d=a.U_.shift();Tg(a).h_(),await lie(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await D1(a)}}(n,t),uie(n)&&die(n)}async function RX(n,t){const s=Jn(n);s.asyncQueue.verifyOperationInProgress(),Qt(OE,"RemoteStore received new credentials");const a=UE(s);s.W_.add(3),await rC(s),a&&s.j_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(t),s.W_.delete(3),await N1(s)}async function G4e(n,t){const s=Jn(n);t?(s.W_.delete(2),await N1(s)):t||(s.W_.add(2),await rC(s),s.j_.set("Unknown"))}function x0(n){return n.J_||(n.J_=function(s,a,l){const d=Jn(s);return d.M_(),new A4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:L4e.bind(null,n),No:x4e.bind(null,n),Lo:M4e.bind(null,n),p_:U4e.bind(null,n)}),n.G_.push(async t=>{t?(n.J_.h_(),Dj(n)?Nj(n):n.j_.set("Unknown")):(await n.J_.stop(),cie(n))})),n.J_}function Tg(n){return n.Y_||(n.Y_=function(s,a,l){const d=Jn(s);return d.M_(),new P4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:j4e.bind(null,n),Lo:z4e.bind(null,n),D_:B4e.bind(null,n),v_:W4e.bind(null,n)}),n.G_.push(async t=>{t?(n.Y_.h_(),await D1(n)):(await n.Y_.stop(),n.U_.length>0&&(Qt(OE,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lj{constructor(t,s,a,l,d){this.asyncQueue=t,this.timerId=s,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new Cf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,s,a,l,d){const f=Date.now()+a,E=new Lj(t,s,f,l,d);return E.start(a),E}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new sn(Tt.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function xj(n,t){if(Lf("AsyncQueue",`${t}: ${n}`),L0(n))return new sn(Tt.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XS{static emptySet(t){return new XS(t.comparator)}constructor(t){this.comparator=t?(s,a)=>t(s,a)||Sn.comparator(s.key,a.key):(s,a)=>Sn.comparator(s.key,a.key),this.keyedMap=Lw(),this.sortedSet=new ps(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const s=this.keyedMap.get(t);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((s,a)=>(t(s),!1))}add(t){const s=this.delete(t.key);return s.copy(s.keyedMap.insert(t.key,t),s.sortedSet.insert(t,null))}delete(t){const s=this.get(t);return s?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(s)):this}isEqual(t){if(!(t instanceof XS)||this.size!==t.size)return!1;const s=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(s=>{t.push(s.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,s){const a=new XS;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=s,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CX{constructor(){this.Z_=new ps(Sn.comparator)}track(t){const s=t.doc.key,a=this.Z_.get(s);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(s,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(s,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(s,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(s):t.type===1&&a.type===2?this.Z_=this.Z_.insert(s,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):Wn():this.Z_=this.Z_.insert(s,t)}X_(){const t=[];return this.Z_.inorderTraversal((s,a)=>{t.push(a)}),t}}class E0{constructor(t,s,a,l,d,f,E,v,b){this.query=t,this.docs=s,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=f,this.syncStateChanged=E,this.excludesMetadataChanges=v,this.hasCachedResults=b}static fromInitialDocuments(t,s,a,l,d){const f=[];return s.forEach(E=>{f.push({type:0,doc:E})}),new E0(t,s,XS.emptySet(s),f,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&C1(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const s=this.docChanges,a=t.docChanges;if(s.length!==a.length)return!1;for(let l=0;l<s.length;l++)if(s[l].type!==a[l].type||!s[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class $4e{constructor(){this.queries=IX(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(s,a){const l=Jn(s),d=l.queries;l.queries=IX(),d.forEach((f,E)=>{for(const v of E.ta)v.onError(a)})})(this,new sn(Tt.ABORTED,"Firestore shutting down"))}}function IX(){return new ME(n=>Ore(n),C1)}async function hie(n,t){const s=Jn(n);let a=3;const l=t.query;let d=s.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new H4e,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await s.onListen(l,!0);break;case 1:d.ea=await s.onListen(l,!1);break;case 2:await s.onFirstRemoteStoreListen(l)}}catch(f){const E=xj(f,`Initialization of query '${hS(t.query)}' failed`);return void t.onError(E)}s.queries.set(l,d),d.ta.push(t),t.sa(s.onlineState),d.ea&&t.oa(d.ea)&&Mj(s)}async function pie(n,t){const s=Jn(n),a=t.query;let l=3;const d=s.queries.get(a);if(d){const f=d.ta.indexOf(t);f>=0&&(d.ta.splice(f,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return s.queries.delete(a),s.onUnlisten(a,!0);case 1:return s.queries.delete(a),s.onUnlisten(a,!1);case 2:return s.onLastRemoteStoreUnlisten(a);default:return}}function K4e(n,t){const s=Jn(n);let a=!1;for(const l of t){const d=l.query,f=s.queries.get(d);if(f){for(const E of f.ta)E.oa(l)&&(a=!0);f.ea=l}}a&&Mj(s)}function q4e(n,t,s){const a=Jn(n),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(s);a.queries.delete(t)}function Mj(n){n.ia.forEach(t=>{t.next()})}var dV,AX;(AX=dV||(dV={}))._a="default",AX.Cache="cache";class fie{constructor(t,s,a){this.query=t,this.aa=s,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new E0(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let s=!1;return this.ua?this.la(t)&&(this.aa.next(t),s=!0):this.ha(t,this.onlineState)&&(this.Pa(t),s=!0),this.ca=t,s}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let s=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),s=!0),s}ha(t,s){if(!t.fromCache||!this.ra())return!0;const a=s!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||s==="Offline")}la(t){if(t.docChanges.length>0)return!0;const s=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}Pa(t){t=E0.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==dV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mie{constructor(t){this.key=t}}class gie{constructor(t){this.key=t}}class Y4e{constructor(t,s){this.query=t,this.fa=s,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=wr(),this.mutatedKeys=wr(),this.ya=kre(t),this.wa=new XS(this.ya)}get Sa(){return this.fa}ba(t,s){const a=s?s.Da:new CX,l=s?s.wa:this.wa;let d=s?s.mutatedKeys:this.mutatedKeys,f=l,E=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((w,A)=>{const N=l.get(w),V=I1(this.query,A)?A:null,j=!!N&&this.mutatedKeys.has(N.key),B=!!V&&(V.hasLocalMutations||this.mutatedKeys.has(V.key)&&V.hasCommittedMutations);let H=!1;N&&V?N.data.isEqual(V.data)?j!==B&&(a.track({type:3,doc:V}),H=!0):this.va(N,V)||(a.track({type:2,doc:V}),H=!0,(v&&this.ya(V,v)>0||b&&this.ya(V,b)<0)&&(E=!0)):!N&&V?(a.track({type:0,doc:V}),H=!0):N&&!V&&(a.track({type:1,doc:N}),H=!0,(v||b)&&(E=!0)),H&&(V?(f=f.add(V),d=B?d.add(w):d.delete(w)):(f=f.delete(w),d=d.delete(w)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const w=this.query.limitType==="F"?f.last():f.first();f=f.delete(w.key),d=d.delete(w.key),a.track({type:1,doc:w})}return{wa:f,Da:a,ls:E,mutatedKeys:d}}va(t,s){return t.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(t,s,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const f=t.Da.X_();f.sort((w,A)=>function(V,j){const B=H=>{switch(H){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Wn()}};return B(V)-B(j)}(w.type,A.type)||this.ya(w.doc,A.doc)),this.Ca(a),l=l!=null&&l;const E=s&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,b=v!==this.ga;return this.ga=v,f.length!==0||b?{snapshot:new E0(this.query,t.wa,d,f,t.mutatedKeys,v===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:E}:{Ma:E}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new CX,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(s=>this.fa=this.fa.add(s)),t.modifiedDocuments.forEach(s=>{}),t.removedDocuments.forEach(s=>this.fa=this.fa.delete(s)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=wr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const s=[];return t.forEach(a=>{this.pa.has(a)||s.push(new gie(a))}),this.pa.forEach(a=>{t.has(a)||s.push(new mie(a))}),s}Oa(t){this.fa=t.gs,this.pa=wr();const s=this.ba(t.documents);return this.applyChanges(s,!0)}Na(){return E0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const Uj="SyncEngine";class X4e{constructor(t,s,a){this.query=t,this.targetId=s,this.view=a}}class J4e{constructor(t){this.key=t,this.Ba=!1}}class Q4e{constructor(t,s,a,l,d,f){this.localStore=t,this.remoteStore=s,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new ME(E=>Ore(E),C1),this.qa=new Map,this.Qa=new Set,this.$a=new ps(Sn.comparator),this.Ua=new Map,this.Ka=new Cj,this.Wa={},this.Ga=new Map,this.za=_0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function Z4e(n,t,s=!0){const a=bie(n);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await _ie(a,t,s,!0),l}async function e3e(n,t){const s=bie(n);await _ie(s,t,!0,!1)}async function _ie(n,t,s,a){const l=await v4e(n.localStore,Xh(t)),d=l.targetId,f=n.sharedClientState.addLocalQueryTarget(d,s);let E;return a&&(E=await t3e(n,t,d,f==="current",l.resumeToken)),n.isPrimaryClient&&s&&oie(n.remoteStore,l),E}async function t3e(n,t,s,a,l){n.Ha=(A,N,V)=>async function(B,H,J,$){let te=H.view.ba(J);te.ls&&(te=await vX(B.localStore,H.query,!1).then(({documents:ne})=>H.view.ba(ne,te)));const ce=$&&$.targetChanges.get(H.targetId),oe=$&&$.targetMismatches.get(H.targetId)!=null,_e=H.view.applyChanges(te,B.isPrimaryClient,ce,oe);return OX(B,H.targetId,_e.Ma),_e.snapshot}(n,A,N,V);const d=await vX(n.localStore,t,!0),f=new Y4e(t,d.gs),E=f.ba(d.documents),v=nC.createSynthesizedTargetChangeForCurrentChange(s,a&&n.onlineState!=="Offline",l),b=f.applyChanges(E,n.isPrimaryClient,v);OX(n,s,b.Ma);const w=new X4e(t,s,f);return n.ka.set(t,w),n.qa.has(s)?n.qa.get(s).push(t):n.qa.set(s,[t]),b.snapshot}async function n3e(n,t,s){const a=Jn(n),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(f=>!C1(f,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await lV(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),s&&Oj(a.remoteStore,l.targetId),hV(a,l.targetId)}).catch(D0)):(hV(a,l.targetId),await lV(a.localStore,l.targetId,!0))}async function r3e(n,t){const s=Jn(n),a=s.ka.get(t),l=s.qa.get(a.targetId);s.isPrimaryClient&&l.length===1&&(s.sharedClientState.removeLocalQueryTarget(a.targetId),Oj(s.remoteStore,a.targetId))}async function i3e(n,t,s){const a=d3e(n);try{const l=await function(f,E){const v=Jn(f),b=fo.now(),w=E.reduce((V,j)=>V.add(j.key),wr());let A,N;return v.persistence.runTransaction("Locally write mutations","readwrite",V=>{let j=xf(),B=wr();return v.ds.getEntries(V,w).next(H=>{j=H,j.forEach((J,$)=>{$.isValidDocument()||(B=B.add(J))})}).next(()=>v.localDocuments.getOverlayedDocuments(V,j)).next(H=>{A=H;const J=[];for(const $ of E){const te=vje($,A.get($.key).overlayedDocument);te!=null&&J.push(new Og($.key,te,bre(te.value.mapValue),Pd.exists(!0)))}return v.mutationQueue.addMutationBatch(V,b,J,E)}).next(H=>{N=H;const J=H.applyToLocalDocumentSet(A,B);return v.documentOverlayCache.saveOverlays(V,H.batchId,J)})}).then(()=>({batchId:N.batchId,changes:Dre(A)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(f,E,v){let b=f.Wa[f.currentUser.toKey()];b||(b=new ps(pr)),b=b.insert(E,v),f.Wa[f.currentUser.toKey()]=b}(a,l.batchId,s),await iC(a,l.changes),await D1(a.remoteStore)}catch(l){const d=xj(l,"Failed to persist write");s.reject(d)}}async function Eie(n,t){const s=Jn(n);try{const a=await _4e(s.localStore,t);t.targetChanges.forEach((l,d)=>{const f=s.Ua.get(d);f&&(oi(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?oi(f.Ba):l.removedDocuments.size>0&&(oi(f.Ba),f.Ba=!1))}),await iC(s,a,t)}catch(a){await D0(a)}}function PX(n,t,s){const a=Jn(n);if(a.isPrimaryClient&&s===0||!a.isPrimaryClient&&s===1){const l=[];a.ka.forEach((d,f)=>{const E=f.view.sa(t);E.snapshot&&l.push(E.snapshot)}),function(f,E){const v=Jn(f);v.onlineState=E;let b=!1;v.queries.forEach((w,A)=>{for(const N of A.ta)N.sa(E)&&(b=!0)}),b&&Mj(v)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function s3e(n,t,s){const a=Jn(n);a.sharedClientState.updateQueryState(t,"rejected",s);const l=a.Ua.get(t),d=l&&l.key;if(d){let f=new ps(Sn.comparator);f=f.insert(d,za.newNoDocument(d,Kn.min()));const E=wr().add(d),v=new O1(Kn.min(),new Map,new ps(pr),f,E);await Eie(a,v),a.$a=a.$a.remove(d),a.Ua.delete(t),Vj(a)}else await lV(a.localStore,t,!1).then(()=>hV(a,t,s)).catch(D0)}async function o3e(n,t){const s=Jn(n),a=t.batch.batchId;try{const l=await g4e(s.localStore,t);vie(s,a,null),yie(s,a),s.sharedClientState.updateMutationState(a,"acknowledged"),await iC(s,l)}catch(l){await D0(l)}}async function a3e(n,t,s){const a=Jn(n);try{const l=await function(f,E){const v=Jn(f);return v.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let w;return v.mutationQueue.lookupMutationBatch(b,E).next(A=>(oi(A!==null),w=A.keys(),v.mutationQueue.removeMutationBatch(b,A))).next(()=>v.mutationQueue.performConsistencyCheck(b)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(b,w,E)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,w)).next(()=>v.localDocuments.getDocuments(b,w))})}(a.localStore,t);vie(a,t,s),yie(a,t),a.sharedClientState.updateMutationState(t,"rejected",s),await iC(a,l)}catch(l){await D0(l)}}function yie(n,t){(n.Ga.get(t)||[]).forEach(s=>{s.resolve()}),n.Ga.delete(t)}function vie(n,t,s){const a=Jn(n);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(s?d.reject(s):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function hV(n,t,s=null){n.sharedClientState.removeLocalQueryTarget(t);for(const a of n.qa.get(t))n.ka.delete(a),s&&n.La.Ja(a,s);n.qa.delete(t),n.isPrimaryClient&&n.Ka.br(t).forEach(a=>{n.Ka.containsKey(a)||Sie(n,a)})}function Sie(n,t){n.Qa.delete(t.path.canonicalString());const s=n.$a.get(t);s!==null&&(Oj(n.remoteStore,s),n.$a=n.$a.remove(t),n.Ua.delete(s),Vj(n))}function OX(n,t,s){for(const a of s)a instanceof mie?(n.Ka.addReference(a.key,t),c3e(n,a)):a instanceof gie?(Qt(Uj,"Document no longer in limbo: "+a.key),n.Ka.removeReference(a.key,t),n.Ka.containsKey(a.key)||Sie(n,a.key)):Wn()}function c3e(n,t){const s=t.key,a=s.path.canonicalString();n.$a.get(s)||n.Qa.has(a)||(Qt(Uj,"New document in limbo: "+s),n.Qa.add(a),Vj(n))}function Vj(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const t=n.Qa.values().next().value;n.Qa.delete(t);const s=new Sn(Ki.fromString(t)),a=n.za.next();n.Ua.set(a,new J4e(s)),n.$a=n.$a.insert(s,a),oie(n.remoteStore,new og(Xh(Sj(s.path)),a,"TargetPurposeLimboResolution",T1.ae))}}async function iC(n,t,s){const a=Jn(n),l=[],d=[],f=[];a.ka.isEmpty()||(a.ka.forEach((E,v)=>{f.push(a.Ha(v,t,s).then(b=>{var w;if((b||s)&&a.isPrimaryClient){const A=b?!b.fromCache:(w=s==null?void 0:s.targetChanges.get(v.targetId))===null||w===void 0?void 0:w.current;a.sharedClientState.updateQueryState(v.targetId,A?"current":"not-current")}if(b){l.push(b);const A=Aj.Yi(v.targetId,b);d.push(A)}}))}),await Promise.all(f),a.La.p_(l),await async function(v,b){const w=Jn(v);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",A=>bt.forEach(b,N=>bt.forEach(N.Hi,V=>w.persistence.referenceDelegate.addReference(A,N.targetId,V)).next(()=>bt.forEach(N.Ji,V=>w.persistence.referenceDelegate.removeReference(A,N.targetId,V)))))}catch(A){if(!L0(A))throw A;Qt(Pj,"Failed to update sequence numbers: "+A)}for(const A of b){const N=A.targetId;if(!A.fromCache){const V=w.Ts.get(N),j=V.snapshotVersion,B=V.withLastLimboFreeSnapshotVersion(j);w.Ts=w.Ts.insert(N,B)}}}(a.localStore,d))}async function l3e(n,t){const s=Jn(n);if(!s.currentUser.isEqual(t)){Qt(Uj,"User change. New user:",t.toKey());const a=await nie(s.localStore,t);s.currentUser=t,function(d,f){d.Ga.forEach(E=>{E.forEach(v=>{v.reject(new sn(Tt.CANCELLED,f))})}),d.Ga.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await iC(s,a.Rs)}}function u3e(n,t){const s=Jn(n),a=s.Ua.get(t);if(a&&a.Ba)return wr().add(a.key);{let l=wr();const d=s.qa.get(t);if(!d)return l;for(const f of d){const E=s.ka.get(f);l=l.unionWith(E.view.Sa)}return l}}function bie(n){const t=Jn(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Eie.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=u3e.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=s3e.bind(null,t),t.La.p_=K4e.bind(null,t.eventManager),t.La.Ja=q4e.bind(null,t.eventManager),t}function d3e(n){const t=Jn(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=o3e.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=a3e.bind(null,t),t}class Mk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=k1(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,s){return null}nu(t,s){return null}eu(t){return m4e(this.persistence,new h4e,t.initialUser,this.serializer)}Xa(t){return new tie(Ij.ri,this.serializer)}Za(t){return new b4e}async terminate(){var t,s;(t=this.gcScheduler)===null||t===void 0||t.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Mk.provider={build:()=>new Mk};class h3e extends Mk{constructor(t){super(),this.cacheSizeBytes=t}tu(t,s){oi(this.persistence.referenceDelegate instanceof Lk);const a=this.persistence.referenceDelegate.garbageCollector;return new Jje(a,t.asyncQueue,s)}Xa(t){const s=this.cacheSizeBytes!==void 0?Jc.withCacheSize(this.cacheSizeBytes):Jc.DEFAULT;return new tie(a=>Lk.ri(a,s),this.serializer)}}class pV{async initialize(t,s){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>PX(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=l3e.bind(null,this.syncEngine),await G4e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new $4e}()}createDatastore(t){const s=k1(t.databaseInfo.databaseId),a=function(d){return new I4e(d)}(t.databaseInfo);return function(d,f,E,v){return new k4e(d,f,E,v)}(t.authCredentials,t.appCheckCredentials,a,s)}createRemoteStore(t){return function(a,l,d,f,E){return new D4e(a,l,d,f,E)}(this.localStore,this.datastore,t.asyncQueue,s=>PX(this.syncEngine,s,0),function(){return TX.D()?new TX:new T4e}())}createSyncEngine(t,s){return function(l,d,f,E,v,b,w){const A=new Q4e(l,d,f,E,v,b);return w&&(A.ja=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,s)}async terminate(){var t,s;await async function(l){const d=Jn(l);Qt(OE,"RemoteStore shutting down."),d.W_.add(5),await rC(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}pV.provider={build:()=>new pV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tie{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):Lf("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,s){setTimeout(()=>{this.muted||t(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wg="FirestoreClient";class p3e{constructor(t,s,a,l,d){this.authCredentials=t,this.appCheckCredentials=s,this.asyncQueue=a,this.databaseInfo=l,this.user=Wa.UNAUTHENTICATED,this.clientId=hre.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async f=>{Qt(wg,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(a,f=>(Qt(wg,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Cf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(s){const a=xj(s,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function DM(n,t){n.asyncQueue.verifyOperationInProgress(),Qt(wg,"Initializing OfflineComponentProvider");const s=n.configuration;await t.initialize(s);let a=s.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await nie(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function kX(n,t){n.asyncQueue.verifyOperationInProgress();const s=await f3e(n);Qt(wg,"Initializing OnlineComponentProvider"),await t.initialize(s,n.configuration),n.setCredentialChangeListener(a=>RX(t.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>RX(t.remoteStore,l)),n._onlineComponents=t}async function f3e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Qt(wg,"Using user provided OfflineComponentProvider");try{await DM(n,n._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!function(l){return l.name==="FirebaseError"?l.code===Tt.FAILED_PRECONDITION||l.code===Tt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(s))throw s;d0("Error using user provided cache. Falling back to memory cache: "+s),await DM(n,new Mk)}}else Qt(wg,"Using default OfflineComponentProvider"),await DM(n,new h3e(void 0));return n._offlineComponents}async function wie(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Qt(wg,"Using user provided OnlineComponentProvider"),await kX(n,n._uninitializedComponentsProvider._online)):(Qt(wg,"Using default OnlineComponentProvider"),await kX(n,new pV))),n._onlineComponents}function m3e(n){return wie(n).then(t=>t.syncEngine)}async function Rie(n){const t=await wie(n),s=t.eventManager;return s.onListen=Z4e.bind(null,t.syncEngine),s.onUnlisten=n3e.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=e3e.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=r3e.bind(null,t.syncEngine),s}function g3e(n,t,s={}){const a=new Cf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,E,v,b){const w=new Tie({next:N=>{w.su(),f.enqueueAndForget(()=>pie(d,A));const V=N.docs.has(E);!V&&N.fromCache?b.reject(new sn(Tt.UNAVAILABLE,"Failed to get document because the client is offline.")):V&&N.fromCache&&v&&v.source==="server"?b.reject(new sn(Tt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(N)},error:N=>b.reject(N)}),A=new fie(Sj(E.path),w,{includeMetadataChanges:!0,Ta:!0});return hie(d,A)}(await Rie(n),n.asyncQueue,t,s,a)),a.promise}function _3e(n,t,s={}){const a=new Cf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,E,v,b){const w=new Tie({next:N=>{w.su(),f.enqueueAndForget(()=>pie(d,A)),N.fromCache&&v.source==="server"?b.reject(new sn(Tt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(N)},error:N=>b.reject(N)}),A=new fie(E,w,{includeMetadataChanges:!0,Ta:!0});return hie(d,A)}(await Rie(n),n.asyncQueue,t,s,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cie(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NX=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iie(n,t,s){if(!s)throw new sn(Tt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function E3e(n,t,s,a){if(t===!0&&a===!0)throw new sn(Tt.INVALID_ARGUMENT,`${n} and ${s} cannot be used together.`)}function DX(n){if(!Sn.isDocumentKey(n))throw new sn(Tt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function LX(n){if(Sn.isDocumentKey(n))throw new sn(Tt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function L1(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":Wn()}function tp(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new sn(Tt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=L1(n);throw new sn(Tt.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aie="firestore.googleapis.com",xX=!0;class MX{constructor(t){var s,a;if(t.host===void 0){if(t.ssl!==void 0)throw new sn(Tt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Aie,this.ssl=xX}else this.host=t.host,this.ssl=(s=t.ssl)!==null&&s!==void 0?s:xX;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=eie;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Yje)throw new sn(Tt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}E3e("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Cie((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new sn(Tt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new sn(Tt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new sn(Tt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class x1{constructor(t,s,a,l){this._authCredentials=t,this._appCheckCredentials=s,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new MX({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new sn(Tt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new sn(Tt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new MX(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new CFe;switch(a.type){case"firstParty":return new OFe(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new sn(Tt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const a=NX.get(s);a&&(Qt("ComponentProvider","Removing Datastore"),NX.delete(s),a.terminate())}(this),Promise.resolve()}}function y3e(n,t,s,a={}){var l;const d=(n=tp(n,x1))._getSettings(),f=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),E=`${t}:${s}`;d.host!==Aie&&d.host!==E&&d0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:E,ssl:!1,emulatorOptions:a});if(!kf(v,f)&&(n._setSettings(v),a.mockUserToken)){let b,w;if(typeof a.mockUserToken=="string")b=a.mockUserToken,w=Wa.MOCK_USER;else{b=mne(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const A=a.mockUserToken.sub||a.mockUserToken.user_id;if(!A)throw new sn(Tt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new Wa(A)}n._authCredentials=new IFe(new ure(b,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M0{constructor(t,s,a){this.converter=s,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new M0(this.firestore,t,this._query)}}class mc{constructor(t,s,a){this.converter=s,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new dg(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new mc(this.firestore,t,this._key)}}class dg extends M0{constructor(t,s,a){super(t,s,Sj(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new mc(this.firestore,null,new Sn(t))}withConverter(t){return new dg(this.firestore,t,this._path)}}function y0(n,t,...s){if(n=rs(n),Iie("collection","path",t),n instanceof x1){const a=Ki.fromString(t,...s);return LX(a),new dg(n,null,a)}{if(!(n instanceof mc||n instanceof dg))throw new sn(Tt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Ki.fromString(t,...s));return LX(a),new dg(n.firestore,null,a)}}function Pi(n,t,...s){if(n=rs(n),arguments.length===1&&(t=hre.newId()),Iie("doc","path",t),n instanceof x1){const a=Ki.fromString(t,...s);return DX(a),new mc(n,null,new Sn(a))}{if(!(n instanceof mc||n instanceof dg))throw new sn(Tt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Ki.fromString(t,...s));return DX(a),new mc(n.firestore,n instanceof dg?n.converter:null,new Sn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UX="AsyncQueue";class VX{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new iie(this,"async_queue_retry"),this.Su=()=>{const a=NM();a&&Qt(UX,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.bu=t;const s=NM();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const s=NM();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.Su)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const s=new Cf;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!L0(t))throw t;Qt(UX,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const s=this.bu.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(f){let E=f.message||"";return f.stack&&(E=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),E}(a);throw Lf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.bu=s,s}enqueueAfterDelay(t,s,a){this.Du(),this.wu.indexOf(t)>-1&&(s=0);const l=Lj.createAndSchedule(this,t,s,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&Wn()}verifyOperationInProgress(){}async Mu(){let t;do t=this.bu,await t;while(t!==this.bu)}xu(t){for(const s of this.fu)if(s.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((s,a)=>s.targetTimeMs-a.targetTimeMs);for(const s of this.fu)if(s.skipDelay(),t!=="all"&&s.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const s=this.fu.indexOf(t);this.fu.splice(s,1)}}class U0 extends x1{constructor(t,s,a,l){super(t,s,a,l),this.type="firestore",this._queue=new VX,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new VX(t),this._firestoreClient=void 0,await t}}}function fV(n,t){const s=typeof n=="object"?n:oj(),a=typeof n=="string"?n:Ik,l=y1(s,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=hne("firestore");d&&y3e(l,...d)}return l}function Fj(n){if(n._terminated)throw new sn(Tt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||v3e(n),n._firestoreClient}function v3e(n){var t,s,a;const l=n._freezeSettings(),d=function(E,v,b,w){return new HFe(E,v,b,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,Cie(w.experimentalLongPollingOptions),w.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((s=l.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new p3e(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(E){const v=E==null?void 0:E._online.build();return{_offline:E==null?void 0:E._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v0{constructor(t){this._byteString=t}static fromBase64String(t){try{return new v0(ha.fromBase64String(t))}catch(s){throw new sn(Tt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(t){return new v0(ha.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M1{constructor(...t){for(let s=0;s<t.length;++s)if(t[s].length===0)throw new sn(Tt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new aa(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sC{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jj{constructor(t,s){if(!isFinite(t)||t<-90||t>90)throw new sn(Tt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(s)||s<-180||s>180)throw new sn(Tt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=t,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return pr(this._lat,t._lat)||pr(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bj{constructor(t){this._values=(t||[]).map(s=>s)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S3e=/^__.*__$/;class b3e{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return this.fieldMask!==null?new Og(t,this.data,this.fieldMask,s,this.fieldTransforms):new tC(t,this.data,s,this.fieldTransforms)}}class Pie{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return new Og(t,this.data,this.fieldMask,s,this.fieldTransforms)}}function Oie(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Wn()}}class U1{constructor(t,s,a,l,d,f){this.settings=t,this.databaseId=s,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new U1(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Uu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Ku(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return Uk(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(s=>t.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>t.isPrefixOf(s.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(Oie(this.Lu)&&S3e.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class T3e{constructor(t,s,a){this.databaseId=t,this.ignoreUndefinedProperties=s,this.serializer=a||k1(t)}ju(t,s,a,l=!1){return new U1({Lu:t,methodName:s,zu:a,path:aa.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function V1(n){const t=n._freezeSettings(),s=k1(n._databaseId);return new T3e(n._databaseId,!!t.ignoreUndefinedProperties,s)}function kie(n,t,s,a,l,d={}){const f=n.ju(d.merge||d.mergeFields?2:0,t,s,l);Gj("Data must be an object, but it was:",f,a);const E=Die(a,f);let v,b;if(d.merge)v=new Nl(f.fieldMask),b=f.fieldTransforms;else if(d.mergeFields){const w=[];for(const A of d.mergeFields){const N=mV(t,A,s);if(!f.contains(N))throw new sn(Tt.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);xie(w,N)||w.push(N)}v=new Nl(w),b=f.fieldTransforms.filter(A=>v.covers(A.field))}else v=null,b=f.fieldTransforms;return new b3e(new Zc(E),v,b)}class F1 extends sC{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof F1}}function Nie(n,t,s){return new U1({Lu:3,zu:t.settings.zu,methodName:n._methodName,Qu:s},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class Wj extends sC{constructor(t,s){super(t),this.Hu=s}_toFieldTransform(t){const s=Nie(this,t,!0),a=this.Hu.map(d=>VE(d,s)),l=new m0(a);return new jre(t.path,l)}isEqual(t){return t instanceof Wj&&kf(this.Hu,t.Hu)}}class zj extends sC{constructor(t,s){super(t),this.Hu=s}_toFieldTransform(t){const s=Nie(this,t,!0),a=this.Hu.map(d=>VE(d,s)),l=new g0(a);return new jre(t.path,l)}isEqual(t){return t instanceof zj&&kf(this.Hu,t.Hu)}}function w3e(n,t,s,a){const l=n.ju(1,t,s);Gj("Data must be an object, but it was:",l,a);const d=[],f=Zc.empty();Pg(a,(v,b)=>{const w=Hj(t,v,s);b=rs(b);const A=l.Uu(w);if(b instanceof F1)d.push(w);else{const N=VE(b,A);N!=null&&(d.push(w),f.set(w,N))}});const E=new Nl(d);return new Pie(f,E,l.fieldTransforms)}function R3e(n,t,s,a,l,d){const f=n.ju(1,t,s),E=[mV(t,a,s)],v=[l];if(d.length%2!=0)throw new sn(Tt.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<d.length;N+=2)E.push(mV(t,d[N])),v.push(d[N+1]);const b=[],w=Zc.empty();for(let N=E.length-1;N>=0;--N)if(!xie(b,E[N])){const V=E[N];let j=v[N];j=rs(j);const B=f.Uu(V);if(j instanceof F1)b.push(V);else{const H=VE(j,B);H!=null&&(b.push(V),w.set(V,H))}}const A=new Nl(b);return new Pie(w,A,f.fieldTransforms)}function C3e(n,t,s,a=!1){return VE(s,n.ju(a?4:3,t))}function VE(n,t){if(Lie(n=rs(n)))return Gj("Unsupported field value:",t,n),Die(n,t);if(n instanceof sC)return function(a,l){if(!Oie(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let f=0;for(const E of a){let v=VE(E,l.Ku(f));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),f++}return{arrayValue:{values:d}}}(n,t)}return function(a,l){if((a=rs(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return fje(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=fo.fromDate(a);return{timestampValue:Dk(l.serializer,d)}}if(a instanceof fo){const d=new fo(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:Dk(l.serializer,d)}}if(a instanceof jj)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof v0)return{bytesValue:Kre(l.serializer,a._byteString)};if(a instanceof mc){const d=l.databaseId,f=a.firestore._databaseId;if(!f.isEqual(d))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:Rj(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof Bj)return function(f,E){return{mapValue:{fields:{[vre]:{stringValue:Sre},[Ak]:{arrayValue:{values:f.toArray().map(b=>{if(typeof b!="number")throw E.Wu("VectorValues must only contain numeric values.");return bj(E.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${L1(a)}`)}(n,t)}function Die(n,t){const s={};return fre(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Pg(n,(a,l)=>{const d=VE(l,t.qu(a));d!=null&&(s[a]=d)}),{mapValue:{fields:s}}}function Lie(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof fo||n instanceof jj||n instanceof v0||n instanceof mc||n instanceof sC||n instanceof Bj)}function Gj(n,t,s){if(!Lie(s)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(s)){const a=L1(s);throw a==="an object"?t.Wu(n+" a custom object"):t.Wu(n+" "+a)}}function mV(n,t,s){if((t=rs(t))instanceof M1)return t._internalPath;if(typeof t=="string")return Hj(n,t);throw Uk("Field path arguments must be of type string or ",n,!1,void 0,s)}const I3e=new RegExp("[~\\*/\\[\\]]");function Hj(n,t,s){if(t.search(I3e)>=0)throw Uk(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,s);try{return new M1(...t.split("."))._internalPath}catch{throw Uk(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,s)}}function Uk(n,t,s,a,l){const d=a&&!a.isEmpty(),f=l!==void 0;let E=`Function ${t}() called with invalid data`;s&&(E+=" (via `toFirestore()`)"),E+=". ";let v="";return(d||f)&&(v+=" (found",d&&(v+=` in field ${a}`),f&&(v+=` in document ${l}`),v+=")"),new sn(Tt.INVALID_ARGUMENT,E+n+v)}function xie(n,t){return n.some(s=>s.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mie{constructor(t,s,a,l,d){this._firestore=t,this._userDataWriter=s,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new mc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new A3e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const s=this._document.data.field($j("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s)}}}class A3e extends Mie{data(){return super.data()}}function $j(n,t){return typeof t=="string"?Hj(n,t):t instanceof M1?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P3e(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new sn(Tt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Kj{}class O3e extends Kj{}function FX(n,t,...s){let a=[];t instanceof Kj&&a.push(t),a=a.concat(s),function(d){const f=d.filter(v=>v instanceof qj).length,E=d.filter(v=>v instanceof j1).length;if(f>1||f>0&&E>0)throw new sn(Tt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class j1 extends O3e{constructor(t,s,a){super(),this._field=t,this._op=s,this._value=a,this.type="where"}static _create(t,s,a){return new j1(t,s,a)}_apply(t){const s=this._parse(t);return Uie(t._query,s),new M0(t.firestore,t.converter,rV(t._query,s))}_parse(t){const s=V1(t.firestore);return function(d,f,E,v,b,w,A){let N;if(b.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new sn(Tt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){WX(A,w);const j=[];for(const B of A)j.push(BX(v,d,B));N={arrayValue:{values:j}}}else N=BX(v,d,A)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||WX(A,w),N=C3e(E,f,A,w==="in"||w==="not-in");return eo.create(b,w,N)}(t._query,"where",s,t.firestore._databaseId,this._field,this._op,this._value)}}function jX(n,t,s){const a=t,l=$j("where",n);return j1._create(l,a,s)}class qj extends Kj{constructor(t,s){super(),this.type=t,this._queryConstraints=s}static _create(t,s){return new qj(t,s)}_parse(t){const s=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return s.length===1?s[0]:kd.create(s,this._getOperator())}_apply(t){const s=this._parse(t);return s.getFilters().length===0?t:(function(l,d){let f=l;const E=d.getFlattenedFilters();for(const v of E)Uie(f,v),f=rV(f,v)}(t._query,s),new M0(t.firestore,t.converter,rV(t._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function BX(n,t,s){if(typeof(s=rs(s))=="string"){if(s==="")throw new sn(Tt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pre(t)&&s.indexOf("/")!==-1)throw new sn(Tt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const a=t.path.child(Ki.fromString(s));if(!Sn.isDocumentKey(a))throw new sn(Tt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return tX(n,new Sn(a))}if(s instanceof mc)return tX(n,s._key);throw new sn(Tt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${L1(s)}.`)}function WX(n,t){if(!Array.isArray(n)||n.length===0)throw new sn(Tt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Uie(n,t){const s=function(l,d){for(const f of l)for(const E of f.getFlattenedFilters())if(d.indexOf(E.op)>=0)return E.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(s!==null)throw s===t.op?new sn(Tt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new sn(Tt.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}class k3e{convertValue(t,s="none"){switch(bg(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ws(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,s);case 5:return t.stringValue;case 6:return this.convertBytes(Sg(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,s);case 11:return this.convertObject(t.mapValue,s);case 10:return this.convertVectorValue(t.mapValue);default:throw Wn()}}convertObject(t,s){return this.convertObjectMap(t.fields,s)}convertObjectMap(t,s="none"){const a={};return Pg(t,(l,d)=>{a[l]=this.convertValue(d,s)}),a}convertVectorValue(t){var s,a,l;const d=(l=(a=(s=t.fields)===null||s===void 0?void 0:s[Ak].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(f=>Ws(f.doubleValue));return new Bj(d)}convertGeoPoint(t){return new jj(Ws(t.latitude),Ws(t.longitude))}convertArray(t,s){return(t.values||[]).map(a=>this.convertValue(a,s))}convertServerTimestamp(t,s){switch(s){case"previous":const a=R1(t);return a==null?null:this.convertValue(a,s);case"estimate":return this.convertTimestamp(IR(t));default:return null}}convertTimestamp(t){const s=vg(t);return new fo(s.seconds,s.nanos)}convertDocumentKey(t,s){const a=Ki.fromString(t);oi(Zre(a));const l=new AR(a.get(1),a.get(3)),d=new Sn(a.popFirst(5));return l.isEqual(s)||Lf(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vie(n,t,s){let a;return a=n?s&&(s.merge||s.mergeFields)?n.toFirestore(t,s):n.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mw{constructor(t,s){this.hasPendingWrites=t,this.fromCache=s}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Fie extends Mie{constructor(t,s,a,l,d,f){super(t,s,a,l,f),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const s=new XO(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,s={}){if(this._document){const a=this._document.data.field($j("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,s.serverTimestamps)}}}class XO extends Fie{data(t={}){return super.data(t)}}class N3e{constructor(t,s,a,l){this._firestore=t,this._userDataWriter=s,this._snapshot=l,this.metadata=new Mw(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(s=>t.push(s)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,s){this._snapshot.docs.forEach(a=>{t.call(s,new XO(this._firestore,this._userDataWriter,a.key,a,new Mw(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const s=!!t.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new sn(Tt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(E=>{const v=new XO(l._firestore,l._userDataWriter,E.doc.key,E.doc,new Mw(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);return E.doc,{type:"added",doc:v,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(E=>d||E.type!==3).map(E=>{const v=new XO(l._firestore,l._userDataWriter,E.doc.key,E.doc,new Mw(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,w=-1;return E.type!==0&&(b=f.indexOf(E.doc.key),f=f.delete(E.doc.key)),E.type!==1&&(f=f.add(E.doc),w=f.indexOf(E.doc.key)),{type:D3e(E.type),doc:v,oldIndex:b,newIndex:w}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function D3e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Wn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(n){n=tp(n,mc);const t=tp(n.firestore,U0);return g3e(Fj(t),n._key).then(s=>x3e(t,n,s))}class jie extends k3e{constructor(t){super(),this.firestore=t}convertBytes(t){return new v0(t)}convertReference(t){const s=this.convertDocumentKey(t,this.firestore._databaseId);return new mc(this.firestore,null,s)}}function OR(n){n=tp(n,M0);const t=tp(n.firestore,U0),s=Fj(t),a=new jie(t);return P3e(n._query),_3e(s,n._query).then(l=>new N3e(t,a,n,l))}function Vk(n,t,s){n=tp(n,mc);const a=tp(n.firestore,U0),l=Vie(n.converter,t,s);return Yj(a,[kie(V1(a),"setDoc",n._key,l,n.converter!==null,s).toMutation(n._key,Pd.none())])}function al(n,t,s,...a){n=tp(n,mc);const l=tp(n.firestore,U0),d=V1(l);let f;return f=typeof(t=rs(t))=="string"||t instanceof M1?R3e(d,"updateDoc",n._key,t,s,a):w3e(d,"updateDoc",n._key,t),Yj(l,[f.toMutation(n._key,Pd.exists(!0))])}function L3e(n,t){const s=tp(n.firestore,U0),a=Pi(n),l=Vie(n.converter,t);return Yj(s,[kie(V1(n.firestore),"addDoc",a._key,l,n.converter!==null,{}).toMutation(a._key,Pd.exists(!1))]).then(()=>a)}function Yj(n,t){return function(a,l){const d=new Cf;return a.asyncQueue.enqueueAndForget(async()=>i3e(await m3e(a),l,d)),d.promise}(Fj(n),t)}function x3e(n,t,s){const a=s.docs.get(t._key),l=new jie(n);return new Fie(n,l,t._key,a,new Mw(s.hasPendingWrites,s.fromCache),t.converter)}function M3e(...n){return new Wj("arrayUnion",n)}function U3e(...n){return new zj("arrayRemove",n)}(function(t,s=!0){(function(l){N0=l})(xE),CE(new Eg("firestore",(a,{instanceIdentifier:l,options:d})=>{const f=a.getProvider("app").getImmediate(),E=new U0(new AFe(a.getProvider("auth-internal")),new kFe(f,a.getProvider("app-check-internal")),function(b,w){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new sn(Tt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new AR(b.options.projectId,w)}(f,l),f);return d=Object.assign({useFetchStreams:s},d),E._setSettings(d),E},"PUBLIC").setMultipleInstances(!0)),Kh(zY,GY,t),Kh(zY,GY,"esm2017")})();var V3e="firebase",F3e="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Kh(V3e,F3e,"app");const j3e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"9442a472625f44e7b2c5065b9f9b3988",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"};console.log("Environment variables check:");console.log("VITE_FIREBASE_API_KEY exists:",!0);console.log("import.meta.env:",j3e);const Jm={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};console.log("Firebase config being used:",{apiKey:Jm.apiKey?`${Jm.apiKey.substring(0,5)}...`:"missing",authDomain:Jm.authDomain,projectId:Jm.projectId,storageBucket:Jm.storageBucket,messagingSenderId:Jm.messagingSenderId?"present":"missing",appId:Jm.appId?"present":"missing"});const Bie=Ene(Jm),Wie=rre(Bie),mi=fV(Bie),Nd=async n=>{try{he.log("userFirestore: Get user Profile data for user ID: "+n);const t=Pi(mi,"users",n),s=await ol(t);return s.exists()?(he.log("userFirestore: Found Profile for : "+s.data().Nickname),s.data()):(he.error("userFirestore: user profile document not found"),null)}catch(t){throw he.error("userFirestore: Error fetching user profile data:",t),t}},B3e=async(n,t,s)=>{try{he.log("userFirestore: Registering new user with email:",n);const l=(await lVe(Wie,n,t)).user;await YU(l),he.log("userFirestore: Verification email sent to:",n);const d={email:l.email,createdAt:new Date,groups:["users"],emailVerified:!1,...s};he.log("userFirestore: Creating user document with data:",d);const f=Pi(mi,"users",l.uid);return await Vk(f,d),he.log("userFirestore: User created successfully with groups:",d.groups),{...l,...d}}catch(a){throw he.error("userFirestore: Error creating user:",a),a}},zie=async(n,t)=>{try{he.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const s=Pi(mi,"users",n);await al(s,{rpmURL:t,lastUpdated:new Date().toISOString()}),he.log("userFirestore: rpmURL updated successfully.")}catch(s){throw he.error("userFirestore: Error updating rpmURL:",s),s}},W3e=async(n,t)=>{try{const s=await Nd(n);return s&&s.groups?s.groups.includes(t):!1}catch(s){return he.error("userFirestore: Error checking group membership:",s),!1}},z3e=(n,t)=>(he.log(`OVERRIDE: isSpaceOwner check for user ${n==null?void 0:n.uid} and space ${t} - Returning true`),!0),G3e=(n,t)=>{if(t==="users")return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${t} - Returning true`),!0;if(t==="disruptiveAdmin"){const a=["lppDQiMb3hhloApQ7llOtk5tckY2","XutdlDmDSncMBUw6vwlQGdkpjNr2","aMhQYu0ArucoNCc6pJJtyfRbn8k2","fJVBogzjtTQqUHnYCYLhTt6jBW13","9NrbbBoc2rOYQC3xAkRBDkig8eg1"].includes(n);return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and admin group ${t} - Returning ${a}`),a}return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${t} - Returning false`),!1},H3e=async(n,t)=>z3e(n,t),Gie=async(n,t)=>G3e(n,t),$3e=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Id={sendUserToUnity:"sendUserToUnity"};class K3e{constructor(){this.events={}}subscribe(t,s){this.events[t]||(this.events[t]=[]),this.events[t].push(s)}publish(t,s){const a=this.events[t];a?(a.forEach(l=>{l(s)}),he.log(`EventBus: Published event '${t}'`)):he.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,s){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(s);a>-1&&this.events[t].splice(a,1)}}const Ad=new K3e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hie="firebasestorage.googleapis.com",$ie="storageBucket",q3e=2*60*1e3,Y3e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds extends ip{constructor(t,s,a=0){super(LM(t),`Firebase Storage: ${s} (${LM(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ds.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return LM(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ns;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ns||(Ns={}));function LM(n){return"storage/"+n}function Xj(){const n="An unknown error occurred, please check the error payload for server response.";return new Ds(Ns.UNKNOWN,n)}function X3e(n){return new Ds(Ns.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function J3e(n){return new Ds(Ns.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Q3e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Ds(Ns.UNAUTHENTICATED,n)}function Z3e(){return new Ds(Ns.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function e5e(n){return new Ds(Ns.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function t5e(){return new Ds(Ns.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function n5e(){return new Ds(Ns.CANCELED,"User canceled the upload/download.")}function r5e(n){return new Ds(Ns.INVALID_URL,"Invalid URL '"+n+"'.")}function i5e(n){return new Ds(Ns.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function s5e(){return new Ds(Ns.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+$ie+"' property when initializing the app?")}function o5e(){return new Ds(Ns.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function a5e(){return new Ds(Ns.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function c5e(n){return new Ds(Ns.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function gV(n){return new Ds(Ns.INVALID_ARGUMENT,n)}function Kie(){return new Ds(Ns.APP_DELETED,"The Firebase app was deleted.")}function l5e(n){return new Ds(Ns.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function nR(n,t){return new Ds(Ns.INVALID_FORMAT,"String does not match format '"+n+"': "+t)}function cw(n){throw new Ds(Ns.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl{constructor(t,s){this.bucket=t,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,s){let a;try{a=Dl.makeFromUrl(t,s)}catch{return new Dl(t,"")}if(a.path==="")return a;throw i5e(t)}static makeFromUrl(t,s){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(ce){ce.path.charAt(ce.path.length-1)==="/"&&(ce.path_=ce.path_.slice(0,-1))}const f="(/(.*))?$",E=new RegExp("^gs://"+l+f,"i"),v={bucket:1,path:3};function b(ce){ce.path_=decodeURIComponent(ce.path)}const w="v[A-Za-z0-9_]+",A=s.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",V=new RegExp(`^https?://${A}/${w}/b/${l}/o${N}`,"i"),j={bucket:1,path:3},B=s===Hie?"(?:storage.googleapis.com|storage.cloud.google.com)":s,H="([^?#]*)",J=new RegExp(`^https?://${B}/${l}/${H}`,"i"),te=[{regex:E,indices:v,postModify:d},{regex:V,indices:j,postModify:b},{regex:J,indices:{bucket:1,path:2},postModify:b}];for(let ce=0;ce<te.length;ce++){const oe=te[ce],_e=oe.regex.exec(t);if(_e){const ne=_e[oe.indices.bucket];let ee=_e[oe.indices.path];ee||(ee=""),a=new Dl(ne,ee),oe.postModify(a);break}}if(a==null)throw r5e(t);return a}}class u5e{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d5e(n,t,s){let a=1,l=null,d=null,f=!1,E=0;function v(){return E===2}let b=!1;function w(...H){b||(b=!0,t.apply(null,H))}function A(H){l=setTimeout(()=>{l=null,n(V,v())},H)}function N(){d&&clearTimeout(d)}function V(H,...J){if(b){N();return}if(H){N(),w.call(null,H,...J);return}if(v()||f){N(),w.call(null,H,...J);return}a<64&&(a*=2);let te;E===1?(E=2,te=0):te=(a+Math.random())*1e3,A(te)}let j=!1;function B(H){j||(j=!0,N(),!b&&(l!==null?(H||(E=2),clearTimeout(l),A(0)):H||(E=1)))}return A(0),d=setTimeout(()=>{f=!0,B(!0)},s),B}function h5e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p5e(n){return n!==void 0}function f5e(n){return typeof n=="object"&&!Array.isArray(n)}function Jj(n){return typeof n=="string"||n instanceof String}function zX(n){return Qj()&&n instanceof Blob}function Qj(){return typeof Blob<"u"}function GX(n,t,s,a){if(a<t)throw gV(`Invalid value for '${n}'. Expected ${t} or greater.`);if(a>s)throw gV(`Invalid value for '${n}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B1(n,t,s){let a=t;return s==null&&(a=`https://${t}`),`${s}://${a}/v0${n}`}function qie(n){const t=encodeURIComponent;let s="?";for(const a in n)if(n.hasOwnProperty(a)){const l=t(a)+"="+t(n[a]);s=s+l+"&"}return s=s.slice(0,-1),s}var yE;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(yE||(yE={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m5e(n,t){const s=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=t.indexOf(n)!==-1;return s||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g5e{constructor(t,s,a,l,d,f,E,v,b,w,A,N=!0){this.url_=t,this.method_=s,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=f,this.callback_=E,this.errorCallback_=v,this.timeout_=b,this.progressCallback_=w,this.connectionFactory_=A,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((V,j)=>{this.resolve_=V,this.reject_=j,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new yO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const f=E=>{const v=E.loaded,b=E.lengthComputable?E.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,b)};this.progressCallback_!==null&&d.addUploadProgressListener(f),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(f),this.pendingConnection_=null;const E=d.getErrorCode()===yE.NO_ERROR,v=d.getStatus();if(!E||m5e(v,this.additionalRetryCodes_)&&this.retry){const w=d.getErrorCode()===yE.ABORT;a(!1,new yO(!1,null,w));return}const b=this.successCodes_.indexOf(v)!==-1;a(!0,new yO(b,d))})},s=(a,l)=>{const d=this.resolve_,f=this.reject_,E=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(E,E.getResponse());p5e(v)?d(v):d()}catch(v){f(v)}else if(E!==null){const v=Xj();v.serverResponse=E.getErrorText(),this.errorCallback_?f(this.errorCallback_(E,v)):f(v)}else if(l.canceled){const v=this.appDelete_?Kie():n5e();f(v)}else{const v=t5e();f(v)}};this.canceled_?s(!1,new yO(!1,null,!0)):this.backoffId_=d5e(t,s,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&h5e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class yO{constructor(t,s,a){this.wasSuccessCode=t,this.connection=s,this.canceled=!!a}}function _5e(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function E5e(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function y5e(n,t){t&&(n["X-Firebase-GMPID"]=t)}function v5e(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function S5e(n,t,s,a,l,d,f=!0){const E=qie(n.urlParams),v=n.url+E,b=Object.assign({},n.headers);return y5e(b,t),_5e(b,s),E5e(b,d),v5e(b,a),new g5e(v,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b5e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function T5e(...n){const t=b5e();if(t!==void 0){const s=new t;for(let a=0;a<n.length;a++)s.append(n[a]);return s.getBlob()}else{if(Qj())return new Blob(n);throw new Ds(Ns.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function w5e(n,t,s){return n.webkitSlice?n.webkitSlice(t,s):n.mozSlice?n.mozSlice(t,s):n.slice?n.slice(t,s):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R5e(n){if(typeof atob>"u")throw c5e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class xM{constructor(t,s){this.data=t,this.contentType=s||null}}function C5e(n,t){switch(n){case jh.RAW:return new xM(Yie(t));case jh.BASE64:case jh.BASE64URL:return new xM(Xie(n,t));case jh.DATA_URL:return new xM(A5e(t),P5e(t))}throw Xj()}function Yie(n){const t=[];for(let s=0;s<n.length;s++){let a=n.charCodeAt(s);if(a<=127)t.push(a);else if(a<=2047)t.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(s<n.length-1&&(n.charCodeAt(s+1)&64512)===56320))t.push(239,191,189);else{const d=a,f=n.charCodeAt(++s);a=65536|(d&1023)<<10|f&1023,t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?t.push(239,191,189):t.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(t)}function I5e(n){let t;try{t=decodeURIComponent(n)}catch{throw nR(jh.DATA_URL,"Malformed data URL.")}return Yie(t)}function Xie(n,t){switch(n){case jh.BASE64:{const l=t.indexOf("-")!==-1,d=t.indexOf("_")!==-1;if(l||d)throw nR(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case jh.BASE64URL:{const l=t.indexOf("+")!==-1,d=t.indexOf("/")!==-1;if(l||d)throw nR(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let s;try{s=R5e(t)}catch(l){throw l.message.includes("polyfill")?l:nR(n,"Invalid character found")}const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}class Jie{constructor(t){this.base64=!1,this.contentType=null;const s=t.match(/^data:([^,]+)?,/);if(s===null)throw nR(jh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=s[1]||null;a!=null&&(this.base64=O5e(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=t.substring(t.indexOf(",")+1)}}function A5e(n){const t=new Jie(n);return t.base64?Xie(jh.BASE64,t.rest):I5e(t.rest)}function P5e(n){return new Jie(n).contentType}function O5e(n,t){return n.length>=t.length?n.substring(n.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ig{constructor(t,s){let a=0,l="";zX(t)?(this.data_=t,a=t.size,l=t.type):t instanceof ArrayBuffer?(s?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),a=this.data_.length):t instanceof Uint8Array&&(s?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),a=t.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(t,s){if(zX(this.data_)){const a=this.data_,l=w5e(a,t,s);return l===null?null:new ig(l)}else{const a=new Uint8Array(this.data_.buffer,t,s-t);return new ig(a,!0)}}static getBlob(...t){if(Qj()){const s=t.map(a=>a instanceof ig?a.data_:a);return new ig(T5e.apply(null,s))}else{const s=t.map(f=>Jj(f)?C5e(jh.RAW,f).data:f.data_);let a=0;s.forEach(f=>{a+=f.byteLength});const l=new Uint8Array(a);let d=0;return s.forEach(f=>{for(let E=0;E<f.length;E++)l[d++]=f[E]}),new ig(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qie(n){let t;try{t=JSON.parse(n)}catch{return null}return f5e(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k5e(n){if(n.length===0)return null;const t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function N5e(n,t){const s=t.split("/").filter(a=>a.length>0).join("/");return n.length===0?s:n+"/"+s}function Zie(n){const t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D5e(n,t){return t}class uc{constructor(t,s,a,l){this.server=t,this.local=s||t,this.writable=!!a,this.xform=l||D5e}}let vO=null;function L5e(n){return!Jj(n)||n.length<2?n:Zie(n)}function ese(){if(vO)return vO;const n=[];n.push(new uc("bucket")),n.push(new uc("generation")),n.push(new uc("metageneration")),n.push(new uc("name","fullPath",!0));function t(d,f){return L5e(f)}const s=new uc("name");s.xform=t,n.push(s);function a(d,f){return f!==void 0?Number(f):f}const l=new uc("size");return l.xform=a,n.push(l),n.push(new uc("timeCreated")),n.push(new uc("updated")),n.push(new uc("md5Hash",null,!0)),n.push(new uc("cacheControl",null,!0)),n.push(new uc("contentDisposition",null,!0)),n.push(new uc("contentEncoding",null,!0)),n.push(new uc("contentLanguage",null,!0)),n.push(new uc("contentType",null,!0)),n.push(new uc("metadata","customMetadata",!0)),vO=n,vO}function x5e(n,t){function s(){const a=n.bucket,l=n.fullPath,d=new Dl(a,l);return t._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:s})}function M5e(n,t,s){const a={};a.type="file";const l=s.length;for(let d=0;d<l;d++){const f=s[d];a[f.local]=f.xform(a,t[f.server])}return x5e(a,n),a}function tse(n,t,s){const a=Qie(t);return a===null?null:M5e(n,a,s)}function U5e(n,t,s,a){const l=Qie(t);if(l===null||!Jj(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const f=encodeURIComponent;return d.split(",").map(b=>{const w=n.bucket,A=n.fullPath,N="/b/"+f(w)+"/o/"+f(A),V=B1(N,s,a),j=qie({alt:"media",token:b});return V+j})[0]}function V5e(n,t){const s={},a=t.length;for(let l=0;l<a;l++){const d=t[l];d.writable&&(s[d.server]=n[d.local])}return JSON.stringify(s)}class Zj{constructor(t,s,a,l){this.url=t,this.method=s,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nse(n){if(!n)throw Xj()}function F5e(n,t){function s(a,l){const d=tse(n,l,t);return nse(d!==null),d}return s}function j5e(n,t){function s(a,l){const d=tse(n,l,t);return nse(d!==null),U5e(d,l,n.host,n._protocol)}return s}function rse(n){function t(s,a){let l;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?l=Z3e():l=Q3e():s.getStatus()===402?l=J3e(n.bucket):s.getStatus()===403?l=e5e(n.path):l=a,l.status=s.getStatus(),l.serverResponse=a.serverResponse,l}return t}function ise(n){const t=rse(n);function s(a,l){let d=t(a,l);return a.getStatus()===404&&(d=X3e(n.path)),d.serverResponse=l.serverResponse,d}return s}function B5e(n,t,s){const a=t.fullServerUrl(),l=B1(a,n.host,n._protocol),d="GET",f=n.maxOperationRetryTime,E=new Zj(l,d,j5e(n,s),f);return E.errorHandler=ise(t),E}function W5e(n,t){const s=t.fullServerUrl(),a=B1(s,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function f(v,b){}const E=new Zj(a,l,f,d);return E.successCodes=[200,204],E.errorHandler=ise(t),E}function z5e(n,t){return n&&n.contentType||t&&t.type()||"application/octet-stream"}function G5e(n,t,s){const a=Object.assign({},s);return a.fullPath=n.path,a.size=t.size(),a.contentType||(a.contentType=z5e(null,t)),a}function H5e(n,t,s,a,l){const d=t.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function E(){let te="";for(let ce=0;ce<2;ce++)te=te+Math.random().toString().slice(2);return te}const v=E();f["Content-Type"]="multipart/related; boundary="+v;const b=G5e(t,a,l),w=V5e(b,s),A="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+v+`\r
Content-Type: `+b.contentType+`\r
\r
`,N=`\r
--`+v+"--",V=ig.getBlob(A,a,N);if(V===null)throw o5e();const j={name:b.fullPath},B=B1(d,n.host,n._protocol),H="POST",J=n.maxUploadRetryTime,$=new Zj(B,H,F5e(n,s),J);return $.urlParams=j,$.headers=f,$.body=V.uploadData(),$.errorHandler=rse(t),$}class $5e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=yE.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=yE.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=yE.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,s,a,l){if(this.sent_)throw cw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(s,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw cw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw cw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw cw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw cw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class K5e extends $5e{initXhr(){this.xhr_.responseType="text"}}function e4(){return new K5e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{constructor(t,s){this._service=t,s instanceof Dl?this._location=s:this._location=Dl.makeFromUrl(s,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,s){return new kE(t,s)}get root(){const t=new Dl(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Zie(this._location.path)}get storage(){return this._service}get parent(){const t=k5e(this._location.path);if(t===null)return null;const s=new Dl(this._location.bucket,t);return new kE(this._service,s)}_throwIfRoot(t){if(this._location.path==="")throw l5e(t)}}function q5e(n,t,s){n._throwIfRoot("uploadBytes");const a=H5e(n.storage,n._location,ese(),new ig(t,!0),s);return n.storage.makeRequestWithTokens(a,e4).then(l=>({metadata:l,ref:n}))}function Y5e(n){n._throwIfRoot("getDownloadURL");const t=B5e(n.storage,n._location,ese());return n.storage.makeRequestWithTokens(t,e4).then(s=>{if(s===null)throw a5e();return s})}function X5e(n){n._throwIfRoot("deleteObject");const t=W5e(n.storage,n._location);return n.storage.makeRequestWithTokens(t,e4)}function J5e(n,t){const s=N5e(n._location.path,t),a=new Dl(n._location.bucket,s);return new kE(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q5e(n){return/^[A-Za-z]+:\/\//.test(n)}function Z5e(n,t){return new kE(n,t)}function sse(n,t){if(n instanceof t4){const s=n;if(s._bucket==null)throw s5e();const a=new kE(s,s._bucket);return t!=null?sse(a,t):a}else return t!==void 0?J5e(n,t):n}function eBe(n,t){if(t&&Q5e(t)){if(n instanceof t4)return Z5e(n,t);throw gV("To use ref(service, url), the first argument must be a Storage instance.")}else return sse(n,t)}function HX(n,t){const s=t==null?void 0:t[$ie];return s==null?null:Dl.makeFromBucketSpec(s,n)}function tBe(n,t,s,a={}){n.host=`${t}:${s}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:mne(l,n.app.options.projectId))}class t4{constructor(t,s,a,l,d){this.app=t,this._authProvider=s,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=Hie,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=q3e,this._maxUploadRetryTime=Y3e,this._requests=new Set,l!=null?this._bucket=Dl.makeFromBucketSpec(l,this._host):this._bucket=HX(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Dl.makeFromBucketSpec(this._url,t):this._bucket=HX(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){GX("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){GX("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const s=await t.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(kl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new kE(this,t)}_makeRequest(t,s,a,l,d=!0){if(this._deleted)return new u5e(Kie());{const f=S5e(t,this._appId,a,l,s,this._firebaseVersion,d);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(t,s){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,s,a,l).getPromise()}}const $X="@firebase/storage",KX="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ose="storage";function n4(n,t,s){return n=rs(n),q5e(n,t,s)}function W1(n){return n=rs(n),Y5e(n)}function r4(n){return n=rs(n),X5e(n)}function FE(n,t){return n=rs(n),eBe(n,t)}function jE(n=oj(),t){n=rs(n);const a=y1(n,ose).getImmediate({identifier:t}),l=hne("storage");return l&&nBe(a,...l),a}function nBe(n,t,s,a={}){tBe(n,t,s,a)}function rBe(n,{instanceIdentifier:t}){const s=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new t4(s,a,l,t,xE)}function iBe(){CE(new Eg(ose,rBe,"PUBLIC").setMultipleInstances(!0)),Kh($X,KX,""),Kh($X,KX,"esm2017")}iBe();const JO=async n=>{const t=jE(),s=FE(t,n);try{return await W1(s)}catch(a){throw he.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let NE={};const hg=async n=>{try{const t=Pi(mi,"spaces",n),s=await ol(t);if(s.exists()){let a=s.data();const l=a.name,d=a.description;if(a.webglBuildId){const f=Pi(mi,"webglBuilds",a.webglBuildId),E=await ol(f);if(E.exists()){const v=E.data();a={...a,...v,name:l||v.name,description:d||v.description}}else he.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await sBe(a),a=oBe(a),console.log("Space data:",a),he.log(`spacesFirestore: Caching space data for: ${n}`),NE[n]=a,a}else return he.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(t){throw he.error("spacesFirestore: Error fetching item data:",t),t}},sBe=async n=>{const s=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await JO(l))});return await Promise.all(s),n},oBe=n=>{const{gsUrlCode:t,gsUrlData:s,gsUrlFramework:a,gsUrlLoader:l,...d}=n;return{...d,codeUrl:t,dataUrl:s,frameworkUrl:a,loaderUrl:l}};let MM={};const ase=async n=>{he.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(MM[n])return he.log("spacesFirestore: Returning cached videos for space:",n),MM[n];const t=y0(mi,`spaces/${n}/videos`),s=await OR(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),MM[n]=a,a}catch(t){throw he.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},aBe=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and logoFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=jE(),a=Date.now(),l=t.name.split(".").pop(),d=`logo_${a}.${l}`,f=FE(s,`spaces/${n}/logo/${d}`);he.log(`Uploading logo for space ${n}`);const E=await n4(f,t),v=await W1(E.ref),b=Pi(mi,"spaces",n);return await al(b,{logoUrl:v,logoGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),he.log(`Successfully uploaded logo for space ${n}`),v}catch(s){throw he.error("Error uploading space logo:",s),s}},cBe=async n=>{try{const t=Pi(mi,"spaces",n),s=await ol(t);if(!s.exists())return he.warn(`No space found with ID: ${n}`),!1;const a=s.data();if(a.logoGsUrl){const l=jE(),d=FE(l,a.logoGsUrl);try{await r4(d),he.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(f){he.warn(`Could not delete logo file from storage: ${f.message}`)}}return await al(t,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),he.log(`Successfully removed logo for space ${n}`),!0}catch(t){throw he.error("Error deleting space logo:",t),t}},lBe=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=jE(),a=Date.now(),l=t.name.split(".").pop(),d=`background_${a}.${l}`,f=FE(s,`spaces/${n}/background/${d}`);he.log(`Uploading background for space ${n}`);const E=await n4(f,t),v=await W1(E.ref),b=Pi(mi,"spaces",n);return await al(b,{backgroundUrl:v,backgroundGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${E.ref.bucket}/${E.ref.fullPath}`,updatedAt:new Date().toISOString()}),he.log(`Successfully uploaded background for space ${n}`),v}catch(s){throw he.error("Error uploading space background:",s),s}},uBe=async n=>{try{const t=Pi(mi,"spaces",n),s=await ol(t);if(!s.exists())return he.warn(`No space found with ID: ${n}`),!1;const a=s.data();if(a.backgroundGsUrl){const l=jE(),d=FE(l,a.backgroundGsUrl);try{await r4(d),he.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(f){he.warn(`Could not delete background file from storage: ${f.message}`)}}return await al(t,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),he.log(`Successfully removed background references for space ${n}`),!0}catch(t){throw he.error("Error deleting space background:",t),t}},dBe=async(n,t)=>{try{he.log(`spacesFirestore: Updating settings for space: ${n}`,t);const s=Pi(mi,"spaces",n),a=await ol(s);if(!a.exists())throw new Error(`Space with ID ${n} not found`);const l=a.data(),d={...t,accessibleToAllUsers:t.accessibleToAllUsers!==void 0?t.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await al(s,d),NE[n]&&delete NE[n],he.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(s){throw he.error(`spacesFirestore: Error updating settings for space: ${n}`,s),s}},hBe=async(n,t)=>{try{he.log(`spacesFirestore: Setting accessibleToAllUsers=${t} for space: ${n}`);const s=Pi(mi,"spaces",n);if(!(await ol(s)).exists())throw new Error(`Space with ID ${n} not found`);await al(s,{accessibleToAllUsers:t,updatedAt:new Date().toISOString()}),NE[n]&&delete NE[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:t}})),he.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(s){throw he.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,s),s}},_V=async(n,t)=>{try{he.log(`spacesFirestore: Updating HLS stream for space: ${n}`,t);const s=Pi(mi,"spaces",n);if(!(await ol(s)).exists())throw new Error(`Space with ID ${n} not found`);const{streamUrl:l,playerIndex:d="0",enabled:f=!0,rtmpUrl:E="",streamKey:v=""}=t,b={HLSStreamURL:{streamUrl:l,playerIndex:d,enabled:f,rtmpUrl:E,streamKey:v,updatedAt:new Date().toISOString()},updatedAt:new Date().toISOString()};return await al(s,b),NE[n]&&delete NE[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceHLSStreamUpdated",{detail:{spaceId:n,streamUrl:l,playerIndex:d,enabled:f,rtmpUrl:E,streamKey:v}})),he.log(`spacesFirestore: Successfully updated HLS stream for space: ${n}`),!0}catch(s){throw he.error(`spacesFirestore: Error updating HLS stream for space: ${n}`,s),s}},cse=async n=>{try{he.log(`spacesFirestore: Getting HLS stream for space: ${n}`);const t=Pi(mi,"spaces",n),s=await ol(t);if(!s.exists())return he.warn(`spacesFirestore: Space with ID ${n} not found`),null;const a=s.data();return a.HLSStreamURL?(he.log(`spacesFirestore: Found HLS stream for space: ${n}`,a.HLSStreamURL),a.HLSStreamURL):(he.log(`spacesFirestore: No HLS stream found for space: ${n}`),null)}catch(t){throw he.error(`spacesFirestore: Error getting HLS stream for space: ${n}`,t),t}},cl=D.createContext(null),pBe=({children:n})=>{const[t,s]=D.useState(null),a=D.useRef(null),[l,d]=D.useState(!0),f=rre(),E=$=>$?$.Nickname?$.Nickname:`${$.firstName} ${$.lastName}`:"Anon";D.useEffect(()=>{const $=pVe(f,async te=>{if(he.log("UserProvider: Firebase onAuthStateChanged() fired"),te)try{const ce=await Nd(te.uid),oe=E(ce),_e={uid:te.uid,email:te.email,emailVerified:te.emailVerified,...ce,displayName:oe};console.log(_e),s(_e),a.current=_e,A(_e)}catch(ce){he.error("UserProvider: Error fetching user profile data:",ce)}else s(null),a.current=null;d(!1)});return()=>{$&&$()}},[]);const v=async($,te,ce)=>{try{const{firstName:oe,lastName:_e}=ce,ne=`${oe}${_e.charAt(0).toUpperCase()}`,ee={...ce,Nickname:ne,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",groups:["users"]},Q=await B3e($,te,ee),se=E(ee),pe={uid:Q.uid,email:Q.email,...ee,displayName:se};return s(pe),a.current=pe,he.log("UserProvider: User registered successfully with groups:",ee.groups),pe}catch(oe){throw he.error("UserProvider: Error creating user:",oe),oe}},b=async($,te)=>{try{const ce=await uVe(f,$,te);if(!ce.user.emailVerified)throw await YU(ce.user),he.log("UserProvider: Verification email sent again to:",$),new Error("Please verify your email before signing in. A new verification email has been sent.");const oe=await Nd(ce.user.uid),_e=E(oe),ne={uid:ce.user.uid,email:ce.user.email,emailVerified:ce.user.emailVerified,...oe,displayName:_e};s(ne),A(ne)}catch(ce){throw he.error("UserProvider: Error signing in:",ce),ce}},w=async()=>{try{await fVe(f),s(null),he.log("UserProvider: User signed out.")}catch($){throw he.error("UserProvider: Error signing out:",$),$}},A=()=>{const $=a.current;if($){const te=N($);he.log("UserProvider: sendUserToUnity() using the eventBus",te),Ad.publish(Id.sendUserToUnity,te)}else he.log("UserProvider: No current user to send to Unity.")},N=$=>{const te={};return[...$3e,"uid"].forEach(oe=>{$.hasOwnProperty(oe)&&(te[oe]=$[oe])}),te},V=async $=>!t||!t.uid?!1:await Gie(t.uid,$),j=async $=>{if(!t||!t.uid)return!1;try{const te=await hg($);if(te.usersAllowed.includes(t.uid)||te.userAdmin.includes(t.uid)||te.usersModerators.includes(t.uid))return!0;if(t.groups&&Array.isArray(t.groups)){const oe=`space_${$}_owners`,_e=`space_${$}_hosts`;if(t.groups.includes(oe)||t.groups.includes(_e))return he.log(`UserProvider: User ${t.uid} has access to space ${$} as owner/host`),!0}return te.accessibleToAllUsers===!0&&t.groups?t.groups.includes("users"):!1}catch(te){return he.error("UserProvider: Error verifying user access to space:",te),!1}},B=async $=>{if(!t||!t.uid)return!1;try{return(await hg($)).userAdmin.includes(t.uid)}catch(te){return he.error("UserProvider: Error verifying user admin status for space:",te),!1}},H=async $=>{if(!t||!t.uid)return!1;try{return(await hg($)).usersModerators.includes(t.uid)}catch(te){return he.error("UserProvider: Error verifying user moderator status for space:",te),!1}},J=async()=>{try{const $=f.currentUser;return $&&!$.emailVerified?(await YU($),he.log("UserProvider: Verification email resent to:",$.email),!0):!1}catch($){throw he.error("UserProvider: Error resending verification email:",$),$}};return C.jsx(cl.Provider,{value:{user:t,loading:l,register:v,signIn:b,signOut:w,sendUserToUnity:A,isUserInGroup:V,userHasAccessToSpace:j,userIsAdminOfSpace:B,userIsModeratorOfSpace:H,resendVerificationEmail:J},children:n})},lse=D.createContext(),Dd=()=>D.useContext(lse),fBe=({children:n})=>{const[t,s]=D.useState(!1),a=D.useRef(null),[l,d]=D.useState(!1);D.useEffect(()=>{const v=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const f=D.useCallback(v=>{a.current=v},[]),E=D.useCallback(()=>{const v=a.current;if(!v)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const w=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(w.webkitEnterFullscreen)try{w.webkitEnterFullscreen(),s(!0);return}catch(A){console.error("iOS fullscreen error:",A)}try{if(w.webkitRequestFullscreen){w.webkitRequestFullscreen(),s(!0);return}}catch(A){console.error("iOS fallback fullscreen error:",A)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),s(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),s(!0));return}catch(A){console.error("Android fullscreen error:",A)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{s(!1)}).catch(w=>console.error("Error exiting fullscreen:",w)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),s(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),s(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),s(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{s(!0)}).catch(w=>console.error("Error entering fullscreen:",w)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),s(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),s(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),s(!0))}catch(w){console.error("Fullscreen error:",w)}},[l]);return D.useEffect(()=>{const v=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s(!!b)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),C.jsx(lse.Provider,{value:{isFullscreen:t,toggleFullscreen:E,fullscreenRef:a,setFullscreenRef:f,isMobile:l},children:C.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})};var UM={},lw={},uw={},qX;function mBe(){if(qX)return uw;qX=1,Object.defineProperty(uw,"__esModule",{value:!0}),uw.useUnityCanvasId=void 0;var n=Au(),t=0,s="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[s,++t].join("-")},[]);return d};return uw.useUnityCanvasId=a,uw}var rf={},dw={},YX;function use(){if(YX)return dw;YX=1,Object.defineProperty(dw,"__esModule",{value:!0}),dw.UnityLoaderStatus=void 0;var n;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(n||(dw.UnityLoaderStatus=n={})),dw}var hw={},XX;function i4(){return XX||(XX=1,Object.defineProperty(hw,"__esModule",{value:!0}),hw.isBrowserEnvironment=void 0,hw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),hw}var JX;function gBe(){if(JX)return rf;JX=1;var n=rf&&rf.__awaiter||function(f,E,v,b){function w(A){return A instanceof v?A:new v(function(N){N(A)})}return new(v||(v=Promise))(function(A,N){function V(H){try{B(b.next(H))}catch(J){N(J)}}function j(H){try{B(b.throw(H))}catch(J){N(J)}}function B(H){H.done?A(H.value):w(H.value).then(V,j)}B((b=b.apply(f,E||[])).next())})},t=rf&&rf.__generator||function(f,E){var v={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},b,w,A,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=V(0),N.throw=V(1),N.return=V(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function V(B){return function(H){return j([B,H])}}function j(B){if(b)throw new TypeError("Generator is already executing.");for(;N&&(N=0,B[0]&&(v=0)),v;)try{if(b=1,w&&(A=B[0]&2?w.return:B[0]?w.throw||((A=w.return)&&A.call(w),0):w.next)&&!(A=A.call(w,B[1])).done)return A;switch(w=0,A&&(B=[B[0]&2,A.value]),B[0]){case 0:case 1:A=B;break;case 4:return v.label++,{value:B[1],done:!1};case 5:v.label++,w=B[1],B=[0];continue;case 7:B=v.ops.pop(),v.trys.pop();continue;default:if(A=v.trys,!(A=A.length>0&&A[A.length-1])&&(B[0]===6||B[0]===2)){v=0;continue}if(B[0]===3&&(!A||B[1]>A[0]&&B[1]<A[3])){v.label=B[1];break}if(B[0]===6&&v.label<A[1]){v.label=A[1],A=B;break}if(A&&v.label<A[2]){v.label=A[2],v.ops.push(B);break}A[2]&&v.ops.pop(),v.trys.pop();continue}B=E.call(f,v)}catch(H){B=[6,H],w=0}finally{b=A=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(rf,"__esModule",{value:!0}),rf.useUnityInstance=void 0;var s=Au(),a=use(),l=i4(),d=function(f,E,v,b){(0,s.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var w,A;return t(this,function(N){switch(N.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==a.UnityLoaderStatus.Loaded||E===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,window.createUnityInstance(E,v,b.setLoadingProgression)];case 2:return w=N.sent(),b.setUnityInstance(w),b.setInitialisationError(null),[3,4];case 3:return A=N.sent(),b.setUnityInstance(null),b.setInitialisationError(A),[3,4];case 4:return[2]}})})})()},[f,E,v,b])};return rf.useUnityInstance=d,rf}var pw={},QX;function _Be(){if(QX)return pw;QX=1,Object.defineProperty(pw,"__esModule",{value:!0}),pw.useUnityArguments=void 0;var n=Au(),t=function(s){return(0,n.useMemo)(function(){return{dataUrl:s.unityProvider.unityConfig.dataUrl,frameworkUrl:s.unityProvider.unityConfig.frameworkUrl,codeUrl:s.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:s.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:s.unityProvider.unityConfig.memoryUrl,symbolsUrl:s.unityProvider.unityConfig.symbolsUrl,workerUrl:s.unityProvider.unityConfig.workerUrl,companyName:s.unityProvider.unityConfig.companyName,productName:s.unityProvider.unityConfig.productName,productVersion:s.unityProvider.unityConfig.productVersion,webglContextAttributes:s.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:s.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:s.devicePixelRatio||1,autoSyncPersistentDataPath:s.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof s.matchWebGLToCanvasSize=="boolean"?s.matchWebGLToCanvasSize:!0,disabledCanvasEvents:s.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return pw.useUnityArguments=t,pw}var fw={},ZX;function EBe(){if(ZX)return fw;ZX=1,Object.defineProperty(fw,"__esModule",{value:!0}),fw.useUnityLoader=void 0;var n=Au(),t=i4(),s=use(),a=function(l){var d=(0,n.useState)(s.UnityLoaderStatus.Loading),f=d[0],E=d[1];return(0,n.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){E(s.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):E(v.getAttribute("data-status")==="loaded"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error);var b=function(w){return E(w.type==="load"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error)};return v.addEventListener("load",b),v.addEventListener("error",b),function(){v!==null&&(v.removeEventListener("load",b),v.removeEventListener("error",b),window.document.body.removeChild(v))}}},[l.loaderUrl]),f};return fw.useUnityLoader=a,fw}var eJ;function yBe(){if(eJ)return lw;eJ=1,Object.defineProperty(lw,"__esModule",{value:!0}),lw.Unity=void 0;var n=Au(),t=Au(),s=mBe(),a=gBe(),l=_Be(),d=EBe(),f=(0,t.forwardRef)(function(E,v){var b=(0,t.useRef)(null),w=(0,s.useUnityCanvasId)(E),A=(0,l.useUnityArguments)(E),N=(0,d.useUnityLoader)(E.unityProvider.unityConfig);return(0,a.useUnityInstance)(N,b.current,A,E.unityProvider),(0,n.useImperativeHandle)(v,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:w,style:E.style,className:E.className,tabIndex:E.tabIndex})});return lw.Unity=f,lw}var sf={},mw={},tJ;function dse(){if(tJ)return mw;tJ=1,Object.defineProperty(mw,"__esModule",{value:!0}),mw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return mw.errorMessages=n,mw}var eE={},nJ;function vBe(){if(nJ)return eE;nJ=1;var n=eE&&eE.__spreadArray||function(E,v,b){if(b||arguments.length===2)for(var w=0,A=v.length,N;w<A;w++)(N||!(w in v))&&(N||(N=Array.prototype.slice.call(v,0,w)),N[w]=v[w]);return E.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(eE,"__esModule",{value:!0}),eE.useEventSystem=void 0;var t=Au(),s=dse(),a=i4(),l=[],d=function(E){for(var v=[],b=1;b<arguments.length;b++)v[b-1]=arguments[b];var w=void 0;return l.forEach(function(A){w=A.apply(void 0,n([E],v,!1))}),w};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var f=function(){var E=(0,t.useRef)([]),v=(0,t.useCallback)(function(A,N){E.current=n(n([],E.current,!0),[{eventName:A,callback:N}],!1)},[E]),b=(0,t.useCallback)(function(A,N){E.current=E.current.filter(function(V){return V.eventName!==A&&V.callback!==N})},[E]),w=(0,t.useCallback)(function(A){for(var N=[],V=1;V<arguments.length;V++)N[V-1]=arguments[V];var j=E.current.find(function(B){return B.eventName===A});if(typeof j>"u"){console.warn(s.errorMessages.noEventListener,{eventName:A});return}return j.callback.apply(j,N)},[E]);return(0,t.useEffect)(function(){return l.push(w),function(){l.splice(l.indexOf(w),1)}},[w]),{addEventListener:v,removeEventListener:b}};return eE.useEventSystem=f,eE}var gw={},rJ;function SBe(){if(rJ)return gw;rJ=1,Object.defineProperty(gw,"__esModule",{value:!0}),gw.useNullableState=void 0;var n=Au(),t=function(s){return(0,n.useState)(s||null)};return gw.useNullableState=t,gw}var iJ;function bBe(){if(iJ)return sf;iJ=1;var n=sf&&sf.__awaiter||function(E,v,b,w){function A(N){return N instanceof b?N:new b(function(V){V(N)})}return new(b||(b=Promise))(function(N,V){function j(J){try{H(w.next(J))}catch($){V($)}}function B(J){try{H(w.throw(J))}catch($){V($)}}function H(J){J.done?N(J.value):A(J.value).then(j,B)}H((w=w.apply(E,v||[])).next())})},t=sf&&sf.__generator||function(E,v){var b={label:0,sent:function(){if(N[0]&1)throw N[1];return N[1]},trys:[],ops:[]},w,A,N,V=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return V.next=j(0),V.throw=j(1),V.return=j(2),typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function j(H){return function(J){return B([H,J])}}function B(H){if(w)throw new TypeError("Generator is already executing.");for(;V&&(V=0,H[0]&&(b=0)),b;)try{if(w=1,A&&(N=H[0]&2?A.return:H[0]?A.throw||((N=A.return)&&N.call(A),0):A.next)&&!(N=N.call(A,H[1])).done)return N;switch(A=0,N&&(H=[H[0]&2,N.value]),H[0]){case 0:case 1:N=H;break;case 4:return b.label++,{value:H[1],done:!1};case 5:b.label++,A=H[1],H=[0];continue;case 7:H=b.ops.pop(),b.trys.pop();continue;default:if(N=b.trys,!(N=N.length>0&&N[N.length-1])&&(H[0]===6||H[0]===2)){b=0;continue}if(H[0]===3&&(!N||H[1]>N[0]&&H[1]<N[3])){b.label=H[1];break}if(H[0]===6&&b.label<N[1]){b.label=N[1],N=H;break}if(N&&b.label<N[2]){b.label=N[2],b.ops.push(H);break}N[2]&&b.ops.pop(),b.trys.pop();continue}H=v.call(E,b)}catch(J){H=[6,J],A=0}finally{w=N=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}};Object.defineProperty(sf,"__esModule",{value:!0}),sf.useUnityContext=void 0;var s=Au(),a=dse(),l=vBe(),d=SBe(),f=function(E){var v=(0,d.useNullableState)(),b=v[0],w=v[1],A=(0,s.useState)(0),N=A[0],V=A[1],j=(0,s.useState)(!1),B=j[0],H=j[1],J=(0,d.useNullableState)(),$=J[0],te=J[1],ce=(0,l.useEventSystem)(),oe=(0,s.useRef)({setLoadingProgression:V,setInitialisationError:te,setUnityInstance:w,setIsLoaded:H,unityConfig:E}),_e=(0,s.useCallback)(function(fe){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(fe===!0?1:0)},[b]),ne=(0,s.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),ee=(0,s.useCallback)(function(fe,ue,Me){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(fe,ue,Me)},[b]),Q=(0,s.useCallback)(function(fe,ue){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(fe,ue)},[b]),se=(0,s.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),pe=(0,s.useCallback)(function(){return n(void 0,void 0,void 0,function(){var fe;return t(this,function(ue){switch(ue.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(fe=b.Module.canvas,document.body.appendChild(fe),fe.style.display="none",[4,se()]);case 1:return ue.sent(),fe.remove(),[2]}})})},[b]);return(0,s.useEffect)(function(){H(N===1)},[N]),{unityProvider:oe.current,loadingProgression:N,initialisationError:$,isLoaded:B,UNSAFE__unityInstance:b,requestFullscreen:_e,requestPointerLock:ne,sendMessage:ee,takeScreenshot:Q,unload:se,UNSAFE__detachAndUnloadImmediate:pe,addEventListener:ce.addEventListener,removeEventListener:ce.removeEventListener}};return sf.useUnityContext=f,sf}var sJ;function TBe(){return sJ||(sJ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var t=yBe();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return t.Unity}});var s=bBe();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return s.useUnityContext}})}(UM)),UM}var hse=TBe();const Td="[UnityProvider]",EV=D.createContext(),wBe=({spaceID:n,children:t,loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:f,showLoginButton:E,showDisruptiveLogo:v})=>{he.log(`${Td} Initializing with spaceID:`,n),he.log(`${Td} Unity URLs:`,{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:V,removeEventListener:j,error:B}=hse.useUnityContext({loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d}),H={unityProvider:b,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:V,removeEventListener:j,error:B,spaceID:n},J=D.useRef(null),$=D.useRef(Date.now());D.useEffect(()=>{const _e=()=>{document.hidden?(he.log(`${Td} Page hidden, starting keep-alive`),te()):(he.log(`${Td} Page visible, stopping keep-alive`),ce())};return document.addEventListener("visibilitychange",_e),()=>{document.removeEventListener("visibilitychange",_e),ce()}},[]),D.useEffect(()=>{const _e=()=>{$.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",_e),window.addEventListener("keydown",_e),window.addEventListener("touchstart",_e),()=>{window.removeEventListener("mousemove",_e),window.removeEventListener("keydown",_e),window.removeEventListener("touchstart",_e)}},[N]);const te=()=>{J.current||(J.current=setInterval(()=>{A&&document.hidden&&(N("WebGLInputManager","KeepAlive"),he.debug(`${Td} Sent keep-alive message`))},1e4))},ce=()=>{J.current&&(clearInterval(J.current),J.current=null)};D.useEffect(()=>(he.log(`${Td} Component mounted`),()=>{he.log(`${Td} Component unmounting`),ce()}),[]),D.useEffect(()=>{he.log(`${Td} Loading progress:`,w)},[w]),D.useEffect(()=>{A&&(he.log(`${Td} Unity instance loaded for:`,n),document.hidden&&te())},[A,n]),D.useEffect(()=>{B&&he.error(`${Td} Unity error:`,B)},[B]),he.log(`${Td} Rendering provider with instance:`,H),D.useEffect(()=>{he.log("UnityProvider: Unity build URLs:",{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d})},[s,a,l,d]);const oe=[];if(s||oe.push("loaderUrl"),a||oe.push("dataUrl"),l||oe.push("frameworkUrl"),d||oe.push("codeUrl"),oe.length>0)return he.error(`UnityProvider: Missing required Unity build URLs: ${oe.join(", ")}`),C.jsx(EV.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${oe.join(", ")}`),spaceID:n},children:t});try{return D.useEffect(()=>{he.log("UnityProvider: Unity context created:",b),b?he.log("UnityProvider: Unity provider is available"):he.error("UnityProvider: Unity provider is not available"),A?he.log("UnityProvider: Unity is loaded"):he.log("UnityProvider: Unity is not loaded yet")},[b,A]),C.jsx(EV.Provider,{value:H,children:t})}catch(_e){return he.error("UnityProvider: Error creating Unity context:",_e),C.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[C.jsx("h3",{children:"Unity Error"}),C.jsxs("p",{children:["Error creating Unity context: ",_e.message]}),C.jsx("p",{children:"Please check the console for more details."})]})}},Ka=()=>D.useContext(EV),Ff=()=>{const{sendMessage:n,isLoaded:t}=Ka(),s=D.useRef([]),a=D.useCallback(()=>{if(t)for(;s.current.length>0;){const{eventName:d,data:f}=s.current.shift();he.log("useSendUnityEvent: Processing queued event to Unity:",d,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(f)}))}catch(E){he.error("useSendUnityEvent: Error sending event to Unity:",E),s.current.unshift({eventName:d,data:f});break}}},[n,t]);return D.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),D.useCallback((d,f)=>{he.log("useSendUnityEvent: Queuing event for Unity:",d),s.current.push({eventName:d,data:f}),a()},[a])},sp=()=>{const{addEventListener:n,removeEventListener:t}=Ka();return D.useCallback((s,a)=>{const l=d=>{he.log(s+" unity message received.");let f=null;if(d)try{f=JSON.parse(d)}catch(E){he.warn("Failed to parse JSON data from Unity message:",E)}a(f)};return n(s,l),()=>{t(s,l)}},[n,t])},RBe=()=>{const[n,t]=D.useState(!1),s=sp();return D.useEffect(()=>{const l=s("FirstSceneLoaded",()=>{he.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[s]),n},CBe=n=>{const[t,s]=D.useState(null),a=sp(),{spaceID:l}=Ka();return D.useEffect(()=>{let f=!0;const v=a("PlayVideo",async b=>{try{const{gameObjectName:w}=b;if(!w){he.error("Game object name is missing in Unity event data.");return}const A=await ase(l);he.log("SPACES VIDEOS",A);const N=A.find(V=>V.id===w);N&&f?(s(N.url),he.log("Video URL set to:",N.url)):console.error("Video not found for game object:",w)}catch(w){console.error("Error fetching space videos:",w)}});return()=>{f=!1,v()}},[a,l,n]),[t,()=>{s(null)}]},IBe=()=>{const n=sp(),{sendUserToUnity:t}=D.useContext(cl);return D.useEffect(()=>{const a=n("RequestUserForUnity",()=>{he.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[n,t]),!0},ABe=()=>{const{spaceID:n}=Ka(),t=Ff(),[s,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){he.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{he.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!s){he.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}he.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await ase(n),f=async b=>{const w=`https://vimeo.com/api/oembed.json?url=${b}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch thumbnail: ${A.statusText}`);const N=await A.json(),V=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let B=null;for(let H of j){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${V}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){B=J;break}}catch($){console.warn(`Failed to validate thumbnail URL: ${J}`,$)}}return B||N.thumbnail_url},E=d.map(async b=>{const w=await f(b.url);return{gameObjectName:b.id,thumbnailUrl:w}}),v=await Promise.all(E);he.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:b,thumbnailUrl:w})=>{t("SetThumbnail",{gameObjectName:b,thumbnailUrl:w})})}catch(d){he.error("Error fetching thumbnails:",d)}})()},[t,n,s])},PBe=()=>{const[n,t]=D.useState(null),s=sp();return console.log(" Nameplate click hook initialized"),D.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=s("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const E=typeof f=="string"?JSON.parse(f):f;t({playerName:E.playerName,playerId:E.playerId,uid:E.uid,isLocalPlayer:E.isLocalPlayer}),console.log(" Processed nameplate data:",E)}catch(E){console.error(" Error processing nameplate data:",E)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[s]),[n,()=>{console.log(" Resetting nameplate data"),t(null)}]},pse=()=>{const[n,t]=D.useState([]),s=sp();return D.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(he.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=V=>{if(a){he.log("UpdatePlayerList unity message received.");try{let j=[];if(typeof V=="object"&&V!==null?j=V.players||[]:j=JSON.parse(V).players||[],Array.isArray(j)){const B=Array.from(new Map(j.map(H=>[H.playerId,H])).values());t(B),l&&(clearTimeout(l),l=null)}}catch(j){he.error("Error handling player list data:",j),l||(l=setTimeout(d,1e3))}}},E=()=>{he.log("Player disconnected, requesting fresh player list"),d()},v=()=>{he.log("Player left, requesting fresh player list"),d()};d();const b=s("UpdatePlayerList",f),w=s("PlayerDisconnected",E),A=s("PlayerLeft",v),N=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof w=="function"&&w(),typeof A=="function"&&A(),clearInterval(N)}},[s]),n},fse=()=>{const[n,t]=D.useState({}),[s,a]=D.useState(!1),[l,d]=D.useState(null),[f,E]=D.useState(0),v=Ff(),b=sp(),{spaceID:w,sendMessage:A,isLoaded:N}=Ka(),V=D.useCallback((J,$)=>{if(!J)return;he.log(`useHLSStream: Sending stream URL to Unity: ${J} for player ${$}`);const te={identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:J};if(v("SetHLSStream",te),N&&A)try{he.log("useHLSStream: Sending with ReactIncomingEvent approach"),A("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(te)})),he.log("useHLSStream: Sending with direct HLSStream approach"),A("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:J})),he.log("useHLSStream: Sending with most direct approach possible"),A("LiveProjector","SetStreamUrl",J),A("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:$.toString(),Url:J}))}catch(ce){he.error("useHLSStream: Error with direct message:",ce)}else he.warn("useHLSStream: Unity not loaded, could not send direct message")},[v,A,N]);D.useEffect(()=>{w&&j(w)},[w]);const j=async J=>{try{if(!J){he.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}a(!0),he.log(`useHLSStream: Loading stream from Firebase for space ${J}`);const $=await cse(J);if($&&$.streamUrl)if(he.log(`useHLSStream: Loaded stream data from Firebase for space ${J}`,$),d($),N)he.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{V($.streamUrl,$.playerIndex||"0")},500),setTimeout(()=>{he.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),V($.streamUrl,$.playerIndex||"0")},2e3);else{he.warn("useHLSStream: Unity is not loaded yet, will try again later");const te=setInterval(()=>{N&&(he.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),V($.streamUrl,$.playerIndex||"0"),clearInterval(te))},1e3);setTimeout(()=>{clearInterval(te)},3e4)}else he.log(`useHLSStream: No saved stream found for space ${J}`),d(null)}catch($){he.error(`useHLSStream: Error loading stream from Firebase for space ${J}`,$)}finally{a(!1)}},B=D.useCallback(async()=>{w&&(he.log(`useHLSStream: Forcing reload of stream data for space ${w}`),E(J=>J+1),await j(w))},[w]),H=D.useCallback(async(J,$=0,te={})=>{try{if(!J||!J.trim()){he.error("useHLSStream: Invalid stream URL");return}a(!0),he.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${$}]`,J);const{enabled:ce=!0,rtmpUrl:oe="",streamKey:_e="",skipSendToUnity:ne=!1}=te;if(ne||V(J,$),w)try{const ee={streamUrl:J,playerIndex:$.toString(),enabled:ce,rtmpUrl:oe,streamKey:_e,updatedAt:new Date().toISOString()};he.log(`useHLSStream: Saving stream URL to Firebase for space ${w}`,ee),await _V(w,ee),d(ee)}catch(ee){throw he.error(`useHLSStream: Error saving stream URL to Firebase for space ${w}`,ee),ee}else he.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{a(!1)}},[V,w]);return D.useEffect(()=>{const $=b("SetHLSStream",te=>{if(te)try{he.log("useHLSStream: Received player status update",te);const{identifier:ce,playerIndex:oe,isReady:_e,isPlaying:ne}=te,ee=`${ce}_${oe}`;t(Q=>({...Q,[ee]:{identifier:ce,playerIndex:oe,isReady:_e,isPlaying:ne}}))}catch(ce){he.error("useHLSStream: Error handling player status update",ce)}});return()=>{$()}},[b]),D.useEffect(()=>{if(l&&l.streamUrl){he.log("useHLSStream: Resending saved stream URL to Unity");const J=setTimeout(()=>{V(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(J)}},[l,n,V,f]),D.useEffect(()=>{const J=$=>{if($.detail){if(he.log("useHLSStream: Received stream update event",$.detail),w===$.detail.spaceId)he.log(`useHLSStream: Stream update is for our space ${w}, loading stream data`),j(w);else if($.detail.streamUrl){he.log(`useHLSStream: Using stream URL directly from event: ${$.detail.streamUrl}`);const te=$.detail.playerIndex||"0";V($.detail.streamUrl,te),d($.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",J),window.addEventListener("SpaceStreamUpdated",J),()=>{window.removeEventListener("SpaceHLSStreamUpdated",J),window.removeEventListener("SpaceStreamUpdated",J)}},[w,V]),{setHLSStreamUrl:H,playerStatus:n,isLoading:s,savedStreamData:l,reloadStreamData:B}},oJ=async(n,t,s,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:f=null}=a;if(!n||!t)throw new Error("Missing required parameters: spaceId and mediaScreenId");let E=null;if(s){if(!s.type.startsWith("image/"))throw new Error("File must be an image");const v=jE(),b=Date.now(),w=s.name.split(".").pop(),A=`${t}_${b}.${w}`,N=FE(v,`spaces/${n}/mediaScreens/${A}`);he.log(`Uploading image for media screen ${t} in space ${n}`);const V=await n4(N,s);E=await W1(V.ref);const j=Pi(mi,`spaces/${n}/mediaScreens`,t);await Vk(j,{imageUrl:E,gsUrl:`gs://${V.ref.bucket}/${V.ref.fullPath}`,fileName:A,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){E=f;const v=Pi(mi,`spaces/${n}/mediaScreens`,t);await Vk(v,{videoUrl:f,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return he.log(`Successfully uploaded ${l} for media screen ${t} (display as video: ${d})`),E}catch(l){throw he.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},s4=async n=>{he.log(`Getting media screen images for space: ${n}`);try{const t=y0(mi,`spaces/${n}/mediaScreens`),s=await OR(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(t){throw he.error("Error fetching media screen images from Firestore:",t),t}},Ef=async(n,t)=>{try{const s=Pi(mi,`spaces/${n}/mediaScreens`,t),a=await ol(s);return a.exists()?{id:a.id,...a.data()}:(he.warn(`No media screen found with ID: ${t}`),null)}catch(s){throw he.error("Error fetching media screen image:",s),s}},OBe=async(n,t)=>{try{const s=await Ef(n,t);if(!s)return he.warn(`No media screen found with ID: ${t} to delete`),!1;if(s.gsUrl){const l=jE(),d=FE(l,s.gsUrl);try{await r4(d),he.log(`Deleted file from storage: ${s.gsUrl}`)}catch(f){he.warn(`Could not delete file from storage: ${f.message}`)}}const a=Pi(mi,`spaces/${n}/mediaScreens`,t);return s.mediaType==="video"?(await al(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),he.log(`Successfully removed video for media screen ${t}`)):(await al(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),he.log(`Successfully removed image for media screen ${t}`)),!0}catch(s){throw he.error("Error deleting media screen image:",s),s}},kBe=async(n,t,s)=>{try{if(!n||!t||typeof s!="boolean")throw new Error("Missing or invalid required parameters");const a=await Ef(n,t);if(!a||!a.imageUrl&&!a.videoUrl)return he.warn(`No media screen content found with ID: ${t} to update`),!1;const l=Pi(mi,`spaces/${n}/mediaScreens`,t);return await al(l,{displayAsVideo:s,updatedAt:new Date().toISOString()}),he.log(`Successfully updated display mode for media screen ${t} to ${s?"video":"image"}`),!0}catch(a){throw he.error("Error updating media screen display mode:",a),a}},NBe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},mse=()=>{const{spaceID:n}=Ka(),t=Ff(),[s,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){he.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{he.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!s){he.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}he.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await s4(n);he.log("Fetched Media Screen Images",d),d.forEach(f=>{const{id:E,imageUrl:v,displayAsVideo:b,videoUrl:w}=f;let A=null;(!b||!w)&&(A=v?NBe(v):null),t("SetMediaScreenImage",{mediaScreenId:E,imageUrl:A,videoUrl:w||null,displayAsVideo:b||!1,timestamp:Date.now()}),he.log(`Sent media screen data for ${E} to Unity (displayAsVideo: ${b})`),b&&w&&(t("SetMediaScreenDisplayMode",{mediaScreenId:E,displayAsVideo:!0,videoUrl:w,timestamp:Date.now()}),he.log(`Set display mode to video for screen ${E}`))})}catch(d){he.error("Error fetching media screen images:",d)}})()},[t,n,s])},DBe=n=>({opacity:1});var oC=n=>n.type==="checkbox",uE=n=>n instanceof Date,dc=n=>n==null;const gse=n=>typeof n=="object";var Hs=n=>!dc(n)&&!Array.isArray(n)&&gse(n)&&!uE(n),LBe=n=>Hs(n)&&n.target?oC(n.target)?n.target.checked:n.target.value:n,xBe=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,MBe=(n,t)=>n.has(xBe(t)),UBe=n=>{const t=n.constructor&&n.constructor.prototype;return Hs(t)&&t.hasOwnProperty("isPrototypeOf")},o4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function bu(n){let t;const s=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)t=new Date(n);else if(n instanceof Set)t=new Set(n);else if(!(o4&&(n instanceof Blob||a))&&(s||Hs(n)))if(t=s?[]:{},!s&&!UBe(n))t=n;else for(const l in n)n.hasOwnProperty(l)&&(t[l]=bu(n[l]));else return n;return t}var z1=n=>Array.isArray(n)?n.filter(Boolean):[],Js=n=>n===void 0,an=(n,t,s)=>{if(!t||!Hs(n))return s;const a=z1(t.split(/[,[\].]+?/)).reduce((l,d)=>dc(l)?l:l[d],n);return Js(a)||a===n?Js(n[t])?s:n[t]:a},Nh=n=>typeof n=="boolean",a4=n=>/^\w*$/.test(n),_se=n=>z1(n.replace(/["|']|\]/g,"").split(/\.|\[/)),$i=(n,t,s)=>{let a=-1;const l=a4(t)?[t]:_se(t),d=l.length,f=d-1;for(;++a<d;){const E=l[a];let v=s;if(a!==f){const b=n[E];v=Hs(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(E==="__proto__"||E==="constructor"||E==="prototype")return;n[E]=v,n=n[E]}return n};const aJ={BLUR:"blur",FOCUS_OUT:"focusout"},Cd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},of={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};si.createContext(null);var VBe=(n,t,s,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const f=d;return t._proxyFormState[f]!==Cd.all&&(t._proxyFormState[f]=!a||Cd.all),n[f]}});return l},Xc=n=>Hs(n)&&!Object.keys(n).length,FBe=(n,t,s,a)=>{s(n);const{name:l,...d}=n;return Xc(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(f=>t[f]===Cd.all)},QO=n=>Array.isArray(n)?n:[n];function jBe(n){const t=si.useRef(n);t.current=n,si.useEffect(()=>{const s=!n.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{s&&s.unsubscribe()}},[n.disabled])}var Bh=n=>typeof n=="string",BBe=(n,t,s,a,l)=>Bh(n)?(a&&t.watch.add(n),an(s,n,l)):Array.isArray(n)?n.map(d=>(a&&t.watch.add(d),an(s,d))):(a&&(t.watchAll=!0),s),WBe=(n,t,s,a,l)=>t?{...s[n],types:{...s[n]&&s[n].types?s[n].types:{},[a]:l||!0}}:{},cJ=n=>({isOnSubmit:!n||n===Cd.onSubmit,isOnBlur:n===Cd.onBlur,isOnChange:n===Cd.onChange,isOnAll:n===Cd.all,isOnTouch:n===Cd.onTouched}),lJ=(n,t,s)=>!s&&(t.watchAll||t.watch.has(n)||[...t.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const rR=(n,t,s,a)=>{for(const l of s||Object.keys(n)){const d=an(n,l);if(d){const{_f:f,...E}=d;if(f){if(f.refs&&f.refs[0]&&t(f.refs[0],l)&&!a)return!0;if(f.ref&&t(f.ref,f.name)&&!a)return!0;if(rR(E,t))break}else if(Hs(E)&&rR(E,t))break}}};var zBe=(n,t,s)=>{const a=QO(an(n,s));return $i(a,"root",t[s]),$i(n,s,a),n},c4=n=>n.type==="file",Uh=n=>typeof n=="function",Fk=n=>{if(!o4)return!1;const t=n?n.ownerDocument:0;return n instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},ZO=n=>Bh(n),l4=n=>n.type==="radio",jk=n=>n instanceof RegExp;const uJ={value:!1,isValid:!1},dJ={value:!0,isValid:!0};var Ese=n=>{if(Array.isArray(n)){if(n.length>1){const t=n.filter(s=>s&&s.checked&&!s.disabled).map(s=>s.value);return{value:t,isValid:!!t.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!Js(n[0].attributes.value)?Js(n[0].value)||n[0].value===""?dJ:{value:n[0].value,isValid:!0}:dJ:uJ}return uJ};const hJ={isValid:!1,value:null};var yse=n=>Array.isArray(n)?n.reduce((t,s)=>s&&s.checked&&!s.disabled?{isValid:!0,value:s.value}:t,hJ):hJ;function pJ(n,t,s="validate"){if(ZO(n)||Array.isArray(n)&&n.every(ZO)||Nh(n)&&!n)return{type:s,message:ZO(n)?n:"",ref:t}}var uS=n=>Hs(n)&&!jk(n)?n:{value:n,message:""},fJ=async(n,t,s,a,l,d)=>{const{ref:f,refs:E,required:v,maxLength:b,minLength:w,min:A,max:N,pattern:V,validate:j,name:B,valueAsNumber:H,mount:J}=n._f,$=an(s,B);if(!J||t.has(B))return{};const te=E?E[0]:f,ce=fe=>{l&&te.reportValidity&&(te.setCustomValidity(Nh(fe)?"":fe||""),te.reportValidity())},oe={},_e=l4(f),ne=oC(f),ee=_e||ne,Q=(H||c4(f))&&Js(f.value)&&Js($)||Fk(f)&&f.value===""||$===""||Array.isArray($)&&!$.length,se=WBe.bind(null,B,a,oe),pe=(fe,ue,Me,He=of.maxLength,nt=of.minLength)=>{const we=fe?ue:Me;oe[B]={type:fe?He:nt,message:we,ref:f,...se(fe?He:nt,we)}};if(d?!Array.isArray($)||!$.length:v&&(!ee&&(Q||dc($))||Nh($)&&!$||ne&&!Ese(E).isValid||_e&&!yse(E).isValid)){const{value:fe,message:ue}=ZO(v)?{value:!!v,message:v}:uS(v);if(fe&&(oe[B]={type:of.required,message:ue,ref:te,...se(of.required,ue)},!a))return ce(ue),oe}if(!Q&&(!dc(A)||!dc(N))){let fe,ue;const Me=uS(N),He=uS(A);if(!dc($)&&!isNaN($)){const nt=f.valueAsNumber||$&&+$;dc(Me.value)||(fe=nt>Me.value),dc(He.value)||(ue=nt<He.value)}else{const nt=f.valueAsDate||new Date($),we=Ne=>new Date(new Date().toDateString()+" "+Ne),Ce=f.type=="time",ve=f.type=="week";Bh(Me.value)&&$&&(fe=Ce?we($)>we(Me.value):ve?$>Me.value:nt>new Date(Me.value)),Bh(He.value)&&$&&(ue=Ce?we($)<we(He.value):ve?$<He.value:nt<new Date(He.value))}if((fe||ue)&&(pe(!!fe,Me.message,He.message,of.max,of.min),!a))return ce(oe[B].message),oe}if((b||w)&&!Q&&(Bh($)||d&&Array.isArray($))){const fe=uS(b),ue=uS(w),Me=!dc(fe.value)&&$.length>+fe.value,He=!dc(ue.value)&&$.length<+ue.value;if((Me||He)&&(pe(Me,fe.message,ue.message),!a))return ce(oe[B].message),oe}if(V&&!Q&&Bh($)){const{value:fe,message:ue}=uS(V);if(jk(fe)&&!$.match(fe)&&(oe[B]={type:of.pattern,message:ue,ref:f,...se(of.pattern,ue)},!a))return ce(ue),oe}if(j){if(Uh(j)){const fe=await j($,s),ue=pJ(fe,te);if(ue&&(oe[B]={...ue,...se(of.validate,ue.message)},!a))return ce(ue.message),oe}else if(Hs(j)){let fe={};for(const ue in j){if(!Xc(fe)&&!a)break;const Me=pJ(await j[ue]($,s),te,ue);Me&&(fe={...Me,...se(ue,Me.message)},ce(Me.message),a&&(oe[B]=fe))}if(!Xc(fe)&&(oe[B]={ref:te,...fe},!a))return oe}}return ce(!0),oe};function GBe(n,t){const s=t.slice(0,-1).length;let a=0;for(;a<s;)n=Js(n)?a++:n[t[a++]];return n}function HBe(n){for(const t in n)if(n.hasOwnProperty(t)&&!Js(n[t]))return!1;return!0}function po(n,t){const s=Array.isArray(t)?t:a4(t)?[t]:_se(t),a=s.length===1?n:GBe(n,s),l=s.length-1,d=s[l];return a&&delete a[d],l!==0&&(Hs(a)&&Xc(a)||Array.isArray(a)&&HBe(a))&&po(n,s.slice(0,-1)),n}var VM=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},yV=n=>dc(n)||!gse(n);function sg(n,t){if(yV(n)||yV(t))return n===t;if(uE(n)&&uE(t))return n.getTime()===t.getTime();const s=Object.keys(n),a=Object.keys(t);if(s.length!==a.length)return!1;for(const l of s){const d=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const f=t[l];if(uE(d)&&uE(f)||Hs(d)&&Hs(f)||Array.isArray(d)&&Array.isArray(f)?!sg(d,f):d!==f)return!1}}return!0}var vse=n=>n.type==="select-multiple",$Be=n=>l4(n)||oC(n),FM=n=>Fk(n)&&n.isConnected,Sse=n=>{for(const t in n)if(Uh(n[t]))return!0;return!1};function Bk(n,t={}){const s=Array.isArray(n);if(Hs(n)||s)for(const a in n)Array.isArray(n[a])||Hs(n[a])&&!Sse(n[a])?(t[a]=Array.isArray(n[a])?[]:{},Bk(n[a],t[a])):dc(n[a])||(t[a]=!0);return t}function bse(n,t,s){const a=Array.isArray(n);if(Hs(n)||a)for(const l in n)Array.isArray(n[l])||Hs(n[l])&&!Sse(n[l])?Js(t)||yV(s[l])?s[l]=Array.isArray(n[l])?Bk(n[l],[]):{...Bk(n[l])}:bse(n[l],dc(t)?{}:t[l],s[l]):s[l]=!sg(n[l],t[l]);return s}var _w=(n,t)=>bse(n,t,Bk(t)),Tse=(n,{valueAsNumber:t,valueAsDate:s,setValueAs:a})=>Js(n)?n:t?n===""?NaN:n&&+n:s&&Bh(n)?new Date(n):a?a(n):n;function jM(n){const t=n.ref;return c4(t)?t.files:l4(t)?yse(n.refs).value:vse(t)?[...t.selectedOptions].map(({value:s})=>s):oC(t)?Ese(n.refs).value:Tse(Js(t.value)?n.ref.value:t.value,n)}var KBe=(n,t,s,a)=>{const l={};for(const d of n){const f=an(t,d);f&&$i(l,d,f._f)}return{criteriaMode:s,names:[...n],fields:l,shouldUseNativeValidation:a}},Ew=n=>Js(n)?n:jk(n)?n.source:Hs(n)?jk(n.value)?n.value.source:n.value:n;const mJ="AsyncFunction";var qBe=n=>!!n&&!!n.validate&&!!(Uh(n.validate)&&n.validate.constructor.name===mJ||Hs(n.validate)&&Object.values(n.validate).find(t=>t.constructor.name===mJ)),YBe=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function gJ(n,t,s){const a=an(n,s);if(a||a4(s))return{error:a,name:s};const l=s.split(".");for(;l.length;){const d=l.join("."),f=an(t,d),E=an(n,d);if(f&&!Array.isArray(f)&&s!==d)return{name:s};if(E&&E.type)return{name:d,error:E};l.pop()}return{name:s}}var XBe=(n,t,s,a,l)=>l.isOnAll?!1:!s&&l.isOnTouch?!(t||n):(s?a.isOnBlur:l.isOnBlur)?!n:(s?a.isOnChange:l.isOnChange)?n:!0,JBe=(n,t)=>!z1(an(n,t)).length&&po(n,t);const QBe={mode:Cd.onSubmit,reValidateMode:Cd.onChange,shouldFocusError:!0};function ZBe(n={}){let t={...QBe,...n},s={submitCount:0,isDirty:!1,isLoading:Uh(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=Hs(t.defaultValues)||Hs(t.values)?bu(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:bu(l),f={action:!1,mount:!1,watch:!1},E={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,b=0;const w={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},A={values:VM(),array:VM(),state:VM()},N=cJ(t.mode),V=cJ(t.reValidateMode),j=t.criteriaMode===Cd.all,B=Re=>Fe=>{clearTimeout(b),b=setTimeout(Re,Fe)},H=async Re=>{if(!t.disabled&&(w.isValid||Re)){const Fe=t.resolver?Xc((await ee()).errors):await se(a,!0);Fe!==s.isValid&&A.state.next({isValid:Fe})}},J=(Re,Fe)=>{!t.disabled&&(w.isValidating||w.validatingFields)&&((Re||Array.from(E.mount)).forEach(We=>{We&&(Fe?$i(s.validatingFields,We,Fe):po(s.validatingFields,We))}),A.state.next({validatingFields:s.validatingFields,isValidating:!Xc(s.validatingFields)}))},$=(Re,Fe=[],We,ot,Et=!0,yt=!0)=>{if(ot&&We&&!t.disabled){if(f.action=!0,yt&&Array.isArray(an(a,Re))){const zt=We(an(a,Re),ot.argA,ot.argB);Et&&$i(a,Re,zt)}if(yt&&Array.isArray(an(s.errors,Re))){const zt=We(an(s.errors,Re),ot.argA,ot.argB);Et&&$i(s.errors,Re,zt),JBe(s.errors,Re)}if(w.touchedFields&&yt&&Array.isArray(an(s.touchedFields,Re))){const zt=We(an(s.touchedFields,Re),ot.argA,ot.argB);Et&&$i(s.touchedFields,Re,zt)}w.dirtyFields&&(s.dirtyFields=_w(l,d)),A.state.next({name:Re,isDirty:fe(Re,Fe),dirtyFields:s.dirtyFields,errors:s.errors,isValid:s.isValid})}else $i(d,Re,Fe)},te=(Re,Fe)=>{$i(s.errors,Re,Fe),A.state.next({errors:s.errors})},ce=Re=>{s.errors=Re,A.state.next({errors:s.errors,isValid:!1})},oe=(Re,Fe,We,ot)=>{const Et=an(a,Re);if(Et){const yt=an(d,Re,Js(We)?an(l,Re):We);Js(yt)||ot&&ot.defaultChecked||Fe?$i(d,Re,Fe?yt:jM(Et._f)):He(Re,yt),f.mount&&H()}},_e=(Re,Fe,We,ot,Et)=>{let yt=!1,zt=!1;const pn={name:Re};if(!t.disabled){const xn=!!(an(a,Re)&&an(a,Re)._f&&an(a,Re)._f.disabled);if(!We||ot){w.isDirty&&(zt=s.isDirty,s.isDirty=pn.isDirty=fe(),yt=zt!==pn.isDirty);const cn=xn||sg(an(l,Re),Fe);zt=!!(!xn&&an(s.dirtyFields,Re)),cn||xn?po(s.dirtyFields,Re):$i(s.dirtyFields,Re,!0),pn.dirtyFields=s.dirtyFields,yt=yt||w.dirtyFields&&zt!==!cn}if(We){const cn=an(s.touchedFields,Re);cn||($i(s.touchedFields,Re,We),pn.touchedFields=s.touchedFields,yt=yt||w.touchedFields&&cn!==We)}yt&&Et&&A.state.next(pn)}return yt?pn:{}},ne=(Re,Fe,We,ot)=>{const Et=an(s.errors,Re),yt=w.isValid&&Nh(Fe)&&s.isValid!==Fe;if(t.delayError&&We?(v=B(()=>te(Re,We)),v(t.delayError)):(clearTimeout(b),v=null,We?$i(s.errors,Re,We):po(s.errors,Re)),(We?!sg(Et,We):Et)||!Xc(ot)||yt){const zt={...ot,...yt&&Nh(Fe)?{isValid:Fe}:{},errors:s.errors,name:Re};s={...s,...zt},A.state.next(zt)}},ee=async Re=>{J(Re,!0);const Fe=await t.resolver(d,t.context,KBe(Re||E.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return J(Re),Fe},Q=async Re=>{const{errors:Fe}=await ee(Re);if(Re)for(const We of Re){const ot=an(Fe,We);ot?$i(s.errors,We,ot):po(s.errors,We)}else s.errors=Fe;return Fe},se=async(Re,Fe,We={valid:!0})=>{for(const ot in Re){const Et=Re[ot];if(Et){const{_f:yt,...zt}=Et;if(yt){const pn=E.array.has(yt.name),xn=Et._f&&qBe(Et._f);xn&&w.validatingFields&&J([ot],!0);const cn=await fJ(Et,E.disabled,d,j,t.shouldUseNativeValidation&&!Fe,pn);if(xn&&w.validatingFields&&J([ot]),cn[yt.name]&&(We.valid=!1,Fe))break;!Fe&&(an(cn,yt.name)?pn?zBe(s.errors,cn,yt.name):$i(s.errors,yt.name,cn[yt.name]):po(s.errors,yt.name))}!Xc(zt)&&await se(zt,Fe,We)}}return We.valid},pe=()=>{for(const Re of E.unMount){const Fe=an(a,Re);Fe&&(Fe._f.refs?Fe._f.refs.every(We=>!FM(We)):!FM(Fe._f.ref))&&Qe(Re)}E.unMount=new Set},fe=(Re,Fe)=>!t.disabled&&(Re&&Fe&&$i(d,Re,Fe),!sg(Te(),l)),ue=(Re,Fe,We)=>BBe(Re,E,{...f.mount?d:Js(Fe)?l:Bh(Re)?{[Re]:Fe}:Fe},We,Fe),Me=Re=>z1(an(f.mount?d:l,Re,t.shouldUnregister?an(l,Re,[]):[])),He=(Re,Fe,We={})=>{const ot=an(a,Re);let Et=Fe;if(ot){const yt=ot._f;yt&&(!yt.disabled&&$i(d,Re,Tse(Fe,yt)),Et=Fk(yt.ref)&&dc(Fe)?"":Fe,vse(yt.ref)?[...yt.ref.options].forEach(zt=>zt.selected=Et.includes(zt.value)):yt.refs?oC(yt.ref)?yt.refs.length>1?yt.refs.forEach(zt=>(!zt.defaultChecked||!zt.disabled)&&(zt.checked=Array.isArray(Et)?!!Et.find(pn=>pn===zt.value):Et===zt.value)):yt.refs[0]&&(yt.refs[0].checked=!!Et):yt.refs.forEach(zt=>zt.checked=zt.value===Et):c4(yt.ref)?yt.ref.value="":(yt.ref.value=Et,yt.ref.type||A.values.next({name:Re,values:{...d}})))}(We.shouldDirty||We.shouldTouch)&&_e(Re,Et,We.shouldTouch,We.shouldDirty,!0),We.shouldValidate&&Ne(Re)},nt=(Re,Fe,We)=>{for(const ot in Fe){const Et=Fe[ot],yt=`${Re}.${ot}`,zt=an(a,yt);(E.array.has(Re)||Hs(Et)||zt&&!zt._f)&&!uE(Et)?nt(yt,Et,We):He(yt,Et,We)}},we=(Re,Fe,We={})=>{const ot=an(a,Re),Et=E.array.has(Re),yt=bu(Fe);$i(d,Re,yt),Et?(A.array.next({name:Re,values:{...d}}),(w.isDirty||w.dirtyFields)&&We.shouldDirty&&A.state.next({name:Re,dirtyFields:_w(l,d),isDirty:fe(Re,yt)})):ot&&!ot._f&&!dc(yt)?nt(Re,yt,We):He(Re,yt,We),lJ(Re,E)&&A.state.next({...s}),A.values.next({name:f.mount?Re:void 0,values:{...d}})},Ce=async Re=>{f.mount=!0;const Fe=Re.target;let We=Fe.name,ot=!0;const Et=an(a,We),yt=()=>Fe.type?jM(Et._f):LBe(Re),zt=pn=>{ot=Number.isNaN(pn)||uE(pn)&&isNaN(pn.getTime())||sg(pn,an(d,We,pn))};if(Et){let pn,xn;const cn=yt(),dr=Re.type===aJ.BLUR||Re.type===aJ.FOCUS_OUT,pa=!YBe(Et._f)&&!t.resolver&&!an(s.errors,We)&&!Et._f.deps||XBe(dr,an(s.touchedFields,We),s.isSubmitted,V,N),Vt=lJ(We,E,dr);$i(d,We,cn),dr?(Et._f.onBlur&&Et._f.onBlur(Re),v&&v(0)):Et._f.onChange&&Et._f.onChange(Re);const on=_e(We,cn,dr,!1),Mi=!Xc(on)||Vt;if(!dr&&A.values.next({name:We,type:Re.type,values:{...d}}),pa)return w.isValid&&(t.mode==="onBlur"&&dr?H():dr||H()),Mi&&A.state.next({name:We,...Vt?{}:on});if(!dr&&Vt&&A.state.next({...s}),t.resolver){const{errors:fs}=await ee([We]);if(zt(cn),ot){const Ls=gJ(s.errors,a,We),Zr=gJ(fs,a,Ls.name||We);pn=Zr.error,We=Zr.name,xn=Xc(fs)}}else J([We],!0),pn=(await fJ(Et,E.disabled,d,j,t.shouldUseNativeValidation))[We],J([We]),zt(cn),ot&&(pn?xn=!1:w.isValid&&(xn=await se(a,!0)));ot&&(Et._f.deps&&Ne(Et._f.deps),ne(We,xn,pn,on))}},ve=(Re,Fe)=>{if(an(s.errors,Fe)&&Re.focus)return Re.focus(),1},Ne=async(Re,Fe={})=>{let We,ot;const Et=QO(Re);if(t.resolver){const yt=await Q(Js(Re)?Re:Et);We=Xc(yt),ot=Re?!Et.some(zt=>an(yt,zt)):We}else Re?(ot=(await Promise.all(Et.map(async yt=>{const zt=an(a,yt);return await se(zt&&zt._f?{[yt]:zt}:zt)}))).every(Boolean),!(!ot&&!s.isValid)&&H()):ot=We=await se(a);return A.state.next({...!Bh(Re)||w.isValid&&We!==s.isValid?{}:{name:Re},...t.resolver||!Re?{isValid:We}:{},errors:s.errors}),Fe.shouldFocus&&!ot&&rR(a,ve,Re?Et:E.mount),ot},Te=Re=>{const Fe={...f.mount?d:l};return Js(Re)?Fe:Bh(Re)?an(Fe,Re):Re.map(We=>an(Fe,We))},be=(Re,Fe)=>({invalid:!!an((Fe||s).errors,Re),isDirty:!!an((Fe||s).dirtyFields,Re),error:an((Fe||s).errors,Re),isValidating:!!an(s.validatingFields,Re),isTouched:!!an((Fe||s).touchedFields,Re)}),Ae=Re=>{Re&&QO(Re).forEach(Fe=>po(s.errors,Fe)),A.state.next({errors:Re?s.errors:{}})},Ue=(Re,Fe,We)=>{const ot=(an(a,Re,{_f:{}})._f||{}).ref,Et=an(s.errors,Re)||{},{ref:yt,message:zt,type:pn,...xn}=Et;$i(s.errors,Re,{...xn,...Fe,ref:ot}),A.state.next({name:Re,errors:s.errors,isValid:!1}),We&&We.shouldFocus&&ot&&ot.focus&&ot.focus()},Ge=(Re,Fe)=>Uh(Re)?A.values.subscribe({next:We=>Re(ue(void 0,Fe),We)}):ue(Re,Fe,!0),Qe=(Re,Fe={})=>{for(const We of Re?QO(Re):E.mount)E.mount.delete(We),E.array.delete(We),Fe.keepValue||(po(a,We),po(d,We)),!Fe.keepError&&po(s.errors,We),!Fe.keepDirty&&po(s.dirtyFields,We),!Fe.keepTouched&&po(s.touchedFields,We),!Fe.keepIsValidating&&po(s.validatingFields,We),!t.shouldUnregister&&!Fe.keepDefaultValue&&po(l,We);A.values.next({values:{...d}}),A.state.next({...s,...Fe.keepDirty?{isDirty:fe()}:{}}),!Fe.keepIsValid&&H()},tt=({disabled:Re,name:Fe,field:We,fields:ot})=>{(Nh(Re)&&f.mount||Re||E.disabled.has(Fe))&&(Re?E.disabled.add(Fe):E.disabled.delete(Fe),_e(Fe,jM(We?We._f:an(ot,Fe)._f),!1,!1,!0))},dt=(Re,Fe={})=>{let We=an(a,Re);const ot=Nh(Fe.disabled)||Nh(t.disabled);return $i(a,Re,{...We||{},_f:{...We&&We._f?We._f:{ref:{name:Re}},name:Re,mount:!0,...Fe}}),E.mount.add(Re),We?tt({field:We,disabled:Nh(Fe.disabled)?Fe.disabled:t.disabled,name:Re}):oe(Re,!0,Fe.value),{...ot?{disabled:Fe.disabled||t.disabled}:{},...t.progressive?{required:!!Fe.required,min:Ew(Fe.min),max:Ew(Fe.max),minLength:Ew(Fe.minLength),maxLength:Ew(Fe.maxLength),pattern:Ew(Fe.pattern)}:{},name:Re,onChange:Ce,onBlur:Ce,ref:Et=>{if(Et){dt(Re,Fe),We=an(a,Re);const yt=Js(Et.value)&&Et.querySelectorAll&&Et.querySelectorAll("input,select,textarea")[0]||Et,zt=$Be(yt),pn=We._f.refs||[];if(zt?pn.find(xn=>xn===yt):yt===We._f.ref)return;$i(a,Re,{_f:{...We._f,...zt?{refs:[...pn.filter(FM),yt,...Array.isArray(an(l,Re))?[{}]:[]],ref:{type:yt.type,name:Re}}:{ref:yt}}}),oe(Re,!1,void 0,yt)}else We=an(a,Re,{}),We._f&&(We._f.mount=!1),(t.shouldUnregister||Fe.shouldUnregister)&&!(MBe(E.array,Re)&&f.action)&&E.unMount.add(Re)}}},Ze=()=>t.shouldFocusError&&rR(a,ve,E.mount),wt=Re=>{Nh(Re)&&(A.state.next({disabled:Re}),rR(a,(Fe,We)=>{const ot=an(a,We);ot&&(Fe.disabled=ot._f.disabled||Re,Array.isArray(ot._f.refs)&&ot._f.refs.forEach(Et=>{Et.disabled=ot._f.disabled||Re}))},0,!1))},un=(Re,Fe)=>async We=>{let ot;We&&(We.preventDefault&&We.preventDefault(),We.persist&&We.persist());let Et=bu(d);if(E.disabled.size)for(const yt of E.disabled)$i(Et,yt,void 0);if(A.state.next({isSubmitting:!0}),t.resolver){const{errors:yt,values:zt}=await ee();s.errors=yt,Et=zt}else await se(a);if(po(s.errors,"root"),Xc(s.errors)){A.state.next({errors:{}});try{await Re(Et,We)}catch(yt){ot=yt}}else Fe&&await Fe({...s.errors},We),Ze(),setTimeout(Ze);if(A.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Xc(s.errors)&&!ot,submitCount:s.submitCount+1,errors:s.errors}),ot)throw ot},xt=(Re,Fe={})=>{an(a,Re)&&(Js(Fe.defaultValue)?we(Re,bu(an(l,Re))):(we(Re,Fe.defaultValue),$i(l,Re,bu(Fe.defaultValue))),Fe.keepTouched||po(s.touchedFields,Re),Fe.keepDirty||(po(s.dirtyFields,Re),s.isDirty=Fe.defaultValue?fe(Re,bu(an(l,Re))):fe()),Fe.keepError||(po(s.errors,Re),w.isValid&&H()),A.state.next({...s}))},tn=(Re,Fe={})=>{const We=Re?bu(Re):l,ot=bu(We),Et=Xc(Re),yt=Et?l:ot;if(Fe.keepDefaultValues||(l=We),!Fe.keepValues){if(Fe.keepDirtyValues){const zt=new Set([...E.mount,...Object.keys(_w(l,d))]);for(const pn of Array.from(zt))an(s.dirtyFields,pn)?$i(yt,pn,an(d,pn)):we(pn,an(yt,pn))}else{if(o4&&Js(Re))for(const zt of E.mount){const pn=an(a,zt);if(pn&&pn._f){const xn=Array.isArray(pn._f.refs)?pn._f.refs[0]:pn._f.ref;if(Fk(xn)){const cn=xn.closest("form");if(cn){cn.reset();break}}}}a={}}d=t.shouldUnregister?Fe.keepDefaultValues?bu(l):{}:bu(yt),A.array.next({values:{...yt}}),A.values.next({values:{...yt}})}E={mount:Fe.keepDirtyValues?E.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!w.isValid||!!Fe.keepIsValid||!!Fe.keepDirtyValues,f.watch=!!t.shouldUnregister,A.state.next({submitCount:Fe.keepSubmitCount?s.submitCount:0,isDirty:Et?!1:Fe.keepDirty?s.isDirty:!!(Fe.keepDefaultValues&&!sg(Re,l)),isSubmitted:Fe.keepIsSubmitted?s.isSubmitted:!1,dirtyFields:Et?{}:Fe.keepDirtyValues?Fe.keepDefaultValues&&d?_w(l,d):s.dirtyFields:Fe.keepDefaultValues&&Re?_w(l,Re):Fe.keepDirty?s.dirtyFields:{},touchedFields:Fe.keepTouched?s.touchedFields:{},errors:Fe.keepErrors?s.errors:{},isSubmitSuccessful:Fe.keepIsSubmitSuccessful?s.isSubmitSuccessful:!1,isSubmitting:!1})},kn=(Re,Fe)=>tn(Uh(Re)?Re(d):Re,Fe);return{control:{register:dt,unregister:Qe,getFieldState:be,handleSubmit:un,setError:Ue,_executeSchema:ee,_getWatch:ue,_getDirty:fe,_updateValid:H,_removeUnmounted:pe,_updateFieldArray:$,_updateDisabledField:tt,_getFieldArray:Me,_reset:tn,_resetDefaultValues:()=>Uh(t.defaultValues)&&t.defaultValues().then(Re=>{kn(Re,t.resetOptions),A.state.next({isLoading:!1})}),_updateFormState:Re=>{s={...s,...Re}},_disableForm:wt,_subjects:A,_proxyFormState:w,_setErrors:ce,get _fields(){return a},get _formValues(){return d},get _state(){return f},set _state(Re){f=Re},get _defaultValues(){return l},get _names(){return E},set _names(Re){E=Re},get _formState(){return s},set _formState(Re){s=Re},get _options(){return t},set _options(Re){t={...t,...Re}}},trigger:Ne,register:dt,handleSubmit:un,watch:Ge,setValue:we,getValues:Te,reset:kn,resetField:xt,clearErrors:Ae,unregister:Qe,setError:Ue,setFocus:(Re,Fe={})=>{const We=an(a,Re),ot=We&&We._f;if(ot){const Et=ot.refs?ot.refs[0]:ot.ref;Et.focus&&(Et.focus(),Fe.shouldSelect&&Uh(Et.select)&&Et.select())}},getFieldState:be}}function wse(n={}){const t=si.useRef(void 0),s=si.useRef(void 0),[a,l]=si.useState({isDirty:!1,isValidating:!1,isLoading:Uh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:Uh(n.defaultValues)?void 0:n.defaultValues});t.current||(t.current={...ZBe(n),formState:a});const d=t.current.control;return d._options=n,jBe({subject:d._subjects.state,next:f=>{FBe(f,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),si.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),si.useEffect(()=>{if(d._proxyFormState.isDirty){const f=d._getDirty();f!==a.isDirty&&d._subjects.state.next({isDirty:f})}},[d,a.isDirty]),si.useEffect(()=>{n.values&&!sg(n.values,s.current)?(d._reset(n.values,d._options.resetOptions),s.current=n.values,l(f=>({...f}))):d._resetDefaultValues()},[n.values,d]),si.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),si.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),si.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),t.current.formState=VBe(a,d),t.current}const G1=(n,t="generic-modal")=>{D.useEffect(()=>{if(!window.unityInstance)return;const s=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),he.log(`Unity input disabled for ${t}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=t}catch(l){he.error(`Failed to disable Unity input for ${t}:`,l)}},a=()=>{try{window.unityInputDisabledBy===t?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),he.log(`Unity input re-enabled (was disabled by ${t})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):he.log(`Not re-enabling Unity input for ${t} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){he.error(`Failed to enable Unity input for ${t}:`,l)}};return n?s():a(),()=>{n&&a()}},[n,t])};function u4({mode:n,label:t,buttonProps:s={},isOpen:a,onClose:l}){const{register:d,handleSubmit:f,formState:{errors:E}}=wse(),{register:v}=D.useContext(cl),b=Du(),{fullscreenRef:w}=Dd(),[A,N]=D.useState(!1),[V,j]=D.useState(!1),B=a!==void 0?a:A,H=l||(()=>N(!1));G1(B);const J=async ce=>{const{email:oe,password:_e,confirmPassword:ne,...ee}=ce;if(_e!==ne){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}j(!0);try{const Q=await v(oe,_e,ee);he.log("User: Registration process complete."),H(),b({title:"Registration Successful",description:"Your account has been created. Please check your email to verify your account before signing in.",status:"success",duration:7e3,isClosable:!0,position:"top"})}catch(Q){he.error("User: Registration Error:",Q),b({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{j(!1)}},$=()=>{l?l():N(!A)},te=n==="link"?C.jsx(Ru,{variant:"header",onClick:$,children:t}):C.jsx(Ti,{onClick:$,...s,children:t});return C.jsxs(C.Fragment,{children:[!a&&te,C.jsxs(ca,{isOpen:B,onClose:H,size:"md",portalProps:{containerRef:w},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(da,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsxs(la,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:ce=>{ce.stopPropagation()},children:[C.jsxs(sl,{p:8,textAlign:"center",children:[C.jsx(_k,{size:"lg",mb:2,children:"Create Account"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),C.jsx(Ha,{color:"gray.400"}),C.jsx(ua,{px:8,children:C.jsx("form",{onSubmit:f(J),children:C.jsxs(Di,{spacing:4,children:[C.jsxs(Ai,{isInvalid:E.companyName,isRequired:!0,children:[C.jsx(ds,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),C.jsx(af,{children:E.companyName&&E.companyName.message})]}),C.jsxs(zs,{gap:4,w:"100%",children:[C.jsxs(Ai,{isInvalid:E.firstName,isRequired:!0,children:[C.jsx(ds,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),C.jsx(af,{children:E.firstName&&E.firstName.message})]}),C.jsxs(Ai,{isInvalid:E.lastName,isRequired:!0,children:[C.jsx(ds,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),C.jsx(af,{children:E.lastName&&E.lastName.message})]})]}),C.jsxs(Ai,{isInvalid:E.email,isRequired:!0,children:[C.jsx(ds,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),C.jsx(af,{children:E.email&&E.email.message})]}),C.jsxs(zs,{gap:4,w:"100%",children:[C.jsxs(Ai,{isInvalid:E.password,isRequired:!0,children:[C.jsx(ds,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),C.jsx(af,{children:E.password&&E.password.message})]}),C.jsxs(Ai,{isInvalid:E.confirmPassword,isRequired:!0,children:[C.jsx(ds,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),C.jsx(af,{children:E.confirmPassword&&E.confirmPassword.message})]})]}),C.jsx(Ai,{children:C.jsx(ds,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),C.jsx(Ai,{children:C.jsx(ds,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),C.jsxs(_g,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(Ti,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(J),isLoading:V,loadingText:"Creating Account",children:"Create Account"}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",C.jsx(Ru,{color:"blue.400",onClick:()=>{H(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]})]})}u4.propTypes={mode:Lr.oneOf(["button","link"]),label:Lr.string,buttonProps:Lr.object,isOpen:Lr.bool,onClose:Lr.func};const e6e=Cg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),t6e=Cg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),n6e=Cg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),r6e=Cg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),_J=Cg({displayName:"EmailIcon",path:C.jsxs("g",{fill:"currentColor",children:[C.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),C.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),i6e=Cg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),s6e=Cg({displayName:"QuestionOutlineIcon",path:C.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[C.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),C.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),C.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),o6e=Cg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});function d4({mode:n="button",label:t="Sign In",buttonProps:s={},initialIsOpen:a=!1}){const{signIn:l}=D.useContext(cl),{fullscreenRef:d}=Dd(),f=Du(),{register:E,handleSubmit:v,formState:{errors:b,isSubmitting:w}}=wse({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[A,N]=D.useState(a),[V,j]=D.useState(!1),[B,H]=D.useState(!1),[J,$]=D.useState(""),[te,ce]=D.useState(!1);G1(A||B),D.useEffect(()=>{const pe=()=>{N(!0)};return window.addEventListener("openSignInModal",pe),()=>{window.removeEventListener("openSignInModal",pe)}},[]);const oe=async pe=>{try{await l(pe.email,pe.password),he.log("User: Sign-in process complete."),N(!1),window.location.reload()}catch(fe){he.error("User: SignIn Error:",fe);const ue=fe.message||"An error occurred while logging in. Please check your credentials.",Me=ue.includes("verify your email");f({title:Me?"Email Verification Required":"Error",description:ue,status:Me?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}},_e=async()=>{if(!J){f({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:d.current});return}try{ce(!0),await cVe(Wie,J),f({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:d.current}),H(!1)}catch(pe){he.error("User: Reset Password Error:",pe),f({title:"Error",description:pe.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:d.current})}finally{ce(!1)}},ne=()=>N(pe=>!pe),ee=()=>{N(!1),j(!0)},Q=()=>{H(!0)},se=n==="link"?C.jsx(Ru,{variant:"header",onClick:ne,children:t}):C.jsx(Ti,{onClick:ne,...s,children:t});return C.jsxs(C.Fragment,{children:[se,C.jsxs(ca,{isOpen:A,onClose:ne,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(da,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsx("form",{onSubmit:v(oe),children:C.jsxs(la,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:pe=>{pe.stopPropagation()},children:[C.jsxs(sl,{p:8,textAlign:"center",children:[C.jsx(_k,{size:"lg",mb:2,children:"Welcome Back"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),C.jsx(Ha,{color:"gray.400"}),C.jsx(ua,{px:8,pb:8,children:C.jsxs(Di,{spacing:4,children:[C.jsxs(Ai,{isInvalid:b.email,children:[C.jsxs(GS,{children:[C.jsx(qw,{pointerEvents:"none",children:C.jsx(_J,{color:"gray.500"})}),C.jsx(ds,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("email",{required:"Email is required."})})]}),C.jsx(af,{children:b.email&&b.email.message})]}),C.jsxs(Ai,{isInvalid:b.password,children:[C.jsxs(GS,{children:[C.jsx(qw,{pointerEvents:"none",children:C.jsx(n6e,{color:"gray.500"})}),C.jsx(ds,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("password",{required:"Password is required."})})]}),C.jsx(af,{children:b.password&&b.password.message})]}),C.jsx(It,{alignSelf:"flex-end",children:C.jsx(Ru,{color:"blue.400",fontSize:"sm",onClick:Q,children:"Forgot Password?"})})]})}),C.jsxs(_g,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(Ti,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:w,loadingText:"Signing In",children:"Sign In"}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",C.jsx(Ru,{color:"blue.400",onClick:ee,children:"Sign Up"})]})]})]})})]}),C.jsxs(ca,{isOpen:B,onClose:()=>H(!1),size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(da,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsxs(la,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:pe=>{pe.stopPropagation()},children:[C.jsxs(sl,{p:8,textAlign:"center",children:[C.jsx(_k,{size:"lg",mb:2,children:"Reset Password"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),C.jsx(Ha,{color:"gray.400"}),C.jsx(ua,{px:8,pb:4,children:C.jsx(Ai,{children:C.jsxs(GS,{children:[C.jsx(qw,{pointerEvents:"none",children:C.jsx(_J,{color:"gray.500"})}),C.jsx(ds,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:J,onChange:pe=>$(pe.target.value)})]})})}),C.jsxs(_g,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(Ti,{colorScheme:"blue",size:"lg",width:"100%",onClick:_e,isLoading:te,loadingText:"Sending",children:"Send Reset Link"}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",C.jsx(Ru,{color:"blue.400",onClick:()=>H(!1),children:"Back to Sign In"})]})]})]})]}),C.jsx(u4,{mode:"link",isOpen:V,onClose:()=>j(!1)})]})}d4.propTypes={mode:Lr.oneOf(["button","link"]),label:Lr.string,buttonProps:Lr.object,initialIsOpen:Lr.bool};function a6e(){const{loadingProgression:n,isLoaded:t,error:s}=Ka(),{user:a}=D.useContext(cl),[l,d]=D.useState(!1),[f,E]=D.useState(!1),[v,b]=D.useState(!1),[w,A]=D.useState(!1),N=D.useRef(!1),V=D.useRef(!1),j=D.useRef(null),B=D.useRef(null),H=D.useRef(null),J=sp(),$=D.useRef(null),te=D.useRef(null),ce=D.useRef(null),oe=D.useRef(null);D.useEffect(()=>{d(!a&&n===0)},[a,n]),D.useEffect(()=>{const ee=document.createElement("style");return ee.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(ee),$.current=ee,()=>{$.current&&document.head.removeChild($.current)}},[]),D.useEffect(()=>{const ee=()=>{const Q=document.getElementById("unity-canvas"),se=document.getElementById("unity-container");Q&&(j.current=Q,console.log("LoaderProgress: Found Unity canvas"),Q.style.zIndex="1"),se&&(B.current=se,console.log("LoaderProgress: Found Unity container"),se.style.zIndex="1"),Q&&se&&ce.current&&(clearInterval(ce.current),ce.current=null)};return ee(),ce.current=setInterval(ee,100),()=>{ce.current&&(clearInterval(ce.current),ce.current=null)}},[]),D.useEffect(()=>{console.log("LoaderProgress: Setting up FirstSceneLoaded listener"),window.isFirstSceneLoaded&&(console.log("LoaderProgress: FirstSceneLoaded already set via window flag"),V.current=!0,A(!0));const Q=J("FirstSceneLoaded",()=>{console.log("LoaderProgress: FirstSceneLoaded event received"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0}),se=setTimeout(()=>{V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded after timeout"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{Q(),clearTimeout(se)}},[J]),D.useEffect(()=>{console.log("LoaderProgress: Setting up PlayerInstantiated listener"),window.isPlayerInstantiated&&(console.log("LoaderProgress: Player already instantiated via window flag"),N.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is already instantiated"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0));const ee=()=>{console.log("LoaderProgress: PlayerInstantiated event received"),N.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is instantiated"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",ee);const Q=J("PlayerInstantiated",ee),se=setTimeout(()=>{N.current||(console.log("LoaderProgress: Forcing player instantiation after timeout"),N.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because of timeout"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",ee),Q(),clearTimeout(se)}},[J]),D.useEffect(()=>(console.log("LoaderProgress: Handling visibility changes",{isFirstSceneLoaded:w,isPlayerInstantiated:v}),w&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),te.current&&clearTimeout(te.current),te.current=setTimeout(()=>{console.log("LoaderProgress: Showing Unity canvas now"),j.current&&(j.current.style.opacity="1",j.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="1",B.current.style.removeProperty("opacity")),H.current&&(H.current.style.opacity="0",H.current.style.pointerEvents="none",setTimeout(()=>{H.current&&(H.current.style.display="none")},1500))},2e3)),()=>{te.current&&clearTimeout(te.current)}),[w,v]),D.useEffect(()=>(oe.current=setInterval(()=>{var ee,Q;console.log("LoaderProgress: Debug interval",{isLoaded:t,isFirstSceneLoaded:V.current,isPlayerInstantiated:N.current,windowFirstSceneLoaded:window.isFirstSceneLoaded,windowPlayerInstantiated:window.isPlayerInstantiated,unityCanvasZIndex:(ee=j.current)==null?void 0:ee.style.zIndex,loaderZIndex:(Q=H.current)==null?void 0:Q.style.zIndex})},5e3),()=>{oe.current&&clearInterval(oe.current)}),[t]),D.useEffect(()=>{console.log("LoaderProgress: State updated",{isLoaded:t,isFirstSceneLoaded:w,isPlayerInstantiated:v,loadingProgression:n})},[t,w,v,n]);const _e=()=>t?t&&!w&&!v?"Scene initializing":w&&!v?"Player initializing":"Ready":"World loading",ne=()=>t?t&&!w&&!v?85:w&&!v?95:100:n*80;return C.jsx(C.Fragment,{children:l?C.jsx(It,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:C.jsxs(Di,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[C.jsx(ht,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),C.jsx(ht,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),C.jsx(Ti,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>E(!0),children:"Sign In"})]})}):C.jsx(It,{ref:H,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:C.jsxs(zs,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[C.jsx(ht,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),C.jsx(ht,{fontSize:"sm",children:_e()}),C.jsx(u0,{value:ne(),size:"lg",width:"100%",marginY:2})]})})})}function Rse({mode:n="button",label:t="Sign Out"}){const s=Du(),{signOut:a}=D.useContext(cl),{fullscreenRef:l}=Dd(),d=async()=>{try{await a(),s({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(E){console.error("SignOut Error:",E),s({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?C.jsx(Ru,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return C.jsx(C.Fragment,{children:f})}Rse.propTypes={mode:Lr.oneOf(["button","link"]),label:Lr.string};function c6e(){const{user:n}=D.useContext(cl);return C.jsx("div",{children:n!==null?C.jsx("div",{children:C.jsx(Rse,{})}):C.jsxs("div",{children:[C.jsx(u4,{}),C.jsx(d4,{})]})})}function l6e(){const{fullscreenRef:n}=Dd(),[t,s]=D.useState(!1),a=()=>{s(!t)};return C.jsxs(C.Fragment,{children:[C.jsx(wf,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:C.jsx(No,{"aria-label":"Controller Help",icon:C.jsx(s6e,{}),onClick:a,variant:"iconButton"})}),C.jsxs(ca,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:n},children:[C.jsx(da,{}),C.jsxs(la,{children:[C.jsx(sl,{children:"Notes"}),C.jsx(Ha,{}),C.jsx(ua,{children:C.jsx(ht,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),C.jsx(_g,{children:C.jsx(Ti,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var Cse={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},EJ=si.createContext&&si.createContext(Cse),pg=function(){return pg=Object.assign||function(n){for(var t,s=1,a=arguments.length;s<a;s++){t=arguments[s];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(n[l]=t[l])}return n},pg.apply(this,arguments)},u6e=function(n,t){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(s[a[l]]=n[a[l]]);return s};function Ise(n){return n&&n.map(function(t,s){return si.createElement(t.tag,pg({key:s},t.attr),Ise(t.child))})}function Rr(n){return function(t){return si.createElement(d6e,pg({attr:pg({},n.attr)},t),Ise(n.child))}}function d6e(n){var t=function(s){var a=n.attr,l=n.size,d=n.title,f=u6e(n,["attr","size","title"]),E=l||s.size||"1em",v;return s.className&&(v=s.className),n.className&&(v=(v?v+" ":"")+n.className),si.createElement("svg",pg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,a,f,{className:v,style:pg(pg({color:n.color||s.color},s.style),n.style),height:E,width:E,xmlns:"http://www.w3.org/2000/svg"}),d&&si.createElement("title",null,d),n.children)};return EJ!==void 0?si.createElement(EJ.Consumer,null,function(s){return t(s)}):t(Cse)}function Ase(n){return Rr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function h6e(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function yJ(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function vJ(n){return Rr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function vV(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function p6e(n){return Rr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function f6e(n){return Rr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function m6e(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function Pse(n){return Rr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function g6e(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function _6e(n){return Rr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function SV(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function bV(n){return Rr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function E6e(n){return Rr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function y6e(n){return Rr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function v6e(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function TV(n){return Rr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function S6e(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function b6e(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function T6e(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function w6e(n){return Rr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function R6e(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function Ose({open:n,onClose:t}){const s=D.useRef(null),a=Ff(),{user:l}=D.useContext(cl),d=v=>{s.current&&!s.current.contains(v.target)&&t()},f=async v=>{const b=E(v);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&s.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const w=b.data.url;if(console.log(`Avatar URL: ${w}`),a("AvatarUrlFromReact",{url:w}),l&&l.uid)try{await zie(l.uid,w),t()}catch(A){console.error("Error updating RPM URL:",A)}else console.error("No authenticated user found to update rpmURL.")}},E=v=>{try{return JSON.parse(v.data)}catch{return null}};return D.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",f)}),[n]),n&&C.jsx(Nu,{children:C.jsx(It,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:C.jsx(It,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:C.jsx("iframe",{ref:s,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function C6e({isOpen:n,onClose:t}){const[s,a]=D.useState(!1),[l,d]=D.useState(null),{user:f}=D.useContext(cl),E=Ff(),v=j=>{j.stopPropagation(),a(!0)},b=()=>{a(!1),t()},w=async j=>{if(d(j),f&&f.uid)try{await zie(f.uid,j.url),E("AvatarUrlFromReact",{url:j.url}),t()}catch(B){console.error("Error updating RPM URL:",B)}else console.error("No authenticated user found to update rpmURL.")},A=uCe("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",V=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return C.jsxs(C.Fragment,{children:[C.jsx(Nu,{children:C.jsxs(ca,{isOpen:n,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[C.jsx(da,{bg:"rgba(0, 0, 0, 0.7)"}),C.jsxs(la,{bg:"gray.800",color:"white",maxW:"900px",children:[C.jsx(sl,{fontSize:"lg",children:"Customise Your Avatar"}),C.jsx(Ha,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),C.jsx(ua,{pb:4,children:C.jsxs(Di,{spacing:4,align:"stretch",children:[C.jsx(ht,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),C.jsxs(gte,{columns:5,spacing:2,children:[C.jsx(It,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:A,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:C.jsxs(Di,{spacing:1,children:[C.jsx(Ln,{as:y6e,boxSize:4}),C.jsx(ht,{fontSize:"xs",children:"Create Custom Avatar"})]})}),V.map(j=>C.jsxs(It,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===j.id?"blue.400":A,borderRadius:"lg",overflow:"hidden",onClick:()=>w(j),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[C.jsx(Fh,{src:j.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:j.name,width:"100%",height:"100%",objectFit:"cover"}),C.jsx(It,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:C.jsx(ht,{fontSize:"xs",children:j.name})})]},j.id))]})]})})]})]})}),s&&C.jsx(Ose,{open:s,onClose:b})]})}function I6e(){const{fullscreenRef:n}=Dd(),[t,s]=D.useState(!1),[a,l]=D.useState(!1),[d,f]=D.useState(!1),[E,v]=D.useState(!1),{user:b}=D.useContext(cl),[w,A]=D.useState(null),[N,V]=D.useState(!0),j=($,te)=>!$||!te?"?":`${$.charAt(0)}${te.charAt(0)}`.toUpperCase(),B=async()=>{if(b!=null&&b.uid){V(!0);try{const $=await Nd(b.uid);A({rpmURL:$.rpmURL?$.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:$.firstName,lastName:$.lastName})}catch($){console.error("Error fetching profile data:",$)}finally{V(!1)}}};D.useEffect(()=>{B()},[b==null?void 0:b.uid]),D.useEffect(()=>{const $=()=>{s(!0)};return window.addEventListener("PlayerInstantiated",$),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const H=()=>l(!a),J=()=>{l(!1),B()};return t?C.jsxs(C.Fragment,{children:[C.jsx(wf,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:E,portalProps:{containerRef:n},children:C.jsxs(It,{position:"relative",onMouseEnter:()=>{f(!0),v(!0)},onMouseLeave:()=>{f(!1),v(!1)},cursor:"pointer",onClick:H,children:[C.jsx(Qh,{src:N||w==null?void 0:w.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?j(w==null?void 0:w.firstName,w==null?void 0:w.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&C.jsx(It,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:C.jsx(ht,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),C.jsx(C6e,{isOpen:a,onClose:J})]}):null}function A6e(n){return Rr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function P6e(n){return Rr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function O6e(){const{isFullscreen:n,toggleFullscreen:t,fullscreenRef:s,isMobile:a}=Dd(),l=Du();D.useEffect(()=>{const f=E=>{console.error("Fullscreen error:",E),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const d=()=>{s.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return C.jsx(wf,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:s},children:C.jsx(No,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?C.jsx(A6e,{}):C.jsx(P6e,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const SJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function k6e(){const{isOpen:n,onOpen:t,onClose:s}=If(),{fullscreenRef:a}=Dd(),[l,d]=CBe(!1);D.useEffect(()=>{he.log("VideoPlayer: Current video URL:",l),l&&(he.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const f=()=>{he.log("VideoPlayer: Closing modal"),d(),s()};return C.jsx(Nu,{containerRef:a,children:C.jsxs(ca,{isOpen:n,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[C.jsx(da,{bg:"rgba(0, 0, 0, 0.8)"}),C.jsxs(la,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[C.jsx(Ha,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),C.jsx(ua,{p:0,width:"100%",children:l&&C.jsx(It,{style:SJ.iframeContainer,children:C.jsx("iframe",{src:l,style:SJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function N6e({isOpen:n,onClose:t,playerName:s,playerId:a,uid:l}){const[d,f]=D.useState(null),[E,v]=D.useState(!0),[b,w]=D.useState(null);return D.useEffect(()=>{n&&(async()=>{if(v(!0),w(null),!l){he.warn("NameplateModal: No UID provided for player:",s),w("No user ID available for this player"),v(!1);return}try{he.log("NameplateModal: Fetching profile for UID:",l);const N=await Nd(l);N?f({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):w("Could not find profile data for this player")}catch(N){he.error("Error fetching profile data:",N),w("Error loading profile data")}finally{v(!1)}})()},[l,n,s]),C.jsxs(ca,{isOpen:n,onClose:t,isCentered:!0,size:"md",children:[C.jsx(da,{backdropFilter:"blur(10px)"}),C.jsxs(la,{bg:"gray.900",color:"white",borderRadius:"xl",children:[C.jsx(sl,{children:"Player Info"}),C.jsx(Ha,{}),C.jsx(ua,{pb:6,children:E?C.jsx(Dee,{py:8,children:C.jsx(np,{size:"xl",color:"blue.400"})}):b?C.jsxs(hf,{status:"warning",variant:"solid",borderRadius:"md",children:[C.jsx(pf,{}),b]}):C.jsxs(Di,{spacing:4,align:"center",children:[C.jsx(Qh,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:s,borderWidth:"2px",borderColor:"whiteAlpha.300"}),C.jsxs(Di,{spacing:1,children:[C.jsx(ht,{fontSize:"2xl",fontWeight:"bold",children:s}),(d==null?void 0:d.firstName)&&C.jsxs(ht,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),C.jsxs(ht,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&C.jsxs(C.Fragment,{children:[C.jsx(ag,{borderColor:"whiteAlpha.300"}),C.jsxs(fi,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&C.jsx(Ru,{href:d.linkedinUrl,isExternal:!0,children:C.jsx(No,{icon:C.jsx(Ase,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&C.jsx(Ru,{href:d.websiteUrl,isExternal:!0,children:C.jsx(No,{icon:C.jsx(Pse,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const D6e=({isVisible:n,onToggleVisibility:t,spaceID:s})=>{const[a]=$Ne("(max-width: 768px)"),[l,d]=D.useState(!1);D.useEffect(()=>{(()=>{const Ce=navigator.userAgent||navigator.vendor||window.opera,Ne=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(Ce);d(Ne),Ne&&he.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const f=a||l,E=pse(),[v,b]=D.useState(!1),[w,A]=D.useState([]),[N,V]=D.useState(!1),[j,B]=D.useState({}),[H,J]=D.useState({}),[$,te]=D.useState(null),[ce,oe]=D.useState(!1),_e=Du(),ne=window.currentUser||{},Q=(()=>{if(s)return s;if(window.spaceID)return window.spaceID;const Ce=(window.location.pathname||"").split("/"),ve=Ce[Ce.length-1];if(ve&&ve.length>5)return ve;const Ne=document.body.getAttribute("data-space-id");if(Ne)return Ne;const Te=localStorage.getItem("currentSpaceId");return Te||"fallback-space-id"})();D.useEffect(()=>{(async()=>{try{const ve=await hg(Q);ve&&ve.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),oe(!0)):oe(!1)}catch(ve){console.error("UnityPlayerList: Error checking if voice is disabled:",ve)}})();const Ce=ve=>{ve.detail&&typeof ve.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",ve.detail.voiceDisabled),oe(ve.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ce),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ce)}},[Q]),D.useEffect(()=>{const we={};E.forEach(Ce=>{if(Ce.uid){if(Ce.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)we[Ce.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ve=window.agoraClient.client.remoteUsers,Ne=ve.find(Te=>String(Te.uid)===String(Ce.uid));if(Ne)we[Ce.uid]=Ne.uid;else{const Te=ve.find(be=>typeof be.uid=="string"&&be.uid.includes(Ce.uid));if(Te)we[Ce.uid]=Te.uid;else{const be=ve.find(Ae=>typeof Ce.uid=="string"&&Ce.uid.includes(String(Ae.uid)));if(be)we[Ce.uid]=be.uid;else{const Ae=ve.filter(Ue=>!(typeof Ue.uid=="string"&&Ue.uid.startsWith("screen-")));Ae.length===1&&!Ce.isLocalPlayer&&(we[Ce.uid]=Ae[0].uid)}}}}}}),J(we)},[E]);const se=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const we=window.agoraClient.isVoiceEnabled;we!==N&&V(we)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const we=window.agoraClient.client.remoteUsers,Ce={};we.forEach(ve=>{typeof ve.uid=="string"&&ve.uid.startsWith("screen-")||(Ce[ve.uid]=!!ve.audioTrack&&!ve.audioTrack.muted)}),JSON.stringify(Ce)!==JSON.stringify(j)&&B(Ce)}};D.useEffect(()=>{const we=setInterval(se,500),Ce=ve=>{ve.detail&&typeof ve.detail.enabled=="boolean"&&V(ve.detail.enabled)};return window.addEventListener("VoiceToggled",Ce),se(),()=>{clearInterval(we),window.removeEventListener("VoiceToggled",Ce)}},[]),D.useEffect(()=>{const we=()=>{he.log("UnityPlayerList: Player instantiated, showing list"),b(!0)};return window.addEventListener("PlayerInstantiated",we),window.isPlayerInstantiated&&(he.log("UnityPlayerList: Player was already instantiated"),b(!0)),()=>{window.removeEventListener("PlayerInstantiated",we)}},[]),D.useEffect(()=>{(async()=>{const Ce=await Promise.all(E.map(async ve=>{if(ve.uid)try{const Ne=await Nd(ve.uid);let Te=null;if(Ne.groups){const be=`space_${Q}_owners`,Ae=`space_${Q}_hosts`;Ne.groups.includes(be)?Te="owner":Ne.groups.includes(Ae)&&(Te="host")}return ue({uid:ve.uid})&&te(Te),{...ve,firstName:Ne.firstName,lastName:Ne.lastName,linkedInProfile:Ne.linkedInProfile,websiteUrl:Ne.websiteUrl,rpmURL:Ne.rpmURL?Ne.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:Te}}catch(Ne){return he.error(`Error fetching data for player ${ve.playerName}:`,Ne),ve}return ve}));A(Ce)})()},[E,Q]);const pe=[...w].sort((we,Ce)=>we.isLocalPlayer?-1:Ce.isLocalPlayer?1:0),fe=()=>{he.log("UnityPlayerList: Toggling visibility"),t&&t()},ue=we=>!!(we.isLocalPlayer||ne&&ne.uid&&we.uid===ne.uid),Me=we=>{try{if(ue(we))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:N;if(we.uid){if(j[we.uid])return!0;const Ce=H[we.uid];if(Ce&&j[Ce])return!0;const ve=parseInt(we.uid);if(!isNaN(ve)&&j[ve])return!0}return!1}catch(Ce){return console.error("Error in hasActiveMic:",Ce),!1}},He=({player:we})=>{const Ce=we.role;return Ce==="owner"?C.jsxs(fi,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[C.jsx(Ln,{as:vV,color:"green.400",boxSize:5}),C.jsx(ff,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):Ce==="host"?C.jsxs(fi,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[C.jsx(Ln,{as:TV,color:"purple.400",boxSize:5}),C.jsx(ff,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},nt=(we,Ce)=>{switch(console.log(`Action "${we}" performed on player: ${Ce.playerName}`),we){case"mute":_e({title:"Player Muted",description:`${Ce.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":_e({title:"Player Kicked",description:`${Ce.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":_e({title:"Player Promoted",description:`${Ce.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return C.jsxs(It,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!f?"visible":"hidden",role:"group",children:[C.jsx(It,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:C.jsx(No,{icon:C.jsx(i6e,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:fe,_hover:{opacity:.8}})}),C.jsxs(ht,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",E.length]}),C.jsx(It,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:C.jsx(Di,{align:"stretch",spacing:1,width:"100%",children:pe.map((we,Ce)=>{const ve=ue(we),Ne=!ce&&Me(we);return C.jsx(It,{children:C.jsxs(zte,{placement:"left",trigger:"hover",children:[C.jsx(qte,{children:C.jsxs(fi,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[C.jsx(Qh,{size:"xs",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),C.jsx(ht,{fontSize:"xs",children:we.playerName}),we.role==="owner"&&C.jsx(Ln,{as:vV,color:"green.400",boxSize:2.5}),we.role==="host"&&C.jsx(Ln,{as:TV,color:"purple.400",boxSize:2.5}),C.jsx(gk,{}),$==="owner"&&C.jsxs(c1,{closeOnSelect:!0,placement:"bottom-end",children:[C.jsx(l1,{as:No,"aria-label":"Options",icon:C.jsx(f6e,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:Te=>Te.stopPropagation()}),C.jsxs(u1,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[C.jsx(HS,{icon:C.jsx(w6e,{}),onClick:()=>nt("mute",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:ce,children:"Mute Player"}),C.jsx(HS,{icon:C.jsx(S6e,{}),onClick:()=>nt("promote",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),C.jsx(Pte,{borderColor:"whiteAlpha.300"}),C.jsx(HS,{icon:C.jsx(h6e,{}),onClick:()=>nt("kick",we),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!ce&&(Ne?C.jsx(It,{color:"green.400",children:C.jsx(bV,{})}):C.jsx(It,{color:"red.400",children:C.jsx(SV,{})})),ve&&C.jsx(ht,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),C.jsx(Kte,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:C.jsx(Hte,{children:C.jsxs(Di,{align:"center",spacing:3,children:[C.jsx(Qh,{size:"xl",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),C.jsx(ht,{fontSize:"xl",fontWeight:"bold",children:we.playerName}),C.jsx(He,{player:we}),we.firstName&&C.jsxs(ht,{fontSize:"sm",color:"gray.300",children:[we.firstName," ",we.lastName]}),C.jsxs(fi,{spacing:4,pt:2,children:[we.linkedInProfile&&C.jsx(Ru,{href:we.linkedInProfile,isExternal:!0,children:C.jsx(No,{icon:C.jsx(Ase,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),we.websiteUrl&&C.jsx(Ru,{href:we.websiteUrl,isExternal:!0,children:C.jsx(No,{icon:C.jsx(Pse,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!ce&&C.jsx(No,{icon:Ne?C.jsx(bV,{}):C.jsx(SV,{}),variant:"ghost",colorScheme:Ne?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),ce&&C.jsx(No,{icon:C.jsx(T6e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},Ce)})})})]})};var ek={exports:{}},L6e=ek.exports,bJ;function x6e(){return bJ||(bJ=1,function(n,t){(function(s,a){n.exports=a()})(L6e,function(){function s(e,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof oE<"u"?oE:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},f=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=f,v=Function.prototype,b=v.call,w=E&&v.bind.bind(b,b),A=E?w:function(e){return function(){return b.apply(e,arguments)}},N=A({}.isPrototypeOf),V=function(e){return e&&e.Math==Math&&e},j=V(typeof globalThis=="object"&&globalThis)||V(typeof window=="object"&&window)||V(typeof self=="object"&&self)||V(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),B=f,H=Function.prototype,J=H.apply,$=H.call,te=typeof Reflect=="object"&&Reflect.apply||(B?$.bind(J):function(){return $.apply(J,arguments)}),ce=A,oe=ce({}.toString),_e=ce("".slice),ne=function(e){return _e(oe(e),8,-1)},ee=ne,Q=A,se=function(e){if(ee(e)==="Function")return Q(e)},pe=typeof document=="object"&&document.all,fe={all:pe,IS_HTMLDDA:pe===void 0&&pe!==void 0},ue=fe.all,Me=fe.IS_HTMLDDA?function(e){return typeof e=="function"||e===ue}:function(e){return typeof e=="function"},He={},nt=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),we=f,Ce=Function.prototype.call,ve=we?Ce.bind(Ce):function(){return Ce.apply(Ce,arguments)},Ne={},Te={}.propertyIsEnumerable,be=Object.getOwnPropertyDescriptor,Ae=be&&!Te.call({1:2},1);Ne.f=Ae?function(e){var r=be(this,e);return!!r&&r.enumerable}:Te;var Ue,Ge,Qe=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},tt=d,dt=ne,Ze=Object,wt=A("".split),un=tt(function(){return!Ze("z").propertyIsEnumerable(0)})?function(e){return dt(e)=="String"?wt(e,""):Ze(e)}:Ze,xt=function(e){return e==null},tn=xt,kn=TypeError,$t=function(e){if(tn(e))throw kn("Can't call method on "+e);return e},zn=un,Bt=$t,Re=function(e){return zn(Bt(e))},Fe=Me,We=fe.all,ot=fe.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Fe(e)||e===We}:function(e){return typeof e=="object"?e!==null:Fe(e)},Et={},yt=Et,zt=j,pn=Me,xn=function(e){return pn(e)?e:void 0},cn=function(e,r){return arguments.length<2?xn(yt[e])||xn(zt[e]):yt[e]&&yt[e][r]||zt[e]&&zt[e][r]},dr=typeof navigator<"u"&&String(navigator.userAgent)||"",pa=j,Vt=dr,on=pa.process,Mi=pa.Deno,fs=on&&on.versions||Mi&&Mi.version,Ls=fs&&fs.v8;Ls&&(Ge=(Ue=Ls.split("."))[0]>0&&Ue[0]<4?1:+(Ue[0]+Ue[1])),!Ge&&Vt&&(!(Ue=Vt.match(/Edge\/(\d+)/))||Ue[1]>=74)&&(Ue=Vt.match(/Chrome\/(\d+)/))&&(Ge=+Ue[1]);var Zr=Ge,Pt=Zr,wn=d,ir=j.String,Oi=!!Object.getOwnPropertySymbols&&!wn(function(){var e=Symbol();return!ir(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Pt&&Pt<41}),_c=Oi&&!Symbol.sham&&typeof Symbol.iterator=="symbol",is=cn,fa=Me,_o=N,ma=Object,ga=_c?function(e){return typeof e=="symbol"}:function(e){var r=is("Symbol");return fa(r)&&_o(r.prototype,ma(e))},to=String,ms=function(e){try{return to(e)}catch{return"Object"}},ss=Me,Do=ms,Ui=TypeError,gs=function(e){if(ss(e))return e;throw Ui(Do(e)+" is not a function")},qa=gs,Lu=xt,Ec=function(e,r){var i=e[r];return Lu(i)?void 0:qa(i)},_a=ve,Ea=Me,Ld=ot,kg=TypeError,xu={exports:{}},op=j,$s=Object.defineProperty,Mu=function(e,r){try{$s(op,e,{value:r,configurable:!0,writable:!0})}catch{op[e]=r}return r},ya="__core-js_shared__",xd=j[ya]||Mu(ya,{}),Md=xd;(xu.exports=function(e,r){return Md[e]||(Md[e]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ya=xu.exports,Ud=$t,Uu=Object,Lo=function(e){return Uu(Ud(e))},Vd=Lo,Br=A({}.hasOwnProperty),gi=Object.hasOwn||function(e,r){return Br(Vd(e),r)},yc=A,ll=0,va=Math.random(),ap=yc(1 .toString),Fd=function(e){return"Symbol("+(e===void 0?"":e)+")_"+ap(++ll+va,36)},Fl=Ya,Eo=gi,jf=Fd,no=Oi,cp=_c,ul=j.Symbol,jd=Fl("wks"),Bd=cp?ul.for||ul:ul&&ul.withoutSetter||jf,fr=function(e){return Eo(jd,e)||(jd[e]=no&&Eo(ul,e)?ul[e]:Bd("Symbol."+e)),jd[e]},jl=ve,Bl=ot,Vu=ga,Xa=Ec,xo=function(e,r){var i,o;if(Ea(i=e.toString)&&!Ld(o=_a(i,e))||Ea(i=e.valueOf)&&!Ld(o=_a(i,e)))return o;throw kg("Can't convert object to primitive value")},Fu=TypeError,dl=fr("toPrimitive"),Wl=function(e,r){if(!Bl(e)||Vu(e))return e;var i,o=Xa(e,dl);if(o){if(i=jl(o,e,r),!Bl(i)||Vu(i))return i;throw Fu("Can't convert object to primitive value")}return xo(e)},Hr=ga,Ja=function(e){var r=Wl(e,"string");return Hr(r)?r:r+""},sr=ot,vc=j.document,Bf=sr(vc)&&sr(vc.createElement),zl=function(e){return Bf?vc.createElement(e):{}},Wd=zl,lp=!nt&&!d(function(){return Object.defineProperty(Wd("div"),"a",{get:function(){return 7}}).a!=7}),Wf=nt,up=ve,Mo=Ne,os=Qe,Uo=Re,Vo=Ja,Gl=gi,Fo=lp,jo=Object.getOwnPropertyDescriptor;He.f=Wf?jo:function(e,r){if(e=Uo(e),r=Vo(r),Fo)try{return jo(e,r)}catch{}if(Gl(e,r))return os(!up(Mo.f,e,r),e[r])};var zf=d,Sc=Me,_s=/#|\.prototype\./,ju=function(e,r){var i=hl[dp(e)];return i==Gf||i!=Hl&&(Sc(r)?zf(r):!!r)},dp=ju.normalize=function(e){return String(e).replace(_s,".").toLowerCase()},hl=ju.data={},Hl=ju.NATIVE="N",Gf=ju.POLYFILL="P",Sa=ju,ba=gs,pl=f,Se=se(se.bind),De=function(e,r){return ba(e),r===void 0?e:pl?Se(e,r):function(){return e.apply(r,arguments)}},et={},Yt=nt&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),qn=ot,yr=String,Wr=TypeError,ln=function(e){if(qn(e))return e;throw Wr(yr(e)+" is not an object")},xr=nt,_i=lp,xs=Yt,Bo=ln,Wo=Ja,Bu=TypeError,Xi=Object.defineProperty,fl=Object.getOwnPropertyDescriptor,zd="enumerable",bc="configurable",Ng="writable";et.f=xr?xs?function(e,r,i){if(Bo(e),r=Wo(r),Bo(i),typeof e=="function"&&r==="prototype"&&"value"in i&&Ng in i&&!i[Ng]){var o=fl(e,r);o&&o[Ng]&&(e[r]=i.value,i={configurable:bc in i?i[bc]:o[bc],enumerable:zd in i?i[zd]:o[zd],writable:!1})}return Xi(e,r,i)}:Xi:function(e,r,i){if(Bo(e),r=Wo(r),Bo(i),_i)try{return Xi(e,r,i)}catch{}if("get"in i||"set"in i)throw Bu("Accessors not supported");return"value"in i&&(e[r]=i.value),e};var Hf=et,Wu=Qe,zo=nt?function(e,r,i){return Hf.f(e,r,Wu(1,i))}:function(e,r,i){return e[r]=i,e},$l=j,$f=te,Dg=se,BE=Me,Kf=He.f,qf=Sa,zu=Et,Gu=De,Hu=zo,Lg=gi,WE=function(e){var r=function(i,o,c){if(this instanceof r){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,c)}return $f(e,this,arguments)};return r.prototype=e.prototype,r},Vn=function(e,r){var i,o,c,u,h,m,_,y,S,R=e.target,P=e.global,k=e.stat,z=e.proto,U=P?$l:k?$l[R]:($l[R]||{}).prototype,F=P?zu:zu[R]||Hu(zu,R,{})[R],q=F.prototype;for(u in r)o=!(i=qf(P?u:R+(k?".":"#")+u,e.forced))&&U&&Lg(U,u),m=F[u],o&&(_=e.dontCallGetSet?(S=Kf(U,u))&&S.value:U[u]),h=o&&_?_:r[u],o&&typeof m==typeof h||(y=e.bind&&o?Gu(h,$l):e.wrap&&o?WE(h):z&&BE(h)?Dg(h):h,(e.sham||h&&h.sham||m&&m.sham)&&Hu(y,"sham",!0),Hu(F,u,y),z&&(Lg(zu,c=R+"Prototype")||Hu(zu,c,{}),Hu(zu[c],u,h),e.real&&q&&(i||!q[u])&&Hu(q,u,h)))},Yf=Math.ceil,Go=Math.floor,zE=Math.trunc||function(e){var r=+e;return(r>0?Go:Yf)(r)},GE=zE,Tc=function(e){var r=+e;return r!=r||r===0?0:GE(r)},I=Tc,W=Math.max,Z=Math.min,me=function(e,r){var i=I(e);return i<0?W(i+r,0):Z(i,r)},Ke=Tc,at=Math.min,Mt=function(e){return e>0?at(Ke(e),9007199254740991):0},$r=Mt,ai=function(e){return $r(e.length)},vr=Re,Ks=me,Es=ai,Qa=function(e){return function(r,i,o){var c,u=vr(r),h=Es(u),m=Ks(o,h);if(e&&i!=i){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((e||m in u)&&u[m]===i)return e||m||0;return!e&&-1}},Ho={includes:Qa(!0),indexOf:Qa(!1)},hp=Ho.includes;Vn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return hp(this,e,arguments.length>1?arguments[1]:void 0)}});var Xf=Et,Za=function(e){return Xf[e+"Prototype"]},aC=Za("Array").includes,cC=ot,Jf=ne,H1=fr("match"),lC=function(e){var r;return cC(e)&&((r=e[H1])!==void 0?!!r:Jf(e)=="RegExp")},$1=lC,uC=TypeError,V0={};V0[fr("toStringTag")]="z";var pp=String(V0)==="[object z]",xg=pp,K1=Me,fp=ne,q1=fr("toStringTag"),dC=Object,F0=fp(function(){return arguments}())=="Arguments",wc=xg?fp:function(e){var r,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(r=dC(e),q1))=="string"?i:F0?fp(r):(o=fp(r))=="Object"&&K1(r.callee)?"Arguments":o},hC=wc,pC=String,Ta=function(e){if(hC(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return pC(e)},Y1=fr("match"),X1=Vn,J1=function(e){if($1(e))throw uC("The method doesn't accept regular expressions");return e},Q1=$t,fC=Ta,ml=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[Y1]=!1,"/./"[e](r)}catch{}}return!1},Mg=A("".indexOf);X1({target:"String",proto:!0,forced:!ml("includes")},{includes:function(e){return!!~Mg(fC(Q1(this)),fC(J1(e)),arguments.length>1?arguments[1]:void 0)}});var mC=Za("String").includes,j0=N,gC=aC,_C=mC,Ug=Array.prototype,B0=String.prototype,Z1=function(e){var r=e.includes;return e===Ug||j0(Ug,e)&&r===Ug.includes?gC:typeof e=="string"||e===B0||j0(B0,e)&&r===B0.includes?_C:r},st=l(Z1),W0=gs,Vg=Lo,z0=un,EC=ai,HE=TypeError,Qf=function(e){return function(r,i,o,c){W0(i);var u=Vg(r),h=z0(u),m=EC(u),_=e?m-1:0,y=e?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=y;break}if(_+=y,e?_<0:m<=_)throw HE("Reduce of empty array with no initial value")}for(;e?_>=0:m>_;_+=y)_ in h&&(c=i(c,h[_],_,u));return c}},G0={left:Qf(!1)},yC=d,mp=function(e,r){var i=[][e];return!!i&&yC(function(){i.call(null,r||function(){return 1},1)})},gp=typeof process<"u"&&ne(process)=="process",vC=G0.left;Vn({target:"Array",proto:!0,forced:!gp&&Zr>79&&Zr<83||!mp("reduce")},{reduce:function(e){var r=arguments.length;return vC(this,e,r,r>1?arguments[1]:void 0)}});var SC=Za("Array").reduce,bC=N,TC=SC,$E=Array.prototype,Gd=function(e){var r=e.reduce;return e===$E||bC($E,e)&&r===$E.reduce?TC:r},KE=Gd,ec=l(KE),eN=ne,Fg=Array.isArray||function(e){return eN(e)=="Array"},jg=Vn,tN=Fg,wC=A([].reverse),H0=[1,2];jg({target:"Array",proto:!0,forced:String(H0)===String(H0.reverse())},{reverse:function(){return tN(this)&&(this.length=this.length),wC(this)}});var wi=Za("Array").reverse,$0=N,qE=wi,_p=Array.prototype,RC=function(e){var r=e.reverse;return e===_p||$0(_p,e)&&r===_p.reverse?qE:r},YE=RC,Zf=l(YE),XE=Fd,Ep=Ya("keys"),Bg=function(e){return Ep[e]||(Ep[e]=XE(e))},nN=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),rN=gi,CC=Me,JE=Lo,QE=nN,ZE=Bg("IE_PROTO"),Wg=Object,K0=Wg.prototype,zg=QE?Wg.getPrototypeOf:function(e){var r=JE(e);if(rN(r,ZE))return r[ZE];var i=r.constructor;return CC(i)&&r instanceof i?i.prototype:r instanceof Wg?K0:null},iN=A,IC=gs,sN=Me,oN=String,q0=TypeError,Hd=function(e,r,i){try{return iN(IC(Object.getOwnPropertyDescriptor(e,r)[i]))}catch{}},AC=ln,em=function(e){if(typeof e=="object"||sN(e))return e;throw q0("Can't set "+oN(e)+" as a prototype")},Kl=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,i={};try{(e=Hd(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(o,c){return AC(o),em(c),r?e(o,c):o.__proto__=c,o}}():void 0),$d={},Rc={},Gg=gi,aN=Re,cN=Ho.indexOf,yp=Rc,tm=A([].push),vp=function(e,r){var i,o=aN(e),c=0,u=[];for(i in o)!Gg(yp,i)&&Gg(o,i)&&tm(u,i);for(;r.length>c;)Gg(o,i=r[c++])&&(~cN(u,i)||tm(u,i));return u},nm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Y0=vp,rm=nm.concat("length","prototype");$d.f=Object.getOwnPropertyNames||function(e){return Y0(e,rm)};var Cc={};Cc.f=Object.getOwnPropertySymbols;var Ri=cn,Ei=$d,Kd=Cc,yo=ln,wa=A([].concat),Sp=Ri("Reflect","ownKeys")||function(e){var r=Ei.f(yo(e)),i=Kd.f;return i?wa(r,i(e)):r},bp=gi,Ra=Sp,ey=He,PC=et,ty={},ny=vp,OC=nm,Ic=Object.keys||function(e){return ny(e,OC)},ry=nt,X0=Yt,kC=et,lN=ln,qd=Re,im=Ic;ty.f=ry&&!X0?Object.defineProperties:function(e,r){lN(e);for(var i,o=qd(r),c=im(r),u=c.length,h=0;u>h;)kC.f(e,i=c[h++],o[i]);return e};var $u,Hg=cn("document","documentElement"),iy=ln,Ac=ty,tc=nm,Tp=Rc,Ku=Hg,qu=zl,Yu="prototype",sy="script",oy=Bg("IE_PROTO"),$g=function(){},Ca=function(e){return"<"+sy+">"+e+"</"+sy+">"},Ia=function(e){e.write(Ca("")),e.close();var r=e.parentWindow.Object;return e=null,r},ci=function(){try{$u=new ActiveXObject("htmlfile")}catch{}var e,r,i;ci=typeof document<"u"?document.domain&&$u?Ia($u):(r=qu("iframe"),i="java"+sy+":",r.style.display="none",Ku.appendChild(r),r.src=String(i),(e=r.contentWindow.document).open(),e.write(Ca("document.F=Object")),e.close(),e.F):Ia($u);for(var o=tc.length;o--;)delete ci[Yu][tc[o]];return ci()};Tp[oy]=!0;var $o=Object.create||function(e,r){var i;return e!==null?($g[Yu]=iy(e),i=new $g,$g[Yu]=null,i[oy]=e):i=ci(),r===void 0?i:Ac.f(i,r)},NC=ot,DC=zo,ay=Error,J0=A("".replace),LC=String(ay("zxcasd").stack),Kg=/\n\s*at [^:]*:[^\n]*/,xC=Kg.test(LC),sm=Qe,Q0=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",sm(1,7)),e.stack!==7)}),uN=zo,qg=function(e,r){if(xC&&typeof e=="string"&&!ay.prepareStackTrace)for(;r--;)e=J0(e,Kg,"");return e},cy=Q0,Z0=Error.captureStackTrace,Yd={},om=Yd,MC=fr("iterator"),ly=Array.prototype,Yg=function(e){return e!==void 0&&(om.Array===e||ly[MC]===e)},am=wc,uy=Ec,eb=xt,tb=Yd,nb=fr("iterator"),Xu=function(e){if(!eb(e))return uy(e,nb)||uy(e,"@@iterator")||tb[am(e)]},Pc=ve,wp=gs,rb=ln,UC=ms,Ju=Xu,Xd=TypeError,Xg=function(e,r){var i=arguments.length<2?Ju(e):r;if(wp(i))return rb(Pc(i,e));throw Xd(UC(e)+" is not iterable")},VC=ve,ql=ln,Jd=Ec,Jg=function(e,r,i){var o,c;ql(e);try{if(!(o=Jd(e,"return"))){if(r==="throw")throw i;return i}o=VC(o,e)}catch(u){c=!0,o=u}if(r==="throw")throw i;if(c)throw o;return ql(o),i},FC=De,dy=ve,jC=ln,Qg=ms,Yl=Yg,Zg=ai,cm=N,Rp=Xg,ib=Xu,Cp=Jg,BC=TypeError,lm=function(e,r){this.stopped=e,this.result=r},ki=lm.prototype,Qd=function(e,r,i){var o,c,u,h,m,_,y,S=i&&i.that,R=!(!i||!i.AS_ENTRIES),P=!(!i||!i.IS_RECORD),k=!(!i||!i.IS_ITERATOR),z=!(!i||!i.INTERRUPTED),U=FC(r,S),F=function(Y){return o&&Cp(o,"normal",Y),new lm(!0,Y)},q=function(Y){return R?(jC(Y),z?U(Y[0],Y[1],F):U(Y[0],Y[1])):z?U(Y,F):U(Y)};if(P)o=e.iterator;else if(k)o=e;else{if(!(c=ib(e)))throw BC(Qg(e)+" is not iterable");if(Yl(c)){for(u=0,h=Zg(e);h>u;u++)if((m=q(e[u]))&&cm(ki,m))return m;return new lm(!1)}o=Rp(e,c)}for(_=P?e.next:o.next;!(y=dy(_,o)).done;){try{m=q(y.value)}catch(Y){Cp(o,"throw",Y)}if(typeof m=="object"&&m&&cm(ki,m))return m}return new lm(!1)},sb=Ta,ob=Vn,hy=N,ab=zg,Xl=Kl,Vi=function(e,r,i){for(var o=Ra(r),c=PC.f,u=ey.f,h=0;h<o.length;h++){var m=o[h];bp(e,m)||i&&bp(i,m)||c(e,m,u(r,m))}},ys=$o,vs=zo,um=Qe,e_=function(e,r){NC(r)&&"cause"in r&&DC(e,"cause",r.cause)},t_=function(e,r,i,o){cy&&(Z0?Z0(e,r):uN(e,"stack",qg(i,o)))},dN=Qd,vo=function(e,r){return e===void 0?arguments.length<2?"":r:sb(e)},cb=fr("toStringTag"),dm=Error,lb=[].push,Ko=function(e,r){var i,o=hy(Aa,this);Xl?i=Xl(dm(),o?ab(this):Aa):(i=o?this:ys(Aa),vs(i,cb,"Error")),r!==void 0&&vs(i,"message",vo(r)),t_(i,Ko,i.stack,1),arguments.length>2&&e_(i,arguments[2]);var c=[];return dN(e,lb,{that:c}),vs(i,"errors",c),i};Xl?Xl(Ko,dm):Vi(Ko,dm,{name:!0});var Aa=Ko.prototype=ys(dm.prototype,{constructor:um(1,Ko),message:um(1,""),name:um(1,"AggregateError")});ob({global:!0},{AggregateError:Ko});var Zd,Ip,hm,WC=Me,ub=j.WeakMap,zC=WC(ub)&&/native code/.test(String(ub)),db=j,GC=ot,HC=zo,py=gi,fy=xd,n_=Bg,$C=Rc,r_="Object already initialized",pm=db.TypeError,KC=db.WeakMap;if(zC||fy.state){var Oc=fy.state||(fy.state=new KC);Oc.get=Oc.get,Oc.has=Oc.has,Oc.set=Oc.set,Zd=function(e,r){if(Oc.has(e))throw pm(r_);return r.facade=e,Oc.set(e,r),r},Ip=function(e){return Oc.get(e)||{}},hm=function(e){return Oc.has(e)}}else{var Ap=n_("state");$C[Ap]=!0,Zd=function(e,r){if(py(e,Ap))throw pm(r_);return r.facade=e,HC(e,Ap,r),r},Ip=function(e){return py(e,Ap)?e[Ap]:{}},hm=function(e){return py(e,Ap)}}var eh,hb,pb,Qu={set:Zd,get:Ip,has:hm,enforce:function(e){return hm(e)?Ip(e):Zd(e,{})},getterFor:function(e){return function(r){var i;if(!GC(r)||(i=Ip(r)).type!==e)throw pm("Incompatible receiver, "+e+" required");return i}}},my=nt,qC=gi,fb=Function.prototype,hN=my&&Object.getOwnPropertyDescriptor,mb=qC(fb,"name"),YC={PROPER:mb&&(function(){}).name==="something",CONFIGURABLE:mb&&(!my||my&&hN(fb,"name").configurable)},pN=zo,Zu=function(e,r,i,o){return o&&o.enumerable?e[r]=i:pN(e,r,i),e},XC=d,JC=Me,gy=ot,fN=$o,QC=zg,mN=Zu,nc=fr("iterator"),_y=!1;[].keys&&("next"in(pb=[].keys())?(hb=QC(QC(pb)))!==Object.prototype&&(eh=hb):_y=!0);var Ey=!gy(eh)||XC(function(){var e={};return eh[nc].call(e)!==e});JC((eh=Ey?{}:fN(eh))[nc])||mN(eh,nc,function(){return this});var gb={IteratorPrototype:eh,BUGGY_SAFARI_ITERATORS:_y},ZC=wc,eI=pp?{}.toString:function(){return"[object "+ZC(this)+"]"},_b=pp,fm=et.f,Eb=zo,yb=gi,gN=eI,vb=fr("toStringTag"),ed=function(e,r,i,o){if(e){var c=i?e:e.prototype;yb(c,vb)||fm(c,vb,{configurable:!0,value:r}),o&&!_b&&Eb(c,"toString",gN)}},tI=gb.IteratorPrototype,nI=$o,rI=Qe,_N=ed,Pa=Yd,qo=function(){return this},yy=function(e,r,i,o){var c=r+" Iterator";return e.prototype=nI(tI,{next:rI(+!o,i)}),_N(e,c,!1,!0),Pa[c]=qo,e},iI=Vn,sI=ve,oI=YC,aI=yy,Sb=zg,cI=ed,vy=Zu,bb=Yd,lI=gb,Tb=oI.PROPER,mm=lI.BUGGY_SAFARI_ITERATORS,Sy=fr("iterator"),by="keys",Pp="values",uI="entries",dI=function(){return this},Ty=function(e,r,i,o,c,u,h){aI(i,r,o);var m,_,y,S=function(q){if(q===c&&U)return U;if(!mm&&q in k)return k[q];switch(q){case by:case Pp:case uI:return function(){return new i(this,q)}}return function(){return new i(this)}},R=r+" Iterator",P=!1,k=e.prototype,z=k[Sy]||k["@@iterator"]||c&&k[c],U=!mm&&z||S(c),F=r=="Array"&&k.entries||z;if(F&&(m=Sb(F.call(new e)))!==Object.prototype&&m.next&&(cI(m,R,!0,!0),bb[R]=dI),Tb&&c==Pp&&z&&z.name!==Pp&&(P=!0,U=function(){return sI(z,this)}),c)if(_={values:S(Pp),keys:u?U:S(by),entries:S(uI)},h)for(y in _)(mm||P||!(y in k))&&vy(k,y,_[y]);else iI({target:r,proto:!0,forced:mm||P},_);return h&&k[Sy]!==U&&vy(k,Sy,U,{}),bb[r]=U,_},wy=function(e,r){return{value:e,done:r}},Ry=Re,Jl=Yd,hI=Qu;et.f;var pI=Ty,Cy=wy,wb="Array Iterator",fI=hI.set,i_=hI.getterFor(wb);pI(Array,"Array",function(e,r){fI(this,{type:wb,target:Ry(e),index:0,kind:r})},function(){var e=i_(this),r=e.target,i=e.kind,o=e.index++;return!r||o>=r.length?(e.target=void 0,Cy(void 0,!0)):Cy(i=="keys"?o:i=="values"?r[o]:[o,r[o]],!1)},"values"),Jl.Arguments=Jl.Array;var So=et,Iy=function(e,r,i){return So.f(e,r,i)},EN=cn,Ay=Iy,bo=nt,mI=fr("species"),Jt=N,gm=TypeError,s_=function(e,r){if(Jt(r,e))return e;throw gm("Incorrect invocation")},gI=Me,Rb=xd,o_=A(Function.toString);gI(Rb.inspectSource)||(Rb.inspectSource=function(e){return o_(e)});var a_=Rb.inspectSource,Cb=A,_I=d,Ib=Me,EI=wc,Ab=a_,Py=function(){},ro=[],kc=cn("Reflect","construct"),Ql=/^\s*(?:class|function)\b/,yI=Cb(Ql.exec),vI=!Ql.exec(Py),Yo=function(e){if(!Ib(e))return!1;try{return kc(Py,ro,e),!0}catch{return!1}},Pb=function(e){if(!Ib(e))return!1;switch(EI(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return vI||!!yI(Ql,Ab(e))}catch{return!0}};Pb.sham=!0;var Oa,_m,Ob,Oy,c_=!kc||_I(function(){var e;return Yo(Yo.call)||!Yo(Object)||!Yo(function(){e=!0})||e})?Pb:Yo,SI=c_,yN=ms,ky=TypeError,Ny=ln,Nc=function(e){if(SI(e))return e;throw ky(yN(e)+" is not a constructor")},Cr=xt,qs=fr("species"),Ji=function(e,r){var i,o=Ny(e).constructor;return o===void 0||Cr(i=Ny(o)[qs])?r:Nc(i)},Ss=A([].slice),rc=TypeError,gl=function(e,r){if(e<r)throw rc("Not enough arguments");return e},bs=/(?:ipad|iphone|ipod).*applewebkit/i.test(dr),io=j,Op=te,Dy=De,Ly=Me,l_=gi,Xo=d,xy=Hg,Em=Ss,Zl=zl,My=gl,kb=bs,th=gp,ym=io.setImmediate,eu=io.clearImmediate,Uy=io.process,kp=io.Dispatch,Nb=io.Function,u_=io.MessageChannel,Vy=io.String,so=0,Dc={},Lc="onreadystatechange";Xo(function(){Oa=io.location});var To=function(e){if(l_(Dc,e)){var r=Dc[e];delete Dc[e],r()}},Fy=function(e){return function(){To(e)}},jy=function(e){To(e.data)},By=function(e){io.postMessage(Vy(e),Oa.protocol+"//"+Oa.host)};ym&&eu||(ym=function(e){My(arguments.length,1);var r=Ly(e)?e:Nb(e),i=Em(arguments,1);return Dc[++so]=function(){Op(r,void 0,i)},_m(so),so},eu=function(e){delete Dc[e]},th?_m=function(e){Uy.nextTick(Fy(e))}:kp&&kp.now?_m=function(e){kp.now(Fy(e))}:u_&&!kb?(Oy=(Ob=new u_).port2,Ob.port1.onmessage=jy,_m=Dy(Oy.postMessage,Oy)):io.addEventListener&&Ly(io.postMessage)&&!io.importScripts&&Oa&&Oa.protocol!=="file:"&&!Xo(By)?(_m=By,io.addEventListener("message",jy,!1)):_m=Lc in Zl("script")?function(e){xy.appendChild(Zl("script"))[Lc]=function(){xy.removeChild(this),To(e)}}:function(e){setTimeout(Fy(e),0)});var Wy={set:ym,clear:eu},td=function(){this.head=null,this.tail=null};td.prototype={add:function(e){var r={item:e,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Np,d_,nd,h_,nh,Db=td,bI=/ipad|iphone|ipod/i.test(dr)&&typeof Pebble<"u",Lb=/web0s(?!.*chrome)/i.test(dr),tu=j,TI=De,vN=He.f,zy=Wy.set,wI=Db,Dp=bs,SN=bI,vm=Lb,Gy=gp,Fi=tu.MutationObserver||tu.WebKitMutationObserver,RI=tu.document,xb=tu.process,Hy=tu.Promise,CI=vN(tu,"queueMicrotask"),$y=CI&&CI.value;if(!$y){var p_=new wI,Ky=function(){var e,r;for(Gy&&(e=xb.domain)&&e.exit();r=p_.get();)try{r()}catch(i){throw p_.head&&Np(),i}e&&e.enter()};Dp||Gy||vm||!Fi||!RI?!SN&&Hy&&Hy.resolve?((h_=Hy.resolve(void 0)).constructor=Hy,nh=TI(h_.then,h_),Np=function(){nh(Ky)}):Gy?Np=function(){xb.nextTick(Ky)}:(zy=TI(zy,tu),Np=function(){zy(Ky)}):(d_=!0,nd=RI.createTextNode(""),new Fi(Ky).observe(nd,{characterData:!0}),Np=function(){nd.data=d_=!d_}),$y=function(e){p_.head||Np(),p_.add(e)}}var ic=$y,rh=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},Lp=j.Promise,rd=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",qy=!rd&&!gp&&typeof window=="object"&&typeof document=="object",xp=j,ih=Lp,Mb=Me,Ub=Sa,bN=a_,Vb=fr,TN=qy,II=rd,Yy=Zr,f_=ih&&ih.prototype,Xy=Vb("species"),Fb=Mb(xp.PromiseRejectionEvent),jb=Ub("Promise",function(){var e=bN(ih),r=e!==String(ih);if(!r&&Yy===66||!f_.catch||!f_.finally)return!0;if(!Yy||Yy<51||!/native code/.test(e)){var i=new ih(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((i.constructor={})[Xy]=o,!(i.then(function(){})instanceof o))return!0}return!r&&(TN||II)&&!Fb}),m_={CONSTRUCTOR:jb,REJECTION_EVENT:Fb},_l={},Jy=gs,Qy=TypeError,Bb=function(e){var r,i;this.promise=new e(function(o,c){if(r!==void 0||i!==void 0)throw Qy("Bad Promise constructor");r=o,i=c}),this.resolve=Jy(r),this.reject=Jy(i)};_l.f=function(e){return new Bb(e)};var Sm,Wb,wN=Vn,Mp=gp,sh=j,id=ve,RN=Zu,Zy=ed,p=function(e){var r=EN(e);bo&&r&&!r[mI]&&Ay(r,mI,{configurable:!0,get:function(){return this}})},g=gs,T=Me,O=ot,M=s_,G=Ji,ae=Wy.set,Ie=ic,xe=function(e,r){try{arguments.length==1?console.error(e):console.error(e,r)}catch{}},rt=rh,At=Db,Ot=Qu,Ct=Lp,Kt=m_,Zt=_l,en="Promise",Qi=Kt.CONSTRUCTOR,Ye=Kt.REJECTION_EVENT,Ve=Ot.getterFor(en),Je=Ot.set,Nt=Ct&&Ct.prototype,nn=Ct,fn=Nt,En=sh.TypeError,Nn=sh.document,Ts=sh.process,Sr=Zt.f,oh=Sr,CN=!!(Nn&&Nn.createEvent&&sh.dispatchEvent),f4="unhandledrejection",m4=function(e){var r;return!(!O(e)||!T(r=e.then))&&r},g4=function(e,r){var i,o,c,u=r.value,h=r.state==1,m=h?e.ok:e.fail,_=e.resolve,y=e.reject,S=e.domain;try{m?(h||(r.rejection===2&&Gse(r),r.rejection=1),m===!0?i=u:(S&&S.enter(),i=m(u),S&&(S.exit(),c=!0)),i===e.promise?y(En("Promise-chain cycle")):(o=m4(i))?id(o,i,_,y):_(i)):y(u)}catch(R){S&&!c&&S.exit(),y(R)}},_4=function(e,r){e.notified||(e.notified=!0,Ie(function(){for(var i,o=e.reactions;i=o.get();)g4(i,e);e.notified=!1,r&&!e.rejection&&zse(e)}))},E4=function(e,r,i){var o,c;CN?((o=Nn.createEvent("Event")).promise=r,o.reason=i,o.initEvent(e,!1,!0),sh.dispatchEvent(o)):o={promise:r,reason:i},!Ye&&(c=sh["on"+e])?c(o):e===f4&&xe("Unhandled promise rejection",i)},zse=function(e){id(ae,sh,function(){var r,i=e.facade,o=e.value;if(y4(e)&&(r=rt(function(){Mp?Ts.emit("unhandledRejection",o,i):E4(f4,i,o)}),e.rejection=Mp||y4(e)?2:1,r.error))throw r.value})},y4=function(e){return e.rejection!==1&&!e.parent},Gse=function(e){id(ae,sh,function(){var r=e.facade;Mp?Ts.emit("rejectionHandled",r):E4("rejectionhandled",r,e.value)})},ev=function(e,r,i){return function(o){e(r,o,i)}},tv=function(e,r,i){e.done||(e.done=!0,i&&(e=i),e.value=r,e.state=2,_4(e,!0))},IN=function(e,r,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===r)throw En("Promise can't be resolved itself");var o=m4(r);o?Ie(function(){var c={done:!1};try{id(o,r,ev(IN,c,e),ev(tv,c,e))}catch(u){tv(c,u,e)}}):(e.value=r,e.state=1,_4(e,!1))}catch(c){tv({done:!1},c,e)}}};Qi&&(fn=(nn=function(e){M(this,fn),g(e),id(Sm,this);var r=Ve(this);try{e(ev(IN,r),ev(tv,r))}catch(i){tv(r,i)}}).prototype,(Sm=function(e){Je(this,{type:en,done:!1,notified:!1,parent:!1,reactions:new At,rejection:!1,state:0,value:void 0})}).prototype=RN(fn,"then",function(e,r){var i=Ve(this),o=Sr(G(this,nn));return i.parent=!0,o.ok=!T(e)||e,o.fail=T(r)&&r,o.domain=Mp?Ts.domain:void 0,i.state==0?i.reactions.add(o):Ie(function(){g4(o,i)}),o.promise}),Wb=function(){var e=new Sm,r=Ve(e);this.promise=e,this.resolve=ev(IN,r),this.reject=ev(tv,r)},Zt.f=Sr=function(e){return e===nn||e===void 0?new Wb(e):oh(e)}),wN({global:!0,wrap:!0,forced:Qi},{Promise:nn}),Zy(nn,en,!1,!0),p(en);var v4=fr("iterator"),S4=!1;try{var Hse=0,b4={next:function(){return{done:!!Hse++}},return:function(){S4=!0}};b4[v4]=function(){return this},Array.from(b4,function(){throw 2})}catch{}var $se=Lp,Kse=function(e,r){if(!S4)return!1;var i=!1;try{var o={};o[v4]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},AI=m_.CONSTRUCTOR||!Kse(function(e){$se.all(e).then(void 0,function(){})}),qse=ve,Yse=gs,Xse=_l,Jse=rh,Qse=Qd;Vn({target:"Promise",stat:!0,forced:AI},{all:function(e){var r=this,i=Xse.f(r),o=i.resolve,c=i.reject,u=Jse(function(){var h=Yse(r.resolve),m=[],_=0,y=1;Qse(e,function(S){var R=_++,P=!1;y++,qse(h,r,S).then(function(k){P||(P=!0,m[R]=k,--y||o(m))},c)}),--y||o(m)});return u.error&&c(u.value),i.promise}});var Zse=Vn,eoe=m_.CONSTRUCTOR;Lp&&Lp.prototype,Zse({target:"Promise",proto:!0,forced:eoe,real:!0},{catch:function(e){return this.then(void 0,e)}});var toe=ve,noe=gs,roe=_l,ioe=rh,soe=Qd;Vn({target:"Promise",stat:!0,forced:AI},{race:function(e){var r=this,i=roe.f(r),o=i.reject,c=ioe(function(){var u=noe(r.resolve);soe(e,function(h){toe(u,r,h).then(i.resolve,o)})});return c.error&&o(c.value),i.promise}});var ooe=ve,aoe=_l;Vn({target:"Promise",stat:!0,forced:m_.CONSTRUCTOR},{reject:function(e){var r=aoe.f(this);return ooe(r.reject,void 0,e),r.promise}});var coe=ln,loe=ot,uoe=_l,T4=function(e,r){if(coe(e),loe(r)&&r.constructor===e)return r;var i=uoe.f(e);return(0,i.resolve)(r),i.promise},doe=Vn,hoe=Lp,poe=m_.CONSTRUCTOR,foe=T4,moe=cn("Promise"),goe=!poe;doe({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return foe(goe&&this===moe?hoe:this,e)}});var _oe=ve,Eoe=gs,yoe=_l,voe=rh,Soe=Qd;Vn({target:"Promise",stat:!0,forced:AI},{allSettled:function(e){var r=this,i=yoe.f(r),o=i.resolve,c=i.reject,u=voe(function(){var h=Eoe(r.resolve),m=[],_=0,y=1;Soe(e,function(S){var R=_++,P=!1;y++,_oe(h,r,S).then(function(k){P||(P=!0,m[R]={status:"fulfilled",value:k},--y||o(m))},function(k){P||(P=!0,m[R]={status:"rejected",reason:k},--y||o(m))})}),--y||o(m)});return u.error&&c(u.value),i.promise}});var boe=ve,Toe=gs,woe=cn,Roe=_l,Coe=rh,Ioe=Qd,w4="No one promise resolved";Vn({target:"Promise",stat:!0,forced:AI},{any:function(e){var r=this,i=woe("AggregateError"),o=Roe.f(r),c=o.resolve,u=o.reject,h=Coe(function(){var m=Toe(r.resolve),_=[],y=0,S=1,R=!1;Ioe(e,function(P){var k=y++,z=!1;S++,boe(m,r,P).then(function(U){z||R||(R=!0,c(U))},function(U){z||R||(z=!0,_[k]=U,--S||u(new i(_,w4)))})}),--S||u(new i(_,w4))});return h.error&&u(h.value),o.promise}});var Aoe=Vn,AN=Lp,Poe=d,Ooe=cn,koe=Me,Noe=Ji,R4=T4,Doe=AN&&AN.prototype;Aoe({target:"Promise",proto:!0,real:!0,forced:!!AN&&Poe(function(){Doe.finally.call({then:function(){}},function(){})})},{finally:function(e){var r=Noe(this,Ooe("Promise")),i=koe(e);return this.then(i?function(o){return R4(r,e()).then(function(){return o})}:e,i?function(o){return R4(r,e()).then(function(){throw o})}:e)}});var PN=A,Loe=Tc,xoe=Ta,Moe=$t,Uoe=PN("".charAt),C4=PN("".charCodeAt),Voe=PN("".slice),I4=function(e){return function(r,i){var o,c,u=xoe(Moe(r)),h=Loe(i),m=u.length;return h<0||h>=m?e?"":void 0:(o=C4(u,h))<55296||o>56319||h+1===m||(c=C4(u,h+1))<56320||c>57343?e?Uoe(u,h):o:e?Voe(u,h,h+2):c-56320+(o-55296<<10)+65536}},ON={codeAt:I4(!1),charAt:I4(!0)},Foe=ON.charAt,joe=Ta,A4=Qu,Boe=Ty,P4=wy,O4="String Iterator",Woe=A4.set,zoe=A4.getterFor(O4);Boe(String,"String",function(e){Woe(this,{type:O4,string:joe(e),index:0})},function(){var e,r=zoe(this),i=r.string,o=r.index;return o>=i.length?P4(void 0,!0):(e=Foe(i,o),r.index+=e.length,P4(e,!1))});var Goe=Et.Promise,Hoe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},$oe=j,Koe=wc,qoe=zo,k4=Yd,N4=fr("toStringTag");for(var kN in Hoe){var D4=$oe[kN],NN=D4&&D4.prototype;NN&&Koe(NN)!==N4&&qoe(NN,N4,kN),k4[kN]=k4.Array}var L4=Goe,lt=l(L4),Yoe=Za("Array").values,Xoe=wc,Joe=gi,Qoe=N,Zoe=Yoe,DN=Array.prototype,eae={DOMTokenList:!0,NodeList:!0},tae=function(e){var r=e.values;return e===DN||Qoe(DN,e)&&r===DN.values||Joe(eae,Xoe(e))?Zoe:r},xc=l(tae),nae=d,rae=fr("iterator"),LN=!nae(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),r=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),o+=u+c}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!r.size&&!0||!r.sort||e.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[rae]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),iae=Zu,sae=Ja,oae=et,aae=Qe,PI=function(e,r,i){var o=sae(r);o in e?oae.f(e,o,aae(0,i)):e[o]=i},x4=me,cae=ai,lae=PI,uae=Array,dae=Math.max,xN=function(e,r,i){for(var o=cae(e),c=x4(r,o),u=x4(i===void 0?o:i,o),h=uae(dae(u-c,0)),m=0;c<u;c++,m++)lae(h,m,e[c]);return h.length=m,h},M4=xN,hae=Math.floor,MN=function(e,r){var i=e.length,o=hae(i/2);return i<8?pae(e,r):fae(e,MN(M4(e,0,o),r),MN(M4(e,o),r),r)},pae=function(e,r){for(var i,o,c=e.length,u=1;u<c;){for(o=u,i=e[u];o&&r(e[o-1],i)>0;)e[o]=e[--o];o!==u++&&(e[o]=i)}return e},fae=function(e,r,i,o){for(var c=r.length,u=i.length,h=0,m=0;h<c||m<u;)e[h+m]=h<c&&m<u?o(r[h],i[m])<=0?r[h++]:i[m++]:h<c?r[h++]:i[m++];return e},U4=MN,UN=Vn,nv=j,OI=ve,ah=A,rv=nt,V4=LN,F4=Zu,mae=Iy,gae=function(e,r,i){for(var o in r)i&&i.unsafe&&e[o]?e[o]=r[o]:iae(e,o,r[o],i);return e},_ae=ed,Eae=yy,VN=Qu,j4=s_,FN=Me,yae=gi,vae=De,Sae=wc,bae=ln,B4=ot,sc=Ta,Tae=$o,W4=Qe,jN=Xg,wae=Xu,iv=gl,Rae=U4,Cae=fr("iterator"),zb="URLSearchParams",z4=zb+"Iterator",G4=VN.set,nu=VN.getterFor(zb),Iae=VN.getterFor(z4),Aae=Object.getOwnPropertyDescriptor,BN=function(e){if(!rv)return nv[e];var r=Aae(nv,e);return r&&r.value},H4=BN("fetch"),kI=BN("Request"),Gb=BN("Headers"),WN=kI&&kI.prototype,$4=Gb&&Gb.prototype,Pae=nv.RegExp,Oae=nv.TypeError,K4=nv.decodeURIComponent,kae=nv.encodeURIComponent,Nae=ah("".charAt),q4=ah([].join),g_=ah([].push),zN=ah("".replace),Dae=ah([].shift),Y4=ah([].splice),X4=ah("".split),Lae=ah("".slice),xae=/\+/g,J4=Array(4),Mae=function(e){return J4[e-1]||(J4[e-1]=Pae("((?:%[\\da-f]{2}){"+e+"})","gi"))},Uae=function(e){try{return K4(e)}catch{return e}},Q4=function(e){var r=zN(e,xae," "),i=4;try{return K4(r)}catch{for(;i;)r=zN(r,Mae(i--),Uae);return r}},Vae=/[!'()~]|%20/g,Fae={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},jae=function(e){return Fae[e]},Z4=function(e){return zN(kae(e),Vae,jae)},GN=Eae(function(e,r){G4(this,{type:z4,iterator:jN(nu(e).entries),kind:r})},"Iterator",function(){var e=Iae(this),r=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),i},!0),e3=function(e){this.entries=[],this.url=null,e!==void 0&&(B4(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Nae(e,0)==="?"?Lae(e,1):e:sc(e)))};e3.prototype={type:zb,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var r,i,o,c,u,h,m,_=wae(e);if(_)for(i=(r=jN(e,_)).next;!(o=OI(i,r)).done;){if(u=(c=jN(bae(o.value))).next,(h=OI(u,c)).done||(m=OI(u,c)).done||!OI(u,c).done)throw Oae("Expected sequence with length 2");g_(this.entries,{key:sc(h.value),value:sc(m.value)})}else for(var y in e)yae(e,y)&&g_(this.entries,{key:y,value:sc(e[y])})},parseQuery:function(e){if(e)for(var r,i,o=X4(e,"&"),c=0;c<o.length;)(r=o[c++]).length&&(i=X4(r,"="),g_(this.entries,{key:Q4(Dae(i)),value:Q4(q4(i,"="))}))},serialize:function(){for(var e,r=this.entries,i=[],o=0;o<r.length;)e=r[o++],g_(i,Z4(e.key)+"="+Z4(e.value));return q4(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var NI=function(){j4(this,sv);var e=G4(this,new e3(arguments.length>0?arguments[0]:void 0));rv||(this.size=e.entries.length)},sv=NI.prototype;if(gae(sv,{append:function(e,r){var i=nu(this);iv(arguments.length,2),g_(i.entries,{key:sc(e),value:sc(r)}),rv||this.length++,i.updateURL()},delete:function(e){for(var r=nu(this),i=iv(arguments.length,1),o=r.entries,c=sc(e),u=i<2?void 0:arguments[1],h=u===void 0?u:sc(u),m=0;m<o.length;){var _=o[m];if(_.key!==c||h!==void 0&&_.value!==h)m++;else if(Y4(o,m,1),h!==void 0)break}rv||(this.size=o.length),r.updateURL()},get:function(e){var r=nu(this).entries;iv(arguments.length,1);for(var i=sc(e),o=0;o<r.length;o++)if(r[o].key===i)return r[o].value;return null},getAll:function(e){var r=nu(this).entries;iv(arguments.length,1);for(var i=sc(e),o=[],c=0;c<r.length;c++)r[c].key===i&&g_(o,r[c].value);return o},has:function(e){for(var r=nu(this).entries,i=iv(arguments.length,1),o=sc(e),c=i<2?void 0:arguments[1],u=c===void 0?c:sc(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(e,r){var i=nu(this);iv(arguments.length,1);for(var o,c=i.entries,u=!1,h=sc(e),m=sc(r),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?Y4(c,_--,1):(u=!0,o.value=m));u||g_(c,{key:h,value:m}),rv||(this.size=c.length),i.updateURL()},sort:function(){var e=nu(this);Rae(e.entries,function(r,i){return r.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var r,i=nu(this).entries,o=vae(e,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)o((r=i[c++]).value,r.key,this)},keys:function(){return new GN(this,"keys")},values:function(){return new GN(this,"values")},entries:function(){return new GN(this,"entries")}},{enumerable:!0}),F4(sv,Cae,sv.entries,{}),F4(sv,"toString",function(){return nu(this).serialize()},{enumerable:!0}),rv&&mae(sv,"size",{get:function(){return nu(this).entries.length},configurable:!0,enumerable:!0}),_ae(NI,zb),UN({global:!0,forced:!V4},{URLSearchParams:NI}),!V4&&FN(Gb)){var Bae=ah($4.has),Wae=ah($4.set),t3=function(e){if(B4(e)){var r,i=e.body;if(Sae(i)===zb)return r=e.headers?new Gb(e.headers):new Gb,Bae(r,"content-type")||Wae(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Tae(e,{body:W4(0,sc(i)),headers:W4(0,r)})}return e};if(FN(H4)&&UN({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return H4(e,arguments.length>1?t3(arguments[1]):{})}}),FN(kI)){var HN=function(e){return j4(this,WN),new kI(e,arguments.length>1?t3(arguments[1]):{})};WN.constructor=HN,HN.prototype=WN,UN({global:!0,dontCallGetSet:!0,forced:!0},{Request:HN})}}var ru,zae={URLSearchParams:NI,getState:nu},Gae=Et.URLSearchParams,n3=nt,Hae=A,$ae=ve,Kae=d,$N=Ic,qae=Cc,Yae=Ne,Xae=Lo,Jae=un,ov=Object.assign,r3=Object.defineProperty,Qae=Hae([].concat),Zae=!ov||Kae(function(){if(n3&&ov({b:1},ov(r3({},"a",{enumerable:!0,get:function(){r3(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(c){r[c]=c}),ov({},e)[i]!=7||$N(ov({},r)).join("")!=o})?function(e,r){for(var i=Xae(e),o=arguments.length,c=1,u=qae.f,h=Yae.f;o>c;)for(var m,_=Jae(arguments[c++]),y=u?Qae($N(_),u(_)):$N(_),S=y.length,R=0;S>R;)m=y[R++],n3&&!$ae(h,_,m)||(i[m]=_[m]);return i}:ov,ece=ln,tce=Jg,nce=De,rce=ve,ice=Lo,sce=function(e,r,i,o){try{return o?r(ece(i)[0],i[1]):r(i)}catch(c){tce(e,"throw",c)}},oce=Yg,ace=c_,cce=ai,i3=PI,lce=Xg,uce=Xu,s3=Array,__=A,KN=2147483647,dce=/[^\0-\u007E]/,o3=/[.\u3002\uFF0E\uFF61]/g,a3="Overflow: input needs wider integers to process",c3=RangeError,hce=__(o3.exec),av=Math.floor,qN=String.fromCharCode,l3=__("".charCodeAt),u3=__([].join),bm=__([].push),pce=__("".replace),fce=__("".split),mce=__("".toLowerCase),d3=function(e){return e+22+75*(e<26)},gce=function(e,r,i){var o=0;for(e=i?av(e/700):e>>1,e+=av(e/r);e>455;)e=av(e/35),o+=36;return av(o+36*e/(e+38))},_ce=function(e){var r=[];e=function(q){for(var Y=[],le=0,Ee=q.length;le<Ee;){var ye=l3(q,le++);if(ye>=55296&&ye<=56319&&le<Ee){var ge=l3(q,le++);(64512&ge)==56320?bm(Y,((1023&ye)<<10)+(1023&ge)+65536):(bm(Y,ye),le--)}else bm(Y,ye)}return Y}(e);var i,o,c=e.length,u=128,h=0,m=72;for(i=0;i<e.length;i++)(o=e[i])<128&&bm(r,qN(o));var _=r.length,y=_;for(_&&bm(r,"-");y<c;){var S=KN;for(i=0;i<e.length;i++)(o=e[i])>=u&&o<S&&(S=o);var R=y+1;if(S-u>av((KN-h)/R))throw c3(a3);for(h+=(S-u)*R,u=S,i=0;i<e.length;i++){if((o=e[i])<u&&++h>KN)throw c3(a3);if(o==u){for(var P=h,k=36;;){var z=k<=m?1:k>=m+26?26:k-m;if(P<z)break;var U=P-z,F=36-z;bm(r,qN(d3(z+U%F))),P=av(U/F),k+=36}bm(r,qN(d3(P))),m=gce(h,R,y==_),h=0,y++}}h++,u++}return u3(r,"")},Ece=Vn,YN=nt,yce=LN,XN=j,h3=De,iu=A,DI=Zu,su=Iy,vce=s_,JN=gi,QN=Zae,cv=function(e){var r=ice(e),i=ace(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=nce(c,o>2?arguments[2]:void 0));var h,m,_,y,S,R,P=uce(r),k=0;if(!P||this===s3&&oce(P))for(h=cce(r),m=i?new this(h):s3(h);h>k;k++)R=u?c(r[k],k):r[k],i3(m,k,R);else for(S=(y=lce(r,P)).next,m=i?new this:[];!(_=rce(S,y)).done;k++)R=u?sce(y,c,[_.value,k],!0):_.value,i3(m,k,R);return m.length=k,m},sd=xN,Sce=ON.codeAt,bce=function(e){var r,i,o=[],c=fce(pce(mce(e),o3,"."),".");for(r=0;r<c.length;r++)i=c[r],bm(o,hce(dce,i)?"xn--"+_ce(i):i);return u3(o,".")},Up=Ta,Tce=ed,wce=gl,p3=zae,f3=Qu,Rce=f3.set,LI=f3.getterFor("URL"),Cce=p3.URLSearchParams,Ice=p3.getState,Hb=XN.URL,ZN=XN.TypeError,xI=XN.parseInt,Ace=Math.floor,m3=Math.pow,ou=iu("".charAt),od=iu(/./.exec),$b=iu([].join),Pce=iu(1 .toString),Oce=iu([].pop),lv=iu([].push),eD=iu("".replace),kce=iu([].shift),Nce=iu("".split),Kb=iu("".slice),MI=iu("".toLowerCase),Dce=iu([].unshift),tD="Invalid scheme",E_="Invalid host",g3="Invalid port",_3=/[a-z]/i,Lce=/[\d+-.a-z]/i,nD=/\d/,xce=/^0x/i,Mce=/^[0-7]+$/,Uce=/^\d+$/,E3=/^[\da-f]+$/i,Vce=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Fce=/[\0\t\n\r #/:<>?@[\\\]^|]/,jce=/^[\u0000-\u0020]+/,Bce=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Wce=/[\t\n\r]/g,qb=function(e){var r,i,o,c;if(typeof e=="number"){for(r=[],i=0;i<4;i++)Dce(r,e%256),e=Ace(e/256);return $b(r,".")}if(typeof e=="object"){for(r="",o=function(u){for(var h=null,m=1,_=null,y=0,S=0;S<8;S++)u[S]!==0?(y>m&&(h=_,m=y),_=null,y=0):(_===null&&(_=S),++y);return y>m&&(h=_,m=y),h}(e),i=0;i<8;i++)c&&e[i]===0||(c&&(c=!1),o===i?(r+=i?":":"::",c=!0):(r+=Pce(e[i],16),i<7&&(r+=":")));return"["+r+"]"}return e},UI={},y3=QN({},UI,{" ":1,'"':1,"<":1,">":1,"`":1}),v3=QN({},y3,{"#":1,"?":1,"{":1,"}":1}),rD=QN({},v3,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Tm=function(e,r){var i=Sce(e,0);return i>32&&i<127&&!JN(r,e)?e:encodeURIComponent(e)},VI={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Yb=function(e,r){var i;return e.length==2&&od(_3,ou(e,0))&&((i=ou(e,1))==":"||!r&&i=="|")},S3=function(e){var r;return e.length>1&&Yb(Kb(e,0,2))&&(e.length==2||(r=ou(e,2))==="/"||r==="\\"||r==="?"||r==="#")},zce=function(e){return e==="."||MI(e)==="%2e"},iD={},b3={},sD={},T3={},w3={},oD={},R3={},C3={},FI={},jI={},aD={},cD={},lD={},uD={},I3={},dD={},uv={},ch={},A3={},y_={},Vp={},hD=function(e,r,i){var o,c,u,h=Up(e);if(r){if(c=this.parse(h))throw ZN(c);this.searchParams=null}else{if(i!==void 0&&(o=new hD(i,!0)),c=this.parse(h,null,o))throw ZN(c);(u=Ice(new Cce)).bindURL(this),this.searchParams=u}};hD.prototype={type:"URL",parse:function(e,r,i){var o,c,u,h,m,_=this,y=r||iD,S=0,R="",P=!1,k=!1,z=!1;for(e=Up(e),r||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=eD(e,jce,""),e=eD(e,Bce,"$1")),e=eD(e,Wce,""),o=cv(e);S<=o.length;){switch(c=o[S],y){case iD:if(!c||!od(_3,c)){if(r)return tD;y=sD;continue}R+=MI(c),y=b3;break;case b3:if(c&&(od(Lce,c)||c=="+"||c=="-"||c=="."))R+=MI(c);else{if(c!=":"){if(r)return tD;R="",y=sD,S=0;continue}if(r&&(_.isSpecial()!=JN(VI,R)||R=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=R,r)return void(_.isSpecial()&&VI[_.scheme]==_.port&&(_.port=null));R="",_.scheme=="file"?y=uD:_.isSpecial()&&i&&i.scheme==_.scheme?y=T3:_.isSpecial()?y=C3:o[S+1]=="/"?(y=w3,S++):(_.cannotBeABaseURL=!0,lv(_.path,""),y=A3)}break;case sD:if(!i||i.cannotBeABaseURL&&c!="#")return tD;if(i.cannotBeABaseURL&&c=="#"){_.scheme=i.scheme,_.path=sd(i.path),_.query=i.query,_.fragment="",_.cannotBeABaseURL=!0,y=Vp;break}y=i.scheme=="file"?uD:oD;continue;case T3:if(c!="/"||o[S+1]!="/"){y=oD;continue}y=FI,S++;break;case w3:if(c=="/"){y=jI;break}y=ch;continue;case oD:if(_.scheme=i.scheme,c==ru)_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=sd(i.path),_.query=i.query;else if(c=="/"||c=="\\"&&_.isSpecial())y=R3;else if(c=="?")_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=sd(i.path),_.query="",y=y_;else{if(c!="#"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=sd(i.path),_.path.length--,y=ch;continue}_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=sd(i.path),_.query=i.query,_.fragment="",y=Vp}break;case R3:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,y=ch;continue}y=jI}else y=FI;break;case C3:if(y=FI,c!="/"||ou(R,S+1)!="/")continue;S++;break;case FI:if(c!="/"&&c!="\\"){y=jI;continue}break;case jI:if(c=="@"){P&&(R="%40"+R),P=!0,u=cv(R);for(var U=0;U<u.length;U++){var F=u[U];if(F!=":"||z){var q=Tm(F,rD);z?_.password+=q:_.username+=q}else z=!0}R=""}else if(c==ru||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(P&&R=="")return"Invalid authority";S-=cv(R).length+1,R="",y=aD}else R+=c;break;case aD:case cD:if(r&&_.scheme=="file"){y=dD;continue}if(c!=":"||k){if(c==ru||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&R=="")return E_;if(r&&R==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(R))return h;if(R="",y=uv,r)return;continue}c=="["?k=!0:c=="]"&&(k=!1),R+=c}else{if(R=="")return E_;if(h=_.parseHost(R))return h;if(R="",y=lD,r==cD)return}break;case lD:if(!od(nD,c)){if(c==ru||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||r){if(R!=""){var Y=xI(R,10);if(Y>65535)return g3;_.port=_.isSpecial()&&Y===VI[_.scheme]?null:Y,R=""}if(r)return;y=uv;continue}return g3}R+=c;break;case uD:if(_.scheme="file",c=="/"||c=="\\")y=I3;else{if(!i||i.scheme!="file"){y=ch;continue}if(c==ru)_.host=i.host,_.path=sd(i.path),_.query=i.query;else if(c=="?")_.host=i.host,_.path=sd(i.path),_.query="",y=y_;else{if(c!="#"){S3($b(sd(o,S),""))||(_.host=i.host,_.path=sd(i.path),_.shortenPath()),y=ch;continue}_.host=i.host,_.path=sd(i.path),_.query=i.query,_.fragment="",y=Vp}}break;case I3:if(c=="/"||c=="\\"){y=dD;break}i&&i.scheme=="file"&&!S3($b(sd(o,S),""))&&(Yb(i.path[0],!0)?lv(_.path,i.path[0]):_.host=i.host),y=ch;continue;case dD:if(c==ru||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&Yb(R))y=ch;else if(R==""){if(_.host="",r)return;y=uv}else{if(h=_.parseHost(R))return h;if(_.host=="localhost"&&(_.host=""),r)return;R="",y=uv}continue}R+=c;break;case uv:if(_.isSpecial()){if(y=ch,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=ru&&(y=ch,c!="/"))continue}else _.fragment="",y=Vp;else _.query="",y=y_;break;case ch:if(c==ru||c=="/"||c=="\\"&&_.isSpecial()||!r&&(c=="?"||c=="#")){if((m=MI(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||lv(_.path,"")):zce(R)?c=="/"||c=="\\"&&_.isSpecial()||lv(_.path,""):(_.scheme=="file"&&!_.path.length&&Yb(R)&&(_.host&&(_.host=""),R=ou(R,0)+":"),lv(_.path,R)),R="",_.scheme=="file"&&(c==ru||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)kce(_.path);c=="?"?(_.query="",y=y_):c=="#"&&(_.fragment="",y=Vp)}else R+=Tm(c,v3);break;case A3:c=="?"?(_.query="",y=y_):c=="#"?(_.fragment="",y=Vp):c!=ru&&(_.path[0]+=Tm(c,UI));break;case y_:r||c!="#"?c!=ru&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":Tm(c,UI)):(_.fragment="",y=Vp);break;case Vp:c!=ru&&(_.fragment+=Tm(c,y3))}S++}},parseHost:function(e){var r,i,o;if(ou(e,0)=="["){if(ou(e,e.length-1)!="]"||(r=function(c){var u,h,m,_,y,S,R,P=[0,0,0,0,0,0,0,0],k=0,z=null,U=0,F=function(){return ou(c,U)};if(F()==":"){if(ou(c,1)!=":")return;U+=2,z=++k}for(;F();){if(k==8)return;if(F()!=":"){for(u=h=0;h<4&&od(E3,F());)u=16*u+xI(F(),16),U++,h++;if(F()=="."){if(h==0||(U-=h,k>6))return;for(m=0;F();){if(_=null,m>0){if(!(F()=="."&&m<4))return;U++}if(!od(nD,F()))return;for(;od(nD,F());){if(y=xI(F(),10),_===null)_=y;else{if(_==0)return;_=10*_+y}if(_>255)return;U++}P[k]=256*P[k]+_,++m!=2&&m!=4||k++}if(m!=4)return;break}if(F()==":"){if(U++,!F())return}else if(F())return;P[k++]=u}else{if(z!==null)return;U++,z=++k}}if(z!==null)for(S=k-z,k=7;k!=0&&S>0;)R=P[k],P[k--]=P[z+S-1],P[z+--S]=R;else if(k!=8)return;return P}(Kb(e,1,-1)),!r))return E_;this.host=r}else if(this.isSpecial()){if(e=bce(e),od(Vce,e)||(r=function(c){var u,h,m,_,y,S,R,P=Nce(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((_=P[m])=="")return c;if(y=10,_.length>1&&ou(_,0)=="0"&&(y=od(xce,_)?16:8,_=Kb(_,y==8?1:2)),_==="")S=0;else{if(!od(y==10?Uce:y==8?Mce:E3,_))return c;S=xI(_,y)}lv(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=m3(256,5-u))return null}else if(S>255)return null;for(R=Oce(h),m=0;m<h.length;m++)R+=h[m]*m3(256,3-m);return R}(e),r===null))return E_;this.host=r}else{if(od(Fce,e))return E_;for(r="",i=cv(e),o=0;o<i.length;o++)r+=Tm(i[o],UI);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return JN(VI,this.scheme)},shortenPath:function(){var e=this.path,r=e.length;!r||this.scheme=="file"&&r==1&&Yb(e[0],!0)||e.length--},serialize:function(){var e=this,r=e.scheme,i=e.username,o=e.password,c=e.host,u=e.port,h=e.path,m=e.query,_=e.fragment,y=r+":";return c!==null?(y+="//",e.includesCredentials()&&(y+=i+(o?":"+o:"")+"@"),y+=qb(c),u!==null&&(y+=":"+u)):r=="file"&&(y+="//"),y+=e.cannotBeABaseURL?h[0]:h.length?"/"+$b(h,"/"):"",m!==null&&(y+="?"+m),_!==null&&(y+="#"+_),y},setHref:function(e){var r=this.parse(e);if(r)throw ZN(r);this.searchParams.update()},getOrigin:function(){var e=this.scheme,r=this.port;if(e=="blob")try{return new dv(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+qb(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Up(e)+":",iD)},getUsername:function(){return this.username},setUsername:function(e){var r=cv(Up(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=Tm(r[i],rD)}},getPassword:function(){return this.password},setPassword:function(e){var r=cv(Up(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=Tm(r[i],rD)}},getHost:function(){var e=this.host,r=this.port;return e===null?"":r===null?qb(e):qb(e)+":"+r},setHost:function(e){this.cannotBeABaseURL||this.parse(e,aD)},getHostname:function(){var e=this.host;return e===null?"":qb(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,cD)},getPort:function(){var e=this.port;return e===null?"":Up(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Up(e))==""?this.port=null:this.parse(e,lD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+$b(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,uv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Up(e))==""?this.query=null:(ou(e,0)=="?"&&(e=Kb(e,1)),this.query="",this.parse(e,y_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Up(e))!=""?(ou(e,0)=="#"&&(e=Kb(e,1)),this.fragment="",this.parse(e,Vp)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var dv=function(e){var r=vce(this,oc),i=wce(arguments.length,1)>1?arguments[1]:void 0,o=Rce(r,new hD(e,!1,i));YN||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},oc=dv.prototype,au=function(e,r){return{get:function(){return LI(this)[e]()},set:r&&function(i){return LI(this)[r](i)},configurable:!0,enumerable:!0}};if(YN&&(su(oc,"href",au("serialize","setHref")),su(oc,"origin",au("getOrigin")),su(oc,"protocol",au("getProtocol","setProtocol")),su(oc,"username",au("getUsername","setUsername")),su(oc,"password",au("getPassword","setPassword")),su(oc,"host",au("getHost","setHost")),su(oc,"hostname",au("getHostname","setHostname")),su(oc,"port",au("getPort","setPort")),su(oc,"pathname",au("getPathname","setPathname")),su(oc,"search",au("getSearch","setSearch")),su(oc,"searchParams",au("getSearchParams")),su(oc,"hash",au("getHash","setHash"))),DI(oc,"toJSON",function(){return LI(this).serialize()},{enumerable:!0}),DI(oc,"toString",function(){return LI(this).serialize()},{enumerable:!0}),Hb){var P3=Hb.createObjectURL,O3=Hb.revokeObjectURL;P3&&DI(dv,"createObjectURL",h3(P3,Hb)),O3&&DI(dv,"revokeObjectURL",h3(O3,Hb))}Tce(dv,"URL"),Ece({global:!0,forced:!yce,sham:!YN},{URL:dv});var Gce=Vn,Hce=d,$ce=gl,k3=Ta,Kce=LN,N3=cn("URL");Gce({target:"URL",stat:!0,forced:!(Kce&&Hce(function(){N3.canParse()}))},{canParse:function(e){var r=$ce(arguments.length,1),i=k3(e),o=r<2||arguments[1]===void 0?void 0:k3(arguments[1]);try{return!!new N3(i,o)}catch{return!1}}});var BI=l(Et.URL);let D3=!0,L3=!0;function WI(e,r,i){const o=e.match(r);return o&&o.length>=i&&parseInt(o[i],10)}function v_(e,r,i){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const _=y=>{const S=i(y);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const _=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function qce(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(D3=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Yce(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(L3=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function x3(){if(typeof window=="object"){if(D3)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function pD(e,r){L3&&console.warn(e+" is deprecated, please use "+r+" instead.")}function M3(e){return Object.prototype.toString.call(e)==="[object Object]"}function U3(e){var r;return M3(e)?ec(r=Object.keys(e)).call(r,function(i,o){const c=M3(e[o]),u=c?U3(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[o]:u})},{}):e}function fD(e,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?fD(e,e.get(r[o]),i):o.endsWith("Ids")&&r[o].forEach(c=>{fD(e,e.get(c),i)})}))}function V3(e,r,i){const o=i?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===o&&m.trackId===h.id&&fD(e,m,c)})}),c}const F3=x3;function j3(e,r){const i=e&&e.navigator;if(!i.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const y=typeof h[_]=="object"?h[_]:{ideal:h[_]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);const S=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(y.ideal!==void 0){m.optional=m.optional||[];let R={};typeof y.ideal=="number"?(R[S("min",_)]=y.ideal,m.optional.push(R),R={},R[S("max",_)]=y.ideal,m.optional.push(R)):(R[S("",_)]=y.ideal,m.optional.push(R))}y.exact!==void 0&&typeof y.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=y.exact):["min","max"].forEach(R=>{y[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,_)]=y[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(y,S,R){S in y&&!(R in y)&&(y[R]=y[S],delete y[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const y=r.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||y)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return i.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(k=>k.kind==="videoinput")).find(k=>S.some(z=>{var U;return st(U=k.label.toLowerCase()).call(U,z)}));return!P&&R.length&&st(S).call(S,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=_.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=o(h.video),F3("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return F3("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,m,_){c(h,y=>{i.webkitGetUserMedia(y,m,S=>{_&&_(u(S))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return c(m,_=>h(_).then(y=>{if(_.audio&&!y.getAudioTracks().length||_.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return y},y=>lt.reject(u(y))))}}}function B3(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function W3(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else v_(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function z3(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let _=c.apply(this,arguments);return _||(_=r(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function G3(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,o,c]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);const u=function(m){const _={};return m.result().forEach(y=>{const S={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(R=>{S[R]=y.stat(R)}),_[S.id]=S}),_},h=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){o(h(u(_)))};return r.apply(this,[m,i])}return new lt((m,_)=>{r.apply(this,[function(y){m(h(u(y)))},_])}).then(o,c)}}function H3(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>V3(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(c=>c._pc=this),o}),v_(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>V3(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===i&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||o&&c?lt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():lt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function $3(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function K3(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return $3(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(y=>this._reverseStreams[y.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(y=>{if(this.getSenders().find(R=>R.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const y=new e.MediaStream(_.getTracks());this._streams[_.id]=y,this._reverseStreams[y.id]=_,_=y}o.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(k.id,"g"),P.id)}),new RTCSessionDescription({type:y.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(k=>k===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[y.id];if(P)P.addTrack(_),lt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new e.MediaStream([_]);this._streams[y.id]=k,this._reverseStreams[k.id]=y,this.addStream(k)}return this.getSenders().find(k=>k.track===_)},["createOffer","createAnswer"].forEach(function(_){const y=e.RTCPeerConnection.prototype[_],S={[_](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[P=>{const k=u(this,P);R[0].apply(null,[k])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):y.apply(this,arguments).then(P=>u(this,P))}};e.RTCPeerConnection.prototype[_]=S[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(P.id,"g"),k.id)}),new RTCSessionDescription({type:y.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>_.track===R)&&(y=this._streams[S])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function mD(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]})}function q3(e,r){v_(e,"negotiationneeded",i=>{const o=i.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var Y3=Object.freeze({__proto__:null,fixNegotiationNeeded:q3,shimAddTrackRemoveTrack:K3,shimAddTrackRemoveTrackWithNative:$3,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof r=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(o=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:z3,shimGetStats:G3,shimGetUserMedia:j3,shimMediaStream:B3,shimOnTrack:W3,shimPeerConnection:mD,shimSenderReceiverGetStats:H3});function X3(e,r){const i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){pD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,m,_){m in h&&!(_ in h)&&(h[_]=h[m],delete h[m])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function J3(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gD(e,r){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(_=>{_.type=i[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((y,S)=>{m.set(S,Object.assign({},y,{type:i[y.type]||y.type}))})}return m}).then(u,h)}}function Q3(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):lt.resolve(new Map)}}function Z3(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i}),v_(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function e5(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(r){pD("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&st(o=r.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function t5(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function n5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const o=i.length>0;o&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function r5(e){if(typeof e!="object"||!e.RTCRtpSender)return;const r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){const i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function i5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?lt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function s5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?lt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var o5=Object.freeze({__proto__:null,shimAddTransceiver:n5,shimCreateAnswer:s5,shimCreateOffer:i5,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,lt.reject(o)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:r5,shimGetUserMedia:X3,shimOnTrack:J3,shimPeerConnection:gD,shimRTCDataChannel:t5,shimReceiverGetStats:Z3,shimRemoveStream:e5,shimSenderGetStats:Q3});function a5(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),st(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>r.call(this,c,i)),i.getVideoTracks().forEach(c=>r.call(this,c,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?st(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);const o=r.getTracks();this.getSenders().forEach(c=>{st(o).call(o,c.track)&&this.removeTrack(c)})})}}function c5(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),st(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),r.apply(i,arguments)}}}function l5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],R=i.apply(this,[S]);return y?(R.then(_,y),lt.resolve()):R},r.createAnswer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return y?(R.then(_,y),lt.resolve()):R};let m=function(_,y,S){const R=c.apply(this,[_]);return S?(R.then(y,S),lt.resolve()):R};r.setLocalDescription=m,m=function(_,y,S){const R=u.apply(this,[_]);return S?(R.then(y,S),lt.resolve()):R},r.setRemoteDescription=m,m=function(_,y,S){const R=h.apply(this,[_]);return S?(R.then(y,S),lt.resolve()):R},r.addIceCandidate=m}function u5(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,o=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=c=>o(d5(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(i,o,c){r.mediaDevices.getUserMedia(i).then(o,c)}).bind(r))}function d5(e){return e&&e.video!==void 0?Object.assign({},e,{video:U3(e.video)}):e}function h5(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(pD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new r(i,o)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function p5(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function f5(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function m5(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var g5=Object.freeze({__proto__:null,shimAudioContext:m5,shimCallbacksAPI:l5,shimConstraints:d5,shimCreateOfferLegacy:f5,shimGetUserMedia:u5,shimLocalStreamsAPI:a5,shimRTCIceServerUrls:h5,shimRemoteStreamsAPI:c5,shimTrackEventTransceiver:p5}),_5=`	
\v\f\r \u2028\u2029\uFEFF`,Xce=$t,Jce=Ta,_D=_5,E5=A("".replace),Qce=RegExp("^["+_D+"]+"),Zce=RegExp("(^|[^"+_D+"])["+_D+"]+$"),ele=function(e){return function(r){var i=Jce(Xce(r));return 1&e&&(i=E5(i,Qce,"")),2&e&&(i=E5(i,Zce,"$1")),i}},tle={trim:ele(3)},nle=YC.PROPER,rle=d,y5=_5,ile=tle.trim;Vn({target:"String",proto:!0,forced:function(e){return rle(function(){return!!y5[e]()||""[e]()!==""||nle&&y5[e].name!==e})}("trim")},{trim:function(){return ile(this)}});var sle=Za("String").trim,ole=N,ale=sle,ED=String.prototype,cle=function(e){var r=e.trim;return typeof e=="string"||e===ED||ole(ED,e)&&r===ED.trim?ale:r},oo=l(cle),v5={exports:{}};(function(e){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(i){return i.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(i){const o=r.splitSections(i);return o&&o[0]},r.getMediaSections=function(i){const o=r.splitSections(i);return o.shift(),o},r.matchPrefix=function(i,o){return r.splitLines(i).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},r.writeCandidate=function(i){const o=[];o.push(i.foundation);const c=i.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);const u=i.type;return o.push("typ"),o.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let o=i.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(i){const o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){const o={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(i){let o="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},r.parseRtcpFb=function(i){const o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(i){let o="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(i){const o=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,o),10)},u=i.indexOf(":",o);return u>-1?(c.attribute=i.substring(o+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(o+1),c},r.parseSsrcGroup=function(i){const o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(i){const o=r.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(i){const o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:r.matchPrefix(i+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,o){let c="a=setup:"+o+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(i){const o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,o){return r.matchPrefix(i+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,o){const c=r.matchPrefix(i+o,"a=ice-ufrag:")[0],u=r.matchPrefix(i+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(i){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(i)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],_=r.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(_){const y=r.parseRtpMap(_),S=r.matchPrefix(i,"a=fmtp:"+m+" ");switch(y.parameters=S.length?r.parseFmtp(S[0]):{},y.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(y.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(i,o){let c="";c+="m="+i+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(i){const o=[],c=r.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(i,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),_=m.length>0&&m[0].ssrc;let y;const S=r.matchPrefix(i,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(k=>parseInt(k,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(y=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let k={ssrc:_,codecPayloadType:parseInt(P.parameters.apt,10)};_&&y&&(k.rtx={ssrc:y}),o.push(k),u&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(k))}}),o.length===0&&_&&o.push({ssrc:_});let R=r.matchPrefix(i,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(P=>{P.maxBitrate=R})),o},r.parseRtcpParameters=function(i){const o={},c=r.matchPrefix(i,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=r.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=r.matchPrefix(i,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},r.parseMsid=function(i){let o;const c=r.matchPrefix(i,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=r.matchPrefix(i,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(i){const o=r.parseMLine(i),c=r.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=r.matchPrefix(i,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},r.writeSctpDescription=function(i,o){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,o,c){let u;const h=o!==void 0?o:2;return u=i||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,o){const c=r.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){const o=r.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(i){const o=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const o=r.splitLines(i);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=r})(v5);var S5=v5.exports,hv=l(S5),lle=s({__proto__:null,default:hv},[S5]);function zI(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const r=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const o=new r(i),c=hv.parseCandidate(i.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(i)},e.RTCIceCandidate.prototype=r.prototype,v_(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function yD(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||v_(e,"icecandidate",r=>{if(r.candidate){const i=hv.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function GI(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(m){if(!m||!m.sdp)return!1;const _=hv.splitSections(m.sdp);return _.shift(),_.some(y=>{const S=hv.parseMLine(y);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const y=parseInt(_[1],10);return y!=y?-1:y},c=function(m){let _=65536;return r.browser==="firefox"&&(_=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),_},u=function(m,_){let y=65536;r.browser==="firefox"&&r.version===57&&(y=65535);const S=hv.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?y=parseInt(S[0].substr(19),10):r.browser==="firefox"&&_!==-1&&(y=2147483637),y},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=o(arguments[0]),_=c(m),y=u(arguments[0],m);let S;S=_===0&&y===0?Number.POSITIVE_INFINITY:_===0||y===0?Math.max(_,y):Math.min(_,y);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function HI(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function r(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return r(o,this),o},v_(e,"datachannel",o=>(r(o.channel,o.target),o))}function vD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const o=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function SD(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>oo(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return i.apply(this,arguments)}}function $I(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?lt.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),lt.resolve())})}function KI(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var ule=Object.freeze({__proto__:null,removeExtmapAllowMixed:SD,shimAddIceCandidateNullOrEmpty:$I,shimConnectionState:vD,shimMaxMessageSize:GI,shimParameterlessSetLocalDescription:KI,shimRTCIceCandidate:zI,shimRTCIceCandidateRelayProtocol:yD,shimSendThrowTypeError:HI});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=x3,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=WI(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=WI(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=WI(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:ule,extractVersion:WI,disableLog:qce,disableWarnings:Yce,sdp:lle};switch(o.browser){case"chrome":if(!Y3||!mD||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=Y3,$I(e,o),KI(e),j3(e,o),B3(e),mD(e,o),W3(e),K3(e,o),z3(e),G3(e),H3(e),q3(e,o),zI(e),yD(e),vD(e),GI(e,o),HI(e),SD(e,o);break;case"firefox":if(!o5||!gD||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=o5,$I(e,o),KI(e),X3(e,o),gD(e,o),J3(e),e5(e),Q3(e),Z3(e),t5(e),n5(e),r5(e),i5(e),s5(e),zI(e),vD(e),GI(e,o),HI(e);break;case"safari":if(!g5||!r.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=g5,$I(e,o),KI(e),h5(e),f5(e),l5(e),a5(e),c5(e),p5(e),u5(e),m5(e),zI(e),yD(e),GI(e,o),HI(e),SD(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var b5=ms,dle=TypeError,T5=dr.match(/firefox\/(\d+)/i),hle=!!T5&&+T5[1],ple=/MSIE|Trident/.test(dr),w5=dr.match(/AppleWebKit\/(\d+)\./),fle=!!w5&&+w5[1],mle=Vn,R5=A,gle=gs,_le=Lo,C5=ai,Ele=function(e,r){if(!delete e[r])throw dle("Cannot delete property "+b5(r)+" of "+b5(e))},I5=Ta,bD=d,yle=U4,vle=mp,A5=hle,Sle=ple,P5=Zr,O5=fle,wm=[],k5=R5(wm.sort),ble=R5(wm.push),Tle=bD(function(){wm.sort(void 0)}),wle=bD(function(){wm.sort(null)}),Rle=vle("sort"),N5=!bD(function(){if(P5)return P5<70;if(!(A5&&A5>3)){if(Sle)return!0;if(O5)return O5<603;var e,r,i,o,c="";for(e=65;e<76;e++){switch(r=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)wm.push({k:r+o,v:i})}for(wm.sort(function(u,h){return h.v-u.v}),o=0;o<wm.length;o++)r=wm[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});mle({target:"Array",proto:!0,forced:Tle||!wle||!Rle||!N5},{sort:function(e){e!==void 0&&gle(e);var r=_le(this);if(N5)return e===void 0?k5(r):k5(r,e);var i,o,c=[],u=C5(r);for(o=0;o<u;o++)o in r&&ble(c,r[o]);for(yle(c,function(h){return function(m,_){return _===void 0?-1:m===void 0?1:h!==void 0?+h(m,_)||0:I5(m)>I5(_)?1:-1}}(e)),i=C5(c),o=0;o<i;)r[o]=c[o++];for(;o<u;)Ele(r,o++);return r}});var Cle=Za("Array").sort,Ile=N,Ale=Cle,TD=Array.prototype,Ple=function(e){var r=e.sort;return e===TD||Ile(TD,e)&&r===TD.sort?Ale:r},Xb=l(Ple),wD=j;Vn({global:!0,forced:wD.globalThis!==wD},{globalThis:wD});var D5=l(j),RD={exports:{}};(function(e,r){(function(i,o){var c="function",u="undefined",h="object",m="string",_="major",y="model",S="name",R="type",P="vendor",k="version",z="architecture",U="console",F="mobile",q="tablet",Y="smarttv",le="wearable",Ee="embedded",ye="Amazon",ge="Apple",ke="ASUS",qe="BlackBerry",ut="Browser",ft="Chrome",yn="Firefox",vn="Google",ur="Huawei",ni="LG",Gr="Microsoft",ra="Motorola",je="Opera",it="Samsung",St="Sharp",ze="Sony",x="Xiaomi",ie="Zebra",de="Facebook",Xe="Chromium OS",qt="Mac OS",rr=function(bi){for(var Gi={},br=0;br<bi.length;br++)Gi[bi[br].toUpperCase()]=bi[br];return Gi},zi=function(bi,Gi){return typeof bi===m&&Ma(Gi).indexOf(Ma(bi))!==-1},Ma=function(bi){return bi.toLowerCase()},tf=function(bi,Gi){if(typeof bi===m)return bi=bi.replace(/^\s\s*/,""),typeof Gi===u?bi:bi.substring(0,350)},J_=function(bi,Gi){for(var br,lc,Ih,ri,Bn,Ua,$m=0;$m<Gi.length&&!Bn;){var vd=Gi[$m],o$=Gi[$m+1];for(br=lc=0;br<vd.length&&!Bn&&vd[br];)if(Bn=vd[br++].exec(bi))for(Ih=0;Ih<o$.length;Ih++)Ua=Bn[++lc],typeof(ri=o$[Ih])===h&&ri.length>0?ri.length===2?typeof ri[1]==c?this[ri[0]]=ri[1].call(this,Ua):this[ri[0]]=ri[1]:ri.length===3?typeof ri[1]!==c||ri[1].exec&&ri[1].test?this[ri[0]]=Ua?Ua.replace(ri[1],ri[2]):o:this[ri[0]]=Ua?ri[1].call(this,Ua,ri[2]):o:ri.length===4&&(this[ri[0]]=Ua?ri[3].call(this,Ua.replace(ri[1],ri[2])):o):this[ri]=Ua||o;$m+=2}},ZT=function(bi,Gi){for(var br in Gi)if(typeof Gi[br]===h&&Gi[br].length>0){for(var lc=0;lc<Gi[br].length;lc++)if(zi(Gi[br][lc],bi))return br==="?"?o:br}else if(zi(Gi[br],bi))return br==="?"?o:br;return bi},GP={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},HP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[k,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[k,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,k],[/opios[\/ ]+([\w\.]+)/i],[k,[S,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[k,[S,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,k],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[k,[S,"UC"+ut]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[k,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[k,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[k,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[k,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[k,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+ut],k],[/\bfocus\/([\w\.]+)/i],[k,[S,yn+" Focus"]],[/\bopt\/([\w\.]+)/i],[k,[S,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[k,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[k,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[k,[S,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[k,[S,"MIUI "+ut]],[/fxios\/([-\w\.]+)/i],[k,[S,yn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+ut]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+ut],k],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],k],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,k],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,de],k],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,k],[/\bgsa\/([\w\.]+) .*safari\//i],[k,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[k,[S,ft+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,ft+" WebView"],k],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[k,[S,"Android "+ut]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,k],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[k,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[k,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[k,ZT,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,k],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],k],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[k,[S,yn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,k],[/(cobalt)\/([\w\.]+)/i],[S,[k,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[z,"amd64"]],[/(ia32(?=;))/i],[[z,Ma]],[/((?:i[346]|x)86)[;\)]/i],[[z,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[z,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[z,"armhf"]],[/windows (ce|mobile); ppc;/i],[[z,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[z,/ower/,"",Ma]],[/(sun4\w)[;\)]/i],[[z,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[z,Ma]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[P,it],[R,q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[y,[P,it],[R,F]],[/\((ip(?:hone|od)[\w ]*);/i],[y,[P,ge],[R,F]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[P,ge],[R,q]],[/(macintosh);/i],[y,[P,ge]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[P,St],[R,F]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[y,[P,ur],[R,q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[P,ur],[R,F]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[y,/_/g," "],[P,x],[R,F]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[y,/_/g," "],[P,x],[R,q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[P,"OPPO"],[R,F]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[P,"Vivo"],[R,F]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[y,[P,"Realme"],[R,F]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[P,ra],[R,F]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[P,ra],[R,q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[P,ni],[R,q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[P,ni],[R,F]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[y,[P,"Lenovo"],[R,q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[y,/_/g," "],[P,"Nokia"],[R,F]],[/(pixel c)\b/i],[y,[P,vn],[R,q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[P,vn],[R,F]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[P,ze],[R,F]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[P,ze],[R,q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[P,"OnePlus"],[R,F]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[P,ye],[R,q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[P,ye],[R,F]],[/(playbook);[-\w\),; ]+(rim)/i],[y,P,[R,q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[P,qe],[R,F]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[P,ke],[R,q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[P,ke],[R,F]],[/(nexus 9)/i],[y,[P,"HTC"],[R,q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[y,/_/g," "],[R,F]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[P,"Acer"],[R,q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[P,"Meizu"],[R,F]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,y,[R,F]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,y,[R,q]],[/(surface duo)/i],[y,[P,Gr],[R,q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[P,"Fairphone"],[R,F]],[/(u304aa)/i],[y,[P,"AT&T"],[R,F]],[/\bsie-(\w*)/i],[y,[P,"Siemens"],[R,F]],[/\b(rct\w+) b/i],[y,[P,"RCA"],[R,q]],[/\b(venue[\d ]{2,7}) b/i],[y,[P,"Dell"],[R,q]],[/\b(q(?:mv|ta)\w+) b/i],[y,[P,"Verizon"],[R,q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[P,"Barnes & Noble"],[R,q]],[/\b(tm\d{3}\w+) b/i],[y,[P,"NuVision"],[R,q]],[/\b(k88) b/i],[y,[P,"ZTE"],[R,q]],[/\b(nx\d{3}j) b/i],[y,[P,"ZTE"],[R,F]],[/\b(gen\d{3}) b.+49h/i],[y,[P,"Swiss"],[R,F]],[/\b(zur\d{3}) b/i],[y,[P,"Swiss"],[R,q]],[/\b((zeki)?tb.*\b) b/i],[y,[P,"Zeki"],[R,q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],y,[R,q]],[/\b(ns-?\w{0,9}) b/i],[y,[P,"Insignia"],[R,q]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[P,"NextBook"],[R,q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],y,[R,F]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],y,[R,F]],[/\b(ph-1) /i],[y,[P,"Essential"],[R,F]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[P,"Envizen"],[R,q]],[/\b(trio[-\w\. ]+) b/i],[y,[P,"MachSpeed"],[R,q]],[/\btu_(1491) b/i],[y,[P,"Rotor"],[R,q]],[/(shield[\w ]+) b/i],[y,[P,"Nvidia"],[R,q]],[/(sprint) (\w+)/i],[P,y,[R,F]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[P,Gr],[R,F]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[P,ie],[R,q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[P,ie],[R,F]],[/smart-tv.+(samsung)/i],[P,[R,Y]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[P,it],[R,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,ni],[R,Y]],[/(apple) ?tv/i],[P,[y,ge+" TV"],[R,Y]],[/crkey/i],[[y,ft+"cast"],[P,vn],[R,Y]],[/droid.+aft(\w)( bui|\))/i],[y,[P,ye],[R,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[P,St],[R,Y]],[/(bravia[\w ]+)( bui|\))/i],[y,[P,ze],[R,Y]],[/(mitv-\w{5}) bui/i],[y,[P,x],[R,Y]],[/Hbbtv.*(technisat) (.*);/i],[P,y,[R,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,tf],[y,tf],[R,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,y,[R,U]],[/droid.+; (shield) bui/i],[y,[P,"Nvidia"],[R,U]],[/(playstation [345portablevi]+)/i],[y,[P,ze],[R,U]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[P,Gr],[R,U]],[/((pebble))app/i],[P,y,[R,le]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[P,ge],[R,le]],[/droid.+; (glass) \d/i],[y,[P,vn],[R,le]],[/droid.+; (wt63?0{2,3})\)/i],[y,[P,ie],[R,le]],[/(quest( 2| pro)?)/i],[y,[P,de],[R,le]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,Ee]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[y,[R,F]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[R,q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,F]],[/(android[-\w\. ]{0,9});.+buil/i],[y,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[k,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[k,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,k],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[k,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,k],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[k,ZT,GP]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[k,ZT,GP]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[k,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,qt],[k,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[k,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,k],[/\(bb(10);/i],[k,[S,qe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[k,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[k,[S,yn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[k,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[k,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[k,[S,ft+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Xe],k],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,k],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],k],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,k]]},Al=function(bi,Gi){if(typeof bi===h&&(Gi=bi,bi=o),!(this instanceof Al))return new Al(bi,Gi).getResult();var br=typeof i!==u&&i.navigator?i.navigator:o,lc=bi||(br&&br.userAgent?br.userAgent:""),Ih=br&&br.userAgentData?br.userAgentData:o,ri=Gi?function(Bn,Ua){var $m={};for(var vd in Bn)Ua[vd]&&Ua[vd].length%2==0?$m[vd]=Ua[vd].concat(Bn[vd]):$m[vd]=Bn[vd];return $m}(HP,Gi):HP;return this.getBrowser=function(){var Bn={};return Bn[S]=o,Bn[k]=o,J_.call(Bn,lc,ri.browser),Bn[_]=function(Ua){return typeof Ua===m?Ua.replace(/[^\d\.]/g,"").split(".")[0]:o}(Bn[k]),br&&br.brave&&typeof br.brave.isBrave==c&&(Bn[S]="Brave"),Bn},this.getCPU=function(){var Bn={};return Bn[z]=o,J_.call(Bn,lc,ri.cpu),Bn},this.getDevice=function(){var Bn={};return Bn[P]=o,Bn[y]=o,Bn[R]=o,J_.call(Bn,lc,ri.device),!Bn[R]&&Ih&&Ih.mobile&&(Bn[R]=F),Bn[y]=="Macintosh"&&br&&typeof br.standalone!==u&&br.maxTouchPoints&&br.maxTouchPoints>2&&(Bn[y]="iPad",Bn[R]=q),Bn},this.getEngine=function(){var Bn={};return Bn[S]=o,Bn[k]=o,J_.call(Bn,lc,ri.engine),Bn},this.getOS=function(){var Bn={};return Bn[S]=o,Bn[k]=o,J_.call(Bn,lc,ri.os),!Bn[S]&&Ih&&Ih.platform!="Unknown"&&(Bn[S]=Ih.platform.replace(/chrome os/i,Xe).replace(/macos/i,qt)),Bn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return lc},this.setUA=function(Bn){return lc=typeof Bn===m&&Bn.length>350?tf(Bn,350):Bn,this},this.setUA(lc),this};Al.VERSION="0.7.34",Al.BROWSER=rr([S,k,_]),Al.CPU=rr([z]),Al.DEVICE=rr([y,P,R,U,F,Y,q,le,Ee]),Al.ENGINE=Al.OS=rr([S,k]),e.exports&&(r=e.exports=Al),r.UAParser=Al;var Hm=typeof i!==u&&(i.jQuery||i.Zepto);if(Hm&&!Hm.ua){var Q_=new Al;Hm.ua=Q_.getResult(),Hm.ua.get=function(){return Q_.getUA()},Hm.ua.set=function(bi){Q_.setUA(bi);var Gi=Q_.getResult();for(var br in Gi)Hm.ua[br]=Gi[br]}}})(typeof window=="object"?window:a)})(RD,RD.exports);var Ole=l(RD.exports),kle=wc,Nle=gi,Dle=xt,Lle=Yd,xle=fr("iterator"),Mle=Object,Ule=function(e){if(Dle(e))return!1;var r=Mle(e);return r[xle]!==void 0||"@@iterator"in r||Nle(Lle,kle(r))},Vle=l(Ule),L5=Wy.clear;Vn({global:!0,bind:!0,forced:j.clearImmediate!==L5},{clearImmediate:L5});var Fle=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",x5=j,jle=te,Ble=Me,Wle=Fle,zle=dr,Gle=Ss,Hle=gl,$le=x5.Function,Kle=/MSIE .\./.test(zle)||Wle&&function(){var e=x5.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),qle=Vn,M5=j,U5=Wy.set,Yle=function(e,r){var i=1;return Kle?function(o,c){var u=Hle(arguments.length,1)>i,h=Ble(o)?o:$le(o),m=u?Gle(arguments,i):[],_=u?function(){jle(h,this,m)}:h;return e(_)}:e},V5=M5.setImmediate?Yle(U5):U5;qle({global:!0,bind:!0,forced:M5.setImmediate!==V5},{setImmediate:V5});var F5=l(Et.setImmediate),Xle=Vn,Jle=ic,Qle=gs,Zle=gl,eue=gp,tue=j.process;Xle({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){Zle(arguments.length,1),Qle(e);var r=eue&&tue.domain;Jle(r?r.bind(e):e)}});var j5=l(Et.queueMicrotask);function B5(e,r){return function(){return e.apply(r,arguments)}}const{toString:nue}=Object.prototype,{getPrototypeOf:CD}=Object,qI=(ID=Object.create(null),e=>{const r=nue.call(e);return ID[r]||(ID[r]=r.slice(8,-1).toLowerCase())});var ID;const ad=e=>(e=e.toLowerCase(),r=>qI(r)===e),YI=e=>r=>typeof r===e,{isArray:pv}=Array,Jb=YI("undefined"),W5=ad("ArrayBuffer"),rue=YI("string"),El=YI("function"),z5=YI("number"),XI=e=>e!==null&&typeof e=="object",JI=e=>{if(qI(e)!=="object")return!1;const r=CD(e);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in e||Vle(e))},iue=ad("Date"),sue=ad("File"),oue=ad("Blob"),aue=ad("FileList"),cue=ad("URLSearchParams"),[lue,uue,due,hue]=["ReadableStream","Request","Response","Headers"].map(ad);function Qb(e,r){let i,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),pv(e))for(i=0,o=e.length;i<o;i++)r.call(null,e[i],i,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(i=0;i<h;i++)m=u[i],r.call(null,e[m],m,e)}}function G5(e,r){r=r.toLowerCase();const i=Object.keys(e);let o,c=i.length;for(;c-- >0;)if(o=i[c],r===o.toLowerCase())return o;return null}const S_=D5!==void 0?D5:typeof self<"u"?self:typeof window<"u"?window:oE,H5=e=>!Jb(e)&&e!==S_,pue=(AD=typeof Uint8Array<"u"&&CD(Uint8Array),e=>AD&&e instanceof AD);var AD;const fue=ad("HTMLFormElement"),$5=(e=>{let{hasOwnProperty:r}=e;return(i,o)=>r.call(i,o)})(Object.prototype),mue=ad("RegExp"),K5=(e,r)=>{const i=Object.getOwnPropertyDescriptors(e),o={};Qb(i,(c,u)=>{let h;(h=r(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},PD="abcdefghijklmnopqrstuvwxyz",q5="0123456789",Y5={DIGIT:q5,ALPHA:PD,ALPHA_DIGIT:PD+PD.toUpperCase()+q5},gue=ad("AsyncFunction"),X5=(J5=typeof F5=="function",Q5=El(S_.postMessage),J5?F5:Q5?(OD="axios@".concat(Math.random()),QI=[],S_.addEventListener("message",e=>{let{source:r,data:i}=e;r===S_&&i===OD&&QI.length&&QI.shift()()},!1),e=>{QI.push(e),S_.postMessage(OD,"*")}):e=>setTimeout(e));var J5,Q5,OD,QI;const _ue=j5!==void 0?j5.bind(S_):typeof process<"u"&&process.nextTick||X5;var ct={isArray:pv,isArrayBuffer:W5,isBuffer:function(e){return e!==null&&!Jb(e)&&e.constructor!==null&&!Jb(e.constructor)&&El(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||El(e.append)&&((r=qI(e))==="formdata"||r==="object"&&El(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&W5(e.buffer),r},isString:rue,isNumber:z5,isBoolean:e=>e===!0||e===!1,isObject:XI,isPlainObject:JI,isReadableStream:lue,isRequest:uue,isResponse:due,isHeaders:hue,isUndefined:Jb,isDate:iue,isFile:sue,isBlob:oue,isRegExp:mue,isFunction:El,isStream:e=>XI(e)&&El(e.pipe),isURLSearchParams:cue,isTypedArray:pue,isFileList:aue,forEach:Qb,merge:function e(){const{caseless:r}=H5(this)&&this||{},i={},o=(c,u)=>{const h=r&&G5(i,u)||u;JI(i[h])&&JI(c)?i[h]=e(i[h],c):JI(c)?i[h]=e({},c):pv(c)?i[h]=c.slice():i[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&Qb(arguments[c],o);return i},extend:function(e,r,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Qb(r,(c,u)=>{i&&El(c)?e[u]=B5(c,i):e[u]=c},{allOwnKeys:o}),e},trim:e=>oo(e)?oo(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,r,i,o)=>{e.prototype=Object.create(r.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,r,i,o)=>{let c,u,h;const m={};if(r=r||{},e==null)return r;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,r)||m[h]||(r[h]=e[h],m[h]=!0);e=i!==!1&&CD(e)}while(e&&(!i||i(e,r))&&e!==Object.prototype);return r},kindOf:qI,kindOfTest:ad,endsWith:(e,r,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=r.length;const o=e.indexOf(r,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(pv(e))return e;let r=e.length;if(!z5(r))return null;const i=new Array(r);for(;r-- >0;)i[r]=e[r];return i},forEachEntry:(e,r)=>{const i=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=i.next())&&!o.done;){const c=o.value;r.call(e,c[0],c[1])}},matchAll:(e,r)=>{let i;const o=[];for(;(i=e.exec(r))!==null;)o.push(i);return o},isHTMLForm:fue,hasOwnProperty:$5,hasOwnProp:$5,reduceDescriptors:K5,freezeMethods:e=>{K5(e,(r,i)=>{if(El(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const o=e[i];El(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,r)=>{const i={},o=c=>{c.forEach(u=>{i[u]=!0})};return pv(e)?o(e):o(String(e).split(r)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,r)=>e!=null&&Number.isFinite(e=+e)?e:r,findKey:G5,global:S_,isContextDefined:H5,ALPHABET:Y5,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Y5.ALPHA_DIGIT,i="";const{length:o}=r;for(;e--;)i+=r[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&El(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const r=new Array(10),i=(o,c)=>{if(XI(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const u=pv(o)?[]:{};return Qb(o,(h,m)=>{const _=i(h,c+1);!Jb(_)&&(u[m]=_)}),r[c]=void 0,u}}return o};return i(e,0)},isAsyncFn:gue,isThenable:e=>e&&(XI(e)||El(e))&&El(e.then)&&El(e.catch),setImmediate:X5,asap:_ue};function tr(e,r,i,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}ct.inherits(tr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ct.toJSONObject(this.config),code:this.code,status:this.status}}});const Z5=tr.prototype,eB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{eB[e]={value:e}}),Object.defineProperties(tr,eB),Object.defineProperty(Z5,"isAxiosError",{value:!0}),tr.from=(e,r,i,o,c,u)=>{const h=Object.create(Z5);return ct.toFlatObject(e,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),tr.call(h,e.message,r,i,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function kD(e){return ct.isPlainObject(e)||ct.isArray(e)}function tB(e){return ct.endsWith(e,"[]")?e.slice(0,-2):e}function nB(e,r,i){return e?e.concat(r).map(function(o,c){return o=tB(o),!i&&c?"["+o+"]":o}).join(i?".":""):r}const Eue=ct.toFlatObject(ct,{},null,function(e){return/^is[A-Z]/.test(e)});function ZI(e,r,i){if(!ct.isObject(e))throw new TypeError("target must be an object");r=r||new FormData;const o=(i=ct.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,k){return!ct.isUndefined(k[P])})).metaTokens,c=i.visitor||y,u=i.dots,h=i.indexes,m=(i.Blob||typeof Blob<"u"&&Blob)&&ct.isSpecCompliantForm(r);if(!ct.isFunction(c))throw new TypeError("visitor must be a function");function _(P){if(P===null)return"";if(ct.isDate(P))return P.toISOString();if(!m&&ct.isBlob(P))throw new tr("Blob is not supported. Use a Buffer instead.");return ct.isArrayBuffer(P)||ct.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function y(P,k,z){let U=P;if(P&&!z&&typeof P=="object"){if(ct.endsWith(k,"{}"))k=o?k:k.slice(0,-2),P=JSON.stringify(P);else if(ct.isArray(P)&&function(F){return ct.isArray(F)&&!F.some(kD)}(P)||(ct.isFileList(P)||ct.endsWith(k,"[]"))&&(U=ct.toArray(P)))return k=tB(k),U.forEach(function(F,q){!ct.isUndefined(F)&&F!==null&&r.append(h===!0?nB([k],q,u):h===null?k:k+"[]",_(F))}),!1}return!!kD(P)||(r.append(nB(z,k,u),_(P)),!1)}const S=[],R=Object.assign(Eue,{defaultVisitor:y,convertValue:_,isVisitable:kD});if(!ct.isObject(e))throw new TypeError("data must be an object");return function P(k,z){if(!ct.isUndefined(k)){if(S.indexOf(k)!==-1)throw Error("Circular reference detected in "+z.join("."));S.push(k),ct.forEach(k,function(U,F){(!(ct.isUndefined(U)||U===null)&&c.call(r,U,ct.isString(F)?oo(F).call(F):F,z,R))===!0&&P(U,z?z.concat(F):[F])}),S.pop()}}(e),r}function rB(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function ND(e,r){this._pairs=[],e&&ZI(e,this,r)}const iB=ND.prototype;function yue(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function sB(e,r,i){if(!r)return e;const o=i&&i.encode||yue;ct.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(r,i):ct.isURLSearchParams(r)?r.toString():new ND(r,i).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}iB.append=function(e,r){this._pairs.push([e,r])},iB.toString=function(e){const r=e?function(i){return e.call(this,i,rB)}:rB;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var oB=class{constructor(){this.handlers=[]}use(e,r,i){return this.handlers.push({fulfilled:e,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ct.forEach(this.handlers,function(r){r!==null&&e(r)})}},aB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},cB={exports:{}},vue=Vn,Sue=nt,lB=et.f;vue({target:"Object",stat:!0,forced:Object.defineProperty!==lB,sham:!Sue},{defineProperty:lB});var uB=Et.Object,bue=cB.exports=function(e,r,i){return uB.defineProperty(e,r,i)};uB.defineProperty.sham&&(bue.sham=!0);var dB=l(cB.exports),Tue=TypeError,hB=Fg,wue=c_,Rue=ot,Cue=fr("species"),pB=Array,Iue=function(e){var r;return hB(e)&&(r=e.constructor,(wue(r)&&(r===pB||hB(r.prototype))||Rue(r)&&(r=r[Cue])===null)&&(r=void 0)),r===void 0?pB:r},fB=function(e,r){return new(Iue(e))(r===0?0:r)},Aue=d,Pue=Zr,Oue=fr("species"),mB=function(e){return Pue>=51||!Aue(function(){var r=[];return(r.constructor={})[Oue]=function(){return{foo:1}},r[e](Boolean).foo!==1})},kue=Vn,Nue=d,Due=Fg,Lue=ot,xue=Lo,Mue=ai,gB=function(e){if(e>9007199254740991)throw Tue("Maximum allowed index exceeded");return e},_B=PI,Uue=fB,Vue=mB,Fue=Zr,EB=fr("isConcatSpreadable"),jue=Fue>=51||!Nue(function(){var e=[];return e[EB]=!1,e.concat()[0]!==e}),Bue=function(e){if(!Lue(e))return!1;var r=e[EB];return r!==void 0?!!r:Due(e)};kue({target:"Array",proto:!0,forced:!jue||!Vue("concat")},{concat:function(e){var r,i,o,c,u,h=xue(this),m=Uue(h,0),_=0;for(r=-1,o=arguments.length;r<o;r++)if(Bue(u=r===-1?h:arguments[r]))for(c=Mue(u),gB(_+c),i=0;i<c;i++,_++)i in u&&_B(m,_,u[i]);else gB(_+1),_B(m,_++,u);return m.length=_,m}});var yB={},Wue=ne,zue=Re,vB=$d.f,Gue=xN,SB=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];yB.f=function(e){return SB&&Wue(e)=="Window"?function(r){try{return vB(r)}catch{return Gue(SB)}}(e):vB(zue(e))};var fv={},Hue=fr;fv.f=Hue;var bB=Et,$ue=gi,Kue=fv,que=et.f,ws=function(e){var r=bB.Symbol||(bB.Symbol={});$ue(r,e)||que(r,e,{value:Kue.f(e)})},Yue=ve,Xue=cn,Jue=fr,Que=Zu,TB=function(){var e=Xue("Symbol"),r=e&&e.prototype,i=r&&r.valueOf,o=Jue("toPrimitive");r&&!r[o]&&Que(r,o,function(c){return Yue(i,this)},{})},Zue=De,ede=un,tde=Lo,nde=ai,rde=fB,wB=A([].push),ide=function(e){var r=e==1,i=e==2,o=e==3,c=e==4,u=e==6,h=e==7,m=e==5||u;return function(_,y,S,R){for(var P,k,z=tde(_),U=ede(z),F=Zue(y,S),q=nde(U),Y=0,le=R||rde,Ee=r?le(_,q):i||h?le(_,0):void 0;q>Y;Y++)if((m||Y in U)&&(k=F(P=U[Y],Y,z),e))if(r)Ee[Y]=k;else if(k)switch(e){case 3:return!0;case 5:return P;case 6:return Y;case 2:wB(Ee,P)}else switch(e){case 4:return!1;case 7:wB(Ee,P)}return u?-1:o||c?c:Ee}},RB={forEach:ide(0)},eA=Vn,DD=j,LD=ve,sde=A,mv=nt,gv=Oi,ode=d,wo=gi,ade=N,xD=ln,tA=Re,MD=Ja,cde=Ta,UD=Qe,Zb=$o,CB=Ic,lde=$d,IB=yB,ude=Cc,AB=He,PB=et,dde=ty,OB=Ne,kB=Zu,hde=Iy,VD=Ya,NB=Rc,DB=Fd,pde=fr,fde=fv,mde=ws,gde=TB,_de=ed,LB=Qu,nA=RB.forEach,Mc=Bg("hidden"),rA="Symbol",eT="prototype",Ede=LB.set,xB=LB.getterFor(rA),cd=Object[eT],b_=DD.Symbol,iA=b_&&b_[eT],yde=DD.TypeError,FD=DD.QObject,MB=AB.f,T_=PB.f,UB=IB.f,vde=OB.f,VB=sde([].push),Fp=VD("symbols"),tT=VD("op-symbols"),Sde=VD("wks"),jD=!FD||!FD[eT]||!FD[eT].findChild,BD=mv&&ode(function(){return Zb(T_({},"a",{get:function(){return T_(this,"a",{value:7}).a}})).a!=7})?function(e,r,i){var o=MB(cd,r);o&&delete cd[r],T_(e,r,i),o&&e!==cd&&T_(cd,r,o)}:T_,WD=function(e,r){var i=Fp[e]=Zb(iA);return Ede(i,{type:rA,tag:e,description:r}),mv||(i.description=r),i},sA=function(e,r,i){e===cd&&sA(tT,r,i),xD(e);var o=MD(r);return xD(i),wo(Fp,o)?(i.enumerable?(wo(e,Mc)&&e[Mc][o]&&(e[Mc][o]=!1),i=Zb(i,{enumerable:UD(0,!1)})):(wo(e,Mc)||T_(e,Mc,UD(1,{})),e[Mc][o]=!0),BD(e,o,i)):T_(e,o,i)},zD=function(e,r){xD(e);var i=tA(r),o=CB(i).concat(WB(i));return nA(o,function(c){mv&&!LD(FB,i,c)||sA(e,c,i[c])}),e},FB=function(e){var r=MD(e),i=LD(vde,this,r);return!(this===cd&&wo(Fp,r)&&!wo(tT,r))&&(!(i||!wo(this,r)||!wo(Fp,r)||wo(this,Mc)&&this[Mc][r])||i)},jB=function(e,r){var i=tA(e),o=MD(r);if(i!==cd||!wo(Fp,o)||wo(tT,o)){var c=MB(i,o);return!c||!wo(Fp,o)||wo(i,Mc)&&i[Mc][o]||(c.enumerable=!0),c}},BB=function(e){var r=UB(tA(e)),i=[];return nA(r,function(o){wo(Fp,o)||wo(NB,o)||VB(i,o)}),i},WB=function(e){var r=e===cd,i=UB(r?tT:tA(e)),o=[];return nA(i,function(c){!wo(Fp,c)||r&&!wo(cd,c)||VB(o,Fp[c])}),o};gv||(b_=function(){if(ade(iA,this))throw yde("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?cde(arguments[0]):void 0,r=DB(e),i=function(o){this===cd&&LD(i,tT,o),wo(this,Mc)&&wo(this[Mc],r)&&(this[Mc][r]=!1),BD(this,r,UD(1,o))};return mv&&jD&&BD(cd,r,{configurable:!0,set:i}),WD(r,e)},kB(iA=b_[eT],"toString",function(){return xB(this).tag}),kB(b_,"withoutSetter",function(e){return WD(DB(e),e)}),OB.f=FB,PB.f=sA,dde.f=zD,AB.f=jB,lde.f=IB.f=BB,ude.f=WB,fde.f=function(e){return WD(pde(e),e)},mv&&hde(iA,"description",{configurable:!0,get:function(){return xB(this).description}})),eA({global:!0,wrap:!0,forced:!gv,sham:!gv},{Symbol:b_}),nA(CB(Sde),function(e){mde(e)}),eA({target:rA,stat:!0,forced:!gv},{useSetter:function(){jD=!0},useSimple:function(){jD=!1}}),eA({target:"Object",stat:!0,forced:!gv,sham:!mv},{create:function(e,r){return r===void 0?Zb(e):zD(Zb(e),r)},defineProperty:sA,defineProperties:zD,getOwnPropertyDescriptor:jB}),eA({target:"Object",stat:!0,forced:!gv},{getOwnPropertyNames:BB}),gde(),_de(b_,rA),NB[Mc]=!0;var zB=Oi&&!!Symbol.for&&!!Symbol.keyFor,bde=Vn,Tde=cn,wde=gi,Rde=Ta,GB=Ya,Cde=zB,GD=GB("string-to-symbol-registry"),Ide=GB("symbol-to-string-registry");bde({target:"Symbol",stat:!0,forced:!Cde},{for:function(e){var r=Rde(e);if(wde(GD,r))return GD[r];var i=Tde("Symbol")(r);return GD[r]=i,Ide[i]=r,i}});var Ade=Vn,Pde=gi,Ode=ga,kde=ms,Nde=zB,HB=Ya("symbol-to-string-registry");Ade({target:"Symbol",stat:!0,forced:!Nde},{keyFor:function(e){if(!Ode(e))throw TypeError(kde(e)+" is not a symbol");if(Pde(HB,e))return HB[e]}});var $B=Fg,Dde=Me,KB=ne,Lde=Ta,qB=A([].push),xde=Vn,YB=cn,XB=te,Mde=ve,nT=A,JB=d,QB=Me,ZB=ga,e6=Ss,Ude=function(e){if(Dde(e))return e;if($B(e)){for(var r=e.length,i=[],o=0;o<r;o++){var c=e[o];typeof c=="string"?qB(i,c):typeof c!="number"&&KB(c)!="Number"&&KB(c)!="String"||qB(i,Lde(c))}var u=i.length,h=!0;return function(m,_){if(h)return h=!1,_;if($B(this))return _;for(var y=0;y<u;y++)if(i[y]===m)return _}}},Vde=Oi,Fde=String,Rm=YB("JSON","stringify"),oA=nT(/./.exec),t6=nT("".charAt),jde=nT("".charCodeAt),Bde=nT("".replace),Wde=nT(1 .toString),zde=/[\uD800-\uDFFF]/g,n6=/^[\uD800-\uDBFF]$/,r6=/^[\uDC00-\uDFFF]$/,i6=!Vde||JB(function(){var e=YB("Symbol")();return Rm([e])!="[null]"||Rm({a:e})!="{}"||Rm(Object(e))!="{}"}),s6=JB(function(){return Rm("\uDF06\uD834")!=='"\\udf06\\ud834"'||Rm("\uDEAD")!=='"\\udead"'}),Gde=function(e,r){var i=e6(arguments),o=Ude(r);if(QB(o)||e!==void 0&&!ZB(e))return i[1]=function(c,u){if(QB(o)&&(u=Mde(o,this,Fde(c),u)),!ZB(u))return u},XB(Rm,null,i)},Hde=function(e,r,i){var o=t6(i,r-1),c=t6(i,r+1);return oA(n6,e)&&!oA(r6,c)||oA(r6,e)&&!oA(n6,o)?"\\u"+Wde(jde(e,0),16):e};Rm&&xde({target:"JSON",stat:!0,forced:i6||s6},{stringify:function(e,r,i){var o=e6(arguments),c=XB(i6?Gde:Rm,null,o);return s6&&typeof c=="string"?Bde(c,zde,Hde):c}});var o6=Cc,$de=Lo;Vn({target:"Object",stat:!0,forced:!Oi||d(function(){o6.f(1)})},{getOwnPropertySymbols:function(e){var r=o6.f;return r?r($de(e)):[]}}),ws("asyncIterator"),ws("hasInstance"),ws("isConcatSpreadable"),ws("iterator"),ws("match"),ws("matchAll"),ws("replace"),ws("search"),ws("species"),ws("split");var Kde=TB;ws("toPrimitive"),Kde();var qde=cn,Yde=ed;ws("toStringTag"),Yde(qde("Symbol"),"Symbol"),ws("unscopables"),ed(j.JSON,"JSON",!0);var Xde=Et.Symbol,Jde=fr,Qde=et.f,a6=Jde("metadata"),c6=Function.prototype;c6[a6]===void 0&&Qde(c6,a6,{value:null}),ws("dispose"),ws("metadata");var Zde=Xde;ws("asyncDispose");var ehe=A,HD=cn("Symbol"),the=HD.keyFor,nhe=ehe(HD.prototype.valueOf),l6=HD.isRegisteredSymbol||function(e){try{return the(nhe(e))!==void 0}catch{return!1}};Vn({target:"Symbol",stat:!0},{isRegisteredSymbol:l6});for(var rhe=Ya,u6=cn,ihe=A,she=ga,ohe=fr,aA=u6("Symbol"),d6=aA.isWellKnownSymbol,h6=u6("Object","getOwnPropertyNames"),ahe=ihe(aA.prototype.valueOf),p6=rhe("wks"),$D=0,f6=h6(aA),che=f6.length;$D<che;$D++)try{var m6=f6[$D];she(aA[m6])&&ohe(m6)}catch{}var g6=function(e){if(d6&&d6(e))return!0;try{for(var r=ahe(e),i=0,o=h6(p6),c=o.length;i<c;i++)if(p6[o[i]]==r)return!0}catch{}return!1};Vn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:g6}),ws("matcher"),ws("observable"),Vn({target:"Symbol",stat:!0},{isRegistered:l6}),Vn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:g6}),ws("metadataKey"),ws("patternMatch"),ws("replaceAll");var _v=l(Zde),_6=l(fv.f("iterator"));function rT(e){return rT=typeof _v=="function"&&typeof _6=="symbol"?function(r){return typeof r}:function(r){return r&&typeof _v=="function"&&r.constructor===_v&&r!==_v.prototype?"symbol":typeof r},rT(e)}var lhe=l(fv.f("toPrimitive"));function uhe(e){var r=function(i,o){if(rT(i)!=="object"||i===null)return i;var c=i[lhe];if(c!==void 0){var u=c.call(i,o);if(rT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return rT(r)==="symbol"?r:String(r)}function K(e,r,i){return(r=uhe(r))in e?dB(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}var E6=l(Gae),dhe={isBrowser:!0,classes:{URLSearchParams:E6!==void 0?E6:ND,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const KD=typeof window<"u"&&typeof document<"u",qD=typeof navigator=="object"&&navigator||void 0,hhe=KD&&(!qD||["ReactNative","NativeScript","NS"].indexOf(qD.product)<0),phe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",fhe=KD&&window.location.href||"http://localhost";function y6(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function v6(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?y6(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var ka=v6(v6({},Object.freeze({__proto__:null,hasBrowserEnv:KD,hasStandardBrowserEnv:hhe,hasStandardBrowserWebWorkerEnv:phe,navigator:qD,origin:fhe})),dhe),mhe=ln,ghe=ve,_he=gi,Ehe=N,yhe=function(){var e=mhe(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},S6=RegExp.prototype,b6=function(e){var r=e.flags;return r!==void 0||"flags"in S6||_he(e,"flags")||!Ehe(S6,e)?r:ghe(yhe,e)},vhe=ON.charAt,T6=ve,She=ln,bhe=Me,The=ne,whe=/./.exec,Rhe=TypeError,Che=Vn,w6=ve,R6=se,Ihe=yy,cA=wy,C6=$t,I6=Mt,iT=Ta,Ahe=ln,Phe=xt,Ohe=ne,khe=lC,A6=b6,Nhe=Ec,Dhe=d,Lhe=Ji,xhe=function(e,r,i){return r+(i?vhe(e,r).length:1)},Mhe=function(e,r){var i=e.exec;if(bhe(i)){var o=T6(i,e,r);return o!==null&&She(o),o}if(The(e)==="RegExp")return T6(whe,e,r);throw Rhe("RegExp#exec called on incompatible receiver")},P6=Qu,Uhe=fr("matchAll"),O6="RegExp String",k6=O6+" Iterator",Vhe=P6.set,Fhe=P6.getterFor(k6),jhe=TypeError,YD=R6("".indexOf),lA=R6("".matchAll),XD=!!lA&&!Dhe(function(){lA("a",/./)}),Bhe=Ihe(function(e,r,i,o){Vhe(this,{type:k6,regexp:e,string:r,global:i,unicode:o,done:!1})},O6,function(){var e=Fhe(this);if(e.done)return cA(void 0,!0);var r=e.regexp,i=e.string,o=Mhe(r,i);return o===null?(e.done=!0,cA(void 0,!0)):e.global?(iT(o[0])===""&&(r.lastIndex=xhe(i,I6(r.lastIndex),e.unicode)),cA(o,!1)):(e.done=!0,cA(o,!1))}),N6=function(e){var r,i,o,c=Ahe(this),u=iT(e),h=Lhe(c,RegExp),m=iT(A6(c));return r=new h(h===RegExp?c.source:c,m),i=!!~YD(m,"g"),o=!!~YD(m,"u"),r.lastIndex=I6(c.lastIndex),new Bhe(r,u,i,o)};Che({target:"String",proto:!0,forced:XD},{matchAll:function(e){var r,i,o,c,u=C6(this);if(Phe(e)){if(XD)return lA(u,e)}else{if(khe(e)&&(r=iT(C6(A6(e))),!~YD(r,"g")))throw jhe("`.matchAll` does not allow non-global regexes");if(XD)return lA(u,e);if((o=Nhe(e,Uhe))===void 0&&Ohe(e)=="RegExp"&&(o=N6),o)return w6(o,e,u)}return i=iT(u),c=new RegExp(e,"g"),w6(N6,c,i)}});var Whe=Za("String").matchAll,zhe=N,Ghe=Whe,JD=String.prototype,Hhe=function(e){var r=e.matchAll;return typeof e=="string"||e===JD||zhe(JD,e)&&r===JD.matchAll?Ghe:r},$he=l(Hhe);function D6(e){function r(i,o,c,u){let h=i[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),_=u>=i.length;return h=!h&&ct.isArray(c)?c.length:h,_?(ct.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&ct.isObject(c[h])||(c[h]=[]),r(i,o,c[h],u)&&ct.isArray(c[h])&&(c[h]=function(y){const S={},R=Object.keys(y);let P;const k=R.length;let z;for(P=0;P<k;P++)z=R[P],S[z]=y[z];return S}(c[h])),!m)}if(ct.isFormData(e)&&ct.isFunction(e.entries)){const i={};return ct.forEachEntry(e,(o,c)=>{r(function(u){return $he(ct).call(ct,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,i,0)}),i}return null}const QD={transitional:aB,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const i=r.getContentType()||"",o=i.indexOf("application/json")>-1,c=ct.isObject(e);if(c&&ct.isHTMLForm(e)&&(e=new FormData(e)),ct.isFormData(e))return o?JSON.stringify(D6(e)):e;if(ct.isArrayBuffer(e)||ct.isBuffer(e)||ct.isStream(e)||ct.isFile(e)||ct.isBlob(e)||ct.isReadableStream(e))return e;if(ct.isArrayBufferView(e))return e.buffer;if(ct.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return ZI(h,new ka.classes.URLSearchParams,Object.assign({visitor:function(_,y,S,R){return ka.isNode&&ct.isBuffer(_)?(this.append(y,_.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((u=ct.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return ZI(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,_){if(ct.isString(h))try{return(m||JSON.parse)(h),oo(ct).call(ct,h)}catch(y){if(y.name!=="SyntaxError")throw y}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const r=this.transitional||QD.transitional,i=r&&r.forcedJSONParsing,o=this.responseType==="json";if(ct.isResponse(e)||ct.isReadableStream(e))return e;if(e&&ct.isString(e)&&(i&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?tr.from(u,tr.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ka.classes.FormData,Blob:ka.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ct.forEach(["delete","get","head","post","put","patch"],e=>{QD.headers[e]={}});var ZD=QD;const Khe=ct.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),L6=Symbol("internals");function sT(e){var r;return e&&oo(r=String(e)).call(r).toLowerCase()}function uA(e){return e===!1||e==null?e:ct.isArray(e)?e.map(uA):String(e)}function eL(e,r,i,o,c){return ct.isFunction(o)?o.call(this,r,i):(c&&(r=i),ct.isString(r)?ct.isString(o)?r.indexOf(o)!==-1:ct.isRegExp(o)?o.test(r):void 0:void 0)}class dA{constructor(r){r&&this.set(r)}set(r,i,o){const c=this;function u(_,y,S){const R=sT(y);if(!R)throw new Error("header name must be a non-empty string");const P=ct.findKey(c,R);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||y]=uA(_))}const h=(_,y)=>ct.forEach(_,(S,R)=>u(S,R,y));if(ct.isPlainObject(r)||r instanceof this.constructor)h(r,i);else if(ct.isString(r)&&(r=oo(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(oo(m=r).call(m)))h((_=>{const y={};let S,R,P;return _&&_.split(`
`).forEach(function(k){var z,U;P=k.indexOf(":"),S=oo(z=k.substring(0,P)).call(z).toLowerCase(),R=oo(U=k.substring(P+1)).call(U),!S||y[S]&&Khe[S]||(S==="set-cookie"?y[S]?y[S].push(R):y[S]=[R]:y[S]=y[S]?y[S]+", "+R:R)}),y})(r),i);else if(ct.isHeaders(r))for(const[_,y]of r.entries())u(y,_,o);else r!=null&&u(i,r,o);var m;return this}get(r,i){if(r=sT(r)){const o=ct.findKey(this,r);if(o){const c=this[o];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(u);)h[_[1]]=_[2];return h}(c);if(ct.isFunction(i))return i.call(this,c,o);if(ct.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,i){if(r=sT(r)){const o=ct.findKey(this,r);return!(!o||this[o]===void 0||i&&!eL(0,this[o],o,i))}return!1}delete(r,i){const o=this;let c=!1;function u(h){if(h=sT(h)){const m=ct.findKey(o,h);!m||i&&!eL(0,o[m],m,i)||(delete o[m],c=!0)}}return ct.isArray(r)?r.forEach(u):u(r),c}clear(r){const i=Object.keys(this);let o=i.length,c=!1;for(;o--;){const u=i[o];r&&!eL(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const i=this,o={};return ct.forEach(this,(c,u)=>{var h;const m=ct.findKey(o,u);if(m)return i[m]=uA(c),void delete i[u];const _=r?function(y){return oo(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,P)=>R.toUpperCase()+P)}(u):oo(h=String(u)).call(h);_!==u&&delete i[u],i[_]=uA(c),o[_]=!0}),this}concat(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(r){const i=Object.create(null);return ct.forEach(this,(o,c)=>{o!=null&&o!==!1&&(i[c]=r&&ct.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[i,o]=r;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const i=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(r){const i=(this[L6]=this[L6]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=sT(u);i[h]||(function(m,_){const y=ct.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+y,{value:function(R,P,k){return this[S].call(this,_,R,P,k)},configurable:!0})})}(o,u),i[h]=!0)}return ct.isArray(r)?r.forEach(c):c(r),this}}dA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ct.reduceDescriptors(dA.prototype,(e,r)=>{let{value:i}=e,o=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(c){this[o]=c}}}),ct.freezeMethods(dA);var ld=dA;function tL(e,r){const i=this||ZD,o=r||i,c=ld.from(o.headers);let u=o.data;return ct.forEach(e,function(h){u=h.call(i,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function x6(e){return!(!e||!e.__CANCEL__)}function Ev(e,r,i){tr.call(this,e??"canceled",tr.ERR_CANCELED,r,i),this.name="CanceledError"}function M6(e,r,i){const o=i.config.validateStatus;i.status&&o&&!o(i.status)?r(new tr("Request failed with status code "+i.status,[tr.ERR_BAD_REQUEST,tr.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}ct.inherits(Ev,tr,{__CANCEL__:!0});const hA=function(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),_=new Array(u);let y,S=0,R=0;return h=h!==void 0?h:1e3,function(P){const k=Date.now(),z=_[R];y||(y=k),m[S]=P,_[S]=k;let U=R,F=0;for(;U!==S;)F+=m[U++],U%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),k-y<h)return;const q=z&&k-z;return q?Math.round(1e3*F/q):void 0}}(50,250);return function(u,h){let m,_,y=0,S=1e3/h;const R=function(P){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),u.apply(null,P)};return[function(){const P=Date.now(),k=P-y;for(var z=arguments.length,U=new Array(z),F=0;F<z;F++)U[F]=arguments[F];k>=S?R(U,P):(m=U,_||(_=setTimeout(()=>{_=null,R(m)},S-k)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,_=h-o,y=c(_);o=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:_,rate:y||void 0,estimated:y&&m&&h<=m?(m-h)/y:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},i)},U6=(e,r)=>{const i=e!=null;return[o=>r[0]({lengthComputable:i,total:e,loaded:o}),r[1]]},V6=e=>function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return ct.asap(()=>e(...i))};var qhe=ka.hasStandardBrowserEnv?((e,r)=>i=>(i=new BI(i,ka.origin),e.protocol===i.protocol&&e.host===i.host&&(r||e.port===i.port)))(new BI(ka.origin),ka.navigator&&/(msie|trident)/i.test(ka.navigator.userAgent)):()=>!0,Yhe=ka.hasStandardBrowserEnv?{write(e,r,i,o,c,u){const h=[e+"="+encodeURIComponent(r)];ct.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),ct.isString(o)&&h.push("path="+o),ct.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function F6(e,r){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(r)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,r):r}function j6(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const B6=e=>e instanceof ld?function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?j6(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):j6(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e):e;function w_(e,r){r=r||{};const i={};function o(y,S,R,P){return ct.isPlainObject(y)&&ct.isPlainObject(S)?ct.merge.call({caseless:P},y,S):ct.isPlainObject(S)?ct.merge({},S):ct.isArray(S)?S.slice():S}function c(y,S,R,P){return ct.isUndefined(S)?ct.isUndefined(y)?void 0:o(void 0,y,0,P):o(y,S,0,P)}function u(y,S){if(!ct.isUndefined(S))return o(void 0,S)}function h(y,S){return ct.isUndefined(S)?ct.isUndefined(y)?void 0:o(void 0,y):o(void 0,S)}function m(y,S,R){return R in r?o(y,S):R in e?o(void 0,y):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(y,S,R)=>c(B6(y),B6(S),0,!0)};return ct.forEach(Object.keys(Object.assign({},e,r)),function(y){const S=_[y]||c,R=S(e[y],r[y],y);ct.isUndefined(R)&&S!==m||(i[y]=R)}),i}var W6=e=>{const r=w_({},e);let i,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:_}=r;if(r.headers=m=ld.from(m),r.url=sB(F6(r.baseURL,r.url),e.params,e.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),ct.isFormData(o)){if(ka.hasStandardBrowserEnv||ka.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((i=m.getContentType())!==!1){const[y,...S]=i?i.split(";").map(R=>oo(R).call(R)).filter(Boolean):[];m.setContentType([y||"multipart/form-data",...S].join("; "))}}if(ka.hasStandardBrowserEnv&&(c&&ct.isFunction(c)&&(c=c(r)),c||c!==!1&&qhe(r.url))){const y=u&&h&&Yhe.read(h);y&&m.set(u,y)}return r},Xhe=typeof XMLHttpRequest<"u"&&function(e){return new lt(function(r,i){const o=W6(e);let c=o.data;const u=ld.from(o.headers).normalize();let h,m,_,y,S,{responseType:R,onUploadProgress:P,onDownloadProgress:k}=o;function z(){y&&y(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let U=new XMLHttpRequest;function F(){if(!U)return;const Y=ld.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders());M6(function(le){r(le),z()},function(le){i(le),z()},{data:R&&R!=="text"&&R!=="json"?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:Y,config:e,request:U}),U=null}U.open(o.method.toUpperCase(),o.url,!0),U.timeout=o.timeout,"onloadend"in U?U.onloadend=F:U.onreadystatechange=function(){U&&U.readyState===4&&(U.status!==0||U.responseURL&&U.responseURL.indexOf("file:")===0)&&setTimeout(F)},U.onabort=function(){U&&(i(new tr("Request aborted",tr.ECONNABORTED,e,U)),U=null)},U.onerror=function(){i(new tr("Network Error",tr.ERR_NETWORK,e,U)),U=null},U.ontimeout=function(){let Y=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const le=o.transitional||aB;o.timeoutErrorMessage&&(Y=o.timeoutErrorMessage),i(new tr(Y,le.clarifyTimeoutError?tr.ETIMEDOUT:tr.ECONNABORTED,e,U)),U=null},c===void 0&&u.setContentType(null),"setRequestHeader"in U&&ct.forEach(u.toJSON(),function(Y,le){U.setRequestHeader(le,Y)}),ct.isUndefined(o.withCredentials)||(U.withCredentials=!!o.withCredentials),R&&R!=="json"&&(U.responseType=o.responseType),k&&([_,S]=hA(k,!0),U.addEventListener("progress",_)),P&&U.upload&&([m,y]=hA(P),U.upload.addEventListener("progress",m),U.upload.addEventListener("loadend",y)),(o.cancelToken||o.signal)&&(h=Y=>{U&&(i(!Y||Y.type?new Ev(null,e,U):Y),U.abort(),U=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const q=function(Y){const le=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return le&&le[1]||""}(o.url);q&&ka.protocols.indexOf(q)===-1?i(new tr("Unsupported protocol "+q+":",tr.ERR_BAD_REQUEST,e)):U.send(c||null)})},Jhe=(e,r)=>{const{length:i}=e=e?e.filter(Boolean):[];if(r||i){let o,c=new AbortController;const u=function(y){if(!o){o=!0,m();const S=y instanceof Error?y:this.reason;c.abort(S instanceof tr?S:new Ev(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new tr("timeout ".concat(r," of ms exceeded"),tr.ETIMEDOUT))},r);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(y=>{y.unsubscribe?y.unsubscribe(u):y.removeEventListener("abort",u)}),e=null)};e.forEach(y=>y.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>ct.asap(m),_}},Qhe=L4,Zhe=_l;Vn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=Zhe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var epe=_l,tpe=rh;Vn({target:"Promise",stat:!0,forced:!0},{try:function(e){var r=epe.f(this),i=tpe(e);return(i.error?r.reject:r.resolve)(i.value),r.promise}});var nL=l(Qhe),z6=fv.f("asyncIterator"),npe=l(z6);function rL(e,r){this.v=e,this.k=r}function oT(e){var r,i;function o(u,h){try{var m=e[u](h),_=m.value,y=_ instanceof rL;nL.resolve(y?_.v:_).then(function(S){if(y){var R=u==="return"?"return":"next";if(!_.k||S.done)return o(R,S);S=e[R](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):i=null}this._invoke=function(u,h){return new nL(function(m,_){var y={key:u,arg:h,resolve:m,reject:_,next:null};i?i=i.next=y:(r=i=y,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function yl(e){return function(){return new oT(e.apply(this,arguments))}}function Rn(e){return new rL(e,0)}function pA(e){var r={},i=!1;function o(c,u){return i=!0,{done:!1,value:new rL(u=new nL(function(h){h(e[c](u))}),1)}}return r[_v!==void 0&&_6||"@@iterator"]=function(){return this},r.next=function(c){return i?(i=!1,c):o("next",c)},typeof e.throw=="function"&&(r.throw=function(c){if(i)throw i=!1,c;return o("throw",c)}),typeof e.return=="function"&&(r.return=function(c){return i?(i=!1,c):o("return",c)}),r}oT.prototype[typeof _v=="function"&&npe||"@@asyncIterator"]=function(){return this},oT.prototype.next=function(e){return this._invoke("next",e)},oT.prototype.throw=function(e){return this._invoke("throw",e)},oT.prototype.return=function(e){return this._invoke("return",e)};var iL=l(z6);function sL(e){var r,i,o,c=2;for(typeof Symbol<"u"&&(i=iL,o=Symbol.iterator);c--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new fA(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function fA(e){function r(i){if(Object(i)!==i)return lt.reject(new TypeError(i+" is not an object."));var o=i.done;return lt.resolve(i.value).then(function(c){return{value:c,done:o}})}return fA=function(i){this.s=i,this.n=i.next},fA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?lt.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?lt.reject(i):r(o.apply(this.s,arguments))}},new fA(e)}const rpe=function*(e,r){let i=e.byteLength;if(!r||i<r)return void(yield e);let o,c=0;for(;c<i;)o=c+r,yield e.slice(c,o),c=o},ipe=function(){var e=yl(function*(r,i){var o,c=!1,u=!1;try{for(var h,m=sL(spe(r));c=!(h=yield Rn(m.next())).done;c=!1){const _=h.value;yield*pA(sL(rpe(_,i)))}}catch(_){u=!0,o=_}finally{try{c&&m.return!=null&&(yield Rn(m.return()))}finally{if(u)throw o}}});return function(r,i){return e.apply(this,arguments)}}(),spe=function(){var e=yl(function*(r){if(r[iL])return void(yield*pA(sL(r)));const i=r.getReader();try{for(;;){const{done:o,value:c}=yield Rn(i.read());if(o)break;yield c}}finally{yield Rn(i.cancel())}});return function(r){return e.apply(this,arguments)}}(),G6=(e,r,i,o)=>{const c=ipe(e,r);let u,h=0,m=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:y,value:S}=await c.next();if(y)return m(),void _.close();let R=S.byteLength;if(i){let P=h+=R;i(P)}_.enqueue(new Uint8Array(S))}catch(y){throw m(y),y}},cancel:_=>(m(_),c.return())},{highWaterMark:2})};function H6(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function $6(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?H6(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):H6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const mA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",K6=mA&&typeof ReadableStream=="function",ope=mA&&(typeof TextEncoder=="function"?(q6=new TextEncoder,e=>q6.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var q6;const Y6=function(e){try{for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return!!e(...i)}catch{return!1}},ape=K6&&Y6(()=>{let e=!1;const r=new Request(ka.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!r}),oL=K6&&Y6(()=>ct.isReadableStream(new Response("").body)),gA={stream:oL&&(e=>e.body)};var X6;mA&&(X6=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!gA[e]&&(gA[e]=ct.isFunction(X6[e])?r=>r[e]():(r,i)=>{throw new tr("Response type '".concat(e,"' is not supported"),tr.ERR_NOT_SUPPORT,i)})}));const cpe=async(e,r)=>{const i=ct.toFiniteNumber(e.getContentLength());return i??(async o=>o==null?0:ct.isBlob(o)?o.size:ct.isSpecCompliantForm(o)?(await new Request(ka.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:ct.isArrayBufferView(o)||ct.isArrayBuffer(o)?o.byteLength:(ct.isURLSearchParams(o)&&(o+=""),ct.isString(o)?(await ope(o)).byteLength:void 0))(r)};var lpe=mA&&(async e=>{let{url:r,method:i,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:_,responseType:y,headers:S,withCredentials:R="same-origin",fetchOptions:P}=W6(e);y=y?(y+"").toLowerCase():"text";let k,z=Jhe([c,u&&u.toAbortSignal()],h);const U=z&&z.unsubscribe&&(()=>{z.unsubscribe()});let F;try{if(_&&ape&&i!=="get"&&i!=="head"&&(F=await cpe(S,o))!==0){let ye,ge=new Request(r,{method:"POST",body:o,duplex:"half"});if(ct.isFormData(o)&&(ye=ge.headers.get("content-type"))&&S.setContentType(ye),ge.body){const[ke,qe]=U6(F,hA(V6(_)));o=G6(ge.body,65536,ke,qe)}}ct.isString(R)||(R=R?"include":"omit");const q="credentials"in Request.prototype;k=new Request(r,$6($6({},P),{},{signal:z,method:i.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:q?R:void 0}));let Y=await fetch(k);const le=oL&&(y==="stream"||y==="response");if(oL&&(m||le&&U)){const ye={};["status","statusText","headers"].forEach(ut=>{ye[ut]=Y[ut]});const ge=ct.toFiniteNumber(Y.headers.get("content-length")),[ke,qe]=m&&U6(ge,hA(V6(m),!0))||[];Y=new Response(G6(Y.body,65536,ke,()=>{qe&&qe(),U&&U()}),ye)}y=y||"text";let Ee=await gA[ct.findKey(gA,y)||"text"](Y,e);return!le&&U&&U(),await new lt((ye,ge)=>{M6(ye,ge,{data:Ee,headers:ld.from(Y.headers),status:Y.status,statusText:Y.statusText,config:e,request:k})})}catch(q){throw U&&U(),q&&q.name==="TypeError"&&/fetch/i.test(q.message)?Object.assign(new tr("Network Error",tr.ERR_NETWORK,e,k),{cause:q.cause||q}):tr.from(q,q&&q.code,e,k)}});const aL={http:null,xhr:Xhe,fetch:lpe};ct.forEach(aL,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const J6=e=>"- ".concat(e),upe=e=>ct.isFunction(e)||e===null||e===!1;var Q6={getAdapter:e=>{e=ct.isArray(e)?e:[e];const{length:r}=e;let i,o;const c={};for(let u=0;u<r;u++){let h;if(i=e[u],o=i,!upe(i)&&(o=aL[(h=String(i)).toLowerCase()],o===void 0))throw new tr("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,_]=h;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new tr("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(J6).join(`
`):" "+J6(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:aL};function cL(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ev(null,e)}function Z6(e){return cL(e),e.headers=ld.from(e.headers),e.data=tL.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Q6.getAdapter(e.adapter||ZD.adapter)(e).then(function(r){return cL(e),r.data=tL.call(e,e.transformResponse,r),r.headers=ld.from(r.headers),r},function(r){return x6(r)||(cL(e),r&&r.response&&(r.response.data=tL.call(e,e.transformResponse,r.response),r.response.headers=ld.from(r.response.headers))),lt.reject(r)})}const e8="1.7.9",_A={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{_A[e]=function(i){return typeof i===e||"a"+(r<1?"n ":" ")+e}});const t8={};_A.transitional=function(e,r,i){function o(c,u){return"[Axios v"+e8+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(e===!1)throw new tr(o(u," has been removed"+(r?" in "+r:"")),tr.ERR_DEPRECATED);return r&&!t8[u]&&(t8[u]=!0,console.warn(o(u," has been deprecated since v"+r+" and will be removed in the near future"))),!e||e(c,u,h)}},_A.spelling=function(e){return(r,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var EA={assertOptions:function(e,r,i){if(typeof e!="object")throw new tr("options must be an object",tr.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=r[u];if(h){const m=e[u],_=m===void 0||h(m,u,e);if(_!==!0)throw new tr("option "+u+" must be "+_,tr.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new tr("Unknown option "+u,tr.ERR_BAD_OPTION)}},validators:_A};const lh=EA.validators;let yA=class{constructor(e){this.defaults=e,this.interceptors={request:new oB,response:new oB}}async request(e,r){try{return await this._request(e,r)}catch(i){if(i instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(e,r){typeof e=="string"?(r=r||{}).url=e:r=e||{},r=w_(this.defaults,r);const{transitional:i,paramsSerializer:o,headers:c}=r;i!==void 0&&EA.assertOptions(i,{silentJSONParsing:lh.transitional(lh.boolean),forcedJSONParsing:lh.transitional(lh.boolean),clarifyTimeoutError:lh.transitional(lh.boolean)},!1),o!=null&&(ct.isFunction(o)?r.paramsSerializer={serialize:o}:EA.assertOptions(o,{encode:lh.function,serialize:lh.function},!0)),EA.assertOptions(r,{baseUrl:lh.spelling("baseURL"),withXsrfToken:lh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&ct.merge(c.common,c[r.method]);c&&ct.forEach(["delete","get","head","post","put","patch","common"],k=>{delete c[k]}),r.headers=ld.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(r)===!1||(m=m&&k.synchronous,h.unshift(k.fulfilled,k.rejected))});const _=[];let y;this.interceptors.response.forEach(function(k){_.push(k.fulfilled,k.rejected)});let S,R=0;if(!m){const k=[Z6.bind(this),void 0];for(k.unshift.apply(k,h),k.push.apply(k,_),S=k.length,y=lt.resolve(r);R<S;)y=y.then(k[R++],k[R++]);return y}S=h.length;let P=r;for(R=0;R<S;){const k=h[R++],z=h[R++];try{P=k(P)}catch(U){z.call(this,U);break}}try{y=Z6.call(this,P)}catch(k){return lt.reject(k)}for(R=0,S=_.length;R<S;)y=y.then(_[R++],_[R++]);return y}getUri(e){return sB(F6((e=w_(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};ct.forEach(["delete","get","head","options"],function(e){yA.prototype[e]=function(r,i){return this.request(w_(i||{},{method:e,url:r,data:(i||{}).data}))}}),ct.forEach(["post","put","patch"],function(e){function r(i){return function(o,c,u){return this.request(w_(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}yA.prototype[e]=r(),yA.prototype[e+"Form"]=r(!0)});var vA=yA;class lL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new lt(function(c){i=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new lt(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},r(function(c,u,h){o.reason||(o.reason=new Ev(c,u,h),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const r=new AbortController,i=o=>{r.abort(o)};return this.subscribe(i),r.signal.unsubscribe=()=>this.unsubscribe(i),r.signal}static source(){let r;return{token:new lL(function(o){r=o}),cancel:r}}}var dpe=lL;const uL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(uL).forEach(e=>{let[r,i]=e;uL[i]=r});var hpe=uL;const Ys=function e(r){const i=new vA(r),o=B5(vA.prototype.request,i);return ct.extend(o,vA.prototype,i,{allOwnKeys:!0}),ct.extend(o,i,null,{allOwnKeys:!0}),o.create=function(c){return e(w_(r,c))},o}(ZD);Ys.Axios=vA,Ys.CanceledError=Ev,Ys.CancelToken=dpe,Ys.isCancel=x6,Ys.VERSION=e8,Ys.toFormData=ZI,Ys.AxiosError=tr,Ys.Cancel=Ys.CanceledError,Ys.all=function(e){return lt.all(e)},Ys.spread=function(e){return function(r){return e.apply(null,r)}},Ys.isAxiosError=function(e){return ct.isObject(e)&&e.isAxiosError===!0},Ys.mergeConfig=w_,Ys.AxiosHeaders=ld,Ys.formToJSON=e=>D6(ct.isHTMLForm(e)?new FormData(e):e),Ys.getAdapter=Q6.getAdapter,Ys.HttpStatusCode=hpe,Ys.default=Ys;var Jo=Ys;const ppe=()=>{};function aT(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:ppe};return e.promise=new lt((r,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,r(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}const SA=new Map,bA=new Map,uh=new Map;let ji=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Fn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const n8=new Ole;let ud=n8.getResult(),dL=null;function Cn(e){if(!dL){ud=n8.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Fn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Fn.CHROME;case"Safari":case"Mobile Safari":return Fn.SAFARI;case"Edge":return Fn.EDGE;case"Firefox":return Fn.FIREFOX;case"QQ":case"QQBrowser":return Fn.QQ;case"Opera":return Fn.OPERA;case"WeChat":return Fn.WECHAT;default:return m.browser.name||""}}(ud),i=r8(ud),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(ud),c=ud.os.version,u=r8(ud,!1),h=ud.device.type;if(!(r&&i&&o&&c))return{name:r,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h};dL={name:r,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h}}return dL}function r8(e){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?r.split(".")[0]:r}function TA(){return Cn().os}function i8(){const e=Cn();return"".concat(e.os," ").concat(e.osVersion)}function wA(){const e=Cn();return!!(ud.engine.name==="WebKit"&&e.os===ji.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Fn.SAFARI||Ro()&&e.name!==Fn.SAFARI)}function jp(){return Cn().name===Fn.CHROME}function Rs(){return Cn().name===Fn.SAFARI}function s8(){return Cn().name===Fn.EDGE}function Mr(){return Cn().name===Fn.FIREFOX}function Ro(){return Cn().os===ji.IOS}function cT(e){const r=Cn();return!(r.name!==Fn.CHROME||!r.osVersion)&&Number(r.version)>=e}function o8(e){const r=Cn();return!(r.name!==Fn.CHROME||!r.osVersion)&&Number(r.version)<e}function hL(e,r,i){const o=Cn();return!(o.name!==e||!o.osVersion)&&(i?Number(o.version)>=r&&Number(o.version)<=i:Number(o.version)===r)}function pL(e){const r=Cn();return!(r.name!==Fn.EDGE||!r.osVersion)&&Number(r.version)>=e}function a8(e){const r=Cn();return!(r.name!==Fn.SAFARI||!r.osVersion)&&Number(r.version)>=e}function c8(e,r,i){const o=Cn();if(o.os!==ji.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e}function l8(e,r,i){const o=Cn();if(o.name!==Fn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return i?r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e:r?Number(c[0])===e&&Number(c[1])<=r||Number(c[0])<e:Number(c[0])<=e}function fL(e){const r=Cn();return!(r.name!==Fn.OPERA||!r.osVersion)&&Number(r.version)>=e}function u8(){const e=Cn();if(e.os!==ji.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function yv(){const e=Cn();if(e.os!==ji.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15}function mL(){const e=Cn();if(e.os!==ji.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===16}function d8(){const e=Cn();if(e.os!==ji.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function cu(){return Rs()&&navigator.maxTouchPoints>0}function h8(){return Cn().name===Fn.WECHAT}function p8(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function gL(){const e=TA();return function(){const{deviceType:r}=Cn();return r==="mobile"||r==="tablet"}()||e===ji.ANDROID||e===ji.IOS||e===ji.HARMONY_OS}function Bp(){const e=Cn();return e.name!==Fn.EDGE&&e.name!==Fn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function RA(){return TA()===ji.ANDROID}function lT(){const e=Cn();return RA()&&(e.name===Fn.CHROME||e.name===Fn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function f8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function mt(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?f8(Object(i),!0).forEach(function(o){Ht(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Ht(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}let X=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Le=class extends Error{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),Ht(this,"code",void 0),Ht(this,"message",void 0),Ht(this,"data",void 0),Ht(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return e==="error"&&(r||console).error(this.toString()),e==="warning"&&(r||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Wp(e,r){if(typeof e!="boolean")throw new Le(X.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Ni(e,r,i){if(!st(i).call(i,e))throw new Le(X.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function nr(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Le(X.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function _L(e,r){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Le(X.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));e.min!==void 0&&nr(e.min,"".concat(r,".min"),0,1/0),e.max!==void 0&&nr(e.max,"".concat(r,".max"),1,1/0),e.exact!==void 0&&nr(e.exact,"".concat(r,".exact"),1,1/0),e.ideal!==void 0&&nr(e.ideal,"".concat(r,".ideal"),1,1/0)}else nr(e,r,1,1/0)}function as(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Le(X.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!m8(e,i,o,c))throw new Le(X.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function zp(e,r){if(!Array.isArray(e))throw new Le(X.INVALID_PARAMS,"".concat(r," should be an array"))}function Ur(e){return e==null}function m8(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var uT=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(uT||{}),EL=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(EL||{});const g8=new class{constructor(){Ht(this,"_clientSize",null),Ht(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ht(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ht(this,"getStyle",e=>window.getComputedStyle(e,null)),Ht(this,"checkCssVisibleProperty",e=>{var r;let i=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||st(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(i=!1),!!i&&(m&&m.split(" ").filter(_=>{var y;const S=_.split("(")[0];return st(y=["brightness","blur","opacity"]).call(y,S)}).map(_=>{const[y,S]=_.split(/\(|\)/);return[y,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[y,S]=_;switch(y){case"brightness":(S<.1||S>3)&&(i=!1);break;case"blur":S>3&&(i=!1);break;case"opacity":S<.1&&(i=!1)}}),i)}),Ht(this,"checkPropertyUpToAllParentNodes",(e,r)=>{let i=!0,o=!0;const c=h=>r(h);let u=e;for(;u&&o;)c(u)||(i=!1,o=!1),u=u.parentElement,u||(o=!1);return i}),Ht(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Ht(this,"getSizeAboutClient",e=>{const{width:r,height:i,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:r,height:i,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),Ht(this,"checkActualSize",()=>{const{width:e,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,r,i)}),Ht(this,"elementFromPoint",(e,r)=>document.elementFromPoint?document.elementFromPoint(e,r):null),Ht(this,"checkCoverForAPoint",(e,r,i)=>{const o=this.elementFromPoint(e,r);return o!==null&&o!==i}),Ht(this,"getPointPositionList",()=>{const{width:e,height:r,left:i,top:o}=this._clientSize,c=e/6,u=r/6,h=[],m=10**6;for(let _=0;_<5;_++)for(let y=0;y<5;y++){const S=(i*m+(_===0?.1:_===4?(c*_*m-1e5)/m:c*_)*m)/m,R=(o*m+(y===0?.1:y===4?(u*y*m-1e5)/m:u*y)*m)/m;h.push({x:S,y:R})}return[...h]}),Ht(this,"checkElementCover",e=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,e)).filter(r=>!!r).length>6),Ht(this,"checkSizeIsVisible",(e,r,i)=>(e>50||i/e<=10)&&(r>50||i/r<=10)),Ht(this,"checkSizeOfPartInClient",()=>{const{left:e,right:r,top:i,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,_,y,S;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(r<0)return!1;if(_=r<u?r:u,i<0)y=0;else{if(!(i<c))return!1;y=i}if(o<0)return!1;S=o<c?o:c;const R=_-m,P=S-y;return this.checkSizeIsVisible(R,P,h)}),Ht(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Ht(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(uT.COVERED);{const r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(uT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(uT.SIZE)}}return this.returnHiddenResult(uT.STYLE)}return this.returnHiddenResult(EL.UNMOUNTED)}return this.returnHiddenResult(EL.INVALID_HTML_ELEMENT)}),Ht(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function yL(e){return new TextEncoder().encode(e)}const _8=function(e,r){const i=new Uint8Array(e.byteLength+r.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(r),e.byteLength),i},vL=async e=>function(r,i){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",yL(e)),16);let kr=class{constructor(){Ht(this,"_events",{}),Ht(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(r=>r.listener):[]}on(e,r){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(e,r){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(e,r){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,r);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const r=this._events[e].map(u=>u);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,r){let i=e.length;for(;i--;)if(e[i].listener===r)return i;return-1}},dT=null;function E8(){if(dT)return dT;if(window.electron)return dT=window.electron;if(!window.require)return null;try{return dT=window.require("electron"),dT}catch{return null}}let yi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Vr=function(e){return e.TRACER="tracer",e}({});function y8(e){return nr(e.timeout,"config.timeout",0,1e5),nr(e.timeoutFactor,"config.timeoutFactor",0,100,!1),nr(e.maxRetryCount,"config.maxRetryConfig",0,1/0),nr(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let fpe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Gn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function hT(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function v8(e){return as(e.turnServerURL,"turnServerURL"),as(e.username,"username"),as(e.password,"password"),e.udpport&&nr(e.udpport,"udpport",1,99999,!0),e.forceturn&&Wp(e.forceturn,"forceturn"),e.security&&Wp(e.security,"security"),e.tcpport&&nr(e.tcpport,"tcpport",1,99999,!0),!0}function SL(e){return e.level!==void 0&&Ni(e.level,"level",[1,2,3]),e.delay!==void 0&&nr(e.delay,"delay",0,3e3,!0),!0}let mn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Cs=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),ac=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),vv=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Is(e,r){for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return e.getListeners(r).length===0?lt.reject(new Le(X.UNEXPECTED_ERROR,"can not emit promise")):new lt((u,h)=>{e.emit(r,...o,u,h)})}function ar(e,r){if(e.getListeners(r).length===0)return lt.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return Is(e,r,...o)}function Uc(e,r){if(e.getListeners(r).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return pT(e,r,...o)}function pT(e,r){let i=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(r,...u,m=>{i=m},m=>{o=m}),o!==null)throw o;if(i===null)throw new Le(X.UNEXPECTED_ERROR,"handler is not sync");return i}const li=new class extends kr{set networkState(e){this.emit(vv.NETWORK_STATE_CHANGE,e,this._networkState),e===ac.ONLINE?this.emit(vv.ONLINE):e===ac.OFFLINE&&(this.onlineWaiter=new lt(r=>{this.once(vv.ONLINE,()=>{this.onlineWaiter=void 0,r(ac.ONLINE)})}),this.emit(vv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ac.ONLINE}constructor(){super(),Ht(this,"_moduleName","network-indicator"),Ht(this,"_networkState",ac.ONLINE),Ht(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ac.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ac.OFFLINE})}};function CA(e,r){const i=e.indexOf(r);i!==-1&&e.splice(i,1)}function Sv(e){const r=[];return e.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function IA(e){lt!==void 0?lt.resolve().then(e):setTimeout(e,0)}function Fr(e){return JSON.parse(JSON.stringify(e))}function R_(e){try{return Fr(e)}catch{return e}}const S8={};function Cm(e,r){S8[r]||(S8[r]=!0,e())}function C_(e){const r=window.atob(e),i=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)i[o]=r.charCodeAt(o);return i}function Im(e){let r="";for(let i=0;i<e.length;i+=1)r+=String.fromCharCode(e[i]);return window.btoa(r)}function b8(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>r)i=i.slice(0,r);else if(i.length<r){const o=new Uint8Array(r);o.set(i),i=o}return i}function T8(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=ec(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function dh(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function w8(e){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{r+=typeof i=="string"?dh(i):i.size}),r+138}function mpe(e){const r=new Le(X.TIMEOUT,"timeout");return new lt((i,o)=>{window.setTimeout(()=>o(r),e)})}function cs(e){return new lt(r=>{window.setTimeout(r,e)})}function cr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(r).concat(i):"".concat(r).concat(i)+cr(e-i.length,"")}function I_(){return cr(32,"").toUpperCase()}const AA=()=>{},R8=new class{constructor(){Ht(this,"fnMap",new Map)}throttleByKey(e,r,i,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==i){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:_,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,mt(mt({},m),{},{fn:e,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(r);_&&_.fn(..._.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:m,args:u,skipFn:o})}}},C8=R8.throttleByKey.bind(R8);function I8(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function bL(e,r){if(!I8(e)||!I8(r)||Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(e)){const i=[...e];for(let o=0;o<r.length;o++)i[o]=bL(e[o],r[o]);return i}{const i=mt({},e);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=bL(e[o],r[o]):i[o]=r[o]);return i}}function A8(e,r){let i=[0];if(i=new Array(r).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==r););return i}function TL(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function P8(e){const r="0123456789abcdef";function i(le){let Ee,ye="";for(Ee=0;Ee<=3;Ee++)ye+=r.charAt(le>>8*Ee+4&15)+r.charAt(le>>8*Ee&15);return ye}function o(le,Ee){const ye=(65535&le)+(65535&Ee);return(le>>16)+(Ee>>16)+(ye>>16)<<16|65535&ye}function c(le,Ee,ye,ge,ke,qe){return o(function(ut,ft){return ut<<ft|ut>>>32-ft}(o(o(Ee,le),o(ge,qe)),ke),ye)}function u(le,Ee,ye,ge,ke,qe,ut){return c(Ee&ye|~Ee&ge,le,Ee,ke,qe,ut)}function h(le,Ee,ye,ge,ke,qe,ut){return c(Ee&ge|ye&~ge,le,Ee,ke,qe,ut)}function m(le,Ee,ye,ge,ke,qe,ut){return c(Ee^ye^ge,le,Ee,ke,qe,ut)}function _(le,Ee,ye,ge,ke,qe,ut){return c(ye^(Ee|~ge),le,Ee,ke,qe,ut)}const y=function(le){let Ee;const ye=1+(le.length+8>>6),ge=new Array(16*ye);for(Ee=0;Ee<16*ye;Ee++)ge[Ee]=0;for(Ee=0;Ee<le.length;Ee++)ge[Ee>>2]|=le.charCodeAt(Ee)<<Ee%4*8;return ge[Ee>>2]|=128<<Ee%4*8,ge[16*ye-2]=8*le.length,ge}(e);let S,R,P,k,z,U=1732584193,F=-271733879,q=-1732584194,Y=271733878;for(S=0;S<y.length;S+=16)R=U,P=F,k=q,z=Y,U=u(U,F,q,Y,y[S+0],7,-680876936),Y=u(Y,U,F,q,y[S+1],12,-389564586),q=u(q,Y,U,F,y[S+2],17,606105819),F=u(F,q,Y,U,y[S+3],22,-1044525330),U=u(U,F,q,Y,y[S+4],7,-176418897),Y=u(Y,U,F,q,y[S+5],12,1200080426),q=u(q,Y,U,F,y[S+6],17,-1473231341),F=u(F,q,Y,U,y[S+7],22,-45705983),U=u(U,F,q,Y,y[S+8],7,1770035416),Y=u(Y,U,F,q,y[S+9],12,-1958414417),q=u(q,Y,U,F,y[S+10],17,-42063),F=u(F,q,Y,U,y[S+11],22,-1990404162),U=u(U,F,q,Y,y[S+12],7,1804603682),Y=u(Y,U,F,q,y[S+13],12,-40341101),q=u(q,Y,U,F,y[S+14],17,-1502002290),F=u(F,q,Y,U,y[S+15],22,1236535329),U=h(U,F,q,Y,y[S+1],5,-165796510),Y=h(Y,U,F,q,y[S+6],9,-1069501632),q=h(q,Y,U,F,y[S+11],14,643717713),F=h(F,q,Y,U,y[S+0],20,-373897302),U=h(U,F,q,Y,y[S+5],5,-701558691),Y=h(Y,U,F,q,y[S+10],9,38016083),q=h(q,Y,U,F,y[S+15],14,-660478335),F=h(F,q,Y,U,y[S+4],20,-405537848),U=h(U,F,q,Y,y[S+9],5,568446438),Y=h(Y,U,F,q,y[S+14],9,-1019803690),q=h(q,Y,U,F,y[S+3],14,-187363961),F=h(F,q,Y,U,y[S+8],20,1163531501),U=h(U,F,q,Y,y[S+13],5,-1444681467),Y=h(Y,U,F,q,y[S+2],9,-51403784),q=h(q,Y,U,F,y[S+7],14,1735328473),F=h(F,q,Y,U,y[S+12],20,-1926607734),U=m(U,F,q,Y,y[S+5],4,-378558),Y=m(Y,U,F,q,y[S+8],11,-2022574463),q=m(q,Y,U,F,y[S+11],16,1839030562),F=m(F,q,Y,U,y[S+14],23,-35309556),U=m(U,F,q,Y,y[S+1],4,-1530992060),Y=m(Y,U,F,q,y[S+4],11,1272893353),q=m(q,Y,U,F,y[S+7],16,-155497632),F=m(F,q,Y,U,y[S+10],23,-1094730640),U=m(U,F,q,Y,y[S+13],4,681279174),Y=m(Y,U,F,q,y[S+0],11,-358537222),q=m(q,Y,U,F,y[S+3],16,-722521979),F=m(F,q,Y,U,y[S+6],23,76029189),U=m(U,F,q,Y,y[S+9],4,-640364487),Y=m(Y,U,F,q,y[S+12],11,-421815835),q=m(q,Y,U,F,y[S+15],16,530742520),F=m(F,q,Y,U,y[S+2],23,-995338651),U=_(U,F,q,Y,y[S+0],6,-198630844),Y=_(Y,U,F,q,y[S+7],10,1126891415),q=_(q,Y,U,F,y[S+14],15,-1416354905),F=_(F,q,Y,U,y[S+5],21,-57434055),U=_(U,F,q,Y,y[S+12],6,1700485571),Y=_(Y,U,F,q,y[S+3],10,-1894986606),q=_(q,Y,U,F,y[S+10],15,-1051523),F=_(F,q,Y,U,y[S+1],21,-2054922799),U=_(U,F,q,Y,y[S+8],6,1873313359),Y=_(Y,U,F,q,y[S+15],10,-30611744),q=_(q,Y,U,F,y[S+6],15,-1560198380),F=_(F,q,Y,U,y[S+13],21,1309151649),U=_(U,F,q,Y,y[S+4],6,-145523070),Y=_(Y,U,F,q,y[S+11],10,-1120210379),q=_(q,Y,U,F,y[S+2],15,718787259),F=_(F,q,Y,U,y[S+9],21,-343485551),U=o(U,R),F=o(F,P),q=o(q,k),Y=o(Y,z);return i(U)+i(F)+i(q)+i(Y)}let gpe=1,O8=console,Ms=class{static setLogger(e){O8=e}constructor(e,r){Ht(this,"id",void 0),Ht(this,"lockingPromise",lt.resolve()),Ht(this,"locks",0),Ht(this,"name",""),Ht(this,"lockId",void 0),this.lockId=gpe++,e&&(this.name=e),r&&(this.id=r),this.logger("created")}logger(e,r){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(r??"");O8.debug("".concat(i," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let r;this.locks+=1,this.logger("locked",e);const i=new lt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function bv(e,r){return function(i,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(o));try{for(var _=arguments.length,y=new Array(_),S=0;S<_;S++)y[S]=arguments[S];return await u.apply(this,y)}finally{m()}},c}}const vi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function wL(e,r){const i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,e));return Math.min(r.maxRetryTimeout,i)}function dd(e,r,i,o){const c=Object.assign({},vi,o);let u=c.timeout;const h=async()=>{await function(y){return new lt(S=>{window.setTimeout(S,y)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const _=new lt(async(y,S)=>{r=r||(()=>!1),i=i||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new Le(X.OPERATION_ABORTED));try{const P=await e();if(!r(P,R)||R+1===c.maxRetryCount)return y(P);await h()}catch(P){if(!i(P,R)||R+1===c.maxRetryCount)return S(P);await h()}}});return _.cancel=()=>m=!0,_}let PA,k8=class{constructor(e){Ht(this,"input",[]),Ht(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:ec(e=this.input).call(e,(r,i)=>r+i)/this.input.length}},OA=0,RL=0;function CL(e,r,i,o){return new lt((c,u)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),OA+=dh(r.data)):i&&(r.data.size?OA+=r.data.size:r.data instanceof FormData?OA+=w8(r.data):OA+=dh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,Jo.request(r).then(h=>{typeof h.data=="string"?RL+=dh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?RL+=h.data.byteLength:RL+=dh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Jo.isCancel(h)?u(new Le(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Le(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Le(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Le(X.NETWORK_ERROR,h.message))})})}async function _pe(e,r){const i=new Blob([r.data],{type:"buffer"});return await CL(e,mt(mt({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const N8=()=>window.isSecureContext!==void 0;function lu(e){if(Array.isArray(e))return e.map(i=>i);if(!D8(e))return e;const r={};for(const i in e){const o=e[i];D8(o)||Array.isArray(o)?r[i]=lu(o):r[i]=o}return r}function D8(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let IL=class{constructor(e){Ht(this,"input",[]),Ht(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const hh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},fT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:hh,remoteCandidate:hh},updateInterval:0},L8={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},x8={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},M8={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},U8={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let AL=class{constructor(e,r){Ht(this,"onFirstVideoReceived",void 0),Ht(this,"onFirstVideoDecoded",void 0),Ht(this,"onFirstAudioReceived",void 0),Ht(this,"onFirstVideoDecodedTimeout",void 0),Ht(this,"onFirstAudioDecoded",void 0),Ht(this,"onSelectedLocalCandidateChanged",void 0),Ht(this,"onSelectedRemoteCandidateChanged",void 0),Ht(this,"videoIsReady",!1),Ht(this,"videoIsReady2",{}),Ht(this,"pc",void 0),Ht(this,"options",void 0),Ht(this,"intervalTimer",void 0),Ht(this,"stats",lu(fT)),Ht(this,"isFirstVideoReceived",{}),Ht(this,"isFirstVideoDecoded",{}),Ht(this,"isFirstAudioReceived",{}),Ht(this,"isFirstAudioDecoded",{}),Ht(this,"isFirstVideoDecodedTimeout",{}),Ht(this,"lossRateWindowStats",[]),this.pc=e,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new lt(e=>{e({local:mt({},hh),remote:mt({},hh)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,r){this.videoIsReady2[e]=r}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of i)e[m].forEach((_,y)=>{if(!this.lossRateWindowStats[r-1][m][y]||!this.lossRateWindowStats[0][m][y])return;const S=this.lossRateWindowStats[r-1][m][y].packets-this.lossRateWindowStats[0][m][y].packets,R=this.lossRateWindowStats[r-1][m][y].packetsLost-this.lossRateWindowStats[0][m][y].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||R<=0?0:R/(S+R)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Epe=class extends AL{constructor(){super(...arguments),Ht(this,"_stats",fT),Ht(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),r=this.statsResponsesToObjects(e);this._stats=lu(fT);const i=r.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(r=>{var i;const o=st(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=lu(x8);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=lu(L8),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:mt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=lu(U8);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=lu(M8);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new lt((e,r)=>{this.pc.getStats(e,r)})}statsResponsesToObjects(e){const r=[];return e.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{o[c]=i.stat(c)}),r.push(o)}),r}},mT=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),kA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),PL=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Vc=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Tv=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Tv||{});function gT(e,r,i,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Tv.kNone;if(!r)return;const u=Number(r[i]);if(typeof u!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const m=Number(e[i]);if(typeof m!="number")return;const _=Number(e[o]);if(typeof _!="number")return;const y=h-_;return y?(u-m)/y*c:void 0}let V8=class extends AL{constructor(){super(...arguments),Ht(this,"_stats",fT),Ht(this,"report",void 0),Ht(this,"lastDecodeVideoReceiverStats",new Map),Ht(this,"lastVideoFramesRecv",new Map),Ht(this,"lastVideoFramesSent",new Map),Ht(this,"lastVideoFramesDecode",new Map),Ht(this,"lastVideoFramesOutput",new Map),Ht(this,"lastVideoJBDelay",new Map),Ht(this,"lastAudioJBDelay",new Map),Ht(this,"mediaBytesSent",new Map),Ht(this,"mediaBytesRetransmit",new Map),Ht(this,"mediaBytesTargetEncode",new Map),Ht(this,"lastDecodeAudioReceiverStats",new Map),Ht(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=lu(fT),this.report.forEach(e=>{switch(e.type){case Vc.OUTBOUND:case Vc.INBOUND:{const r=e.mediaType||e.kind,i=!r&&"frameWidth"in e,o=!r&&!("frameWidth"in e);e.type===Vc.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(e):(r==="video"||i)&&this.processVideoOutboundStats(e):e.type===Vc.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(e):(r==="video"||i)&&this.processVideoInboundStats(e));break}case Vc.TRANSPORT:{const r=this.report.get(e.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Vc.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),r={local:mt({},hh),remote:mt({},hh)};return e.forEach(i=>{let o;if(i.type===Vc.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===Vc.CANDIDATE_PAIR&&i.selected&&(o=i),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(r.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const r=this.report.get(e.localCandidateId);r&&this.processCandidateStats(r)}if(e.remoteCandidateId){const r=this.report.get(e.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(e){let r;e.type===Vc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),e.type===Vc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=e.type,r.id=e.id,e.address&&(r.address=e.address),e.candidateType&&(r.candidateType=e.candidateType),e.port&&(r.port=e.port),e.priority&&(r.priority=e.priority),e.protocol&&(r.protocol=e.protocol),e.relayProtocol&&(r.relayProtocol=e.relayProtocol),e.type===Vc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.localCandidate)),e.type===Vc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let r=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);r||(r=lu(U8),this._stats.audioRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.packetsDiscarded=e.packetsDiscarded,r.bytes=e.bytesReceived,r.jitterMs=1e3*e.jitter,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived,r.totalProcessingDelay=e.totalProcessingDelay,r.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=gT(i,r,"totalProcessingDelay","jitterBufferEmittedCount",Tv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),r.receivedFrames||(r.receivedFrames=e.packetsReceived),r.droppedFrames||(r.droppedFrames=e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof e.concealedSamples=="number"&&(r.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,mt({},r))}processVideoInboundStats(e){let r=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);r||(r=lu(L8),this._stats.videoRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.bytes=e.bytesReceived,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.framesDecodeCount=e.framesDecoded,r.framesDroppedCount=e.framesDropped,r.totalInterFrameDelay=e.totalInterFrameDelay,r.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,r.totalFreezesDuration=e.totalFreezesDuration,r.totalProcessingDelay=e.totalProcessingDelay,r.packetsDiscarded=e.packetsDiscarded,r.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,r.totalAssemblyTime=e.totalAssemblyTime,r.keyFramesDecoded=e.keyFramesDecoded,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){const h=i.stats,m=u-i.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?r.qpSumPerFrame=e.qpSum/e.framesDecoded:r.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(r.decodeMs=1e3*e.totalDecodeTime,r.avgDecodeMs=gT(i==null?void 0:i.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=gT(i==null?void 0:i.stats,r,"totalProcessingDelay","framesDecodeCount",Tv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=gT(i==null?void 0:i.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Tv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=gT(i==null?void 0:i.stats,r,"totalInterFrameDelay","framesDecodeCount",Tv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((e.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(r.framesRateFirefox=e.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:mt({},r),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let r=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);r||(r=lu(x8),this._stats.videoSend.push(r));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const o=new IL(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new IL(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new IL(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(r.ssrc=e.ssrc,r.bytes=e.bytesSent,r.packets=e.packetsSent,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.frameCount=e.framesEncoded,r.adaptionChangeReason=e.qualityLimitationReason,r.scalabilityMode=e.scalabilityMode,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,r.hugeFramesSent=e.hugeFramesSent,r.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)r.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?r.qpSumPerFrame=e.qpSum/e.framesEncoded:r.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,r),this.processVideoTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const o=this.findRemoteStatsId(e.ssrc,Vc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(e){let r=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(r||(r=lu(M8),this._stats.audioSend.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsSent,r.bytes=e.bytesSent,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const i=this.findRemoteStatsId(e.ssrc,Vc.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}findRemoteStatsId(e,r){var i;const o=Array.from(xc(i=this.report).call(i)).find(c=>c.type===r&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,r){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,r){const i=this.report.get(e);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,r,i){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof _!="number")return;let y=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:e.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof y=="number"&&typeof S=="number"||(y=0,S=0),R==null){const P=Date.now(),k=this.lastVideoFramesSent.get(i.ssrc);k&&P-k.lts>=800?(R=Math.round((_-k.count)/((P-k.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:P,rate:R})):k?R=k.rate:this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:P,rate:0})}i.sentFrame={width:y,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,r,i){var o,c,u,h,m;const _=r?this.report.get(r):void 0,y=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,R=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,P=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,k=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof y=="number"){const z=this.lastVideoFramesRecv.get(i.ssrc),U=Date.now();i.framesReceivedCount=y;let F=0;z&&U-z.lts>=800?(F=Math.round((y-z.count)/((U-z.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:U,rate:F})):z?F=z.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:U,rate:0}),i.receivedFrame={width:S||0,height:R||0,frameRate:F||0},i.decodedFrame={width:S||0,height:R||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:S||0,height:R||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(P&&k){const z=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let U=z.jitterBufferMs;const F=k-z.jitterBufferEmittedCount;F>0&&(U=1e3*(P-z.jitterBufferDelay)/F),i.jitterBufferMs=U,i.currentDelayMs=Math.round(U),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:k,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,r,i){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,y=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=_,i.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(e,r,i){var o,c,u,h,m,_,y;const S=r?this.report.get(r):void 0,R=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,k=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,z=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,U=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,F=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,q=(y=S==null?void 0:S.concealedSamples)!==null&&y!==void 0?y:e.concealedSamples;if(typeof P=="number"&&(i.totalSamplesReceived=P),R&&P&&(i.accelerateRate=R/P),k&&z){const le=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Ee=le.jitterBufferMs;const ye=z-le.jitterBufferEmittedCount;ye>0&&(Ee=1e3*(k-le.jitterBufferDelay)/ye),i.jitterBufferMs=Math.round(Ee),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:z,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=U;let Y=1920;F&&P&&(Y=P/F/50,i.receivedFrames=Math.round(P/Y)),q&&(i.droppedFrames=Math.round(q/Y))}processRemoteInboundStats(e,r){const i=this.report.get(e);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(e){const r=this.report.get(e);if(!r)return"";const i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,r=null,i=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const o=r!==null?e-r:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},ype=class extends AL{updateStats(){return lt.resolve()}};function OL(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new Epe(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new V8(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof lt||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(e)?new V8(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new ype(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const F8="websdk_ng_install_id";function kL(){try{if(re("INSTALL_ID"))return re("INSTALL_ID");let e=window.localStorage.getItem(F8);return e||(e=I_(),window.localStorage.setItem(F8,e)),Qn("INSTALL_ID",e),e}catch{return}}const vl=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const i=r[1],o=r[2];return"".concat(i,".").concat(o)}return"4.0.0.999"}("4.23.2"),NL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let A_=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const As=function(){const e="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const o=i.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=As;const NA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},DL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},LL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",xL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},_r=mt(mt(mt({},xL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:DL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},NA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Qn(e,r,i){var o,c,u;st(o=Object.keys(_r)).call(o,e)&&(!i&&st(c=Object.keys(hd)).call(c,e)||(_r[e]=r,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(_r.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(_r.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,_r.USE_NEW_NETWORK_CONFIG=u,u&&(_r.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],_r.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],_r.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],_r.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],_r.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",_r.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",_r.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&r&&(_r.ENABLE_INSTANT_VIDEO=!0,_r.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&r&&(_r.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&r&&(_r.NEW_TURN_MODE||(_r.NEW_TURN_MODE=4))))}function re(e){return _r[e]}NL||(_r.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],_r.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],_r.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],_r.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],_r.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],_r.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],_r.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",_r.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",_r.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",_r.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",_r.AREAS=["NORTH_AMERICA","OVERSEA"]);let j8=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const hd={};var gn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(gn||{});let DA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const B8=128,vpe=96,W8=1e3,wv=10;let Spe=0;var z8=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>ut,Printer:()=>ni,parse:()=>it,print:()=>St});const h=`
`,m="".concat("\r").concat(h),_=" ";let y;function S(ze){return ze>="0"&&ze<="9"}function R(ze){return ze>="!"&&ze<="~"}function P(ze){return R(ze)||ze>=""&&ze<=""}function k(ze){return ze==="!"||ze>="#"&&ze<="'"||ze>="*"&&ze<="+"||ze>="-"&&ze<="."||ze>="0"&&ze<="9"||ze>="A"&&ze<="Z"||ze>="^"&&ze<="~"}function z(ze){return ze>="1"&&ze<="9"}function U(ze){return ze>="A"&&ze<="Z"||ze>="a"&&ze<="z"}function F(ze){return ze==="d"||ze==="h"||ze==="m"||ze==="s"}function q(ze){return ze>""&&ze<"	"||ze>"\v"&&ze<"\f"||ze>""&&ze<""}function Y(ze){return U(ze)||S(ze)||ze==="+"||ze==="/"}function le(ze){return S(ze)||U(ze)||ze==="+"||ze==="/"||ze==="-"||ze==="_"}function Ee(ze){return U(ze)||S(ze)||ze==="+"||ze==="/"}function ye(ze,x){var ie=Object.keys(ze);if(Object.getOwnPropertySymbols){var de=Object.getOwnPropertySymbols(ze);x&&(de=de.filter(function(Xe){return Object.getOwnPropertyDescriptor(ze,Xe).enumerable})),ie.push.apply(ie,de)}return ie}function ge(ze){for(var x=1;x<arguments.length;x++){var ie=arguments[x]!=null?arguments[x]:{};x%2?ye(Object(ie),!0).forEach(function(de){ke(ze,de,ie[de])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ze,Object.getOwnPropertyDescriptors(ie)):ye(Object(ie)).forEach(function(de){Object.defineProperty(ze,de,Object.getOwnPropertyDescriptor(ie,de))})}return ze}function ke(ze,x,ie){return x in ze?Object.defineProperty(ze,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):ze[x]=ie,ze}(function(ze){ze.VERSION="v",ze.ORIGIN="o",ze.SESSION_NAME="s",ze.INFORMATION="i",ze.URI="u",ze.EMAIL="e",ze.PHONE="p",ze.CONNECTION="c",ze.BANDWIDTH="b",ze.TIME="t",ze.REPEAT="r",ze.ZONE_ADJUSTMENTS="z",ze.KEY="k",ze.ATTRIBUTE="a",ze.MEDIA="m"})(y||(y={}));class qe{consumeText(x,ie){let de=ie;for(;de<x.length;){const Xe=x[de];if(Xe==="\0"||Xe==="\r"||Xe===h)break;de+=1}if(de-ie==0)throw new Error("Invalid text, at ".concat(x));return de}consumeUnicastAddress(x,ie,de){return this.consumeTill(x,ie,_)}consumeOneOrMore(x,ie,de){let Xe=ie;for(;de(x[Xe]);)Xe++;if(Xe-ie==0)throw new Error("Invalid rule at ".concat(ie,"."));return Xe}consumeSpace(x,ie){if(x[ie]===_)return ie+1;throw new Error("Invalid space at ".concat(ie,"."))}consumeIP4Address(x,ie){let de=ie;for(let Xe=0;Xe<4;Xe++)if(de=this.consumeDecimalUChar(x,de),Xe!==3){if(x[de]!==".")throw new Error("Invalid IP4 address.");de++}return de}consumeDecimalUChar(x,ie){let de=ie;for(let qt=0;qt<3&&S(x[de]);qt++,de++);if(de-ie==0)throw new Error("Invalid decimal uchar.");const Xe=parseInt(x.slice(ie,de));if(Xe>=0&&Xe<=255)return de;throw new Error("Invalid decimal uchar")}consumeIP6Address(x,ie){let de=this.consumeHexpart(x,ie);return x[de]===":"&&(de+=1,de=this.consumeIP4Address(x,de)),de}consumeHexpart(x,ie){let de=ie;if(x[de]===":"&&x[de+1]===":"){de+=2;try{de=this.consumeHexseq(x,de)}catch{}return de}if(de=this.consumeHexseq(x,de),x[de]===":"&&x[de+1]===":"){de+=2;try{de=this.consumeHexseq(x,de)}catch{}return de}return de}consumeHexseq(x,ie){let de=ie;for(;de=this.consumeHex4(x,de),x[de]===":"&&x[de+1]!==":";)de+=1;return de}consumeHex4(x,ie){let de=0;for(;de<4;de++)if(!((Xe=x[ie+de])>="0"&&Xe<="9"||Xe>="a"&&Xe<="f"||Xe>="A"&&Xe<="F")){if(de===0)throw new Error("Invalid hex 4");break}var Xe;return ie+de}consumeFQDN(x,ie){let de=ie;for(;S(x[de])||U(x[de])||x[de]==="-"||x[de]===".";)de+=1;if(de-ie<4)throw new Error("Invalid FQDN");return de}consumeExtnAddr(x,ie){return this.consumeOneOrMore(x,ie,P)}consumeMulticastAddress(x,ie,de){switch(de){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(x,ie);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(x,ie);default:try{return this.consumeFQDN(x,ie)}catch{return this.consumeExtnAddr(x,ie)}}}consumeIP6MulticastAddress(x,ie){const de=this.consumeHexpart(x,ie);return x[de]==="/"?this.consumeInteger(x,de+1):de}consumeIP4MulticastAddress(x,ie){let de=ie+3;const Xe=x.slice(ie,de),qt=parseInt(Xe);if(qt<224||qt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let rr=0;rr<3;rr++){if(x[de]!==".")throw new Error("Invalid IP4 multicast address.");de+=1,de=this.consumeDecimalUChar(x,de)}return x[de]==="/"&&(de+=1),de=this.consumeTTL(x,de),x[de]==="/"&&(de=this.consumeInteger(x,de)),de}consumeInteger(x,ie){if(!z(x[ie]))throw new Error("Invalid integer.");for(ie+=1;S(x[ie]);)ie+=1;return ie}consumeTTL(x,ie){if(x[ie]==="0")return ie+1;if(!z(x[ie]))throw new Error("Invalid TTL.");ie+=1;for(let de=0;de<2&&S(x[ie]);de++)ie+=1;return ie}consumeToken(x,ie){return this.consumeOneOrMore(x,ie,k)}consumeTime(x,ie){let de=ie;if(x[de]==="0")return de+1;for(z(x[de])&&(de+=1);S(x[de]);)de++;if(de-ie<10)throw new Error("Invalid time");return de}consumeAddress(x,ie){return this.consumeTill(x,ie,_)}consumeTypedTime(x,ie){let de=ie;return de=this.consumeOneOrMore(x,de,S),F(x[de])?de+1:de}consumeRepeatInterval(x,ie){if(!z(x[ie]))throw new Error("Invalid repeat interval");for(ie+=1;S(x[ie]);)ie+=1;return F(x[ie])&&(ie+=1),ie}consumePort(x,ie){return this.consumeOneOrMore(x,ie,S)}consume(x,ie,de){for(let Xe=0;Xe<de.length;Xe++){if(ie+Xe>=x.length)throw new Error("consume exceeding value length");if(x[ie+Xe]!==de[Xe])throw new Error("consume ".concat(de," failed at ").concat(Xe))}return ie+de.length}consumeTill(x,ie,de){let Xe=ie;for(;Xe<x.length&&(typeof de!="string"||x[Xe]!==de)&&(typeof de!="function"||!de(x[Xe]));)Xe++;return Xe}}class ut extends qe{constructor(){super(),ke(this,"records",[]),ke(this,"currentLine",0)}parse(x){const ie=this.probeEOL(x);this.records=x.split(ie).filter(Q_=>!!oo(Q_).call(Q_)).map(this.parseLine),this.currentLine=0;const de=this.parseVersion(),Xe=this.parseOrigin(),qt=this.parseSessionName(),rr=this.parseInformation(),zi=this.parseUri(),Ma=this.parseEmail(),tf=this.parsePhone(),J_=this.parseConnection(),ZT=this.parseBandWidth(),GP=this.parseTimeFields(),HP=this.parseKey(),Al=this.parseSessionAttribute(),Hm=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:de,origin:Xe,sessionName:qt,information:rr,uri:zi,emails:Ma,phones:tf,connection:J_,bandwidths:ZT,timeFields:GP,key:HP,attributes:Al,mediaDescriptions:Hm}}getCurrentRecord(){const x=this.records[this.currentLine];if(!x)throw new Error("Record doesn't exit.");return x}probeEOL(x){for(let ie=0;ie<x.length;ie++)if(x[ie]===h)return x[ie-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(x,ie){if(x.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const de=x[0];if(x[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:de,value:x.slice(2),line:ie,cur:0}}parseSessionAttribute(){const x=new yn;for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.ATTRIBUTE)break;const de={attField:this.extractOneOrMore(ie,Xe=>k(Xe)&&Xe!==":"),_cur:0};ie.value[ie.cur]===":"&&(ie.cur+=1,de.attValue=this.extractOneOrMore(ie,q)),x.parse(de),this.currentLine++}return x.digest()}parseMediaAttributes(x){const ie=new vn(x);for(;this.currentLine<this.records.length;){const de=this.getCurrentRecord();if(de.type!==y.ATTRIBUTE)break;const Xe={attField:this.extractOneOrMore(de,qt=>k(qt)&&qt!==":"),_cur:0};de.value[de.cur]===":"&&(de.cur+=1,Xe.attValue=this.extractOneOrMore(de,q)),ie.parse(Xe),this.currentLine++}return ie.digest()}parseKey(){const x=this.getCurrentRecord();if(x.type===y.KEY){if(x.value==="prompt"||x.value==="clear:"||x.value==="base64:"||x.value==="uri:")return x.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const x=this.getCurrentRecord();if(x.type===y.ZONE_ADJUSTMENTS){const ie=[];for(;;)try{const de=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);let Xe=!1;x.value[x.cur]==="-"&&(Xe=!0,x.cur+=1);const qt=this.extract(x,this.consumeTypedTime);ie.push({time:de,typedTime:qt,back:Xe})}catch{break}if(ie.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ie}return[]}parseRepeat(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.REPEAT)break;{const de=this.extract(ie,this.consumeRepeatInterval),Xe=this.parseTypedTime(ie);x.push({repeatInterval:de,typedTimes:Xe}),this.currentLine++}}return x}parseTypedTime(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeTypedTime))}catch{break}if(ie.length===0)throw new Error("Invalid typed time.");return ie}parseTime(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);const de=this.extract(x,this.consumeTime);return this.currentLine++,{startTime:ie,stopTime:de}}parseBandWidth(){const x=[];for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.BANDWIDTH)break;{const de=this.extractOneOrMore(ie,k);if(ie.value[ie.cur]!==":")throw new Error("Invalid bandwidth field.");ie.cur++;const Xe=this.extractOneOrMore(ie,S);x.push({bwtype:de,bandwidth:Xe}),this.currentLine++}}return x}parseVersion(){const x=this.getCurrentRecord();if(x.type!==y.VERSION)throw new Error("first sdp record must be version");const ie=x.value.slice(0,this.consumeOneOrMore(x.value,0,S));if(ie.length!==x.value.length)throw new Error('invalid proto version, "v='.concat(x.value,'"'));return this.currentLine++,ie}parseOrigin(){const x=this.getCurrentRecord();if(x.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const ie=this.extractOneOrMore(x,P);this.consumeSpaceForRecord(x);const de=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const Xe=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const qt=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const rr=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const zi=this.extract(x,this.consumeUnicastAddress);return this.currentLine++,{username:ie,sessId:de,sessVersion:Xe,nettype:qt,addrtype:rr,unicastAddress:zi}}parseSessionName(){const x=this.getCurrentRecord();if(x.type===y.SESSION_NAME){const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}}parseInformation(){const x=this.getCurrentRecord();if(x.type!==y.INFORMATION)return;const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}parseUri(){const x=this.getCurrentRecord();if(x.type===y.URI)return this.currentLine++,x.value}parseEmail(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.EMAIL)break;x.push(ie.value),this.currentLine++}return x}parsePhone(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.PHONE)break;x.push(ie.value),this.currentLine++}return x}parseConnection(){const x=this.getCurrentRecord();if(x.type===y.CONNECTION){const ie=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const de=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const Xe=this.extract(x,this.consumeAddress);return this.currentLine++,{nettype:ie,addrtype:de,address:Xe}}}parseMedia(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeToken);this.consumeSpaceForRecord(x);let de=this.extract(x,this.consumePort);x.value[x.cur]==="/"&&(x.cur+=1,de+=this.extract(x,this.consumeInteger)),this.consumeSpaceForRecord(x);const Xe=[];for(Xe.push(this.extract(x,this.consumeToken));x.value[x.cur]==="/";)x.cur+=1,Xe.push(this.extract(x,this.consumeToken));if(Xe.length===0)throw new Error("Invalid proto");const qt=this.parseFmt(x);return this.currentLine++,{mediaType:ie,port:de,protos:Xe,fmts:qt}}parseTimeFields(){const x=[];for(;this.getCurrentRecord().type===y.TIME;){const ie=this.parseTime(),de=this.parseRepeat(),Xe=this.parseZone();x.push({time:ie,repeats:de,zones:Xe})}return x}parseMediaDescription(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const ie=this.parseMedia(),de=this.parseInformation(),Xe=this.parseConnections(),qt=this.parseBandWidth(),rr=this.parseKey(),zi=this.parseMediaAttributes(ie);x.push({media:ie,information:de,connections:Xe,bandwidths:qt,key:rr,attributes:zi})}return x}parseConnections(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)x.push(this.parseConnection());return x}parseFmt(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeToken))}catch{break}if(ie.length===0)throw new Error("Invalid fmts");return ie}extract(x,ie){for(var de=arguments.length,Xe=new Array(de>2?de-2:0),qt=2;qt<de;qt++)Xe[qt-2]=arguments[qt];const rr=ie.call(this,x.value,x.cur,...Xe),zi=x.value.slice(x.cur,rr);return x.cur=rr,zi}extractOneOrMore(x,ie){const de=this.consumeOneOrMore(x.value,x.cur,ie),Xe=x.value.slice(x.cur,de);return x.cur=de,Xe}consumeSpaceForRecord(x){if(x.value[x.cur]!==_)throw new Error("Invalid space at ".concat(x.cur,"."));x.cur+=1}}class ft extends qe{constructor(){super(...arguments),ke(this,"attributes",void 0),ke(this,"digested",!1)}extractOneOrMore(x,ie,de){const Xe=this.consumeOneOrMore(x.attValue,x._cur,ie),qt=x.attValue.slice(x._cur,Xe),[rr,zi]=de||[];if(typeof rr=="number"&&qt.length<rr)throw new Error("error in length, should be more or equal than ".concat(rr," characters."));if(typeof zi=="number"&&qt.length>zi)throw new Error("error in length, should be less or equal than ".concat(zi," characters."));return x._cur=Xe,qt}consumeAttributeSpace(x){if(x.attValue[x._cur]!==_)throw new Error("Invalid space at ".concat(x._cur,"."));x._cur+=1}extract(x,ie){if(!x.attValue)throw new Error("Nothing to extract from attValue.");for(var de=arguments.length,Xe=new Array(de>2?de-2:0),qt=2;qt<de;qt++)Xe[qt-2]=arguments[qt];const rr=ie.call(this,x.attValue,x._cur,...Xe),zi=x.attValue.slice(x._cur,rr);return x._cur=rr,zi}atEnd(x){if(!x.attValue)throw new Error;return x._cur>=x.attValue.length}peekChar(x){if(!x.attValue)throw new Error;return x.attValue[x._cur]}peek(x,ie){if(!x.attValue)throw new Error;for(let de=0;de<ie.length;de++)if(ie[de]!==x.attValue[x._cur+de])return!1;return!0}parseIceUfrag(x){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(x,Y,[4,256])}parseIcePwd(x){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(x,Y,[22,256])}parseIceOptions(x){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ie=[];for(;!this.atEnd(x);){ie.push(this.extractOneOrMore(x,Y));try{this.consumeAttributeSpace(x)}catch(de){if(this.atEnd(x))break;throw de}}this.attributes.iceOptions=ie}parseFingerprint(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ie,fingerprint:de})}parseExtmap(x){const ie=this.extractOneOrMore(x,S);let de;this.peekChar(x)==="/"&&(this.extract(x,this.consume,"/"),de=this.extract(x,this.consumeToken)),this.consumeAttributeSpace(x);const Xe=this.extract(x,this.consumeTill,_),qt=ge(ge({entry:parseInt(ie,10)},de&&{direction:de}),{},{extensionName:Xe});this.peekChar(x)===_&&(this.consumeAttributeSpace(x),qt.extensionAttributes=this.extract(x,this.consumeTill)),this.attributes.extmaps.push(qt)}parseSetup(x){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ie=this.extract(x,this.consumeTill);if(ie!=="active"&&ie!=="passive"&&ie!=="actpass"&&ie!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ie}}class yn extends ft{constructor(){super(...arguments),ke(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"group":this.parseGroup(x);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"fingerprint":this.parseFingerprint(x);break;case"setup":this.parseSetup(x);break;case"tls-id":this.parseTlsId(x);break;case"identity":this.parseIdentity(x);break;case"extmap":this.parseExtmap(x);break;case"msid-semantic":this.parseMsidSemantic(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing session attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(x){const ie=this.extract(x,this.consumeToken),de=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;)this.consumeAttributeSpace(x),de.push(this.extract(x,this.consumeToken));this.attributes.groups.push({semantic:ie,identificationTag:de})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(x){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(x,le)}parseIdentity(x){const ie=this.extractOneOrMore(x,Ee),de=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;){this.consumeAttributeSpace(x);const Xe=this.extract(x,this.consumeToken);this.extract(x,this.consume,"=");const qt=this.extractOneOrMore(x,rr=>rr!==_&&q(rr));de.push({name:Xe,value:qt})}this.attributes.identities.push({assertionValue:ie,extensions:de})}parseMsidSemantic(x){this.peekChar(x)===_&&this.consumeAttributeSpace(x);const ie={semantic:this.extract(x,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(x)}catch{break}if(this.peekChar(x)==="*"){this.extract(x,this.consume,"*"),ie.applyForAll=!0;break}{const de=this.extract(x,this.consumeTill,_);ie.identifierList.push(de)}}this.attributes.msidSemantic=ie}}class vn extends ft{constructor(x){super(),ke(this,"attributes",void 0),x.protos.indexOf("RTP")!==-1||x.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"extmap":this.parseExtmap(x);break;case"setup":this.parseSetup(x);break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"candidate":this.parseCandidate(x);break;case"remote-candidate":this.parseRemoteCandidate(x);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(x);break;case"rtpmap":this.parseRtpmap(x);break;case"ptime":this.parsePtime(x);break;case"maxptime":this.parseMaxPtime(x);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(x);break;case"ssrc":this.parseSSRC(x);break;case"fmtp":this.parseFmtp(x);break;case"rtcp-fb":this.parseRtcpFb(x);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(x);break;case"mid":this.parseMid(x);break;case"msid":this.parseMsid(x);break;case"imageattr":this.parseImageAttr(x);break;case"rid":this.parseRid(x);break;case"simulcast":this.parseSimulcast(x);break;case"sctp-port":this.parseSctpPort(x);break;case"max-message-size":this.parseMaxMessageSize(x);break;case"ssrc-group":this.parseSSRCGroup(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing media attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}parseCandidate(x){const ie=this.extractOneOrMore(x,Y,[1,32]);this.consumeAttributeSpace(x);const de=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Xe=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const qt=this.extractOneOrMore(x,S,[1,10]);this.consumeAttributeSpace(x);const rr=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const zi=this.extract(x,this.consumePort);this.consumeAttributeSpace(x),this.extract(x,this.consume,"typ"),this.consumeAttributeSpace(x);const Ma={foundation:ie,componentId:de,transport:Xe,priority:qt,connectionAddress:rr,port:zi,type:this.extract(x,this.consumeToken),extension:{}};for(this.peek(x," raddr")&&(this.extract(x,this.consume," raddr"),this.consumeAttributeSpace(x),Ma.relAddr=this.extract(x,this.consumeAddress)),this.peek(x," rport")&&(this.extract(x,this.consume," rport"),this.consumeAttributeSpace(x),Ma.relPort=this.extract(x,this.consumePort));this.peekChar(x)===_;){this.consumeAttributeSpace(x);const tf=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x),Ma.extension[tf]=this.extractOneOrMore(x,R)}this.attributes.candidates.push(Ma)}parseRemoteCandidate(x){const ie=[];for(;;){const de=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Xe=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const qt=this.extract(x,this.consumePort);ie.push({componentId:de,connectionAddress:Xe,port:qt});try{this.consumeAttributeSpace(x)}catch{break}}this.attributes.remoteCandidatesList.push(ie)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill,"/");this.extract(x,this.consume,"/");const Xe={encodingName:de,clockRate:this.extractOneOrMore(x,S)};this.atEnd(x)||this.peekChar(x)!=="/"||(this.extract(x,this.consume,"/"),Xe.encodingParameters=parseInt(this.extract(x,this.consumeTill),10));const qt=this.attributes.payloads.find(rr=>rr.payloadType===parseInt(ie,10));qt?qt.rtpMap=Xe:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtpMap:Xe,rtcpFeedbacks:[]})}parsePtime(x){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(x,this.consumeTill)}parseMaxPtime(x){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(x,this.consumeTill)}parseDirection(x){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=x.attField}parseSSRC(x){const ie=this.extractOneOrMore(x,S);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill,":");let Xe;this.peekChar(x)===":"&&(this.extract(x,this.consume,":"),Xe=this.extract(x,this.consumeTill));const qt=this.attributes.ssrcs.find(rr=>rr.ssrcId===parseInt(ie,10));qt?qt.attributes[de]=Xe:this.attributes.ssrcs.push({ssrcId:parseInt(ie,10),attributes:{[de]:Xe}})}parseFmtp(x){const ie=this.extract(x,this.consumeTill,_);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill),Xe={};de.split(";").forEach(rr=>{let[zi,Ma]=rr.split("=");zi=oo(zi).call(zi);const tf=typeof Ma=="string"?oo(Ma).call(Ma):null;typeof zi=="string"&&zi.length>0&&(Xe[zi]=tf)});const qt=this.attributes.payloads.find(rr=>rr.payloadType===parseInt(ie,10));qt?qt.fmtp={parameters:Xe}:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[],fmtp:{parameters:Xe}})}parseFmtParameters(x){const ie={},de=this.extract(x,this.consumeTill,"=");x._cur++;const Xe=this.extract(x,this.consumeTill,";");for(ie[de]=Xe;x.attValue[x._cur]===";";){const qt=this.extract(x,this.consumeTill,"=");x._cur++;const rr=this.extract(x,this.consumeTill,";");ie[qt]=rr}return ie}parseRtcpFb(x){let ie="";ie=this.peekChar(x)==="*"?this.extract(x,this.consume,"*"):this.extract(x,this.consumeTill,_),this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill,_);let Xe;if(de==="trr-int")Xe={type:de,interval:this.extract(x,this.consumeTill)};else{const qt={type:de};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),qt.parameter=this.extract(x,this.consumeToken),this.peekChar(x)===_&&(qt.additional=this.extract(x,this.consumeTill))),Xe=qt}if(ie==="*")this.attributes.rtcpFeedbackWildcards.push(Xe);else{const qt=this.attributes.payloads.find(rr=>rr.payloadType===parseInt(ie,10));qt?qt.rtcpFeedbacks.push(Xe):this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[Xe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(x){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ie={port:this.extract(x,this.consumePort)};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.netType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.addressType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.address=this.extract(x,this.consumeAddress)),this.attributes.rtcp=ie}parseMsid(x){const ie={id:this.extractOneOrMore(x,k,[1,64])};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.appdata=this.extractOneOrMore(x,k,[1,64])),this.attributes.msids.push(ie)}parseImageAttr(x){this.attributes.imageattr.push(x.attValue)}parseRid(x){const ie=this.extractOneOrMore(x,Xe=>U(Xe)||S(Xe)||Xe==="_"||Xe==="-");this.consumeAttributeSpace(x);const de={id:ie,direction:this.extract(x,this.consumeToken),params:[]};if(this.peekChar(x)===_){if(this.consumeAttributeSpace(x),this.peek(x,"pt=")){this.extract(x,this.consume,"pt=");const Xe=[];for(;;){const qt=this.extract(x,this.consumeToken);Xe.push(qt);try{this.extract(x,this.consume,",")}catch{break}}de.payloads=Xe,this.peekChar(x)===_&&this.extract(x,this.consume,_)}for(;;){const Xe=this.extract(x,this.consumeToken);switch(Xe){case"depend":{const qt={type:Xe,rids:this.extract(x,this.consume,"=").split(",")};de.params.push(qt);break}default:{const qt={type:Xe};this.peekChar(x)==="="&&(this.extract(x,this.consume,"="),qt.val=this.extract(x,this.consumeTill,";")),de.params.push(qt)}}try{this.extract(x,this.consume,";")}catch{break}}}this.attributes.rids.push(de)}parseSimulcast(x){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=x.attValue,this.extract(x,this.consumeTill)}parseSctpPort(x){this.attributes.sctpPort=this.extractOneOrMore(x,S,[1,5])}parseMaxMessageSize(x){this.attributes.maxMessageSize=this.extractOneOrMore(x,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(x){this.attributes.mid=this.extract(x,this.consumeToken)}parseSSRCGroup(x){const ie=this.extract(x,this.consumeToken),de=[];for(;;)try{this.consumeAttributeSpace(x);const Xe=this.extract(x,this.consumeInteger);de.push(parseInt(Xe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ie,ssrcIds:de})}}function ur(ze,x,ie){return x in ze?Object.defineProperty(ze,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):ze[x]=ie,ze}class ni{constructor(){ur(this,"eol",m)}print(x,ie){let de="";return ie&&(this.eol=ie),de+=this.printVersion(x.version),de+=this.printOrigin(x.origin),de+=this.printSessionName(x.sessionName),de+=this.printInformation(x.information),de+=this.printUri(x.uri),de+=this.printEmail(x.emails),de+=this.printPhone(x.phones),de+=this.printConnection(x.connection),de+=this.printBandwidth(x.bandwidths),de+=this.printTimeFields(x.timeFields),de+=this.printKey(x.key),de+=this.printSessionAttributes(x.attributes),de+=this.printMediaDescription(x.mediaDescriptions),de}printVersion(x){return"v=".concat(x).concat(this.eol)}printOrigin(x){return"o=".concat(x.username," ").concat(x.sessId," ").concat(x.sessVersion," ").concat(x.nettype," ").concat(x.addrtype," ").concat(x.unicastAddress).concat(this.eol)}printSessionName(x){return x?"s=".concat(x).concat(this.eol):""}printInformation(x){return x?"i=".concat(x).concat(this.eol):""}printUri(x){return x?"u=".concat(x).concat(this.eol):""}printEmail(x){let ie="";for(const de of x)ie+="e=".concat(de).concat(this.eol);return ie}printPhone(x){let ie="";for(const de of x)ie+="e=".concat(de).concat(this.eol);return ie}printConnection(x){return x?"c=".concat(x.nettype," ").concat(x.addrtype," ").concat(x.address).concat(this.eol):""}printBandwidth(x){let ie="";for(const de of x)ie+="b=".concat(de.bwtype,":").concat(de.bandwidth).concat(this.eol);return ie}printTimeFields(x){let ie="";for(const de of x){ie+="t=".concat(de.time.startTime," ").concat(de.time.startTime).concat(this.eol);for(const Xe of de.repeats)ie+="r=".concat(Xe.repeatInterval," ").concat(Xe.typedTimes.join(" ")).concat(this.eol);de.zoneAdjustments&&(ie+="z=",ie+="z=".concat(de.zoneAdjustments.map(Xe=>"".concat(Xe.time," ").concat(Xe.back?"-":""," ").concat(Xe.typedTime)).join(" ")).concat(this.eol),ie+=this.eol)}return ie}printKey(x){return x?"k=".concat(x).concat(this.eol):""}printAttributes(x){let ie="";for(const de of x)ie+="a=".concat(de.attField).concat(de.attValue?":".concat(de.attValue):"").concat(this.eol);return ie}printMediaDescription(x){let ie="";for(const de of x)ie+=this.printMedia(de.media),ie+=this.printInformation(de.information),ie+=this.printConnections(de.connections),ie+=this.printBandwidth(de.bandwidths),ie+=this.printKey(de.key),ie+=this.printMediaAttributes(de);return ie}printConnections(x){let ie="";for(const de of x)ie+=this.printConnection(de);return ie}printMedia(x){return"m=".concat(x.mediaType," ").concat(x.port," ").concat(x.protos.join("/")," ").concat(x.fmts.join(" ")).concat(this.eol)}printSessionAttributes(x){return new ra(this.eol).print(x)}printMediaAttributes(x){return new je(this.eol).print(x)}}class Gr{constructor(x){ur(this,"eol",void 0),this.eol=x}printIceUfrag(x){return x===void 0?"":"a=ice-ufrag:".concat(x).concat(this.eol)}printIcePwd(x){return x===void 0?"":"a=ice-pwd:".concat(x).concat(this.eol)}printIceOptions(x){return x===void 0?"":"a=ice-options:".concat(x.join(_)).concat(this.eol)}printFingerprints(x){return x.length>0?x.map(ie=>"a=fingerprint:".concat(ie.hashFunction).concat(_).concat(ie.fingerprint)).join(this.eol)+this.eol:""}printExtmap(x){return x.map(ie=>"a=extmap:".concat(ie.entry).concat(ie.direction?"/".concat(ie.direction):"").concat(_).concat(ie.extensionName).concat(ie.extensionAttributes?"".concat(_).concat(ie.extensionAttributes):"").concat(this.eol)).join("")}printSetup(x){return x===void 0?"":"a=setup:".concat(x).concat(this.eol)}printUnrecognized(x){return x.map(ie=>"a=".concat(ie.attField).concat(ie.attValue?":".concat(ie.attValue):"").concat(this.eol)).join("")}}class ra extends Gr{print(x){let ie="";return ie+=this.printGroups(x.groups),ie+=this.printMsidSemantic(x.msidSemantic),ie+=this.printIceLite(x.iceLite),ie+=this.printIceUfrag(x.iceUfrag),ie+=this.printIcePwd(x.icePwd),ie+=this.printIceOptions(x.iceOptions),ie+=this.printFingerprints(x.fingerprints),ie+=this.printSetup(x.setup),ie+=this.printTlsId(x.tlsId),ie+=this.printIdentity(x.identities),ie+=this.printExtmap(x.extmaps),ie+=this.printUnrecognized(x.unrecognized),ie}printGroups(x){let ie="";return x.length>0&&(ie+=x.map(de=>"a=group:".concat(de.semantic).concat(de.identificationTag.map(Xe=>"".concat(_).concat(Xe)).join("")).concat(this.eol)).join("")),ie}printIceLite(x){return x===void 0?"":"a=ice-lite"+this.eol}printTlsId(x){return x?"a=tls-id:".concat(x).concat(this.eol):""}printIdentity(x){return x.length===0?"":x.map(ie=>"a=identity:".concat(ie.assertionValue).concat(ie.extensions.map(de=>"".concat(_).concat(de.name).concat(de.value?"=".concat(de.value):"")))).join(this.eol)+this.eol}printMsidSemantic(x){if(!x)return"";let ie="a=msid-semantic:".concat(x.semantic);return x.applyForAll?ie+="".concat(_,"*"):x.identifierList.length>0&&(ie+=x.identifierList.map(de=>"".concat(_).concat(de))),ie+this.eol}}class je extends Gr{print(x){const ie=x.attributes;let de="";return de+=this.printRTCP(ie.rtcp),de+=this.printIceUfrag(ie.iceUfrag),de+=this.printIcePwd(ie.icePwd),de+=this.printIceOptions(ie.iceOptions),de+=this.printCandidates(ie.candidates),de+=this.printRemoteCandidatesList(ie.remoteCandidatesList),de+=this.printEndOfCandidates(ie.endOfCandidates),de+=this.printFingerprints(ie.fingerprints),de+=this.printSetup(ie.setup),de+=this.printMid(ie.mid),de+=this.printExtmap(ie.extmaps),de+=this.printRTPRelated(ie),de+=this.printPtime(ie.ptime),de+=this.printMaxPtime(ie.maxPtime),de+=this.printDirection(ie.direction),de+=this.printSSRCGroups(ie.ssrcGroups),de+=this.printSSRC(ie.ssrcs),de+=this.printRTCPMux(ie.rtcpMux),de+=this.printRTCPMuxOnly(ie.rtcpMuxOnly),de+=this.printRTCPRsize(ie.rtcpRsize),de+=this.printMSId(ie.msids),de+=this.printImageattr(ie.imageattr),de+=this.printRid(ie.rids),de+=this.printSimulcast(ie.simulcast),de+=this.printSCTPPort(ie.sctpPort),de+=this.printMaxMessageSize(ie.maxMessageSize),de+=this.printUnrecognized(ie.unrecognized),de}printCandidates(x){return x.map(ie=>"a=candidate:".concat(ie.foundation).concat(_).concat(ie.componentId).concat(_).concat(ie.transport).concat(_).concat(ie.priority).concat(_).concat(ie.connectionAddress).concat(_).concat(ie.port).concat(_,"typ").concat(_).concat(ie.type).concat(ie.relAddr?"".concat(_,"raddr").concat(_).concat(ie.relAddr):"").concat(ie.relPort?"".concat(_,"rport").concat(_).concat(ie.relPort):"").concat(Object.keys(ie.extension).map(de=>"".concat(_).concat(de).concat(_).concat(ie.extension[de])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(x){return x.map(ie=>"a=remote-candidates:".concat(ie.join(_)).concat(this.eol)).join("")}printEndOfCandidates(x){return x===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(x){if(!x.payloads)return"";const ie=x.payloads;let de="";de+=x.rtcpFeedbackWildcards.map(Xe=>this.printRTCPFeedback("*",Xe)).join("");for(const Xe of ie)de+=this.printRtpMap(Xe.payloadType,Xe.rtpMap),de+=this.printFmtp(Xe.payloadType,Xe.fmtp),de+=Xe.rtcpFeedbacks.map(qt=>this.printRTCPFeedback(Xe.payloadType,qt)).join("");return de}printFmtp(x,ie){if(!ie)return"";const de=Object.keys(ie.parameters);return de.length===1&&ie.parameters[de[0]]===null?"a=fmtp:".concat(x).concat(_).concat(de[0]).concat(this.eol):"a=fmtp:".concat(x).concat(_).concat(Object.keys(ie.parameters).map(Xe=>"".concat(Xe,"=").concat(ie.parameters[Xe])).join(";")).concat(this.eol)}printRtpMap(x,ie){return ie?"a=rtpmap:".concat(x).concat(_).concat(ie.encodingName,"/").concat(ie.clockRate).concat(ie.encodingParameters?"/".concat(ie.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(x,ie){let de="a=rtcp-fb:".concat(x).concat(_),Xe=ie;return Xe.type==="trr-int"?de+="ttr-int".concat(_).concat(Xe.interval):(de+="".concat(Xe.type),Xe.parameter&&(de+="".concat(_).concat(Xe.parameter),Xe.additional&&(de+="".concat(_).concat(Xe.additional)))),de+this.eol}printPtime(x){return x===void 0?"":"a=ptime:".concat(x).concat(this.eol)}printMaxPtime(x){return x===void 0?"":"a=maxptime:".concat(x).concat(this.eol)}printDirection(x){return x===void 0?"":"a=".concat(x).concat(this.eol)}printSSRC(x){return x.map(ie=>Object.keys(ie.attributes).map(de=>"a=ssrc:".concat(ie.ssrcId.toString(10)).concat(_).concat(de).concat(ie.attributes[de]?":".concat(ie.attributes[de]):"").concat(this.eol)).join("")).join("")}printRTCPMux(x){return x===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(x){return x===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(x){return x===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(x){if(x===void 0)return"";let ie="a=rtcp:".concat(x.port);return x.netType&&(ie+="".concat(_).concat(x.netType)),x.addressType&&(ie+="".concat(_).concat(x.addressType)),x.address&&(ie+="".concat(_).concat(x.address)),ie+this.eol}printMSId(x){return x.map(ie=>"a=msid:".concat(ie.id).concat(ie.appdata?"".concat(_).concat(ie.appdata):"").concat(this.eol)).join("")}printImageattr(x){return x.map(ie=>"a=imageattr:".concat(ie).concat(this.eol)).join("")}printRid(x){return x.map(ie=>{let de="a=rid:".concat(ie.id).concat(_).concat(ie.direction);return ie.payloads&&(de+="".concat(_,"pt=").concat(ie.payloads.join(","))),ie.params.length>0&&(de+="".concat(_).concat(ie.params.map(Xe=>Xe.type==="depend"?"depend=".concat(Xe.rids.join(",")):"".concat(Xe.type,"=").concat(Xe.val)).join(";"))),de+this.eol}).join("")}printSimulcast(x){return x===void 0?"":"a=simulcast:".concat(x).concat(this.eol)}printSCTPPort(x){return x===void 0?"":"a=sctp-port:".concat(x).concat(this.eol)}printMaxMessageSize(x){return x===void 0?"":"a=max-message-size:".concat(x).concat(this.eol)}printMid(x){return x===void 0?"":"a=mid:".concat(x).concat(this.eol)}printSSRCGroups(x){return x.map(ie=>"a=ssrc-group:".concat(ie.semantic).concat(ie.ssrcIds.map(de=>"".concat(_).concat(de.toString(10))).join("")).concat(this.eol)).join("")}}function it(ze){return new ut().parse(ze)}function St(ze,x){return new ni().print(ze,x)}}},r={};function i(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return e[o](c,c.exports,i),c.exports}return i.d=(o,c)=>{for(var u in c)i.o(c,u)&&!i.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();function Na(e){return z8.parse(e)}function Am(e,r){return z8.print(e,r)}var bpe=Za("Array").keys,Tpe=wc,wpe=gi,Rpe=N,Cpe=bpe,ML=Array.prototype,Ipe={DOMTokenList:!0,NodeList:!0},Ape=function(e){var r=e.keys;return e===ML||Rpe(ML,e)&&r===ML.keys||wpe(Ipe,Tpe(e))?Cpe:r},Fc=l(Ape);function G8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function rn(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?G8(Object(i),!0).forEach(function(o){jr(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):G8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function jr(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}const H8=new class extends kr{constructor(){super(...arguments),jr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:r}=e;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Ppe{constructor(r){jr(this,"logger",void 0),jr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function UL(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function $8(){const e=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Sl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},LA=Date.now(),_T=e=>{for(const r in Sl)if(Object.prototype.hasOwnProperty.call(Sl,r)&&Sl[r]===e)return r;return"DEFAULT"},L=new class{constructor(){jr(this,"proxyServerURL",void 0),jr(this,"logLevel",Sl.DEBUG),jr(this,"uploadState","collecting"),jr(this,"uploadLogWaitingList",[]),jr(this,"uploadLogUploadingList",[]),jr(this,"uploadErrorCount",0),jr(this,"currentLogID",0),jr(this,"url",void 0),jr(this,"extLog",(e,r)=>{this.appendLogToWaitingList(e,...r)})}debug(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Sl.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Sl.INFO].concat(r);this.log.apply(this,o)}warning(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Sl.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Sl.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Sl.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Qn("UPLOAD_LOG",!0)}disableLogUpload(){Qn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Ppe(this).prefix(e)}log(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-LA<100)return void setTimeout(()=>{this.log(...r)},Date.now()-LA);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=UL()+" Agora-SDK [".concat(_T(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=UL()+" %cAgora-SDK [".concat(_T(o),"]:");let u=[];if(!re("USE_NEW_LOG"))switch(o){case Sl.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case Sl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case Sl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case Sl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-LA<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-LA);const o=Math.max(0,Math.min(4,r[0]));r[0]=UL()+" Agora-SDK [".concat(_T(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(e){if(!re("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=$8()+" Agora-SDK [".concat(_T(e),"]:"):i[0]=$8()+" Agora-SDK [".concat(_T(e),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,r={sdk_version:vl,process_id:re("PROCESS_ID"),payload:JSON.stringify(e)};return dd(async()=>{const i=await Jo.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(re("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(re("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{const o={status:-1,message:i.message,errorRange:e.map(c=>c.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),H8.reportLogUploadError(o),!0},{timeout:re("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:re("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,re("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var K8;function Ope(e){return as(e.reportId,"params.reportId",0,100,!1),as(e.category,"params.category",0,100,!1),as(e.event,"params.event",0,100,!1),as(e.label,"params.label",0,100,!1),nr(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(K8={}).FREE="free",K8.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const kpe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Bi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Ir=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Npe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,o){const c=o.value;if(typeof c=="function"){const u=e.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,_=new Array(m),y=0;y<m;y++)_[y]=arguments[y];let S=_;if(e.argsMap)try{S=e.argsMap(this,..._)}catch(P){L.warning(P),S=[]}try{JSON.stringify(S)}catch{L.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),S=[]}const R=(e.report||Rt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:S,tag:Vr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const P=c.apply(this,_);return P instanceof lt?P.then(k=>(R.onSuccess(e.reportResult&&k),k)).catch(k=>{throw R.onError(k),k}):(R.onSuccess(e.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return o}}const Rt=new class{constructor(){jr(this,"baseInfoMap",new Map),jr(this,"proxyServer",void 0),jr(this,"eventUploadTimer",void 0),jr(this,"setSessionIdTimer",void 0),jr(this,"url",void 0),jr(this,"sids",new Set),jr(this,"backupUrl",void 0),jr(this,"_appId",void 0),jr(this,"_aid",0),jr(this,"keyEventUploadPendingItems",[]),jr(this,"normalEventUploadPendingItems",[]),jr(this,"apiInvokeUploadPendingItems",[]),jr(this,"apiInvokeCount",0),jr(this,"apiInvokeLoggedCount",0),jr(this,"ltsList",[]),jr(this,"lastSendNormalEventTime",Date.now()),jr(this,"customReportCounterTimer",void 0),jr(this,"customReportCount",0),jr(this,"extApiInvoke",async e=>{for(const r of e){const i=rn(rn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Vr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),re("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),re("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,r=>{let[i,o]=r;return i+o}),16)||0}reportApiInvoke(e,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!re("SHOW_REPORT_INVOKER_LOG"),h=!!re("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function y(k,z){if(m){let U="[apiInvoke-".concat(_,"]");r.id&&(U+="[".concat(r.id,"]")),r.name&&(U+="[".concat(r.name,"]")),L.info("".concat(U," ").concat(k),k==="start"?r.options:z||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:e,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});y("start");let R=!1;cs(r.timeout).then(()=>{R||(this.sendApiInvoke(rn(rn({},S()),{},{error:X.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))});const P=new Le(X.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:k=>{const z=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(rn(rn({},S()),{},{success:!0},r.reportResult&&{result:k})),y("onSuccess"),k};return i?C8(z,r.name+"Success",i,()=>R=!0):z()},onError:k=>{const z=()=>{if(R)throw k;R=!0,this.sendApiInvoke(rn(rn({},S()),{},{success:!1,error:k})),y("onFailure",k.toString())};return i?C8(z,r.name+"Error",i,()=>R=!0):z()}}}sessionInit(e,r){if(this.baseInfoMap.has(e))return;const i=Date.now(),o=this.createBaseInfo(e,i);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:re("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:NL?"global":"oversea",areas:re("AREAS")&&re("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientRole:S}=r,R=Date.now(),P=rn(rn({},o),{},{eventType:Bi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:LL,lts:R,elapse:R-i,extend:JSON.stringify(c),mode:r.mode,process:re("PROCESS_ID"),appType:re("APP_TYPE"),success:!0,version:vl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientType:st(k=window.navigator.userAgent).call(k,"AgoraWebView")?42:20,clientRole:S,serviceId:re("PROCESS_ID"),extensionID:re("PLUGIN_INFO").join(",")||""});var k;this.send({type:Ir.SESSION,data:P},!0)}joinChooseServer(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{role:r.role,eventType:Bi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:Ir.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Bi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-i.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Ir.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:_}=r,y=c-(u&&h?h:i.startTime),S=rn(rn({},o),{},{eventType:Bi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:y,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:kL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=S.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=c),u)this.send({type:Ir.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(_){const z=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:z&&z.length?z[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:_?1:0}}else{const z=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:z&&z.length?z[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const k=Object.assign({},S,P,{eventType:Bi.REJOIN_GATEWAY});this.send({type:Ir.RE_JOIN_GATEWAY,data:k},!0)}}joinChannelTimeout(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=Date.now(),c=rn(rn({},i.info),{},{lts:o,timeout:r,elapse:o-i.startTime});this.send({type:Ir.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Bi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Ir.PUBLISH,data:u},!0)}subscribe(e,r,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=rn(rn({},c),{},{eventType:Bi.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Ir.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var r;const i=[...Fc(r=this.baseInfoMap).call(r)],o=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn({},u),{},{eventType:Bi.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:Ir.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:i,data:m},!0)}firstRemoteFrame(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:i,data:m},!0)}abTest(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Bi.AB_TEST,lts:c});this.send({type:Ir.AB_TEST,data:u},!0)}pcStats(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Bi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Ir.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,r){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Bi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Ir.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),o),{},{eventType:r,lts:h});this.send({type:i,data:m},!0)}streamSwitch(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Bi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-i.startTime,success:r.succ});this.send({type:Ir.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Bi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Ir.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Bi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Ir.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?L.debug("reportProxyServerurl: ".concat(e)):L.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Ir.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now();(function(u,h,m){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const y=dh(JSON.stringify(u));let S=0;const R=[];let P=0;for(let k=0;k<_.length;k++)P+=_.charCodeAt(k)<=127?1:3,P<=m-y||(R[R.length]=mt(mt({},u),{},{[h]:_.substring(S,k)}),S=k,P=_.charCodeAt(k)<=127?1:3);return S!==_.length-1&&(R[R.length]=mt(mt({},u),{},{[h]:_.substring(S)})),R})(rn(rn(rn({},o),r),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Ir.WORKER_EVENT,data:u},!0))}apworkerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{elapse:c-i.startTime,lts:c});this.send({type:Ir.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{elapse:c-i.startTime,lts:c,extend:r.extend||void 0});this.send({type:Ir.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{elapse:c-i.startTime,lts:c});this.send({type:Ir.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,r){if(this.customReportCount+=r.length,this.customReportCount>re("CUSTOM_REPORT_LIMIT"))throw new Le(X.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),o=r.map(c=>({type:Ir.USER_ANALYTICS,data:rn(rn({sid:e},c),{},{lts:i})}));try{re("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw L.error("send custom report message failed",c.toString()),new Le(X.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const r=re("NOT_REPORT_EVENT");if(e.tag&&st(r)&&st(r).call(r,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=i.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Le){const{code:_,message:y}=e.error;h=_||y||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Ir.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const r=Array.from(this.sids).find(i=>i!==null);r&&e.forEach(i=>{i&&(i.sid=r,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,r){if(r)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,r){const i=[],o=[];for(;e.length;){const u=e.shift();i.length<20?i.push(u):o.push(u)}e.push(...o);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),Xb(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),re("ENABLE_EVENT_REPORT")&&i.length&&(re("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{re("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-re("NORMAL_EVENT_QUEUE_CAPACITY")),L.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){li.networkState===ac.OFFLINE&&await lt.race([li.onlineWaiter,cs(2*vi.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=yL(JSON.stringify(h.data)),_=new ArrayBuffer(5),y=(R=>{let P=0;return Object.entries(Ir).forEach(k=>{let[z,U]=k;U===R.type&&(P=Npe[z])}),P})(h),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&y),S.setUint8(3,y>>>8&255),S.setUint8(4,y>>>16&255),u=_8(u,new Uint8Array(_)),u=_8(u,m)}),u},i="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await CL(o,{timeout:1e4,data:r(e),headers:rn(rn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),o=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:i,aid:o};li.networkState===ac.OFFLINE&&await lt.race([li.onlineWaiter,cs(2*vi.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u)));try{r?await _pe(h,{timeout:1e4,data:c}):await CL(h,{timeout:1e4,data:c})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(e,r){const i=Object.assign({},kpe);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:r}),i}reportResourceTiming(e,r){const i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:Vr.TRACER}).onSuccess()}};H8.on("REPORT_LOG_UPLOAD",e=>{e.networkState=li.networkState,Rt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Vr.TRACER}).onSuccess("logUploadError")});class Oe extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),jr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,L)}throw(){super.throw(L)}}const ls={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Dn(){return ls}function q8(){return"setSinkId"in HTMLAudioElement.prototype&&(!re("RESTRICTION_SET_PLAYBACK_DEVICE")||(jp()||s8())&&!gL())}function Y8(){return!ls.supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Bp()}let us=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Rv(e,r,i){return{sampleRate:e,stereo:r,bitrate:i}}function In(e,r,i,o,c){return{width:e,height:r,frameRate:i,bitrateMin:o,bitrateMax:c}}function uu(e,r,i,o,c){return{width:{max:e},height:{max:r},frameRate:i,bitrateMin:o,bitrateMax:c}}function VL(e,r){return{numSpatialLayers:e,numTemporalLayers:r}}const Dpe={"90p":In(160,90),"90p_1":In(160,90),"120p":In(160,120,15,30,65),"120p_1":In(160,120,15,30,65),"120p_3":In(120,120,15,30,50),"120p_4":In(212,120),"180p":In(320,180,15,30,140),"180p_1":In(320,180,15,30,140),"180p_3":In(180,180,15,30,100),"180p_4":In(240,180,15,30,120),"240p":In(320,240,15,40,200),"240p_1":In(320,240,15,40,200),"240p_3":In(240,240,15,40,140),"240p_4":In(424,240,15,40,220),"360p":In(640,360,15,80,400),"360p_1":In(640,360,15,80,400),"360p_3":In(360,360,15,80,260),"360p_4":In(640,360,30,80,600),"360p_6":In(360,360,30,80,400),"360p_7":In(480,360,15,80,320),"360p_8":In(480,360,30,80,490),"360p_9":In(640,360,15,80,800),"360p_10":In(640,360,24,80,800),"360p_11":In(640,360,24,80,1e3),"480p":In(640,480,15,100,500),"480p_1":In(640,480,15,100,500),"480p_2":In(640,480,30,100,1e3),"480p_3":In(480,480,15,100,400),"480p_4":In(640,480,30,100,750),"480p_6":In(480,480,30,100,600),"480p_8":In(848,480,15,100,610),"480p_9":In(848,480,30,100,930),"480p_10":In(640,480,10,100,400),"720p":In(1280,720,15,120,1130),"720p_auto":In(1280,720,30,900,3e3),"720p_1":In(1280,720,15,120,1130),"720p_2":In(1280,720,30,120,2e3),"720p_3":In(1280,720,30,120,1710),"720p_5":In(960,720,15,120,910),"720p_6":In(960,720,30,120,1380),"1080p":In(1920,1080,15,120,2080),"1080p_1":In(1920,1080,15,120,2080),"1080p_2":In(1920,1080,30,120,3e3),"1080p_3":In(1920,1080,30,120,3150),"1080p_5":In(1920,1080,60,120,4780),"1440p":In(2560,1440,30,120,4850),"1440p_1":In(2560,1440,30,120,4850),"1440p_2":In(2560,1440,60,120,7350),"4k":In(3840,2160,30,120,8910),"4k_1":In(3840,2160,30,120,8910),"4k_3":In(3840,2160,60,120,13500)},Lpe={"480p":uu(640,480,5),"480p_1":uu(640,480,5),"480p_2":uu(640,480,30),"480p_3":uu(640,480,15),"720p":uu(1280,720,5),"720p_auto":In(1280,720,30,900,3e3),"720p_1":uu(1280,720,5),"720p_2":uu(1280,720,30),"720p_3":uu(1280,720,15),"1080p":uu(1920,1080,5),"1080p_1":uu(1920,1080,5),"1080p_2":uu(1920,1080,30),"1080p_3":uu(1920,1080,15)},xpe={"1SL1TL":VL(1,1),"3SL3TL":VL(3,3),"2SL3TL":VL(2,3)};function ph(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Dpe[e]):e}function FL(e){return typeof e=="string"?Object.assign({},Lpe[e]):e}function xA(e){return typeof e=="string"?Object.assign({},xpe[e]):e}const Mpe={speech_low_quality:Rv(16e3,!1),speech_standard:Rv(32e3,!1,18),music_standard:Rv(48e3,!1),standard_stereo:Rv(48e3,!0,56),high_quality:Rv(48e3,!1,128),high_quality_stereo:Rv(48e3,!0,192)};function MA(e){return typeof e=="string"?Object.assign({},Mpe[e]):e}const Cv=[];function X8(e){return Ni(e,"mediaSource",["screen","window","application"]),!0}let _t=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),lr=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Iv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Upe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Vpe=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),P_=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Av=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Pv=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Ov=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),jc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const jL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},BL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},J8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Fpe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Q8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Co=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Bc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),ET=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),O_=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),ao=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),fh=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const WL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let UA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Z8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Ar(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Z8(Object(i),!0).forEach(function(o){Pe(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Z8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Pe(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function An(e,r,i,o,c){var u,h,m={};return Object.keys(o).forEach(function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=ec(u=Zf(h=i.slice()).call(h)).call(u,function(_,y){return y(e,r,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(e,r,m),m=null),m}class eW extends kr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(P_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,i){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=i||cr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){st(Cv).call(Cv,o)||Cv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Cm(()=>{var i;Rt.reportApiInvoke(null,{name:yi.GET_MEDIA_STREAM_TRACK,options:[],tag:Vr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Iv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const i=Cv.indexOf(r);i!==-1&&Cv.splice(i,1)}(this),this.emit(Av.CLOSED),this.removeAllListeners(P_.SEI_RECEIVED)}_updateRtpTransceiver(r,i){if(i===Iv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(P_.TRANSCEIVER_UPDATED,r,i)}}class kv extends eW{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,i){super(r,i),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ms("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return(r=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,L.debug("[".concat(this.getTrackId(),"] close")),this.emit(_t.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ar(this,_t.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Av.TRACK_ENDED)}stateCheck(r,i){if(L.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),Wp(i,r),this._enabled&&this._muted&&r==="enabled"&&i===!1)throw new Le(X.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",L);if(!this._enabled&&!this._muted&&r==="muted"&&i===!0)throw new Le(X.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",L)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():lt.resolve([])}}const tW=window.AudioContext||window.webkitAudioContext;let Wc=null;const Zn=new class extends kr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{L.info("ios15-interruption-start"),this.emit(us.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{L.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?L.info("ios15-interruption-end-canceled"):(Wc&&await Wc.suspend(),this.emit(us.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){L.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){L.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Nv(){if(!Wc){if(function(){if(!tW)return void L.error("your browser is not support web audio");L.info("create audio context");const e=Ar({},re("WEBAUDIO_INIT_OPTIONS"));L.debug("audio context init option:",JSON.stringify(e)),Wc=new tW(e),Zn.curState=Wc.state,Wc.onstatechange=()=>{Zn.prevState=Zn.curState,Zn.curState=Wc?Wc.state:void 0;const{prevState:r,curState:i}=Zn,o=i==="running",c=i==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",_=Cn().osVersion;(Ro()||cu())&&u&&c&&(L.info("ios".concat(_,"-interruption-start")),Zn.emit(us.IOS_INTERRUPTION_START)),(Ro()||cu())&&(h||m)&&o&&(L.info("ios".concat(_,"-interruption-end")),Zn.emit(us.IOS_INTERRUPTION_END)),r!==i&&Zn.emit(us.STATE_CHANGE,i,r)},setInterval(()=>{var r;const i=(r=Wc)===null||r===void 0?void 0:r.currentTime;Zn.currentTime!==i?(Zn.currentTimeStuckAt&&(L.debug("AudioContext current time resume at ".concat(i)),Zn.currentTimeStuckAt=void 0),Zn.currentTime=i):(i!==Zn.currentTimeStuckAt&&(Rt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Vr.TRACER}).onSuccess(),L.warning("AudioContext current time stuck at ".concat(i))),Zn.currentTimeStuckAt=i)},5e3),async function(r){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(U){r.state==="running"?_(!1):Ro()||cu()?r.state==="suspended"&&(_(!0),U&&r.resume().then(y,y)):r.state!=="closed"&&(_(!0),U&&r.resume().then(y,y))}function _(U){if(c!==U){c=U;for(let F=0,q=i;F<q.length;F+=1){const Y=q[F];U?window.addEventListener(Y,S,{capture:!0,passive:!0}):window.removeEventListener(Y,S,{capture:!0,passive:!0})}}}function y(){m(!1)}function S(){m(!0)}function R(U){if(!h)if(o.paused)if(U){let F;P(!1),h=!0;try{F=o.play(),F?F.then(k,k):(o.addEventListener("playing",k),o.addEventListener("abort",k),o.addEventListener("error",k))}catch{k()}}else P(!0);else P(!1)}function P(U){if(u!==U){u=U;for(let F=0,q=i;F<q.length;F++){const Y=q[F];U?window.addEventListener(Y,z,{capture:!0,passive:!0}):window.removeEventListener(Y,z,{capture:!0,passive:!0})}}}function k(){o.removeEventListener("playing",k),o.removeEventListener("abort",k),o.removeEventListener("error",k),h=!1,R(!1)}function z(){R(!0)}if(Ro()){const U=r.createMediaStreamDestination(),F=document.createElement("div");F.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=F.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=U.stream,R(!0)}Zn.on(us.STATE_CHANGE,function(){m(!0)}),m(!1)}(Wc)}(),!Wc)throw new Le(X.NOT_SUPPORTED,"can not create audio context");return Wc}return Wc}function k_(e){if(function(){if(zL!==null)return zL;const o=Nv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),zL=m,m}())return;const r=e.connect,i=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),st(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),r.call(e,o,c,u)):r.call(e,o,c)),e},e.disconnect=(o,c,u)=>{i.call(e),o?CA(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)r.call(e,h)}}let zL=null;function GL(e,r){let i=!1;const o=1/r;if(re("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=Nv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{i=!0}}class nW{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=Nv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ro()||cu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const i=ec(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{L.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class rW extends kr{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=Nv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),k_(this.outputNode),this.volumeLevelAnalyser=new nW}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(jc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Dn().webAudioMediaStreamDest)throw new Le(X.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&IA(()=>{Zn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ro()||cu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await cs(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;(r=this.processedNode)===null||r===void 0||r.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class iW extends rW{get isFreeze(){return!1}constructor(r,i,o){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(L.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void L.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>L.info("resume success")),L.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),k_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),k_(this.outputNode),this.emit(jc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(X.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),k_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,L.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));k_(_),this.originVolumeLevelAnalyser=new nW,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Cn();i&&h.os===ji.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Zn.on(us.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),k_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(jc.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),Zn.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),L.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([i]));k_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function sW(e,r,i){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function jpe(e,r){const i=await oW(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new lt((m,_)=>{const y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const k=document.createElement("div");k.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const z=document.createElement("button");z.innerHTML="cancel",z.setAttribute("style","width: 85px;"),z.onclick=()=>{document.body.removeChild(q);const Y=new Error("NotAllowedError");Y.name="NotAllowedError",_(Y)};let U=h;const F=document.createElement("div");if(h){const Y=document.createElement("input");Y.setAttribute("type","checkbox");const le=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),le.innerText="Share audio",Y.checked=U,Y.onchange=()=>{U=Y.checked},F.appendChild(Y),F.appendChild(le)}k.appendChild(F),k.appendChild(z),S.appendChild(R),S.appendChild(P),S.appendChild(k);const q=document.createElement("div");q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),q.appendChild(y),q.appendChild(S),document.body.appendChild(q),u.map(Y=>{if(Y.id){const le=document.createElement("div");le.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Ee=Y.thumbnail;try{const{width:ye}=Ee.getSize();ye>1920&&(Ee=Ee.resize({width:1920}))}catch(ye){throw ye&&ye.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ye}le.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Ee.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(ye){return"&#"+ye.charCodeAt(0)+";"})+"</span>",le.onclick=()=>{document.body.removeChild(q),m({sourceId:Y.id,audio:U})},P.appendChild(le)}})})}(i,r);return await sW(o,e,c)}async function oW(e){let r=["window","screen"];e!=="application"&&e!=="window"||(r=["window"]),e==="screen"&&(r=["screen"]);const i=E8();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new Le(X.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new lt((u,h)=>{i.desktopCapturer.getSources({types:r},(m,_)=>{m?h(m):u(_)})}));try{return await o}catch(u){throw new Le(X.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const HL=new Ms("safari");let aW=!1,cW=!1;async function zc(e,r){let i=0,o=null;for(;i<2;)try{o=await Bpe(e,r,i>0);break}catch(c){if(c instanceof Le)throw L.error("[".concat(r,"] ").concat(c.toString())),c;const u=VA(c.name||c.code||c,c.message);if(u.code===X.MEDIA_OPTION_INVALID){L.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await cs(500);continue}throw L.error("[".concat(r,"] ").concat(u.toString())),u}if(!o)throw new Le(X.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Bpe(e,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(X.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=Dn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return L.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(E8())e.screen.sourceId?Dv(c,await sW(e.screen.sourceId,e.screen,!!e.screenAudio)):Dv(c,await jpe(e.screen,!!e.screenAudio));else if(jp()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Le(X.NOT_SUPPORTED,"This browser does not support screen sharing");L.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=e.screen.extensionId,m=r,new lt((k,z)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},U=>{if(!U||!U.streamId)return L.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),U),void z(new Le(X.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));k(U.streamId)})}catch(U){L.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),U.toString()),z(new Le(X.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=P,Dv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&X8(e.screen.mediaSource);const P={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:k,surfaceSwitching:z,systemAudio:U,preferCurrentTab:F}=e.screen,q={selfBrowserSurface:k,surfaceSwitching:z,systemAudio:U,preferCurrentTab:F};!k&&delete q.selfBrowserSurface,!z&&delete q.surfaceSwitching,!U&&delete q.systemAudio,!F&&delete q.preferCurrentTab,L.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:e.screenAudio,controls:q})),Dv(c,await navigator.mediaDevices.getDisplayMedia(Ar({video:P,audio:e.screenAudio},q)))}else{if(!Mr())throw L.error("[".concat(r,"] This browser does not support screenSharing")),new Le(X.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&X8(e.screen.mediaSource);const P={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};L.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),Dv(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},y=re("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),_=bL(_,y)}catch{}L.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(_)),Cn();let S,R=null;(Rs()||Ro()||wA())&&(R=await HL.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(P){throw R&&R(),P}return _.audio&&(aW=!0),_.video&&(cW=!0),Dv(c,S),R&&R(),c}function VA(e,r){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(X.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(X.DEVICE_NOT_FOUND,"".concat(e,": ").concat(r));case"NotSupportedError":return new Le(X.NOT_SUPPORTED,"".concat(e,": ").concat(r));case"NotReadableError":return new Le(X.NOT_READABLE,"".concat(e,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(X.PERMISSION_DENIED,"".concat(e,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(X.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(r));default:return L.error("getUserMedia unexpected error",e),new Le(X.UNEXPECTED_ERROR,"".concat(e,": ").concat(r))}}function Dv(e,r){const i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(i&&e.removeTrack(i),e.addTrack(c))}const Gc=new class extends kr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(O_.STATE_CHANGE,e),this._state=e)}constructor(){super(),Pe(this,"_state",ET.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(re("ENUMERATE_DEVICES_INTERVAL")||(RA()||TA()===ji.HARMONY_OS)&&Bp())&&this.updateDevicesInfo()},re("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>L.error(e.toString()))}async enumerateDevices(e,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(X.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,_=null,y=null;if(!i&&(u||h)){if(HL.isLocked&&(L.debug("[device manager] wait GUM lock"),(await HL.lock())(),L.debug("[device manager] GUM unlock")),aW&&(u=!1,this.isAccessMicrophonePermission=!0),cW&&(h=!1,this.isAccessCameraPermission=!0),L.debug("[device manager] check media device permissions",e,r,u,h),u&&h){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=VA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;L.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const R=VA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;L.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const R=VA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;L.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}L.debug("[device manager] mic permission",e,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,_=null,y=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,_=null,y=null,new Le(X.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(e){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(r=i.device.deviceId)}),r}async getDeviceById(e){const r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!r)throw new Le(X.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=ET.INITING;try{await this.updateDevicesInfo(),this.state=ET.INITEND}catch(e){throw L.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=ET.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(X.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?L.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):L.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):L.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",i.push(c))}),this.state!==ET.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(O_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(O_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(O_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const r=e.filter(c=>c.kind==="audioinput"),i=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){o.video=!0;break}return o}};let $L=!1;const Hc=new class extends kr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function lW(){if(Cn(),!$L){const e=r=>{r.preventDefault(),$L=!1,lT()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};$L=!0,lT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),L.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Hc.onAutoplayFailed?Hc.onAutoplayFailed():Hc.onAudioAutoplayFailed?L.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):L.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Hc.emit("autoplay-failed")}}function uW(e,r,i,o){if(!e)return;const c=Rt.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),m=Ar(Ar({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Hc.onAutoplayFailed||Hc.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:o,extend:void 0});Rt.send({type:Ir.AUTOPLAY_FAILED,data:m},!0)}const Wpe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Qo=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,o]=r;const c=this.elementStateMap.get(i),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(L.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if(Zn.curState==="running")return yv()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,i]=e;const o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(L.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),Zn.on(us.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Zn.on(us.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Zn.on(us.STATE_CHANGE,()=>{Ro()&&Zn.prevState==="suspended"&&Zn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,r){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,r),i)try{await i.setSinkId(r)}catch(o){throw new Le(X.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,r,i,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,ao.INIT),this.setVolume(r,i);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{L.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){L.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&uW(o,"audio",m.message,r),L.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(L.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),IA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),lW()}))})}updateTrack(e,r){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([r]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,r){const i=this.elementMap.get(e);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}stop(e){const r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!r)return;const i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,r){Wpe.forEach(i=>{r.addEventListener(i,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(L.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=r==null?void 0:r.error;h&&L.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{L.debug("Auto resume audio element success")}).catch(i=>{L.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new lt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{lT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function ei(){return function(e,r,i){const o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new Le(X.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",L);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof lt?new lt((_,y)=>{m.then(_).catch(y)}):m}),i}}class dW extends kr{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(X.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(X.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Co.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Co.ON_TRACK,void 0)}}class hW extends kr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=i}async getConstraints(){return await Is(this,Bc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,i){var o;return L.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),ar(this,Bc.REQUEST_UPDATE_CONSTRAINTS,Array.from(xc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return L.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),ar(this,Bc.REQUEST_UPDATE_CONSTRAINTS,Array.from(xc(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){L.error(new Le(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof lt&&(o=await o),r.push(Ar(Ar({},o),{},{direction:this.direction}))}catch(o){L.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class pW extends kr{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(X.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(X.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Co.ON_TRACK,void 0),this.emit(Co.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Co.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Co.ON_NODE,this.inputNode))}}class fW extends kr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,o){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=o}async getConstraints(){return Is(this,Bc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,i){var o;return L.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),ar(this,Bc.REQUEST_UPDATE_CONSTRAINTS,Array.from(xc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),ar(this,Bc.REQUEST_UPDATE_CONSTRAINTS,Array.from(xc(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){L.error(new Le(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof lt&&(o=await o),r.push(Ar(Ar({},o),{},{direction:this.direction}))}catch(o){L.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class KL extends kr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new zpe}setVolume(){}createOutputTrack(){throw new Le(X.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class zpe{disconnect(){}connect(){}}function mW(e){return new lt((r,i)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=Ro()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Mr()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(AA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function FA(e){const r={};e.facingMode&&(r.facingMode=e.facingMode),e.cameraId&&(r.deviceId={exact:e.cameraId});const i=ph(e.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!p8()&&i.frameRate&&(r.frameRate=i.frameRate),s8()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Mr()&&(r.frameRate={ideal:30,max:30}),r}function gW(e){const r={};return p8()||(e.AGC!==void 0&&(r.autoGainControl=e.AGC),e.AEC!==void 0&&(r.echoCancellation=e.AEC),e.ANS!==void 0&&(r.noiseSuppression=e.ANS,jp()&&e.ANS&&(r.googHighpassFilter=e.ANS))),r}function _W(e){const r=gW(e);if(e.encoderConfig){const i=MA(e.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return e.microphoneId&&(r.deviceId={exact:e.microphoneId}),RA()&&(r.sampleRate=void 0),r}const Gpe=e=>{const r=e._encoderConfig;if(!r)return;const{frameRate:i,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=o,height:m=c}=r;if(!u||!h||!m)return;h=TL(h),m=TL(m),u=TL(u);const{max:_,min:y}=function(k,z,U){const F=200*Math.pow(U/15,.6)*Math.pow(k*z/640/360,.75);return{min:Math.floor(F),max:Math.floor(4*F)}}(h,m,u),{bitrateMax:S,bitrateMin:R}=r||{};S||L.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:P}=re("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:S||_,bitrateMin:R||y,scaleResolutionDownBy:1,scale:0}},EW=async(e,r,i)=>await(async(o,c,u)=>{const h=function(y){const S=[];for(let R=0;R<y.length;R+=2)S.push(parseInt(y.slice(R,R+2),16));return Uint8Array.from(S)}(P8(""+c+u)).slice(0,16),m=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,o))})(e.buffer,r,i),qL=e=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new lt((i,o)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await yW(c);i({buffer:u,width:r.width,height:r.height})}else o(new Le(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},yW=async e=>{const r=await e.arrayBuffer();return new Uint8Array(r)};var vW,SW,bW,TW,wW,RW,CW,IW,AW,PW,OW,kW,NW,DW,LW,xW,MW,UW,Nr,VW,FW,jW,BW,WW,zW,mh,GW,HW,$W,KW,qW,YW,XW,JW,QW,ZW,ez,tz,nz,Ps;let zr=(vW=Ut({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),SW=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),bW=ei(),TW=bv("LocalAudioTrack","_enabledMutex"),wW=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),RW=ei(),CW=bv("LocalAudioTrack","_enabledMutex"),IW=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),AW=ei(),PW=ei(),OW=ei(),kW=Ut({argsMap:e=>[e.getTrackId()]}),NW=ei(),DW=Ut({argsMap:e=>[e.getTrackId()]}),LW=ei(),xW=Ut({argsMap:e=>[e.getTrackId()]}),MW=Ut({argsMap:(e,r)=>[e.getTrackId(),r.name]}),UW=Ut({argsMap:e=>[e.getTrackId()]}),An((Nr=class extends kv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Qo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,r,i,o){super(e,i),Pe(this,"trackMediaType",Ov.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new KL,re("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),re("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Rs()&&!Wc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){nr(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Qo.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void L.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,ar(this,_t.NEED_REPLACE_TRACK,this).then(()=>{L.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{L.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!q8())throw new Le(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qo.setSinkID(this.getTrackId(),e)}async setEnabled(e,r,i){return this._setEnabled(e,r,i)}async _setEnabled(e,r,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await ar(this,_t.NEED_ENABLE_TRACK,this),L.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),L.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await ar(this,_t.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,L.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await ar(this,_t.NEED_MUTE_TRACK,this):await ar(this,_t.NEED_UNMUTE_TRACK,this))}getStats(){return Cm(()=>{L.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Uc(this,_t.GET_STATS)||Ar({},jL)}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(jc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(jc.ON_AUDIO_BUFFER),this._source.on(jc.ON_AUDIO_BUFFER,i=>e(i))}play(){L.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(L.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Qo.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){L.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Qo.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];L.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,r){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ar(this,_t.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return lt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Le(X.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(e){e.on(Co.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await ar(this,_t.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ar(this,_t.NEED_REPLACE_TRACK,this))}),e.on(Co.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Co.ON_TRACK),e.removeAllListeners(Co.ON_NODE)}bindProcessorContextEvents(e){e.on(Bc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Bc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof KL&&(this._trackSource=new iW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new fW(this._source.context,this.getTrackId(),"local"),r=new pW(e);return this._processorContext=e,this._processorDestination=r,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(r),this._source.on(jc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Qo.stop(this.getTrackId()),this._source.play()),ar(this,_t.NEED_REPLACE_MIXING_TRACK,this).then(()=>{L.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{L.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:r}}}).prototype,"setVolume",[vW],Object.getOwnPropertyDescriptor(Nr.prototype,"setVolume"),Nr.prototype),An(Nr.prototype,"setPlaybackDevice",[SW,bW],Object.getOwnPropertyDescriptor(Nr.prototype,"setPlaybackDevice"),Nr.prototype),An(Nr.prototype,"setEnabled",[TW,wW,RW],Object.getOwnPropertyDescriptor(Nr.prototype,"setEnabled"),Nr.prototype),An(Nr.prototype,"setMuted",[CW,IW,AW],Object.getOwnPropertyDescriptor(Nr.prototype,"setMuted"),Nr.prototype),An(Nr.prototype,"getStats",[PW],Object.getOwnPropertyDescriptor(Nr.prototype,"getStats"),Nr.prototype),An(Nr.prototype,"setAudioFrameCallback",[OW],Object.getOwnPropertyDescriptor(Nr.prototype,"setAudioFrameCallback"),Nr.prototype),An(Nr.prototype,"play",[kW,NW],Object.getOwnPropertyDescriptor(Nr.prototype,"play"),Nr.prototype),An(Nr.prototype,"stop",[DW,LW],Object.getOwnPropertyDescriptor(Nr.prototype,"stop"),Nr.prototype),An(Nr.prototype,"close",[xW],Object.getOwnPropertyDescriptor(Nr.prototype,"close"),Nr.prototype),An(Nr.prototype,"pipe",[MW],Object.getOwnPropertyDescriptor(Nr.prototype,"pipe"),Nr.prototype),An(Nr.prototype,"unpipe",[UW],Object.getOwnPropertyDescriptor(Nr.prototype,"unpipe"),Nr.prototype),Nr),jA=(VW=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),FW=ei(),jW=bv("MicrophoneAudioTrack","_enabledMutex"),BW=Ut({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),WW=ei(),zW=Ut({argsMap:e=>[e.getTrackId()]}),An((mh=class extends zr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,r,i,o){super(e,r.encoderConfig?MA(r.encoderConfig):{},o,re("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(yv()||mL())&&Zn.bindInterruptDetectorTrack(this)}async setDevice(e){if(L.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const r=await Gc.getDeviceById(e),i={};i.audio=Ar({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await zc(i,this.getTrackId())}catch(c){throw L.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await zc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Gc.getDeviceById(e);this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}L.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,r,i){if(r)return L.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),e),re("AUTO_RESET_AUDIO_ROUTE")&&(Ro()||cu())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await ar(this,_t.NEED_DISABLE_TRACK,this)}catch(h){throw L.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Ar({},this._constraints),u=Gc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await zc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await ar(this,_t.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),L.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}L.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(yv()||mL())&&Zn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Ro()||cu())&&this._enabled&&!this._isClosed&&Zn.duringInterruption){const e=async()=>{Zn.off(us.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Zn.on(us.IOS_INTERRUPTION_END,e)}else L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Av.TRACK_ENDED)}async renewMediaStreamTrack(e){const r=e||this._constraints,i=Gc.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await zc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Bc.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Bc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[VW,FW],Object.getOwnPropertyDescriptor(mh.prototype,"setDevice"),mh.prototype),An(mh.prototype,"setEnabled",[jW,BW,WW],Object.getOwnPropertyDescriptor(mh.prototype,"setEnabled"),mh.prototype),An(mh.prototype,"close",[zW],Object.getOwnPropertyDescriptor(mh.prototype,"close"),mh.prototype),mh),Hpe=(GW=Ut({argsMap:(e,r)=>[e.getTrackId(),r,e.duration]}),HW=ei(),$W=Ut({argsMap:e=>[e.getTrackId()]}),KW=ei(),qW=Ut({argsMap:e=>[e.getTrackId()]}),YW=ei(),XW=Ut({argsMap:e=>[e.getTrackId()]}),JW=ei(),QW=Ut({argsMap:e=>[e.getTrackId()]}),ZW=ei(),ez=Ut({argsMap:e=>[e.getTrackId()]}),tz=Ut({argsMap:e=>[e.getTrackId()]}),nz=ei(),An((Ps=class extends zr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,r,i,o){super(r.createOutputTrack(),i,o),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=r,this._bufferSource.on(jc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Av.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){nr(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[GW,HW],Object.getOwnPropertyDescriptor(Ps.prototype,"startProcessAudioBuffer"),Ps.prototype),An(Ps.prototype,"pauseProcessAudioBuffer",[$W,KW],Object.getOwnPropertyDescriptor(Ps.prototype,"pauseProcessAudioBuffer"),Ps.prototype),An(Ps.prototype,"seekAudioBuffer",[qW,YW],Object.getOwnPropertyDescriptor(Ps.prototype,"seekAudioBuffer"),Ps.prototype),An(Ps.prototype,"resumeProcessAudioBuffer",[XW,JW],Object.getOwnPropertyDescriptor(Ps.prototype,"resumeProcessAudioBuffer"),Ps.prototype),An(Ps.prototype,"stopProcessAudioBuffer",[QW,ZW],Object.getOwnPropertyDescriptor(Ps.prototype,"stopProcessAudioBuffer"),Ps.prototype),An(Ps.prototype,"close",[ez],Object.getOwnPropertyDescriptor(Ps.prototype,"close"),Ps.prototype),An(Ps.prototype,"setAudioBufferPlaybackSpeed",[tz,nz],Object.getOwnPropertyDescriptor(Ps.prototype,"setAudioBufferPlaybackSpeed"),Ps.prototype),Ps);class Ci extends zr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Nv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,cr(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(L.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):L.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){L.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}CA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof Ci?i.emit(P_.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}}class $pe extends rW{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(jc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):L.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const rz=new Map;class YL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(L.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var i;r!==this._videoState&&(this._videoState=r,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"renderStats",void 0),Pe(this,"_videoState",fh.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",ao.NONE),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return L.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Zn.curState==="running"&&(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(i8())),d8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=ao.PLAYING;break;case"loadeddata":if(this.videoState=fh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ao.CANPLAY;break;case"stalled":this.videoElementStatus=ao.STALLED;break;case"suspend":this.videoElementStatus=ao.SUSPEND;break;case"pause":this.videoElementStatus=ao.PAUSED,Ro()||cu()||Rs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ao.WAITING;break;case"abort":this.videoElementStatus=ao.ABORT;break;case"ended":this.videoElementStatus=ao.ENDED;break;case"emptied":this.videoElementStatus=ao.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=ao.ERROR,L.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,Gp.lastVisibleTime<Gp.lastHiddenTime||u<Gp.lastHiddenTime||u<Gp.lastVisibleTime)return;for(c>re("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(i8())),d8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),Zn.on(us.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Zn.on(us.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{r&&uW(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(L.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):L.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Cn();if((o.name==="Safari"&&Number(o.version)===15||yv())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");if(!i)return L.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);const o=i.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new lt((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const _=await yW(m);u({buffer:_,width:o.width,height:o.height})}else h(new Le(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,i<0?.1:i>1?1:i)})):await qL(r)}destroy(){this.renderStats=void 0,Zn.off(us.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Zn.off(us.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=fh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ao.INIT,!this.videoElementCheckInterval&&(iz.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=ao.DESTROYED)},1e3),re("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===fh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=fh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(y,S)=>{if(this.videoElementStatus===ao.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const k=S.presentationTime-u.presentationTime;this.videoState===fh.VideoStateStarting&&(this.videoState=fh.VideoStateDecoding),this.videoState===fh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION"))),k<re("VIDEO_FREEZE_DURATION")&&this.videoState===fh.VideoStateFrozen&&(this.videoState=fh.VideoStateDecoding),k>re("VIDEO_FREEZE_DURATION")&&Gp.lastVisibleTime>=Gp.lastHiddenTime&&u.timestamp>Gp.lastVisibleTime&&u.timestamp>Gp.lastHiddenTime&&(this.renderFreezeAccTime+=k)}u=Ar(Ar({},S),{},{timestamp:y})}var R,P;re("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,_))};(r=(i=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(i,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),RA()&&!re("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Cn();o.name==="Safari"&&Number(o.version)===15||yv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Mr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Mr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{L.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){iz.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ao.NONE}handleAutoPlayFailed(){const r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{L.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{L.error(o)}),this.autoplayFailed=!1,lT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};lT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),lW()}}const iz=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class sz extends YL{constructor(r){super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const i=r.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await qL(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",re("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var oz,az,cz,lz,uz,dz,hz,pz,fz,mz,gz,_z,Ez,yz,vz,Sz,bz,Tz,wz,Rz,Cz,Iz,Az,Pz,bn,Oz,kz,Nz,Dz,Lz,xz,Mz,Uz,$c;let Er=(oz=Ut({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),az=ei(),cz=Ut({argsMap:e=>[e.getTrackId()]}),lz=bv("LocalVideoTrack","_enabledMutex"),uz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),dz=ei(),hz=bv("LocalVideoTrack","_enabledMutex"),pz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),fz=ei(),mz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),gz=ei(),_z=ei(),Ez=Ut({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),yz=ei(),vz=ei(),Sz=ei(),bz=ei(),Tz=ei(),wz=ei(),Rz=ei(),Cz=Ut({argsMap:(e,r)=>[e.getTrackId(),r.name]}),Iz=Ut({argsMap:e=>[e.getTrackId()]}),Az=Ut({argsMap:e=>[e.getTrackId()]}),Pz=Ut({argsMap:(e,r,i)=>[e.getTrackId(),r.label,i]}),bn=class kse extends kv{get videoHeight(){if(Rs()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Rs()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ao.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,o,c,u,h){if(super(r,u),Pe(this,"trackMediaType",Ov.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),Rs()){const{width:m,height:_}=r.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(lr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(hL(Fn.CHROME,115)&&TA().indexOf("Windows")!==-1){const m=function(_,y){if("VideoFrame"in window&&"TransformStream"in window&&Dn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),R=new MediaStreamTrackGenerator({kind:"video"});let P,k,z=Date.now();const U=()=>{F&&(clearInterval(F),F=void 0),P&&(P.close(),P=void 0),_.stop(),k=void 0,R.removeEventListener("ended",U)};let F=window.setInterval(()=>{if(k&&P&&Date.now()-z>1e3)try{R.readyState==="live"?k.enqueue(P.clone()):U()}catch{U()}},1e3);const q=new TransformStream({transform:(Y,le)=>{R.readyState==="live"?(k=le,z=Date.now(),P===void 0?(P=Y,le.enqueue(Y.clone())):(le.enqueue(P),P=Y)):Y.close()}});return R.addEventListener("ended",U),S.readable.pipeThrough(q).pipeTo(R.writable),R}}(r);m&&(L.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}i&&this._hints.indexOf(lr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new hW(this.getTrackId(),"local"),this._processorDestination=new dW(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(L.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}L.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const o=Ar(Ar(Ar({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new YL(o):this._player=new sz(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Av.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,L.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await ar(this,_t.NEED_DISABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void L.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await ar(this,_t.NEED_ENABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}L.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,L.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await ar(this,_t.NEED_MUTE_TRACK,this):await ar(this,_t.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,i){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=ph(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=FA({encoderConfig:r});(Rs()||Ro()||cu())&&(o.deviceId=void 0),L.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Le(X.UNEXPECTED_ERROR,c.toString());throw L.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(lr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ar(this,_t.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(L)}}getStats(){return Cm(()=>{L.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Uc(this,_t.GET_STATS)||Ar({},BL)}async setBeautyEffect(r){L.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await qL(r)}async setBitrateLimit(r){L.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void L.error(X.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=r,await ar(this,_t.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,L.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}L.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return L.error(X.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,L.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){mW(this._originMediaStreamTrack).then(r=>{let[i,o]=r;this._videoHeight=o,this._videoWidth=i}).catch(AA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");L.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=ph(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(lr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ar(this,_t.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(L)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!i||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(_,y,S,R,P){const k=re("BITRATE_ADAPTER_TYPE");if(k==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var z;const F=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*y/640/360,.75));P=k==="STANDARD_BITRATE"?4*F:2*F,R=(z=R)!==null&&z!==void 0?z:F}else{var U;R=(U=R)!==null&&U!==void 0?U:Math.floor(P/10)}return{min:R,max:P}}(r,i,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,L.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,i;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=g8.checkOneElementVisible(u),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const y=Rt.reportApiInvoke(null,{tag:Vr.TRACER,name:yi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new Le(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Ar(Ar({},o),ph(r))),o=R_(o);const c=cr(8,"track-video-cloned-"),u=new kse(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,R_(this._scalabilityMode),this._optimizationMode,c,R_(this._hints));return r&&o&&u.setEncoderConfiguration(o),L.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new Le(X.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(X.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Cm(()=>{Rt.reportApiInvoke(null,{name:yi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Vr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!re("ENABLE_VIDEO_SEI")||!re("ENABLE_ENCODED_TRANSFORM"))return void L.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(X.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void L.warning("Video track is not published, SEI can not be send");const o=i.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):L.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Co.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await ar(this,_t.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ar(this,_t.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Co.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Bc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Bc.REQUEST_CONSTRAINTS)}},An(bn.prototype,"play",[oz,az],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),An(bn.prototype,"stop",[cz],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),An(bn.prototype,"setEnabled",[lz,uz,dz],Object.getOwnPropertyDescriptor(bn.prototype,"setEnabled"),bn.prototype),An(bn.prototype,"setMuted",[hz,pz,fz],Object.getOwnPropertyDescriptor(bn.prototype,"setMuted"),bn.prototype),An(bn.prototype,"setEncoderConfiguration",[mz,gz],Object.getOwnPropertyDescriptor(bn.prototype,"setEncoderConfiguration"),bn.prototype),An(bn.prototype,"getStats",[_z],Object.getOwnPropertyDescriptor(bn.prototype,"getStats"),bn.prototype),An(bn.prototype,"setBeautyEffect",[Ez,yz],Object.getOwnPropertyDescriptor(bn.prototype,"setBeautyEffect"),bn.prototype),An(bn.prototype,"getCurrentFrameData",[vz],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameData"),bn.prototype),An(bn.prototype,"getCurrentFrameImage",[Sz],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameImage"),bn.prototype),An(bn.prototype,"setBitrateLimit",[bz],Object.getOwnPropertyDescriptor(bn.prototype,"setBitrateLimit"),bn.prototype),An(bn.prototype,"setOptimizationMode",[Tz],Object.getOwnPropertyDescriptor(bn.prototype,"setOptimizationMode"),bn.prototype),An(bn.prototype,"setScalabiltyMode",[wz],Object.getOwnPropertyDescriptor(bn.prototype,"setScalabiltyMode"),bn.prototype),An(bn.prototype,"updateMediaStreamTrackResolution",[Rz],Object.getOwnPropertyDescriptor(bn.prototype,"updateMediaStreamTrackResolution"),bn.prototype),An(bn.prototype,"pipe",[Cz],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),An(bn.prototype,"unpipe",[Iz],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),An(bn.prototype,"close",[Az],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),An(bn.prototype,"replaceTrack",[Pz],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),bn),XL=(Oz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),kz=ei(),Nz=bv("CameraVideoTrack","_enabledMutex"),Dz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),Lz=ei(),xz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),Mz=ei(),Uz=Ut({argsMap:e=>[e.getTrackId()]}),$c=class Nse extends Er{get __className__(){return"CameraVideoTrack"}constructor(r,i,o,c,u,h){super(r,ph(i.encoderConfig),c,u,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(yv()||mL())&&!function(){const m=Cn();if(m.os!==ji.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&h8()&&this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=ph(this._config.encoderConfig),Zn.on(us.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Zn.on(us.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(L.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await Gc.getDeviceById(r),o={};o.video=Ar({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await zc(o,this.getTrackId())}catch(u){throw L.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await zc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Gc.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}L.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){L.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const i={video:Ar(Ar({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await zc(i,this.getTrackId())}catch(c){throw L.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await zc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Ar({},i.video),L.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await zc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await ar(this,_t.NEED_ENABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),L.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await ar(this,_t.NEED_DISABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}L.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=ph(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=Fr(this._config);o.encoderConfig=r;const c=FA(o);(Rs()||Ro()||cu())&&(c.deviceId=void 0),L.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Le(X.UNEXPECTED_ERROR,u.toString());throw L.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(lr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ar(this,_t.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(L)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ro()||cu())&&this._enabled&&!this._isClosed&&Zn.duringInterruption){const r=async()=>{Zn.off(us.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Zn.on(us.IOS_INTERRUPTION_END,r)}else L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Av.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,o=Gc.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){const c=await zc({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Zn.off(us.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Zn.off(us.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Ar(Ar({},o),ph(r))),o=R_(o);const c=cr(8,"track-cam-cloned-"),u=new Nse(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,R_(Ar(Ar({},this._config),{},{encoderConfig:o})),R_(this._constraints),R_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&u.setEncoderConfiguration(o),L.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(Bc.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}}),this.processorContext.on(Bc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},An($c.prototype,"setDevice",[Oz,kz],Object.getOwnPropertyDescriptor($c.prototype,"setDevice"),$c.prototype),An($c.prototype,"setEnabled",[Nz,Dz,Lz],Object.getOwnPropertyDescriptor($c.prototype,"setEnabled"),$c.prototype),An($c.prototype,"setEncoderConfiguration",[xz,Mz],Object.getOwnPropertyDescriptor($c.prototype,"setEncoderConfiguration"),$c.prototype),An($c.prototype,"close",[Uz],Object.getOwnPropertyDescriptor($c.prototype,"close"),$c.prototype),$c);function JL(e,r,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=Ar(Ar({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?L.debug("[".concat(e,"] set content hint to"),i.optimizationMode):L.debug("[".concat(e,"] set content hint failed")))):L.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Vz,Fz,jz,Bz,bl,Wz,zz,Gz,Hz,$z,Kz,co;class qz extends eW{getUserId(){return this._userId}constructor(r,i,o,c){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(cr(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,L.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Lv=(Vz=Ut({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),Fz=Ut({argsMap:e=>[e.getTrackId()]}),jz=Ut({argsMap:(e,r)=>[e.getTrackId(),r.name]}),Bz=Ut({argsMap:e=>[e.getTrackId()]}),An((bl=class extends qz{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ao.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,r,i,o){super(e,r,i,o),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",Ov.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new hW(this.getTrackId(),"remote"),this.processorDestination=new dW(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Cm(()=>{L.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Uc(this,_t.GET_STATS)||Ar({},Q8)}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(L.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}L.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const i=Ar(Ar({fit:"cover"},r),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new YL(i):this._player=new sz(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Pv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(Pv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Pv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,L.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){mW(this._originMediaStreamTrack).then(e=>{let[r,i]=e;this._videoHeight=i,this._videoWidth=r}).catch(AA)}_updatePlayerSource(){L.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,r;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=g8.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=Rt.reportApiInvoke(null,{tag:Vr.TRACER,name:yi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new Le(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Co.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Co.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(P_.SEI_RECEIVED,e)}}).prototype,"play",[Vz],Object.getOwnPropertyDescriptor(bl.prototype,"play"),bl.prototype),An(bl.prototype,"stop",[Fz],Object.getOwnPropertyDescriptor(bl.prototype,"stop"),bl.prototype),An(bl.prototype,"pipe",[jz],Object.getOwnPropertyDescriptor(bl.prototype,"pipe"),bl.prototype),An(bl.prototype,"unpipe",[Bz],Object.getOwnPropertyDescriptor(bl.prototype,"unpipe"),bl.prototype),bl),xv=(Wz=Ut({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),zz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),Gz=Ut({argsMap:e=>[e.getTrackId()]}),Hz=Ut({argsMap:e=>[e.getTrackId()]}),$z=Ut({argsMap:(e,r)=>[e.getTrackId(),r.name]}),Kz=Ut({argsMap:e=>[e.getTrackId()]}),An((co=class extends qz{get isPlaying(){return this._useAudioElement?Qo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,r,i,o){super(e,r,i,o),Pe(this,"trackMediaType",Ov.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),re("DISABLE_WEBAUDIO")?(this._source=new KL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new iW(e,!0),re("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(jc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Pv.FIRST_FRAME_DECODED)}),this.processorContext=new fW(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new pW(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(jc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(jc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(jc.ON_AUDIO_BUFFER),this._source.on(jc.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?Qo.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!q8())throw new Le(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qo.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Cm(()=>{L.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Uc(this,_t.GET_STATS)||Ar({},J8)}play(){L.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(L.debug("[".concat(this.getTrackId(),"] use audio element to play")),Qo.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){L.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Qo.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];L.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Co.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Co.ON_NODE,e=>{this._source.processedNode=e;const r=!e;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Co.ON_TRACK),this.processorDestination.removeAllListeners(Co.ON_NODE)}}).prototype,"setVolume",[Wz],Object.getOwnPropertyDescriptor(co.prototype,"setVolume"),co.prototype),An(co.prototype,"setPlaybackDevice",[zz],Object.getOwnPropertyDescriptor(co.prototype,"setPlaybackDevice"),co.prototype),An(co.prototype,"play",[Gz],Object.getOwnPropertyDescriptor(co.prototype,"play"),co.prototype),An(co.prototype,"stop",[Hz],Object.getOwnPropertyDescriptor(co.prototype,"stop"),co.prototype),An(co.prototype,"pipe",[$z],Object.getOwnPropertyDescriptor(co.prototype,"pipe"),co.prototype),An(co.prototype,"unpipe",[Kz],Object.getOwnPropertyDescriptor(co.prototype,"unpipe"),co.prototype),co);const Gp=new class extends kr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),L.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Yz extends kr{constructor(r,i){super(),Pe(this,"trackMediaType",Ov.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Pe(this,"_datachannelEventMap",new Map),this._config=r,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return re("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new lt((r,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;i(new Le(X.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Le(X.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new Le(X.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[UA.OPEN,UA.CLOSE,UA.ERROR].forEach(i=>{const o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),r.addEventListener(i,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,c]=i;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class Kpe extends Yz{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(re("SHOW_DATASTREAM2_LOG")&&L.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(UA.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class qpe extends Yz{send(r){if(this._originDataChannel){let i=r;i=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function BA(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>BI.revokeObjectURL(e),0),new Worker(BI.createObjectURL(e))}const Xz=71,QL=1,ZL=2,ex=1,Jz=2;var Hp=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Hp||{});function Qz(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==Xz)return;const o=e.getUint16(1),c=QL+ZL+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:i,tlvLen:o,tlv:[],frame:u};let m=QL+ZL;for(;m<c;){const _=e.getUint8(m),y=e.getUint16(m+ex),S=ex+Jz;if(_===Hp.AUDIO_LEVEL){let R=e.getUint8(m+S);for(let P=1;P<y;P++)R=R<<8|e.getUint8(m+S+P);h.tlv.push({tag:_,length:y,value:r?127^R>>1:127&R})}else if(_===Hp.METADATA||_===Hp.AUDIO_64_BIT_PTS){const R=new Uint8Array(y);for(let P=0;P<y;P++)R[P]=e.getUint8(m+S+P);h.tlv.push({tag:_,length:y,value:R})}m+=S+y}return h}const WA=new Map,zA=127,N_=1e-10,tx=139/13,GA=new Map;function nx(e,r,i){const o="".concat(e,"-").concat(r,"-").concat(i);let c=0;return GA.has(o)?c=GA.get(o):(c=Math.log(function(h,m){const _=h-m;m<_&&(m=_);let y=1;for(let S=h,R=1;S>m;S--,R++)y=y*S/R;return y}(r,e))+e*Math.log(.5)+(r-e)*Math.log(1-.5)-Math.log(i)+i*e,GA.set(o,c)),c<N_&&(c=N_),c}function Zz(e,r,i){const o=r.length,c=e.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let _=0;for(let y=m+c;m<y;m++)e[m]>i&&_++;r[h]!==_&&(r[h]=_,u=!0)}return u}window.cache=GA;let Ype=0;class eG{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",N_),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",N_),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",N_),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(Ype++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,i=this.levels,o=this.minLevel+tx;let c=!1;for(let u=0;u<r.length;++u){let h=i[u];h<o&&(h=0);const m=Math.floor(h/tx);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return Zz(this.mediums,this.longs,4)}computeMediums(){return Zz(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=nx(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=nx(this.longs[0],10,47),this.longSpeechActivityScore>N_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=nx(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(Zf(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let o=r;return r<0&&(o=0),r>zA&&(o=zA),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+tx?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>zA&&(i=zA),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Xpe{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?r=!0:setTimeout(this.execute.bind(this),i)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class rx{constructor(r,i,o){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=i,this.energyScore=o}}class Jpe extends kr{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,i!=null&&(this.energyExpireTimeMs=i),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(i=>i.id===r)}levelChanged(r,i){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(i,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(r){r.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(r){let i=this.speakers.get(r);return i||(i=new eG(r),this.speakers.set(r,i),this.maybeStartDecisionMaker()),i}updateLoudestList(r,i,o){const c=r.id===this.dominantId;if(i<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==r;)++_;return new rx(c,_,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new rx(c,0,r.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new rx(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Xpe(this),this.decisionMaker.execute())}makeDecision(r){let i=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=xc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const _=this.relativeSpeechActivities;let y=2;for(const S of this.speakers.entries()){const[R,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let F=0;F<_.length;++F){const q=m==null?N_:m.getSpeechActivityScore(F);_[F]=Math.log(P.getSpeechActivityScore(F)/q)}const k=_[0],z=_[1],U=_[2];k>3&&z>2&&U>0&&z>y&&(y=z,u=R)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===i||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),i=300-(r-this.lastLevelIdleTime);let o=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=i;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const i=[];for(const c of xc(o=this.speakers).call(o)){var o;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const Mv=new Map;let pd=null,HA=null;const tG=3;let D_=[];const fd=new Map,$A=new Map;class Qpe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,i){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=i,this.setActive(fd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:o}=function(){const c=[],u=[];return Array.from(xc(fd).call(fd)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(i){let o;return Array.from(xc(fd).call(fd)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(i){let o;return Array.from(xc(fd).call(fd)).forEach(c=>{c.active||c.id===i||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let KA;function nG(e){const r=fd.get(e);r&&(fd.delete(e),r.clearTimer())}const qA=new Map,Zpe=new Map;function efe(e,r,i){let o=new Uint8Array(e,r,i),c=[],u=0;for(;c.length<i;)u+3<i&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const YA=new Map,yT=new Map;(function(){const e=Cn();ls.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ls.getStreamFromExtension=e.name===Fn.CHROME&&Number(e.version)>34,ls.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),ls.supportMinBitrate=e.name===Fn.CHROME||e.name===Fn.EDGE,ls.supportSetRtpSenderParameters=function(){const r=Cn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Bp()||!(!Rs()&&!wA())||r.name===Fn.FIREFOX&&Number(r.version)>=64)}(),e.name===Fn.SAFARI&&(Number(e.version)>=14?ls.supportDualStream=!0:ls.supportDualStream=!1),ls.webAudioMediaStreamDest=function(){const r=Cn();return!(r.name===Fn.SAFARI&&Number(r.version)<12)}(),ls.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ls.supportWebGL=typeof WebGLRenderingContext<"u",ls.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Bp()||(ls.webAudioWithAEC=!0),ls.supportShareAudio=function(){const r=Cn();return(r.os===ji.WIN_10||r.os===ji.WIN_81||r.os===ji.WIN_7||r.os===ji.LINUX||r.os===ji.MAC_OS||r.os===ji.CHROMIUM_OS)&&r.name===Fn.CHROME&&Number(r.version)>=74}(),ls.supportDataChannel=!!(cT(76)||function(r){const i=Cn();return!(i.name!==Fn.FIREFOX||!i.osVersion)&&Number(i.version)>=r}(68)||a8(14)),ls.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Mr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),ls.supportWebRTCEncodedTransform=function(){const r=Cn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),ls.supportWebRTCInsertableStream=function(){const r=Cn();return(r.name===Fn.CHROME||r.name===Fn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ls.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ls.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,IA(()=>{ls.supportDualStreamEncoding=function(){const r=Cn();return!!re("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&re("CHROME_DUAL_STREAM_USE_ENCODING"))}(),L.debug("browser ua: ",navigator.userAgent),L.info("browser info: ",e),L.info("browser compatibility: ",ls)})})();const tfe=["CHINA","GLOBAL"],rG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],L_=[],Uv=[];function x_(e,r){return!!r&&L_.some(i=>i.uid===e&&i.channelName===r)}function ix(){return Uv.length>0}var nfe=RB.forEach,iG=mp("forEach")?[].forEach:function(e){return nfe(this,e,arguments.length>1?arguments[1]:void 0)};Vn({target:"Array",proto:!0,forced:[].forEach!=iG},{forEach:iG});var rfe=Za("Array").forEach,ife=wc,sfe=gi,ofe=N,afe=rfe,sx=Array.prototype,cfe={DOMTokenList:!0,NodeList:!0},lfe=function(e){var r=e.forEach;return e===sx||ofe(sx,e)&&r===sx.forEach||sfe(cfe,ife(e))?afe:r},ufe=l(lfe),dfe=Lo,sG=Ic;Vn({target:"Object",stat:!0,forced:d(function(){sG(1)})},{keys:function(e){return sG(dfe(e))}});var oG=l(Et.Object.keys),hfe=l(KE),pfe=l(YE),ffe=Vn,aG=Fg,mfe=c_,gfe=ot,cG=me,_fe=ai,Efe=Re,yfe=PI,vfe=fr,Sfe=Ss,bfe=mB("slice"),Tfe=vfe("species"),ox=Array,wfe=Math.max;ffe({target:"Array",proto:!0,forced:!bfe},{slice:function(e,r){var i,o,c,u=Efe(this),h=_fe(u),m=cG(e,h),_=cG(r===void 0?h:r,h);if(aG(u)&&(i=u.constructor,(mfe(i)&&(i===ox||aG(i.prototype))||gfe(i)&&(i=i[Tfe])===null)&&(i=void 0),i===ox||i===void 0))return Sfe(u,m,_);for(o=new(i===void 0?ox:i)(wfe(_-m,0)),c=0;m<_;m++,c++)m in u&&yfe(o,c,u[m]);return o.length=c,o}});var Rfe=Za("Array").slice,Cfe=N,Ife=Rfe,ax=Array.prototype,Afe=function(e){var r=e.slice;return e===ax||Cfe(ax,e)&&r===ax.slice?Ife:r},Pfe=l(Afe);function vt(e,r,i,o,c){var u,h,m,_={};return ufe(u=oG(o)).call(u,function(y){_[y]=o[y]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=hfe(h=pfe(m=Pfe(i).call(i)).call(m)).call(h,function(y,S){return S(e,r,y)||y},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(dB(e,r,_),_=null),_}let XA=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),cx=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),du=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Io=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Lt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),hr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Wt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),jt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),vT=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),_n=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Ao=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Xt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function JA(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw L.error("Invalid Channel Name ".concat(e)),new Oe(X.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function QA(e){if(r=e,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||m8(e,1,255)))throw new Oe(X.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof e=="string"&&L.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let $p=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Ofe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},lx={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function ux(e,r){as(e.url,"".concat(r,".url"),1,1e3,!1),Ur(e.x)||nr(e.x,"".concat(r,".x"),0,1e4),Ur(e.y)||nr(e.y,"".concat(r,".y"),0,1e4),Ur(e.width)||nr(e.width,"".concat(r,".width"),0,1e4),Ur(e.height)||nr(e.height,"".concat(r,".height"),0,1e4),Ur(e.zOrder)||nr(e.zOrder,"".concat(r,".zOrder"),0,255),Ur(e.alpha)||nr(e.alpha,"".concat(r,".alpha"),0,1,!1)}const kfe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Pm=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),dx=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Ii=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function lG(e){if(!e.channelName)throw new Oe(X.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Oe(X.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&as(e.token,"info.token",1,2047),QA(e.uid),JA(e.channelName),!0}let Po=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Kp=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Da=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Vv=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),$n=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Zi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),ZA=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Wi=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),jn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const uG=[jn.AFRICA,jn.ASIA,jn.CHINA,jn.EUROPE,jn.GLOBAL,jn.INDIA,jn.JAPAN,jn.NORTH_AMERICA,jn.OCEANIA,jn.OVERSEA,jn.SOUTH_AMERICA];let Us=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const eP={CHINA:{},ASIA:{CODE:Us.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Us.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Us.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Us.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Us.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Us.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Us.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Us.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Us.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Us.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Us.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Us.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Us.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};NL&&(eP.CHINA={CODE:Us.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let ST=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function dG(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class hG extends kr{constructor(r,i){super(),K(this,"onICEConnectionStateChange",void 0),K(this,"onConnectionStateChange",void 0),K(this,"onDTLSTransportStateChange",void 0),K(this,"onDTLSTransportError",void 0),K(this,"onICETransportStateChange",void 0),K(this,"onFirstAudioReceived",void 0),K(this,"onFirstVideoReceived",void 0),K(this,"onFirstAudioDecoded",void 0),K(this,"onFirstVideoDecoded",void 0),K(this,"onFirstVideoDecodedTimeout",void 0),K(this,"onSelectedLocalCandidateChanged",void 0),K(this,"onSelectedRemoteCandidateChanged",void 0),K(this,"onICECandidateError",void 0),K(this,"getLocalVideoStats",void 0)}}class pG extends hG{constructor(r,i){super(r,i),K(this,"establishPromise",void 0)}}let gt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Vs=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),qp=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const fG=["disconnected","failed"];let $e=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Hn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),kt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),hu=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),pu=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),es=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),mG=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),gh=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Tl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),md=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Fv=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ti=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),jv=function(e){return e.ABORT="abort",e}({}),Om=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Nfe=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Dfe={[XA.ACCESS_POINT]:{[Io.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Io.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Io.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Io.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Io.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Io.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Io.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[XA.UNILBS]:{[du.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[du.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[du.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[du.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[du.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[du.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[du.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[du.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[du.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[du.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[du.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[du.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[XA.STRING_UID_ALLOCATOR]:{[cx.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[cx.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[cx.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Bv(e){const r=Dfe[Math.floor(e/1e4)];if(!r)return{desc:"unknown error",retry:!1};const i=r[e%1e4];if(!i){if(Math.floor(e/1e4)===XA.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const Lfe={[Lt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Lt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Lt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Lt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Lt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Lt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Lt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Lt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Lt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Lt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Lt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Lt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Lt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Lt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Lt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Lt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Lt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Lt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Lt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Lt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Lt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Lt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Lt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Lt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Lt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Lt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Lt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Lt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Lt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Lt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Lt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Lt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Lt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Lt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Lt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Lt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Lt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Lt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Lt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Lt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Lt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Lt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Lt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Lt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Lt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Lt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Lt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Lt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Lt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Lt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Lt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Lt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Lt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Lt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Lt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Lt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Lt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Lt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Lt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Lt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function bT(e){return Lfe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function gG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function hx(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?gG(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):gG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function _G(e,r){if(typeof e=="string")return e;const{proxy:i,host:o,port:c}=e;if(r){const u=re("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const xfe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Mfe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Ufe=/wss:\/\/(.+):([0-9]+)\/?/,Vfe=/wss:\/\/(.[^\/]+)\/?/;let Ffe=0;class jfe{constructor(r,i){K(this,"id",0),K(this,"store",void 0),K(this,"recordIndex",void 0),K(this,"websockets",[]),K(this,"try443PortDuration",2e3),K(this,"forceCloseWSDuration",5e3),K(this,"try443PortTimeout",null),K(this,"forceCloseTimeout",null),K(this,"isTry443PortFailed",!1),K(this,"isNormalPortFailed",!1),K(this,"useDoubleDomain",!1),K(this,"useProxy",!1),K(this,"startTime",Date.now()),this.id=++Ffe,this.try443PortDuration=re("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const i=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];L.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(r,i,o){this.logger("createWebSocket:",r,{isTry443Port:i,hasTimeoutDetection:o});const c=re("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var k;return st(k=r.host).call(k,P)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(P=>{_.push(_G(hx(hx({},r),{},{host:r.host.replace(m,P)}),i))});else{const P=hx({},r);if(i&&m){const k=c.find(z=>z!==m);k&&(P.host=P.host.replace(m,k))}_.push(_G(P,i))}try{_.forEach(P=>{const k=new WebSocket(P);k.binaryType="arraybuffer",h.push(k),this.logger("ws is connecting:",k.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(k=>k.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,i,o);if(!i&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new Oe(X.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const y=aT();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(k=>{k!==P&&(k.onopen=null,k.onclose=null,k.onmessage=null,k.close(),this.logger("close backup websocket: ".concat(k.url)))}),this.websockets.length=0,y.resolve(P)},P.onclose=k=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const z=h.every(U=>U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(z)),z&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(k.reason)),y.reject({code:k.code,reason:ZA.A_ROUND_WS_FAILED})):!i&&z&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),i?this.isTry443PortFailed=z:this.isNormalPortFailed=z},P.onmessage=k=>this.logger("".concat(P.url," onmessage: ").concat(k.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(y.isResolved)return S();Cn().os===ji.MAC_OS&&Mr()&&S(),this.createWebSocket(r,!0,!0).then(P=>{y.resolve(P)}).catch(P=>{this.isNormalPortFailed&&y.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),y.promise}chooseBestWebsocket(r,i,o,c){return this.useDoubleDomain=!!i,typeof r=="string"&&(r=function(u){let h,m,_;return[,h,m,_]=u.match(xfe)||[],h||([,m,_]=u.match(Mfe)||[]),m&&_||([,m,_]=u.match(Ufe)||[]),m&&_||([,m]=u.match(Vfe)||[]),m||L.warning("un-destructible url: ",u),{proxy:h,host:m,port:_||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(L.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function EG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class yG extends kr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;st(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(Xt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Xt.CONNECTED):this._state==="closed"?this.emit(Xt.CLOSED):this._state==="failed"&&this.emit(Xt.FAILED))}resetReconnectCount(r){L.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),K(this,"connectionID",0),K(this,"currentURLIndex",0),K(this,"urls",[]),K(this,"_reconnectMode","tryNext"),K(this,"reconnectReason",void 0),K(this,"_initMutex",void 0),K(this,"name",void 0),K(this,"_state","closed"),K(this,"reconnectInterrupter",void 0),K(this,"websocket",void 0),K(this,"retryConfig",void 0),K(this,"reconnectCount",0),K(this,"forceCloseTimeout",5e3),K(this,"onlineReconnectListener",void 0),K(this,"useCompress",void 0),K(this,"tryDoubleDomain",!1),K(this,"use443PortOnly",!1),K(this,"wsInflateLength",0),K(this,"wsDeflateLength",0),K(this,"closeEstablishingWs",()=>{}),K(this,"store",void 0),K(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var k=arguments[P]!=null?arguments[P]:{};P%2?EG(Object(k),!0).forEach(function(z){K(R,z,k[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(k)):EG(Object(k)).forEach(function(z){Object.defineProperty(R,z,Object.getOwnPropertyDescriptor(k,z))})}return R}({},i),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Ms("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:_}=i,y=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*_)/10);ac.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S),li.on(vv.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===ac.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=r,this.state="connecting";try{const c=aT(),u=this.urls[this.currentURLIndex];re("ENABLE_PREALLOC_PC")&&this.emit(mG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Xt.CLOSED,()=>{c.reject(new Le(X.WS_DISCONNECT))}),this.once(Xt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void L.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),L.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(X.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new Le(X.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var i;const o=aT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),L.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var R;if(L.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Le(X.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=Uc(this,Xt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,k=await this.reconnectWithAction(P);if(this.state==="closed")return void L.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!k)return o.reject(new Le(X.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(Xt.ON_MESSAGE,S)},m=S=>{L.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),re("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=re("GATEWAY_WSS_ADDRESS")),L.debug("[".concat(this.name,"] start connect, url:"),r);const _=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const R=this.state==="closed",P=S instanceof Le,k=P&&S.code===X.WS_ABORT,z=P&&S.code===X.WS_ERR,U=P?S.message:S&&(S.reason||S.toString());L.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(U)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:k?"aborted":"error",errors:[S]},_),R||z?(o.reject(R?new Le(X.WS_DISCONNECT,"websocket is closed: ".concat(U)):new Le(X.WS_ERR,"init websocket failed: ".concat(U))),z&&L.error("[".concat(this.name,"] init websocket failed: ").concat(U))):u&&u(S)}return o.promise}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;L.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||li.isOnline||!li.onlineWaiter||(this.onlineReconnectListener=li.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){const h=wL(this.reconnectCount,this.retryConfig);L.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await lt.race([cs(h),this.onlineReconnectListener||new lt(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Xt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);L.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(L.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Is(this,Xt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;L.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&st(m).call(m,"dynamic key expired")?(this.emit(Xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,i)}return!0}}class px extends yG{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){const o=aT(),c=function(h,m){return new jfe(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{L.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Le(X.WS_ABORT,"choose best websocket aborted"))};const u=re("GATEWAY_DOMAINS");return L.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class TT extends yG{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){return new lt((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{L.debug("[choose-best-ws] close establishing websockets"),h.forEach(z=>{z.onclose=null,z.onopen=null,z.onmessage=null,z.close()}),c(new Le(X.WS_ABORT,"choose best websocket aborted"))};const m=re("GATEWAY_DOMAINS");let _;const y=r.indexOf("?h="),S=m.find(z=>y!==-1?st(r).call(r,z,y):st(r).call(r,z));L.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var P;const z=Date.now();try{m.forEach(U=>{const F=y===-1?r.replace(S,U):r.substr(0,y)+r.substr(y).replace(S,U),q=new WebSocket(F);q.binaryType="arraybuffer",h.push(q),L.debug("[choose-best-ws] ws is connecting:",q.url)})}catch{for(L.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(F=>F.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(U=>U.url),service:"gateway"},i),h.forEach(U=>{U.onopen=()=>{if(u)return;const F=Date.now()-z;L.debug("[choose-best-ws] ws open cost ".concat(F,"ms")),h.filter(q=>q!==U).forEach(q=>{L.debug("[choose-best-ws]close backup websocket: ".concat(q.url)),q.close()}),u=!0,o(U)},U.onclose=F=>{_=F,!u&&(h.find(q=>!(q.readyState===WebSocket.CLOSED||q.readyState===WebSocket.CLOSING))||(L.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},U.onmessage=F=>{L.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(F.data))}}),cs(this.forceCloseTimeout).then(()=>{h.forEach(U=>{U.readyState!==WebSocket.OPEN&&U.close()})})}if(R){var k;let z;L.debug("[choose-best-ws] use single url: ",r),(k=this.store)===null||k===void 0||k.recordJoinChannelService({urls:[r],service:"gateway"},i);try{z=new WebSocket(r),h.push(z),z.binaryType="arraybuffer"}catch(U){const F=new Le(X.WS_ERR,"init websocket failed! Error: ".concat(U.toString()));return L.error("[".concat(this.name,"]").concat(F)),void c(F)}z.onopen=()=>{o(z)},z.onclose=U=>{c(U)},z.onmessage=U=>{L.debug("[choose-best-ws]".concat(z.url," onmessage: ").concat(U.data))},cs(this.forceCloseTimeout).then(()=>{z&&z.readyState!==WebSocket.OPEN&&z.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Bfe extends kr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===hr.CONNECTED?this.emit(Wt.WS_CONNECTED):r===hr.RECONNECTING?this.emit(Wt.WS_RECONNECTING,this._websocketReconnectReason):r===hr.CLOSED&&this.emit(Wt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",hr.CLOSED),K(this,"reconnectToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new k8(5)),K(this,"pingpongTimer",void 0),K(this,"wsInflateDataTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Wt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Gn.UID_BANNED);break;case 15:this.close(Gn.IP_BANNED);break;case 16:this.close(Gn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Lt.ERR_LICENSE_MISSING:this.close(Gn.LICENSE_MISSING);break;case Lt.ERR_LICENSE_EXPIRED:this.close(Gn.LICENSE_EXPIRED);break;case Lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Gn.LICENSE_MINUTES_EXCEEDED);break;case Lt.ERR_LICENSE_PERIOD_INVALID:this.close(Gn.LICENSE_PERIOD_INVALID);break;case Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Gn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Lt.ERR_LICENSE_ILLEGAL:this.close(Gn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new px("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===hr.CONNECTED&&this.reconnect("retry",Cs.OFFLINE)})}async request(r,i,o,c){const u=cr(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,_=()=>new lt((z,U)=>{if(this.connectionState===hr.CONNECTED)return z();const F=()=>{this.off(Wt.WS_CLOSED,q),z()},q=()=>{this.off(Wt.WS_CONNECTED,F),U(new Oe(X.WS_ABORT))};this.once(Wt.WS_CONNECTED,F),this.once(Wt.WS_CLOSED,q),r!==jt.PUBLISH&&r!==jt.PUBLISH_DATASTREAM&&r!==jt.SUBSCRIBE&&r!==jt.SUBSCRIBE_DATASTREAM&&r!==jt.UNSUBSCRIBE&&r!==jt.UNSUBSCRIBE_DATASTREAM&&r!==jt.UNPUBLISH&&r!==jt.UNPUBLISH_DATASTREAM&&r!==jt.CONTROL&&r!==jt.RESTART_ICE||this.once(Wt.DISCONNECT_P2P,()=>{U(new Oe(X.DISCONNECT_P2P))}),r!==jt.PUBLISH&&r!==jt.RESTART_ICE||this.once(Wt.ABORT_P2P_EXECUTION,()=>{U(new Oe(X.DISCONNECT_P2P))})});if(this.connectionState!==hr.CONNECTING&&this.connectionState!==hr.RECONNECTING||r===jt.JOIN||r===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new lt((z,U)=>{let F=!1;const q=(le,Ee)=>{F=!0,z({isSuccess:le==="success",message:Ee||{}}),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.emit(Wt.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),q);const Y=()=>{U(new Oe(X.WS_ABORT,"type: ".concat(r))),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Wt.WS_CLOSED,Y),this.once(Wt.WS_RECONNECTING,Y),cs(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||F||(L.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Wt.REQUEST_TIMEOUT,r,i))})});let S=null;try{S=await y}catch(z){if(this.connectionState===hr.CLOSED||r===jt.LEAVE)throw new Oe(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?z.throw():r===jt.JOIN||r===jt.REJOIN?null:(await _(),await this.request(r,i))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=bT(R),k=new Oe(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(L.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Lt.ERR_TOO_MANY_BROADCASTERS?((r===jt.JOIN||r===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,L.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Cs.MULTI_IP)):this.reconnect(P.action,Cs.SERVER_ERROR),r===jt.JOIN||r===jt.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new lt(o=>{const c=u=>{(!i||i(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void L.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(vT.WRTC_STATS,i)}upload(r,i){const o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==hr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const o={_type:r,_message:i};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new lt((i,o)=>{this.once(Wt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Wt.WS_CLOSED,c=>o(this.initError||new Oe(X.WS_ABORT,c))),this.connectionState=hr.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Gn.LEAVE,this.connectionState=hr.CLOSED,L.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Wt.ABORT_P2P_EXECUTION);const r=await Is(this,Wt.REQUEST_JOIN_INFO),i=await this.request(jt.JOIN,r);if(!i)return this.emit(Wt.REPORT_JOIN_GATEWAY,ZA.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Wt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=hr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(X.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=pT(this,Wt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(jt.REJOIN,r);return!!i&&(this.connectionState=hr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(_n.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(_n.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(_n.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(_n.MUTE_AUDIO,{uid:o.uid}):this.emit(_n.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(_n.MUTE_VIDEO,{uid:o.uid}):this.emit(_n.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(_n.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(_n.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(_n.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(_n.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(_n.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleNotification(r){L.debug("[".concat(this.clientId,"] receive notification: "),r);const i=bT(r.code);if(r.code===28&&"detail"in r&&(L.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Wt.RECOVER_NOTIFICATION,r.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Gn.UID_BANNED),void this.close()):void this.reconnect(i.action,Cs.SERVER_ERROR);L.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(L.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Cs.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();r!==0&&i!==0&&this.upload(vT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Xt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Wt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Xt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Xt.CLOSED,()=>{this.connectionState=hr.CLOSED}),this.websocket.on(Xt.FAILED,()=>{this._disconnectedReason=Gn.NETWORK_ERROR,this.connectionState=hr.CLOSED}),this.websocket.on(Xt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===hr.CONNECTED?this.connectionState=hr.RECONNECTING:this.connectionState=hr.CONNECTING}),this.websocket.on(Xt.WILL_RECONNECT,(r,i,o)=>{const c=pT(this,Wt.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(L.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",i=ZA.P2P_DISCONNECTED),u&&(L.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Wt.REPORT_JOIN_GATEWAY,i||ZA.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Wt.DISCONNECT_P2P)),o(r)}),this.websocket.on(Xt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{L.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Cs.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Wt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===X.UNEXPECTED_RESPONSE&&r.data.code===Lt.ERR_NO_AUTHORIZED)return this.initError=new Oe(X.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Gn.TOKEN_EXPIRE);L.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Cs.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Xt.REQUEST_NEW_URLS,(r,i)=>{Is(this,Wt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(mG.PRE_CONNECT_PC,()=>{this.emit(Wt.PRE_CONNECT_PC)})}}let Wfe=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),ui=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function vG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function tP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?vG(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):vG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function km(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(re("TURN_DOMAIN")):(L.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function fx(e,r){e.addresses||(e.addresses=[]);const i=function(m,_){if(re("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:k}=R;return{address:"".concat(P,":").concat(k)}});const y=re("GATEWAY_DOMAINS");let S=y[1]&&st(_).call(_,y[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:k,ip:z}=R;if(P)return{address:"".concat(P,".").concat(y[S++%y.length],":").concat(k)};const U=/^[\.\:\d]+$/.test(z),F=U?"".concat(z.replace(/[^\d]/g,"-"),".").concat(y[S++%y.length],":").concat(k):"".concat(z,":").concat(k);return U||L.debug("Cannot recognized as ip address: ".concat(z,", use as host")),{ip:z,port:k,address:F}})}(e.addresses,r),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let _=0;_<m.length;_++){var c;const y=oo(c=m[_]).call(c);i[_]&&y&&(i[_].ip6=y)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,_]=u.split(":");m&&_&&(h={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function cc(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function SG(e){const r=e._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?"".concat(cc(r.width),"x").concat(cc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function bG(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function wT(e,r){let i,o,c;switch(r){case ui.CHOOSE_SERVER:o=4096,c="choose server";break;case ui.CLOUD_PROXY:o=1048576,c="proxy";break;case ui.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case ui.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Oe(X.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>tP(tP({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:tP(tP({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!i)throw new Oe(X.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function TG(e,r){return await lt.all(e.addresses.map(async i=>({address:re("USE_TURN_IP")?i.ip:km(i.ip),tcpport:i.port,udpport:i.port,username:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():As.username,password:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await vL(r.toString()):As.password})))}function mx(e,r){const i=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||i.height,c=r.videoWidth||i.width;return o&&c?Math.max(Math.min(o,c)/Math.min(cc(e.height),cc(e.width)),1):(L.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Nm(e){let{candidateType:r,relayProtocol:i,type:o,address:c,port:u,protocol:h}=e;const m={candidateType:r,relayProtocol:i,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=u}return m}function nP(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:re("SVC_MODE");if(re("ENABLE_SVC"))return function(r){return r in kA}(e)?e:kA.L1T3}const wG={[gt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[gt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function rP(e,r,i){r.forEach(o=>{var c;const u=wG[e].find(m=>{var _;let{key:y}=m;return st(_=o.extensionName).call(_,y)});if(!u)return;const h=i.find(m=>{let{extensionName:_}=m;return st(_).call(_,u.key)});h&&st(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function Wv(e,r){r.forEach(i=>{var o;const c=wG[e].find(u=>{var h;let{key:m}=u;return st(h=i.extensionName).call(h,m)});st(o=i.extensionName).call(o,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function RG(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||st(e).call(e,"abs-send-time")}function iP(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||st(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function CG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function IG(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?CG(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):CG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function RT(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:_}=r,{useXR:y}=i;let S=[],R=[],P=[],k=[],z=!1,U=!1;if(Na(e).mediaDescriptions.forEach(q=>{o&&o!==q.attributes.direction||(q.media.mediaType!=="video"||z||(R=q.attributes.payloads,k=q.attributes.extmaps,z=!0),q.media.mediaType!=="audio"||U||(S=q.attributes.payloads,P=q.attributes.extmaps,U=!0))}),!k||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"}),R=R.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),h&&(S=S.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(q=>{var Y;return st(m).call(m,((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const q=R.filter(Y=>{var le;return st(_).call(_,((le=Y.rtpMap)===null||le===void 0?void 0:le.encodingName.toLowerCase())||"")});R=q.concat(c?[]:Ex(q,R))}const F=re("UNSUPPORTED_VIDEO_CODEC");return F&&F.length>0&&(R=R.filter(q=>!(q.rtpMap&&st(F).call(F,q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:P,videoExtensions:k}}function Dm(e){const r=Na(e);let i,o;for(const c of r.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function AG(e,r){const i=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const _=(m=o.find(y=>y.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];i.push({ssrcId:h,rtx:r?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];i.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function PG(e,r,i){const{cname:o}=e;let c=[];r&&(c=OG(r)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),L.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=oP(e.rtpCapabilities),y=[];return Array.isArray(i)&&i.length>0&&i.forEach(S=>{y.push({kind:gt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:gt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:m,cname:o,preSSRCs:y}}function OG(e){let r=[];return e.ip&&typeof e.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],L.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),L.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),r}function M_(e,r,i){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u;const _=cr(8,"track-"),y={ssrcId:h,attributes:IG({label:_,mslabel:i=i||cr(10,""),msid:"".concat(i," ").concat(_)},r&&{cname:r})};if(o.push(y),m!==void 0){const S={ssrcId:m,attributes:IG({label:_,mslabel:i,msid:"".concat(i," ").concat(_)},r&&{cname:r})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function zv(e,r){r instanceof zr&&e.attributes.payloads.forEach(i=>{var o;const c=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Mr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function gx(e){const r=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&e.attributes.unrecognized.splice(r,1)}function _x(e,r){var i;if(!(r instanceof Er&&r._encoderConfig&&r._hints.indexOf(lr.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;Dn().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),Dn().supportMinBitrate&&!st(i=r._hints).call(i,lr.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(re("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function kG(e){if(e.media.mediaType!=="video")return;const r=Cn();if(r.name!==Fn.SAFARI&&r.os!==ji.IOS)return;const i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function sP(e,r,i){if(!r)return;let o,c;if(e.media.mediaType==="video"?(o=i.videoExtensions,c=i.videoCodecs):(o=i.audioExtensions,c=i.audioCodecs),r.twcc===!0){const u=o.find(h=>iP(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>iP(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>iP(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=o.find(h=>RG(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=e.attributes.extmaps.findIndex(h=>RG(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function NG(e,r,i){if(Mr()||e.media.mediaType!=="video"||!(r instanceof Er)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!re("SIMULCAST")||i==="vp9"&&re("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Fr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Fr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function DG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const o=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const S=RT(y,m,_,"sendonly"),R=RT(y,m,_,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},z={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(fu(S,R,"videoExtensions",P,k,z),fu(S,R,"videoCodecs",P,k,z),fu(S,R,"audioExtensions",P,k,z),fu(S,R,"audioCodecs",P,k,z),re("RAISE_H264_BASELINE_PRIORITY")){const U=[],F=[];z.videoCodecs.forEach((q,Y)=>{var le;if(((le=q.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){var Ee,ye;const ge=z.videoCodecs[Y+1],ke=ge&&VG(q,ge),qe=(Ee=q.fmtp)===null||Ee===void 0?void 0:Ee.parameters["profile-level-id"],ut=(ye=q.fmtp)===null||ye===void 0?void 0:ye.parameters["packetization-mode"];!qe||qe!==re("FIRST_H264_PROFILE_LEVEL_ID")||re("FIRST_PACKETIZATION_MODE")&&ut!==re("FIRST_PACKETIZATION_MODE")?ke?F.push([q,ge]):F.push([q]):ke?U.push([q,ge]):U.push([q])}}),U.length>0&&F.length>0&&(L.debug("raising H264 baseline profile priority"),z.videoCodecs.forEach((q,Y)=>{var le;if(((le=q.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){const Ee=VG(q,z.videoCodecs[Y+1]),ye=U.shift()||F.shift()||[];ye.length>0&&(Ee?z.videoCodecs.splice(Y,2,...ye):z.videoCodecs.splice(Y,1,...ye))}}),k.videoCodecs=k.videoCodecs.filter(q=>{var Y,le;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((le=q.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))}),re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>{var Y,le;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((le=q.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:k,sendrecv:z}}(e,r,o);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function LG(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=RT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(fu(e,r,"videoExtensions",i,o,c),fu(e,r,"videoCodecs",i,o,c),fu(e,r,"audioExtensions",i,o,c),fu(e,r,"audioCodecs",i,o,c),re("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){L.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:c}}function fu(e,r,i,o,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return e[i].forEach(m=>{r[i].some((_,y)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void r[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return e[i].forEach(m=>{r[i].some((_,y)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void r[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}}function oP(e){const{send:r,recv:i,sendrecv:o}=e;if(!o){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...o.audioCodecs],u.videoCodecs=[...i.videoCodecs,...o.videoCodecs],u.audioExtensions=[...i.audioExtensions,...o.audioExtensions],u.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function Gv(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function CT(e,r,i,o){let c=[];if(e===gt.VIDEO){if(re("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===re("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],_=[];if(i.videoCodecs.forEach(y=>{const S=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";st(S).call(S,o)?u.push(y):st(S).call(S,"vp9")?h.push(y):st(S).call(S,"vp8")?m.push(y):st(S).call(S,"h264")&&_.push(y)}),u.length===0){let y="";h.length!==0?(u=h,y="vp9"):m.length!==0?(u=m,y="vp8"):_.length!==0&&(u=_,y="h264"),L.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}u.length!==0&&(c=r.videoCodecs.filter(y=>u.some(S=>S.payloadType===y.payloadType)))}if(c.length===0&&(L.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),re("USE_PUB_RTX")||re("USE_SUB_RTX")){const u=Ex(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(L.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function Ex(e,r){const i=e.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&st(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function IT(e,r,i){const o=r.toString(),c=MG(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=xG(h,i||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function xG(e,r,i){const o=Na(e),{useXR:c}=r;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!st(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&Gv(u),c&&st(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Am(o)}function MG(e,r,i,o){if(re("SDP_LOGGING"))return L.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(o,`
`),e),r==="offer"?c=>{MG(c,"answer",i==="local"?"remote":"local",o)}:void 0}function UG(e){const r=re("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(i=>st(e).call(e,i))}function VG(e,r){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===r.payloadType.toString()}catch{return!1}}function FG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function wl(e,r){return typeof re(e)===r?re(e):void 0}function zfe(){try{const e=re("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?FG(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):FG(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e)}catch(e){return L.debug("handle gateway attributes failed: ",e),{}}}const jG={};function Lm(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&L.debug("install service ".concat(e.name)),jG[e.name]=e}function Yp(e){const r=jG[e];if(!r)throw new Le(X.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return r}function BG(e,r){return Yp("DataStream").create(e,r)}function aP(){return Yp("InterceptFrame").create()}function WG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Xp(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?WG(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):WG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const yx=new Map;class Gfe extends kr{get state(){return this._state}set state(r){if(r===this._state)return;const i=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(Zi.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit(Zi.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){L.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){var o,c,u;super(),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"key",void 0),K(this,"ntpOffset",0),K(this,"signal",void 0),K(this,"role",void 0),K(this,"inChannelInfo",{joinAt:null,duration:0}),K(this,"spec",void 0),K(this,"_state","DISCONNECTED"),K(this,"_statsCollector",void 0),K(this,"_disconnectedReason",void 0),K(this,"isSignalRecover",!1),K(this,"hasChangeBGPAddress",!1),K(this,"trafficStatsInterval",void 0),K(this,"networkQualityInterval",void 0),K(this,"_joinGatewayStartTime",0),K(this,"_signalTimeout",!1),K(this,"_clientRoleOptions",void 0),K(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useP2P?(o={spec:Xp(Xp({},i),{},{retryConfig:i.websocketRetryConfig}),store:r},(c=(u=Yp("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Bfe(Xp(Xp({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(r,i,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=yx.get(r.cname);if(u||(u=new Map,yx.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const y=new Oe(X.UID_CONFLICT);throw Rt.joinGateway(r.sid,{lts:c,succ:!1,ec:y.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),y}u.set(r.uid,!0),this.joinInfo=r,this.key=i;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{L.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const y=r.gatewayAddrs.map(S=>{let{address:R}=S;const[P,k]=R.split(":"),z={host:P,port:k};return r.proxyServer&&(z.proxy=r.proxyServer),z});h=(await this.signal.init(y)).uid,L.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(y){var _;throw L.error("[".concat(this.store.clientId,"] User join failed"),y.toString()),Rt.joinGateway(r.sid,{lts:c,succ:!1,ec:((_=y.data)===null||_===void 0?void 0:_.desc)||y.code,errorMsg:y.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),y}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),L.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(y=>{L.warning("[".concat(this.store.clientId,"] get traffic stats error"),y.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Zi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Zi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Zi.NETWORK_QUALITY,{uplinkNetworkQuality:bG(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:bG(this._statsCollector.trafficStats.B_dnq)}):this.emit(Zi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Gn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==hr.CONNECTED||await function(o,c){return c===1/0?o:lt.race([o,mpe(c)])}(this.signal.request(jt.LEAVE,void 0,!0),3e3)}catch(o){L.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==Gn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:re("PUB_EXTEND"),twcc:!!re("PUBLISH_TWCC"),rtx:!!re("USE_PUB_RTX")};try{return(await this.signal.request(jt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_PUBLISH_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,i),this.publish(r,i,!1);throw u}}async publishDataChannel(r,i,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(jt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Lt.ERR_PUBLISH_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,i),this.publishDataChannel(r,i,!1);throw h}}async unpublish(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(jt.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(o){L.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await lt.all(r.map(i=>this.signal.request(jt.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){L.warning("unpublish datachannels warning: ",i)}}async presubscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX")||void 0,extend:re("SUB_EXTEND"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,i,!1);throw u}}async subscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX"),extend:re("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return(await this.signal.request(jt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,i),await this.subscribe(r,i,!1);throw u}}async subscribeDataChannel(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(jt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,i),await this.subscribeDataChannel(r,i,!1);throw u}}async subscribeAll(r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!re("USE_SUB_RTX"),twcc:!!re("SUBSCRIBE_TWCC"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(i&&c.data&&c.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(i)return this.signal.request(jt.SET_VIDEO_PROFILE,i);L.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,i){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:i},!0)}catch(o){L.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await lt.all(r.map(o=>this.signal.request(jt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){L.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){L.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(r){const{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(jt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(jt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(jt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,i){i&&(this._clientRoleOptions=Object.assign({},i)),re("CLIENT_ROLE_OPTIONS")&&(L.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),re("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS")),L.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(jt.SET_CLIENT_ROLE,{role:r,level:c,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,i){await this.signal.request(jt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(jt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,i){await this.signal.request(jt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})}async pickSVCLayer(r,i){await this.signal.request(jt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(r){await this.signal.request(jt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,i,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Xp({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(jt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=yx.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:As.username,password:As.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Xp(Xp({},As),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(jt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(i=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&IA(()=>{this.emit(Zi.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Oe(X.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let o=re("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Zi.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,st(Uv).call(Uv,c)||Uv.push(c);const u=!(Mr()||o8(87)||Y8())&&typeof re("ENABLE_PRE_SUB")=="boolean"&&re("ENABLE_PRE_SUB"),h=!Y8()&&wl("ENABLE_PREALLOC_PC","boolean"),m=zfe(),_=cT(87)||function(){const S=Cn();if(S.name!==Fn.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),y=Xp({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:vl,browser:navigator.userAgent,process_id:re("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:re("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:Xp({enableEncodedTransform:!!re("ENABLE_AUDIO_METADATA")&&_||!!re("ENABLE_AUDIO_TOPN")&&hL(Fn.CHROME,87,116)||void 0,enableAudioMetadata:!!re("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!re("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:re("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:re("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:re("TOPN_SWITCH_HOLD_MS"),topnAudioGain:re("TOPN_AUDIO_GAIN"),enablePublishedUserList:re("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:re("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:wl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:wl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:wl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:re("USE_PUB_RTX")===!0||re("USE_SUB_RTX")===!0||void 0,disableFEC:re("DISABLE_FEC"),enableNTPReport:!!re("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!re("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!re("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:wl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!re("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!re("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:wl("USE_XR","boolean"),enableLossbasedBwe:wl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!re("ENABLE_AUT_CC")||void 0,enableCCFallback:wl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?wl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:wl("PUBLISH_TWCC","boolean"),enableSubTWCC:wl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:wl("USE_PUB_RTX","boolean"),enableSubRTX:wl("USE_SUB_RTX","boolean"),enableSubSVC:re("ENABLE_SVC")?re("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0,enableSvcExtended:re("ENABLE_SVC")&&Array.isArray(re("SVC_EXTENDED"))&&re("SVC_EXTENDED").length!==0?re("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,re("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new Oe(X.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Wt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Wt.WS_RECONNECTING,r=>{this.joinInfo&&Rt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Cs.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Rt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Wt.WS_CLOSED,r=>{let i;switch(r){case Gn.LEAVE:i=Cs.LEAVE;break;case Gn.UID_BANNED:case Gn.IP_BANNED:case Gn.CHANNEL_BANNED:case Gn.SERVER_ERROR:i=Cs.SERVER_ERROR;break;case Gn.FALLBACK:i=Cs.FALLBACK;break;case Gn.LICENSE_MISSING:case Gn.LICENSE_EXPIRED:case Gn.LICENSE_MINUTES_EXCEEDED:case Gn.LICENSE_PERIOD_INVALID:case Gn.LICENSE_MULTIPLE_SDK_SERVICE:case Gn.LICENSE_ILLEGAL:case Gn.TOKEN_EXPIRE:i=r;break;default:i=Cs.NETWORK_ERROR}L.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+Cs.NETWORK_ERROR)),this.joinInfo&&Rt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Gn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=r,r!==Gn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Wt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=re("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(L.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(Rt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void L.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));Qn("EVENT_REPORT_DOMAIN",r[1]),Qn("EVENT_REPORT_BACKUP_DOMAIN",r[1]),Qn("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(_n.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Wt.REQUEST_RECOVER,(r,i,o)=>{if(!this.joinInfo)return o(new Oe(X.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Is(this,Zi.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on(Wt.REQUEST_JOIN_INFO,async(r,i,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=Fr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(re("NEW_TURN_MODE")&&u){let y=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;y.length>0&&(y=[y[R%y.length]],u.servers=y),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),L.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:_}=await Is(this,Zi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(y){i(y)}}),this.signal.on(Wt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Wt.REPORT_JOIN_GATEWAY,(r,i)=>{if(!this.joinInfo)return;let o,c="";var u;r instanceof Oe?(o=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):o=r,Rt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Wt.IS_P2P_DISCONNECTED,r=>{r(pT(this,Zi.IS_P2P_DISCONNECTED))}),this.signal.on(Wt.DISCONNECT_P2P,()=>{this.emit(Zi.DISCONNECT_P2P)}),this.signal.on(Wt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Wt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Wt.JOIN_RESPONSE,r=>{const i=this.getCurrentGatewayAddress();this.emit(Zi.JOIN_RESPONSE,r,i)}),this.signal.on(Wt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),i=re("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&i){const o=OG(r);this.emit(Zi.PRE_CONNECT_PC,{candidates:o,fingerprint:i})}}}),this.signal.on(Wt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof re("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(re("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,i){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,i){try{await this.signal.request(jt.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw L.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,i){try{await this.signal.request(jt.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,i){try{await this.signal.request(jt.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw L.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const i={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,i){const o={action:r.find(c=>c.stream_type===$n.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,i){const o={action:r.find(c=>c.stream_type===$n.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,i){const o={action:r===gt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,i){const o={action:r===gt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(jt.RESTART_ICE,i,!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,i){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,i||Cs.P2P_FAILED)}getCurrentGatewayAddress(){var r,i;if(!re("GATEWAY_WSS_ADDRESS"))return re("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(L.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(jt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let cP=0,vx=0;function gd(e,r,i,o){return new lt((c,u)=>{r.timeout=r.timeout||re("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),cP+=dh(r.data)):i&&(r.data.size?cP+=r.data.size:r.data instanceof FormData?cP+=w8(r.data):cP+=dh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,Jo.request(r).then(h=>{typeof h.data=="string"?vx+=dh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?vx+=h.data.byteLength:vx+=dh(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Jo.isCancel(h)?u(new Oe(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Oe(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Oe(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Oe(X.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function r(je){var it=0;return function(){return it<je.length?{done:!1,value:je[it++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(je,it,St){return je==Array.prototype||je==Object.prototype||(je[it]=St.value),je},o,c=function(je){je=[typeof globalThis=="object"&&globalThis,je,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var it=0;it<je.length;++it){var St=je[it];if(St&&St.Math==Math)return St}throw Error("Cannot find global object")}(this);function u(je,it){if(it)e:{var St=c;je=je.split(".");for(var ze=0;ze<je.length-1;ze++){var x=je[ze];if(!(x in St))break e;St=St[x]}(it=it(ze=St[je=je[je.length-1]]))!=ze&&it!=null&&i(St,je,{configurable:!0,writable:!0,value:it})}}function h(je){return(je={next:je})[Symbol.iterator]=function(){return this},je}function m(je){var it=typeof Symbol<"u"&&Symbol.iterator&&je[Symbol.iterator];return it?it.call(je):{next:r(je)}}if(u("Symbol",function(je){function it(x,ie){this.A=x,i(this,"description",{configurable:!0,writable:!0,value:ie})}if(je)return je;it.prototype.toString=function(){return this.A};var St="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ze=0;return function x(ie){if(this instanceof x)throw new TypeError("Symbol is not a constructor");return new it(St+(ie||"")+"_"+ze++,ie)}}),u("Symbol.iterator",function(je){if(je)return je;je=Symbol("Symbol.iterator");for(var it="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),St=0;St<it.length;St++){var ze=c[it[St]];typeof ze=="function"&&typeof ze.prototype[je]!="function"&&i(ze.prototype,je,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return je}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var y={};try{y.__proto__={a:!0},_=y.a;break e}catch{}_=!1}o=_?function(je,it){if(je.__proto__=it,je.__proto__!==it)throw new TypeError(je+" is not extensible");return je}:null}var S=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(je){if(je.m)throw new TypeError("Generator is already running");je.m=!0}function k(je,it){return je.h=3,{value:it}}function z(je){this.g=new R,this.G=je}function U(je,it,St,ze){try{var x=it.call(je.g.j,St);if(!(x instanceof Object))throw new TypeError("Iterator result "+x+" is not an object");if(!x.done)return je.g.m=!1,x;var ie=x.value}catch(de){return je.g.j=null,je.g.s(de),F(je)}return je.g.j=null,ze.call(je.g,ie),F(je)}function F(je){for(;je.g.h;)try{var it=je.G(je.g);if(it)return je.g.m=!1,{value:it.value,done:!1}}catch(St){je.g.v=void 0,je.g.s(St)}if(je.g.m=!1,je.g.l){if(it=je.g.l,je.g.l=null,it.F)throw it.D;return{value:it.return,done:!0}}return{value:void 0,done:!0}}function q(je){this.next=function(it){return je.o(it)},this.throw=function(it){return je.s(it)},this.return=function(it){return function(St,ze){P(St.g);var x=St.g.j;return x?U(St,"return"in x?x.return:function(ie){return{value:ie,done:!0}},ze,St.g.return):(St.g.return(ze),F(St))}(je,it)},this[Symbol.iterator]=function(){return this}}function Y(je,it){return it=new q(new z(it)),S&&je.prototype&&S(it,je.prototype),it}if(R.prototype.o=function(je){this.v=je},R.prototype.s=function(je){this.l={D:je,F:!0},this.h=this.C||this.u},R.prototype.return=function(je){this.l={return:je},this.h=this.u},z.prototype.o=function(je){return P(this.g),this.g.j?U(this,this.g.j.next,je,this.g.o):(this.g.o(je),F(this))},z.prototype.s=function(je){return P(this.g),this.g.j?U(this,this.g.j.throw,je,this.g.o):(this.g.s(je),F(this))},u("Array.prototype.entries",function(je){return je||function(){return function(it,St){it instanceof String&&(it+="");var ze=0,x=!1,ie={next:function(){if(!x&&ze<it.length){var de=ze++;return{value:St(de,it[de]),done:!1}}return x=!0,{done:!0,value:void 0}}};return ie[Symbol.iterator]=function(){return ie},ie}(this,function(it,St){return[it,St]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var le=function(je,it){for(var St=0;St<je.length;St++)it(je[St])},Ee=function(je){return je.replace(/\r?\n|\r/g,`\r
`)},ye=function(je,it,St){return it instanceof Blob?(St=St!==void 0?St+"":typeof it.name=="string"?it.name:"blob",it.name===St&&Object.prototype.toString.call(it)!=="[object Blob]"||(it=new File([it],St)),[String(je),it]):[String(je),String(it)]},ge=function(je,it){if(je.length<it)throw new TypeError(it+" argument required, but only "+je.length+" present.")},ke=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,qe=ke.FormData,ut=ke.XMLHttpRequest&&ke.XMLHttpRequest.prototype.send,ft=ke.Request&&ke.fetch,yn=ke.navigator&&ke.navigator.sendBeacon,vn=ke.Element&&ke.Element.prototype,ur=ke.Symbol&&Symbol.toStringTag;ur&&(Blob.prototype[ur]||(Blob.prototype[ur]="Blob"),"File"in ke&&!File.prototype[ur]&&(File.prototype[ur]="File"));try{new File([],"")}catch{ke.File=function(it,St,ze){return it=new Blob(it,ze||{}),Object.defineProperties(it,{name:{value:St},lastModified:{value:+(ze&&ze.lastModified!==void 0?new Date(ze.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ur&&Object.defineProperty(it,ur,{value:"File"}),it}}var ni=function(je){return je.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Gr=function(je){this.i=[];var it=this;je&&le(je.elements,function(St){if(St.name&&!St.disabled&&St.type!=="submit"&&St.type!=="button"&&!St.matches("form fieldset[disabled] *"))if(St.type==="file"){var ze=St.files&&St.files.length?St.files:[new File([],"",{type:"application/octet-stream"})];le(ze,function(x){it.append(St.name,x)})}else St.type==="select-multiple"||St.type==="select-one"?le(St.options,function(x){!x.disabled&&x.selected&&it.append(St.name,x.value)}):St.type==="checkbox"||St.type==="radio"?St.checked&&it.append(St.name,St.value):(ze=St.type==="textarea"?Ee(St.value):St.value,it.append(St.name,ze))})};if((e=Gr.prototype).append=function(je,it,St){ge(arguments,2),this.i.push(ye(je,it,St))},e.delete=function(je){ge(arguments,1);var it=[];je=String(je),le(this.i,function(St){St[0]!==je&&it.push(St)}),this.i=it},e.entries=function je(){var it,St=this;return Y(je,function(ze){if(ze.h==1&&(it=0),ze.h!=3)return it<St.i.length?ze=k(ze,St.i[it]):(ze.h=0,ze=void 0),ze;it++,ze.h=2})},e.forEach=function(je,it){ge(arguments,1);for(var St=m(this),ze=St.next();!ze.done;ze=St.next()){var x=m(ze.value);ze=x.next().value,x=x.next().value,je.call(it,x,ze,this)}},e.get=function(je){ge(arguments,1);var it=this.i;je=String(je);for(var St=0;St<it.length;St++)if(it[St][0]===je)return it[St][1];return null},e.getAll=function(je){ge(arguments,1);var it=[];return je=String(je),le(this.i,function(St){St[0]===je&&it.push(St[1])}),it},e.has=function(je){ge(arguments,1),je=String(je);for(var it=0;it<this.i.length;it++)if(this.i[it][0]===je)return!0;return!1},e.keys=function je(){var it,St,ze,x,ie=this;return Y(je,function(de){if(de.h==1&&(it=m(ie),St=it.next()),de.h!=3)return St.done?void(de.h=0):(ze=St.value,x=m(ze),k(de,x.next().value));St=it.next(),de.h=2})},e.set=function(je,it,St){ge(arguments,2),je=String(je);var ze=[],x=ye(je,it,St),ie=!0;le(this.i,function(de){de[0]===je?ie&&(ie=!ze.push(x)):ze.push(de)}),ie&&ze.push(x),this.i=ze},e.values=function je(){var it,St,ze,x,ie=this;return Y(je,function(de){if(de.h==1&&(it=m(ie),St=it.next()),de.h!=3)return St.done?void(de.h=0):(ze=St.value,(x=m(ze)).next(),k(de,x.next().value));St=it.next(),de.h=2})},Gr.prototype._asNative=function(){for(var je=new qe,it=m(this),St=it.next();!St.done;St=it.next()){var ze=m(St.value);St=ze.next().value,ze=ze.next().value,je.append(St,ze)}return je},Gr.prototype._blob=function(){var je="----formdata-polyfill-"+Math.random(),it=[],St="--"+je+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ze,x){return typeof ze=="string"?it.push(St+ni(Ee(x))+`"\r
\r
`+Ee(ze)+`\r
`):it.push(St+ni(Ee(x))+'"; filename="'+ni(ze.name)+`"\r
Content-Type: `+(ze.type||"application/octet-stream")+`\r
\r
`,ze,`\r
`)}),it.push("--"+je+"--"),new Blob(it,{type:"multipart/form-data; boundary="+je})},Gr.prototype[Symbol.iterator]=function(){return this.entries()},Gr.prototype.toString=function(){return"[object FormData]"},vn&&!vn.matches&&(vn.matches=vn.matchesSelector||vn.mozMatchesSelector||vn.msMatchesSelector||vn.oMatchesSelector||vn.webkitMatchesSelector||function(je){for(var it=(je=(this.document||this.ownerDocument).querySelectorAll(je)).length;0<=--it&&je.item(it)!==this;);return-1<it}),ur&&(Gr.prototype[ur]="FormData"),ut){var ra=ke.XMLHttpRequest.prototype.setRequestHeader;ke.XMLHttpRequest.prototype.setRequestHeader=function(je,it){ra.call(this,je,it),je.toLowerCase()==="content-type"&&(this.B=!0)},ke.XMLHttpRequest.prototype.send=function(je){je instanceof Gr?(je=je._blob(),this.B||this.setRequestHeader("Content-Type",je.type),ut.call(this,je)):ut.call(this,je)}}ft&&(ke.fetch=function(je,it){return it&&it.body&&it.body instanceof Gr&&(it.body=it.body._blob()),ft.call(this,je,it)}),yn&&(ke.navigator.sendBeacon=function(je,it){return it instanceof Gr&&(it=it._asNative()),yn.call(this,je,it)}),ke.FormData=Gr}})();const AT=()=>{const e=re("AREAS");return e.length===0&&e.push(jn.GLOBAL),ec(e).call(e,(r,i,o)=>{const c=zG(i);return c?o===0?c:"".concat(r,",").concat(c):r},"")},zG=e=>e===jn.OVERSEA?"".concat(Us.ASIA,",").concat(Us.EUROPE,",").concat(Us.AFRICA,",").concat(Us.NORTH_AMERICA,",").concat(Us.SOUTH_AMERICA,",").concat(Us.OCEANIA):Us[e],Hfe=e=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const o=eP[i],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(o[u]))})}),r},lP={GLOBAL:{ASIA:[jn.CHINA,jn.JAPAN,jn.INDIA,jn.KOREA,jn.HKMC],EUROPE:[],NORTH_AMERICA:[jn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},uP=Object.keys(lP[jn.GLOBAL]),Sx=[jn.CHINA,jn.NORTH_AMERICA,jn.EUROPE,jn.ASIA,jn.JAPAN,jn.INDIA,jn.OCEANIA,jn.SOUTH_AMERICA,jn.AFRICA,jn.KOREA,jn.HKMC,jn.US],$fe=function(e,r){let i=[];if(st(e).call(e,jn.GLOBAL)){const u=[jn.GLOBAL,jn.OVERSEA],h=Object.keys(eP);if(r===jn.GLOBAL)throw new Oe(X.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===jn.CHINA)i=[jn.OVERSEA];else if(c=r,st(uP).call(uP,c)){const m=(o=r,lP[jn.GLOBAL][o]||[]),_=[...u,r,...m];i=h.filter(y=>!st(_).call(_,y))}else if(function(m){let _=!1;return uP.forEach(y=>{var S;st(S=lP[jn.GLOBAL][y]).call(S,m)&&(_=!0)}),_}(r)){const m=function(y){let S;return uP.forEach(R=>{var P;st(P=lP[jn.GLOBAL][R]).call(P,y)&&(S=R)}),S}(r),_=[...u,m,r];i=h.filter(y=>!st(_).call(_,y))}else i=e;i=function(m){const _=[];return Sx.forEach(y=>{st(m).call(m,y)&&_.push(y)}),_.concat(m.filter(y=>!st(Sx).call(Sx,y)))}(i)}else i=e;var o,c;return i};function GG(e){var r,i;if(!e&&st(r=re("AREAS")).call(r,jn.EXTENSIONS))return L.debug("update area from ap : reset"),void bx(tfe,!0);if(!st(i=re("AREAS")).call(i,jn.GLOBAL)||!e)return;let o=eP.EXTENSIONS;o&&(o={CODE:zG(jn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},L.debug("update area from ap success: ".concat(e,",config is "),o),Qn("AREAS",[jn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Qn(c,o[c][0]):Qn(c,o[c])}))}function bx(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=Rt.reportApiInvoke(null,{name:yi.SET_AREA,options:e,tag:Vr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!st(uG).call(uG,u))throw new Oe(X.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new Oe(X.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?$fe(m,h):m}if(!r){if(hd.AREAS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void L.warning("setArea is prohibited because of config-distribute")}if(st(o).call(o,jn.GLOBAL)&&re("AREAS")===jn.EXTENSIONS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void L.warning("setArea is prohibited because of ap extensions")}}Qn("AREAS",o,r);const c=Hfe(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Qn(u,c[u][0]):Qn(u,c[u])}),L.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function HG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function _h(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?HG(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):HG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Tx=1;function Kfe(e,r,i,o,c){Tx+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:Tx,requestId:Tx,version:vl,cname:i.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,_,y=e[0];return dd(async()=>{m=Date.now();const S=await gd(y,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,S.code!==0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw L.error(k.toString()),k}const R=JSON.parse(S.json_body);if(R.code!==200){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:_});throw L.error(k.toString()),k}if(!R.servers||R.servers.length===0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:_});throw L.error(k.toString()),k}const P=function(k,z){return{addressList:k.servers.map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(U.wss,"?serviceName=").concat(encodeURIComponent(z))),workerToken:k.workerToken,vid:k.vid}}(R,r);return re("LIVE_STREAMING_ADDRESS")&&(P.addressList=re("LIVE_STREAMING_ADDRESS")instanceof Array?re("LIVE_STREAMING_ADDRESS"):[re("LIVE_STREAMING_ADDRESS")]),_h(_h({},P),{},{responseTime:_})},(S,R)=>(Rt.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:_,serverIp:e[R%e.length]}),!1),(S,R)=>(Rt.apworkerEvent(i.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:_,serverIp:e[R%e.length]}),!!(S.code!==X.OPERATION_ABORTED&&S.code!==X.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(y=e[(R+1)%e.length],!0)),c)}let wx=1;function $G(e,r,i,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:m}=r,_=Date.now();let y;const S=r.role,[R,P]=Cx(r,u,[ui.CHOOSE_SERVER]);let k=li.networkState;return dd(async()=>{k&&li.networkState===ac.OFFLINE&&li.onlineWaiter&&await lt.race([li.onlineWaiter,cs(o&&o.maxRetryTimeout||vi.maxRetryTimeout)]),k=li.networkState;const{data:z,headers:U}=await gd(c,{data:R,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=U.http3==="1"?1:-1,Rt.reportResourceTiming(c,m),qG(z,c,r,_,[ui.CHOOSE_SERVER],y);const F=wT(z,ui.CHOOSE_SERVER);return Rx(F),fx(F,c)},z=>(z&&Rt.joinChooseServer(m,{role:S,lts:_,succ:!0,csAddr:c,opid:P,serverList:z.gatewayAddrs.map(U=>U.address),ec:null,cid:z.cid.toString(),uid:z.uid.toString(),csIp:z.csIp,unilbsServerIds:[ui.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:z.res.detail&&z.res.detail[38]}),!1),z=>z.code!==X.OPERATION_ABORTED&&(z.code===X.CAN_NOT_GET_GATEWAY_SERVER?z.data.retry:(Rt.joinChooseServer(m,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:P,ec:z.code,csIp:z.data&&z.data.csIp,unilbsServerIds:[ui.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:k}),isHttp3:y,corssRegionTagReq:r.apRequestDetail}),L.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),z),!0)),o)}function KG(e,r,i,o){let c,{url:u,areaCode:h,serviceIds:m}=e;const _=Date.now(),y=r.role,[S,R]=Cx(r,h,m);let P;return dd(async()=>{P&&li.networkState===ac.OFFLINE&&li.onlineWaiter&&await lt.race([li.onlineWaiter,cs(o&&o.maxRetryTimeout||vi.maxRetryTimeout)]),P=li.networkState;const{data:k,headers:z}=await gd(u,{data:S,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=z.http3==="1"?1:-1,Rt.reportResourceTiming(u,r.sid),qG(k,u,r,_,m,c);const U=wT(k,ui.CHOOSE_SERVER),F=wT(k,r.cloudProxyServer==="proxy5"?ui.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?ui.CLOUD_PROXY:ui.CLOUD_PROXY_FALLBACK);return Rx(U),{gatewayInfo:fx(U,u),proxyInfo:F,url:u}},k=>(k.gatewayInfo&&Rt.joinChooseServer(r.sid,{role:y,lts:_,succ:!0,csAddr:u,serverList:k.gatewayInfo.gatewayAddrs.map(z=>z.address),ec:null,opid:R,cid:k.gatewayInfo.cid.toString(),uid:k.gatewayInfo.uid.toString(),csIp:k.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:k.gatewayInfo.res.detail&&k.gatewayInfo.res.detail[38]}),k.proxyInfo&&Rt.joinWebProxyAP(r.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:k.proxyInfo.addresses.map(z=>z.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),k=>k.code!==X.OPERATION_ABORTED&&(k.code===X.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(Rt.joinWebProxyAP(r.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:k.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),L.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),k),!0)),o)}const qG=(e,r,i,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:_}=i,y=[],S=R=>{R.flag===4096?Rt.joinChooseServer(h,{role:i.role,lts:o,succ:!1,csAddr:r,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||Rt.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)L.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const k={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:R.buffer.flag};y.push(k),S(k)}if(P!==0){const k=Bv(P),z={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?L.warning(z.error.toString()):y.push(z),S(z)}}),y.length)throw L.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!y.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(y.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},Rx=e=>{var r,i,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(re("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?GG(e.detail[23].toLowerCase()):GG()),(r=e.detail)!==null&&r!==void 0&&r[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const h=e.detail[19],m=h==null?void 0:h.split(";");for(let _=0;_<m.length;_++){var u;const y=oo(u=m[_]).call(u);e.addresses[_]&&m&&(e.addresses[_].fingerprint=y)}}if(re("GATEWAY_ADDRESS")&&re("GATEWAY_ADDRESS").length>0){L.debug("assign gateway address to",re("GATEWAY_ADDRESS"));const h=re("GATEWAY_ADDRESS").map(m=>{var _,y;const S=(_=(y=e.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||y===void 0?void 0:y.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},qfe=(e,r)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const o=Bv(i.buffer.code);throw new Oe(X.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw L.debug("update ticket request received ap response without response body:",r),new Oe(X.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Cx=(e,r,i)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:_h(_h(_h({6:e.stringUid,11:r,12:re("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Yfe=(e,r)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:r,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]};let Hv=0;function $v(e){return lt.all(e.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}const PT=async e=>{let{fragementLength:r,referenceList:i,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const m=r;let _,y=0;const S=async()=>{const R=(()=>{const P=h*m,k=P+m;return i.slice(P,k).map(o)})();u&&u.push(...R);try{_=await $v(R)}catch(P){if(y+=m,h++,!(y>=i.length))return void await S();c(P)}R.forEach(P=>P.cancel())};return await S(),_},YG=async e=>{let{referenceList:r,asyncMapHandler:i,closeFn:o}=e;const c=r.length;let u=0;const h=async()=>{const m=i(r.shift());try{return await m}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function Ix(e,r,i,o){return{gatewayInfo:await async function(u,h,m,_){let y=null;const S=[],R=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(F=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(F+"/api/v2/transpond/webrtc?v=2"):"https://".concat(F,"/api/v2/transpond/webrtc?v=2"),areaCode:AT()})),z=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(F=>F.url)}),U=await PT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:F=>(L.debug("[".concat(u.clientId,"] Connect to choose_server:"),F.url),$G(F,u,h,m)),allFailedhandler:F=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},z),F[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U},P=async()=>{if(await cs(1e3),y!==null)return y;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map(F=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(F+"/api/v2/transpond/webrtc?v=2"):"https://".concat(F,"/api/v2/transpond/webrtc?v=2"),areaCode:AT()})),z=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(F=>F.url)}),U=await PT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:F=>(L.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),F.url),$G(F,u,h,m)),allFailedhandler:F=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},z),F[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U};try{return y=await $v([R(),P()]),S.length&&S.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),y}catch(k){throw k[0]}}(e,r,i,o)}}async function XG(e,r,i,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await Ix(e,r,i,c);if(re("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:k}=await ZG(e,r,i,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:P};const z=k.map(U=>({turnServerURL:U.address,tcpport:U.tcpport||As.tcpport,udpport:U.udpport||As.udpport,username:U.username||As.username,password:U.password||As.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const U=(h=e.uid)!==null&&h!==void 0?h:P.uid,F="glb:".concat(U.toString()),q=await vL(F),Y=k.map(le=>({turnServerURL:le.address,tcpport:le.tcpport||As.tcpport,udpport:le.udpport||As.udpport,username:F,password:q,forceturn:!1,security:!0}));z.push(...Y)}return e.turnServer={mode:"manual",servers:z},{gatewayInfo:P}}return await Ix(e,r,i,c)}const{proxyInfo:m,gatewayInfo:_}=await ZG(e,r,i,c),y={gatewayInfo:_},S=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:As.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:As.udpport,username:P.username||As.username,password:P.password||As.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const P=(R=e.uid)!==null&&R!==void 0?R:_.uid,k="glb:".concat(P.toString()),z=await vL(k),U=m.map(F=>({turnServerURL:F.address,tcpport:u==="proxy3"?void 0:F.tcpport||As.tcpport,udpport:u==="proxy4"?void 0:F.udpport||As.udpport,username:k,password:z,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...U)}return e.turnServer={mode:"manual",servers:S},L.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),y}async function JG(e,r,i,o,c){const u=re("ACCOUNT_REGISTER").slice(0,re("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(_=>"https://".concat(r.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(y,S,R,P,k){const z=Date.now(),U={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let F=y[0];const q=await dd(()=>gd(F+"".concat(F.indexOf("?")===-1?"?":"&","action=stringuid"),{data:U,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,le)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw L.error("Invalid Uint Uid ".concat(S," => ").concat(Y.uid),Y),Rt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:F,stringUid:U.string_uid,uid:Y.uid,errorCode:X.INVALID_UINT_UID_FROM_STRING_UID,extend:U}),new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return Rt.reqUserAccount(U.sid,{lts:z,success:!0,serverAddr:F,stringUid:U.string_uid,uid:Y.uid,errorCode:null,extend:U}),!1}const Ee=Bv(Y.code);return Ee.retry&&(F=y[(le+1)%y.length]),Rt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:F,stringUid:U.string_uid,uid:Y.uid,errorCode:Ee.desc,extend:U}),Ee.retry},(Y,le)=>Y.code!==X.OPERATION_ABORTED&&(Rt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:F,stringUid:U.string_uid,uid:null,errorCode:Y.code,extend:U}),F=y[(le+1)%y.length],!0),k);if(q.code!==0){const Y=Bv(q.code);throw new Oe(X.UNEXPECTED_RESPONSE,Y.desc)}return q}(h,e,r,i,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function Xfe(e,r,i){const o=re("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await YG({referenceList:c,asyncMapHandler:h=>async function(m,_,y,S){const R=Date.now(),P={sid:y.sid,opid:10,appid:y.appId,string_uid:_};try{const k=await gd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(k.code!==0){const z=Bv(k.code);throw new Oe(X.UNEXPECTED_RESPONSE,"preload sua error:".concat(z.desc),z)}if(k.uid<=0||k.uid>=Math.pow(2,32))throw new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:k.uid,elapse:Date.now()-R}}catch(k){throw k}}(h,e,r,i),closeFn:h=>h.code===X.OPERATION_ABORTED||h.code===X.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function Jfe(e,r,i){const o=re("CDS_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(y,S,R,P){const k=Cn(),z={flag:64,cipher_method:0,features:_h(_h(_h(_h(_h({install_id:kL(),device:k.name,system:k.os,system_general:navigator.userAgent,vendor:S.appId,version:vl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:Wfe.WEB_RTC,browser_name:k.name,browser_version:k.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),k.os&&{os_name:k.os}),k.osVersion&&{os_version:k.osVersion}),{},{detail:""})};return dd(()=>gd(y,{data:z,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,U=>U.code!==X.OPERATION_ABORTED,P)}(_,e,r,i));let u=null,h=null,m={};try{u=await $v(c)}catch(_){if(_.code===X.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),Rt.reportApiInvoke(e.sid,{name:yi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(_){if(!_.test_tags)return{};const y=_.test_tags,S=Object.keys(y),R={};return S.forEach(P=>{var k;const z=oo(k=P.slice(4)).call(k),U=JSON.parse(y[P]),F=U[1];R[z]={tag:U[0]||"",value:F}}),R}(u)}catch{}return m}async function QG(e,r){const i=re("WEBCS_DOMAIN").concat(re("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:AT(),serviceIds:[ui.CHOOSE_SERVER,ui.CLOUD_PROXY_FALLBACK]}));try{return await YG({referenceList:i,asyncMapHandler:c=>async function(u,h,m){let _,{url:y,areaCode:S,serviceIds:R}=u;const P=Date.now(),[k,z]=Cx(h,S,R);let U=li.networkState;try{U&&li.networkState===ac.OFFLINE&&li.onlineWaiter&&await lt.race([li.onlineWaiter,cs(vi.maxRetryTimeout)]),U=li.networkState;const{data:F,headers:q}=await gd(y,{data:k,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=q.http3==="1"?1:-1,(ye=>{const ge=[];if(ye.response_body.forEach(ke=>{const qe=ke.buffer.code;if(ke.uri===23&&qe===0&&!ke.buffer.edges_services)if(ke.buffer.flag===4194310)ke.buffer.edges_services=[];else{const ut={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ye.detail[502]}),flag:ke.buffer.flag};ge.push(ut)}if(qe!==0){const ut=Bv(qe),ft={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,ut.desc,{desc:ut.desc,retry:ut.retry,csIp:ye.detail[502]}),flag:ke.buffer.flag};ke.buffer.flag===4194310?L.warning(ft.error.toString()):ge.push(ft)}}),ge.length)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,ge.map(ke=>"flag: ".concat(ke.flag,", message: ").concat(ke.error.message)).join(" | "),{retry:!!ge.find(ke=>ke.error.data.retry),csIp:ye.detail[502],desc:[...new Set(ge.map(ke=>{var qe;return ke==null||(qe=ke.error)===null||qe===void 0||(qe=qe.data)===null||qe===void 0?void 0:qe.desc}).filter(ke=>!!ke))]})})(F);const le=wT(F,ui.CHOOSE_SERVER),Ee=wT(F,ui.CLOUD_PROXY_FALLBACK);return Rx(le),{gatewayInfo:fx(le,y),proxyInfo:Ee,opid:z,requestTime:P,url:y,isHttp3:_,elapse:Date.now()-P}}catch(F){throw F}}(c,e,r),closeFn:c=>c.code===X.OPERATION_ABORTED||c.code===X.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function ZG(e,r,i,o){const c=re("PROXY_SERVER_TYPE3"),u=(k,z,U)=>{let F=U||c;return Array.isArray(F)&&(F=z%2==0?c[1]:c[0]),"https://".concat(F,"/ap/?url=").concat(k)};let h=null;const m=[],_=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((F,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(F,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(F,"/api/v2/transpond/webrtc?v=2"):u("".concat(F,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:AT(),serviceIds:[ui.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ui.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ui.CLOUD_PROXY:ui.CLOUD_PROXY_FALLBACK]}}),z=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(F=>F.url)}),U=await PT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:F=>(L.debug("[".concat(e.clientId,"] Connect to choose_server:"),F.url),KG(F,e,r,i)),allFailedhandler:F=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},z),F[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U},y=async()=>{if(await cs(1e3),h!==null)return h;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map((F,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(F,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(F,"/api/v2/transpond/webrtc?v=2"):u("".concat(F,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:AT(),serviceIds:[ui.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ui.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ui.CLOUD_PROXY:ui.CLOUD_PROXY_FALLBACK]}}),z=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(F=>F.url)}),U=await PT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:F=>(L.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),F.url),KG(F,e,r,i)),allFailedhandler:F=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},z),F[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U};let S,R,P;try{({gatewayInfo:S,proxyInfo:R,url:P}=await $v([_(),y()]))}catch(k){throw k[0]}if(m.length&&m.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),!S||!R)throw new Oe(X.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=P,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const k=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];st(c).call(c,k)&&(e.proxyServer=k,L.setProxyServer(k),Rt.setProxyServer(k))}return h={gatewayInfo:S,proxyInfo:await TG(R,S.uid)},h}async function Qfe(e,r,i){const o=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,_,y){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:vl,cname:m.cname,uid:m.uid.toString(),requestId:wx,seq:wx};wx+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return dd(async()=>{const P=await gd(h,{data:R,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const z=new Oe(X.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw L.error(z.toString()),z}const k=JSON.parse(P.json_body);if(k.code!==200){const z=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(k.code,", reason: ").concat(k.reason));throw L.error(z.toString()),z}if(!k.servers||k.servers.length===0){const z=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw L.error(z.toString()),z}return{vid:k.vid,workerToken:k.workerToken,addressList:(re("CHANNEL_MEDIA_RELAY_SERVERS")||k.servers).map(z=>"wss://".concat(z.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(z.wss))}},void 0,P=>!!(P.code!==X.OPERATION_ABORTED&&P.code!==X.UNEXPECTED_RESPONSE||P.data&&P.data.retry),y)}(u,e,r,i));try{const u=await $v(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function Zfe(e,r,i){let o=null;const c=[],u=async h=>{const m=re(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await cs(1e3),o!==null)?o:await PT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(L.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(y,S,R,P){const[k]=Yfe(S,[ui.CHOOSE_SERVER]);let z=li.networkState;return dd(async()=>{z&&li.networkState===ac.OFFLINE&&li.onlineWaiter&&await lt.race([li.onlineWaiter,cs(P&&P.maxRetryTimeout||vi.maxRetryTimeout)]),z=li.networkState;const U=await gd(y,{data:k,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return qfe(U,y)},()=>!1,U=>U.code!==X.OPERATION_ABORTED&&(U.code===X.UPDATE_TICKET_FAILED?U.data.retry:(L.warning("[".concat(S.clientId,"] update ticket network error, retry"),U),!0)),P)}(_,e,r,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await $v([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function e9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Ax(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?e9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):e9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class eme extends kr{get isSuccess(){return!!this.configs}constructor(r,i){super(),K(this,"configs",void 0),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"cancelToken",void 0),K(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),K(this,"interval",void 0),K(this,"mutex",void 0),K(this,"mutableParamsRead",!1),K(this,"configCache",{}),K(this,"limit_bitrate",void 0),this.mutex=new Ms("config-distribute",r),this.store=i}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),re("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},re("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Rt.reportApiInvoke(null,{options:void 0,name:yi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Vr.TRACER}).onSuccess(JSON.stringify(hd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void L.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const i=await this.mutex.lock();try{r=await Jfe(this.joinInfo,this.cancelToken,this.retryConfig),L.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var u;const h=Xb(u=Object.keys(c).filter(y=>/^webrtc_ng_global_parameter/.test(y))).call(u);for(let y=0;y<h.length;y++)for(let S=h.length-1;S>y;S--){const R=h[S],P=c[R].value;if(typeof P.__priority=="number"){const k=P.__priority,z=h[S-1],U=c[z].value;if(typeof U.__priority=="number"){if(!(k>U.__priority))continue;{const F=R;h[S]=h[S-1],h[S-1]=F}}else{const F=R;h[S]=h[S-1],h[S-1]=F}}}const m=Date.now();let _={};return h.forEach(y=>{const S=c[y].value.__expires;S&&S<=m||(_[y]=c[y])}),_}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Oe(X.NETWORK_RESPONSE_ERROR,o);L.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){dG(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(ST.UPDATE_BITRATE_LIMIT,r):this.emit(ST.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&Ax({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const i={},o=Object.keys(r),c=[];o.forEach(u=>{const h=r[u].value;i[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const _=h.__type,y=r[u].value,S=r[u].tag;let R=0;_?_===j8.REALTIME&&(R=1):Object.keys(y).some(P=>Object.prototype.hasOwnProperty.call(xL,P)||!ix()&&Object.prototype.hasOwnProperty.call(NA,P)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:_,isApplied:y}=u;this.store.sessionId&&Rt.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:h,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){L.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(r){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,_=m.__expires,y=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=Ax(Ax({value:m[S]},_&&{expires:_}),y&&{type:y}))})}),u}(r);try{var o;const c=(o=i.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete i.LIMIT_BITRATE,c&&dG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(r),function(m){try{const _=Date.now();Object.keys(m).forEach(y=>{const{value:S,type:R,expires:P}=m[y];P&&P<=_||((R===j8.REALTIME||Object.prototype.hasOwnProperty.call(xL,y))&&(hd[y]=S,_r[y]=S,L.debug("Update realtime parameters from config distribute",y,S)),R||ix()||!Object.prototype.hasOwnProperty.call(NA,y)||(hd[y]=S,_r[y]=S,L.debug("Update gateway parameters from config distribute",y,S)))})}catch(_){L.error("Error update config immediately: ".concat(m),_.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),L.debug("Caching global parameters ".concat(u))}catch(c){L.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const i=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(_r,o)){const{value:c,expires:u}=r[o];if(u&&u<=i)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(_r[o],c)||(hd[o]=c,_r[o]=c,this.emit(ST.UPDATE_CLIENT_ROLE_OPTIONS,c),L.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(i){L.error("Error handling global parameter config:",i.message)}}}class tme extends kr{constructor(){super(...arguments),K(this,"resultStorage",new Map)}setLocalAudioStats(r,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(r,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,i){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(r,i,o){if(re("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=st(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",t9[r],r,i),!c.isPrevNormal&&h&&this.emit("exception",t9[r]+2e3,r+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,i){return i instanceof Ci&&!i.isActive||!!i.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=cc(i._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,i){return!!i.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,i){return i instanceof Ci&&!i.isActive||!!i.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const t9={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Fs=new class{markSubscribeStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(r))}markPublishStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(r))}measureFromSubscribeStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(r));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(r));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function n9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function U_(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?n9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class OT{constructor(r){K(this,"store",void 0),K(this,"onStatsException",void 0),K(this,"onUploadPublishDuration",void 0),K(this,"onStatsChanged",void 0),K(this,"localStats",new Map),K(this,"remoteStats",new Map),K(this,"updateStatsInterval",void 0),K(this,"trafficStats",void 0),K(this,"trafficStatsPeerList",[]),K(this,"uplinkStats",void 0),K(this,"exceptionMonitor",void 0),K(this,"p2pChannel",void 0),K(this,"scalabilityMode",kA.L1T1),K(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new tme,this.exceptionMonitor.on("exception",(i,o,c)=>{this.onStatsException&&this.onStatsException(i,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get($e.LocalAudioTrack)||U_({},jL)}getLocalVideoTrackStats(){return this.localStats.get($e.LocalVideoTrack)||U_({},BL)}getRemoteAudioTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(o[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRemoteNetworkQualityStats(r){const i={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(i[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getRemoteVideoTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(o[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRTCStats(){let r=0,i=0,o=0,c=0;const u=this.localStats.get($e.LocalAudioTrack);u&&(r+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get($e.LocalVideoTrack);h&&(r+=h.sendBytes,i+=h.sendBitrate);const m=this.localStats.get($e.LocalVideoLowTrack);m&&(r+=m.sendBytes,i+=m.sendBitrate),this.remoteStats.forEach(y=>{let{audioStats:S,videoStats:R}=y;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:i,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Fs.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Fs.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&L.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,o){if(!r)return!1;const c=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||i.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[o,c]=i;switch(o){case $e.LocalVideoTrack:case $e.LocalVideoLowTrack:{const h=c,m=U_({},BL),_=r.getStats(),y=r.getLocalMedia(o);if(_){const S=_.videoSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){const R=r.getLocalVideoSize(),P=r.getEncoderConfig($e.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(L.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&y&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,y.track,m);break}case $e.LocalAudioTrack:{const h=c,m=U_({},jL),_=r.getStats(),y=r.getLocalMedia(o);if(_){const S=_.audioSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set($e.LocalAudioTrack,m),m&&y&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,y.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:_}]=i;const y=m,S=h,R=_,P=U_({},J8),k=U_({},Q8),z=U_({},Fpe),{audioTrack:U,videoTrack:F,audioSSRC:q,videoSSRC:Y}=r.getRemoteMedia(u);let le;le=this.store.useP2P?r.getStats(!0):r.getStats();const Ee=(o=le)===null||o===void 0?void 0:o.audioRecv.find(qe=>qe.ssrc===q),ye=(c=le)===null||c===void 0?void 0:c.videoRecv.find(qe=>qe.ssrc===Y),ge=this.trafficStats&&this.trafficStats.peer_delay.find(qe=>qe.peer_uid===u);if(Ee&&(Ee.codec!=="opus"&&Ee.codec!=="aac"&&Ee.codec!=="PCMU"&&Ee.codec!=="PCMA"&&Ee.codec!=="G722"||(P.codecType=Ee.codec),Ee.outputLevel?P.receiveLevel=Math.round(32767*Ee.outputLevel):U&&(P.receiveLevel=Math.round(32767*U.getVolumeLevel())),P.receiveBytes=Ee.bytes,P.receivePackets=Ee.packets,P.receivePacketsLost=Ee.packetsLost,P.receivePacketsDiscarded=Ee.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=y?8*Math.max(0,P.receiveBytes-y.receiveBytes):0,P.totalDuration=y?y.totalDuration+1:1,P.totalFreezeTime=y?y.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=Ee.jitterBufferMs,P.totalDuration>10&&OT.isRemoteAudioFreeze(U)&&(P.totalFreezeTime+=1)),ye){var ke;ye.codec!=="H264"&&ye.codec!=="H265"&&ye.codec!=="VP8"&&ye.codec!=="VP9"&&ye.codec!=="AV1X"&&ye.codec!=="AV1"||(k.codecType=ye.codec),k.receiveBytes=ye.bytes,k.receiveBitrate=S?8*Math.max(0,k.receiveBytes-S.receiveBytes):0,k.decodeFrameRate=ye.decodeFrameRate<0?0:ye.decodeFrameRate,k.renderFrameRate=ye.decodeFrameRate<0?0:ye.decodeFrameRate,ye.outputFrame&&(k.renderFrameRate=ye.outputFrame.frameRate),ye.receivedFrame?(k.receiveFrameRate=ye.receivedFrame.frameRate,k.receiveResolutionHeight=ye.receivedFrame.height,k.receiveResolutionWidth=ye.receivedFrame.width):F&&(k.receiveResolutionHeight=F._videoHeight||0,k.receiveResolutionWidth=F._videoWidth||0),ye.framesRateFirefox!==void 0&&(k.receiveFrameRate=Math.round(ye.framesRateFirefox)),k.receivePackets=ye.packets,k.receivePacketsLost=ye.packetsLost,k.packetLossRate=k.receivePacketsLost/(k.receivePackets+k.receivePacketsLost);const qe=S?S.totalFreezeTime:0,ut=S?S.totalDuration:0;k.totalDuration=S?S.totalDuration+1:1,k.totalFreezeTime=(ke=ye.totalFreezesDuration)!==null&&ke!==void 0?ke:qe||0,k.receiveDelay=ye.jitterBufferMs||0;const ft=!!Y&&r.getRemoteVideoIsReady(Y);ye.totalFreezesDuration===void 0&&F&&ft&&OT.isRemoteVideoFreeze(F,ye,R)&&(k.totalFreezeTime+=1),k.freezeRate=Math.max(0,Math.min((k.totalFreezeTime-qe)/(k.totalDuration-ut),1))}ge&&(P.end2EndDelay=ge.B_ad,k.end2EndDelay=ge.B_vd,P.transportDelay=ge.B_ed,k.transportDelay=ge.B_ed,P.currentPacketLossRate=ge.B_ealr4/100,k.currentPacketLossRate=ge.B_evlr4/100,z.uplinkNetworkQuality=ge.B_punq?ge.B_punq:0,z.downlinkNetworkQuality=ge.B_pdnq?ge.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:k,videoPcStats:ye,networkStats:z}),U&&this.exceptionMonitor.setRemoteAudioStats(U,P),F&&this.exceptionMonitor.setRemoteVideoStats(F,k)})}}class r9{constructor(){K(this,"destChannelMediaInfos",new Map),K(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){lG(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){lG(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){JA(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function i9(e){if(!(e instanceof r9))return new Oe(X.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!r)return new Oe(X.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new Oe(X.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class xm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,i){K(this,"uid",void 0),K(this,"_uintid",void 0),K(this,"_trust_in_room_",!0),K(this,"_trust_audio_enabled_state_",!0),K(this,"_trust_video_enabled_state_",!0),K(this,"_trust_audio_mute_state_",!0),K(this,"_trust_video_mute_state_",!0),K(this,"_audio_muted_",!1),K(this,"_video_muted_",!1),K(this,"_audio_enabled_",!0),K(this,"_video_enabled_",!0),K(this,"_audio_added_",!1),K(this,"_video_added_",!1),K(this,"_is_pre_created",!1),K(this,"_video_pre_subscribed",!1),K(this,"_audio_pre_subscribed",!1),K(this,"_trust_video_stream_added_state_",!0),K(this,"_trust_audio_stream_added_state_",!0),K(this,"_audioTrack",void 0),K(this,"_videoTrack",void 0),K(this,"_dataChannels",[]),K(this,"_audioSSRC",void 0),K(this,"_videoSSRC",void 0),K(this,"_audioOrtc",void 0),K(this,"_videoOrtc",void 0),K(this,"_cname",void 0),K(this,"_rtxSsrcId",void 0),K(this,"_videoMid",void 0),K(this,"_audioMid",void 0),this.uid=r,this._uintid=i}}function s9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function o9(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?s9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const kT="9",a9=4e4;function c9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Jp(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?c9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Kv=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Kv||{});const dP=new Map;function l9(e,r,i,o){let{scale:c}=e;if(c===0&&o===Kv.UP||c>=r.length-1&&o===Kv.DOWN)return e;let u=Jp(Jp({},e),{},{scale:o===Kv.DOWN?++c:--c});switch(i){case"maintain-framerate":u=Jp(Jp({},u),r[c].motion);break;case"maintain-resolution":u=Jp(Jp({},u),r[c].detail);break;case"balanced":u=Jp(Jp({},u),r[c].balanced)}return u}function u9(e,r){if(r){const i={overUse:0,underUse:0,adaptationList:d9(r)};dP.set(e,i)}else dP.delete(e)}function d9(e){const r=Jp({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:k,PERF_SCALE_UP_THRESHOLD:z,BALANCE_BITRATE_FACTOR:U,BALANCE_FRAMERATE_FACTOR:F,BALANCE_RESOLUTION_FACTOR:q,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:le,DETAIL_FRAMERATE_FACTOR:Ee,DETAIL_BITRATE_FACTOR:ye}=DL,ge=Math.min(r.frameRate,m),ke=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(k,1)*ge),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u}}];for(let qe=1;qe<=_;qe++){const ut={bwe_up:Math.round(Math.pow(R,qe)*i),bwe_down:Math.round(Math.pow(P,qe+1)*i),fps_up:Math.round(Math.pow(z,qe)*ge),fps_down:Math.round(Math.pow(k,qe+1)*ge)},ft={scaleResolutionDownBy:c/Math.pow(q,qe),frameRate:Math.max(Math.round(Math.pow(F,qe)*o),h),bitrateMax:Math.max(Math.round(Math.pow(U,qe)*i),S),bitrateMin:Math.max(Math.round(Math.pow(U,qe)*u),y)},yn={scaleResolutionDownBy:c/Math.pow(Y,qe),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(le,qe)*i),S),bitrateMin:Math.max(Math.round(Math.pow(le,qe)*u),y)},vn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Ee,qe)*o),h),bitrateMax:Math.max(Math.round(Math.pow(ye,qe)*i),S),bitrateMin:Math.max(Math.round(Math.pow(ye,qe)*u),y)};ke.push({scale:qe,threshold:ut,balanced:ft,motion:yn,detail:vn})}return ke}function nme(e,r,i,o,c,u){const h=dP.get(e)||{overUse:0,underUse:0,adaptationList:d9(c)},{adaptationList:m}=h;dP.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:y}=DL,{scale:S}=o;let R,P;return typeof r=="number"&&r>0&&function(k,z,U,F){if(z>=U.length)return!1;let{threshold:{fps_down:q}}=U[z];return re("FORCE_AG_HIGH_FRAMERATE")&&F==="maintain-framerate"&&(q=U[0].threshold.fps_down),k<q}(r,S,m,u)&&(h.overUse++,P=mT.CPU,h.overUse>_)||typeof i=="number"&&i>0&&function(k,z,U){if(z>=U.length)return!1;const{threshold:{bwe_down:F}}=U[z];return k<F}(i,S,m)&&(h.overUse++,P=mT.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,R=l9(o,m,u,Kv.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(k,z,U,F){if(z===0)return;let{threshold:{fps_up:q}}=U[z];return re("FORCE_AG_HIGH_FRAMERATE")&&F==="maintain-framerate"&&(q=U[1].threshold.fps_up),k>q}(r,S,m,u)&&function(k,z,U){if(z===0)return;const{threshold:{bwe_up:F}}=U[z];return k>F}(i,S,m)&&(h.underUse++,h.underUse>y&&(h.overUse=0,h.underUse=0,R=l9(o,m,u,Kv.UP),R.scale===0&&(P=mT.NONE))),[R,P])}function h9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Px(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?h9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):h9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function rme(e){var r;return!!re("ENABLE_AG_ADAPTATION")&&!!(e instanceof XL||st(r=e._hints).call(r,lr.CUSTOM_TRACK))&&(!!re("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){const o=Cn();if(o.os!==ji.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=i}(14)&&c8(17,4)||a8(14)&&l8(17,4,!0)))}const hP=new Map;function pP(e,r){const i=hP.get(e);if(i){const{timer:o}=i;window.clearTimeout(o),hP.delete(e)}r.qualityLimitationReason=mT.NONE,u9(e)}function ime(e,r){var i;let o;switch(r){case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoTrack:o=st(i=e._hints).call(i,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:o=$n.Low}return o}function Ox(e){const r=Dn();if(e.some(i=>i._bypassWebAudio))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function kx(e,r){Ox(e);const i=new Ci;return e.forEach(o=>i.addAudioTrack(o)),i}const sme=!Dn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Bp();function fP(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return sme?(i={spec:r,store:e},Yp("PlanBConnection").create(i)):new Eh(r,e)}function Nx(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function p9(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(hT(e.turnServer.servers))return!1;if(re("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Tn;function f9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function _d(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?f9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Eh=(Tn=class iE extends pG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return st(i=Object.keys(DA)).call(i,r)}))]}constructor(r,i){super(r,i),K(this,"id",cr(5,"connection-")),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"forceTurn",!1),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"transportEventReceiver",void 0),K(this,"statsFilter",void 0),K(this,"extension",{useXR:re("USE_XR")}),K(this,"localCapabilities",void 0),K(this,"remoteCodecs",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"isPreallocation",!1),K(this,"preSSRCMap",new Map),K(this,"dataStreamChannelMap",new Map),K(this,"establishPromise",void 0),K(this,"recoveredDataChannelIds",[]),K(this,"currentDataChannelId",1),K(this,"supportAV1RtpSpec",!1),K(this,"mutex",void 0),K(this,"qualityLimitationReason",mT.NONE),K(this,"isFirstConnected",!1),this.store=i,this.forceTurn=p9(r),this.mutex=new Ms("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(iE.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=OL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Mr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const i=this.preSSRCMap.get(r);if(i!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void L.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else L.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Dm(o.sdp),u=await DG({filterRTX:!re("USE_PUB_RTX")&&!re("USE_SUB_RTX"),filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterVideoCodec:re("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=oP(u),this.initialOffer=o,re("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:kA.L1T3}]});const y=await _.createOffer();if(!y.sdp)return void _.close();const S=Na(y.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&UG(o.sdp)&&(h=Fr(u),(i=h).send&&(Wv(gt.VIDEO,i.send.videoExtensions),Wv(gt.AUDIO,i.send.audioExtensions)),i.recv&&(Wv(gt.VIDEO,i.recv.videoExtensions),Wv(gt.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(Wv(gt.VIDEO,i.sendrecv.videoExtensions),Wv(gt.AUDIO,i.sendrecv.audioExtensions))),_d(_d({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var i}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&UG(this.initialOffer.sdp)&&(i=r.rtpCapabilities,o=this.localCapabilities,i.send&&(rP(gt.VIDEO,i.send.videoExtensions,o.send.videoExtensions),rP(gt.AUDIO,i.send.audioExtensions,o.send.audioExtensions)),i.recv&&(rP(gt.VIDEO,i.recv.videoExtensions,o.recv.videoExtensions),rP(gt.AUDIO,i.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Fr(this._localCapabilities)}get rtpCapabilities(){return Fr(this._rtpCapabilities)}get candidates(){return Fr(this._candidates)}get iceParameters(){return Fr(this._iceParameters)}get dtlsParameters(){return Fr(this._dtlsParameters)}constructor(y){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_originCandidates",void 0),K(this,"_iceParameters",void 0),K(this,"_isUseExtmapAllowMixed",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),K(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,y=Fr(y);const{iceParameters:R,dtlsParameters:P,candidates:k,rtpCapabilities:z,setup:U,localCapabilities:F,cname:q}=y;this._rtpCapabilities=z,this._candidates=k,this._originCandidates=Fr(k),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=F,this.setup=U,this.cname=q,this.sessionDesc=this.updateRemoteRTPCapabilities(z),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(y){const S=this.candidates,R=this.dtlsParameters,P=this.iceParameters,k=this.rtpCapabilities.send;let z=this.sessionDesc.mediaDescriptions.length-1;for(let U=1;U<y;U++){const F=2*U+2e4,q=2*U+a9,{ssrcs:Y,ssrcGroups:le}=M_([{ssrcId:F}],this.cname),{ssrcs:Ee,ssrcGroups:ye}=M_([{ssrcId:q,rtx:re("USE_SUB_RTX")?q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:kT,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.videoCodecs.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Ee,ssrcGroups:ye,rtcpFeedbackWildcards:[],payloads:k.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++z)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:kT,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.audioCodecs.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Y,ssrcGroups:le,rtcpFeedbackWildcards:[],payloads:k.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++z)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Am(this.sessionDesc)}send(y,S,R,P){const{ssrcs:k,ssrcGroups:z}=M_(S,this.cname,re("SYNC_GROUP")?R:void 0),U=this.findPreloadMediaDesc(k);if(U){if(Mr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,U.attributes.mid),P&&(P.twcc||P.remb)){const F=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(U,P),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{const F=this.findAvailableMediaIndex(y,k);let q;return F===-1||F===1&&(Rs()||function(){const Y=Cn();return!(Y.name!==Fn.CHROME||!Y.osVersion)&&Number(Y.version)<=90}()||re("ENABLE_ENCODED_TRANSFORM")&&jp())||F===0&&re("USE_SUB_RTX")||u8()?(q=this.createOrRecycleSendMedia(y,k,z,"sendonly",P),this.updateBundleMids()):(q=Fr(this.sessionDesc.mediaDescriptions[F]),q.attributes.direction="sendonly",q.attributes.ssrcs=k,q.attributes.ssrcGroups=z,this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(q,P)),Mr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,q.attributes.mid),{mid:q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:y,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:y.attributes.mid,needExchangeSDP:S}}batchSend(y){const S=y.map(k=>{let{kind:z,ssrcMsg:U,mslabel:F}=k;return this.send(z,U,F)}),R=[];let P=!1;return S.forEach(k=>{let{mid:z,needExchangeSDP:U}=k;U&&(P=!0),R.push(z)}),{mids:R,needExchangeSDP:P}}stopSending(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&y.indexOf(R.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||Mr()||u8()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(y){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(y){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(y).call(y,R.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(y).call(y,R.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(y,S,R,P){y.forEach((k,z)=>{this.createOrRecycleRecvMedia(k,[],"recvonly",S,R,P[z])}),this.updateBundleMids()}stopReceiving(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>y.indexOf(R.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(y){const S=this.sessionDesc||Na((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=y;const P=this.rtpCapabilities.send,k=this.localCapabilities.send;for(const z of S.mediaDescriptions){if(z.attributes.iceUfrag=this._iceParameters.iceUfrag,z.attributes.icePwd=this._iceParameters.icePwd,z.attributes.fingerprints=this._dtlsParameters.fingerprints,z.attributes.candidates=this._candidates,z.attributes.setup=this.setup,z.media.mediaType==="application"&&(z.attributes.sctpPort="5000"),z.media.mediaType==="video"){if(P.videoCodecs.length===0){const U=k.videoCodecs.filter(F=>{var q,Y;return(q=F.rtpMap)===null||q===void 0?void 0:st(Y=q.encodingName.toLowerCase()).call(Y,"vp8")})||[k.videoCodecs[0]];z.media.fmts=U.map(F=>F.payloadType.toString(10)),z.attributes.payloads=U,z.attributes.extmaps=[]}else if(z.media.fmts=P.videoCodecs.map(U=>U.payloadType.toString(10)),z.attributes.payloads=P.videoCodecs,z.attributes.extmaps=P.videoExtensions,re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:F}=M_([{ssrcId:a9,rtx:re("USE_SUB_RTX")?40001:void 0}],this.cname);z.attributes.ssrcs=U,z.attributes.ssrcGroups=F}}if(z.media.mediaType==="audio"){if(P.audioCodecs.length===0){const U=k.audioCodecs.filter(F=>{var q,Y;return(q=F.rtpMap)===null||q===void 0?void 0:st(Y=q.encodingName.toLowerCase()).call(Y,"opus")})||[k.audioCodecs[0]];z.media.fmts=U.map(F=>F.payloadType.toString(10)),z.attributes.payloads=U,z.attributes.extmaps=[]}else if(z.media.fmts=P.audioCodecs.map(U=>U.payloadType.toString(10)),z.attributes.payloads=P.audioCodecs,z.attributes.extmaps=P.audioExtensions,Gv(z),re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:F}=M_([{ssrcId:2e4}],this.cname);z.attributes.ssrcs=U,z.attributes.ssrcGroups=F}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(y){const S=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(S.forEach(P=>{R.push(o9(o9({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(y){case Vs.TCP_RELAY:this._candidates=R;break;case Vs.UDP_TCP_RELAY:case Vs.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(y){y=Fr(y),this._iceParameters=y,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=y.iceUfrag,S.attributes.icePwd=y.icePwd})}predictReceivingMids(y){const S=[];for(let R=0;R<y;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(y,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===y&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Mr()){if(P){const k=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(k||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!k||k!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const y="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:kT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(y),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(y,S,R,P,k,z){const U=y._mediaStreamTrack.kind,F=this.rtpCapabilities.recv,q=CT(U,F,this.localCapabilities.send,U===gt.VIDEO?P:k),Y=U===gt.VIDEO?F.videoExtensions:F.audioExtensions;this.currentMidIndex+=1;const le="".concat(this.currentMidIndex);let Ee={media:{mediaType:U,port:kT,protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(le)}};Ee=this.mungRecvMediaDsec(Ee,y,z);const ye=this.findFirstClosedMedia(U);if(ye){const ge=this.sessionDesc.mediaDescriptions.indexOf(ye);this.sessionDesc.mediaDescriptions[ge]=Ee}else this.sessionDesc.mediaDescriptions.push(Ee);return Ee}updateRemoteCodec(y,S,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Ee=>Ee.rtpMap&&Ee.rtpMap.encodingName.toLowerCase()||"").filter(Ee=>{var ye;return st(ye=Object.keys(DA)).call(ye,Ee)}))],k=new Set(S);if(P.every(Ee=>k.has(Ee)))return L.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const z=this._rtpCapabilities.recv.videoCodecs.filter(Ee=>S.some(ye=>{var ge;return st(ge=Ee.rtpMap&&Ee.rtpMap.encodingName.toLowerCase()||"").call(ge,ye)}));if(z.length===0)return L.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const U=[...new Set(z.map(Ee=>Ee.rtpMap&&Ee.rtpMap.encodingName.toLowerCase()||""))];let F;if(L.debug("updateRemoteCodec, from ".concat(P," to ").concat(U)),y.length===0)F=this.sessionDesc.mediaDescriptions.filter(Ee=>Ee.media.mediaType==="video"&&Ee.attributes.direction==="recvonly");else if(F=this.sessionDesc.mediaDescriptions.filter(Ee=>Ee.attributes.mid&&st(y).call(y,Ee.attributes.mid)&&Ee.attributes.direction==="recvonly"),F.length!==y.length)return L.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(y,", codecs: ").concat(S)),!1;if(re("USE_PUB_RTX")||re("USE_SUB_RTX")){const Ee=Ex(z,this.rtpCapabilities.recv.videoCodecs);z.push(...Ee)}this._rtpCapabilities.recv.videoCodecs=z;const q=this.localCapabilities.send,Y=this.rtpCapabilities.recv,le=CT(gt.VIDEO,Y,q,R);return F.forEach(Ee=>{const ye=le.map(ge=>ge.payloadType.toString(10));L.debug("updateRemoteCodec mid: ".concat(Ee.attributes.mid,", from"),Ee.attributes.payloads,"to",le),Ee.attributes.payloads=le,Ee.media.fmts=ye}),!0}createOrRecycleSendMedia(y,S,R,P,k){const z=this.rtpCapabilities.send,U=y===gt.VIDEO?z.videoCodecs:z.audioCodecs,F=y===gt.VIDEO?z.videoExtensions:z.audioExtensions;this.currentMidIndex+=1;const q="".concat(this.currentMidIndex);let Y={media:{mediaType:y,port:kT,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(Ee=>Ee.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:F,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};Y=this.mungSendMediaDesc(Y,k);const le=this.findFirstClosedMedia(y);if(le){const Ee=this.sessionDesc.mediaDescriptions.indexOf(le);this.sessionDesc.mediaDescriptions[Ee]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(y=>y.media.port!=="0").map(y=>y.attributes.mid)}mungRecvMediaDsec(y,S,R){const P=Fr(y);return gx(P),zv(P,S),_x(P,S),kG(P),sP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(y,S){const R=Fr(y);return sP(R,S,this.localCapabilities.recv),Gv(R),R}updateRecvMedia(y,S){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===y);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(y){this.currentMidIndex+=y}findFirstClosedMedia(y){return this.sessionDesc.mediaDescriptions.find(S=>Mr()?S.media.port==="0"&&S.media.mediaType===y:S.media.port==="0")}findPreloadMediaDesc(y){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===y[0].ssrcId})}getSSRC(y){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y))===null||S===void 0?void 0:S.attributes.ssrcs}}(_d(_d({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=xG(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),re("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(re("PRELOAD_MEDIA_COUNT"));const y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=r;if(Array.isArray(_)&&_.length>0){const{mids:y}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));y.forEach((S,R)=>{this.preSSRCMap.set(_[R].ssrcId,S)}),await IT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var i,o}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=r;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await IT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,o){var c=this;return yl(function*(){const u=yield Rn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=nP();r.forEach(F=>{const q=c.peerConnection.addTransceiver(F._mediaStreamTrack,_d({direction:"sendonly"},F.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(q),F._updateRtpTransceiver(q)}),Mr()&&re("SIMULCAST")===!0&&(yield Rn(c.applySimulcastForFirefox(h,r)));const _=yield Rn(c.peerConnection.createOffer()),y=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(_.sdp,r,y),R=Na(S),P=y.map(F=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===F);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return AG(q,re("USE_PUB_RTX"))});let k;try{k=yield P}catch(F){k=[],c.remoteSDP.receive(r,i,o,k);const q=c.remoteSDP.toString();throw yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Rn(c.stopSending(y,!0)),F}c.remoteSDP.receive(r,i,o,k);const z=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(c.applySimulcastEncodings(h,r)),yield Rn(c.applySendEncodings(h,r)),U==null||U(z),yield Rn(c.peerConnection.setRemoteDescription({type:"answer",sdp:z})),h.map((F,q)=>{const Y=y[q];return{localSSRC:P[q],id:Y,transceiver:F}})}catch(h){throw h instanceof Le?h:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")L.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:re("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}i.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),L.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else L.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Le?o:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof Le?i:new Le(X.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var y;pP(this.id+_.mid,this),_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);h&&(await IT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await IT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,_]=h;if(_===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return yl(function*(){const o=yield Rn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Dn().supportPCSetConfiguration,u=re("FORCE_TURN_TCP")||i.forceTurn;if(r===Vs.RELAY&&!c)return;if(c&&!u){const R=r===Vs.RELAY?"relay":"all",P=i.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(L.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,i.peerConnection.setConfiguration(P))}i.remoteSDP.updateCandidates(r);const h=yield Rn(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Dm(h.sdp),{remoteIceParameters:_}=yield m.iceParameters;i.remoteSDP.restartICE(_);const y=i.remoteSDP.toString(),S=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Rn(i.peerConnection.setLocalDescription(h)),S==null||S(y),yield Rn(i.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){L.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Vs.TCP_RELAY),await IT(this.peerConnection,this.remoteSDP,this.extension)}catch(i){L.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{pP(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return _d(_d({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(i)?Mr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:_d(_d({},hh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:_d(_d({},hh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(hT(r.turnServer.servers)?i.iceServers=r.turnServer.servers:re("NEW_TURN_MODE")&&i.iceServers?(re("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...iE.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...iE.newTurnServerConfigToIceServers(r.turnServer.servers)),re("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...iE.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...iE.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&Dn().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(km(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!re("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{const c=re("NEW_TURN_MODE");c===1?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(km(o.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(km(o.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=i.iceTransport;o&&(o.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();L.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o,c;if(i||(i=this.peerConnection.getSenders().find(F=>F.track===r._mediaStreamTrack)),!i)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return L.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Dn().supportSetRtpSenderParameters)return L.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(U,F){return U.getTransceivers().find(q=>q.sender.track===F||q.receiver.track===F)}(this.peerConnection,r._mediaStreamTrack),_=Gpe(r);if(rme(r)&&m&&i&&_&&this.getLocalVideoStats&&st(o=["vp8","vp9"]).call(o,this.store.codec)){var y;const U=u.degradationPreference||(st(y=r._hints).call(y,lr.CUSTOM_TRACK)?re("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(F,q,Y,le,Ee,ye){if(pP(F,Y),Ee(q),le!=="balanced"&&le!=="maintain-framerate"&&le!=="maintain-resolution")return;let ge=-1;u9(F,q);const ke=window.setInterval(()=>{const ut=hP.get(F);if(!re("ENABLE_AG_ADAPTATION")||!ut)return pP(F,Y),void Ee(q);const ft=ye();if(ft.sendPackets>0&&ft.OutgoingAvailableBandwidth>0){if(ge===-1)return void(ge=Date.now());if(Date.now()-ge<1e3)return;const yn=ft.sendFrameRate,vn=ft.OutgoingAvailableBandwidth,[ur,ni]=nme(F,yn,vn,ut.adaptationConfig,q,le);ni&&(Y.qualityLimitationReason=ni),ur&&ut.adaptationConfig.scale!==ur.scale&&(L.debug("[".concat(F,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(yn,", bwe ").concat(vn,", switch from ").concat(ut.adaptationConfig.scale," to ").concat(ur.scale," ")),ut.adaptationConfig=Px(Px({},ut.adaptationConfig),ur),Ee(ur))}},re("CHECK_LOCAL_STATS_INTERVAL")),qe=Px({},q);hP.set(F,{timer:ke,adaptationConfig:qe,originConfig:q,adaptationFunc:Ee}),L.debug("[".concat(F,"] start adaptation, originConfig: ").concat(JSON.stringify(q),", degradationPreference: ").concat(le))})(this.id+m.mid,_,this,U,F=>{i&&this.updateAdaptation(i,F)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:U,frameRate:F,scaleResolutionDownBy:q}=r._encoderConfig;U&&(h.maxBitrate=1e3*U),(st(S=r._hints).call(S,lr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(F&&(h.maxFramerate=cc(F)),q&&q>=1&&(h.scaleResolutionDownBy=q))}const{maxFramerate:R}=re("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),re("DSCP_TYPE")&&Bp()){var P;const U=re("DSCP_TYPE");st(P=["very-low","low","medium","high"]).call(P,U)&&(h.networkPriority=U)}const k=i.getParameters(),z=(c=k.encodings)===null||c===void 0?void 0:c[0];Mr()&&!z&&(u.encodings=[h]),z&&Object.assign(z,h),Object.assign(k,u),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(k.encodings))),await i.setParameters(k),await async function(U,F,q){try{var Y;if(!Dn().supportSetRtpSenderParameters||!function(ke){return ke==="vp9"||ke==="av1"}(U)||!re("ENABLE_SVC"))return;const le={},Ee={},ye=F.getParameters(),ge=(Y=ye.encodings)===null||Y===void 0?void 0:Y[0];Ee.scalabilityMode=nP(q),ge&&Object.assign(ge,Ee),Object.assign(ye,le),await F.setParameters(ye),L.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ye.encodings)))}catch(le){L.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",le)}}(this.store.codec,i,re("SVC_MODE"))}async updateAdaptation(r,i){var o,c;if(!r)return L.debug("[updateAdaptation] no rtpSender found");if(!Dn().supportSetRtpSenderParameters)return L.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:_}=i;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=cc(m)),_&&_>=1&&st(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const y=r.getParameters(),S=(c=y.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(y,{});try{await r.setParameters(y),L.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?L.debug("[updateAdaptation] peerConnection not connected}"):L.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):L.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!Dn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];u instanceof Er&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){const c=Na(r);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(zv(_,u),NG(_,u,this.store.codec))}),Am(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const y=r[_],S=i[_];if(S instanceof Er&&!st(o=S._hints).call(o,lr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,i){if(!Mr()&&r.length===i.length)for(let o=0;o<r.length;o++){const c=i[o];if(c instanceof Er&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var i,o,c,u,h;return!!(r instanceof Er&&re("SIMULCAST")&&this.store.codec==="vp8"&&!st(i=r._hints).call(i,lr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,o,c){if(re("SDP_LOGGING"))return L.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(Dn().supportPCSetConfiguration){const i=iE.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},vt(Tn.prototype,"updateRemoteRTPCapabilities",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateRemoteRTPCapabilities"),Tn.prototype),vt(Tn.prototype,"connect",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"connect"),Tn.prototype),vt(Tn.prototype,"updateRemoteConnect",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateRemoteConnect"),Tn.prototype),vt(Tn.prototype,"createDataChannels",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"createDataChannels"),Tn.prototype),vt(Tn.prototype,"receive",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"receive"),Tn.prototype),vt(Tn.prototype,"batchReceive",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"batchReceive"),Tn.prototype),vt(Tn.prototype,"stopReceiving",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"stopReceiving"),Tn.prototype),vt(Tn.prototype,"muteRemote",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"muteRemote"),Tn.prototype),vt(Tn.prototype,"unmuteRemote",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteRemote"),Tn.prototype),vt(Tn.prototype,"muteLocal",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"muteLocal"),Tn.prototype),vt(Tn.prototype,"unmuteLocal",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteLocal"),Tn.prototype),vt(Tn.prototype,"close",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"close"),Tn.prototype),vt(Tn.prototype,"updateEncoderConfig",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateEncoderConfig"),Tn.prototype),vt(Tn.prototype,"updateSendParameters",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateSendParameters"),Tn.prototype),vt(Tn.prototype,"replaceTrack",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"replaceTrack"),Tn.prototype),vt(Tn.prototype,"updateAdaptation",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateAdaptation"),Tn.prototype),vt(Tn.prototype,"getRemoteSSRC",[Zo],Object.getOwnPropertyDescriptor(Tn.prototype,"getRemoteSSRC"),Tn.prototype),Tn);function Zo(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function Dx(e,r){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=cc(r.width),o.height=cc(r.height);const c=cc(r.framerate||15);document.body.append(i),document.body.append(o);let u=e._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play();const h=o.getContext("2d");if(!h)throw new Oe(X.UNEXPECTED_ERROR,"can not get canvas context");const m=Dn(),_=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const S=i.videoWidth,R=i.videoHeight/S,P=o.width*R;Math.abs(P-o.height)>=2&&(L.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(P)),o.height=P)}h.drawImage(i,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,i.srcObject=new MediaStream([u]))},o.stopCapture=GL(()=>o.startCapture&&o.startCapture(),c);const y=_.stop;return _.stop=()=>{y.call(_),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),L.debug("clean low stream renderer")},_}var mP=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(mP||{}),di=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(di||{}),V_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(V_||{}),hi=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(hi||{}),F_=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(F_||{}),m9=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(m9||{}),yh=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(yh||{}),ea=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(ea||{}),g9=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(g9||{}),ta=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(ta||{}),gP=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(gP||{});const j_=1e3,B_=6,_P=3,ome=Math.max(B_,_P);function Ft(e,r,i){i!=null&&Number.isFinite(i)&&(e[r]=Math.round(Math.max(0,i)))}function _9(e){const r={[ta.CONN_TYPE]:0,[ta.RTT]:e.rtt,[ta.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[ta.CONN_TYPE]=1),i==="tcp"&&(r[ta.CONN_TYPE]=3),i==="tls"&&(r[ta.CONN_TYPE]=4);break}case"srflx":r[ta.CONN_TYPE]=2;break;case"unknown":r[ta.CONN_TYPE]=5;break;default:r[ta.CONN_TYPE]=0}return r}function E9(e){let r=0;switch(e){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class y9 extends kr{constructor(r){super(),K(this,"store",void 0),K(this,"uploadWRTCStatsTimer",void 0),K(this,"uploadOutboundDenoiserStatsTimer",void 0),K(this,"uploadExtStatsTimer",void 0),K(this,"uploadExtUsageStatsTimer",void 0),K(this,"uploadInboundExtStatsTimer",void 0),K(this,"requestStats",void 0),K(this,"requestTransportStats",void 0),K(this,"requestLocalMedia",void 0),K(this,"requestRemoteMedia",void 0),K(this,"requestAllTracks",void 0),K(this,"requestVideoIsReady",void 0),K(this,"requestUploadStats",void 0),K(this,"requestUpload",void 0),K(this,"uploadOutboundStarted",!1),K(this,"uploadInboundStarted",!1),K(this,"uploadTransportStarted",!1),K(this,"uploadBaseStatsStarted",!1),K(this,"uploadExtensionUsageStarted",!1),K(this,"lastRecvStats",void 0),K(this,"lastSendStats",void 0),K(this,"lastRefRecvStats",void 0),K(this,"lastRefSendStats",void 0),K(this,"lastFullRecvStats",void 0),K(this,"lastFullSendStats",void 0),K(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const i=r%_P==0,o=r%B_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const y=this.getTransportStats(c,u,i);y&&(m.misc=[y])}if(this.uploadOutboundStarted&&c){const y=this.getOutboundStats(c,o?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,o);y&&(m.outbound=[y])}if(this.uploadInboundStarted&&u){const y=this.getInboundStats(u,o?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,o);y&&(m.inbound=y)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[gP.RTC_PEER_CONNECTION_STATE]=PL[_]):m.misc=[{addition:{[gP.RTC_PEER_CONNECTION_STATE]:PL[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,o;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[gP.RTC_PEER_CONNECTION_STATE]:PL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===ome+1&&(r=1)},j_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,i,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[ta.RTT]:r.rtt,[ta.CONN_TYPE]:void 0,[ta.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=_9(r);if(this.store.useP2P){if(i){const u=_9(i);c[ta.CONN_TYPE]+=u[ta.CONN_TYPE]<<3}c[ta.CONN_TYPE]+=110}else c[ta.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,_;return u.forEach(y=>{let[S,{track:R,ssrcs:P}]=y;switch(S){case $e.LocalVideoLowTrack:case $e.LocalVideoTrack:if(S===$e.LocalVideoTrack){const k=function(F,q,Y,le,Ee,ye){const ge=q.videoSend.find(ft=>ft.ssrc===F);if(!ge)return;const ke={},{sentFrame:qe,inputFrame:ut}=ge;if(ye&&(Ft(ke,di.QP_SUM,ge.qpSumPerFrame),ut&&qe)){const ft=ut.frameRate,yn=qe.frameRate;ke[di.FREEZE]=function(vn,ur){let ni=!0;return ni=!(vn<=5)&&(vn<=10?ur<3:vn<=20?ur<4:ur<5),ni}(ft,yn)?1:0}if(Ee){switch(qe&&(Ft(ke,di.HEIGHT,qe.height),Ft(ke,di.WIDTH,qe.width),Ft(ke,di.FRAME_RATE,qe.frameRate)),ke[di.DISABLED]=le._originMediaStreamTrack&&!le._originMediaStreamTrack.enabled||le._mediaStreamTrack&&!le._mediaStreamTrack.enabled?1:0,ge.adaptionChangeReason){case"none":ke[di.ADAPTATION]=0;break;case"cpu":ke[di.ADAPTATION]=1;break;case"bandwidth":ke[di.ADAPTATION]=2;break;case"other":ke[di.ADAPTATION]=3}let ft=0;ge.adaptionChangeReason&&(ft+=E9(ge.adaptionChangeReason)),q.qualityLimitationReason&&(ft+=E9(q.qualityLimitationReason)<<3),ke[di.ADAPTATION]=ft,ke[di.PLAYER_STATUS]=WL[le._player?le._player.videoElementStatus:"uninit"],Ft(ke,di.NACKS,ge.nacksCount),Ft(ke,di.PLIS,ge.plisCount),Ft(ke,di.FIRS,ge.firsCount),Ft(ke,di.AVG_ENCODE,ge.avgEncodeMs),Ft(ke,di.HUGE_FRAME_SENT,ge.hugeFramesSent),Ft(ke,di.BYTES_RETRANSMIT,ge.retransmittedBytesSent),Ft(ke,di.PACKAGES_RETRANSMIT,ge.retransmittedPacketsSent),Ft(ke,di.KEY_FRAMES_ENCODED,ge.keyFramesEncoded);const yn=Y&&Y.videoSend.find(vn=>vn.ssrc===F);if(yn){let vn=Ee?j_:j_*B_;yn.timestamp&&ge.timestamp&&(vn=ge.timestamp-yn.timestamp),yn.packets!=null&&ge.packets!=null&&Ft(ke,di.PACKAGE_RATE,1e3*(ge.packets-yn.packets)/vn),ge.packetsLost!=null&&yn.packetsLost!=null&&Ft(ke,di.PACKAGE_LOST,ge.packetsLost-yn.packetsLost),yn.bytes!=null&&ge.bytes!=null&&Ft(ke,di.BITRATE,8*(ge.bytes-yn.bytes)/vn)}}return ke}(P[0].ssrcId,r,i,R,o,c),z=R&&function(F,q,Y,le){const Ee=q.videoSend.find(ge=>ge.ssrc===F);if(!Ee)return null;const ye={};if(le){const ge=Ee.inputFrame,ke=ge&&ge.height||Y.videoHeight||0,qe=ge&&ge.width||Y.videoWidth||0,ut=ge&&ge.frameRate||0;Ft(ye,mP.HEIGHT,ke),Ft(ye,mP.WIDTH,qe),Ft(ye,mP.FRAME_RATE,ut)}return ye}(P[0].ssrcId,r,R,o),U=function(F,q){const Y={};return q&&(Ft(Y,di.RETRANSMIT,F.bitrate.retransmit),Ft(Y,di.TARGET_ENCODED,F.bitrate.targetEncoded),Ft(Y,di.ACTUAL_ENCODED,F.bitrate.actualEncoded),Ft(Y,di.TRANSMIT,F.bitrate.transmit),Ft(Y,di.BANDWIDTH,F.sendBandwidth)),Y}(r,o);m=Object.assign({},k,z,U)}else _=function(k,z,U,F){const q=z.videoSend.find(le=>le.ssrc===k);if(!q)return;const Y={};if(F){const le=q.sentFrame;if(le&&(Ft(Y,V_.HEIGHT,le.height),Ft(Y,V_.WIDTH,le.width),Ft(Y,V_.FRAME_RATE,le.frameRate)),U){const Ee=U.videoSend.find(ye=>ye.ssrc===k);if(Ee){let ye=j_*B_;Ee.timestamp&&q.timestamp&&(ye=q.timestamp-Ee.timestamp),Ee.packets!=null&&q.packets!=null&&Ft(Y,V_.PACKAGE_RATE,1e3*(q.packets-Ee.packets)/ye),q.packetsLost!=null&&Ee.packetsLost!=null&&Ft(Y,V_.PACKAGE_LOST,q.packetsLost-Ee.packetsLost),Ee.bytes!=null&&q.bytes!=null&&Ft(Y,V_.BITRATE,8*(q.bytes-Ee.bytes)/ye)}}}return Y}(P[0].ssrcId,r,i,o);break;case $e.LocalAudioTrack:h=R&&function(k,z,U,F,q){const Y=z.audioSend.find(Ee=>Ee.ssrc===k);if(!Y)return;const le={};if(q){le[yh.DISABLED]=F._originMediaStreamTrack&&!F._originMediaStreamTrack.enabled||F._mediaStreamTrack&&!F._mediaStreamTrack.enabled?1:0;const Ee=100*F._source.getAccurateVolumeLevel(),ye=Y.inputLevel;if(ye!=null){const ke=Math.ceil(50*Math.log10(100*ye+1));Ft(le,yh.LEVEL,ke)}Ft(le,m9.PCM_LEVEL,Ee),Ft(le,yh.AEC_RETURN_LOSS,Y.aecReturnLoss),Ft(le,yh.AEC_RETURN_LOSS_ENH,Y.aecReturnLossEnhancement),Ft(le,yh.BYTES_RETRANSMIT,Y.retransmittedBytesSent),Ft(le,yh.PACKAGES_RETRANSMIT,Y.retransmittedPacketsSent),le[yh.FREEZE]=0;const ge=U&&U.audioSend.find(ke=>ke.ssrc===k);if(ge){let ke=j_*B_;ge.timestamp&&Y.timestamp&&(ke=Y.timestamp-ge.timestamp),ge.bytes!=null&&Y.bytes!=null&&Ft(le,yh.BITRATE,8*(Y.bytes-ge.bytes)/ke),ge.packets!=null&&Y.packets!=null&&Ft(le,yh.PACKAGE_RATE,1e3*(Y.packets-ge.packets)/ke)}}return le}(P[0].ssrcId,r,i,R,o)}}),{high:m,low:_,audio:h}}getInboundStats(r,i,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[_,y]=m;const S={peer:_.uid};if(y.has(gt.VIDEO)&&_.videoTrack){const R=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,P=_.videoTrack?function(k,z,U,F,q,Y,le,Ee){const ye=z.videoRecv.find(vn=>vn.ssrc===k);if(!ye)return;const ge={},{receivedFrame:ke,outputFrame:qe,decodeFrameRate:ut}=ye,ft=U&&U.videoRecv.find(vn=>vn.ssrc===k);if(Ft(ge,F_.FRAME_RATE_DECODE,ut),ye.framesRateFirefox&&Ft(ge,hi.FRAME_RATE,ye.framesRateFirefox),ke&&Ft(ge,hi.FRAME_RATE,ke.frameRate),Ft(ge,hi.FRAMES_DROPPED,ye.framesDroppedCount),Ft(ge,hi.BYTES_RETRANSMIT,ye.retransmittedBytesReceived),Ft(ge,hi.PACKAGES_RETRANSMIT,ye.retransmittedPacketsReceived),Ft(ge,hi.PACKAGES_DISCARDED,ye.packetsDiscarded),Ft(ge,hi.AVG_DECODE,ye.avgDecodeMs),Ft(ge,hi.AVG_PROCESSING_DELAY,ye.avgProcessingDelayMs),Ft(ge,hi.AVG_ASSEMBLY_TIME,ye.avgFramesAssembledFromMultiplePacketsMs),Ft(ge,hi.AVG_INTER_FRAME_DELAY,ye.avgInterFrameDelayMs),Ft(ge,hi.KEY_FRAMES_DECODED,ye.keyFramesDecoded),ft){const vn=z.timestamp-U.timestamp||j_*(Ee?B_:le?_P:1);ye.packetsLost!=null&&ft.packetsLost!=null&&Ft(ge,hi.PACKAGE_LOST,ye.packetsLost-ft.packetsLost),ft.bytes!=null&&ye.bytes!=null&&Ft(ge,hi.BITRATE,8*(ye.bytes-ft.bytes)/vn),ft.packets!=null&&ye.packets!=null&&Ft(ge,hi.PACKAGE_RATE,1e3*(ye.packets-ft.packets)/vn)}if(Ee&&(Ft(ge,hi.QP_SUM,ye.qpSumPerFrame),ge[hi.FREEZE]=q&&OT.isRemoteVideoFreeze(F,ye,ft)?1:0),le){var yn;ke?(Ft(ge,hi.HEIGHT,ke.height),Ft(ge,hi.WIDTH,ke.width)):F&&(Ft(ge,hi.HEIGHT,F._videoHeight||0),Ft(ge,hi.WIDTH,F._videoWidth||0)),qe&&Ft(ge,F_.FRAME_RATE_OUTPUT,qe.frameRate);const vn=(yn=F._player)===null||yn===void 0?void 0:yn.rendFrameRate.toFixed(0);if(vn&&Ft(ge,F_.FRAME_RATE_RENDER,+vn),Ft(ge,hi.JITTER_BUFFER,ye.jitterBufferMs),Ft(ge,hi.CURRENT_DELAY,ye.currentDelayMs),Ft(ge,hi.FIRS,ye.firsCount),Ft(ge,hi.NACKS,ye.nacksCount),Ft(ge,hi.PLIS,ye.plisCount),F){ge[hi.DISABLED]=F._originMediaStreamTrack.enabled&&F._mediaStreamTrack.enabled?0:1;const ur=F._player;if(ur){const{freezeTimeCounterList:ni,renderFreezeAccTime:Gr,videoElementStatus:ra}=ur;if(ni&&ni.length>0&&Ft(ge,F_.FREEZE_TIME,ni.splice(0,1)[0]),Y&&Gp.visibility==="visible"&&ra===ao.PLAYING&&Dn().supportRequestVideoFrameCallback){const je=Math.min(6e3,Gr);ur.renderFreezeAccTime=Math.max(0,Gr-je),Ft(ge,F_.FREEZE_TIME_RENDER,je)}if(typeof ye.totalFreezesDuration=="number"){const je=ft&&ft.totalFreezesDuration?ye.totalFreezesDuration-ft.totalFreezesDuration:ye.totalFreezesDuration;Ft(ge,F_.FREEZE_DURATION,1e3*je)}}}if(ge[hi.PLAYER_STATUS]=WL[F._player?F._player.videoElementStatus:"uninit"],ft&&ye.totalInterFrameDelay!==void 0&&ye.totalSquaredInterFrameDelay!==void 0&&ft.totalInterFrameDelay!==void 0&&ft.totalSquaredInterFrameDelay!==void 0){const ur=ye.totalInterFrameDelay-ft.totalInterFrameDelay,ni=ye.totalSquaredInterFrameDelay-ft.totalSquaredInterFrameDelay,Gr=ye.framesDecodeCount-ft.framesDecodeCount,ra=ur/Gr*1e3,je=Math.round(1e3*Math.sqrt((ni-Math.pow(ur,2)/Gr)/Gr));!isNaN(je)&&ra+je>Math.max(3*ra,ra+150)&&(ge[hi.I_FRAME_DELAY]=je)}}return ge}(_._videoSSRC,r,i,_.videoTrack,R===!0,this.needUploadRenderFreezeTime,o,c):void 0;P&&(S.video=P)}if(y.has(gt.AUDIO)&&_.audioTrack){const R=_.audioTrack?function(P,k,z,U,F,q){const Y=k.audioRecv.find(ge=>ge.ssrc===P);if(!Y)return;const le={},Ee=z&&z.audioRecv.find(ge=>ge.ssrc===P);if(Ft(le,ea.JITTER,Y.jitterMs),Ft(le,ea.BYTES_RETRANSMIT,Y.retransmittedBytesReceived),Ft(le,ea.PACKAGES_RETRANSMIT,Y.retransmittedPacketsReceived),Ft(le,ea.PACKAGES_DISCARDED,Y.packetsDiscarded),Ft(le,ea.AVG_PROCESSING_DELAY,Y.avgProcessingDelayMs),Ee){const ge=k.timestamp-z.timestamp||j_*(q?B_:F?_P:1);Y.packets!=null&&Ee.packets!=null&&Ft(le,ea.PACKAGE_RATE,1e3*(Y.packets-Ee.packets)/ge),F&&Ee.bytes!=null&&Y.bytes!=null&&Ft(le,ea.BITRATE,8*(Y.bytes-Ee.bytes)/ge),Y.packetsLost!=null&&Ee.packetsLost!=null&&Ft(le,ea.PACKAGE_LOST,Y.packetsLost-Ee.packetsLost)}if(q){const{receivedFrames:ge,droppedFrames:ke}=Y;ge!=null&&ke!=null&&(le[ea.FREEZE]=(ye=ge)===0||100*ke/ye>20?1:0)}var ye;if(F){const ge=100*U._source.getAccurateVolumeLevel(),ke=Y.outputLevel;if(ke!=null){const qe=Math.ceil(50*Math.log10(100*ke+1));Ft(le,g9.LEVEL,qe)}if(Ft(le,ea.PCM_LEVEL,ge),U&&(le[ea.DISABLED]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),Ft(le,ea.JITTER_BUFFER,Y.jitterBufferMs),Ft(le,ea.CURRENT_DELAY,Y.jitterBufferMs),le[ea.PLAYER_STATUS]=WL[Qo.getPlayerState(U.getTrackId())],Ee){const qe=Y.concealedSamples-Ee.concealedSamples;qe>0&&Ft(le,ea.CONCEALED_SAMPLES,qe);const ut=Y.totalSamplesReceived-Ee.totalSamplesReceived;ut>0&&Ft(le,ea.TOTAL_SAMPLES_RECEIVED,ut)}}return le}(_._audioSSRC,r,i,_.audioTrack,o,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(i=>i instanceof jA);if(r&&r._external.getDenoiserStats){const i=r._external.getDenoiserStats();i&&this.requestUpload(vT.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[i,o]=r;o.has(gt.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(gt.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),o={connectionInterval:re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const y of u)!y.muted&&y.enabled&&(c=c.concat(await y.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[y,S]of h)S.has(gt.VIDEO)&&y.videoTrack&&(c=c.concat(await y.videoTrack.getProcessorUsage())),S.has(gt.AUDIO)&&y.audioTrack&&(c=c.concat(await y.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(y,S){const R={};for(const{id:U,value:F,level:q,direction:Y}of y){var P;const le=(P=S.get(U))!==null&&P!==void 0?P:0,Ee=F===2?le+re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:le;var k,z;S.set(U,Ee),R[U]?(F===2&&(R[U].value=F),q>R[U].level&&(R[U].level=q),Y==="remote"&&(R[U].remoteUidCount+=1),R[U].totalTs=(k=S.get(U))!==null&&k!==void 0?k:0):R[U]={value:F,level:q,remoteUidCount:Y==="local"?0:1,totalTs:(z=S.get(U))!==null&&z!==void 0?z:0}}return Object.keys(R).map(U=>{const{level:F,value:q,totalTs:Y}=R[U];return{id:U,level:F,value:q,totalTs:Y}})}(c,r);const m=Date.now(),_=m>i?m:i+1;this.requestUpload&&this.requestUpload(vT.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},re("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const ame=re("ICE_RESTART_INTERVAL");let EP=new Map,qv=new Map,Mm=[Vs.UDP_TCP_RELAY,Vs.TCP_RELAY,Vs.RELAY],Lx=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Dn().supportPCSetConfiguration;function v9(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=EP.get(e.id);i&&(window.clearTimeout(i),EP.delete(e.id));const o=qv.get(e.id);r&&o&&o.index===Mm.length-1&&(L.debug("[".concat(e.id,"] reset ICE restart policy")),qv.delete(e.id))}function S9(e,r,i){if(EP.size===0&&qv.size===0&&(Array.isArray(re("RESTART_SEQUENCE"))&&re("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let y=0;y<m.length;y+=1){const S=m[y];if(m.filter(R=>R===S).length!==_.filter(R=>R===S).length)return!1}return!0}(Mm,re("RESTART_SEQUENCE"))&&(Mm=re("RESTART_SEQUENCE").filter(m=>{var _;if(st(_=Object.values(Vs)).call(_,m))return!0}),L.debug("use reconnection policy from config distribution, queues: ".concat(Mm.join(" => ")))),Lx=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Dn().supportPCSetConfiguration),Mm.length===0)return void i();let o,{index:c=0,type:u}=qv.get(e.id)||{};if(Lx&&u===Vs.RELAY)return void i();let h=u&&c>=Mm.length-1;if(Lx)u=Vs.RELAY;else{if(h)return void i();u?(c++,u=Mm[c]):(u=Mm[0],c=0)}L.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),qv.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>S9(e,r,i),ame),EP.set(e.id,o)}var dn;function b9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function vh(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?b9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):b9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function T9(e){var r,i,o,c=2;for(typeof Symbol<"u"&&(i=iL,o=Symbol.iterator);c--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new yP(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function yP(e){function r(i){if(Object(i)!==i)return lt.reject(new TypeError(i+" is not an object."));var o=i.done;return lt.resolve(i.value).then(function(c){return{value:c,done:o}})}return yP=function(i){this.s=i,this.n=i.next},yP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?lt.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?lt.reject(i):r(o.apply(this.s,arguments))}},new yP(e)}let NT=(dn=class extends kr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(kt.StateChange,r,this._state)}constructor(e,r){super(),K(this,"isPlanB",void 0),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"connection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"remoteDataChannelMap",new Map),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"pendingLocalDataChannels",[]),K(this,"pendingRemoteDataChannels",[]),K(this,"statsCollector",void 0),K(this,"shouldForwardP2PCreation",void 0),K(this,"iceFailedCount",0),K(this,"dtlsFailedCount",0),K(this,"mutex",void 0),K(this,"_state",Hn.Disconnected),K(this,"_pcStatsUploadType",re("NEW_ICE_RESTART")?qp.FIRST_CONNECTION:qp.OLD_FIRST_CONNECTION),K(this,"_isStartRestartIce",!1),K(this,"_restartTimer",void 0),K(this,"_isTryConnecting",!1),K(this,"_iceError",null),K(this,"_forceTurn",!1),K(this,"_isWaitPcToRePub",!1),K(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Hn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createMuteMessage(h);await ar(this,kt.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Hn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");if(m){const y=m[1];if(y.track._originMediaStreamTrack.stop(),!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding){const S=i._mediaStreamTrack.clone();y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}else{const S=Dx(i,pT(this,kt.RequestLowStreamParameter));y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}await new lt((S,R)=>{this.handleReplaceTrack(y.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createUnmuteMessage(h);await ar(this,kt.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!_||_.track!==i||this.state!==Hn.Connected)return void o();const{id:y,track:S}=_;await this.connection.updateSendParameters(y,S),await this.connection.updateEncoderConfig(y,S),this.emit(kt.UpdateVideoEncoder,S),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==Hn.Connected)return void o();const{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceMixingTrack",async(i,o,c,u)=>{if(!this.connection||this.state!==Hn.Connected)return void o();const h=kx([i]);let m;L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),o()}catch(y){c(y)}finally{var _;(_=m)===null||_===void 0||_()}}),K(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;L.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return i===R});if(!this.connection||!y||this.state!==Hn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),this.isPlanB){const S=y[1];S.id=i._mediaStreamTrack.id,this.localTrackMap.set(y[0],S)}if(y[0]===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const R=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new lt((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),K(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),K(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new y9(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ms("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Dn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Bp(),this.shouldForwardP2PCreation=re("FORWARD_P2P_CREATION")&&Dn().supportPCSetConfiguration&&gL(),this.shouldForwardP2PCreation&&(this.connection=fP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var r;this.state=Hn.New,this._forceTurn=p9(e),L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=fP(this.store,e),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=re("NEW_ICE_RESTART")?qp.FIRST_CONNECTION:qp.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");re("ENABLE_PREALLOC_PC")&&this.state===Hn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Hn.Connected)}updateRemoteRTPCapabilities(e){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return st(u=[$e.LocalVideoLowTrack,$e.LocalVideoTrack]).call(u,h)}),i=r.map(c=>{let[,{id:u}]=c;return u}),o=r.map(c=>{let[u]=c;return u});if(this.connection instanceof Eh){if(Rt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!st(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>st(e).call(e,u));c&&(this.store.codec=c,L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof Eh&&this.connection.peerConnectionState!=="closed"&&st(e=[Hn.New,Hn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Hn.Connected){if(this.state===Hn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;st(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}const r=this.filterTobePublishedDataChannels(e);return r.length===0?[]:(r.forEach(i=>{const o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);const o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,r,i){var o=this;return yl(function*(){const c=yield Rn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&st(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Hn.Connected||h){if(o.state===Hn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const _=e.filter(y=>o.pendingLocalTracks.indexOf(y)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Fs.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(e,r,i);if(m.length===0)return void(yield Rn(o.tryToUnmuteAudio(e)));yield*pA(T9(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(e,r){var i=this;return yl(function*(){r.forEach(P=>{let{track:k,type:z}=P;const U=Date.now();i.store.publish(k.getTrackId(),z===$e.LocalAudioTrack?"audio":"video",U)}),i.bindLocalTrackEvents(r);const o=r.map(P=>{let{track:k}=P;return k}),c=yield Rn(e.send(o,i.store.codec,i.store.audioCodec)),u=(yield Rn(c.next())).value,h=i.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===X.WS_ABORT&&r.forEach(k=>{let{track:z}=k;i.pendingLocalTracks.indexOf(z)===-1&&i.pendingLocalTracks.push(z)}),i.unbindLocalTrackEvents(r),P}const _=i.mapPubResToRemoteConfig(h,m,o),y=(yield Rn(c.next(_))).value;if(i.state===Hn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");re("ENABLE_VIDEO_SEI");const S=re("ENABLE_ENCODED_TRANSFORM"),R=re("ENABLE_AUDIO_METADATA");o.forEach(async P=>{const k=P.getRTCRtpTransceiver();if(!k||!S)return;const{interceptLocalVideoFrame:z,interceptLocalAudioFrame:U}=aP();P.trackMediaType===gt.VIDEO?await z(k.sender,P):P.trackMediaType===gt.AUDIO&&await U(k.sender,{metadata:R?()=>{const F=P.metadata.shift();return F&&F.value}:void 0})}),r.forEach(P=>{let{type:k}=P;i.statsCollector.addLocalStats(k)}),i.assignLocalTracks(r,y),i.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:k,type:z}=P;const U=Date.now();i.store.publish(k.getTrackId(),z===$e.LocalAudioTrack?"audio":"video",void 0,U)})})()}async updateVideoStreamParameter(e,r){const i=this.localTrackMap.get(r);if(!i||!this.connection)return;if(!(i.track instanceof Er))return L.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=i,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=mx(u,h)),m.maxFramerate=u.framerate?cc(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(e,o);if(o._encoderConfig||(o._encoderConfig={}),r!==$e.LocalVideoLowTrack||!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return L.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const _=h.canvas;m.width&&(_.width=cc(m.width)),m.height&&(_.height=cc(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=GL(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},cc(m.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),L.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var r=this;return yl(function*(){if(!r.connection||r.state!==Hn.Connected)return;const i=yield Rn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get($e.LocalVideoTrack);if(!c)throw new Le(X.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has($e.LocalVideoLowTrack))throw new Le(X.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,e),type:$e.LocalVideoLowTrack}];if(yield*pA(T9(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get($e.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield Rn(r.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(L.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Is(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(L.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Is(this,kt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:i,kind:o}=this.pendingRemoteTracks[r];(o!==gt.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==gt.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(e)await Is(this,kt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===gt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(kt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Hn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(e){if(!this.connection||this.state!==Hn.Connected)return void e.forEach(i=>{const o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(e);return r.length!==0?(r.forEach(i=>{const o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Hn.Connected)return;const e=this.localTrackMap.get($e.LocalVideoLowTrack);if(!e)return;e.track.close();const r=[[$e.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,r)}async doUnpublish(e,r){const i=this.createGatewayUnpublishMessage(r);return await e.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,r){if(!this.connection||this.state!==Hn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:_}=h;return m.uid===e.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(o=>o.id)}async subscribe(e,r,i,o,c){var u;if(!this.connection||this.state!==Hn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(r))return;let h,m,_;const y=this.connection.getPreMedia(i);if(y)L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),_=y.transceiver,h=y.track,m=y.id;else if(c){const P=c.find(z=>{let{stream_type:U}=z;return U===r});if(!P)throw new Le(X.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const k=await this.connection.receive(r,P.ssrcs,String(e._uintid),P.attributes);this.connection instanceof Eh&&(_=k.transceiver),h=k.track,m=k.id}else{const P=await this.connection.receive(r,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof Eh&&(_=P.transceiver),h=P.track,m=P.id}if(r===gt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new xv(h,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new Lv(h,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:k}=aP();r==gt.VIDEO?await P(_.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(z=>{var U;return(U=e._videoTrack)===null||U===void 0?void 0:U._onSei(z)})}):r==gt.AUDIO&&await k(_.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:z=>{this.safeEmit(kt.AudioMetadata,z)}})}const S=this.remoteUserMap.get(e);S?S.set(r,m):this.remoteUserMap.set(e,new Map([[r,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:k,kind:z}=P;return k.uid===e.uid&&r===z});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(kt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Hn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],i=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?i.set(c.ssrcId,u):r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{i.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const m=i.get(h);if(!m)return void L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:y,transceiver:S}=m;if(S&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:z}=aP();u==gt.VIDEO?await k(S.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(U=>{var F;return(F=c._videoTrack)===null||F===void 0?void 0:F._onSei(U)})}):u==gt.AUDIO&&await z(S.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:U=>{this.safeEmit(kt.AudioMetadata,U)}})}if(u===gt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new xv(_,c.uid,c._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new Lv(_,c.uid,c._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),re("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:z}=aP();u==gt.VIDEO?await k(S.receiver,{onSei:U=>{var F;(F=c._videoTrack)===null||F===void 0||F._onSei(U)}}):u==gt.AUDIO&&await z(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,y):this.remoteUserMap.set(c,new Map([[u,y]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(k=>{let{user:z,kind:U}=k;return z.uid===c.uid&&u===U});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(kt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,r,i){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:_}=h;return r!==void 0?m.uid===e.uid&&r===_:m.uid===e.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Hn.Connected||i||o.forEach(h=>{let{kind:m}=h;var _;if(m===gt.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(m===gt.VIDEO){var y;(y=e._videoTrack)===null||y===void 0||y._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Hn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:_}]=h;var y,S;if(_===gt.VIDEO&&m._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===gt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),i||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(_===gt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!i&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,r);if(i.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return i.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let r=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:y}=m;return u!==void 0?_.uid===c.uid&&u===y:_.uid===c.uid});h.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),r=r.concat(h)}if(!this.connection||this.state!==Hn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===gt.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===gt.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const i=ec(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u;const _=this.filterTobeUnSubscribedTracks(h,m);return c.concat(_)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var m,_;if(h===gt.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===gt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===gt.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),(y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==Hn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void L.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void L.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===gt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void L.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||L.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}addAudioMetadata(e){const r=this.localTrackMap.get($e.LocalAudioTrack),i=r&&r.track;i&&i.metadata.push(e)}getAllTracks(e){const r=this.localTrackMap.get($e.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ci){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==$e.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===$e.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,r,i,o,c){if(e){const h=this.localTrackMap.get($e.LocalAudioTrack),m=o?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);Rt.publish(this.store.sessionId,{eventElapse:Fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(lr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof zr),m=o?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof Er);Rt.publish(this.store.sessionId,{eventElapse:Fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(lr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,i,o){const c=o===gt.VIDEO?i._videoSSRC:i._audioSSRC;c&&Rt.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===gt.VIDEO,audio:o===gt.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Fs.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){L.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ms("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=fP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get($e.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ci){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Hn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get($e.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get($e.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof Er||r&&r.track instanceof zr?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(Fc(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get($e.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xb(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(L.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Hn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=fP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case $e.LocalVideoTrack:st(r=o._hints).call(r,lr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case $e.LocalAudioTrack:o instanceof Ci?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case $e.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Fc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Fc(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),L.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,r){for(const i of this.pendingRemoteDataChannels){const{user:o,id:c}=i;if((e instanceof xm?e.uid:e)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(e,r){this.hasPendingRemoteDataChannel(e,r)||this.pendingRemoteDataChannels.push({user:e,id:r})}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof xm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}restartICE(e){var r=this;return yl(function*(){if(!r.connection||r.state!==Hn.Connected)return;const i=yield Rn(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Rn(r.connection.restartICE(e));const u=yield Rn(o.next());if(u.done)return;const h=u.value,m=yield h;switch(Nx(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),e){case Vs.UDP_TCP_RELAY:r._pcStatsUploadType=qp.UDP_TCP_RESTART;break;case Vs.TCP_RELAY:r._pcStatsUploadType=qp.TCP_RESTART;break;case Vs.RELAY:r._pcStatsUploadType=qp.RELAY_RESTART;break;default:r._pcStatsUploadType=qp.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),r=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalAudioTrack),o=e.videoSend.find(k=>k.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=e.audioSend.find(k=>k.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=Uc(this,kt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(lr.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,z=e.bitrate.actualEncoded;if(k&&z){const U=(1e3*k-z)/(1e3*k);return rG[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(z=>z.ssrc===c),m=e.videoRecv.find(z=>z.ssrc===u);if(!h&&!m)return void(r+=1);const _=Uc(this,kt.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new lt((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}async replaceTrack(e,r){var i;if(L.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Hn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==r&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,o[1].id)),this.isPlanB){const u=o[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding){const u=this.localTrackMap.get($e.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new lt((m,_)=>{this.handleReplaceTrack(u.track,m,_,!0)})}}}filterTobePublishedTracks(e,r,i){const o=[],c=this.getAllTracks();e=Sv(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const m=this.localTrackMap.get($e.LocalAudioTrack);for(const _ of e){if(_ instanceof Er&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:$e.LocalVideoTrack}),h=!0),r)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:$e.LocalVideoLowTrack})}if(_ instanceof zr)if(m){const y=m.track;if(y instanceof Ci)Ox([_]),y.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=kx([y,_]);L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(y,S)}}else u instanceof Ci?(Ox([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&Dn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=kx(u?[_,u]:[_]):u=_}return u&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:$e.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=Sv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof zr){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ci?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([$e.LocalAudioTrack,c]),c.track.close())):r.push([$e.LocalAudioTrack,c])}if(o instanceof Er){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;r.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&r.push([$e.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(e){return e=(e=Sv(e)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Sv(e)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case $e.LocalVideoTrack:i.addListener(_t.GET_STATS,this.handleGetLocalVideoStats),i.addListener(_t.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(_t.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(_t.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Ci?e.trackList.forEach(i=>{i.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(_t.GET_STATS,this.handleGetLocalAudioStats),i.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(_t.GET_STATS,this.handleGetLocalAudioStats),e.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(e.addListener(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(_t.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case $e.LocalVideoTrack:i.off(_t.GET_STATS,this.handleGetLocalVideoStats),i.off(_t.GET_RTC_STATS,this.handleGetRTCStats),i.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(_t.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(_t.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ci?e.trackList.forEach(r=>{r.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(_t.GET_STATS,this.handleGetLocalAudioStats),r.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(_t.GET_STATS,this.handleGetLocalAudioStats),e.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(_t.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Lv&&r.addListener(_t.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof xv&&r.addListener(_t.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(_t.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var c;let u,h,{track:m,type:_}=i;switch(_){case $e.LocalAudioTrack:u=$n.Audio,h={dtx:m instanceof jA&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case $e.LocalVideoTrack:u=st(c=m._hints).call(c,lr.SCREEN_TRACK)?$n.Screen:$n.High,h=vh(vh({},SG(m)),{},{codec:this.store.codec,svc_mode:nP()});break;case $e.LocalVideoLowTrack:u=$n.Low,h=vh(vh({},SG(m)),{},{codec:this.store.codec,svc_mode:nP()})}return{stream_type:u,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalVideoTrack:o=st(i=u._hints).call(i,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{if(L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r==="connecting"&&e instanceof Eh&&!Mr()&&re("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&e.extendCandidate()},re("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Eh&&v9(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=qp.DISCONNECTED_OR_FAILED,Uc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Rt.reportApiInvoke(this.store.sessionId,{name:yi.REPUB_AFTER_PC_CONNECTED,options:i.concat(o),tag:Vr.TRACER}).onSuccess(),this.republish()}if(re("NEW_ICE_RESTART")&&e instanceof Eh&&!Mr()&&!this._forceTurn){if(st(fG).call(fG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{Nx(e)&&(L.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Uc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE,c))},o=()=>{Nx(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),L.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{S9(e,i,o)},800))}}else{if(r==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&re("ICE_RESTART")&&Uc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Rt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Vr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const o=Array.from(Fc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Pv.FIRST_FRAME_DECODED),Rt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_DECODE,Ir.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Fs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const o=Array.from(Fc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_RECEIVED,Ir.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Fs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;const o=Array.from(Fc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_VIDEO_RECEIVED,Ir.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Fs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{const o=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(kt.ConnectionTypeChange,o),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Nm(i))," -> ").concat(JSON.stringify(Nm(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Nm(i))," -> ").concat(JSON.stringify(Nm(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return vh(vh({},r),i)},e.onICECandidateError=r=>{this._iceError=r}}resetConnection(e){e instanceof Eh&&function(r){qv.delete(r.id),v9(r)}(e),e.close(),this.emit(kt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof zr&&(i==null?void 0:i.track)instanceof Ci)return i.track.isActive||r.push([$e.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof zr&&(i==null?void 0:i.track)instanceof Ci)return i.track.isActive&&r.push([$e.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===$e.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoTrack:o=st(i=u._hints).call(i,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoTrack:o=st(i=u._hints).call(i,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){const c=o.get(r);if(!c)return i;i.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(e,r){const i=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case gt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:o._videoSSRC}));case gt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(e){const r=new Map;return e.forEach(i=>{let[o,{kind:c}]=i;if(r.has(o)){let u=r.get(o);c===gt.VIDEO?u|=Wi.Video:u|=Wi.Audio,r.set(o,u)}else c===gt.VIDEO?r.set(o,Wi.Video):r.set(o,Wi.Audio)}),{users:Array.from(r.entries()).map(i=>{let[o,c]=i;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new lt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new lt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,r,i){return e.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=r.find(_=>{let{stream_type:y}=_;return h===y}))===null||u===void 0?void 0:u.attributes;if(m&&re("DISABLE_SCREEN_SHARE_REMB")){const _=i[c]._hints;(st(_).call(_,lr.SCREEN_TRACK)||st(_).call(_,lr.SCREEN_LOW_TRACK))&&(m.remb=!1,L.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof zr){var r;const o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await ar(this,kt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(kt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(kt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await cs(wL(this.dtlsFailedCount,vi)),this.emit(kt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),r.length>0&&await Is(this,kt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(kt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Er)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof Er).length>1)throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof zr).length>1&&(e.some(r=>r instanceof zr&&r._bypassWebAudio)||!Dn().webAudioMediaStreamDest))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof Er&&this.pendingLocalTracks.some(i=>i instanceof Er))throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof zr&&this.pendingLocalTracks.some(i=>i instanceof zr)&&(!Dn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof zr&&i._bypassWebAudio)))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){var i;const o=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding,c=vh(vh({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=o?e._mediaStreamTrack.clone():Dx(e,c);const h=cr(8,"track-low-"),m=new Er(u,vh(vh({},o&&{scaleResolutionDownBy:mx(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(P_.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,Iv.LOW_STREAM)}),m._hints.push(lr.LOW_STREAM),st(i=e._hints).call(i,lr.SCREEN_TRACK)&&m._hints.push(lr.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),e.addListener(_t.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,r,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Eh){var c,u,h,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:P,remote:k}=await this.connection.getSelectedCandidatePair();Rt.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:y,dtlsstate:S,connectionstate:R,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=k.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=k.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(k.address,":").concat(k.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,r,i,o){var c;const u=Array.from(Fc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");Rt.firstRemoteVideoDecode(this.store.sessionId,Bi.FIRST_VIDEO_DECODE,Ir.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Fs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===$e.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Iv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},vt(dn.prototype,"startP2PConnection",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"startP2PConnection"),dn.prototype),vt(dn.prototype,"connect",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"connect"),dn.prototype),vt(dn.prototype,"updateRemoteRTPCapabilities",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"updateRemoteRTPCapabilities"),dn.prototype),vt(dn.prototype,"publishDataChannel",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"publishDataChannel"),dn.prototype),vt(dn.prototype,"unpublish",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"unpublish"),dn.prototype),vt(dn.prototype,"unpublishDataChannel",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"unpublishDataChannel"),dn.prototype),vt(dn.prototype,"unpublishLowStream",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"unpublishLowStream"),dn.prototype),vt(dn.prototype,"subscribeDataChannel",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"subscribeDataChannel"),dn.prototype),vt(dn.prototype,"subscribe",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"subscribe"),dn.prototype),vt(dn.prototype,"massSubscribe",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"massSubscribe"),dn.prototype),vt(dn.prototype,"unsubscribe",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"unsubscribe"),dn.prototype),vt(dn.prototype,"unsubscribeDataChannel",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"unsubscribeDataChannel"),dn.prototype),vt(dn.prototype,"massUnsubscribe",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"massUnsubscribe"),dn.prototype),vt(dn.prototype,"muteRemote",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"muteRemote"),dn.prototype),vt(dn.prototype,"unmuteRemote",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"unmuteRemote"),dn.prototype),vt(dn.prototype,"hasRemoteMediaWithLock",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"hasRemoteMediaWithLock"),dn.prototype),vt(dn.prototype,"disconnectForReconnect",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"disconnectForReconnect"),dn.prototype),vt(dn.prototype,"updateBitrateLimit",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"updateBitrateLimit"),dn.prototype),vt(dn.prototype,"remoteMediaSsrcChanged",[lo],Object.getOwnPropertyDescriptor(dn.prototype,"remoteMediaSsrcChanged"),dn.prototype),dn);function lo(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function w9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function R9(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?w9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const cme=Date.now(),lme=20,xx=new Map,vP=new Map;async function C9(e){const r=xx.get(e),i=Array.isArray(r)&&r[r.length-1],o=vP.get(e);if(!i)return void(o.isSyncing=!1);const c={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);const u=i.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=i.mediaDelay+h;m<=0?(r.pop(),I9(i.context,c),m=0):m=Math.min(m,lme),setTimeout(()=>r.length&&C9(e),m)}function I9(e,r){e.safeEmit(mn.STREAM_MESSAGE,r.uid,r.payload),e.onStreamMessage&&e.onStreamMessage(r)}function ume(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return I9(i,{uid:e.uid,payload:e.payload});const o="".concat(i.id,"-").concat(e.uid),c=xx.get(o)||[],u=c.findIndex(y=>e.sendTs>=y.sendTs),h=R9(R9({},e),{},{context:i,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),xx.set(o,c);let m=!1;var _;vP.has(o)?m=!((_=vP.get(o))===null||_===void 0||!_.isSyncing):vP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||C9(o)}const dme=Cn().name;function A9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function P9(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?A9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):A9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Yv="websdk_ng_cache_parameter",hme=re("MAX_PRELOAD_ASYNC_LENGTH"),pme=1e4,W_=new Map,z_=[];let Mx=null,Ux=0,Vx=0;const SP=new Map,fme=function(e,r){const i=[];let o=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&o<r?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new lt(async(_,y)=>{i.push(async()=>{try{const S=await e(...h);_(S)}catch(S){y(S)}}),o<r&&(o++,c())})}}(O9,hme),Fx=Jo.CancelToken.source();async function O9(e,r,i,o,c,u){try{if(!re("ENABLE_PRELOAD"))return;if(!Dn().supportWebCrypto)return void Cm(()=>{L.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new Le(X.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&as(i,"token",1,2047),as(e,"appid",1,2047),JA(r),o&&QA(o);const h=I_();L.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:e,cname:r,token:i||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,y;typeof o=="string"?(m.stringUid=o,[y,_]=await lt.all([Xfe(o,{sid:h,appId:e},Fx.token),QG(P9(P9({},m),{},{token:i||e,uid:0}),Fx.token)]),m.uid=y.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),_=await QG(m,Fx.token));const S={sid:h,appId:e,cname:r,token:i||e,uid:m.stringUid||o,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:y,ap:_};await async function(R){let P;try{R.uid&&N9({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const k=M9(R),z=await async function(F,q){try{const Y=await window.crypto.subtle.importKey("raw",b8(q),"AES-GCM",!1,["encrypt"]),le=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,C_(window.btoa(JSON.stringify(F))));return Im(new Uint8Array(le))}catch{return}}(R,R.token||R.appId);if(!z)return;P=x9(Yv);const U=P?JSON.parse(P):[];U.push({[k]:z}),U.length>re("AP_CACHE_NUM")&&U.shift(),bP(Yv,JSON.stringify(U))}catch(k){L.warn("Error caching server parameters:",k.message),bP(Yv,"")}}(S),Ux++}catch(h){throw Vx++,function(m){Mx||(Mx=window.setTimeout(()=>{let y="";SP.forEach((S,R)=>{y+="".concat(R,": ").concat(S," ;")}),Rt.reportApiInvoke(null,{name:yi.PRELOAD,options:{success:Ux,failed:Vx,err:y}}).onError(m),Ux=0,Vx=0,SP.clear(),Mx=null},pme));const _=SP.get(m.code)||0;SP.set(m.code,_+1)}(h),h}}async function k9(e){try{if(re("AP_REQUEST_DETAIL")||re("ENABLE_ROLE_SELECT_EDGE"))return;const r=N9(e);if(!r||e.cloudProxyServer!=="disabled")return;const i=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",b8(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,C_(o));return JSON.parse(window.atob(Im(new Uint8Array(h))))}catch{return}}(r,e.token||e.appId);if(!i||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<re("AP_CACHE_LIFETIME"))return i}catch(r){L.warn("Error get preloadInfo",r.message)}}function N9(e){let r;try{if(r=x9(Yv),!r)return;const i=JSON.parse(r),o=M9(e),c=function(h,m){for(let _=h.length-1;_>=0;_--)if(m(h[_]))return _;return-1}(i,h=>o in h);if(c===-1)return;const u=i.splice(c,1)[0];return bP(Yv,JSON.stringify(i)),u[o]}catch(i){L.warn("Error delete preload info: ".concat(r),i.message),bP(Yv,"")}}function jx(e){if(e){let r=W_.get(e);r&&(window.clearTimeout(r),r=null,W_.delete(e)),st(z_).call(z_,e)||e.cloudProxyServer!=="disabled"||z_.push(e)}if(W_.size<re("AP_CACHE_NUM")&&z_.length>0){const r=z_.shift();W_.set(r,window.setTimeout(async()=>{const{appId:i,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await fme(i,o,c,h,m,u),W_.has(r)&&jx(r)}catch(_){L.warn("update preload failed",_.message),D9(r)}},re("AP_UPDATE_INTERVAL")))}}function D9(e){const r=z_.indexOf(e);r!==-1&&z_.splice(r,1);let i=W_.get(e);i&&(window.clearTimeout(i),i=null,W_.delete(e),jx())}function L9(e,r){const i=e.sua,o=e.ap;r&&i&&Rt.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:e.intUid,errorCode:null,extend:i.req}),Rt.reportResourceTiming(e.ap.url,e.sid),Rt.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[ui.CHOOSE_SERVER,ui.CLOUD_PROXY_FALLBACK].toString()}),Rt.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[ui.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function x9(e){return window.atob(window.localStorage.getItem(e)||"")}function bP(e,r){window.localStorage.setItem(e,window.btoa(r))}function M9(e){let r="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(r+="_s_".concat(e.uid)),typeof e.uid=="number"&&(r+="_".concat(e.uid)),e.token&&(r+="_".concat(e.token)),P8(r)}function mme(e){let r=function(){const i=Eme.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let c=i.appId;c!==void 0&&(pi(o,10),Um(o,c));let u=i.cid;u!==void 0&&(pi(o,16),pi(o,u));let h=i.cname;h!==void 0&&(pi(o,26),Um(o,h));let m=i.deviceId;m!==void 0&&(pi(o,34),Um(o,m));let _=i.elapse;_!==void 0&&(pi(o,40),Vm(o,_));let y=i.fileSize;y!==void 0&&(pi(o,48),Vm(o,Xv(y)));let S=i.height;S!==void 0&&(pi(o,56),Vm(o,Xv(S)));let R=i.jpg;R!==void 0&&(pi(o,66),pi(o,R.length),V9(o,R));let P=i.networkType;P!==void 0&&(pi(o,72),Vm(o,Xv(P)));let k=i.osType;k!==void 0&&(pi(o,80),Vm(o,Xv(k)));let z=i.requestId;z!==void 0&&(pi(o,90),Um(o,z));let U=i.sdkVersion;U!==void 0&&(pi(o,98),Um(o,U));let F=i.sequence;F!==void 0&&(pi(o,104),Vm(o,Xv(F)));let q=i.sid;q!==void 0&&(pi(o,114),Um(o,q));let Y=i.timestamp;Y!==void 0&&(pi(o,120),Vm(o,Y));let le=i.uid;le!==void 0&&(pi(o,128),pi(o,le));let Ee=i.vid;Ee!==void 0&&(pi(o,136),pi(o,Ee));let ye=i.width;ye!==void 0&&(pi(o,144),Vm(o,Xv(ye)));let ge=i.service;ge!==void 0&&(pi(o,152),pi(o,ge));let ke=i.callbackData;ke!==void 0&&(pi(o,162),pi(o,ke.length),V9(o,ke));let qe=i.ticket;qe!==void 0&&(pi(o,170),Um(o,qe));let ut=i.vendorConfigs;ut!==void 0&&(pi(o,178),Um(o,ut))}(e,r),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(r)}function gme(e){return function(i){let o={};e:for(;!yme(i);){let c=DT(i);switch(c>>>3){case 0:break e;case 1:o.code=DT(i);break;case 2:o.msg=F9(i,DT(i));break;case 3:o.requestId=F9(i,DT(i));break;case 4:o.timestamp=vme(i,!1);break;default:_me(i,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function _me(e,r){switch(r){case 0:for(;128&mu(e););break;case 2:Bx(e,DT(e));break;case 5:Bx(e,4);break;case 1:Bx(e,8);break;default:throw new Error("Unimplemented type: "+r)}}function Xv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Eme=[];function Bx(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function yme(e){return e.offset>=e.limit}function TP(e,r){let i=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function U9(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function V9(e,r){let i=TP(e,r.length);e.bytes.set(r,i)}function F9(e,r){let i=U9(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,y,S,R,P=c[m+i];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&y)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Um(e,r){let i=r.length,o=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}pi(e,o);let c=TP(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function mu(e){return e.bytes[U9(e,1)]}function j9(e,r){let i=TP(e,1);e.bytes[i]=r}function DT(e){let r,i=0,o=0;do r=mu(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function pi(e,r){for(r>>>=0;r>=128;)j9(e,127&r|128),r>>>=7;j9(e,r)}function vme(e,r){let i,o=0,c=0,u=0;return i=mu(e),o=127&i,128&i&&(i=mu(e),o|=(127&i)<<7,128&i&&(i=mu(e),o|=(127&i)<<14,128&i&&(i=mu(e),o|=(127&i)<<21,128&i&&(i=mu(e),c=127&i,128&i&&(i=mu(e),c|=(127&i)<<7,128&i&&(i=mu(e),c|=(127&i)<<14,128&i&&(i=mu(e),c|=(127&i)<<21,128&i&&(i=mu(e),u=127&i,128&i&&(i=mu(e),u|=(127&i)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:r}}function Vm(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=TP(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}const B9={},W9={},wP=4294967296,Sme=wP*wP,bme=Sme/2;G9(0,!0);const z9=G9(0),Tme=LT(0,-2147483648,!1),wme=LT(-1,2147483647,!1);function G9(e,r){let i,o,c;return r?(c=0<=(e>>>=0)&&e<256)&&(o=W9[e],o)?o:(i=LT(e,0,!0),c&&(W9[e]=i),i):(c=-128<=(e|=0)&&e<128)&&(o=B9[e],o)?o:(i=LT(e,e<0?-1:0,!1),c&&(B9[e]=i),i)}function LT(e,r,i){return{low:0|e,high:0|r,unsigned:!!i}}function H9(e,r){if(isNaN(e))return z9;{if(e<=-9223372036854776e3)return Tme;if(e+1>=bme)return wme}return e<0?z9:LT(e%wP|0,e/wP|0,r)}function $9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class Wx extends kr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(md.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),K(this,"name","AgoraRTCImageModeration"),K(this,"_connectionState",Tl.CONNECTING),K(this,"_sequence",0),K(this,"_moderationStartTime",void 0),K(this,"_workerConnection",void 0),K(this,"_workerMessageLengthLimit",void 0),K(this,"_qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",Jo.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"_moderationInterval",void 0),K(this,"_moderationTimer",null),K(this,"_moderationMode",1),K(this,"_quality",1),K(this,"_qualityTimer",null),K(this,"_ticket",void 0),K(this,"_moderationIntervalMinimum",void 0),K(this,"_uploadFailedNum",0),K(this,"_uploadNum",0),K(this,"_uploadTimer",null),K(this,"_extraInfo",void 0),K(this,"_vendor",""),K(this,"_encoder",new TextEncoder),K(this,"_moderationId",void 0),K(this,"inspectImage",()=>{if(this.connectionState!==Tl.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Tl.CONNECTED?this.requestToInspectImage():L.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=cr(5,"image-moderation-"),this._workerMessageLengthLimit=re("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=re("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=re("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new TT("worker-"+this._moderationId,vi),this.on(md.STATE_CHANGE,(o,c)=>{L.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Fv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(md.STATE_CHANGE,Fv.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=i,new lt((c,u)=>{this.on(md.CONNECTION_STATE_CHANGE,(h,m)=>{h===Tl.CONNECTED&&c()}),this.requestAP(r,o,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),L.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Tl.CONNECTED&&this.inspectImage()}async requestAP(r,i,o){const c=re("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,y,S,R){let{appId:P,areaCode:k,cname:z,sid:U,token:F,uid:q}=y;Hv++;const Y="moderation_plugin",le={service_name:Y,json_body:JSON.stringify({appId:P,areaCode:k,cname:z,command:"allocateEdge",requestId:Hv,seq:Hv,sid:U,appToken:F,ts:Date.now(),uid:q+""})};let Ee,ye,ge=_[0];return dd(async()=>{Ee=Date.now();const ke=await gd(ge,{data:le,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-Ee,ke.code!==0){const ft=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ke.code,{retry:!0,responseTime:ye});throw L.error(ft.toString()),ft}const qe=JSON.parse(ke.json_body);if(qe.code!==200){const ft=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(qe.code,", reason: ").concat(qe.reason),{code:qe.code,responseTime:ye});throw L.error(ft.toString()),ft}if(!qe.servers||!Array.isArray(qe.servers)||qe.servers.length===0){const ft=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:qe.code,responseTime:ye});throw L.error(ft.toString()),ft}if(!qe.servers.some(ft=>!!ft.wss)){const ft=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:qe.code,responseTime:ye});throw L.error(ft.toString()),ft}const ut=re("IMAGE_MODERATION_WORKER_HOST");return{addressList:qe.servers.map(ft=>{let{address:yn,wss:vn}=ft;if(yn&&vn)return"wss://".concat(yn.replace(/\./g,"-"),".").concat(ut,":").concat(vn,"/moderation")}).filter(ft=>!!ft),workerToken:qe.workerToken,vid:qe.vid,ticket:qe.appTicket,responseTime:ye}},(ke,qe)=>(Rt.apworkerEvent(U,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(ke.addressList),firstSuccess:qe===0,responseTime:ye,serverIp:_[qe%_.length]}),!1),(ke,qe)=>(Rt.apworkerEvent(U,{success:!1,sc:ke.data&&ke.data.code||200,serviceName:Y,responseTime:ye,serverIp:_[qe%_.length]}),!!(ke.code!==X.OPERATION_ABORTED&&ke.code!==X.UNEXPECTED_RESPONSE||ke.data&&ke.data.retry)&&(ge=_[(qe+1)%_.length],!0)),R)}(c,r,i,o);this.emit(md.STATE_CHANGE,Fv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(md.STATE_CHANGE,Fv.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(Xt.CONNECTED,async()=>{this.emit(md.STATE_CHANGE,Fv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Tl.CONNECTED}),this._workerConnection.on(Xt.CLOSED,()=>{this.connectionState=Tl.CLOSED}),this._workerConnection.on(Xt.FAILED,()=>{this.connectionState=Tl.CLOSED}),this._workerConnection.on(Xt.RECONNECTING,()=>{this.connectionState=this.connectionState===Tl.CONNECTED?Tl.RECONNECTING:Tl.CONNECTING}),this._workerConnection.on(Xt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const i=gme(new Uint8Array(r.data));re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,L.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Rt.reportApiInvoke(this._connectInfo.sid||null,{name:yi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:Vr.TRACER}).onError(new Oe(X.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},re("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else L.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Xt.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(Xt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Uc(this,md.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,i);this._workerConnection.sendMessage(o,!0,!0)}else re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await EW(S,o,c),P=this._sequence+"-"+u+"-"+_+"-"+y+"-"+cr(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:Wx.intToLong(Number(y-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:H9(y),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete k.callbackData;const z=mme(k);if(z.byteLength<this._workerMessageLengthLimit){if(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const U=function(F){for(var q=1;q<arguments.length;q++){var Y=arguments[q]!=null?arguments[q]:{};q%2?$9(Object(Y),!0).forEach(function(le){K(F,le,Y[le])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(Y)):$9(Object(Y)).forEach(function(le){Object.defineProperty(F,le,Object.getOwnPropertyDescriptor(Y,le))})}return F}({},k);delete U.jpg,L.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(U))}return z}{const U=this.quality*this._qualityRatio;return this.quality=U,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Jo.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Tl.CLOSED,this.emit(md.STATE_CHANGE,Fv.CLOSED)}}function K9(e){if(nr(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Oe(X.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Rme={name:"ImageModeration",create:function(e){let{config:r}=e;return K9(r),new Wx(r)}};var q9,Y9,X9,J9,Q9,Z9,eH,tH,nH,rH,iH,sH,oH,aH,cH,lH,uH,dH,hH,pH,fH,mH,gH,_H,EH,yH,vH,SH,bH,TH,wH,RH,CH,IH,AH,PH,OH,kH,NH,DH,LH,pt;function xH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function gu(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?xH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}Ms.setLogger(L);let Cme=(q9=Ut(),Y9=Ut({argsMap:(e,r)=>{if(!Array.isArray(r)){if(!(r instanceof kv))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),X9=Ut({argsMap:(e,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Ov.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),J9=Ut({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),Q9=Ut({argsMap:(e,r,i)=>[r,i]}),Z9=Ut({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:c}=i;return[o==null?void 0:o.uid,c]})}),eH=Ut({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),tH=Ut({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:c}=i;return{uid:o==null?void 0:o.uid,mediaType:c}})}),nH=Ut(),rH=Ut(),iH=Ut(),sH=Ut(),oH=Ut(),aH=Ut(),cH=Ut(),lH=Ut(),uH=Ut(),dH=Ut(),hH=Ut(),pH=Ut(),fH=Ut(),mH=Ut(),gH=Ut(),_H=Ut({argsMap:(e,r)=>[r]}),EH=Ut(),yH=Ut(),vH=Ut(),SH=Ut(),bH=Ut(),TH=Ut(),wH=Ut(),RH=Ut(),CH=Ut({argsMap:(e,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),IH=Ut(),AH=Ut(),PH=Ut(),OH=Ut(),kH=Ut(),NH=Ut(),DH=Ut({reportResult:!0}),LH=Ut(),pt=class extends kr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,r){let i;if(super(),K(this,"store",void 0),K(this,"_uid",void 0),K(this,"_channelName",void 0),K(this,"_uintUid",void 0),K(this,"_users",[]),K(this,"_config",void 0),K(this,"_clientId",void 0),K(this,"_appId",void 0),K(this,"_sessionId",null),K(this,"_key",void 0),K(this,"_rtmConfig",{}),K(this,"_joinInfo",void 0),K(this,"_gateway",void 0),K(this,"_statsCollector",void 0),K(this,"_configDistribute",void 0),K(this,"_leaveMutex",void 0),K(this,"_publishMutex",void 0),K(this,"_renewTokenMutex",void 0),K(this,"_subscribeMutex",void 0),K(this,"_encryptionMode","none"),K(this,"_encryptionSecret",null),K(this,"_encryptionSalt",null),K(this,"_encryptDataStream",!1),K(this,"_encryptDataStreamKey",null),K(this,"_encryptDataStreamIv",null),K(this,"_proxyServer",void 0),K(this,"_turnServer",{servers:[],mode:"auto"}),K(this,"_cloudProxyServerMode","disabled"),K(this,"_isDualStreamEnabled",!1),K(this,"_defaultStreamFallbackType",void 0),K(this,"_lowStreamParameter",void 0),K(this,"_streamFallbackTypeCacheMap",new Map),K(this,"_remoteStreamTypeCacheMap",new Map),K(this,"_axiosCancelSource",Jo.CancelToken.source()),K(this,"_audioVolumeIndicationInterval",void 0),K(this,"_networkQualityInterval",void 0),K(this,"_userOfflineTimeout",void 0),K(this,"_streamRemovedTimeout",void 0),K(this,"_liveTranscodeStreamingClient",void 0),K(this,"_liveRawStreamingClient",void 0),K(this,"_channelMediaRelayClient",void 0),K(this,"_networkQualitySensitivity","normal"),K(this,"_p2pChannel",void 0),K(this,"_useLocalAccessPoint",!1),K(this,"_setLocalAPVersion",void 0),K(this,"_joinAndNotLeaveYet",!1),K(this,"_numberOfJoinCount",0),K(this,"_remoteDefaultVideoStreamType",void 0),K(this,"_inspect",void 0),K(this,"_moderation",void 0),K(this,"_license",void 0),K(this,"_pendingPublishedUsers",[]),K(this,"ntpAlignErrorCount",0),K(this,"remoteInboundOffset",0),K(this,"_peerConnectionState",void 0),K(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),K(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),K(this,"_handleUserOnline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&x_(c.uid,this.channelName))return void L.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&L.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(mn.USER_JOINED,u));else{const h=new xm(c.uid,c.uint_id||c.uid);this._users.push(h),L.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(mn.USER_JOINED,h)}}),K(this,"_handleUserOffline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&x_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:CA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),L.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(mn.USER_LEAVED,u,c.reason))}),K(this,"_handleAddAudioOrVideoStream",(c,u,h,m,_,y,S)=>{if(re("BLOCK_LOCAL_CLIENT")&&x_(u,this.channelName))return;const R=this._users.find(k=>k.uid===u);if(!R)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));L.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=_||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),y&&(R._audioOrtc=y)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),y&&(R._videoOrtc=y)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(L.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,R,c)),c==="video"?Rt.onGatewayStream(this._sessionId,Bi.ON_ADD_VIDEO_STREAM,Ir.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:R._videoSSRC}):Rt.onGatewayStream(this._sessionId,Bi.ON_ADD_AUDIO_STREAM,Ir.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(k=>{if(k&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof NT))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(z=>{L.error("[".concat(this._clientId,"] resubscribe error"),z.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(k=>{L.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),K(this,"_handleRemoveStream",c=>{if(re("BLOCK_LOCAL_CLIENT")&&x_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void L.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));L.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio"),L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof NT&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),Rt.onGatewayStream(this._sessionId,Bi.ON_REMOVE_STREAM,Ir.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),K(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&x_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void L.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));L.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";L.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}const y=c==="audio"?m.hasAudio:m.hasVideo;return _!==y?!_&&y?(L.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(mn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),L.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(mn.USER_UNPUBLISHED,m,c)):void 0}),K(this,"_handleMuteStream",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&x_(c,this.channelName))return;L.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void L.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}const y=u==="audio"?m.hasAudio:m.hasVideo;if(_!==y){if(!_&&y)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(L.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(mn.USER_PUBLISHED,m,u)):void L.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),L.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(mn.USER_UNPUBLISHED,m,u)}}),K(this,"_handleP2PLost",async c=>{L.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():L.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),K(this,"_handleTokenWillExpire",()=>{L.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),K(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),L.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),K(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(mn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(mn.NETWORK_QUALITY,c)}),K(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));L.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const y=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),m!==void 0&&(_._videoMid=m)),(c==="audio"?_.hasAudio:_.hasVideo)&&!y&&(L.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{L.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=r||cr(5,"client-"),this.store=new class{constructor(c,u,h,m){Ht(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:A_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case gn.SET_SESSION_ID:return mt(mt({},u),{},{sessionId:h.sessionId});case gn.SET_P2P_ID:return mt(mt({},u),{},{p2pId:h.p2pId});case gn.SET_UID:return mt(mt({},u),{},{uid:h.uid});case gn.SET_INT_UID:return mt(mt({},u),{},{intUid:h.intUid});case gn.SET_PUB_ID:return mt(mt({},u),{},{pubId:h.pubId});case gn.KEY_METRIC_CLIENT_CREATED:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{clientCreated:h.metric})});case gn.KEY_METRIC_JOIN_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinStart:h.metric})});case gn.AVOID_JOIN_START:return mt(mt({},u),{},{avoidJoinStart:h.avoidJoinStart});case gn.KEY_METRIC_JOIN_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinEnd:h.metric})});case gn.KEY_METRIC_REQUEST_AP_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{requestAPStart:h.metric})});case gn.KEY_METRIC_REQUEST_AP_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{requestAPEnd:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case gn.KEY_METRIC_DESCRIPTION_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{descriptionStart:h.metric})});case gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case gn.KEY_METRIC_ICE_CONNECTION_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case gn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,_=m.findIndex(y=>y.trackId===h.metric.trackId);return _!==-1?(m[_]=mt(mt({},m[_]),h.metric),mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{publish:[...m]})})):mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case gn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,_=m.findIndex(y=>y.userId===h.metric.userId&&y.type===h.metric.type);return _!==-1?(m[_]=mt(mt({},m[_]),h.metric),mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{subscribe:[...m]})})):mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case gn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case gn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=mt(mt({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case gn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case gn.SET_USE_P2P:return mt(mt({},u),{},{useP2P:h.val});case gn.SET_TRANSPORT_TYPE:return mt(mt({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:gn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:gn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:gn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:gn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:gn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:gn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:gn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:gn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:gn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:gn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:gn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:gn.KEY_METRIC_PUBLISH,metric:mt(mt({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,_,y,S){this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt(mt(mt({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),y&&{streamAdded:y}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(_=>{this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:mt(mt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:gn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:gn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Ms("client-leave",this._clientId),this._publishMutex=new Ms("client-publish",this._clientId),this._renewTokenMutex=new Ms("client-renewtoken",this._clientId),this._subscribeMutex=new Ms("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),L.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(vl," build: ").concat(LL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{SL(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(c){L.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new OT(this.store),this._statsCollector.onStatsException=(c,u,h)=>{L.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(mn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const _=this._users.find(y=>y.uid===c);_&&Rt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new Gfe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||vi,httpRetryConfig:e.httpRetryConfig||vi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new eme(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},Yp("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new NT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,r,i,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Qn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Qn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof px&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(_,y,S){SA.get(_)||SA.set(_,[]),bA.get(_)||bA.set(_,y),uh.get(_)||uh.set(_,0);const R=SA.get(_),P=bA.get(_);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(uh.get(_)===P){const q=aT();R.push(q),await q.promise}uh.set(_,uh.get(_)+1);for(var k=arguments.length,z=new Array(k>3?k-3:0),U=3;U<k;U++)z[U-3]=arguments[U];const F=await S(...z);return uh.set(_,uh.get(_)-1),uh.get(_)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),uh.get(_)===0&&(SA.set(_,[]),bA.set(_,0),uh.set(_,0)),F}("client.join",re("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,r,i,o,c)}async join(e,r,i,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(PA||PA||(PA=(window.location.protocol.split(":")[0]||"").toUpperCase(),PA))==="HTTPS",m=N8()?window.isSecureContext:"Browser Not Support";(!N8()&&!h||!window.isSecureContext)&&L.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),L.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Rt.setAppId(e);try{if(!i&&i!==null)throw new Oe(X.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&as(i,"token",1,2047),as(e,"appid",1,2047),JA(r),o&&QA(o),c&&as(c,"optionalInfo",1,2047)}catch(U){throw Rt.reportApiInvoke(I_(),{name:yi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:Vr.TRACER}).onError(U),U}if(this._leaveMutex.isLocked&&(L.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),L.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const U=new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Rt.reportApiInvoke(I_(),{name:yi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:Vr.TRACER}).onError(U),U}this._gateway.state="CONNECTING";const _=await k9({appId:e,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const y=(_==null?void 0:_.sid)||I_();L.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=y,this.store.sessionId=this._sessionId);const S=Rt.reportApiInvoke(y,{id:this._clientId,name:yi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:Vr.TRACER}),R=gu(gu(gu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:re("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async U=>{const F=function(Ee){const ye=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ge=new Uint8Array(new ArrayBuffer(ye.length));for(let ke=0;ke<ye.length;ke+=1)ge[ke]=ye.charCodeAt(ke);return ge}(),q=await window.crypto.subtle.importKey("spki",F,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Y=yL(U),le=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,Y);return function(Ee){let ye="";for(let ge=0;ge<Ee.length;ge+=1)ye+=String.fromCharCode(Ee[ge]);return window.btoa(ye)}(new Uint8Array(le))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const U=new TextEncoder,F=re("USE_PURE_ENCRYPTION_MASTER_KEY")?U.encode(R.appId+this._encryptionSecret+this._encryptionSecret):U.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(q,Y,le){const Ee=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),ye=q==="aes-128-gcm2"?128:256,ge=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:W8,hash:"SHA-256",salt:le},Ee,ye+vpe);return new Uint8Array(ge).subarray(ye/8)}(this._encryptionMode,F,C_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(q,Y,le){const Ee=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),ye=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:W8,hash:"SHA-256",salt:le},Ee,{name:"AES-GCM",length:ye},!0,["encrypt","decrypt"])}(this._encryptionMode,F,C_(this._encryptionSalt))}else m?L.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):L.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,L.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:e,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&Rt.joinChannelTimeout(this._sessionId,5)},5e3);try{var k;let U;const F=R.cloudProxyServer;if(st(k=["proxy3","proxy4","proxy5"]).call(k,F)){const ye=re("PROXY_SERVER_TYPE3");Array.isArray(ye)?R.proxyServer=ye[0]:R.proxyServer=ye}if(Rt.setProxyServer(R.proxyServer),L.setProxyServer(R.proxyServer),this.store.requestAPStart(),_){if(L.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(_.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=_.intUid),U={gatewayInfo:_.ap.gatewayInfo},re("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)L.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ye=(await TG(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(ge=>({turnServerURL:ge.address,tcpport:ge.tcpport||As.tcpport,udpport:ge.udpport||As.udpport,username:ge.username||As.username,password:ge.password||As.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:ye}}L9(_,R.stringUid)}else{if(R.stringUid&&!R.uid){let ye;[ye,U]=await lt.all([JG(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||vi,this.store),XG(R,this._axiosCancelSource.token,this._config.httpRetryConfig||vi,!0,this.store)]),L.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(ye)),R.uid=ye,U.gatewayInfo.uid=ye,U.gatewayInfo.res.uid=ye}else U=await XG(R,this._axiosCancelSource.token,this._config.httpRetryConfig||vi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(ST.UPDATE_BITRATE_LIMIT,ye=>{this._p2pChannel.updateBitrateLimit(ye)}),this._configDistribute.on(ST.UPDATE_CLIENT_ROLE_OPTIONS,ye=>{this._setClientRoleOptions(ye)})},0),this._key=i||e;const q=U.gatewayInfo,Y=R.uid?R.uid:q.uid;this._joinInfo=gu(gu({},R),{},{cid:q.cid,uid:Y,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=Y,this.store.cid=q.cid;const le=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(le),this._appId=e,this._channelName=R.cname,this._uid=le,this.store.uid=le,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Rs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Ee=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return L.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(Ee)),setTimeout(()=>{L.startUpload()},5e3),this.store.joinEnd(),z=this,st(L_).call(L_,z)||L_.push(z),this._cloudProxyServerMode==="disabled"&&Dn().supportWebCrypto&&re("ENABLE_PRELOAD")&&jx(this._joinInfo),le}catch(U){const F=Array.isArray(U)?U[0]:U;throw F&&F.code===X.OPERATION_ABORTED?L.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),F):L.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),F),F.code!==X.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(F),F}var z}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(X.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!re("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){L.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Rs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const i=L_.indexOf(r);i!==-1&&L_.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return L.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Gn.LEAVE),L.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof kv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Oe(X.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new Oe(X.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof kv))throw new Oe(X.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(X.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}L.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof Er&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),L.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw L.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){nr(e.id,"id",0,65535,!0),Wp(e.ordered,"ordered"),as(e.metadata,"metadata",0,512),L.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Oe(X.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return BG(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw L.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(X.CREATE_DATACHANNEL_ERROR);try{await lt.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==X.DISCONNECT_P2P)throw c}}return L.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw L.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(e)if(Array.isArray(e))r=e;else{if(!(e instanceof kv))return this._unpublishDataChannel([e]);r=[e]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);L.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(ti.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),L.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw L.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),L.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const r=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),L.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw L.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(e,r,i){if(!(e instanceof xm)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");e=o}return r==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,r)}async presubscribe(e,r){if(Ni(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(X.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=r===gt.AUDIO,o=r===gt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:_,uint_id:y}=await this._gateway.presubscribe(e,r,!0);if(u==null)throw new Oe(X.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===e);S||(S=new xm(e,y||e),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=y||e),i&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),L.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const R=i?S._audioTrack:S._videoTrack;if(!R)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw L.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,r){var i;if(nr(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Oe(X.INVALID_REMOTE_USER,"user is not published");const c=(i=e._dataChannels)===null||i===void 0?void 0:i.find(m=>m.id===r);if(!c)throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[c]);if(m&&st(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(X.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return L.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,r,i){if(Ni(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!i&&(r==="audio"&&!e.hasAudio||r==="video"&&!e.hasVideo)){const u=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const h=r==="audio"?e._audioSSRC:e._videoSSRC,m=r==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,r,h,m)}catch(h){throw h}L.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{L.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw L.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,r,i){if(this.store.useP2P)return this._p2pSubscribe(e,r);if(Ni(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(y=>y===e)){const y=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),y}if(!e.hasAudio&&!e.hasVideo){const y=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),y}if(!(i||(r!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(r!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const y=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),y}let c=r==="audio"?e._audioSSRC:e._videoSSRC,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const S=r==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c}),Fs.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,r,Date.now()),await this._p2pChannel.subscribe(e,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,r),R;await this._p2pChannel.unsubscribe(e,r,!0),this._p2pChannel.setPendingRemoteMedia(e,r)}this.store.subscribe(e.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,r),S}L.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{L.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const y=r==="audio"?e._audioTrack:e._videoTrack;if(!y)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return y}catch(y){throw L.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),y),y}finally{_()}}async massSubscribe(e){if(zp(e,"subscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),i=new Map,o=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:_,mediaType:y}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(y)}).join("; ")));const c=(e=[...e]).map(m=>{let{user:_,mediaType:y}=m;return{user:_,mediaType:y}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:R}=y;if(Ni(R,"mediaType",["audio","video"]),!S){const U=new Oe(X.INVALID_PARAMS,"user property does not exist in subscribeList item");throw L.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find(U=>U===S)){const U=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");L.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=U,e.splice(_,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const U=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);L.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[_].error=U,e.splice(_,1);continue}const k=Wi.Video|Wi.LwoVideo,z=i.get(S);if(z){if(R==="video"?z&k:z&Wi.Audio){e.splice(_,1),L.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}i.set(S,z|(R==="video"?k:Wi.Audio))}else i.set(S,R==="video"?k:Wi.Audio)}for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:R}=y,P=Wi.Video|Wi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const k=i.get(S);i.set(S,R==="video"?k^P:k^Wi.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),r);let m=ec(h=Array.from(i.entries())).call(h,(_,y)=>{let[S,R]=y;if(R===0)return _;const P={stream_id:S.uid,stream_type:R};return R&Wi.Audio&&(P.audio_ssrc=S._audioSSRC),R&Wi.Video&&(P.video_ssrc=S._videoSSRC),_.push(P),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(y=>{let{user:S,mediaType:R}=y;return{user:S,mediaType:R,ssrcId:R===gt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===gt.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc),m.length>0){const y=await this._gateway.subscribeAll(m,!0);((y==null?void 0:y.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:P,audio_error_code:k,error_code:z}=S;(P||k||z)&&_.set(R,{video_error_code:P,audio_error_code:k,error_code:z})})}if(Array.from(_.entries()).length>0){const y=[];Array.from(_.entries()).forEach(S=>{let[R,P]=S;const k=this.remoteUsers.find(z=>z.uid===R);if(k){let z;P.error_code||P.video_error_code&&P.audio_error_code?z=void 0:P.video_error_code?z=gt.VIDEO:P.audio_error_code&&(z=gt.AUDIO),y.push({user:k,mediaType:z})}}),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(const y of c){const S=_.get(y.user.uid);if(S){const R=S.error_code||y.mediaType==="audio"&&S.audio_error_code||y.mediaType==="video"&&S.video_error_code;if(R){const P=bT(R);L.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(P.desc)),y.error=new Oe(X.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(c.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),c.forEach(y=>{var S;Rt.subscribe(this.store.sessionId,{succ:!!y.error,ec:((S=y.error)===null||S===void 0?void 0:S.code)||null,video:y.mediaType===gt.VIDEO,audio:y.mediaType===gt.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===gt.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)}),L.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(y=>{let{user:S,mediaType:R}=y;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),o()}}async unsubscribe(e,r,i){if(!(e instanceof xm)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(r&&Ni(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}L.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,r);else{const u=await this._p2pChannel.unsubscribe(e,r);u&&await this._gateway.unsubscribe(u,e.uid),r&&r!=="audio"||(e._audio_pre_subscribed=!1),r&&r!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&CA(this._users,e),L.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===X.DISCONNECT_P2P)return void L.warning("disconnecting p2p, abort unsubscribe request.");throw L.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,r){if(r&&nr(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=e._dataChannels.find(u=>u.id===r);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(r,", remote datachannel is not published")),c}L.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),L.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===X.DISCONNECT_P2P)return void L.warning("disconnecting p2p, abort unsubscribe request.");throw L.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(zp(e,"unsubscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");L.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const r=new Map;for(let i=e.length-1;i>=0;i--){const{user:o,mediaType:c}=e[i];if(!o){const m=new Oe(X.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw L.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Ni(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){L.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}const h=Wi.Video|Wi.LwoVideo;if(r.has(o)){const m=r.get(o);let _;switch(c){case"video":_=m&h;break;case"audio":_=m&Wi.Audio;break;default:_=m&(Wi.Audio|h)}if(_){L.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(i,1);continue}c?c==="audio"?r.set(o,m|Wi.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|Wi.Audio|h)}else c?c==="audio"?r.set(o,Wi.Audio):c==="video"&&r.set(o,h):r.set(o,Wi.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),L.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===X.DISCONNECT_P2P)return void L.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw L.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new Le(X.INVALID_PARAMS);Ur(i.width)||_L(i.width,"streamParameter.width"),Ur(i.height)||_L(i.height,"streamParameter.height"),Ur(i.framerate)||_L(i.framerate,"streamParameter.framerate"),Ur(i.bitrate)||nr(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&L.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),L.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&e.bitrate&&r.bitrate<e.bitrate&&(e.bitrate=r.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,$e.LocalVideoLowTrack)}async enableDualStream(){if(!Dn().supportDualStream)throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(X.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(X.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),L.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia($e.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),L.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,r){if(function(o){Ni(o,"role",["audience","host"])}(e),r&&SL(r),this.mode==="rtc"||this.mode==="p2p")throw L.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(X.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&e==="host")throw new Oe(X.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(X.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&re("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,r),this._config.role=e,this._gateway.reconnect("recover",Cs.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,r),this._config.role=e),L.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(r&&r.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{e&&SL(e),await this._gateway.setClientRole(this._config.role,e),r=!0}catch{}finally{L.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const r=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!r||!r.timestamp)return 0;const i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,r){if(as(e,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Rt.setProxyServer(this._proxyServer),L.setProxyServer(this._proxyServer),L.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(e,r){if(Array.isArray(e)||(e=[e]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}if(hT(e))return this._turnServer={servers:e,mode:"original-manual"},void L.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>v8(i)),this._turnServer={servers:e,mode:"manual"},L.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"you should set license before join channel");if(as(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Oe(X.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,L.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Oe(X.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new Oe(X.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,L.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Stop proxy server after leave channel");Rt.setProxyServer(),L.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",L.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Oe(X.INVALID_PARAMS,"accessPoints is required.");zp(e.accessPoints.serverList,"accessPoints.serverList"),as(e.accessPoints.domain,"accessPoints.domain");const r=(P,k)=>{nr(P,k,0,65535,!0)};let i=443;if(e.accessPoints.port&&(r(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");re("CLOSE_AFB_FOR_LOCAL_AP")&&(Qn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Qn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(P=>o.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Qn("WEBCS_DOMAIN",h),Qn("WEBCS_DOMAIN_BACKUP_LIST",h),Qn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(zp(e.report.hostname,"report.hostname"),Qn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Qn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Qn("EVENT_REPORT_DOMAIN",u[0]),Qn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(r(e.report.port,"report.port"),m=e.report.port),Qn("STATS_COLLECTOR_PORT",m),e.report?Qn("ENABLE_EVENT_REPORT",!0):Qn("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(zp(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let y=6444;e.log&&e.log.port&&(r(e.log.port,"log.port"),y=e.log.port),Qn("LOG_UPLOAD_SERVER","".concat(_,":").concat(y));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(zp(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let R=443;e.cds&&e.cds.port&&(r(e.cds.port,"cds.port"),R=e.cds.port),Qn("CDS_AP",S.map(P=>"".concat(P,":").concat(R))),e.cds?Qn("ENABLE_CONFIG_DISTRIBUTE",!0):Qn("ENABLE_CONFIG_DISTRIBUTE",!1),L.info("set local access point v2 success")}setLocalAccessPoints(e,r){if(zp(e,"serverList"),as(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Qn("WEBCS_DOMAIN",e),Qn("WEBCS_DOMAIN_BACKUP_LIST",e),Qn("GATEWAY_DOMAINS",[r]),Qn("EVENT_REPORT_DOMAIN",e[0]),Qn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Qn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),L.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Ni(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw L.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else L.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,r){Ni(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,r),setTimeout(()=>{const i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw L.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}L.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(e,r)}async setStreamFallbackOption(e,r){Ni(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,r)}catch(i){throw L.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}L.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(e,r)}setEncryptionConfig(e,r,i,o){(function(u){Ni(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),as(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(st(c).call(c,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new Oe(X.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Wp(o,"encryptDataStream"),!st(c).call(c,e))throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||L.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=r,i&&(this._encryptionSalt=Im(i))}async renewToken(e){if(as(e,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(re("USE_NEW_TOKEN")){L.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Zfe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||vi);L.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else L.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});L.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,L.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?L.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(mn.VOLUME_INDICATOR,e)},re("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return e.Duration=Math.round(r.duration/1e3),e}async startLiveStreaming(e,r){if(!r){if(this.codec!=="h264")throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Oe(X.LIVE_STREAMING_TASK_CONFLICT);const i=r?$p.TRANSCODE:$p.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient($p.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!r.length)throw new Oe(X.INVALID_PARAMS,"can not find live streaming url to stop");await lt.all(r.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){i9(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){i9(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof NT&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var m;const _=ec(m=Array.from(h)).call(m,(U,F)=>U+F,0),y={serverTs:0,seq:Spe++,length:h.length,checkSum:_},S=new Uint8Array(A8(_,2)),R=new ArrayBuffer(wv),P=new DataView(R);P.setUint32(0,y.serverTs),P.setUint16(4,y.seq),P.setUint16(6,y.length),P.setUint16(8,y.checkSum);const k=16-h.length%16;h=T8(h,new Uint8Array(k));const z=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:B8,additionalData:S},u,h);return T8(new Uint8Array(R),new Uint8Array(z))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Oe(X.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(jt.DATA_STREAM,{payload:Im(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-cme},!i)}sendMetadata(e){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Oe(X.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(jt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Im(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Ope),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send custom report, not joined");await Rt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,r){Ni(r.spatialLayer,"spatialLayer",[0,1,2,3]),Ni(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,r)}catch(i){throw L.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:r=!1,rtmFlag:i}=e;if(Wp(r,"apRTM"),nr(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,L.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(L.debug("[".concat(this._clientId,"] reset client")),function(e){const r=Uv.indexOf(e);r!==-1&&Uv.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Jo.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&D9(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Rt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(r=>r._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ms("client-publish",this._clientId),this._subscribeMutex=new Ms("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,r){var i;const o=e||I_();e?L.debug("[".concat(this._clientId,"] new Session ").concat(o)):L.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,Rt.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Rt.sessionInit(this._sessionId,gu({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");L.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(ti.PUBLISH,o,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await i.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof Er&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{L.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===X.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));L.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw i.throw(u),u}i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===X.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(X.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Yp("LiveStreaming").create(o));var o;return i.onLiveStreamError=(c,u)=>{Rt.reportApiInvoke(this._sessionId,{name:yi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Vr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{Rt.reportApiInvoke(this._sessionId,{name:yi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Vr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_WARNING,c,u)},i.on(dx.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Oe(X.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,y,S){const R=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(P=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Kfe(R,m,_,y,S)})(c,this._joinInfo,this._axiosCancelSource.token,vi).then(u).catch(h)}),i};return e===$p.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(X.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},Yp("ChannelMediaRelay").create(e));o.on("state",c=>{c===Da.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(mn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(mn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,r){const{added:i,deleted:o}=e,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{i.every(_=>_.uid!==h._uintid||_.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:m,ordered:_,max_retrans_times:y,metadata:S}=u,R=this._users.find(P=>P._uintid===h);if(!R)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(L.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),st(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!_,maxRetransmits:y,metadata:S},k=function(z){return BG(z,!0)}(P);R._dataChannels.push(k),L.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(mn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(L.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(P=>{L.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(mn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void L.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const y=_._dataChannels.find(S=>S.id===u.stream_id);y&&(L.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[y]).then(S=>{if(_._dataChannels=_._dataChannels.filter(R=>R!==y),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),L.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(mn.USER_UNPUBLISHED,_,"datachannel",y._config))})}_handleRemoveDataChannels(e){const r=this._users.find(i=>i.uid===e.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){L.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(mn.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),i()}}else L.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Zi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void L.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:u,expires:h}=r[o];h&&h<=i||u||ix()||!Object.prototype.hasOwnProperty.call(NA,o)||(hd[o]=c,_r[o]=c,L.debug("Update gateway parameters from config distribute",o,c))})}catch(r){L.error("Error update config from local cache",r.message)}})()}),this._gateway.on(Zi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Zi.CONNECTION_STATE_CHANGE,(e,r,i)=>{var o;if(i===Gn.FALLBACK)return;const c=()=>{this.safeEmit(mn.CONNECTION_STATE_CHANGE,e,r,i)};if(Rt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:yi.CONNECTION_STATE_CHANGE,options:[e,r,i],tag:Vr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:r,reason:i})),L.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(_=>{L.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(_=>{L.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{L.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{L.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{L.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(L.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.AUDIO,!1)),h._trust_video_mute_state_||(L.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.VIDEO,!1)),h._trust_audio_enabled_state_||(L.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(L.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(L.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(L.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(L.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(Zi.REQUEST_NEW_GATEWAY_LIST,async(e,r)=>{if(!this._joinInfo)return r(new Oe(X.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const o=await k9(gu(gu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,L9(o),this._joinInfo.preload=!0):(i=await Ix(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||vi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const c=[];i.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):c.push({host:m,port:_})}),e(c)}catch(i){r(i)}}),this._gateway.on(Zi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(mn.NETWORK_QUALITY,e)}),this._gateway.on(Zi.STREAM_TYPE_CHANGE,(e,r)=>{this.safeEmit(mn.STREAM_TYPE_CHANGED,e,r),Rt.reportApiInvoke(this._sessionId,{name:yi.STREAM_TYPE_CHANGE,options:[e,r],tag:Vr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:r}))}),this._gateway.on(Zi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Zi.REQUEST_P2P_CONNECTION_PARAMS,async(e,r,i)=>{try{let o=await this._p2pChannel.getEstablishParams();re("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),r(o)}catch(o){i(o)}}),this._gateway.on(Zi.JOIN_RESPONSE,(e,r)=>{if(this.store.useP2P)return;let i;e.attributes?i=e.attributes.userAttributes.preSubSsrcs:L.debug("no attributes in joinResponse");const o=PG(e.ortc,r,i);this._p2pChannel.connect(o)}),this._gateway.on(Zi.PRE_CONNECT_PC,async e=>{const{candidates:r,fingerprint:i}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=re("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(_n.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(_n.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(_n.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(_n.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(_n.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(_n.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(_n.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(_n.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(_n.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,gt.AUDIO,!0)),this._gateway.signal.on(_n.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,gt.AUDIO,!1)),this._gateway.signal.on(_n.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,gt.VIDEO,!0)),this._gateway.signal.on(_n.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,gt.VIDEO,!1)),this._gateway.signal.on(_n.RECEIVE_METADATA,e=>{const r=C_(e.metadata);this.safeEmit(mn.RECEIVE_METADATA,e.uid,r)}),this._gateway.signal.on(_n.ON_DATA_STREAM,async e=>{var r;if(!e)return;let i=C_(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(e.payload.length<wv)throw new Oe(X.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(wv));i=await async function(u,h,m){const _=m.subarray(0,wv),y=_.slice(8,wv),S=(y[0]<<8)+y[1],R=(_[6]<<8)+_[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:B8,additionalData:new Uint8Array(A8(S,2))},h,m.subarray(wv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),ume(gu(gu({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(_n.ON_CRYPT_ERROR,()=>{Cm(()=>{L.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(mn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{L.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Gn.TOKEN_EXPIRE),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(_n.ON_STREAM_FALLBACK_UPDATE,e=>{L.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(mn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(_n.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),L.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(_n.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(_n.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Wt.REQUEST_TIMEOUT,(e,r)=>{if(this._joinInfo)switch(e){case jt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var i,o;const u=c.some(_=>{let{stream_type:y}=_;return y===$n.Audio}),h=c.some(_=>{let{stream_type:y}=_;return y!==$n.Audio}),m=c.some(_=>{let{stream_type:y}=_;return y===$n.Screen||y===$n.ScreenLow});r.state==="offer"&&Rt.publish(this._joinInfo.sid,{eventElapse:Fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:X.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(i=c.find(_=>{let{stream_type:y}=_;return y===$n.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:y}=_;return y!==$n.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case jt.SUBSCRIBE:r&&Rt.subscribe(this._joinInfo.sid,{succ:!1,ec:X.TIMEOUT,audio:r.stream_type===gt.AUDIO,video:r.stream_type===gt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Fs.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(_n.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(_n.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;re("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!x_(o.string_id||o.stream_id,this.channelName)));const r=[],i=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new xm(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(L.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(mn.USER_JOINED,c)));const u=Wi.Audio&o.stream_type,h=(Wi.Video|Wi.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,_=u&&c.hasAudio,y=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(L.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(mn.USER_PUBLISHED,c,"audio")),h&&!y&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(L.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(mn.USER_PUBLISHED,c,"video")),(u&&!_||h&&!y||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(L.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{L.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(mn.PUBLISHED_USER_LIST).length>0?re("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(L.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(mn.PUBLISHED_USER_LIST,r)):L.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(_n.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:r}=e;this._p2pChannel instanceof NT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var o;return st(o=Object.keys(DA)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(_n.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ti.PUBLISH,(e,r,i)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const y=this._users.find(S=>S.uid===o);return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,u,h[0].ssrcId,m).then(()=>{r()}).catch(i):r(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(ti.CALL,async(e,r,i)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){i(c)}}),this._gateway.signal.on(Wt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(ti.UNPUBLISH,async(e,r,i)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return L.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const _=m===$n.Audio?gt.AUDIO:gt.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),r()}catch(h){i(h)}}}),this._gateway.signal.on(ti.CONTROL,async(e,r)=>{const{action:i}=e;switch(i){case Om.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,gt.VIDEO,!0);break;case Om.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,gt.AUDIO,!0);break;case Om.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,gt.VIDEO,!1);break;case Om.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,gt.AUDIO,!1)}}),this._gateway.signal.on(ti.RESTART_ICE,async(e,r,i)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==Ao.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){i(o)}}),this._gateway.signal.on(ti.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:r,direction:i}=e;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(kt.RequestP2PRestartICE,async(e,r,i)=>{try{const{direction:o}=e;r(await this._gateway.sendExtensionMessage(ti.RESTART_ICE,e,o===Ao.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(kt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(ti.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(kt.RequestP2PMuteLocal,async(e,r,i)=>{try{await this._gateway.sendExtensionMessage(ti.CONTROL,e,!0),r()}catch(o){i(o)}}),this._p2pChannel.on(kt.RequestP2PUnmuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.RequestP2PMuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.StateChange,(e,r)=>{r===Hn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(kt.PeerConnectionStateChange,e=>{const r=this._peerConnectionState;e!==r&&(this.safeEmit(mn.PEERCONNECTION_STATE_CHANGE,e,r),this._peerConnectionState=e)}),this._p2pChannel.on(kt.RequestMuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.RequestUnmuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.RequestRePublish,(e,r,i)=>{this.publish(e,!1).then(r).catch(i)}),this._p2pChannel.on(kt.RequestRePublishDataChannel,(e,r,i)=>{lt.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==X.DISCONNECT_P2P)throw u}})).then(r).catch(i)}),this._p2pChannel.on(kt.RequestReSubscribe,async(e,r,i)=>{try{for(const{user:o,kind:c}of e)c===gt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){i(o)}}),this._p2pChannel.on(kt.RequestUpload,(e,r)=>{this._gateway.upload(e,r)}),this._p2pChannel.on(kt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(kt.MediaReconnectStart,e=>{this.safeEmit(mn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(kt.MediaReconnectEnd,e=>{this.safeEmit(mn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(kt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(kt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(e),i=await r.next();if(i.done)return;const o=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(kt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(kt.RequestReconnectPC,async()=>{var e;const{iceParameters:r,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:o}),h=PG(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(kt.RequestUnpublishForReconnectPC,async(e,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),r()):i()}),this._p2pChannel.on(kt.P2PLost,()=>{this.safeEmit(mn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(kt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(kt.ConnectionTypeChange,e=>{this.safeEmit(mn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(kt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(kt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(kt.AudioMetadata,e=>{this.safeEmit(mn.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(r={config:e},Yp("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:_,vid:y}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:_,vid:y?Number(y):0},vi)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(e){e.on(es.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(mn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===hu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(mn.CONTENT_INSPECT_ERROR,new Oe(X.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(es.INSPECT_RESULT,(r,i)=>{var o;if((i==null?void 0:i.code)===X.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return L.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(mn.CONTENT_INSPECT_RESULT,r,i)}),e.on(es.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,r){if(Wp(e,"enabled"),e){if(!r)throw new Oe(X.INVALID_PARAMS,"config is required");if(K9(r),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(i={config:r},Yp("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:_,cid:y,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:_,cid:y,vid:S?Number(S):0},vi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(md.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(mn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===Tl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(X.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(md.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(r){Ni(r,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Oe(X.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,L.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return L.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Wp(e,"enabled"),Qn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,r){switch(r){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},vt(pt.prototype,"leave",[q9],Object.getOwnPropertyDescriptor(pt.prototype,"leave"),pt.prototype),vt(pt.prototype,"publish",[Y9],Object.getOwnPropertyDescriptor(pt.prototype,"publish"),pt.prototype),vt(pt.prototype,"unpublish",[X9],Object.getOwnPropertyDescriptor(pt.prototype,"unpublish"),pt.prototype),vt(pt.prototype,"subscribe",[J9],Object.getOwnPropertyDescriptor(pt.prototype,"subscribe"),pt.prototype),vt(pt.prototype,"presubscribe",[Q9],Object.getOwnPropertyDescriptor(pt.prototype,"presubscribe"),pt.prototype),vt(pt.prototype,"massSubscribe",[Z9],Object.getOwnPropertyDescriptor(pt.prototype,"massSubscribe"),pt.prototype),vt(pt.prototype,"unsubscribe",[eH],Object.getOwnPropertyDescriptor(pt.prototype,"unsubscribe"),pt.prototype),vt(pt.prototype,"massUnsubscribe",[tH],Object.getOwnPropertyDescriptor(pt.prototype,"massUnsubscribe"),pt.prototype),vt(pt.prototype,"setLowStreamParameter",[nH],Object.getOwnPropertyDescriptor(pt.prototype,"setLowStreamParameter"),pt.prototype),vt(pt.prototype,"enableDualStream",[rH],Object.getOwnPropertyDescriptor(pt.prototype,"enableDualStream"),pt.prototype),vt(pt.prototype,"disableDualStream",[iH],Object.getOwnPropertyDescriptor(pt.prototype,"disableDualStream"),pt.prototype),vt(pt.prototype,"setClientRole",[sH],Object.getOwnPropertyDescriptor(pt.prototype,"setClientRole"),pt.prototype),vt(pt.prototype,"_setClientRoleOptions",[oH],Object.getOwnPropertyDescriptor(pt.prototype,"_setClientRoleOptions"),pt.prototype),vt(pt.prototype,"setProxyServer",[aH],Object.getOwnPropertyDescriptor(pt.prototype,"setProxyServer"),pt.prototype),vt(pt.prototype,"setTurnServer",[cH],Object.getOwnPropertyDescriptor(pt.prototype,"setTurnServer"),pt.prototype),vt(pt.prototype,"setLicense",[lH],Object.getOwnPropertyDescriptor(pt.prototype,"setLicense"),pt.prototype),vt(pt.prototype,"startProxyServer",[uH],Object.getOwnPropertyDescriptor(pt.prototype,"startProxyServer"),pt.prototype),vt(pt.prototype,"stopProxyServer",[dH],Object.getOwnPropertyDescriptor(pt.prototype,"stopProxyServer"),pt.prototype),vt(pt.prototype,"setLocalAccessPointsV2",[hH],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPointsV2"),pt.prototype),vt(pt.prototype,"setLocalAccessPoints",[pH],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPoints"),pt.prototype),vt(pt.prototype,"setRemoteDefaultVideoStreamType",[fH],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteDefaultVideoStreamType"),pt.prototype),vt(pt.prototype,"setRemoteVideoStreamType",[mH],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteVideoStreamType"),pt.prototype),vt(pt.prototype,"setStreamFallbackOption",[gH],Object.getOwnPropertyDescriptor(pt.prototype,"setStreamFallbackOption"),pt.prototype),vt(pt.prototype,"setEncryptionConfig",[_H],Object.getOwnPropertyDescriptor(pt.prototype,"setEncryptionConfig"),pt.prototype),vt(pt.prototype,"renewToken",[EH],Object.getOwnPropertyDescriptor(pt.prototype,"renewToken"),pt.prototype),vt(pt.prototype,"enableAudioVolumeIndicator",[yH],Object.getOwnPropertyDescriptor(pt.prototype,"enableAudioVolumeIndicator"),pt.prototype),vt(pt.prototype,"startLiveStreaming",[vH],Object.getOwnPropertyDescriptor(pt.prototype,"startLiveStreaming"),pt.prototype),vt(pt.prototype,"setLiveTranscoding",[SH],Object.getOwnPropertyDescriptor(pt.prototype,"setLiveTranscoding"),pt.prototype),vt(pt.prototype,"stopLiveStreaming",[bH],Object.getOwnPropertyDescriptor(pt.prototype,"stopLiveStreaming"),pt.prototype),vt(pt.prototype,"startChannelMediaRelay",[TH],Object.getOwnPropertyDescriptor(pt.prototype,"startChannelMediaRelay"),pt.prototype),vt(pt.prototype,"updateChannelMediaRelay",[wH],Object.getOwnPropertyDescriptor(pt.prototype,"updateChannelMediaRelay"),pt.prototype),vt(pt.prototype,"stopChannelMediaRelay",[RH],Object.getOwnPropertyDescriptor(pt.prototype,"stopChannelMediaRelay"),pt.prototype),vt(pt.prototype,"sendCustomReportMessage",[CH],Object.getOwnPropertyDescriptor(pt.prototype,"sendCustomReportMessage"),pt.prototype),vt(pt.prototype,"pickSVCLayer",[IH],Object.getOwnPropertyDescriptor(pt.prototype,"pickSVCLayer"),pt.prototype),vt(pt.prototype,"setRTMConfig",[AH],Object.getOwnPropertyDescriptor(pt.prototype,"setRTMConfig"),pt.prototype),vt(pt.prototype,"enableContentInspect",[PH],Object.getOwnPropertyDescriptor(pt.prototype,"enableContentInspect"),pt.prototype),vt(pt.prototype,"disableContentInspect",[OH],Object.getOwnPropertyDescriptor(pt.prototype,"disableContentInspect"),pt.prototype),vt(pt.prototype,"setImageModeration",[kH],Object.getOwnPropertyDescriptor(pt.prototype,"setImageModeration"),pt.prototype),vt(pt.prototype,"setP2PTransport",[NH],Object.getOwnPropertyDescriptor(pt.prototype,"setP2PTransport"),pt.prototype),vt(pt.prototype,"getJoinChannelServiceRecords",[DH],Object.getOwnPropertyDescriptor(pt.prototype,"getJoinChannelServiceRecords"),pt.prototype),vt(pt.prototype,"setPublishAudioFilterEnabled",[LH],Object.getOwnPropertyDescriptor(pt.prototype,"setPublishAudioFilterEnabled"),pt.prototype),pt);class xT{constructor(r,i){K(this,"id",0),K(this,"element",void 0),K(this,"peerPair",void 0),K(this,"context",void 0),K(this,"audioPlayerElement",void 0),K(this,"audioTrack",void 0),xT.count+=1,this.id=xT.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new lt(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},i=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await i(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(o){throw new Oe(X.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(c){throw new Oe(X.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new Oe(X.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){L.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var MH,RP;K(xT,"count",0);const Ime=window.AudioContext||window.webkitAudioContext,Ame=new(MH=Ut({report:Rt}),vt((RP=class{constructor(){K(this,"units",[]),K(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return L.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Ime);let r=this.units.find(i=>i&&i.getElement()===e);return r||(r=new xT(e,this.context),this.units.push(r)),r.startEchoCancellation(),L.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Cn().name!==Fn.SAFARI}}).prototype,"processExternalMediaAEC",[MH],Object.getOwnPropertyDescriptor(RP.prototype,"processExternalMediaAEC"),RP.prototype),RP);function UH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function VH(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?UH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):UH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const zx=window||document;function FH(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!zx)return;const i=Si._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);const o=c=>{if(!(c&&c.blockedURI&&(Si.onSecurityPolicyViolation||Si.getListeners(gh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;re("CSP_DETECTED_HOSTNAME_LIST").some(h=>st(u).call(u,h))&&(Si.onSecurityPolicyViolation&&typeof Si.onSecurityPolicyViolation=="function"&&Si.onSecurityPolicyViolation(c),Si.getListeners(gh.SECURITY_POLICY_VIOLATION).length>0&&Si.safeEmit(gh.SECURITY_POLICY_VIOLATION,c))};i&&zx.removeEventListener("securitypolicyviolation",i),(r||e&&typeof e=="function"||Si.getListeners(gh.SECURITY_POLICY_VIOLATION).length>0)&&zx.addEventListener("securitypolicyviolation",o),Si._cspEventHandlerPointer=o}var Pme=N,Ome=b6,jH=RegExp.prototype,kme=function(e){return e===jH||Pme(jH,e)?Ome(e):e.flags},uo=l(kme);function Jv(e){let r=e.length;for(;--r>=0;)e[r]=0}const Gx=256,BH=286,MT=30,UT=15,Hx=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),CP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Nme=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),WH=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qp=new Array(576);Jv(Qp);const VT=new Array(60);Jv(VT);const FT=new Array(512);Jv(FT);const jT=new Array(256);Jv(jT);const $x=new Array(29);Jv($x);const IP=new Array(MT);function Kx(e,r,i,o,c){this.static_tree=e,this.extra_bits=r,this.extra_base=i,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let zH,GH,HH;function qx(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}Jv(IP);const $H=e=>e<256?FT[e]:FT[256+(e>>>7)],BT=(e,r)=>{e.pending_buf[e.pending++]=255&r,e.pending_buf[e.pending++]=r>>>8&255},Kc=(e,r,i)=>{e.bi_valid>16-i?(e.bi_buf|=r<<e.bi_valid&65535,BT(e,e.bi_buf),e.bi_buf=r>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=i)},Sh=(e,r,i)=>{Kc(e,i[2*r],i[2*r+1])},KH=(e,r)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--r>0);return i>>>1},qH=(e,r,i)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=UT;c++)h=h+i[c-1]<<1,o[c]=h;for(u=0;u<=r;u++){let m=e[2*u+1];m!==0&&(e[2*u]=KH(o[m]++,m))}},YH=e=>{let r;for(r=0;r<BH;r++)e.dyn_ltree[2*r]=0;for(r=0;r<MT;r++)e.dyn_dtree[2*r]=0;for(r=0;r<19;r++)e.bl_tree[2*r]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},XH=e=>{e.bi_valid>8?BT(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},JH=(e,r,i,o)=>{const c=2*r,u=2*i;return e[c]<e[u]||e[c]===e[u]&&o[r]<=o[i]},Yx=(e,r,i)=>{const o=e.heap[i];let c=i<<1;for(;c<=e.heap_len&&(c<e.heap_len&&JH(r,e.heap[c+1],e.heap[c],e.depth)&&c++,!JH(r,o,e.heap[c],e.depth));)e.heap[i]=e.heap[c],i=c,c<<=1;e.heap[i]=o},QH=(e,r,i)=>{let o,c,u,h,m=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+m++],o+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],o===0?Sh(e,c,r):(u=jT[c],Sh(e,u+Gx+1,r),h=Hx[u],h!==0&&(c-=$x[u],Kc(e,c,h)),o--,u=$H(o),Sh(e,u,i),h=CP[u],h!==0&&(o-=IP[u],Kc(e,o,h)));while(m<e.sym_next);Sh(e,256,r)},Xx=(e,r)=>{const i=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,_,y=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(e.heap[++e.heap_len]=y=h,e.depth[h]=0):i[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=y<2?++y:0,i[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=o[2*_+1]);for(r.max_code=y,h=e.heap_len>>1;h>=1;h--)Yx(e,i,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Yx(e,i,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,i[2*_]=i[2*h]+i[2*m],e.depth[_]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,i[2*h+1]=i[2*m+1]=_,e.heap[1]=_++,Yx(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,R)=>{const P=R.dyn_tree,k=R.max_code,z=R.stat_desc.static_tree,U=R.stat_desc.has_stree,F=R.stat_desc.extra_bits,q=R.stat_desc.extra_base,Y=R.stat_desc.max_length;let le,Ee,ye,ge,ke,qe,ut=0;for(ge=0;ge<=UT;ge++)S.bl_count[ge]=0;for(P[2*S.heap[S.heap_max]+1]=0,le=S.heap_max+1;le<573;le++)Ee=S.heap[le],ge=P[2*P[2*Ee+1]+1]+1,ge>Y&&(ge=Y,ut++),P[2*Ee+1]=ge,Ee>k||(S.bl_count[ge]++,ke=0,Ee>=q&&(ke=F[Ee-q]),qe=P[2*Ee],S.opt_len+=qe*(ge+ke),U&&(S.static_len+=qe*(z[2*Ee+1]+ke)));if(ut!==0){do{for(ge=Y-1;S.bl_count[ge]===0;)ge--;S.bl_count[ge]--,S.bl_count[ge+1]+=2,S.bl_count[Y]--,ut-=2}while(ut>0);for(ge=Y;ge!==0;ge--)for(Ee=S.bl_count[ge];Ee!==0;)ye=S.heap[--le],ye>k||(P[2*ye+1]!==ge&&(S.opt_len+=(ge-P[2*ye+1])*P[2*ye],P[2*ye+1]=ge),Ee--)}})(e,r),qH(i,y,e.bl_count)},ZH=(e,r,i)=>{let o,c,u=-1,h=r[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),r[2*(i+1)+1]=65535,o=0;o<=i;o++)c=h,h=r[2*(o+1)+1],++m<_&&c===h||(m<y?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4))},e7=(e,r,i)=>{let o,c,u=-1,h=r[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),o=0;o<=i;o++)if(c=h,h=r[2*(o+1)+1],!(++m<_&&c===h)){if(m<y)do Sh(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Sh(e,c,e.bl_tree),m--),Sh(e,16,e.bl_tree),Kc(e,m-3,2)):m<=10?(Sh(e,17,e.bl_tree),Kc(e,m-3,3)):(Sh(e,18,e.bl_tree),Kc(e,m-11,7));m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4)}};let t7=!1;const n7=(e,r,i,o)=>{Kc(e,0+(o?1:0),3),XH(e),BT(e,i),BT(e,~i),i&&e.pending_buf.set(e.window.subarray(r,r+i),e.pending),e.pending+=i};var Dme=e=>{t7||((()=>{let r,i,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for($x[c]=o,r=0;r<1<<Hx[c];r++)jT[o++]=c;for(jT[o-1]=c,u=0,c=0;c<16;c++)for(IP[c]=u,r=0;r<1<<CP[c];r++)FT[u++]=c;for(u>>=7;c<MT;c++)for(IP[c]=u<<7,r=0;r<1<<CP[c]-7;r++)FT[256+u++]=c;for(i=0;i<=UT;i++)h[i]=0;for(r=0;r<=143;)Qp[2*r+1]=8,r++,h[8]++;for(;r<=255;)Qp[2*r+1]=9,r++,h[9]++;for(;r<=279;)Qp[2*r+1]=7,r++,h[7]++;for(;r<=287;)Qp[2*r+1]=8,r++,h[8]++;for(qH(Qp,287,h),r=0;r<MT;r++)VT[2*r+1]=5,VT[2*r]=KH(r,5);zH=new Kx(Qp,Hx,257,BH,UT),GH=new Kx(VT,CP,0,MT,UT),HH=new Kx(new Array(0),Nme,0,19,7)})(),t7=!0),e.l_desc=new qx(e.dyn_ltree,zH),e.d_desc=new qx(e.dyn_dtree,GH),e.bl_desc=new qx(e.bl_tree,HH),e.bi_buf=0,e.bi_valid=0,YH(e)},Lme=(e,r,i,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let _,y=4093624447;for(_=0;_<=31;_++,y>>>=1)if(1&y&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<Gx;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(e)),Xx(e,e.l_desc),Xx(e,e.d_desc),h=(m=>{let _;for(ZH(m,m.dyn_ltree,m.l_desc.max_code),ZH(m,m.dyn_dtree,m.d_desc.max_code),Xx(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*WH[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&r!==-1?n7(e,r,i,o):e.strategy===4||u===c?(Kc(e,2+(o?1:0),3),QH(e,Qp,VT)):(Kc(e,4+(o?1:0),3),((m,_,y,S)=>{let R;for(Kc(m,_-257,5),Kc(m,y-1,5),Kc(m,S-4,4),R=0;R<S;R++)Kc(m,m.bl_tree[2*WH[R]+1],3);e7(m,m.dyn_ltree,_-1),e7(m,m.dyn_dtree,y-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),QH(e,e.dyn_ltree,e.dyn_dtree)),YH(e),o&&XH(e)},xme=(e,r,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,r===0?e.dyn_ltree[2*i]++:(e.matches++,r--,e.dyn_ltree[2*(jT[i]+Gx+1)]++,e.dyn_dtree[2*$H(r)]++),e.sym_next===e.sym_end),Mme=e=>{Kc(e,2,3),Sh(e,256,Qp),(r=>{r.bi_valid===16?(BT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(e)},Ume={_tr_init:Dme,_tr_stored_block:n7,_tr_flush_block:Lme,_tr_tally:xme,_tr_align:Mme},WT=(e,r,i,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+r[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const Vme=new Uint32Array((()=>{let e,r=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;r[i]=e}return r})());var Oo=(e,r,i,o)=>{const c=Vme,u=o+i;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^r[h])];return-1^e},G_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},AP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Fme,_tr_stored_block:Jx,_tr_flush_block:jme,_tr_tally:Fm,_tr_align:Bme}=Ume,{Z_NO_FLUSH:jm,Z_PARTIAL_FLUSH:Wme,Z_FULL_FLUSH:zme,Z_FINISH:_u,Z_BLOCK:r7,Z_OK:na,Z_STREAM_END:i7,Z_STREAM_ERROR:bh,Z_DATA_ERROR:Gme,Z_BUF_ERROR:Qx,Z_DEFAULT_COMPRESSION:Hme,Z_FILTERED:$me,Z_HUFFMAN_ONLY:PP,Z_RLE:Kme,Z_FIXED:qme,Z_DEFAULT_STRATEGY:Yme,Z_UNKNOWN:Xme,Z_DEFLATED:OP}=AP,Zx=286,Jme=30,Qme=19,Zme=2*Zx+1,ege=15,H_=258,Th=262,Qv=42,$_=113,zT=666,K_=(e,r)=>(e.msg=G_[r],r),s7=e=>2*e-(e>4?9:0),Bm=e=>{let r=e.length;for(;--r>=0;)e[r]=0},tge=e=>{let r,i,o,c=e.w_size;r=e.hash_size,o=r;do i=e.head[--o],e.head[o]=i>=c?i-c:0;while(--r);r=c,o=r;do i=e.prev[--o],e.prev[o]=i>=c?i-c:0;while(--r)};let Wm=(e,r,i)=>(r<<e.hash_shift^i)&e.hash_mask;const Rl=e=>{const r=e.state;let i=r.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),e.next_out),e.next_out+=i,r.pending_out+=i,e.total_out+=i,e.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},Cl=(e,r)=>{jme(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,Rl(e.strm)},Kr=(e,r)=>{e.pending_buf[e.pending++]=r},GT=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=255&r},e2=(e,r,i,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,r.set(e.input.subarray(e.next_in,e.next_in+c),i),e.state.wrap===1?e.adler=WT(e.adler,r,c,i):e.state.wrap===2&&(e.adler=Oo(e.adler,r,c,i)),e.next_in+=c,e.total_in+=c,c)},o7=(e,r)=>{let i,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const _=e.strstart>e.w_size-Th?e.strstart-(e.w_size-Th):0,y=e.window,S=e.w_mask,R=e.prev,P=e.strstart+H_;let k=y[u+h-1],z=y[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(i=r,y[i+h]===z&&y[i+h-1]===k&&y[i]===y[u]&&y[++i]===y[u+1]){u+=2,i++;do;while(y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&u<P);if(o=H_-(P-u),u=P-H_,o>h){if(e.match_start=r,h=o,o>=m)break;k=y[u+h-1],z=y[u+h]}}while((r=R[r&S])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},Zv=e=>{const r=e.w_size;let i,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-Th)&&(e.window.set(e.window.subarray(r,r+r-o),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),tge(e),o+=r),e.strm.avail_in===0)break;if(i=e2(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Wm(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Wm(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Th&&e.strm.avail_in!==0)},a7=(e,r)=>{let i,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(i=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&r!==_u||r===jm||i!==o+e.strm.avail_in)))break;h=r===_u&&i===o+e.strm.avail_in?1:0,Jx(e,0,0,h),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,Rl(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(e2(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:r!==jm&&r!==_u&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(e2(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||r===_u)&&r!==jm&&e.strm.avail_in===0&&o<=c)&&(i=o>c?c:o,h=r===_u&&e.strm.avail_in===0&&i===o?1:0,Jx(e,e.block_start,i,h),e.block_start+=i,Rl(e.strm)),h?3:1)},t2=(e,r)=>{let i,o;for(;;){if(e.lookahead<Th){if(Zv(e),e.lookahead<Th&&r===jm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Wm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-Th&&(e.match_length=o7(e,i)),e.match_length>=3)if(o=Fm(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Wm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Wm(e,e.ins_h,e.window[e.strstart+1]);else o=Fm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(Cl(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,r===_u?(Cl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Cl(e,!1),e.strm.avail_out===0)?1:2},eS=(e,r)=>{let i,o,c;for(;;){if(e.lookahead<Th){if(Zv(e),e.lookahead<Th&&r===jm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Wm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Th&&(e.match_length=o7(e,i),e.match_length<=5&&(e.strategy===$me||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=Fm(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Wm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(Cl(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=Fm(e,0,e.window[e.strstart-1]),o&&Cl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=Fm(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,r===_u?(Cl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Cl(e,!1),e.strm.avail_out===0)?1:2};function wh(e,r,i,o,c){this.good_length=e,this.max_lazy=r,this.nice_length=i,this.max_chain=o,this.func=c}const HT=[new wh(0,0,0,0,a7),new wh(4,4,8,4,t2),new wh(4,5,16,8,t2),new wh(4,6,32,32,t2),new wh(4,4,16,16,eS),new wh(8,16,32,32,eS),new wh(8,16,128,128,eS),new wh(8,32,128,256,eS),new wh(32,128,258,1024,eS),new wh(32,258,258,4096,eS)];function nge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=OP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Zme),this.dyn_dtree=new Uint16Array(2*(2*Jme+1)),this.bl_tree=new Uint16Array(2*(2*Qme+1)),Bm(this.dyn_ltree),Bm(this.dyn_dtree),Bm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ege+1),this.heap=new Uint16Array(2*Zx+1),Bm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Zx+1),Bm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const $T=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.status!==Qv&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==$_&&r.status!==zT?1:0},c7=e=>{if($T(e))return K_(e,bh);e.total_in=e.total_out=0,e.data_type=Xme;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?Qv:$_,e.adler=r.wrap===2?0:1,r.last_flush=-2,Fme(r),na},l7=e=>{const r=c7(e);return r===na&&(i=>{i.window_size=2*i.w_size,Bm(i.head),i.max_lazy_match=HT[i.level].max_lazy,i.good_match=HT[i.level].good_length,i.nice_match=HT[i.level].nice_length,i.max_chain_length=HT[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),r},u7=(e,r,i,o,c,u)=>{if(!e)return bh;let h=1;if(r===Hme&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||i!==OP||o<8||o>15||r<0||r>9||u<0||u>qme||o===8&&h!==1)return K_(e,bh);o===8&&(o=9);const m=new nge;return e.state=m,m.strm=e,m.status=Qv,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=i,l7(e)};var rge=(e,r)=>{if($T(e)||r>r7||r<0)return e?K_(e,bh):bh;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===zT&&r!==_u)return K_(e,e.avail_out===0?Qx:bh);const o=i.last_flush;if(i.last_flush=r,i.pending!==0){if(Rl(e),e.avail_out===0)return i.last_flush=-1,na}else if(e.avail_in===0&&s7(r)<=s7(o)&&r!==_u)return K_(e,Qx);if(i.status===zT&&e.avail_in!==0)return K_(e,Qx);if(i.status===Qv&&i.wrap===0&&(i.status=$_),i.status===Qv){let c=OP+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=PP||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,GT(i,c),i.strstart!==0&&(GT(i,e.adler>>>16),GT(i,65535&e.adler)),e.adler=1,i.status=$_,Rl(e),i.pending!==0)return i.last_flush=-1,na}if(i.status===57){if(e.adler=0,Kr(i,31),Kr(i,139),Kr(i,8),i.gzhead)Kr(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Kr(i,255&i.gzhead.time),Kr(i,i.gzhead.time>>8&255),Kr(i,i.gzhead.time>>16&255),Kr(i,i.gzhead.time>>24&255),Kr(i,i.level===9?2:i.strategy>=PP||i.level<2?4:0),Kr(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Kr(i,255&i.gzhead.extra.length),Kr(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Oo(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Kr(i,0),Kr(i,0),Kr(i,0),Kr(i,0),Kr(i,0),Kr(i,i.level===9?2:i.strategy>=PP||i.level<2?4:0),Kr(i,3),i.status=$_,Rl(e),i.pending!==0)return i.last_flush=-1,na}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let m=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+m),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(e.adler=Oo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=m,Rl(e),i.pending!==0)return i.last_flush=-1,na;c=0,u-=m}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(e.adler=Oo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=Oo(e.adler,i.pending_buf,i.pending-u,u)),Rl(e),i.pending!==0)return i.last_flush=-1,na;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Kr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=Oo(e.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=Oo(e.adler,i.pending_buf,i.pending-u,u)),Rl(e),i.pending!==0)return i.last_flush=-1,na;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Kr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=Oo(e.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(Rl(e),i.pending!==0))return i.last_flush=-1,na;Kr(i,255&e.adler),Kr(i,e.adler>>8&255),e.adler=0}if(i.status=$_,Rl(e),i.pending!==0)return i.last_flush=-1,na}if(e.avail_in!==0||i.lookahead!==0||r!==jm&&i.status!==zT){let c=i.level===0?a7(i,r):i.strategy===PP?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(Zv(u),u.lookahead===0)){if(h===jm)return 1;break}if(u.match_length=0,m=Fm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(Cl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===_u?(Cl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Cl(u,!1),u.strm.avail_out===0)?1:2})(i,r):i.strategy===Kme?((u,h)=>{let m,_,y,S;const R=u.window;for(;;){if(u.lookahead<=H_){if(Zv(u),u.lookahead<=H_&&h===jm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(y=u.strstart-1,_=R[y],_===R[++y]&&_===R[++y]&&_===R[++y])){S=u.strstart+H_;do;while(_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&y<S);u.match_length=H_-(S-y),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=Fm(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=Fm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(Cl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===_u?(Cl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Cl(u,!1),u.strm.avail_out===0)?1:2})(i,r):HT[i.level].func(i,r);if(c!==3&&c!==4||(i.status=zT),c===1||c===3)return e.avail_out===0&&(i.last_flush=-1),na;if(c===2&&(r===Wme?Bme(i):r!==r7&&(Jx(i,0,0,!1),r===zme&&(Bm(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),Rl(e),e.avail_out===0))return i.last_flush=-1,na}return r!==_u?na:i.wrap<=0?i7:(i.wrap===2?(Kr(i,255&e.adler),Kr(i,e.adler>>8&255),Kr(i,e.adler>>16&255),Kr(i,e.adler>>24&255),Kr(i,255&e.total_in),Kr(i,e.total_in>>8&255),Kr(i,e.total_in>>16&255),Kr(i,e.total_in>>24&255)):(GT(i,e.adler>>>16),GT(i,65535&e.adler)),Rl(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?na:i7)},ige=(e,r)=>{let i=r.length;if($T(e))return bh;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==Qv||o.lookahead)return bh;if(c===1&&(e.adler=WT(e.adler,r,i,0)),o.wrap=0,i>=o.w_size){c===0&&(Bm(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(r.subarray(i-o.w_size,i),0),r=_,i=o.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=i,e.next_in=0,e.input=r,Zv(o);o.lookahead>=3;){let _=o.strstart,y=o.lookahead-2;do o.ins_h=Wm(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--y);o.strstart=_,o.lookahead=2,Zv(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,o.wrap=c,na},KT={deflateInit:(e,r)=>u7(e,r,OP,15,8,Yme),deflateInit2:u7,deflateReset:l7,deflateResetKeep:c7,deflateSetHeader:(e,r)=>$T(e)||e.state.wrap!==2?bh:(e.state.gzhead=r,na),deflate:rge,deflateEnd:e=>{if($T(e))return bh;const r=e.state.status;return e.state=null,r===$_?K_(e,Gme):na},deflateSetDictionary:ige,deflateInfo:"pako deflate (from Nodeca project)"};const sge=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var kP={assign:function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const o in i)sge(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let r=0;for(let o=0,c=e.length;o<c;o++)r+=e[o].length;const i=new Uint8Array(r);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];i.set(h,c),c+=h.length}return i}};let d7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d7=!1}const qT=new Uint8Array(256);for(let e=0;e<256;e++)qT[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;qT[254]=qT[254]=1;var YT={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,i,o,c,u,h=e.length,m=0;for(c=0;c<h;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),m+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),i<128?r[u++]=i:i<2048?(r[u++]=192|i>>>6,r[u++]=128|63&i):i<65536?(r[u++]=224|i>>>12,r[u++]=128|i>>>6&63,r[u++]=128|63&i):(r[u++]=240|i>>>18,r[u++]=128|i>>>12&63,r[u++]=128|i>>>6&63,r[u++]=128|63&i);return r},buf2string:(e,r)=>{const i=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let o,c;const u=new Array(2*i);for(c=0,o=0;o<i;){let h=e[o++];if(h<128){u[c++]=h;continue}let m=qT[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<i;)h=h<<6|63&e[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&d7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let _="";for(let y=0;y<m;y++)_+=String.fromCharCode(h[y]);return _})(u,c)},utf8border:(e,r)=>{(r=r||e.length)>e.length&&(r=e.length);let i=r-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?r:i+qT[e[i]]>r?i:r}},h7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const p7=Object.prototype.toString,{Z_NO_FLUSH:oge,Z_SYNC_FLUSH:age,Z_FULL_FLUSH:cge,Z_FINISH:lge,Z_OK:NP,Z_STREAM_END:uge,Z_DEFAULT_COMPRESSION:dge,Z_DEFAULT_STRATEGY:hge,Z_DEFLATED:pge}=AP;function DP(e){this.options=kP.assign({level:dge,method:pge,chunkSize:16384,windowBits:15,memLevel:8,strategy:hge},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h7,this.strm.avail_out=0;let i=KT.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==NP)throw new Error(G_[i]);if(r.header&&KT.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?YT.string2buf(r.dictionary):p7.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=KT.deflateSetDictionary(this.strm,o),i!==NP)throw new Error(G_[i]);this._dict_set=!0}}function fge(e,r){const i=new DP(r);if(i.push(e,!0),i.err)throw i.msg||G_[i.err];return i.result}DP.prototype.push=function(e,r){const i=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?lge:oge,typeof e=="string"?i.input=YT.string2buf(e):p7.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(u===age||u===cge)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=KT.deflate(i,u),c===uge)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=KT.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===NP;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},DP.prototype.onData=function(e){this.chunks.push(e)},DP.prototype.onEnd=function(e){e===NP&&(this.result=kP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var mge={deflate:fge};const LP=16209;var gge=function(e,r){let i,o,c,u,h,m,_,y,S,R,P,k,z,U,F,q,Y,le,Ee,ye,ge,ke,qe,ut;const ft=e.state;i=e.next_in,qe=e.input,o=i+(e.avail_in-5),c=e.next_out,ut=e.output,u=c-(r-e.avail_out),h=c+(e.avail_out-257),m=ft.dmax,_=ft.wsize,y=ft.whave,S=ft.wnext,R=ft.window,P=ft.hold,k=ft.bits,z=ft.lencode,U=ft.distcode,F=(1<<ft.lenbits)-1,q=(1<<ft.distbits)-1;e:do{k<15&&(P+=qe[i++]<<k,k+=8,P+=qe[i++]<<k,k+=8),Y=z[P&F];t:for(;;){if(le=Y>>>24,P>>>=le,k-=le,le=Y>>>16&255,le===0)ut[c++]=65535&Y;else{if(!(16&le)){if((64&le)==0){Y=z[(65535&Y)+(P&(1<<le)-1)];continue t}if(32&le){ft.mode=16191;break e}e.msg="invalid literal/length code",ft.mode=LP;break e}Ee=65535&Y,le&=15,le&&(k<le&&(P+=qe[i++]<<k,k+=8),Ee+=P&(1<<le)-1,P>>>=le,k-=le),k<15&&(P+=qe[i++]<<k,k+=8,P+=qe[i++]<<k,k+=8),Y=U[P&q];n:for(;;){if(le=Y>>>24,P>>>=le,k-=le,le=Y>>>16&255,!(16&le)){if((64&le)==0){Y=U[(65535&Y)+(P&(1<<le)-1)];continue n}e.msg="invalid distance code",ft.mode=LP;break e}if(ye=65535&Y,le&=15,k<le&&(P+=qe[i++]<<k,k+=8,k<le&&(P+=qe[i++]<<k,k+=8)),ye+=P&(1<<le)-1,ye>m){e.msg="invalid distance too far back",ft.mode=LP;break e}if(P>>>=le,k-=le,le=c-u,ye>le){if(le=ye-le,le>y&&ft.sane){e.msg="invalid distance too far back",ft.mode=LP;break e}if(ge=0,ke=R,S===0){if(ge+=_-le,le<Ee){Ee-=le;do ut[c++]=R[ge++];while(--le);ge=c-ye,ke=ut}}else if(S<le){if(ge+=_+S-le,le-=S,le<Ee){Ee-=le;do ut[c++]=R[ge++];while(--le);if(ge=0,S<Ee){le=S,Ee-=le;do ut[c++]=R[ge++];while(--le);ge=c-ye,ke=ut}}}else if(ge+=S-le,le<Ee){Ee-=le;do ut[c++]=R[ge++];while(--le);ge=c-ye,ke=ut}for(;Ee>2;)ut[c++]=ke[ge++],ut[c++]=ke[ge++],ut[c++]=ke[ge++],Ee-=3;Ee&&(ut[c++]=ke[ge++],Ee>1&&(ut[c++]=ke[ge++]))}else{ge=c-ye;do ut[c++]=ut[ge++],ut[c++]=ut[ge++],ut[c++]=ut[ge++],Ee-=3;while(Ee>2);Ee&&(ut[c++]=ut[ge++],Ee>1&&(ut[c++]=ut[ge++]))}break}}break}}while(i<o&&c<h);Ee=k>>3,i-=Ee,k-=Ee<<3,P&=(1<<k)-1,e.next_in=i,e.next_out=c,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=c<h?h-c+257:257-(c-h),ft.hold=P,ft.bits=k};const xP=15,_ge=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ege=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),yge=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),vge=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var XT=(e,r,i,o,c,u,h,m)=>{const _=m.bits;let y,S,R,P,k,z,U=0,F=0,q=0,Y=0,le=0,Ee=0,ye=0,ge=0,ke=0,qe=0,ut=null;const ft=new Uint16Array(16),yn=new Uint16Array(16);let vn,ur,ni,Gr=null;for(U=0;U<=xP;U++)ft[U]=0;for(F=0;F<o;F++)ft[r[i+F]]++;for(le=_,Y=xP;Y>=1&&ft[Y]===0;Y--);if(le>Y&&(le=Y),Y===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(q=1;q<Y&&ft[q]===0;q++);for(le<q&&(le=q),ge=1,U=1;U<=xP;U++)if(ge<<=1,ge-=ft[U],ge<0)return-1;if(ge>0&&(e===0||Y!==1))return-1;for(yn[1]=0,U=1;U<xP;U++)yn[U+1]=yn[U]+ft[U];for(F=0;F<o;F++)r[i+F]!==0&&(h[yn[r[i+F]]++]=F);if(e===0?(ut=Gr=h,z=20):e===1?(ut=_ge,Gr=Ege,z=257):(ut=yge,Gr=vge,z=0),qe=0,F=0,U=q,k=u,Ee=le,ye=0,R=-1,ke=1<<le,P=ke-1,e===1&&ke>852||e===2&&ke>592)return 1;for(;;){vn=U-ye,h[F]+1<z?(ur=0,ni=h[F]):h[F]>=z?(ur=Gr[h[F]-z],ni=ut[h[F]-z]):(ur=96,ni=0),y=1<<U-ye,S=1<<Ee,q=S;do S-=y,c[k+(qe>>ye)+S]=vn<<24|ur<<16|ni|0;while(S!==0);for(y=1<<U-1;qe&y;)y>>=1;if(y!==0?(qe&=y-1,qe+=y):qe=0,F++,--ft[U]==0){if(U===Y)break;U=r[i+h[F]]}if(U>le&&(qe&P)!==R){for(ye===0&&(ye=le),k+=q,Ee=U-ye,ge=1<<Ee;Ee+ye<Y&&(ge-=ft[Ee+ye],!(ge<=0));)Ee++,ge<<=1;if(ke+=1<<Ee,e===1&&ke>852||e===2&&ke>592)return 1;R=qe&P,c[R]=le<<24|Ee<<16|k-u|0}}return qe!==0&&(c[k+qe]=U-ye<<24|64<<16|0),m.bits=le,0};const{Z_FINISH:f7,Z_BLOCK:Sge,Z_TREES:MP,Z_OK:q_,Z_STREAM_END:bge,Z_NEED_DICT:Tge,Z_STREAM_ERROR:Eu,Z_DATA_ERROR:m7,Z_MEM_ERROR:g7,Z_BUF_ERROR:wge,Z_DEFLATED:_7}=AP,UP=16180,VP=16190,Zp=16191,n2=16192,r2=16194,FP=16199,jP=16200,i2=16206,ts=16209,E7=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Rge(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Y_=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.mode<UP||r.mode>16211?1:0},y7=e=>{if(Y_(e))return Eu;const r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=1&r.wrap),r.mode=UP,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,q_},v7=e=>{if(Y_(e))return Eu;const r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,y7(e)},S7=(e,r)=>{let i;if(Y_(e))return Eu;const o=e.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Eu:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=i,o.wbits=r,v7(e))},b7=(e,r)=>{if(!e)return Eu;const i=new Rge;e.state=i,i.strm=e,i.window=null,i.mode=UP;const o=S7(e,r);return o!==q_&&(e.state=null),o};let s2,o2,T7=!0;const Cge=e=>{if(T7){s2=new Int32Array(512),o2=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(XT(1,e.lens,0,288,s2,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;XT(2,e.lens,0,32,o2,0,e.work,{bits:5}),T7=!1}e.lencode=s2,e.lenbits=9,e.distcode=o2,e.distbits=5},w7=(e,r,i,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(r.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(r.subarray(i-o,i-o+c),u.wnext),(o-=c)?(u.window.set(r.subarray(i-o,i),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var Ige=(e,r)=>{let i,o,c,u,h,m,_,y,S,R,P,k,z,U,F,q,Y,le,Ee,ye,ge,ke,qe=0;const ut=new Uint8Array(4);let ft,yn;const vn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Y_(e)||!e.output||!e.input&&e.avail_in!==0)return Eu;i=e.state,i.mode===Zp&&(i.mode=n2),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,R=m,P=_,ke=q_;e:for(;;)switch(i.mode){case UP:if(i.wrap===0){i.mode=n2;break}for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(2&i.wrap&&y===35615){i.wbits===0&&(i.wbits=15),i.check=0,ut[0]=255&y,ut[1]=y>>>8&255,i.check=Oo(i.check,ut,2,0),y=0,S=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",i.mode=ts;break}if((15&y)!==_7){e.msg="unknown compression method",i.mode=ts;break}if(y>>>=4,S-=4,ge=8+(15&y),i.wbits===0&&(i.wbits=ge),ge>15||ge>i.wbits){e.msg="invalid window size",i.mode=ts;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&y?16189:Zp,y=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.flags=y,(255&uo(i))!==_7){e.msg="unknown compression method",i.mode=ts;break}if(57344&uo(i)){e.msg="unknown header flags set",i.mode=ts;break}i.head&&(i.head.text=y>>8&1),512&uo(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,i.check=Oo(i.check,ut,2,0)),y=0,S=0,i.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.time=y),512&uo(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,ut[2]=y>>>16&255,ut[3]=y>>>24&255,i.check=Oo(i.check,ut,4,0)),y=0,S=0,i.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&uo(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,i.check=Oo(i.check,ut,2,0)),y=0,S=0,i.mode=16184;case 16184:if(1024&uo(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length=y,i.head&&(i.head.extra_len=y),512&uo(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,i.check=Oo(i.check,ut,2,0)),y=0,S=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&uo(i)&&(k=i.length,k>m&&(k=m),k&&(i.head&&(ge=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(u,u+k),ge)),512&uo(i)&&4&i.wrap&&(i.check=Oo(i.check,o,k,u)),m-=k,u+=k,i.length-=k),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&uo(i)){if(m===0)break e;k=0;do ge=o[u+k++],i.head&&ge&&i.length<65536&&(i.head.name+=String.fromCharCode(ge));while(ge&&k<m);if(512&uo(i)&&4&i.wrap&&(i.check=Oo(i.check,o,k,u)),m-=k,u+=k,ge)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&uo(i)){if(m===0)break e;k=0;do ge=o[u+k++],i.head&&ge&&i.length<65536&&(i.head.comment+=String.fromCharCode(ge));while(ge&&k<m);if(512&uo(i)&&4&i.wrap&&(i.check=Oo(i.check,o,k,u)),m-=k,u+=k,ge)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&uo(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ts;break}y=0,S=0}i.head&&(i.head.hcrc=uo(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Zp;break;case 16189:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}e.adler=i.check=E7(y),y=0,S=0,i.mode=VP;case VP:if(i.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,Tge;e.adler=i.check=1,i.mode=Zp;case Zp:if(r===Sge||r===MP)break e;case n2:if(i.last){y>>>=7&S,S-=7&S,i.mode=i2;break}for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}switch(i.last=1&y,y>>>=1,S-=1,3&y){case 0:i.mode=16193;break;case 1:if(Cge(i),i.mode=FP,r===MP){y>>>=2,S-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=ts}y>>>=2,S-=2;break;case 16193:for(y>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ts;break}if(i.length=65535&y,y=0,S=0,i.mode=r2,r===MP)break e;case r2:i.mode=16195;case 16195:if(k=i.length,k){if(k>m&&(k=m),k>_&&(k=_),k===0)break e;c.set(o.subarray(u,u+k),h),m-=k,u+=k,_-=k,h+=k,i.length-=k;break}i.mode=Zp;break;case 16196:for(;S<14;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.nlen=257+(31&y),y>>>=5,S-=5,i.ndist=1+(31&y),y>>>=5,S-=5,i.ncode=4+(15&y),y>>>=4,S-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ts;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.lens[vn[i.have++]]=7&y,y>>>=3,S-=3}for(;i.have<19;)i.lens[vn[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ft={bits:i.lenbits},ke=XT(0,i.lens,0,19,i.lencode,0,i.work,ft),i.lenbits=ft.bits,ke){e.msg="invalid code lengths set",i.mode=ts;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;qe=i.lencode[y&(1<<i.lenbits)-1],F=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(F<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(Y<16)y>>>=F,S-=F,i.lens[i.have++]=Y;else{if(Y===16){for(yn=F+2;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(y>>>=F,S-=F,i.have===0){e.msg="invalid bit length repeat",i.mode=ts;break}ge=i.lens[i.have-1],k=3+(3&y),y>>>=2,S-=2}else if(Y===17){for(yn=F+3;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=F,S-=F,ge=0,k=3+(7&y),y>>>=3,S-=3}else{for(yn=F+7;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=F,S-=F,ge=0,k=11+(127&y),y>>>=7,S-=7}if(i.have+k>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ts;break}for(;k--;)i.lens[i.have++]=ge}}if(i.mode===ts)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=ts;break}if(i.lenbits=9,ft={bits:i.lenbits},ke=XT(1,i.lens,0,i.nlen,i.lencode,0,i.work,ft),i.lenbits=ft.bits,ke){e.msg="invalid literal/lengths set",i.mode=ts;break}if(i.distbits=6,i.distcode=i.distdyn,ft={bits:i.distbits},ke=XT(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ft),i.distbits=ft.bits,ke){e.msg="invalid distances set",i.mode=ts;break}if(i.mode=FP,r===MP)break e;case FP:i.mode=jP;case jP:if(m>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,gge(e,P),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,i.mode===Zp&&(i.back=-1);break}for(i.back=0;qe=i.lencode[y&(1<<i.lenbits)-1],F=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(F<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(q&&(240&q)==0){for(le=F,Ee=q,ye=Y;qe=i.lencode[ye+((y&(1<<le+Ee)-1)>>le)],F=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(le+F<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=le,S-=le,i.back+=le}if(y>>>=F,S-=F,i.back+=F,i.length=Y,q===0){i.mode=16205;break}if(32&q){i.back=-1,i.mode=Zp;break}if(64&q){e.msg="invalid literal/length code",i.mode=ts;break}i.extra=15&q,i.mode=16201;case 16201:if(i.extra){for(yn=i.extra;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;qe=i.distcode[y&(1<<i.distbits)-1],F=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(F<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((240&q)==0){for(le=F,Ee=q,ye=Y;qe=i.distcode[ye+((y&(1<<le+Ee)-1)>>le)],F=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(le+F<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=le,S-=le,i.back+=le}if(y>>>=F,S-=F,i.back+=F,64&q){e.msg="invalid distance code",i.mode=ts;break}i.offset=Y,i.extra=15&q,i.mode=16203;case 16203:if(i.extra){for(yn=i.extra;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ts;break}i.mode=16204;case 16204:if(_===0)break e;if(k=P-_,i.offset>k){if(k=i.offset-k,k>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ts;break}k>i.wnext?(k-=i.wnext,z=i.wsize-k):z=i.wnext-k,k>i.length&&(k=i.length),U=i.window}else U=c,z=h-i.offset,k=i.length;k>_&&(k=_),_-=k,i.length-=k;do c[h++]=U[z++];while(--k);i.length===0&&(i.mode=jP);break;case 16205:if(_===0)break e;c[h++]=i.length,_--,i.mode=jP;break;case i2:if(i.wrap){for(;S<32;){if(m===0)break e;m--,y|=o[u++]<<S,S+=8}if(P-=_,e.total_out+=P,i.total+=P,4&i.wrap&&P&&(e.adler=i.check=uo(i)?Oo(i.check,c,P,h-P):WT(i.check,c,P,h-P)),P=_,4&i.wrap&&(uo(i)?y:E7(y))!==i.check){e.msg="incorrect data check",i.mode=ts;break}y=0,S=0}i.mode=16207;case 16207:if(i.wrap&&uo(i)){for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ts;break}y=0,S=0}i.mode=16208;case 16208:ke=bge;break e;case ts:ke=m7;break e;case 16210:return g7;default:return Eu}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,(i.wsize||P!==e.avail_out&&i.mode<ts&&(i.mode<i2||r!==f7))&&w7(e,e.output,e.next_out,P-e.avail_out),R-=e.avail_in,P-=e.avail_out,e.total_in+=R,e.total_out+=P,i.total+=P,4&i.wrap&&P&&(e.adler=i.check=uo(i)?Oo(i.check,c,P,e.next_out-P):WT(i.check,c,P,e.next_out-P)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Zp?128:0)+(i.mode===FP||i.mode===r2?256:0),(R===0&&P===0||r===f7)&&ke===q_&&(ke=wge),ke},ef={inflateReset:v7,inflateReset2:S7,inflateResetKeep:y7,inflateInit:e=>b7(e,15),inflateInit2:b7,inflate:Ige,inflateEnd:e=>{if(Y_(e))return Eu;let r=e.state;return r.window&&(r.window=null),e.state=null,q_},inflateGetHeader:(e,r)=>{if(Y_(e))return Eu;const i=e.state;return(2&i.wrap)==0?Eu:(i.head=r,r.done=!1,q_)},inflateSetDictionary:(e,r)=>{const i=r.length;let o,c,u;return Y_(e)?Eu:(o=e.state,o.wrap!==0&&o.mode!==VP?Eu:o.mode===VP&&(c=1,c=WT(c,r,i,0),c!==o.check)?m7:(u=w7(e,r,i,i),u?(o.mode=16210,g7):(o.havedict=1,q_)))},inflateInfo:"pako inflate (from Nodeca project)"},Age=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const R7=Object.prototype.toString,{Z_NO_FLUSH:Pge,Z_FINISH:Oge,Z_OK:JT,Z_STREAM_END:a2,Z_NEED_DICT:c2,Z_STREAM_ERROR:kge,Z_DATA_ERROR:C7,Z_MEM_ERROR:Nge}=AP;function BP(e){this.options=kP.assign({chunkSize:65536,windowBits:15,to:""},e||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h7,this.strm.avail_out=0;let i=ef.inflateInit2(this.strm,r.windowBits);if(i!==JT)throw new Error(G_[i]);if(this.header=new Age,ef.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=YT.string2buf(r.dictionary):R7.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=ef.inflateSetDictionary(this.strm,r.dictionary),i!==JT)))throw new Error(G_[i])}function Dge(e,r){const i=new BP(r);if(i.push(e),i.err)throw i.msg||G_[i.err];return i.result}BP.prototype.push=function(e,r){const i=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?Oge:Pge,R7.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),u=ef.inflate(i,h),u===c2&&c&&(u=ef.inflateSetDictionary(i,c),u===JT?u=ef.inflate(i,h):u===C7&&(u=c2));i.avail_in>0&&u===a2&&i.state.wrap>0&&e[i.next_in]!==0;)ef.inflateReset(i),u=ef.inflate(i,h);switch(u){case kge:case C7:case c2:case Nge:return this.onEnd(u),this.ended=!0,!1}if(m=i.avail_out,i.next_out&&(i.avail_out===0||u===a2))if(this.options.to==="string"){let _=YT.utf8border(i.output,i.next_out),y=i.next_out-_,S=YT.buf2string(i.output,_);i.next_out=y,i.avail_out=o-y,y&&i.output.set(i.output.subarray(_,_+y),0),this.onData(S)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==JT||m!==0){if(u===a2)return u=ef.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},BP.prototype.onData=function(e){this.chunks.push(e)},BP.prototype.onEnd=function(e){e===JT&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=kP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Lge={inflate:Dge};const{deflate:xge}=mge,{inflate:Mge}=Lge;var Uge=xge,Vge=Mge,I7=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(I7||{});class Fge{constructor(){K(this,"_sequence",0),K(this,"_startTime",Date.now()),K(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};i.commonPacketHeader.extension=1,i.extension=y,i.payload=this.compress(r),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;re("SHOW_DATASTREAM2_LOG")&&L.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const o=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const m=this.serializeExtension(i.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const i=new DataView(r);let o=0;const c=i.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)};let h,m;if(o+=4,re("SHOW_DATASTREAM2_LOG")&&L.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let _=!1;if(m.datas.length>0){const y=m.datas.find(S=>S.id===0);y&&(_=(1&new DataView(y.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:i,length:o,datas:c}=r,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let _=0;if(m.setUint8(_++,i),m.setUint8(_++,o),c.forEach(y=>{i?(m.setUint8(_++,y.id),m.setUint8(_++,y.length),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength):(m.setUint8(_++,y.id|y.length<<4),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(r){const i=new DataView(r);let o=0;const c=i.getUint8(o);o++;const u=i.getUint8(o);o++;const h=c===I7.TWO_BYTE,m=[],_=new DataView(r,2);let y=0;for(;y<u;){let S=0,R=0,P=new ArrayBuffer(0);h?(S=_.getUint8(y),y++,R=_.getUint8(y),y++):(S=15&_.getUint8(y),R=_.getUint8(y)>>4,y++),R>0&&(P=_.buffer.slice(y+2,y+2+R),y+=P.byteLength),m.push({id:S,length:R,data:P})}if(y!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return Vge(new Uint8Array(r))}compress(r){return Uge(new Uint8Array(r))}}const jge={name:"DataStream",create:(e,r)=>{const i=r?new Kpe(e):new qpe(e);return i.useDataStream(new Fge),i}};class Bge extends kr{constructor(r,i,o){super(),K(this,"ws",void 0),K(this,"requestId",1),K(this,"heartBeatTimer",void 0),K(this,"joinInfo",void 0),K(this,"clientId",void 0),K(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),K(this,"onClose",c=>{this.emit("close"),this.dispose()}),K(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=i,this.ws=new TT("cross-channel-".concat(this.clientId),o),this.ws.on(Xt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Xt.CONNECTED,this.onOpen),this.ws.on(Xt.ON_MESSAGE,this.onMessage),this.ws.on(Xt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new lt((i,o)=>{const c=window.setTimeout(()=>{o(new Oe(X.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Oe(X.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Oe(X.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(X.WS_DISCONNECT);const i=()=>new lt((h,m)=>{this.ws.once(Xt.CLOSED,()=>m(new Oe(X.WS_ABORT))),this.ws.once(Xt.CONNECTED,h)});this.ws.state!=="connected"&&await i();const o=this.sendMessage(r),c=new lt((h,m)=>{const _=()=>{m(new Oe(X.WS_ABORT))};this.ws.once(Xt.RECONNECTING,_),this.ws.once(Xt.CLOSED,_),this.once("req_".concat(o),h),cs(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Xt.RECONNECTING,_),this.ws.off(Xt.CLOSED,_),m(new Oe(X.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Oe(X.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(Xt.REQUEST_NEW_URLS),this.ws.on(Xt.REQUEST_NEW_URLS,i=>{i(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Wge extends kr{set state(r){r!==this._state&&(r!==Da.RELAY_STATE_FAILURE&&(this.errorCode=Vv.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,o,c,u){super(),K(this,"joinInfo",void 0),K(this,"sid",void 0),K(this,"clientId",void 0),K(this,"cancelToken",Jo.CancelToken.source()),K(this,"workerToken",void 0),K(this,"requestId",0),K(this,"signal",void 0),K(this,"prevChannelMediaConfig",void 0),K(this,"httpRetryConfig",void 0),K(this,"_resolution",void 0),K(this,"_state",Da.RELAY_STATE_IDLE),K(this,"errorCode",Vv.RELAY_OK),K(this,"onStatus",h=>{L.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Kp.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Kp.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Vv.SRC_TOKEN_EXPIRED,this.state=Da.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Vv.DEST_TOKEN_EXPIRED,this.state=Da.RELAY_STATE_FAILURE))}),K(this,"onReconnect",async()=>{L.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Kp.NETWORK_DISCONNECTED),this.state=Da.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Da.RELAY_STATE_IDLE&&(L.error("auto restart channel media relay failed",h.toString()),this.errorCode=Vv.SERVER_CONNECTION_LOST,this.state=Da.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=i,this.sid=I_(),this.signal=new Bge(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==Da.RELAY_STATE_IDLE)throw new Oe(X.INVALID_OPERATION);this.state=Da.RELAY_STATE_CONNECTING,await this.connect(),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new Oe(X.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Da.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Da.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);const i=this.genMessage(Po.SetVideoProfile);await this.signal.request(i),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),L.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Da.RELAY_STATE_IDLE,this.dispose()}dispose(){L.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Jo.CancelToken.source(),this.state=Da.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Qfe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",Kp.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const i=this.genMessage(Po.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(Po.SetSdkProfile,r);await this.signal.request(o),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Po.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Kp.PACKET_JOINED_SRC_CHANNEL),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(Po.SetSourceUserId,r);await this.signal.request(u),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Po.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Kp.PACKET_JOINED_DEST_CHANNEL),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(Po.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",Kp.PACKET_SENT_TO_DEST_CHANNEL),this.state=Da.RELAY_STATE_RUNNING,L.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const i=this.genMessage(Po.UpdateDestChannel,r);await this.signal.request(i),this.emit("event",Kp.PACKET_UPDATE_DEST_CHANNEL),L.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Po.StopPacketTransfer);await this.signal.request(r),L.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,i){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:vl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,_=null;switch(r){case Po.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Po.SetSourceChannel:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case Po.SetSourceUserId:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case Po.SetDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case Po.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Po.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Po.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Po.UpdateDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case Po.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const zge={name:"ChannelMediaRelay",create:function(e){return new Wge(e.joinInfo,e.clientId,e.websocketRetryConfig||vi,e.httpRetryConfig||vi,e.resolution)}};function A7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function QT(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?A7(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):A7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Gge extends kr{constructor(r,i,o,c){super(),K(this,"spec",void 0),K(this,"token",void 0),K(this,"websocket",void 0),K(this,"pingpongTimer",void 0),K(this,"reconnectMode","retry"),K(this,"serviceMode",void 0),K(this,"reqId",0),K(this,"commandReqId",0),K(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),K(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Rt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===$p.TRANSCODE?1:2}),this.emit(Pm.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=r,this.serviceMode=c,this.websocket=new TT("live-streaming",o),this.websocket.on(Xt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Xt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Xt.REQUEST_NEW_URLS,(u,h)=>{Is(this,Pm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Xt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,i,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(X.UNEXPECTED_ERROR);const m=QT({command:r,sdkVersion:vl==="4.23.2"?"0.0.1":vl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new Oe(X.WS_DISCONNECT);const _=()=>new lt((P,k)=>{this.websocket.once(Xt.CLOSED,()=>k(new Oe(X.WS_ABORT))),this.websocket.once(Xt.CONNECTED,P)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const y=new lt((P,k)=>{const z=()=>{k(new Oe(X.WS_ABORT))};this.websocket.once(Xt.RECONNECTING,z),this.websocket.once(Xt.CLOSED,z),this.once("@".concat(h,"-").concat(this.spec.sid),U=>{P(U)})});c&&Rt.workerEvent(this.spec.sid,QT(QT({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await y}catch(P){if(this.websocket.state==="closed")throw P;return await _(),await this.request(r,i,o)}return c&&Rt.workerEvent(this.spec.sid,QT(QT({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=vl==="4.23.2"?"0.0.1":vl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Ii.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void L.warning("live stream response already exists stream");case Ii.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ii.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ii.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(X.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Ii.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ii.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(X.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Ii.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Pm.WARNING,i,r.serverResponse.url)}case Ii.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new Oe(X.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Pm.WARNING,i,r.serverResponse.url)}case Ii.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ii.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(X.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Ii.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new Oe(X.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Pm.WARNING,i,r.serverResponse.url)}case Ii.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Ii.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ii.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ii.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ii.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ii.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(AA)},6e3)}}function P7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function La(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?P7(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):P7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Hge extends kr{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vi;super(),K(this,"onLiveStreamWarning",void 0),K(this,"onLiveStreamError",void 0),K(this,"spec",void 0),K(this,"retryTimeout",1e4),K(this,"connection",void 0),K(this,"httpRetryConfig",void 0),K(this,"wsRetryConfig",void 0),K(this,"streamingTasks",new Map),K(this,"isStartingStreamingTask",!1),K(this,"taskMutex",new Ms("live-streaming")),K(this,"cancelToken",Jo.CancelToken.source()),K(this,"transcodingConfig",void 0),K(this,"uapResponse",void 0),K(this,"lastTaskId",1),K(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(r){const i=La(La({},kfe),r);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(L.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>La(La(La({},Ofe),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Ur(h.width)||nr(h.width,"config.width",0,1e4),Ur(h.height)||nr(h.height,"config.height",0,1e4),Ur(h.videoBitrate)||nr(h.videoBitrate,"config.videoBitrate",1,1e6),Ur(h.videoFrameRate)||nr(h.videoFrameRate,"config.videoFrameRate"),Ur(h.lowLatency)||Wp(h.lowLatency,"config.lowLatency"),Ur(h.audioSampleRate)||Ni(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Ur(h.audioBitrate)||nr(h.audioBitrate,"config.audioBitrate",1,128),Ur(h.audioChannels)||Ni(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Ur(h.videoGop)||nr(h.videoGop,"config.videoGop"),Ur(h.videoCodecProfile)||Ni(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Ur(h.userCount)||nr(h.userCount,"config.userCount",0,17),Ur(h.backgroundColor)||nr(h.backgroundColor,"config.backgroundColor",0,16777215),Ur(h.userConfigExtraInfo)||as(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Ur(h.transcodingUsers)&&(zp(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,_)=>{QA(m.uid),Ur(m.x)||nr(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Ur(m.y)||nr(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Ur(m.width)||nr(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Ur(m.height)||nr(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Ur(m.zOrder)||nr(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Ur(m.alpha)||nr(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Ur(h.watermark)||ux(h.watermark,"watermark"),Ur(h.backgroundImage)||ux(h.backgroundImage,"backgroundImage"),h.images&&!Ur(h.images)&&(zp(h.images,"config.images"),h.images.forEach((m,_)=>{ux(m,"images[".concat(_,"]"))}))}(i);const o=[];i.images&&o.push(...i.images.map(h=>La(La(La({},lx),h),{},{zOrder:255}))),i.backgroundImage&&(o.push(La(La(La({},lx),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push(La(La(La({},lx),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>La({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?lt.resolve(h.uid):JG(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await lt.all(c)).forEach((h,m)=>{i.userConfigs&&i.userConfigs[m]&&(i.userConfigs[m].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(xc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});L.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{L.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{L.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{L.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(r,i,o){if(!this.transcodingConfig&&i===$p.TRANSCODE)throw new Oe(X.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};L.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(r)&&!o)return u(),new Oe(X.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(m){throw u(),m}switch(i){case $p.TRANSCODE:c.transcodingConfig=La({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new lt((y,S)=>{cs(this.retryTimeout).then(()=>{if(o)return S(o);const R=this.statusError.get(r);return R?(this.statusError.delete(r),S(R)):void 0})}),_=await lt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:i===$p.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,L.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(r,{clientRequest:c,mode:i,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,i,m)):await this.startLiveStreamingTask(r,i,m)}}stopLiveStreamingTask(r){return new lt((i,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(X.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{L.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===$p.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{L.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(o)})}resetAllTask(){var r;const i=Array.from(xc(r=this.streamingTasks).call(r));this.terminate();for(const o of i)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Jo.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(X.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await Is(this,dx.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=i,this.connection=new Gge(i.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Pm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Pm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Pm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Oe(X.UNEXPECTED_ERROR,"can not get new live streaming address list"));Is(this,dx.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(r){const i=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),c=r.reason;switch(r.code){case Ii.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return L.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case Ii.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case Ii.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ii.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(xc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(L.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{L.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{L.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const $ge={name:"LiveStreaming",create:function(e){return new Hge(e.joinInfo,e.websocketRetryConfig||vi,e.httpRetryConfig||vi)}};function Kge(e){let r=N7();return function(i,o){let c=i.appId;c!==void 0&&(Yn(o,10),Rh(o,c));let u=i.cid;u!==void 0&&(Yn(o,16),Yn(o,u));let h=i.cname;h!==void 0&&(Yn(o,26),Rh(o,h));let m=i.deviceId;m!==void 0&&(Yn(o,34),Rh(o,m));let _=i.elapse;_!==void 0&&(Yn(o,40),zm(o,_));let y=i.fileSize;y!==void 0&&(Yn(o,48),zm(o,tS(y)));let S=i.height;S!==void 0&&(Yn(o,56),zm(o,tS(S)));let R=i.jpg;R!==void 0&&(Yn(o,66),Yn(o,R.length),function(ra,je){let it=nS(ra,je.length);ra.bytes.set(je,it)}(o,R));let P=i.networkType;P!==void 0&&(Yn(o,72),zm(o,tS(P)));let k=i.osType;k!==void 0&&(Yn(o,80),zm(o,tS(k)));let z=i.requestId;z!==void 0&&(Yn(o,90),Rh(o,z));let U=i.sdkVersion;U!==void 0&&(Yn(o,98),Rh(o,U));let F=i.sequence;F!==void 0&&(Yn(o,104),zm(o,tS(F)));let q=i.sid;q!==void 0&&(Yn(o,114),Rh(o,q));let Y=i.timestamp;Y!==void 0&&(Yn(o,120),zm(o,Y));let le=i.uid;le!==void 0&&(Yn(o,128),Yn(o,le));let Ee=i.vid;Ee!==void 0&&(Yn(o,136),Yn(o,Ee));let ye=i.width;ye!==void 0&&(Yn(o,144),zm(o,tS(ye)));let ge=i.service;ge!==void 0&&(Yn(o,152),Yn(o,ge));let ke=i.callbackData;ke!==void 0&&(Yn(o,162),Rh(o,ke));let qe=i.jpgEncryption;qe!==void 0&&(Yn(o,168),Yn(o,qe));let ut=i.requestType;ut!==void 0&&(Yn(o,176),Yn(o,ut));let ft=i.scorePorn;ft!==void 0&&(Yn(o,185),p2(o,ft));let yn=i.scoreSexy;yn!==void 0&&(Yn(o,193),p2(o,yn));let vn=i.scoreNeutral;vn!==void 0&&(Yn(o,201),p2(o,vn));let ur=i.scene;ur!==void 0&&(Yn(o,208),Yn(o,ur));let ni=i.ossFilePrefix;ni!==void 0&&(Yn(o,218),Rh(o,ni));let Gr=i.serviceVendor;if(Gr!==void 0)for(let ra of Gr){Yn(o,226);let je=N7();Xge(ra,je),Yn(o,je.limit),e_e(o,je),Zge(je)}}(e,r),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(r)}function qge(e){return function(i){let o={};e:for(;!D7(i);){let c=Ch(i);switch(c>>>3){case 0:break e;case 1:o.code=Ch(i);break;case 2:o.msg=L7(i,Ch(i));break;case 3:{let u=Jge(i);o.data=Yge(i),i.limit=u;break}default:O7(i,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function Yge(e){let r={};e:for(;!D7(e);){let i=Ch(e);switch(i>>>3){case 0:break e;case 1:r.requestId=L7(e,Ch(e));break;case 2:r.requestType=Ch(e)>>>0;break;case 3:r.scorePorn=h2(e);break;case 4:r.scoreSexy=h2(e);break;case 5:r.scoreNeutral=h2(e);break;case 6:r.requestScene=Ch(e)>>>0;break;case 7:r.scene=Ch(e)>>>0;break;default:O7(e,7&i)}}return r}function Xge(e,r){let i=e.service;i!==void 0&&(Yn(r,8),Yn(r,i));let o=e.vendor;o!==void 0&&(Yn(r,16),Yn(r,o));let c=e.token;c!==void 0&&(Yn(r,26),Rh(r,c));let u=e.callbackUrl;u!==void 0&&(Yn(r,34),Rh(r,u))}function Jge(e){let r=Ch(e),i=e.limit;return e.limit=e.offset+r,i}function O7(e,r){switch(r){case 0:for(;128&x7(e););break;case 2:u2(e,Ch(e));break;case 5:u2(e,4);break;case 1:u2(e,8);break;default:throw new Error("Unimplemented type: "+r)}}let Qge=new Float32Array(1);new Uint8Array(Qge.buffer);let l2=new Float64Array(1),xa=new Uint8Array(l2.buffer);function tS(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let k7=[];function N7(){const e=k7.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Zge(e){k7.push(e)}function u2(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function D7(e){return e.offset>=e.limit}function nS(e,r){let i=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function d2(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function L7(e,r){let i=d2(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,y,S,R,P=c[m+i];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&y)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Rh(e,r){let i=r.length,o=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}Yn(e,o);let c=nS(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function e_e(e,r){let i=nS(e,r.limit),o=e.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)o[u+i]=c[u]}function x7(e){return e.bytes[d2(e,1)]}function M7(e,r){let i=nS(e,1);e.bytes[i]=r}function h2(e){let r=d2(e,8),i=e.bytes;return xa[0]=i[r++],xa[1]=i[r++],xa[2]=i[r++],xa[3]=i[r++],xa[4]=i[r++],xa[5]=i[r++],xa[6]=i[r++],xa[7]=i[r++],l2[0]}function p2(e,r){let i=nS(e,8),o=e.bytes;l2[0]=r,o[i++]=xa[0],o[i++]=xa[1],o[i++]=xa[2],o[i++]=xa[3],o[i++]=xa[4],o[i++]=xa[5],o[i++]=xa[6],o[i++]=xa[7]}function Ch(e){let r,i=0,o=0;do r=x7(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function Yn(e,r){for(r>>>=0;r>=128;)M7(e,127&r|128),r>>>=7;M7(e,r)}function zm(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=nS(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}function U7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const t_e=new Map([["moderation",1],["supervise",2]]);class n_e extends kr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(es.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=ec(i=r.map(o=>t_e.get(o)||0)).call(i,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),K(this,"name","AgoraRTCVideoContentInspect"),K(this,"_connectionState",hu.CONNECTING),K(this,"_innerConnectionState",void 0),K(this,"sequence",0),K(this,"inspectStartTime",void 0),K(this,"workerManagerConnection",void 0),K(this,"workerConnection",void 0),K(this,"workerMessageLengthLimit",void 0),K(this,"inspectIntervalMinimum",void 0),K(this,"qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",Jo.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"wmSequence",0),K(this,"inspectInterval",void 0),K(this,"inspectTimer",null),K(this,"ossFilePrefix",void 0),K(this,"extraInfo",void 0),K(this,"_inspectType",void 0),K(this,"_inspectMode",void 0),K(this,"_quality",1),K(this,"qualityTimer",null),K(this,"_inspectId",void 0),K(this,"_needWorkUrlOnly",!1),K(this,"inspectImage",()=>{if(this.connectionState!==hu.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===hu.CONNECTED?this.requestToInspectImage():L.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=cr(5,"inspect-"),this.workerMessageLengthLimit=re("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=re("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=re("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new TT("worker-manager-"+this._inspectId,vi),this.on(es.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,L.debug("[".concat(this._inspectId,"] Inspect operation :").concat(pu[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new TT("worker-"+this._inspectId,vi),this.handleWorkerEvents()}async init(r,i){this.emit(es.STATE_CHANGE,pu.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=i,new lt((c,u)=>{this.on(es.CONNECTION_STATE_CHANGE,(h,m)=>{m===hu.CONNECTED&&c()}),this.requestAP(r,o,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,i,o){const c=re("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,_,y,S){let{appId:R,areaCode:P,cname:k,sid:z,token:U,uid:F}=_;Hv++;const q="image_moderation_api",Y={service_name:q,json_body:JSON.stringify({appId:R,areaCode:P,cname:k,command:"allocateEdge",requestId:Hv,seq:Hv,sid:z,token:U,ts:Date.now(),uid:F+""})};let le,Ee,ye=m[0];return dd(async()=>{le=Date.now();const ge=await gd(ye,{data:Y,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-le,ge.code!==0){const ft=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ge.code,{retry:!0,responseTime:Ee});throw L.error(ft.toString()),ft}const ke=JSON.parse(ge.json_body);if(ke.code!==200){const ft=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ke.code,", reason: ").concat(ke.reason),{code:ke.code,responseTime:Ee});throw L.error(ft.toString()),ft}if(!ke.servers||!Array.isArray(ke.servers)||ke.servers.length===0){const ft=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ke.code,responseTime:Ee});throw L.error(ft.toString()),ft}const qe=re("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ut=re("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ke.servers.map(ft=>{let{address:yn,wss:vn}=ft;if(yn&&vn)return"wss://".concat(yn.replace(/\./g,"-"),".").concat(qe,":").concat(ut||vn)}).filter(ft=>!!ft),workerToken:ke.workerToken,vid:ke.vid,responseTime:Ee}},(ge,ke)=>(Rt.apworkerEvent(z,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(ge.addressList),firstSuccess:ke===0,responseTime:Ee,serverIp:m[ke%m.length]}),!1),(ge,ke)=>(Rt.apworkerEvent(z,{success:!1,sc:ge.data&&ge.data.code||200,serviceName:q,responseTime:Ee,serverIp:m[ke%m.length]}),!!(ge.code!==X.OPERATION_ABORTED&&ge.code!==X.UNEXPECTED_RESPONSE||ge.data&&ge.data.retry)&&(ye=m[(ke+1)%m.length],!0)),S)}(c,r,i,o);this.emit(es.STATE_CHANGE,pu.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(es.STATE_CHANGE,pu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Xt.CONNECTED,async()=>{this.emit(es.STATE_CHANGE,pu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Xt.CLOSED,()=>{this._innerConnectionState<pu.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Xt.FAILED,()=>{this._innerConnectionState<pu.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Xt.RECONNECTING,()=>{this._innerConnectionState<pu.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Xt.ON_MESSAGE,async r=>{this.emit(es.STATE_CHANGE,pu.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw L.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Oe(X.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw L.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Oe(X.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=re("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(es.STATE_CHANGE,pu.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(es.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Xt.WILL_RECONNECT,(r,i,o)=>{o(r)}),this.workerManagerConnection.on(Xt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Xt.CONNECTED,async()=>{this.emit(es.STATE_CHANGE,pu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=hu.CONNECTED}),this.workerConnection.on(Xt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=qge(new Uint8Array(r.data));if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&L.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(es.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=ec(i=Object.keys(c)).call(i,(m,_)=>c[m]>c[_]?m:_,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(es.INSPECT_RESULT,h)}else this.emit(es.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(es.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else L.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(es.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Xt.CLOSED,()=>{this.connectionState=hu.CLOSED}),this.workerConnection.on(Xt.FAILED,()=>{this.connectionState=hu.CLOSED}),this.workerConnection.on(Xt.RECONNECTING,()=>{this.connectionState=this.connectionState===hu.CONNECTED?hu.RECONNECTING:hu.CONNECTING}),this.workerConnection.on(Xt.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(Xt.REQUEST_NEW_URLS,(r,i)=>{this.workerManagerConnection.close(),this.once(es.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}async requestToInspectImage(){this.sequence++;const r=Uc(this,es.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(es.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(es.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await EW(S,o,c),P=this.sequence+"-"+u+"-"+_+"-"+y+"-"+cr(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:(z=Number(y-this.inspectStartTime),{low:z|=0,high:z>>31,unsigned:z>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:H9(y),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var z;this.extraInfo===void 0&&delete k.callbackData,this.ossFilePrefix===void 0&&delete k.ossFilePrefix;const U=Kge(k);if(U.byteLength<this.workerMessageLengthLimit){if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const F=function(q){for(var Y=1;Y<arguments.length;Y++){var le=arguments[Y]!=null?arguments[Y]:{};Y%2?U7(Object(le),!0).forEach(function(Ee){K(q,Ee,le[Ee])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(le)):U7(Object(le)).forEach(function(Ee){Object.defineProperty(q,Ee,Object.getOwnPropertyDescriptor(le,Ee))})}return q}({},k);delete F.jpg,L.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(F))}return U}{const F=this.quality*this.qualityRatio;return this.quality=F,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Jo.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=hu.CLOSED,this.emit(es.STATE_CHANGE,pu.CLOSED)}}const r_e={name:"ContentInspect",create:function(e){let{config:r}=e;return function(i){if(!i)throw new Oe(X.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new Oe(X.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(i.inspectType)];o.forEach(c=>{var u;if(!st(u=["supervise","moderation"]).call(u,c))throw new Oe(X.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new n_e(r)}};var V7=l(Et.Object.getOwnPropertySymbols),i_e=Vn,s_e=Ho.indexOf,o_e=mp,f2=se([].indexOf),F7=!!f2&&1/f2([1],1,-0)<0;i_e({target:"Array",proto:!0,forced:F7||!o_e("indexOf")},{indexOf:function(e){var r=arguments.length>1?arguments[1]:void 0;return F7?f2(this,e,r)||0:s_e(this,e,r)}});var a_e=Za("Array").indexOf,c_e=N,l_e=a_e,m2=Array.prototype,u_e=function(e){var r=e.indexOf;return e===m2||c_e(m2,e)&&r===m2.indexOf?l_e:r},j7=l(u_e);function d_e(e,r){if(e==null)return{};var i,o,c=function(h,m){if(h==null)return{};var _,y,S={},R=oG(h);for(y=0;y<R.length;y++)_=R[y],j7(m).call(m,_)>=0||(S[_]=h[_]);return S}(e,r);if(V7){var u=V7(e);for(o=0;o<u.length;o++)i=u[o],j7(r).call(r,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(c[i]=e[i])}return c}let B7=class{get localCapabilities(){return Fr(this._localCapabilities)}get rtpCapabilities(){return Fr(this._rtpCapabilities)}get candidates(){return Fr(this._candidates)}get iceParameters(){return Fr(this._iceParameters)}get dtlsParameters(){return Fr(this._dtlsParameters)}constructor(e){K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_iceParameters",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname","o/i14u9pJrxRKAsu"),K(this,"firefoxSsrcMidMap",new Map),e=Fr(e);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:_,audioCodec:y}=e;let S;this.setup=m,S=h===Ao.RECEIVE_ONLY?Na(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Na(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u;const R=h===Ao.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===Ao.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,k=h===Ao.RECEIVE_ONLY?c.send.videoCodecs:CT(gt.VIDEO,R,P,_),z=h===Ao.RECEIVE_ONLY?c.send.audioCodecs:CT(gt.AUDIO,R,P,y);for(const U of S.mediaDescriptions)U.attributes.iceUfrag=r.iceUfrag,U.attributes.icePwd=r.icePwd,U.attributes.fingerprints=i.fingerprints,U.attributes.candidates=o,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video"&&(U.media.fmts=k.map(F=>F.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=R.videoExtensions),U.media.mediaType==="audio"&&(U.media.fmts=z.map(F=>F.payloadType.toString(10)),U.attributes.payloads=z,U.attributes.extmaps=R.audioExtensions,Gv(U));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Am(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===e)}send(e,r,i,o,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=M_(r,this.cname,re("SYNC_GROUP")?i:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Mr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,o);let y;return _===-1?(y=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(y=Fr(this.sessionDesc.mediaDescriptions[_]),y.attributes.direction="sendonly",y.attributes.ssrcs=u,y.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(y,c)),Mr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,r,i){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,_=!1;h===-1?(_=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,i),this.updateBundleMids()):(m=Fr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:r,protocol:i,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:_}=new RTCIceCandidate(e),y={foundation:r??"",componentId:"1",transport:i??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===y.priority&&S.connectionAddress===y.connectionAddress&&S.port===y.port)||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,r,i,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=CT(u,h,this.localCapabilities.send,u===gt.AUDIO?c:o),_=u===gt.VIDEO?h.videoExtensions:h.audioExtensions,y="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};S=this.mungRecvMediaDsec(S,e);const R=this.findFirstClosedMedia(u);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>st(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>st(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,r,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Mr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(e){const r=[];for(let i=0;i<e;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(e){e=Fr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,r,i,o,c,u){const h=this.rtpCapabilities.send,m=e===gt.VIDEO?h.videoCodecs:h.audioCodecs,_=e===gt.VIDEO?h.videoExtensions:h.audioExtensions;Mr()&&(c="".concat(++this.currentMidIndex));let y={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};y=this.mungSendMediaDesc(y,u);const S=this.findFirstClosedMedia(e);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(e,r,i){const o=Fr(e);return gx(o),zv(o,r),_x(o,r),kG(o),sP(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,r){const i=Fr(e);return sP(i,r,this.localCapabilities.recv),Gv(i),i}updateRecvMedia(e,r){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>Mr()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}};const h_e=["sdp"];var mr;function W7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Gm(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?W7(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):W7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let z7=(mr=class mS extends hG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,o){super(r,i),K(this,"direction",void 0),K(this,"name",void 0),K(this,"store",void 0),K(this,"spec",void 0),K(this,"peerConnection",void 0),K(this,"initialOffer",void 0),K(this,"transport",void 0),K(this,"statsFilter",void 0),K(this,"localCandidateCount",0),K(this,"_isInRestartIce",!1),K(this,"mutex",void 0),K(this,"onLocalCandidate",void 0),K(this,"remoteSDP",void 0),K(this,"pendingCandidates",[]),K(this,"localCapabilities",void 0),K(this,"isReady",!1),K(this,"restartCnt",0),K(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.mutex=new Ms("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(mS.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Ao.SEND_ONLY,this.name=this.direction===Ao.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=OL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Mr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const i=await DG();if(this.localCapabilities=oP(i),r){const{sdp:o}=r,c=d_e(r,h_e),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=RT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},z={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(fu(R,S,"videoExtensions",P,k,z),fu(R,S,"videoCodecs",P,k,z),fu(R,S,"audioExtensions",P,k,z),fu(R,S,"audioCodecs",P,k,z),re("RAISE_H264_BASELINE_PRIORITY")){const U=z.videoCodecs.findIndex(F=>F.rtpMap&&F.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&F.fmtp&&F.fmtp.parameters["profile-level-id"]==="42001f");if(U!==-1){const F=z.videoCodecs.findIndex(q=>q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(F<U){L.debug("raising H264 baseline profile priority");const q=z.videoCodecs[U];z.videoCodecs.splice(U,1),z.videoCodecs.splice(F,0,q)}F!==-1&&re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>!(q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&q.fmtp&&q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:k,sendrecv:z}}({},{},o);this.remoteSDP=new B7({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Dm(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await LG({},{},h.sdp);this.localCapabilities=oP(_);const y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),Gm(Gm({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Dm(o.sdp);return this.initialOffer=o,Gm(Gm({},c),{},{sdp:o.sdp})}}catch(i){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:o,dtlsParameters:c}=r,u=await LG({},{},i);this.remoteSDP=new B7({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new Le(X.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,o){var c=this;return yl(function*(){const u=yield Rn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,i,o);r.forEach((F,q)=>{if(m[q].needCreateTransceiver){const Y=c.peerConnection.addTransceiver(F._mediaStreamTrack,{direction:"sendonly"});h.push(Y),F._updateRtpTransceiver(Y)}else{const Y=c.peerConnection.getTransceivers().find(le=>le.mid===m[q].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[q].mid));h.push(Y),F._updateRtpTransceiver(Y)}}),Mr()&&re("SIMULCAST")===!0&&(yield Rn(c.applySimulcastForFirefox(h,r)));const _=m.map(F=>F.mid),y=yield Rn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(y.sdp,r,_),R=Na(S),P=_.map(F=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===F);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return AG(q,re("USE_PUB_RTX"))}),k=h.map((F,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}});yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield k}catch(F){const q=c.remoteSDP.toString();throw yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Rn(c.stopSending(_,!0)),F}yield Rn(c.applySimulcastEncodings(h,r)),yield Rn(c.applySendEncodings(h,r));const z=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return U==null||U(z),yield Rn(c.setRemoteDescription({type:"answer",sdp:z})),h.map((F,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}})}catch(h){throw h instanceof Le?h:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var y;_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);if(h){const _=this.remoteSDP.toString(),y=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,r);y==null||y(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const y=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(y.sdp,u,r);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===A_.Auto&&(this.store.p2pTransport=A_.SdRtn,Dn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(mS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Dn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(mS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Dm(i.sdp);return this.store.descriptionStart(),this.direction===Ao.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Ao.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Dm(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(i)?Mr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:Gm(Gm({},hh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Gm(Gm({},hh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;st(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(hT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...mS.turnServerConfigToIceServers(r.turnServer.servers,i,o)),re("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...mS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,o)),st(u=[A_.Relay,A_.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),re("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&Dn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),L.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);L.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(i){case A_.SdRtn:const m=r.filter(y=>{var S;return st(S=y.username).call(S,"glb:")&&y.turnServerURL==y.turnServerURL}),_=m.length>o?m[o]:m[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(km(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(km(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case A_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(km(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(km(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=r.iceTransport;i&&(i.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair();L.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!i)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return L.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Dn().supportSetRtpSenderParameters)return L.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),st(h=r._hints).call(h,lr.LOW_STREAM)&&(R&&(u.maxFramerate=cc(R)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(re("DSCP_TYPE")&&Bp()){var m;const S=re("DSCP_TYPE");st(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const _=i.getParameters(),y=(o=_.encodings)===null||o===void 0?void 0:o[0];Mr()&&!y&&(c.encodings=[u]),y&&Object.assign(y,u),Object.assign(_,c),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await i.setParameters(_)}async applySendEncodings(r,i){try{if(!Dn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];u instanceof Er&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){const c=Na(r);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(zv(_,u),NG(_,u,this.store.codec))}),Am(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const y=r[_],S=i[_];if(S instanceof Er&&!st(o=S._hints).call(o,lr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,i){if(!Mr()&&r.length===i.length)for(let o=0;o<r.length;o++){const c=i[o];if(c instanceof Er&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var i,o,c,u,h;return!!(r instanceof Er&&re("SIMULCAST")&&this.store.codec==="vp8"&&!st(i=r._hints).call(i,lr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,o,c){if(re("SDP_LOGGING"))return L.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var o,c;if(i=(o=i)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=Na(i).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),st(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,o){const c=Na(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&o===gt.AUDIO&&u.media.mediaType==="audio"&&Gv(u),Am(c)}},vt(mr.prototype,"establish",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"establish"),mr.prototype),vt(mr.prototype,"connect",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"connect"),mr.prototype),vt(mr.prototype,"receive",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"receive"),mr.prototype),vt(mr.prototype,"mockReceive",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"mockReceive"),mr.prototype),vt(mr.prototype,"stopReceiving",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"stopReceiving"),mr.prototype),vt(mr.prototype,"restartICE",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"restartICE"),mr.prototype),vt(mr.prototype,"close",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"close"),mr.prototype),vt(mr.prototype,"updateEncoderConfig",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"updateEncoderConfig"),mr.prototype),vt(mr.prototype,"updateSendParameters",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"updateSendParameters"),mr.prototype),vt(mr.prototype,"replaceTrack",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"replaceTrack"),mr.prototype),vt(mr.prototype,"muteLocal",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"muteLocal"),mr.prototype),vt(mr.prototype,"unmuteLocal",[yu],Object.getOwnPropertyDescriptor(mr.prototype,"unmuteLocal"),mr.prototype),mr);function yu(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}let Ed=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var G7,H7,$7,K7,q7,Y7,X7,J7,Q7,Z7,e$,Pr;function t$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function WP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?t$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let p_e=(G7=yd(Ed.SEND_ONLY),H7=yd(Ed.SEND_ONLY),$7=yd(),K7=yd(Ed.RECEIVE_ONLY),q7=yd(Ed.RECEIVE_ONLY),Y7=yd(Ed.RECEIVE_ONLY),X7=yd(Ed.RECEIVE_ONLY),J7=yd(Ed.RECEIVE_ONLY),Q7=yd(Ed.RECEIVE_ONLY),Z7=yd(),e$=yd(Ed.RECEIVE_ONLY),Pr=class extends kr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(kt.StateChange,r,this._state)}constructor(e,r){super(),K(this,"isPlanB",!1),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"sendConnection",void 0),K(this,"recvConnection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"statsCollector",void 0),K(this,"dtlsFailedCount",0),K(this,"sendMutex",void 0),K(this,"recvMutex",void 0),K(this,"_state",Hn.Disconnected),K(this,"_restartStates",["disconnected","failed"]),K(this,"reconnectInterval",void 0),K(this,"uploadUnplinkStarted",!1),K(this,"uploadDownlinkStarted",!1),K(this,"uplinkStateUploadInterval",void 0),K(this,"downlinkStatsUploadInterval",void 0),K(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Hn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(i);if(_.length===0)return void o();const y=_.find(k=>k[0]==="videoLowTrack");y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(k=>{let[,{id:z}]=k;return z}));let S=!1;var h,m;i.trackMediaType==="video"?S=!((h=this.localTrackMap.get($e.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get($e.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(_);await ar(this,kt.RequestMuteLocal,R);const P=i.trackMediaType==="video"?Om.MUTE_LOCAL_VIDEO:Om.MUTE_LOCAL_AUDIO;await ar(this,kt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:S}),o()}catch(_){c(_)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Hn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const m=this.createUnmuteMessage(h),_=i.trackMediaType==="video"?Om.UNMUTE_LOCAL_VIDEO:Om.UNMUTE_LOCAL_AUDIO;await ar(this,kt.RequestP2PMuteLocal,{action:_,message:m}),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==i||this.state!==Hn.Connected)return void o();const{id:y,track:S}=_;y&&(await this.sendConnection.updateSendParameters(y,S),await this.sendConnection.updateEncoderConfig(y,S),this.emit(kt.UpdateVideoEncoder,S)),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==Hn.Connected)return void o();const{id:m,track:_}=h;m&&await this.sendConnection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;L.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return i===R});if(!this.sendConnection||!y||y[1].id===void 0||this.state!==Hn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),y[0]===$e.LocalVideoTrack&&Dn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const R=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new lt((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),K(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new y9(e),this.bindStatsUploaderEvents(),this.sendMutex=new Ms("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Ms("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},re("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,r){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,r){let i;try{if(r){this.recvConnection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new z7(e,this.store,Ao.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Hn.New,this.sendConnection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new z7(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Hn.Connected}async addRemoteCandidate(e,r){if(r===Ao.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,r,i){var o=this;return yl(function*(){const c=yield Rn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Hn.Connected){o.throwIfTrackTypeNotMatch(e);const y=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(y))}o.store.pubId=o.store.pubId+1,Fs.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,r,i);if(u.length===0)return void(yield Rn(o.tryToUnmuteAudio(e)));u.forEach(y=>{let{track:S,type:R}=y;const P=Date.now();o.store.publish(S.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(u);const h=yield Rn(o.sendConnection.send(u.map(y=>{let{track:S}=y;return S}),o.store.codec,o.store.audioCodec)),m=(yield Rn(h.next())).value,_=o.createGatewayPublishMessage(u,m);try{yield _}catch(y){throw h.throw(y),(y==null?void 0:y.code)===X.WS_ABORT&&u.forEach(S=>{let{track:R}=S;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),y}yield Rn(h.next()),u.forEach(y=>{let{type:S}=y;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(y=>{let{track:S,type:R}=y;const P=Date.now();o.store.publish(S.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",void 0,P)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Hn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!st(e).call(e,c)));const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Hn.Connected)return i&&i[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:ime(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):i.push(m)}),r.length>0&&r.forEach(o=>{ar(this,kt.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{ar(this,kt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return yl(function*(){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(L.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Is(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,r,i,o){var c;if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:i}],String(e.uid),o);r===gt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new xv(u,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Lv(u,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(r,h):this.remoteUserMap.set(e,new Map([[r,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const y=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:P}=S;return R.uid===e.uid&&r===P});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(kt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,r,i,o){if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,r,i){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===e.uid&&r===m:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||o.forEach(u=>{let{kind:h}=u;var m;if(h===gt.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===gt.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var _,y;if(m===gt.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===gt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0);else if(m===gt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;ar(this,kt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[gt.VIDEO,gt.AUDIO].forEach(o=>{i.has(o)?ar(this,kt.RequestP2PUnmuteRemote,o):ar(this,kt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===gt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||L.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){const r=this.localTrackMap.get($e.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ci){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==$e.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===$e.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,r,i,o,c){if(e){const h=this.localTrackMap.get($e.LocalAudioTrack),m=o?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);Rt.publish(this.store.sessionId,{eventElapse:Fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(lr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof zr),m=o?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof Er);Rt.publish(this.store.sessionId,{eventElapse:Fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(lr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,i,o){const c=o===gt.VIDEO?i._videoSSRC:i._audioSSRC;c&&Rt.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===gt.VIDEO,audio:o===gt.AUDIO,peerid:i.uid,subscribeRequestid:o===gt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Fs.measureFromSubscribeStart(this.store.clientId,c)})}reset(){L.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ms("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ms("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get($e.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ci){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Hn.Disconnected}getStats(e){var r,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get($e.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get($e.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof Er||r&&r.track instanceof zr?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(Fc(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get($e.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xb(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(L.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Hn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case $e.LocalVideoTrack:st(r=o._hints).call(r,lr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case $e.LocalAudioTrack:o instanceof Ci?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case $e.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Fc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),L.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof xm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}async restartICE(e,r){let i,o;if(e===Ao.SEND_ONLY){if(!this.sendConnection)throw new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await Is(this,kt.RequestP2PRestartICE,{direction:Ao.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),r=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalAudioTrack),o=e.videoSend.find(k=>{var z;return k.ssrc===(r==null||(z=r.ssrcs)===null||z===void 0?void 0:z[0].ssrcId)}),c=e.audioSend.find(k=>{var z;return k.ssrc===(i==null||(z=i.ssrcs)===null||z===void 0?void 0:z[0].ssrcId)});if(!o||!c)return 1;const u=Uc(this,kt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(lr.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,z=e.bitrate.actualEncoded;if(k&&z){const U=(1e3*k-z)/(1e3*k);return rG[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(z=>z.ssrc===c),m=e.videoRecv.find(z=>z.ssrc===u);if(!h&&!m)return void(r+=1);const _=Uc(this,kt.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new lt((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}filterTobePublishedTracks(e,r,i){const o=[],c=Dn(),u=this.getAllTracks();e=Sv(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,m=!1;for(const _ of e){if(_ instanceof Er&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:$e.LocalVideoTrack}),h=!0),r)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:$e.LocalVideoLowTrack})}if(_ instanceof zr){const y=this.localTrackMap.get($e.LocalAudioTrack);if(y){if(!(y.track instanceof Ci))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const S=o.find(R=>{let{type:P}=R;return P===$e.LocalAudioTrack});if(!(S.track instanceof Ci))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof Ci||_._bypassWebAudio)o.push({track:_,type:$e.LocalAudioTrack});else{const S=new Ci;S.addAudioTrack(_),o.push({track:S,type:$e.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=Sv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof zr){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ci?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([$e.LocalAudioTrack,c]),c.track.close())):r.push([$e.LocalAudioTrack,c])}if(o instanceof Er){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;r.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&r.push([$e.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case $e.LocalVideoTrack:i.addListener(_t.GET_STATS,this.handleGetLocalVideoStats),i.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(_t.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(_t.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Ci?e.trackList.forEach(i=>{i.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(_t.GET_STATS,this.handleGetLocalAudioStats),i.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(_t.GET_STATS,this.handleGetLocalAudioStats),e.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||e.addListener(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case $e.LocalVideoTrack:i.off(_t.GET_STATS,this.handleGetLocalVideoStats),i.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(_t.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(_t.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ci?e.trackList.forEach(r=>{r.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(_t.GET_STATS,this.handleGetLocalAudioStats),r.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(_t.GET_STATS,this.handleGetLocalAudioStats),e.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Lv&&r.addListener(_t.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof xv&&r.addListener(_t.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(_t.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var c;let u,{track:h,type:m}=i;switch(m){case $e.LocalAudioTrack:u=$n.Audio;break;case $e.LocalVideoTrack:u=st(c=h._hints).call(c,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:u=$n.Low}return{kind:m===$e.LocalAudioTrack?gt.AUDIO:gt.VIDEO,stream_type:u,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalVideoTrack:o=st(i=u._hints).call(i,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{var i;L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(e.isInRestartIce=!1),st(i=this._restartStates).call(i,r)&&!e.isInRestartIce&&(r==="disconnected"&&await cs(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Rt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Vr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const o=Array.from(Fc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Pv.FIRST_FRAME_DECODED),Rt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_DECODE,Ir.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Fs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const o=Array.from(Fc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_AUDIO_RECEIVED,Ir.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Fs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;const o=Array.from(Fc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Bi.FIRST_VIDEO_RECEIVED,Ir.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Fs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{const o=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(kt.ConnectionTypeChange,o),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Nm(i))," -> ").concat(JSON.stringify(Nm(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Nm(i))," -> ").concat(JSON.stringify(Nm(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.onLocalCandidate=r=>{this.emit(kt.LocalCandidate,{candidate:r,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const r=e===Ao.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,L.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),e===Ao.SEND_ONLY?this.restartICE(e):Is(this,kt.RequestP2PRestartICE,{direction:Ao.SEND_ONLY}))}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof zr&&(i==null?void 0:i.track)instanceof Ci)return i.track.isActive||r.push([$e.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof zr&&(i==null?void 0:i.track)instanceof Ci)return i.track.isActive&&r.push([$e.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===$e.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoTrack:o=st(i=u._hints).call(i,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoTrack:o=st(i=u._hints).call(i,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){const c=o.get(r);if(!c)return i;i.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case gt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:o._videoSSRC}));case gt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new lt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new lt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return e!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof zr){const i=this.filterTobeUnmutedTracks(e[r]);if(i.length===0)continue;const o=this.createUnmuteMessage(i);return void await ar(this,kt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:r}]=e;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(kt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(kt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await cs(wL(this.dtlsFailedCount,vi)),this.emit(kt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Er)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof Er).length>1)throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof zr).length>1&&(e.some(r=>r instanceof zr&&r._bypassWebAudio)||!Dn().webAudioMediaStreamDest))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof Er&&this.pendingLocalTracks.some(i=>i instanceof Er))throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof zr&&this.pendingLocalTracks.some(i=>i instanceof zr)&&(!Dn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof zr&&i._bypassWebAudio)))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){const i=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding,o=WP(WP({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=i?e._mediaStreamTrack.clone():Dx(e,o);const u=cr(8,"track-low-"),h=new Er(c,WP(WP({},i&&{scaleResolutionDownBy:mx(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(P_.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Iv.LOW_STREAM)}),h._hints.push(lr.LOW_STREAM),e.addListener(_t.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,r,i,o){var c;const u=Array.from(Fc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");Rt.firstRemoteVideoDecode(this.store.sessionId,Bi.FIRST_VIDEO_DECODE,Ir.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Fs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Le(X.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Le(X.NOT_SUPPORTED)}async subscribeDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}async unsubscribeDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}async preConnect(e){throw new Le(X.NOT_SUPPORTED)}getEstablishParams(){throw new Le(X.NOT_SUPPORTED)}async reSubscribe(e){throw new Le(X.NOT_SUPPORTED)}async updateVideoStreamParameter(e,r){throw new Le(X.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===$e.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Iv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},vt(Pr.prototype,"p2pConnect",[G7],Object.getOwnPropertyDescriptor(Pr.prototype,"p2pConnect"),Pr.prototype),vt(Pr.prototype,"unpublish",[H7],Object.getOwnPropertyDescriptor(Pr.prototype,"unpublish"),Pr.prototype),vt(Pr.prototype,"unpublishLowStream",[$7],Object.getOwnPropertyDescriptor(Pr.prototype,"unpublishLowStream"),Pr.prototype),vt(Pr.prototype,"subscribe",[K7],Object.getOwnPropertyDescriptor(Pr.prototype,"subscribe"),Pr.prototype),vt(Pr.prototype,"mockSubscribe",[q7],Object.getOwnPropertyDescriptor(Pr.prototype,"mockSubscribe"),Pr.prototype),vt(Pr.prototype,"unsubscribe",[Y7],Object.getOwnPropertyDescriptor(Pr.prototype,"unsubscribe"),Pr.prototype),vt(Pr.prototype,"muteRemote",[X7],Object.getOwnPropertyDescriptor(Pr.prototype,"muteRemote"),Pr.prototype),vt(Pr.prototype,"unmuteRemote",[J7],Object.getOwnPropertyDescriptor(Pr.prototype,"unmuteRemote"),Pr.prototype),vt(Pr.prototype,"hasRemoteMediaWithLock",[Q7],Object.getOwnPropertyDescriptor(Pr.prototype,"hasRemoteMediaWithLock"),Pr.prototype),vt(Pr.prototype,"disconnectForReconnect",[Z7],Object.getOwnPropertyDescriptor(Pr.prototype,"disconnectForReconnect"),Pr.prototype),vt(Pr.prototype,"remoteMediaSsrcChanged",[e$],Object.getOwnPropertyDescriptor(Pr.prototype,"remoteMediaSsrcChanged"),Pr.prototype),Pr);function yd(e){return function(r,i,o){const c=r[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case Ed.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}case Ed.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i)),y=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_(),y()}}}},o}}class X_ extends kr{constructor(r,i){super(),K(this,"signal",void 0),K(this,"token",void 0),K(this,"tokenTimeout",void 0),K(this,"tokenInterval",void 0),K(this,"_sequence",0),K(this,"userMap",new Map),K(this,"encoder",new TextEncoder),this.signal=r,this.token=i;const o=()=>{this.signal.connectionState===hr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*re("P2P_TOKEN_INTERVAL"))};o()}async send(r,i,o,c,u){var h,m,_;if(this.userMap.size===0)return;const y=Array.from(xc(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=(m=c)!==null&&m!==void 0?m:cr(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:r,_seq:u,_message:i,token:"".concat(this.token,"_").concat(y)};re("SHOW_P2P_LOG")&&L.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(jt.DATA_STREAM,{payload:Im(this.encoder.encode(P))})});const R=new lt((P,k)=>{const z=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),this.off(jv.ABORT,F),L.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?k(new Le(X.INVALID_REMOTE_USER)):k(new Le(X.TIMEOUT))},re("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),U=()=>{z&&window.clearTimeout(z),this.off(jv.ABORT,F),o&&P()},F=()=>{z&&window.clearTimeout(z),this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),k(new Le(X.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(jv.ABORT,F),this.once("res-@".concat(c,"_ack"),U);const q=(le,Ee)=>{Y=!0,z&&window.clearTimeout(z),this.off("res-@".concat(c,"_ack"),U),this.off(jv.ABORT,F),le==="success"?P(Ee):k(new Le(X.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let Y=!1;o||(this.once("res-@".concat(c),q),cs(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{Y||L.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(P){if(P.code===X.TIMEOUT)return await this.send(r,i,o,c,u);throw P}}onMessage(r){var i;const{_uid:o}=r;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==ti.CHECK)return;const{token:y}=r;c=new Map,u={uid:o,isStart:!0,token:y,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(_n.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:y,total:S}=r,R=(h=c.get(y))!==null&&h!==void 0?h:[];if(R.push(r),c.has(y)||c.set(y,R),R.length!==S)return;{const P=Xb(R).call(R,(k,z)=>k.index-z.index).map(k=>k.payload).join("");c.delete(y),(r=JSON.parse(P))._uid=o}}const{_type:m,token:_}=r;if(st(i=[ti.ACK,ti.CHECK]).call(i,m))return m===ti.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(r);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):L.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:cr(6,""),token:this.token,_type:ti.CHECK};re("SHOW_P2P_LOG")&&L.debug("send message",r),this.signal.request(jt.DATA_STREAM,{payload:Im(this.encoder.encode(JSON.stringify(r)))})}ack(r){const i={_id:r,_type:ti.ACK,token:this.token};re("SHOW_P2P_LOG")&&L.debug("send message",i),this.signal.request(jt.DATA_STREAM,{payload:Im(this.encoder.encode(JSON.stringify(i)))})}response(r,i,o){this.send(ti.RESPONSE,JSON.stringify({success:!o,message:i}),!0,r)}handleReceivedMessage(r){const i=()=>{this.userMap.forEach(y=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=y;for(;S.has(R);){const P=S.get(R);S.delete(R),this.receiveMessage(P),y.nextExpectedSequenceNumber++}})};if(!r)return void i();const{_uid:o,_seq:c}=r,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(r._id),void L.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===_&&(this.receiveMessage(r),h.delete(_),u.nextExpectedSequenceNumber++,i())}receiveMessage(r){const{_id:i,_type:o,_message:c,_uid:u}=r;if(re("SHOW_P2P_LOG")&&L.debug("receive message",r),i){let h;switch(r._type!==ti.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case ti.CANDIDATE:case ti.CONTROL:this.signal.emit(o,h,u);break;case ti.PUBLISH:case ti.UNPUBLISH:case ti.RESTART_ICE:case ti.CALL:h.uid=u,Is(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case ti.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case ti.RESPONSE:{const{success:m,message:_}=h;this.emit("res-@".concat(i),m?"success":"failed",_);break}}}}splitMessage(r){if(r.length<X_.MAX_MESSAGE_SIZE)return[r];const i=[],{remoteToken:o}=JSON.parse(r),c=cr(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const _={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>X_.MAX_MESSAGE_SIZE?h-=50:(i.push(_),r=r.slice(h))}return i.map(_=>JSON.stringify(_))}handleCheckToken(r,i){return r.token!==i?(L.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{L.debug("token timeout, ".concat(i)),this.reset(r.uid)},re("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Is(this.signal,ti.CALL,void 0),i=await this.send(ti.CALL,r);this.signal.emit(Wt.P2P_CONNECTION,i,!0)}async reset(r,i){const o=this.userMap.get(r);o&&(this.emit(jv.ABORT),this.signal.emit(_n.ON_USER_OFFLINE,{uid:o.uid,reason:Nfe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(L.debug("change local token from ".concat(i," to ").concat(i)),this.token=cr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(jv.ABORT)}}K(X_,"MAX_SIZE",1),K(X_,"MAX_MESSAGE_SIZE",1024);class f_e extends kr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===hr.CONNECTED?this.emit(Wt.WS_CONNECTED):r===hr.RECONNECTING?this.emit(Wt.WS_RECONNECTING,this._websocketReconnectReason):r===hr.CLOSED&&this.emit(Wt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",hr.CLOSED),K(this,"reconnectToken",void 0),K(this,"p2pToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new k8(5)),K(this,"pingpongTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"_external_signal",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Wt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case _n.ON_DATA_STREAM:return void this.handleDataStream(c._message);case _n.MUTE_AUDIO:case _n.MUTE_VIDEO:case _n.ON_P2P_LOST:case _n.ON_USER_ONLINE:return;case _n.ON_USER_OFFLINE:const{uid:u}=c._message;return L.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Gn.UID_BANNED);break;case 15:this.close(Gn.IP_BANNED);break;case 16:this.close(Gn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Lt.ERR_LICENSE_MISSING:this.close(Gn.LICENSE_MISSING);break;case Lt.ERR_LICENSE_EXPIRED:this.close(Gn.LICENSE_EXPIRED);break;case Lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Gn.LICENSE_MINUTES_EXCEEDED);break;case Lt.ERR_LICENSE_PERIOD_INVALID:this.close(Gn.LICENSE_PERIOD_INVALID);break;case Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Gn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Lt.ERR_LICENSE_ILLEGAL:this.close(Gn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new px("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===hr.CONNECTED&&this.reconnect("retry",Cs.OFFLINE)}),this.p2pToken=cr(6,""),this._external_signal=new X_(this,this.p2pToken)}async request(r,i,o,c){const u=cr(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,_=()=>new lt((z,U)=>{if(this.connectionState===hr.CONNECTED)return z();const F=()=>{this.off(Wt.WS_CLOSED,q),z()},q=()=>{this.off(Wt.WS_CONNECTED,F),U(new Le(X.WS_ABORT))};this.once(Wt.WS_CONNECTED,F),this.once(Wt.WS_CLOSED,q)});if(this.connectionState!==hr.CONNECTING&&this.connectionState!==hr.RECONNECTING||r===jt.JOIN||r===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new lt((z,U)=>{let F=!1;const q=(le,Ee)=>{F=!0,z({isSuccess:le==="success",message:Ee||{}}),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.emit(Wt.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),q);const Y=()=>{U(new Le(X.WS_ABORT,"type: ".concat(r))),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Wt.WS_CLOSED,Y),this.once(Wt.WS_RECONNECTING,Y),cs(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||F||(L.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Wt.REQUEST_TIMEOUT,r,i))})});let S=null;try{S=await y}catch(z){if(this.connectionState===hr.CLOSED||r===jt.LEAVE)throw new Le(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?z.throw():r===jt.JOIN||r===jt.REJOIN?null:(await _(),await this.request(r,i))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=bT(R),k=new Le(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(L.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Lt.ERR_TOO_MANY_BROADCASTERS?((r===jt.JOIN||r===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,L.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Cs.MULTI_IP)):this.reconnect(P.action,Cs.SERVER_ERROR),r===jt.JOIN||r===jt.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new lt(o=>{const c=u=>{(!i||i(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void L.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(vT.WRTC_STATS,i)}upload(r,i){const o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==hr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const o={_type:r,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(r,i,o){return await this._external_signal.send(r,i,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new lt((i,o)=>{this.once(Wt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Wt.WS_CLOSED,()=>o(this.initError||new Le(X.WS_ABORT))),this.connectionState=hr.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Gn.LEAVE,this.connectionState=hr.CLOSED,L.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=cr(6,""),this._external_signal.clear(),this._external_signal=new X_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Wt.ABORT_P2P_EXECUTION);const r=await Is(this,Wt.REQUEST_JOIN_INFO),i=await this.request(jt.JOIN,r);if(!i)return this.emit(Wt.REPORT_JOIN_GATEWAY,X.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Wt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=hr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleDataStream(r){try{var i;const o=C_(r.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||st(i=Object.values(ti)).call(i,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(_n.ON_DATA_STREAM,r)}catch{this.emit(_n.ON_DATA_STREAM,r)}}handleNotification(r){L.debug("[".concat(this.clientId,"] receive notification: "),r);const i=bT(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Gn.UID_BANNED),void this.close()):void this.reconnect(i.action,Cs.SERVER_ERROR);L.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(L.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Cs.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Xt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Wt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Xt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Xt.CLOSED,()=>{this.connectionState=hr.CLOSED}),this.websocket.on(Xt.FAILED,()=>{this._disconnectedReason=Gn.NETWORK_ERROR,this.connectionState=hr.CLOSED}),this.websocket.on(Xt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===hr.CONNECTED?this.connectionState=hr.RECONNECTING:this.connectionState=hr.CONNECTING}),this.websocket.on(Xt.WILL_RECONNECT,(r,i,o)=>{r!=="retry"?(L.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):L.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(Xt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Wt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===X.UNEXPECTED_RESPONSE&&r.data.code===Lt.ERR_NO_AUTHORIZED)return L.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Cs.SERVER_ERROR);L.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Cs.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Xt.REQUEST_NEW_URLS,(r,i)=>{Is(this,Wt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const m_e={name:"P2PChannel",create:function(e){let{store:r,statsCollector:i}=e;return new p_e(r,i)},createSubmodule:function(e){let{store:r,spec:i}=e;return new f_e(i,r)}};function n$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function r$(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?n$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class g_e{constructor(r){K(this,"sessionDesc",void 0),K(this,"localCapabilities",void 0),K(this,"rtpCapabilities",void 0),K(this,"candidates",void 0),K(this,"_originCandidates",void 0),K(this,"iceParameters",void 0),K(this,"dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),r=Fr(r);const{iceParameters:i,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:_,cname:y}=r,S=Na(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Fr(c),this.iceParameters=i,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=y;for(let R=0;R<S.mediaDescriptions.length;R++){const P=S.mediaDescriptions[R];if(P.attributes.iceUfrag=i.iceUfrag,P.attributes.icePwd=i.icePwd,P.attributes.fingerprints=o.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(z=>z.payloadType.toString(10));let k=u.videoCodecs.filter(z=>{var U,F;return(U=z.rtpMap)===null||U===void 0?void 0:st(F=U.encodingName.toLowerCase()).call(F,_)});k.length===0&&(k=u.videoCodecs),P.attributes.payloads=k,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(k=>k.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Am(this.sessionDesc)}send(r,i,o){const{ssrcs:c,ssrcGroups:u}=M_(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(y=>r===gt.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),m=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:_}}batchSend(r){return r.map(i=>{let{kind:o,ssrcMsg:c}=i;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const o=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{st(r).call(r,h.attributes.label||"")?u.push(h):o.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var m;st(m=u.map(_=>_.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=c})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,o){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(r){}updateCandidates(r){const i=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(i.forEach(c=>{o.push(r$(r$({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(r){case Vs.TCP_RELAY:this.candidates=o;break;case Vs.UDP_TCP_RELAY:case Vs.RELAY:this.candidates=[...i,...o];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Fr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let o=0;o<r;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(r,i){const o=Fr(r);return zv(o,i),_x(o,i),o}updateRecvMedia(r,i){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===gt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===i);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(i,o))}}mungMediaDesc(r){const i=Fr(r);return gx(i),function(o){const c=o.attributes.extmaps.find(u=>iP(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const o of i.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var or;function i$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function zP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?i$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):i$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let __e=(or=class Uw extends pG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return st(i=Object.keys(DA)).call(i,r)}))]}constructor(r,i){super(r,i),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"statsFilter",void 0),K(this,"useRTX",!1),K(this,"localCapabilities",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"establishPromise",void 0),K(this,"mutex",void 0),this.store=i,this.mutex=new Ms("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Uw.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=OL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Mr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Dm(r.sdp),o=RT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,zP(zP({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new g_e(zP(zP({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var o=this;return yl(function*(){const c=yield Rn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>o.peerConnection.addTrack(P._mediaStreamTrack)),h=yield Rn(o.peerConnection.createOffer()),m=Na(h.sdp),_=r.map(P=>{const k=P._mediaStreamTrack,z=m.mediaDescriptions.find(U=>U.attributes.mid===k.kind);if(!z)throw new Error("Cannot extract ssrc from mediaDescription.");return function(U,F,q){const Y=U.attributes.ssrcs.filter(Ee=>Ee.attributes.label===F),le=U.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(le&&Y.length>1){const Ee=le.find(ye=>ye.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return Ee?[{ssrcId:Ee.ssrcIds[0],rtx:q?Ee.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(z,k.id,o.useRTX)});let y;try{y=yield _}catch(P){throw u.forEach(k=>{Rs()&&k.replaceTrack(null),o.peerConnection.removeTrack(k)}),P}const S=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,i,y);const R=o.remoteSDP.toString();return yield Rn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(o.applySendEncodings(u,r)),yield Rn(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,k)=>{const z=P._mediaStreamTrack.id;return{localSSRC:_[k],id:z}})}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{Rs()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,i,c),m=new lt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),k=z=>{const U=Cn();if((U.name==="Safari"&&Number(U.version)===11||Ro())&&z.track.id!==u&&z.streams[0].id===h){var F;const q=z.streams[0].getTracks()[0];return(F=this.remoteSDP)===null||F===void 0||F.updateTrackLabel(r,u,z.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(q)}if(z.track.id===u)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(z.track)};this.peerConnection.addEventListener("track",k)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await m,id:u}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(Rs()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(Rs()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return yl(function*(){const o=yield Rn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Dn().supportPCSetConfiguration;if(r===Vs.RELAY&&!c)return;if(c){const y=i.peerConnection.getConfiguration(),S=r===Vs.RELAY?"relay":"all";y.iceTransportPolicy!==S&&(L.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(S,"]")),y.iceTransportPolicy=S,i.peerConnection.setConfiguration(y))}r!==Vs.RELAY&&i.remoteSDP.updateCandidates(r);const u=yield Rn(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Dm(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;i.remoteSDP.restartICE(m);const _=i.remoteSDP.toString();yield Rn(i.peerConnection.setLocalDescription(u)),yield Rn(i.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){L.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(hT(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...Uw.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...Uw.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(y=>{var S;return((S=y.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!i)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Dn().supportSetRtpSenderParameters)return L.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof Er)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(re("DSCP_TYPE")&&Bp()){var h;const y=re("DSCP_TYPE");st(h=["very-low","low","medium","high"]).call(h,y)&&(u.networkPriority=y)}const m=i.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(m,c),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m)}async applySendEncodings(r,i){try{if(!Dn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){const o=Na(r);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);m&&zv(m,c)}),Am(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:_}=u;const{kind:y}=r[h];return new lt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),k=z=>{const U=Cn();if(U.name==="Safari"&&Number(U.version)===11&&z.track.id!==m&&z.streams[0].id===_){var F;const q=z.streams[0].getTracks()[0];return(F=this.remoteSDP)===null||F===void 0||F.updateTrackLabel(y,m,z.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:q,id:m})}if(z.track.id===m)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:z.track,id:m})};this.peerConnection.addEventListener("track",k)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await lt.all(i)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i==null?void 0:i[0].ssrcId}setConfiguration(r){if(Dn().supportPCSetConfiguration){const i=Uw.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},vt(or.prototype,"connect",[Il],Object.getOwnPropertyDescriptor(or.prototype,"connect"),or.prototype),vt(or.prototype,"stopSending",[Il],Object.getOwnPropertyDescriptor(or.prototype,"stopSending"),or.prototype),vt(or.prototype,"receive",[Il],Object.getOwnPropertyDescriptor(or.prototype,"receive"),or.prototype),vt(or.prototype,"stopReceiving",[Il],Object.getOwnPropertyDescriptor(or.prototype,"stopReceiving"),or.prototype),vt(or.prototype,"muteRemote",[Il],Object.getOwnPropertyDescriptor(or.prototype,"muteRemote"),or.prototype),vt(or.prototype,"unmuteRemote",[Il],Object.getOwnPropertyDescriptor(or.prototype,"unmuteRemote"),or.prototype),vt(or.prototype,"muteLocal",[Il],Object.getOwnPropertyDescriptor(or.prototype,"muteLocal"),or.prototype),vt(or.prototype,"unmuteLocal",[Il],Object.getOwnPropertyDescriptor(or.prototype,"unmuteLocal"),or.prototype),vt(or.prototype,"close",[Il],Object.getOwnPropertyDescriptor(or.prototype,"close"),or.prototype),vt(or.prototype,"updateEncoderConfig",[Il],Object.getOwnPropertyDescriptor(or.prototype,"updateEncoderConfig"),or.prototype),vt(or.prototype,"updateSendParameters",[Il],Object.getOwnPropertyDescriptor(or.prototype,"updateSendParameters"),or.prototype),vt(or.prototype,"replaceTrack",[Il],Object.getOwnPropertyDescriptor(or.prototype,"replaceTrack"),or.prototype),vt(or.prototype,"getRemoteSSRC",[Il],Object.getOwnPropertyDescriptor(or.prototype,"getRemoteSSRC"),or.prototype),or);function Il(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}const E_e={name:"PlanBConnection",create:function(e){let{store:r,spec:i}=e;return new __e(i,r)}},y_e={interceptLocalAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Dn().supportWebRTCEncodedTransform)return void L.warning("browser not support audio encoded transform");if(WA.has(e)||!e.track)return;const i={track:e.track};if(jp()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void L.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(L.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=r.metadata&&r.metadata();_?function(y,S){const{chunk:R,controller:P}=S,k=re("ENABLE_AUDIO_PTS_METADATA")?Hp.AUDIO_64_BIT_PTS:Hp.METADATA;R.data=function(z,U,F){const q=F.byteLength,Y=q+ex+Jz,le=QL+ZL+Y,Ee=new ArrayBuffer(z.byteLength+le),ye=new DataView(Ee);ye.setUint8(0,Xz),ye.setUint16(1,Y),ye.setUint8(3,U),ye.setUint16(4,q);for(let ke=0;ke<q;ke++)ye.setUint8(6+ke,F[ke]);const ge=new Uint8Array(ye.buffer);return ge.set(new Uint8Array(z),le),ge.buffer}(R.data,k,y),P.enqueue(R)}(_,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Rs()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=BA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;if(m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id)L.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o);else if(m.data.getMetadata){const y=r.metadata&&r.metadata();y&&u.port1.postMessage({metadata:y})}},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=WA.get(e);if(c){WA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){L.warning(m&&m.message)}}}WA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Dn().supportWebRTCEncodedTransform)return void L.warning("browser not support audio encoded transform");if(qA.has(e))return;const i={track:e.track,onMetadata:r.onMetadata};if(jp()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");hL(Fn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void L.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(L.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)),r.enableTopn?function(_,y,S){var R;const P=Qz(new DataView(y.data));if(!P)return S.enqueue(y);const k=_.track.id;Zpe.set(k,_.track);const z=(R=P.tlv.find(Ee=>Ee.tag===Hp.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let U=0;typeof z=="number"&&(U=127-z);const F=Math.round(Math.pow(10,U/60)-1),{selected:q,speaker:Y}=function(Ee,ye){let ge=Mv.get(Ee);if(ge||(ge=function(ke){const qe=new eG;return Mv.set(ke,qe),pd||(pd=new Jpe(re("TOPN_SILENCE_THRESHOLD")||500),pd.on("ActiveSpeakerChanged",ut=>{ut!=null&&(HA=ut)})),pd.addSpeakers([qe]),qe}(Ee)),Mv.size<=tG)return{selected:!0,speaker:ge};if(!pd)throw new Error("no active speaker detector");return pd.levelChanged(ge.id,ye),D_=pd.loudest.map(ke=>ke.id),HA&&!st(D_).call(D_,HA)&&D_.length>=tG&&D_.pop(),{selected:st(D_).call(D_,ge.id)||ge.id===HA,speaker:ge}}(_,F),le=function(Ee,ye,ge){const ke=fd.get(Ee)||new Qpe(Ee,ye);return ke.score=ge,fd.set(Ee,ke),function(qe){if($A.set(qe,!0),!KA)return void(KA=Date.now());const ut=Date.now();ut-KA>1e3&&($A.get(qe)?$A.set(qe,!1):(nG(qe),$A.delete(qe)),KA=ut)}(Ee),ke}(k,_.track,Y.energyScore);le.addSample(q),le.active&&(y.data=P.frame.buffer,S.enqueue(y))}(e,h,m):r.enableMetadata?function(_,y,S){const R=Qz(new DataView(_.data));if(!R)return y.enqueue(_);const P=R.tlv.find(k=>k.tag===Hp.METADATA||k.tag===Hp.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),_.data=R.frame.buffer,y.enqueue(_)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Rs()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=BA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(L.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.metadata&&i.onMetadata&&i.onMetadata(m.data.metadata)},i.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=qA.get(c);if(u){(function(_){const y=Mv.get(_);y&&(Mv.delete(_),pd&&(pd.removeSpeakers([y]),Mv.size===0&&(pd.destroy(),pd=null)))})(c),nG(c.track.id),qA.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){L.warning(_&&_.message)}}}(e)}qA.set(e,i),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,r){if(!Dn().supportWebRTCEncodedTransform)return void L.warning("browser not support video encoded transform");if(YA.has(e)||!e.track)return;const i={track:e.track};if(jp()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void L.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,_){i.controller||(i.controller=_),e.track&&e.track.id!==i.track.id&&(L.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const y=u.shift();y&&(m.data=function(S,R){const P=function(Y){const le=Y.length;let Ee=[],ye=0;for(;ye<le;)ye+2<le&&Y[ye]===0&&Y[ye+1]===0&&(Y[ye+2]===0||Y[ye+2]===1||Y[ye+2]===2||Y[ye+2]===3)?(Ee.push(Y[ye],Y[ye+1],3,Y[ye+2]),ye+=3):(Ee.push(Y[ye]),ye++);return new Uint8Array(Ee)}(R),k=P.length,z=Math.floor(k/255),U=k%255,F=new Uint8Array(6+z+1+k+S.byteLength);F[0]=0,F[1]=0,F[2]=0,F[3]=1,F[4]=6,F[5]=101;let q=0;for(;q<z;)F[6+q]=255,q++;return F[6+q]=U,q++,F.set(P,6+q),F.set(new Uint8Array(S),6+q+k),F.buffer}(m.data,y)),_.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Rs())return;{if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=BA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id&&(L.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=YA.get(e);if(c){YA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){L.warning(m&&m.message)}}}YA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Dn().supportWebRTCEncodedTransform)return void L.warning("browser not support video encoded transform");if(!e.track)return;if(yT.has(e)){const c=yT.get(e);return void(c&&(c.onSei=r.onSei))}const i={track:e.track,onSei:r.onSei};if(jp()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void L.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(L.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=function(y){const S=new DataView(y.data);let R=0;for(;R+4<y.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let P=R+6,k=0,z=0;for(;(z=S.getUint8(P++))===255;)k+=255;k+=z;const U=efe(y.data,P,k);return new Uint8Array(U)}R++}return null}(h);_&&i.onSei&&i.onSei(_),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Rs()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=BA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(L.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.sei&&i.onSei&&i.onSei(m.data.sei)},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=yT.get(c);if(u){yT.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){L.warning(_&&_.message)}}})(e)}yT.set(e,i),e.track.addEventListener("ended",o)}},v_e={name:"InterceptFrame",create:()=>y_e};kL(),Qn("PROCESS_ID","process-".concat(cr(8,""),"-").concat(cr(4,""),"-").concat(cr(4,""),"-").concat(cr(4,""),"-").concat(cr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void L.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();L.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(_r,o)){const{value:c,expires:u}=r[o];if(u&&u<=i)return;hd[o]=c,_r[o]=c}})}catch(r){L.error("Error loading mutableParamsCache: ".concat(e),r.message)}}(),Array.isArray(hd.AREAS)&&hd.AREAS.length>0&&bx(hd.AREAS,!0);const s$=(e,r,i)=>{L.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(r))),Qn(e,r,i)};Lm(zge,!1),Lm($ge,!1),Lm(Rme,!1),Lm(r_e,!1),Lm(jge,!1),Lm(m_e,!1),Lm(E_e,!1),Lm(v_e,!1);const Si=function(e){const r=new kr,i=e,o={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===gh.SECURITY_POLICY_VIOLATION&&FH(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return VH(VH({},i),o)}({__TRACK_LIST__:Cv,VERSION:vl,BUILD:LL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:s$,getParameter:re,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let r=new RTCPeerConnection;const i=await async function(o){let c;return Dn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!i)return e;r.close(),r=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(r){throw new Oe(X.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return e},checkSystemRequirements:function(){const e=Rt.reportApiInvoke(null,{name:yi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Vr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&gL()&&o8(75)&&new u().close()}catch(u){return L.error("check system requirement failed: ",u),!1}let i=!1;const o=Cn();o.name===Fn.CHROME&&Number(o.version)>=58&&(ud.engine.name!=="WebKit"||function(){const u=Cn();if(wA()){if(u.os===ji.MAC_OS)return!0;if(u.os===ji.IOS){const h=ud.os.version&&ud.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(i=!0),(o.name===Fn.FIREFOX&&Number(o.version)>=56||o.name===Fn.OPERA&&Number(o.version)>=45||o.name===Fn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(Ro()||cu())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||h8()||Cn().name===Fn.QQ)&&(i=!0),L.debug("checkSystemRequirements, api:",r,"browser",i);const c=r&&i;return e.onSuccess(c),c},getDevices:function(e){return Gc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Gc.getRecordingDevices(e)},getCameras:function(e){return Gc.getCamerasDevices(e)},getElectronScreenSources:oW,getPlaybackDevices:function(e){return Gc.getSpeakers(e)},createClient:function(){var e;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=cr(5,"client-"),o=Rt.reportApiInvoke(null,{id:i,name:yi.CREATE_CLIENT,options:[r],tag:Vr.TRACER});try{(function(c){Ni(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ni(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Ni(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&as(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&v8(c.turnServer),c.httpRetryConfig!==void 0&&y8(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&y8(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return(c8(16,0)||l8(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",L.debug("browser not support vp9, force use vp8")),Qn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new Cme(gu(gu({forceWaitGatewayResponse:!0},r),{},{role:st(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=re("CAMERA_CAPTURE_CONFIG"),i=cr(8,"track-cam-"),o=Rt.reportApiInvoke(null,{id:i,tag:Vr.TRACER,name:yi.CREATE_CAM_VIDEO_TRACK,options:[Ar({},e),r]});r&&(e.encoderConfig=r);const c=FA(e);let u=null;L.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{u=(await zc({video:c},i)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(L)}e.optimizationMode&&JL(i,u,e,ph(e.encoderConfig));const h=new XL(u,e,c,e.scalabiltyMode?xA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return o.onSuccess(h.getTrackId()),L.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(e){const r=cr(8,"track-cus-"),i=Rt.reportApiInvoke(null,{id:r,tag:Vr.TRACER,name:yi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),o=new Er(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?xA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[lr.CUSTOM_TRACK]);return i.onSuccess(o.getTrackId()),L.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof r=="object"?function(P){return gW(P)}(r):void 0;i&&(r="auto");const o=cr(8,"track-scr-v-"),c=Rt.reportApiInvoke(null,{id:o,tag:Vr.TRACER,name:yi.CREATE_SCREEN_VIDEO_TRACK,options:[Ar({},e),r]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(P){const k={};P.screenSourceType&&(k.mediaSource=P.screenSourceType),P.extensionId&&jp()&&(k.extensionId=P.extensionId);const{displaySurface:z,selfBrowserSurface:U,surfaceSwitching:F,systemAudio:q,preferCurrentTab:Y}=P;(cT(107)||pL(107)||fL(93))&&(z&&(Ni(z,"displaySurface",["browser","window","monitor"]),k.displaySurface=z),U?(Ni(U,"selfBrowserSurface",["exclude","include"]),k.selfBrowserSurface=U):k.selfBrowserSurface="include",F&&(Ni(F,"surfaceSwitching",["exclude","include"]),k.surfaceSwitching=F)),(cT(105)||pL(105)||fL(91))&&q&&(Ni(q,"systemAudio",["exclude","include"]),k.systemAudio=q),(cT(94)||pL(94)||fL(80))&&Y&&(k.preferCurrentTab=!0),P.electronScreenSourceId&&(k.sourceId=P.electronScreenSourceId);const le=P.encoderConfig?FL(P.encoderConfig):null;return k.mandatory={chromeMediaSource:"desktop",maxWidth:le?le.width:void 0,maxHeight:le?le.height:void 0},le&&(le.frameRate&&(typeof le.frameRate=="number"?(k.mandatory.maxFrameRate=le.frameRate,k.mandatory.minFrameRate=le.frameRate):(k.mandatory.maxFrameRate=le.frameRate.max||le.frameRate.ideal||le.frameRate.exact||void 0,k.mandatory.minFrameRate=le.frameRate.min||le.frameRate.ideal||le.frameRate.exact||void 0),k.frameRate=le.frameRate),le.width&&(k.width=le.width),le.height&&(k.height=le.height)),k}(e);let h=null,m=null;const _=Dn();if(!_.supportShareAudio&&r==="enable"){const P=new Le(X.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(L)}L.info("start create screen video track with config",e,"withAudio",r,"trackId",o);const y=_.supportShareAudio&&r!=="disable";try{const P=await zc({screen:u,screenAudio:y?i||!0:void 0},o);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(L)}if(!m&&r==="enable"){h&&h.stop();const P=new Le(X.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(L)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(JL(o,h,e,e.encoderConfig&&FL(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new Er(h,e.encoderConfig?FL(e.encoderConfig):{},e.scalabiltyMode?xA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[lr.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),L.info("create screen video track success","video:",S.getTrackId()),S;const R=new zr(m,void 0,cr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),L.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=re("CAMERA_CAPTURE_CONFIG"),o=cr(8,"track-mic-"),c=cr(8,"track-cam-"),u=Rt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Vr.TRACER,name:yi.CREATE_MIC_AND_CAM_TRACKS,options:[e,r,i]});i&&(r.encoderConfig=i);const h=FA(r),m=_W(e);let _=null,y=null;L.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(r)));try{const P=await zc({audio:m,video:h},"".concat(o,"-").concat(c));_=P.getAudioTracks()[0],y=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!_||!y){const P=new Le(X.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(L)}r.optimizationMode&&JL(c,y,r,ph(r.encoderConfig));const S=new jA(_,e,m,o),R=new XL(y,r,h,r.scalabiltyMode?xA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),L.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=cr(8,"track-mic-"),i=Rt.reportApiInvoke(null,{id:r,tag:Vr.TRACER,name:yi.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=_W(e);let c=null;L.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{c=(await zc({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(L)}const u=new jA(c,e,o,r);return i.onSuccess(u.getTrackId()),L.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(e){const r=cr(8,"track-cus-"),i=Rt.reportApiInvoke(null,{id:r,tag:Vr.TRACER,name:yi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new zr(e.mediaStreamTrack,e.encoderConfig?MA(e.encoderConfig):{},r,!1);return L.info("create custom audio track success with config",e,"trackId",o.getTrackId()),i.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var r;const{cacheOnlineFile:i,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:i,encoderConfig:o},h=cr(8,"track-buf-"),m=Rt.reportApiInvoke(null,{id:h,tag:Vr.TRACER,name:yi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(re("DISABLE_WEBAUDIO"))throw new Le(X.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");L.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let k=null;if(typeof R=="string"){const U=rz.get(R);if(U)return L.debug("use cached audio resource: ",R),U;try{k=(await dd(()=>Jo.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(F){throw new Le(X.FETCH_AUDIO_FILE_FAILED,F.toString())}}else k=await new lt((F,q)=>{const Y=new FileReader;Y.onload=le=>{le.target?F(le.target.result):q(new Le(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.onerror=()=>{q(new Le(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.readAsArrayBuffer(R)});const z=await function(U){const F=Nv();return new lt((q,Y)=>{F.decodeAudioData(U,le=>{q(le)},le=>{Y(new Le(X.DECODE_AUDIO_FILE_FAILED,le.toString()))})})}(k);return typeof R=="string"&&P&&rz.set(R,z),z}(c,i)}catch(R){return m.onError(R),R.throw(L)}const y=new $pe(c),S=new Hpe(_,y,o?MA(o):{},h);return L.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(e){if(L.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw L.debug("Invalid appType"),new Oe(X.INVALID_PARAMS,"invalid app type",e);Qn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){L.setLogLevel(e)},enableLogUpload:function(){re("USE_NEW_LOG")?Qn("UPLOAD_LOG",!0):L.enableLogUpload()},disableLogUpload:function(){re("USE_NEW_LOG")?Qn("UPLOAD_LOG",!1):L.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new r9},checkAudioTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=Rt.reportApiInvoke(null,{tag:Vr.TRACER,name:yi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof zr||e instanceof xv)){const _=new Oe(X.INVALID_TRACK,"the parameter is not a audio track");return i.onError(_),_.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof zr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const m=Date.now();return new lt(_=>{const y=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const R=u-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(y);const k=R,z={duration:P,deviceLabel:o,maxVolumeLevel:u,result:k};L.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(z))),i.onSuccess(z),_(k)}},200)})},checkVideoTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=Rt.reportApiInvoke(null,{tag:Vr.TRACER,name:yi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof Er||e instanceof Lv)){const R=new Oe(X.INVALID_TRACK,"the parameter is not a video track");return i.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof Er?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Rs()||wA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,_=0;try{const R=Date.now();m=await function(P,k,z,U){let F,q=0,Y=null;return new lt((le,Ee)=>{function ye(){q>U&&F&&(F(),le(q));const ge=z.getContext("2d");if(!ge){const ut=new Oe(X.UNEXPECTED_ERROR,"can not get canvas 2d context.");return L.error(ut.toString()),void Ee(ut)}ge.drawImage(P,0,0,160,120);const ke=ge.getImageData(0,0,z.width,z.height),qe=Math.floor(ke.data.length/3);if(Y){for(let ut=0;ut<qe;ut+=3)if(ke.data[ut]!==Y[ut])return q+=1,void(Y=ke.data);Y=ke.data}else Y=ke.data}setTimeout(()=>{F&&(F(),le(q))},k),F=GL(()=>{ye()},30)})}(u,r,h,4),_=Date.now()-R}catch(R){throw i.onError(R),R}dme===Fn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const y=m>4,S={duration:_,changedPicNum:m,deviceLabel:o,result:y};return L.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),i.onSuccess(S),y},setArea:bx,audioElementPlayCenter:Qo,resumeAudioContext:function(){Qo.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Ame.processExternalMediaAEC(e)},registerExtensions:function(e){const r=re("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!st(r).call(r,i.name)&&r.push(i.name);const o=i;o.__registered__=!0,o.logger.hookLog=L.extLog,o.reporter.hookApiInvoke=Rt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=re(c)})}),s$("PLUGIN_INFO",r)},ChannelMediaRelayError:Vv,ChannelMediaRelayEvent:Kp,ChannelMediaRelayState:Da,RemoteStreamFallbackType:Vpe,RemoteStreamType:Upe,ConnectionDisconnectedReason:Gn,AudienceLatencyLevelType:fpe,AREAS:jn,preload:async function(e,r,i,o){return O9(e,r,i,o)}});return Object.defineProperties(Si,{onAudioAutoplayFailed:{get:()=>Hc.onAudioAutoplayFailed,set:e=>{Hc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Hc.onAutoplayFailed,set:e=>{Hc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Si._onSecurityPolicyViolation,set(e){Si._onSecurityPolicyViolation=e,FH(e)}},__CLIENT_LIST__:{get:()=>re("SHOW_GLOBAL_CLIENT_LIST")?L_:[]}}),Gc.on(O_.CAMERA_DEVICE_CHANGED,e=>{L.info("camera device changed",JSON.stringify(e)),Si.onCameraChanged&&Si.onCameraChanged(e),Si.safeEmit(gh.CAMERA_CHANGED,e)}),Gc.on(O_.RECORDING_DEVICE_CHANGED,e=>{L.info("microphone device changed",JSON.stringify(e)),Si.onMicrophoneChanged&&Si.onMicrophoneChanged(e),Si.safeEmit(gh.MICROPHONE_CHANGED,e)}),Gc.on(O_.PLAYOUT_DEVICE_CHANGED,e=>{L.debug("playout device changed",JSON.stringify(e)),Si.onPlaybackDeviceChanged&&Si.onPlaybackDeviceChanged(e),Si.safeEmit(gh.PLAYBACK_DEVICE_CHANGED,e)}),Qo.onAutoplayFailed=()=>{L.info("detect audio element autoplay failed"),Hc.onAudioAutoplayFailed&&Hc.onAudioAutoplayFailed()},Zn.on("autoplay-failed",()=>{L.info("detect webaudio autoplay failed"),Hc.onAudioAutoplayFailed&&Hc.onAudioAutoplayFailed(),Si.safeEmit(gh.AUTOPLAY_FAILED)}),Zn.on(us.STATE_CHANGE,(e,r)=>{L.info("audio context state changed: ".concat(r," => ").concat(e)),Si.onAudioContextStateChanged&&Si.onAudioContextStateChanged(e,r),Si.safeEmit(gh.AUDIO_CONTEXT_STATE_CHANGED,e,r)}),li.on(vv.NETWORK_STATE_CHANGE,(e,r)=>{L.info("[network-indicator] network state changed, ".concat(r," => ").concat(e))}),window&&(window.__ARTC__=Si),Si})}(ek)),ek.exports}var M6e=x6e();const kR=DE(M6e),U6e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"9442a472625f44e7b2c5065b9f9b3988",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"},Dse="9442a472625f44e7b2c5065b9f9b3988";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",Dse);console.log("AgoraProvider: import.meta.env:",U6e);const V6e=kR.createClient({mode:"rtc",codec:"vp8"});let yw=null;const Lse=D.createContext(null),xse=({children:n,appId:t=Dse,channel:s=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:f=!0,onClientReady:E=()=>{}})=>{console.log("AgoraProvider: appId prop:",t);const[v,b]=D.useState(!1),[w,A]=D.useState(!1),[N,V]=D.useState([]),[j,B]=D.useState(null),[H,J]=D.useState(null),[$,te]=D.useState(null),[ce,oe]=D.useState(!1),[_e,ne]=D.useState(!1),[ee,Q]=D.useState(!1),[se,pe]=D.useState(null),[fe,ue]=D.useState(!1),Me=Du(),He=D.useRef(V6e),nt=D.useRef({appId:t,channel:s,uid:l,enabled:d}),we=D.useRef(!1),Ce=D.useRef(null);D.useRef(null),D.useEffect(()=>{nt.current={appId:t,channel:s,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:t,channel:s,uid:l,enabled:d})},[t,s,l,d]),D.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:t,channel:s,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[t,s,l,d]),D.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",s),J(s)},[s]),D.useEffect(()=>{if(!He.current)return;const tt=dt=>{console.log(`Connection state changed to: ${dt}`),dt==="DISCONNECTED"?(b(!1),console.log("Disconnected from Agora")):dt==="CONNECTED"&&(b(!0),B(null))};return He.current.on("connection-state-change",tt),()=>{He.current.off("connection-state-change",tt)}},[]),D.useEffect(()=>{if(!s||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:s,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",s,"with UID",l);const tt=async(xt,tn)=>{console.log("AgoraProvider: User published:",xt.uid,tn);try{await He.current.subscribe(xt,tn),console.log("AgoraProvider: Subscribed to user:",xt.uid,"mediaType:",tn),tn==="audio"&&(xt.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",xt.uid)),V(kn=>kn.some($t=>$t.uid===xt.uid)?kn:[...kn,xt])}catch(kn){console.error("AgoraProvider: Error subscribing to user:",kn)}},dt=(xt,tn)=>{console.log("AgoraProvider: User unpublished:",xt.uid,tn),tn==="audio"&&xt.audioTrack&&(xt.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",xt.uid))},Ze=xt=>{console.log("AgoraProvider: User joined:",xt.uid),V(tn=>tn.some(kn=>kn.uid===xt.uid)?tn:[...tn,xt])},wt=xt=>{console.log("AgoraProvider: User left:",xt.uid),V(tn=>tn.filter(kn=>kn.uid!==xt.uid))};He.current.on("user-published",tt),He.current.on("user-unpublished",dt),He.current.on("user-joined",Ze),He.current.on("user-left",wt);const un=async()=>{if(we.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}we.current=!0;try{if(v&&Ce.current===s){console.log("AgoraProvider: Already joined to channel",s),oe(!0),E(He.current);return}if(He.current.connectionState==="CONNECTING"||He.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",He.current.connectionState),Ce.current&&Ce.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Te()}catch(xt){console.error("AgoraProvider: Error leaving channel:",xt)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),b(!0),oe(!0),Ce.current=s,yw=s,E(He.current);return}console.log("AgoraProvider: Joining channel",s,"current joined channel:",Ce.current),await Ne(),console.log("AgoraProvider: Join channel completed")}catch(xt){console.error("AgoraProvider: Error during initialization:",xt)}finally{we.current=!1}};return console.log("AgoraProvider: Running initialization"),un(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),He.current.off("user-published",tt),He.current.off("user-unpublished",dt),He.current.off("user-joined",Ze),He.current.off("user-left",wt)}},[s,d,l,E,v]);const ve=async()=>{if(!d||$)return $;console.log("Initializing microphone");try{const tt=await kR.createMicrophoneAudioTrack();return await tt.setMuted(f),te(tt),console.log("Microphone initialized successfully"),tt}catch(tt){return console.error("Error initializing microphone:",tt),B("Failed to initialize microphone. Please check your permissions."),null}};D.useEffect(()=>{(async()=>{if(s)try{const wt=await hg(s);wt&&wt.voiceDisabled?(console.log("AgoraProvider: Voice is disabled for this space"),ue(!0),v&&await Te()):ue(!1)}catch(Ze){console.error("AgoraProvider: Error checking if voice is disabled:",Ze)}})();const dt=Ze=>{Ze.detail&&typeof Ze.detail.voiceDisabled=="boolean"&&(console.log("AgoraProvider: Voice setting changed:",Ze.detail.voiceDisabled),ue(Ze.detail.voiceDisabled),Ze.detail.voiceDisabled&&v?Te():!Ze.detail.voiceDisabled&&!v&&d&&s&&Ne())};return window.addEventListener("SpaceVoiceSettingChanged",dt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",dt)}},[s,v,d]);const Ne=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(fe)return console.log("AgoraProvider: Voice is disabled for this space, not joining channel"),B("Voice chat is disabled for this space"),!1;if(!s)return console.error("AgoraProvider: No channel specified"),B("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",s,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:v,isJoining:_e,connectionState:He.current.connectionState,joinedChannel:Ce.current}),v&&Ce.current===s)return console.log("AgoraProvider: Already joined to channel:",s),!0;if(_e)return console.log("AgoraProvider: Already in the process of joining"),!1;if(He.current.connectionState==="CONNECTED")if(Ce.current&&Ce.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Te()}catch(tt){console.error("AgoraProvider: Error leaving channel:",tt)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),b(!0),oe(!0),Ce.current=s,yw=s,E(He.current),!0;if(He.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),ne(!0),new Promise(tt=>{const dt=setInterval(()=>{He.current.connectionState==="CONNECTED"&&(clearInterval(dt),b(!0),ne(!1),oe(!0),Ce.current=s,yw=s,E(He.current),tt(!0))},500);setTimeout(()=>{clearInterval(dt),console.log("AgoraProvider: Connection timeout, considering join failed"),ne(!1),tt(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",s,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",t,"Type:",typeof t,"Length:",t.length),!t||t.trim()===""){const dt="AgoraProvider: App ID is empty or invalid";return console.error(dt),B(dt),ne(!1),!1}ne(!0);const tt=l||Math.floor(Math.random()*1e6);return await He.current.join(t,s,a,tt),console.log("AgoraProvider: Joined channel successfully with UID:",He.current.uid),b(!0),ne(!1),oe(!0),Ce.current=s,yw=s,E(He.current),!0}catch(tt){return console.error("AgoraProvider: Error joining channel:",tt),B(`Error joining channel: ${tt.toString()}`),ne(!1),!1}},Te=async()=>{if(v)try{$&&await He.current.unpublish($),await He.current.leave(),yw=null,Ce.current=null,console.log("Left channel successfully"),b(!1),V([])}catch(tt){console.error("Error leaving channel:",tt),B(tt.message||"Failed to leave channel")}};D.useEffect(()=>()=>{$&&$.close()},[]),D.useEffect(()=>{d&&s&&(!v||Ce.current!==s)&&Ne()},[d,s,v]);const be=()=>{if(!$)return!1;try{return $.isActive&&!$.muted}catch(tt){return console.error("Error checking microphone status:",tt),!1}};D.useEffect(()=>{const tt=()=>{const Ze=be();Ze!==w&&(console.log("Syncing microphone state:",{actualStatus:Ze,currentState:w}),A(Ze),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Ze}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ze,window.agoraClient.microphoneTrack=$))};$&&tt();const dt=setInterval(tt,1e3);return()=>{clearInterval(dt)}},[$,w]);const Ae=async()=>{var tt;if(fe)return console.log("AgoraProvider: Voice is disabled for this space, cannot toggle"),Me({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const dt=w!==void 0?w:$?!$.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:w,currentState:dt,hasMicTrack:!!$,trackMuted:$==null?void 0:$.muted}),!$&&(console.log("AgoraProvider: No microphone track, initializing..."),!await ve()))return console.error("AgoraProvider: Failed to initialize microphone"),dt;const Ze=!dt;if(console.log("AgoraProvider: New voice state will be:",Ze),dt){if($)try{console.log("AgoraProvider: Muting microphone track"),await $.setMuted(!0),$.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await $.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",$.muted)}catch(wt){return console.error("Error muting track:",wt),dt}}else if($)try{He.current&&v&&!((tt=He.current.localTracks)!=null&&tt.includes($))&&(console.log("AgoraProvider: Publishing microphone track"),await He.current.publish($),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await $.setMuted(!1),$.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await $.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",$.muted)}catch(wt){return console.error("Error unmuting track:",wt),dt}return A(Ze),Ze}catch(dt){return console.error("AgoraProvider: Error toggling voice:",dt),w}},Ue=async tt=>{try{te(tt),console.log("Microphone track updated successfully")}catch(dt){throw console.error("Error updating microphone track:",dt),dt}},Ge=async()=>{if(!He.current||!s)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(ee)return console.log("AgoraProvider: Stopping screen share"),se&&(Array.isArray(se)?(await He.current.unpublish(se),se.forEach(tt=>tt.close())):(await He.current.unpublish(se),se.close()),pe(null)),Q(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const tt=await kR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",tt),tt.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),He.current.unpublish(tt),tt.close(),pe(null),Q(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await He.current.publish(tt),pe(tt),Q(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=tt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(tt){return console.error("AgoraProvider: Error creating screen track:",tt),Q(!1),pe(null),!1}}catch(tt){return console.error("AgoraProvider: Error toggling screen share:",tt),Q(!1),pe(null),!1}};D.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current,isScreenSharing:!1,screenTrack:null};const tt=Ze=>{console.log("AgoraProvider: Received ToggleScreenShare event"),Ge().then(wt=>{Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!0,wt)}).catch(wt=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",wt),Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!1,ee)})},dt=Ze=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Ne().then(wt=>{Ze.detail&&Ze.detail.callback&&Ze.detail.callback(wt)}).catch(wt=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",wt),Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",tt),window.addEventListener("JoinVoiceChat",dt),()=>{window.removeEventListener("ToggleScreenShare",tt),window.removeEventListener("JoinVoiceChat",dt),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),D.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",w),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=w,window.agoraClient.microphoneTrack=$,window.agoraClient.client=He.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:w}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:w}))},[w,$]);const Qe={client:He.current,isJoined:v,isVoiceEnabled:w,users:N,error:j,channel:H,appId:t,toggleVoice:Ae,leaveChannel:Te,joinChannel:Ne,microphoneTrack:$,isReady:ce,createMicrophoneTrack:Ue,isScreenSharing:ee,screenTrack:se,toggleScreenShare:Ge,voiceDisabled:fe};return C.jsx(Lse.Provider,{value:Qe,children:n})},Mse=()=>{const n=D.useContext(Lse);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};xse.propTypes={children:Lr.node.isRequired,appId:Lr.string.isRequired,channel:Lr.string.isRequired,token:Lr.string,uid:Lr.oneOfType([Lr.string,Lr.number])};const F6e=()=>{var we,Ce;const{client:n,isVoiceEnabled:t,isJoined:s,users:a,error:l,microphoneTrack:d,isReady:f,channel:E,appId:v,toggleVoice:b,joinChannel:w,leaveChannel:A,createMicrophoneTrack:N,isScreenSharing:V,screenTrack:j,toggleScreenShare:B,voiceDisabled:H}=Mse(),[J,$]=D.useState(t!==void 0?t:((we=window.agoraClient)==null?void 0:we.isVoiceEnabled)||!1),[te,ce]=D.useState(V!==void 0?V:((Ce=window.agoraClient)==null?void 0:Ce.isScreenSharing)||!1),[oe,_e]=D.useState(H!==void 0?H:!1),[ne,ee]=D.useState(!0);D.useEffect(()=>{var ve;t!==void 0?$(t):((ve=window.agoraClient)==null?void 0:ve.isVoiceEnabled)!==void 0?$(window.agoraClient.isVoiceEnabled):d&&$(!d.muted)},[t,d]),D.useEffect(()=>{var ve;V!==void 0?ce(V):((ve=window.agoraClient)==null?void 0:ve.isScreenSharing)!==void 0&&ce(window.agoraClient.isScreenSharing)},[V]),D.useEffect(()=>{H!==void 0&&_e(H)},[H]);const Q=D.useRef({isVoiceEnabled:J,isScreenSharing:te,isJoined:s,users:a,error:l,isReady:f,channel:E,appId:v,voiceDisabled:oe});D.useEffect(()=>{Q.current={isVoiceEnabled:J,isScreenSharing:te,isJoined:s,users:a,error:l,isReady:f,channel:E,appId:v,voiceDisabled:oe}},[J,te,s,a,l,f,E,v,oe]),D.useEffect(()=>{const ve=setTimeout(()=>{ee(!1)},5e3);return()=>clearTimeout(ve)},[]),D.useEffect(()=>{f&&ee(!1)},[f]),D.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:J,contextIsScreenSharing:V,localScreenSharing:te,isJoined:s,users:a.length,error:l,isReady:f,channel:E,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!j})},[t,J,V,te,s,a,l,f,E,v,d,j]);const se=async()=>{try{console.log("useVoiceChat: Toggling voice from:",J);const ve=await b();if(console.log("useVoiceChat: Toggle result:",ve),ve!==void 0)$(ve);else{const Ne=!J;$(Ne),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ne)}return ve!==void 0?ve:!J}catch(ve){return console.error("useVoiceChat: Error toggling voice:",ve),J}},pe=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",te);const ve=await B();if(console.log("useVoiceChat: Screen share toggle result:",ve),ve!==void 0)ce(ve);else{const Ne=!te;ce(Ne),window.agoraClient&&(window.agoraClient.isScreenSharing=Ne)}return ve!==void 0?ve:!te}catch(ve){return console.error("useVoiceChat: Error toggling screen share:",ve),te}},fe=async()=>{J&&d&&await se()},ue=async()=>{!J&&d&&await se()},Me=ve=>a.some(Ne=>{var Te;return Ne.uid===ve&&((Te=Ne.audioTrack)==null?void 0:Te.isPlaying)}),He=D.useCallback(()=>{if(!d||!J)return 0;try{return d.getVolumeLevel()}catch(ve){return console.error("Error getting volume level:",ve),0}},[d,J]);return{isVoiceEnabled:J,isScreenSharing:te,isJoined:s,users:a,error:l,toggleVoice:se,toggleScreenShare:pe,mute:fe,unmute:ue,isUserSpeaking:Me,getVolumeLevel:He,microphoneTrack:d,screenTrack:j,isLoading:ne,channel:E,appId:v,joinChannel:w,leaveChannel:A,client:n,setMicrophoneDevice:async ve=>{try{if(!ve){console.error("No device ID provided");return}if(!n||!s){console.error("Client not initialized or not joined to a channel");return}d&&(J&&await n.unpublish(d),await d.close());const Ne=await kR.createMicrophoneAudioTrack({microphoneId:ve,encoderConfig:"music_standard"});N&&await N(Ne),J&&await n.publish(Ne),console.log("Microphone device changed successfully")}catch(Ne){throw console.error("Error changing microphone device:",Ne),Ne}},voiceDisabled:oe}},j6e=({size:n="md",tooltipPlacement:t="top",defaultMuted:s=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:f,isJoined:E,joinChannel:v,channel:b,client:w,voiceDisabled:A}=F6e(),[N,V]=D.useState(!1),[j,B]=D.useState(!1);D.useEffect(()=>{const $=()=>{he.log("VoiceButton: Player instantiated, showing button"),B(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(he.log("VoiceButton: Player was already instantiated"),B(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]),D.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:E,channel:b,hasClient:!!w,clientState:w==null?void 0:w.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:j,voiceDisabled:A})},[d,E,b,w,j,A]);const H=async()=>{if(!(N||A)){V(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:E});try{if(!E&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(te){te.message&&te.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",te)}console.log("VoiceButton: Toggling voice state from:",d);const $=await f();console.log("VoiceButton: Voice toggled, new state:",$)}catch($){console.error("VoiceButton: Error toggling voice:",$)}finally{V(!1)}}},J=()=>A?"Voice chat is disabled for this space":j?N?"Processing...":E?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!j||A?null:C.jsx(wf,{label:J(),placement:t,hasArrow:!0,children:C.jsxs(It,{position:"relative",cursor:"pointer",onClick:H,children:[C.jsx(Qh,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?C.jsx(bV,{color:"white"}):C.jsx(SV,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),N&&C.jsx(It,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:C.jsx(np,{size:"sm",color:"white"})})]})})},B6e=si.createContext({user:null}),W6e=({userNickname:n})=>{const{client:t,channel:s,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=Mse(),[f,E]=D.useState([]),[v,b]=D.useState(!1),[w,A]=D.useState(!0);D.useRef({});const N=D.useRef(null);D.useRef(null);const{user:V}=D.useContext(B6e)||{user:null},[j,B]=D.useState({}),H=D.useRef(a),[J,$]=D.useState(null),{isOpen:te,onOpen:ce,onClose:oe}=If(),[_e,ne]=D.useState(!1),ee=D.useRef(null),Q=D.useRef(null);D.useEffect(()=>{H.current=a},[a]),D.useEffect(()=>{if(!t||!s){b(!1);return}const Me=setTimeout(()=>{A(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",s);const He=t.connectionState;if(console.log("Current connection state:",He),He==="CONNECTED")b(!0),A(!1);else{b(!1);const nt=we=>{console.log("Connection state changed:",we),we==="CONNECTED"?(b(!0),A(!1)):b(!1)};return t.on("connection-state-change",nt),()=>{t.off("connection-state-change",nt),clearTimeout(Me)}}return()=>{clearTimeout(Me)}},[t,s]),D.useEffect(()=>{const Me=async()=>{const He={...j};let nt=!1;for(const we of f){if(j[we.uid])continue;let Ce=null,ve=we.uid;if(typeof ve=="string"&&(ve.includes("-")?(Ce=ve.split("-")[0],ve=ve.split("-")[1]):ve.includes("_")&&(Ce=ve.split("_")[0],ve=ve.split("_")[1])),ve)try{console.log("Trying to fetch nickname for user ID:",ve);const Ne=await Nd(ve);Ne&&Ne.Nickname?(console.log("Found nickname in Firebase for user ID:",ve,"Nickname:",Ne.Nickname),He[we.uid]=Ne.Nickname,nt=!0):Ce?(console.log("Using extracted name for user ID:",ve,"Name:",Ce),He[we.uid]=Ce,nt=!0):(He[we.uid]="User",nt=!0)}catch(Ne){console.error("Error fetching user profile:",Ne),Ce?(He[we.uid]=Ce,nt=!0):(He[we.uid]="User",nt=!0)}else Ce?(He[we.uid]=Ce,nt=!0):(He[we.uid]="User",nt=!0)}nt&&B(He)};f.length>0&&Me()},[f,j]),D.useEffect(()=>{if(!t||!s||!v)return;console.log("Setting up screen share event handlers");const Me=async(we,Ce)=>{if(console.log("User published:",we.uid,Ce,we),Ce==="video"){console.log("Remote video track detected:",we.uid);try{await t.subscribe(we,Ce),console.log("Subscribed to remote video track:",we.uid),E(ve=>ve.some(Ne=>Ne.uid===we.uid)?ve:[...ve,we])}catch(ve){console.error("Error subscribing to remote video track:",ve)}}},He=(we,Ce)=>{if(console.log("User unpublished:",we.uid,Ce),Ce==="video"){if(console.log("Remote video track unpublished:",we.uid),we.videoTrack)try{we.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(E(ve=>ve.filter(Ne=>Ne.uid!==we.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),H.current.play(N.current)}catch(ve){console.error("Error replaying local screen track:",ve)}}},nt=we=>{console.log("User left:",we.uid);const Ce=f.find(ve=>ve.uid===we.uid);if(Ce&&Ce.videoTrack)try{Ce.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(E(ve=>ve.filter(Ne=>Ne.uid!==we.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),H.current.play(N.current)}catch(ve){console.error("Error replaying local screen track:",ve)}};return t.on("user-published",Me),t.on("user-unpublished",He),t.on("user-left",nt),()=>{t.off("user-published",Me),t.off("user-unpublished",He),t.off("user-left",nt)}},[t,s,v,f,l]),D.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(Me=>{if(Me.videoTrack)try{console.log("Playing video track for:",Me.uid),Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error("Error playing video track:",He)}}),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),H.current.play(N.current)}catch(Me){console.error("Error replaying local screen track:",Me)}},[f,l]),D.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&N.current)try{console.log("Playing local screen track"),a.play(N.current)}catch(Me){console.error("Error playing local screen track:",Me)}},[l,a]),D.useEffect(()=>()=>{if(f.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.stop()}catch(He){console.error("Error stopping video track on unmount:",He)}}),a)try{a.stop()}catch(Me){console.error("Error stopping local screen track on unmount:",Me)}},[f,a]);const se=()=>{console.log("Stopping local screen share"),d()},pe=Me=>(console.log("Getting display name for UID:",Me,"type:",typeof Me),l&&V&&(Me===V.uid||Me===(t==null?void 0:t.uid))?n||"You":j[Me]?j[Me]:typeof Me=="string"?Me.includes("-")?Me.split("-")[0]:Me.includes("_")?Me.split("_")[0]:Me:"User"),fe=Me=>{console.log("Opening modal for remote screen",Me),$(Me),ce()},ue=()=>{console.log("Opening modal for local screen"),$({isLocal:!0}),ce()};return D.useEffect(()=>{te&&J?(console.log("Modal opened, activeScreen:",J),setTimeout(()=>{if(J.isLocal&&H.current)try{console.log("Playing local screen in modal"),H.current.play("modal-screen-container"),ne(!0)}catch(Me){console.error("Error playing local screen in modal:",Me)}else if(J.videoTrack)try{console.log("Playing remote screen in modal"),J.videoTrack.play("modal-screen-container"),ne(!0)}catch(Me){console.error("Error playing remote screen in modal:",Me)}},500)):te||(ne(!1),$(null),setTimeout(()=>{if(l&&H.current)try{H.current.play("local-screen-container")}catch(Me){console.error("Error playing local screen in small container:",Me)}f.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error(`Error playing remote screen ${Me.uid} in small container:`,He)}})},500))},[te,J,l,f]),!v||w&&f.length===0&&!l||f.length===0&&!l?null:C.jsxs(C.Fragment,{children:[!te&&C.jsxs(It,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:ee,children:[l&&a&&C.jsxs(It,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:ue,children:[C.jsx(It,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),C.jsx(It,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(Me=>{const He=j[Me.uid]||pe(Me.uid);return C.jsxs(It,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>fe(Me),children:[C.jsx(It,{id:`video-container-${Me.uid}`,width:"100%",height:"100%",position:"relative"}),C.jsx(It,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${He}'s Screen`})]},Me.uid)})]}),te&&C.jsx(It,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:oe,children:C.jsxs(It,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Me=>Me.stopPropagation(),children:[!_e&&C.jsxs(It,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[C.jsx(np,{size:"xl"}),C.jsx(ht,{mt:4,children:"Loading screen share..."})]}),C.jsx(It,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:Q}),C.jsx(It,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:oe,children:""}),C.jsx(It,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:J!=null&&J.isLocal?n?`${n}'s Screen`:"Your Screen":`${j[J==null?void 0:J.uid]||pe(J==null?void 0:J.uid)}'s Screen`}),(J==null?void 0:J.isLocal)&&C.jsx(It,{position:"absolute",bottom:4,right:4,children:C.jsx(Ti,{colorScheme:"red",size:"sm",onClick:se,children:"Stop Sharing"})})]})})]})},z6e=({onClose:n})=>{const t=Du(),[s,a]=D.useState(!1),[l,d]=D.useState(!1);D.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const b=setInterval(v,1e3),w=()=>{v()};return window.addEventListener("ScreenShareToggled",w),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",w)}},[]);const f=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)E();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:w=>{if(!w){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}E()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),t({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},E=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,w)=>{a(!1),b?(d(w),t(w?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),t({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:s?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function G6e({open:n,onClose:t}){const[s,a]=D.useState(0);return C.jsxs(ca,{isOpen:n,onClose:t,size:"md",isCentered:!0,children:[C.jsx(da,{backdropFilter:"blur(4px)"}),C.jsxs(la,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[C.jsx(sl,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),C.jsx(Ha,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(ua,{p:0,display:"flex",children:C.jsxs($R,{orientation:"vertical",variant:"unstyled",index:s,onChange:a,display:"flex",flexGrow:1,children:[C.jsxs(KR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[C.jsxs(hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Ln,{as:_6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Movement"})]}),C.jsxs(hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Ln,{as:E6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Camera"})]}),C.jsxs(hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Ln,{as:m6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Actions"})]}),C.jsxs(hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Ln,{as:g6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Tips"})]})]}),C.jsxs(_1,{flexGrow:1,display:"flex",flexDirection:"column",children:[C.jsxs(Ol,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),C.jsxs(zs,{wrap:"wrap",gap:3,children:[C.jsx(Pl,{keyLabel:"W",description:"Move Forward"}),C.jsx(Pl,{keyLabel:"A",description:"Move Left"}),C.jsx(Pl,{keyLabel:"S",description:"Move Backward"}),C.jsx(Pl,{keyLabel:"D",description:"Move Right"}),C.jsx(Pl,{keyLabel:"Shift",description:"Run"}),C.jsx(Pl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),C.jsxs(Ol,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),C.jsxs(zs,{wrap:"wrap",gap:3,children:[C.jsx(Pl,{keyLabel:"Mouse",description:"Look Around"}),C.jsx(Pl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),C.jsx(Pl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),C.jsxs(Ol,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),C.jsxs(zs,{wrap:"wrap",gap:3,children:[C.jsx(Pl,{keyLabel:"E",description:"Interact"}),C.jsx(Pl,{keyLabel:"F",description:"Emote Menu"}),C.jsx(Pl,{keyLabel:"T",description:"Chat"}),C.jsx(Pl,{keyLabel:"M",description:"Mute Mic"})]})]}),C.jsxs(Ol,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),C.jsxs(Di,{align:"stretch",spacing:2,children:[C.jsx(ht,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),C.jsx(ht,{fontSize:"xs",children:" Press ESC to access settings"}),C.jsx(ht,{fontSize:"xs",children:" Click on players to view their profile"}),C.jsx(ht,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Pl=({keyLabel:n,description:t})=>C.jsx(It,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:C.jsxs(fi,{spacing:2,children:[C.jsx(It,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),C.jsx(ht,{fontSize:"xs",children:t})]})}),H6e=()=>{const[n,t]=D.useState([]),[s,a]=D.useState(""),[l,d]=D.useState(0),[f,E]=D.useState(100),[v,b]=D.useState(100),[w,A]=D.useState(!0),[N,V]=D.useState(!0),[j,B]=D.useState(!1);D.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const oe=await kR.getMicrophones();t(oe),oe.length>0&&a(oe[0].deviceId)}catch(oe){console.error("Error getting audio devices:",oe)}})()},[]),D.useEffect(()=>{const ce=setInterval(()=>{d(j?Math.random()*50:0)},100);return()=>clearInterval(ce)},[j]);const H=ce=>{const oe=ce.target.value;a(oe),console.log("Microphone changed to:",oe)},J=ce=>{E(ce),console.log("Microphone volume set to:",ce)},$=ce=>{b(ce),console.log("Speaker volume set to:",ce)},te=()=>{B(!j)};return C.jsxs(Di,{spacing:6,align:"stretch",children:[C.jsxs(Ai,{children:[C.jsxs(Ba,{children:["Microphone",C.jsx(ff,{ml:2,colorScheme:j?"green":"red",children:j?"Enabled":"Muted"})]}),C.jsxs(Xte,{value:s,onChange:H,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(ce=>C.jsx("option",{value:ce.deviceId,children:ce.label||`Microphone ${ce.deviceId.slice(0,5)}...`},ce.deviceId)),n.length===0&&C.jsx("option",{value:"",children:"No microphones found"})]})]}),C.jsxs(It,{children:[C.jsx(ht,{mb:2,children:"Microphone Level"}),C.jsx(u0,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),C.jsxs(Ai,{children:[C.jsxs(Ba,{children:["Microphone Volume: ",f,"%"]}),C.jsxs(UU,{value:f,onChange:J,min:0,max:100,step:1,colorScheme:"blue",children:[C.jsx(FU,{bg:"gray.700",children:C.jsx(jU,{})}),C.jsx(VU,{boxSize:6})]})]}),C.jsxs(Ai,{children:[C.jsxs(Ba,{children:["Speaker Volume: ",v,"%"]}),C.jsxs(UU,{value:v,onChange:$,min:0,max:100,step:1,colorScheme:"blue",children:[C.jsx(FU,{bg:"gray.700",children:C.jsx(jU,{})}),C.jsx(VU,{boxSize:6})]})]}),C.jsxs(Ai,{display:"flex",alignItems:"center",children:[C.jsx(Ba,{mb:"0",children:"Microphone Enabled"}),C.jsx(Tf,{isChecked:j,onChange:te,colorScheme:"green",size:"lg"})]}),C.jsxs(Ai,{display:"flex",alignItems:"center",children:[C.jsx(Ba,{mb:"0",children:"Echo Cancellation"}),C.jsx(Tf,{isChecked:w,onChange:()=>A(!w),colorScheme:"green",size:"lg"})]}),C.jsxs(Ai,{display:"flex",alignItems:"center",children:[C.jsx(Ba,{mb:"0",children:"Noise Suppression"}),C.jsx(Tf,{isChecked:N,onChange:()=>V(!N),colorScheme:"green",size:"lg"})]}),C.jsxs(hf,{status:"info",borderRadius:"md",children:[C.jsx(pf,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function $6e({open:n,onClose:t,containerRef:s}){return C.jsx(Nu,{containerRef:s,children:C.jsxs(ca,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[C.jsx(da,{}),C.jsxs(la,{bg:"gray.900",color:"white",borderRadius:"lg",children:[C.jsx(sl,{children:"Settings"}),C.jsx(Ha,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),C.jsx(ua,{children:C.jsxs($R,{variant:"enclosed",children:[C.jsxs(KR,{mb:4,children:[C.jsx(hc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),C.jsx(hc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),C.jsxs(_1,{children:[C.jsx(Ol,{children:C.jsx(It,{p:4,bg:"gray.800",borderRadius:"md",children:C.jsx(H6e,{})})}),C.jsx(Ol,{children:C.jsx(It,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function K6e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function q6e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function JS(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function Use(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function Y6e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function X6e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function J6e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function iR(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function wV(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function TJ(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function kS(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function Q6e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const Z6e=async()=>{try{he.log("tagsFirestore: Fetching all tags");const n=y0(mi,"tags"),t=await OR(n),s=[];return t.forEach(a=>{s.push({id:a.id,...a.data()})}),s}catch(n){throw he.error("tagsFirestore: Error fetching tags:",n),n}},e8e=async n=>{try{he.log(`tagsFirestore: Fetching tag with ID: ${n}`);const t=Pi(mi,"tags",n),s=await ol(t);return s.exists()?{id:s.id,...s.data()}:(he.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(t){throw he.error(`tagsFirestore: Error fetching tag with ID ${n}:`,t),t}},t8e=async({id:n,name:t,color:s,description:a})=>{try{he.log(`tagsFirestore: Creating new tag: ${t}`);const l={name:t,color:s||"#808080",description:a||"",createdAt:new Date,updatedAt:new Date};let d;if(n){const f=Pi(mi,"tags",n);await Vk(f,l),d=n}else{const f=y0(mi,"tags");d=(await L3e(f,l)).id}return{id:d,...l}}catch(l){throw he.error("tagsFirestore: Error creating tag:",l),l}},n8e=async(n,t)=>{try{he.log(`tagsFirestore: Adding tag ${t} to space ${n}`);const s=Pi(mi,"tags",t);if(!(await ol(s)).exists())throw new Error(`Tag with ID ${t} does not exist`);const l=Pi(mi,"spaces",n);return await al(l,{tags:M3e(t)}),!0}catch(s){throw he.error(`tagsFirestore: Error adding tag ${t} to space ${n}:`,s),s}},r8e=async(n,t)=>{try{he.log(`tagsFirestore: Removing tag ${t} from space ${n}`);const s=Pi(mi,"spaces",n);return await al(s,{tags:U3e(t)}),!0}catch(s){throw he.error(`tagsFirestore: Error removing tag ${t} from space ${n}:`,s),s}},i8e=async n=>{try{he.log(`tagsFirestore: Getting tags for space ${n}`);const t=Pi(mi,"spaces",n),s=await ol(t);if(!s.exists())throw new Error(`Space with ID ${n} not found`);const l=s.data().tags||[];if(l.length===0)return[];const d=[];for(const f of l){const E=await e8e(f);E&&d.push(E)}return d}catch(t){throw he.error(`tagsFirestore: Error getting tags for space ${n}:`,t),t}},s8e=async()=>{he.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let t=0,s=0;for(const a of n){he.log(`tagsFirestore: Processing tag: ${a.name}`);const l=Pi(mi,"tags",a.id);(await ol(l)).exists()?(he.log(`tagsFirestore: Tag ${a.id} already exists, skipping`),s++):(await t8e(a),t++,he.log(`tagsFirestore: Created tag: ${a.name}`))}return he.log(`tagsFirestore: Tags initialization complete. Created: ${t}, Skipped: ${s}`),{created:t,skipped:s}}catch(t){throw he.error("tagsFirestore: Error initializing default tags:",t),t}},Vse=({spaceID:n})=>{const[t,s]=D.useState([]),[a,l]=D.useState([]),[d,f]=D.useState(!0),[E,v]=D.useState(!1),[b,w]=D.useState(!1),[A,N]=D.useState(null),{isOpen:V,onOpen:j,onClose:B}=If(),H=Du(),{user:J}=D.useContext(cl),$=(J==null?void 0:J.groups)&&(J.groups.includes("disruptiveAdmin")||J.groups.includes("admin"));D.useEffect(()=>{te()},[n]);const te=async()=>{f(!0);try{let Q=[];try{Q=await Z6e(),s(Q)}catch(se){he.error("SpaceTagsManager: Error loading available tags:",se),s([]),H({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const se=await i8e(n);l(se)}catch(se){he.error("SpaceTagsManager: Error loading space tags:",se),l([]),H({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(Q){he.error("SpaceTagsManager: Error in loadTags:",Q),H({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{f(!1)}},ce=async()=>{w(!0),N(null);try{const Q=await s8e();console.log("Tag initialization result:",Q),N(Q),H({title:"Tags initialized",description:`Successfully created ${Q.created} tags. Skipped ${Q.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await te()}catch(Q){he.error("SpaceTagsManager: Error initializing tags:",Q),N(!1),H({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{w(!1)}},oe=async Q=>{if(!(!n||!Q)){v(!0);try{await n8e(n,Q);const se=t.find(pe=>pe.id===Q);se&&l(pe=>[...pe,se]),H({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(se){he.error(`SpaceTagsManager: Error adding tag ${Q} to space:`,se),H({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},_e=async Q=>{if(!(!n||!Q)){v(!0);try{await r8e(n,Q),l(se=>se.filter(pe=>pe.id!==Q)),H({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(se){he.error(`SpaceTagsManager: Error removing tag ${Q} from space:`,se),H({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},ne=()=>{const Q=a.map(se=>se.id);return t.filter(se=>!Q.includes(se.id))},ee=ne().length===0;return C.jsxs(It,{children:[C.jsx(zs,{mb:3,justifyContent:"space-between",alignItems:"center",children:C.jsxs(fi,{spacing:2,ml:"auto",children:[$&&C.jsx(Ti,{size:"xs",leftIcon:C.jsx(t6e,{}),onClick:j,variant:"outline",colorScheme:"purple",children:"Admin"}),C.jsxs(c1,{children:[C.jsx(l1,{as:Ti,size:"xs",leftIcon:C.jsx(e6e,{}),rightIcon:C.jsx(r6e,{}),isDisabled:d||E||ee,children:ee?"No Available Tags":"Add Tag"}),C.jsx(u1,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:ne().length>0?ne().map(Q=>C.jsx(HS,{onClick:()=>oe(Q.id),icon:C.jsx(It,{width:"12px",height:"12px",borderRadius:"full",bg:Q.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:Q.name},Q.id)):C.jsx(HS,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),d?C.jsx(zs,{justify:"center",py:4,children:C.jsx(np,{size:"sm",color:"blue.300"})}):t.length===0?C.jsx(It,{children:C.jsxs(ht,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",$?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):a.length===0?C.jsx(ht,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):C.jsx(ane,{spacing:2,children:a.map(Q=>C.jsx(rj,{children:C.jsxs(nne,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${Q.color||"#888"}`,children:[C.jsx(It,{width:"8px",height:"8px",borderRadius:"full",bg:Q.color||"#888",mr:1}),C.jsx(rne,{children:Q.name}),C.jsx(sne,{onClick:()=>_e(Q.id),isDisabled:E})]})},Q.id))}),C.jsxs(ca,{isOpen:V,onClose:B,size:"md",children:[C.jsx(da,{backdropFilter:"blur(4px)"}),C.jsxs(la,{bg:"gray.800",color:"white",children:[C.jsx(sl,{fontSize:"md",children:"Tag System Administration"}),C.jsx(Ha,{}),C.jsxs(ua,{children:[C.jsx(ht,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),A&&C.jsxs(hf,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[C.jsx(pf,{}),C.jsxs(ht,{fontSize:"sm",children:["Tags initialized. Created: ",C.jsx("b",{children:A.created}),", Skipped: ",C.jsx("b",{children:A.skipped})]})]}),C.jsx(Ti,{colorScheme:"blue",onClick:ce,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),C.jsx(_g,{children:C.jsx(Ti,{variant:"ghost",size:"sm",onClick:B,children:"Close"})})]})]})]})};Vse.propTypes={spaceID:Lr.string.isRequired};const o8e=({isOpen:n,onClose:t})=>{const{spaceID:s}=Ka(),[a,l]=D.useState(0),[d,f]=D.useState(""),[E,v]=D.useState(""),[b,w]=D.useState(!1),[A,N]=D.useState(null),[V,j]=D.useState(null),[B,H]=D.useState(!1),[J,$]=D.useState(0),[te,ce]=D.useState(null),oe=D.useRef(null),[_e,ne]=D.useState(null),[ee,Q]=D.useState(null),[se,pe]=D.useState(!1),[fe,ue]=D.useState(0),[Me,He]=D.useState(null),nt=D.useRef(null),[we,Ce]=D.useState([]),[ve,Ne]=D.useState([]),[Te,be]=D.useState(!1),[Ae,Ue]=D.useState(!1),[Ge,Qe]=D.useState(!0),[tt,dt]=D.useState(!1),[Ze,wt]=D.useState(!1),[un,xt]=D.useState(""),[tn,kn]=D.useState(""),[$t,zn]=D.useState(""),[Bt,Re]=D.useState(!1),{setHLSStreamUrl:Fe,savedStreamData:We}=fse(),ot=Du();D.useEffect(()=>{n&&s&&Et()},[n,s]);const Et=async()=>{try{const Pt=await hg(s);Pt.logoUrl&&ce(Pt.logoUrl),Pt.backgroundUrl&&He(Pt.backgroundUrl),Pt.voiceDisabled!==void 0&&Ue(Pt.voiceDisabled),Pt.accessibleToAllUsers!==void 0&&Qe(Pt.accessibleToAllUsers),f(Pt.name||""),v(Pt.description||"");try{const wn=await cse(s);if(wn){xt(wn.streamUrl||""),kn(wn.rtmpUrl||""),zn(wn.streamKey||"");const ir=wn.enabled===!0;wt(ir),he.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:ir,rawValue:wn.enabled})}else wt(!1),he.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(wn){if(he.error("Error fetching stream data directly:",wn),We){xt(We.streamUrl||""),kn(We.rtmpUrl||""),zn(We.streamKey||"");const ir=We.enabled===!0;wt(ir),he.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:ir,rawValue:We.enabled})}else wt(!1),he.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}yt(Pt)}catch(Pt){he.error("Error fetching space data:",Pt),ot({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};D.useEffect(()=>{if(We){if(!Bt){xt(We.streamUrl||""),kn(We.rtmpUrl||""),zn(We.streamKey||"");const Pt=We.enabled===!0;wt(Pt),he.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:Pt,rawValue:We.enabled})}}else n&&!Bt&&he.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[We,Bt,n]);const yt=async Pt=>{if(s&&n){be(!0);try{const wn=fV(),ir=`space_${s}_owners`,Oi=FX(y0(wn,"users"),jX("groups","array-contains",ir)),_c=await OR(Oi),is=[];for(const to of _c.docs){const ms=to.data(),ss=await Nd(to.id);is.push({uid:to.id,email:ms.email,displayName:ms.displayName||ss.Nickname||"Unknown User",photoURL:ms.photoURL||ss.photoURL,firstName:ss.firstName,lastName:ss.lastName})}Ce(is);const fa=`space_${s}_hosts`,_o=FX(y0(wn,"users"),jX("groups","array-contains",fa)),ma=await OR(_o),ga=[];for(const to of ma.docs){const ms=to.data(),ss=await Nd(to.id);ga.push({uid:to.id,email:ms.email,displayName:ms.displayName||ss.Nickname||"Unknown User",photoURL:ms.photoURL||ss.photoURL,firstName:ss.firstName,lastName:ss.lastName})}Ne(ga)}catch(wn){he.error("Error fetching space users:",wn),ot({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{be(!1)}}};D.useEffect(()=>{s&&n&&a===4&&yt()},[s,n,a]);const zt=Pt=>{const wn=Pt.target.files[0];if(wn){if(!wn.type.startsWith("image/")){ot({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}N(wn);const ir=new FileReader;ir.onloadend=()=>{j(ir.result)},ir.readAsDataURL(wn)}},pn=Pt=>{const wn=Pt.target.files[0];if(wn){if(!wn.type.startsWith("image/")){ot({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}ne(wn);const ir=new FileReader;ir.onloadend=()=>{Q(ir.result)},ir.readAsDataURL(wn)}},xn=async()=>{if(!A){ot({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{H(!0);const Pt=setInterval(()=>{$(ir=>{const Oi=ir+10;return Oi>=90?90:Oi})},300),wn=await aBe(s,A);clearInterval(Pt),$(100),ce(wn),ot({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{N(null),j(null),$(0),H(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:wn}}))}catch(Pt){console.error("Error uploading logo:",Pt),ot({title:"Upload failed",description:Pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),H(!1),$(0)}},cn=async()=>{if(!_e){ot({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{pe(!0);const Pt=setInterval(()=>{ue(ir=>{const Oi=ir+10;return Oi>=90?90:Oi})},300),wn=await lBe(s,_e);clearInterval(Pt),ue(100),He(wn),ot({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{ne(null),Q(null),ue(0),pe(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:wn}}))}catch(Pt){console.error("Error uploading background:",Pt),ot({title:"Upload failed",description:Pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),pe(!1),ue(0)}},dr=async()=>{if(te)try{H(!0),await cBe(s),ce(null),ot({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),H(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Pt){console.error("Error deleting logo:",Pt),ot({title:"Deletion failed",description:Pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),H(!1)}},pa=async()=>{if(Me)try{pe(!0),await uBe(s),He(null),ot({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),pe(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Pt){console.error("Error deleting background:",Pt),ot({title:"Deletion failed",description:Pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),pe(!1)}},Vt=()=>{oe.current&&oe.current.click()},on=()=>{nt.current&&nt.current.click()},Mi=async()=>{dt(!0);try{await dBe(s,{voiceDisabled:!Ae}),Ue(!Ae),ot({title:"Settings Updated",description:`Voice chat has been ${Ae?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Pt){he.error("Error updating voice settings:",Pt),ot({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{dt(!1)}},fs=async()=>{dt(!0);try{await hBe(s,!Ge),Qe(!Ge),ot({title:"Settings Updated",description:`Space is now ${Ge?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Pt){he.error("Error updating accessibility settings:",Pt),ot({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{dt(!1)}},Ls=async()=>{if(s){w(!0);try{const Pt=fV(),wn=Pi(Pt,"spaces",s);await al(wn,{name:d,description:E}),ot({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:E}}))}catch(Pt){he.error("Error updating space details:",Pt),ot({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{w(!1)}}},Zr=async()=>{if(s){Re(!0);try{const Pt={enabled:Ze,streamUrl:un,rtmpUrl:tn,streamKey:$t,playerIndex:"0",updatedAt:new Date().toISOString()};he.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Ze,url:un,hasRtmp:!!tn,hasKey:!!$t});try{await _V(s,Pt),he.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(wn){throw he.error("SpaceManageModal: Error updating stream settings directly in Firebase:",wn),wn}await Fe(un,0,{enabled:Ze,rtmpUrl:tn,streamKey:$t}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Ze,spaceId:s}})),ot({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Ze?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{Et()},500)}catch(Pt){he.error("Error updating stream settings:",Pt),ot({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{Re(!1)}}};return C.jsxs(ca,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[C.jsx(da,{backdropFilter:"blur(4px)"}),C.jsxs(la,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[C.jsx(sl,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),C.jsx(Ha,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(ua,{p:0,display:"flex",overflow:"hidden",children:C.jsxs($R,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",width:"100%",height:"100%",children:[C.jsxs(KR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[C.jsxs(hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Ln,{as:Use,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Details"})]}),C.jsxs(hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Ln,{as:JS,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Logo"})]}),C.jsxs(hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Ln,{as:q6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Background"})]}),C.jsxs(hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Ln,{as:X6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Settings"})]}),C.jsxs(hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Ln,{as:TJ,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Users"})]}),C.jsxs(hc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Ln,{as:kS,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Stream"})]})]}),C.jsxs(_1,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[C.jsxs(Ol,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),C.jsxs(Di,{spacing:4,align:"stretch",children:[C.jsxs(Ai,{children:[C.jsx(Ba,{fontSize:"xs",children:"Space Name"}),C.jsx(ds,{value:d,onChange:Pt=>f(Pt.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),C.jsxs(Ai,{children:[C.jsx(Ba,{fontSize:"xs",children:"Description"}),C.jsx(one,{value:E,onChange:Pt=>v(Pt.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),C.jsxs(Ai,{children:[C.jsx(Ba,{fontSize:"xs",children:"Space Tags"}),C.jsx(It,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:s?C.jsx(Vse,{spaceID:s}):C.jsxs(hf,{status:"warning",variant:"subtle",borderRadius:"md",children:[C.jsx(pf,{}),C.jsx(AS,{fontSize:"sm",children:"Space ID missing"}),C.jsx(PS,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),C.jsx(Ti,{colorScheme:"blue",size:"sm",onClick:Ls,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),C.jsxs(Ol,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(te||V)&&C.jsxs(zs,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[te&&C.jsxs(It,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),C.jsx(Fh,{src:te,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),C.jsx(Ti,{mt:3,colorScheme:"red",leftIcon:C.jsx(Ln,{as:iR}),onClick:dr,isLoading:B,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),V&&C.jsxs(It,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),C.jsx(Fh,{src:V,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),C.jsxs(Ai,{children:[C.jsx(Ba,{fontSize:"xs",children:"Upload New Logo"}),C.jsx(ds,{type:"file",accept:"image/*",onChange:zt,ref:oe,display:"none"}),B&&C.jsxs(It,{mt:3,mb:3,children:[C.jsxs(ht,{fontSize:"xs",mb:1,children:["Uploading... ",J,"%"]}),C.jsx(u0,{value:J,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),C.jsxs(fi,{mt:3,spacing:3,children:[C.jsx(Ti,{colorScheme:"blue",leftIcon:C.jsx(Ln,{as:JS}),onClick:Vt,isDisabled:B,size:"sm",variant:"outline",children:"Browse"}),C.jsx(Ti,{colorScheme:"green",leftIcon:C.jsx(Ln,{as:wV}),onClick:xn,isLoading:B,loadingText:"Uploading...",isDisabled:!A||B,size:"sm",children:"Upload"})]}),C.jsx(wU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),C.jsxs(Ol,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(Me||ee)&&C.jsxs(zs,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Me&&C.jsxs(It,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),C.jsx(Fh,{src:Me,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),C.jsx(Ti,{mt:3,colorScheme:"red",leftIcon:C.jsx(Ln,{as:iR}),onClick:pa,isLoading:se,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),ee&&C.jsxs(It,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),C.jsx(Fh,{src:ee,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),C.jsxs(Ai,{children:[C.jsx(Ba,{fontSize:"xs",children:"Upload New Background"}),C.jsx(ds,{type:"file",accept:"image/*",onChange:pn,ref:nt,display:"none"}),se&&C.jsxs(It,{mt:3,mb:3,children:[C.jsxs(ht,{fontSize:"xs",mb:1,children:["Uploading... ",fe,"%"]}),C.jsx(u0,{value:fe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),C.jsxs(fi,{mt:3,spacing:3,children:[C.jsx(Ti,{colorScheme:"blue",leftIcon:C.jsx(Ln,{as:JS}),onClick:on,isDisabled:se,size:"sm",variant:"outline",children:"Browse"}),C.jsx(Ti,{colorScheme:"green",leftIcon:C.jsx(Ln,{as:wV}),onClick:cn,isLoading:se,loadingText:"Uploading...",isDisabled:!_e||se,size:"sm",children:"Upload"})]}),C.jsx(wU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),C.jsxs(Ol,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),C.jsxs(Di,{spacing:4,align:"stretch",children:[C.jsx(It,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(fi,{justify:"space-between",align:"center",children:[C.jsxs(It,{children:[C.jsxs(fi,{mb:1,spacing:2,children:[C.jsxs(It,{position:"relative",w:"16px",h:"16px",children:[C.jsx(Ln,{as:Q6e,color:Ae?"red.400":"green.400"}),Ae&&C.jsx(It,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.800",children:Ae?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),C.jsx(Tf,{isChecked:!Ae,onChange:Mi,colorScheme:"green",size:"md",isDisabled:tt})]})}),C.jsx(It,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(fi,{justify:"space-between",align:"center",children:[C.jsxs(It,{children:[C.jsxs(fi,{mb:1,spacing:2,children:[C.jsx(It,{position:"relative",w:"16px",h:"16px",children:C.jsx(Ln,{as:TJ,color:Ge?"green.400":"red.400"})}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.800",children:Ge?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),C.jsx(ht,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),C.jsx(Tf,{isChecked:Ge,onChange:fs,colorScheme:"green",size:"md",isDisabled:tt})]})}),C.jsxs(hf,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[C.jsx(pf,{color:"blue.300"}),C.jsxs(It,{children:[C.jsx(AS,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),C.jsx(PS,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),C.jsxs(Ol,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),Te?C.jsx(zs,{justify:"center",align:"center",h:"200px",children:C.jsx(np,{color:"blue.300"})}):C.jsxs(Di,{spacing:4,align:"stretch",children:[C.jsxs(It,{children:[C.jsxs(fi,{mb:2,children:[C.jsx(Ln,{as:K6e,color:"green.400"}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Owners"}),C.jsx(ff,{colorScheme:"green",ml:2,children:we.length})]}),C.jsx(It,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:we.length===0?C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):C.jsx(Di,{spacing:1,align:"stretch",children:we.map(Pt=>C.jsxs(fi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[C.jsx(Qh,{size:"xs",src:Pt.photoURL,name:Pt.displayName}),C.jsxs(It,{children:[C.jsx(ht,{fontSize:"xs",children:Pt.displayName}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:Pt.firstName&&Pt.lastName?`${Pt.firstName} ${Pt.lastName}`:"Full name not available"})]}),C.jsx(gk,{}),C.jsx(ff,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Pt.uid))})})]}),C.jsxs(It,{children:[C.jsxs(fi,{mb:2,children:[C.jsx(Ln,{as:J6e,color:"purple.400"}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),C.jsx(ff,{colorScheme:"purple",ml:2,children:ve.length})]}),C.jsx(It,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ve.length===0?C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):C.jsx(Di,{spacing:1,align:"stretch",children:ve.map(Pt=>C.jsxs(fi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[C.jsx(Qh,{size:"xs",src:Pt.photoURL,name:Pt.displayName}),C.jsxs(It,{children:[C.jsx(ht,{fontSize:"xs",children:Pt.displayName}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:Pt.firstName&&Pt.lastName?`${Pt.firstName} ${Pt.lastName}`:"Full name not available"})]}),C.jsx(gk,{}),C.jsx(ff,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Pt.uid))})})]}),C.jsx(ag,{borderColor:"whiteAlpha.200"}),C.jsxs(hf,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[C.jsx(pf,{color:"blue.300",boxSize:4}),C.jsxs(It,{children:[C.jsx(AS,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),C.jsx(PS,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]}),C.jsxs(Ol,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Stream Settings"}),C.jsxs(Di,{spacing:4,align:"stretch",children:[C.jsx(It,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(fi,{justify:"space-between",align:"center",children:[C.jsx(It,{children:C.jsxs(fi,{mb:1,spacing:2,children:[C.jsx(It,{position:"relative",w:"16px",h:"16px",children:C.jsx(Ln,{as:kS,color:Ze?"green.400":"red.400"})}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),C.jsx(Tf,{isChecked:Ze,onChange:async()=>{const Pt=!Ze;wt(Pt),Re(!0);try{he.log("SpaceManageModal: Auto-saving streaming enabled state:",Pt);const wn={enabled:Pt,streamUrl:un||"",rtmpUrl:tn||"",streamKey:$t||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await _V(s,wn),he.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(ir){throw he.error("SpaceManageModal: Error updating streaming state directly in Firebase:",ir),ir}await Fe(un,0,{enabled:Pt,rtmpUrl:tn,streamKey:$t}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Pt,spaceId:s}})),ot({title:"Streaming "+(Pt?"Enabled":"Disabled"),description:`Streaming is now ${Pt?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(wn){he.error("Error auto-saving streaming state:",wn),wt(!Pt),ot({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{Re(!1),setTimeout(()=>{Et()},500)}},colorScheme:"green",size:"md",isDisabled:Bt})]})}),C.jsxs(It,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),C.jsxs(Ai,{mb:4,children:[C.jsx(Ba,{fontSize:"xs",children:"Stream URL"}),C.jsx(ds,{value:un,onChange:Pt=>xt(Pt.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Bt})]}),C.jsx(ag,{my:3,borderColor:"whiteAlpha.200"}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),C.jsxs(Ai,{mb:3,children:[C.jsx(Ba,{fontSize:"xs",children:"RTMP URL"}),C.jsx(ds,{value:tn,onChange:Pt=>kn(Pt.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Bt})]}),C.jsxs(Ai,{mb:3,children:[C.jsx(Ba,{fontSize:"xs",children:"Stream Key"}),C.jsx(ds,{value:$t,onChange:Pt=>zn(Pt.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Bt,type:"password"})]})]}),C.jsx(Ti,{colorScheme:"blue",size:"sm",onClick:Zr,isLoading:Bt,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Ze?"inline-flex":"none",children:"Save Stream Settings"}),C.jsxs(hf,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[C.jsx(pf,{color:"blue.300"}),C.jsxs(It,{children:[C.jsx(AS,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),C.jsx(PS,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},a8e=({onTogglePlayerList:n,spaceID:t})=>{const{fullscreenRef:s}=Dd(),[a,l]=D.useState(!0),[d,f]=D.useState(!1),[E,v]=D.useState(!1),[b,w]=D.useState(!1),[A,N]=D.useState(!1),[V,j]=D.useState(!1),[B,H]=D.useState(null),[J,$]=D.useState(!1),[te,ce]=D.useState(!1),[oe,_e]=D.useState(!1),[ne,ee]=D.useState(!1),Q=Du(),{user:se}=D.useContext(cl),pe=(se==null?void 0:se.Nickname)||"Unknown",[fe,ue]=D.useState(!1),Me=async()=>{if(se!=null&&se.uid&&t)try{const be=await Nd(se.uid);let Ae=!1,Ue=!1;if(be.groups){const Qe=`space_${t}_owners`,tt=`space_${t}_hosts`;Ae=be.groups.includes(Qe),Ue=be.groups.includes(tt)}const Ge=await Gie(se.uid,"disruptiveAdmin");if(ee(Ge),H({rpmURL:be.rpmURL?be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),ce(Ae||Ge),_e(Ue),!Ae&&!Ge&&J){$(!1);const Qe=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Qe),Q({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(be){console.error("Error fetching profile data:",be),ce(!1),_e(!1),ee(!1)}else ce(!1),_e(!1),ee(!1)};D.useEffect(()=>{Me()},[se==null?void 0:se.uid,t,J]),D.useEffect(()=>{const be=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]),D.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&ue(window.agoraClient.voiceDisabled)}catch(Ue){console.error("Error checking if voice is disabled:",Ue)}})();const Ae=Ue=>{Ue.detail&&typeof Ue.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",Ue.detail.voiceDisabled),ue(Ue.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ae),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ae)}},[]);const He=()=>v(!E),nt=()=>w(!b),we=()=>{j(!V),Ne()},Ce=()=>{N(!1),Me()},ve=be=>{be.stopPropagation(),typeof n=="function"&&(he.log("CanvasMainMenu: Toggling player list"),n())},Ne=()=>{f(!1)},Te=be=>{if(be.stopPropagation(),!te){Q({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Ae=!J;$(Ae);const Ue=new CustomEvent("editModeChanged",{detail:{enabled:Ae}});window.dispatchEvent(Ue),Q({title:Ae?"Edit Mode Enabled":"Edit Mode Disabled",description:Ae?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Ae?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return C.jsxs(C.Fragment,{children:[C.jsxs(c1,{isOpen:d,onClose:()=>f(!1),children:[C.jsx(l1,{as:No,icon:C.jsx(o6e,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!d)}),C.jsx(Nu,{containerRef:s,children:C.jsx(u1,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:C.jsxs(Di,{align:"stretch",spacing:4,children:[C.jsxs(fi,{children:[C.jsx(Qh,{size:"md",src:B==null?void 0:B.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),C.jsxs(Di,{align:"start",spacing:0,children:[C.jsxs(fi,{children:[C.jsx(ht,{fontWeight:"bold",children:pe}),te&&!ne&&C.jsx(wf,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:C.jsx(It,{display:"inline-block",children:C.jsx(Ln,{as:vV,color:"green.400",boxSize:3})})}),!te&&oe&&!ne&&C.jsx(wf,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:C.jsx(It,{display:"inline-block",children:C.jsx(Ln,{as:TV,color:"purple.400",boxSize:3})})}),ne&&C.jsx(wf,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:C.jsx(It,{display:"inline-block",children:C.jsx(Ln,{as:v6e,color:"blue.400",boxSize:3})})})]}),C.jsx(ht,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),C.jsxs(fi,{spacing:4,justify:"center",children:[C.jsx(No,{icon:C.jsx(b6e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ve}),te&&C.jsx(No,{icon:C.jsx(p6e,{}),variant:"ghost",colorScheme:J?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:Te}),C.jsx(No,{icon:C.jsx(It,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),C.jsx(No,{icon:C.jsx(It,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),C.jsx(ag,{borderColor:"whiteAlpha.300"}),C.jsxs(Di,{align:"stretch",spacing:2,children:[te&&C.jsxs(fi,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:be=>be.stopPropagation(),justify:"space-between",children:[C.jsx(ht,{fontSize:"md",children:"Edit Mode"}),C.jsx(Tf,{id:"edit-mode-toggle",isChecked:J,onChange:Te,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:J?"green.500":"black"}}})]}),te&&C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:we,children:"Manage Space"}),se&&t&&!fe&&C.jsx(z6e,{onClose:Ne}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:He,children:"Settings"}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:nt,children:"Controls"}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&C.jsx(G6e,{open:b,onClose:nt}),E&&C.jsx($6e,{open:E,onClose:He}),A&&C.jsx(Ose,{open:A,onClose:Ce}),C.jsx(o8e,{isOpen:V,onClose:we})]})},c8e=({isOpen:n,onClose:t,mediaScreenId:s,onImageChange:a})=>{const{spaceID:l}=Ka(),d=Ff(),f=Du(),E=D.useRef(null),v=D.useRef(null),b=D.useRef(),[w,A]=D.useState(null),[N,V]=D.useState(""),[j,B]=D.useState(!1),[H,J]=D.useState(0),[$,te]=D.useState(null),[ce,oe]=D.useState(!0),[_e,ne]=D.useState(!1),[ee,Q]=D.useState(!1),[se,pe]=D.useState(0),[fe,ue]=D.useState("image"),[Me,He]=D.useState(""),[nt,we]=D.useState(!1);D.useEffect(()=>{(async()=>{if(n&&s&&l){oe(!0);try{const wt=await Ef(l,s);if(wt&&(wt.imageUrl||wt.videoUrl)){te(wt);const un=wt.mediaType==="video";ue(un?"video":"image"),we(wt.displayAsVideo||!1),un&&wt.videoUrl&&(He(wt.videoUrl),pe(1))}else te(null)}catch(wt){he.error("Error fetching existing image:",wt),te(null)}finally{oe(!1)}}})()},[n,s,l]),D.useEffect(()=>{n||(A(null),V(""),J(0),He(""))},[n]);const Ce=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation(),Q(!0)},[]),ve=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation(),Q(!1)},[]),Ne=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation()},[]),Te=D.useCallback(Ze=>{if(Ze.preventDefault(),Ze.stopPropagation(),Q(!1),Ze.dataTransfer.files&&Ze.dataTransfer.files.length>0){const wt=Ze.dataTransfer.files[0];be(wt)}},[]);D.useEffect(()=>{const Ze=v.current;if(Ze)return Ze.addEventListener("dragenter",Ce),Ze.addEventListener("dragleave",ve),Ze.addEventListener("dragover",Ne),Ze.addEventListener("drop",Te),()=>{Ze.removeEventListener("dragenter",Ce),Ze.removeEventListener("dragleave",ve),Ze.removeEventListener("dragover",Ne),Ze.removeEventListener("drop",Te)}},[Ce,ve,Ne,Te]);const be=Ze=>{if(!Ze)return;if(!Ze.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}A(Ze);const wt=new FileReader;wt.onloadend=()=>{V(wt.result)},wt.readAsDataURL(Ze)},Ae=Ze=>{const wt=Ze.target.files[0];be(wt)},Ue=async Ze=>{const wt=Ze.target.checked;if(we(wt),$)try{await kBe(l,s,wt),wt?d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:$.imageUrl||null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!1}),te({...$,displayAsVideo:wt}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${wt?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),he.log(`Updated display mode for media screen ${s} to ${wt?"video":"image"}`),a&&a({type:"update",mediaScreenId:s,displayAsVideo:wt})}catch(un){he.error("Error updating display mode:",un),f({title:"Update failed",description:un.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),we(!wt)}},Ge=async()=>{if(fe==="image"&&!w){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(fe==="video"&&!Me){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const Ze=setInterval(()=>{J(tn=>{const kn=tn+10;return kn>=90?90:kn})},300);let wt;fe==="image"?wt=await oJ(l,s,w,{mediaType:fe,displayAsVideo:nt}):(wt=Me,await oJ(l,s,null,{mediaType:"video",directUrl:Me,displayAsVideo:nt})),clearInterval(Ze),J(100);let un=null,xt=null;fe==="image"?(un=nt?null:wt,xt=($==null?void 0:$.videoUrl)||null):(un=!nt&&($!=null&&$.imageUrl)?$.imageUrl:null,xt=wt),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:un,videoUrl:xt,mediaType:fe,displayAsVideo:nt}),he.log(`Uploaded and sent ${fe} for media screen ${s} (display as video: ${nt})`),a&&a({type:"upload",mediaScreenId:s,imageUrl:fe==="image"?wt:$==null?void 0:$.imageUrl,videoUrl:fe==="video"?wt:$==null?void 0:$.videoUrl,mediaType:fe,displayAsVideo:nt}),f({title:"Upload successful",description:`The ${fe} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{A(null),V(""),B(!1),J(0),t()},1e3)}catch(Ze){he.error(`Error uploading ${fe}:`,Ze),f({title:"Upload failed",description:Ze.message||`An error occurred while uploading the ${fe}`,status:"error",duration:5e3,isClosable:!0}),B(!1),J(0)}},Qe=async()=>{ne(!1);try{B(!0),await OBe(l,s),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:fe==="image"?null:($==null?void 0:$.imageUrl)||null,videoUrl:fe==="video"?null:($==null?void 0:$.videoUrl)||null,mediaType:null,displayAsVideo:!1}),he.log(`Deleted ${fe} for media screen ${s}`),a&&a({type:"delete",mediaScreenId:s}),f({title:`${fe==="image"?"Image":"Video"} deleted`,description:`The ${fe} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),te(null),B(!1),He(""),we(!1),setTimeout(()=>{t()},500)}catch(Ze){he.error(`Error deleting ${fe}:`,Ze),f({title:"Deletion failed",description:Ze.message||`An error occurred while deleting the ${fe}`,status:"error",duration:5e3,isClosable:!0}),B(!1)}},tt=()=>{j||(A(null),V(""),J(0),t())},dt=Ze=>{pe(Ze),ue(Ze===0?"image":"video")};return C.jsxs(C.Fragment,{children:[C.jsxs(ca,{isOpen:n,onClose:tt,size:"xl",children:[C.jsx(da,{backdropFilter:"blur(10px)"}),C.jsxs(la,{bg:"gray.800",color:"white",maxW:"900px",children:[C.jsx(sl,{children:"Media Screen Content"}),C.jsx(Ha,{isDisabled:j}),C.jsxs(It,{px:6,pb:2,children:[C.jsxs(zs,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[C.jsxs(fi,{spacing:4,children:[C.jsx(ht,{fontWeight:"medium",children:"Display as:"}),C.jsxs(fi,{spacing:2,children:[C.jsx(Ln,{as:JS,color:nt?"gray.400":"green.300"}),C.jsx(Tf,{colorScheme:"purple",size:"md",isChecked:nt,onChange:Ue}),C.jsx(Ln,{as:kS,color:nt?"purple.300":"gray.400"})]})]}),C.jsx(ff,{colorScheme:nt?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:nt?"Video Output":"Image Output"})]}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",C.jsx("strong",{children:s})]}),C.jsx(ht,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),C.jsx(ag,{mb:4})]}),C.jsx(ua,{children:C.jsxs(zs,{children:[C.jsx($R,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:se,onChange:dt,h:"100%",minW:"120px",mr:4,children:C.jsxs(KR,{children:[C.jsxs(hc,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[C.jsx(Ln,{as:JS,mr:2})," Image"]}),C.jsxs(hc,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[C.jsx(Ln,{as:kS,mr:2})," Video"]})]})}),C.jsx(It,{flex:"1",children:ce?C.jsx(zs,{justify:"center",align:"center",h:"150px",children:C.jsx(np,{size:"xl",color:"blue.400"})}):C.jsxs(C.Fragment,{children:[C.jsx(It,{children:se===0?C.jsxs(Di,{spacing:4,align:"stretch",children:[$&&$.imageUrl&&fe==="image"&&C.jsxs(It,{children:[C.jsx(ht,{fontWeight:"semibold",mb:2,children:"Current Image:"}),C.jsxs(zs,{children:[C.jsx(It,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:C.jsx(Fh,{src:$.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),C.jsxs(Di,{align:"flex-start",spacing:2,children:[C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date($.uploadedAt).toLocaleString()]}),C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),C.jsx(Ti,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:C.jsx(Ln,{as:iR}),onClick:()=>ne(!0),isDisabled:j,children:"Delete"})]})]}),C.jsx(ag,{my:4})]}),C.jsx(ht,{fontWeight:"semibold",mb:2,children:$&&$.imageUrl&&fe==="image"?"Replace with new image:":"Upload new image:"}),C.jsxs(It,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:ee?"blue.400":"gray.500",bg:ee?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>E.current.click(),children:[N?C.jsx(It,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:C.jsx(Fh,{src:N,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):C.jsxs(Di,{spacing:2,children:[C.jsx(Ln,{as:wV,boxSize:"24px",color:"gray.400"}),C.jsx(ht,{children:"Drag and drop an image here, or click to browse"}),C.jsx(ht,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),C.jsx(ds,{type:"file",accept:"image/*",onChange:Ae,ref:E,display:"none"})]}),w&&C.jsxs(ht,{fontSize:"sm",children:["Selected file: ",w.name," (",Math.round(w.size/1024)," KB)"]})]}):C.jsxs(Di,{spacing:4,align:"stretch",children:[$&&$.videoUrl&&fe==="video"&&C.jsxs(It,{children:[C.jsx(ht,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),C.jsxs(zs,{children:[C.jsx(It,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:C.jsx(ht,{fontSize:"sm",wordBreak:"break-all",children:$.videoUrl})}),C.jsxs(Di,{align:"flex-start",spacing:2,children:[C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date($.uploadedAt).toLocaleString()]}),C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),C.jsx(Ti,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:C.jsx(Ln,{as:iR}),onClick:()=>ne(!0),isDisabled:j,children:"Delete"})]})]}),C.jsx(ag,{my:4})]}),C.jsx(ht,{fontWeight:"semibold",mb:2,children:$&&$.videoUrl&&fe==="video"?"Replace with new video:":"Add video URL:"}),C.jsx(It,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:C.jsxs(fi,{children:[C.jsx(Ln,{as:Use,color:"blue.300"}),C.jsx(ht,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),C.jsxs(Ai,{children:[C.jsx(Ba,{fontSize:"sm",children:"Video URL"}),C.jsx(ds,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Me,onChange:Ze=>He(Ze.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),C.jsx(ht,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),C.jsxs(It,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[C.jsxs(fi,{children:[C.jsx(Ln,{as:kS,color:"blue.300"}),C.jsx(ht,{fontWeight:"medium",children:"Video Support"})]}),C.jsx(ht,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),C.jsx(ht,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Me&&C.jsxs(It,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[C.jsxs(fi,{mb:2,children:[C.jsx(Ln,{as:Y6e,color:"blue.300"}),C.jsx(ht,{fontWeight:"medium",children:"URL Preview"})]}),C.jsx(ht,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Me}),C.jsx(ht,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),j&&C.jsxs(It,{mt:4,children:[C.jsxs(ht,{mb:2,children:["Uploading: ",H,"%"]}),C.jsx(u0,{value:H,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),C.jsxs(_g,{children:[C.jsx(Ti,{variant:"ghost",mr:3,onClick:tt,isDisabled:j,children:"Cancel"}),C.jsx(Ti,{colorScheme:"blue",onClick:Ge,isLoading:j,loadingText:"Uploading",isDisabled:fe==="image"&&!w||fe==="video"&&!Me||j||ce,leftIcon:C.jsx(Ln,{as:fe==="image"?JS:kS}),size:"lg",px:6,children:fe==="image"?"Upload Image":"Save Video URL"})]})]})]}),C.jsx(Dxe,{isOpen:_e,leastDestructiveRef:b,onClose:()=>ne(!1),children:C.jsx(da,{children:C.jsxs(Lxe,{bg:"gray.800",color:"white",children:[C.jsxs(sl,{fontSize:"lg",fontWeight:"bold",children:["Delete ",fe==="video"?"Video":"Image"]}),C.jsxs(ua,{children:["Are you sure you want to delete this ",fe,"? This will revert the media screen to its blank state."]}),C.jsxs(_g,{children:[C.jsx(Ti,{ref:b,onClick:()=>ne(!1),children:"Cancel"}),C.jsx(Ti,{colorScheme:"red",onClick:Qe,ml:3,leftIcon:C.jsx(Ln,{as:iR}),children:"Delete"})]})]})})})]})},l8e=n=>{const[t,s]=D.useState(null),[a,l]=D.useState(""),[d,f]=D.useState(null),[E,v]=D.useState(!1),b=sp(),{spaceID:w}=Ka(),A=D.useCallback(j=>{var B,H;try{if(!j)return null;if(j.includes("youtube.com")||j.includes("youtu.be")){let J="";return j.includes("youtube.com/watch")?J=new URLSearchParams(new URL(j).search).get("v"):j.includes("youtu.be/")&&(J=j.split("youtu.be/")[1].split("?")[0]),J?`https://www.youtube.com/embed/${J}?autoplay=1`:j}if(j.includes("vimeo.com")){if(j.includes("player.vimeo.com/video"))return j;const J=(H=(B=j.split("vimeo.com/")[1])==null?void 0:B.split("?")[0])==null?void 0:H.split("/")[0];return J?`https://player.vimeo.com/video/${J}?autoplay=1`:j}return j}catch(J){return he.error("Error converting to embed URL:",J),j}},[]),N=D.useCallback(()=>{setTimeout(()=>{v(!1),he.log("Video processing state reset")},100)},[]);D.useEffect(()=>{let j=!0,B=null;const J=b("PlayMediaScreenVideo",async $=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",$,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",$);const{mediaScreenId:te,videoUrl:ce}=$||{};if(!te){he.error("Media screen ID is missing in Unity event data."),N();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${te}, setting ID but not playing video`),he.log("Edit mode is active, setting media screen ID but not playing video"),f(te);return}if(v(!0),B=setTimeout(()=>{j&&(he.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),ce){if(console.log(`Using direct video URL from event: ${ce}`),j)try{const oe=A(ce);console.log(`Setting video URL to: ${oe} (original: ${ce})`),s(oe),l(`Media Screen ${te}`),f(te),he.log("Media screen video URL set directly from event:",oe)}catch(oe){he.error("Error setting video URL from direct URL:",oe)}finally{N(),clearTimeout(B)}return}console.log(`Fetching media screen data for ID: ${te}`);try{const oe=await Ef(w,te);if(console.log("Media screen data from Firestore:",oe),!oe||!oe.videoUrl){he.error("No video URL found for media screen:",te),N(),clearTimeout(B);return}if(!oe.displayAsVideo){he.log("Media screen is not set to display as video:",te),console.log("displayAsVideo flag is false for this media screen"),N(),clearTimeout(B);return}if(j)try{const _e=A(oe.videoUrl);console.log(`Setting video URL to: ${_e} (original: ${oe.videoUrl})`),s(_e),l(oe.title||`Media Screen ${te}`),f(te),he.log("Media screen video URL set to:",_e)}catch(_e){he.error("Error setting video URL from Firestore:",_e)}finally{N(),clearTimeout(B)}}catch(oe){he.error(`Error fetching media screen data for ${te}:`,oe),N(),clearTimeout(B)}}catch(te){he.error("Error handling media screen video play:",te),console.error("Error handling media screen video play:",te),N(),clearTimeout(B)}});return()=>{j=!1,B&&clearTimeout(B),J()}},[b,w,n,A,N]);const V=D.useCallback(()=>{s(null),l(""),f(null),v(!1),he.log("Video player state reset")},[]);return[t,a,d,V,E]},u8e=()=>{const{spaceID:n}=Ka(),t=Ff(),s=sp(),[a,l]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){he.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{he.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const d=D.useCallback(async b=>{try{return b.includes("vimeo.com")?await f(b):b.includes("youtube.com")||b.includes("youtu.be")?await E(b):"https://via.placeholder.com/640x360?text=Video"}catch(w){return he.error(`Error fetching thumbnail for ${b}:`,w),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async b=>{try{const w=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${A.statusText}`);const N=await A.json(),V=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let B=null;for(let H of j){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${V}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){B=J;break}}catch($){he.warn(`Failed to validate thumbnail URL: ${J}`,$)}}return B||N.thumbnail_url}catch(w){return he.error(`Error fetching Vimeo thumbnail: ${w.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},E=async b=>{let w="";if(b.includes("youtube.com/watch")?w=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(w=b.split("youtu.be/")[1].split("?")[0]),!w)throw new Error("Could not extract YouTube video ID");const A=`https://img.youtube.com/vi/${w}/maxresdefault.jpg`;try{if((await fetch(A,{method:"HEAD"})).ok)return A}catch(N){he.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${w}`,N)}return`https://img.youtube.com/vi/${w}/hqdefault.jpg`},v=D.useCallback(async b=>{try{if(!n||!b)return;he.log(`Refreshing thumbnail for media screen ${b}`);const w=await Ef(n,b);if(!w){he.log(`No media screen found with ID ${b}`);return}if(he.log("Media screen data:",w),!w.displayAsVideo||!w.videoUrl){he.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const A=await d(w.videoUrl);t("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:A}),he.log(`Sent refreshed thumbnail for media screen ${b}: ${A}`)}catch(w){he.error(`Error refreshing thumbnail for media screen ${b}:`,w)}},[n,d,t]);D.useEffect(()=>{if(!a){he.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}he.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const w=s("SetMediaScreenThumbnail",async A=>{try{const{mediaScreenId:N,thumbnailUrl:V}=A;V==="refresh"&&N&&(console.log(`Received request to refresh thumbnail for media screen ${N}`),await v(N))}catch(N){console.error("Error handling SetMediaScreenThumbnail event:",N)}});return()=>{w()}},[s,v,a]),D.useEffect(()=>{if(!a){he.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}he.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");he.log("Fetching media screens for thumbnails...");const A=await s4(n);he.log("All media screens:",A);const N=A.filter(B=>B.displayAsVideo&&B.videoUrl);if(he.log("Media screens set to display as videos:",N),N.length===0){he.log("No media screens set to display as videos found.");return}he.log(`Found ${N.length} media screens set to display as videos.`);const V=N.map(async B=>{try{const H=await d(B.videoUrl);return he.log(`Fetched thumbnail for ${B.id}: ${H}`),{mediaScreenId:B.id,thumbnailUrl:H}}catch(H){return he.error(`Error processing thumbnail for media screen ${B.id}:`,H),{mediaScreenId:B.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),j=await Promise.all(V);he.log("Fetched Media Screen Thumbnails",j),j.forEach(({mediaScreenId:B,thumbnailUrl:H})=>{t("SetMediaScreenThumbnail",{mediaScreenId:B,thumbnailUrl:H}),he.log(`Sent thumbnail to Unity for media screen ${B}: ${H}`)})}catch(A){he.error("Error fetching media screen thumbnails:",A)}};b();const w=setInterval(b,5*60*1e3);return()=>{clearInterval(w)}},[t,n,d,a])},wJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},d8e=()=>C.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),h8e=({videoUrl:n,videoTitle:t,mediaScreenId:s,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Dd();return G1(a,`video-modal-${s}`),D.useEffect(()=>{if(a){const f=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const E=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(E&&(E.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),E&&(E.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[a]),C.jsxs(C.Fragment,{children:[C.jsx(d8e,{}),C.jsxs(ca,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${s}`,children:[C.jsx(da,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),C.jsxs(la,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[C.jsx(Ha,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),C.jsx(ua,{p:0,width:"100%",children:n?C.jsx(It,{className:"iframe-container",style:wJ.iframeContainer,children:C.jsx("iframe",{className:"video-iframe",src:n,style:wJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:t||"Video Player"})}):C.jsxs(zs,{direction:"column",align:"center",justify:"center",h:"400px",children:[C.jsx(np,{size:"xl",mb:4}),C.jsx(ht,{children:"Unable to load video"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},js=(...n)=>{},p8e=()=>{const{isOpen:n,onOpen:t,onClose:s}=If(),[a,l]=D.useState(null),[d,f]=D.useState("image"),E=D.useRef(null);G1(n,"image-viewer-modal");const v=D.useCallback(A=>{A.stopPropagation()},[]);return D.useEffect(()=>{if(n&&E.current){const A=E.current;A.addEventListener("mousemove",v),A.addEventListener("mousedown",v),A.addEventListener("mouseup",v),A.addEventListener("wheel",v);const N=document.getElementById("unity-canvas");return N&&(N.style.pointerEvents="none"),()=>{A.removeEventListener("mousemove",v),A.removeEventListener("mousedown",v),A.removeEventListener("mouseup",v),A.removeEventListener("wheel",v),N&&(N.style.pointerEvents="auto")}}},[n,v]),{isOpen:n,currentImageUrl:a,currentMediaType:d,openImageViewer:(A,N="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${A} and original media type: ${N}`);const V=typeof A=="string"&&(A.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||A.includes("firebasestorage")&&!A.includes("video")),j=V?"image":N;console.log(`[DEBUG] Detected URL as ${V?"image":"non-image"}, using media type: ${j}`),l(A),f(j),t()},closeImageViewer:()=>{s(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:E,preventPropagation:v}},f8e=()=>C.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),BM=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),js(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},m8e=()=>{const{spaceID:n}=Ka(),[t,s]=D.useState(!1),[a,l]=D.useState([]),[d,f]=D.useState(null),{isOpen:E,onOpen:v,onClose:b}=If(),[w,A]=D.useState({}),[N,V]=D.useState(0);D.useRef(null);const j=Ff(),{fullscreenRef:B}=Dd(),H=sp(),[J,$]=D.useState(!1),{isOpen:te,currentImageUrl:ce,currentMediaType:oe,openImageViewer:_e,closeImageViewer:ne,modalContentRef:ee,preventPropagation:Q}=p8e(),[se,pe,fe,ue,Me]=l8e(t),{isOpen:He,onOpen:nt,onClose:we}=If();u8e(),mse(),D.useEffect(()=>{if(window.isPlayerInstantiated){$(!0);return}const be=()=>{$(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]);const Ce=D.useCallback(be=>{if(Array.isArray(a)&&a.length>0){const Ae=a.find(Ue=>Ue.mediaScreenId===be);if(Ae){const Ue=Ae.imageUrl,Ge=Ae.videoUrl;return{screen:Ae,imageUrl:Ue,videoUrl:Ge,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(ce){let Ae=null;return Array.isArray(a)&&(Ae=a.find(Ue=>Ue.mediaScreenId===be)),{screen:Ae||{mediaScreenId:be},imageUrl:ce,videoUrl:null,mediaType:(Ae==null?void 0:Ae.mediaType)||"image",displayAsVideo:(Ae==null?void 0:Ae.displayAsVideo)||!1}}return n&&be&&Ef(n,be).then(Ae=>{Ae&&l(Ue=>Array.isArray(Ue)&&Ue.some(Qe=>Qe.mediaScreenId===be)?Ue.map(Qe=>Qe.mediaScreenId===be?{...Qe,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:Qe):[...Array.isArray(Ue)?Ue:[],{mediaScreenId:be,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Ae=>{console.error(`Error fetching media screen data for ${be}:`,Ae)}),console.warn("No screen data found for:",be),null},[a,ce,n,l]),ve=D.useCallback(be=>{if(console.log(`[DEBUG] Processing click on screen: ${be}, isEditMode: ${t}`),f(be),t)console.log(`[DEBUG] Opening upload modal for screen: ${be} in edit mode`),v();else{const Ae=Ce(be);if(Ae){if(console.log(`[DEBUG] Screen data for ${be}:`,Ae),js("Screen data details:",{mediaScreenId:be,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType,displayAsVideo:Ae.displayAsVideo}),He&&fe===be)return;if(Ae.displayAsVideo&&Ae.videoUrl)js(`Opening video player for: ${Ae.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Ae.videoUrl});else if(Ae.imageUrl){js(`Opening viewer modal with ${Ae.mediaType}: ${Ae.imageUrl}`);const Ge=BM(Ae.imageUrl);_e(Ge,Ae.mediaType||"image")}else n&&Ef(n,be).then(Ge=>{if(Ge){if(Ge.displayAsVideo&&Ge.videoUrl)js(`Opening video player for: ${Ge.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Ge.videoUrl});else if(Ge.imageUrl){js(`Opening viewer modal with image: ${Ge.imageUrl}`);const Qe=BM(Ge.imageUrl);_e(Qe,Ge.mediaType||"image")}l(Qe=>Array.isArray(Qe)&&Qe.some(dt=>dt.mediaScreenId===be)?Qe.map(dt=>dt.mediaScreenId===be?{...dt,...Ge,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:dt):[...Array.isArray(Qe)?Qe:[],{...Ge,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ge=>{console.error(`Error fetching media screen data for ${be}:`,Ge)})}else n&&Ef(n,be).then(Ue=>{if(Ue){if(Ue.displayAsVideo&&Ue.videoUrl)js(`Opening video player for: ${Ue.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Ue.videoUrl});else if(Ue.imageUrl){js(`Opening viewer modal with image: ${Ue.imageUrl}`);const Ge=BM(Ue.imageUrl);_e(Ge,Ue.mediaType||"image")}l(Ge=>Array.isArray(Ge)&&Ge.some(tt=>tt.mediaScreenId===be)?Ge.map(tt=>tt.mediaScreenId===be?{...tt,...Ue,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:tt):[...Array.isArray(Ge)?Ge:[],{...Ue,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ue=>{console.error(`Error fetching media screen data for ${be}:`,Ue)})}},[t,v,Ce,He,fe,j,_e,n]);D.useEffect(()=>{if(!J)return;const be=async()=>{if(n)try{const Ue=await s4(n),Ge={};Ue.forEach(Qe=>{Qe.id&&Qe.imageUrl&&(Ge[Qe.id]=Qe.imageUrl)}),l(Qe=>Qe.map(tt=>{const dt=!!Ge[tt.mediaScreenId],Ze=Ge[tt.mediaScreenId],wt=tt.mediaType||"image";return{...tt,hasImage:dt,imageUrl:Ze,mediaType:wt}}))}catch(Ue){console.error("Error fetching media screen images:",Ue)}};be();let Ae=null;return t&&(Ae=setInterval(be,5e3)),()=>{Ae&&clearInterval(Ae)}},[n,t,N,J]);const Ne=be=>{l(Ae=>Ae.map(Ue=>{if(Ue.mediaScreenId===be.mediaScreenId){if(be.type==="upload")return{...Ue,hasImage:!0,imageUrl:be.imageUrl,mediaType:be.mediaType||"image"};if(be.type==="delete")return{...Ue,hasImage:!1,imageUrl:null,mediaType:null}}return Ue})),be.type==="delete"?(setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==be.mediaScreenId))},100),setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==be.mediaScreenId))},1500)):setTimeout(()=>{l(Ae=>Ae.some(Ge=>Ge.mediaScreenId===be.mediaScreenId)?Ae.map(Ge=>Ge.mediaScreenId===be.mediaScreenId?{...Ge,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image"}:Ge):[...Ae,{mediaScreenId:be.mediaScreenId,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};D.useEffect(()=>{const be=Ae=>{const Ue=Ae.detail.enabled;s(Ue),Ue?j("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):j("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",be),()=>{window.removeEventListener("editModeChanged",be)}},[j]),D.useEffect(()=>(window.JsSendMediaScreenClick=function(be){console.log("Unity: MediaScreenClick received with data:",be);try{const Ae=JSON.parse(be),Ue=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ae)});window.dispatchEvent(Ue)}catch(Ae){console.error("Error processing MediaScreenClick data:",Ae)}},window.handleMediaScreenClick=function(be){console.log("Direct call to handleMediaScreenClick with ID:",be),ve(be)},window.TestJavaScriptFromUnity=function(be){console.log("Unity called TestJavaScriptFromUnity with:",be),alert("Unity called JavaScript: "+be)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[ve]),D.useEffect(()=>{const be=Ge=>{try{const Qe=JSON.parse(Ge.detail);he.log(`MediaScreen registered: ${Qe.mediaScreenId}`),js("MediaScreen registered from Unity:",Qe),l(dt=>dt.some(wt=>wt.mediaScreenId===Qe.mediaScreenId)?dt.map(wt=>wt.mediaScreenId===Qe.mediaScreenId?{...wt,...Qe,source:"event",lastUpdated:new Date().toISOString()}:wt):[...dt,{...Qe,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:Qe.mediaScreenId,enabled:!0,showUploadIcon:!0});const tt=Qe.mediaScreenId;tt&&Ef(n,tt).then(dt=>{dt&&(js(`Media screen data for ${tt}:`,dt),dt.displayAsVideo&&dt.videoUrl&&(js(`Media screen ${tt} should display as video, sending null imageUrl`),j("SetMediaScreenImage",{mediaScreenId:tt,imageUrl:null,displayAsVideo:!0})))}).catch(dt=>{console.error(`Error fetching media screen data for ${tt}:`,dt)})}catch(Qe){console.error("Error handling MediaScreen registration:",Qe)}},Ae=Ge=>{try{js("MediaScreenClick event received:",Ge);let Qe;if(typeof Ge=="string")Qe=Ge,js("MediaScreenClick: Direct call with ID:",Qe);else{js("MediaScreenClick: Event from Unity:",Ge),js("MediaScreenClick: Event detail:",Ge.detail);try{Qe=JSON.parse(Ge.detail).mediaScreenId,js("MediaScreenClick: Parsed mediaScreenId:",Qe)}catch(tt){if(console.error("MediaScreenClick: Error parsing event detail:",tt),Ge.detail&&Ge.detail.mediaScreenId)Qe=Ge.detail.mediaScreenId,js("MediaScreenClick: Using direct mediaScreenId from detail:",Qe);else throw new Error("Could not extract mediaScreenId from event")}}he.log(`MediaScreen clicked: ${Qe}`),js("MediaScreen clicked:",Qe),ve(Qe)}catch(Qe){console.error("Error handling MediaScreen click:",Qe)}},Ue=Ge=>{if(Ge.detail&&Ge.detail.eventName==="RegisterMediaScreen")be({detail:Ge.detail.eventData});else if(Ge.detail&&Ge.detail.eventName==="MediaScreenClick")Ae({detail:Ge.detail.eventData});else if(Ge.detail&&Ge.detail.eventName==="SetMediaScreenImage")try{const Qe=JSON.parse(Ge.detail.eventData);Qe.mediaScreenId&&(js("SetMediaScreenImage event received:",Qe),l(tt=>Array.isArray(tt)&&tt.some(Ze=>Ze.mediaScreenId===Qe.mediaScreenId)?tt.map(Ze=>Ze.mediaScreenId===Qe.mediaScreenId?{...Ze,imageUrl:Qe.imageUrl,hasImage:!!Qe.imageUrl,displayAsVideo:Qe.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:Ze):[...Array.isArray(tt)?tt:[],{mediaScreenId:Qe.mediaScreenId,imageUrl:Qe.imageUrl,hasImage:!!Qe.imageUrl,displayAsVideo:Qe.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(Qe){console.error("Error handling SetMediaScreenImage event:",Qe)}};return window.addEventListener("RegisterMediaScreen",be),window.addEventListener("MediaScreenClick",Ae),window.addEventListener("reactUnityEvent",Ue),()=>{window.removeEventListener("RegisterMediaScreen",be),window.removeEventListener("MediaScreenClick",Ae),window.removeEventListener("reactUnityEvent",Ue)}},[t,v,j,a,te,He,_e,ve,n]),D.useEffect(()=>{const be=Ae=>{try{js("Direct MediaScreenClick event received:",Ae);let Ue;if(Ae.detail)try{Ue=JSON.parse(Ae.detail).mediaScreenId}catch(Ge){console.error("Error parsing MediaScreenClick event detail:",Ge);return}if(!Ue){console.error("No mediaScreenId found in MediaScreenClick event");return}js(`Direct handler: Processing click for media screen ${Ue}`),ve(Ue)}catch(Ue){console.error("Error in direct MediaScreenClick handler:",Ue)}};return window.addEventListener("MediaScreenClick",be),()=>{window.removeEventListener("MediaScreenClick",be)}},[ve]),D.useEffect(()=>{se&&nt()},[se,nt]);const Te=()=>{ue(),we()};return D.useEffect(()=>{const Ae=H("RegisterMediaScreen",Ue=>{try{if(he.log("Direct RegisterMediaScreen event received with data:",Ue),!Ue||!Ue.mediaScreenId){he.warn("RegisterMediaScreen event received with invalid data");return}const Ge=Ue.mediaScreenId;he.log(`Media screen registered directly: ${Ge}`),l(Qe=>Qe.some(dt=>dt.mediaScreenId===Ge)?Qe.map(dt=>dt.mediaScreenId===Ge?{...dt,...Ue,source:"direct-event",lastUpdated:new Date().toISOString()}:dt):[...Qe,{...Ue,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:Ge,enabled:!0,showUploadIcon:!0})}catch(Ge){console.error("Error handling direct RegisterMediaScreen event:",Ge)}});return()=>{Ae()}},[H,t,j]),D.useEffect(()=>{const Ae=H("MediaScreenClick",Ue=>{try{if(he.log("Direct MediaScreenClick event received with data:",Ue),!Ue||!Ue.mediaScreenId){he.warn("MediaScreenClick event received with invalid data");return}const Ge=Ue.mediaScreenId;he.log(`Media screen clicked directly: ${Ge}`),ve(Ge)}catch(Ge){console.error("Error handling direct MediaScreenClick event:",Ge)}});return()=>{Ae()}},[H,ve]),D.useEffect(()=>{t&&fe&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${fe}`),f(fe),v(),ue())},[t,fe,v,ue]),C.jsxs(C.Fragment,{children:[C.jsx(c8e,{isOpen:E,onClose:b,mediaScreenId:d,onImageChange:Ne}),C.jsx(f8e,{}),C.jsx(Nu,{containerRef:B,children:C.jsxs(ca,{isOpen:te,onClose:ne,size:"lg",isCentered:!0,portalProps:{containerRef:B},id:"image-viewer-modal",blockScrollOnMount:!0,children:[C.jsx(da,{bg:"rgba(0, 0, 0, 0.8)",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q}),C.jsxs(la,{ref:ee,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:[C.jsx(Ha,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),C.jsx(ua,{p:0,width:"100%",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:ce?C.jsx(It,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:oe==="image"?C.jsx(Fh,{src:ce,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",ce),onError:be=>console.error("Error loading image:",be,ce),onClick:Q}):C.jsxs(It,{width:"100%",textAlign:"center",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:[C.jsx(ht,{mb:4,fontSize:"lg",children:"Video URL:"}),C.jsx(ht,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:ce}),C.jsx(ht,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):C.jsx(zs,{direction:"column",align:"center",justify:"center",h:"400px",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:C.jsx(ht,{children:"No image available"})})})]})]})}),C.jsx(h8e,{videoUrl:se,videoTitle:pe,mediaScreenId:fe,isOpen:He,onClose:Te})]})},Fse=({backgroundUrl:n=null,containerRef:t})=>{const[s,a]=D.useState(!1),[l,d]=D.useState(n),f=D.useRef(null),E=D.useRef(null);return D.useEffect(()=>{const v=b=>{const{backgroundUrl:w}=b.detail;d(w),f.current&&(w?(f.current.style.backgroundImage=`url('${w}')`,f.current.style.display="block",E.current&&(E.current.style.display="block")):(f.current.style.display="none",E.current&&(E.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",v),()=>{window.removeEventListener("SpaceBackgroundUpdated",v)}},[]),D.useEffect(()=>{d(n),f.current&&n!==l&&(f.current.style.backgroundImage=`url('${n}')`)},[n]),D.useEffect(()=>{if(!t||!t.current)return;const v=document.createElement("div");f.current=v,Object.assign(v.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const b=document.createElement("div");E.current=b,Object.assign(b.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),t.current.appendChild(v),t.current.appendChild(b);const w=()=>{console.log("PersistentBackground: Player instantiated event received"),a(!0),v.style.opacity="0",b.style.opacity="0",setTimeout(()=>{t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(b)&&t.current.removeChild(b)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),w();else{Ad.subscribe(Id.playerInstantiated,w);const A=()=>w();window.addEventListener("PlayerInstantiated",A);const N=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),w()},3e4);return()=>{Ad.unsubscribe(Id.playerInstantiated,w),window.removeEventListener("PlayerInstantiated",A),clearTimeout(N),t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(b)&&t.current.removeChild(b)}}},[l,t]),null};Fse.propTypes={backgroundUrl:Lr.string,containerRef:Lr.shape({current:Lr.instanceOf(Element)})};const jse=({containerRef:n})=>{const{spaceID:t}=Ka(),[s,a]=D.useState(!1),[l,d]=D.useState(!1),[f,E]=D.useState(0),[v,b]=D.useState("Initialising World"),[w,A]=D.useState(null),N=D.useRef(null),V=D.useRef(null),j=D.useRef(null),B=D.useRef(null);D.useEffect(()=>(he.log("PersistentLoader: Component mounted with spaceID:",t),he.log("PersistentLoader: Container ref:",n),()=>{he.log("PersistentLoader: Component unmounting")}),[]);const{error:H}=Ka(),[J,$]=D.useState(!1);return D.useEffect(()=>{H&&(he.error("PersistentLoader: Unity error detected:",H),$(!0),setTimeout(()=>{if(N.current){const te=N.current.querySelector("div:first-child");te&&(te.textContent="Reconnecting...")}},3e3))},[H]),D.useEffect(()=>{(async()=>{if(t){he.log(`PersistentLoader: Fetching logo for space ${t}`);try{const ce=await hg(t);ce&&ce.logoUrl?(he.log(`PersistentLoader: Found logo URL: ${ce.logoUrl}`),A(ce.logoUrl)):he.log(`PersistentLoader: No logo URL found for space ${t}`)}catch(ce){he.error("PersistentLoader: Error fetching space logo:",ce)}}else he.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[t]),D.useEffect(()=>{const te=ce=>{const{logoUrl:oe}=ce.detail;he.log(`PersistentLoader: Logo update event received with URL: ${oe}`),A(oe),V.current?oe?(he.log("PersistentLoader: Updating logo element with new URL"),V.current.src=oe,j.current.style.display="flex"):(he.log("PersistentLoader: Hiding logo element (no URL)"),j.current.style.display="none"):he.warn("PersistentLoader: Logo ref is null during update")};return he.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",te),()=>{he.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",te)}},[]),D.useEffect(()=>{if(!n||!n.current){he.error("PersistentLoader: Container ref is null or has no current property");return}he.log("PersistentLoader: Creating loader elements");const te=document.createElement("div");if(N.current=te,Object.assign(te.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% + 50px))",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"8px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.7)"}),w){he.log(`PersistentLoader: Creating logo element with URL: ${w}`);const He=document.createElement("div");j.current=He,Object.assign(He.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% - 40px))",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px"});const nt=document.createElement("img");V.current=nt,nt.src=w,nt.alt="Space Logo",nt.style.maxHeight="100px",nt.style.maxWidth="100%",nt.style.objectFit="contain",nt.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",He.appendChild(nt),n.current.appendChild(He),he.log("PersistentLoader: Logo container added to main container")}else he.log("PersistentLoader: No logo URL available, skipping logo creation");const ce=document.createElement("style");ce.textContent=`
      @keyframes progress-pulse {
        0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
      }
      
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(ce),he.log("PersistentLoader: Animation styles added to document head");const oe=document.createElement("div");oe.style.fontSize="16px",oe.style.fontWeight="bold",oe.style.textAlign="center",oe.style.marginBottom="16px",oe.style.color="#ffffff",oe.textContent="Initialising World";const _e=document.createElement("div");_e.style.width="100%",_e.style.height="12px",_e.style.backgroundColor="rgba(255, 255, 255, 0.2)",_e.style.borderRadius="6px",_e.style.overflow="hidden",_e.style.position="relative",_e.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5) inset";const ne=document.createElement("div");ne.style.height="100%",ne.style.width="0%",ne.style.background="linear-gradient(90deg, #4facfe 0%, #00f2fe 100%)",ne.style.backgroundSize="200% 200%",ne.style.animation="progress-glow 2s ease infinite",ne.style.transition="width 0.5s ease-out",ne.style.borderRadius="6px",ne.style.boxShadow="0 0 10px rgba(255, 255, 255, 0.5)",_e.appendChild(ne);const ee=document.createElement("div");ee.style.marginTop="8px",ee.style.fontSize="14px",ee.style.fontWeight="bold",ee.style.color="#ffffff",ee.textContent="0%",te.appendChild(oe),te.appendChild(_e),te.appendChild(ee),n.current.appendChild(te),he.log("PersistentLoader: Loader element added to container");const Q=He=>{E(He),ne.style.width=`${Math.round(He*100)}%`,ee.textContent=`${Math.round(He*100)}%`,he.log(`PersistentLoader: Progress updated to ${Math.round(He*100)}%`)},se=He=>{b(He),oe.textContent=He,he.log(`PersistentLoader: Loading stage updated to "${He}"`)},pe=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];J&&(pe[0].stage="Connecting to Space",pe[1].stage="Reconnecting...",pe[2].stage="Please Wait"),se(pe[0].stage),Q(.05);const fe=He=>{const nt=He.detail.progress;he.log(`PersistentLoader: Progress event received with value: ${nt}`),Q(nt),nt<.33?se(pe[0].stage):nt<.66?se(pe[1].stage):se(pe[2].stage)},ue=()=>{he.log("PersistentLoader: First scene loaded event received"),a(!0),se(pe[1].stage),Q(.66)},Me=()=>{if(he.log("PersistentLoader: Player instantiated event received"),B.current&&(clearInterval(B.current),he.log("PersistentLoader: Progress interval cleared")),d(!0),se(pe[2].stage),Q(1),J){he.log("PersistentLoader: Keeping loader visible due to Unity error");return}te.style.opacity="0",j.current&&(j.current.style.opacity="0"),setTimeout(()=>{n.current&&n.current.contains(te)?(n.current.removeChild(te),he.log("PersistentLoader: Loader element removed after fade")):he.warn("PersistentLoader: Could not remove loader element (not found in container)"),j.current&&n.current&&n.current.contains(j.current)?(n.current.removeChild(j.current),he.log("PersistentLoader: Logo container removed after fade")):j.current&&he.warn("PersistentLoader: Could not remove logo container (not found in container)")},1500)};if(window.isPlayerInstantiated)he.log("PersistentLoader: Player was already instantiated"),Me();else{he.log("PersistentLoader: Subscribing to playerInstantiated event"),Ad.subscribe(Id.playerInstantiated,Me);const He=()=>Me();he.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",He),he.log("PersistentLoader: Adding firstSceneLoaded event listener"),Ad.subscribe(Id.firstSceneLoaded,ue),he.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",fe),B.current=setInterval(()=>{l||E(we=>{const Ce=Math.min(we+.01,.95);return ne.style.width=`${Math.round(Ce*100)}%`,ee.textContent=`${Math.round(Ce*100)}%`,Ce<.33&&v!==pe[0].stage?se(pe[0].stage):Ce>=.33&&Ce<.66&&v!==pe[1].stage?se(pe[1].stage):Ce>=.66&&v!==pe[2].stage&&se(pe[2].stage),Ce})},500);const nt=setTimeout(()=>{he.log("PersistentLoader: Forcing loader removal after timeout"),Me()},6e4);return()=>{he.log("PersistentLoader: Cleaning up event listeners"),Ad.unsubscribe(Id.playerInstantiated,Me),window.removeEventListener("PlayerInstantiated",He),Ad.unsubscribe(Id.firstSceneLoaded,ue),window.removeEventListener("UnityProgress",fe),clearInterval(B.current),clearTimeout(nt),n.current&&n.current.contains(te)&&(n.current.removeChild(te),he.log("PersistentLoader: Loader element removed during cleanup")),j.current&&n.current&&n.current.contains(j.current)&&(n.current.removeChild(j.current),he.log("PersistentLoader: Logo container removed during cleanup"))}}},[w,n]),null};jse.propTypes={containerRef:Lr.shape({current:Lr.instanceOf(Element)})};const S0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,h4=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],t=a=>{if(n.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=a.target.closest("canvas")||a.target.closest("#webgl-root"),E=document.activeElement===d;!l&&(f||E)&&a.preventDefault()}},s=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",t),document.addEventListener("click",s),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",t),document.removeEventListener("click",s)}},Bse=()=>{document.body.classList.remove("unity-focused")};function Wk(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?h4():Bse(),new Promise(t=>{try{const s=S0();if(s){try{n?s.SendMessage("WebGLInput","EnableKeyboardCapture"):s.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),t(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{s.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),t(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(s.Module){!n&&s.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=s.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(s.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(s.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),t(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),RV(n)),t(!1)}catch(s){console.error("Error setting Unity keyboard capture:",s),t(!1)}})}function RV(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const t=20;let s=0;const a=()=>{s++;const l=S0();if(l){console.log(`Unity instance found after ${s} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Failed to apply pending keyboard state with fallback method",f)}}}else if(s<t){const d=Math.min(500*Math.pow(1.2,s),5e3);console.log(`Unity instance not found (attempt ${s}/${t}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(a,d)}else console.warn(`Unity instance still not found after ${t} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function g8e(){const n=S0();if(!n)return!1;const t=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(t&&document.activeElement===t||n.Module&&n.Module.WebGLInputHandler)}function gS(n=!0){return console.log("Focusing Unity canvas"),n?h4():Bse(),new Promise(t=>{try{const s=document.querySelector("canvas")||document.getElementById("unity-canvas");if(s){try{s.focus({preventScroll:!0})}catch{s.focus()}if(s.style.pointerEvents="auto",n){Wk(!0).then(t);return}t(!0)}else console.warn("Unity canvas not found"),t(!1)}catch(s){console.error("Error focusing Unity canvas:",s),t(!1)}})}function NS(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),h4(),new Promise(t=>{try{if(n)Wk(!1).then(s=>{var d;s&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=S0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),t(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const s=S0();s!=null&&s.Module&&window._savedWebGLInputHandler&&(s.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),Wk(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),t(!0)})}}catch(s){console.error("Error in blockUnityKeyboardInput:",s),t(!1)}})}function _8e(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const t=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${t}`);try{t?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${t} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(s){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",s);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",t),console.log(`Applied pending keyboard state: ${t} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(t){console.error("Error applying pending keyboard state:",t)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function E8e(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=Wk,window.focusUnity=gS,window.blockUnityKeyboardInput=NS,window.hasUnityKeyboardFocus=g8e,window.getUnityInstance=S0,window.registerUnityInstance=_8e,document.getElementById("webgl-root")){const n=new MutationObserver(t=>{for(const s of t)if(s.addedNodes.length)for(let a=0;a<s.addedNodes.length;a++){const l=s.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),RV(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),RV(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[s,a]=n.useState(!1);return n.useEffect(()=>(s?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),NS(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),NS(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{s&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),NS(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[s]),[s,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(E8e,0);const y8e=({size:n="md",tooltipPlacement:t="top",className:s="livestream-button"})=>{const[a,l]=D.useState(!1),[d,f]=D.useState(!1),{savedStreamData:E,reloadStreamData:v}=fse(),{spaceID:b}=Ka(),{user:w}=D.useContext(cl),A=Du(),[N,V]=D.useState(!1),j=C$((E==null?void 0:E.rtmpUrl)||""),B=C$((E==null?void 0:E.streamKey)||"");D.useEffect(()=>{if(b){he.log("LiveStreamButton: Forcing reload of stream data"),v();const $=()=>{he.log("LiveStreamButton: Stream settings changed, reloading data"),v()};return window.addEventListener("StreamSettingsChanged",$),()=>{window.removeEventListener("StreamSettingsChanged",$)}}},[b,v]),D.useEffect(()=>{(async()=>{if(!(w!=null&&w.uid)||!b){V(!1);return}try{const te=await W3e(w.uid,"disruptiveAdmin"),ce=await H3e(w,b);V(te||ce)}catch(te){he.error("Error checking user permissions:",te),V(!1)}})()},[w==null?void 0:w.uid,b]),D.useEffect(()=>{he.log("LiveStreamButton: Current streaming data:",{enabled:E==null?void 0:E.enabled,hasRtmpUrl:!!(E!=null&&E.rtmpUrl),hasStreamKey:!!(E!=null&&E.streamKey),hasPermission:N,isPlayerReady:d})},[E,N,d]),D.useEffect(()=>{const $=()=>{he.log("LiveStreamButton: Player instantiated, showing button"),f(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(he.log("LiveStreamButton: Player was already instantiated"),f(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const H=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},J=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!d||!N||(E==null?void 0:E.enabled)!==!0?(he.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!d,noPermission:!N,streamingDisabled:(E==null?void 0:E.enabled)!==!0,enabledValue:E==null?void 0:E.enabled}),null):C.jsxs(C.Fragment,{children:[C.jsx(wf,{label:"Live Stream Info",placement:t,hasArrow:!0,children:C.jsx(Qh,{size:n,borderRadius:"full",bg:"black",icon:C.jsx(R6e,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:s,"data-testid":"livestream-button",cursor:"pointer",onClick:H})}),C.jsxs(ca,{isOpen:a,onClose:J,isCentered:!0,size:"md",children:[C.jsx(da,{backdropFilter:"blur(4px)"}),C.jsxs(la,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[C.jsx(sl,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),C.jsx(Ha,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(ua,{p:4,children:E!=null&&E.rtmpUrl&&(E!=null&&E.streamKey)?C.jsxs(It,{children:[C.jsx(ht,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),C.jsxs(It,{mb:4,children:[C.jsx(ht,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),C.jsx(zs,{children:C.jsxs(GS,{size:"sm",children:[C.jsx(ds,{value:E.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),C.jsx(fk,{children:C.jsx(No,{"aria-label":"Copy RTMP URL",icon:j.hasCopied?C.jsx(yJ,{}):C.jsx(vJ,{}),size:"xs",colorScheme:j.hasCopied?"green":"blue",onClick:()=>{j.onCopy(),A({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),C.jsxs(It,{mb:4,children:[C.jsx(ht,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),C.jsx(zs,{children:C.jsxs(GS,{size:"sm",children:[C.jsx(ds,{value:E.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),C.jsx(fk,{children:C.jsx(No,{"aria-label":"Copy Stream Key",icon:B.hasCopied?C.jsx(yJ,{}):C.jsx(vJ,{}),size:"xs",colorScheme:B.hasCopied?"green":"blue",onClick:()=>{B.onCopy(),A({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):C.jsxs(It,{textAlign:"center",p:4,children:[C.jsx(ht,{color:"white",children:"No stream configuration found for this space."}),C.jsx(ht,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})},v8e="9442a472625f44e7b2c5065b9f9b3988",WM=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),p4=D.forwardRef(({settings:n},t)=>{const{unityProvider:s,isLoaded:a,error:l}=Ka(),d=RBe();IBe();const f=Ff(),E=DBe(d),{user:v}=D.useContext(cl),[b,w]=D.useState(!1),[A,N]=D.useState(window.devicePixelRatio),[V,j]=PBe();pse().find(Ne=>Ne.isLocalPlayer);const[H,J]=D.useState(!0),[$,te]=D.useState(!0),[ce,oe]=D.useState(!1),[_e,ne]=D.useState(!1),[ee,Q]=D.useState(!1);D.useEffect(()=>{ee?(console.log("WebGLRenderer: Modal opened, disabling Unity keyboard capture"),NS(!0)):(console.log("WebGLRenderer: Modal closed, enabling Unity keyboard capture"),a&&!_e&&NS(!1).then(()=>{setTimeout(()=>{gS(!0)},100)}))},[ee,a,_e]);const se=n.spaceID||"default",pe=D.useMemo(()=>{const be=new URLSearchParams(window.location.search).get("sessionId")||se;return console.log("WebGLRenderer: Using session ID:",be),be},[se]),[fe,ue]=D.useState(null);D.useEffect(()=>{v!=null&&v.uid&&Nd(v.uid).then(Ne=>{ue(Ne),console.log("WebGLRenderer: User profile loaded:",(Ne==null?void 0:Ne.Nickname)||"Unknown")}).catch(Ne=>{console.error("Error fetching user profile:",Ne)})},[v==null?void 0:v.uid]),D.useEffect(()=>{if(l||!v){he.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const Ne=setTimeout(()=>{ne(!0),Q(!0)},1e3);return()=>clearTimeout(Ne)}else ne(!1)},[l,v]),D.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const Ne=()=>{console.log("WebGLRenderer: Player instantiated event received"),te(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),te(!0)),Ad.subscribe(Id.playerInstantiated,Ne);const Te=setTimeout(()=>{$||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),te(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Ad.unsubscribe(Id.playerInstantiated,Ne),clearTimeout(Te)}},[$]),D.useEffect(()=>{const Ne=()=>{console.log("WebGLRenderer: Modal opened"),Q(!0)},Te=()=>{console.log("WebGLRenderer: Modal closed"),Q(!1)};return window.addEventListener("modal-opened",Ne),window.addEventListener("modal-closed",Te),()=>{window.removeEventListener("modal-opened",Ne),window.removeEventListener("modal-closed",Te)}},[]),D.useEffect(()=>{Q(V!==null)},[V]),D.useEffect(()=>{a||d?setTimeout(()=>{w(!0),he.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):he.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),D.useEffect(()=>{a&&s&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(Ne){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",Ne)}},1e3)},[a,s]),D.useEffect(()=>{const Ne=document.getElementById("webgl-root");return Ne?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),Ne.style.display="block",Ne.getAttribute("data-space-id")!==se&&(Ne.setAttribute("data-space-id",se),console.log(`WebGLRenderer: Set data-space-id attribute to ${se}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[se]),D.useEffect(()=>{const Ne=()=>{const Ae=WM();Ae?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Ae.tabIndex=1,Ae.style.outline="none",Ae.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ee||gS(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};Ne();const Te=setTimeout(Ne,1e3),be=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),Ne()};return window.addEventListener("unityReady",be),()=>{clearTimeout(Te),window.removeEventListener("unityReady",be)}},[a,ee]);const Me=D.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ee||gS(!0)},[ee]);D.useEffect(()=>{if(a&&s){const Ne=WM();if(Ne)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),Ne.addEventListener("click",Me),()=>{Ne.removeEventListener("click",Me)}}},[a,s,Me]),D.useEffect(()=>{if(a&&s){console.log("WebGLRenderer: Setting up global click handler for focus management");const Ne=Te=>{if(ee){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(Te.target.tagName==="INPUT"||Te.target.tagName==="TEXTAREA"||Te.target.tagName==="SELECT"||Te.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(Te.target.closest(".chakra-modal__content")||Te.target.closest('[role="dialog"]')||Te.target.closest('[role="menu"]')||Te.target.closest(".chakra-popover__content")||Te.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const be=WM();if(be&&(Te.target===be||be.contains(Te.target)))return;if(Te.target.closest(".webgl-overlay")||Te.target.closest(".game-ui")||Te.target.closest(".player-list")||Te.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{ee||gS(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{be&&!ee&&((be.tabIndex===void 0||be.tabIndex<0)&&(be.tabIndex=1),be.focus(),gS(!0))},50)};return document.addEventListener("click",Ne,!0),()=>{document.removeEventListener("click",Ne,!0)}}},[a,s,ee]),D.useEffect(()=>{const Ne=Te=>{he.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",Te)};return Ad.subscribe(Id.sendUserToUnity,Ne),()=>Ad.unsubscribe(Id.sendUserToUnity,Ne)},[f]);const{setFullscreenRef:He,fullscreenRef:nt}=Dd();D.useEffect(()=>{He(t.current)},[t,He]);const we=()=>{J(!H)},Ce=v&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:$,showVoiceChat:Ce,sessionId:pe}),D.useEffect(()=>{const Ne=Te=>{oe(Te.detail.enabled)};return window.addEventListener("editModeChanged",Ne),()=>{window.removeEventListener("editModeChanged",Ne)}},[]),mse(),ABe();const ve=D.useRef(null);return C.jsxs(It,{className:"webgl-renderer",children:[n.urlLoadingBackground&&C.jsx(Fse,{backgroundUrl:n.urlLoadingBackground,containerRef:ve}),!_e&&C.jsx(jse,{containerRef:ve}),_e&&C.jsx(It,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:C.jsx(d4,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),C.jsx($V,{containerRef:nt.current?nt:document.body,children:C.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[C.jsxs(It,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&C.jsx(c6e,{}),v&&C.jsx(y8e,{size:"md"}),Ce&&C.jsxs(xse,{appId:v8e,channel:pe,uid:v==null?void 0:v.uid,enabled:!0,children:[C.jsx(j6e,{size:"md",defaultMuted:!0,joinOnClick:!0}),C.jsx(W6e,{userNickname:fe==null?void 0:fe.Nickname})]}),C.jsx(I6e,{}),C.jsx(It,{position:"relative",zIndex:"9999",children:C.jsx(a8e,{onTogglePlayerList:we,spaceID:se})})]}),C.jsxs(It,{ref:ve,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[C.jsx(It,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),C.jsx(It,{...E,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:s?C.jsx(hse.Unity,{unityProvider:s,style:{width:"100%",height:"100%"},devicePixelRatio:A,tabIndex:1}):C.jsx(It,{width:"100%",height:"100%"})}),C.jsx(It,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:C.jsx(a6e,{})})]}),C.jsx(It,{...E,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&C.jsx(Fh,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),C.jsx(It,{...E,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),C.jsxs(It,{...E,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&C.jsx(l6e,{}),C.jsx(O6e,{})]}),C.jsx(k6e,{}),C.jsx(N6e,{isOpen:V!==null,onClose:()=>{console.log(" Closing nameplate modal"),j()},playerName:(V==null?void 0:V.playerName)||"Unknown Player",playerId:(V==null?void 0:V.playerId)||"Unknown ID"}),C.jsx(D6e,{isVisible:H,onToggleVisibility:J,spaceID:se}),C.jsx(m8e,{})]})})]})});p4.displayName="WebGLRenderer";p4.propTypes={settings:Lr.shape({urlLoadingBackground:Lr.string,showAuthButton:Lr.bool,showDisruptiveLogo:Lr.bool,urlDisruptiveLogo:Lr.string,showHelpButton:Lr.bool,enableVoiceChat:Lr.bool,spaceID:Lr.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:t=>(console.log("HISPlayer: mute called with state:",t),!0),isMuted:!1,seek:t=>(console.log("HISPlayer: seek called with time:",t),!0),setVolume:t=>(console.log("HISPlayer: setVolume called with volume:",t),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:t=>(console.log("HISPlayer: setUnityContext called with:",t),window.hisPlayerContextId=t,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:t=>(console.log("HISPlayer: setProperties called with:",t),!0),setMultiPaths:t=>(console.log("HISPlayer: setMultiPaths called with:",t),window._hisplayer_paths=t,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(he.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),he.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const t=new window.MultipleView;if(t&&t.multiView&&typeof t.multiView.setUnityContext=="function")return t.multiView.setUnityContext(n),window._hisplayer_instance=t,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:a=>(window.hisPlayerContextId=a,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const t=new window.MultipleView;return t.multiView.setUnityContext(n),window._hisplayer_instance=t,!0}}catch(t){console.error("HISPlayer: Error in setUpContext:",t);const s=document.getElementById("hisplayer-error");s&&(s.innerHTML="Error: "+t.message)}return!1}}const Wse=({spaceID:n,overrideSettings:t})=>{const s=D.useRef(null),[a,l]=D.useState(!0),[d,f]=D.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[E,v]=D.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return D.useEffect(()=>{(async()=>{try{const w=await hg(n);if(w){f(V=>({...V,spaceID:n,loaderUrl:w.loaderUrl,dataUrl:w.dataUrl,frameworkUrl:w.frameworkUrl,codeUrl:w.codeUrl}));const A=await JO(E.urlDisruptiveLogo);let N="";if(w.backgroundUrl)N=w.backgroundUrl;else if(w.backgroundGsUrl)try{N=await JO(w.backgroundGsUrl)}catch(V){he.warn("WebGLLoader: Error fetching background from GS URL:",V)}else if(w.gsUrlLoadingBackground)try{N=await JO(w.gsUrlLoadingBackground)}catch(V){he.warn("WebGLLoader: Error fetching background from legacy GS URL:",V)}v(V=>({...V,urlLoadingBackground:N,showAuthButton:w.showAuthButton!==void 0?w.showAuthButton:!0,showDisruptiveLogo:w.showDisruptiveLogo!==void 0?w.showDisruptiveLogo:!0,showHelpButton:w.showHelpButton!==void 0?w.showHelpButton:!0,enableVoiceChat:w.enableVoiceChat!==void 0?w.enableVoiceChat:!0,urlDisruptiveLogo:A,spaceID:n,...t||{}})),l(!1)}else he.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(w){he.error("WebGLLoader: Error fetching space data:",w)}finally{l(!1)}})()},[n,E.urlDisruptiveLogo,t]),D.useEffect(()=>{a||(he.log("WebGLLoader: Unity config from Firebase",d),he.log("WebGLLoader: Space settings from Firebase",E))},[a]),C.jsx(C.Fragment,{children:a?C.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):C.jsx(wBe,{...d,children:C.jsx(p4,{ref:s,settings:E})})})};Wse.propTypes={spaceID:Lr.string.isRequired,overrideSettings:Lr.object};function RJ(){const n=document.getElementById("webgl-root");if(n){const t=n.getAttribute("data-space-id"),s=n.getAttribute("data-theme")||"default",a=()=>{const[l,d]=D.useState(null);return D.useEffect(()=>{O2e(s).then(d)},[]),l?C.jsx(Wke,{theme:l,children:C.jsx(pBe,{children:C.jsx(fBe,{children:C.jsx(Wse,{spaceID:t})})})}):C.jsx("div",{children:"Loading theme..."})};try{O_e.createRoot(n).render(C.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",RJ):RJ());export{H_e as a,_ve as b,xi as c,fve as d,b8e as e,S8e as f,ove as g,Cu as i,Vh as m,mRe as t};
