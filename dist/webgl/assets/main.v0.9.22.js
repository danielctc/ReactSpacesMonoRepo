function hye(n,t){for(var s=0;s<t.length;s++){const a=t[s];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var py=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ng(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var F2={exports:{}},cw={},j2={exports:{}},Er={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W$;function pye(){if(W$)return Er;W$=1;var n=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),f=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),I=Symbol.iterator;function k(Te){return Te===null||typeof Te!="object"?null:(Te=I&&Te[I]||Te["@@iterator"],typeof Te=="function"?Te:null)}var L={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},V=Object.assign,B={};function W(Te,be,Pe){this.props=Te,this.context=be,this.refs=B,this.updater=Pe||L}W.prototype.isReactComponent={},W.prototype.setState=function(Te,be){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,be,"setState")},W.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function Q(){}Q.prototype=W.prototype;function $(Te,be,Pe){this.props=Te,this.context=be,this.refs=B,this.updater=Pe||L}var ie=$.prototype=new Q;ie.constructor=$,V(ie,W.prototype),ie.isPureReactComponent=!0;var ce=Array.isArray,ne=Object.prototype.hasOwnProperty,de={current:null},Y={key:!0,ref:!0,__self:!0,__source:!0};function X(Te,be,Pe){var xe,ze={},Je=null,Ze=null;if(be!=null)for(xe in be.ref!==void 0&&(Ze=be.ref),be.key!==void 0&&(Je=""+be.key),be)ne.call(be,xe)&&!Y.hasOwnProperty(xe)&&(ze[xe]=be[xe]);var lt=arguments.length-2;if(lt===1)ze.children=Pe;else if(1<lt){for(var nt=Array(lt),Rt=0;Rt<lt;Rt++)nt[Rt]=arguments[Rt+2];ze.children=nt}if(Te&&Te.defaultProps)for(xe in lt=Te.defaultProps,lt)ze[xe]===void 0&&(ze[xe]=lt[xe]);return{$$typeof:n,type:Te,key:Je,ref:Ze,props:ze,_owner:de.current}}function Z(Te,be){return{$$typeof:n,type:Te.type,key:be,ref:Te.ref,props:Te.props,_owner:Te._owner}}function se(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===n}function me(Te){var be={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(Pe){return be[Pe]})}var pe=/\/+/g;function ue(Te,be){return typeof Te=="object"&&Te!==null&&Te.key!=null?me(""+Te.key):be.toString(36)}function Le(Te,be,Pe,xe,ze){var Je=typeof Te;(Je==="undefined"||Je==="boolean")&&(Te=null);var Ze=!1;if(Te===null)Ze=!0;else switch(Je){case"string":case"number":Ze=!0;break;case"object":switch(Te.$$typeof){case n:case t:Ze=!0}}if(Ze)return Ze=Te,ze=ze(Ze),Te=xe===""?"."+ue(Ze,0):xe,ce(ze)?(Pe="",Te!=null&&(Pe=Te.replace(pe,"$&/")+"/"),Le(ze,be,Pe,"",function(Rt){return Rt})):ze!=null&&(se(ze)&&(ze=Z(ze,Pe+(!ze.key||Ze&&Ze.key===ze.key?"":(""+ze.key).replace(pe,"$&/")+"/")+Te)),be.push(ze)),1;if(Ze=0,xe=xe===""?".":xe+":",ce(Te))for(var lt=0;lt<Te.length;lt++){Je=Te[lt];var nt=xe+ue(Je,lt);Ze+=Le(Je,be,Pe,nt,ze)}else if(nt=k(Te),typeof nt=="function")for(Te=nt.call(Te),lt=0;!(Je=Te.next()).done;)Je=Je.value,nt=xe+ue(Je,lt++),Ze+=Le(Je,be,Pe,nt,ze);else if(Je==="object")throw be=String(Te),Error("Objects are not valid as a React child (found: "+(be==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":be)+"). If you meant to render a collection of children, use an array instead.");return Ze}function We(Te,be,Pe){if(Te==null)return Te;var xe=[],ze=0;return Le(Te,xe,"","",function(Je){return be.call(Pe,Je,ze++)}),xe}function $e(Te){if(Te._status===-1){var be=Te._result;be=be(),be.then(function(Pe){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=Pe)},function(Pe){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=Pe)}),Te._status===-1&&(Te._status=0,Te._result=be)}if(Te._status===1)return Te._result.default;throw Te._result}var ve={current:null},_e={transition:null},Ee={ReactCurrentDispatcher:ve,ReactCurrentBatchConfig:_e,ReactCurrentOwner:de};function ke(){throw Error("act(...) is not supported in production builds of React.")}return Er.Children={map:We,forEach:function(Te,be,Pe){We(Te,function(){be.apply(this,arguments)},Pe)},count:function(Te){var be=0;return We(Te,function(){be++}),be},toArray:function(Te){return We(Te,function(be){return be})||[]},only:function(Te){if(!se(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}},Er.Component=W,Er.Fragment=s,Er.Profiler=l,Er.PureComponent=$,Er.StrictMode=a,Er.Suspense=v,Er.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ee,Er.act=ke,Er.cloneElement=function(Te,be,Pe){if(Te==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Te+".");var xe=V({},Te.props),ze=Te.key,Je=Te.ref,Ze=Te._owner;if(be!=null){if(be.ref!==void 0&&(Je=be.ref,Ze=de.current),be.key!==void 0&&(ze=""+be.key),Te.type&&Te.type.defaultProps)var lt=Te.type.defaultProps;for(nt in be)ne.call(be,nt)&&!Y.hasOwnProperty(nt)&&(xe[nt]=be[nt]===void 0&&lt!==void 0?lt[nt]:be[nt])}var nt=arguments.length-2;if(nt===1)xe.children=Pe;else if(1<nt){lt=Array(nt);for(var Rt=0;Rt<nt;Rt++)lt[Rt]=arguments[Rt+2];xe.children=lt}return{$$typeof:n,type:Te.type,key:ze,ref:Je,props:xe,_owner:Ze}},Er.createContext=function(Te){return Te={$$typeof:f,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Te.Provider={$$typeof:d,_context:Te},Te.Consumer=Te},Er.createElement=X,Er.createFactory=function(Te){var be=X.bind(null,Te);return be.type=Te,be},Er.createRef=function(){return{current:null}},Er.forwardRef=function(Te){return{$$typeof:y,render:Te}},Er.isValidElement=se,Er.lazy=function(Te){return{$$typeof:w,_payload:{_status:-1,_result:Te},_init:$e}},Er.memo=function(Te,be){return{$$typeof:b,type:Te,compare:be===void 0?null:be}},Er.startTransition=function(Te){var be=_e.transition;_e.transition={};try{Te()}finally{_e.transition=be}},Er.unstable_act=ke,Er.useCallback=function(Te,be){return ve.current.useCallback(Te,be)},Er.useContext=function(Te){return ve.current.useContext(Te)},Er.useDebugValue=function(){},Er.useDeferredValue=function(Te){return ve.current.useDeferredValue(Te)},Er.useEffect=function(Te,be){return ve.current.useEffect(Te,be)},Er.useId=function(){return ve.current.useId()},Er.useImperativeHandle=function(Te,be,Pe){return ve.current.useImperativeHandle(Te,be,Pe)},Er.useInsertionEffect=function(Te,be){return ve.current.useInsertionEffect(Te,be)},Er.useLayoutEffect=function(Te,be){return ve.current.useLayoutEffect(Te,be)},Er.useMemo=function(Te,be){return ve.current.useMemo(Te,be)},Er.useReducer=function(Te,be,Pe){return ve.current.useReducer(Te,be,Pe)},Er.useRef=function(Te){return ve.current.useRef(Te)},Er.useState=function(Te){return ve.current.useState(Te)},Er.useSyncExternalStore=function(Te,be,Pe){return ve.current.useSyncExternalStore(Te,be,Pe)},Er.useTransition=function(){return ve.current.useTransition()},Er.version="18.3.1",Er}var z$;function Mu(){return z$||(z$=1,j2.exports=pye()),j2.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G$;function fye(){if(G$)return cw;G$=1;var n=Mu(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function f(y,v,b){var w,I={},k=null,L=null;b!==void 0&&(k=""+b),v.key!==void 0&&(k=""+v.key),v.ref!==void 0&&(L=v.ref);for(w in v)a.call(v,w)&&!d.hasOwnProperty(w)&&(I[w]=v[w]);if(y&&y.defaultProps)for(w in v=y.defaultProps,v)I[w]===void 0&&(I[w]=v[w]);return{$$typeof:t,type:y,key:k,ref:L,props:I,_owner:l.current}}return cw.Fragment=s,cw.jsx=f,cw.jsxs=f,cw}var H$;function mye(){return H$||(H$=1,F2.exports=fye()),F2.exports}var C=mye(),D=Mu();const di=Ng(D),$$=hye({__proto__:null,default:di},[D]);var eO={},B2={exports:{}},nl={},W2={exports:{}},z2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K$;function gye(){return K$||(K$=1,function(n){function t(_e,Ee){var ke=_e.length;_e.push(Ee);e:for(;0<ke;){var Te=ke-1>>>1,be=_e[Te];if(0<l(be,Ee))_e[Te]=Ee,_e[ke]=be,ke=Te;else break e}}function s(_e){return _e.length===0?null:_e[0]}function a(_e){if(_e.length===0)return null;var Ee=_e[0],ke=_e.pop();if(ke!==Ee){_e[0]=ke;e:for(var Te=0,be=_e.length,Pe=be>>>1;Te<Pe;){var xe=2*(Te+1)-1,ze=_e[xe],Je=xe+1,Ze=_e[Je];if(0>l(ze,ke))Je<be&&0>l(Ze,ze)?(_e[Te]=Ze,_e[Je]=ke,Te=Je):(_e[Te]=ze,_e[xe]=ke,Te=xe);else if(Je<be&&0>l(Ze,ke))_e[Te]=Ze,_e[Je]=ke,Te=Je;else break e}}return Ee}function l(_e,Ee){var ke=_e.sortIndex-Ee.sortIndex;return ke!==0?ke:_e.id-Ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var f=Date,y=f.now();n.unstable_now=function(){return f.now()-y}}var v=[],b=[],w=1,I=null,k=3,L=!1,V=!1,B=!1,W=typeof setTimeout=="function"?setTimeout:null,Q=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ie(_e){for(var Ee=s(b);Ee!==null;){if(Ee.callback===null)a(b);else if(Ee.startTime<=_e)a(b),Ee.sortIndex=Ee.expirationTime,t(v,Ee);else break;Ee=s(b)}}function ce(_e){if(B=!1,ie(_e),!V)if(s(v)!==null)V=!0,$e(ne);else{var Ee=s(b);Ee!==null&&ve(ce,Ee.startTime-_e)}}function ne(_e,Ee){V=!1,B&&(B=!1,Q(X),X=-1),L=!0;var ke=k;try{for(ie(Ee),I=s(v);I!==null&&(!(I.expirationTime>Ee)||_e&&!me());){var Te=I.callback;if(typeof Te=="function"){I.callback=null,k=I.priorityLevel;var be=Te(I.expirationTime<=Ee);Ee=n.unstable_now(),typeof be=="function"?I.callback=be:I===s(v)&&a(v),ie(Ee)}else a(v);I=s(v)}if(I!==null)var Pe=!0;else{var xe=s(b);xe!==null&&ve(ce,xe.startTime-Ee),Pe=!1}return Pe}finally{I=null,k=ke,L=!1}}var de=!1,Y=null,X=-1,Z=5,se=-1;function me(){return!(n.unstable_now()-se<Z)}function pe(){if(Y!==null){var _e=n.unstable_now();se=_e;var Ee=!0;try{Ee=Y(!0,_e)}finally{Ee?ue():(de=!1,Y=null)}}else de=!1}var ue;if(typeof $=="function")ue=function(){$(pe)};else if(typeof MessageChannel<"u"){var Le=new MessageChannel,We=Le.port2;Le.port1.onmessage=pe,ue=function(){We.postMessage(null)}}else ue=function(){W(pe,0)};function $e(_e){Y=_e,de||(de=!0,ue())}function ve(_e,Ee){X=W(function(){_e(n.unstable_now())},Ee)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(_e){_e.callback=null},n.unstable_continueExecution=function(){V||L||(V=!0,$e(ne))},n.unstable_forceFrameRate=function(_e){0>_e||125<_e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Z=0<_e?Math.floor(1e3/_e):5},n.unstable_getCurrentPriorityLevel=function(){return k},n.unstable_getFirstCallbackNode=function(){return s(v)},n.unstable_next=function(_e){switch(k){case 1:case 2:case 3:var Ee=3;break;default:Ee=k}var ke=k;k=Ee;try{return _e()}finally{k=ke}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(_e,Ee){switch(_e){case 1:case 2:case 3:case 4:case 5:break;default:_e=3}var ke=k;k=_e;try{return Ee()}finally{k=ke}},n.unstable_scheduleCallback=function(_e,Ee,ke){var Te=n.unstable_now();switch(typeof ke=="object"&&ke!==null?(ke=ke.delay,ke=typeof ke=="number"&&0<ke?Te+ke:Te):ke=Te,_e){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=ke+be,_e={id:w++,callback:Ee,priorityLevel:_e,startTime:ke,expirationTime:be,sortIndex:-1},ke>Te?(_e.sortIndex=ke,t(b,_e),s(v)===null&&_e===s(b)&&(B?(Q(X),X=-1):B=!0,ve(ce,ke-Te))):(_e.sortIndex=be,t(v,_e),V||L||(V=!0,$e(ne))),_e},n.unstable_shouldYield=me,n.unstable_wrapCallback=function(_e){var Ee=k;return function(){var ke=k;k=Ee;try{return _e.apply(this,arguments)}finally{k=ke}}}}(z2)),z2}var q$;function _ye(){return q$||(q$=1,W2.exports=gye()),W2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y$;function yye(){if(Y$)return nl;Y$=1;var n=Mu(),t=_ye();function s(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,T=1;T<arguments.length;T++)g+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)a.add(g[p])}var y=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w={},I={};function k(p){return v.call(I,p)?!0:v.call(w,p)?!1:b.test(p)?I[p]=!0:(w[p]=!0,!1)}function L(p,g,T,O){if(T!==null&&T.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return O?!1:T!==null?!T.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function V(p,g,T,O){if(g===null||typeof g>"u"||L(p,g,T,O))return!0;if(O)return!1;if(T!==null)switch(T.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function B(p,g,T,O,U,H,le){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=O,this.attributeNamespace=U,this.mustUseProperty=T,this.propertyName=p,this.type=g,this.sanitizeURL=H,this.removeEmptyString=le}var W={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){W[p]=new B(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];W[g]=new B(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){W[p]=new B(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){W[p]=new B(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){W[p]=new B(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){W[p]=new B(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){W[p]=new B(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){W[p]=new B(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){W[p]=new B(p,5,!1,p.toLowerCase(),null,!1,!1)});var Q=/[\-:]([a-z])/g;function $(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(Q,$);W[g]=new B(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(Q,$);W[g]=new B(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(Q,$);W[g]=new B(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){W[p]=new B(p,1,!1,p.toLowerCase(),null,!1,!1)}),W.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){W[p]=new B(p,1,!1,p.toLowerCase(),null,!0,!0)});function ie(p,g,T,O){var U=W.hasOwnProperty(g)?W[g]:null;(U!==null?U.type!==0:O||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(V(g,T,U,O)&&(T=null),O||U===null?k(g)&&(T===null?p.removeAttribute(g):p.setAttribute(g,""+T)):U.mustUseProperty?p[U.propertyName]=T===null?U.type===3?!1:"":T:(g=U.attributeName,O=U.attributeNamespace,T===null?p.removeAttribute(g):(U=U.type,T=U===3||U===4&&T===!0?"":""+T,O?p.setAttributeNS(O,g,T):p.setAttribute(g,T))))}var ce=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ne=Symbol.for("react.element"),de=Symbol.for("react.portal"),Y=Symbol.for("react.fragment"),X=Symbol.for("react.strict_mode"),Z=Symbol.for("react.profiler"),se=Symbol.for("react.provider"),me=Symbol.for("react.context"),pe=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),Le=Symbol.for("react.suspense_list"),We=Symbol.for("react.memo"),$e=Symbol.for("react.lazy"),ve=Symbol.for("react.offscreen"),_e=Symbol.iterator;function Ee(p){return p===null||typeof p!="object"?null:(p=_e&&p[_e]||p["@@iterator"],typeof p=="function"?p:null)}var ke=Object.assign,Te;function be(p){if(Te===void 0)try{throw Error()}catch(T){var g=T.stack.trim().match(/\n( *(at )?)/);Te=g&&g[1]||""}return`
`+Te+p}var Pe=!1;function xe(p,g){if(!p||Pe)return"";Pe=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(rt){var O=rt}Reflect.construct(p,[],g)}else{try{g.call()}catch(rt){O=rt}p.call(g.prototype)}else{try{throw Error()}catch(rt){O=rt}p()}}catch(rt){if(rt&&O&&typeof rt.stack=="string"){for(var U=rt.stack.split(`
`),H=O.stack.split(`
`),le=U.length-1,Ie=H.length-1;1<=le&&0<=Ie&&U[le]!==H[Ie];)Ie--;for(;1<=le&&0<=Ie;le--,Ie--)if(U[le]!==H[Ie]){if(le!==1||Ie!==1)do if(le--,Ie--,0>Ie||U[le]!==H[Ie]){var Ue=`
`+U[le].replace(" at new "," at ");return p.displayName&&Ue.includes("<anonymous>")&&(Ue=Ue.replace("<anonymous>",p.displayName)),Ue}while(1<=le&&0<=Ie);break}}}finally{Pe=!1,Error.prepareStackTrace=T}return(p=p?p.displayName||p.name:"")?be(p):""}function ze(p){switch(p.tag){case 5:return be(p.type);case 16:return be("Lazy");case 13:return be("Suspense");case 19:return be("SuspenseList");case 0:case 2:case 15:return p=xe(p.type,!1),p;case 11:return p=xe(p.type.render,!1),p;case 1:return p=xe(p.type,!0),p;default:return""}}function Je(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case Y:return"Fragment";case de:return"Portal";case Z:return"Profiler";case X:return"StrictMode";case ue:return"Suspense";case Le:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case me:return(p.displayName||"Context")+".Consumer";case se:return(p._context.displayName||"Context")+".Provider";case pe:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case We:return g=p.displayName||null,g!==null?g:Je(p.type)||"Memo";case $e:g=p._payload,p=p._init;try{return Je(p(g))}catch{}}return null}function Ze(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Je(g);case 8:return g===X?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function lt(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function nt(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Rt(p){var g=nt(p)?"checked":"value",T=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),O=""+p[g];if(!p.hasOwnProperty(g)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var U=T.get,H=T.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return U.call(this)},set:function(le){O=""+le,H.call(this,le)}}),Object.defineProperty(p,g,{enumerable:T.enumerable}),{getValue:function(){return O},setValue:function(le){O=""+le},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function fn(p){p._valueTracker||(p._valueTracker=Rt(p))}function Ft(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var T=g.getValue(),O="";return p&&(O=nt(p)?p.checked?"true":"false":p.value),p=O,p!==T?(g.setValue(p),!0):!1}function on(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function Zt(p,g){var T=g.checked;return ke({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??p._wrapperState.initialChecked})}function Yt(p,g){var T=g.defaultValue==null?"":g.defaultValue,O=g.checked!=null?g.checked:g.defaultChecked;T=lt(g.value!=null?g.value:T),p._wrapperState={initialChecked:O,initialValue:T,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Vn(p,g){g=g.checked,g!=null&&ie(p,"checked",g,!1)}function $t(p,g){Vn(p,g);var T=lt(g.value),O=g.type;if(T!=null)O==="number"?(T===0&&p.value===""||p.value!=T)&&(p.value=""+T):p.value!==""+T&&(p.value=""+T);else if(O==="submit"||O==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?Ve(p,g.type,T):g.hasOwnProperty("defaultValue")&&Ve(p,g.type,lt(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function Re(p,g,T){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var O=g.type;if(!(O!=="submit"&&O!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,T||g===p.value||(p.value=g),p.defaultValue=g}T=p.name,T!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,T!==""&&(p.name=T)}function Ve(p,g,T){(g!=="number"||on(p.ownerDocument)!==p)&&(T==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+T&&(p.defaultValue=""+T))}var Ge=Array.isArray;function ht(p,g,T,O){if(p=p.options,g){g={};for(var U=0;U<T.length;U++)g["$"+T[U]]=!0;for(T=0;T<p.length;T++)U=g.hasOwnProperty("$"+p[T].value),p[T].selected!==U&&(p[T].selected=U),U&&O&&(p[T].defaultSelected=!0)}else{for(T=""+lt(T),g=null,U=0;U<p.length;U++){if(p[U].value===T){p[U].selected=!0,O&&(p[U].defaultSelected=!0);return}g!==null||p[U].disabled||(g=p[U])}g!==null&&(g.selected=!0)}}function mt(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(s(91));return ke({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function vt(p,g){var T=g.value;if(T==null){if(T=g.children,g=g.defaultValue,T!=null){if(g!=null)throw Error(s(92));if(Ge(T)){if(1<T.length)throw Error(s(93));T=T[0]}g=T}g==null&&(g=""),T=g}p._wrapperState={initialValue:lt(T)}}function Bt(p,g){var T=lt(g.value),O=lt(g.defaultValue);T!=null&&(T=""+T,T!==p.value&&(p.value=T),g.defaultValue==null&&p.defaultValue!==T&&(p.defaultValue=T)),O!=null&&(p.defaultValue=""+O)}function mn(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function En(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function en(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?En(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Et,nr=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,T,O,U){MSApp.execUnsafeLocalFunction(function(){return p(g,T,O,U)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(Et=Et||document.createElement("div"),Et.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Et.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function Nt(p,g){if(g){var T=p.firstChild;if(T&&T===p.lastChild&&T.nodeType===3){T.nodeValue=g;return}}p.textContent=g}var Ut={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},gn=["Webkit","ms","Moz","O"];Object.keys(Ut).forEach(function(p){gn.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),Ut[g]=Ut[p]})});function ki(p,g,T){return g==null||typeof g=="boolean"||g===""?"":T||typeof g!="number"||g===0||Ut.hasOwnProperty(p)&&Ut[p]?(""+g).trim():g+"px"}function _s(p,g){p=p.style;for(var T in g)if(g.hasOwnProperty(T)){var O=T.indexOf("--")===0,U=ki(T,g[T],O);T==="float"&&(T="cssFloat"),O?p.setProperty(T,U):p[T]=U}}var ii=ke({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ho(p,g){if(g){if(ii[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(s(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(s(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(s(61))}if(g.style!=null&&typeof g.style!="object")throw Error(s(62))}}function ec(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ks=null;function qs(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var Rc=null,ys=null,Ca=null;function To(p){if(p=um(p)){if(typeof Rc!="function")throw Error(s(280));var g=p.stateNode;g&&(g=dm(g),Rc(p.stateNode,p.type,g))}}function Ra(p){ys?Ca?Ca.push(p):Ca=[p]:ys=p}function tc(){if(ys){var p=ys,g=Ca;if(Ca=ys=null,To(p),g)for(p=0;p<g.length;p++)To(g[p])}}function pl(p,g){return p(g)}function Ia(){}var nc=!1;function io(p,g,T){if(nc)return p(g,T);nc=!0;try{return pl(p,g,T)}finally{nc=!1,(ys!==null||Ca!==null)&&(Ia(),tc())}}function Ni(p,g){var T=p.stateNode;if(T===null)return null;var O=dm(T);if(O===null)return null;T=O[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(p=p.type,O=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!O;break e;default:p=!1}if(p)return null;if(T&&typeof T!="function")throw Error(s(231,g,typeof T));return T}var gt=!1;if(y)try{var dn={};Object.defineProperty(dn,"passive",{get:function(){gt=!0}}),window.addEventListener("test",dn,dn),window.removeEventListener("test",dn,dn)}catch{gt=!1}function gr(p,g,T,O,U,H,le,Ie,Ue){var rt=Array.prototype.slice.call(arguments,3);try{g.apply(T,rt)}catch(Ot){this.onError(Ot)}}var fi=!1,wo=null,so=!1,Hl=null,pp={onError:function(p){fi=!0,wo=p}};function fl(p,g,T,O,U,H,le,Ie,Ue){fi=!1,wo=null,gr.apply(pp,arguments)}function $l(p,g,T,O,U,H,le,Ie,Ue){if(fl.apply(this,arguments),fi){if(fi){var rt=wo;fi=!1,wo=null}else throw Error(s(198));so||(so=!0,Hl=rt)}}function bi(p){var g=p,T=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(T=g.return),p=g.return;while(p)}return g.tag===3?T:null}function oo(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function Fi(p){if(bi(p)!==p)throw Error(s(188))}function Fd(p){var g=p.alternate;if(!g){if(g=bi(p),g===null)throw Error(s(188));return g!==p?null:p}for(var T=p,O=g;;){var U=T.return;if(U===null)break;var H=U.alternate;if(H===null){if(O=U.return,O!==null){T=O;continue}break}if(U.child===H.child){for(H=U.child;H;){if(H===T)return Fi(U),p;if(H===O)return Fi(U),g;H=H.sibling}throw Error(s(188))}if(T.return!==O.return)T=U,O=H;else{for(var le=!1,Ie=U.child;Ie;){if(Ie===T){le=!0,T=U,O=H;break}if(Ie===O){le=!0,O=U,T=H;break}Ie=Ie.sibling}if(!le){for(Ie=H.child;Ie;){if(Ie===T){le=!0,T=H,O=U;break}if(Ie===O){le=!0,O=H,T=U;break}Ie=Ie.sibling}if(!le)throw Error(s(189))}}if(T.alternate!==O)throw Error(s(190))}if(T.tag!==3)throw Error(s(188));return T.stateNode.current===T?p:g}function jd(p){return p=Fd(p),p!==null?rc(p):null}function rc(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=rc(p);if(g!==null)return g;p=p.sibling}return null}var Bd=t.unstable_scheduleCallback,Wu=t.unstable_cancelCallback,$o=t.unstable_shouldYield,Wd=t.unstable_requestPaint,$r=t.unstable_now,Ti=t.unstable_getCurrentPriorityLevel,Ic=t.unstable_ImmediatePriority,ml=t.unstable_UserBlockingPriority,Aa=t.unstable_NormalPriority,fp=t.unstable_LowPriority,zd=t.unstable_IdlePriority,Kl=null,Co=null;function Yf(p){if(Co&&typeof Co.onCommitFiberRoot=="function")try{Co.onCommitFiberRoot(Kl,p,void 0,(p.current.flags&128)===128)}catch{}}var ao=Math.clz32?Math.clz32:Gd,mp=Math.log,gl=Math.LN2;function Gd(p){return p>>>=0,p===0?32:31-(mp(p)/gl|0)|0}var Hd=64,_r=4194304;function ql(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Yl(p,g){var T=p.pendingLanes;if(T===0)return 0;var O=0,U=p.suspendedLanes,H=p.pingedLanes,le=T&268435455;if(le!==0){var Ie=le&~U;Ie!==0?O=ql(Ie):(H&=le,H!==0&&(O=ql(H)))}else le=T&~U,le!==0?O=ql(le):H!==0&&(O=ql(H));if(O===0)return 0;if(g!==0&&g!==O&&(g&U)===0&&(U=O&-O,H=g&-g,U>=H||U===16&&(H&4194240)!==0))return g;if((O&4)!==0&&(O|=T&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=O;0<g;)T=31-ao(g),U=1<<T,O|=p[T],g&=~U;return O}function zu(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ic(p,g){for(var T=p.suspendedLanes,O=p.pingedLanes,U=p.expirationTimes,H=p.pendingLanes;0<H;){var le=31-ao(H),Ie=1<<le,Ue=U[le];Ue===-1?((Ie&T)===0||(Ie&O)!==0)&&(U[le]=zu(Ie,g)):Ue<=g&&(p.expiredLanes|=Ie),H&=~Ie}}function Ko(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Gu(){var p=Hd;return Hd<<=1,(Hd&4194240)===0&&(Hd=64),p}function _l(p){for(var g=[],T=0;31>T;T++)g.push(p);return g}function Xl(p,g,T){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-ao(g),p[g]=T}function Xr(p,g){var T=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var O=p.eventTimes;for(p=p.expirationTimes;0<T;){var U=31-ao(T),H=1<<U;g[U]=0,O[U]=-1,p[U]=-1,T&=~H}}function sc(p,g){var T=p.entangledLanes|=g;for(p=p.entanglements;T;){var O=31-ao(T),U=1<<O;U&g|p[O]&g&&(p[O]|=g),T&=~U}}var cr=0;function Ac(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var Xf,Jl,$d,gp,Jf,_p=!1,qo=[],us=null,Yo=null,Xo=null,Ql=new Map,Jo=new Map,Qo=[],Qf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pc(p,g){switch(p){case"focusin":case"focusout":us=null;break;case"dragenter":case"dragleave":Yo=null;break;case"mouseover":case"mouseout":Xo=null;break;case"pointerover":case"pointerout":Ql.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jo.delete(g.pointerId)}}function Es(p,g,T,O,U,H){return p===null||p.nativeEvent!==H?(p={blockedOn:g,domEventName:T,eventSystemFlags:O,nativeEvent:H,targetContainers:[U]},g!==null&&(g=um(g),g!==null&&Jl(g)),p):(p.eventSystemFlags|=O,g=p.targetContainers,U!==null&&g.indexOf(U)===-1&&g.push(U),p)}function Hu(p,g,T,O,U){switch(g){case"focusin":return us=Es(us,p,g,T,O,U),!0;case"dragenter":return Yo=Es(Yo,p,g,T,O,U),!0;case"mouseover":return Xo=Es(Xo,p,g,T,O,U),!0;case"pointerover":var H=U.pointerId;return Ql.set(H,Es(Ql.get(H)||null,p,g,T,O,U)),!0;case"gotpointercapture":return H=U.pointerId,Jo.set(H,Es(Jo.get(H)||null,p,g,T,O,U)),!0}return!1}function yp(p){var g=Rp(p.target);if(g!==null){var T=bi(g);if(T!==null){if(g=T.tag,g===13){if(g=oo(T),g!==null){p.blockedOn=g,Jf(p.priority,function(){$d(T)});return}}else if(g===3&&T.stateNode.current.memoizedState.isDehydrated){p.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}p.blockedOn=null}function yl(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var T=wr(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(T===null){T=p.nativeEvent;var O=new T.constructor(T.type,T);Ks=O,T.target.dispatchEvent(O),Ks=null}else return g=um(T),g!==null&&Jl(g),p.blockedOn=T,!1;g.shift()}return!0}function Zl(p,g,T){yl(p)&&T.delete(g)}function Zf(){_p=!1,us!==null&&yl(us)&&(us=null),Yo!==null&&yl(Yo)&&(Yo=null),Xo!==null&&yl(Xo)&&(Xo=null),Ql.forEach(Zl),Jo.forEach(Zl)}function Pa(p,g){p.blockedOn===g&&(p.blockedOn=null,_p||(_p=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Zf)))}function Oa(p){function g(U){return Pa(U,p)}if(0<qo.length){Pa(qo[0],p);for(var T=1;T<qo.length;T++){var O=qo[T];O.blockedOn===p&&(O.blockedOn=null)}}for(us!==null&&Pa(us,p),Yo!==null&&Pa(Yo,p),Xo!==null&&Pa(Xo,p),Ql.forEach(g),Jo.forEach(g),T=0;T<Qo.length;T++)O=Qo[T],O.blockedOn===p&&(O.blockedOn=null);for(;0<Qo.length&&(T=Qo[0],T.blockedOn===null);)yp(T),T.blockedOn===null&&Qo.shift()}var El=ce.ReactCurrentBatchConfig,Ce=!0;function De(p,g,T,O){var U=cr,H=El.transition;El.transition=null;try{cr=1,Jt(p,g,T,O)}finally{cr=U,El.transition=H}}function tt(p,g,T,O){var U=cr,H=El.transition;El.transition=null;try{cr=4,Jt(p,g,T,O)}finally{cr=U,El.transition=H}}function Jt(p,g,T,O){if(Ce){var U=wr(p,g,T,O);if(U===null)oE(p,g,O,Qn,T),Pc(p,O);else if(Hu(U,p,g,T,O))O.stopPropagation();else if(Pc(p,O),g&4&&-1<Qf.indexOf(p)){for(;U!==null;){var H=um(U);if(H!==null&&Xf(H),H=wr(p,g,T,O),H===null&&oE(p,g,O,Qn,T),H===U)break;U=H}U!==null&&O.stopPropagation()}else oE(p,g,O,null,T)}}var Qn=null;function wr(p,g,T,O){if(Qn=null,p=qs(O),p=Rp(p),p!==null)if(g=bi(p),g===null)p=null;else if(T=g.tag,T===13){if(p=oo(g),p!==null)return p;p=null}else if(T===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return Qn=p,null}function Kr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ti()){case Ic:return 1;case ml:return 4;case Aa:case fp:return 16;case zd:return 536870912;default:return 16}default:return 16}}var hn=null,Fr=null,wi=null;function Ms(){if(wi)return wi;var p,g=Fr,T=g.length,O,U="value"in hn?hn.value:hn.textContent,H=U.length;for(p=0;p<T&&g[p]===U[p];p++);var le=T-p;for(O=1;O<=le&&g[T-O]===U[H-O];O++);return wi=U.slice(p,1<O?1-O:void 0)}function Zo(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function ea(){return!0}function $u(){return!1}function rs(p){function g(T,O,U,H,le){this._reactName=T,this._targetInst=U,this.type=O,this.nativeEvent=H,this.target=le,this.currentTarget=null;for(var Ie in p)p.hasOwnProperty(Ie)&&(T=p[Ie],this[Ie]=T?T(H):H[Ie]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?ea:$u,this.isPropagationStopped=$u,this}return ke(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=ea)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=ea)},persist:function(){},isPersistent:ea}),g}var vl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Kd=rs(vl),Oc=ke({},vl,{view:0,detail:0}),Fg=rs(Oc),em,Ku,ta,eu=ke({},Oc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==ta&&(ta&&p.type==="mousemove"?(em=p.screenX-ta.screenX,Ku=p.screenY-ta.screenY):Ku=em=0,ta=p),em)},movementY:function(p){return"movementY"in p?p.movementY:Ku}}),tm=rs(eu),jg=ke({},eu,{dataTransfer:0}),Qy=rs(jg),nm=ke({},Oc,{relatedTarget:0}),rm=rs(nm),qu=ke({},vl,{animationName:0,elapsedTime:0,pseudoElement:0}),Yu=rs(qu),Xu=ke({},vl,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Bg=rs(Xu),Zy=ke({},vl,{data:0}),zn=rs(Zy),im={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},na={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},eE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tE(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=eE[p])?!!g[p]:!1}function kc(){return tE}var A=ke({},Oc,{key:function(p){if(p.key){var g=im[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=Zo(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?na[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kc,charCode:function(p){return p.type==="keypress"?Zo(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Zo(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),z=rs(A),re=ke({},eu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ge=rs(re),qe=ke({},Oc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kc}),ot=rs(qe),Vt=ke({},vl,{propertyName:0,elapsedTime:0,pseudoElement:0}),Jr=rs(Vt),mi=ke({},eu,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),Cr=rs(mi),Ys=[9,13,27,32],vs=y&&"CompositionEvent"in window,oc=null;y&&"documentMode"in document&&(oc=document.documentMode);var ra=y&&"TextEvent"in window&&!oc,Ep=y&&(!vs||oc&&8<oc&&11>=oc),sm=" ",ac=!1;function mR(p,g){switch(p){case"keyup":return Ys.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gR(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var om=!1;function fN(p,g){switch(p){case"compositionend":return gR(g);case"keypress":return g.which!==32?null:(ac=!0,sm);case"textInput":return p=g.data,p===sm&&ac?null:p;default:return null}}function _R(p,g){if(om)return p==="compositionend"||!vs&&mR(p,g)?(p=Ms(),wi=Fr=hn=null,om=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Ep&&g.locale!=="ko"?null:g.data;default:return null}}var mN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yR(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!mN[p.type]:g==="textarea"}function $0(p,g,T,O){Ra(O),g=aE(g,"onChange"),0<g.length&&(T=new Kd("onChange","change",null,T,O),p.push({event:T,listeners:g}))}var vp=null,Wg=null;function gN(p){Z0(p,0)}function Sp(p){var g=Ip(p);if(Ft(g))return p}function _N(p,g){if(p==="change")return g}var ER=!1;if(y){var K0;if(y){var Nc="oninput"in document;if(!Nc){var vR=document.createElement("div");vR.setAttribute("oninput","return;"),Nc=typeof vR.oninput=="function"}K0=Nc}else K0=!1;ER=K0&&(!document.documentMode||9<document.documentMode)}function SR(){vp&&(vp.detachEvent("onpropertychange",ka),Wg=vp=null)}function ka(p){if(p.propertyName==="value"&&Sp(Wg)){var g=[];$0(g,Wg,p,qs(p)),io(gN,g)}}function yN(p,g,T){p==="focusin"?(SR(),vp=g,Wg=T,vp.attachEvent("onpropertychange",ka)):p==="focusout"&&SR()}function EN(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Sp(Wg)}function vN(p,g){if(p==="click")return Sp(g)}function SN(p,g){if(p==="input"||p==="change")return Sp(g)}function bR(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var Sl=typeof Object.is=="function"?Object.is:bR;function zg(p,g){if(Sl(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var T=Object.keys(p),O=Object.keys(g);if(T.length!==O.length)return!1;for(O=0;O<T.length;O++){var U=T[O];if(!v.call(g,U)||!Sl(p[U],g[U]))return!1}return!0}function TR(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function q0(p,g){var T=TR(p);p=0;for(var O;T;){if(T.nodeType===3){if(O=p+T.textContent.length,p<=g&&O>=g)return{node:T,offset:g-p};p=O}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=TR(T)}}function wR(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?wR(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function CR(){for(var p=window,g=on();g instanceof p.HTMLIFrameElement;){try{var T=typeof g.contentWindow.location.href=="string"}catch{T=!1}if(T)p=g.contentWindow;else break;g=on(p.document)}return g}function Gg(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function Y0(p){var g=CR(),T=p.focusedElem,O=p.selectionRange;if(g!==T&&T&&T.ownerDocument&&wR(T.ownerDocument.documentElement,T)){if(O!==null&&Gg(T)){if(g=O.start,p=O.end,p===void 0&&(p=g),"selectionStart"in T)T.selectionStart=g,T.selectionEnd=Math.min(p,T.value.length);else if(p=(g=T.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var U=T.textContent.length,H=Math.min(O.start,U);O=O.end===void 0?H:Math.min(O.end,U),!p.extend&&H>O&&(U=O,O=H,H=U),U=q0(T,H);var le=q0(T,O);U&&le&&(p.rangeCount!==1||p.anchorNode!==U.node||p.anchorOffset!==U.offset||p.focusNode!==le.node||p.focusOffset!==le.offset)&&(g=g.createRange(),g.setStart(U.node,U.offset),p.removeAllRanges(),H>O?(p.addRange(g),p.extend(le.node,le.offset)):(g.setEnd(le.node,le.offset),p.addRange(g)))}}for(g=[],p=T;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<g.length;T++)p=g[T],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var bN=y&&"documentMode"in document&&11>=document.documentMode,st=null,X0=null,Hg=null,J0=!1;function RR(p,g,T){var O=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;J0||st==null||st!==on(O)||(O=st,"selectionStart"in O&&Gg(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),Hg&&zg(Hg,O)||(Hg=O,O=aE(X0,"onSelect"),0<O.length&&(g=new Kd("onSelect","select",null,g,T),p.push({event:g,listeners:O}),g.target=st)))}function nE(p,g){var T={};return T[p.toLowerCase()]=g.toLowerCase(),T["Webkit"+p]="webkit"+g,T["Moz"+p]="moz"+g,T}var am={animationend:nE("Animation","AnimationEnd"),animationiteration:nE("Animation","AnimationIteration"),animationstart:nE("Animation","AnimationStart"),transitionend:nE("Transition","TransitionEnd")},Q0={},IR={};y&&(IR=document.createElement("div").style,"AnimationEvent"in window||(delete am.animationend.animation,delete am.animationiteration.animation,delete am.animationstart.animation),"TransitionEvent"in window||delete am.transitionend.transition);function bp(p){if(Q0[p])return Q0[p];if(!am[p])return p;var g=am[p],T;for(T in g)if(g.hasOwnProperty(T)&&T in IR)return Q0[p]=g[T];return p}var Tp=bp("animationend"),AR=bp("animationiteration"),PR=bp("animationstart"),OR=bp("transitionend"),kR=new Map,rE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qd(p,g){kR.set(p,g),d(g,[p])}for(var iE=0;iE<rE.length;iE++){var cc=rE[iE],TN=cc.toLowerCase(),$g=cc[0].toUpperCase()+cc.slice(1);qd(TN,"on"+$g)}qd(Tp,"onAnimationEnd"),qd(AR,"onAnimationIteration"),qd(PR,"onAnimationStart"),qd("dblclick","onDoubleClick"),qd("focusin","onFocus"),qd("focusout","onBlur"),qd(OR,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Kg));function NR(p,g,T){var O=p.type||"unknown-event";p.currentTarget=T,$l(O,g,void 0,p),p.currentTarget=null}function Z0(p,g){g=(g&4)!==0;for(var T=0;T<p.length;T++){var O=p[T],U=O.event;O=O.listeners;e:{var H=void 0;if(g)for(var le=O.length-1;0<=le;le--){var Ie=O[le],Ue=Ie.instance,rt=Ie.currentTarget;if(Ie=Ie.listener,Ue!==H&&U.isPropagationStopped())break e;NR(U,Ie,rt),H=Ue}else for(le=0;le<O.length;le++){if(Ie=O[le],Ue=Ie.instance,rt=Ie.currentTarget,Ie=Ie.listener,Ue!==H&&U.isPropagationStopped())break e;NR(U,Ie,rt),H=Ue}}}if(so)throw p=Hl,so=!1,Hl=null,p}function Di(p,g){var T=g[Jg];T===void 0&&(T=g[Jg]=new Set);var O=p+"__bubble";T.has(O)||(DR(g,p,2,!1),T.add(O))}function eb(p,g,T){var O=0;g&&(O|=4),DR(T,p,O,g)}var sE="_reactListening"+Math.random().toString(36).slice(2);function wp(p){if(!p[sE]){p[sE]=!0,a.forEach(function(T){T!=="selectionchange"&&(wN.has(T)||eb(T,!1,p),eb(T,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[sE]||(g[sE]=!0,eb("selectionchange",!1,g))}}function DR(p,g,T,O){switch(Kr(g)){case 1:var U=De;break;case 4:U=tt;break;default:U=Jt}T=U.bind(null,g,T,p),U=void 0,!gt||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(U=!0),O?U!==void 0?p.addEventListener(g,T,{capture:!0,passive:U}):p.addEventListener(g,T,!0):U!==void 0?p.addEventListener(g,T,{passive:U}):p.addEventListener(g,T,!1)}function oE(p,g,T,O,U){var H=O;if((g&1)===0&&(g&2)===0&&O!==null)e:for(;;){if(O===null)return;var le=O.tag;if(le===3||le===4){var Ie=O.stateNode.containerInfo;if(Ie===U||Ie.nodeType===8&&Ie.parentNode===U)break;if(le===4)for(le=O.return;le!==null;){var Ue=le.tag;if((Ue===3||Ue===4)&&(Ue=le.stateNode.containerInfo,Ue===U||Ue.nodeType===8&&Ue.parentNode===U))return;le=le.return}for(;Ie!==null;){if(le=Rp(Ie),le===null)return;if(Ue=le.tag,Ue===5||Ue===6){O=H=le;continue e}Ie=Ie.parentNode}}O=O.return}io(function(){var rt=H,Ot=qs(T),kt=[];e:{var Pt=kR.get(p);if(Pt!==void 0){var qt=Kd,rn=p;switch(p){case"keypress":if(Zo(T)===0)break e;case"keydown":case"keyup":qt=z;break;case"focusin":rn="focus",qt=rm;break;case"focusout":rn="blur",qt=rm;break;case"beforeblur":case"afterblur":qt=rm;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qt=tm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qt=Qy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qt=ot;break;case Tp:case AR:case PR:qt=Yu;break;case OR:qt=Jr;break;case"scroll":qt=Fg;break;case"wheel":qt=Cr;break;case"copy":case"cut":case"paste":qt=Bg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qt=ge}var sn=(g&4)!==0,ss=!sn&&p==="scroll",Xe=sn?Pt!==null?Pt+"Capture":null:Pt;sn=[];for(var Fe=rt,et;Fe!==null;){et=Fe;var Lt=et.stateNode;if(et.tag===5&&Lt!==null&&(et=Lt,Xe!==null&&(Lt=Ni(Fe,Xe),Lt!=null&&sn.push(cm(Fe,Lt,et)))),ss)break;Fe=Fe.return}0<sn.length&&(Pt=new qt(Pt,rn,null,T,Ot),kt.push({event:Pt,listeners:sn}))}}if((g&7)===0){e:{if(Pt=p==="mouseover"||p==="pointerover",qt=p==="mouseout"||p==="pointerout",Pt&&T!==Ks&&(rn=T.relatedTarget||T.fromElement)&&(Rp(rn)||rn[Dc]))break e;if((qt||Pt)&&(Pt=Ot.window===Ot?Ot:(Pt=Ot.ownerDocument)?Pt.defaultView||Pt.parentWindow:window,qt?(rn=T.relatedTarget||T.toElement,qt=rt,rn=rn?Rp(rn):null,rn!==null&&(ss=bi(rn),rn!==ss||rn.tag!==5&&rn.tag!==6)&&(rn=null)):(qt=null,rn=rt),qt!==rn)){if(sn=tm,Lt="onMouseLeave",Xe="onMouseEnter",Fe="mouse",(p==="pointerout"||p==="pointerover")&&(sn=ge,Lt="onPointerLeave",Xe="onPointerEnter",Fe="pointer"),ss=qt==null?Pt:Ip(qt),et=rn==null?Pt:Ip(rn),Pt=new sn(Lt,Fe+"leave",qt,T,Ot),Pt.target=ss,Pt.relatedTarget=et,Lt=null,Rp(Ot)===rt&&(sn=new sn(Xe,Fe+"enter",rn,T,Ot),sn.target=et,sn.relatedTarget=ss,Lt=sn),ss=Lt,qt&&rn)t:{for(sn=qt,Xe=rn,Fe=0,et=sn;et;et=Cp(et))Fe++;for(et=0,Lt=Xe;Lt;Lt=Cp(Lt))et++;for(;0<Fe-et;)sn=Cp(sn),Fe--;for(;0<et-Fe;)Xe=Cp(Xe),et--;for(;Fe--;){if(sn===Xe||Xe!==null&&sn===Xe.alternate)break t;sn=Cp(sn),Xe=Cp(Xe)}sn=null}else sn=null;qt!==null&&qg(kt,Pt,qt,sn,!1),rn!==null&&ss!==null&&qg(kt,ss,rn,sn,!0)}}e:{if(Pt=rt?Ip(rt):window,qt=Pt.nodeName&&Pt.nodeName.toLowerCase(),qt==="select"||qt==="input"&&Pt.type==="file")var an=_N;else if(yR(Pt))if(ER)an=SN;else{an=EN;var Sn=yN}else(qt=Pt.nodeName)&&qt.toLowerCase()==="input"&&(Pt.type==="checkbox"||Pt.type==="radio")&&(an=vN);if(an&&(an=an(p,rt))){$0(kt,an,T,Ot);break e}Sn&&Sn(p,Pt,rt),p==="focusout"&&(Sn=Pt._wrapperState)&&Sn.controlled&&Pt.type==="number"&&Ve(Pt,"number",Pt.value)}switch(Sn=rt?Ip(rt):window,p){case"focusin":(yR(Sn)||Sn.contentEditable==="true")&&(st=Sn,X0=rt,Hg=null);break;case"focusout":Hg=X0=st=null;break;case"mousedown":J0=!0;break;case"contextmenu":case"mouseup":case"dragend":J0=!1,RR(kt,T,Ot);break;case"selectionchange":if(bN)break;case"keydown":case"keyup":RR(kt,T,Ot)}var Cn;if(vs)e:{switch(p){case"compositionstart":var Fn="onCompositionStart";break e;case"compositionend":Fn="onCompositionEnd";break e;case"compositionupdate":Fn="onCompositionUpdate";break e}Fn=void 0}else om?mR(p,T)&&(Fn="onCompositionEnd"):p==="keydown"&&T.keyCode===229&&(Fn="onCompositionStart");Fn&&(Ep&&T.locale!=="ko"&&(om||Fn!=="onCompositionStart"?Fn==="onCompositionEnd"&&om&&(Cn=Ms()):(hn=Ot,Fr="value"in hn?hn.value:hn.textContent,om=!0)),Sn=aE(rt,Fn),0<Sn.length&&(Fn=new zn(Fn,p,null,T,Ot),kt.push({event:Fn,listeners:Sn}),Cn?Fn.data=Cn:(Cn=gR(T),Cn!==null&&(Fn.data=Cn)))),(Cn=ra?fN(p,T):_R(p,T))&&(rt=aE(rt,"onBeforeInput"),0<rt.length&&(Ot=new zn("onBeforeInput","beforeinput",null,T,Ot),kt.push({event:Ot,listeners:rt}),Ot.data=Cn))}Z0(kt,g)})}function cm(p,g,T){return{instance:p,listener:g,currentTarget:T}}function aE(p,g){for(var T=g+"Capture",O=[];p!==null;){var U=p,H=U.stateNode;U.tag===5&&H!==null&&(U=H,H=Ni(p,T),H!=null&&O.unshift(cm(p,H,U)),H=Ni(p,g),H!=null&&O.push(cm(p,H,U))),p=p.return}return O}function Cp(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function qg(p,g,T,O,U){for(var H=g._reactName,le=[];T!==null&&T!==O;){var Ie=T,Ue=Ie.alternate,rt=Ie.stateNode;if(Ue!==null&&Ue===O)break;Ie.tag===5&&rt!==null&&(Ie=rt,U?(Ue=Ni(T,H),Ue!=null&&le.unshift(cm(T,Ue,Ie))):U||(Ue=Ni(T,H),Ue!=null&&le.push(cm(T,Ue,Ie)))),T=T.return}le.length!==0&&p.push({event:g,listeners:le})}var CN=/\r\n?/g,RN=/\u0000|\uFFFD/g;function xR(p){return(typeof p=="string"?p:""+p).replace(CN,`
`).replace(RN,"")}function cE(p,g,T){if(g=xR(g),xR(p)!==g&&T)throw Error(s(425))}function lE(){}var uE=null,Yg=null;function tb(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Xg=typeof setTimeout=="function"?setTimeout:void 0,IN=typeof clearTimeout=="function"?clearTimeout:void 0,LR=typeof Promise=="function"?Promise:void 0,AN=typeof queueMicrotask=="function"?queueMicrotask:typeof LR<"u"?function(p){return LR.resolve(null).then(p).catch(PN)}:Xg;function PN(p){setTimeout(function(){throw p})}function nb(p,g){var T=g,O=0;do{var U=T.nextSibling;if(p.removeChild(T),U&&U.nodeType===8)if(T=U.data,T==="/$"){if(O===0){p.removeChild(U),Oa(g);return}O--}else T!=="$"&&T!=="$?"&&T!=="$!"||O++;T=U}while(T);Oa(g)}function Yd(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function MR(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var T=p.data;if(T==="$"||T==="$!"||T==="$?"){if(g===0)return p;g--}else T==="/$"&&g++}p=p.previousSibling}return null}var lm=Math.random().toString(36).slice(2),tu="__reactFiber$"+lm,Xd="__reactProps$"+lm,Dc="__reactContainer$"+lm,Jg="__reactEvents$"+lm,ON="__reactListeners$"+lm,kN="__reactHandles$"+lm;function Rp(p){var g=p[tu];if(g)return g;for(var T=p.parentNode;T;){if(g=T[Dc]||T[tu]){if(T=g.alternate,g.child!==null||T!==null&&T.child!==null)for(p=MR(p);p!==null;){if(T=p[tu])return T;p=MR(p)}return g}p=T,T=p.parentNode}return null}function um(p){return p=p[tu]||p[Dc],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Ip(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(s(33))}function dm(p){return p[Xd]||null}var rb=[],hm=-1;function xc(p){return{current:p}}function xi(p){0>hm||(p.current=rb[hm],rb[hm]=null,hm--)}function Ci(p,g){hm++,rb[hm]=p.current,p.current=g}var Jd={},Ro=xc(Jd),Na=xc(!1),Ap=Jd;function Pp(p,g){var T=p.type.contextTypes;if(!T)return Jd;var O=p.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===g)return O.__reactInternalMemoizedMaskedChildContext;var U={},H;for(H in T)U[H]=g[H];return O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=U),U}function Da(p){return p=p.childContextTypes,p!=null}function dE(){xi(Na),xi(Ro)}function UR(p,g,T){if(Ro.current!==Jd)throw Error(s(168));Ci(Ro,g),Ci(Na,T)}function hE(p,g,T){var O=p.stateNode;if(g=g.childContextTypes,typeof O.getChildContext!="function")return T;O=O.getChildContext();for(var U in O)if(!(U in g))throw Error(s(108,Ze(p)||"Unknown",U));return ke({},T,O)}function pE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Jd,Ap=Ro.current,Ci(Ro,p),Ci(Na,Na.current),!0}function VR(p,g,T){var O=p.stateNode;if(!O)throw Error(s(169));T?(p=hE(p,g,Ap),O.__reactInternalMemoizedMergedChildContext=p,xi(Na),xi(Ro),Ci(Ro,p)):xi(Na),Ci(Na,T)}var Lc=null,fE=!1,ib=!1;function FR(p){Lc===null?Lc=[p]:Lc.push(p)}function NN(p){fE=!0,FR(p)}function Qd(){if(!ib&&Lc!==null){ib=!0;var p=0,g=cr;try{var T=Lc;for(cr=1;p<T.length;p++){var O=T[p];do O=O(!0);while(O!==null)}Lc=null,fE=!1}catch(U){throw Lc!==null&&(Lc=Lc.slice(p+1)),Bd(Ic,Qd),U}finally{cr=g,ib=!1}}return null}var pm=[],Ju=0,Qg=null,mE=0,Mc=[],lc=0,Op=null,Qu=1,Zu="";function ed(p,g){pm[Ju++]=mE,pm[Ju++]=Qg,Qg=p,mE=g}function gE(p,g,T){Mc[lc++]=Qu,Mc[lc++]=Zu,Mc[lc++]=Op,Op=p;var O=Qu;p=Zu;var U=32-ao(O)-1;O&=~(1<<U),T+=1;var H=32-ao(g)+U;if(30<H){var le=U-U%5;H=(O&(1<<le)-1).toString(32),O>>=le,U-=le,Qu=1<<32-ao(g)+U|T<<U|O,Zu=H+p}else Qu=1<<H|T<<U|O,Zu=p}function _E(p){p.return!==null&&(ed(p,1),gE(p,1,0))}function Zg(p){for(;p===Qg;)Qg=pm[--Ju],pm[Ju]=null,mE=pm[--Ju],pm[Ju]=null;for(;p===Op;)Op=Mc[--lc],Mc[lc]=null,Zu=Mc[--lc],Mc[lc]=null,Qu=Mc[--lc],Mc[lc]=null}var xa=null,La=null,gi=!1,ia=null;function jR(p,g){var T=hc(5,null,null,0);T.elementType="DELETED",T.stateNode=g,T.return=p,g=p.deletions,g===null?(p.deletions=[T],p.flags|=16):g.push(T)}function BR(p,g){switch(p.tag){case 5:var T=p.type;return g=g.nodeType!==1||T.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,xa=p,La=Yd(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,xa=p,La=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(T=Op!==null?{id:Qu,overflow:Zu}:null,p.memoizedState={dehydrated:g,treeContext:T,retryLane:1073741824},T=hc(18,null,null,0),T.stateNode=g,T.return=p,p.child=T,xa=p,La=null,!0):!1;default:return!1}}function yE(p){return(p.mode&1)!==0&&(p.flags&128)===0}function sb(p){if(gi){var g=La;if(g){var T=g;if(!BR(p,g)){if(yE(p))throw Error(s(418));g=Yd(T.nextSibling);var O=xa;g&&BR(p,g)?jR(O,T):(p.flags=p.flags&-4097|2,gi=!1,xa=p)}}else{if(yE(p))throw Error(s(418));p.flags=p.flags&-4097|2,gi=!1,xa=p}}}function WR(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;xa=p}function e_(p){if(p!==xa)return!1;if(!gi)return WR(p),gi=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!tb(p.type,p.memoizedProps)),g&&(g=La)){if(yE(p))throw zR(),Error(s(418));for(;g;)jR(p,g),g=Yd(g.nextSibling)}if(WR(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var T=p.data;if(T==="/$"){if(g===0){La=Yd(p.nextSibling);break e}g--}else T!=="$"&&T!=="$!"&&T!=="$?"||g++}p=p.nextSibling}La=null}}else La=xa?Yd(p.stateNode.nextSibling):null;return!0}function zR(){for(var p=La;p;)p=Yd(p.nextSibling)}function fm(){La=xa=null,gi=!1}function ob(p){ia===null?ia=[p]:ia.push(p)}var DN=ce.ReactCurrentBatchConfig;function t_(p,g,T){if(p=T.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(s(309));var O=T.stateNode}if(!O)throw Error(s(147,p));var U=O,H=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(le){var Ie=U.refs;le===null?delete Ie[H]:Ie[H]=le},g._stringRef=H,g)}if(typeof p!="string")throw Error(s(284));if(!T._owner)throw Error(s(290,p))}return p}function EE(p,g){throw p=Object.prototype.toString.call(g),Error(s(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function ab(p){var g=p._init;return g(p._payload)}function Zd(p){function g(Xe,Fe){if(p){var et=Xe.deletions;et===null?(Xe.deletions=[Fe],Xe.flags|=16):et.push(Fe)}}function T(Xe,Fe){if(!p)return null;for(;Fe!==null;)g(Xe,Fe),Fe=Fe.sibling;return null}function O(Xe,Fe){for(Xe=new Map;Fe!==null;)Fe.key!==null?Xe.set(Fe.key,Fe):Xe.set(Fe.index,Fe),Fe=Fe.sibling;return Xe}function U(Xe,Fe){return Xe=cd(Xe,Fe),Xe.index=0,Xe.sibling=null,Xe}function H(Xe,Fe,et){return Xe.index=et,p?(et=Xe.alternate,et!==null?(et=et.index,et<Fe?(Xe.flags|=2,Fe):et):(Xe.flags|=2,Fe)):(Xe.flags|=1048576,Fe)}function le(Xe){return p&&Xe.alternate===null&&(Xe.flags|=2),Xe}function Ie(Xe,Fe,et,Lt){return Fe===null||Fe.tag!==6?(Fe=Gb(et,Xe.mode,Lt),Fe.return=Xe,Fe):(Fe=U(Fe,et),Fe.return=Xe,Fe)}function Ue(Xe,Fe,et,Lt){var an=et.type;return an===Y?Ot(Xe,Fe,et.props.children,Lt,et.key):Fe!==null&&(Fe.elementType===an||typeof an=="object"&&an!==null&&an.$$typeof===$e&&ab(an)===Fe.type)?(Lt=U(Fe,et.props),Lt.ref=t_(Xe,Fe,et),Lt.return=Xe,Lt):(Lt=sv(et.type,et.key,et.props,null,Xe.mode,Lt),Lt.ref=t_(Xe,Fe,et),Lt.return=Xe,Lt)}function rt(Xe,Fe,et,Lt){return Fe===null||Fe.tag!==4||Fe.stateNode.containerInfo!==et.containerInfo||Fe.stateNode.implementation!==et.implementation?(Fe=Hb(et,Xe.mode,Lt),Fe.return=Xe,Fe):(Fe=U(Fe,et.children||[]),Fe.return=Xe,Fe)}function Ot(Xe,Fe,et,Lt,an){return Fe===null||Fe.tag!==7?(Fe=Wp(et,Xe.mode,Lt,an),Fe.return=Xe,Fe):(Fe=U(Fe,et),Fe.return=Xe,Fe)}function kt(Xe,Fe,et){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return Fe=Gb(""+Fe,Xe.mode,et),Fe.return=Xe,Fe;if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case ne:return et=sv(Fe.type,Fe.key,Fe.props,null,Xe.mode,et),et.ref=t_(Xe,null,Fe),et.return=Xe,et;case de:return Fe=Hb(Fe,Xe.mode,et),Fe.return=Xe,Fe;case $e:var Lt=Fe._init;return kt(Xe,Lt(Fe._payload),et)}if(Ge(Fe)||Ee(Fe))return Fe=Wp(Fe,Xe.mode,et,null),Fe.return=Xe,Fe;EE(Xe,Fe)}return null}function Pt(Xe,Fe,et,Lt){var an=Fe!==null?Fe.key:null;if(typeof et=="string"&&et!==""||typeof et=="number")return an!==null?null:Ie(Xe,Fe,""+et,Lt);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case ne:return et.key===an?Ue(Xe,Fe,et,Lt):null;case de:return et.key===an?rt(Xe,Fe,et,Lt):null;case $e:return an=et._init,Pt(Xe,Fe,an(et._payload),Lt)}if(Ge(et)||Ee(et))return an!==null?null:Ot(Xe,Fe,et,Lt,null);EE(Xe,et)}return null}function qt(Xe,Fe,et,Lt,an){if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return Xe=Xe.get(et)||null,Ie(Fe,Xe,""+Lt,an);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case ne:return Xe=Xe.get(Lt.key===null?et:Lt.key)||null,Ue(Fe,Xe,Lt,an);case de:return Xe=Xe.get(Lt.key===null?et:Lt.key)||null,rt(Fe,Xe,Lt,an);case $e:var Sn=Lt._init;return qt(Xe,Fe,et,Sn(Lt._payload),an)}if(Ge(Lt)||Ee(Lt))return Xe=Xe.get(et)||null,Ot(Fe,Xe,Lt,an,null);EE(Fe,Lt)}return null}function rn(Xe,Fe,et,Lt){for(var an=null,Sn=null,Cn=Fe,Fn=Fe=0,Cs=null;Cn!==null&&Fn<et.length;Fn++){Cn.index>Fn?(Cs=Cn,Cn=null):Cs=Cn.sibling;var Rr=Pt(Xe,Cn,et[Fn],Lt);if(Rr===null){Cn===null&&(Cn=Cs);break}p&&Cn&&Rr.alternate===null&&g(Xe,Cn),Fe=H(Rr,Fe,Fn),Sn===null?an=Rr:Sn.sibling=Rr,Sn=Rr,Cn=Cs}if(Fn===et.length)return T(Xe,Cn),gi&&ed(Xe,Fn),an;if(Cn===null){for(;Fn<et.length;Fn++)Cn=kt(Xe,et[Fn],Lt),Cn!==null&&(Fe=H(Cn,Fe,Fn),Sn===null?an=Cn:Sn.sibling=Cn,Sn=Cn);return gi&&ed(Xe,Fn),an}for(Cn=O(Xe,Cn);Fn<et.length;Fn++)Cs=qt(Cn,Xe,Fn,et[Fn],Lt),Cs!==null&&(p&&Cs.alternate!==null&&Cn.delete(Cs.key===null?Fn:Cs.key),Fe=H(Cs,Fe,Fn),Sn===null?an=Cs:Sn.sibling=Cs,Sn=Cs);return p&&Cn.forEach(function(uh){return g(Xe,uh)}),gi&&ed(Xe,Fn),an}function sn(Xe,Fe,et,Lt){var an=Ee(et);if(typeof an!="function")throw Error(s(150));if(et=an.call(et),et==null)throw Error(s(151));for(var Sn=an=null,Cn=Fe,Fn=Fe=0,Cs=null,Rr=et.next();Cn!==null&&!Rr.done;Fn++,Rr=et.next()){Cn.index>Fn?(Cs=Cn,Cn=null):Cs=Cn.sibling;var uh=Pt(Xe,Cn,Rr.value,Lt);if(uh===null){Cn===null&&(Cn=Cs);break}p&&Cn&&uh.alternate===null&&g(Xe,Cn),Fe=H(uh,Fe,Fn),Sn===null?an=uh:Sn.sibling=uh,Sn=uh,Cn=Cs}if(Rr.done)return T(Xe,Cn),gi&&ed(Xe,Fn),an;if(Cn===null){for(;!Rr.done;Fn++,Rr=et.next())Rr=kt(Xe,Rr.value,Lt),Rr!==null&&(Fe=H(Rr,Fe,Fn),Sn===null?an=Rr:Sn.sibling=Rr,Sn=Rr);return gi&&ed(Xe,Fn),an}for(Cn=O(Xe,Cn);!Rr.done;Fn++,Rr=et.next())Rr=qt(Cn,Xe,Fn,Rr.value,Lt),Rr!==null&&(p&&Rr.alternate!==null&&Cn.delete(Rr.key===null?Fn:Rr.key),Fe=H(Rr,Fe,Fn),Sn===null?an=Rr:Sn.sibling=Rr,Sn=Rr);return p&&Cn.forEach(function(YN){return g(Xe,YN)}),gi&&ed(Xe,Fn),an}function ss(Xe,Fe,et,Lt){if(typeof et=="object"&&et!==null&&et.type===Y&&et.key===null&&(et=et.props.children),typeof et=="object"&&et!==null){switch(et.$$typeof){case ne:e:{for(var an=et.key,Sn=Fe;Sn!==null;){if(Sn.key===an){if(an=et.type,an===Y){if(Sn.tag===7){T(Xe,Sn.sibling),Fe=U(Sn,et.props.children),Fe.return=Xe,Xe=Fe;break e}}else if(Sn.elementType===an||typeof an=="object"&&an!==null&&an.$$typeof===$e&&ab(an)===Sn.type){T(Xe,Sn.sibling),Fe=U(Sn,et.props),Fe.ref=t_(Xe,Sn,et),Fe.return=Xe,Xe=Fe;break e}T(Xe,Sn);break}else g(Xe,Sn);Sn=Sn.sibling}et.type===Y?(Fe=Wp(et.props.children,Xe.mode,Lt,et.key),Fe.return=Xe,Xe=Fe):(Lt=sv(et.type,et.key,et.props,null,Xe.mode,Lt),Lt.ref=t_(Xe,Fe,et),Lt.return=Xe,Xe=Lt)}return le(Xe);case de:e:{for(Sn=et.key;Fe!==null;){if(Fe.key===Sn)if(Fe.tag===4&&Fe.stateNode.containerInfo===et.containerInfo&&Fe.stateNode.implementation===et.implementation){T(Xe,Fe.sibling),Fe=U(Fe,et.children||[]),Fe.return=Xe,Xe=Fe;break e}else{T(Xe,Fe);break}else g(Xe,Fe);Fe=Fe.sibling}Fe=Hb(et,Xe.mode,Lt),Fe.return=Xe,Xe=Fe}return le(Xe);case $e:return Sn=et._init,ss(Xe,Fe,Sn(et._payload),Lt)}if(Ge(et))return rn(Xe,Fe,et,Lt);if(Ee(et))return sn(Xe,Fe,et,Lt);EE(Xe,et)}return typeof et=="string"&&et!==""||typeof et=="number"?(et=""+et,Fe!==null&&Fe.tag===6?(T(Xe,Fe.sibling),Fe=U(Fe,et),Fe.return=Xe,Xe=Fe):(T(Xe,Fe),Fe=Gb(et,Xe.mode,Lt),Fe.return=Xe,Xe=Fe),le(Xe)):T(Xe,Fe)}return ss}var mm=Zd(!0),GR=Zd(!1),vE=xc(null),n_=null,gm=null,SE=null;function cb(){SE=gm=n_=null}function lb(p){var g=vE.current;xi(vE),p._currentValue=g}function ub(p,g,T){for(;p!==null;){var O=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,O!==null&&(O.childLanes|=g)):O!==null&&(O.childLanes&g)!==g&&(O.childLanes|=g),p===T)break;p=p.return}}function td(p,g){n_=p,SE=gm=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(Ua=!0),p.firstContext=null)}function Uc(p){var g=p._currentValue;if(SE!==p)if(p={context:p,memoizedValue:g,next:null},gm===null){if(n_===null)throw Error(s(308));gm=p,n_.dependencies={lanes:0,firstContext:p}}else gm=gm.next=p;return g}var kp=null;function db(p){kp===null?kp=[p]:kp.push(p)}function HR(p,g,T,O){var U=g.interleaved;return U===null?(T.next=T,db(g)):(T.next=U.next,U.next=T),g.interleaved=T,nd(p,O)}function nd(p,g){p.lanes|=g;var T=p.alternate;for(T!==null&&(T.lanes|=g),T=p,p=p.return;p!==null;)p.childLanes|=g,T=p.alternate,T!==null&&(T.childLanes|=g),T=p,p=p.return;return T.tag===3?T.stateNode:null}var eh=!1;function r_(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function $R(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function nu(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function th(p,g,T){var O=p.updateQueue;if(O===null)return null;if(O=O.shared,(Or&2)!==0){var U=O.pending;return U===null?g.next=g:(g.next=U.next,U.next=g),O.pending=g,nd(p,T)}return U=O.interleaved,U===null?(g.next=g,db(O)):(g.next=U.next,U.next=g),O.interleaved=g,nd(p,T)}function i_(p,g,T){if(g=g.updateQueue,g!==null&&(g=g.shared,(T&4194240)!==0)){var O=g.lanes;O&=p.pendingLanes,T|=O,g.lanes=T,sc(p,T)}}function KR(p,g){var T=p.updateQueue,O=p.alternate;if(O!==null&&(O=O.updateQueue,T===O)){var U=null,H=null;if(T=T.firstBaseUpdate,T!==null){do{var le={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};H===null?U=H=le:H=H.next=le,T=T.next}while(T!==null);H===null?U=H=g:H=H.next=g}else U=H=g;T={baseState:O.baseState,firstBaseUpdate:U,lastBaseUpdate:H,shared:O.shared,effects:O.effects},p.updateQueue=T;return}p=T.lastBaseUpdate,p===null?T.firstBaseUpdate=g:p.next=g,T.lastBaseUpdate=g}function bE(p,g,T,O){var U=p.updateQueue;eh=!1;var H=U.firstBaseUpdate,le=U.lastBaseUpdate,Ie=U.shared.pending;if(Ie!==null){U.shared.pending=null;var Ue=Ie,rt=Ue.next;Ue.next=null,le===null?H=rt:le.next=rt,le=Ue;var Ot=p.alternate;Ot!==null&&(Ot=Ot.updateQueue,Ie=Ot.lastBaseUpdate,Ie!==le&&(Ie===null?Ot.firstBaseUpdate=rt:Ie.next=rt,Ot.lastBaseUpdate=Ue))}if(H!==null){var kt=U.baseState;le=0,Ot=rt=Ue=null,Ie=H;do{var Pt=Ie.lane,qt=Ie.eventTime;if((O&Pt)===Pt){Ot!==null&&(Ot=Ot.next={eventTime:qt,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var rn=p,sn=Ie;switch(Pt=g,qt=T,sn.tag){case 1:if(rn=sn.payload,typeof rn=="function"){kt=rn.call(qt,kt,Pt);break e}kt=rn;break e;case 3:rn.flags=rn.flags&-65537|128;case 0:if(rn=sn.payload,Pt=typeof rn=="function"?rn.call(qt,kt,Pt):rn,Pt==null)break e;kt=ke({},kt,Pt);break e;case 2:eh=!0}}Ie.callback!==null&&Ie.lane!==0&&(p.flags|=64,Pt=U.effects,Pt===null?U.effects=[Ie]:Pt.push(Ie))}else qt={eventTime:qt,lane:Pt,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},Ot===null?(rt=Ot=qt,Ue=kt):Ot=Ot.next=qt,le|=Pt;if(Ie=Ie.next,Ie===null){if(Ie=U.shared.pending,Ie===null)break;Pt=Ie,Ie=Pt.next,Pt.next=null,U.lastBaseUpdate=Pt,U.shared.pending=null}}while(!0);if(Ot===null&&(Ue=kt),U.baseState=Ue,U.firstBaseUpdate=rt,U.lastBaseUpdate=Ot,g=U.shared.interleaved,g!==null){U=g;do le|=U.lane,U=U.next;while(U!==g)}else H===null&&(U.shared.lanes=0);Up|=le,p.lanes=le,p.memoizedState=kt}}function qR(p,g,T){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var O=p[g],U=O.callback;if(U!==null){if(O.callback=null,O=T,typeof U!="function")throw Error(s(191,U));U.call(O)}}}var s_={},ru=xc(s_),o_=xc(s_),_m=xc(s_);function Np(p){if(p===s_)throw Error(s(174));return p}function hb(p,g){switch(Ci(_m,g),Ci(o_,p),Ci(ru,s_),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:en(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=en(g,p)}xi(ru),Ci(ru,g)}function Dp(){xi(ru),xi(o_),xi(_m)}function YR(p){Np(_m.current);var g=Np(ru.current),T=en(g,p.type);g!==T&&(Ci(o_,p),Ci(ru,T))}function ym(p){o_.current===p&&(xi(ru),xi(o_))}var ji=xc(0);function nh(p){for(var g=p;g!==null;){if(g.tag===13){var T=g.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var pb=[];function fb(){for(var p=0;p<pb.length;p++)pb[p]._workInProgressVersionPrimary=null;pb.length=0}var TE=ce.ReactCurrentDispatcher,mb=ce.ReactCurrentBatchConfig,iu=0,Hi=null,Ss=null,bs=null,Em=!1,a_=!1,c_=0,xN=0;function Io(){throw Error(s(321))}function gb(p,g){if(g===null)return!1;for(var T=0;T<g.length&&T<p.length;T++)if(!Sl(p[T],g[T]))return!1;return!0}function vm(p,g,T,O,U,H){if(iu=H,Hi=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,TE.current=p===null||p.memoizedState===null?UN:oI,p=T(O,U),a_){H=0;do{if(a_=!1,c_=0,25<=H)throw Error(s(301));H+=1,bs=Ss=null,g.updateQueue=null,TE.current=VN,p=T(O,U)}while(a_)}if(TE.current=IE,g=Ss!==null&&Ss.next!==null,iu=0,bs=Ss=Hi=null,Em=!1,g)throw Error(s(300));return p}function _b(){var p=c_!==0;return c_=0,p}function sa(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bs===null?Hi.memoizedState=bs=p:bs=bs.next=p,bs}function Ma(){if(Ss===null){var p=Hi.alternate;p=p!==null?p.memoizedState:null}else p=Ss.next;var g=bs===null?Hi.memoizedState:bs.next;if(g!==null)bs=g,Ss=p;else{if(p===null)throw Error(s(310));Ss=p,p={memoizedState:Ss.memoizedState,baseState:Ss.baseState,baseQueue:Ss.baseQueue,queue:Ss.queue,next:null},bs===null?Hi.memoizedState=bs=p:bs=bs.next=p}return bs}function rh(p,g){return typeof g=="function"?g(p):g}function xp(p){var g=Ma(),T=g.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=p;var O=Ss,U=O.baseQueue,H=T.pending;if(H!==null){if(U!==null){var le=U.next;U.next=H.next,H.next=le}O.baseQueue=U=H,T.pending=null}if(U!==null){H=U.next,O=O.baseState;var Ie=le=null,Ue=null,rt=H;do{var Ot=rt.lane;if((iu&Ot)===Ot)Ue!==null&&(Ue=Ue.next={lane:0,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null}),O=rt.hasEagerState?rt.eagerState:p(O,rt.action);else{var kt={lane:Ot,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null};Ue===null?(Ie=Ue=kt,le=O):Ue=Ue.next=kt,Hi.lanes|=Ot,Up|=Ot}rt=rt.next}while(rt!==null&&rt!==H);Ue===null?le=O:Ue.next=Ie,Sl(O,g.memoizedState)||(Ua=!0),g.memoizedState=O,g.baseState=le,g.baseQueue=Ue,T.lastRenderedState=O}if(p=T.interleaved,p!==null){U=p;do H=U.lane,Hi.lanes|=H,Up|=H,U=U.next;while(U!==p)}else U===null&&(T.lanes=0);return[g.memoizedState,T.dispatch]}function Sm(p){var g=Ma(),T=g.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=p;var O=T.dispatch,U=T.pending,H=g.memoizedState;if(U!==null){T.pending=null;var le=U=U.next;do H=p(H,le.action),le=le.next;while(le!==U);Sl(H,g.memoizedState)||(Ua=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),T.lastRenderedState=H}return[H,O]}function XR(){}function yb(p,g){var T=Hi,O=Ma(),U=g(),H=!Sl(O.memoizedState,U);if(H&&(O.memoizedState=U,Ua=!0),O=O.queue,Vc(QR.bind(null,T,O,p),[p]),O.getSnapshot!==g||H||bs!==null&&bs.memoizedState.tag&1){if(T.flags|=2048,l_(9,Eb.bind(null,T,O,U,g),void 0,null),Xs===null)throw Error(s(349));(iu&30)!==0||JR(T,g,U)}return U}function JR(p,g,T){p.flags|=16384,p={getSnapshot:g,value:T},g=Hi.updateQueue,g===null?(g={lastEffect:null,stores:null},Hi.updateQueue=g,g.stores=[p]):(T=g.stores,T===null?g.stores=[p]:T.push(p))}function Eb(p,g,T,O){g.value=T,g.getSnapshot=O,ZR(g)&&wE(p)}function QR(p,g,T){return T(function(){ZR(g)&&wE(p)})}function ZR(p){var g=p.getSnapshot;p=p.value;try{var T=g();return!Sl(p,T)}catch{return!0}}function wE(p){var g=nd(p,1);g!==null&&Wc(g,p,1,-1)}function CE(p){var g=sa();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:rh,lastRenderedState:p},g.queue=p,p=p.dispatch=MN.bind(null,Hi,p),[g.memoizedState,p]}function l_(p,g,T,O){return p={tag:p,create:g,destroy:T,deps:O,next:null},g=Hi.updateQueue,g===null?(g={lastEffect:null,stores:null},Hi.updateQueue=g,g.lastEffect=p.next=p):(T=g.lastEffect,T===null?g.lastEffect=p.next=p:(O=T.next,T.next=p,p.next=O,g.lastEffect=p)),p}function eI(){return Ma().memoizedState}function u_(p,g,T,O){var U=sa();Hi.flags|=p,U.memoizedState=l_(1|g,T,void 0,O===void 0?null:O)}function bm(p,g,T,O){var U=Ma();O=O===void 0?null:O;var H=void 0;if(Ss!==null){var le=Ss.memoizedState;if(H=le.destroy,O!==null&&gb(O,le.deps)){U.memoizedState=l_(g,T,H,O);return}}Hi.flags|=p,U.memoizedState=l_(1|g,T,H,O)}function tI(p,g){return u_(8390656,8,p,g)}function Vc(p,g){return bm(2048,8,p,g)}function Lp(p,g){return bm(4,2,p,g)}function ih(p,g){return bm(4,4,p,g)}function vb(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function Sb(p,g,T){return T=T!=null?T.concat([p]):null,bm(4,4,vb.bind(null,g,p),T)}function rd(){}function RE(p,g){var T=Ma();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&gb(g,O[1])?O[0]:(T.memoizedState=[p,g],p)}function nI(p,g){var T=Ma();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&gb(g,O[1])?O[0]:(p=p(),T.memoizedState=[p,g],p)}function bb(p,g,T){return(iu&21)===0?(p.baseState&&(p.baseState=!1,Ua=!0),p.memoizedState=T):(Sl(T,g)||(T=Gu(),Hi.lanes|=T,Up|=T,p.baseState=!0),g)}function LN(p,g){var T=cr;cr=T!==0&&4>T?T:4,p(!0);var O=mb.transition;mb.transition={};try{p(!1),g()}finally{cr=T,mb.transition=O}}function Tb(){return Ma().memoizedState}function rI(p,g,T){var O=Bc(p);if(T={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null},id(p))iI(g,T);else if(T=HR(p,g,T,O),T!==null){var U=uo();Wc(T,p,O,U),sI(T,g,O)}}function MN(p,g,T){var O=Bc(p),U={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null};if(id(p))iI(g,U);else{var H=p.alternate;if(p.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var le=g.lastRenderedState,Ie=H(le,T);if(U.hasEagerState=!0,U.eagerState=Ie,Sl(Ie,le)){var Ue=g.interleaved;Ue===null?(U.next=U,db(g)):(U.next=Ue.next,Ue.next=U),g.interleaved=U;return}}catch{}finally{}T=HR(p,g,U,O),T!==null&&(U=uo(),Wc(T,p,O,U),sI(T,g,O))}}function id(p){var g=p.alternate;return p===Hi||g!==null&&g===Hi}function iI(p,g){a_=Em=!0;var T=p.pending;T===null?g.next=g:(g.next=T.next,T.next=g),p.pending=g}function sI(p,g,T){if((T&4194240)!==0){var O=g.lanes;O&=p.pendingLanes,T|=O,g.lanes=T,sc(p,T)}}var IE={readContext:Uc,useCallback:Io,useContext:Io,useEffect:Io,useImperativeHandle:Io,useInsertionEffect:Io,useLayoutEffect:Io,useMemo:Io,useReducer:Io,useRef:Io,useState:Io,useDebugValue:Io,useDeferredValue:Io,useTransition:Io,useMutableSource:Io,useSyncExternalStore:Io,useId:Io,unstable_isNewReconciler:!1},UN={readContext:Uc,useCallback:function(p,g){return sa().memoizedState=[p,g===void 0?null:g],p},useContext:Uc,useEffect:tI,useImperativeHandle:function(p,g,T){return T=T!=null?T.concat([p]):null,u_(4194308,4,vb.bind(null,g,p),T)},useLayoutEffect:function(p,g){return u_(4194308,4,p,g)},useInsertionEffect:function(p,g){return u_(4,2,p,g)},useMemo:function(p,g){var T=sa();return g=g===void 0?null:g,p=p(),T.memoizedState=[p,g],p},useReducer:function(p,g,T){var O=sa();return g=T!==void 0?T(g):g,O.memoizedState=O.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},O.queue=p,p=p.dispatch=rI.bind(null,Hi,p),[O.memoizedState,p]},useRef:function(p){var g=sa();return p={current:p},g.memoizedState=p},useState:CE,useDebugValue:rd,useDeferredValue:function(p){return sa().memoizedState=p},useTransition:function(){var p=CE(!1),g=p[0];return p=LN.bind(null,p[1]),sa().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,T){var O=Hi,U=sa();if(gi){if(T===void 0)throw Error(s(407));T=T()}else{if(T=g(),Xs===null)throw Error(s(349));(iu&30)!==0||JR(O,g,T)}U.memoizedState=T;var H={value:T,getSnapshot:g};return U.queue=H,tI(QR.bind(null,O,H,p),[p]),O.flags|=2048,l_(9,Eb.bind(null,O,H,T,g),void 0,null),T},useId:function(){var p=sa(),g=Xs.identifierPrefix;if(gi){var T=Zu,O=Qu;T=(O&~(1<<32-ao(O)-1)).toString(32)+T,g=":"+g+"R"+T,T=c_++,0<T&&(g+="H"+T.toString(32)),g+=":"}else T=xN++,g=":"+g+"r"+T.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},oI={readContext:Uc,useCallback:RE,useContext:Uc,useEffect:Vc,useImperativeHandle:Sb,useInsertionEffect:Lp,useLayoutEffect:ih,useMemo:nI,useReducer:xp,useRef:eI,useState:function(){return xp(rh)},useDebugValue:rd,useDeferredValue:function(p){var g=Ma();return bb(g,Ss.memoizedState,p)},useTransition:function(){var p=xp(rh)[0],g=Ma().memoizedState;return[p,g]},useMutableSource:XR,useSyncExternalStore:yb,useId:Tb,unstable_isNewReconciler:!1},VN={readContext:Uc,useCallback:RE,useContext:Uc,useEffect:Vc,useImperativeHandle:Sb,useInsertionEffect:Lp,useLayoutEffect:ih,useMemo:nI,useReducer:Sm,useRef:eI,useState:function(){return Sm(rh)},useDebugValue:rd,useDeferredValue:function(p){var g=Ma();return Ss===null?g.memoizedState=p:bb(g,Ss.memoizedState,p)},useTransition:function(){var p=Sm(rh)[0],g=Ma().memoizedState;return[p,g]},useMutableSource:XR,useSyncExternalStore:yb,useId:Tb,unstable_isNewReconciler:!1};function uc(p,g){if(p&&p.defaultProps){g=ke({},g),p=p.defaultProps;for(var T in p)g[T]===void 0&&(g[T]=p[T]);return g}return g}function AE(p,g,T,O){g=p.memoizedState,T=T(O,g),T=T==null?g:ke({},g,T),p.memoizedState=T,p.lanes===0&&(p.updateQueue.baseState=T)}var PE={isMounted:function(p){return(p=p._reactInternals)?bi(p)===p:!1},enqueueSetState:function(p,g,T){p=p._reactInternals;var O=uo(),U=Bc(p),H=nu(O,U);H.payload=g,T!=null&&(H.callback=T),g=th(p,H,U),g!==null&&(Wc(g,p,U,O),i_(g,p,U))},enqueueReplaceState:function(p,g,T){p=p._reactInternals;var O=uo(),U=Bc(p),H=nu(O,U);H.tag=1,H.payload=g,T!=null&&(H.callback=T),g=th(p,H,U),g!==null&&(Wc(g,p,U,O),i_(g,p,U))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var T=uo(),O=Bc(p),U=nu(T,O);U.tag=2,g!=null&&(U.callback=g),g=th(p,U,O),g!==null&&(Wc(g,p,O,T),i_(g,p,O))}};function wb(p,g,T,O,U,H,le){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(O,H,le):g.prototype&&g.prototype.isPureReactComponent?!zg(T,O)||!zg(U,H):!0}function aI(p,g,T){var O=!1,U=Jd,H=g.contextType;return typeof H=="object"&&H!==null?H=Uc(H):(U=Da(g)?Ap:Ro.current,O=g.contextTypes,H=(O=O!=null)?Pp(p,U):Jd),g=new g(T,H),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=PE,p.stateNode=g,g._reactInternals=p,O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=U,p.__reactInternalMemoizedMaskedChildContext=H),g}function cI(p,g,T,O){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(T,O),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(T,O),g.state!==p&&PE.enqueueReplaceState(g,g.state,null)}function Cb(p,g,T,O){var U=p.stateNode;U.props=T,U.state=p.memoizedState,U.refs={},r_(p);var H=g.contextType;typeof H=="object"&&H!==null?U.context=Uc(H):(H=Da(g)?Ap:Ro.current,U.context=Pp(p,H)),U.state=p.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&(AE(p,g,H,T),U.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(g=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),g!==U.state&&PE.enqueueReplaceState(U,U.state,null),bE(p,T,U,O),U.state=p.memoizedState),typeof U.componentDidMount=="function"&&(p.flags|=4194308)}function Tm(p,g){try{var T="",O=g;do T+=ze(O),O=O.return;while(O);var U=T}catch(H){U=`
Error generating stack: `+H.message+`
`+H.stack}return{value:p,source:g,stack:U,digest:null}}function Rb(p,g,T){return{value:p,source:null,stack:T??null,digest:g??null}}function Ib(p,g){try{console.error(g.value)}catch(T){setTimeout(function(){throw T})}}var FN=typeof WeakMap=="function"?WeakMap:Map;function Ab(p,g,T){T=nu(-1,T),T.tag=3,T.payload={element:null};var O=g.value;return T.callback=function(){KE||(KE=!0,Fb=O),Ib(p,g)},T}function sd(p,g,T){T=nu(-1,T),T.tag=3;var O=p.type.getDerivedStateFromError;if(typeof O=="function"){var U=g.value;T.payload=function(){return O(U)},T.callback=function(){Ib(p,g)}}var H=p.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(T.callback=function(){Ib(p,g),typeof O!="function"&&(sh===null?sh=new Set([this]):sh.add(this));var le=g.stack;this.componentDidCatch(g.value,{componentStack:le!==null?le:""})}),T}function lI(p,g,T){var O=p.pingCache;if(O===null){O=p.pingCache=new FN;var U=new Set;O.set(g,U)}else U=O.get(g),U===void 0&&(U=new Set,O.set(g,U));U.has(T)||(U.add(T),p=DI.bind(null,p,g,T),g.then(p,p))}function uI(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function dI(p,g,T,O,U){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(g=nu(-1,1),g.tag=2,th(T,g,1))),T.lanes|=1),p):(p.flags|=65536,p.lanes=U,p)}var jN=ce.ReactCurrentOwner,Ua=!1;function oa(p,g,T,O){g.child=p===null?GR(g,null,T,O):mm(g,p.child,T,O)}function OE(p,g,T,O,U){T=T.render;var H=g.ref;return td(g,U),O=vm(p,g,T,O,H,U),T=_b(),p!==null&&!Ua?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~U,su(p,g,U)):(gi&&T&&_E(g),g.flags|=1,oa(p,g,O,U),g.child)}function hI(p,g,T,O,U){if(p===null){var H=T.type;return typeof H=="function"&&!ah(H)&&H.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(g.tag=15,g.type=H,pI(p,g,H,O,U)):(p=sv(T.type,null,O,g,g.mode,U),p.ref=g.ref,p.return=g,g.child=p)}if(H=p.child,(p.lanes&U)===0){var le=H.memoizedProps;if(T=T.compare,T=T!==null?T:zg,T(le,O)&&p.ref===g.ref)return su(p,g,U)}return g.flags|=1,p=cd(H,O),p.ref=g.ref,p.return=g,g.child=p}function pI(p,g,T,O,U){if(p!==null){var H=p.memoizedProps;if(zg(H,O)&&p.ref===g.ref)if(Ua=!1,g.pendingProps=O=H,(p.lanes&U)!==0)(p.flags&131072)!==0&&(Ua=!0);else return g.lanes=p.lanes,su(p,g,U)}return Pb(p,g,T,O,U)}function fI(p,g,T){var O=g.pendingProps,U=O.children,H=p!==null?p.memoizedState:null;if(O.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ci(bl,dc),dc|=T;else{if((T&1073741824)===0)return p=H!==null?H.baseLanes|T:T,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,Ci(bl,dc),dc|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=H!==null?H.baseLanes:T,Ci(bl,dc),dc|=O}else H!==null?(O=H.baseLanes|T,g.memoizedState=null):O=T,Ci(bl,dc),dc|=O;return oa(p,g,U,T),g.child}function mI(p,g){var T=g.ref;(p===null&&T!==null||p!==null&&p.ref!==T)&&(g.flags|=512,g.flags|=2097152)}function Pb(p,g,T,O,U){var H=Da(T)?Ap:Ro.current;return H=Pp(g,H),td(g,U),T=vm(p,g,T,O,H,U),O=_b(),p!==null&&!Ua?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~U,su(p,g,U)):(gi&&O&&_E(g),g.flags|=1,oa(p,g,T,U),g.child)}function gI(p,g,T,O,U){if(Da(T)){var H=!0;pE(g)}else H=!1;if(td(g,U),g.stateNode===null)ME(p,g),aI(g,T,O),Cb(g,T,O,U),O=!0;else if(p===null){var le=g.stateNode,Ie=g.memoizedProps;le.props=Ie;var Ue=le.context,rt=T.contextType;typeof rt=="object"&&rt!==null?rt=Uc(rt):(rt=Da(T)?Ap:Ro.current,rt=Pp(g,rt));var Ot=T.getDerivedStateFromProps,kt=typeof Ot=="function"||typeof le.getSnapshotBeforeUpdate=="function";kt||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(Ie!==O||Ue!==rt)&&cI(g,le,O,rt),eh=!1;var Pt=g.memoizedState;le.state=Pt,bE(g,O,le,U),Ue=g.memoizedState,Ie!==O||Pt!==Ue||Na.current||eh?(typeof Ot=="function"&&(AE(g,T,Ot,O),Ue=g.memoizedState),(Ie=eh||wb(g,T,Ie,O,Pt,Ue,rt))?(kt||typeof le.UNSAFE_componentWillMount!="function"&&typeof le.componentWillMount!="function"||(typeof le.componentWillMount=="function"&&le.componentWillMount(),typeof le.UNSAFE_componentWillMount=="function"&&le.UNSAFE_componentWillMount()),typeof le.componentDidMount=="function"&&(g.flags|=4194308)):(typeof le.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=O,g.memoizedState=Ue),le.props=O,le.state=Ue,le.context=rt,O=Ie):(typeof le.componentDidMount=="function"&&(g.flags|=4194308),O=!1)}else{le=g.stateNode,$R(p,g),Ie=g.memoizedProps,rt=g.type===g.elementType?Ie:uc(g.type,Ie),le.props=rt,kt=g.pendingProps,Pt=le.context,Ue=T.contextType,typeof Ue=="object"&&Ue!==null?Ue=Uc(Ue):(Ue=Da(T)?Ap:Ro.current,Ue=Pp(g,Ue));var qt=T.getDerivedStateFromProps;(Ot=typeof qt=="function"||typeof le.getSnapshotBeforeUpdate=="function")||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(Ie!==kt||Pt!==Ue)&&cI(g,le,O,Ue),eh=!1,Pt=g.memoizedState,le.state=Pt,bE(g,O,le,U);var rn=g.memoizedState;Ie!==kt||Pt!==rn||Na.current||eh?(typeof qt=="function"&&(AE(g,T,qt,O),rn=g.memoizedState),(rt=eh||wb(g,T,rt,O,Pt,rn,Ue)||!1)?(Ot||typeof le.UNSAFE_componentWillUpdate!="function"&&typeof le.componentWillUpdate!="function"||(typeof le.componentWillUpdate=="function"&&le.componentWillUpdate(O,rn,Ue),typeof le.UNSAFE_componentWillUpdate=="function"&&le.UNSAFE_componentWillUpdate(O,rn,Ue)),typeof le.componentDidUpdate=="function"&&(g.flags|=4),typeof le.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof le.componentDidUpdate!="function"||Ie===p.memoizedProps&&Pt===p.memoizedState||(g.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&Pt===p.memoizedState||(g.flags|=1024),g.memoizedProps=O,g.memoizedState=rn),le.props=O,le.state=rn,le.context=Ue,O=rt):(typeof le.componentDidUpdate!="function"||Ie===p.memoizedProps&&Pt===p.memoizedState||(g.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&Pt===p.memoizedState||(g.flags|=1024),O=!1)}return kE(p,g,T,O,H,U)}function kE(p,g,T,O,U,H){mI(p,g);var le=(g.flags&128)!==0;if(!O&&!le)return U&&VR(g,T,!1),su(p,g,H);O=g.stateNode,jN.current=g;var Ie=le&&typeof T.getDerivedStateFromError!="function"?null:O.render();return g.flags|=1,p!==null&&le?(g.child=mm(g,p.child,null,H),g.child=mm(g,null,Ie,H)):oa(p,g,Ie,H),g.memoizedState=O.state,U&&VR(g,T,!0),g.child}function Ob(p){var g=p.stateNode;g.pendingContext?UR(p,g.pendingContext,g.pendingContext!==g.context):g.context&&UR(p,g.context,!1),hb(p,g.containerInfo)}function _I(p,g,T,O,U){return fm(),ob(U),g.flags|=256,oa(p,g,T,O),g.child}var kb={dehydrated:null,treeContext:null,retryLane:0};function wm(p){return{baseLanes:p,cachePool:null,transitions:null}}function NE(p,g,T){var O=g.pendingProps,U=ji.current,H=!1,le=(g.flags&128)!==0,Ie;if((Ie=le)||(Ie=p!==null&&p.memoizedState===null?!1:(U&2)!==0),Ie?(H=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(U|=1),Ci(ji,U&1),p===null)return sb(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(le=O.children,p=O.fallback,H?(O=g.mode,H=g.child,le={mode:"hidden",children:le},(O&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=le):H=ch(le,O,0,null),p=Wp(p,O,T,null),H.return=g,p.return=g,H.sibling=p,g.child=H,g.child.memoizedState=wm(T),g.memoizedState=kb,p):DE(g,le));if(U=p.memoizedState,U!==null&&(Ie=U.dehydrated,Ie!==null))return yI(p,g,le,O,Ie,U,T);if(H){H=O.fallback,le=g.mode,U=p.child,Ie=U.sibling;var Ue={mode:"hidden",children:O.children};return(le&1)===0&&g.child!==U?(O=g.child,O.childLanes=0,O.pendingProps=Ue,g.deletions=null):(O=cd(U,Ue),O.subtreeFlags=U.subtreeFlags&14680064),Ie!==null?H=cd(Ie,H):(H=Wp(H,le,T,null),H.flags|=2),H.return=g,O.return=g,O.sibling=H,g.child=O,O=H,H=g.child,le=p.child.memoizedState,le=le===null?wm(T):{baseLanes:le.baseLanes|T,cachePool:null,transitions:le.transitions},H.memoizedState=le,H.childLanes=p.childLanes&~T,g.memoizedState=kb,O}return H=p.child,p=H.sibling,O=cd(H,{mode:"visible",children:O.children}),(g.mode&1)===0&&(O.lanes=T),O.return=g,O.sibling=null,p!==null&&(T=g.deletions,T===null?(g.deletions=[p],g.flags|=16):T.push(p)),g.child=O,g.memoizedState=null,O}function DE(p,g){return g=ch({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function Mp(p,g,T,O){return O!==null&&ob(O),mm(g,p.child,null,T),p=DE(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function yI(p,g,T,O,U,H,le){if(T)return g.flags&256?(g.flags&=-257,O=Rb(Error(s(422))),Mp(p,g,le,O)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(H=O.fallback,U=g.mode,O=ch({mode:"visible",children:O.children},U,0,null),H=Wp(H,U,le,null),H.flags|=2,O.return=g,H.return=g,O.sibling=H,g.child=O,(g.mode&1)!==0&&mm(g,p.child,null,le),g.child.memoizedState=wm(le),g.memoizedState=kb,H);if((g.mode&1)===0)return Mp(p,g,le,null);if(U.data==="$!"){if(O=U.nextSibling&&U.nextSibling.dataset,O)var Ie=O.dgst;return O=Ie,H=Error(s(419)),O=Rb(H,O,void 0),Mp(p,g,le,O)}if(Ie=(le&p.childLanes)!==0,Ua||Ie){if(O=Xs,O!==null){switch(le&-le){case 4:U=2;break;case 16:U=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:U=32;break;case 536870912:U=268435456;break;default:U=0}U=(U&(O.suspendedLanes|le))!==0?0:U,U!==0&&U!==H.retryLane&&(H.retryLane=U,nd(p,U),Wc(O,p,U,-1))}return Wb(),O=Rb(Error(s(421))),Mp(p,g,le,O)}return U.data==="$?"?(g.flags|=128,g.child=p.child,g=nv.bind(null,p),U._reactRetry=g,null):(p=H.treeContext,La=Yd(U.nextSibling),xa=g,gi=!0,ia=null,p!==null&&(Mc[lc++]=Qu,Mc[lc++]=Zu,Mc[lc++]=Op,Qu=p.id,Zu=p.overflow,Op=g),g=DE(g,O.children),g.flags|=4096,g)}function EI(p,g,T){p.lanes|=g;var O=p.alternate;O!==null&&(O.lanes|=g),ub(p.return,g,T)}function xE(p,g,T,O,U){var H=p.memoizedState;H===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:O,tail:T,tailMode:U}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=O,H.tail=T,H.tailMode=U)}function LE(p,g,T){var O=g.pendingProps,U=O.revealOrder,H=O.tail;if(oa(p,g,O.children,T),O=ji.current,(O&2)!==0)O=O&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&EI(p,T,g);else if(p.tag===19)EI(p,T,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}O&=1}if(Ci(ji,O),(g.mode&1)===0)g.memoizedState=null;else switch(U){case"forwards":for(T=g.child,U=null;T!==null;)p=T.alternate,p!==null&&nh(p)===null&&(U=T),T=T.sibling;T=U,T===null?(U=g.child,g.child=null):(U=T.sibling,T.sibling=null),xE(g,!1,U,T,H);break;case"backwards":for(T=null,U=g.child,g.child=null;U!==null;){if(p=U.alternate,p!==null&&nh(p)===null){g.child=U;break}p=U.sibling,U.sibling=T,T=U,U=p}xE(g,!0,T,null,H);break;case"together":xE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function ME(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function su(p,g,T){if(p!==null&&(g.dependencies=p.dependencies),Up|=g.lanes,(T&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(s(153));if(g.child!==null){for(p=g.child,T=cd(p,p.pendingProps),g.child=T,T.return=g;p.sibling!==null;)p=p.sibling,T=T.sibling=cd(p,p.pendingProps),T.return=g;T.sibling=null}return g.child}function vI(p,g,T){switch(g.tag){case 3:Ob(g),fm();break;case 5:YR(g);break;case 1:Da(g.type)&&pE(g);break;case 4:hb(g,g.stateNode.containerInfo);break;case 10:var O=g.type._context,U=g.memoizedProps.value;Ci(vE,O._currentValue),O._currentValue=U;break;case 13:if(O=g.memoizedState,O!==null)return O.dehydrated!==null?(Ci(ji,ji.current&1),g.flags|=128,null):(T&g.child.childLanes)!==0?NE(p,g,T):(Ci(ji,ji.current&1),p=su(p,g,T),p!==null?p.sibling:null);Ci(ji,ji.current&1);break;case 19:if(O=(T&g.childLanes)!==0,(p.flags&128)!==0){if(O)return LE(p,g,T);g.flags|=128}if(U=g.memoizedState,U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),Ci(ji,ji.current),O)break;return null;case 22:case 23:return g.lanes=0,fI(p,g,T)}return su(p,g,T)}var SI,UE,Nb,bI;SI=function(p,g){for(var T=g.child;T!==null;){if(T.tag===5||T.tag===6)p.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===g)break;for(;T.sibling===null;){if(T.return===null||T.return===g)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},UE=function(){},Nb=function(p,g,T,O){var U=p.memoizedProps;if(U!==O){p=g.stateNode,Np(ru.current);var H=null;switch(T){case"input":U=Zt(p,U),O=Zt(p,O),H=[];break;case"select":U=ke({},U,{value:void 0}),O=ke({},O,{value:void 0}),H=[];break;case"textarea":U=mt(p,U),O=mt(p,O),H=[];break;default:typeof U.onClick!="function"&&typeof O.onClick=="function"&&(p.onclick=lE)}Ho(T,O);var le;T=null;for(rt in U)if(!O.hasOwnProperty(rt)&&U.hasOwnProperty(rt)&&U[rt]!=null)if(rt==="style"){var Ie=U[rt];for(le in Ie)Ie.hasOwnProperty(le)&&(T||(T={}),T[le]="")}else rt!=="dangerouslySetInnerHTML"&&rt!=="children"&&rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&rt!=="autoFocus"&&(l.hasOwnProperty(rt)?H||(H=[]):(H=H||[]).push(rt,null));for(rt in O){var Ue=O[rt];if(Ie=U!=null?U[rt]:void 0,O.hasOwnProperty(rt)&&Ue!==Ie&&(Ue!=null||Ie!=null))if(rt==="style")if(Ie){for(le in Ie)!Ie.hasOwnProperty(le)||Ue&&Ue.hasOwnProperty(le)||(T||(T={}),T[le]="");for(le in Ue)Ue.hasOwnProperty(le)&&Ie[le]!==Ue[le]&&(T||(T={}),T[le]=Ue[le])}else T||(H||(H=[]),H.push(rt,T)),T=Ue;else rt==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Ie=Ie?Ie.__html:void 0,Ue!=null&&Ie!==Ue&&(H=H||[]).push(rt,Ue)):rt==="children"?typeof Ue!="string"&&typeof Ue!="number"||(H=H||[]).push(rt,""+Ue):rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&(l.hasOwnProperty(rt)?(Ue!=null&&rt==="onScroll"&&Di("scroll",p),H||Ie===Ue||(H=[])):(H=H||[]).push(rt,Ue))}T&&(H=H||[]).push("style",T);var rt=H;(g.updateQueue=rt)&&(g.flags|=4)}},bI=function(p,g,T,O){T!==O&&(g.flags|=4)};function d_(p,g){if(!gi)switch(p.tailMode){case"hidden":g=p.tail;for(var T=null;g!==null;)g.alternate!==null&&(T=g),g=g.sibling;T===null?p.tail=null:T.sibling=null;break;case"collapsed":T=p.tail;for(var O=null;T!==null;)T.alternate!==null&&(O=T),T=T.sibling;O===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:O.sibling=null}}function Ao(p){var g=p.alternate!==null&&p.alternate.child===p.child,T=0,O=0;if(g)for(var U=p.child;U!==null;)T|=U.lanes|U.childLanes,O|=U.subtreeFlags&14680064,O|=U.flags&14680064,U.return=p,U=U.sibling;else for(U=p.child;U!==null;)T|=U.lanes|U.childLanes,O|=U.subtreeFlags,O|=U.flags,U.return=p,U=U.sibling;return p.subtreeFlags|=O,p.childLanes=T,g}function VE(p,g,T){var O=g.pendingProps;switch(Zg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ao(g),null;case 1:return Da(g.type)&&dE(),Ao(g),null;case 3:return O=g.stateNode,Dp(),xi(Na),xi(Ro),fb(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(p===null||p.child===null)&&(e_(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,ia!==null&&(QE(ia),ia=null))),UE(p,g),Ao(g),null;case 5:ym(g);var U=Np(_m.current);if(T=g.type,p!==null&&g.stateNode!=null)Nb(p,g,T,O,U),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!O){if(g.stateNode===null)throw Error(s(166));return Ao(g),null}if(p=Np(ru.current),e_(g)){O=g.stateNode,T=g.type;var H=g.memoizedProps;switch(O[tu]=g,O[Xd]=H,p=(g.mode&1)!==0,T){case"dialog":Di("cancel",O),Di("close",O);break;case"iframe":case"object":case"embed":Di("load",O);break;case"video":case"audio":for(U=0;U<Kg.length;U++)Di(Kg[U],O);break;case"source":Di("error",O);break;case"img":case"image":case"link":Di("error",O),Di("load",O);break;case"details":Di("toggle",O);break;case"input":Yt(O,H),Di("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!H.multiple},Di("invalid",O);break;case"textarea":vt(O,H),Di("invalid",O)}Ho(T,H),U=null;for(var le in H)if(H.hasOwnProperty(le)){var Ie=H[le];le==="children"?typeof Ie=="string"?O.textContent!==Ie&&(H.suppressHydrationWarning!==!0&&cE(O.textContent,Ie,p),U=["children",Ie]):typeof Ie=="number"&&O.textContent!==""+Ie&&(H.suppressHydrationWarning!==!0&&cE(O.textContent,Ie,p),U=["children",""+Ie]):l.hasOwnProperty(le)&&Ie!=null&&le==="onScroll"&&Di("scroll",O)}switch(T){case"input":fn(O),Re(O,H,!0);break;case"textarea":fn(O),mn(O);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(O.onclick=lE)}O=U,g.updateQueue=O,O!==null&&(g.flags|=4)}else{le=U.nodeType===9?U:U.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=En(T)),p==="http://www.w3.org/1999/xhtml"?T==="script"?(p=le.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof O.is=="string"?p=le.createElement(T,{is:O.is}):(p=le.createElement(T),T==="select"&&(le=p,O.multiple?le.multiple=!0:O.size&&(le.size=O.size))):p=le.createElementNS(p,T),p[tu]=g,p[Xd]=O,SI(p,g,!1,!1),g.stateNode=p;e:{switch(le=ec(T,O),T){case"dialog":Di("cancel",p),Di("close",p),U=O;break;case"iframe":case"object":case"embed":Di("load",p),U=O;break;case"video":case"audio":for(U=0;U<Kg.length;U++)Di(Kg[U],p);U=O;break;case"source":Di("error",p),U=O;break;case"img":case"image":case"link":Di("error",p),Di("load",p),U=O;break;case"details":Di("toggle",p),U=O;break;case"input":Yt(p,O),U=Zt(p,O),Di("invalid",p);break;case"option":U=O;break;case"select":p._wrapperState={wasMultiple:!!O.multiple},U=ke({},O,{value:void 0}),Di("invalid",p);break;case"textarea":vt(p,O),U=mt(p,O),Di("invalid",p);break;default:U=O}Ho(T,U),Ie=U;for(H in Ie)if(Ie.hasOwnProperty(H)){var Ue=Ie[H];H==="style"?_s(p,Ue):H==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Ue!=null&&nr(p,Ue)):H==="children"?typeof Ue=="string"?(T!=="textarea"||Ue!=="")&&Nt(p,Ue):typeof Ue=="number"&&Nt(p,""+Ue):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?Ue!=null&&H==="onScroll"&&Di("scroll",p):Ue!=null&&ie(p,H,Ue,le))}switch(T){case"input":fn(p),Re(p,O,!1);break;case"textarea":fn(p),mn(p);break;case"option":O.value!=null&&p.setAttribute("value",""+lt(O.value));break;case"select":p.multiple=!!O.multiple,H=O.value,H!=null?ht(p,!!O.multiple,H,!1):O.defaultValue!=null&&ht(p,!!O.multiple,O.defaultValue,!0);break;default:typeof U.onClick=="function"&&(p.onclick=lE)}switch(T){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return Ao(g),null;case 6:if(p&&g.stateNode!=null)bI(p,g,p.memoizedProps,O);else{if(typeof O!="string"&&g.stateNode===null)throw Error(s(166));if(T=Np(_m.current),Np(ru.current),e_(g)){if(O=g.stateNode,T=g.memoizedProps,O[tu]=g,(H=O.nodeValue!==T)&&(p=xa,p!==null))switch(p.tag){case 3:cE(O.nodeValue,T,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&cE(O.nodeValue,T,(p.mode&1)!==0)}H&&(g.flags|=4)}else O=(T.nodeType===9?T:T.ownerDocument).createTextNode(O),O[tu]=g,g.stateNode=O}return Ao(g),null;case 13:if(xi(ji),O=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(gi&&La!==null&&(g.mode&1)!==0&&(g.flags&128)===0)zR(),fm(),g.flags|=98560,H=!1;else if(H=e_(g),O!==null&&O.dehydrated!==null){if(p===null){if(!H)throw Error(s(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(s(317));H[tu]=g}else fm(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;Ao(g),H=!1}else ia!==null&&(QE(ia),ia=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=T,g):(O=O!==null,O!==(p!==null&&p.memoizedState!==null)&&O&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(ji.current&1)!==0?ws===0&&(ws=3):Wb())),g.updateQueue!==null&&(g.flags|=4),Ao(g),null);case 4:return Dp(),UE(p,g),p===null&&wp(g.stateNode.containerInfo),Ao(g),null;case 10:return lb(g.type._context),Ao(g),null;case 17:return Da(g.type)&&dE(),Ao(g),null;case 19:if(xi(ji),H=g.memoizedState,H===null)return Ao(g),null;if(O=(g.flags&128)!==0,le=H.rendering,le===null)if(O)d_(H,!1);else{if(ws!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(le=nh(p),le!==null){for(g.flags|=128,d_(H,!1),O=le.updateQueue,O!==null&&(g.updateQueue=O,g.flags|=4),g.subtreeFlags=0,O=T,T=g.child;T!==null;)H=T,p=O,H.flags&=14680066,le=H.alternate,le===null?(H.childLanes=0,H.lanes=p,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=le.childLanes,H.lanes=le.lanes,H.child=le.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=le.memoizedProps,H.memoizedState=le.memoizedState,H.updateQueue=le.updateQueue,H.type=le.type,p=le.dependencies,H.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),T=T.sibling;return Ci(ji,ji.current&1|2),g.child}p=p.sibling}H.tail!==null&&$r()>Im&&(g.flags|=128,O=!0,d_(H,!1),g.lanes=4194304)}else{if(!O)if(p=nh(le),p!==null){if(g.flags|=128,O=!0,T=p.updateQueue,T!==null&&(g.updateQueue=T,g.flags|=4),d_(H,!0),H.tail===null&&H.tailMode==="hidden"&&!le.alternate&&!gi)return Ao(g),null}else 2*$r()-H.renderingStartTime>Im&&T!==1073741824&&(g.flags|=128,O=!0,d_(H,!1),g.lanes=4194304);H.isBackwards?(le.sibling=g.child,g.child=le):(T=H.last,T!==null?T.sibling=le:g.child=le,H.last=le)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=$r(),g.sibling=null,T=ji.current,Ci(ji,O?T&1|2:T&1),g):(Ao(g),null);case 22:case 23:return E_(),O=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==O&&(g.flags|=8192),O&&(g.mode&1)!==0?(dc&1073741824)!==0&&(Ao(g),g.subtreeFlags&6&&(g.flags|=8192)):Ao(g),null;case 24:return null;case 25:return null}throw Error(s(156,g.tag))}function BN(p,g){switch(Zg(g),g.tag){case 1:return Da(g.type)&&dE(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return Dp(),xi(Na),xi(Ro),fb(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return ym(g),null;case 13:if(xi(ji),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(s(340));fm()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return xi(ji),null;case 4:return Dp(),null;case 10:return lb(g.type._context),null;case 22:case 23:return E_(),null;case 24:return null;default:return null}}var FE=!1,Po=!1,TI=typeof WeakSet=="function"?WeakSet:Set,tn=null;function Cm(p,g){var T=p.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(O){$i(p,g,O)}else T.current=null}function h_(p,g,T){try{T()}catch(O){$i(p,g,O)}}var wI=!1;function Db(p,g){if(uE=Ce,p=CR(),Gg(p)){if("selectionStart"in p)var T={start:p.selectionStart,end:p.selectionEnd};else e:{T=(T=p.ownerDocument)&&T.defaultView||window;var O=T.getSelection&&T.getSelection();if(O&&O.rangeCount!==0){T=O.anchorNode;var U=O.anchorOffset,H=O.focusNode;O=O.focusOffset;try{T.nodeType,H.nodeType}catch{T=null;break e}var le=0,Ie=-1,Ue=-1,rt=0,Ot=0,kt=p,Pt=null;t:for(;;){for(var qt;kt!==T||U!==0&&kt.nodeType!==3||(Ie=le+U),kt!==H||O!==0&&kt.nodeType!==3||(Ue=le+O),kt.nodeType===3&&(le+=kt.nodeValue.length),(qt=kt.firstChild)!==null;)Pt=kt,kt=qt;for(;;){if(kt===p)break t;if(Pt===T&&++rt===U&&(Ie=le),Pt===H&&++Ot===O&&(Ue=le),(qt=kt.nextSibling)!==null)break;kt=Pt,Pt=kt.parentNode}kt=qt}T=Ie===-1||Ue===-1?null:{start:Ie,end:Ue}}else T=null}T=T||{start:0,end:0}}else T=null;for(Yg={focusedElem:p,selectionRange:T},Ce=!1,tn=g;tn!==null;)if(g=tn,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,tn=p;else for(;tn!==null;){g=tn;try{var rn=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(rn!==null){var sn=rn.memoizedProps,ss=rn.memoizedState,Xe=g.stateNode,Fe=Xe.getSnapshotBeforeUpdate(g.elementType===g.type?sn:uc(g.type,sn),ss);Xe.__reactInternalSnapshotBeforeUpdate=Fe}break;case 3:var et=g.stateNode.containerInfo;et.nodeType===1?et.textContent="":et.nodeType===9&&et.documentElement&&et.removeChild(et.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Lt){$i(g,g.return,Lt)}if(p=g.sibling,p!==null){p.return=g.return,tn=p;break}tn=g.return}return rn=wI,wI=!1,rn}function p_(p,g,T){var O=g.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var U=O=O.next;do{if((U.tag&p)===p){var H=U.destroy;U.destroy=void 0,H!==void 0&&h_(g,T,H)}U=U.next}while(U!==O)}}function f_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var T=g=g.next;do{if((T.tag&p)===p){var O=T.create;T.destroy=O()}T=T.next}while(T!==g)}}function xb(p){var g=p.ref;if(g!==null){var T=p.stateNode;switch(p.tag){case 5:p=T;break;default:p=T}typeof g=="function"?g(p):g.current=p}}function CI(p){var g=p.alternate;g!==null&&(p.alternate=null,CI(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[tu],delete g[Xd],delete g[Jg],delete g[ON],delete g[kN])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function Lb(p){return p.tag===5||p.tag===3||p.tag===4}function RI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||Lb(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function Mb(p,g,T){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?T.nodeType===8?T.parentNode.insertBefore(p,g):T.insertBefore(p,g):(T.nodeType===8?(g=T.parentNode,g.insertBefore(p,T)):(g=T,g.appendChild(p)),T=T._reactRootContainer,T!=null||g.onclick!==null||(g.onclick=lE));else if(O!==4&&(p=p.child,p!==null))for(Mb(p,g,T),p=p.sibling;p!==null;)Mb(p,g,T),p=p.sibling}function jE(p,g,T){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?T.insertBefore(p,g):T.appendChild(p);else if(O!==4&&(p=p.child,p!==null))for(jE(p,g,T),p=p.sibling;p!==null;)jE(p,g,T),p=p.sibling}var co=null,Fc=!1;function ou(p,g,T){for(T=T.child;T!==null;)II(p,g,T),T=T.sibling}function II(p,g,T){if(Co&&typeof Co.onCommitFiberUnmount=="function")try{Co.onCommitFiberUnmount(Kl,T)}catch{}switch(T.tag){case 5:Po||Cm(T,g);case 6:var O=co,U=Fc;co=null,ou(p,g,T),co=O,Fc=U,co!==null&&(Fc?(p=co,T=T.stateNode,p.nodeType===8?p.parentNode.removeChild(T):p.removeChild(T)):co.removeChild(T.stateNode));break;case 18:co!==null&&(Fc?(p=co,T=T.stateNode,p.nodeType===8?nb(p.parentNode,T):p.nodeType===1&&nb(p,T),Oa(p)):nb(co,T.stateNode));break;case 4:O=co,U=Fc,co=T.stateNode.containerInfo,Fc=!0,ou(p,g,T),co=O,Fc=U;break;case 0:case 11:case 14:case 15:if(!Po&&(O=T.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){U=O=O.next;do{var H=U,le=H.destroy;H=H.tag,le!==void 0&&((H&2)!==0||(H&4)!==0)&&h_(T,g,le),U=U.next}while(U!==O)}ou(p,g,T);break;case 1:if(!Po&&(Cm(T,g),O=T.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=T.memoizedProps,O.state=T.memoizedState,O.componentWillUnmount()}catch(Ie){$i(T,g,Ie)}ou(p,g,T);break;case 21:ou(p,g,T);break;case 22:T.mode&1?(Po=(O=Po)||T.memoizedState!==null,ou(p,g,T),Po=O):ou(p,g,T);break;default:ou(p,g,T)}}function AI(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var T=p.stateNode;T===null&&(T=p.stateNode=new TI),g.forEach(function(O){var U=xI.bind(null,p,O);T.has(O)||(T.add(O),O.then(U,U))})}}function aa(p,g){var T=g.deletions;if(T!==null)for(var O=0;O<T.length;O++){var U=T[O];try{var H=p,le=g,Ie=le;e:for(;Ie!==null;){switch(Ie.tag){case 5:co=Ie.stateNode,Fc=!1;break e;case 3:co=Ie.stateNode.containerInfo,Fc=!0;break e;case 4:co=Ie.stateNode.containerInfo,Fc=!0;break e}Ie=Ie.return}if(co===null)throw Error(s(160));II(H,le,U),co=null,Fc=!1;var Ue=U.alternate;Ue!==null&&(Ue.return=null),U.return=null}catch(rt){$i(U,g,rt)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Ub(g,p),g=g.sibling}function Ub(p,g){var T=p.alternate,O=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(aa(g,p),Va(p),O&4){try{p_(3,p,p.return),f_(3,p)}catch(sn){$i(p,p.return,sn)}try{p_(5,p,p.return)}catch(sn){$i(p,p.return,sn)}}break;case 1:aa(g,p),Va(p),O&512&&T!==null&&Cm(T,T.return);break;case 5:if(aa(g,p),Va(p),O&512&&T!==null&&Cm(T,T.return),p.flags&32){var U=p.stateNode;try{Nt(U,"")}catch(sn){$i(p,p.return,sn)}}if(O&4&&(U=p.stateNode,U!=null)){var H=p.memoizedProps,le=T!==null?T.memoizedProps:H,Ie=p.type,Ue=p.updateQueue;if(p.updateQueue=null,Ue!==null)try{Ie==="input"&&H.type==="radio"&&H.name!=null&&Vn(U,H),ec(Ie,le);var rt=ec(Ie,H);for(le=0;le<Ue.length;le+=2){var Ot=Ue[le],kt=Ue[le+1];Ot==="style"?_s(U,kt):Ot==="dangerouslySetInnerHTML"?nr(U,kt):Ot==="children"?Nt(U,kt):ie(U,Ot,kt,rt)}switch(Ie){case"input":$t(U,H);break;case"textarea":Bt(U,H);break;case"select":var Pt=U._wrapperState.wasMultiple;U._wrapperState.wasMultiple=!!H.multiple;var qt=H.value;qt!=null?ht(U,!!H.multiple,qt,!1):Pt!==!!H.multiple&&(H.defaultValue!=null?ht(U,!!H.multiple,H.defaultValue,!0):ht(U,!!H.multiple,H.multiple?[]:"",!1))}U[Xd]=H}catch(sn){$i(p,p.return,sn)}}break;case 6:if(aa(g,p),Va(p),O&4){if(p.stateNode===null)throw Error(s(162));U=p.stateNode,H=p.memoizedProps;try{U.nodeValue=H}catch(sn){$i(p,p.return,sn)}}break;case 3:if(aa(g,p),Va(p),O&4&&T!==null&&T.memoizedState.isDehydrated)try{Oa(g.containerInfo)}catch(sn){$i(p,p.return,sn)}break;case 4:aa(g,p),Va(p);break;case 13:aa(g,p),Va(p),U=p.child,U.flags&8192&&(H=U.memoizedState!==null,U.stateNode.isHidden=H,!H||U.alternate!==null&&U.alternate.memoizedState!==null||($E=$r())),O&4&&AI(p);break;case 22:if(Ot=T!==null&&T.memoizedState!==null,p.mode&1?(Po=(rt=Po)||Ot,aa(g,p),Po=rt):aa(g,p),Va(p),O&8192){if(rt=p.memoizedState!==null,(p.stateNode.isHidden=rt)&&!Ot&&(p.mode&1)!==0)for(tn=p,Ot=p.child;Ot!==null;){for(kt=tn=Ot;tn!==null;){switch(Pt=tn,qt=Pt.child,Pt.tag){case 0:case 11:case 14:case 15:p_(4,Pt,Pt.return);break;case 1:Cm(Pt,Pt.return);var rn=Pt.stateNode;if(typeof rn.componentWillUnmount=="function"){O=Pt,T=Pt.return;try{g=O,rn.props=g.memoizedProps,rn.state=g.memoizedState,rn.componentWillUnmount()}catch(sn){$i(O,T,sn)}}break;case 5:Cm(Pt,Pt.return);break;case 22:if(Pt.memoizedState!==null){m_(kt);continue}}qt!==null?(qt.return=Pt,tn=qt):m_(kt)}Ot=Ot.sibling}e:for(Ot=null,kt=p;;){if(kt.tag===5){if(Ot===null){Ot=kt;try{U=kt.stateNode,rt?(H=U.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Ie=kt.stateNode,Ue=kt.memoizedProps.style,le=Ue!=null&&Ue.hasOwnProperty("display")?Ue.display:null,Ie.style.display=ki("display",le))}catch(sn){$i(p,p.return,sn)}}}else if(kt.tag===6){if(Ot===null)try{kt.stateNode.nodeValue=rt?"":kt.memoizedProps}catch(sn){$i(p,p.return,sn)}}else if((kt.tag!==22&&kt.tag!==23||kt.memoizedState===null||kt===p)&&kt.child!==null){kt.child.return=kt,kt=kt.child;continue}if(kt===p)break e;for(;kt.sibling===null;){if(kt.return===null||kt.return===p)break e;Ot===kt&&(Ot=null),kt=kt.return}Ot===kt&&(Ot=null),kt.sibling.return=kt.return,kt=kt.sibling}}break;case 19:aa(g,p),Va(p),O&4&&AI(p);break;case 21:break;default:aa(g,p),Va(p)}}function Va(p){var g=p.flags;if(g&2){try{e:{for(var T=p.return;T!==null;){if(Lb(T)){var O=T;break e}T=T.return}throw Error(s(160))}switch(O.tag){case 5:var U=O.stateNode;O.flags&32&&(Nt(U,""),O.flags&=-33);var H=RI(p);jE(p,H,U);break;case 3:case 4:var le=O.stateNode.containerInfo,Ie=RI(p);Mb(p,Ie,le);break;default:throw Error(s(161))}}catch(Ue){$i(p,p.return,Ue)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function Rm(p,g,T){tn=p,Vb(p)}function Vb(p,g,T){for(var O=(p.mode&1)!==0;tn!==null;){var U=tn,H=U.child;if(U.tag===22&&O){var le=U.memoizedState!==null||FE;if(!le){var Ie=U.alternate,Ue=Ie!==null&&Ie.memoizedState!==null||Po;Ie=FE;var rt=Po;if(FE=le,(Po=Ue)&&!rt)for(tn=U;tn!==null;)le=tn,Ue=le.child,le.tag===22&&le.memoizedState!==null?PI(U):Ue!==null?(Ue.return=le,tn=Ue):PI(U);for(;H!==null;)tn=H,Vb(H),H=H.sibling;tn=U,FE=Ie,Po=rt}BE(p)}else(U.subtreeFlags&8772)!==0&&H!==null?(H.return=U,tn=H):BE(p)}}function BE(p){for(;tn!==null;){var g=tn;if((g.flags&8772)!==0){var T=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:Po||f_(5,g);break;case 1:var O=g.stateNode;if(g.flags&4&&!Po)if(T===null)O.componentDidMount();else{var U=g.elementType===g.type?T.memoizedProps:uc(g.type,T.memoizedProps);O.componentDidUpdate(U,T.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&qR(g,H,O);break;case 3:var le=g.updateQueue;if(le!==null){if(T=null,g.child!==null)switch(g.child.tag){case 5:T=g.child.stateNode;break;case 1:T=g.child.stateNode}qR(g,le,T)}break;case 5:var Ie=g.stateNode;if(T===null&&g.flags&4){T=Ie;var Ue=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ue.autoFocus&&T.focus();break;case"img":Ue.src&&(T.src=Ue.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var rt=g.alternate;if(rt!==null){var Ot=rt.memoizedState;if(Ot!==null){var kt=Ot.dehydrated;kt!==null&&Oa(kt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Po||g.flags&512&&xb(g)}catch(Pt){$i(g,g.return,Pt)}}if(g===p){tn=null;break}if(T=g.sibling,T!==null){T.return=g.return,tn=T;break}tn=g.return}}function m_(p){for(;tn!==null;){var g=tn;if(g===p){tn=null;break}var T=g.sibling;if(T!==null){T.return=g.return,tn=T;break}tn=g.return}}function PI(p){for(;tn!==null;){var g=tn;try{switch(g.tag){case 0:case 11:case 15:var T=g.return;try{f_(4,g)}catch(Ue){$i(g,T,Ue)}break;case 1:var O=g.stateNode;if(typeof O.componentDidMount=="function"){var U=g.return;try{O.componentDidMount()}catch(Ue){$i(g,U,Ue)}}var H=g.return;try{xb(g)}catch(Ue){$i(g,H,Ue)}break;case 5:var le=g.return;try{xb(g)}catch(Ue){$i(g,le,Ue)}}}catch(Ue){$i(g,g.return,Ue)}if(g===p){tn=null;break}var Ie=g.sibling;if(Ie!==null){Ie.return=g.return,tn=Ie;break}tn=g.return}}var WN=Math.ceil,WE=ce.ReactCurrentDispatcher,zE=ce.ReactCurrentOwner,jc=ce.ReactCurrentBatchConfig,Or=0,Xs=null,is=null,Ts=0,dc=0,bl=xc(0),ws=0,lo=null,Up=0,GE=0,HE=0,g_=null,ca=null,$E=0,Im=1/0,au=null,KE=!1,Fb=null,sh=null,Am=!1,cu=null,qE=0,Vp=0,jb=null,__=-1,YE=0;function uo(){return(Or&6)!==0?$r():__!==-1?__:__=$r()}function Bc(p){return(p.mode&1)===0?1:(Or&2)!==0&&Ts!==0?Ts&-Ts:DN.transition!==null?(YE===0&&(YE=Gu()),YE):(p=cr,p!==0||(p=window.event,p=p===void 0?16:Kr(p.type)),p)}function Wc(p,g,T,O){if(50<Vp)throw Vp=0,jb=null,Error(s(185));Xl(p,T,O),((Or&2)===0||p!==Xs)&&(p===Xs&&((Or&2)===0&&(GE|=T),ws===4&&od(p,Ts)),Oo(p,O),T===1&&Or===0&&(g.mode&1)===0&&(Im=$r()+500,fE&&Qd()))}function Oo(p,g){var T=p.callbackNode;ic(p,g);var O=Yl(p,p===Xs?Ts:0);if(O===0)T!==null&&Wu(T),p.callbackNode=null,p.callbackPriority=0;else if(g=O&-O,p.callbackPriority!==g){if(T!=null&&Wu(T),g===1)p.tag===0?NN(Fp.bind(null,p)):FR(Fp.bind(null,p)),AN(function(){(Or&6)===0&&Qd()}),T=null;else{switch(Ac(O)){case 1:T=Ic;break;case 4:T=ml;break;case 16:T=Aa;break;case 536870912:T=zd;break;default:T=Aa}T=v_(T,XE.bind(null,p))}p.callbackPriority=g,p.callbackNode=T}}function XE(p,g){if(__=-1,YE=0,(Or&6)!==0)throw Error(s(327));var T=p.callbackNode;if(Pm()&&p.callbackNode!==T)return null;var O=Yl(p,p===Xs?Ts:0);if(O===0)return null;if((O&30)!==0||(O&p.expiredLanes)!==0||g)g=lu(p,O);else{g=O;var U=Or;Or|=2;var H=OI();(Xs!==p||Ts!==g)&&(au=null,Im=$r()+500,oh(p,g));do try{zN();break}catch(Ie){Bb(p,Ie)}while(!0);cb(),WE.current=H,Or=U,is!==null?g=0:(Xs=null,Ts=0,g=ws)}if(g!==0){if(g===2&&(U=Ko(p),U!==0&&(O=U,g=JE(p,U))),g===1)throw T=lo,oh(p,0),od(p,O),Oo(p,$r()),T;if(g===6)od(p,O);else{if(U=p.current.alternate,(O&30)===0&&!ZE(U)&&(g=lu(p,O),g===2&&(H=Ko(p),H!==0&&(O=H,g=JE(p,H))),g===1))throw T=lo,oh(p,0),od(p,O),Oo(p,$r()),T;switch(p.finishedWork=U,p.finishedLanes=O,g){case 0:case 1:throw Error(s(345));case 2:jp(p,ca,au);break;case 3:if(od(p,O),(O&130023424)===O&&(g=$E+500-$r(),10<g)){if(Yl(p,0)!==0)break;if(U=p.suspendedLanes,(U&O)!==O){uo(),p.pingedLanes|=p.suspendedLanes&U;break}p.timeoutHandle=Xg(jp.bind(null,p,ca,au),g);break}jp(p,ca,au);break;case 4:if(od(p,O),(O&4194240)===O)break;for(g=p.eventTimes,U=-1;0<O;){var le=31-ao(O);H=1<<le,le=g[le],le>U&&(U=le),O&=~H}if(O=U,O=$r()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*WN(O/1960))-O,10<O){p.timeoutHandle=Xg(jp.bind(null,p,ca,au),O);break}jp(p,ca,au);break;case 5:jp(p,ca,au);break;default:throw Error(s(329))}}}return Oo(p,$r()),p.callbackNode===T?XE.bind(null,p):null}function JE(p,g){var T=g_;return p.current.memoizedState.isDehydrated&&(oh(p,g).flags|=256),p=lu(p,g),p!==2&&(g=ca,ca=T,g!==null&&QE(g)),p}function QE(p){ca===null?ca=p:ca.push.apply(ca,p)}function ZE(p){for(var g=p;;){if(g.flags&16384){var T=g.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var O=0;O<T.length;O++){var U=T[O],H=U.getSnapshot;U=U.value;try{if(!Sl(H(),U))return!1}catch{return!1}}}if(T=g.child,g.subtreeFlags&16384&&T!==null)T.return=g,g=T;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function od(p,g){for(g&=~HE,g&=~GE,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var T=31-ao(g),O=1<<T;p[T]=-1,g&=~O}}function Fp(p){if((Or&6)!==0)throw Error(s(327));Pm();var g=Yl(p,0);if((g&1)===0)return Oo(p,$r()),null;var T=lu(p,g);if(p.tag!==0&&T===2){var O=Ko(p);O!==0&&(g=O,T=JE(p,O))}if(T===1)throw T=lo,oh(p,0),od(p,g),Oo(p,$r()),T;if(T===6)throw Error(s(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,jp(p,ca,au),Oo(p,$r()),null}function y_(p,g){var T=Or;Or|=1;try{return p(g)}finally{Or=T,Or===0&&(Im=$r()+500,fE&&Qd())}}function ad(p){cu!==null&&cu.tag===0&&(Or&6)===0&&Pm();var g=Or;Or|=1;var T=jc.transition,O=cr;try{if(jc.transition=null,cr=1,p)return p()}finally{cr=O,jc.transition=T,Or=g,(Or&6)===0&&Qd()}}function E_(){dc=bl.current,xi(bl)}function oh(p,g){p.finishedWork=null,p.finishedLanes=0;var T=p.timeoutHandle;if(T!==-1&&(p.timeoutHandle=-1,IN(T)),is!==null)for(T=is.return;T!==null;){var O=T;switch(Zg(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&dE();break;case 3:Dp(),xi(Na),xi(Ro),fb();break;case 5:ym(O);break;case 4:Dp();break;case 13:xi(ji);break;case 19:xi(ji);break;case 10:lb(O.type._context);break;case 22:case 23:E_()}T=T.return}if(Xs=p,is=p=cd(p.current,null),Ts=dc=g,ws=0,lo=null,HE=GE=Up=0,ca=g_=null,kp!==null){for(g=0;g<kp.length;g++)if(T=kp[g],O=T.interleaved,O!==null){T.interleaved=null;var U=O.next,H=T.pending;if(H!==null){var le=H.next;H.next=U,O.next=le}T.pending=O}kp=null}return p}function Bb(p,g){do{var T=is;try{if(cb(),TE.current=IE,Em){for(var O=Hi.memoizedState;O!==null;){var U=O.queue;U!==null&&(U.pending=null),O=O.next}Em=!1}if(iu=0,bs=Ss=Hi=null,a_=!1,c_=0,zE.current=null,T===null||T.return===null){ws=1,lo=g,is=null;break}e:{var H=p,le=T.return,Ie=T,Ue=g;if(g=Ts,Ie.flags|=32768,Ue!==null&&typeof Ue=="object"&&typeof Ue.then=="function"){var rt=Ue,Ot=Ie,kt=Ot.tag;if((Ot.mode&1)===0&&(kt===0||kt===11||kt===15)){var Pt=Ot.alternate;Pt?(Ot.updateQueue=Pt.updateQueue,Ot.memoizedState=Pt.memoizedState,Ot.lanes=Pt.lanes):(Ot.updateQueue=null,Ot.memoizedState=null)}var qt=uI(le);if(qt!==null){qt.flags&=-257,dI(qt,le,Ie,H,g),qt.mode&1&&lI(H,rt,g),g=qt,Ue=rt;var rn=g.updateQueue;if(rn===null){var sn=new Set;sn.add(Ue),g.updateQueue=sn}else rn.add(Ue);break e}else{if((g&1)===0){lI(H,rt,g),Wb();break e}Ue=Error(s(426))}}else if(gi&&Ie.mode&1){var ss=uI(le);if(ss!==null){(ss.flags&65536)===0&&(ss.flags|=256),dI(ss,le,Ie,H,g),ob(Tm(Ue,Ie));break e}}H=Ue=Tm(Ue,Ie),ws!==4&&(ws=2),g_===null?g_=[H]:g_.push(H),H=le;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var Xe=Ab(H,Ue,g);KR(H,Xe);break e;case 1:Ie=Ue;var Fe=H.type,et=H.stateNode;if((H.flags&128)===0&&(typeof Fe.getDerivedStateFromError=="function"||et!==null&&typeof et.componentDidCatch=="function"&&(sh===null||!sh.has(et)))){H.flags|=65536,g&=-g,H.lanes|=g;var Lt=sd(H,Ie,g);KR(H,Lt);break e}}H=H.return}while(H!==null)}NI(T)}catch(an){g=an,is===T&&T!==null&&(is=T=T.return);continue}break}while(!0)}function OI(){var p=WE.current;return WE.current=IE,p===null?IE:p}function Wb(){(ws===0||ws===3||ws===2)&&(ws=4),Xs===null||(Up&268435455)===0&&(GE&268435455)===0||od(Xs,Ts)}function lu(p,g){var T=Or;Or|=2;var O=OI();(Xs!==p||Ts!==g)&&(au=null,oh(p,g));do try{kI();break}catch(U){Bb(p,U)}while(!0);if(cb(),Or=T,WE.current=O,is!==null)throw Error(s(261));return Xs=null,Ts=0,ws}function kI(){for(;is!==null;)ev(is)}function zN(){for(;is!==null&&!$o();)ev(is)}function ev(p){var g=rv(p.alternate,p,dc);p.memoizedProps=p.pendingProps,g===null?NI(p):is=g,zE.current=null}function NI(p){var g=p;do{var T=g.alternate;if(p=g.return,(g.flags&32768)===0){if(T=VE(T,g,dc),T!==null){is=T;return}}else{if(T=BN(T,g),T!==null){T.flags&=32767,is=T;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{ws=6,is=null;return}}if(g=g.sibling,g!==null){is=g;return}is=g=p}while(g!==null);ws===0&&(ws=5)}function jp(p,g,T){var O=cr,U=jc.transition;try{jc.transition=null,cr=1,GN(p,g,T,O)}finally{jc.transition=U,cr=O}return null}function GN(p,g,T,O){do Pm();while(cu!==null);if((Or&6)!==0)throw Error(s(327));T=p.finishedWork;var U=p.finishedLanes;if(T===null)return null;if(p.finishedWork=null,p.finishedLanes=0,T===p.current)throw Error(s(177));p.callbackNode=null,p.callbackPriority=0;var H=T.lanes|T.childLanes;if(Xr(p,H),p===Xs&&(is=Xs=null,Ts=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||Am||(Am=!0,v_(Aa,function(){return Pm(),null})),H=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||H){H=jc.transition,jc.transition=null;var le=cr;cr=1;var Ie=Or;Or|=4,zE.current=null,Db(p,T),Ub(T,p),Y0(Yg),Ce=!!uE,Yg=uE=null,p.current=T,Rm(T),Wd(),Or=Ie,cr=le,jc.transition=H}else p.current=T;if(Am&&(Am=!1,cu=p,qE=U),H=p.pendingLanes,H===0&&(sh=null),Yf(T.stateNode),Oo(p,$r()),g!==null)for(O=p.onRecoverableError,T=0;T<g.length;T++)U=g[T],O(U.value,{componentStack:U.stack,digest:U.digest});if(KE)throw KE=!1,p=Fb,Fb=null,p;return(qE&1)!==0&&p.tag!==0&&Pm(),H=p.pendingLanes,(H&1)!==0?p===jb?Vp++:(Vp=0,jb=p):Vp=0,Qd(),null}function Pm(){if(cu!==null){var p=Ac(qE),g=jc.transition,T=cr;try{if(jc.transition=null,cr=16>p?16:p,cu===null)var O=!1;else{if(p=cu,cu=null,qE=0,(Or&6)!==0)throw Error(s(331));var U=Or;for(Or|=4,tn=p.current;tn!==null;){var H=tn,le=H.child;if((tn.flags&16)!==0){var Ie=H.deletions;if(Ie!==null){for(var Ue=0;Ue<Ie.length;Ue++){var rt=Ie[Ue];for(tn=rt;tn!==null;){var Ot=tn;switch(Ot.tag){case 0:case 11:case 15:p_(8,Ot,H)}var kt=Ot.child;if(kt!==null)kt.return=Ot,tn=kt;else for(;tn!==null;){Ot=tn;var Pt=Ot.sibling,qt=Ot.return;if(CI(Ot),Ot===rt){tn=null;break}if(Pt!==null){Pt.return=qt,tn=Pt;break}tn=qt}}}var rn=H.alternate;if(rn!==null){var sn=rn.child;if(sn!==null){rn.child=null;do{var ss=sn.sibling;sn.sibling=null,sn=ss}while(sn!==null)}}tn=H}}if((H.subtreeFlags&2064)!==0&&le!==null)le.return=H,tn=le;else e:for(;tn!==null;){if(H=tn,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:p_(9,H,H.return)}var Xe=H.sibling;if(Xe!==null){Xe.return=H.return,tn=Xe;break e}tn=H.return}}var Fe=p.current;for(tn=Fe;tn!==null;){le=tn;var et=le.child;if((le.subtreeFlags&2064)!==0&&et!==null)et.return=le,tn=et;else e:for(le=Fe;tn!==null;){if(Ie=tn,(Ie.flags&2048)!==0)try{switch(Ie.tag){case 0:case 11:case 15:f_(9,Ie)}}catch(an){$i(Ie,Ie.return,an)}if(Ie===le){tn=null;break e}var Lt=Ie.sibling;if(Lt!==null){Lt.return=Ie.return,tn=Lt;break e}tn=Ie.return}}if(Or=U,Qd(),Co&&typeof Co.onPostCommitFiberRoot=="function")try{Co.onPostCommitFiberRoot(Kl,p)}catch{}O=!0}return O}finally{cr=T,jc.transition=g}}return!1}function tv(p,g,T){g=Tm(T,g),g=Ab(p,g,1),p=th(p,g,1),g=uo(),p!==null&&(Xl(p,1,g),Oo(p,g))}function $i(p,g,T){if(p.tag===3)tv(p,p,T);else for(;g!==null;){if(g.tag===3){tv(g,p,T);break}else if(g.tag===1){var O=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(sh===null||!sh.has(O))){p=Tm(T,p),p=sd(g,p,1),g=th(g,p,1),p=uo(),g!==null&&(Xl(g,1,p),Oo(g,p));break}}g=g.return}}function DI(p,g,T){var O=p.pingCache;O!==null&&O.delete(g),g=uo(),p.pingedLanes|=p.suspendedLanes&T,Xs===p&&(Ts&T)===T&&(ws===4||ws===3&&(Ts&130023424)===Ts&&500>$r()-$E?oh(p,0):HE|=T),Oo(p,g)}function zb(p,g){g===0&&((p.mode&1)===0?g=1:(g=_r,_r<<=1,(_r&130023424)===0&&(_r=4194304)));var T=uo();p=nd(p,g),p!==null&&(Xl(p,g,T),Oo(p,T))}function nv(p){var g=p.memoizedState,T=0;g!==null&&(T=g.retryLane),zb(p,T)}function xI(p,g){var T=0;switch(p.tag){case 13:var O=p.stateNode,U=p.memoizedState;U!==null&&(T=U.retryLane);break;case 19:O=p.stateNode;break;default:throw Error(s(314))}O!==null&&O.delete(g),zb(p,T)}var rv;rv=function(p,g,T){if(p!==null)if(p.memoizedProps!==g.pendingProps||Na.current)Ua=!0;else{if((p.lanes&T)===0&&(g.flags&128)===0)return Ua=!1,vI(p,g,T);Ua=(p.flags&131072)!==0}else Ua=!1,gi&&(g.flags&1048576)!==0&&gE(g,mE,g.index);switch(g.lanes=0,g.tag){case 2:var O=g.type;ME(p,g),p=g.pendingProps;var U=Pp(g,Ro.current);td(g,T),U=vm(null,g,O,p,U,T);var H=_b();return g.flags|=1,typeof U=="object"&&U!==null&&typeof U.render=="function"&&U.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Da(O)?(H=!0,pE(g)):H=!1,g.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,r_(g),U.updater=PE,g.stateNode=U,U._reactInternals=g,Cb(g,O,p,T),g=kE(null,g,O,!0,H,T)):(g.tag=0,gi&&H&&_E(g),oa(null,g,U,T),g=g.child),g;case 16:O=g.elementType;e:{switch(ME(p,g),p=g.pendingProps,U=O._init,O=U(O._payload),g.type=O,U=g.tag=Bp(O),p=uc(O,p),U){case 0:g=Pb(null,g,O,p,T);break e;case 1:g=gI(null,g,O,p,T);break e;case 11:g=OE(null,g,O,p,T);break e;case 14:g=hI(null,g,O,uc(O.type,p),T);break e}throw Error(s(306,O,""))}return g;case 0:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:uc(O,U),Pb(p,g,O,U,T);case 1:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:uc(O,U),gI(p,g,O,U,T);case 3:e:{if(Ob(g),p===null)throw Error(s(387));O=g.pendingProps,H=g.memoizedState,U=H.element,$R(p,g),bE(g,O,null,T);var le=g.memoizedState;if(O=le.element,H.isDehydrated)if(H={element:O,isDehydrated:!1,cache:le.cache,pendingSuspenseBoundaries:le.pendingSuspenseBoundaries,transitions:le.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){U=Tm(Error(s(423)),g),g=_I(p,g,O,T,U);break e}else if(O!==U){U=Tm(Error(s(424)),g),g=_I(p,g,O,T,U);break e}else for(La=Yd(g.stateNode.containerInfo.firstChild),xa=g,gi=!0,ia=null,T=GR(g,null,O,T),g.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(fm(),O===U){g=su(p,g,T);break e}oa(p,g,O,T)}g=g.child}return g;case 5:return YR(g),p===null&&sb(g),O=g.type,U=g.pendingProps,H=p!==null?p.memoizedProps:null,le=U.children,tb(O,U)?le=null:H!==null&&tb(O,H)&&(g.flags|=32),mI(p,g),oa(p,g,le,T),g.child;case 6:return p===null&&sb(g),null;case 13:return NE(p,g,T);case 4:return hb(g,g.stateNode.containerInfo),O=g.pendingProps,p===null?g.child=mm(g,null,O,T):oa(p,g,O,T),g.child;case 11:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:uc(O,U),OE(p,g,O,U,T);case 7:return oa(p,g,g.pendingProps,T),g.child;case 8:return oa(p,g,g.pendingProps.children,T),g.child;case 12:return oa(p,g,g.pendingProps.children,T),g.child;case 10:e:{if(O=g.type._context,U=g.pendingProps,H=g.memoizedProps,le=U.value,Ci(vE,O._currentValue),O._currentValue=le,H!==null)if(Sl(H.value,le)){if(H.children===U.children&&!Na.current){g=su(p,g,T);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Ie=H.dependencies;if(Ie!==null){le=H.child;for(var Ue=Ie.firstContext;Ue!==null;){if(Ue.context===O){if(H.tag===1){Ue=nu(-1,T&-T),Ue.tag=2;var rt=H.updateQueue;if(rt!==null){rt=rt.shared;var Ot=rt.pending;Ot===null?Ue.next=Ue:(Ue.next=Ot.next,Ot.next=Ue),rt.pending=Ue}}H.lanes|=T,Ue=H.alternate,Ue!==null&&(Ue.lanes|=T),ub(H.return,T,g),Ie.lanes|=T;break}Ue=Ue.next}}else if(H.tag===10)le=H.type===g.type?null:H.child;else if(H.tag===18){if(le=H.return,le===null)throw Error(s(341));le.lanes|=T,Ie=le.alternate,Ie!==null&&(Ie.lanes|=T),ub(le,T,g),le=H.sibling}else le=H.child;if(le!==null)le.return=H;else for(le=H;le!==null;){if(le===g){le=null;break}if(H=le.sibling,H!==null){H.return=le.return,le=H;break}le=le.return}H=le}oa(p,g,U.children,T),g=g.child}return g;case 9:return U=g.type,O=g.pendingProps.children,td(g,T),U=Uc(U),O=O(U),g.flags|=1,oa(p,g,O,T),g.child;case 14:return O=g.type,U=uc(O,g.pendingProps),U=uc(O.type,U),hI(p,g,O,U,T);case 15:return pI(p,g,g.type,g.pendingProps,T);case 17:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:uc(O,U),ME(p,g),g.tag=1,Da(O)?(p=!0,pE(g)):p=!1,td(g,T),aI(g,O,U),Cb(g,O,U,T),kE(null,g,O,!0,p,T);case 19:return LE(p,g,T);case 22:return fI(p,g,T)}throw Error(s(156,g.tag))};function v_(p,g){return Bd(p,g)}function iv(p,g,T,O){this.tag=p,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hc(p,g,T,O){return new iv(p,g,T,O)}function ah(p){return p=p.prototype,!(!p||!p.isReactComponent)}function Bp(p){if(typeof p=="function")return ah(p)?1:0;if(p!=null){if(p=p.$$typeof,p===pe)return 11;if(p===We)return 14}return 2}function cd(p,g){var T=p.alternate;return T===null?(T=hc(p.tag,g,p.key,p.mode),T.elementType=p.elementType,T.type=p.type,T.stateNode=p.stateNode,T.alternate=p,p.alternate=T):(T.pendingProps=g,T.type=p.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=p.flags&14680064,T.childLanes=p.childLanes,T.lanes=p.lanes,T.child=p.child,T.memoizedProps=p.memoizedProps,T.memoizedState=p.memoizedState,T.updateQueue=p.updateQueue,g=p.dependencies,T.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},T.sibling=p.sibling,T.index=p.index,T.ref=p.ref,T}function sv(p,g,T,O,U,H){var le=2;if(O=p,typeof p=="function")ah(p)&&(le=1);else if(typeof p=="string")le=5;else e:switch(p){case Y:return Wp(T.children,U,H,g);case X:le=8,U|=8;break;case Z:return p=hc(12,T,g,U|2),p.elementType=Z,p.lanes=H,p;case ue:return p=hc(13,T,g,U),p.elementType=ue,p.lanes=H,p;case Le:return p=hc(19,T,g,U),p.elementType=Le,p.lanes=H,p;case ve:return ch(T,U,H,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case se:le=10;break e;case me:le=9;break e;case pe:le=11;break e;case We:le=14;break e;case $e:le=16,O=null;break e}throw Error(s(130,p==null?p:typeof p,""))}return g=hc(le,T,g,U),g.elementType=p,g.type=O,g.lanes=H,g}function Wp(p,g,T,O){return p=hc(7,p,O,g),p.lanes=T,p}function ch(p,g,T,O){return p=hc(22,p,O,g),p.elementType=ve,p.lanes=T,p.stateNode={isHidden:!1},p}function Gb(p,g,T){return p=hc(6,p,null,g),p.lanes=T,p}function Hb(p,g,T){return g=hc(4,p.children!==null?p.children:[],p.key,g),g.lanes=T,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function HN(p,g,T,O,U){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_l(0),this.expirationTimes=_l(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_l(0),this.identifierPrefix=O,this.onRecoverableError=U,this.mutableSourceEagerHydrationData=null}function $b(p,g,T,O,U,H,le,Ie,Ue){return p=new HN(p,g,T,Ie,Ue),g===1?(g=1,H===!0&&(g|=8)):g=0,H=hc(3,null,null,g),p.current=H,H.stateNode=p,H.memoizedState={element:O,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},r_(H),p}function $N(p,g,T){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:de,key:O==null?null:""+O,children:p,containerInfo:g,implementation:T}}function LI(p){if(!p)return Jd;p=p._reactInternals;e:{if(bi(p)!==p||p.tag!==1)throw Error(s(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Da(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(s(171))}if(p.tag===1){var T=p.type;if(Da(T))return hE(p,T,g)}return g}function ov(p,g,T,O,U,H,le,Ie,Ue){return p=$b(T,O,!0,p,U,H,le,Ie,Ue),p.context=LI(null),T=p.current,O=uo(),U=Bc(T),H=nu(O,U),H.callback=g??null,th(T,H,U),p.current.lanes=U,Xl(p,U,O),Oo(p,O),p}function S_(p,g,T,O){var U=g.current,H=uo(),le=Bc(U);return T=LI(T),g.context===null?g.context=T:g.pendingContext=T,g=nu(H,le),g.payload={element:p},O=O===void 0?null:O,O!==null&&(g.callback=O),p=th(U,g,le),p!==null&&(Wc(p,U,le,H),i_(p,U,le)),le}function av(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function Kb(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var T=p.retryLane;p.retryLane=T!==0&&T<g?T:g}}function qb(p,g){Kb(p,g),(p=p.alternate)&&Kb(p,g)}function b_(){return null}var Tl=typeof reportError=="function"?reportError:function(p){console.error(p)};function cv(p){this._internalRoot=p}lv.prototype.render=cv.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(s(409));S_(p,g,null,null)},lv.prototype.unmount=cv.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;ad(function(){S_(null,p,null,null)}),g[Dc]=null}};function lv(p){this._internalRoot=p}lv.prototype.unstable_scheduleHydration=function(p){if(p){var g=gp();p={blockedOn:null,target:p,priority:g};for(var T=0;T<Qo.length&&g!==0&&g<Qo[T].priority;T++);Qo.splice(T,0,p),T===0&&yp(p)}};function Yb(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Om(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function Xb(){}function KN(p,g,T,O,U){if(U){if(typeof O=="function"){var H=O;O=function(){var rt=av(le);H.call(rt)}}var le=ov(g,O,p,0,null,!1,!1,"",Xb);return p._reactRootContainer=le,p[Dc]=le.current,wp(p.nodeType===8?p.parentNode:p),ad(),le}for(;U=p.lastChild;)p.removeChild(U);if(typeof O=="function"){var Ie=O;O=function(){var rt=av(Ue);Ie.call(rt)}}var Ue=$b(p,0,!1,null,null,!1,!1,"",Xb);return p._reactRootContainer=Ue,p[Dc]=Ue.current,wp(p.nodeType===8?p.parentNode:p),ad(function(){S_(g,Ue,T,O)}),Ue}function zp(p,g,T,O,U){var H=T._reactRootContainer;if(H){var le=H;if(typeof U=="function"){var Ie=U;U=function(){var Ue=av(le);Ie.call(Ue)}}S_(g,le,p,U)}else le=KN(T,g,p,U,O);return av(le)}Xf=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var T=ql(g.pendingLanes);T!==0&&(sc(g,T|1),Oo(g,$r()),(Or&6)===0&&(Im=$r()+500,Qd()))}break;case 13:ad(function(){var O=nd(p,1);if(O!==null){var U=uo();Wc(O,p,1,U)}}),qb(p,1)}},Jl=function(p){if(p.tag===13){var g=nd(p,134217728);if(g!==null){var T=uo();Wc(g,p,134217728,T)}qb(p,134217728)}},$d=function(p){if(p.tag===13){var g=Bc(p),T=nd(p,g);if(T!==null){var O=uo();Wc(T,p,g,O)}qb(p,g)}},gp=function(){return cr},Jf=function(p,g){var T=cr;try{return cr=p,g()}finally{cr=T}},Rc=function(p,g,T){switch(g){case"input":if($t(p,T),g=T.name,T.type==="radio"&&g!=null){for(T=p;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<T.length;g++){var O=T[g];if(O!==p&&O.form===p.form){var U=dm(O);if(!U)throw Error(s(90));Ft(O),$t(O,U)}}}break;case"textarea":Bt(p,T);break;case"select":g=T.value,g!=null&&ht(p,!!T.multiple,g,!1)}},pl=y_,Ia=ad;var lh={usingClientEntryPoint:!1,Events:[um,Ip,dm,Ra,tc,y_]},ld={findFiberByHostInstance:Rp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},qN={bundleType:ld.bundleType,version:ld.version,rendererPackageName:ld.rendererPackageName,rendererConfig:ld.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ce.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=jd(p),p===null?null:p.stateNode},findFiberByHostInstance:ld.findFiberByHostInstance||b_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uv.isDisabled&&uv.supportsFiber)try{Kl=uv.inject(qN),Co=uv}catch{}}return nl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lh,nl.createPortal=function(p,g){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Yb(g))throw Error(s(200));return $N(p,g,null,T)},nl.createRoot=function(p,g){if(!Yb(p))throw Error(s(299));var T=!1,O="",U=Tl;return g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(O=g.identifierPrefix),g.onRecoverableError!==void 0&&(U=g.onRecoverableError)),g=$b(p,1,!1,null,null,T,!1,O,U),p[Dc]=g.current,wp(p.nodeType===8?p.parentNode:p),new cv(g)},nl.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(s(188)):(p=Object.keys(p).join(","),Error(s(268,p)));return p=jd(g),p=p===null?null:p.stateNode,p},nl.flushSync=function(p){return ad(p)},nl.hydrate=function(p,g,T){if(!Om(g))throw Error(s(200));return zp(null,p,g,!0,T)},nl.hydrateRoot=function(p,g,T){if(!Yb(p))throw Error(s(405));var O=T!=null&&T.hydratedSources||null,U=!1,H="",le=Tl;if(T!=null&&(T.unstable_strictMode===!0&&(U=!0),T.identifierPrefix!==void 0&&(H=T.identifierPrefix),T.onRecoverableError!==void 0&&(le=T.onRecoverableError)),g=ov(g,null,p,1,T??null,U,!1,H,le),p[Dc]=g.current,wp(p),O)for(p=0;p<O.length;p++)T=O[p],U=T._getVersion,U=U(T._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[T,U]:g.mutableSourceEagerHydrationData.push(T,U);return new lv(g)},nl.render=function(p,g,T){if(!Om(g))throw Error(s(200));return zp(null,p,g,!1,T)},nl.unmountComponentAtNode=function(p){if(!Om(p))throw Error(s(40));return p._reactRootContainer?(ad(function(){zp(null,null,p,!1,function(){p._reactRootContainer=null,p[Dc]=null})}),!0):!1},nl.unstable_batchedUpdates=y_,nl.unstable_renderSubtreeIntoContainer=function(p,g,T,O){if(!Om(T))throw Error(s(200));if(p==null||p._reactInternals===void 0)throw Error(s(38));return zp(p,g,T,!1,O)},nl.version="18.3.1-next-f1338f8080-20240426",nl}var X$;function OQ(){if(X$)return B2.exports;X$=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),B2.exports=yye(),B2.exports}var J$;function Eye(){if(J$)return eO;J$=1;var n=OQ();return eO.createRoot=n.createRoot,eO.hydrateRoot=n.hydrateRoot,eO}var vye=Eye();const Sye=Ng(vye);function bye(n,t,s,a){return n.addEventListener(t,s,a),()=>{n.removeEventListener(t,s,a)}}function o1(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function Tye(){return!!(globalThis!=null&&globalThis.document)}function kQ(n){return n.parentElement&&kQ(n.parentElement)?!0:n.hidden}function wye(n){const t=n.getAttribute("contenteditable");return t!=="false"&&t!=null}function Cye(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function Rye(n){var t;return((t=NQ(n))==null?void 0:t.defaultView)??window}function NQ(n){return o1(n)?n.ownerDocument:document}function Iye(n){return n.view??window}function Aye(n){return NQ(n).activeElement}function Pye(n){const t=Iye(n);return typeof t.PointerEvent<"u"&&n instanceof t.PointerEvent?n.pointerType==="mouse":n instanceof t.MouseEvent}function DQ(n){return!!n.touches}function Oye(n){return DQ(n)&&n.touches.length>1}function kye(n,t="page"){const s=n.touches[0]||n.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function Nye(n,t="page"){return{x:n[`${t}X`],y:n[`${t}Y`]}}function xQ(n,t="page"){return DQ(n)?kye(n,t):Nye(n,t)}function Dye(n){return t=>{const s=Pye(t);(!s||s&&t.button===0)&&n(t)}}function xye(n,t=!1){function s(l){n(l,{point:xQ(l)})}return t?Dye(s):s}function kO(n,t,s,a){return bye(n,t,xye(s,t==="pointerdown"),a)}function Lye(n,...t){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const s={...n};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in s&&delete s[l],s[l]=a[l]);return s}const er=n=>n?"":void 0,Cf=n=>n?!0:void 0;function Mye(n){return Array.isArray(n)}function Du(n){const t=typeof n;return n!=null&&(t==="object"||t==="function")&&!Mye(n)}function Uye(n){const t=n==null?0:n.length;return t?n[t-1]:void 0}function Vye(n){const t=parseFloat(n.toString()),s=n.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}}function pU(n){if(n==null)return n;const{unitless:t}=Vye(n);return t||typeof n=="number"?`${n}px`:n}const LQ=(n,t)=>parseInt(n[1],10)>parseInt(t[1],10)?1:-1,eF=n=>Object.fromEntries(Object.entries(n).sort(LQ));function Q$(n){const t=eF(n);return Object.assign(Object.values(t),t)}function Fye(n){const t=Object.keys(eF(n));return new Set(t)}function Z$(n){if(!n)return n;n=pU(n)??n;const t=-.02;return typeof n=="number"?`${n+t}`:n.replace(/(\d+\.?\d*)/u,s=>`${parseFloat(s)+t}`)}function Aw(n,t){const s=["@media screen"];return n&&s.push("and",`(min-width: ${pU(n)})`),t&&s.push("and",`(max-width: ${pU(t)})`),s.join(" ")}function jye(n){if(!n)return null;n.base=n.base??"0px";const t=Q$(n),s=Object.entries(n).sort(LQ).map(([d,f],y,v)=>{let[,b]=v[y+1]??[];return b=parseFloat(b)>0?Z$(b):void 0,{_minW:Z$(f),breakpoint:d,minW:f,maxW:b,maxWQuery:Aw(null,b),minWQuery:Aw(f),minMaxQuery:Aw(f,b)}}),a=Fye(n),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const f=Object.keys(d);return f.length>0&&f.every(y=>a.has(y))},asObject:eF(n),asArray:Q$(n),details:s,get(d){return s.find(f=>f.breakpoint===d)},media:[null,...t.map(d=>Aw(d)).slice(1)],toArrayValue(d){if(!Du(d))throw new Error("toArrayValue: value must be an object");const f=l.map(y=>d[y]??null);for(;Uye(f)===null;)f.pop();return f},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((f,y,v)=>{const b=l[v];return b!=null&&y!=null&&(f[b]=y),f},{})}}}function MQ(...n){return function(...s){n.forEach(a=>a==null?void 0:a(...s))}}function kn(...n){return function(s){n.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}function tF(n){return D.Children.toArray(n).filter(t=>D.isValidElement(t))}function a1(n){const t=Object.assign({},n);for(let s in t)t[s]===void 0&&delete t[s];return t}function Bye(n,t){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Oi(n={}){const{name:t,strict:s=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:f}=n,y=D.createContext(f);y.displayName=t;function v(){var w;const b=D.useContext(y);if(!b&&s){const I=new Error(d??Bye(a,l));throw I.name="ContextError",(w=Error.captureStackTrace)==null||w.call(Error,I,v),I}return b}return[y.Provider,v,y]}const pn=(...n)=>n.filter(Boolean).join(" "),UQ=n=>n.hasAttribute("tabindex"),Wye=n=>UQ(n)&&n.tabIndex===-1;function yk(n){if(!o1(n)||kQ(n)||Cye(n))return!1;const{localName:t}=n;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return t in a?a[t]():wye(n)?!0:UQ(n)}function zye(n){return n?o1(n)&&yk(n)&&!Wye(n):!1}const Gye=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],Hye=Gye.join(),$ye=n=>n.offsetWidth>0&&n.offsetHeight>0;function VQ(n){const t=Array.from(n.querySelectorAll(Hye));return t.unshift(n),t.filter(s=>yk(s)&&$ye(s))}function Kye(n,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?s:n}const qye=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const y=t.get(a);if(y.has(l))return y.get(l);const v=n(a,l,d,f);return y.set(l,v),v}},FQ=qye(Kye),Yye=n=>n.default||n;function nF(n){const{wasSelected:t,enabled:s,isSelected:a,mode:l="unmount"}=n;return!!(!s||a||l==="keepMounted"&&t)}function Xye(n){const t=parseFloat(n);return typeof t!="number"||Number.isNaN(t)?0:t}function rF(n,t){let s=Xye(n);const a=10**(t??10);return s=Math.round(s*a)/a,t?s.toFixed(t):s.toString()}function fU(n){if(!Number.isFinite(n))return 0;let t=1,s=0;for(;Math.round(n*t)/t!==n;)t*=10,s+=1;return s}function eK(n,t,s){return(n-t)*100/(s-t)}function Jye(n,t,s){return(s-t)*n+t}function tK(n,t,s){const a=Math.round((n-t)/s)*s+t,l=fU(s);return rF(a,l)}function NO(n,t,s){return n==null?n:(s<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,t),s))}function N0(n,t=[]){const s=Object.assign({},n);for(const a of t)a in s&&delete s[a];return s}function jQ(n,t){const s={};for(const a of t)a in n&&(s[a]=n[a]);return s}function iF(n,t){return Array.isArray(n)?n.map(s=>s===null?null:t(s)):Du(n)?Object.keys(n).reduce((s,a)=>(s[a]=t(n[a]),s),{}):n!=null?t(n):null}const Qye=n=>typeof n=="function";function cl(n,...t){return Qye(n)?n(...t):n}function Zye(n){const t=n.ownerDocument.defaultView||window,{overflow:s,overflowX:a,overflowY:l}=t.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(s+l+a)}function eEe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function BQ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:o1(n)&&Zye(n)?n:BQ(eEe(n))}function tEe(n,t){const s={},a={};for(const[l,d]of Object.entries(n))t.includes(l)?s[l]=d:a[l]=d;return[s,a]}function nEe(n,...t){const s=Object.getOwnPropertyDescriptors(n),a=Object.keys(s),l=f=>{const y={};for(let v=0;v<f.length;v++){const b=f[v];s[b]&&(Object.defineProperty(y,b,s[b]),delete s[b])}return y},d=f=>l(Array.isArray(f)?f:a.filter(f));return t.map(d).concat(l(a))}function nK(n,t,s={}){const{stop:a,getKey:l}=s;function d(f,y=[]){if(Du(f)||Array.isArray(f)){const v={};for(const[b,w]of Object.entries(f)){const I=(l==null?void 0:l(b))??b,k=[...y,I];if(a!=null&&a(f,k))return t(f,y);v[I]=d(w,k)}return v}return t(f,y)}return d(n)}var Pw={exports:{}};Pw.exports;var rK;function rEe(){return rK||(rK=1,function(n,t){var s=200,a="__lodash_hash_undefined__",l=800,d=16,f=9007199254740991,y="[object Arguments]",v="[object Array]",b="[object AsyncFunction]",w="[object Boolean]",I="[object Date]",k="[object Error]",L="[object Function]",V="[object GeneratorFunction]",B="[object Map]",W="[object Number]",Q="[object Null]",$="[object Object]",ie="[object Proxy]",ce="[object RegExp]",ne="[object Set]",de="[object String]",Y="[object Undefined]",X="[object WeakMap]",Z="[object ArrayBuffer]",se="[object DataView]",me="[object Float32Array]",pe="[object Float64Array]",ue="[object Int8Array]",Le="[object Int16Array]",We="[object Int32Array]",$e="[object Uint8Array]",ve="[object Uint8ClampedArray]",_e="[object Uint16Array]",Ee="[object Uint32Array]",ke=/[\\^$.*+?()[\]{}|]/g,Te=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,Pe={};Pe[me]=Pe[pe]=Pe[ue]=Pe[Le]=Pe[We]=Pe[$e]=Pe[ve]=Pe[_e]=Pe[Ee]=!0,Pe[y]=Pe[v]=Pe[Z]=Pe[w]=Pe[se]=Pe[I]=Pe[k]=Pe[L]=Pe[B]=Pe[W]=Pe[$]=Pe[ce]=Pe[ne]=Pe[de]=Pe[X]=!1;var xe=typeof py=="object"&&py&&py.Object===Object&&py,ze=typeof self=="object"&&self&&self.Object===Object&&self,Je=xe||ze||Function("return this")(),Ze=t&&!t.nodeType&&t,lt=Ze&&!0&&n&&!n.nodeType&&n,nt=lt&&lt.exports===Ze,Rt=nt&&xe.process,fn=function(){try{var Ce=lt&&lt.require&&lt.require("util").types;return Ce||Rt&&Rt.binding&&Rt.binding("util")}catch{}}(),Ft=fn&&fn.isTypedArray;function on(Ce,De,tt){switch(tt.length){case 0:return Ce.call(De);case 1:return Ce.call(De,tt[0]);case 2:return Ce.call(De,tt[0],tt[1]);case 3:return Ce.call(De,tt[0],tt[1],tt[2])}return Ce.apply(De,tt)}function Zt(Ce,De){for(var tt=-1,Jt=Array(Ce);++tt<Ce;)Jt[tt]=De(tt);return Jt}function Yt(Ce){return function(De){return Ce(De)}}function Vn(Ce,De){return Ce==null?void 0:Ce[De]}function $t(Ce,De){return function(tt){return Ce(De(tt))}}var Re=Array.prototype,Ve=Function.prototype,Ge=Object.prototype,ht=Je["__core-js_shared__"],mt=Ve.toString,vt=Ge.hasOwnProperty,Bt=function(){var Ce=/[^.]+$/.exec(ht&&ht.keys&&ht.keys.IE_PROTO||"");return Ce?"Symbol(src)_1."+Ce:""}(),mn=Ge.toString,En=mt.call(Object),en=RegExp("^"+mt.call(vt).replace(ke,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Et=nt?Je.Buffer:void 0,nr=Je.Symbol,Nt=Je.Uint8Array;Et&&Et.allocUnsafe;var Ut=$t(Object.getPrototypeOf,Object),gn=Object.create,ki=Ge.propertyIsEnumerable,_s=Re.splice,ii=nr?nr.toStringTag:void 0,Ho=function(){try{var Ce=ic(Object,"defineProperty");return Ce({},"",{}),Ce}catch{}}(),ec=Et?Et.isBuffer:void 0,Ks=Math.max,qs=Date.now,Rc=ic(Je,"Map"),ys=ic(Object,"create"),Ca=function(){function Ce(){}return function(De){if(!Pc(De))return{};if(gn)return gn(De);Ce.prototype=De;var tt=new Ce;return Ce.prototype=void 0,tt}}();function To(Ce){var De=-1,tt=Ce==null?0:Ce.length;for(this.clear();++De<tt;){var Jt=Ce[De];this.set(Jt[0],Jt[1])}}function Ra(){this.__data__=ys?ys(null):{},this.size=0}function tc(Ce){var De=this.has(Ce)&&delete this.__data__[Ce];return this.size-=De?1:0,De}function pl(Ce){var De=this.__data__;if(ys){var tt=De[Ce];return tt===a?void 0:tt}return vt.call(De,Ce)?De[Ce]:void 0}function Ia(Ce){var De=this.__data__;return ys?De[Ce]!==void 0:vt.call(De,Ce)}function nc(Ce,De){var tt=this.__data__;return this.size+=this.has(Ce)?0:1,tt[Ce]=ys&&De===void 0?a:De,this}To.prototype.clear=Ra,To.prototype.delete=tc,To.prototype.get=pl,To.prototype.has=Ia,To.prototype.set=nc;function io(Ce){var De=-1,tt=Ce==null?0:Ce.length;for(this.clear();++De<tt;){var Jt=Ce[De];this.set(Jt[0],Jt[1])}}function Ni(){this.__data__=[],this.size=0}function gt(Ce){var De=this.__data__,tt=Wd(De,Ce);if(tt<0)return!1;var Jt=De.length-1;return tt==Jt?De.pop():_s.call(De,tt,1),--this.size,!0}function dn(Ce){var De=this.__data__,tt=Wd(De,Ce);return tt<0?void 0:De[tt][1]}function gr(Ce){return Wd(this.__data__,Ce)>-1}function fi(Ce,De){var tt=this.__data__,Jt=Wd(tt,Ce);return Jt<0?(++this.size,tt.push([Ce,De])):tt[Jt][1]=De,this}io.prototype.clear=Ni,io.prototype.delete=gt,io.prototype.get=dn,io.prototype.has=gr,io.prototype.set=fi;function wo(Ce){var De=-1,tt=Ce==null?0:Ce.length;for(this.clear();++De<tt;){var Jt=Ce[De];this.set(Jt[0],Jt[1])}}function so(){this.size=0,this.__data__={hash:new To,map:new(Rc||io),string:new To}}function Hl(Ce){var De=zu(this,Ce).delete(Ce);return this.size-=De?1:0,De}function pp(Ce){return zu(this,Ce).get(Ce)}function fl(Ce){return zu(this,Ce).has(Ce)}function $l(Ce,De){var tt=zu(this,Ce),Jt=tt.size;return tt.set(Ce,De),this.size+=tt.size==Jt?0:1,this}wo.prototype.clear=so,wo.prototype.delete=Hl,wo.prototype.get=pp,wo.prototype.has=fl,wo.prototype.set=$l;function bi(Ce){var De=this.__data__=new io(Ce);this.size=De.size}function oo(){this.__data__=new io,this.size=0}function Fi(Ce){var De=this.__data__,tt=De.delete(Ce);return this.size=De.size,tt}function Fd(Ce){return this.__data__.get(Ce)}function jd(Ce){return this.__data__.has(Ce)}function rc(Ce,De){var tt=this.__data__;if(tt instanceof io){var Jt=tt.__data__;if(!Rc||Jt.length<s-1)return Jt.push([Ce,De]),this.size=++tt.size,this;tt=this.__data__=new wo(Jt)}return tt.set(Ce,De),this.size=tt.size,this}bi.prototype.clear=oo,bi.prototype.delete=Fi,bi.prototype.get=Fd,bi.prototype.has=jd,bi.prototype.set=rc;function Bd(Ce,De){var tt=Yo(Ce),Jt=!tt&&us(Ce),Qn=!tt&&!Jt&&Jo(Ce),wr=!tt&&!Jt&&!Qn&&yp(Ce),Kr=tt||Jt||Qn||wr,hn=Kr?Zt(Ce.length,String):[],Fr=hn.length;for(var wi in Ce)Kr&&(wi=="length"||Qn&&(wi=="offset"||wi=="parent")||wr&&(wi=="buffer"||wi=="byteLength"||wi=="byteOffset")||_l(wi,Fr))||hn.push(wi);return hn}function Wu(Ce,De,tt){(tt!==void 0&&!qo(Ce[De],tt)||tt===void 0&&!(De in Ce))&&$r(Ce,De,tt)}function $o(Ce,De,tt){var Jt=Ce[De];(!(vt.call(Ce,De)&&qo(Jt,tt))||tt===void 0&&!(De in Ce))&&$r(Ce,De,tt)}function Wd(Ce,De){for(var tt=Ce.length;tt--;)if(qo(Ce[tt][0],De))return tt;return-1}function $r(Ce,De,tt){De=="__proto__"&&Ho?Ho(Ce,De,{configurable:!0,enumerable:!0,value:tt,writable:!0}):Ce[De]=tt}var Ti=Yl();function Ic(Ce){return Ce==null?Ce===void 0?Y:Q:ii&&ii in Object(Ce)?Ko(Ce):Xf(Ce)}function ml(Ce){return Es(Ce)&&Ic(Ce)==y}function Aa(Ce){if(!Pc(Ce)||sc(Ce))return!1;var De=Qo(Ce)?en:Te;return De.test(_p(Ce))}function fp(Ce){return Es(Ce)&&Qf(Ce.length)&&!!Pe[Ic(Ce)]}function zd(Ce){if(!Pc(Ce))return Ac(Ce);var De=cr(Ce),tt=[];for(var Jt in Ce)Jt=="constructor"&&(De||!vt.call(Ce,Jt))||tt.push(Jt);return tt}function Kl(Ce,De,tt,Jt,Qn){Ce!==De&&Ti(De,function(wr,Kr){if(Qn||(Qn=new bi),Pc(wr))Co(Ce,De,Kr,tt,Kl,Jt,Qn);else{var hn=Jt?Jt($d(Ce,Kr),wr,Kr+"",Ce,De,Qn):void 0;hn===void 0&&(hn=wr),Wu(Ce,Kr,hn)}},Zl)}function Co(Ce,De,tt,Jt,Qn,wr,Kr){var hn=$d(Ce,tt),Fr=$d(De,tt),wi=Kr.get(Fr);if(wi){Wu(Ce,tt,wi);return}var Ms=wr?wr(hn,Fr,tt+"",Ce,De,Kr):void 0,Zo=Ms===void 0;if(Zo){var ea=Yo(Fr),$u=!ea&&Jo(Fr),rs=!ea&&!$u&&yp(Fr);Ms=Fr,ea||$u||rs?Yo(hn)?Ms=hn:Ql(hn)?Ms=Hd(hn):$u?(Zo=!1,Ms=mp(Fr)):rs?(Zo=!1,Ms=Gd(Fr)):Ms=[]:Hu(Fr)||us(Fr)?(Ms=hn,us(hn)?Ms=yl(hn):(!Pc(hn)||Qo(hn))&&(Ms=Gu(Fr))):Zo=!1}Zo&&(Kr.set(Fr,Ms),Qn(Ms,Fr,Jt,wr,Kr),Kr.delete(Fr)),Wu(Ce,tt,Ms)}function Yf(Ce,De){return gp(Jl(Ce,De,Oa),Ce+"")}var ao=Ho?function(Ce,De){return Ho(Ce,"toString",{configurable:!0,enumerable:!1,value:Pa(De),writable:!0})}:Oa;function mp(Ce,De){return Ce.slice()}function gl(Ce){var De=new Ce.constructor(Ce.byteLength);return new Nt(De).set(new Nt(Ce)),De}function Gd(Ce,De){var tt=gl(Ce.buffer);return new Ce.constructor(tt,Ce.byteOffset,Ce.length)}function Hd(Ce,De){var tt=-1,Jt=Ce.length;for(De||(De=Array(Jt));++tt<Jt;)De[tt]=Ce[tt];return De}function _r(Ce,De,tt,Jt){var Qn=!tt;tt||(tt={});for(var wr=-1,Kr=De.length;++wr<Kr;){var hn=De[wr],Fr=void 0;Fr===void 0&&(Fr=Ce[hn]),Qn?$r(tt,hn,Fr):$o(tt,hn,Fr)}return tt}function ql(Ce){return Yf(function(De,tt){var Jt=-1,Qn=tt.length,wr=Qn>1?tt[Qn-1]:void 0,Kr=Qn>2?tt[2]:void 0;for(wr=Ce.length>3&&typeof wr=="function"?(Qn--,wr):void 0,Kr&&Xl(tt[0],tt[1],Kr)&&(wr=Qn<3?void 0:wr,Qn=1),De=Object(De);++Jt<Qn;){var hn=tt[Jt];hn&&Ce(De,hn,Jt,wr)}return De})}function Yl(Ce){return function(De,tt,Jt){for(var Qn=-1,wr=Object(De),Kr=Jt(De),hn=Kr.length;hn--;){var Fr=Kr[++Qn];if(tt(wr[Fr],Fr,wr)===!1)break}return De}}function zu(Ce,De){var tt=Ce.__data__;return Xr(De)?tt[typeof De=="string"?"string":"hash"]:tt.map}function ic(Ce,De){var tt=Vn(Ce,De);return Aa(tt)?tt:void 0}function Ko(Ce){var De=vt.call(Ce,ii),tt=Ce[ii];try{Ce[ii]=void 0;var Jt=!0}catch{}var Qn=mn.call(Ce);return Jt&&(De?Ce[ii]=tt:delete Ce[ii]),Qn}function Gu(Ce){return typeof Ce.constructor=="function"&&!cr(Ce)?Ca(Ut(Ce)):{}}function _l(Ce,De){var tt=typeof Ce;return De=De??f,!!De&&(tt=="number"||tt!="symbol"&&be.test(Ce))&&Ce>-1&&Ce%1==0&&Ce<De}function Xl(Ce,De,tt){if(!Pc(tt))return!1;var Jt=typeof De;return(Jt=="number"?Xo(tt)&&_l(De,tt.length):Jt=="string"&&De in tt)?qo(tt[De],Ce):!1}function Xr(Ce){var De=typeof Ce;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Ce!=="__proto__":Ce===null}function sc(Ce){return!!Bt&&Bt in Ce}function cr(Ce){var De=Ce&&Ce.constructor,tt=typeof De=="function"&&De.prototype||Ge;return Ce===tt}function Ac(Ce){var De=[];if(Ce!=null)for(var tt in Object(Ce))De.push(tt);return De}function Xf(Ce){return mn.call(Ce)}function Jl(Ce,De,tt){return De=Ks(De===void 0?Ce.length-1:De,0),function(){for(var Jt=arguments,Qn=-1,wr=Ks(Jt.length-De,0),Kr=Array(wr);++Qn<wr;)Kr[Qn]=Jt[De+Qn];Qn=-1;for(var hn=Array(De+1);++Qn<De;)hn[Qn]=Jt[Qn];return hn[De]=tt(Kr),on(Ce,this,hn)}}function $d(Ce,De){if(!(De==="constructor"&&typeof Ce[De]=="function")&&De!="__proto__")return Ce[De]}var gp=Jf(ao);function Jf(Ce){var De=0,tt=0;return function(){var Jt=qs(),Qn=d-(Jt-tt);if(tt=Jt,Qn>0){if(++De>=l)return arguments[0]}else De=0;return Ce.apply(void 0,arguments)}}function _p(Ce){if(Ce!=null){try{return mt.call(Ce)}catch{}try{return Ce+""}catch{}}return""}function qo(Ce,De){return Ce===De||Ce!==Ce&&De!==De}var us=ml(function(){return arguments}())?ml:function(Ce){return Es(Ce)&&vt.call(Ce,"callee")&&!ki.call(Ce,"callee")},Yo=Array.isArray;function Xo(Ce){return Ce!=null&&Qf(Ce.length)&&!Qo(Ce)}function Ql(Ce){return Es(Ce)&&Xo(Ce)}var Jo=ec||El;function Qo(Ce){if(!Pc(Ce))return!1;var De=Ic(Ce);return De==L||De==V||De==b||De==ie}function Qf(Ce){return typeof Ce=="number"&&Ce>-1&&Ce%1==0&&Ce<=f}function Pc(Ce){var De=typeof Ce;return Ce!=null&&(De=="object"||De=="function")}function Es(Ce){return Ce!=null&&typeof Ce=="object"}function Hu(Ce){if(!Es(Ce)||Ic(Ce)!=$)return!1;var De=Ut(Ce);if(De===null)return!0;var tt=vt.call(De,"constructor")&&De.constructor;return typeof tt=="function"&&tt instanceof tt&&mt.call(tt)==En}var yp=Ft?Yt(Ft):fp;function yl(Ce){return _r(Ce,Zl(Ce))}function Zl(Ce){return Xo(Ce)?Bd(Ce):zd(Ce)}var Zf=ql(function(Ce,De,tt,Jt){Kl(Ce,De,tt,Jt)});function Pa(Ce){return function(){return Ce}}function Oa(Ce){return Ce}function El(){return!1}n.exports=Zf}(Pw,Pw.exports)),Pw.exports}var iEe=rEe();const zh=Ng(iEe);function Gs(n,t=[]){const s=D.useRef(n);return D.useEffect(()=>{s.current=n}),D.useCallback((...a)=>{var l;return(l=s.current)==null?void 0:l.call(s,...a)},t)}function Ey(n,t,s,a){const l=Gs(s);return D.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!s||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,n,a,l,s]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(t,l,a)}}function WQ(n){const{isOpen:t,ref:s}=n,[a,l]=D.useState(t),[d,f]=D.useState(!1);return D.useEffect(()=>{d||(l(t),f(!0))},[t,d,a]),Ey(()=>s.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var w;const v=Rye(s.current),b=new v.CustomEvent("animationend",{bubbles:!0});(w=s.current)==null||w.dispatchEvent(b)}}}var G2,iK;function sEe(){return iK||(iK=1,G2=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var t=document.activeElement,s=[],a=0;a<n.rangeCount;a++)s.push(n.getRangeAt(a));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||s.forEach(function(l){n.addRange(l)}),t&&t.focus()}}),G2}var H2,sK;function oEe(){if(sK)return H2;sK=1;var n=sEe(),t={"text/plain":"Text","text/html":"Url",default:"Text"},s="Copy to clipboard: #{key}, Enter";function a(d){var f=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return d.replace(/#{\s*key\s*}/g,f)}function l(d,f){var y,v,b,w,I,k,L=!1;f||(f={}),y=f.debug||!1;try{b=n(),w=document.createRange(),I=document.getSelection(),k=document.createElement("span"),k.textContent=d,k.ariaHidden="true",k.style.all="unset",k.style.position="fixed",k.style.top=0,k.style.clip="rect(0, 0, 0, 0)",k.style.whiteSpace="pre",k.style.webkitUserSelect="text",k.style.MozUserSelect="text",k.style.msUserSelect="text",k.style.userSelect="text",k.addEventListener("copy",function(B){if(B.stopPropagation(),f.format)if(B.preventDefault(),typeof B.clipboardData>"u"){y&&console.warn("unable to use e.clipboardData"),y&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var W=t[f.format]||t.default;window.clipboardData.setData(W,d)}else B.clipboardData.clearData(),B.clipboardData.setData(f.format,d);f.onCopy&&(B.preventDefault(),f.onCopy(B.clipboardData))}),document.body.appendChild(k),w.selectNodeContents(k),I.addRange(w);var V=document.execCommand("copy");if(!V)throw new Error("copy command was unsuccessful");L=!0}catch(B){y&&console.error("unable to copy using execCommand: ",B),y&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(f.format||"text",d),f.onCopy&&f.onCopy(window.clipboardData),L=!0}catch(W){y&&console.error("unable to copy using clipboardData: ",W),y&&console.error("falling back to prompt"),v=a("message"in f?f.message:s),window.prompt(v,d)}}finally{I&&(typeof I.removeRange=="function"?I.removeRange(w):I.removeAllRanges()),k&&document.body.removeChild(k),b()}return L}return H2=l,H2}var aEe=oEe();const oK=Ng(aEe);function aK(n,t={}){const[s,a]=D.useState(!1),[l,d]=D.useState(n);D.useEffect(()=>d(n),[n]);const{timeout:f=1500,...y}=typeof t=="number"?{timeout:t}:t,v=D.useCallback(b=>{const w=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(w).then(()=>a(!0)).catch(()=>a(oK(w,y))):a(oK(w,y))},[l,y]);return D.useEffect(()=>{let b=null;return s&&(b=window.setTimeout(()=>{a(!1)},f)),()=>{b&&window.clearTimeout(b)}},[f,s]),{value:l,setValue:d,onCopy:v,hasCopied:s}}function zQ(n){const{value:t,defaultValue:s,onChange:a,shouldUpdate:l=(k,L)=>k!==L}=n,d=Gs(a),f=Gs(l),[y,v]=D.useState(s),b=t!==void 0,w=b?t:y,I=Gs(k=>{const V=typeof k=="function"?k(w):k;f(w,V)&&(b||v(V),d(V))},[b,d,w,f]);return[w,I]}function cEe(n={}){const{onChange:t,precision:s,defaultValue:a,value:l,step:d=1,min:f=Number.MIN_SAFE_INTEGER,max:y=Number.MAX_SAFE_INTEGER,keepWithinRange:v=!0}=n,b=Gs(t),[w,I]=D.useState(()=>a==null?"":$2(a,d,s)??""),k=typeof l<"u",L=k?l:w,V=GQ(sg(L),d),B=s??V,W=D.useCallback(se=>{se!==L&&(k||I(se.toString()),b==null||b(se.toString(),sg(se)))},[b,k,L]),Q=D.useCallback(se=>{let me=se;return v&&(me=NO(me,f,y)),rF(me,B)},[B,v,y,f]),$=D.useCallback((se=d)=>{let me;L===""?me=sg(se):me=sg(L)+se,me=Q(me),W(me)},[Q,d,W,L]),ie=D.useCallback((se=d)=>{let me;L===""?me=sg(-se):me=sg(L)-se,me=Q(me),W(me)},[Q,d,W,L]),ce=D.useCallback(()=>{let se;a==null?se="":se=$2(a,d,s)??f,W(se)},[a,s,d,W,f]),ne=D.useCallback(se=>{const me=$2(se,d,B)??f;W(me)},[B,d,W,f]),de=sg(L);return{isOutOfRange:de>y||de<f,isAtMax:de===y,isAtMin:de===f,precision:B,value:L,valueAsNumber:de,update:W,reset:ce,increment:$,decrement:ie,clamp:Q,cast:ne,setValue:I}}function sg(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function GQ(n,t){return Math.max(fU(t),fU(n))}function $2(n,t,s){const a=sg(n);if(Number.isNaN(a))return;const l=GQ(a,t);return rF(a,s??l)}function Df(n={}){const{onClose:t,onOpen:s,isOpen:a,id:l}=n,d=Gs(s),f=Gs(t),[y,v]=D.useState(n.defaultIsOpen||!1),b=a!==void 0?a:y,w=a!==void 0,I=D.useId(),k=l??`disclosure-${I}`,L=D.useCallback(()=>{w||v(!1),f==null||f()},[w,f]),V=D.useCallback(()=>{w||v(!0),d==null||d()},[w,d]),B=D.useCallback(()=>{b?L():V()},[b,V,L]);function W($={}){return{...$,"aria-expanded":b,"aria-controls":k,onClick(ie){var ce;(ce=$.onClick)==null||ce.call($,ie),B()}}}function Q($={}){return{...$,hidden:!b,id:k}}return{isOpen:b,onOpen:V,onClose:L,onToggle:B,isControlled:w,getButtonProps:W,getDisclosureProps:Q}}const Kh=globalThis!=null&&globalThis.document?D.useLayoutEffect:D.useEffect,xf=(n,t)=>{const s=D.useRef(!1),a=D.useRef(!1);D.useEffect(()=>{if(s.current&&a.current)return n();a.current=!0},t),D.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[])};function lEe(n){const t=n.current;if(!t)return!1;const s=Aye(t);return!s||t.contains(s)?!1:!!zye(s)}function HQ(n,t){const{shouldFocus:s,visible:a,focusRef:l}=t,d=s&&!a;xf(()=>{if(!d||lEe(n))return;const f=(l==null?void 0:l.current)||n.current;let y;if(f)return y=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(y)}},[d,n,l])}const uEe={preventScroll:!0,shouldFocus:!1};function dEe(n,t=uEe){const{focusRef:s,preventScroll:a,shouldFocus:l,visible:d}=t,f=hEe(n)?n.current:n,y=l&&d,v=D.useRef(y),b=D.useRef(d);Kh(()=>{!b.current&&d&&(v.current=y),b.current=d},[d,y]);const w=D.useCallback(()=>{if(!(!d||!f||!v.current)&&(v.current=!1,!f.contains(document.activeElement)))if(s!=null&&s.current)requestAnimationFrame(()=>{var I;(I=s.current)==null||I.focus({preventScroll:a})});else{const I=VQ(f);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:a})})}},[d,a,f,s]);xf(()=>{w()},[w]),Ey(f,"transitionend",w)}function hEe(n){return"current"in n}function pEe(n){return"current"in n}const $Q=()=>typeof window<"u";function fEe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const mEe=n=>$Q()&&n.test(navigator.vendor),gEe=n=>$Q()&&n.test(fEe()),_Ee=()=>gEe(/mac|iphone|ipad|ipod/i),yEe=()=>_Ee()&&mEe(/apple/i);function EEe(n){const{ref:t,elements:s,enabled:a}=n,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};Ey(l,"pointerdown",d=>{var b,w;if(!yEe()||!a)return;const f=((w=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:w[0])??d.target,v=(s??[t]).some(I=>{const k=pEe(I)?I.current:I;return(k==null?void 0:k.contains(f))||k===f});l().activeElement!==f&&v&&(d.preventDefault(),f.focus())})}function vEe(n,t){const s=D.useId();return D.useMemo(()=>n||[t,s].filter(Boolean).join("-"),[n,t,s])}function SEe(n,...t){const s=vEe(n);return D.useMemo(()=>t.map(a=>`${a}-${s}`),[s,t])}function bEe(n,t){const s=Gs(n);D.useEffect(()=>{let a=null;const l=()=>s();return t!==null&&(a=window.setInterval(l,t)),()=>{a&&window.clearInterval(a)}},[t,s])}function KQ(n){const t=D.useRef(null);return t.current=n,t}function TEe(n,t){if(n!=null){if(typeof n=="function"){n(t);return}try{n.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${n}'`)}}}function Vi(...n){return t=>{n.forEach(s=>{TEe(s,t)})}}function wEe(...n){return D.useMemo(()=>Vi(...n),n)}function qQ(n){const{ref:t,handler:s,enabled:a=!0}=n,l=Gs(s),f=D.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;D.useEffect(()=>{if(!a)return;const y=I=>{K2(I,t)&&(f.isPointerDown=!0)},v=I=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&s&&K2(I,t)&&(f.isPointerDown=!1,l(I))},b=I=>{f.ignoreEmulatedMouseEvents=!0,s&&f.isPointerDown&&K2(I,t)&&(f.isPointerDown=!1,l(I))},w=YQ(t.current);return w.addEventListener("mousedown",y,!0),w.addEventListener("mouseup",v,!0),w.addEventListener("touchstart",y,!0),w.addEventListener("touchend",b,!0),()=>{w.removeEventListener("mousedown",y,!0),w.removeEventListener("mouseup",v,!0),w.removeEventListener("touchstart",y,!0),w.removeEventListener("touchend",b,!0)}},[s,t,l,f,a])}function K2(n,t){var a,l;const s=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return s&&!YQ(s).contains(s)?!1:!((l=t.current)!=null&&l.contains(s))}function YQ(n){return(n==null?void 0:n.ownerDocument)??document}function CEe(n,t){const s=Gs(n);D.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{s()},t),()=>{a&&window.clearTimeout(a)}},[t,s])}const XQ=1/60*1e3,REe=typeof performance<"u"?()=>performance.now():()=>Date.now(),JQ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(REe()),XQ);function IEe(n){let t=[],s=[],a=0,l=!1,d=!1;const f=new WeakSet,y={schedule:(v,b=!1,w=!1)=>{const I=w&&l,k=I?t:s;return b&&f.add(v),k.indexOf(v)===-1&&(k.push(v),I&&l&&(a=t.length)),v},cancel:v=>{const b=s.indexOf(v);b!==-1&&s.splice(b,1),f.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[t,s]=[s,t],s.length=0,a=t.length,a)for(let b=0;b<a;b++){const w=t[b];w(v),f.has(w)&&(y.schedule(w),n())}l=!1,d&&(d=!1,y.process(v))}};return y}const AEe=40;let mU=!0,pC=!1,gU=!1;const GS={delta:0,timestamp:0},BC=["read","update","preRender","render","postRender"],c1=BC.reduce((n,t)=>(n[t]=IEe(()=>pC=!0),n),{}),PEe=BC.reduce((n,t)=>{const s=c1[t];return n[t]=(a,l=!1,d=!1)=>(pC||NEe(),s.schedule(a,l,d)),n},{}),OEe=BC.reduce((n,t)=>(n[t]=c1[t].cancel,n),{});BC.reduce((n,t)=>(n[t]=()=>c1[t].process(GS),n),{});const kEe=n=>c1[n].process(GS),QQ=n=>{pC=!1,GS.delta=mU?XQ:Math.max(Math.min(n-GS.timestamp,AEe),1),GS.timestamp=n,gU=!0,BC.forEach(kEe),gU=!1,pC&&(mU=!1,JQ(QQ))},NEe=()=>{pC=!0,mU=!0,gU||JQ(QQ)},cK=()=>GS;var DEe=Object.defineProperty,xEe=(n,t,s)=>t in n?DEe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,Rd=(n,t,s)=>(xEe(n,typeof t!="symbol"?t+"":t,s),s);class LEe{constructor(t,s,a){if(Rd(this,"history",[]),Rd(this,"startEvent",null),Rd(this,"lastEvent",null),Rd(this,"lastEventInfo",null),Rd(this,"handlers",{}),Rd(this,"removeListeners",()=>{}),Rd(this,"threshold",3),Rd(this,"win"),Rd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const y=q2(this.lastEventInfo,this.history),v=this.startEvent!==null,b=FEe(y.offset,{x:0,y:0})>=this.threshold;if(!v&&!b)return;const{timestamp:w}=cK();this.history.push({...y.point,timestamp:w});const{onStart:I,onMove:k}=this.handlers;v||(I==null||I(this.lastEvent,y),this.startEvent=this.lastEvent),k==null||k(this.lastEvent,y)}),Rd(this,"onPointerMove",(y,v)=>{this.lastEvent=y,this.lastEventInfo=v,PEe.update(this.updatePoint,!0)}),Rd(this,"onPointerUp",(y,v)=>{const b=q2(v,this.history),{onEnd:w,onSessionEnd:I}=this.handlers;I==null||I(y,b),this.end(),!(!w||!this.startEvent)&&(w==null||w(y,b))}),this.win=t.view??window,Oye(t))return;this.handlers=s,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:xQ(t)},{timestamp:d}=cK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:f}=s;f==null||f(t,q2(l,this.history)),this.removeListeners=VEe(kO(this.win,"pointermove",this.onPointerMove),kO(this.win,"pointerup",this.onPointerUp),kO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),OEe.update(this.updatePoint)}}function lK(n,t){return{x:n.x-t.x,y:n.y-t.y}}function q2(n,t){return{point:n.point,delta:lK(n.point,t[t.length-1]),offset:lK(n.point,t[0]),velocity:UEe(t,.1)}}const MEe=n=>n*1e3;function UEe(n,t){if(n.length<2)return{x:0,y:0};let s=n.length-1,a=null;const l=n[n.length-1];for(;s>=0&&(a=n[s],!(l.timestamp-a.timestamp>MEe(t)));)s--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function VEe(...n){return t=>n.reduce((s,a)=>a(s),t)}function Y2(n,t){return Math.abs(n-t)}function uK(n){return"x"in n&&"y"in n}function FEe(n,t){if(typeof n=="number"&&typeof t=="number")return Y2(n,t);if(uK(n)&&uK(t)){const s=Y2(n.x,t.x),a=Y2(n.y,t.y);return Math.sqrt(s**2+a**2)}return 0}function jEe(n,t){const{onPan:s,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:f,threshold:y}=t,v=!!(s||a||l||d||f),b=D.useRef(null),w=KQ({onSessionStart:d,onSessionEnd:f,onStart:a,onMove:s,onEnd(I,k){b.current=null,l==null||l(I,k)}});D.useEffect(()=>{var I;(I=b.current)==null||I.updateHandlers(w.current)}),D.useEffect(()=>{const I=n.current;if(!I||!v)return;function k(L){b.current=new LEe(L,w.current,y)}return kO(I,"pointerdown",k)},[n,v,w,y]),D.useEffect(()=>()=>{var I;(I=b.current)==null||I.end(),b.current=null},[])}const _o={open:(n,t)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${t}`,closed:(n,t)=>`${n}[data-closed], ${n}[data-state=closed] ${t}`,hover:(n,t)=>`${n}:hover ${t}, ${n}[data-hover] ${t}`,focus:(n,t)=>`${n}:focus ${t}, ${n}[data-focus] ${t}`,focusVisible:(n,t)=>`${n}:focus-visible ${t}`,focusWithin:(n,t)=>`${n}:focus-within ${t}`,active:(n,t)=>`${n}:active ${t}, ${n}[data-active] ${t}`,disabled:(n,t)=>`${n}:disabled ${t}, ${n}[data-disabled] ${t}`,invalid:(n,t)=>`${n}:invalid ${t}, ${n}[data-invalid] ${t}`,checked:(n,t)=>`${n}:checked ${t}, ${n}[data-checked] ${t}`,placeholderShown:(n,t)=>`${n}:placeholder-shown ${t}`},Nh=n=>ZQ(t=>n(t,"&"),"[role=group]","[data-group]",".group"),uf=n=>ZQ(t=>n(t,"~ &"),"[data-peer]",".peer"),ZQ=(n,...t)=>t.map(n).join(", "),HS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Nh(_o.open),_groupClosed:Nh(_o.closed),_groupHover:Nh(_o.hover),_peerHover:uf(_o.hover),_groupFocus:Nh(_o.focus),_peerFocus:uf(_o.focus),_groupFocusVisible:Nh(_o.focusVisible),_peerFocusVisible:uf(_o.focusVisible),_groupActive:Nh(_o.active),_peerActive:uf(_o.active),_groupDisabled:Nh(_o.disabled),_peerDisabled:uf(_o.disabled),_groupInvalid:Nh(_o.invalid),_peerInvalid:uf(_o.invalid),_groupChecked:Nh(_o.checked),_peerChecked:uf(_o.checked),_groupFocusWithin:Nh(_o.focusWithin),_peerFocusWithin:uf(_o.focusWithin),_peerPlaceholderShown:uf(_o.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},eZ=Object.keys(HS),BEe=n=>/!(important)?$/.test(n),dK=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,WEe=(n,t)=>s=>{const a=String(t),l=BEe(a),d=dK(a),f=n?`${n}.${d}`:d;let y=Du(s.__cssMap)&&f in s.__cssMap?s.__cssMap[f].varRef:t;return y=dK(y),l?`${y} !important`:y};function sF(n){const{scale:t,transform:s,compose:a}=n;return(d,f)=>{const y=WEe(t,d)(f);let v=(s==null?void 0:s(y,f))??y;return a&&(v=a(v,f)),v}}const tO=(...n)=>t=>n.reduce((s,a)=>a(s),t);function Au(n,t){return s=>{const a={property:s,scale:n};return a.transform=sF({scale:n,transform:t}),a}}const zEe=({rtl:n,ltr:t})=>s=>s.direction==="rtl"?n:t;function GEe(n){const{property:t,scale:s,transform:a}=n;return{scale:s,property:zEe(t),transform:s?sF({scale:s,compose:a}):a}}const tZ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function HEe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...tZ].join(" ")}function $Ee(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...tZ].join(" ")}const KEe={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},qEe={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function YEe(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const XEe={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},_U={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},JEe=new Set(Object.values(_U)),yU=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),QEe=n=>n.trim();function ZEe(n,t){if(n==null||yU.has(n))return n;if(!(EU(n)||yU.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!d||!f)return n;const y=d.includes("-gradient")?d:`${d}-gradient`,[v,...b]=f.split(",").map(QEe).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const w=v in _U?_U[v]:v;b.unshift(w);const I=b.map(k=>{if(JEe.has(k))return k;const L=k.indexOf(" "),[V,B]=L!==-1?[k.substr(0,L),k.substr(L+1)]:[k],W=EU(B)?B:B&&B.split(" "),Q=`colors.${V}`,$=Q in t.__cssMap?t.__cssMap[Q].varRef:V;return W?[$,...Array.isArray(W)?W:[W]].join(" "):$});return`${y}(${I.join(", ")})`}const EU=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),eve=(n,t)=>ZEe(n,t??{});function tve(n){return/^var\(--.+\)$/.test(n)}const nve=n=>{const t=parseFloat(n.toString()),s=n.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}},Dh=n=>t=>`${n}(${t})`,xr={filter(n){return n!=="auto"?n:KEe},backdropFilter(n){return n!=="auto"?n:qEe},ring(n){return YEe(xr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?HEe():n==="auto-gpu"?$Ee():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:t}=nve(n);return t||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,t){const s={left:"right",right:"left"};return t.direction==="rtl"?s[n]:n},degree(n){if(tve(n)||n==null)return n;const t=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||t?`${n}deg`:n},gradient:eve,blur:Dh("blur"),opacity:Dh("opacity"),brightness:Dh("brightness"),contrast:Dh("contrast"),dropShadow:Dh("drop-shadow"),grayscale:Dh("grayscale"),hueRotate:n=>Dh("hue-rotate")(xr.degree(n)),invert:Dh("invert"),saturate:Dh("saturate"),sepia:Dh("sepia"),bgImage(n){return n==null||EU(n)||yU.has(n)?n:`url(${n})`},outline(n){const t=String(n)==="0"||String(n)==="none";return n!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:t,divide:s}=XEe[n]??{},a={flexDirection:n};return t&&(a[t]=1),s&&(a[s]=1),a}},Be={borderWidths:Au("borderWidths"),borderStyles:Au("borderStyles"),colors:Au("colors"),borders:Au("borders"),gradients:Au("gradients",xr.gradient),radii:Au("radii",xr.px),space:Au("space",tO(xr.vh,xr.px)),spaceT:Au("space",tO(xr.vh,xr.px)),degreeT(n){return{property:n,transform:xr.degree}},prop(n,t,s){return{property:n,scale:t,...t&&{transform:sF({scale:t,transform:s})}}},propT(n,t){return{property:n,transform:t}},sizes:Au("sizes",tO(xr.vh,xr.px)),sizesT:Au("sizes",tO(xr.vh,xr.fraction)),shadows:Au("shadows"),logical:GEe,blur:Au("blur",xr.blur)},DO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:xr.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:xr.bgClip}};Object.assign(DO,{bgImage:DO.backgroundImage,bgImg:DO.backgroundImage});const Zr={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Zr,{rounded:Zr.borderRadius,roundedTop:Zr.borderTopRadius,roundedTopLeft:Zr.borderTopLeftRadius,roundedTopRight:Zr.borderTopRightRadius,roundedTopStart:Zr.borderStartStartRadius,roundedTopEnd:Zr.borderStartEndRadius,roundedBottom:Zr.borderBottomRadius,roundedBottomLeft:Zr.borderBottomLeftRadius,roundedBottomRight:Zr.borderBottomRightRadius,roundedBottomStart:Zr.borderEndStartRadius,roundedBottomEnd:Zr.borderEndEndRadius,roundedLeft:Zr.borderLeftRadius,roundedRight:Zr.borderRightRadius,roundedStart:Zr.borderInlineStartRadius,roundedEnd:Zr.borderInlineEndRadius,borderStart:Zr.borderInlineStart,borderEnd:Zr.borderInlineEnd,borderTopStartRadius:Zr.borderStartStartRadius,borderTopEndRadius:Zr.borderStartEndRadius,borderBottomStartRadius:Zr.borderEndStartRadius,borderBottomEndRadius:Zr.borderEndEndRadius,borderStartRadius:Zr.borderInlineStartRadius,borderEndRadius:Zr.borderInlineEndRadius,borderStartWidth:Zr.borderInlineStartWidth,borderEndWidth:Zr.borderInlineEndWidth,borderStartColor:Zr.borderInlineStartColor,borderEndColor:Zr.borderInlineEndColor,borderStartStyle:Zr.borderInlineStartStyle,borderEndStyle:Zr.borderInlineEndStyle});const rve={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},Ek={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:xr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(Ek,{flexDir:Ek.flexDirection});const ku={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",xr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(ku,{w:ku.width,h:ku.height,minW:ku.minWidth,maxW:ku.maxWidth,minH:ku.minHeight,maxH:ku.maxHeight,overscroll:ku.overscrollBehavior,overscrollX:ku.overscrollBehaviorX,overscrollY:ku.overscrollBehaviorY});const ive={filter:{transform:xr.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",xr.brightness),contrast:Be.propT("--chakra-contrast",xr.contrast),hueRotate:Be.propT("--chakra-hue-rotate",xr.hueRotate),invert:Be.propT("--chakra-invert",xr.invert),saturate:Be.propT("--chakra-saturate",xr.saturate),dropShadow:Be.propT("--chakra-drop-shadow",xr.dropShadow),backdropFilter:{transform:xr.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",xr.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",xr.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",xr.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",xr.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",xr.saturate)},sve={ring:{transform:xr.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},ove={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:xr.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},nZ={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function ave(n,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?s:n}const cve=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const y=t.get(a);if(y.has(l))return y.get(l);const v=n(a,l,d,f);return y.set(l,v),v}},lve=cve(ave),uve={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},dve={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},X2=(n,t,s)=>{const a={},l=lve(n,t,{});for(const d in l)d in s&&s[d]!=null||(a[d]=l[d]);return a},hve={srOnly:{transform(n){return n===!0?uve:n==="focusable"?dve:{}}},layerStyle:{processResult:!0,transform:(n,t,s)=>X2(t,`layerStyles.${n}`,s)},textStyle:{processResult:!0,transform:(n,t,s)=>X2(t,`textStyles.${n}`,s)},apply:{processResult:!0,transform:(n,t,s)=>X2(t,n,s)}},Kw={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Kw,{insetStart:Kw.insetInlineStart,insetEnd:Kw.insetInlineEnd});const vU={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign(vU,{shadow:vU.boxShadow});const Qi={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(Qi,{m:Qi.margin,mt:Qi.marginTop,mr:Qi.marginRight,me:Qi.marginInlineEnd,marginEnd:Qi.marginInlineEnd,mb:Qi.marginBottom,ml:Qi.marginLeft,ms:Qi.marginInlineStart,marginStart:Qi.marginInlineStart,mx:Qi.marginX,my:Qi.marginY,p:Qi.padding,pt:Qi.paddingTop,py:Qi.paddingY,px:Qi.paddingX,pb:Qi.paddingBottom,pl:Qi.paddingLeft,ps:Qi.paddingInlineStart,paddingStart:Qi.paddingInlineStart,pr:Qi.paddingRight,pe:Qi.paddingInlineEnd,paddingEnd:Qi.paddingInlineEnd});const pve={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},fve={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",xr.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},mve={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},gve={clipPath:!0,transform:Be.propT("transform",xr.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},_ve={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},yve={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},oF=zh({},DO,Zr,rve,Ek,ku,ive,sve,ove,nZ,hve,Kw,vU,Qi,pve,fve,mve,gve,_ve,yve),Eve=Object.assign({},Qi,ku,Ek,nZ,Kw),vve=Object.keys(Eve),Sve=[...Object.keys(oF),...eZ],bve={...oF,...HS},Tve=n=>n in bve,wve=n=>t=>{if(!t.__breakpoints)return n;const{isResponsive:s,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const f in n){let y=cl(n[f],t);if(y==null)continue;if(y=Du(y)&&s(y)?a(y):y,!Array.isArray(y)){d[f]=y;continue}const v=y.slice(0,l.length).length;for(let b=0;b<v;b+=1){const w=l==null?void 0:l[b];if(!w){d[f]=y[b];continue}d[w]=d[w]||{},y[b]!=null&&(d[w][f]=y[b])}}return d};function Cve(n){const t=[];let s="",a=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(a=!0,s+=d):d===")"?(a=!1,s+=d):d===","&&!a?(t.push(s),s=""):s+=d}return s=s.trim(),s&&t.push(s),t}function Rve(n){return/^var\(--.+\)$/.test(n)}const Ive=(n,t)=>n.startsWith("--")&&typeof t=="string"&&!Rve(t),Ave=(n,t)=>{if(t==null)return t;const s=f=>{var y,v;return(v=(y=n.__cssMap)==null?void 0:y[f])==null?void 0:v.varRef},a=f=>s(f)??f,[l,d]=Cve(t);return t=s(l)??a(d)??a(t),t};function Pve(n){const{configs:t={},pseudos:s={},theme:a}=n,l=(d,f=!1)=>{var w;const y=cl(d,a),v=wve(y)(a);let b={};for(let I in v){const k=v[I];let L=cl(k,a);I in s&&(I=s[I]),Ive(I,L)&&(L=Ave(a,L));let V=t[I];if(V===!0&&(V={property:I}),Du(L)){b[I]=b[I]??{},b[I]=zh({},b[I],l(L,!0));continue}let B=((w=V==null?void 0:V.transform)==null?void 0:w.call(V,L,a,y))??L;B=V!=null&&V.processResult?l(B,!0):B;const W=cl(V==null?void 0:V.property,a);if(!f&&(V!=null&&V.static)){const Q=cl(V.static,a);b=zh({},b,Q)}if(W&&Array.isArray(W)){for(const Q of W)b[Q]=B;continue}if(W){W==="&"&&Du(B)?b=zh({},b,B):b[W]=B;continue}if(Du(B)){b=zh({},b,B);continue}b[I]=B}return b};return l}const rZ=n=>t=>Pve({theme:t,pseudos:HS,configs:oF})(n);function ZWe(n){return n}function eze(n){return n}function zi(n){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:n,...t}}}}function Ove(n,t,s){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${t}.${s}`])==null?void 0:l.varRef)??s}function kve(n,t){if(Array.isArray(n))return n;if(Du(n))return t(n);if(n!=null)return[n]}function Nve(n,t){for(let s=t+1;s<n.length;s++)if(n[s]!=null)return s;return-1}function Dve(n){const t=n.__breakpoints;return function(a,l,d,f){var k,L;if(!t)return;const y={},v=kve(d,t.toArrayValue);if(!v)return y;const b=v.length,w=b===1,I=!!a.parts;for(let V=0;V<b;V++){const B=t.details[V],W=t.details[Nve(v,V)],Q=Aw(B.minW,W==null?void 0:W._minW),$=cl((k=a[l])==null?void 0:k[v[V]],f);if($){if(I){(L=a.parts)==null||L.forEach(ie=>{zh(y,{[ie]:w?$[ie]:{[Q]:$[ie]}})});continue}if(!I){w?zh(y,$):y[Q]=$;continue}y[Q]=$}}return y}}function xve(n){return t=>{const{variant:s,size:a,theme:l}=t,d=Dve(l);return zh({},cl(n.baseStyle??{},t),d(n,"sizes",a,t),d(n,"variants",s,t))}}function Gi(n){return N0(n,["styleConfig","size","variant","colorScheme"])}function iZ(n){return Du(n)&&n.reference?n.reference:String(n)}const l1=(n,...t)=>t.map(iZ).join(` ${n} `).replace(/calc/g,""),hK=(...n)=>`calc(${l1("+",...n)})`,pK=(...n)=>`calc(${l1("-",...n)})`,SU=(...n)=>`calc(${l1("*",...n)})`,fK=(...n)=>`calc(${l1("/",...n)})`,mK=n=>{const t=iZ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:SU(t,-1)},ff=Object.assign(n=>({add:(...t)=>ff(hK(n,...t)),subtract:(...t)=>ff(pK(n,...t)),multiply:(...t)=>ff(SU(n,...t)),divide:(...t)=>ff(fK(n,...t)),negate:()=>ff(mK(n)),toString:()=>n.toString()}),{add:hK,subtract:pK,multiply:SU,divide:fK,negate:mK});function Lve(n,t="-"){return n.replace(/\s+/g,t)}function Mve(n){const t=Lve(n.toString());return Vve(Uve(t))}function Uve(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function Vve(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function Fve(n,t=""){return[t,n].filter(Boolean).join("-")}function jve(n,t){return`var(${n}${t?`, ${t}`:""})`}function Bve(n,t=""){return Mve(`--${Fve(n,t)}`)}function Un(n,t,s){const a=Bve(n,s);return{variable:a,reference:jve(a,t)}}function Wve(n,t){const s={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;s[l]=Un(`${n}-${l}`,d);continue}s[a]=Un(`${n}-${a}`)}return s}const zve=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Gve(n){return jQ(n,zve)}function Hve(n){return n.semanticTokens}function $ve(n){const{__cssMap:t,__cssVars:s,__breakpoints:a,...l}=n;return l}function Kve(n){const t=Gve(n),s=Hve(n),a=d=>eZ.includes(d)||d==="default",l={};return nK(t,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!1,value:d})}),nK(s,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function gK(n,t){return Un(String(n).replace(/\./g,"-"),void 0,t)}function qve(n){var f;const t=Kve(n),s=(f=n.config)==null?void 0:f.cssVarPrefix;let a={};const l={};function d(y,v){const w=[String(y).split(".")[0],v].join(".");if(!t[w])return v;const{reference:k}=gK(w,s);return k}for(const[y,v]of Object.entries(t)){const{isSemantic:b,value:w}=v,{variable:I,reference:k}=gK(y,s);if(!b){if(y.startsWith("space")){const V=y.split("."),[B,...W]=V,Q=`${B}.-${W.join(".")}`,$=ff.negate(w),ie=ff.negate(k);l[Q]={value:$,var:I,varRef:ie}}a[I]=w,l[y]={value:w,var:I,varRef:k};continue}const L=Du(w)?w:{default:w};a=zh(a,Object.entries(L).reduce((V,[B,W])=>{if(!W)return V;const Q=d(y,`${W}`);if(B==="default")return V[I]=Q,V;const $=(HS==null?void 0:HS[B])??B;return V[$]={[I]:Q},V},{})),l[y]={value:k,var:I,varRef:k}}return{cssVars:a,cssMap:l}}function Yve(n){const t=$ve(n),{cssMap:s,cssVars:a}=qve(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:s,__breakpoints:jye(t.breakpoints)}),t}function ri(n,t={}){let s=!1;function a(){if(!s){s=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...w){a();for(const I of w)t[I]=v(I);return ri(n,t)}function d(...w){for(const I of w)I in t||(t[I]=v(I));return ri(n,t)}function f(){return Object.fromEntries(Object.entries(t).map(([I,k])=>[I,k.selector]))}function y(){return Object.fromEntries(Object.entries(t).map(([I,k])=>[I,k.className]))}function v(w){const L=`chakra-${(["container","root"].includes(w??"")?[n]:[n,w]).filter(Boolean).join("__")}`;return{className:L,selector:`.${L}`,toString:()=>w}}return{parts:l,toPart:v,extend:d,selectors:f,classnames:y,get keys(){return Object.keys(t)},__type:{}}}const Xve=ri("accordion").parts("root","container","button","panel","icon"),Jve=ri("alert").parts("title","description","container","icon","spinner"),Qve=ri("avatar").parts("label","badge","container","excessLabel","group"),Zve=ri("breadcrumb").parts("link","item","container","separator");ri("button").parts();const eSe=ri("checkbox").parts("control","icon","container","label");ri("progress").parts("track","filledTrack","label");const tSe=ri("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),nSe=ri("editable").parts("preview","input","textarea"),rSe=ri("form").parts("container","requiredIndicator","helperText"),iSe=ri("formError").parts("text","icon"),sSe=ri("input").parts("addon","field","element","group"),oSe=ri("list").parts("container","item","icon"),aSe=ri("menu").parts("button","list","item","groupTitle","icon","command","divider"),cSe=ri("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),lSe=ri("numberinput").parts("root","field","stepperGroup","stepper");ri("pininput").parts("field");const uSe=ri("popover").parts("content","header","body","footer","popper","arrow","closeButton"),dSe=ri("progress").parts("label","filledTrack","track"),hSe=ri("radio").parts("container","control","label"),pSe=ri("select").parts("field","icon"),fSe=ri("slider").parts("container","track","thumb","filledTrack","mark"),mSe=ri("stat").parts("container","label","helpText","number","icon"),gSe=ri("switch").parts("container","track","thumb","label"),_Se=ri("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),ySe=ri("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),ESe=ri("tag").parts("container","label","closeButton"),vSe=ri("card").parts("container","header","body","footer");ri("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:SSe,defineMultiStyleConfig:bSe}=zi(Xve.keys),TSe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},wSe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},CSe={pt:"2",px:"4",pb:"5"},RSe={fontSize:"1.25em"},ISe=SSe({container:TSe,button:wSe,panel:CSe,icon:RSe}),ASe=bSe({baseStyle:ISe});function fy(n,t,s){return Math.min(Math.max(n,s),t)}class PSe extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var Ow=PSe;function aF(n){if(typeof n!="string")throw new Ow(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=n.trim();t=USe.test(n)?NSe(n):n;const s=DSe.exec(t);if(s){const f=Array.from(s).slice(1);return[...f.slice(0,3).map(y=>parseInt(fC(y,2),16)),parseInt(fC(f[3]||"f",2),16)/255]}const a=xSe.exec(t);if(a){const f=Array.from(a).slice(1);return[...f.slice(0,3).map(y=>parseInt(y,16)),parseInt(f[3]||"ff",16)/255]}const l=LSe.exec(t);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(y=>parseInt(y,10)),parseFloat(f[3]||"1")]}const d=MSe.exec(t);if(d){const[f,y,v,b]=Array.from(d).slice(1).map(parseFloat);if(fy(0,100,y)!==y)throw new Ow(n);if(fy(0,100,v)!==v)throw new Ow(n);return[...VSe(f,y,v),Number.isNaN(b)?1:b]}throw new Ow(n)}function OSe(n){let t=5381,s=n.length;for(;s;)t=t*33^n.charCodeAt(--s);return(t>>>0)%2341}const _K=n=>parseInt(n.replace(/_/g,""),36),kSe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,t)=>{const s=_K(t.substring(0,3)),a=_K(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return n[s]=`${l}${a}`,n},{});function NSe(n){const t=n.toLowerCase().trim(),s=kSe[OSe(t)];if(!s)throw new Ow(n);return`#${s}`}const fC=(n,t)=>Array.from(Array(t)).map(()=>n).join(""),DSe=new RegExp(`^#${fC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),xSe=new RegExp(`^#${fC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),LSe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${fC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),MSe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,USe=/^[a-z]+$/i,yK=n=>Math.round(n*255),VSe=(n,t,s)=>{let a=s/100;if(t===0)return[a,a,a].map(yK);const l=(n%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),f=d*(1-Math.abs(l%2-1));let y=0,v=0,b=0;l>=0&&l<1?(y=d,v=f):l>=1&&l<2?(y=f,v=d):l>=2&&l<3?(v=d,b=f):l>=3&&l<4?(v=f,b=d):l>=4&&l<5?(y=f,b=d):l>=5&&l<6&&(y=d,b=f);const w=a-d/2,I=y+w,k=v+w,L=b+w;return[I,k,L].map(yK)};function FSe(n,t,s,a){return`rgba(${fy(0,255,n).toFixed()}, ${fy(0,255,t).toFixed()}, ${fy(0,255,s).toFixed()}, ${parseFloat(fy(0,1,a).toFixed(3))})`}function jSe(n,t){const[s,a,l,d]=aF(n);return FSe(s,a,l,d-t)}function BSe(n){const[t,s,a,l]=aF(n);let d=f=>{const y=fy(0,255,f).toString(16);return y.length===1?`0${y}`:y};return`#${d(t)}${d(s)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const WSe=n=>Object.keys(n).length===0;function zSe(n,t,s,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)n=n?n[t[a]]:l;return n===l?s:n}const Sc=(n,t,s)=>{const a=zSe(n,`colors.${t}`,t);try{return BSe(a),a}catch{return s??"#000000"}},GSe=n=>{const[t,s,a]=aF(n);return(t*299+s*587+a*114)/1e3},HSe=n=>t=>{const s=Sc(t,n);return GSe(s)<128?"dark":"light"},$Se=n=>t=>HSe(n)(t)==="dark",a0=(n,t)=>s=>{const a=Sc(s,n);return jSe(a,1-t)};function EK(n="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const KSe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function qSe(n){const t=KSe();return!n||WSe(n)?t:n.string&&n.colors?XSe(n.string,n.colors):n.string&&!n.colors?YSe(n.string):n.colors&&!n.string?JSe(n.colors):t}function YSe(n){let t=0;if(n.length===0)return t.toString();for(let a=0;a<n.length;a+=1)t=n.charCodeAt(a)+((t<<5)-t),t=t&t;let s="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;s+=`00${l.toString(16)}`.substr(-2)}return s}function XSe(n,t){let s=0;if(n.length===0)return t[0];for(let a=0;a<n.length;a+=1)s=n.charCodeAt(a)+((s<<5)-s),s=s&s;return s=(s%t.length+t.length)%t.length,t[s]}function JSe(n){return n[Math.floor(Math.random()*n.length)]}function Mn(n,t){return s=>s.colorMode==="dark"?t:n}function cF(n){const{orientation:t,vertical:s,horizontal:a}=n;return t?t==="vertical"?s:a:{}}function sZ(n){return Du(n)&&n.reference?n.reference:String(n)}const u1=(n,...t)=>t.map(sZ).join(` ${n} `).replace(/calc/g,""),vK=(...n)=>`calc(${u1("+",...n)})`,SK=(...n)=>`calc(${u1("-",...n)})`,bU=(...n)=>`calc(${u1("*",...n)})`,bK=(...n)=>`calc(${u1("/",...n)})`,TK=n=>{const t=sZ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:bU(t,-1)},mf=Object.assign(n=>({add:(...t)=>mf(vK(n,...t)),subtract:(...t)=>mf(SK(n,...t)),multiply:(...t)=>mf(bU(n,...t)),divide:(...t)=>mf(bK(n,...t)),negate:()=>mf(TK(n)),toString:()=>n.toString()}),{add:vK,subtract:SK,multiply:bU,divide:bK,negate:TK});function QSe(n){return!Number.isInteger(parseFloat(n.toString()))}function ZSe(n,t="-"){return n.replace(/\s+/g,t)}function oZ(n){const t=ZSe(n.toString());return t.includes("\\.")?n:QSe(n)?t.replace(".","\\."):n}function e0e(n,t=""){return[t,oZ(n)].filter(Boolean).join("-")}function t0e(n,t){return`var(${oZ(n)}${t?`, ${t}`:""})`}function n0e(n,t=""){return`--${e0e(n,t)}`}function bo(n,t){const s=n0e(n,t==null?void 0:t.prefix);return{variable:s,reference:t0e(s,r0e(t==null?void 0:t.fallback))}}function r0e(n){return n==null?void 0:n.reference}const{definePartsStyle:WC,defineMultiStyleConfig:i0e}=zi(Jve.keys),jl=Un("alert-fg"),Lf=Un("alert-bg"),s0e=WC({container:{bg:Lf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:jl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:jl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function lF(n){const{theme:t,colorScheme:s}=n,a=a0(`${s}.200`,.16)(t);return{light:`colors.${s}.100`,dark:a}}const o0e=WC(n=>{const{colorScheme:t}=n,s=lF(n);return{container:{[jl.variable]:`colors.${t}.600`,[Lf.variable]:s.light,_dark:{[jl.variable]:`colors.${t}.200`,[Lf.variable]:s.dark}}}}),a0e=WC(n=>{const{colorScheme:t}=n,s=lF(n);return{container:{[jl.variable]:`colors.${t}.600`,[Lf.variable]:s.light,_dark:{[jl.variable]:`colors.${t}.200`,[Lf.variable]:s.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:jl.reference}}}),c0e=WC(n=>{const{colorScheme:t}=n,s=lF(n);return{container:{[jl.variable]:`colors.${t}.600`,[Lf.variable]:s.light,_dark:{[jl.variable]:`colors.${t}.200`,[Lf.variable]:s.dark},pt:"2",borderTopWidth:"4px",borderTopColor:jl.reference}}}),l0e=WC(n=>{const{colorScheme:t}=n;return{container:{[jl.variable]:"colors.white",[Lf.variable]:`colors.${t}.600`,_dark:{[jl.variable]:"colors.gray.900",[Lf.variable]:`colors.${t}.200`},color:jl.reference}}}),u0e={subtle:o0e,"left-accent":a0e,"top-accent":c0e,solid:l0e},d0e=i0e({baseStyle:s0e,variants:u0e,defaultProps:{variant:"subtle",colorScheme:"blue"}}),aZ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},h0e={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},p0e={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},cZ={...aZ,...h0e,container:p0e},f0e=n=>typeof n=="function";function bc(n,...t){return f0e(n)?n(...t):n}const{definePartsStyle:lZ,defineMultiStyleConfig:m0e}=zi(Qve.keys),$S=Un("avatar-border-color"),qw=Un("avatar-bg"),mC=Un("avatar-font-size"),c0=Un("avatar-size"),g0e={borderRadius:"full",border:"0.2em solid",borderColor:$S.reference,[$S.variable]:"white",_dark:{[$S.variable]:"colors.gray.800"}},_0e={bg:qw.reference,fontSize:mC.reference,width:c0.reference,height:c0.reference,lineHeight:"1",[qw.variable]:"colors.gray.200",_dark:{[qw.variable]:"colors.whiteAlpha.400"}},y0e=n=>{const{name:t,theme:s}=n,a=t?qSe({string:t}):"colors.gray.400",l=$Se(a)(s);let d="white";return l||(d="gray.800"),{bg:qw.reference,fontSize:mC.reference,color:d,borderColor:$S.reference,verticalAlign:"top",width:c0.reference,height:c0.reference,"&:not([data-loaded])":{[qw.variable]:a},[$S.variable]:"colors.white",_dark:{[$S.variable]:"colors.gray.800"}}},E0e={fontSize:mC.reference,lineHeight:"1"},v0e=lZ(n=>({badge:bc(g0e,n),excessLabel:bc(_0e,n),container:bc(y0e,n),label:E0e}));function ng(n){const t=n!=="100%"?cZ[n]:void 0;return lZ({container:{[c0.variable]:t??n,[mC.variable]:`calc(${t??n} / 2.5)`},excessLabel:{[c0.variable]:t??n,[mC.variable]:`calc(${t??n} / 2.5)`}})}const S0e={"2xs":ng(4),xs:ng(6),sm:ng(8),md:ng(12),lg:ng(16),xl:ng(24),"2xl":ng(32),full:ng("100%")},b0e=m0e({baseStyle:v0e,sizes:S0e,defaultProps:{size:"md"}}),Hs=Wve("badge",["bg","color","shadow"]),T0e={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Hs.bg.reference,color:Hs.color.reference,boxShadow:Hs.shadow.reference},w0e=n=>{const{colorScheme:t,theme:s}=n,a=a0(`${t}.500`,.6)(s);return{[Hs.bg.variable]:`colors.${t}.500`,[Hs.color.variable]:"colors.white",_dark:{[Hs.bg.variable]:a,[Hs.color.variable]:"colors.whiteAlpha.800"}}},C0e=n=>{const{colorScheme:t,theme:s}=n,a=a0(`${t}.200`,.16)(s);return{[Hs.bg.variable]:`colors.${t}.100`,[Hs.color.variable]:`colors.${t}.800`,_dark:{[Hs.bg.variable]:a,[Hs.color.variable]:`colors.${t}.200`}}},R0e=n=>{const{colorScheme:t,theme:s}=n,a=a0(`${t}.200`,.8)(s);return{[Hs.color.variable]:`colors.${t}.500`,_dark:{[Hs.color.variable]:a},[Hs.shadow.variable]:`inset 0 0 0px 1px ${Hs.color.reference}`}},I0e={solid:w0e,subtle:C0e,outline:R0e},Yw={baseStyle:T0e,variants:I0e,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:A0e,definePartsStyle:P0e}=zi(Zve.keys),J2=Un("breadcrumb-link-decor"),O0e={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:J2.reference,[J2.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[J2.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},k0e=P0e({link:O0e}),N0e=A0e({baseStyle:k0e}),D0e={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},uZ=n=>{const{colorScheme:t,theme:s}=n;if(t==="gray")return{color:Mn("gray.800","whiteAlpha.900")(n),_hover:{bg:Mn("gray.100","whiteAlpha.200")(n)},_active:{bg:Mn("gray.200","whiteAlpha.300")(n)}};const a=a0(`${t}.200`,.12)(s),l=a0(`${t}.200`,.24)(s);return{color:Mn(`${t}.600`,`${t}.200`)(n),bg:"transparent",_hover:{bg:Mn(`${t}.50`,a)(n)},_active:{bg:Mn(`${t}.100`,l)(n)}}},x0e=n=>{const{colorScheme:t}=n,s=Mn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:t==="gray"?s:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...bc(uZ,n)}},L0e={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},M0e=n=>{const{colorScheme:t}=n;if(t==="gray"){const y=Mn("gray.100","whiteAlpha.200")(n);return{bg:y,color:Mn("gray.800","whiteAlpha.900")(n),_hover:{bg:Mn("gray.200","whiteAlpha.300")(n),_disabled:{bg:y}},_active:{bg:Mn("gray.300","whiteAlpha.400")(n)}}}const{bg:s=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=L0e[t]??{},f=Mn(s,`${t}.200`)(n);return{bg:f,color:Mn(a,"gray.800")(n),_hover:{bg:Mn(l,`${t}.300`)(n),_disabled:{bg:f}},_active:{bg:Mn(d,`${t}.400`)(n)}}},U0e=n=>{const{colorScheme:t}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Mn(`${t}.500`,`${t}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Mn(`${t}.700`,`${t}.500`)(n)}}},V0e={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},F0e={ghost:uZ,outline:x0e,solid:M0e,link:U0e,unstyled:V0e},j0e={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},B0e={baseStyle:D0e,variants:F0e,sizes:j0e,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:vy,defineMultiStyleConfig:W0e}=zi(vSe.keys),vk=Un("card-bg"),Rf=Un("card-padding"),dZ=Un("card-shadow"),xO=Un("card-radius"),hZ=Un("card-border-width","0"),pZ=Un("card-border-color"),z0e=vy({container:{[vk.variable]:"colors.chakra-body-bg",backgroundColor:vk.reference,boxShadow:dZ.reference,borderRadius:xO.reference,color:"chakra-body-text",borderWidth:hZ.reference,borderColor:pZ.reference},body:{padding:Rf.reference,flex:"1 1 0%"},header:{padding:Rf.reference},footer:{padding:Rf.reference}}),G0e={sm:vy({container:{[xO.variable]:"radii.base",[Rf.variable]:"space.3"}}),md:vy({container:{[xO.variable]:"radii.md",[Rf.variable]:"space.5"}}),lg:vy({container:{[xO.variable]:"radii.xl",[Rf.variable]:"space.7"}})},H0e={elevated:vy({container:{[dZ.variable]:"shadows.base",_dark:{[vk.variable]:"colors.gray.700"}}}),outline:vy({container:{[hZ.variable]:"1px",[pZ.variable]:"colors.chakra-border-color"}}),filled:vy({container:{[vk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Rf.variable]:0},header:{[Rf.variable]:0},footer:{[Rf.variable]:0}}},$0e=W0e({baseStyle:z0e,variants:H0e,sizes:G0e,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:LO,defineMultiStyleConfig:K0e}=zi(eSe.keys),Xw=Un("checkbox-size"),q0e=n=>{const{colorScheme:t}=n;return{w:Xw.reference,h:Xw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Mn(`${t}.500`,`${t}.200`)(n),borderColor:Mn(`${t}.500`,`${t}.200`)(n),color:Mn("white","gray.900")(n),_hover:{bg:Mn(`${t}.600`,`${t}.300`)(n),borderColor:Mn(`${t}.600`,`${t}.300`)(n)},_disabled:{borderColor:Mn("gray.200","transparent")(n),bg:Mn("gray.200","whiteAlpha.300")(n),color:Mn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Mn(`${t}.500`,`${t}.200`)(n),borderColor:Mn(`${t}.500`,`${t}.200`)(n),color:Mn("white","gray.900")(n)},_disabled:{bg:Mn("gray.100","whiteAlpha.100")(n),borderColor:Mn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Mn("red.500","red.300")(n)}}},Y0e={_disabled:{cursor:"not-allowed"}},X0e={userSelect:"none",_disabled:{opacity:.4}},J0e={transitionProperty:"transform",transitionDuration:"normal"},Q0e=LO(n=>({icon:J0e,container:Y0e,control:bc(q0e,n),label:X0e})),Z0e={sm:LO({control:{[Xw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:LO({control:{[Xw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:LO({control:{[Xw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},ag=K0e({baseStyle:Q0e,sizes:Z0e,defaultProps:{size:"md",colorScheme:"blue"}}),Jw=bo("close-button-size"),lw=bo("close-button-bg"),ebe={w:[Jw.reference],h:[Jw.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[lw.variable]:"colors.blackAlpha.100",_dark:{[lw.variable]:"colors.whiteAlpha.100"}},_active:{[lw.variable]:"colors.blackAlpha.200",_dark:{[lw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:lw.reference},tbe={lg:{[Jw.variable]:"sizes.10",fontSize:"md"},md:{[Jw.variable]:"sizes.8",fontSize:"xs"},sm:{[Jw.variable]:"sizes.6",fontSize:"2xs"}},nbe={baseStyle:ebe,sizes:tbe,defaultProps:{size:"md"}},{variants:rbe,defaultProps:ibe}=Yw,sbe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Hs.bg.reference,color:Hs.color.reference,boxShadow:Hs.shadow.reference},obe={baseStyle:sbe,variants:rbe,defaultProps:ibe},abe={w:"100%",mx:"auto",maxW:"prose",px:"4"},cbe={baseStyle:abe},lbe={opacity:.6,borderColor:"inherit"},ube={borderStyle:"solid"},dbe={borderStyle:"dashed"},hbe={solid:ube,dashed:dbe},pbe={baseStyle:lbe,variants:hbe,defaultProps:{variant:"solid"}},{definePartsStyle:TU,defineMultiStyleConfig:fbe}=zi(tSe.keys),Q2=Un("drawer-bg"),Z2=Un("drawer-box-shadow");function fS(n){return TU(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const mbe={bg:"blackAlpha.600",zIndex:"modal"},gbe={display:"flex",zIndex:"modal",justifyContent:"center"},_be=n=>{const{isFullHeight:t}=n;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[Q2.variable]:"colors.white",[Z2.variable]:"shadows.lg",_dark:{[Q2.variable]:"colors.gray.700",[Z2.variable]:"shadows.dark-lg"},bg:Q2.reference,boxShadow:Z2.reference}},ybe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Ebe={position:"absolute",top:"2",insetEnd:"3"},vbe={px:"6",py:"2",flex:"1",overflow:"auto"},Sbe={px:"6",py:"4"},bbe=TU(n=>({overlay:mbe,dialogContainer:gbe,dialog:bc(_be,n),header:ybe,closeButton:Ebe,body:vbe,footer:Sbe})),Tbe={xs:fS("xs"),sm:fS("md"),md:fS("lg"),lg:fS("2xl"),xl:fS("4xl"),full:fS("full")},wbe=fbe({baseStyle:bbe,sizes:Tbe,defaultProps:{size:"xs"}}),{definePartsStyle:Cbe,defineMultiStyleConfig:Rbe}=zi(nSe.keys),Ibe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Abe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Pbe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Obe=Cbe({preview:Ibe,input:Abe,textarea:Pbe}),kbe=Rbe({baseStyle:Obe}),{definePartsStyle:Nbe,defineMultiStyleConfig:Dbe}=zi(rSe.keys),KS=Un("form-control-color"),xbe={marginStart:"1",[KS.variable]:"colors.red.500",_dark:{[KS.variable]:"colors.red.300"},color:KS.reference},Lbe={mt:"2",[KS.variable]:"colors.gray.600",_dark:{[KS.variable]:"colors.whiteAlpha.600"},color:KS.reference,lineHeight:"normal",fontSize:"sm"},Mbe=Nbe({container:{width:"100%",position:"relative"},requiredIndicator:xbe,helperText:Lbe}),Ube=Dbe({baseStyle:Mbe}),{definePartsStyle:Vbe,defineMultiStyleConfig:Fbe}=zi(iSe.keys),qS=Un("form-error-color"),jbe={[qS.variable]:"colors.red.500",_dark:{[qS.variable]:"colors.red.300"},color:qS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},Bbe={marginEnd:"0.5em",[qS.variable]:"colors.red.500",_dark:{[qS.variable]:"colors.red.300"},color:qS.reference},Wbe=Vbe({text:jbe,icon:Bbe}),zbe=Fbe({baseStyle:Wbe}),Gbe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},Hbe={baseStyle:Gbe},$be={fontFamily:"heading",fontWeight:"bold"},Kbe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},qbe={baseStyle:$be,sizes:Kbe,defaultProps:{size:"xl"}},{definePartsStyle:_f,defineMultiStyleConfig:Ybe}=zi(sSe.keys),AS=Un("input-height"),PS=Un("input-font-size"),OS=Un("input-padding"),kS=Un("input-border-radius"),Xbe=_f({addon:{height:AS.reference,fontSize:PS.reference,px:OS.reference,borderRadius:kS.reference},field:{width:"100%",height:AS.reference,fontSize:PS.reference,px:OS.reference,borderRadius:kS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),rg={lg:{[PS.variable]:"fontSizes.lg",[OS.variable]:"space.4",[kS.variable]:"radii.md",[AS.variable]:"sizes.12"},md:{[PS.variable]:"fontSizes.md",[OS.variable]:"space.4",[kS.variable]:"radii.md",[AS.variable]:"sizes.10"},sm:{[PS.variable]:"fontSizes.sm",[OS.variable]:"space.3",[kS.variable]:"radii.sm",[AS.variable]:"sizes.8"},xs:{[PS.variable]:"fontSizes.xs",[OS.variable]:"space.2",[kS.variable]:"radii.sm",[AS.variable]:"sizes.6"}},Jbe={lg:_f({field:rg.lg,group:rg.lg}),md:_f({field:rg.md,group:rg.md}),sm:_f({field:rg.sm,group:rg.sm}),xs:_f({field:rg.xs,group:rg.xs})};function uF(n){const{focusBorderColor:t,errorBorderColor:s}=n;return{focusBorderColor:t||Mn("blue.500","blue.300")(n),errorBorderColor:s||Mn("red.500","red.300")(n)}}const Qbe=_f(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=uF(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Mn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Sc(t,a),boxShadow:`0 0 0 1px ${Sc(t,a)}`},_focusVisible:{zIndex:1,borderColor:Sc(t,s),boxShadow:`0 0 0 1px ${Sc(t,s)}`}},addon:{border:"1px solid",borderColor:Mn("inherit","whiteAlpha.50")(n),bg:Mn("gray.100","whiteAlpha.300")(n)}}}),Zbe=_f(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=uF(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Mn("gray.100","whiteAlpha.50")(n),_hover:{bg:Mn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Sc(t,a)},_focusVisible:{bg:"transparent",borderColor:Sc(t,s)}},addon:{border:"2px solid",borderColor:"transparent",bg:Mn("gray.100","whiteAlpha.50")(n)}}}),eTe=_f(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=uF(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Sc(t,a),boxShadow:`0px 1px 0px 0px ${Sc(t,a)}`},_focusVisible:{borderColor:Sc(t,s),boxShadow:`0px 1px 0px 0px ${Sc(t,s)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),tTe=_f({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),nTe={outline:Qbe,filled:Zbe,flushed:eTe,unstyled:tTe},ni=Ybe({baseStyle:Xbe,sizes:Jbe,variants:nTe,defaultProps:{size:"md",variant:"outline"}}),eM=Un("kbd-bg"),rTe={[eM.variable]:"colors.gray.100",_dark:{[eM.variable]:"colors.whiteAlpha.100"},bg:eM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},iTe={baseStyle:rTe},sTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},oTe={baseStyle:sTe},{defineMultiStyleConfig:aTe,definePartsStyle:cTe}=zi(oSe.keys),lTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},uTe=cTe({icon:lTe}),dTe=aTe({baseStyle:uTe}),{defineMultiStyleConfig:hTe,definePartsStyle:pTe}=zi(aSe.keys),xh=Un("menu-bg"),tM=Un("menu-shadow"),fTe={[xh.variable]:"#fff",[tM.variable]:"shadows.sm",_dark:{[xh.variable]:"colors.gray.700",[tM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:xh.reference,boxShadow:tM.reference},mTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[xh.variable]:"colors.gray.100",_dark:{[xh.variable]:"colors.whiteAlpha.100"}},_active:{[xh.variable]:"colors.gray.200",_dark:{[xh.variable]:"colors.whiteAlpha.200"}},_expanded:{[xh.variable]:"colors.gray.100",_dark:{[xh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:xh.reference},gTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},_Te={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},yTe={opacity:.6},ETe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},vTe={transitionProperty:"common",transitionDuration:"normal"},STe=pTe({button:vTe,list:fTe,item:mTe,groupTitle:gTe,icon:_Te,command:yTe,divider:ETe}),bTe=hTe({baseStyle:STe}),{defineMultiStyleConfig:TTe,definePartsStyle:wU}=zi(cSe.keys),nM=Un("modal-bg"),rM=Un("modal-shadow"),wTe={bg:"blackAlpha.600",zIndex:"modal"},CTe=n=>{const{isCentered:t,scrollBehavior:s}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:s==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},RTe=n=>{const{isCentered:t,scrollBehavior:s}=n;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:s==="inside"?"calc(100% - 7.5rem)":void 0,[nM.variable]:"colors.white",[rM.variable]:"shadows.lg",_dark:{[nM.variable]:"colors.gray.700",[rM.variable]:"shadows.dark-lg"},bg:nM.reference,boxShadow:rM.reference}},ITe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},ATe={position:"absolute",top:"2",insetEnd:"3"},PTe=n=>{const{scrollBehavior:t}=n;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},OTe={px:"6",py:"4"},kTe=wU(n=>({overlay:wTe,dialogContainer:bc(CTe,n),dialog:bc(RTe,n),header:ITe,closeButton:ATe,body:bc(PTe,n),footer:OTe}));function Id(n){return wU(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const NTe={xs:Id("xs"),sm:Id("sm"),md:Id("md"),lg:Id("lg"),xl:Id("xl"),"2xl":Id("2xl"),"3xl":Id("3xl"),"4xl":Id("4xl"),"5xl":Id("5xl"),"6xl":Id("6xl"),full:Id("full")},DTe=TTe({baseStyle:kTe,sizes:NTe,defaultProps:{size:"md"}}),fZ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:xTe,definePartsStyle:mZ}=zi(lSe.keys),dF=bo("number-input-stepper-width"),gZ=bo("number-input-input-padding"),LTe=mf(dF).add("0.5rem").toString(),iM=bo("number-input-bg"),sM=bo("number-input-color"),oM=bo("number-input-border-color"),MTe={[dF.variable]:"sizes.6",[gZ.variable]:LTe},UTe=n=>{var t;return((t=bc(ni.baseStyle,n))==null?void 0:t.field)??{}},VTe={width:dF.reference},FTe={borderStart:"1px solid",borderStartColor:oM.reference,color:sM.reference,bg:iM.reference,[sM.variable]:"colors.chakra-body-text",[oM.variable]:"colors.chakra-border-color",_dark:{[sM.variable]:"colors.whiteAlpha.800",[oM.variable]:"colors.whiteAlpha.300"},_active:{[iM.variable]:"colors.gray.200",_dark:{[iM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},jTe=mZ(n=>({root:MTe,field:bc(UTe,n)??{},stepperGroup:VTe,stepper:FTe}));function nO(n){var d,f;const t=(d=ni.sizes)==null?void 0:d[n],s={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((f=t.field)==null?void 0:f.fontSize)??"md",l=fZ.fontSizes[a];return mZ({field:{...t.field,paddingInlineEnd:gZ.reference,verticalAlign:"top"},stepper:{fontSize:mf(l).multiply(.75).toString(),_first:{borderTopEndRadius:s[n]},_last:{borderBottomEndRadius:s[n],mt:"-1px",borderTopWidth:1}}})}const BTe={xs:nO("xs"),sm:nO("sm"),md:nO("md"),lg:nO("lg")},WTe=xTe({baseStyle:jTe,sizes:BTe,variants:ni.variants,defaultProps:ni.defaultProps});var pQ;const zTe={...(pQ=ni.baseStyle)==null?void 0:pQ.field,textAlign:"center"},GTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var fQ;const HTe={outline:n=>{var t,s;return((s=bc((t=ni.variants)==null?void 0:t.outline,n))==null?void 0:s.field)??{}},flushed:n=>{var t,s;return((s=bc((t=ni.variants)==null?void 0:t.flushed,n))==null?void 0:s.field)??{}},filled:n=>{var t,s;return((s=bc((t=ni.variants)==null?void 0:t.filled,n))==null?void 0:s.field)??{}},unstyled:((fQ=ni.variants)==null?void 0:fQ.unstyled.field)??{}},$Te={baseStyle:zTe,sizes:GTe,variants:HTe,defaultProps:ni.defaultProps},{defineMultiStyleConfig:KTe,definePartsStyle:qTe}=zi(uSe.keys),rO=bo("popper-bg"),YTe=bo("popper-arrow-bg"),wK=bo("popper-arrow-shadow-color"),XTe={zIndex:"popover"},JTe={[rO.variable]:"colors.white",bg:rO.reference,[YTe.variable]:rO.reference,[wK.variable]:"colors.gray.200",_dark:{[rO.variable]:"colors.gray.700",[wK.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},QTe={px:3,py:2,borderBottomWidth:"1px"},ZTe={px:3,py:2},ewe={px:3,py:2,borderTopWidth:"1px"},twe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},nwe=qTe({popper:XTe,content:JTe,header:QTe,body:ZTe,footer:ewe,closeButton:twe}),rwe=KTe({baseStyle:nwe}),{defineMultiStyleConfig:iwe,definePartsStyle:kw}=zi(dSe.keys),swe=n=>{const{colorScheme:t,theme:s,isIndeterminate:a,hasStripe:l}=n,d=Mn(EK(),EK("1rem","rgba(0,0,0,0.1)"))(n),f=Mn(`${t}.500`,`${t}.200`)(n),y=`linear-gradient(
    to right,
    transparent 0%,
    ${Sc(s,f)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:y}:{bgColor:f}}},owe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},awe=n=>({bg:Mn("gray.100","whiteAlpha.300")(n)}),cwe=n=>({transitionProperty:"common",transitionDuration:"slow",...swe(n)}),lwe=kw(n=>({label:owe,filledTrack:cwe(n),track:awe(n)})),uwe={xs:kw({track:{h:"1"}}),sm:kw({track:{h:"2"}}),md:kw({track:{h:"3"}}),lg:kw({track:{h:"4"}})},dwe=iwe({sizes:uwe,baseStyle:lwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:hwe,definePartsStyle:MO}=zi(hSe.keys),pwe=n=>{var s;const t=(s=bc(ag.baseStyle,n))==null?void 0:s.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},fwe=MO(n=>{var t,s;return{label:(t=ag.baseStyle)==null?void 0:t.call(ag,n).label,container:(s=ag.baseStyle)==null?void 0:s.call(ag,n).container,control:pwe(n)}}),mwe={md:MO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:MO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:MO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},gwe=hwe({baseStyle:fwe,sizes:mwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:_we,definePartsStyle:ywe}=zi(pSe.keys),iO=Un("select-bg");var mQ;const Ewe={...(mQ=ni.baseStyle)==null?void 0:mQ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:iO.reference,[iO.variable]:"colors.white",_dark:{[iO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:iO.reference}},vwe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},Swe=ywe({field:Ewe,icon:vwe}),sO={paddingInlineEnd:"8"};var gQ,_Q,yQ,EQ,vQ,SQ,bQ,TQ;const bwe={lg:{...(gQ=ni.sizes)==null?void 0:gQ.lg,field:{...(_Q=ni.sizes)==null?void 0:_Q.lg.field,...sO}},md:{...(yQ=ni.sizes)==null?void 0:yQ.md,field:{...(EQ=ni.sizes)==null?void 0:EQ.md.field,...sO}},sm:{...(vQ=ni.sizes)==null?void 0:vQ.sm,field:{...(SQ=ni.sizes)==null?void 0:SQ.sm.field,...sO}},xs:{...(bQ=ni.sizes)==null?void 0:bQ.xs,field:{...(TQ=ni.sizes)==null?void 0:TQ.xs.field,...sO},icon:{insetEnd:"1"}}},Twe=_we({baseStyle:Swe,sizes:bwe,variants:ni.variants,defaultProps:ni.defaultProps}),aM=Un("skeleton-start-color"),cM=Un("skeleton-end-color"),wwe={[aM.variable]:"colors.gray.100",[cM.variable]:"colors.gray.400",_dark:{[aM.variable]:"colors.gray.800",[cM.variable]:"colors.gray.600"},background:aM.reference,borderColor:cM.reference,opacity:.7,borderRadius:"sm"},Cwe={baseStyle:wwe},lM=Un("skip-link-bg"),Rwe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[lM.variable]:"colors.white",_dark:{[lM.variable]:"colors.gray.700"},bg:lM.reference}},Iwe={baseStyle:Rwe},{defineMultiStyleConfig:Awe,definePartsStyle:d1}=zi(fSe.keys),ky=Un("slider-thumb-size"),gC=Un("slider-track-size"),cg=Un("slider-bg"),Pwe=n=>{const{orientation:t}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...cF({orientation:t,vertical:{h:"100%",px:ff(ky.reference).divide(2).toString()},horizontal:{w:"100%",py:ff(ky.reference).divide(2).toString()}})}},Owe=n=>({...cF({orientation:n.orientation,horizontal:{h:gC.reference},vertical:{w:gC.reference}}),overflow:"hidden",borderRadius:"sm",[cg.variable]:"colors.gray.200",_dark:{[cg.variable]:"colors.whiteAlpha.200"},_disabled:{[cg.variable]:"colors.gray.300",_dark:{[cg.variable]:"colors.whiteAlpha.300"}},bg:cg.reference}),kwe=n=>{const{orientation:t}=n;return{...cF({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:ky.reference,h:ky.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},Nwe=n=>{const{colorScheme:t}=n;return{width:"inherit",height:"inherit",[cg.variable]:`colors.${t}.500`,_dark:{[cg.variable]:`colors.${t}.200`},bg:cg.reference}},Dwe=d1(n=>({container:Pwe(n),track:Owe(n),thumb:kwe(n),filledTrack:Nwe(n)})),xwe=d1({container:{[ky.variable]:"sizes.4",[gC.variable]:"sizes.1"}}),Lwe=d1({container:{[ky.variable]:"sizes.3.5",[gC.variable]:"sizes.1"}}),Mwe=d1({container:{[ky.variable]:"sizes.2.5",[gC.variable]:"sizes.0.5"}}),Uwe={lg:xwe,md:Lwe,sm:Mwe},Vwe=Awe({baseStyle:Dwe,sizes:Uwe,defaultProps:{size:"md",colorScheme:"blue"}}),hy=bo("spinner-size"),Fwe={width:[hy.reference],height:[hy.reference]},jwe={xs:{[hy.variable]:"sizes.3"},sm:{[hy.variable]:"sizes.4"},md:{[hy.variable]:"sizes.6"},lg:{[hy.variable]:"sizes.8"},xl:{[hy.variable]:"sizes.12"}},Bwe={baseStyle:Fwe,sizes:jwe,defaultProps:{size:"md"}},{defineMultiStyleConfig:Wwe,definePartsStyle:_Z}=zi(mSe.keys),zwe={fontWeight:"medium"},Gwe={opacity:.8,marginBottom:"2"},Hwe={verticalAlign:"baseline",fontWeight:"semibold"},$we={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},Kwe=_Z({container:{},label:zwe,helpText:Gwe,number:Hwe,icon:$we}),qwe={md:_Z({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},Ywe=Wwe({baseStyle:Kwe,sizes:qwe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:Xwe,definePartsStyle:Nw}=zi(["stepper","step","title","description","indicator","separator","icon","number"]),gf=Un("stepper-indicator-size"),NS=Un("stepper-icon-size"),DS=Un("stepper-title-font-size"),Dw=Un("stepper-description-font-size"),uw=Un("stepper-accent-color"),Jwe=Nw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[uw.variable]:`colors.${n}.500`,_dark:{[uw.variable]:`colors.${n}.200`}},title:{fontSize:DS.reference,fontWeight:"medium"},description:{fontSize:Dw.reference,color:"chakra-subtle-text"},number:{fontSize:DS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:NS.reference,height:NS.reference},indicator:{flexShrink:0,borderRadius:"full",width:gf.reference,height:gf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:uw.reference},"&[data-status=complete]":{bg:uw.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:uw.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${gf.reference} - 8px)`,top:`calc(${gf.reference} + 4px)`,insetStart:`calc(${gf.reference} / 2 - 1px)`}}})),Qwe=Xwe({baseStyle:Jwe,sizes:{xs:Nw({stepper:{[gf.variable]:"sizes.4",[NS.variable]:"sizes.3",[DS.variable]:"fontSizes.xs",[Dw.variable]:"fontSizes.xs"}}),sm:Nw({stepper:{[gf.variable]:"sizes.6",[NS.variable]:"sizes.4",[DS.variable]:"fontSizes.sm",[Dw.variable]:"fontSizes.xs"}}),md:Nw({stepper:{[gf.variable]:"sizes.8",[NS.variable]:"sizes.5",[DS.variable]:"fontSizes.md",[Dw.variable]:"fontSizes.sm"}}),lg:Nw({stepper:{[gf.variable]:"sizes.10",[NS.variable]:"sizes.6",[DS.variable]:"fontSizes.lg",[Dw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Zwe,definePartsStyle:UO}=zi(gSe.keys),Qw=bo("switch-track-width"),Sy=bo("switch-track-height"),uM=bo("switch-track-diff"),eCe=mf.subtract(Qw,Sy),CU=bo("switch-thumb-x"),dw=bo("switch-bg"),tCe=n=>{const{colorScheme:t}=n;return{borderRadius:"full",p:"0.5",width:[Qw.reference],height:[Sy.reference],transitionProperty:"common",transitionDuration:"fast",[dw.variable]:"colors.gray.300",_dark:{[dw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[dw.variable]:`colors.${t}.500`,_dark:{[dw.variable]:`colors.${t}.200`}},bg:dw.reference}},nCe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Sy.reference],height:[Sy.reference],_checked:{transform:`translateX(${CU.reference})`}},rCe=UO(n=>({container:{[uM.variable]:eCe,[CU.variable]:uM.reference,_rtl:{[CU.variable]:mf(uM).negate().toString()}},track:tCe(n),thumb:nCe})),iCe={sm:UO({container:{[Qw.variable]:"1.375rem",[Sy.variable]:"sizes.3"}}),md:UO({container:{[Qw.variable]:"1.875rem",[Sy.variable]:"sizes.4"}}),lg:UO({container:{[Qw.variable]:"2.875rem",[Sy.variable]:"sizes.6"}})},sCe=Zwe({baseStyle:rCe,sizes:iCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:oCe,definePartsStyle:YS}=zi(_Se.keys),aCe=YS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),Sk={"&[data-is-numeric=true]":{textAlign:"end"}},cCe=YS(n=>{const{colorScheme:t}=n;return{th:{color:Mn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Mn(`${t}.100`,`${t}.700`)(n),...Sk},td:{borderBottom:"1px",borderColor:Mn(`${t}.100`,`${t}.700`)(n),...Sk},caption:{color:Mn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),lCe=YS(n=>{const{colorScheme:t}=n;return{th:{color:Mn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Mn(`${t}.100`,`${t}.700`)(n),...Sk},td:{borderBottom:"1px",borderColor:Mn(`${t}.100`,`${t}.700`)(n),...Sk},caption:{color:Mn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Mn(`${t}.100`,`${t}.700`)(n)},td:{background:Mn(`${t}.100`,`${t}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),uCe={simple:cCe,striped:lCe,unstyled:{}},dCe={sm:YS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:YS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:YS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},hCe=oCe({baseStyle:aCe,variants:uCe,sizes:dCe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),ol=Un("tabs-color"),kd=Un("tabs-bg"),oO=Un("tabs-border-color"),{defineMultiStyleConfig:pCe,definePartsStyle:qh}=zi(ySe.keys),fCe=n=>{const{orientation:t}=n;return{display:t==="vertical"?"flex":"block"}},mCe=n=>{const{isFitted:t}=n;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},gCe=n=>{const{align:t="start",orientation:s}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:s==="vertical"?"column":"row"}},_Ce={p:4},yCe=qh(n=>({root:fCe(n),tab:mCe(n),tablist:gCe(n),tabpanel:_Ce})),ECe={sm:qh({tab:{py:1,px:4,fontSize:"sm"}}),md:qh({tab:{fontSize:"md",py:2,px:4}}),lg:qh({tab:{fontSize:"lg",py:3,px:4}})},vCe=qh(n=>{const{colorScheme:t,orientation:s}=n,a=s==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[ol.variable]:`colors.${t}.600`,_dark:{[ol.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[kd.variable]:"colors.gray.200",_dark:{[kd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:ol.reference,bg:kd.reference}}}),SCe=qh(n=>{const{colorScheme:t}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[oO.variable]:"transparent",_selected:{[ol.variable]:`colors.${t}.600`,[oO.variable]:"colors.white",_dark:{[ol.variable]:`colors.${t}.300`,[oO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:oO.reference},color:ol.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),bCe=qh(n=>{const{colorScheme:t}=n;return{tab:{border:"1px solid",borderColor:"inherit",[kd.variable]:"colors.gray.50",_dark:{[kd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[kd.variable]:"colors.white",[ol.variable]:`colors.${t}.600`,_dark:{[kd.variable]:"colors.gray.800",[ol.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:ol.reference,bg:kd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),TCe=qh(n=>{const{colorScheme:t,theme:s}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Sc(s,`${t}.700`),bg:Sc(s,`${t}.100`)}}}}),wCe=qh(n=>{const{colorScheme:t}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[ol.variable]:"colors.gray.600",_dark:{[ol.variable]:"inherit"},_selected:{[ol.variable]:"colors.white",[kd.variable]:`colors.${t}.600`,_dark:{[ol.variable]:"colors.gray.800",[kd.variable]:`colors.${t}.300`}},color:ol.reference,bg:kd.reference}}}),CCe=qh({}),RCe={line:vCe,enclosed:SCe,"enclosed-colored":bCe,"soft-rounded":TCe,"solid-rounded":wCe,unstyled:CCe},ICe=pCe({baseStyle:yCe,sizes:ECe,variants:RCe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:ACe,definePartsStyle:by}=zi(ESe.keys),CK=Un("tag-bg"),RK=Un("tag-color"),dM=Un("tag-shadow"),VO=Un("tag-min-height"),FO=Un("tag-min-width"),jO=Un("tag-font-size"),BO=Un("tag-padding-inline"),PCe={fontWeight:"medium",lineHeight:1.2,outline:0,[RK.variable]:Hs.color.reference,[CK.variable]:Hs.bg.reference,[dM.variable]:Hs.shadow.reference,color:RK.reference,bg:CK.reference,boxShadow:dM.reference,borderRadius:"md",minH:VO.reference,minW:FO.reference,fontSize:jO.reference,px:BO.reference,_focusVisible:{[dM.variable]:"shadows.outline"}},OCe={lineHeight:1.2,overflow:"visible"},kCe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},NCe=by({container:PCe,label:OCe,closeButton:kCe}),DCe={sm:by({container:{[VO.variable]:"sizes.5",[FO.variable]:"sizes.5",[jO.variable]:"fontSizes.xs",[BO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:by({container:{[VO.variable]:"sizes.6",[FO.variable]:"sizes.6",[jO.variable]:"fontSizes.sm",[BO.variable]:"space.2"}}),lg:by({container:{[VO.variable]:"sizes.8",[FO.variable]:"sizes.8",[jO.variable]:"fontSizes.md",[BO.variable]:"space.3"}})},xCe={subtle:by(n=>{var t;return{container:(t=Yw.variants)==null?void 0:t.subtle(n)}}),solid:by(n=>{var t;return{container:(t=Yw.variants)==null?void 0:t.solid(n)}}),outline:by(n=>{var t;return{container:(t=Yw.variants)==null?void 0:t.outline(n)}})},LCe=ACe({variants:xCe,baseStyle:NCe,sizes:DCe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var wQ;const MCe={...(wQ=ni.baseStyle)==null?void 0:wQ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var CQ;const UCe={outline:n=>{var t;return((t=ni.variants)==null?void 0:t.outline(n).field)??{}},flushed:n=>{var t;return((t=ni.variants)==null?void 0:t.flushed(n).field)??{}},filled:n=>{var t;return((t=ni.variants)==null?void 0:t.filled(n).field)??{}},unstyled:((CQ=ni.variants)==null?void 0:CQ.unstyled.field)??{}};var RQ,IQ,AQ,PQ;const VCe={xs:((RQ=ni.sizes)==null?void 0:RQ.xs.field)??{},sm:((IQ=ni.sizes)==null?void 0:IQ.sm.field)??{},md:((AQ=ni.sizes)==null?void 0:AQ.md.field)??{},lg:((PQ=ni.sizes)==null?void 0:PQ.lg.field)??{}},FCe={baseStyle:MCe,sizes:VCe,variants:UCe,defaultProps:{size:"md",variant:"outline"}},aO=bo("tooltip-bg"),hM=bo("tooltip-fg"),jCe=bo("popper-arrow-bg"),BCe={bg:aO.reference,color:hM.reference,[aO.variable]:"colors.gray.700",[hM.variable]:"colors.whiteAlpha.900",_dark:{[aO.variable]:"colors.gray.300",[hM.variable]:"colors.gray.900"},[jCe.variable]:aO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},WCe={baseStyle:BCe},zCe={Accordion:ASe,Alert:d0e,Avatar:b0e,Badge:Yw,Breadcrumb:N0e,Button:B0e,Checkbox:ag,CloseButton:nbe,Code:obe,Container:cbe,Divider:pbe,Drawer:wbe,Editable:kbe,Form:Ube,FormError:zbe,FormLabel:Hbe,Heading:qbe,Input:ni,Kbd:iTe,Link:oTe,List:dTe,Menu:bTe,Modal:DTe,NumberInput:WTe,PinInput:$Te,Popover:rwe,Progress:dwe,Radio:gwe,Select:Twe,Skeleton:Cwe,SkipLink:Iwe,Slider:Vwe,Spinner:Bwe,Stat:Ywe,Switch:sCe,Table:hCe,Tabs:ICe,Tag:LCe,Textarea:FCe,Tooltip:WCe,Card:$0e,Stepper:Qwe},GCe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},HCe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},$Ce={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},KCe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},qCe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},YCe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},XCe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},JCe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},QCe={property:YCe,easing:XCe,duration:JCe},ZCe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},eRe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},tRe={breakpoints:HCe,zIndices:ZCe,radii:KCe,blur:eRe,colors:$Ce,...fZ,sizes:cZ,shadows:qCe,space:aZ,borders:GCe,transition:QCe},nRe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},rRe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},iRe="ltr",sRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},oRe={semanticTokens:nRe,direction:iRe,...tRe,components:zCe,styles:rRe,config:sRe};function aRe(n){if(n.sheet)return n.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===n)return document.styleSheets[t]}function cRe(n){var t=document.createElement("style");return t.setAttribute("data-emotion",n.key),n.nonce!==void 0&&t.setAttribute("nonce",n.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var lRe=function(){function n(s){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=s.speedy===void 0?!0:s.speedy,this.tags=[],this.ctr=0,this.nonce=s.nonce,this.key=s.key,this.container=s.container,this.prepend=s.prepend,this.insertionPoint=s.insertionPoint,this.before=null}var t=n.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(cRe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=aRe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),Ka="-ms-",bk="-moz-",ei="-webkit-",yZ="comm",hF="rule",pF="decl",uRe="@import",EZ="@keyframes",dRe="@layer",hRe=Math.abs,h1=String.fromCharCode,pRe=Object.assign;function fRe(n,t){return va(n,0)^45?(((t<<2^va(n,0))<<2^va(n,1))<<2^va(n,2))<<2^va(n,3):0}function vZ(n){return n.trim()}function mRe(n,t){return(n=t.exec(n))?n[0]:n}function ti(n,t,s){return n.replace(t,s)}function RU(n,t){return n.indexOf(t)}function va(n,t){return n.charCodeAt(t)|0}function _C(n,t,s){return n.slice(t,s)}function Uh(n){return n.length}function fF(n){return n.length}function cO(n,t){return t.push(n),n}function gRe(n,t){return n.map(t).join("")}var p1=1,l0=1,SZ=0,dl=0,to=0,D0="";function f1(n,t,s,a,l,d,f){return{value:n,root:t,parent:s,type:a,props:l,children:d,line:p1,column:l0,length:f,return:""}}function hw(n,t){return pRe(f1("",null,null,"",null,null,0),n,{length:-n.length},t)}function _Re(){return to}function yRe(){return to=dl>0?va(D0,--dl):0,l0--,to===10&&(l0=1,p1--),to}function Bl(){return to=dl<SZ?va(D0,dl++):0,l0++,to===10&&(l0=1,p1++),to}function Yh(){return va(D0,dl)}function WO(){return dl}function zC(n,t){return _C(D0,n,t)}function yC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function bZ(n){return p1=l0=1,SZ=Uh(D0=n),dl=0,[]}function TZ(n){return D0="",n}function zO(n){return vZ(zC(dl-1,IU(n===91?n+2:n===40?n+1:n)))}function ERe(n){for(;(to=Yh())&&to<33;)Bl();return yC(n)>2||yC(to)>3?"":" "}function vRe(n,t){for(;--t&&Bl()&&!(to<48||to>102||to>57&&to<65||to>70&&to<97););return zC(n,WO()+(t<6&&Yh()==32&&Bl()==32))}function IU(n){for(;Bl();)switch(to){case n:return dl;case 34:case 39:n!==34&&n!==39&&IU(to);break;case 40:n===41&&IU(n);break;case 92:Bl();break}return dl}function SRe(n,t){for(;Bl()&&n+to!==57;)if(n+to===84&&Yh()===47)break;return"/*"+zC(t,dl-1)+"*"+h1(n===47?n:Bl())}function bRe(n){for(;!yC(Yh());)Bl();return zC(n,dl)}function TRe(n){return TZ(GO("",null,null,null,[""],n=bZ(n),0,[0],n))}function GO(n,t,s,a,l,d,f,y,v){for(var b=0,w=0,I=f,k=0,L=0,V=0,B=1,W=1,Q=1,$=0,ie="",ce=l,ne=d,de=a,Y=ie;W;)switch(V=$,$=Bl()){case 40:if(V!=108&&va(Y,I-1)==58){RU(Y+=ti(zO($),"&","&\f"),"&\f")!=-1&&(Q=-1);break}case 34:case 39:case 91:Y+=zO($);break;case 9:case 10:case 13:case 32:Y+=ERe(V);break;case 92:Y+=vRe(WO()-1,7);continue;case 47:switch(Yh()){case 42:case 47:cO(wRe(SRe(Bl(),WO()),t,s),v);break;default:Y+="/"}break;case 123*B:y[b++]=Uh(Y)*Q;case 125*B:case 59:case 0:switch($){case 0:case 125:W=0;case 59+w:Q==-1&&(Y=ti(Y,/\f/g,"")),L>0&&Uh(Y)-I&&cO(L>32?AK(Y+";",a,s,I-1):AK(ti(Y," ","")+";",a,s,I-2),v);break;case 59:Y+=";";default:if(cO(de=IK(Y,t,s,b,w,l,y,ie,ce=[],ne=[],I),d),$===123)if(w===0)GO(Y,t,de,de,ce,d,I,y,ne);else switch(k===99&&va(Y,3)===110?100:k){case 100:case 108:case 109:case 115:GO(n,de,de,a&&cO(IK(n,de,de,0,0,l,y,ie,l,ce=[],I),ne),l,ne,I,y,a?ce:ne);break;default:GO(Y,de,de,de,[""],ne,0,y,ne)}}b=w=L=0,B=Q=1,ie=Y="",I=f;break;case 58:I=1+Uh(Y),L=V;default:if(B<1){if($==123)--B;else if($==125&&B++==0&&yRe()==125)continue}switch(Y+=h1($),$*B){case 38:Q=w>0?1:(Y+="\f",-1);break;case 44:y[b++]=(Uh(Y)-1)*Q,Q=1;break;case 64:Yh()===45&&(Y+=zO(Bl())),k=Yh(),w=I=Uh(ie=Y+=bRe(WO())),$++;break;case 45:V===45&&Uh(Y)==2&&(B=0)}}return d}function IK(n,t,s,a,l,d,f,y,v,b,w){for(var I=l-1,k=l===0?d:[""],L=fF(k),V=0,B=0,W=0;V<a;++V)for(var Q=0,$=_C(n,I+1,I=hRe(B=f[V])),ie=n;Q<L;++Q)(ie=vZ(B>0?k[Q]+" "+$:ti($,/&\f/g,k[Q])))&&(v[W++]=ie);return f1(n,t,s,l===0?hF:y,v,b,w)}function wRe(n,t,s){return f1(n,t,s,yZ,h1(_Re()),_C(n,2,-2),0)}function AK(n,t,s,a){return f1(n,t,s,pF,_C(n,0,a),_C(n,a+1,-1),a)}function XS(n,t){for(var s="",a=fF(n),l=0;l<a;l++)s+=t(n[l],l,n,t)||"";return s}function CRe(n,t,s,a){switch(n.type){case dRe:if(n.children.length)break;case uRe:case pF:return n.return=n.return||n.value;case yZ:return"";case EZ:return n.return=n.value+"{"+XS(n.children,a)+"}";case hF:n.value=n.props.join(",")}return Uh(s=XS(n.children,a))?n.return=n.value+"{"+s+"}":""}function RRe(n){var t=fF(n);return function(s,a,l,d){for(var f="",y=0;y<t;y++)f+=n[y](s,a,l,d)||"";return f}}function IRe(n){return function(t){t.root||(t=t.return)&&n(t)}}var PK=function(t){var s=new WeakMap;return function(a){if(s.has(a))return s.get(a);var l=t(a);return s.set(a,l),l}};function wZ(n){var t=Object.create(null);return function(s){return t[s]===void 0&&(t[s]=n(s)),t[s]}}var ARe=function(t,s,a){for(var l=0,d=0;l=d,d=Yh(),l===38&&d===12&&(s[a]=1),!yC(d);)Bl();return zC(t,dl)},PRe=function(t,s){var a=-1,l=44;do switch(yC(l)){case 0:l===38&&Yh()===12&&(s[a]=1),t[a]+=ARe(dl-1,s,a);break;case 2:t[a]+=zO(l);break;case 4:if(l===44){t[++a]=Yh()===58?"&\f":"",s[a]=t[a].length;break}default:t[a]+=h1(l)}while(l=Bl());return t},ORe=function(t,s){return TZ(PRe(bZ(t),s))},OK=new WeakMap,kRe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var s=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&s.charCodeAt(0)!==58&&!OK.get(a))&&!l){OK.set(t,!0);for(var d=[],f=ORe(s,d),y=a.props,v=0,b=0;v<f.length;v++)for(var w=0;w<y.length;w++,b++)t.props[b]=d[v]?f[v].replace(/&\f/g,y[w]):y[w]+" "+f[v]}}},NRe=function(t){if(t.type==="decl"){var s=t.value;s.charCodeAt(0)===108&&s.charCodeAt(2)===98&&(t.return="",t.value="")}};function CZ(n,t){switch(fRe(n,t)){case 5103:return ei+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ei+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return ei+n+bk+n+Ka+n+n;case 6828:case 4268:return ei+n+Ka+n+n;case 6165:return ei+n+Ka+"flex-"+n+n;case 5187:return ei+n+ti(n,/(\w+).+(:[^]+)/,ei+"box-$1$2"+Ka+"flex-$1$2")+n;case 5443:return ei+n+Ka+"flex-item-"+ti(n,/flex-|-self/,"")+n;case 4675:return ei+n+Ka+"flex-line-pack"+ti(n,/align-content|flex-|-self/,"")+n;case 5548:return ei+n+Ka+ti(n,"shrink","negative")+n;case 5292:return ei+n+Ka+ti(n,"basis","preferred-size")+n;case 6060:return ei+"box-"+ti(n,"-grow","")+ei+n+Ka+ti(n,"grow","positive")+n;case 4554:return ei+ti(n,/([^-])(transform)/g,"$1"+ei+"$2")+n;case 6187:return ti(ti(ti(n,/(zoom-|grab)/,ei+"$1"),/(image-set)/,ei+"$1"),n,"")+n;case 5495:case 3959:return ti(n,/(image-set\([^]*)/,ei+"$1$`$1");case 4968:return ti(ti(n,/(.+:)(flex-)?(.*)/,ei+"box-pack:$3"+Ka+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ei+n+n;case 4095:case 3583:case 4068:case 2532:return ti(n,/(.+)-inline(.+)/,ei+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Uh(n)-1-t>6)switch(va(n,t+1)){case 109:if(va(n,t+4)!==45)break;case 102:return ti(n,/(.+:)(.+)-([^]+)/,"$1"+ei+"$2-$3$1"+bk+(va(n,t+3)==108?"$3":"$2-$3"))+n;case 115:return~RU(n,"stretch")?CZ(ti(n,"stretch","fill-available"),t)+n:n}break;case 4949:if(va(n,t+1)!==115)break;case 6444:switch(va(n,Uh(n)-3-(~RU(n,"!important")&&10))){case 107:return ti(n,":",":"+ei)+n;case 101:return ti(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ei+(va(n,14)===45?"inline-":"")+"box$3$1"+ei+"$2$3$1"+Ka+"$2box$3")+n}break;case 5936:switch(va(n,t+11)){case 114:return ei+n+Ka+ti(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return ei+n+Ka+ti(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return ei+n+Ka+ti(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return ei+n+Ka+n+n}return n}var DRe=function(t,s,a,l){if(t.length>-1&&!t.return)switch(t.type){case pF:t.return=CZ(t.value,t.length);break;case EZ:return XS([hw(t,{value:ti(t.value,"@","@"+ei)})],l);case hF:if(t.length)return gRe(t.props,function(d){switch(mRe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return XS([hw(t,{props:[ti(d,/:(read-\w+)/,":"+bk+"$1")]})],l);case"::placeholder":return XS([hw(t,{props:[ti(d,/:(plac\w+)/,":"+ei+"input-$1")]}),hw(t,{props:[ti(d,/:(plac\w+)/,":"+bk+"$1")]}),hw(t,{props:[ti(d,/:(plac\w+)/,Ka+"input-$1")]})],l)}return""})}},xRe=[DRe],LRe=function(t){var s=t.key;if(s==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(B){var W=B.getAttribute("data-emotion");W.indexOf(" ")!==-1&&(document.head.appendChild(B),B.setAttribute("data-s",""))})}var l=t.stylisPlugins||xRe,d={},f,y=[];f=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+s+' "]'),function(B){for(var W=B.getAttribute("data-emotion").split(" "),Q=1;Q<W.length;Q++)d[W[Q]]=!0;y.push(B)});var v,b=[kRe,NRe];{var w,I=[CRe,IRe(function(B){w.insert(B)})],k=RRe(b.concat(l,I)),L=function(W){return XS(TRe(W),k)};v=function(W,Q,$,ie){w=$,L(W?W+"{"+Q.styles+"}":Q.styles),ie&&(V.inserted[Q.name]=!0)}}var V={key:s,sheet:new lRe({key:s,container:f,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:v};return V.sheet.hydrate(y),V};function Ny(){return Ny=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(n[a]=s[a])}return n},Ny.apply(null,arguments)}var pM={exports:{}},li={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kK;function MRe(){if(kK)return li;kK=1;var n=typeof Symbol=="function"&&Symbol.for,t=n?Symbol.for("react.element"):60103,s=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,y=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,w=n?Symbol.for("react.forward_ref"):60112,I=n?Symbol.for("react.suspense"):60113,k=n?Symbol.for("react.suspense_list"):60120,L=n?Symbol.for("react.memo"):60115,V=n?Symbol.for("react.lazy"):60116,B=n?Symbol.for("react.block"):60121,W=n?Symbol.for("react.fundamental"):60117,Q=n?Symbol.for("react.responder"):60118,$=n?Symbol.for("react.scope"):60119;function ie(ne){if(typeof ne=="object"&&ne!==null){var de=ne.$$typeof;switch(de){case t:switch(ne=ne.type,ne){case v:case b:case a:case d:case l:case I:return ne;default:switch(ne=ne&&ne.$$typeof,ne){case y:case w:case V:case L:case f:return ne;default:return de}}case s:return de}}}function ce(ne){return ie(ne)===b}return li.AsyncMode=v,li.ConcurrentMode=b,li.ContextConsumer=y,li.ContextProvider=f,li.Element=t,li.ForwardRef=w,li.Fragment=a,li.Lazy=V,li.Memo=L,li.Portal=s,li.Profiler=d,li.StrictMode=l,li.Suspense=I,li.isAsyncMode=function(ne){return ce(ne)||ie(ne)===v},li.isConcurrentMode=ce,li.isContextConsumer=function(ne){return ie(ne)===y},li.isContextProvider=function(ne){return ie(ne)===f},li.isElement=function(ne){return typeof ne=="object"&&ne!==null&&ne.$$typeof===t},li.isForwardRef=function(ne){return ie(ne)===w},li.isFragment=function(ne){return ie(ne)===a},li.isLazy=function(ne){return ie(ne)===V},li.isMemo=function(ne){return ie(ne)===L},li.isPortal=function(ne){return ie(ne)===s},li.isProfiler=function(ne){return ie(ne)===d},li.isStrictMode=function(ne){return ie(ne)===l},li.isSuspense=function(ne){return ie(ne)===I},li.isValidElementType=function(ne){return typeof ne=="string"||typeof ne=="function"||ne===a||ne===b||ne===d||ne===l||ne===I||ne===k||typeof ne=="object"&&ne!==null&&(ne.$$typeof===V||ne.$$typeof===L||ne.$$typeof===f||ne.$$typeof===y||ne.$$typeof===w||ne.$$typeof===W||ne.$$typeof===Q||ne.$$typeof===$||ne.$$typeof===B)},li.typeOf=ie,li}var NK;function URe(){return NK||(NK=1,pM.exports=MRe()),pM.exports}var fM,DK;function VRe(){if(DK)return fM;DK=1;var n=URe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=a,d[n.Memo]=l;function f(V){return n.isMemo(V)?l:d[V.$$typeof]||t}var y=Object.defineProperty,v=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,k=Object.prototype;function L(V,B,W){if(typeof B!="string"){if(k){var Q=I(B);Q&&Q!==k&&L(V,Q,W)}var $=v(B);b&&($=$.concat(b(B)));for(var ie=f(V),ce=f(B),ne=0;ne<$.length;++ne){var de=$[ne];if(!s[de]&&!(W&&W[de])&&!(ce&&ce[de])&&!(ie&&ie[de])){var Y=w(B,de);try{y(V,de,Y)}catch{}}}}return V}return fM=L,fM}var FRe=VRe();const jRe=Ng(FRe);var BRe=!0;function RZ(n,t,s){var a="";return s.split(" ").forEach(function(l){n[l]!==void 0?t.push(n[l]+";"):l&&(a+=l+" ")}),a}var mF=function(t,s,a){var l=t.key+"-"+s.name;(a===!1||BRe===!1)&&t.registered[l]===void 0&&(t.registered[l]=s.styles)},gF=function(t,s,a){mF(t,s,a);var l=t.key+"-"+s.name;if(t.inserted[s.name]===void 0){var d=s;do t.insert(s===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function WRe(n){for(var t=0,s,a=0,l=n.length;l>=4;++a,l-=4)s=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,s=(s&65535)*1540483477+((s>>>16)*59797<<16),s^=s>>>24,t=(s&65535)*1540483477+((s>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(n.charCodeAt(a+2)&255)<<16;case 2:t^=(n.charCodeAt(a+1)&255)<<8;case 1:t^=n.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var zRe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},GRe=/[A-Z]|^ms/g,HRe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,IZ=function(t){return t.charCodeAt(1)===45},xK=function(t){return t!=null&&typeof t!="boolean"},mM=wZ(function(n){return IZ(n)?n:n.replace(GRe,"-$&").toLowerCase()}),LK=function(t,s){switch(t){case"animation":case"animationName":if(typeof s=="string")return s.replace(HRe,function(a,l,d){return Vh={name:l,styles:d,next:Vh},l})}return zRe[t]!==1&&!IZ(t)&&typeof s=="number"&&s!==0?s+"px":s};function EC(n,t,s){if(s==null)return"";var a=s;if(a.__emotion_styles!==void 0)return a;switch(typeof s){case"boolean":return"";case"object":{var l=s;if(l.anim===1)return Vh={name:l.name,styles:l.styles,next:Vh},l.name;var d=s;if(d.styles!==void 0){var f=d.next;if(f!==void 0)for(;f!==void 0;)Vh={name:f.name,styles:f.styles,next:Vh},f=f.next;var y=d.styles+";";return y}return $Re(n,t,s)}case"function":{if(n!==void 0){var v=Vh,b=s(n);return Vh=v,EC(n,t,b)}break}}var w=s;if(t==null)return w;var I=t[w];return I!==void 0?I:w}function $Re(n,t,s){var a="";if(Array.isArray(s))for(var l=0;l<s.length;l++)a+=EC(n,t,s[l])+";";else for(var d in s){var f=s[d];if(typeof f!="object"){var y=f;t!=null&&t[y]!==void 0?a+=d+"{"+t[y]+"}":xK(y)&&(a+=mM(d)+":"+LK(d,y)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(t==null||t[f[0]]===void 0))for(var v=0;v<f.length;v++)xK(f[v])&&(a+=mM(d)+":"+LK(d,f[v])+";");else{var b=EC(n,t,f);switch(d){case"animation":case"animationName":{a+=mM(d)+":"+b+";";break}default:a+=d+"{"+b+"}"}}}return a}var MK=/label:\s*([^\s;{]+)\s*(;|$)/g,Vh;function m1(n,t,s){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";Vh=void 0;var d=n[0];if(d==null||d.raw===void 0)a=!1,l+=EC(s,t,d);else{var f=d;l+=f[0]}for(var y=1;y<n.length;y++)if(l+=EC(s,t,n[y]),a){var v=d;l+=v[y]}MK.lastIndex=0;for(var b="",w;(w=MK.exec(l))!==null;)b+="-"+w[1];var I=WRe(l)+b;return{name:I,styles:l,next:Vh}}var KRe=function(t){return t()},AZ=$$.useInsertionEffect?$$.useInsertionEffect:!1,PZ=AZ||KRe,UK=AZ||D.useLayoutEffect,_F=D.createContext(typeof HTMLElement<"u"?LRe({key:"css"}):null);_F.Provider;var qRe=function(){return D.useContext(_F)},yF=function(t){return D.forwardRef(function(s,a){var l=D.useContext(_F);return t(s,l,a)})},u0=D.createContext({}),YRe=function(t,s){if(typeof s=="function"){var a=s(t);return a}return Ny({},t,s)},XRe=PK(function(n){return PK(function(t){return YRe(n,t)})}),JRe=function(t){var s=D.useContext(u0);return t.theme!==s&&(s=XRe(s)(t.theme)),D.createElement(u0.Provider,{value:s},t.children)},EF={}.hasOwnProperty,AU="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",QRe=function(t,s){var a={};for(var l in s)EF.call(s,l)&&(a[l]=s[l]);return a[AU]=t,a},ZRe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return mF(s,a,l),PZ(function(){return gF(s,a,l)}),null},eIe=yF(function(n,t,s){var a=n.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=n[AU],d=[a],f="";typeof n.className=="string"?f=RZ(t.registered,d,n.className):n.className!=null&&(f=n.className+" ");var y=m1(d,void 0,D.useContext(u0));f+=t.key+"-"+y.name;var v={};for(var b in n)EF.call(n,b)&&b!=="css"&&b!==AU&&(v[b]=n[b]);return v.className=f,s&&(v.ref=s),D.createElement(D.Fragment,null,D.createElement(ZRe,{cache:t,serialized:y,isStringTag:typeof l=="string"}),D.createElement(l,v))}),tIe=eIe,VK=function(t,s){var a=arguments;if(s==null||!EF.call(s,"css"))return D.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=tIe,d[1]=QRe(t,s);for(var f=2;f<l;f++)d[f]=a[f];return D.createElement.apply(null,d)};(function(n){var t;t||(t=n.JSX||(n.JSX={}))})(VK||(VK={}));var g1=yF(function(n,t){var s=n.styles,a=m1([s],void 0,D.useContext(u0)),l=D.useRef();return UK(function(){var d=t.key+"-global",f=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),y=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(f.before=t.sheet.tags[0]),v!==null&&(y=!0,v.setAttribute("data-emotion",d),f.hydrate([v])),l.current=[f,y],function(){f.flush()}},[t]),UK(function(){var d=l.current,f=d[0],y=d[1];if(y){d[1]=!1;return}if(a.next!==void 0&&gF(t,a.next,!0),f.tags.length){var v=f.tags[f.tags.length-1].nextElementSibling;f.before=v,f.flush()}t.insert("",a,f,!1)},[t,a.name]),null});function nIe(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return m1(t)}function GC(){var n=nIe.apply(void 0,arguments),t="animation-"+n.name;return{name:t,styles:"@keyframes "+t+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const vF=D.createContext({});vF.displayName="ColorModeContext";function _1(){const n=D.useContext(vF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function rIe(n,t){const{colorMode:s}=_1();return s==="dark"?t:n}const lO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function iIe(n={}){const{preventTransition:t=!0,nonce:s}=n,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?lO.dark:lO.light),document.body.classList.remove(l?lO.light:lO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),f=y=>{l(y.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(f):d.addEventListener("change",f),()=>{typeof d.removeListener=="function"?d.removeListener(f):d.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),s!==void 0&&(l.nonce=s),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const sIe="chakra-ui-color-mode";function oIe(n){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let s;try{s=localStorage.getItem(n)||t}catch{}return s||t},set(t){try{localStorage.setItem(n,t)}catch{}}}}const aIe=oIe(sIe),FK=()=>{},cIe=Tye()?D.useLayoutEffect:D.useEffect;function jK(n,t){return n.type==="cookie"&&n.ssr?n.get(t):t}const OZ=function(t){const{value:s,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:f}={},colorModeManager:y=aIe}=t,v=qRe(),b=d==="dark"?"dark":"light",[w,I]=D.useState(()=>jK(y,b)),[k,L]=D.useState(()=>jK(y)),{getSystemTheme:V,setClassName:B,setDataset:W,addListener:Q}=D.useMemo(()=>iIe({preventTransition:f,nonce:v==null?void 0:v.nonce}),[f,v==null?void 0:v.nonce]),$=d==="system"&&!w?k:w,ie=D.useCallback(de=>{const Y=de==="system"?V():de;I(Y),B(Y==="dark"),W(Y),y.set(Y)},[y,V,B,W]);cIe(()=>{d==="system"&&L(V())},[]),D.useEffect(()=>{const de=y.get();if(de){ie(de);return}if(d==="system"){ie("system");return}ie(b)},[y,b,d,ie]);const ce=D.useCallback(()=>{ie($==="dark"?"light":"dark")},[$,ie]);D.useEffect(()=>{if(l)return Q(ie)},[l,Q,ie]);const ne=D.useMemo(()=>({colorMode:s??$,toggleColorMode:s?FK:ce,setColorMode:s?FK:ie,forced:s!==void 0}),[$,ce,ie,s]);return C.jsx(vF.Provider,{value:ne,children:a})};OZ.displayName="ColorModeProvider";const kZ=String.raw,NZ=kZ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,lIe=()=>C.jsx(g1,{styles:NZ}),uIe=({scope:n=""})=>C.jsx(g1,{styles:kZ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${NZ}
    `});function dIe(n){const{cssVarsRoot:t,theme:s,children:a}=n,l=D.useMemo(()=>Yve(s),[s]);return C.jsxs(JRe,{theme:l,children:[C.jsx(hIe,{root:t}),a]})}function hIe({root:n=":host, :root"}){const t=[n,"[data-theme]"].join(",");return C.jsx(g1,{styles:s=>({[t]:s.__cssVars})})}Oi({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function pIe(){const{colorMode:n}=_1();return C.jsx(g1,{styles:t=>{const s=FQ(t,"styles.global"),a=cl(s,{theme:t,colorMode:n});return a?rZ(a)(t):void 0}})}const[fIe,mIe]=Oi({strict:!1,name:"PortalManagerContext"});function SF(n){const{children:t,zIndex:s}=n;return C.jsx(fIe,{value:{zIndex:s},children:t})}SF.displayName="PortalManager";const bF=D.createContext({getDocument(){return document},getWindow(){return window}});bF.displayName="EnvironmentContext";function gIe({defer:n}={}){const[,t]=D.useReducer(s=>s+1,0);return Kh(()=>{n&&t()},[n]),D.useContext(bF)}function DZ(n){const{children:t,environment:s,disabled:a}=n,l=D.useRef(null),d=D.useMemo(()=>s||{getDocument:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument)??document},getWindow:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument.defaultView)??window}},[s]),f=!a||!s;return C.jsxs(bF.Provider,{value:d,children:[t,f&&C.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}DZ.displayName="EnvironmentProvider";const _Ie=n=>{const{children:t,colorModeManager:s,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:f={},environment:y,cssVarsRoot:v,disableEnvironment:b,disableGlobalStyle:w}=n,I=C.jsx(DZ,{environment:y,disabled:b,children:t});return C.jsx(dIe,{theme:f,cssVarsRoot:v,children:C.jsxs(OZ,{colorModeManager:s,options:f.config,children:[d?C.jsx(uIe,{scope:l}):C.jsx(lIe,{}),!w&&C.jsx(pIe,{}),a?C.jsx(SF,{zIndex:a,children:I}):I]})})},TF=D.createContext({});function wF(n){const t=D.useRef(null);return t.current===null&&(t.current=n()),t.current}const HC=D.createContext(null),CF=D.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class yIe extends D.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function EIe({children:n,isPresent:t}){const s=D.useId(),a=D.useRef(null),l=D.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=D.useContext(CF);return D.useInsertionEffect(()=>{const{width:f,height:y,top:v,left:b}=l.current;if(t||!a.current||!f||!y)return;a.current.dataset.motionPopId=s;const w=document.createElement("style");return d&&(w.nonce=d),document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${y}px !important;
            top: ${v}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[t]),C.jsx(yIe,{isPresent:t,childRef:a,sizeRef:l,children:D.cloneElement(n,{ref:a})})}const vIe=({children:n,initial:t,isPresent:s,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:f})=>{const y=wF(SIe),v=D.useId(),b=D.useCallback(I=>{y.set(I,!0);for(const k of y.values())if(!k)return;a&&a()},[y,a]),w=D.useMemo(()=>({id:v,initial:t,isPresent:s,custom:l,onExitComplete:b,register:I=>(y.set(I,!1),()=>y.delete(I))}),d?[Math.random(),b]:[s,b]);return D.useMemo(()=>{y.forEach((I,k)=>y.set(k,!1))},[s]),D.useEffect(()=>{!s&&!y.size&&a&&a()},[s]),f==="popLayout"&&(n=C.jsx(EIe,{isPresent:s,children:n})),C.jsx(HC.Provider,{value:w,children:n})};function SIe(){return new Map}function RF(n=!0){const t=D.useContext(HC);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:l}=t,d=D.useId();D.useEffect(()=>{n&&l(d)},[n]);const f=D.useCallback(()=>n&&a&&a(d),[d,a,n]);return!s&&a?[!1,f]:[!0]}function bIe(){return TIe(D.useContext(HC))}function TIe(n){return n===null?!0:n.isPresent}const uO=n=>n.key||"";function BK(n){const t=[];return D.Children.forEach(n,s=>{D.isValidElement(s)&&t.push(s)}),t}const IF=typeof window<"u",xZ=IF?D.useLayoutEffect:D.useEffect,x0=({children:n,custom:t,initial:s=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:f=!1})=>{const[y,v]=RF(f),b=D.useMemo(()=>BK(n),[n]),w=f&&!y?[]:b.map(uO),I=D.useRef(!0),k=D.useRef(b),L=wF(()=>new Map),[V,B]=D.useState(b),[W,Q]=D.useState(b);xZ(()=>{I.current=!1,k.current=b;for(let ce=0;ce<W.length;ce++){const ne=uO(W[ce]);w.includes(ne)?L.delete(ne):L.get(ne)!==!0&&L.set(ne,!1)}},[W,w.length,w.join("-")]);const $=[];if(b!==V){let ce=[...b];for(let ne=0;ne<W.length;ne++){const de=W[ne],Y=uO(de);w.includes(Y)||(ce.splice(ne,0,de),$.push(de))}d==="wait"&&$.length&&(ce=$),Q(BK(ce)),B(b);return}const{forceRender:ie}=D.useContext(TF);return C.jsx(C.Fragment,{children:W.map(ce=>{const ne=uO(ce),de=f&&!y?!1:b===W||w.includes(ne),Y=()=>{if(L.has(ne))L.set(ne,!0);else return;let X=!0;L.forEach(Z=>{Z||(X=!1)}),X&&(ie==null||ie(),Q(k.current),f&&(v==null||v()),a&&a())};return C.jsx(vIe,{isPresent:de,initial:!I.current||s?void 0:!1,custom:de?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:de?void 0:Y,children:ce},ne)})})},Wl=n=>n;let LZ=Wl;function AF(n){let t;return()=>(t===void 0&&(t=n()),t)}const d0=(n,t,s)=>{const a=t-n;return a===0?1:(s-n)/a},If=n=>n*1e3,Af=n=>n/1e3,wIe={useManualTiming:!1};function CIe(n){let t=new Set,s=new Set,a=!1,l=!1;const d=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function y(b){d.has(b)&&(v.schedule(b),n()),b(f)}const v={schedule:(b,w=!1,I=!1)=>{const L=I&&a?t:s;return w&&d.add(b),L.has(b)||L.add(b),b},cancel:b=>{s.delete(b),d.delete(b)},process:b=>{if(f=b,a){l=!0;return}a=!0,[t,s]=[s,t],t.forEach(y),t.clear(),a=!1,l&&(l=!1,v.process(b))}};return v}const dO=["read","resolveKeyframes","update","preRender","render","postRender"],RIe=40;function MZ(n,t){let s=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>s=!0,f=dO.reduce((Q,$)=>(Q[$]=CIe(d),Q),{}),{read:y,resolveKeyframes:v,update:b,preRender:w,render:I,postRender:k}=f,L=()=>{const Q=performance.now();s=!1,l.delta=a?1e3/60:Math.max(Math.min(Q-l.timestamp,RIe),1),l.timestamp=Q,l.isProcessing=!0,y.process(l),v.process(l),b.process(l),w.process(l),I.process(l),k.process(l),l.isProcessing=!1,s&&t&&(a=!1,n(L))},V=()=>{s=!0,a=!0,l.isProcessing||n(L)};return{schedule:dO.reduce((Q,$)=>{const ie=f[$];return Q[$]=(ce,ne=!1,de=!1)=>(s||V(),ie.schedule(ce,ne,de)),Q},{}),cancel:Q=>{for(let $=0;$<dO.length;$++)f[dO[$]].cancel(Q)},state:l,steps:f}}const{schedule:ns,cancel:bg,state:_a,steps:gM}=MZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Wl,!0),UZ=D.createContext({strict:!1}),WK={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},h0={};for(const n in WK)h0[n]={isEnabled:t=>WK[n].some(s=>!!t[s])};function IIe(n){for(const t in n)h0[t]={...h0[t],...n[t]}}const AIe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Tk(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||AIe.has(n)}let VZ=n=>!Tk(n);function PIe(n){n&&(VZ=t=>t.startsWith("on")?!Tk(t):n(t))}try{PIe(require("@emotion/is-prop-valid").default)}catch{}function OIe(n,t,s){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(VZ(l)||s===!0&&Tk(l)||!t&&!Tk(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function kIe(n){if(typeof Proxy>"u")return n;const t=new Map,s=(...a)=>n(...a);return new Proxy(s,{get:(a,l)=>l==="create"?n:(t.has(l)||t.set(l,n(l)),t.get(l))})}const y1=D.createContext({});function vC(n){return typeof n=="string"||Array.isArray(n)}function E1(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const PF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],OF=["initial",...PF];function v1(n){return E1(n.animate)||OF.some(t=>vC(n[t]))}function FZ(n){return!!(v1(n)||n.variants)}function NIe(n,t){if(v1(n)){const{initial:s,animate:a}=n;return{initial:s===!1||vC(s)?s:void 0,animate:vC(a)?a:void 0}}return n.inherit!==!1?t:{}}function DIe(n){const{initial:t,animate:s}=NIe(n,D.useContext(y1));return D.useMemo(()=>({initial:t,animate:s}),[zK(t),zK(s)])}function zK(n){return Array.isArray(n)?n.join(" "):n}const xIe=Symbol.for("motionComponentSymbol");function xS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function LIe(n,t,s){return D.useCallback(a=>{a&&n.onMount&&n.onMount(a),t&&(a?t.mount(a):t.unmount()),s&&(typeof s=="function"?s(a):xS(s)&&(s.current=a))},[t])}const kF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),MIe="framerAppearId",jZ="data-"+kF(MIe),{schedule:NF}=MZ(queueMicrotask,!1),BZ=D.createContext({});function UIe(n,t,s,a,l){var d,f;const{visualElement:y}=D.useContext(y1),v=D.useContext(UZ),b=D.useContext(HC),w=D.useContext(CF).reducedMotion,I=D.useRef(null);a=a||v.renderer,!I.current&&a&&(I.current=a(n,{visualState:t,parent:y,props:s,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:w}));const k=I.current,L=D.useContext(BZ);k&&!k.projection&&l&&(k.type==="html"||k.type==="svg")&&VIe(I.current,s,l,L);const V=D.useRef(!1);D.useInsertionEffect(()=>{k&&V.current&&k.update(s,b)});const B=s[jZ],W=D.useRef(!!B&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,B))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,B)));return xZ(()=>{k&&(V.current=!0,window.MotionIsMounted=!0,k.updateFeatures(),NF.render(k.render),W.current&&k.animationState&&k.animationState.animateChanges())}),D.useEffect(()=>{k&&(!W.current&&k.animationState&&k.animationState.animateChanges(),W.current&&(queueMicrotask(()=>{var Q;(Q=window.MotionHandoffMarkAsComplete)===null||Q===void 0||Q.call(window,B)}),W.current=!1))}),k}function VIe(n,t,s,a){const{layoutId:l,layout:d,drag:f,dragConstraints:y,layoutScroll:v,layoutRoot:b}=t;n.projection=new s(n.latestValues,t["data-framer-portal-id"]?void 0:WZ(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!f||y&&xS(y),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:b})}function WZ(n){if(n)return n.options.allowProjection!==!1?n.projection:WZ(n.parent)}function FIe({preloadedFeatures:n,createVisualElement:t,useRender:s,useVisualState:a,Component:l}){var d,f;n&&IIe(n);function y(b,w){let I;const k={...D.useContext(CF),...b,layoutId:jIe(b)},{isStatic:L}=k,V=DIe(b),B=a(b,L);if(!L&&IF){BIe();const W=WIe(k);I=W.MeasureLayout,V.visualElement=UIe(l,B,k,t,W.ProjectionNode)}return C.jsxs(y1.Provider,{value:V,children:[I&&V.visualElement?C.jsx(I,{visualElement:V.visualElement,...k}):null,s(l,b,LIe(B,V.visualElement,w),B,L,V.visualElement)]})}y.displayName=`motion.${typeof l=="string"?l:`create(${(f=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&f!==void 0?f:""})`}`;const v=D.forwardRef(y);return v[xIe]=l,v}function jIe({layoutId:n}){const t=D.useContext(TF).id;return t&&n!==void 0?t+"-"+n:n}function BIe(n,t){D.useContext(UZ).strict}function WIe(n){const{drag:t,layout:s}=h0;if(!t&&!s)return{};const a={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(n)||s!=null&&s.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const zIe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function DF(n){return typeof n!="string"||n.includes("-")?!1:!!(zIe.indexOf(n)>-1||/[A-Z]/u.test(n))}function GK(n){const t=[{},{}];return n==null||n.values.forEach((s,a)=>{t[0][a]=s.get(),t[1][a]=s.getVelocity()}),t}function xF(n,t,s,a){if(typeof t=="function"){const[l,d]=GK(a);t=t(s!==void 0?s:n.custom,l,d)}if(typeof t=="string"&&(t=n.variants&&n.variants[t]),typeof t=="function"){const[l,d]=GK(a);t=t(s!==void 0?s:n.custom,l,d)}return t}const PU=n=>Array.isArray(n),GIe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),HIe=n=>PU(n)?n[n.length-1]||0:n,Ja=n=>!!(n&&n.getVelocity);function HO(n){const t=Ja(n)?n.get():n;return GIe(t)?t.toValue():t}function $Ie({scrapeMotionValuesFromProps:n,createRenderState:t,onUpdate:s},a,l,d){const f={latestValues:KIe(a,l,d,n),renderState:t()};return s&&(f.onMount=y=>s({props:a,current:y,...f}),f.onUpdate=y=>s(y)),f}const zZ=n=>(t,s)=>{const a=D.useContext(y1),l=D.useContext(HC),d=()=>$Ie(n,t,a,l);return s?d():wF(d)};function KIe(n,t,s,a){const l={},d=a(n,{});for(const k in d)l[k]=HO(d[k]);let{initial:f,animate:y}=n;const v=v1(n),b=FZ(n);t&&b&&!v&&n.inherit!==!1&&(f===void 0&&(f=t.initial),y===void 0&&(y=t.animate));let w=s?s.initial===!1:!1;w=w||f===!1;const I=w?y:f;if(I&&typeof I!="boolean"&&!E1(I)){const k=Array.isArray(I)?I:[I];for(let L=0;L<k.length;L++){const V=xF(n,k[L]);if(V){const{transitionEnd:B,transition:W,...Q}=V;for(const $ in Q){let ie=Q[$];if(Array.isArray(ie)){const ce=w?ie.length-1:0;ie=ie[ce]}ie!==null&&(l[$]=ie)}for(const $ in B)l[$]=B[$]}}}return l}const L0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Hy=new Set(L0),GZ=n=>t=>typeof t=="string"&&t.startsWith(n),HZ=GZ("--"),qIe=GZ("var(--"),LF=n=>qIe(n)?YIe.test(n.split("/*")[0].trim()):!1,YIe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,$Z=(n,t)=>t&&typeof n=="number"?t.transform(n):n,Mf=(n,t,s)=>s>t?t:s<n?n:s,M0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},SC={...M0,transform:n=>Mf(0,1,n)},hO={...M0,default:1},$C=n=>({test:t=>typeof t=="string"&&t.endsWith(n)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${n}`}),og=$C("deg"),Xh=$C("%"),Bn=$C("px"),XIe=$C("vh"),JIe=$C("vw"),HK={...Xh,parse:n=>Xh.parse(n)/100,transform:n=>Xh.transform(n*100)},QIe={borderWidth:Bn,borderTopWidth:Bn,borderRightWidth:Bn,borderBottomWidth:Bn,borderLeftWidth:Bn,borderRadius:Bn,radius:Bn,borderTopLeftRadius:Bn,borderTopRightRadius:Bn,borderBottomRightRadius:Bn,borderBottomLeftRadius:Bn,width:Bn,maxWidth:Bn,height:Bn,maxHeight:Bn,top:Bn,right:Bn,bottom:Bn,left:Bn,padding:Bn,paddingTop:Bn,paddingRight:Bn,paddingBottom:Bn,paddingLeft:Bn,margin:Bn,marginTop:Bn,marginRight:Bn,marginBottom:Bn,marginLeft:Bn,backgroundPositionX:Bn,backgroundPositionY:Bn},ZIe={rotate:og,rotateX:og,rotateY:og,rotateZ:og,scale:hO,scaleX:hO,scaleY:hO,scaleZ:hO,skew:og,skewX:og,skewY:og,distance:Bn,translateX:Bn,translateY:Bn,translateZ:Bn,x:Bn,y:Bn,z:Bn,perspective:Bn,transformPerspective:Bn,opacity:SC,originX:HK,originY:HK,originZ:Bn},$K={...M0,transform:Math.round},MF={...QIe,...ZIe,zIndex:$K,size:Bn,fillOpacity:SC,strokeOpacity:SC,numOctaves:$K},eAe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},tAe=L0.length;function nAe(n,t,s){let a="",l=!0;for(let d=0;d<tAe;d++){const f=L0[d],y=n[f];if(y===void 0)continue;let v=!0;if(typeof y=="number"?v=y===(f.startsWith("scale")?1:0):v=parseFloat(y)===0,!v||s){const b=$Z(y,MF[f]);if(!v){l=!1;const w=eAe[f]||f;a+=`${w}(${b}) `}s&&(t[f]=b)}}return a=a.trim(),s?a=s(t,l?"":a):l&&(a="none"),a}function UF(n,t,s){const{style:a,vars:l,transformOrigin:d}=n;let f=!1,y=!1;for(const v in t){const b=t[v];if(Hy.has(v)){f=!0;continue}else if(HZ(v)){l[v]=b;continue}else{const w=$Z(b,MF[v]);v.startsWith("origin")?(y=!0,d[v]=w):a[v]=w}}if(t.transform||(f||s?a.transform=nAe(t,n.transform,s):a.transform&&(a.transform="none")),y){const{originX:v="50%",originY:b="50%",originZ:w=0}=d;a.transformOrigin=`${v} ${b} ${w}`}}const rAe={offset:"stroke-dashoffset",array:"stroke-dasharray"},iAe={offset:"strokeDashoffset",array:"strokeDasharray"};function sAe(n,t,s=1,a=0,l=!0){n.pathLength=1;const d=l?rAe:iAe;n[d.offset]=Bn.transform(-a);const f=Bn.transform(t),y=Bn.transform(s);n[d.array]=`${f} ${y}`}function KK(n,t,s){return typeof n=="string"?n:Bn.transform(t+s*n)}function oAe(n,t,s){const a=KK(t,n.x,n.width),l=KK(s,n.y,n.height);return`${a} ${l}`}function VF(n,{attrX:t,attrY:s,attrScale:a,originX:l,originY:d,pathLength:f,pathSpacing:y=1,pathOffset:v=0,...b},w,I){if(UF(n,b,I),w){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:k,style:L,dimensions:V}=n;k.transform&&(V&&(L.transform=k.transform),delete k.transform),V&&(l!==void 0||d!==void 0||L.transform)&&(L.transformOrigin=oAe(V,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(k.x=t),s!==void 0&&(k.y=s),a!==void 0&&(k.scale=a),f!==void 0&&sAe(k,f,y,v,!1)}const FF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),KZ=()=>({...FF(),attrs:{}}),jF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function qZ(n,{style:t,vars:s},a,l){Object.assign(n.style,t,l&&l.getProjectionStyles(a));for(const d in s)n.style.setProperty(d,s[d])}const YZ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function XZ(n,t,s,a){qZ(n,t,void 0,a);for(const l in t.attrs)n.setAttribute(YZ.has(l)?l:kF(l),t.attrs[l])}const wk={};function aAe(n){Object.assign(wk,n)}function JZ(n,{layout:t,layoutId:s}){return Hy.has(n)||n.startsWith("origin")||(t||s!==void 0)&&(!!wk[n]||n==="opacity")}function BF(n,t,s){var a;const{style:l}=n,d={};for(const f in l)(Ja(l[f])||t.style&&Ja(t.style[f])||JZ(f,n)||((a=s==null?void 0:s.getValue(f))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[f]=l[f]);return d}function QZ(n,t,s){const a=BF(n,t,s);for(const l in n)if(Ja(n[l])||Ja(t[l])){const d=L0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=n[l]}return a}function cAe(n,t){try{t.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const qK=["x","y","width","height","cx","cy","r"],lAe={useVisualState:zZ({scrapeMotionValuesFromProps:QZ,createRenderState:KZ,onUpdate:({props:n,prevProps:t,current:s,renderState:a,latestValues:l})=>{if(!s)return;let d=!!n.drag;if(!d){for(const y in l)if(Hy.has(y)){d=!0;break}}if(!d)return;let f=!t;if(t)for(let y=0;y<qK.length;y++){const v=qK[y];n[v]!==t[v]&&(f=!0)}f&&ns.read(()=>{cAe(s,a),ns.render(()=>{VF(a,l,jF(s.tagName),n.transformTemplate),XZ(s,a)})})}})},uAe={useVisualState:zZ({scrapeMotionValuesFromProps:BF,createRenderState:FF})};function ZZ(n,t,s){for(const a in t)!Ja(t[a])&&!JZ(a,s)&&(n[a]=t[a])}function dAe({transformTemplate:n},t){return D.useMemo(()=>{const s=FF();return UF(s,t,n),Object.assign({},s.vars,s.style)},[t])}function hAe(n,t){const s=n.style||{},a={};return ZZ(a,s,n),Object.assign(a,dAe(n,t)),a}function pAe(n,t){const s={},a=hAe(n,t);return n.drag&&n.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(s.tabIndex=0),s.style=a,s}function fAe(n,t,s,a){const l=D.useMemo(()=>{const d=KZ();return VF(d,t,jF(a),n.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(n.style){const d={};ZZ(d,n.style,n),l.style={...d,...l.style}}return l}function mAe(n=!1){return(s,a,l,{latestValues:d},f)=>{const v=(DF(s)?fAe:pAe)(a,d,f,s),b=OIe(a,typeof s=="string",n),w=s!==D.Fragment?{...b,...v,ref:l}:{},{children:I}=a,k=D.useMemo(()=>Ja(I)?I.get():I,[I]);return D.createElement(s,{...w,children:k})}}function gAe(n,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...DF(a)?lAe:uAe,preloadedFeatures:n,useRender:mAe(l),createVisualElement:t,Component:a};return FIe(f)}}function eee(n,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==n.length)return!1;for(let a=0;a<s;a++)if(t[a]!==n[a])return!1;return!0}function S1(n,t,s){const a=n.getProps();return xF(a,t,s!==void 0?s:a.custom,n)}const _Ae=AF(()=>window.ScrollTimeline!==void 0);class yAe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t,s){const a=this.animations.map(l=>{if(_Ae()&&l.attachTimeline)return l.attachTimeline(t);if(typeof s=="function")return s(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class EAe extends yAe{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function WF(n,t){return n?n[t]||n.default||n:void 0}const OU=2e4;function tee(n){let t=0;const s=50;let a=n.next(t);for(;!a.done&&t<OU;)t+=s,a=n.next(t);return t>=OU?1/0:t}function zF(n){return typeof n=="function"}function YK(n,t){n.timeline=t,n.onfinish=null}const GF=n=>Array.isArray(n)&&typeof n[0]=="number",vAe={linearEasing:void 0};function SAe(n,t){const s=AF(n);return()=>{var a;return(a=vAe[t])!==null&&a!==void 0?a:s()}}const Ck=SAe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),nee=(n,t,s=10)=>{let a="";const l=Math.max(Math.round(t/s),2);for(let d=0;d<l;d++)a+=n(d0(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function ree(n){return!!(typeof n=="function"&&Ck()||!n||typeof n=="string"&&(n in kU||Ck())||GF(n)||Array.isArray(n)&&n.every(ree))}const xw=([n,t,s,a])=>`cubic-bezier(${n}, ${t}, ${s}, ${a})`,kU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:xw([0,.65,.55,1]),circOut:xw([.55,0,1,.45]),backIn:xw([.31,.01,.66,-.59]),backOut:xw([.33,1.53,.69,.99])};function iee(n,t){if(n)return typeof n=="function"&&Ck()?nee(n,t):GF(n)?xw(n):Array.isArray(n)?n.map(s=>iee(s,t)||kU.easeOut):kU[n]}const Od={x:!1,y:!1};function see(){return Od.x||Od.y}function bAe(n,t,s){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function oee(n,t){const s=bAe(n),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[s,l,()=>a.abort()]}function XK(n){return t=>{t.pointerType==="touch"||see()||n(t)}}function TAe(n,t,s={}){const[a,l,d]=oee(n,s),f=XK(y=>{const{target:v}=y,b=t(y);if(typeof b!="function"||!v)return;const w=XK(I=>{b(I),v.removeEventListener("pointerleave",w)});v.addEventListener("pointerleave",w,l)});return a.forEach(y=>{y.addEventListener("pointerenter",f,l)}),d}const aee=(n,t)=>t?n===t?!0:aee(n,t.parentElement):!1,HF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,wAe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function CAe(n){return wAe.has(n.tagName)||n.tabIndex!==-1}const Lw=new WeakSet;function JK(n){return t=>{t.key==="Enter"&&n(t)}}function _M(n,t){n.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const RAe=(n,t)=>{const s=n.currentTarget;if(!s)return;const a=JK(()=>{if(Lw.has(s))return;_M(s,"down");const l=JK(()=>{_M(s,"up")}),d=()=>_M(s,"cancel");s.addEventListener("keyup",l,t),s.addEventListener("blur",d,t)});s.addEventListener("keydown",a,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),t)};function QK(n){return HF(n)&&!see()}function IAe(n,t,s={}){const[a,l,d]=oee(n,s),f=y=>{const v=y.currentTarget;if(!QK(y)||Lw.has(v))return;Lw.add(v);const b=t(y),w=(L,V)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",k),!(!QK(L)||!Lw.has(v))&&(Lw.delete(v),typeof b=="function"&&b(L,{success:V}))},I=L=>{w(L,s.useGlobalTarget||aee(v,L.target))},k=L=>{w(L,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",k,l)};return a.forEach(y=>{!CAe(y)&&y.getAttribute("tabindex")===null&&(y.tabIndex=0),(s.useGlobalTarget?window:y).addEventListener("pointerdown",f,l),y.addEventListener("focus",b=>RAe(b,l),l)}),d}function AAe(n){return n==="x"||n==="y"?Od[n]?null:(Od[n]=!0,()=>{Od[n]=!1}):Od.x||Od.y?null:(Od.x=Od.y=!0,()=>{Od.x=Od.y=!1})}const cee=new Set(["width","height","top","left","right","bottom",...L0]);let $O;function PAe(){$O=void 0}const Jh={now:()=>($O===void 0&&Jh.set(_a.isProcessing||wIe.useManualTiming?_a.timestamp:performance.now()),$O),set:n=>{$O=n,queueMicrotask(PAe)}};function $F(n,t){n.indexOf(t)===-1&&n.push(t)}function KF(n,t){const s=n.indexOf(t);s>-1&&n.splice(s,1)}class qF{constructor(){this.subscriptions=[]}add(t){return $F(this.subscriptions,t),()=>KF(this.subscriptions,t)}notify(t,s,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,s,a);else for(let d=0;d<l;d++){const f=this.subscriptions[d];f&&f(t,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function lee(n,t){return t?n*(1e3/t):0}const ZK=30,OAe=n=>!isNaN(parseFloat(n));class kAe{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Jh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=Jh.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=OAe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new qF);const a=this.events[t].add(s);return t==="change"?()=>{a(),ns.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Jh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>ZK)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,ZK);return lee(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function bC(n,t){return new kAe(n,t)}function NAe(n,t,s){n.hasValue(t)?n.getValue(t).set(s):n.addValue(t,bC(s))}function DAe(n,t){const s=S1(n,t);let{transitionEnd:a={},transition:l={},...d}=s||{};d={...d,...a};for(const f in d){const y=HIe(d[f]);NAe(n,f,y)}}function xAe(n){return!!(Ja(n)&&n.add)}function NU(n,t){const s=n.getValue("willChange");if(xAe(s))return s.add(t)}function uee(n){return n.props[jZ]}const dee=(n,t,s)=>(((1-3*s+3*t)*n+(3*s-6*t))*n+3*t)*n,LAe=1e-7,MAe=12;function UAe(n,t,s,a,l){let d,f,y=0;do f=t+(s-t)/2,d=dee(f,a,l)-n,d>0?s=f:t=f;while(Math.abs(d)>LAe&&++y<MAe);return f}function KC(n,t,s,a){if(n===t&&s===a)return Wl;const l=d=>UAe(d,0,1,n,s);return d=>d===0||d===1?d:dee(l(d),t,a)}const hee=n=>t=>t<=.5?n(2*t)/2:(2-n(2*(1-t)))/2,pee=n=>t=>1-n(1-t),fee=KC(.33,1.53,.69,.99),YF=pee(fee),mee=hee(YF),gee=n=>(n*=2)<1?.5*YF(n):.5*(2-Math.pow(2,-10*(n-1))),XF=n=>1-Math.sin(Math.acos(n)),_ee=pee(XF),yee=hee(XF),Eee=n=>/^0[^.\s]+$/u.test(n);function VAe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||Eee(n):!0}const Zw=n=>Math.round(n*1e5)/1e5,JF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function FAe(n){return n==null}const jAe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,QF=(n,t)=>s=>!!(typeof s=="string"&&jAe.test(s)&&s.startsWith(n)||t&&!FAe(s)&&Object.prototype.hasOwnProperty.call(s,t)),vee=(n,t,s)=>a=>{if(typeof a!="string")return a;const[l,d,f,y]=a.match(JF);return{[n]:parseFloat(l),[t]:parseFloat(d),[s]:parseFloat(f),alpha:y!==void 0?parseFloat(y):1}},BAe=n=>Mf(0,255,n),yM={...M0,transform:n=>Math.round(BAe(n))},my={test:QF("rgb","red"),parse:vee("red","green","blue"),transform:({red:n,green:t,blue:s,alpha:a=1})=>"rgba("+yM.transform(n)+", "+yM.transform(t)+", "+yM.transform(s)+", "+Zw(SC.transform(a))+")"};function WAe(n){let t="",s="",a="",l="";return n.length>5?(t=n.substring(1,3),s=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(t=n.substring(1,2),s=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),t+=t,s+=s,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const DU={test:QF("#"),parse:WAe,transform:my.transform},LS={test:QF("hsl","hue"),parse:vee("hue","saturation","lightness"),transform:({hue:n,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(n)+", "+Xh.transform(Zw(t))+", "+Xh.transform(Zw(s))+", "+Zw(SC.transform(a))+")"},qa={test:n=>my.test(n)||DU.test(n)||LS.test(n),parse:n=>my.test(n)?my.parse(n):LS.test(n)?LS.parse(n):DU.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?my.transform(n):LS.transform(n)},zAe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function GAe(n){var t,s;return isNaN(n)&&typeof n=="string"&&(((t=n.match(JF))===null||t===void 0?void 0:t.length)||0)+(((s=n.match(zAe))===null||s===void 0?void 0:s.length)||0)>0}const See="number",bee="color",HAe="var",$Ae="var(",eq="${}",KAe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function TC(n){const t=n.toString(),s=[],a={color:[],number:[],var:[]},l=[];let d=0;const y=t.replace(KAe,v=>(qa.test(v)?(a.color.push(d),l.push(bee),s.push(qa.parse(v))):v.startsWith($Ae)?(a.var.push(d),l.push(HAe),s.push(v)):(a.number.push(d),l.push(See),s.push(parseFloat(v))),++d,eq)).split(eq);return{values:s,split:y,indexes:a,types:l}}function Tee(n){return TC(n).values}function wee(n){const{split:t,types:s}=TC(n),a=t.length;return l=>{let d="";for(let f=0;f<a;f++)if(d+=t[f],l[f]!==void 0){const y=s[f];y===See?d+=Zw(l[f]):y===bee?d+=qa.transform(l[f]):d+=l[f]}return d}}const qAe=n=>typeof n=="number"?0:n;function YAe(n){const t=Tee(n);return wee(n)(t.map(qAe))}const Tg={test:GAe,parse:Tee,createTransformer:wee,getAnimatableNone:YAe},XAe=new Set(["brightness","contrast","saturate","opacity"]);function JAe(n){const[t,s]=n.slice(0,-1).split("(");if(t==="drop-shadow")return n;const[a]=s.match(JF)||[];if(!a)return n;const l=s.replace(a,"");let d=XAe.has(t)?1:0;return a!==s&&(d*=100),t+"("+d+l+")"}const QAe=/\b([a-z-]*)\(.*?\)/gu,xU={...Tg,getAnimatableNone:n=>{const t=n.match(QAe);return t?t.map(JAe).join(" "):n}},ZAe={...MF,color:qa,backgroundColor:qa,outlineColor:qa,fill:qa,stroke:qa,borderColor:qa,borderTopColor:qa,borderRightColor:qa,borderBottomColor:qa,borderLeftColor:qa,filter:xU,WebkitFilter:xU},ZF=n=>ZAe[n];function Cee(n,t){let s=ZF(n);return s!==xU&&(s=Tg),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const ePe=new Set(["auto","none","0"]);function tPe(n,t,s){let a=0,l;for(;a<n.length&&!l;){const d=n[a];typeof d=="string"&&!ePe.has(d)&&TC(d).values.length&&(l=n[a]),a++}if(l&&s)for(const d of t)n[d]=Cee(s,l)}const tq=n=>n===M0||n===Bn,nq=(n,t)=>parseFloat(n.split(", ")[t]),rq=(n,t)=>(s,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return nq(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?nq(d[1],n):0}},nPe=new Set(["x","y","z"]),rPe=L0.filter(n=>!nPe.has(n));function iPe(n){const t=[];return rPe.forEach(s=>{const a=n.getValue(s);a!==void 0&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),t}const p0={width:({x:n},{paddingLeft:t="0",paddingRight:s="0"})=>n.max-n.min-parseFloat(t)-parseFloat(s),height:({y:n},{paddingTop:t="0",paddingBottom:s="0"})=>n.max-n.min-parseFloat(t)-parseFloat(s),top:(n,{top:t})=>parseFloat(t),left:(n,{left:t})=>parseFloat(t),bottom:({y:n},{top:t})=>parseFloat(t)+(n.max-n.min),right:({x:n},{left:t})=>parseFloat(t)+(n.max-n.min),x:rq(4,13),y:rq(5,14)};p0.translateX=p0.x;p0.translateY=p0.y;const Ty=new Set;let LU=!1,MU=!1;function Ree(){if(MU){const n=Array.from(Ty).filter(a=>a.needsMeasurement),t=new Set(n.map(a=>a.element)),s=new Map;t.forEach(a=>{const l=iPe(a);l.length&&(s.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=s.get(a);l&&l.forEach(([d,f])=>{var y;(y=a.getValue(d))===null||y===void 0||y.set(f)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}MU=!1,LU=!1,Ty.forEach(n=>n.complete()),Ty.clear()}function Iee(){Ty.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(MU=!0)})}function sPe(){Iee(),Ree()}class ej{constructor(t,s,a,l,d,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=a,this.motionValue=l,this.element=d,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Ty.add(this),LU||(LU=!0,ns.read(Iee),ns.resolveKeyframes(Ree))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const f=l==null?void 0:l.get(),y=t[t.length-1];if(f!==void 0)t[0]=f;else if(a&&s){const v=a.readValue(s,y);v!=null&&(t[0]=v)}t[0]===void 0&&(t[0]=y),l&&f===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Ty.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Ty.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Aee=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),oPe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function aPe(n){const t=oPe.exec(n);if(!t)return[,];const[,s,a,l]=t;return[`--${s??a}`,l]}function Pee(n,t,s=1){const[a,l]=aPe(n);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const f=d.trim();return Aee(f)?parseFloat(f):f}return LF(l)?Pee(l,t,s+1):l}const Oee=n=>t=>t.test(n),cPe={test:n=>n==="auto",parse:n=>n},kee=[M0,Bn,Xh,og,JIe,XIe,cPe],iq=n=>kee.find(Oee(n));class Nee extends ej{constructor(t,s,a,l,d){super(t,s,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let b=t[v];if(typeof b=="string"&&(b=b.trim(),LF(b))){const w=Pee(b,s.current);w!==void 0&&(t[v]=w),v===t.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!cee.has(a)||t.length!==2)return;const[l,d]=t,f=iq(l),y=iq(d);if(f!==y)if(tq(f)&&tq(y))for(let v=0;v<t.length;v++){const b=t[v];typeof b=="string"&&(t[v]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,a=[];for(let l=0;l<t.length;l++)VAe(t[l])&&a.push(l);a.length&&tPe(t,a,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=p0[a](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const l=s[s.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:s,name:a,unresolvedKeyframes:l}=this;if(!s||!s.current)return;const d=s.getValue(a);d&&d.jump(this.measuredOrigin,!1);const f=l.length-1,y=l[f];l[f]=p0[a](s.measureViewportBox(),window.getComputedStyle(s.current)),y!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=y),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([v,b])=>{s.getValue(v).set(b)}),this.resolveNoneKeyframes()}}const sq=(n,t)=>t==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Tg.test(n)||n==="0")&&!n.startsWith("url("));function lPe(n){const t=n[0];if(n.length===1)return!0;for(let s=0;s<n.length;s++)if(n[s]!==t)return!0}function uPe(n,t,s,a){const l=n[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=n[n.length-1],f=sq(l,t),y=sq(d,t);return!f||!y?!1:lPe(n)||(s==="spring"||zF(s))&&a}const dPe=n=>n!==null;function b1(n,{repeat:t,repeatType:s="loop"},a){const l=n.filter(dPe),d=t&&s!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const hPe=40;class Dee{constructor({autoplay:t=!0,delay:s=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:f="loop",...y}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Jh.now(),this.options={autoplay:t,delay:s,type:a,repeat:l,repeatDelay:d,repeatType:f,...y},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>hPe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&sPe(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=Jh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:f,onComplete:y,onUpdate:v,isGenerator:b}=this.options;if(!b&&!uPe(t,a,l,d))if(f)this.options.duration=0;else{v&&v(b1(t,this.options,s)),y&&y(),this.resolveFinishedPromise();return}const w=this.initPlayback(t,s);w!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...w},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const ms=(n,t,s)=>n+(t-n)*s;function EM(n,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?n+(t-n)*6*s:s<1/2?t:s<2/3?n+(t-n)*(2/3-s)*6:n}function pPe({hue:n,saturation:t,lightness:s,alpha:a}){n/=360,t/=100,s/=100;let l=0,d=0,f=0;if(!t)l=d=f=s;else{const y=s<.5?s*(1+t):s+t-s*t,v=2*s-y;l=EM(v,y,n+1/3),d=EM(v,y,n),f=EM(v,y,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(f*255),alpha:a}}function Rk(n,t){return s=>s>0?t:n}const vM=(n,t,s)=>{const a=n*n,l=s*(t*t-a)+a;return l<0?0:Math.sqrt(l)},fPe=[DU,my,LS],mPe=n=>fPe.find(t=>t.test(n));function oq(n){const t=mPe(n);if(!t)return!1;let s=t.parse(n);return t===LS&&(s=pPe(s)),s}const aq=(n,t)=>{const s=oq(n),a=oq(t);if(!s||!a)return Rk(n,t);const l={...s};return d=>(l.red=vM(s.red,a.red,d),l.green=vM(s.green,a.green,d),l.blue=vM(s.blue,a.blue,d),l.alpha=ms(s.alpha,a.alpha,d),my.transform(l))},gPe=(n,t)=>s=>t(n(s)),qC=(...n)=>n.reduce(gPe),UU=new Set(["none","hidden"]);function _Pe(n,t){return UU.has(n)?s=>s<=0?n:t:s=>s>=1?t:n}function yPe(n,t){return s=>ms(n,t,s)}function tj(n){return typeof n=="number"?yPe:typeof n=="string"?LF(n)?Rk:qa.test(n)?aq:SPe:Array.isArray(n)?xee:typeof n=="object"?qa.test(n)?aq:EPe:Rk}function xee(n,t){const s=[...n],a=s.length,l=n.map((d,f)=>tj(d)(d,t[f]));return d=>{for(let f=0;f<a;f++)s[f]=l[f](d);return s}}function EPe(n,t){const s={...n,...t},a={};for(const l in s)n[l]!==void 0&&t[l]!==void 0&&(a[l]=tj(n[l])(n[l],t[l]));return l=>{for(const d in a)s[d]=a[d](l);return s}}function vPe(n,t){var s;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const f=t.types[d],y=n.indexes[f][l[f]],v=(s=n.values[y])!==null&&s!==void 0?s:0;a[d]=v,l[f]++}return a}const SPe=(n,t)=>{const s=Tg.createTransformer(t),a=TC(n),l=TC(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?UU.has(n)&&!l.values.length||UU.has(t)&&!a.values.length?_Pe(n,t):qC(xee(vPe(a,l),l.values),s):Rk(n,t)};function Lee(n,t,s){return typeof n=="number"&&typeof t=="number"&&typeof s=="number"?ms(n,t,s):tj(n)(n,t)}const bPe=5;function Mee(n,t,s){const a=Math.max(t-bPe,0);return lee(s-n(a),t-a)}const Ds={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},cq=.001;function TPe({duration:n=Ds.duration,bounce:t=Ds.bounce,velocity:s=Ds.velocity,mass:a=Ds.mass}){let l,d,f=1-t;f=Mf(Ds.minDamping,Ds.maxDamping,f),n=Mf(Ds.minDuration,Ds.maxDuration,Af(n)),f<1?(l=b=>{const w=b*f,I=w*n,k=w-s,L=VU(b,f),V=Math.exp(-I);return cq-k/L*V},d=b=>{const I=b*f*n,k=I*s+s,L=Math.pow(f,2)*Math.pow(b,2)*n,V=Math.exp(-I),B=VU(Math.pow(b,2),f);return(-l(b)+cq>0?-1:1)*((k-L)*V)/B}):(l=b=>{const w=Math.exp(-b*n),I=(b-s)*n+1;return-.001+w*I},d=b=>{const w=Math.exp(-b*n),I=(s-b)*(n*n);return w*I});const y=5/n,v=CPe(l,d,y);if(n=If(n),isNaN(v))return{stiffness:Ds.stiffness,damping:Ds.damping,duration:n};{const b=Math.pow(v,2)*a;return{stiffness:b,damping:f*2*Math.sqrt(a*b),duration:n}}}const wPe=12;function CPe(n,t,s){let a=s;for(let l=1;l<wPe;l++)a=a-n(a)/t(a);return a}function VU(n,t){return n*Math.sqrt(1-t*t)}const RPe=["duration","bounce"],IPe=["stiffness","damping","mass"];function lq(n,t){return t.some(s=>n[s]!==void 0)}function APe(n){let t={velocity:Ds.velocity,stiffness:Ds.stiffness,damping:Ds.damping,mass:Ds.mass,isResolvedFromDuration:!1,...n};if(!lq(n,IPe)&&lq(n,RPe))if(n.visualDuration){const s=n.visualDuration,a=2*Math.PI/(s*1.2),l=a*a,d=2*Mf(.05,1,1-(n.bounce||0))*Math.sqrt(l);t={...t,mass:Ds.mass,stiffness:l,damping:d}}else{const s=TPe(n);t={...t,...s,mass:Ds.mass},t.isResolvedFromDuration=!0}return t}function Uee(n=Ds.visualDuration,t=Ds.bounce){const s=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:t}:n;let{restSpeed:a,restDelta:l}=s;const d=s.keyframes[0],f=s.keyframes[s.keyframes.length-1],y={done:!1,value:d},{stiffness:v,damping:b,mass:w,duration:I,velocity:k,isResolvedFromDuration:L}=APe({...s,velocity:-Af(s.velocity||0)}),V=k||0,B=b/(2*Math.sqrt(v*w)),W=f-d,Q=Af(Math.sqrt(v/w)),$=Math.abs(W)<5;a||(a=$?Ds.restSpeed.granular:Ds.restSpeed.default),l||(l=$?Ds.restDelta.granular:Ds.restDelta.default);let ie;if(B<1){const ne=VU(Q,B);ie=de=>{const Y=Math.exp(-B*Q*de);return f-Y*((V+B*Q*W)/ne*Math.sin(ne*de)+W*Math.cos(ne*de))}}else if(B===1)ie=ne=>f-Math.exp(-Q*ne)*(W+(V+Q*W)*ne);else{const ne=Q*Math.sqrt(B*B-1);ie=de=>{const Y=Math.exp(-B*Q*de),X=Math.min(ne*de,300);return f-Y*((V+B*Q*W)*Math.sinh(X)+ne*W*Math.cosh(X))/ne}}const ce={calculatedDuration:L&&I||null,next:ne=>{const de=ie(ne);if(L)y.done=ne>=I;else{let Y=0;B<1&&(Y=ne===0?If(V):Mee(ie,ne,de));const X=Math.abs(Y)<=a,Z=Math.abs(f-de)<=l;y.done=X&&Z}return y.value=y.done?f:de,y},toString:()=>{const ne=Math.min(tee(ce),OU),de=nee(Y=>ce.next(ne*Y).value,ne,30);return ne+"ms "+de}};return ce}function uq({keyframes:n,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:f,min:y,max:v,restDelta:b=.5,restSpeed:w}){const I=n[0],k={done:!1,value:I},L=X=>y!==void 0&&X<y||v!==void 0&&X>v,V=X=>y===void 0?v:v===void 0||Math.abs(y-X)<Math.abs(v-X)?y:v;let B=s*t;const W=I+B,Q=f===void 0?W:f(W);Q!==W&&(B=Q-I);const $=X=>-B*Math.exp(-X/a),ie=X=>Q+$(X),ce=X=>{const Z=$(X),se=ie(X);k.done=Math.abs(Z)<=b,k.value=k.done?Q:se};let ne,de;const Y=X=>{L(k.value)&&(ne=X,de=Uee({keyframes:[k.value,V(k.value)],velocity:Mee(ie,X,k.value),damping:l,stiffness:d,restDelta:b,restSpeed:w}))};return Y(0),{calculatedDuration:null,next:X=>{let Z=!1;return!de&&ne===void 0&&(Z=!0,ce(X),Y(X)),ne!==void 0&&X>=ne?de.next(X-ne):(!Z&&ce(X),k)}}}const PPe=KC(.42,0,1,1),OPe=KC(0,0,.58,1),Vee=KC(.42,0,.58,1),kPe=n=>Array.isArray(n)&&typeof n[0]!="number",NPe={linear:Wl,easeIn:PPe,easeInOut:Vee,easeOut:OPe,circIn:XF,circInOut:yee,circOut:_ee,backIn:YF,backInOut:mee,backOut:fee,anticipate:gee},dq=n=>{if(GF(n)){LZ(n.length===4);const[t,s,a,l]=n;return KC(t,s,a,l)}else if(typeof n=="string")return NPe[n];return n};function DPe(n,t,s){const a=[],l=s||Lee,d=n.length-1;for(let f=0;f<d;f++){let y=l(n[f],n[f+1]);if(t){const v=Array.isArray(t)?t[f]||Wl:t;y=qC(v,y)}a.push(y)}return a}function xPe(n,t,{clamp:s=!0,ease:a,mixer:l}={}){const d=n.length;if(LZ(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const f=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),t=[...t].reverse());const y=DPe(t,a,l),v=y.length,b=w=>{if(f&&w<n[0])return t[0];let I=0;if(v>1)for(;I<n.length-2&&!(w<n[I+1]);I++);const k=d0(n[I],n[I+1],w);return y[I](k)};return s?w=>b(Mf(n[0],n[d-1],w)):b}function LPe(n,t){const s=n[n.length-1];for(let a=1;a<=t;a++){const l=d0(0,t,a);n.push(ms(s,1,l))}}function MPe(n){const t=[0];return LPe(t,n.length-1),t}function UPe(n,t){return n.map(s=>s*t)}function VPe(n,t){return n.map(()=>t||Vee).splice(0,n.length-1)}function Ik({duration:n=300,keyframes:t,times:s,ease:a="easeInOut"}){const l=kPe(a)?a.map(dq):dq(a),d={done:!1,value:t[0]},f=UPe(s&&s.length===t.length?s:MPe(t),n),y=xPe(f,t,{ease:Array.isArray(l)?l:VPe(t,l)});return{calculatedDuration:n,next:v=>(d.value=y(v),d.done=v>=n,d)}}const FPe=n=>{const t=({timestamp:s})=>n(s);return{start:()=>ns.update(t,!0),stop:()=>bg(t),now:()=>_a.isProcessing?_a.timestamp:Jh.now()}},jPe={decay:uq,inertia:uq,tween:Ik,keyframes:Ik,spring:Uee},BPe=n=>n/100;class nj extends Dee{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:s,motionValue:a,element:l,keyframes:d}=this.options,f=(l==null?void 0:l.KeyframeResolver)||ej,y=(v,b)=>this.onKeyframesResolved(v,b);this.resolver=new f(d,y,s,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:f=0}=this.options,y=zF(s)?s:jPe[s]||Ik;let v,b;y!==Ik&&typeof t[0]!="number"&&(v=qC(BPe,Lee(t[0],t[1])),t=[0,100]);const w=y({...this.options,keyframes:t});d==="mirror"&&(b=y({...this.options,keyframes:[...t].reverse(),velocity:-f})),w.calculatedDuration===null&&(w.calculatedDuration=tee(w));const{calculatedDuration:I}=w,k=I+l,L=k*(a+1)-l;return{generator:w,mirroredGenerator:b,mapPercentToKeyframes:v,calculatedDuration:I,resolvedDuration:k,totalDuration:L}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:a}=this;if(!a){const{keyframes:X}=this.options;return{done:!0,value:X[X.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:f,mapPercentToKeyframes:y,keyframes:v,calculatedDuration:b,totalDuration:w,resolvedDuration:I}=a;if(this.startTime===null)return d.next(0);const{delay:k,repeat:L,repeatType:V,repeatDelay:B,onUpdate:W}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-w/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const Q=this.currentTime-k*(this.speed>=0?1:-1),$=this.speed>=0?Q<0:Q>w;this.currentTime=Math.max(Q,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=w);let ie=this.currentTime,ce=d;if(L){const X=Math.min(this.currentTime,w)/I;let Z=Math.floor(X),se=X%1;!se&&X>=1&&(se=1),se===1&&Z--,Z=Math.min(Z,L+1),!!(Z%2)&&(V==="reverse"?(se=1-se,B&&(se-=B/I)):V==="mirror"&&(ce=f)),ie=Mf(0,1,se)*I}const ne=$?{done:!1,value:v[0]}:ce.next(ie);y&&(ne.value=y(ne.value));let{done:de}=ne;!$&&b!==null&&(de=this.speed>=0?this.currentTime>=w:this.currentTime<=0);const Y=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&de);return Y&&l!==void 0&&(ne.value=b1(v,this.options,l)),W&&W(ne.value),Y&&this.finish(),ne}get duration(){const{resolved:t}=this;return t?Af(t.calculatedDuration):0}get time(){return Af(this.currentTime)}set time(t){t=If(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=Af(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=FPe,onPlay:s,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),s&&s();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const WPe=new Set(["opacity","clipPath","filter","transform"]);function zPe(n,t,s,{delay:a=0,duration:l=300,repeat:d=0,repeatType:f="loop",ease:y="easeInOut",times:v}={}){const b={[t]:s};v&&(b.offset=v);const w=iee(y,l);return Array.isArray(w)&&(b.easing=w),n.animate(b,{delay:a,duration:l,easing:Array.isArray(w)?"linear":w,fill:"both",iterations:d+1,direction:f==="reverse"?"alternate":"normal"})}const GPe=AF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Ak=10,HPe=2e4;function $Pe(n){return zF(n.type)||n.type==="spring"||!ree(n.ease)}function KPe(n,t){const s=new nj({...t,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let d=0;for(;!a.done&&d<HPe;)a=s.sample(d),l.push(a.value),d+=Ak;return{times:void 0,keyframes:l,duration:d-Ak,ease:"linear"}}const Fee={anticipate:gee,backInOut:mee,circInOut:yee};function qPe(n){return n in Fee}class hq extends Dee{constructor(t){super(t);const{name:s,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new Nee(d,(f,y)=>this.onKeyframesResolved(f,y),s,a,l),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:a=300,times:l,ease:d,type:f,motionValue:y,name:v,startTime:b}=this.options;if(!y.owner||!y.owner.current)return!1;if(typeof d=="string"&&Ck()&&qPe(d)&&(d=Fee[d]),$Pe(this.options)){const{onComplete:I,onUpdate:k,motionValue:L,element:V,...B}=this.options,W=KPe(t,B);t=W.keyframes,t.length===1&&(t[1]=t[0]),a=W.duration,l=W.times,d=W.ease,f="keyframes"}const w=zPe(y.owner.current,v,t,{...this.options,duration:a,times:l,ease:d});return w.startTime=b??this.calcStartTime(),this.pendingTimeline?(YK(w,this.pendingTimeline),this.pendingTimeline=void 0):w.onfinish=()=>{const{onComplete:I}=this.options;y.set(b1(t,this.options,s)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:w,duration:a,times:l,type:f,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return Af(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return Af(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.currentTime=If(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return Wl;const{animation:a}=s;YK(a,t)}return Wl}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:a,duration:l,type:d,ease:f,times:y}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:w,onComplete:I,element:k,...L}=this.options,V=new nj({...L,keyframes:a,duration:l,type:d,ease:f,times:y,isGenerator:!0}),B=If(this.time);b.setWithVelocity(V.sample(B-Ak).value,V.sample(B).value,Ak)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:a,repeatDelay:l,repeatType:d,damping:f,type:y}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:b}=s.owner.getProps();return GPe()&&a&&WPe.has(a)&&!v&&!b&&!l&&d!=="mirror"&&f!==0&&y!=="inertia"}}const YPe={type:"spring",stiffness:500,damping:25,restSpeed:10},XPe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),JPe={type:"keyframes",duration:.8},QPe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},ZPe=(n,{keyframes:t})=>t.length>2?JPe:Hy.has(n)?n.startsWith("scale")?XPe(t[1]):YPe:QPe;function eOe({when:n,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:f,repeatDelay:y,from:v,elapsed:b,...w}){return!!Object.keys(w).length}const rj=(n,t,s,a={},l,d)=>f=>{const y=WF(a,n)||{},v=y.delay||a.delay||0;let{elapsed:b=0}=a;b=b-If(v);let w={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...y,delay:-b,onUpdate:k=>{t.set(k),y.onUpdate&&y.onUpdate(k)},onComplete:()=>{f(),y.onComplete&&y.onComplete()},name:n,motionValue:t,element:d?void 0:l};eOe(y)||(w={...w,...ZPe(n,w)}),w.duration&&(w.duration=If(w.duration)),w.repeatDelay&&(w.repeatDelay=If(w.repeatDelay)),w.from!==void 0&&(w.keyframes[0]=w.from);let I=!1;if((w.type===!1||w.duration===0&&!w.repeatDelay)&&(w.duration=0,w.delay===0&&(I=!0)),I&&!d&&t.get()!==void 0){const k=b1(w.keyframes,y);if(k!==void 0)return ns.update(()=>{w.onUpdate(k),w.onComplete()}),new EAe([])}return!d&&hq.supports(w)?new hq(w):new nj(w)};function tOe({protectedKeys:n,needsAnimating:t},s){const a=n.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,a}function jee(n,t,{delay:s=0,transitionOverride:a,type:l}={}){var d;let{transition:f=n.getDefaultTransition(),transitionEnd:y,...v}=t;a&&(f=a);const b=[],w=l&&n.animationState&&n.animationState.getState()[l];for(const I in v){const k=n.getValue(I,(d=n.latestValues[I])!==null&&d!==void 0?d:null),L=v[I];if(L===void 0||w&&tOe(w,I))continue;const V={delay:s,...WF(f||{},I)};let B=!1;if(window.MotionHandoffAnimation){const Q=uee(n);if(Q){const $=window.MotionHandoffAnimation(Q,I,ns);$!==null&&(V.startTime=$,B=!0)}}NU(n,I),k.start(rj(I,k,L,n.shouldReduceMotion&&cee.has(I)?{type:!1}:V,n,B));const W=k.animation;W&&b.push(W)}return y&&Promise.all(b).then(()=>{ns.update(()=>{y&&DAe(n,y)})}),b}function FU(n,t,s={}){var a;const l=S1(n,t,s.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};s.transitionOverride&&(d=s.transitionOverride);const f=l?()=>Promise.all(jee(n,l,s)):()=>Promise.resolve(),y=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:w=0,staggerChildren:I,staggerDirection:k}=d;return nOe(n,t,w+b,I,k,s)}:()=>Promise.resolve(),{when:v}=d;if(v){const[b,w]=v==="beforeChildren"?[f,y]:[y,f];return b().then(()=>w())}else return Promise.all([f(),y(s.delay)])}function nOe(n,t,s=0,a=0,l=1,d){const f=[],y=(n.variantChildren.size-1)*a,v=l===1?(b=0)=>b*a:(b=0)=>y-b*a;return Array.from(n.variantChildren).sort(rOe).forEach((b,w)=>{b.notify("AnimationStart",t),f.push(FU(b,t,{...d,delay:s+v(w)}).then(()=>b.notify("AnimationComplete",t)))}),Promise.all(f)}function rOe(n,t){return n.sortNodePosition(t)}function iOe(n,t,s={}){n.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>FU(n,d,s));a=Promise.all(l)}else if(typeof t=="string")a=FU(n,t,s);else{const l=typeof t=="function"?S1(n,t,s.custom):t;a=Promise.all(jee(n,l,s))}return a.then(()=>{n.notify("AnimationComplete",t)})}const sOe=OF.length;function Bee(n){if(!n)return;if(!n.isControllingVariants){const s=n.parent?Bee(n.parent)||{}:{};return n.props.initial!==void 0&&(s.initial=n.props.initial),s}const t={};for(let s=0;s<sOe;s++){const a=OF[s],l=n.props[a];(vC(l)||l===!1)&&(t[a]=l)}return t}const oOe=[...PF].reverse(),aOe=PF.length;function cOe(n){return t=>Promise.all(t.map(({animation:s,options:a})=>iOe(n,s,a)))}function lOe(n){let t=cOe(n),s=pq(),a=!0;const l=v=>(b,w)=>{var I;const k=S1(n,w,v==="exit"?(I=n.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(k){const{transition:L,transitionEnd:V,...B}=k;b={...b,...B,...V}}return b};function d(v){t=v(n)}function f(v){const{props:b}=n,w=Bee(n.parent)||{},I=[],k=new Set;let L={},V=1/0;for(let W=0;W<aOe;W++){const Q=oOe[W],$=s[Q],ie=b[Q]!==void 0?b[Q]:w[Q],ce=vC(ie),ne=Q===v?$.isActive:null;ne===!1&&(V=W);let de=ie===w[Q]&&ie!==b[Q]&&ce;if(de&&a&&n.manuallyAnimateOnMount&&(de=!1),$.protectedKeys={...L},!$.isActive&&ne===null||!ie&&!$.prevProp||E1(ie)||typeof ie=="boolean")continue;const Y=uOe($.prevProp,ie);let X=Y||Q===v&&$.isActive&&!de&&ce||W>V&&ce,Z=!1;const se=Array.isArray(ie)?ie:[ie];let me=se.reduce(l(Q),{});ne===!1&&(me={});const{prevResolvedValues:pe={}}=$,ue={...pe,...me},Le=ve=>{X=!0,k.has(ve)&&(Z=!0,k.delete(ve)),$.needsAnimating[ve]=!0;const _e=n.getValue(ve);_e&&(_e.liveStyle=!1)};for(const ve in ue){const _e=me[ve],Ee=pe[ve];if(L.hasOwnProperty(ve))continue;let ke=!1;PU(_e)&&PU(Ee)?ke=!eee(_e,Ee):ke=_e!==Ee,ke?_e!=null?Le(ve):k.add(ve):_e!==void 0&&k.has(ve)?Le(ve):$.protectedKeys[ve]=!0}$.prevProp=ie,$.prevResolvedValues=me,$.isActive&&(L={...L,...me}),a&&n.blockInitialAnimation&&(X=!1),X&&(!(de&&Y)||Z)&&I.push(...se.map(ve=>({animation:ve,options:{type:Q}})))}if(k.size){const W={};k.forEach(Q=>{const $=n.getBaseTarget(Q),ie=n.getValue(Q);ie&&(ie.liveStyle=!0),W[Q]=$??null}),I.push({animation:W})}let B=!!I.length;return a&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(B=!1),a=!1,B?t(I):Promise.resolve()}function y(v,b){var w;if(s[v].isActive===b)return Promise.resolve();(w=n.variantChildren)===null||w===void 0||w.forEach(k=>{var L;return(L=k.animationState)===null||L===void 0?void 0:L.setActive(v,b)}),s[v].isActive=b;const I=f(v);for(const k in s)s[k].protectedKeys={};return I}return{animateChanges:f,setActive:y,setAnimateFunction:d,getState:()=>s,reset:()=>{s=pq(),a=!0}}}function uOe(n,t){return typeof t=="string"?t!==n:Array.isArray(t)?!eee(t,n):!1}function oy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function pq(){return{animate:oy(!0),whileInView:oy(),whileHover:oy(),whileTap:oy(),whileDrag:oy(),whileFocus:oy(),exit:oy()}}class Dg{constructor(t){this.isMounted=!1,this.node=t}update(){}}class dOe extends Dg{constructor(t){super(t),t.animationState||(t.animationState=lOe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();E1(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let hOe=0;class pOe extends Dg{constructor(){super(...arguments),this.id=hOe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);s&&!t&&l.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const fOe={animation:{Feature:dOe},exit:{Feature:pOe}};function wC(n,t,s,a={passive:!0}){return n.addEventListener(t,s,a),()=>n.removeEventListener(t,s)}function YC(n){return{point:{x:n.pageX,y:n.pageY}}}const mOe=n=>t=>HF(t)&&n(t,YC(t));function eC(n,t,s,a){return wC(n,t,mOe(s),a)}const fq=(n,t)=>Math.abs(n-t);function gOe(n,t){const s=fq(n.x,t.x),a=fq(n.y,t.y);return Math.sqrt(s**2+a**2)}class Wee{constructor(t,s,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=bM(this.lastMoveEventInfo,this.history),k=this.startEvent!==null,L=gOe(I.offset,{x:0,y:0})>=3;if(!k&&!L)return;const{point:V}=I,{timestamp:B}=_a;this.history.push({...V,timestamp:B});const{onStart:W,onMove:Q}=this.handlers;k||(W&&W(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),Q&&Q(this.lastMoveEvent,I)},this.handlePointerMove=(I,k)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=SM(k,this.transformPagePoint),ns.update(this.updatePoint,!0)},this.handlePointerUp=(I,k)=>{this.end();const{onEnd:L,onSessionEnd:V,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const W=bM(I.type==="pointercancel"?this.lastMoveEventInfo:SM(k,this.transformPagePoint),this.history);this.startEvent&&L&&L(I,W),V&&V(I,W)},!HF(t))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=a,this.contextWindow=l||window;const f=YC(t),y=SM(f,this.transformPagePoint),{point:v}=y,{timestamp:b}=_a;this.history=[{...v,timestamp:b}];const{onSessionStart:w}=s;w&&w(t,bM(y,this.history)),this.removeListeners=qC(eC(this.contextWindow,"pointermove",this.handlePointerMove),eC(this.contextWindow,"pointerup",this.handlePointerUp),eC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),bg(this.updatePoint)}}function SM(n,t){return t?{point:t(n.point)}:n}function mq(n,t){return{x:n.x-t.x,y:n.y-t.y}}function bM({point:n},t){return{point:n,delta:mq(n,zee(t)),offset:mq(n,_Oe(t)),velocity:yOe(t,.1)}}function _Oe(n){return n[0]}function zee(n){return n[n.length-1]}function yOe(n,t){if(n.length<2)return{x:0,y:0};let s=n.length-1,a=null;const l=zee(n);for(;s>=0&&(a=n[s],!(l.timestamp-a.timestamp>If(t)));)s--;if(!a)return{x:0,y:0};const d=Af(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const Gee=1e-4,EOe=1-Gee,vOe=1+Gee,Hee=.01,SOe=0-Hee,bOe=0+Hee;function zl(n){return n.max-n.min}function TOe(n,t,s){return Math.abs(n-t)<=s}function gq(n,t,s,a=.5){n.origin=a,n.originPoint=ms(t.min,t.max,n.origin),n.scale=zl(s)/zl(t),n.translate=ms(s.min,s.max,n.origin)-n.originPoint,(n.scale>=EOe&&n.scale<=vOe||isNaN(n.scale))&&(n.scale=1),(n.translate>=SOe&&n.translate<=bOe||isNaN(n.translate))&&(n.translate=0)}function tC(n,t,s,a){gq(n.x,t.x,s.x,a?a.originX:void 0),gq(n.y,t.y,s.y,a?a.originY:void 0)}function _q(n,t,s){n.min=s.min+t.min,n.max=n.min+zl(t)}function wOe(n,t,s){_q(n.x,t.x,s.x),_q(n.y,t.y,s.y)}function yq(n,t,s){n.min=t.min-s.min,n.max=n.min+zl(t)}function nC(n,t,s){yq(n.x,t.x,s.x),yq(n.y,t.y,s.y)}function COe(n,{min:t,max:s},a){return t!==void 0&&n<t?n=a?ms(t,n,a.min):Math.max(n,t):s!==void 0&&n>s&&(n=a?ms(s,n,a.max):Math.min(n,s)),n}function Eq(n,t,s){return{min:t!==void 0?n.min+t:void 0,max:s!==void 0?n.max+s-(n.max-n.min):void 0}}function ROe(n,{top:t,left:s,bottom:a,right:l}){return{x:Eq(n.x,s,l),y:Eq(n.y,t,a)}}function vq(n,t){let s=t.min-n.min,a=t.max-n.max;return t.max-t.min<n.max-n.min&&([s,a]=[a,s]),{min:s,max:a}}function IOe(n,t){return{x:vq(n.x,t.x),y:vq(n.y,t.y)}}function AOe(n,t){let s=.5;const a=zl(n),l=zl(t);return l>a?s=d0(t.min,t.max-a,n.min):a>l&&(s=d0(n.min,n.max-l,t.min)),Mf(0,1,s)}function POe(n,t){const s={};return t.min!==void 0&&(s.min=t.min-n.min),t.max!==void 0&&(s.max=t.max-n.min),s}const jU=.35;function OOe(n=jU){return n===!1?n=0:n===!0&&(n=jU),{x:Sq(n,"left","right"),y:Sq(n,"top","bottom")}}function Sq(n,t,s){return{min:bq(n,t),max:bq(n,s)}}function bq(n,t){return typeof n=="number"?n:n[t]||0}const Tq=()=>({translate:0,scale:1,origin:0,originPoint:0}),MS=()=>({x:Tq(),y:Tq()}),wq=()=>({min:0,max:0}),Ws=()=>({x:wq(),y:wq()});function Nu(n){return[n("x"),n("y")]}function $ee({top:n,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:n,max:a}}}function kOe({x:n,y:t}){return{top:t.min,right:n.max,bottom:t.max,left:n.min}}function NOe(n,t){if(!t)return n;const s=t({x:n.left,y:n.top}),a=t({x:n.right,y:n.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function TM(n){return n===void 0||n===1}function BU({scale:n,scaleX:t,scaleY:s}){return!TM(n)||!TM(t)||!TM(s)}function cy(n){return BU(n)||Kee(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Kee(n){return Cq(n.x)||Cq(n.y)}function Cq(n){return n&&n!=="0%"}function Pk(n,t,s){const a=n-s,l=t*a;return s+l}function Rq(n,t,s,a,l){return l!==void 0&&(n=Pk(n,l,a)),Pk(n,s,a)+t}function WU(n,t=0,s=1,a,l){n.min=Rq(n.min,t,s,a,l),n.max=Rq(n.max,t,s,a,l)}function qee(n,{x:t,y:s}){WU(n.x,t.translate,t.scale,t.originPoint),WU(n.y,s.translate,s.scale,s.originPoint)}const Iq=.999999999999,Aq=1.0000000000001;function DOe(n,t,s,a=!1){const l=s.length;if(!l)return;t.x=t.y=1;let d,f;for(let y=0;y<l;y++){d=s[y],f=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&VS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,qee(n,f)),a&&cy(d.latestValues)&&VS(n,d.latestValues))}t.x<Aq&&t.x>Iq&&(t.x=1),t.y<Aq&&t.y>Iq&&(t.y=1)}function US(n,t){n.min=n.min+t,n.max=n.max+t}function Pq(n,t,s,a,l=.5){const d=ms(n.min,n.max,l);WU(n,t,s,d,a)}function VS(n,t){Pq(n.x,t.x,t.scaleX,t.scale,t.originX),Pq(n.y,t.y,t.scaleY,t.scale,t.originY)}function Yee(n,t){return $ee(NOe(n.getBoundingClientRect(),t))}function xOe(n,t,s){const a=Yee(n,s),{scroll:l}=t;return l&&(US(a.x,l.offset.x),US(a.y,l.offset.y)),a}const Xee=({current:n})=>n?n.ownerDocument.defaultView:null,LOe=new WeakMap;class MOe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ws(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=w=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(YC(w).point)},d=(w,I)=>{const{drag:k,dragPropagation:L,onDragStart:V}=this.getProps();if(k&&!L&&(this.openDragLock&&this.openDragLock(),this.openDragLock=AAe(k),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Nu(W=>{let Q=this.getAxisMotionValue(W).get()||0;if(Xh.test(Q)){const{projection:$}=this.visualElement;if($&&$.layout){const ie=$.layout.layoutBox[W];ie&&(Q=zl(ie)*(parseFloat(Q)/100))}}this.originPoint[W]=Q}),V&&ns.postRender(()=>V(w,I)),NU(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},f=(w,I)=>{const{dragPropagation:k,dragDirectionLock:L,onDirectionLock:V,onDrag:B}=this.getProps();if(!k&&!this.openDragLock)return;const{offset:W}=I;if(L&&this.currentDirection===null){this.currentDirection=UOe(W),this.currentDirection!==null&&V&&V(this.currentDirection);return}this.updateAxis("x",I.point,W),this.updateAxis("y",I.point,W),this.visualElement.render(),B&&B(w,I)},y=(w,I)=>this.stop(w,I),v=()=>Nu(w=>{var I;return this.getAnimationState(w)==="paused"&&((I=this.getAxisMotionValue(w).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new Wee(t,{onSessionStart:l,onStart:d,onMove:f,onSessionEnd:y,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:Xee(this.visualElement)})}stop(t,s){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=s;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&ns.postRender(()=>d(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,a){const{drag:l}=this.getProps();if(!a||!pO(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let f=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(f=COe(f,this.constraints[t],this.elastic[t])),d.set(f)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;s&&xS(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&l?this.constraints=ROe(l.layoutBox,s):this.constraints=!1,this.elastic=OOe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Nu(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=POe(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!xS(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=xOe(a,l.root,this.visualElement.getTransformPagePoint());let f=IOe(l.layout.layoutBox,d);if(s){const y=s(kOe(f));this.hasMutatedConstraints=!!y,y&&(f=$ee(y))}return f}startAnimation(t){const{drag:s,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:f,onDragTransitionEnd:y}=this.getProps(),v=this.constraints||{},b=Nu(w=>{if(!pO(w,s,this.currentDirection))return;let I=v&&v[w]||{};f&&(I={min:0,max:0});const k=l?200:1e6,L=l?40:1e7,V={type:"inertia",velocity:a?t[w]:0,bounceStiffness:k,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...d,...I};return this.startAxisValueAnimation(w,V)});return Promise.all(b).then(y)}startAxisValueAnimation(t,s){const a=this.getAxisMotionValue(t);return NU(this.visualElement,t),a.start(rj(t,a,0,s,this.visualElement,!1))}stopAnimation(){Nu(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Nu(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[s];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){Nu(s=>{const{drag:a}=this.getProps();if(!pO(s,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(s);if(l&&l.layout){const{min:f,max:y}=l.layout.layoutBox[s];d.set(t[s]-ms(f,y,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!xS(s)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Nu(f=>{const y=this.getAxisMotionValue(f);if(y&&this.constraints!==!1){const v=y.get();l[f]=AOe({min:v,max:v},this.constraints[f])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Nu(f=>{if(!pO(f,t,null))return;const y=this.getAxisMotionValue(f),{min:v,max:b}=this.constraints[f];y.set(ms(v,b,l[f]))})}addListeners(){if(!this.visualElement.current)return;LOe.set(this.visualElement,this);const t=this.visualElement.current,s=eC(t,"pointerdown",v=>{const{drag:b,dragListener:w=!0}=this.getProps();b&&w&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();xS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),ns.read(a);const f=wC(window,"resize",()=>this.scalePositionWithinConstraints()),y=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:b})=>{this.isDragging&&b&&(Nu(w=>{const I=this.getAxisMotionValue(w);I&&(this.originPoint[w]+=v[w].translate,I.set(I.get()+v[w].translate))}),this.visualElement.render())});return()=>{f(),s(),d(),y&&y()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:f=jU,dragMomentum:y=!0}=t;return{...t,drag:s,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:f,dragMomentum:y}}}function pO(n,t,s){return(t===!0||t===n)&&(s===null||s===n)}function UOe(n,t=10){let s=null;return Math.abs(n.y)>t?s="y":Math.abs(n.x)>t&&(s="x"),s}class VOe extends Dg{constructor(t){super(t),this.removeGroupControls=Wl,this.removeListeners=Wl,this.controls=new MOe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Wl}unmount(){this.removeGroupControls(),this.removeListeners()}}const Oq=n=>(t,s)=>{n&&ns.postRender(()=>n(t,s))};class FOe extends Dg{constructor(){super(...arguments),this.removePointerDownListener=Wl}onPointerDown(t){this.session=new Wee(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Xee(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:Oq(t),onStart:Oq(s),onMove:a,onEnd:(d,f)=>{delete this.session,l&&ns.postRender(()=>l(d,f))}}}mount(){this.removePointerDownListener=eC(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const KO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function kq(n,t){return t.max===t.min?0:n/(t.max-t.min)*100}const pw={correct:(n,t)=>{if(!t.target)return n;if(typeof n=="string")if(Bn.test(n))n=parseFloat(n);else return n;const s=kq(n,t.target.x),a=kq(n,t.target.y);return`${s}% ${a}%`}},jOe={correct:(n,{treeScale:t,projectionDelta:s})=>{const a=n,l=Tg.parse(n);if(l.length>5)return a;const d=Tg.createTransformer(n),f=typeof l[0]!="number"?1:0,y=s.x.scale*t.x,v=s.y.scale*t.y;l[0+f]/=y,l[1+f]/=v;const b=ms(y,v,.5);return typeof l[2+f]=="number"&&(l[2+f]/=b),typeof l[3+f]=="number"&&(l[3+f]/=b),d(l)}};class BOe extends D.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;aAe(WOe),d&&(s.group&&s.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),KO.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:a,drag:l,isPresent:d}=this.props,f=a.projection;return f&&(f.isPresent=d,l||t.layoutDependency!==s||s===void 0?f.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?f.promote():f.relegate()||ns.postRender(()=>{const y=f.getStack();(!y||!y.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),NF.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Jee(n){const[t,s]=RF(),a=D.useContext(TF);return C.jsx(BOe,{...n,layoutGroup:a,switchLayoutGroup:D.useContext(BZ),isPresent:t,safeToRemove:s})}const WOe={borderRadius:{...pw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:pw,borderTopRightRadius:pw,borderBottomLeftRadius:pw,borderBottomRightRadius:pw,boxShadow:jOe};function zOe(n,t,s){const a=Ja(n)?n:bC(n);return a.start(rj("",a,t,s)),a.animation}function GOe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const HOe=(n,t)=>n.depth-t.depth;class $Oe{constructor(){this.children=[],this.isDirty=!1}add(t){$F(this.children,t),this.isDirty=!0}remove(t){KF(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(HOe),this.isDirty=!1,this.children.forEach(t)}}function KOe(n,t){const s=Jh.now(),a=({timestamp:l})=>{const d=l-s;d>=t&&(bg(a),n(d-t))};return ns.read(a,!0),()=>bg(a)}const Qee=["TopLeft","TopRight","BottomLeft","BottomRight"],qOe=Qee.length,Nq=n=>typeof n=="string"?parseFloat(n):n,Dq=n=>typeof n=="number"||Bn.test(n);function YOe(n,t,s,a,l,d){l?(n.opacity=ms(0,s.opacity!==void 0?s.opacity:1,XOe(a)),n.opacityExit=ms(t.opacity!==void 0?t.opacity:1,0,JOe(a))):d&&(n.opacity=ms(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,a));for(let f=0;f<qOe;f++){const y=`border${Qee[f]}Radius`;let v=xq(t,y),b=xq(s,y);if(v===void 0&&b===void 0)continue;v||(v=0),b||(b=0),v===0||b===0||Dq(v)===Dq(b)?(n[y]=Math.max(ms(Nq(v),Nq(b),a),0),(Xh.test(b)||Xh.test(v))&&(n[y]+="%")):n[y]=b}(t.rotate||s.rotate)&&(n.rotate=ms(t.rotate||0,s.rotate||0,a))}function xq(n,t){return n[t]!==void 0?n[t]:n.borderRadius}const XOe=Zee(0,.5,_ee),JOe=Zee(.5,.95,Wl);function Zee(n,t,s){return a=>a<n?0:a>t?1:s(d0(n,t,a))}function Lq(n,t){n.min=t.min,n.max=t.max}function Pu(n,t){Lq(n.x,t.x),Lq(n.y,t.y)}function Mq(n,t){n.translate=t.translate,n.scale=t.scale,n.originPoint=t.originPoint,n.origin=t.origin}function Uq(n,t,s,a,l){return n-=t,n=Pk(n,1/s,a),l!==void 0&&(n=Pk(n,1/l,a)),n}function QOe(n,t=0,s=1,a=.5,l,d=n,f=n){if(Xh.test(t)&&(t=parseFloat(t),t=ms(f.min,f.max,t/100)-f.min),typeof t!="number")return;let y=ms(d.min,d.max,a);n===d&&(y-=t),n.min=Uq(n.min,t,s,y,l),n.max=Uq(n.max,t,s,y,l)}function Vq(n,t,[s,a,l],d,f){QOe(n,t[s],t[a],t[l],t.scale,d,f)}const ZOe=["x","scaleX","originX"],eke=["y","scaleY","originY"];function Fq(n,t,s,a){Vq(n.x,t,ZOe,s?s.x:void 0,a?a.x:void 0),Vq(n.y,t,eke,s?s.y:void 0,a?a.y:void 0)}function jq(n){return n.translate===0&&n.scale===1}function ete(n){return jq(n.x)&&jq(n.y)}function Bq(n,t){return n.min===t.min&&n.max===t.max}function tke(n,t){return Bq(n.x,t.x)&&Bq(n.y,t.y)}function Wq(n,t){return Math.round(n.min)===Math.round(t.min)&&Math.round(n.max)===Math.round(t.max)}function tte(n,t){return Wq(n.x,t.x)&&Wq(n.y,t.y)}function zq(n){return zl(n.x)/zl(n.y)}function Gq(n,t){return n.translate===t.translate&&n.scale===t.scale&&n.originPoint===t.originPoint}class nke{constructor(){this.members=[]}add(t){$F(this.members,t),t.scheduleRender()}remove(t){if(KF(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(l=>t===l);if(s===0)return!1;let a;for(let l=s;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,s){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,s&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:a}=t;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function rke(n,t,s){let a="";const l=n.x.translate/t.x,d=n.y.translate/t.y,f=(s==null?void 0:s.z)||0;if((l||d||f)&&(a=`translate3d(${l}px, ${d}px, ${f}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:b,rotate:w,rotateX:I,rotateY:k,skewX:L,skewY:V}=s;b&&(a=`perspective(${b}px) ${a}`),w&&(a+=`rotate(${w}deg) `),I&&(a+=`rotateX(${I}deg) `),k&&(a+=`rotateY(${k}deg) `),L&&(a+=`skewX(${L}deg) `),V&&(a+=`skewY(${V}deg) `)}const y=n.x.scale*t.x,v=n.y.scale*t.y;return(y!==1||v!==1)&&(a+=`scale(${y}, ${v})`),a||"none"}const ly={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Mw=typeof window<"u"&&window.MotionDebug!==void 0,wM=["","X","Y","Z"],ike={visibility:"hidden"},Hq=1e3;let ske=0;function CM(n,t,s,a){const{latestValues:l}=t;l[n]&&(s[n]=l[n],t.setStaticValue(n,0),a&&(a[n]=0))}function nte(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:t}=n.options;if(!t)return;const s=uee(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(s,"transform",ns,!(l||d))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&nte(a)}function rte({attachResizeListener:n,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},y=t==null?void 0:t()){this.id=ske++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Mw&&(ly.totalNodes=ly.resolvedTargetDeltas=ly.recalculatedProjection=0),this.nodes.forEach(cke),this.nodes.forEach(pke),this.nodes.forEach(fke),this.nodes.forEach(lke),Mw&&window.MotionDebug.record(ly)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=y?y.root||y:this,this.path=y?[...y.path,y]:[],this.parent=y,this.depth=y?y.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new $Oe)}addEventListener(f,y){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new qF),this.eventHandlers.get(f).add(y)}notifyListeners(f,...y){const v=this.eventHandlers.get(f);v&&v.notify(...y)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,y=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=GOe(f),this.instance=f;const{layoutId:v,layout:b,visualElement:w}=this.options;if(w&&!w.current&&w.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),y&&(b||v)&&(this.isLayoutDirty=!0),n){let I;const k=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=KOe(k,250),KO.hasAnimatedSinceResize&&(KO.hasAnimatedSinceResize=!1,this.nodes.forEach(Kq))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&w&&(v||b)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:k,hasRelativeTargetChanged:L,layout:V})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||w.getDefaultTransition()||Eke,{onLayoutAnimationStart:W,onLayoutAnimationComplete:Q}=w.getProps(),$=!this.targetLayout||!tte(this.targetLayout,V)||L,ie=!k&&L;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ie||k&&($||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,ie);const ce={...WF(B,"layout"),onPlay:W,onComplete:Q};(w.shouldReduceMotion||this.options.layoutRoot)&&(ce.delay=0,ce.type=!1),this.startAnimation(ce)}else k||Kq(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=V})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,bg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(mke),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&nte(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const I=this.path[w];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:y,layout:v}=this.options;if(y===void 0&&!v)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach($q);return}this.isUpdating||this.nodes.forEach(dke),this.isUpdating=!1,this.nodes.forEach(hke),this.nodes.forEach(oke),this.nodes.forEach(ake),this.clearAllSnapshots();const y=Jh.now();_a.delta=Mf(0,1e3/60,y-_a.timestamp),_a.timestamp=y,_a.isProcessing=!0,gM.update.process(_a),gM.preRender.process(_a),gM.render.process(_a),_a.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,NF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(uke),this.sharedNodes.forEach(gke)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ns.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ns.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ws(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:y}=this.options;y&&y.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let y=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(y=!1),y){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:v,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,y=this.projectionDelta&&!ete(this.projectionDelta),v=this.getTransformTemplate(),b=v?v(this.latestValues,""):void 0,w=b!==this.prevTransformTemplateValue;f&&(y||cy(this.latestValues)||w)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const y=this.measurePageBox();let v=this.removeElementScroll(y);return f&&(v=this.removeTransform(v)),vke(v),{animationId:this.root.animationId,measuredBox:y,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:y}=this.options;if(!y)return Ws();const v=y.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(Ske))){const{scroll:w}=this.root;w&&(US(v.x,w.offset.x),US(v.y,w.offset.y))}return v}removeElementScroll(f){var y;const v=Ws();if(Pu(v,f),!((y=this.scroll)===null||y===void 0)&&y.wasRoot)return v;for(let b=0;b<this.path.length;b++){const w=this.path[b],{scroll:I,options:k}=w;w!==this.root&&I&&k.layoutScroll&&(I.wasRoot&&Pu(v,f),US(v.x,I.offset.x),US(v.y,I.offset.y))}return v}applyTransform(f,y=!1){const v=Ws();Pu(v,f);for(let b=0;b<this.path.length;b++){const w=this.path[b];!y&&w.options.layoutScroll&&w.scroll&&w!==w.root&&VS(v,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),cy(w.latestValues)&&VS(v,w.latestValues)}return cy(this.latestValues)&&VS(v,this.latestValues),v}removeTransform(f){const y=Ws();Pu(y,f);for(let v=0;v<this.path.length;v++){const b=this.path[v];if(!b.instance||!cy(b.latestValues))continue;BU(b.latestValues)&&b.updateSnapshot();const w=Ws(),I=b.measurePageBox();Pu(w,I),Fq(y,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,w)}return cy(this.latestValues)&&Fq(y,this.latestValues),y}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==_a.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var y;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==v;if(!(f||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((y=this.parent)===null||y===void 0)&&y.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:k}=this.options;if(!(!this.layout||!(I||k))){if(this.resolvedRelativeTargetAt=_a.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ws(),this.relativeTargetOrigin=Ws(),nC(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),Pu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ws(),this.targetWithTransforms=Ws()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),wOe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Pu(this.target,this.layout.layoutBox),qee(this.target,this.targetDelta)):Pu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ws(),this.relativeTargetOrigin=Ws(),nC(this.relativeTargetOrigin,this.target,L.target),Pu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Mw&&ly.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||BU(this.parent.latestValues)||Kee(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const y=this.getLead(),v=!!this.resumingFrom||this!==y;let b=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(b=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===_a.timestamp&&(b=!1),b)return;const{layout:w,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||I))return;Pu(this.layoutCorrected,this.layout.layoutBox);const k=this.treeScale.x,L=this.treeScale.y;DOe(this.layoutCorrected,this.treeScale,this.path,v),y.layout&&!y.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(y.target=y.layout.layoutBox,y.targetWithTransforms=Ws());const{target:V}=y;if(!V){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Mq(this.prevProjectionDelta.x,this.projectionDelta.x),Mq(this.prevProjectionDelta.y,this.projectionDelta.y)),tC(this.projectionDelta,this.layoutCorrected,V,this.latestValues),(this.treeScale.x!==k||this.treeScale.y!==L||!Gq(this.projectionDelta.x,this.prevProjectionDelta.x)||!Gq(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",V)),Mw&&ly.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var y;if((y=this.options.visualElement)===null||y===void 0||y.scheduleRender(),f){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=MS(),this.projectionDelta=MS(),this.projectionDeltaWithTransform=MS()}setAnimationOrigin(f,y=!1){const v=this.snapshot,b=v?v.latestValues:{},w={...this.latestValues},I=MS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!y;const k=Ws(),L=v?v.source:void 0,V=this.layout?this.layout.source:void 0,B=L!==V,W=this.getStack(),Q=!W||W.members.length<=1,$=!!(B&&!Q&&this.options.crossfade===!0&&!this.path.some(yke));this.animationProgress=0;let ie;this.mixTargetDelta=ce=>{const ne=ce/1e3;qq(I.x,f.x,ne),qq(I.y,f.y,ne),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(nC(k,this.layout.layoutBox,this.relativeParent.layout.layoutBox),_ke(this.relativeTarget,this.relativeTargetOrigin,k,ne),ie&&tke(this.relativeTarget,ie)&&(this.isProjectionDirty=!1),ie||(ie=Ws()),Pu(ie,this.relativeTarget)),B&&(this.animationValues=w,YOe(w,b,this.latestValues,ne,$,Q)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ne},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(bg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ns.update(()=>{KO.hasAnimatedSinceResize=!0,this.currentAnimation=zOe(0,Hq,{...f,onUpdate:y=>{this.mixTargetDelta(y),f.onUpdate&&f.onUpdate(y)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Hq),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:y,target:v,layout:b,latestValues:w}=f;if(!(!y||!v||!b)){if(this!==f&&this.layout&&b&&ite(this.options.animationType,this.layout.layoutBox,b.layoutBox)){v=this.target||Ws();const I=zl(this.layout.layoutBox.x);v.x.min=f.target.x.min,v.x.max=v.x.min+I;const k=zl(this.layout.layoutBox.y);v.y.min=f.target.y.min,v.y.max=v.y.min+k}Pu(y,v),VS(y,w),tC(this.projectionDeltaWithTransform,this.layoutCorrected,y,w)}}registerSharedNode(f,y){this.sharedNodes.has(f)||this.sharedNodes.set(f,new nke),this.sharedNodes.get(f).add(y);const b=y.options.initialPromotionConfig;y.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(y):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:y}=this.options;return y?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:y}=this.options;return y?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:y,preserveFollowOpacity:v}={}){const b=this.getStack();b&&b.promote(this,v),f&&(this.projectionDelta=void 0,this.needsReset=!0),y&&this.setOptions({transition:y})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let y=!1;const{latestValues:v}=f;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(y=!0),!y)return;const b={};v.z&&CM("z",f,b,this.animationValues);for(let w=0;w<wM.length;w++)CM(`rotate${wM[w]}`,f,b,this.animationValues),CM(`skew${wM[w]}`,f,b,this.animationValues);f.render();for(const w in b)f.setStaticValue(w,b[w]),this.animationValues&&(this.animationValues[w]=b[w]);f.scheduleRender()}getProjectionStyles(f){var y,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return ike;const b={visibility:""},w=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=HO(f==null?void 0:f.pointerEvents)||"",b.transform=w?w(this.latestValues,""):"none",b;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const B={};return this.options.layoutId&&(B.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,B.pointerEvents=HO(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!cy(this.latestValues)&&(B.transform=w?w({},""):"none",this.hasProjected=!1),B}const k=I.animationValues||I.latestValues;this.applyTransformsToTarget(),b.transform=rke(this.projectionDeltaWithTransform,this.treeScale,k),w&&(b.transform=w(k,b.transform));const{x:L,y:V}=this.projectionDelta;b.transformOrigin=`${L.origin*100}% ${V.origin*100}% 0`,I.animationValues?b.opacity=I===this?(v=(y=k.opacity)!==null&&y!==void 0?y:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:k.opacityExit:b.opacity=I===this?k.opacity!==void 0?k.opacity:"":k.opacityExit!==void 0?k.opacityExit:0;for(const B in wk){if(k[B]===void 0)continue;const{correct:W,applyTo:Q}=wk[B],$=b.transform==="none"?k[B]:W(k[B],I);if(Q){const ie=Q.length;for(let ce=0;ce<ie;ce++)b[Q[ce]]=$}else b[B]=$}return this.options.layoutId&&(b.pointerEvents=I===this?HO(f==null?void 0:f.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var y;return(y=f.currentAnimation)===null||y===void 0?void 0:y.stop()}),this.root.nodes.forEach($q),this.root.sharedNodes.clear()}}}function oke(n){n.updateLayout()}function ake(n){var t;const s=((t=n.resumeFrom)===null||t===void 0?void 0:t.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&s&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:d}=n.options,f=s.source!==n.layout.source;d==="size"?Nu(I=>{const k=f?s.measuredBox[I]:s.layoutBox[I],L=zl(k);k.min=a[I].min,k.max=k.min+L}):ite(d,s.layoutBox,a)&&Nu(I=>{const k=f?s.measuredBox[I]:s.layoutBox[I],L=zl(a[I]);k.max=k.min+L,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[I].max=n.relativeTarget[I].min+L)});const y=MS();tC(y,a,s.layoutBox);const v=MS();f?tC(v,n.applyTransform(l,!0),s.measuredBox):tC(v,a,s.layoutBox);const b=!ete(y);let w=!1;if(!n.resumeFrom){const I=n.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:k,layout:L}=I;if(k&&L){const V=Ws();nC(V,s.layoutBox,k.layoutBox);const B=Ws();nC(B,a,L.layoutBox),tte(V,B)||(w=!0),I.options.layoutRoot&&(n.relativeTarget=B,n.relativeTargetOrigin=V,n.relativeParent=I)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:v,layoutDelta:y,hasLayoutChanged:b,hasRelativeTargetChanged:w})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function cke(n){Mw&&ly.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function lke(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function uke(n){n.clearSnapshot()}function $q(n){n.clearMeasurements()}function dke(n){n.isLayoutDirty=!1}function hke(n){const{visualElement:t}=n.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),n.resetTransform()}function Kq(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function pke(n){n.resolveTargetDelta()}function fke(n){n.calcProjection()}function mke(n){n.resetSkewAndRotation()}function gke(n){n.removeLeadSnapshot()}function qq(n,t,s){n.translate=ms(t.translate,0,s),n.scale=ms(t.scale,1,s),n.origin=t.origin,n.originPoint=t.originPoint}function Yq(n,t,s,a){n.min=ms(t.min,s.min,a),n.max=ms(t.max,s.max,a)}function _ke(n,t,s,a){Yq(n.x,t.x,s.x,a),Yq(n.y,t.y,s.y,a)}function yke(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const Eke={duration:.45,ease:[.4,0,.1,1]},Xq=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),Jq=Xq("applewebkit/")&&!Xq("chrome/")?Math.round:Wl;function Qq(n){n.min=Jq(n.min),n.max=Jq(n.max)}function vke(n){Qq(n.x),Qq(n.y)}function ite(n,t,s){return n==="position"||n==="preserve-aspect"&&!TOe(zq(t),zq(s),.2)}function Ske(n){var t;return n!==n.root&&((t=n.scroll)===null||t===void 0?void 0:t.wasRoot)}const bke=rte({attachResizeListener:(n,t)=>wC(n,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),RM={current:void 0},ste=rte({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!RM.current){const n=new bke({});n.mount(window),n.setOptions({layoutScroll:!0}),RM.current=n}return RM.current},resetTransform:(n,t)=>{n.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),Tke={pan:{Feature:FOe},drag:{Feature:VOe,ProjectionNode:ste,MeasureLayout:Jee}};function Zq(n,t,s){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",s==="Start");const l="onHover"+s,d=a[l];d&&ns.postRender(()=>d(t,YC(t)))}class wke extends Dg{mount(){const{current:t}=this.node;t&&(this.unmount=TAe(t,s=>(Zq(this.node,s,"Start"),a=>Zq(this.node,a,"End"))))}unmount(){}}class Cke extends Dg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=qC(wC(this.node.current,"focus",()=>this.onFocus()),wC(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function eY(n,t,s){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",s==="Start");const l="onTap"+(s==="End"?"":s),d=a[l];d&&ns.postRender(()=>d(t,YC(t)))}class Rke extends Dg{mount(){const{current:t}=this.node;t&&(this.unmount=IAe(t,s=>(eY(this.node,s,"Start"),(a,{success:l})=>eY(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const zU=new WeakMap,IM=new WeakMap,Ike=n=>{const t=zU.get(n.target);t&&t(n)},Ake=n=>{n.forEach(Ike)};function Pke({root:n,...t}){const s=n||document;IM.has(s)||IM.set(s,{});const a=IM.get(s),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(Ake,{root:n,...t})),a[l]}function Oke(n,t,s){const a=Pke(t);return zU.set(n,s),a.observe(n),()=>{zU.delete(n),a.unobserve(n)}}const kke={some:0,all:1};class Nke extends Dg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:a,amount:l="some",once:d}=t,f={root:s?s.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:kke[l]},y=v=>{const{isIntersecting:b}=v;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:w,onViewportLeave:I}=this.node.getProps(),k=b?w:I;k&&k(v)};return Oke(this.node.current,f,y)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(Dke(t,s))&&this.startObserver()}unmount(){}}function Dke({viewport:n={}},{viewport:t={}}={}){return s=>n[s]!==t[s]}const xke={inView:{Feature:Nke},tap:{Feature:Rke},focus:{Feature:Cke},hover:{Feature:wke}},Lke={layout:{ProjectionNode:ste,MeasureLayout:Jee}},GU={current:null},ote={current:!1};function Mke(){if(ote.current=!0,!!IF)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),t=()=>GU.current=n.matches;n.addListener(t),t()}else GU.current=!1}const Uke=[...kee,qa,Tg],Vke=n=>Uke.find(Oee(n)),tY=new WeakMap;function Fke(n,t,s){for(const a in t){const l=t[a],d=s[a];if(Ja(l))n.addValue(a,l);else if(Ja(d))n.addValue(a,bC(l,{owner:n}));else if(d!==l)if(n.hasValue(a)){const f=n.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(a);n.addValue(a,bC(f!==void 0?f:l,{owner:n}))}}for(const a in s)t[a]===void 0&&n.removeValue(a);return t}const nY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class jke{scrapeMotionValuesFromProps(t,s,a){return{}}constructor({parent:t,props:s,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:f},y={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=ej,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=Jh.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,ns.render(this.render,!1,!0))};const{latestValues:v,renderState:b,onUpdate:w}=f;this.onUpdate=w,this.latestValues=v,this.baseTarget={...v},this.initialValues=s.initial?{...v}:{},this.renderState=b,this.parent=t,this.props=s,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=y,this.blockInitialAnimation=!!d,this.isControllingVariants=v1(s),this.isVariantNode=FZ(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:I,...k}=this.scrapeMotionValuesFromProps(s,{},this);for(const L in k){const V=k[L];v[L]!==void 0&&Ja(V)&&V.set(v[L],!1)}}mount(t){this.current=t,tY.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,a)=>this.bindToMotionValue(a,s)),ote.current||Mke(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:GU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){tY.delete(this.current),this.projection&&this.projection.unmount(),bg(this.notifyUpdate),bg(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=Hy.has(t),l=s.on("change",y=>{this.latestValues[t]=y,this.props.onUpdate&&ns.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=s.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{l(),d(),f&&f(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in h0){const s=h0[t];if(!s)continue;const{isEnabled:a,Feature:l}=s;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ws()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<nY.length;a++){const l=nY[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,f=t[d];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=Fke(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const a=this.values.get(t);s!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&s!==void 0&&(a=bC(s===null?void 0:s,{owner:this}),this.addValue(t,a)),a}readValue(t,s){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(Aee(l)||Eee(l))?l=parseFloat(l):!Vke(l)&&Tg.test(s)&&(l=Cee(t,s)),this.setBaseTarget(t,Ja(l)?l.get():l)),Ja(l)?l.get():l}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const f=xF(this.props,a,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);f&&(l=f[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!Ja(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new qF),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class ate extends jke{constructor(){super(...arguments),this.KeyframeResolver=Nee}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:a}){delete s[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Ja(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function Bke(n){return window.getComputedStyle(n)}class Wke extends ate{constructor(){super(...arguments),this.type="html",this.renderInstance=qZ}readValueFromInstance(t,s){if(Hy.has(s)){const a=ZF(s);return a&&a.default||0}else{const a=Bke(t),l=(HZ(s)?a.getPropertyValue(s):a[s])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:s}){return Yee(t,s)}build(t,s,a){UF(t,s,a.transformTemplate)}scrapeMotionValuesFromProps(t,s,a){return BF(t,s,a)}}class zke extends ate{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ws}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(Hy.has(s)){const a=ZF(s);return a&&a.default||0}return s=YZ.has(s)?s:kF(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,a){return QZ(t,s,a)}build(t,s,a){VF(t,s,this.isSVGTag,a.transformTemplate)}renderInstance(t,s,a,l){XZ(t,s,a,l)}mount(t){this.isSVGTag=jF(t.tagName),super.mount(t)}}const Gke=(n,t)=>DF(n)?new zke(t):new Wke(t,{allowProjection:n!==D.Fragment}),Hke=gAe({...fOe,...xke,...Tke,...Lke},Gke),Gf=kIe(Hke),$ke=(n,t)=>n.find(s=>s.id===t);function rY(n,t){const s=cte(n,t),a=s?n[s].findIndex(l=>l.id===t):-1;return{position:s,index:a}}function cte(n,t){for(const[s,a]of Object.entries(n))if($ke(a,t))return s}function Kke(n){const t=n.includes("right"),s=n.includes("left");let a="center";return t&&(a="flex-end"),s&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function qke(n){const s=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:s,top:a,bottom:l,right:d,left:f}}var Yke=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,Xke=wZ(function(n){return Yke.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),Jke=Xke,Qke=function(t){return t!=="theme"},iY=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?Jke:Qke},sY=function(t,s,a){var l;if(s){var d=s.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(f){return t.__emotion_forwardProp(f)&&d(f)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},Zke=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return mF(s,a,l),PZ(function(){return gF(s,a,l)}),null},e1e=function n(t,s){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,f;s!==void 0&&(d=s.label,f=s.target);var y=sY(t,s,a),v=y||iY(l),b=!v("as");return function(){var w=arguments,I=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&I.push("label:"+d+";"),w[0]==null||w[0].raw===void 0)I.push.apply(I,w);else{var k=w[0];I.push(k[0]);for(var L=w.length,V=1;V<L;V++)I.push(w[V],k[V])}var B=yF(function(W,Q,$){var ie=b&&W.as||l,ce="",ne=[],de=W;if(W.theme==null){de={};for(var Y in W)de[Y]=W[Y];de.theme=D.useContext(u0)}typeof W.className=="string"?ce=RZ(Q.registered,ne,W.className):W.className!=null&&(ce=W.className+" ");var X=m1(I.concat(ne),Q.registered,de);ce+=Q.key+"-"+X.name,f!==void 0&&(ce+=" "+f);var Z=b&&y===void 0?iY(ie):v,se={};for(var me in W)b&&me==="as"||Z(me)&&(se[me]=W[me]);return se.className=ce,$&&(se.ref=$),D.createElement(D.Fragment,null,D.createElement(Zke,{cache:Q,serialized:X,isStringTag:typeof ie=="string"}),D.createElement(ie,se))});return B.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",B.defaultProps=t.defaultProps,B.__emotion_real=B,B.__emotion_base=l,B.__emotion_styles=I,B.__emotion_forwardProp=y,Object.defineProperty(B,"toString",{value:function(){return"."+f}}),B.withComponent=function(W,Q){var $=n(W,Ny({},s,Q,{shouldForwardProp:sY(B,Q,!0)}));return $.apply(void 0,I)},B}},t1e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],HU=e1e.bind(null);t1e.forEach(function(n){HU[n]=HU(n)});const n1e=new Set([...Sve,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),r1e=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function i1e(n){return(r1e.has(n)||!n1e.has(n))&&n[0]!=="_"}const s1e=Yye(HU),o1e=({baseStyle:n})=>t=>{const{theme:s,css:a,__css:l,sx:d,...f}=t,[y]=nEe(f,Tve),v=cl(n,t),b=Lye({},l,v,a1(y),d),w=rZ(b)(t.theme);return a?[w,a]:w};function AM(n,t){const{baseStyle:s,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=i1e);const l=o1e({baseStyle:s}),d=s1e(n,a)(l);return D.forwardRef(function(v,b){const{children:w,...I}=v,{colorMode:k,forced:L}=_1(),V=L?k:void 0;return D.createElement(d,{ref:b,"data-theme":V,...I},w)})}function a1e(){const n=new Map;return new Proxy(AM,{apply(t,s,a){return AM(...a)},get(t,s){return n.has(s)||n.set(s,AM(s)),n.get(s)}})}const Dt=a1e(),c1e={initial:n=>{const{position:t}=n,s=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[s]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},lte=D.memo(n=>{const{id:t,message:s,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:f="bottom",duration:y=5e3,containerStyle:v,motionVariants:b=c1e,toastSpacing:w="0.5rem"}=n,[I,k]=D.useState(y),L=bIe();xf(()=>{L||a==null||a()},[L]),xf(()=>{k(y)},[y]);const V=()=>k(null),B=()=>k(y),W=()=>{L&&l()};D.useEffect(()=>{L&&d&&l()},[L,d,l]),CEe(W,I);const Q=D.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:w,...v}),[v,w]),$=D.useMemo(()=>Kke(f),[f]);return C.jsx(Gf.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:V,onHoverEnd:B,custom:{position:f},style:$,children:C.jsx(Dt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:Q,children:cl(s,{id:t,onClose:W})})})});lte.displayName="ToastComponent";function Wt(n){return D.forwardRef(n)}var PM,oY;function l1e(){if(oY)return PM;oY=1;var n=typeof Element<"u",t=typeof Map=="function",s=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,f){if(d===f)return!0;if(d&&f&&typeof d=="object"&&typeof f=="object"){if(d.constructor!==f.constructor)return!1;var y,v,b;if(Array.isArray(d)){if(y=d.length,y!=f.length)return!1;for(v=y;v--!==0;)if(!l(d[v],f[v]))return!1;return!0}var w;if(t&&d instanceof Map&&f instanceof Map){if(d.size!==f.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!f.has(v.value[0]))return!1;for(w=d.entries();!(v=w.next()).done;)if(!l(v.value[1],f.get(v.value[0])))return!1;return!0}if(s&&d instanceof Set&&f instanceof Set){if(d.size!==f.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!f.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(f)){if(y=d.length,y!=f.length)return!1;for(v=y;v--!==0;)if(d[v]!==f[v])return!1;return!0}if(d.constructor===RegExp)return d.source===f.source&&d.flags===f.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof f.valueOf=="function")return d.valueOf()===f.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof f.toString=="function")return d.toString()===f.toString();if(b=Object.keys(d),y=b.length,y!==Object.keys(f).length)return!1;for(v=y;v--!==0;)if(!Object.prototype.hasOwnProperty.call(f,b[v]))return!1;if(n&&d instanceof Element)return!1;for(v=y;v--!==0;)if(!((b[v]==="_owner"||b[v]==="__v"||b[v]==="__o")&&d.$$typeof)&&!l(d[b[v]],f[b[v]]))return!1;return!0}return d!==d&&f!==f}return PM=function(f,y){try{return l(f,y)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},PM}var u1e=l1e();const d1e=Ng(u1e);function U0(){const n=D.useContext(u0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function ute(){const n=_1(),t=U0();return{...n,theme:t}}function h1e(n,t,s){if(t==null)return t;const a=l=>{var d,f;return(f=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:f.value};return a(t)??a(s)??s}function p1e(n,t,s){const a=Array.isArray(t)?t:[t],l=Array.isArray(s)?s:[s];return d=>{const f=l.filter(Boolean),y=a.map((v,b)=>{const w=`${n}.${v}`;return h1e(d,w,f[b]??v)});return Array.isArray(t)?y:y[0]}}function dte(n,t={}){const{styleConfig:s,...a}=t,{theme:l,colorMode:d}=ute(),f=n?FQ(l,`components.${n}`):void 0,y=s||f,v=zh({theme:l,colorMode:d},(y==null?void 0:y.defaultProps)??{},a1(N0(a,["children"])),(w,I)=>w?void 0:I),b=D.useRef({});if(y){const I=xve(y)(v);d1e(b.current,I)||(b.current=I)}return b.current}function ju(n,t={}){return dte(n,t)}function Za(n,t={}){return dte(n,t)}const aY={path:C.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[C.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),C.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),C.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},yn=Wt((n,t)=>{const{as:s,viewBox:a,color:l="currentColor",focusable:d=!1,children:f,className:y,__css:v,...b}=n,w=pn("chakra-icon",y),I=ju("Icon",n),k={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...I},L={ref:t,focusable:d,className:w,__css:k},V=a??aY.viewBox;if(s&&typeof s!="string")return C.jsx(Dt.svg,{as:s,...L,...b});const B=f??aY.path;return C.jsx(Dt.svg,{verticalAlign:"middle",viewBox:V,...L,...b,children:B})});yn.displayName="Icon";function f1e(n){return C.jsx(yn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function m1e(n){return C.jsx(yn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function cY(n){return C.jsx(yn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const g1e=GC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),cp=Wt((n,t)=>{const s=ju("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:f="transparent",className:y,...v}=Gi(n),b=pn("chakra-spinner",y),w={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${g1e} ${d} linear infinite`,...s};return C.jsx(Dt.div,{ref:t,__css:w,className:b,...v,children:a&&C.jsx(Dt.span,{srOnly:!0,children:a})})});cp.displayName="Spinner";const[_1e,ij]=Oi({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[y1e,sj]=Oi({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),hte={info:{icon:m1e,colorScheme:"blue"},warning:{icon:cY,colorScheme:"orange"},success:{icon:f1e,colorScheme:"green"},error:{icon:cY,colorScheme:"red"},loading:{icon:cp,colorScheme:"blue"}};function E1e(n){return hte[n].colorScheme}function v1e(n){return hte[n].icon}const yf=Wt(function(t,s){const{status:a="info",addRole:l=!0,...d}=Gi(t),f=t.colorScheme??E1e(a),y=Za("Alert",{...t,colorScheme:f}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...y.container};return C.jsx(_1e,{value:{status:a},children:C.jsx(y1e,{value:y,children:C.jsx(Dt.div,{"data-status":a,role:l?"alert":void 0,ref:s,...d,className:pn("chakra-alert",t.className),__css:v})})})});yf.displayName="Alert";function Ef(n){const{status:t}=ij(),s=v1e(t),a=sj(),l=t==="loading"?a.spinner:a.icon;return C.jsx(Dt.span,{display:"inherit","data-status":t,...n,className:pn("chakra-alert__icon",n.className),__css:l,children:n.children||C.jsx(s,{h:"100%",w:"100%"})})}Ef.displayName="AlertIcon";const FS=Wt(function(t,s){const a=sj(),{status:l}=ij();return C.jsx(Dt.div,{ref:s,"data-status":l,...t,className:pn("chakra-alert__title",t.className),__css:a.title})});FS.displayName="AlertTitle";const jS=Wt(function(t,s){const{status:a}=ij(),l=sj(),d={display:"inline",...l.description};return C.jsx(Dt.div,{ref:s,"data-status":a,...t,className:pn("chakra-alert__desc",t.className),__css:d})});jS.displayName="AlertDescription";function S1e(n){return C.jsx(yn,{focusable:"false","aria-hidden":!0,...n,children:C.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const oj=Wt(function(t,s){const a=ju("CloseButton",t),{children:l,isDisabled:d,__css:f,...y}=Gi(t),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return C.jsx(Dt.button,{type:"button","aria-label":"Close",ref:s,disabled:d,__css:{...v,...a,...f},...y,children:l||C.jsx(S1e,{width:"1em",height:"1em"})})});oj.displayName="CloseButton";const b1e=n=>{const{status:t,variant:s="solid",id:a,title:l,isClosable:d,onClose:f,description:y,colorScheme:v,icon:b}=n,w=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return C.jsxs(yf,{addRole:!1,status:t,variant:s,id:w==null?void 0:w.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[C.jsx(Ef,{children:b}),C.jsxs(Dt.div,{flex:"1",maxWidth:"100%",children:[l&&C.jsx(FS,{id:w==null?void 0:w.title,children:l}),y&&C.jsx(jS,{id:w==null?void 0:w.description,display:"block",children:y})]}),d&&C.jsx(oj,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function pte(n={}){const{render:t,toastComponent:s=b1e}=n;return l=>typeof t=="function"?t({...l,...n}):C.jsx(s,{...l,...n})}const T1e={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},jh=w1e(T1e);function w1e(n){let t=n;const s=new Set,a=l=>{t=l(t),s.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(s.add(l),()=>{a(()=>n),s.delete(l)}),removeToast:(l,d)=>{a(f=>({...f,[d]:f[d].filter(y=>y.id!=l)}))},notify:(l,d)=>{const f=C1e(l,d),{position:y,id:v}=f;return a(b=>{const I=y.includes("top")?[f,...b[y]??[]]:[...b[y]??[],f];return{...b,[y]:I}}),v},update:(l,d)=>{l&&a(f=>{const y={...f},{position:v,index:b}=rY(y,l);return v&&b!==-1&&(y[v][b]={...y[v][b],...d,message:pte(d)}),y})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,b)=>(v[b]=d[b].map(w=>({...w,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const f=cte(d,l);return f?{...d,[f]:d[f].map(y=>y.id==l?{...y,requestClose:!0}:y)}:d})},isActive:l=>!!rY(jh.getState(),l).position}}let lY=0;function C1e(n,t={}){lY+=1;const s=t.id??lY,a=t.position??"bottom";return{id:s,message:n,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>jh.removeToast(String(s),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var fte=OQ();const[mte,R1e]=Oi({strict:!1,name:"PortalContext"}),aj="chakra-portal",I1e=".chakra-portal",A1e=n=>C.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),P1e=n=>{const{appendToParentPortal:t,children:s}=n,[a,l]=D.useState(null),d=D.useRef(null),[,f]=D.useState({});D.useEffect(()=>f({}),[]);const y=R1e(),v=mIe();Kh(()=>{if(!a)return;const w=a.ownerDocument,I=t?y??w.body:w.body;if(!I)return;d.current=w.createElement("div"),d.current.className=aj,I.appendChild(d.current),f({});const k=d.current;return()=>{I.contains(k)&&I.removeChild(k)}},[a]);const b=v!=null&&v.zIndex?C.jsx(A1e,{zIndex:v==null?void 0:v.zIndex,children:s}):s;return d.current?fte.createPortal(C.jsx(mte,{value:d.current,children:b}),d.current):C.jsx("span",{ref:w=>{w&&l(w)}})},O1e=n=>{const{children:t,containerRef:s,appendToParentPortal:a}=n,l=s.current,d=l??(typeof window<"u"?document.body:void 0),f=D.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=aj),v},[l]),[,y]=D.useState({});return Kh(()=>y({}),[]),Kh(()=>{if(!(!f||!d))return d.appendChild(f),()=>{d.removeChild(f)}},[f,d]),d&&f?fte.createPortal(C.jsx(mte,{value:a?f:null,children:t}),f):null};function Bu(n){const t={appendToParentPortal:!0,...n},{containerRef:s,...a}=t;return s?C.jsx(O1e,{containerRef:s,...a}):C.jsx(P1e,{...a})}Bu.className=aj;Bu.selector=I1e;Bu.displayName="Portal";const[k1e,N1e]=Oi({name:"ToastOptionsContext",strict:!1}),D1e=n=>{const t=D.useSyncExternalStore(jh.subscribe,jh.getState,jh.getState),{motionVariants:s,component:a=lte,portalProps:l,animatePresenceProps:d}=n,y=Object.keys(t).map(v=>{const b=t[v];return C.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:qke(v),children:C.jsx(x0,{...d,initial:!1,children:b.map(w=>C.jsx(a,{motionVariants:s,...w},w.id))})},v)});return C.jsx(Bu,{...l,children:y})},x1e=n=>function({children:s,theme:a=n,toastOptions:l,...d}){return C.jsxs(_Ie,{theme:a,...d,children:[C.jsx(k1e,{value:l==null?void 0:l.defaultOptions,children:s}),C.jsx(D1e,{...l})]})},L1e=x1e(oRe);function uY(n){return n.sort((t,s)=>{const a=t.compareDocumentPosition(s);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const M1e=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function dY(n,t,s){let a=n+1;return s&&a>=t&&(a=0),a}function hY(n,t,s){let a=n-1;return s&&a<0&&(a=t),a}const OM=typeof window<"u"?D.useLayoutEffect:D.useEffect,pY=n=>n;var U1e=Object.defineProperty,V1e=(n,t,s)=>t in n?U1e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,Ns=(n,t,s)=>(V1e(n,typeof t!="symbol"?t+"":t,s),s);class F1e{constructor(){Ns(this,"descendants",new Map),Ns(this,"register",t=>{if(t!=null)return M1e(t)?this.registerNode(t):s=>{this.registerNode(s,t)}}),Ns(this,"unregister",t=>{this.descendants.delete(t);const s=uY(Array.from(this.descendants.keys()));this.assignIndex(s)}),Ns(this,"destroy",()=>{this.descendants.clear()}),Ns(this,"assignIndex",t=>{this.descendants.forEach(s=>{const a=t.indexOf(s.node);s.index=a,s.node.dataset.index=s.index.toString()})}),Ns(this,"count",()=>this.descendants.size),Ns(this,"enabledCount",()=>this.enabledValues().length),Ns(this,"values",()=>Array.from(this.descendants.values()).sort((s,a)=>s.index-a.index)),Ns(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),Ns(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),Ns(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),Ns(this,"first",()=>this.item(0)),Ns(this,"firstEnabled",()=>this.enabledItem(0)),Ns(this,"last",()=>this.item(this.descendants.size-1)),Ns(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),Ns(this,"indexOf",t=>{var s;return t?((s=this.descendants.get(t))==null?void 0:s.index)??-1:-1}),Ns(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(s=>s.node.isSameNode(t))),Ns(this,"next",(t,s=!0)=>{const a=dY(t,this.count(),s);return this.item(a)}),Ns(this,"nextEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=dY(l,this.enabledCount(),s);return this.enabledItem(d)}),Ns(this,"prev",(t,s=!0)=>{const a=hY(t,this.count()-1,s);return this.item(a)}),Ns(this,"prevEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=hY(l,this.enabledCount()-1,s);return this.enabledItem(d)}),Ns(this,"registerNode",(t,s)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=uY(a);s!=null&&s.disabled&&(s.disabled=!!s.disabled);const d={node:t,index:-1,...s};this.descendants.set(t,d),this.assignIndex(l)})}}function gte(){const[n,t]=Oi({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,t,()=>{const l=D.useRef(new F1e);return OM(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[f,y]=D.useState(-1),v=D.useRef(null);OM(()=>()=>{v.current&&d.unregister(v.current)},[]),OM(()=>{if(!v.current)return;const w=Number(v.current.dataset.index);f!=w&&!Number.isNaN(w)&&y(w)});const b=pY(l?d.register(l):d.register);return{descendants:d,index:f,enabledIndex:d.enabledIndexOf(v.current),register:Vi(b,v)}}]}const fY={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},wy={enter:{duration:.2,ease:fY.easeOut},exit:{duration:.1,ease:fY.easeIn}},Cy={enter:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.exit})},[j1e,B1e]=Oi({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function W1e(n){const t=n.trim().split(" "),s=t[0]??"",a=t.length>1?t[t.length-1]:"";return s&&a?`${s.charAt(0)}${a.charAt(0)}`:s.charAt(0)}function _te(n){const{name:t,getInitials:s,...a}=n,l=B1e();return C.jsx(Dt.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?s==null?void 0:s(t):null})}_te.displayName="AvatarName";const yte=n=>C.jsxs(Dt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[C.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),C.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function Ete(n){const{loading:t,src:s,srcSet:a,onLoad:l,onError:d,crossOrigin:f,sizes:y,ignoreFallback:v}=n,[b,w]=D.useState("pending");D.useEffect(()=>{w(s?"loading":"pending")},[s]);const I=D.useRef(null),k=D.useCallback(()=>{if(!s)return;L();const V=new Image;V.src=s,f&&(V.crossOrigin=f),a&&(V.srcset=a),y&&(V.sizes=y),t&&(V.loading=t),V.onload=B=>{L(),w("loaded"),l==null||l(B)},V.onerror=B=>{L(),w("failed"),d==null||d(B)},I.current=V},[s,f,a,y,l,d,t]),L=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return Kh(()=>{if(!v)return b==="loading"&&k(),()=>{L()}},[b,k,v]),v?"loaded":b}const z1e=(n,t)=>n!=="loaded"&&t==="beforeLoadOrError"||n==="failed"&&t==="onError";function vte(n){const{src:t,srcSet:s,onError:a,onLoad:l,getInitials:d,name:f,borderRadius:y,loading:v,iconLabel:b,icon:w=C.jsx(yte,{}),ignoreFallback:I,referrerPolicy:k,crossOrigin:L}=n,B=Ete({src:t,onError:a,crossOrigin:L,ignoreFallback:I})==="loaded";return!t||!B?f?C.jsx(_te,{className:"chakra-avatar__initials",getInitials:d,name:f}):D.cloneElement(w,{role:"img","aria-label":b}):C.jsx(Dt.img,{src:t,srcSet:s,alt:f??b,onLoad:l,referrerPolicy:k,crossOrigin:L??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:y}})}vte.displayName="AvatarImage";const G1e={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},sp=Wt((n,t)=>{const s=Za("Avatar",n),[a,l]=D.useState(!1),{src:d,srcSet:f,name:y,showBorder:v,borderRadius:b="full",onError:w,onLoad:I,getInitials:k=W1e,icon:L=C.jsx(yte,{}),iconLabel:V=" avatar",loading:B,children:W,borderColor:Q,ignoreFallback:$,crossOrigin:ie,referrerPolicy:ce,...ne}=Gi(n),de={borderRadius:b,borderWidth:v?"2px":void 0,...G1e,...s.container};return Q&&(de.borderColor=Q),C.jsx(Dt.span,{ref:t,...ne,className:pn("chakra-avatar",n.className),"data-loaded":er(a),__css:de,children:C.jsxs(j1e,{value:s,children:[C.jsx(vte,{src:d,srcSet:f,loading:B,onLoad:kn(I,()=>{l(!0)}),onError:w,getInitials:k,name:y,borderRadius:b,icon:L,iconLabel:V,ignoreFallback:$,crossOrigin:ie,referrerPolicy:ce}),W]})})});sp.displayName="Avatar";const vf=Wt(function(t,s){const a=ju("Badge",t),{className:l,...d}=Gi(t);return C.jsx(Dt.span,{ref:s,className:pn("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});vf.displayName="Badge";const St=Dt("div");St.displayName="Box";const[nze,H1e]=Oi({strict:!1,name:"ButtonGroupContext"});function Uw(n){const{children:t,className:s,...a}=n,l=D.isValidElement(t)?D.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=pn("chakra-button__icon",s);return C.jsx(Dt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}Uw.displayName="ButtonIcon";function $U(n){const{label:t,placement:s,spacing:a="0.5rem",children:l=C.jsx(cp,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:f,...y}=n,v=pn("chakra-button__spinner",d),b=s==="start"?"marginEnd":"marginStart",w=D.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[b]:t?a:0,fontSize:"1em",lineHeight:"normal",...f}),[f,t,b,a]);return C.jsx(Dt.div,{className:v,...y,__css:w,children:l})}$U.displayName="ButtonSpinner";function $1e(n){const[t,s]=D.useState(!n);return{ref:D.useCallback(d=>{d&&s(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const Lr=Wt((n,t)=>{const s=H1e(),a=ju("Button",{...s,...n}),{isDisabled:l=s==null?void 0:s.isDisabled,isLoading:d,isActive:f,children:y,leftIcon:v,rightIcon:b,loadingText:w,iconSpacing:I="0.5rem",type:k,spinner:L,spinnerPlacement:V="start",className:B,as:W,shouldWrapChildren:Q,...$}=Gi(n),ie=D.useMemo(()=>{const Y={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!s&&{_focus:Y}}},[a,s]),{ref:ce,type:ne}=$1e(W),de={rightIcon:b,leftIcon:v,iconSpacing:I,children:y,shouldWrapChildren:Q};return C.jsxs(Dt.button,{disabled:l||d,ref:wEe(t,ce),as:W,type:k??ne,"data-active":er(f),"data-loading":er(d),__css:ie,className:pn("chakra-button",B),...$,children:[d&&V==="start"&&C.jsx($U,{className:"chakra-button__spinner--start",label:w,placement:"start",spacing:I,children:L}),d?w||C.jsx(Dt.span,{opacity:0,children:C.jsx(mY,{...de})}):C.jsx(mY,{...de}),d&&V==="end"&&C.jsx($U,{className:"chakra-button__spinner--end",label:w,placement:"end",spacing:I,children:L})]})});Lr.displayName="Button";function mY(n){const{leftIcon:t,rightIcon:s,children:a,iconSpacing:l,shouldWrapChildren:d}=n;return d?C.jsxs("span",{style:{display:"contents"},children:[t&&C.jsx(Uw,{marginEnd:l,children:t}),a,s&&C.jsx(Uw,{marginStart:l,children:s})]}):C.jsxs(C.Fragment,{children:[t&&C.jsx(Uw,{marginEnd:l,children:t}),a,s&&C.jsx(Uw,{marginStart:l,children:s})]})}const Fo=Wt((n,t)=>{const{icon:s,children:a,isRound:l,"aria-label":d,...f}=n,y=s||a,v=D.isValidElement(y)?D.cloneElement(y,{"aria-hidden":!0,focusable:!1}):null;return C.jsx(Lr,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...f,children:v})});Fo.displayName="IconButton";const Ste=Dt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Ste.displayName="Center";const K1e={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Wt(function(t,s){const{axis:a="both",...l}=t;return C.jsx(Dt.div,{ref:s,__css:K1e[a],...l,position:"absolute"})});var q1e=()=>typeof document<"u",gY=!1,XC=null,Dy=!1,KU=!1,qU=new Set;function cj(n,t){qU.forEach(s=>s(n,t))}var Y1e=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function X1e(n){return!(n.metaKey||!Y1e&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function _Y(n){Dy=!0,X1e(n)&&(XC="keyboard",cj("keyboard",n))}function mS(n){if(XC="pointer",n.type==="mousedown"||n.type==="pointerdown"){Dy=!0;const t=n.composedPath?n.composedPath()[0]:n.target;let s=!1;try{s=t.matches(":focus-visible")}catch{}if(s)return;cj("pointer",n)}}function J1e(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function Q1e(n){J1e(n)&&(Dy=!0,XC="virtual")}function Z1e(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!Dy&&!KU&&(XC="virtual",cj("virtual",n)),Dy=!1,KU=!1)}function eNe(){Dy=!1,KU=!0}function yY(){return XC!=="pointer"}function tNe(){if(!q1e()||gY)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...s){Dy=!0,n.apply(this,s)},document.addEventListener("keydown",_Y,!0),document.addEventListener("keyup",_Y,!0),document.addEventListener("click",Q1e,!0),window.addEventListener("focus",Z1e,!0),window.addEventListener("blur",eNe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",mS,!0),document.addEventListener("pointermove",mS,!0),document.addEventListener("pointerup",mS,!0)):(document.addEventListener("mousedown",mS,!0),document.addEventListener("mousemove",mS,!0),document.addEventListener("mouseup",mS,!0)),gY=!0}function nNe(n){tNe(),n(yY());const t=()=>n(yY());return qU.add(t),()=>{qU.delete(t)}}const[rNe,bte]=Oi({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[iNe,V0]=Oi({strict:!1,name:"FormControlContext"});function sNe(n){const{id:t,isRequired:s,isInvalid:a,isDisabled:l,isReadOnly:d,...f}=n,y=D.useId(),v=t||`field-${y}`,b=`${v}-label`,w=`${v}-feedback`,I=`${v}-helptext`,[k,L]=D.useState(!1),[V,B]=D.useState(!1),[W,Q]=D.useState(!1),$=D.useCallback((Y={},X=null)=>({id:I,...Y,ref:Vi(X,Z=>{Z&&B(!0)})}),[I]),ie=D.useCallback((Y={},X=null)=>({...Y,ref:X,"data-focus":er(W),"data-disabled":er(l),"data-invalid":er(a),"data-readonly":er(d),id:Y.id!==void 0?Y.id:b,htmlFor:Y.htmlFor!==void 0?Y.htmlFor:v}),[v,l,W,a,d,b]),ce=D.useCallback((Y={},X=null)=>({id:w,...Y,ref:Vi(X,Z=>{Z&&L(!0)}),"aria-live":"polite"}),[w]),ne=D.useCallback((Y={},X=null)=>({...Y,...f,ref:X,role:"group","data-focus":er(W),"data-disabled":er(l),"data-invalid":er(a),"data-readonly":er(d)}),[f,l,W,a,d]),de=D.useCallback((Y={},X=null)=>({...Y,ref:X,role:"presentation","aria-hidden":!0,children:Y.children||"*"}),[]);return{isRequired:!!s,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!W,onFocus:()=>Q(!0),onBlur:()=>Q(!1),hasFeedbackText:k,setHasFeedbackText:L,hasHelpText:V,setHasHelpText:B,id:v,labelId:b,feedbackId:w,helpTextId:I,htmlProps:f,getHelpTextProps:$,getErrorMessageProps:ce,getRootProps:ne,getLabelProps:ie,getRequiredIndicatorProps:de}}const hi=Wt(function(t,s){const a=Za("Form",t),l=Gi(t),{getRootProps:d,htmlProps:f,...y}=sNe(l),v=pn("chakra-form-control",t.className);return C.jsx(iNe,{value:y,children:C.jsx(rNe,{value:a,children:C.jsx(Dt.div,{...d({},s),className:v,__css:a.container})})})});hi.displayName="FormControl";const JS=Wt(function(t,s){const a=V0(),l=bte(),d=pn("chakra-form__helper-text",t.className);return C.jsx(Dt.div,{...a==null?void 0:a.getHelpTextProps(t,s),__css:l.helperText,className:d})});JS.displayName="FormHelperText";function lj(n){const{isDisabled:t,isInvalid:s,isReadOnly:a,isRequired:l,...d}=uj(n);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":Cf(s),"aria-required":Cf(l),"aria-readonly":Cf(a)}}function uj(n){const t=V0(),{id:s,disabled:a,readOnly:l,required:d,isRequired:f,isInvalid:y,isReadOnly:v,isDisabled:b,onFocus:w,onBlur:I,...k}=n,L=n["aria-describedby"]?[n["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&L.push(t.feedbackId),t!=null&&t.hasHelpText&&L.push(t.helpTextId),{...k,"aria-describedby":L.join(" ")||void 0,id:s??(t==null?void 0:t.id),isDisabled:a??b??(t==null?void 0:t.isDisabled),isReadOnly:l??v??(t==null?void 0:t.isReadOnly),isRequired:d??f??(t==null?void 0:t.isRequired),isInvalid:y??(t==null?void 0:t.isInvalid),onFocus:kn(t==null?void 0:t.onFocus,w),onBlur:kn(t==null?void 0:t.onBlur,I)}}const oNe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function aNe(n={}){const t=uj(n),{isDisabled:s,isReadOnly:a,isRequired:l,isInvalid:d,id:f,onBlur:y,onFocus:v,"aria-describedby":b}=t,{defaultChecked:w,isChecked:I,isFocusable:k,onChange:L,isIndeterminate:V,name:B,value:W,tabIndex:Q=void 0,"aria-label":$,"aria-labelledby":ie,"aria-invalid":ce,...ne}=n,de=N0(ne,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Y=Gs(L),X=Gs(y),Z=Gs(v),[se,me]=D.useState(!1),[pe,ue]=D.useState(!1),[Le,We]=D.useState(!1),[$e,ve]=D.useState(!1);D.useEffect(()=>nNe(me),[]);const _e=D.useRef(null),[Ee,ke]=D.useState(!0),[Te,be]=D.useState(!!w),Pe=I!==void 0,xe=Pe?I:Te,ze=D.useCallback(Yt=>{if(a||s){Yt.preventDefault();return}Pe||be(xe?Yt.currentTarget.checked:V?!0:Yt.currentTarget.checked),Y==null||Y(Yt)},[a,s,xe,Pe,V,Y]);Kh(()=>{_e.current&&(_e.current.indeterminate=!!V)},[V]),xf(()=>{s&&ue(!1)},[s,ue]),Kh(()=>{const Yt=_e.current;if(!(Yt!=null&&Yt.form))return;const Vn=()=>{be(!!w)};return Yt.form.addEventListener("reset",Vn),()=>{var $t;return($t=Yt.form)==null?void 0:$t.removeEventListener("reset",Vn)}},[]);const Je=s&&!k,Ze=D.useCallback(Yt=>{Yt.key===" "&&ve(!0)},[ve]),lt=D.useCallback(Yt=>{Yt.key===" "&&ve(!1)},[ve]);Kh(()=>{if(!_e.current)return;_e.current.checked!==xe&&be(_e.current.checked)},[_e.current]);const nt=D.useCallback((Yt={},Vn=null)=>{const $t=Re=>{pe&&Re.preventDefault(),ve(!0)};return{...Yt,ref:Vn,"data-active":er($e),"data-hover":er(Le),"data-checked":er(xe),"data-focus":er(pe),"data-focus-visible":er(pe&&se),"data-indeterminate":er(V),"data-disabled":er(s),"data-invalid":er(d),"data-readonly":er(a),"aria-hidden":!0,onMouseDown:kn(Yt.onMouseDown,$t),onMouseUp:kn(Yt.onMouseUp,()=>ve(!1)),onMouseEnter:kn(Yt.onMouseEnter,()=>We(!0)),onMouseLeave:kn(Yt.onMouseLeave,()=>We(!1))}},[$e,xe,s,pe,se,Le,V,d,a]),Rt=D.useCallback((Yt={},Vn=null)=>({...Yt,ref:Vn,"data-active":er($e),"data-hover":er(Le),"data-checked":er(xe),"data-focus":er(pe),"data-focus-visible":er(pe&&se),"data-indeterminate":er(V),"data-disabled":er(s),"data-invalid":er(d),"data-readonly":er(a)}),[$e,xe,s,pe,se,Le,V,d,a]),fn=D.useCallback((Yt={},Vn=null)=>({...de,htmlFor:Ee?f:void 0,...Yt,ref:Vi(Vn,$t=>{$t&&ke($t.tagName==="LABEL")}),onClick:kn(Yt.onClick,()=>{var $t;Ee||(($t=_e.current)==null||$t.click(),requestAnimationFrame(()=>{var Re;(Re=_e.current)==null||Re.focus({preventScroll:!0})}))}),"data-disabled":er(s),"data-checked":er(xe),"data-invalid":er(d)}),[de,s,xe,d,Ee,f]),Ft=D.useCallback((Yt={},Vn=null)=>({...Yt,ref:Vi(_e,Vn),type:"checkbox",name:B,value:W,id:f,tabIndex:Q,onChange:kn(Yt.onChange,ze),onBlur:kn(Yt.onBlur,X,()=>ue(!1)),onFocus:kn(Yt.onFocus,Z,()=>ue(!0)),onKeyDown:kn(Yt.onKeyDown,Ze),onKeyUp:kn(Yt.onKeyUp,lt),required:l,checked:xe,disabled:Je,readOnly:a,"aria-label":$,"aria-labelledby":ie,"aria-invalid":ce?!!ce:d,"aria-describedby":b,"aria-disabled":s,"aria-checked":V?"mixed":xe,style:oNe}),[B,W,f,Q,ze,X,Z,Ze,lt,l,xe,Je,a,$,ie,ce,d,b,s,V]),on=D.useCallback((Yt={},Vn=null)=>({...Yt,ref:Vn,onMouseDown:kn(Yt.onMouseDown,cNe),"data-disabled":er(s),"data-checked":er(xe),"data-invalid":er(d)}),[xe,s,d]);return{state:{isInvalid:d,isFocused:pe,isChecked:xe,isActive:$e,isHovered:Le,isIndeterminate:V,isDisabled:s,isReadOnly:a,isRequired:l},getRootProps:fn,getCheckboxProps:nt,getIndicatorProps:Rt,getInputProps:Ft,getLabelProps:on,htmlProps:de}}function cNe(n){n.preventDefault(),n.stopPropagation()}const gg=Wt(function(t,s){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:f,borderWidth:y,borderStyle:v,borderColor:b,...w}=ju("Divider",t),{className:I,orientation:k="horizontal",__css:L,...V}=Gi(t),B={vertical:{borderLeftWidth:a||f||y||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||y||"1px",width:"100%"}};return C.jsx(Dt.hr,{ref:s,"aria-orientation":k,...V,__css:{...w,border:"0",borderColor:b,borderStyle:v,...B[k],...L},className:pn("chakra-divider",I)})});gg.displayName="Divider";const Wi=Wt(function(t,s){const{direction:a,align:l,justify:d,wrap:f,basis:y,grow:v,shrink:b,...w}=t,I={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:f,flexBasis:y,flexGrow:v,flexShrink:b};return C.jsx(Dt.div,{ref:s,__css:I,...w})});Wi.displayName="Flex";function lNe(n,t){if(n==null)return{};var s={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(t.indexOf(a)!==-1)continue;s[a]=n[a]}return s}var kM={exports:{}},NM,EY;function uNe(){if(EY)return NM;EY=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return NM=n,NM}var DM,vY;function dNe(){if(vY)return DM;vY=1;var n=uNe();function t(){}function s(){}return s.resetWarningCache=t,DM=function(){function a(f,y,v,b,w,I){if(I!==n){var k=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw k.name="Invariant Violation",k}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:t};return d.PropTypes=d,d},DM}var SY;function hNe(){return SY||(SY=1,kM.exports=dNe()()),kM.exports}var pNe=hNe();const vn=Ng(pNe);var YU="data-focus-lock",Tte="data-focus-lock-disabled",fNe="data-no-focus-lock",mNe="data-autofocus-inside",gNe="data-no-autofocus";function xM(n,t){return typeof n=="function"?n(t):n&&(n.current=t),n}function _Ne(n,t){var s=D.useState(function(){return{value:n,callback:t,facade:{get current(){return s.value},set current(a){var l=s.value;l!==a&&(s.value=a,s.callback(a,l))}}}})[0];return s.callback=t,s.facade}var yNe=typeof window<"u"?D.useLayoutEffect:D.useEffect,bY=new WeakMap;function wte(n,t){var s=_Ne(null,function(a){return n.forEach(function(l){return xM(l,a)})});return yNe(function(){var a=bY.get(s);if(a){var l=new Set(a),d=new Set(n),f=s.current;l.forEach(function(y){d.has(y)||xM(y,null)}),d.forEach(function(y){l.has(y)||xM(y,f)})}bY.set(s,n)},[n]),s}var LM={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Bh=function(){return Bh=Object.assign||function(t){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(t[d]=s[d])}return t},Bh.apply(this,arguments)};function JC(n,t){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(s[a[l]]=n[a[l]]);return s}function ENe(n,t,s){if(s||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return n.concat(d||Array.prototype.slice.call(t))}function Cte(n){return n}function Rte(n,t){t===void 0&&(t=Cte);var s=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:n},useMedium:function(d){var f=t(d,a);return s.push(f),function(){s=s.filter(function(y){return y!==f})}},assignSyncMedium:function(d){for(a=!0;s.length;){var f=s;s=[],f.forEach(d)}s={push:function(y){return d(y)},filter:function(){return s}}},assignMedium:function(d){a=!0;var f=[];if(s.length){var y=s;s=[],y.forEach(d),f=s}var v=function(){var w=f;f=[],w.forEach(d)},b=function(){return Promise.resolve().then(v)};b(),s={push:function(w){f.push(w),b()},filter:function(w){return f=f.filter(w),s}}}};return l}function dj(n,t){return t===void 0&&(t=Cte),Rte(n,t)}function Ite(n){n===void 0&&(n={});var t=Rte(null);return t.options=Bh({async:!0,ssr:!1},n),t}var Ate=function(n){var t=n.sideCar,s=JC(n,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return D.createElement(a,Bh({},s))};Ate.isSideCarExport=!0;function vNe(n,t){return n.useMedium(t),Ate}var Pte=dj({},function(n){var t=n.target,s=n.currentTarget;return{target:t,currentTarget:s}}),Ote=dj(),SNe=dj(),bNe=Ite({async:!0,ssr:typeof document<"u"}),TNe=D.createContext(void 0),wNe=[],hj=D.forwardRef(function(t,s){var a,l=D.useState(),d=l[0],f=l[1],y=D.useRef(),v=D.useRef(!1),b=D.useRef(null),w=D.useState({}),I=w[1],k=t.children,L=t.disabled,V=L===void 0?!1:L,B=t.noFocusGuards,W=B===void 0?!1:B,Q=t.persistentFocus,$=Q===void 0?!1:Q,ie=t.crossFrame,ce=ie===void 0?!0:ie,ne=t.autoFocus,de=ne===void 0?!0:ne;t.allowTextSelection;var Y=t.group,X=t.className,Z=t.whiteList,se=t.hasPositiveIndices,me=t.shards,pe=me===void 0?wNe:me,ue=t.as,Le=ue===void 0?"div":ue,We=t.lockProps,$e=We===void 0?{}:We,ve=t.sideCar,_e=t.returnFocus,Ee=_e===void 0?!1:_e,ke=t.focusOptions,Te=t.onActivation,be=t.onDeactivation,Pe=D.useState({}),xe=Pe[0],ze=D.useCallback(function(Vn){var $t=Vn.captureFocusRestore;if(!b.current){var Re,Ve=(Re=document)==null?void 0:Re.activeElement;b.current=Ve,Ve!==document.body&&(b.current=$t(Ve))}y.current&&Te&&Te(y.current),v.current=!0,I()},[Te]),Je=D.useCallback(function(){v.current=!1,be&&be(y.current),I()},[be]),Ze=D.useCallback(function(Vn){var $t=b.current;if($t){var Re=(typeof $t=="function"?$t():$t)||document.body,Ve=typeof Ee=="function"?Ee(Re):Ee;if(Ve){var Ge=typeof Ve=="object"?Ve:void 0;b.current=null,Vn?Promise.resolve().then(function(){return Re.focus(Ge)}):Re.focus(Ge)}}},[Ee]),lt=D.useCallback(function(Vn){v.current&&Pte.useMedium(Vn)},[]),nt=Ote.useMedium,Rt=D.useCallback(function(Vn){y.current!==Vn&&(y.current=Vn,f(Vn))},[]),fn=Ny((a={},a[Tte]=V&&"disabled",a[YU]=Y,a),$e),Ft=W!==!0,on=Ft&&W!=="tail",Zt=wte([s,Rt]),Yt=D.useMemo(function(){return{observed:y,shards:pe,enabled:!V,active:v.current}},[V,v.current,pe,d]);return di.createElement(D.Fragment,null,Ft&&[di.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:V?-1:0,style:LM}),se?di.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:V?-1:1,style:LM}):null],!V&&di.createElement(ve,{id:xe,sideCar:bNe,observed:d,disabled:V,persistentFocus:$,crossFrame:ce,autoFocus:de,whiteList:Z,shards:pe,onActivation:ze,onDeactivation:Je,returnFocus:Ze,focusOptions:ke,noFocusGuards:W}),di.createElement(Le,Ny({ref:Zt},fn,{className:X,onBlur:nt,onFocus:lt}),di.createElement(TNe.Provider,{value:Yt},k)),on&&di.createElement("div",{"data-focus-guard":!0,tabIndex:V?-1:0,style:LM}))});hj.propTypes={};function XU(n,t){return XU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},XU(n,t)}function CNe(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,XU(n,t)}function CC(n){"@babel/helpers - typeof";return CC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},CC(n)}function RNe(n,t){if(CC(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var a=s.call(n,t);if(CC(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function INe(n){var t=RNe(n,"string");return CC(t)=="symbol"?t:t+""}function ANe(n,t,s){return(t=INe(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function PNe(n,t){function s(a){return a.displayName||a.name||"Component"}return function(l){var d=[],f;function y(){f=n(d.map(function(b){return b.props})),t(f)}var v=function(b){CNe(w,b);function w(){return b.apply(this,arguments)||this}w.peek=function(){return f};var I=w.prototype;return I.componentDidMount=function(){d.push(this),y()},I.componentDidUpdate=function(){y()},I.componentWillUnmount=function(){var L=d.indexOf(this);d.splice(L,1),y()},I.render=function(){return di.createElement(l,this.props)},w}(D.PureComponent);return ANe(v,"displayName","SideEffect("+s(l)+")"),v}}var lp=function(n){for(var t=Array(n.length),s=0;s<n.length;++s)t[s]=n[s];return t},xy=function(n){return Array.isArray(n)?n:[n]},kte=function(n){return Array.isArray(n)?n[0]:n},ONe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(n,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},Nte=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Dte=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},kNe=function(n){return n.hasAttribute("inert")},NNe=function(n,t){return!n||Dte(n)||!ONe(n)&&!kNe(n)&&t(Nte(n))},xte=function(n,t){var s=n.get(t);if(s!==void 0)return s;var a=NNe(t,xte.bind(void 0,n));return n.set(t,a),a},DNe=function(n,t){return n&&!Dte(n)?MNe(n)?t(Nte(n)):!1:!0},Lte=function(n,t){var s=n.get(t);if(s!==void 0)return s;var a=DNe(t,Lte.bind(void 0,n));return n.set(t,a),a},Mte=function(n){return n.dataset},xNe=function(n){return n.tagName==="BUTTON"},Ute=function(n){return n.tagName==="INPUT"},Vte=function(n){return Ute(n)&&n.type==="radio"},LNe=function(n){return!((Ute(n)||xNe(n))&&(n.type==="hidden"||n.disabled))},MNe=function(n){var t=n.getAttribute(gNe);return![!0,"true",""].includes(t)},pj=function(n){var t;return!!(n&&(!((t=Mte(n))===null||t===void 0)&&t.focusGuard))},JU=function(n){return!pj(n)},UNe=function(n){return!!n},VNe=function(n,t){var s=Math.max(0,n.tabIndex),a=Math.max(0,t.tabIndex),l=s-a,d=n.index-t.index;if(l){if(!s)return 1;if(!a)return-1}return l||d},FNe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},fj=function(n,t,s){return lp(n).map(function(a,l){var d=FNe(a);return{node:a,index:l,tabIndex:s&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(VNe)},jNe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],mj=jNe.join(","),BNe="".concat(mj,", [data-focus-guard]"),Fte=function(n,t){return lp((n.shadowRoot||n).children).reduce(function(s,a){return s.concat(a.matches(t?BNe:mj)?[a]:[],Fte(a))},[])},WNe=function(n,t){var s;return n instanceof HTMLIFrameElement&&(!((s=n.contentDocument)===null||s===void 0)&&s.body)?f0([n.contentDocument.body],t):[n]},f0=function(n,t){return n.reduce(function(s,a){var l,d=Fte(a,t),f=(l=[]).concat.apply(l,d.map(function(y){return WNe(y,t)}));return s.concat(f,a.parentNode?lp(a.parentNode.querySelectorAll(mj)).filter(function(y){return y===a}):[])},[])},zNe=function(n){var t=n.querySelectorAll("[".concat(mNe,"]"));return lp(t).map(function(s){return f0([s])}).reduce(function(s,a){return s.concat(a)},[])},gj=function(n,t){return lp(n).filter(function(s){return xte(t,s)}).filter(function(s){return LNe(s)})},TY=function(n,t){return t===void 0&&(t=new Map),lp(n).filter(function(s){return Lte(t,s)})},_j=function(n,t,s){return fj(gj(f0(n,s),t),!0,s)},RC=function(n,t){return fj(gj(f0(n),t),!1)},GNe=function(n,t){return gj(zNe(n),t)},Ry=function(n,t){return n.shadowRoot?Ry(n.shadowRoot,t):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,t)?!0:lp(n.children).some(function(s){var a;if(s instanceof HTMLIFrameElement){var l=(a=s.contentDocument)===null||a===void 0?void 0:a.body;return l?Ry(l,t):!1}return Ry(s,t)})},HNe=function(n){for(var t=new Set,s=n.length,a=0;a<s;a+=1)for(var l=a+1;l<s;l+=1){var d=n[a].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return n.filter(function(f,y){return!t.has(y)})},jte=function(n){return n.parentNode?jte(n.parentNode):n},yj=function(n){var t=xy(n);return t.filter(Boolean).reduce(function(s,a){var l=a.getAttribute(YU);return s.push.apply(s,l?HNe(lp(jte(a).querySelectorAll("[".concat(YU,'="').concat(l,'"]:not([').concat(Tte,'="disabled"])')))):[a]),s},[])},$Ne=function(n){try{return n()}catch{return}},IC=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var t=n.activeElement;return t.shadowRoot?IC(t.shadowRoot):t instanceof HTMLIFrameElement&&$Ne(function(){return t.contentWindow.document})?IC(t.contentWindow.document):t}},KNe=function(n,t){return n===t},qNe=function(n,t){return!!lp(n.querySelectorAll("iframe")).some(function(s){return KNe(s,t)})},Bte=function(n,t){return t===void 0&&(t=IC(kte(n).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:yj(n).some(function(s){return Ry(s,t)||qNe(s,t)})},YNe=function(n){n===void 0&&(n=document);var t=IC(n);return t?lp(n.querySelectorAll("[".concat(fNe,"]"))).some(function(s){return Ry(s,t)}):!1},XNe=function(n,t){return t.filter(Vte).filter(function(s){return s.name===n.name}).filter(function(s){return s.checked})[0]||n},Ej=function(n,t){return Vte(n)&&n.name?XNe(n,t):n},JNe=function(n){var t=new Set;return n.forEach(function(s){return t.add(Ej(s,n))}),n.filter(function(s){return t.has(s)})},wY=function(n){return n[0]&&n.length>1?Ej(n[0],n):n[0]},CY=function(n,t){return n.indexOf(Ej(t,n))},QU="NEW_FOCUS",QNe=function(n,t,s,a,l){var d=n.length,f=n[0],y=n[d-1],v=pj(a);if(!(a&&n.indexOf(a)>=0)){var b=a!==void 0?s.indexOf(a):-1,w=l?s.indexOf(l):b,I=l?n.indexOf(l):-1;if(b===-1)return I!==-1?I:QU;if(I===-1)return QU;var k=b-w,L=s.indexOf(f),V=s.indexOf(y),B=JNe(s),W=a!==void 0?B.indexOf(a):-1,Q=l?B.indexOf(l):W,$=B.filter(function(X){return X.tabIndex>=0}),ie=a!==void 0?$.indexOf(a):-1,ce=l?$.indexOf(l):ie,ne=ie>=0&&ce>=0?ce-ie:Q-W;if(!k&&I>=0||t.length===0)return I;var de=CY(n,t[0]),Y=CY(n,t[t.length-1]);if(b<=L&&v&&Math.abs(k)>1)return Y;if(b>=V&&v&&Math.abs(k)>1)return de;if(k&&Math.abs(ne)>1)return I;if(b<=L)return Y;if(b>V)return de;if(k)return Math.abs(k)>1?I:(d+I+k)%d}},ZNe=function(n){return function(t){var s,a=(s=Mte(t))===null||s===void 0?void 0:s.autofocus;return t.autofocus||a!==void 0&&a!=="false"||n.indexOf(t)>=0}},RY=function(n,t,s){var a=n.map(function(d){var f=d.node;return f}),l=TY(a.filter(ZNe(s)));return l&&l.length?wY(l):wY(TY(t))},ZU=function(n,t){return t===void 0&&(t=[]),t.push(n),n.parentNode&&ZU(n.parentNode.host||n.parentNode,t),t},MM=function(n,t){for(var s=ZU(n),a=ZU(t),l=0;l<s.length;l+=1){var d=s[l];if(a.indexOf(d)>=0)return d}return!1},Wte=function(n,t,s){var a=xy(n),l=xy(t),d=a[0],f=!1;return l.filter(Boolean).forEach(function(y){f=MM(f||y,y)||f,s.filter(Boolean).forEach(function(v){var b=MM(d,v);b&&(!f||Ry(b,f)?f=b:f=MM(b,f))})}),f},IY=function(n,t){return n.reduce(function(s,a){return s.concat(GNe(a,t))},[])},eDe=function(n,t){var s=new Map;return t.forEach(function(a){return s.set(a.node,a)}),n.map(function(a){return s.get(a)}).filter(UNe)},tDe=function(n,t){var s=IC(xy(n).length>0?document:kte(n).ownerDocument),a=yj(n).filter(JU),l=Wte(s||n,n,a),d=new Map,f=RC(a,d),y=f.filter(function(V){var B=V.node;return JU(B)});if(y[0]){var v=RC([l],d).map(function(V){var B=V.node;return B}),b=eDe(v,y),w=b.map(function(V){var B=V.node;return B}),I=b.filter(function(V){var B=V.tabIndex;return B>=0}).map(function(V){var B=V.node;return B}),k=QNe(w,I,v,s,t);if(k===QU){var L=RY(f,I,IY(a,d))||RY(f,w,IY(a,d));if(L)return{node:L};console.warn("focus-lock: cannot find any node to move focus into");return}return k===void 0?k:b[k]}},nDe=function(n){var t=yj(n).filter(JU),s=Wte(n,n,t),a=fj(f0([s],!0),!0,!0),l=f0(t,!1);return a.map(function(d){var f=d.node,y=d.index;return{node:f,index:y,lockItem:l.indexOf(f)>=0,guard:pj(f)}})},vj=function(n,t){n&&("focus"in n&&n.focus(t),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},UM=0,VM=!1,zte=function(n,t,s){s===void 0&&(s={});var a=tDe(n,t);if(!VM&&a){if(UM>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),VM=!0,setTimeout(function(){VM=!1},1);return}UM++,vj(a.node,s.focusOptions),UM--}};function fw(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var t=n?new WeakRef(n):null;return function(){return(t==null?void 0:t.deref())||null}}var rDe=function(n){if(!n)return null;for(var t=[],s=n;s&&s!==document.body;)t.push({current:fw(s),parent:fw(s.parentElement),left:fw(s.previousElementSibling),right:fw(s.nextElementSibling)}),s=s.parentElement;return{element:fw(n),stack:t,ownerDocument:n.ownerDocument}},iDe=function(n){var t,s,a,l,d;if(n)for(var f=n.stack,y=n.ownerDocument,v=new Map,b=0,w=f;b<w.length;b++){var I=w[b],k=(t=I.parent)===null||t===void 0?void 0:t.call(I);if(k&&y.contains(k)){for(var L=(s=I.left)===null||s===void 0?void 0:s.call(I),V=I.current(),B=k.contains(V)?V:void 0,W=(a=I.right)===null||a===void 0?void 0:a.call(I),Q=_j([k],v),$=(d=(l=B??(L==null?void 0:L.nextElementSibling))!==null&&l!==void 0?l:W)!==null&&d!==void 0?d:L;$;){for(var ie=0,ce=Q;ie<ce.length;ie++){var ne=ce[ie];if($!=null&&$.contains(ne.node))return ne.node}$=$.nextElementSibling}if(Q.length)return Q[0].node}}},Gte=function(n){var t=rDe(n);return function(){return iDe(t)}},sDe=function(n,t,s){if(!n||!t)return console.error("no element or scope given"),{};var a=xy(t);if(a.every(function(f){return!Ry(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=s?_j(a,new Map):RC(a,new Map),d=l.findIndex(function(f){var y=f.node;return y===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},oDe=function(n,t){var s=t?_j(xy(n),new Map):RC(xy(n),new Map);return{first:s[0],last:s[s.length-1]}},aDe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},Hte=function(n,t,s){t===void 0&&(t={});var a=aDe(t),l=sDe(n,a.scope,a.onlyTabbable);if(l){var d=s(l,a.cycle);d&&vj(d.node,a.focusOptions)}},cDe=function(n,t){t===void 0&&(t={}),Hte(n,t,function(s,a){var l=s.next,d=s.first;return l||a&&d})},lDe=function(n,t){t===void 0&&(t={}),Hte(n,t,function(s,a){var l=s.prev,d=s.last;return l||a&&d})},$te=function(n,t,s){var a,l=oDe(n,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[s];d&&vj(d.node,t.focusOptions)},uDe=function(n,t){t===void 0&&(t={}),$te(n,t,"first")},dDe=function(n,t){t===void 0&&(t={}),$te(n,t,"last")};function Sj(n){setTimeout(n,1)}var hDe=function(t){return t&&"current"in t?t.current:t},Kte=function(){return document&&document.activeElement===document.body},pDe=function(){return Kte()||YNe()},QS=null,rl=null,AY=function(){return null},ZS=null,AC=!1,bj=!1,fDe=function(){return!0},mDe=function(t){return(QS.whiteList||fDe)(t)},gDe=function(t,s){ZS={observerNode:t,portaledElement:s}},_De=function(t){return ZS&&ZS.portaledElement===t};function PY(n,t,s,a){var l=null,d=n;do{var f=a[d];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(d!==n)return;l=null}else break}while((d+=s)!==t);l&&(l.node.tabIndex=0)}var yDe=function(t){return t?!!AC:AC==="meanwhile"},EDe=function n(t,s,a){return s&&(s.host===t&&(!s.activeElement||a.contains(s.activeElement))||s.parentNode&&n(t,s.parentNode,a))},vDe=function(t,s){return s.some(function(a){return EDe(t,a,a)})},qte=function(t){return RC(t,new Map)},SDe=function(t){return!qte([t.parentNode]).some(function(s){return s.node===t})},Ok=function(){var t=!1;if(QS){var s=QS,a=s.observed,l=s.persistentFocus,d=s.autoFocus,f=s.shards,y=s.crossFrame,v=s.focusOptions,b=s.noFocusGuards,w=a||ZS&&ZS.portaledElement;if(Kte()&&rl&&rl!==document.body&&(!document.body.contains(rl)||SDe(rl))){var I=AY();I&&I.focus()}var k=document&&document.activeElement;if(w){var L=[w].concat(f.map(hDe).filter(Boolean)),V=function(){if(!yDe(y)||!b||!rl||bj)return!1;var ie=qte(L),ce=ie.findIndex(function(ne){var de=ne.node;return de===rl});return ce===0||ce===ie.length-1};if((!k||mDe(k))&&(l||V()||!pDe()||!rl&&d)&&(w&&!(Bte(L)||k&&vDe(k,L)||_De(k))&&(document&&!rl&&k&&!d?(k.blur&&k.blur(),document.body.focus()):(t=zte(L,rl,{focusOptions:v}),ZS={})),rl=document&&document.activeElement,rl!==document.body&&(AY=Gte(rl)),AC=!1),document&&k!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var B=document&&document.activeElement,W=nDe(L),Q=W.map(function($){var ie=$.node;return ie}).indexOf(B);Q>-1&&(W.filter(function($){var ie=$.guard,ce=$.node;return ie&&ce.dataset.focusAutoGuard}).forEach(function($){var ie=$.node;return ie.removeAttribute("tabIndex")}),PY(Q,W.length,1,W),PY(Q,-1,-1,W))}}}return t},Yte=function(t){Ok()&&t&&(t.stopPropagation(),t.preventDefault())},Tj=function(){return Sj(Ok)},bDe=function(t){var s=t.target,a=t.currentTarget;a.contains(s)||gDe(a,s)},TDe=function(){return null},Xte=function(){bj=!0},Jte=function(){bj=!1,AC="just",Sj(function(){AC="meanwhile"})},wDe=function(){document.addEventListener("focusin",Yte),document.addEventListener("focusout",Tj),window.addEventListener("focus",Xte),window.addEventListener("blur",Jte)},CDe=function(){document.removeEventListener("focusin",Yte),document.removeEventListener("focusout",Tj),window.removeEventListener("focus",Xte),window.removeEventListener("blur",Jte)};function RDe(n){return n.filter(function(t){var s=t.disabled;return!s})}var Qte={moveFocusInside:zte,focusInside:Bte,focusNextElement:cDe,focusPrevElement:lDe,focusFirstElement:uDe,focusLastElement:dDe,captureFocusRestore:Gte};function IDe(n){var t=n.slice(-1)[0];t&&!QS&&wDe();var s=QS,a=s&&t&&t.id===s.id;QS=t,s&&!a&&(s.onDeactivation(),n.filter(function(l){var d=l.id;return d===s.id}).length||s.returnFocus(!t)),t?(rl=null,(!a||s.observed!==t.observed)&&t.onActivation(Qte),Ok(),Sj(Ok)):(CDe(),rl=null)}Pte.assignSyncMedium(bDe);Ote.assignMedium(Tj);SNe.assignMedium(function(n){return n(Qte)});const ADe=PNe(RDe,IDe)(TDe);var eV=D.forwardRef(function(t,s){return di.createElement(hj,Ny({sideCar:ADe,ref:s},t))}),Zte=hj.propTypes||{};Zte.sideCar;lNe(Zte,["sideCar"]);eV.propTypes={};const PDe=eV.default??eV,ene=n=>{const{initialFocusRef:t,finalFocusRef:s,contentRef:a,restoreFocus:l,children:d,isDisabled:f,autoFocus:y,persistentFocus:v,lockFocusAcrossFrames:b}=n,w=D.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&VQ(a.current).length===0&&requestAnimationFrame(()=>{var V;(V=a.current)==null||V.focus()})},[t,a]),I=D.useCallback(()=>{var L;(L=s==null?void 0:s.current)==null||L.focus()},[s]),k=l&&!s;return C.jsx(PDe,{crossFrame:b,persistentFocus:v,autoFocus:y,disabled:f,onActivation:w,onDeactivation:I,returnFocus:k,children:d})};ene.displayName="FocusLock";const[ODe,kDe]=Oi({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Fh=Wt((n,t)=>{const s=Za("FormError",n),a=Gi(n),l=V0();return l!=null&&l.isInvalid?C.jsx(ODe,{value:s,children:C.jsx(Dt.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:pn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...s.text}})}):null});Fh.displayName="FormErrorMessage";const NDe=Wt((n,t)=>{const s=kDe(),a=V0();if(!(a!=null&&a.isInvalid))return null;const l=pn("chakra-form__error-icon",n.className);return C.jsx(yn,{ref:t,"aria-hidden":!0,...n,__css:s.icon,className:l,children:C.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});NDe.displayName="FormErrorIcon";const Zs=Wt(function(t,s){const a=ju("FormLabel",t),l=Gi(t),{className:d,children:f,requiredIndicator:y=C.jsx(tne,{}),optionalIndicator:v=null,...b}=l,w=V0(),I=(w==null?void 0:w.getLabelProps(b,s))??{ref:s,...b};return C.jsxs(Dt.label,{...I,className:pn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[f,w!=null&&w.isRequired?y:v]})});Zs.displayName="FormLabel";const tne=Wt(function(t,s){const a=V0(),l=bte();if(!(a!=null&&a.isRequired))return null;const d=pn("chakra-form__required-indicator",t.className);return C.jsx(Dt.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,s),__css:l.requiredIndicator,className:d})});tne.displayName="RequiredIndicator";const nne=Wt(function(t,s){const{templateAreas:a,gap:l,rowGap:d,columnGap:f,column:y,row:v,autoFlow:b,autoRows:w,templateRows:I,autoColumns:k,templateColumns:L,...V}=t,B={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:f,gridAutoColumns:k,gridColumn:y,gridRow:v,gridAutoFlow:b,gridAutoRows:w,gridTemplateRows:I,gridTemplateColumns:L};return C.jsx(Dt.div,{ref:s,__css:B,...V})});nne.displayName="Grid";const rne=Wt(function(t,s){const{columns:a,spacingX:l,spacingY:d,spacing:f,minChildWidth:y,...v}=t,b=U0(),w=y?xDe(y,b):LDe(a);return C.jsx(nne,{ref:s,gap:f,columnGap:l,rowGap:d,templateColumns:w,...v})});rne.displayName="SimpleGrid";function DDe(n){return typeof n=="number"?`${n}px`:n}function xDe(n,t){return iF(n,s=>{const a=p1e("sizes",s,DDe(s))(t);return s===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function LDe(n){return iF(n,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function xg(n){const{viewBox:t="0 0 24 24",d:s,displayName:a,defaultProps:l={}}=n,d=D.Children.toArray(n.path),f=Wt((y,v)=>C.jsx(yn,{ref:v,viewBox:t,...l,...y,children:d.length?d:C.jsx("path",{fill:"currentColor",d:s})}));return f.displayName=a,f}const tV=Wt(function(t,s){const{htmlWidth:a,htmlHeight:l,alt:d,...f}=t;return C.jsx("img",{width:a,height:l,ref:s,alt:d,...f})});tV.displayName="NativeImage";const Gh=Wt(function(t,s){const{fallbackSrc:a,fallback:l,src:d,srcSet:f,align:y,fit:v,loading:b,ignoreFallback:w,crossOrigin:I,fallbackStrategy:k="beforeLoadOrError",referrerPolicy:L,...V}=t,B=a!==void 0||l!==void 0,W=b!=null||w||!B,Q=Ete({...t,crossOrigin:I,ignoreFallback:W}),$=z1e(Q,k),ie={ref:s,objectFit:v,objectPosition:y,...W?V:N0(V,["onError","onLoad"])};return $?l||C.jsx(Dt.img,{as:tV,className:"chakra-image__placeholder",src:a,...ie}):C.jsx(Dt.img,{as:tV,src:d,srcSet:f,crossOrigin:I,loading:b,referrerPolicy:L,className:"chakra-image",...ie})});Gh.displayName="Image";const es=Wt(function(t,s){const{htmlSize:a,...l}=t,d=Za("Input",l),f=Gi(l),y=lj(f),v=pn("chakra-input",t.className);return C.jsx(Dt.input,{size:a,...y,__css:d.field,ref:s,className:v})});es.displayName="Input";es.id="Input";const[MDe,ine]=Oi({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),Iy=Wt(function(t,s){const a=Za("Input",t),{children:l,className:d,...f}=Gi(t),y=pn("chakra-input__group",d),v={},b=tF(l),w=a.field;b.forEach(k=>{a&&(w&&k.type.id==="InputLeftElement"&&(v.paddingStart=w.height??w.h),w&&k.type.id==="InputRightElement"&&(v.paddingEnd=w.height??w.h),k.type.id==="InputRightAddon"&&(v.borderEndRadius=0),k.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const I=b.map(k=>{var V,B;const L=a1({size:((V=k.props)==null?void 0:V.size)||t.size,variant:((B=k.props)==null?void 0:B.variant)||t.variant});return k.type.id!=="Input"?D.cloneElement(k,L):D.cloneElement(k,Object.assign(L,v,k.props))});return C.jsx(Dt.div,{className:y,ref:s,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...f,children:C.jsx(MDe,{value:a,children:I})})});Iy.displayName="InputGroup";const UDe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},VDe=Dt("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),wj=Wt(function(t,s){const{placement:a="left",...l}=t,d=UDe[a]??{},f=ine();return C.jsx(VDe,{ref:s,...l,__css:{...f.addon,...d}})});wj.displayName="InputAddon";const Cj=Wt(function(t,s){return C.jsx(wj,{ref:s,placement:"left",...t,className:pn("chakra-input__left-addon",t.className)})});Cj.displayName="InputLeftAddon";Cj.id="InputLeftAddon";const sne=Wt(function(t,s){return C.jsx(wj,{ref:s,placement:"right",...t,className:pn("chakra-input__right-addon",t.className)})});sne.displayName="InputRightAddon";sne.id="InputRightAddon";const FDe=Dt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),T1=Wt(function(t,s){const{placement:a="left",...l}=t,d=ine(),f=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...d.element};return C.jsx(FDe,{ref:s,__css:v,...l})});T1.id="InputElement";T1.displayName="InputElement";const rC=Wt(function(t,s){const{className:a,...l}=t,d=pn("chakra-input__left-element",a);return C.jsx(T1,{ref:s,placement:"left",className:d,...l})});rC.id="InputLeftElement";rC.displayName="InputLeftElement";const kk=Wt(function(t,s){const{className:a,...l}=t,d=pn("chakra-input__right-element",a);return C.jsx(T1,{ref:s,placement:"right",className:d,...l})});kk.id="InputRightElement";kk.displayName="InputRightElement";const Ul=Wt(function(t,s){const a=ju("Link",t),{className:l,isExternal:d,...f}=Gi(t);return C.jsx(Dt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:s,className:pn("chakra-link",l),...f,__css:a})});Ul.displayName="Link";function jDe(n,t={}){const{ssr:s=!0,fallback:a}=t,{getWindow:l}=gIe(),d=Array.isArray(n)?n:[n];let f=Array.isArray(a)?a:[a];f=f.filter(b=>b!=null);const[y,v]=D.useState(()=>d.map((b,w)=>({media:b,matches:s?!!f[w]:l().matchMedia(b).matches})));return D.useEffect(()=>{const b=l();v(d.map(k=>({media:k,matches:b.matchMedia(k).matches})));const w=d.map(k=>b.matchMedia(k)),I=k=>{v(L=>L.slice().map(V=>V.media===k.media?{...V,matches:k.matches}:V))};return w.forEach(k=>{typeof k.addListener=="function"?k.addListener(I):k.addEventListener("change",I)}),()=>{w.forEach(k=>{typeof k.removeListener=="function"?k.removeListener(I):k.removeEventListener("change",I)})}},[l]),y.map(b=>b.matches)}function BDe(n,t,s,a){if(t==null)return a;if(!a)return n.find(f=>s(f).toLowerCase().startsWith(t.toLowerCase()));const l=n.filter(d=>s(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return a}function WDe(n){const{key:t}=n;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function zDe(n={}){const{timeout:t=300,preventDefault:s=()=>!0}=n,[a,l]=D.useState([]),d=D.useRef(void 0),f=()=>{d.current&&(clearTimeout(d.current),d.current=null)},y=()=>{f(),d.current=setTimeout(()=>{l([]),d.current=null},t)};D.useEffect(()=>f,[]);function v(b){return w=>{if(w.key==="Backspace"){const I=[...a];I.pop(),l(I);return}if(WDe(w)){const I=a.concat(w.key);s(w)&&(w.preventDefault(),w.stopPropagation()),l(I),b(I.join("")),y()}}}return v}var ll="top",Uu="bottom",Vu="right",ul="left",Rj="auto",QC=[ll,Uu,Vu,ul],m0="start",PC="end",GDe="clippingParents",one="viewport",mw="popper",HDe="reference",OY=QC.reduce(function(n,t){return n.concat([t+"-"+m0,t+"-"+PC])},[]),ane=[].concat(QC,[Rj]).reduce(function(n,t){return n.concat([t,t+"-"+m0,t+"-"+PC])},[]),$De="beforeRead",KDe="read",qDe="afterRead",YDe="beforeMain",XDe="main",JDe="afterMain",QDe="beforeWrite",ZDe="write",exe="afterWrite",txe=[$De,KDe,qDe,YDe,XDe,JDe,QDe,ZDe,exe];function op(n){return n?(n.nodeName||"").toLowerCase():null}function Gl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var t=n.ownerDocument;return t&&t.defaultView||window}return n}function Ly(n){var t=Gl(n).Element;return n instanceof t||n instanceof Element}function xu(n){var t=Gl(n).HTMLElement;return n instanceof t||n instanceof HTMLElement}function Ij(n){if(typeof ShadowRoot>"u")return!1;var t=Gl(n).ShadowRoot;return n instanceof t||n instanceof ShadowRoot}function nxe(n){var t=n.state;Object.keys(t.elements).forEach(function(s){var a=t.styles[s]||{},l=t.attributes[s]||{},d=t.elements[s];!xu(d)||!op(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(f){var y=l[f];y===!1?d.removeAttribute(f):d.setAttribute(f,y===!0?"":y)}))})}function rxe(n){var t=n.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},f=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:s[a]),y=f.reduce(function(v,b){return v[b]="",v},{});!xu(l)||!op(l)||(Object.assign(l.style,y),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const ixe={name:"applyStyles",enabled:!0,phase:"write",fn:nxe,effect:rxe,requires:["computeStyles"]};function Qh(n){return n.split("-")[0]}var Ay=Math.max,Nk=Math.min,g0=Math.round;function nV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function cne(){return!/^((?!chrome|android).)*safari/i.test(nV())}function _0(n,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var a=n.getBoundingClientRect(),l=1,d=1;t&&xu(n)&&(l=n.offsetWidth>0&&g0(a.width)/n.offsetWidth||1,d=n.offsetHeight>0&&g0(a.height)/n.offsetHeight||1);var f=Ly(n)?Gl(n):window,y=f.visualViewport,v=!cne()&&s,b=(a.left+(v&&y?y.offsetLeft:0))/l,w=(a.top+(v&&y?y.offsetTop:0))/d,I=a.width/l,k=a.height/d;return{width:I,height:k,top:w,right:b+I,bottom:w+k,left:b,x:b,y:w}}function Aj(n){var t=_0(n),s=n.offsetWidth,a=n.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:n.offsetLeft,y:n.offsetTop,width:s,height:a}}function lne(n,t){var s=t.getRootNode&&t.getRootNode();if(n.contains(t))return!0;if(s&&Ij(s)){var a=t;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Uf(n){return Gl(n).getComputedStyle(n)}function sxe(n){return["table","td","th"].indexOf(op(n))>=0}function Lg(n){return((Ly(n)?n.ownerDocument:n.document)||window.document).documentElement}function w1(n){return op(n)==="html"?n:n.assignedSlot||n.parentNode||(Ij(n)?n.host:null)||Lg(n)}function kY(n){return!xu(n)||Uf(n).position==="fixed"?null:n.offsetParent}function oxe(n){var t=/firefox/i.test(nV()),s=/Trident/i.test(nV());if(s&&xu(n)){var a=Uf(n);if(a.position==="fixed")return null}var l=w1(n);for(Ij(l)&&(l=l.host);xu(l)&&["html","body"].indexOf(op(l))<0;){var d=Uf(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function ZC(n){for(var t=Gl(n),s=kY(n);s&&sxe(s)&&Uf(s).position==="static";)s=kY(s);return s&&(op(s)==="html"||op(s)==="body"&&Uf(s).position==="static")?t:s||oxe(n)||t}function Pj(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function iC(n,t,s){return Ay(n,Nk(t,s))}function axe(n,t,s){var a=iC(n,t,s);return a>s?s:a}function une(){return{top:0,right:0,bottom:0,left:0}}function dne(n){return Object.assign({},une(),n)}function hne(n,t){return t.reduce(function(s,a){return s[a]=n,s},{})}var cxe=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,dne(typeof t!="number"?t:hne(t,QC))};function lxe(n){var t,s=n.state,a=n.name,l=n.options,d=s.elements.arrow,f=s.modifiersData.popperOffsets,y=Qh(s.placement),v=Pj(y),b=[ul,Vu].indexOf(y)>=0,w=b?"height":"width";if(!(!d||!f)){var I=cxe(l.padding,s),k=Aj(d),L=v==="y"?ll:ul,V=v==="y"?Uu:Vu,B=s.rects.reference[w]+s.rects.reference[v]-f[v]-s.rects.popper[w],W=f[v]-s.rects.reference[v],Q=ZC(d),$=Q?v==="y"?Q.clientHeight||0:Q.clientWidth||0:0,ie=B/2-W/2,ce=I[L],ne=$-k[w]-I[V],de=$/2-k[w]/2+ie,Y=iC(ce,de,ne),X=v;s.modifiersData[a]=(t={},t[X]=Y,t.centerOffset=Y-de,t)}}function uxe(n){var t=n.state,s=n.options,a=s.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||lne(t.elements.popper,l)&&(t.elements.arrow=l))}const dxe={name:"arrow",enabled:!0,phase:"main",fn:lxe,effect:uxe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function y0(n){return n.split("-")[1]}var hxe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function pxe(n,t){var s=n.x,a=n.y,l=t.devicePixelRatio||1;return{x:g0(s*l)/l||0,y:g0(a*l)/l||0}}function NY(n){var t,s=n.popper,a=n.popperRect,l=n.placement,d=n.variation,f=n.offsets,y=n.position,v=n.gpuAcceleration,b=n.adaptive,w=n.roundOffsets,I=n.isFixed,k=f.x,L=k===void 0?0:k,V=f.y,B=V===void 0?0:V,W=typeof w=="function"?w({x:L,y:B}):{x:L,y:B};L=W.x,B=W.y;var Q=f.hasOwnProperty("x"),$=f.hasOwnProperty("y"),ie=ul,ce=ll,ne=window;if(b){var de=ZC(s),Y="clientHeight",X="clientWidth";if(de===Gl(s)&&(de=Lg(s),Uf(de).position!=="static"&&y==="absolute"&&(Y="scrollHeight",X="scrollWidth")),de=de,l===ll||(l===ul||l===Vu)&&d===PC){ce=Uu;var Z=I&&de===ne&&ne.visualViewport?ne.visualViewport.height:de[Y];B-=Z-a.height,B*=v?1:-1}if(l===ul||(l===ll||l===Uu)&&d===PC){ie=Vu;var se=I&&de===ne&&ne.visualViewport?ne.visualViewport.width:de[X];L-=se-a.width,L*=v?1:-1}}var me=Object.assign({position:y},b&&hxe),pe=w===!0?pxe({x:L,y:B},Gl(s)):{x:L,y:B};if(L=pe.x,B=pe.y,v){var ue;return Object.assign({},me,(ue={},ue[ce]=$?"0":"",ue[ie]=Q?"0":"",ue.transform=(ne.devicePixelRatio||1)<=1?"translate("+L+"px, "+B+"px)":"translate3d("+L+"px, "+B+"px, 0)",ue))}return Object.assign({},me,(t={},t[ce]=$?B+"px":"",t[ie]=Q?L+"px":"",t.transform="",t))}function fxe(n){var t=n.state,s=n.options,a=s.gpuAcceleration,l=a===void 0?!0:a,d=s.adaptive,f=d===void 0?!0:d,y=s.roundOffsets,v=y===void 0?!0:y,b={placement:Qh(t.placement),variation:y0(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,NY(Object.assign({},b,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:f,roundOffsets:v})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,NY(Object.assign({},b,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const mxe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:fxe,data:{}};var fO={passive:!0};function gxe(n){var t=n.state,s=n.instance,a=n.options,l=a.scroll,d=l===void 0?!0:l,f=a.resize,y=f===void 0?!0:f,v=Gl(t.elements.popper),b=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&b.forEach(function(w){w.addEventListener("scroll",s.update,fO)}),y&&v.addEventListener("resize",s.update,fO),function(){d&&b.forEach(function(w){w.removeEventListener("scroll",s.update,fO)}),y&&v.removeEventListener("resize",s.update,fO)}}const _xe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:gxe,data:{}};var yxe={left:"right",right:"left",bottom:"top",top:"bottom"};function qO(n){return n.replace(/left|right|bottom|top/g,function(t){return yxe[t]})}var Exe={start:"end",end:"start"};function DY(n){return n.replace(/start|end/g,function(t){return Exe[t]})}function Oj(n){var t=Gl(n),s=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:s,scrollTop:a}}function kj(n){return _0(Lg(n)).left+Oj(n).scrollLeft}function vxe(n,t){var s=Gl(n),a=Lg(n),l=s.visualViewport,d=a.clientWidth,f=a.clientHeight,y=0,v=0;if(l){d=l.width,f=l.height;var b=cne();(b||!b&&t==="fixed")&&(y=l.offsetLeft,v=l.offsetTop)}return{width:d,height:f,x:y+kj(n),y:v}}function Sxe(n){var t,s=Lg(n),a=Oj(n),l=(t=n.ownerDocument)==null?void 0:t.body,d=Ay(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=Ay(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),y=-a.scrollLeft+kj(n),v=-a.scrollTop;return Uf(l||s).direction==="rtl"&&(y+=Ay(s.clientWidth,l?l.clientWidth:0)-d),{width:d,height:f,x:y,y:v}}function Nj(n){var t=Uf(n),s=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+l+a)}function pne(n){return["html","body","#document"].indexOf(op(n))>=0?n.ownerDocument.body:xu(n)&&Nj(n)?n:pne(w1(n))}function sC(n,t){var s;t===void 0&&(t=[]);var a=pne(n),l=a===((s=n.ownerDocument)==null?void 0:s.body),d=Gl(a),f=l?[d].concat(d.visualViewport||[],Nj(a)?a:[]):a,y=t.concat(f);return l?y:y.concat(sC(w1(f)))}function rV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function bxe(n,t){var s=_0(n,!1,t==="fixed");return s.top=s.top+n.clientTop,s.left=s.left+n.clientLeft,s.bottom=s.top+n.clientHeight,s.right=s.left+n.clientWidth,s.width=n.clientWidth,s.height=n.clientHeight,s.x=s.left,s.y=s.top,s}function xY(n,t,s){return t===one?rV(vxe(n,s)):Ly(t)?bxe(t,s):rV(Sxe(Lg(n)))}function Txe(n){var t=sC(w1(n)),s=["absolute","fixed"].indexOf(Uf(n).position)>=0,a=s&&xu(n)?ZC(n):n;return Ly(a)?t.filter(function(l){return Ly(l)&&lne(l,a)&&op(l)!=="body"}):[]}function wxe(n,t,s,a){var l=t==="clippingParents"?Txe(n):[].concat(t),d=[].concat(l,[s]),f=d[0],y=d.reduce(function(v,b){var w=xY(n,b,a);return v.top=Ay(w.top,v.top),v.right=Nk(w.right,v.right),v.bottom=Nk(w.bottom,v.bottom),v.left=Ay(w.left,v.left),v},xY(n,f,a));return y.width=y.right-y.left,y.height=y.bottom-y.top,y.x=y.left,y.y=y.top,y}function fne(n){var t=n.reference,s=n.element,a=n.placement,l=a?Qh(a):null,d=a?y0(a):null,f=t.x+t.width/2-s.width/2,y=t.y+t.height/2-s.height/2,v;switch(l){case ll:v={x:f,y:t.y-s.height};break;case Uu:v={x:f,y:t.y+t.height};break;case Vu:v={x:t.x+t.width,y};break;case ul:v={x:t.x-s.width,y};break;default:v={x:t.x,y:t.y}}var b=l?Pj(l):null;if(b!=null){var w=b==="y"?"height":"width";switch(d){case m0:v[b]=v[b]-(t[w]/2-s[w]/2);break;case PC:v[b]=v[b]+(t[w]/2-s[w]/2);break}}return v}function OC(n,t){t===void 0&&(t={});var s=t,a=s.placement,l=a===void 0?n.placement:a,d=s.strategy,f=d===void 0?n.strategy:d,y=s.boundary,v=y===void 0?GDe:y,b=s.rootBoundary,w=b===void 0?one:b,I=s.elementContext,k=I===void 0?mw:I,L=s.altBoundary,V=L===void 0?!1:L,B=s.padding,W=B===void 0?0:B,Q=dne(typeof W!="number"?W:hne(W,QC)),$=k===mw?HDe:mw,ie=n.rects.popper,ce=n.elements[V?$:k],ne=wxe(Ly(ce)?ce:ce.contextElement||Lg(n.elements.popper),v,w,f),de=_0(n.elements.reference),Y=fne({reference:de,element:ie,placement:l}),X=rV(Object.assign({},ie,Y)),Z=k===mw?X:de,se={top:ne.top-Z.top+Q.top,bottom:Z.bottom-ne.bottom+Q.bottom,left:ne.left-Z.left+Q.left,right:Z.right-ne.right+Q.right},me=n.modifiersData.offset;if(k===mw&&me){var pe=me[l];Object.keys(se).forEach(function(ue){var Le=[Vu,Uu].indexOf(ue)>=0?1:-1,We=[ll,Uu].indexOf(ue)>=0?"y":"x";se[ue]+=pe[We]*Le})}return se}function Cxe(n,t){t===void 0&&(t={});var s=t,a=s.placement,l=s.boundary,d=s.rootBoundary,f=s.padding,y=s.flipVariations,v=s.allowedAutoPlacements,b=v===void 0?ane:v,w=y0(a),I=w?y?OY:OY.filter(function(V){return y0(V)===w}):QC,k=I.filter(function(V){return b.indexOf(V)>=0});k.length===0&&(k=I);var L=k.reduce(function(V,B){return V[B]=OC(n,{placement:B,boundary:l,rootBoundary:d,padding:f})[Qh(B)],V},{});return Object.keys(L).sort(function(V,B){return L[V]-L[B]})}function Rxe(n){if(Qh(n)===Rj)return[];var t=qO(n);return[DY(n),t,DY(t)]}function Ixe(n){var t=n.state,s=n.options,a=n.name;if(!t.modifiersData[a]._skip){for(var l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,y=f===void 0?!0:f,v=s.fallbackPlacements,b=s.padding,w=s.boundary,I=s.rootBoundary,k=s.altBoundary,L=s.flipVariations,V=L===void 0?!0:L,B=s.allowedAutoPlacements,W=t.options.placement,Q=Qh(W),$=Q===W,ie=v||($||!V?[qO(W)]:Rxe(W)),ce=[W].concat(ie).reduce(function(xe,ze){return xe.concat(Qh(ze)===Rj?Cxe(t,{placement:ze,boundary:w,rootBoundary:I,padding:b,flipVariations:V,allowedAutoPlacements:B}):ze)},[]),ne=t.rects.reference,de=t.rects.popper,Y=new Map,X=!0,Z=ce[0],se=0;se<ce.length;se++){var me=ce[se],pe=Qh(me),ue=y0(me)===m0,Le=[ll,Uu].indexOf(pe)>=0,We=Le?"width":"height",$e=OC(t,{placement:me,boundary:w,rootBoundary:I,altBoundary:k,padding:b}),ve=Le?ue?Vu:ul:ue?Uu:ll;ne[We]>de[We]&&(ve=qO(ve));var _e=qO(ve),Ee=[];if(d&&Ee.push($e[pe]<=0),y&&Ee.push($e[ve]<=0,$e[_e]<=0),Ee.every(function(xe){return xe})){Z=me,X=!1;break}Y.set(me,Ee)}if(X)for(var ke=V?3:1,Te=function(ze){var Je=ce.find(function(Ze){var lt=Y.get(Ze);if(lt)return lt.slice(0,ze).every(function(nt){return nt})});if(Je)return Z=Je,"break"},be=ke;be>0;be--){var Pe=Te(be);if(Pe==="break")break}t.placement!==Z&&(t.modifiersData[a]._skip=!0,t.placement=Z,t.reset=!0)}}const Axe={name:"flip",enabled:!0,phase:"main",fn:Ixe,requiresIfExists:["offset"],data:{_skip:!1}};function LY(n,t,s){return s===void 0&&(s={x:0,y:0}),{top:n.top-t.height-s.y,right:n.right-t.width+s.x,bottom:n.bottom-t.height+s.y,left:n.left-t.width-s.x}}function MY(n){return[ll,Vu,Uu,ul].some(function(t){return n[t]>=0})}function Pxe(n){var t=n.state,s=n.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,f=OC(t,{elementContext:"reference"}),y=OC(t,{altBoundary:!0}),v=LY(f,a),b=LY(y,l,d),w=MY(v),I=MY(b);t.modifiersData[s]={referenceClippingOffsets:v,popperEscapeOffsets:b,isReferenceHidden:w,hasPopperEscaped:I},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":I})}const Oxe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Pxe};function kxe(n,t,s){var a=Qh(n),l=[ul,ll].indexOf(a)>=0?-1:1,d=typeof s=="function"?s(Object.assign({},t,{placement:n})):s,f=d[0],y=d[1];return f=f||0,y=(y||0)*l,[ul,Vu].indexOf(a)>=0?{x:y,y:f}:{x:f,y}}function Nxe(n){var t=n.state,s=n.options,a=n.name,l=s.offset,d=l===void 0?[0,0]:l,f=ane.reduce(function(w,I){return w[I]=kxe(I,t.rects,d),w},{}),y=f[t.placement],v=y.x,b=y.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=v,t.modifiersData.popperOffsets.y+=b),t.modifiersData[a]=f}const Dxe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Nxe};function xxe(n){var t=n.state,s=n.name;t.modifiersData[s]=fne({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const Lxe={name:"popperOffsets",enabled:!0,phase:"read",fn:xxe,data:{}};function Mxe(n){return n==="x"?"y":"x"}function Uxe(n){var t=n.state,s=n.options,a=n.name,l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,y=f===void 0?!1:f,v=s.boundary,b=s.rootBoundary,w=s.altBoundary,I=s.padding,k=s.tether,L=k===void 0?!0:k,V=s.tetherOffset,B=V===void 0?0:V,W=OC(t,{boundary:v,rootBoundary:b,padding:I,altBoundary:w}),Q=Qh(t.placement),$=y0(t.placement),ie=!$,ce=Pj(Q),ne=Mxe(ce),de=t.modifiersData.popperOffsets,Y=t.rects.reference,X=t.rects.popper,Z=typeof B=="function"?B(Object.assign({},t.rects,{placement:t.placement})):B,se=typeof Z=="number"?{mainAxis:Z,altAxis:Z}:Object.assign({mainAxis:0,altAxis:0},Z),me=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,pe={x:0,y:0};if(de){if(d){var ue,Le=ce==="y"?ll:ul,We=ce==="y"?Uu:Vu,$e=ce==="y"?"height":"width",ve=de[ce],_e=ve+W[Le],Ee=ve-W[We],ke=L?-X[$e]/2:0,Te=$===m0?Y[$e]:X[$e],be=$===m0?-X[$e]:-Y[$e],Pe=t.elements.arrow,xe=L&&Pe?Aj(Pe):{width:0,height:0},ze=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:une(),Je=ze[Le],Ze=ze[We],lt=iC(0,Y[$e],xe[$e]),nt=ie?Y[$e]/2-ke-lt-Je-se.mainAxis:Te-lt-Je-se.mainAxis,Rt=ie?-Y[$e]/2+ke+lt+Ze+se.mainAxis:be+lt+Ze+se.mainAxis,fn=t.elements.arrow&&ZC(t.elements.arrow),Ft=fn?ce==="y"?fn.clientTop||0:fn.clientLeft||0:0,on=(ue=me==null?void 0:me[ce])!=null?ue:0,Zt=ve+nt-on-Ft,Yt=ve+Rt-on,Vn=iC(L?Nk(_e,Zt):_e,ve,L?Ay(Ee,Yt):Ee);de[ce]=Vn,pe[ce]=Vn-ve}if(y){var $t,Re=ce==="x"?ll:ul,Ve=ce==="x"?Uu:Vu,Ge=de[ne],ht=ne==="y"?"height":"width",mt=Ge+W[Re],vt=Ge-W[Ve],Bt=[ll,ul].indexOf(Q)!==-1,mn=($t=me==null?void 0:me[ne])!=null?$t:0,En=Bt?mt:Ge-Y[ht]-X[ht]-mn+se.altAxis,en=Bt?Ge+Y[ht]+X[ht]-mn-se.altAxis:vt,Et=L&&Bt?axe(En,Ge,en):iC(L?En:mt,Ge,L?en:vt);de[ne]=Et,pe[ne]=Et-Ge}t.modifiersData[a]=pe}}const Vxe={name:"preventOverflow",enabled:!0,phase:"main",fn:Uxe,requiresIfExists:["offset"]};function Fxe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function jxe(n){return n===Gl(n)||!xu(n)?Oj(n):Fxe(n)}function Bxe(n){var t=n.getBoundingClientRect(),s=g0(t.width)/n.offsetWidth||1,a=g0(t.height)/n.offsetHeight||1;return s!==1||a!==1}function Wxe(n,t,s){s===void 0&&(s=!1);var a=xu(t),l=xu(t)&&Bxe(t),d=Lg(t),f=_0(n,l,s),y={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!s)&&((op(t)!=="body"||Nj(d))&&(y=jxe(t)),xu(t)?(v=_0(t,!0),v.x+=t.clientLeft,v.y+=t.clientTop):d&&(v.x=kj(d))),{x:f.left+y.scrollLeft-v.x,y:f.top+y.scrollTop-v.y,width:f.width,height:f.height}}function zxe(n){var t=new Map,s=new Set,a=[];n.forEach(function(d){t.set(d.name,d)});function l(d){s.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(y){if(!s.has(y)){var v=t.get(y);v&&l(v)}}),a.push(d)}return n.forEach(function(d){s.has(d.name)||l(d)}),a}function Gxe(n){var t=zxe(n);return txe.reduce(function(s,a){return s.concat(t.filter(function(l){return l.phase===a}))},[])}function Hxe(n){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(n())})})),t}}function $xe(n){var t=n.reduce(function(s,a){var l=s[a.name];return s[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,s},{});return Object.keys(t).map(function(s){return t[s]})}var UY={placement:"bottom",modifiers:[],strategy:"absolute"};function VY(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function Kxe(n){n===void 0&&(n={});var t=n,s=t.defaultModifiers,a=s===void 0?[]:s,l=t.defaultOptions,d=l===void 0?UY:l;return function(y,v,b){b===void 0&&(b=d);var w={placement:"bottom",orderedModifiers:[],options:Object.assign({},UY,d),modifiersData:{},elements:{reference:y,popper:v},attributes:{},styles:{}},I=[],k=!1,L={state:w,setOptions:function(Q){var $=typeof Q=="function"?Q(w.options):Q;B(),w.options=Object.assign({},d,w.options,$),w.scrollParents={reference:Ly(y)?sC(y):y.contextElement?sC(y.contextElement):[],popper:sC(v)};var ie=Gxe($xe([].concat(a,w.options.modifiers)));return w.orderedModifiers=ie.filter(function(ce){return ce.enabled}),V(),L.update()},forceUpdate:function(){if(!k){var Q=w.elements,$=Q.reference,ie=Q.popper;if(VY($,ie)){w.rects={reference:Wxe($,ZC(ie),w.options.strategy==="fixed"),popper:Aj(ie)},w.reset=!1,w.placement=w.options.placement,w.orderedModifiers.forEach(function(se){return w.modifiersData[se.name]=Object.assign({},se.data)});for(var ce=0;ce<w.orderedModifiers.length;ce++){if(w.reset===!0){w.reset=!1,ce=-1;continue}var ne=w.orderedModifiers[ce],de=ne.fn,Y=ne.options,X=Y===void 0?{}:Y,Z=ne.name;typeof de=="function"&&(w=de({state:w,options:X,name:Z,instance:L})||w)}}}},update:Hxe(function(){return new Promise(function(W){L.forceUpdate(),W(w)})}),destroy:function(){B(),k=!0}};if(!VY(y,v))return L;L.setOptions(b).then(function(W){!k&&b.onFirstUpdate&&b.onFirstUpdate(W)});function V(){w.orderedModifiers.forEach(function(W){var Q=W.name,$=W.options,ie=$===void 0?{}:$,ce=W.effect;if(typeof ce=="function"){var ne=ce({state:w,name:Q,instance:L,options:ie}),de=function(){};I.push(ne||de)}})}function B(){I.forEach(function(W){return W()}),I=[]}return L}}var qxe=[_xe,Lxe,mxe,ixe,Dxe,Axe,Vxe,dxe,Oxe],Yxe=Kxe({defaultModifiers:qxe});const gS=(n,t)=>({var:n,varRef:t?`var(${n}, ${t})`:`var(${n})`}),no={arrowShadowColor:gS("--popper-arrow-shadow-color"),arrowSize:gS("--popper-arrow-size","8px"),arrowSizeHalf:gS("--popper-arrow-size-half"),arrowBg:gS("--popper-arrow-bg"),transformOrigin:gS("--popper-transform-origin"),arrowOffset:gS("--popper-arrow-offset")};function Xxe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const Jxe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},Qxe=n=>Jxe[n],FY={scroll:!0,resize:!0};function Zxe(n){let t;return typeof n=="object"?t={enabled:!0,options:{...FY,...n}}:t={enabled:n,options:FY},t}const eLe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const t=n.elements.reference;n.elements.popper.style.width=`${t.offsetWidth}px`}},tLe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{jY(n)},effect:({state:n})=>()=>{jY(n)}},jY=n=>{n.elements.popper.style.setProperty(no.transformOrigin.var,Qxe(n.placement))},nLe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{rLe(n)}},rLe=n=>{var s;if(!n.placement)return;const t=iLe(n.placement);if((s=n.elements)!=null&&s.arrow&&t){Object.assign(n.elements.arrow.style,{[t.property]:t.value,width:no.arrowSize.varRef,height:no.arrowSize.varRef,zIndex:-1});const a={[no.arrowSizeHalf.var]:`calc(${no.arrowSize.varRef} / 2 - 1px)`,[no.arrowOffset.var]:`calc(${no.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},iLe=n=>{if(n.startsWith("top"))return{property:"bottom",value:no.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:no.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:no.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:no.arrowOffset.varRef}},sLe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{BY(n)},effect:({state:n})=>()=>{BY(n)}},BY=n=>{if(!n.elements.arrow)return;const t=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const s=Xxe(n.placement);s&&t.style.setProperty("--popper-arrow-default-shadow",s),Object.assign(t.style,{transform:"rotate(45deg)",background:no.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},oLe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},aLe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function cLe(n,t="ltr"){var a;const s=((a=oLe[n])==null?void 0:a[t])||n;return t==="ltr"?s:aLe[n]??s}function Dj(n={}){const{enabled:t=!0,modifiers:s,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:f=!0,offset:y,gutter:v=8,flip:b=!0,boundary:w="clippingParents",preventOverflow:I=!0,matchWidth:k,direction:L="ltr"}=n,V=D.useRef(null),B=D.useRef(null),W=D.useRef(null),Q=cLe(a,L),$=D.useRef(()=>{}),ie=D.useCallback(()=>{var se;!t||!V.current||!B.current||((se=$.current)==null||se.call($),W.current=Yxe(V.current,B.current,{placement:Q,modifiers:[sLe,nLe,tLe,{...eLe,enabled:!!k},{name:"eventListeners",...Zxe(f)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:y??[0,v]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:w}},...s??[]],strategy:l}),W.current.forceUpdate(),$.current=W.current.destroy)},[Q,t,s,k,f,d,y,v,b,I,w,l]);D.useEffect(()=>()=>{var se;!V.current&&!B.current&&((se=W.current)==null||se.destroy(),W.current=null)},[]);const ce=D.useCallback(se=>{V.current=se,ie()},[ie]),ne=D.useCallback((se={},me=null)=>({...se,ref:Vi(ce,me)}),[ce]),de=D.useCallback(se=>{B.current=se,ie()},[ie]),Y=D.useCallback((se={},me=null)=>({...se,ref:Vi(de,me),style:{...se.style,position:l,minWidth:k?void 0:"max-content",inset:"0 auto auto 0"}}),[l,de,k]),X=D.useCallback((se={},me=null)=>{const{size:pe,shadowColor:ue,bg:Le,style:We,...$e}=se;return{...$e,ref:me,"data-popper-arrow":"",style:lLe(se)}},[]),Z=D.useCallback((se={},me=null)=>({...se,ref:me,"data-popper-arrow-inner":""}),[]);return{update(){var se;(se=W.current)==null||se.update()},forceUpdate(){var se;(se=W.current)==null||se.forceUpdate()},transformOrigin:no.transformOrigin.varRef,referenceRef:ce,popperRef:de,getPopperProps:Y,getArrowProps:X,getArrowInnerProps:Z,getReferenceProps:ne}}function lLe(n){const{size:t,shadowColor:s,bg:a,style:l}=n,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),s&&(d["--popper-arrow-shadow-color"]=s),a&&(d["--popper-arrow-bg"]=a),d}function uLe(){const n=D.useRef(new Map),t=n.current,s=D.useCallback((l,d,f,y)=>{n.current.set(f,{type:d,el:l,options:y}),l.addEventListener(d,f,y)},[]),a=D.useCallback((l,d,f,y)=>{l.removeEventListener(d,f,y),n.current.delete(f)},[]);return D.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:s,remove:a}}function FM(n){var l,d;const t=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:s,isContentEditable:a}=t;return s!=="INPUT"&&s!=="TEXTAREA"&&a!==!0}function mne(n={}){const{ref:t,isDisabled:s,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:f,onMouseUp:y,onClick:v,onKeyDown:b,onKeyUp:w,tabIndex:I,onMouseOver:k,onMouseLeave:L,...V}=n,[B,W]=D.useState(!0),[Q,$]=D.useState(!1),ie=uLe(),ce=ve=>{ve&&ve.tagName!=="BUTTON"&&W(!1)},ne=B?I:I||0,de=s&&!a,Y=D.useCallback(ve=>{if(s){ve.stopPropagation(),ve.preventDefault();return}ve.currentTarget.focus(),v==null||v(ve)},[s,v]),X=D.useCallback(ve=>{Q&&FM(ve)&&(ve.preventDefault(),ve.stopPropagation(),$(!1),ie.remove(document,"keyup",X,!1))},[Q,ie]),Z=D.useCallback(ve=>{if(b==null||b(ve),s||ve.defaultPrevented||ve.metaKey||!FM(ve.nativeEvent)||B)return;const _e=l&&ve.key==="Enter";d&&ve.key===" "&&(ve.preventDefault(),$(!0)),_e&&(ve.preventDefault(),ve.currentTarget.click()),ie.add(document,"keyup",X,!1)},[s,B,b,l,d,ie,X]),se=D.useCallback(ve=>{if(w==null||w(ve),s||ve.defaultPrevented||ve.metaKey||!FM(ve.nativeEvent)||B)return;d&&ve.key===" "&&(ve.preventDefault(),$(!1),ve.currentTarget.click())},[d,B,s,w]),me=D.useCallback(ve=>{ve.button===0&&($(!1),ie.remove(document,"mouseup",me,!1))},[ie]),pe=D.useCallback(ve=>{if(ve.button!==0)return;if(s){ve.stopPropagation(),ve.preventDefault();return}B||$(!0),ve.currentTarget.focus({preventScroll:!0}),ie.add(document,"mouseup",me,!1),f==null||f(ve)},[s,B,f,ie,me]),ue=D.useCallback(ve=>{ve.button===0&&(B||$(!1),y==null||y(ve))},[y,B]),Le=D.useCallback(ve=>{if(s){ve.preventDefault();return}k==null||k(ve)},[s,k]),We=D.useCallback(ve=>{Q&&(ve.preventDefault(),$(!1)),L==null||L(ve)},[Q,L]),$e=Vi(t,ce);return B?{...V,ref:$e,type:"button","aria-disabled":de?void 0:s,disabled:de,onClick:Y,onMouseDown:f,onMouseUp:y,onKeyUp:w,onKeyDown:b,onMouseOver:k,onMouseLeave:L}:{...V,ref:$e,role:"button","data-active":er(Q),"aria-disabled":s?"true":void 0,tabIndex:de?void 0:ne,onClick:Y,onMouseDown:pe,onMouseUp:ue,onKeyUp:se,onKeyDown:Z,onMouseOver:Le,onMouseLeave:We}}const[dLe,hLe,pLe,fLe]=gte(),[mLe,eR]=Oi({strict:!1,name:"MenuContext"});function gne(n){return(n==null?void 0:n.ownerDocument)??document}function gLe(n){return gne(n).activeElement===n}function _Le(n={}){const{id:t,closeOnSelect:s=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:f,isOpen:y,defaultIsOpen:v,onClose:b,onOpen:w,placement:I="bottom-start",lazyBehavior:k="unmount",direction:L,computePositionOnMount:V=!1,...B}=n,W=D.useRef(null),Q=D.useRef(null),$=D.useRef(!0),ie=pLe(),ce=D.useCallback(()=>{requestAnimationFrame(()=>{var Pe;(Pe=W.current)==null||Pe.focus({preventScroll:!1})})},[]),ne=D.useCallback(()=>{const Pe=setTimeout(()=>{var xe,ze;if(l)(xe=l.current)==null||xe.focus();else if(!ie.count())(ze=W.current)==null||ze.focus({preventScroll:!1});else{const Je=ie.firstEnabled();Je&&Le(Je.index)}});Ee.current.add(Pe)},[ie,l]),de=D.useCallback(()=>{const Pe=setTimeout(()=>{var xe;if(!ie.count())(xe=W.current)==null||xe.focus({preventScroll:!1});else{const ze=ie.lastEnabled();ze&&Le(ze.index)}});Ee.current.add(Pe)},[ie]),Y=D.useCallback(()=>{w==null||w(),d?ne():ce()},[d,ne,ce,w]),{isOpen:X,onOpen:Z,onClose:se,onToggle:me}=Df({isOpen:y,defaultIsOpen:v,onClose:b,onOpen:Y});qQ({enabled:X&&a,ref:W,handler:Pe=>{var ze,Je,Ze;const xe=((Je=(ze=Pe.composedPath)==null?void 0:ze.call(Pe))==null?void 0:Je[0])??Pe.target;(Ze=Q.current)!=null&&Ze.contains(xe)||se()}});const pe=Dj({...B,enabled:X||V,placement:I,direction:L}),[ue,Le]=D.useState(-1);HQ(W,{focusRef:Q,visible:X,shouldFocus:!0});const We=WQ({isOpen:X,ref:W}),[$e,ve]=SEe(t,"menu-button","menu-list"),_e=D.useCallback(()=>{Z(),ce()},[Z,ce]),Ee=D.useRef(new Set([]));D.useEffect(()=>{const Pe=Ee.current;return()=>{Pe.forEach(xe=>clearTimeout(xe)),Pe.clear()}},[]),xf(()=>{var Pe;X||(Le(-1),(Pe=W.current)==null||Pe.scrollTo(0,0))},[X]),xf(()=>{X&&ue===-1&&ce()},[ue,X]),D.useEffect(()=>{var xe;if(!X)return;const Pe=ie.item(ue);(xe=Pe==null?void 0:Pe.node)==null||xe.focus({preventScroll:!$.current})},[ie,ue,X]);const ke=D.useCallback(()=>{Z(),ne()},[ne,Z]),Te=D.useCallback(()=>{$.current=!0,Z(),de()},[Z,de]),be=D.useCallback(()=>{var Ze,lt;const Pe=gne(W.current),xe=(Ze=W.current)==null?void 0:Ze.contains(Pe.activeElement);if(!(X&&!xe))return;const Je=(lt=ie.item(ue))==null?void 0:lt.node;Je==null||Je.focus({preventScroll:!$.current})},[X,ue,ie]);return{openAndFocusMenu:_e,openAndFocusFirstItem:ke,openAndFocusLastItem:Te,onTransitionEnd:be,unstable__animationState:We,descendants:ie,popper:pe,buttonId:$e,menuId:ve,forceUpdate:pe.forceUpdate,orientation:"vertical",isOpen:X,onToggle:me,onOpen:Z,onClose:se,menuRef:W,buttonRef:Q,focusedIndex:ue,closeOnSelect:s,closeOnBlur:a,autoSelect:d,setFocusedIndex:Le,isLazy:f,lazyBehavior:k,initialFocusRef:l,scrollIntoViewRef:$}}function yLe(n={},t=null){const s=eR(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:f,scrollIntoViewRef:y}=s,v=D.useCallback(b=>{const w=b.key,k={Enter:d,ArrowDown:d,ArrowUp:f}[w];k&&(y.current=!0,b.preventDefault(),b.stopPropagation(),k(b))},[d,f,y]);return{...n,ref:Vi(s.buttonRef,t,l.referenceRef),id:s.buttonId,"data-active":er(s.isOpen),"aria-expanded":s.isOpen,"aria-haspopup":"menu","aria-controls":s.menuId,onClick:kn(n.onClick,a),onKeyDown:kn(n.onKeyDown,v)}}function iV(n){var t;return bLe(n)&&!!((t=n==null?void 0:n.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function ELe(n={},t=null){const s=eR();if(!s)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:f,onClose:y,menuId:v,isLazy:b,lazyBehavior:w,scrollIntoViewRef:I,unstable__animationState:k}=s,L=hLe(),V=zDe({preventDefault:$=>$.key!==" "&&iV($.target)}),B=D.useCallback($=>{if(!$.currentTarget.contains($.target))return;const ie=$.key,ne={Tab:Y=>Y.preventDefault(),Escape:Y=>{Y.stopPropagation(),y()},ArrowDown:()=>{I.current=!0;const Y=L.nextEnabled(a)??L.firstEnabled();Y&&l(Y.index)},ArrowUp:()=>{I.current=!0;const Y=L.prevEnabled(a)??L.firstEnabled();Y&&l(Y.index)}}[ie];if(ne){$.preventDefault(),ne($);return}const de=V(Y=>{const X=BDe(L.values(),Y,Z=>{var se;return((se=Z==null?void 0:Z.node)==null?void 0:se.textContent)??""},L.item(a));if(X){const Z=L.indexOf(X.node);l(Z)}});iV($.target)&&de($)},[L,a,V,y,l,I]),W=D.useRef(!1);f&&(W.current=!0);const Q=nF({wasSelected:W.current,enabled:b,mode:w,isSelected:k.present});return{...n,ref:Vi(d,t),children:Q?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:kn(n.onKeyDown,B)}}function vLe(n={}){const{popper:t,isOpen:s}=eR();return t.getPopperProps({...n,style:{visibility:s?"visible":"hidden",...n.style}})}function SLe(n={},t=null){const{onMouseEnter:s,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:f,isDisabled:y,isFocusable:v,closeOnSelect:b,type:w,...I}=n,k=eR(),{setFocusedIndex:L,focusedIndex:V,closeOnSelect:B,onClose:W,menuId:Q,scrollIntoViewRef:$}=k,ie=D.useRef(null),ce=`${Q}-menuitem-${D.useId()}`,{index:ne,register:de}=fLe({disabled:y&&!v}),Y=D.useCallback(Le=>{s==null||s(Le),!y&&($.current=!1,L(ne))},[L,ne,y,s,$]),X=D.useCallback(Le=>{a==null||a(Le),ie.current&&!gLe(ie.current)&&Y(Le)},[Y,a]),Z=D.useCallback(Le=>{l==null||l(Le),!y&&L(-1)},[L,y,l]),se=D.useCallback(Le=>{d==null||d(Le),iV(Le.currentTarget)&&(b??B)&&W()},[W,d,B,b]),me=D.useCallback(Le=>{f==null||f(Le),L(ne)},[L,f,ne]),pe=ne===V,ue=mne({onClick:se,onFocus:me,onMouseEnter:Y,onMouseMove:X,onMouseLeave:Z,ref:Vi(de,ie,t),isDisabled:y,isFocusable:v});return{...I,...ue,type:w??ue.type,id:ce,role:"menuitem",tabIndex:pe?0:-1}}function bLe(n){if(!TLe(n))return!1;const t=n.ownerDocument.defaultView??window;return n instanceof t.HTMLElement}function TLe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[wLe,F0]=Oi({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),C1=n=>{const{children:t}=n,s=Za("Menu",n),a=Gi(n),{direction:l}=U0(),{descendants:d,...f}=_Le({...a,direction:l}),y=D.useMemo(()=>f,[f]),{isOpen:v,onClose:b,forceUpdate:w}=y;return C.jsx(dLe,{value:d,children:C.jsx(mLe,{value:y,children:C.jsx(wLe,{value:s,children:cl(t,{isOpen:v,onClose:b,forceUpdate:w})})})})};C1.displayName="Menu";const CLe=Wt((n,t)=>{const s=F0();return C.jsx(Dt.button,{ref:t,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...s.button}})}),R1=Wt((n,t)=>{const{children:s,as:a,...l}=n,d=yLe(l,t),f=a||CLe;return C.jsx(f,{...d,className:pn("chakra-menu__menu-button",n.className),children:C.jsx(Dt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});R1.displayName="MenuButton";const _ne=Wt((n,t)=>{const s=F0();return C.jsx(Dt.span,{ref:t,...n,__css:s.command,className:"chakra-menu__command"})});_ne.displayName="MenuCommand";const yne=n=>{const{className:t,...s}=n,a=F0();return C.jsx(Dt.hr,{"aria-orientation":"horizontal",className:pn("chakra-menu__divider",t),...s,__css:a.divider})};yne.displayName="MenuDivider";const Ene=n=>{const{className:t,children:s,...a}=n,l=F0(),d=D.Children.only(s),f=D.isValidElement(d)?D.cloneElement(d,{focusable:"false","aria-hidden":!0,className:pn("chakra-menu__icon",d.props.className)}):null,y=pn("chakra-menu__icon-wrapper",t);return C.jsx(Dt.span,{className:y,...a,__css:l.icon,children:f})};Ene.displayName="MenuIcon";const RLe=Wt((n,t)=>{const{type:s,...a}=n,l=F0(),d=a.as||s?s??void 0:"button",f=D.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return C.jsx(Dt.button,{ref:t,type:d,...a,__css:f})}),e0=Wt((n,t)=>{const{icon:s,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:f,...y}=n,v=SLe(y,t),w=s||l?C.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return C.jsxs(RLe,{...v,className:pn("chakra-menu__menuitem",v.className),children:[s&&C.jsx(Ene,{fontSize:"0.8em",marginEnd:a,children:s}),w,l&&C.jsx(_ne,{marginStart:d,children:l})]})});e0.displayName="MenuItem";const ILe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},ALe=Dt(Gf.div),I1=Wt(function(t,s){var k;const{rootProps:a,motionProps:l,...d}=t,{isOpen:f,onTransitionEnd:y,unstable__animationState:v}=eR(),b=ELe(d,s),w=vLe(a),I=F0();return C.jsx(Dt.div,{...w,__css:{zIndex:t.zIndex??((k=I.list)==null?void 0:k.zIndex)},children:C.jsx(ALe,{variants:ILe,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...I.list},...l,...b,className:pn("chakra-menu__menu-list",b.className),onUpdate:y,onAnimationComplete:MQ(v.onComplete,b.onAnimationComplete)})})});I1.displayName="MenuList";var PLe=function(n){if(typeof document>"u")return null;var t=Array.isArray(n)?n[0]:n;return t.ownerDocument.body},_S=new WeakMap,mO=new WeakMap,gO={},jM=0,vne=function(n){return n&&(n.host||vne(n.parentNode))},OLe=function(n,t){return t.map(function(s){if(n.contains(s))return s;var a=vne(s);return a&&n.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",n,". Doing nothing"),null)}).filter(function(s){return!!s})},kLe=function(n,t,s,a){var l=OLe(t,Array.isArray(n)?n:[n]);gO[s]||(gO[s]=new WeakMap);var d=gO[s],f=[],y=new Set,v=new Set(l),b=function(I){!I||y.has(I)||(y.add(I),b(I.parentNode))};l.forEach(b);var w=function(I){!I||v.has(I)||Array.prototype.forEach.call(I.children,function(k){if(y.has(k))w(k);else try{var L=k.getAttribute(a),V=L!==null&&L!=="false",B=(_S.get(k)||0)+1,W=(d.get(k)||0)+1;_S.set(k,B),d.set(k,W),f.push(k),B===1&&V&&mO.set(k,!0),W===1&&k.setAttribute(s,"true"),V||k.setAttribute(a,"true")}catch(Q){console.error("aria-hidden: cannot operate on ",k,Q)}})};return w(t),y.clear(),jM++,function(){f.forEach(function(I){var k=_S.get(I)-1,L=d.get(I)-1;_S.set(I,k),d.set(I,L),k||(mO.has(I)||I.removeAttribute(a),mO.delete(I)),L||I.removeAttribute(s)}),jM--,jM||(_S=new WeakMap,_S=new WeakMap,mO=new WeakMap,gO={})}},NLe=function(n,t,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=PLe(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),kLe(a,l,s,"aria-hidden")):function(){return null}},DLe=Object.defineProperty,xLe=(n,t,s)=>t in n?DLe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,LLe=(n,t,s)=>(xLe(n,t+"",s),s);class MLe{constructor(){LLe(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const s=Array.from(this.modals)[this.modals.size-1];return t===s}}const sV=new MLe;function Sne(n,t){const[s,a]=D.useState(0);return D.useEffect(()=>{const l=n.current;if(l){if(t){const d=sV.add(l);a(d)}return()=>{sV.remove(l),a(0)}}},[t,n]),s}function ULe(n){const{isOpen:t,onClose:s,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:f=!0,onOverlayClick:y,onEsc:v}=n,b=D.useRef(null),w=D.useRef(null),[I,k,L]=FLe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");VLe(b,t&&f);const V=Sne(b,t),B=D.useRef(null),W=D.useCallback(Z=>{B.current=Z.target},[]),Q=D.useCallback(Z=>{Z.key==="Escape"&&(Z.stopPropagation(),d&&(s==null||s()),v==null||v())},[d,s,v]),[$,ie]=D.useState(!1),[ce,ne]=D.useState(!1),de=D.useCallback((Z={},se=null)=>({role:"dialog",...Z,ref:Vi(se,b),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":$?k:void 0,"aria-describedby":ce?L:void 0,onClick:kn(Z.onClick,me=>me.stopPropagation())}),[L,ce,I,k,$]),Y=D.useCallback(Z=>{Z.stopPropagation(),B.current===Z.target&&sV.isTopModal(b.current)&&(l&&(s==null||s()),y==null||y())},[s,l,y]),X=D.useCallback((Z={},se=null)=>({...Z,ref:Vi(se,w),onClick:kn(Z.onClick,Y),onKeyDown:kn(Z.onKeyDown,Q),onMouseDown:kn(Z.onMouseDown,W)}),[Q,W,Y]);return{isOpen:t,onClose:s,headerId:k,bodyId:L,setBodyMounted:ne,setHeaderMounted:ie,dialogRef:b,overlayRef:w,getDialogProps:de,getDialogContainerProps:X,index:V}}function VLe(n,t){const s=n.current;D.useEffect(()=>{if(!(!n.current||!t))return NLe(n.current)},[t,n,s])}function FLe(n,...t){const s=D.useId(),a=n||s;return D.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[jLe,j0]=Oi({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[BLe,My]=Oi({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),Bo=n=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:s,children:a,autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:I,motionPreset:k,lockFocusAcrossFrames:L,animatePresenceProps:V,onCloseComplete:B}=t,W=Za("Modal",t),$={...ULe(t),autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:I,motionPreset:k,lockFocusAcrossFrames:L};return C.jsx(BLe,{value:$,children:C.jsx(jLe,{value:W,children:C.jsx(x0,{...V,onExitComplete:B,children:$.isOpen&&C.jsx(Bu,{...s,children:a})})})})};Bo.displayName="Modal";var YO="right-scroll-bar-position",XO="width-before-scroll-bar",WLe="with-scroll-bars-hidden",zLe="--removed-body-scroll-bar-size",bne=Ite(),BM=function(){},A1=D.forwardRef(function(n,t){var s=D.useRef(null),a=D.useState({onScrollCapture:BM,onWheelCapture:BM,onTouchMoveCapture:BM}),l=a[0],d=a[1],f=n.forwardProps,y=n.children,v=n.className,b=n.removeScrollBar,w=n.enabled,I=n.shards,k=n.sideCar,L=n.noIsolation,V=n.inert,B=n.allowPinchZoom,W=n.as,Q=W===void 0?"div":W,$=n.gapMode,ie=JC(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ce=k,ne=wte([s,t]),de=Bh(Bh({},ie),l);return D.createElement(D.Fragment,null,w&&D.createElement(ce,{sideCar:bne,removeScrollBar:b,shards:I,noIsolation:L,inert:V,setCallbacks:d,allowPinchZoom:!!B,lockRef:s,gapMode:$}),f?D.cloneElement(D.Children.only(y),Bh(Bh({},de),{ref:ne})):D.createElement(Q,Bh({},de,{className:v,ref:ne}),y))});A1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};A1.classNames={fullWidth:XO,zeroRight:YO};var GLe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function HLe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var t=GLe();return t&&n.setAttribute("nonce",t),n}function $Le(n,t){n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}function KLe(n){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(n)}var qLe=function(){var n=0,t=null;return{add:function(s){n==0&&(t=HLe())&&($Le(t,s),KLe(t)),n++},remove:function(){n--,!n&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},YLe=function(){var n=qLe();return function(t,s){D.useEffect(function(){return n.add(t),function(){n.remove()}},[t&&s])}},Tne=function(){var n=YLe(),t=function(s){var a=s.styles,l=s.dynamic;return n(a,l),null};return t},XLe={left:0,top:0,right:0,gap:0},WM=function(n){return parseInt(n||"",10)||0},JLe=function(n){var t=window.getComputedStyle(document.body),s=t[n==="padding"?"paddingLeft":"marginLeft"],a=t[n==="padding"?"paddingTop":"marginTop"],l=t[n==="padding"?"paddingRight":"marginRight"];return[WM(s),WM(a),WM(l)]},QLe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return XLe;var t=JLe(n),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-s+t[2]-t[0])}},ZLe=Tne(),t0="data-scroll-locked",e2e=function(n,t,s,a){var l=n.left,d=n.top,f=n.right,y=n.gap;return s===void 0&&(s="margin"),`
  .`.concat(WLe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(y,"px ").concat(a,`;
  }
  body[`).concat(t0,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(y,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(y,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(YO,` {
    right: `).concat(y,"px ").concat(a,`;
  }
  
  .`).concat(XO,` {
    margin-right: `).concat(y,"px ").concat(a,`;
  }
  
  .`).concat(YO," .").concat(YO,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(XO," .").concat(XO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(t0,`] {
    `).concat(zLe,": ").concat(y,`px;
  }
`)},WY=function(){var n=parseInt(document.body.getAttribute(t0)||"0",10);return isFinite(n)?n:0},t2e=function(){D.useEffect(function(){return document.body.setAttribute(t0,(WY()+1).toString()),function(){var n=WY()-1;n<=0?document.body.removeAttribute(t0):document.body.setAttribute(t0,n.toString())}},[])},n2e=function(n){var t=n.noRelative,s=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;t2e();var d=D.useMemo(function(){return QLe(l)},[l]);return D.createElement(ZLe,{styles:e2e(d,!t,l,s?"":"!important")})},oV=!1;if(typeof window<"u")try{var _O=Object.defineProperty({},"passive",{get:function(){return oV=!0,!0}});window.addEventListener("test",_O,_O),window.removeEventListener("test",_O,_O)}catch{oV=!1}var yS=oV?{passive:!1}:!1,r2e=function(n){return n.tagName==="TEXTAREA"},wne=function(n,t){if(!(n instanceof Element))return!1;var s=window.getComputedStyle(n);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!r2e(n)&&s[t]==="visible")},i2e=function(n){return wne(n,"overflowY")},s2e=function(n){return wne(n,"overflowX")},zY=function(n,t){var s=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=Cne(n,a);if(l){var d=Rne(n,a),f=d[1],y=d[2];if(f>y)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},o2e=function(n){var t=n.scrollTop,s=n.scrollHeight,a=n.clientHeight;return[t,s,a]},a2e=function(n){var t=n.scrollLeft,s=n.scrollWidth,a=n.clientWidth;return[t,s,a]},Cne=function(n,t){return n==="v"?i2e(t):s2e(t)},Rne=function(n,t){return n==="v"?o2e(t):a2e(t)},c2e=function(n,t){return n==="h"&&t==="rtl"?-1:1},l2e=function(n,t,s,a,l){var d=c2e(n,window.getComputedStyle(t).direction),f=d*a,y=s.target,v=t.contains(y),b=!1,w=f>0,I=0,k=0;do{var L=Rne(n,y),V=L[0],B=L[1],W=L[2],Q=B-W-d*V;(V||Q)&&Cne(n,y)&&(I+=Q,k+=V),y instanceof ShadowRoot?y=y.host:y=y.parentNode}while(!v&&y!==document.body||v&&(t.contains(y)||t===y));return(w&&Math.abs(I)<1||!w&&Math.abs(k)<1)&&(b=!0),b},yO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},GY=function(n){return[n.deltaX,n.deltaY]},HY=function(n){return n&&"current"in n?n.current:n},u2e=function(n,t){return n[0]===t[0]&&n[1]===t[1]},d2e=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},h2e=0,ES=[];function p2e(n){var t=D.useRef([]),s=D.useRef([0,0]),a=D.useRef(),l=D.useState(h2e++)[0],d=D.useState(Tne)[0],f=D.useRef(n);D.useEffect(function(){f.current=n},[n]),D.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var B=ENe([n.lockRef.current],(n.shards||[]).map(HY),!0).filter(Boolean);return B.forEach(function(W){return W.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),B.forEach(function(W){return W.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var y=D.useCallback(function(B,W){if("touches"in B&&B.touches.length===2||B.type==="wheel"&&B.ctrlKey)return!f.current.allowPinchZoom;var Q=yO(B),$=s.current,ie="deltaX"in B?B.deltaX:$[0]-Q[0],ce="deltaY"in B?B.deltaY:$[1]-Q[1],ne,de=B.target,Y=Math.abs(ie)>Math.abs(ce)?"h":"v";if("touches"in B&&Y==="h"&&de.type==="range")return!1;var X=zY(Y,de);if(!X)return!0;if(X?ne=Y:(ne=Y==="v"?"h":"v",X=zY(Y,de)),!X)return!1;if(!a.current&&"changedTouches"in B&&(ie||ce)&&(a.current=ne),!ne)return!0;var Z=a.current||ne;return l2e(Z,W,B,Z==="h"?ie:ce)},[]),v=D.useCallback(function(B){var W=B;if(!(!ES.length||ES[ES.length-1]!==d)){var Q="deltaY"in W?GY(W):yO(W),$=t.current.filter(function(ne){return ne.name===W.type&&(ne.target===W.target||W.target===ne.shadowParent)&&u2e(ne.delta,Q)})[0];if($&&$.should){W.cancelable&&W.preventDefault();return}if(!$){var ie=(f.current.shards||[]).map(HY).filter(Boolean).filter(function(ne){return ne.contains(W.target)}),ce=ie.length>0?y(W,ie[0]):!f.current.noIsolation;ce&&W.cancelable&&W.preventDefault()}}},[]),b=D.useCallback(function(B,W,Q,$){var ie={name:B,delta:W,target:Q,should:$,shadowParent:f2e(Q)};t.current.push(ie),setTimeout(function(){t.current=t.current.filter(function(ce){return ce!==ie})},1)},[]),w=D.useCallback(function(B){s.current=yO(B),a.current=void 0},[]),I=D.useCallback(function(B){b(B.type,GY(B),B.target,y(B,n.lockRef.current))},[]),k=D.useCallback(function(B){b(B.type,yO(B),B.target,y(B,n.lockRef.current))},[]);D.useEffect(function(){return ES.push(d),n.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:k}),document.addEventListener("wheel",v,yS),document.addEventListener("touchmove",v,yS),document.addEventListener("touchstart",w,yS),function(){ES=ES.filter(function(B){return B!==d}),document.removeEventListener("wheel",v,yS),document.removeEventListener("touchmove",v,yS),document.removeEventListener("touchstart",w,yS)}},[]);var L=n.removeScrollBar,V=n.inert;return D.createElement(D.Fragment,null,V?D.createElement(d,{styles:d2e(l)}):null,L?D.createElement(n2e,{gapMode:n.gapMode}):null)}function f2e(n){for(var t=null;n!==null;)n instanceof ShadowRoot&&(t=n.host,n=n.host),n=n.parentNode;return t}const m2e=vNe(bne,p2e);var Ine=D.forwardRef(function(n,t){return D.createElement(A1,Bh({},n,{ref:t,sideCar:m2e}))});Ine.classNames=A1.classNames;function g2e(n){const{autoFocus:t,trapFocus:s,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:f,finalFocusRef:y,returnFocusOnClose:v,preserveScrollBarGap:b,lockFocusAcrossFrames:w,isOpen:I}=My(),[k,L]=RF();D.useEffect(()=>{!k&&L&&setTimeout(L)},[k,L]);const V=Sne(a,I);return C.jsx(ene,{autoFocus:t,isDisabled:!s,initialFocusRef:l,finalFocusRef:y,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:w,children:C.jsx(Ine,{removeScrollBar:!b,allowPinchZoom:f,enabled:V===1&&d,forwardProps:!0,children:n.children})})}const _2e={initial:({offsetX:n,offsetY:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:t,transition:(s==null?void 0:s.exit)??Cy.exit(wy.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:t,delay:s})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Cy.enter(wy.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:n,offsetX:t,transition:s,transitionEnd:a,reverse:l,delay:d})=>{const f={x:t,y:n};return{opacity:0,transition:(s==null?void 0:s.exit)??Cy.exit(wy.exit,d),...l?{...f,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...f,...a==null?void 0:a.exit}}}}},Vw={initial:"initial",animate:"enter",exit:"exit",variants:_2e},y2e=D.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,className:f,offsetX:y=0,offsetY:v=8,transition:b,transitionEnd:w,delay:I,animatePresenceProps:k,...L}=t,V=a?l&&a:!0,B=l||a?"enter":"exit",W={offsetX:y,offsetY:v,reverse:d,transition:b,transitionEnd:w,delay:I};return C.jsx(x0,{...k,custom:W,children:V&&C.jsx(Gf.div,{ref:s,className:pn("chakra-offset-slide",f),custom:W,...Vw,animate:B,...L})})});y2e.displayName="SlideFade";const E2e={exit:({reverse:n,initialScale:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(s==null?void 0:s.exit)??Cy.exit(wy.exit,l)}),enter:({transitionEnd:n,transition:t,delay:s})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??Cy.enter(wy.enter,s),transitionEnd:n==null?void 0:n.enter})},Ane={initial:"exit",animate:"enter",exit:"exit",variants:E2e},v2e=D.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:f=.95,className:y,transition:v,transitionEnd:b,delay:w,animatePresenceProps:I,...k}=t,L=a?l&&a:!0,V=l||a?"enter":"exit",B={initialScale:f,reverse:d,transition:v,transitionEnd:b,delay:w};return C.jsx(x0,{...I,custom:B,children:L&&C.jsx(Gf.div,{ref:s,className:pn("chakra-offset-slide",y),...Ane,animate:V,custom:B,...k})})});v2e.displayName="ScaleFade";const S2e={slideInBottom:{...Vw,custom:{offsetY:16,reverse:!0}},slideInRight:{...Vw,custom:{offsetX:16,reverse:!0}},slideInTop:{...Vw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Vw,custom:{offsetX:-16,reverse:!0}},scale:{...Ane,custom:{initialScale:.95,reverse:!0}},none:{}},b2e=Dt(Gf.section),T2e=n=>S2e[n||"none"],Pne=D.forwardRef((n,t)=>{const{preset:s,motionProps:a=T2e(s),...l}=n;return C.jsx(b2e,{ref:t,...a,...l})});Pne.displayName="ModalTransition";const Wo=Wt((n,t)=>{const{className:s,children:a,containerProps:l,motionProps:d,...f}=n,{getDialogProps:y,getDialogContainerProps:v}=My(),b=y(f,t),w=v(l),I=pn("chakra-modal__content",s),k=j0(),L={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...k.dialog},V={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...k.dialogContainer},{motionPreset:B}=My();return C.jsx(g2e,{children:C.jsx(Dt.div,{...w,className:"chakra-modal__content-container",tabIndex:-1,__css:V,children:C.jsx(Pne,{preset:B,motionProps:d,className:I,...b,__css:L,children:a})})})});Wo.displayName="ModalContent";const zo=Wt((n,t)=>{const{className:s,...a}=n,{bodyId:l,setBodyMounted:d}=My();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=pn("chakra-modal__body",s),y=j0();return C.jsx(Dt.div,{ref:t,className:f,id:l,...a,__css:y.body})});zo.displayName="ModalBody";const ba=Wt((n,t)=>{const{onClick:s,className:a,...l}=n,{onClose:d}=My(),f=pn("chakra-modal__close-btn",a),y=j0();return C.jsx(oj,{ref:t,__css:y.closeButton,className:f,onClick:kn(s,v=>{v.stopPropagation(),d()}),...l})});ba.displayName="ModalCloseButton";const Vf=Wt((n,t)=>{const{className:s,...a}=n,l=pn("chakra-modal__footer",s),d=j0(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return C.jsx(Dt.footer,{ref:t,...a,__css:f,className:l})});Vf.displayName="ModalFooter";const wc=Wt((n,t)=>{const{className:s,...a}=n,{headerId:l,setHeaderMounted:d}=My();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=pn("chakra-modal__header",s),y=j0(),v={flex:0,...y.header};return C.jsx(Dt.header,{ref:t,className:f,id:l,...a,__css:v})});wc.displayName="ModalHeader";const w2e={enter:({transition:n,transitionEnd:t,delay:s}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Cy.enter(wy.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({transition:n,transitionEnd:t,delay:s}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Cy.exit(wy.exit,s),transitionEnd:t==null?void 0:t.exit})},One={initial:"exit",animate:"enter",exit:"exit",variants:w2e},C2e=D.forwardRef(function(t,s){const{unmountOnExit:a,in:l,className:d,transition:f,transitionEnd:y,delay:v,animatePresenceProps:b,...w}=t,I=l||a?"enter":"exit",k=a?l&&a:!0,L={transition:f,transitionEnd:y,delay:v};return C.jsx(x0,{...b,custom:L,children:k&&C.jsx(Gf.div,{ref:s,className:pn("chakra-fade",d),custom:L,...One,animate:I,...w})})});C2e.displayName="Fade";const R2e=Dt(Gf.div),Go=Wt((n,t)=>{const{className:s,transition:a,motionProps:l,...d}=n,f=pn("chakra-modal__overlay",s),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...j0().overlay},{motionPreset:b}=My(),I=l||(b==="none"?{}:One);return C.jsx(R2e,{...I,__css:v,ref:t,className:f,...d})});Go.displayName="ModalOverlay";function I2e(n){const{leastDestructiveRef:t,...s}=n;return C.jsx(Bo,{...s,initialFocusRef:t})}const A2e=Wt((n,t)=>C.jsx(Wo,{ref:t,role:"alertdialog",...n})),P2e=n=>C.jsx(yn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),O2e=n=>C.jsx(yn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function $Y(n,t,s,a){D.useEffect(()=>{if(!n.current||!a)return;const l=n.current.ownerDocument.defaultView??window,d=Array.isArray(t)?t:[t],f=new l.MutationObserver(y=>{for(const v of y)v.type==="attributes"&&v.attributeName&&d.includes(v.attributeName)&&s(v)});return f.observe(n.current,{attributes:!0,attributeFilter:d}),()=>f.disconnect()})}const k2e=50,KY=300;function N2e(n,t){const[s,a]=D.useState(!1),[l,d]=D.useState(null),[f,y]=D.useState(!0),v=D.useRef(null),b=()=>clearTimeout(v.current);bEe(()=>{l==="increment"&&n(),l==="decrement"&&t()},s?k2e:null);const w=D.useCallback(()=>{f&&n(),v.current=setTimeout(()=>{y(!1),a(!0),d("increment")},KY)},[n,f]),I=D.useCallback(()=>{f&&t(),v.current=setTimeout(()=>{y(!1),a(!0),d("decrement")},KY)},[t,f]),k=D.useCallback(()=>{y(!0),a(!1),b()},[]);return D.useEffect(()=>()=>b(),[]),{up:w,down:I,stop:k,isSpinning:s}}const D2e=/^[Ee0-9+\-.]$/;function x2e(n){return D2e.test(n)}function L2e(n,t){if(n.key==null)return!0;const s=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||s?!0:t(n.key)}function M2e(n={}){const{focusInputOnChange:t=!0,clampValueOnBlur:s=!0,keepWithinRange:a=!0,min:l=Number.MIN_SAFE_INTEGER,max:d=Number.MAX_SAFE_INTEGER,step:f=1,isReadOnly:y,isDisabled:v,isRequired:b,isInvalid:w,pattern:I="[0-9]*(.[0-9]+)?",inputMode:k="decimal",allowMouseWheel:L,id:V,onChange:B,precision:W,name:Q,"aria-describedby":$,"aria-label":ie,"aria-labelledby":ce,onFocus:ne,onBlur:de,onInvalid:Y,getAriaValueText:X,isValidCharacter:Z,format:se,parse:me,...pe}=n,ue=Gs(ne),Le=Gs(de),We=Gs(Y),$e=Gs(Z??x2e),ve=Gs(X),_e=cEe(n),{update:Ee,increment:ke,decrement:Te}=_e,[be,Pe]=D.useState(!1),xe=!(y||v),ze=D.useRef(null),Je=D.useRef(null),Ze=D.useRef(null),lt=D.useRef(null),nt=D.useCallback(Et=>Et.split("").filter($e).join(""),[$e]),Rt=D.useCallback(Et=>(me==null?void 0:me(Et))??Et,[me]),fn=D.useCallback(Et=>((se==null?void 0:se(Et))??Et).toString(),[se]);xf(()=>{(_e.valueAsNumber>d||_e.valueAsNumber<l)&&(We==null||We("rangeOverflow",fn(_e.value),_e.valueAsNumber))},[_e.valueAsNumber,_e.value,fn,We]),Kh(()=>{if(!ze.current)return;if(ze.current.value!=_e.value){const nr=Rt(ze.current.value);_e.setValue(nt(nr))}},[Rt,nt]);const Ft=D.useCallback((Et=f)=>{xe&&ke(Et)},[ke,xe,f]),on=D.useCallback((Et=f)=>{xe&&Te(Et)},[Te,xe,f]),Zt=N2e(Ft,on);$Y(Ze,"disabled",Zt.stop,Zt.isSpinning),$Y(lt,"disabled",Zt.stop,Zt.isSpinning);const Yt=D.useCallback(Et=>{if(Et.nativeEvent.isComposing)return;const Nt=Rt(Et.currentTarget.value);Ee(nt(Nt)),Je.current={start:Et.currentTarget.selectionStart,end:Et.currentTarget.selectionEnd}},[Ee,nt,Rt]),Vn=D.useCallback(Et=>{var nr;ue==null||ue(Et),Je.current&&(Et.currentTarget.selectionStart=Je.current.start??((nr=Et.currentTarget.value)==null?void 0:nr.length),Et.currentTarget.selectionEnd=Je.current.end??Et.currentTarget.selectionStart)},[ue]),$t=D.useCallback(Et=>{if(Et.nativeEvent.isComposing)return;L2e(Et,$e)||Et.preventDefault();const nr=Re(Et)*f,Nt=Et.key,gn={ArrowUp:()=>Ft(nr),ArrowDown:()=>on(nr),Home:()=>Ee(l),End:()=>Ee(d)}[Nt];gn&&(Et.preventDefault(),gn(Et))},[$e,f,Ft,on,Ee,l,d]),Re=Et=>{let nr=1;return(Et.metaKey||Et.ctrlKey)&&(nr=.1),Et.shiftKey&&(nr=10),nr},Ve=D.useMemo(()=>{const Et=ve==null?void 0:ve(_e.value);if(Et!=null)return Et;const nr=_e.value.toString();return nr||void 0},[_e.value,ve]),Ge=D.useCallback(()=>{let Et=_e.value;if(_e.value==="")return;/^[eE]/.test(_e.value.toString())?_e.setValue(""):(_e.valueAsNumber<l&&(Et=l),_e.valueAsNumber>d&&(Et=d),_e.cast(Et))},[_e,d,l]),ht=D.useCallback(()=>{Pe(!1),s&&Ge()},[s,Pe,Ge]),mt=D.useCallback(()=>{t&&requestAnimationFrame(()=>{var Et;(Et=ze.current)==null||Et.focus()})},[t]),vt=D.useCallback(Et=>{Et.preventDefault(),Zt.up(),mt()},[mt,Zt]),Bt=D.useCallback(Et=>{Et.preventDefault(),Zt.down(),mt()},[mt,Zt]);Ey(()=>ze.current,"wheel",Et=>{var ki;const Nt=(((ki=ze.current)==null?void 0:ki.ownerDocument)??document).activeElement===ze.current;if(!L||!Nt)return;Et.preventDefault();const Ut=Re(Et)*f,gn=Math.sign(Et.deltaY);gn===-1?Ft(Ut):gn===1&&on(Ut)},{passive:!1});const mn=D.useCallback((Et={},nr=null)=>{const Nt=v||a&&_e.isAtMax;return{...Et,ref:Vi(nr,Ze),role:"button",tabIndex:-1,onPointerDown:kn(Et.onPointerDown,Ut=>{Ut.button!==0||Nt||vt(Ut)}),onPointerLeave:kn(Et.onPointerLeave,Zt.stop),onPointerUp:kn(Et.onPointerUp,Zt.stop),disabled:Nt,"aria-disabled":Cf(Nt)}},[_e.isAtMax,a,vt,Zt.stop,v]),En=D.useCallback((Et={},nr=null)=>{const Nt=v||a&&_e.isAtMin;return{...Et,ref:Vi(nr,lt),role:"button",tabIndex:-1,onPointerDown:kn(Et.onPointerDown,Ut=>{Ut.button!==0||Nt||Bt(Ut)}),onPointerLeave:kn(Et.onPointerLeave,Zt.stop),onPointerUp:kn(Et.onPointerUp,Zt.stop),disabled:Nt,"aria-disabled":Cf(Nt)}},[_e.isAtMin,a,Bt,Zt.stop,v]),en=D.useCallback((Et={},nr=null)=>({name:Q,inputMode:k,type:"text",pattern:I,"aria-labelledby":ce,"aria-label":ie,"aria-describedby":$,id:V,disabled:v,role:"spinbutton",...Et,readOnly:Et.readOnly??y,"aria-readonly":Et.readOnly??y,"aria-required":Et.required??b,required:Et.required??b,ref:Vi(ze,nr),value:fn(_e.value),"aria-valuemin":l,"aria-valuemax":d,"aria-valuenow":Number.isNaN(_e.valueAsNumber)?void 0:_e.valueAsNumber,"aria-invalid":Cf(w??_e.isOutOfRange),"aria-valuetext":Ve,autoComplete:"off",autoCorrect:"off",onChange:kn(Et.onChange,Yt),onKeyDown:kn(Et.onKeyDown,$t),onFocus:kn(Et.onFocus,Vn,()=>Pe(!0)),onBlur:kn(Et.onBlur,Le,ht)}),[Q,k,I,ce,ie,fn,$,V,v,b,y,w,_e.value,_e.valueAsNumber,_e.isOutOfRange,l,d,Ve,Yt,$t,Vn,Le,ht]);return{value:fn(_e.value),valueAsNumber:_e.valueAsNumber,isFocused:be,isDisabled:v,isReadOnly:y,getIncrementButtonProps:mn,getDecrementButtonProps:En,getInputProps:en,htmlProps:pe}}const[U2e,P1]=Oi({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[V2e,xj]=Oi({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),JO=Wt(function(t,s){const a=Za("NumberInput",t),l=Gi(t),d=uj(l),{htmlProps:f,...y}=M2e(d),v=D.useMemo(()=>y,[y]);return C.jsx(V2e,{value:v,children:C.jsx(U2e,{value:a,children:C.jsx(Dt.div,{...f,ref:s,className:pn("chakra-numberinput",t.className),__css:{position:"relative",zIndex:0,...a.root}})})})});JO.displayName="NumberInput";const QO=Wt(function(t,s){const a=P1();return C.jsx(Dt.div,{"aria-hidden":!0,ref:s,...t,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...a.stepperGroup}})});QO.displayName="NumberInputStepper";const ZO=Wt(function(t,s){const{getInputProps:a}=xj(),l=a(t,s),d=P1();return C.jsx(Dt.input,{...l,className:pn("chakra-numberinput__field",t.className),__css:{width:"100%",...d.field}})});ZO.displayName="NumberInputField";const kne=Dt("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),ek=Wt(function(t,s){const a=P1(),{getDecrementButtonProps:l}=xj(),d=l(t,s);return C.jsx(kne,{...d,__css:a.stepper,children:t.children??C.jsx(P2e,{})})});ek.displayName="NumberDecrementStepper";const tk=Wt(function(t,s){const{getIncrementButtonProps:a}=xj(),l=a(t,s),d=P1();return C.jsx(kne,{...l,__css:d.stepper,children:t.children??C.jsx(O2e,{})})});tk.displayName="NumberIncrementStepper";const[F2e,O1]=Oi({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[j2e,Nne]=Oi({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),vS={click:"click",hover:"hover"};function B2e(n={}){const{closeOnBlur:t=!0,closeOnEsc:s=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:f=!0,arrowSize:y,arrowShadowColor:v,trigger:b=vS.click,openDelay:w=200,closeDelay:I=200,isLazy:k,lazyBehavior:L="unmount",computePositionOnMount:V,...B}=n,{isOpen:W,onClose:Q,onOpen:$,onToggle:ie}=Df(n),[ce,ne]=D.useState(d);D.useEffect(()=>ne(d),[d]);const de=D.useRef(null),Y=D.useRef(null),X=D.useRef(null),Z=D.useRef(!1),se=D.useRef(!1);W&&(se.current=!0);const[me,pe]=D.useState(!1),[ue,Le]=D.useState(!1),We=D.useId(),$e=l??We,[ve,_e,Ee,ke]=["popover-trigger","popover-content","popover-header","popover-body"].map($t=>`${$t}-${$e}`),{referenceRef:Te,getArrowProps:be,getPopperProps:Pe,getArrowInnerProps:xe,forceUpdate:ze}=Dj({...B,enabled:W||!!V}),Je=WQ({isOpen:W,ref:X});EEe({enabled:W,ref:Y}),HQ(X,{focusRef:Y,visible:W,shouldFocus:ce&&b===vS.click}),dEe(X,{focusRef:a,visible:W,shouldFocus:f&&b===vS.click}),qQ({enabled:W&&t,ref:X,handler($t){var Ve;const Re=((Ve=$t.composedPath)==null?void 0:Ve.call($t)[0])??[$t.target];EO(Y.current,Re)||(Re&&ne(!yk(Re)),Q())}});const Ze=nF({wasSelected:se.current,enabled:k,mode:L,isSelected:Je.present}),lt=D.useCallback(($t={},Re=null)=>{const Ve={...$t,style:{...$t.style,transformOrigin:no.transformOrigin.varRef,[no.arrowSize.var]:y?`${y}px`:void 0,[no.arrowShadowColor.var]:v},ref:Vi(X,Re),children:Ze?$t.children:null,id:_e,tabIndex:-1,role:"dialog",onKeyDown:kn($t.onKeyDown,Ge=>{Ge.nativeEvent.isComposing||s&&Ge.key==="Escape"&&(Ge.preventDefault(),Ge.stopPropagation(),Q())}),onBlur:kn($t.onBlur,Ge=>{const ht=qY(Ge),mt=EO(X.current,ht),vt=EO(Y.current,ht),Bt=!mt&&!vt;ht&&ne(!yk(ht)),W&&t&&Bt&&Q()}),"aria-labelledby":me?Ee:void 0,"aria-describedby":ue?ke:void 0};return b===vS.hover&&(Ve.role="tooltip",Ve.onMouseEnter=kn($t.onMouseEnter,()=>{Z.current=!0}),Ve.onMouseLeave=kn($t.onMouseLeave,Ge=>{Ge.nativeEvent.relatedTarget!==null&&(Z.current=!1,setTimeout(()=>Q(),I))})),Ve},[Ze,_e,me,Ee,ue,ke,b,s,Q,W,t,I,v,y]),nt=D.useCallback(($t={},Re=null)=>Pe({...$t,style:{visibility:W?"visible":"hidden",...$t.style}},Re),[W,Pe]),Rt=D.useCallback(($t,Re=null)=>({...$t,ref:Vi(Re,de,Te)}),[de,Te]),fn=D.useRef(void 0),Ft=D.useRef(void 0),on=D.useCallback($t=>{de.current==null&&Te($t)},[Te]),Zt=D.useCallback(($t={},Re=null)=>{const Ve={...$t,ref:Vi(Y,Re,on),id:ve,"aria-haspopup":"dialog","aria-expanded":W,"aria-controls":_e};return b===vS.click&&(Ve.onClick=kn($t.onClick,ie)),b===vS.hover&&(Ve.onFocus=kn($t.onFocus,()=>{fn.current===void 0&&$()}),Ve.onBlur=kn($t.onBlur,Ge=>{const ht=qY(Ge),mt=!EO(X.current,ht);W&&t&&mt&&Q()}),Ve.onKeyDown=kn($t.onKeyDown,Ge=>{Ge.key==="Escape"&&Q()}),Ve.onMouseEnter=kn($t.onMouseEnter,()=>{Z.current=!0,fn.current=window.setTimeout(()=>$(),w)}),Ve.onMouseLeave=kn($t.onMouseLeave,()=>{Z.current=!1,fn.current&&(clearTimeout(fn.current),fn.current=void 0),Ft.current=window.setTimeout(()=>{Z.current===!1&&Q()},I)})),Ve},[ve,W,_e,b,on,ie,$,t,Q,w,I]);D.useEffect(()=>()=>{fn.current&&clearTimeout(fn.current),Ft.current&&clearTimeout(Ft.current)},[]);const Yt=D.useCallback(($t={},Re=null)=>({...$t,id:Ee,ref:Vi(Re,Ve=>{pe(!!Ve)})}),[Ee]),Vn=D.useCallback(($t={},Re=null)=>({...$t,id:ke,ref:Vi(Re,Ve=>{Le(!!Ve)})}),[ke]);return{forceUpdate:ze,isOpen:W,onAnimationComplete:Je.onComplete,onClose:Q,getAnchorProps:Rt,getArrowProps:be,getArrowInnerProps:xe,getPopoverPositionerProps:nt,getPopoverProps:lt,getTriggerProps:Zt,getHeaderProps:Yt,getBodyProps:Vn}}function EO(n,t){return n===t||(n==null?void 0:n.contains(t))}function qY(n){const t=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??t}function Dne(n){const t=Za("Popover",n),{children:s,...a}=Gi(n),l=U0(),d=B2e({...a,direction:l.direction});return C.jsx(F2e,{value:d,children:C.jsx(j2e,{value:t,children:cl(s,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}Dne.displayName="Popover";function xne(n){var s;const t=D.version;return typeof t!="string"||t.startsWith("18.")?n==null?void 0:n.ref:(s=n==null?void 0:n.props)==null?void 0:s.ref}const Lne=Wt(function(t,s){const{getBodyProps:a}=O1(),l=Nne();return C.jsx(Dt.div,{...a(t,s),className:pn("chakra-popover__body",t.className),__css:l.body})});Lne.displayName="PopoverBody";function W2e(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const z2e={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},G2e=Dt(Gf.section),Mne=Wt(function(t,s){const{variants:a=z2e,...l}=t,{isOpen:d}=O1();return C.jsx(G2e,{ref:s,variants:W2e(a),initial:!1,animate:d?"enter":"exit",...l})});Mne.displayName="PopoverTransition";const Une=Wt(function(t,s){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:f,getPopoverPositionerProps:y,onAnimationComplete:v}=O1(),b=Nne(),w={position:"relative",display:"flex",flexDirection:"column",...b.content};return C.jsx(Dt.div,{...y(a),__css:b.popper,className:"chakra-popover__popper",children:C.jsx(Mne,{...l,...f(d,s),onAnimationComplete:MQ(v,d.onAnimationComplete),className:pn("chakra-popover__content",t.className),__css:w})})});Une.displayName="PopoverContent";function Vne(n){const t=D.Children.only(n.children),{getTriggerProps:s}=O1();return C.jsx(C.Fragment,{children:D.cloneElement(t,s(t.props,xne(t)))})}Vne.displayName="PopoverTrigger";function H2e(n,t,s){return(n-t)*100/(s-t)}GC({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});GC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const $2e=GC({"0%":{left:"-40%"},"100%":{left:"100%"}}),K2e=GC({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function q2e(n){const{value:t=0,min:s,max:a,valueText:l,getValueText:d,isIndeterminate:f,role:y="progressbar"}=n,v=H2e(t,s,a);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":a,"aria-valuemin":s,"aria-valuenow":f?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,v):l})(),role:y},percent:v,value:t}}const[Y2e,X2e]=Oi({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),J2e=Wt((n,t)=>{const{min:s,max:a,value:l,isIndeterminate:d,role:f,...y}=n,v=q2e({value:l,min:s,max:a,isIndeterminate:d,role:f}),w={height:"100%",...X2e().filledTrack};return C.jsx(Dt.div,{ref:t,style:{width:`${v.percent}%`,...y.style},...v.bind,...y,__css:w})}),Py=Wt((n,t)=>{var Y;const{value:s,min:a=0,max:l=100,hasStripe:d,isAnimated:f,children:y,borderRadius:v,isIndeterminate:b,"aria-label":w,"aria-labelledby":I,"aria-valuetext":k,title:L,role:V,...B}=Gi(n),W=Za("Progress",n),Q=v??((Y=W.track)==null?void 0:Y.borderRadius),$={animation:`${K2e} 1s linear infinite`},ne={...!b&&d&&f&&$,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${$2e} 1s ease infinite normal none running`}},de={overflow:"hidden",position:"relative",...W.track};return C.jsx(Dt.div,{ref:t,borderRadius:Q,__css:de,...B,children:C.jsxs(Y2e,{value:W,children:[C.jsx(J2e,{"aria-label":w,"aria-labelledby":I,"aria-valuetext":k,min:a,max:l,value:s,isIndeterminate:b,css:ne,borderRadius:Q,title:L,role:V}),y]})})});Py.displayName="Progress";const Fne=Wt(function(t,s){const{children:a,placeholder:l,className:d,...f}=t;return C.jsxs(Dt.select,{...f,ref:s,className:pn("chakra-select",d),children:[l&&C.jsx("option",{value:"",children:l}),a]})});Fne.displayName="SelectField";const jne=Wt((n,t)=>{var ie;const s=Za("Select",n),{rootProps:a,placeholder:l,icon:d,color:f,height:y,h:v,minH:b,minHeight:w,iconColor:I,iconSize:k,...L}=Gi(n),[V,B]=tEe(L,vve),W=lj(B),Q={width:"100%",height:"fit-content",position:"relative",color:f},$={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(ie=s.field)==null?void 0:ie._focus}};return C.jsxs(Dt.div,{className:"chakra-select__wrapper",__css:Q,...V,...a,children:[C.jsx(Fne,{ref:t,height:v??y,minH:b??w,placeholder:l,...W,__css:$,children:n.children}),C.jsx(Bne,{"data-disabled":er(W.disabled),...(I||f)&&{color:I||f},__css:s.icon,...k&&{fontSize:k},children:d})]})});jne.displayName="Select";const Q2e=n=>C.jsx("svg",{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Z2e=Dt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Bne=n=>{const{children:t=C.jsx(Q2e,{}),...s}=n,a=D.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return C.jsx(Z2e,{...s,className:"chakra-select__icon-wrapper",children:D.isValidElement(t)?a:null})};Bne.displayName="SelectIcon";function zM(n){const{orientation:t,vertical:s,horizontal:a}=n;return t==="vertical"?s:a}function eMe(n){const{orientation:t,thumbPercents:s,isReversed:a}=n,l=L=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...zM({orientation:t,vertical:{bottom:`calc(${s[L]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${s[L]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...zM({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},y=s.length===1,v=[0,a?100-s[0]:s[0]],b=y?v:s;let w=b[0];!y&&a&&(w=100-w);const I=Math.abs(b[b.length-1]-b[0]),k={...f,...zM({orientation:t,vertical:a?{height:`${I}%`,top:`${w}%`}:{height:`${I}%`,bottom:`${w}%`},horizontal:a?{width:`${I}%`,right:`${w}%`}:{width:`${I}%`,left:`${w}%`}})};return{trackStyle:f,innerTrackStyle:k,rootStyle:d,getThumbStyle:l}}function tMe(n){const{isReversed:t,direction:s,orientation:a}=n;return s==="ltr"||a==="vertical"?t:!t}function nMe(n){const{min:t=0,max:s=100,onChange:a,value:l,defaultValue:d,isReversed:f,direction:y="ltr",orientation:v="horizontal",id:b,isDisabled:w,isReadOnly:I,onChangeStart:k,onChangeEnd:L,step:V=1,getAriaValueText:B,"aria-valuetext":W,"aria-label":Q,"aria-labelledby":$,name:ie,focusThumbOnChange:ce=!0,...ne}=n,de=Gs(k),Y=Gs(L),X=Gs(B),Z=tMe({isReversed:f,direction:y,orientation:v}),[se,me]=zQ({value:l,defaultValue:d??iMe(t,s),onChange:a}),[pe,ue]=D.useState(!1),[Le,We]=D.useState(!1),$e=!(w||I),ve=(s-t)/10,_e=V||(s-t)/100,Ee=NO(se,t,s),ke=s-Ee+t,be=eK(Z?ke:Ee,t,s),Pe=v==="vertical",xe=KQ({min:t,max:s,step:V,isDisabled:w,value:Ee,isInteractive:$e,isReversed:Z,isVertical:Pe,eventSource:null,focusThumbOnChange:ce,orientation:v}),ze=D.useRef(null),Je=D.useRef(null),Ze=D.useRef(null),lt=D.useId(),nt=b??lt,[Rt,fn]=[`slider-thumb-${nt}`,`slider-track-${nt}`],Ft=D.useCallback(Nt=>{var qs;if(!ze.current)return;const Ut=xe.current;Ut.eventSource="pointer";const gn=ze.current.getBoundingClientRect(),{clientX:ki,clientY:_s}=((qs=Nt.touches)==null?void 0:qs[0])??Nt,ii=Pe?gn.bottom-_s:ki-gn.left,Ho=Pe?gn.height:gn.width;let ec=ii/Ho;Z&&(ec=1-ec);let Ks=Jye(ec,Ut.min,Ut.max);return Ut.step&&(Ks=parseFloat(tK(Ks,Ut.min,Ut.step))),Ks=NO(Ks,Ut.min,Ut.max),Ks},[Pe,Z,xe]),on=D.useCallback(Nt=>{const Ut=xe.current;Ut.isInteractive&&(Nt=parseFloat(tK(Nt,Ut.min,_e)),Nt=NO(Nt,Ut.min,Ut.max),me(Nt))},[_e,me,xe]),Zt=D.useMemo(()=>({stepUp(Nt=_e){const Ut=Z?Ee-Nt:Ee+Nt;on(Ut)},stepDown(Nt=_e){const Ut=Z?Ee+Nt:Ee-Nt;on(Ut)},reset(){on(d||0)},stepTo(Nt){on(Nt)}}),[on,Z,Ee,_e,d]),Yt=D.useCallback(Nt=>{const Ut=xe.current,ki={ArrowRight:()=>Zt.stepUp(),ArrowUp:()=>Zt.stepUp(),ArrowLeft:()=>Zt.stepDown(),ArrowDown:()=>Zt.stepDown(),PageUp:()=>Zt.stepUp(ve),PageDown:()=>Zt.stepDown(ve),Home:()=>on(Ut.min),End:()=>on(Ut.max)}[Nt.key];ki&&(Nt.preventDefault(),Nt.stopPropagation(),ki(Nt),Ut.eventSource="keyboard")},[Zt,on,ve,xe]),Vn=(X==null?void 0:X(Ee))??W,{getThumbStyle:$t,rootStyle:Re,trackStyle:Ve,innerTrackStyle:Ge}=D.useMemo(()=>{const Nt=xe.current;return eMe({isReversed:Z,orientation:Nt.orientation,thumbPercents:[be]})},[Z,be,xe]),ht=D.useCallback(()=>{xe.current.focusThumbOnChange&&setTimeout(()=>{var Ut;return(Ut=Je.current)==null?void 0:Ut.focus()})},[xe]);xf(()=>{const Nt=xe.current;ht(),Nt.eventSource==="keyboard"&&(Y==null||Y(Nt.value))},[Ee,Y]);function mt(Nt){const Ut=Ft(Nt);Ut!=null&&Ut!==xe.current.value&&me(Ut)}jEe(Ze,{onPanSessionStart(Nt){const Ut=xe.current;Ut.isInteractive&&(ue(!0),ht(),mt(Nt),de==null||de(Ut.value))},onPanSessionEnd(){const Nt=xe.current;Nt.isInteractive&&(ue(!1),Y==null||Y(Nt.value))},onPan(Nt){xe.current.isInteractive&&mt(Nt)}});const vt=D.useCallback((Nt={},Ut=null)=>({...Nt,...ne,ref:Vi(Ut,Ze),tabIndex:-1,"aria-disabled":Cf(w),"data-focused":er(Le),style:{...Nt.style,...Re}}),[ne,w,Le,Re]),Bt=D.useCallback((Nt={},Ut=null)=>({...Nt,ref:Vi(Ut,ze),id:fn,"data-disabled":er(w),style:{...Nt.style,...Ve}}),[w,fn,Ve]),mn=D.useCallback((Nt={},Ut=null)=>({...Nt,ref:Ut,style:{...Nt.style,...Ge}}),[Ge]),En=D.useCallback((Nt={},Ut=null)=>({...Nt,ref:Vi(Ut,Je),role:"slider",tabIndex:$e?0:void 0,id:Rt,"data-active":er(pe),"aria-valuetext":Vn,"aria-valuemin":t,"aria-valuemax":s,"aria-valuenow":Ee,"aria-orientation":v,"aria-disabled":Cf(w),"aria-readonly":Cf(I),"aria-label":Q,"aria-labelledby":Q?void 0:$,style:{...Nt.style,...$t(0)},onKeyDown:kn(Nt.onKeyDown,Yt),onFocus:kn(Nt.onFocus,()=>We(!0)),onBlur:kn(Nt.onBlur,()=>We(!1))}),[$e,Rt,pe,Vn,t,s,Ee,v,w,I,Q,$,$t,Yt]),en=D.useCallback((Nt,Ut=null)=>{const gn=!(Nt.value<t||Nt.value>s),ki=Ee>=Nt.value,_s=eK(Nt.value,t,s),ii={position:"absolute",pointerEvents:"none",...rMe({orientation:v,vertical:{bottom:Z?`${100-_s}%`:`${_s}%`},horizontal:{left:Z?`${100-_s}%`:`${_s}%`}})};return{...Nt,ref:Ut,role:"presentation","aria-hidden":!0,"data-disabled":er(w),"data-invalid":er(!gn),"data-highlighted":er(ki),style:{...Nt.style,...ii}}},[w,Z,s,t,v,Ee]),Et=D.useCallback((Nt={},Ut=null)=>({...Nt,ref:Ut,type:"hidden",value:Ee,name:ie}),[ie,Ee]);return{state:{value:Ee,isFocused:Le,isDragging:pe},actions:Zt,getRootProps:vt,getTrackProps:Bt,getInnerTrackProps:mn,getThumbProps:En,getMarkerProps:en,getInputProps:Et}}function rMe(n){const{orientation:t,vertical:s,horizontal:a}=n;return t==="vertical"?s:a}function iMe(n,t){return t<n?n:n+(t-n)/2}const[sMe,k1]=Oi({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[oMe,N1]=Oi({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),aV=Wt((n,t)=>{const s={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=Za("Slider",s),l=Gi(s),{direction:d}=U0();l.direction=d;const{getInputProps:f,getRootProps:y,...v}=nMe(l),b=y(),w=f({},t);return C.jsx(sMe,{value:v,children:C.jsx(oMe,{value:a,children:C.jsxs(Dt.div,{...b,className:pn("chakra-slider",s.className),__css:a.container,children:[s.children,C.jsx("input",{...w})]})})})});aV.displayName="Slider";const cV=Wt((n,t)=>{const{getThumbProps:s}=k1(),a=N1(),l=s(n,t);return C.jsx(Dt.div,{...l,className:pn("chakra-slider__thumb",n.className),__css:a.thumb})});cV.displayName="SliderThumb";const lV=Wt((n,t)=>{const{getTrackProps:s}=k1(),a=N1(),l=s(n,t);return C.jsx(Dt.div,{...l,className:pn("chakra-slider__track",n.className),__css:a.track})});lV.displayName="SliderTrack";const uV=Wt((n,t)=>{const{getInnerTrackProps:s}=k1(),a=N1(),l=s(n,t);return C.jsx(Dt.div,{...l,className:pn("chakra-slider__filled-track",n.className),__css:a.filledTrack})});uV.displayName="SliderFilledTrack";const aMe=Wt((n,t)=>{const{getMarkerProps:s}=k1(),a=N1(),l=s(n,t);return C.jsx(Dt.div,{...l,className:pn("chakra-slider__marker",n.className),__css:a.mark})});aMe.displayName="SliderMark";const Dk=Dt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});Dk.displayName="Spacer";const Wne=n=>C.jsx(Dt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Wne.displayName="StackItem";function cMe(n){const{spacing:t,direction:s}=n,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":iF(s,l=>a[l])}}const Lj=Wt((n,t)=>{const{isInline:s,direction:a,align:l,justify:d,spacing:f="0.5rem",wrap:y,children:v,divider:b,className:w,shouldWrapChildren:I,...k}=n,L=s?"row":a??"column",V=D.useMemo(()=>cMe({spacing:f,direction:L}),[f,L]),B=!!b,W=!I&&!B,Q=D.useMemo(()=>{const ie=tF(v);return W?ie:ie.map((ce,ne)=>{const de=typeof ce.key<"u"?ce.key:ne,Y=ne+1===ie.length,Z=I?C.jsx(Wne,{children:ce},de):ce;if(!B)return Z;const se=D.cloneElement(b,{__css:V}),me=Y?null:se;return C.jsxs(D.Fragment,{children:[Z,me]},de)})},[b,V,B,W,I,v]),$=pn("chakra-stack",w);return C.jsx(Dt.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:L,flexWrap:y,gap:B?void 0:f,className:$,...k,children:Q})});Lj.displayName="Stack";const ui=Wt((n,t)=>C.jsx(Lj,{align:"center",...n,direction:"row",ref:t}));ui.displayName="HStack";const Ui=Wt((n,t)=>C.jsx(Lj,{align:"center",...n,direction:"column",ref:t}));Ui.displayName="VStack";const Zh=Wt(function(t,s){const a=Za("Switch",t),{spacing:l="0.5rem",children:d,...f}=Gi(t),{getIndicatorProps:y,getInputProps:v,getCheckboxProps:b,getRootProps:w,getLabelProps:I}=aNe(f),k=D.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),L=D.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),V=D.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return C.jsxs(Dt.label,{...w(),className:pn("chakra-switch",t.className),__css:k,children:[C.jsx("input",{className:"chakra-switch__input",...v({},s)}),C.jsx(Dt.span,{...b(),className:"chakra-switch__track",__css:L,children:C.jsx(Dt.span,{__css:a.thumb,className:"chakra-switch__thumb",...y()})}),d&&C.jsx(Dt.span,{className:"chakra-switch__label",...I(),__css:V,children:d})]})});Zh.displayName="Switch";const[lMe,uMe,dMe,hMe]=gte();function pMe(n){const{defaultIndex:t,onChange:s,index:a,isManual:l,isLazy:d,lazyBehavior:f="unmount",orientation:y="horizontal",direction:v="ltr",...b}=n,[w,I]=D.useState(t??0),[k,L]=zQ({defaultValue:t??0,value:a,onChange:s});D.useEffect(()=>{a!=null&&I(a)},[a]);const V=dMe(),B=D.useId();return{id:`tabs-${n.id??B}`,selectedIndex:k,focusedIndex:w,setSelectedIndex:L,setFocusedIndex:I,isManual:l,isLazy:d,lazyBehavior:f,orientation:y,descendants:V,direction:v,htmlProps:b}}const[fMe,D1]=Oi({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function mMe(n){const{focusedIndex:t,orientation:s,direction:a}=D1(),l=uMe(),d=D.useCallback(f=>{const y=()=>{var ie;const $=l.nextEnabled(t);$&&((ie=$.node)==null||ie.focus())},v=()=>{var ie;const $=l.prevEnabled(t);$&&((ie=$.node)==null||ie.focus())},b=()=>{var ie;const $=l.firstEnabled();$&&((ie=$.node)==null||ie.focus())},w=()=>{var ie;const $=l.lastEnabled();$&&((ie=$.node)==null||ie.focus())},I=s==="horizontal",k=s==="vertical",L=f.key,V=a==="ltr"?"ArrowLeft":"ArrowRight",B=a==="ltr"?"ArrowRight":"ArrowLeft",Q={[V]:()=>I&&v(),[B]:()=>I&&y(),ArrowDown:()=>k&&y(),ArrowUp:()=>k&&v(),Home:b,End:w}[L];Q&&(f.preventDefault(),Q(f))},[l,t,s,a]);return{...n,role:"tablist","aria-orientation":s,onKeyDown:kn(n.onKeyDown,d)}}function gMe(n){const{isDisabled:t=!1,isFocusable:s=!1,...a}=n,{setSelectedIndex:l,isManual:d,id:f,setFocusedIndex:y,selectedIndex:v}=D1(),{index:b,register:w}=hMe({disabled:t&&!s}),I=b===v,k=()=>{l(b)},L=()=>{y(b),!d&&!(t&&s)&&l(b)};return{...mne({...a,ref:Vi(w,n.ref),isDisabled:t,isFocusable:s,onClick:kn(n.onClick,k)}),id:zne(f,b),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":Gne(f,b),onFocus:t?void 0:kn(n.onFocus,L)}}const[_Me,yMe]=Oi({});function EMe(n){const t=D1(),{id:s,selectedIndex:a}=t,d=tF(n.children).map((f,y)=>D.createElement(_Me,{key:f.key??y,value:{isSelected:y===a,id:Gne(s,y),tabId:zne(s,y),selectedIndex:a}},f));return{...n,children:d}}function vMe(n){const{children:t,...s}=n,{isLazy:a,lazyBehavior:l}=D1(),{isSelected:d,id:f,tabId:y}=yMe(),v=D.useRef(!1);d&&(v.current=!0);const b=nF({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...s,children:b?t:null,role:"tabpanel","aria-labelledby":y,hidden:!d,id:f}}function zne(n,t){return`${n}--tab-${t}`}function Gne(n,t){return`${n}--tabpanel-${t}`}const[SMe,x1]=Oi({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),E0=Wt(function(t,s){const a=Za("Tabs",t),{children:l,className:d,...f}=Gi(t),{htmlProps:y,descendants:v,...b}=pMe(f),w=D.useMemo(()=>b,[b]),{isFitted:I,...k}=y,L={position:"relative",...a.root};return C.jsx(lMe,{value:v,children:C.jsx(fMe,{value:w,children:C.jsx(SMe,{value:a,children:C.jsx(Dt.div,{className:pn("chakra-tabs",d),ref:s,...k,__css:L,children:l})})})})});E0.displayName="Tabs";const ya=Wt(function(t,s){const a=x1(),l=gMe({...t,ref:s}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return C.jsx(Dt.button,{...l,className:pn("chakra-tabs__tab",t.className),__css:d})});ya.displayName="Tab";const v0=Wt(function(t,s){const a=mMe({...t,ref:s}),l=x1(),d={display:"flex",...l.tablist};return C.jsx(Dt.div,{...a,className:pn("chakra-tabs__tablist",t.className),__css:d})});v0.displayName="TabList";const Ec=Wt(function(t,s){const a=vMe({...t,ref:s}),l=x1();return C.jsx(Dt.div,{outline:"0",...a,className:pn("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});Ec.displayName="TabPanel";const kC=Wt(function(t,s){const a=EMe(t),l=x1();return C.jsx(Dt.div,{...a,width:"100%",ref:s,className:pn("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});kC.displayName="TabPanels";const[bMe,Hne]=Oi({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),$ne=Wt((n,t)=>{const s=Za("Tag",n),a=Gi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...s.container};return C.jsx(bMe,{value:s,children:C.jsx(Dt.span,{ref:t,...a,__css:l})})});$ne.displayName="Tag";const Kne=Wt((n,t)=>{const s=Hne();return C.jsx(Dt.span,{ref:t,noOfLines:1,...n,__css:s.label})});Kne.displayName="TagLabel";const TMe=Wt((n,t)=>C.jsx(yn,{ref:t,verticalAlign:"top",marginEnd:"0.5rem",...n}));TMe.displayName="TagLeftIcon";const wMe=Wt((n,t)=>C.jsx(yn,{ref:t,verticalAlign:"top",marginStart:"0.5rem",...n}));wMe.displayName="TagRightIcon";const qne=n=>C.jsx(yn,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:C.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});qne.displayName="TagCloseIcon";const Yne=Wt((n,t)=>{const{isDisabled:s,children:a,...l}=n,f={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...Hne().closeButton};return C.jsx(Dt.button,{ref:t,"aria-label":"close",...l,type:"button",disabled:s,__css:f,children:a||C.jsx(qne,{})})});Yne.displayName="TagCloseButton";const CMe=["h","minH","height","minHeight"],Xne=Wt((n,t)=>{const s=ju("Textarea",n),{className:a,rows:l,...d}=Gi(n),f=lj(d),y=l?N0(s,CMe):s;return C.jsx(Dt.textarea,{ref:t,rows:l,...f,className:pn("chakra-textarea",a),__css:y})});Xne.displayName="Textarea";function RMe(n,t){const s=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[s];return(l==null?void 0:l[t])??s}function IMe(n,t){const s=l=>({...t,...l,position:RMe((l==null?void 0:l.position)??(t==null?void 0:t.position),n)}),a=l=>{const d=s(l),f=pte(d);return jh.notify(f,d)};return a.update=(l,d)=>{jh.update(l,s(d))},a.promise=(l,d)=>{const f=a({...d.loading,status:"loading",duration:null});l.then(y=>a.update(f,{status:"success",duration:5e3,...cl(d.success,y)})).catch(y=>a.update(f,{status:"error",duration:5e3,...cl(d.error,y)}))},a.closeAll=jh.closeAll,a.close=jh.close,a.isActive=jh.isActive,a}function hl(n){const{theme:t}=ute(),s=N1e();return D.useMemo(()=>IMe(t.direction,{...s,...n}),[n,t.direction,s])}const AMe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},dV=n=>{var t;return((t=n.current)==null?void 0:t.ownerDocument)||document},nk=n=>{var t,s;return((s=(t=n.current)==null?void 0:t.ownerDocument)==null?void 0:s.defaultView)||window};function PMe(n={}){const{openDelay:t=0,closeDelay:s=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:f=l,closeOnEsc:y=!0,onOpen:v,onClose:b,placement:w,id:I,isOpen:k,defaultIsOpen:L,arrowSize:V=10,arrowShadowColor:B,arrowPadding:W,modifiers:Q,isDisabled:$,gutter:ie,offset:ce,direction:ne,...de}=n,{isOpen:Y,onOpen:X,onClose:Z}=Df({isOpen:k,defaultIsOpen:L,onOpen:v,onClose:b}),{referenceRef:se,getPopperProps:me,getArrowInnerProps:pe,getArrowProps:ue}=Dj({enabled:Y,placement:w,arrowPadding:W,modifiers:Q,gutter:ie,offset:ce,direction:ne}),Le=D.useId(),$e=`tooltip-${I??Le}`,ve=D.useRef(null),_e=D.useRef(void 0),Ee=D.useCallback(()=>{_e.current&&(clearTimeout(_e.current),_e.current=void 0)},[]),ke=D.useRef(void 0),Te=D.useCallback(()=>{ke.current&&(clearTimeout(ke.current),ke.current=void 0)},[]),be=D.useCallback(()=>{Te(),Z()},[Z,Te]),Pe=OMe(ve,be),xe=D.useCallback(()=>{if(!$&&!_e.current){Y&&Pe();const Ft=nk(ve);_e.current=Ft.setTimeout(X,t)}},[Pe,$,Y,X,t]),ze=D.useCallback(()=>{Ee();const Ft=nk(ve);ke.current=Ft.setTimeout(be,s)},[s,be,Ee]),Je=D.useCallback(()=>{Y&&a&&ze()},[a,ze,Y]),Ze=D.useCallback(()=>{Y&&f&&ze()},[f,ze,Y]),lt=D.useCallback(Ft=>{Y&&Ft.key==="Escape"&&ze()},[Y,ze]);Ey(()=>dV(ve),"keydown",y?lt:void 0),Ey(()=>{if(!d)return null;const Ft=ve.current;if(!Ft)return null;const on=BQ(Ft);return on.localName==="body"?nk(ve):on},"scroll",()=>{Y&&d&&be()},{passive:!0,capture:!0}),D.useEffect(()=>{$&&(Ee(),Y&&Z())},[$,Y,Z,Ee]),D.useEffect(()=>()=>{Ee(),Te()},[Ee,Te]),Ey(()=>ve.current,"pointerleave",ze);const nt=D.useCallback((Ft={},on=null)=>({...Ft,ref:Vi(ve,on,se),onPointerEnter:kn(Ft.onPointerEnter,Yt=>{Yt.pointerType!=="touch"&&xe()}),onClick:kn(Ft.onClick,Je),onPointerDown:kn(Ft.onPointerDown,Ze),onFocus:kn(Ft.onFocus,xe),onBlur:kn(Ft.onBlur,ze),"aria-describedby":Y?$e:void 0}),[xe,ze,Ze,Y,$e,Je,se]),Rt=D.useCallback((Ft={},on=null)=>me({...Ft,style:{...Ft.style,[no.arrowSize.var]:V?`${V}px`:void 0,[no.arrowShadowColor.var]:B}},on),[me,V,B]),fn=D.useCallback((Ft={},on=null)=>{const Zt={...Ft.style,position:"relative",transformOrigin:no.transformOrigin.varRef};return{ref:on,...de,...Ft,id:$e,role:"tooltip",style:Zt}},[de,$e]);return{isOpen:Y,show:xe,hide:ze,getTriggerProps:nt,getTooltipProps:fn,getTooltipPositionerProps:Rt,getArrowProps:ue,getArrowInnerProps:pe}}const GM="chakra-ui:close-tooltip";function OMe(n,t){return D.useEffect(()=>{const s=dV(n);return s.addEventListener(GM,t),()=>s.removeEventListener(GM,t)},[t,n]),()=>{const s=dV(n),a=nk(n);s.dispatchEvent(new a.CustomEvent(GM))}}const kMe=Dt(Gf.div),Pf=Wt((n,t)=>{const s=ju("Tooltip",n),a=Gi(n),l=U0(),{children:d,label:f,shouldWrapChildren:y,"aria-label":v,hasArrow:b,bg:w,portalProps:I,background:k,backgroundColor:L,bgColor:V,motionProps:B,animatePresenceProps:W,...Q}=a,$=k??L??w??V;if($){s.bg=$;const se=Ove(l,"colors",$);s[no.arrowBg.var]=se}const ie=PMe({...Q,direction:l.direction}),ce=!D.isValidElement(d)||y;let ne;if(ce)ne=C.jsx(Dt.span,{display:"inline-block",tabIndex:0,...ie.getTriggerProps(),children:d});else{const se=D.Children.only(d);ne=D.cloneElement(se,ie.getTriggerProps(se.props,xne(se)))}const de=!!v,Y=ie.getTooltipProps({},t),X=de?N0(Y,["role","id"]):Y,Z=jQ(Y,["role","id"]);return f?C.jsxs(C.Fragment,{children:[ne,C.jsx(x0,{...W,children:ie.isOpen&&C.jsx(Bu,{...I,children:C.jsx(Dt.div,{...ie.getTooltipPositionerProps(),__css:{zIndex:s.zIndex,pointerEvents:"none"},children:C.jsxs(kMe,{variants:AMe,initial:"exit",animate:"enter",exit:"exit",...B,...X,__css:s,children:[f,de&&C.jsx(Dt.span,{srOnly:!0,...Z,children:v}),b&&C.jsx(Dt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:C.jsx(Dt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:s.bg}})})]})})})})]}):C.jsx(C.Fragment,{children:d})});Pf.displayName="Tooltip";const NC=Wt(function(t,s){const a=ju("Heading",t),{className:l,...d}=Gi(t);return C.jsx(Dt.h2,{ref:s,className:pn("chakra-heading",t.className),...d,__css:a})});NC.displayName="Heading";const at=Wt(function(t,s){const a=ju("Text",t),{className:l,align:d,decoration:f,casing:y,...v}=Gi(t),b=a1({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return C.jsx(Dt.p,{ref:s,className:pn("chakra-text",t.className),...b,...v,__css:a})});at.displayName="Text";const Jne=Wt(function(t,s){const{spacing:a="0.5rem",spacingX:l,spacingY:d,children:f,justify:y,direction:v,align:b,className:w,shouldWrapChildren:I,...k}=t,L=D.useMemo(()=>I?D.Children.map(f,(V,B)=>C.jsx(Mj,{children:V},B)):f,[f,I]);return C.jsx(Dt.div,{ref:s,className:pn("chakra-wrap",w),...k,children:C.jsx(Dt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:y,alignItems:b,flexDirection:v,listStyleType:"none",gap:a,columnGap:l,rowGap:d,padding:"0"},children:L})})});Jne.displayName="Wrap";const Mj=Wt(function(t,s){const{className:a,...l}=t;return C.jsx(Dt.li,{ref:s,__css:{display:"flex",alignItems:"flex-start"},className:pn("chakra-wrap__listitem",a),...l})});Mj.displayName="WrapItem";const NMe="modulepreload",DMe=function(n,t){return new URL(n,t).href},YY={},HM=function(t,s,a){let l=Promise.resolve();if(s&&s.length>0){const f=document.getElementsByTagName("link"),y=document.querySelector("meta[property=csp-nonce]"),v=(y==null?void 0:y.nonce)||(y==null?void 0:y.getAttribute("nonce"));l=Promise.allSettled(s.map(b=>{if(b=DMe(b,a),b in YY)return;YY[b]=!0;const w=b.endsWith(".css"),I=w?'[rel="stylesheet"]':"";if(!!a)for(let V=f.length-1;V>=0;V--){const B=f[V];if(B.href===b&&(!w||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${I}`))return;const L=document.createElement("link");if(L.rel=w?"stylesheet":NMe,w||(L.as="script"),L.crossOrigin="",L.href=b,v&&L.setAttribute("nonce",v),document.head.appendChild(L),w)return new Promise((V,B)=>{L.addEventListener("load",V),L.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(f){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=f,window.dispatchEvent(y),!y.defaultPrevented)throw f}return l.then(f=>{for(const y of f||[])y.status==="rejected"&&d(y.reason);return t().catch(d)})},vO=()=>{const n=new Date,t=n.getHours().toString().padStart(2,"0"),s=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${t}:${s}:${a}.${l}`},J={log:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.log(`[LOG] [${vO()}] `,...t)}},error:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.error(`[ERROR] [${vO()}] `,...t)}},warn:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.warn(`[WARN] [${vO()}]`,...t)}},trace:n=>{console.trace(`[TRACE] [${vO()}] ${n}`)}};async function xMe(n){let t;try{switch(n){case"default":t=await HM(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:t=await HM(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return t.default}catch(s){return J.error("Failed to load theme:",s),t=await HM(()=>import("./index.v0.9.22.js"),[],import.meta.url),t.default}}const LMe=()=>{};var XY={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qne=function(n){const t=[];let s=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?t[s++]=l:l<2048?(t[s++]=l>>6|192,t[s++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),t[s++]=l>>18|240,t[s++]=l>>12&63|128,t[s++]=l>>6&63|128,t[s++]=l&63|128):(t[s++]=l>>12|224,t[s++]=l>>6&63|128,t[s++]=l&63|128)}return t},MMe=function(n){const t=[];let s=0,a=0;for(;s<n.length;){const l=n[s++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[s++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[s++],f=n[s++],y=n[s++],v=((l&7)<<18|(d&63)<<12|(f&63)<<6|y&63)-65536;t[a++]=String.fromCharCode(55296+(v>>10)),t[a++]=String.fromCharCode(56320+(v&1023))}else{const d=n[s++],f=n[s++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|f&63)}}return t.join("")},Zne={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const d=n[l],f=l+1<n.length,y=f?n[l+1]:0,v=l+2<n.length,b=v?n[l+2]:0,w=d>>2,I=(d&3)<<4|y>>4;let k=(y&15)<<2|b>>6,L=b&63;v||(L=64,f||(k=64)),a.push(s[w],s[I],s[k],s[L])}return a.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Qne(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):MMe(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const d=s[n.charAt(l++)],y=l<n.length?s[n.charAt(l)]:0;++l;const b=l<n.length?s[n.charAt(l)]:64;++l;const I=l<n.length?s[n.charAt(l)]:64;if(++l,d==null||y==null||b==null||I==null)throw new UMe;const k=d<<2|y>>4;if(a.push(k),b!==64){const L=y<<4&240|b>>2;if(a.push(L),I!==64){const V=b<<6&192|I;a.push(V)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class UMe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const VMe=function(n){const t=Qne(n);return Zne.encodeByteArray(t,!0)},xk=function(n){return VMe(n).replace(/\./g,"")},ere=function(n){try{return Zne.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FMe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jMe=()=>FMe().__FIREBASE_DEFAULTS__,BMe=()=>{if(typeof process>"u"||typeof XY>"u")return;const n=XY.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},WMe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&ere(n[1]);return t&&JSON.parse(t)},L1=()=>{try{return LMe()||jMe()||BMe()||WMe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},tre=n=>{var t,s;return(s=(t=L1())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[n]},nre=n=>{const t=tre(n);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(s+1),10);return t[0]==="["?[t.substring(1,s-1),a]:[t.substring(0,s),a]},rre=()=>{var n;return(n=L1())===null||n===void 0?void 0:n.config},ire=n=>{var t;return(t=L1())===null||t===void 0?void 0:t[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zMe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sre(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=t||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[xk(JSON.stringify(s)),xk(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qa(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function GMe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Qa())}function HMe(){var n;const t=(n=L1())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function $Me(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function KMe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function qMe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function YMe(){const n=Qa();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function XMe(){return!HMe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function JMe(){try{return typeof indexedDB=="object"}catch{return!1}}function QMe(){return new Promise((n,t)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),s||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{s=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZMe="FirebaseError";class up extends Error{constructor(t,s,a){super(s),this.code=t,this.customData=a,this.name=ZMe,Object.setPrototypeOf(this,up.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,tR.prototype.create)}}class tR{constructor(t,s,a){this.service=t,this.serviceName=s,this.errors=a}create(t,...s){const a=s[0]||{},l=`${this.service}/${t}`,d=this.errors[t],f=d?eUe(d,a):"Error",y=`${this.serviceName}: ${f} (${l}).`;return new up(l,y,a)}}function eUe(n,t){return n.replace(tUe,(s,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const tUe=/\{\$([^}]+)}/g;function nUe(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function Ff(n,t){if(n===t)return!0;const s=Object.keys(n),a=Object.keys(t);for(const l of s){if(!a.includes(l))return!1;const d=n[l],f=t[l];if(JY(d)&&JY(f)){if(!Ff(d,f))return!1}else if(d!==f)return!1}for(const l of a)if(!s.includes(l))return!1;return!0}function JY(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nR(n){const t=[];for(const[s,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function Fw(n){const t={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function jw(n){const t=n.indexOf("?");if(!t)return"";const s=n.indexOf("#",t);return n.substring(t,s>0?s:void 0)}function rUe(n,t){const s=new iUe(n,t);return s.subscribe.bind(s)}class iUe{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,a){let l;if(t===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");sUe(t,["next","error","complete"])?l=t:l={next:t,error:s,complete:a},l.next===void 0&&(l.next=$M),l.error===void 0&&(l.error=$M),l.complete===void 0&&(l.complete=$M);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function sUe(n,t){if(typeof n!="object"||n===null)return!1;for(const s of t)if(s in n&&typeof n[s]=="function")return!0;return!1}function $M(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ls(n){return n&&n._delegate?n._delegate:n}class wg{constructor(t,s,a){this.name=t,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oUe{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const a=new zMe;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:s});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(cUe(t))try{this.getOrInitializeService({instanceIdentifier:uy})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=uy){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=uy){return this.instances.has(t)}getOptions(t=uy){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[d,f]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(d);a===y&&f.resolve(l)}return l}onInit(t,s){var a;const l=this.normalizeInstanceIdentifier(s),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const f=this.instances.get(l);return f&&t(f,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,s){const a=this.onInitCallbacks.get(s);if(a)for(const l of a)try{l(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:aUe(t),options:s}),this.instances.set(t,a),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=uy){return this.component?this.component.multipleInstances?t:uy:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function aUe(n){return n===uy?void 0:n}function cUe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lUe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new oUe(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ar;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ar||(Ar={}));const uUe={debug:Ar.DEBUG,verbose:Ar.VERBOSE,info:Ar.INFO,warn:Ar.WARN,error:Ar.ERROR,silent:Ar.SILENT},dUe=Ar.INFO,hUe={[Ar.DEBUG]:"log",[Ar.VERBOSE]:"log",[Ar.INFO]:"info",[Ar.WARN]:"warn",[Ar.ERROR]:"error"},pUe=(n,t,...s)=>{if(t<n.logLevel)return;const a=new Date().toISOString(),l=hUe[t];if(l)console[l](`[${a}]  ${n.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Uj{constructor(t){this.name=t,this._logLevel=dUe,this._logHandler=pUe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Ar))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?uUe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Ar.DEBUG,...t),this._logHandler(this,Ar.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Ar.VERBOSE,...t),this._logHandler(this,Ar.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Ar.INFO,...t),this._logHandler(this,Ar.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Ar.WARN,...t),this._logHandler(this,Ar.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Ar.ERROR,...t),this._logHandler(this,Ar.ERROR,...t)}}const fUe=(n,t)=>t.some(s=>n instanceof s);let QY,ZY;function mUe(){return QY||(QY=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function gUe(){return ZY||(ZY=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ore=new WeakMap,hV=new WeakMap,are=new WeakMap,KM=new WeakMap,Vj=new WeakMap;function _Ue(n){const t=new Promise((s,a)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",f)},d=()=>{s(_g(n.result)),l()},f=()=>{a(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",f)});return t.then(s=>{s instanceof IDBCursor&&ore.set(s,n)}).catch(()=>{}),Vj.set(t,n),t}function yUe(n){if(hV.has(n))return;const t=new Promise((s,a)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",f),n.removeEventListener("abort",f)},d=()=>{s(),l()},f=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",f),n.addEventListener("abort",f)});hV.set(n,t)}let pV={get(n,t,s){if(n instanceof IDBTransaction){if(t==="done")return hV.get(n);if(t==="objectStoreNames")return n.objectStoreNames||are.get(n);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return _g(n[t])},set(n,t,s){return n[t]=s,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function EUe(n){pV=n(pV)}function vUe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const a=n.call(qM(this),t,...s);return are.set(a,t.sort?t.sort():[t]),_g(a)}:gUe().includes(n)?function(...t){return n.apply(qM(this),t),_g(ore.get(this))}:function(...t){return _g(n.apply(qM(this),t))}}function SUe(n){return typeof n=="function"?vUe(n):(n instanceof IDBTransaction&&yUe(n),fUe(n,mUe())?new Proxy(n,pV):n)}function _g(n){if(n instanceof IDBRequest)return _Ue(n);if(KM.has(n))return KM.get(n);const t=SUe(n);return t!==n&&(KM.set(n,t),Vj.set(t,n)),t}const qM=n=>Vj.get(n);function bUe(n,t,{blocked:s,upgrade:a,blocking:l,terminated:d}={}){const f=indexedDB.open(n,t),y=_g(f);return a&&f.addEventListener("upgradeneeded",v=>{a(_g(f.result),v.oldVersion,v.newVersion,_g(f.transaction),v)}),s&&f.addEventListener("blocked",v=>s(v.oldVersion,v.newVersion,v)),y.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),y}const TUe=["get","getKey","getAll","getAllKeys","count"],wUe=["put","add","delete","clear"],YM=new Map;function eX(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(YM.get(t))return YM.get(t);const s=t.replace(/FromIndex$/,""),a=t!==s,l=wUe.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(l||TUe.includes(s)))return;const d=async function(f,...y){const v=this.transaction(f,l?"readwrite":"readonly");let b=v.store;return a&&(b=b.index(y.shift())),(await Promise.all([b[s](...y),l&&v.done]))[0]};return YM.set(t,d),d}EUe(n=>({...n,get:(t,s,a)=>eX(t,s)||n.get(t,s,a),has:(t,s)=>!!eX(t,s)||n.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CUe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(RUe(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function RUe(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const fV="@firebase/app",tX="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jf=new Uj("@firebase/app"),IUe="@firebase/app-compat",AUe="@firebase/analytics-compat",PUe="@firebase/analytics",OUe="@firebase/app-check-compat",kUe="@firebase/app-check",NUe="@firebase/auth",DUe="@firebase/auth-compat",xUe="@firebase/database",LUe="@firebase/data-connect",MUe="@firebase/database-compat",UUe="@firebase/functions",VUe="@firebase/functions-compat",FUe="@firebase/installations",jUe="@firebase/installations-compat",BUe="@firebase/messaging",WUe="@firebase/messaging-compat",zUe="@firebase/performance",GUe="@firebase/performance-compat",HUe="@firebase/remote-config",$Ue="@firebase/remote-config-compat",KUe="@firebase/storage",qUe="@firebase/storage-compat",YUe="@firebase/firestore",XUe="@firebase/vertexai",JUe="@firebase/firestore-compat",QUe="firebase",ZUe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mV="[DEFAULT]",eVe={[fV]:"fire-core",[IUe]:"fire-core-compat",[PUe]:"fire-analytics",[AUe]:"fire-analytics-compat",[kUe]:"fire-app-check",[OUe]:"fire-app-check-compat",[NUe]:"fire-auth",[DUe]:"fire-auth-compat",[xUe]:"fire-rtdb",[LUe]:"fire-data-connect",[MUe]:"fire-rtdb-compat",[UUe]:"fire-fn",[VUe]:"fire-fn-compat",[FUe]:"fire-iid",[jUe]:"fire-iid-compat",[BUe]:"fire-fcm",[WUe]:"fire-fcm-compat",[zUe]:"fire-perf",[GUe]:"fire-perf-compat",[HUe]:"fire-rc",[$Ue]:"fire-rc-compat",[KUe]:"fire-gcs",[qUe]:"fire-gcs-compat",[YUe]:"fire-fst",[JUe]:"fire-fst-compat",[XUe]:"fire-vertex","fire-js":"fire-js",[QUe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lk=new Map,tVe=new Map,gV=new Map;function nX(n,t){try{n.container.addComponent(t)}catch(s){jf.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,s)}}function Uy(n){const t=n.name;if(gV.has(t))return jf.debug(`There were multiple attempts to register component ${t}.`),!1;gV.set(t,n);for(const s of Lk.values())nX(s,n);for(const s of tVe.values())nX(s,n);return!0}function M1(n,t){const s=n.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),n.container.getProvider(t)}function Ml(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nVe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},yg=new tR("app","Firebase",nVe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rVe{constructor(t,s,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new wg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw yg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $y=ZUe;function cre(n,t={}){let s=n;typeof t!="object"&&(t={name:t});const a=Object.assign({name:mV,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw yg.create("bad-app-name",{appName:String(l)});if(s||(s=rre()),!s)throw yg.create("no-options");const d=Lk.get(l);if(d){if(Ff(s,d.options)&&Ff(a,d.config))return d;throw yg.create("duplicate-app",{appName:l})}const f=new lUe(l);for(const v of gV.values())f.addComponent(v);const y=new rVe(s,a,f);return Lk.set(l,y),y}function Fj(n=mV){const t=Lk.get(n);if(!t&&n===mV&&rre())return cre();if(!t)throw yg.create("no-app",{appName:n});return t}function ep(n,t,s){var a;let l=(a=eVe[n])!==null&&a!==void 0?a:n;s&&(l+=`-${s}`);const d=l.match(/\s|\//),f=t.match(/\s|\//);if(d||f){const y=[`Unable to register library "${l}" with version "${t}":`];d&&y.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&f&&y.push("and"),f&&y.push(`version name "${t}" contains illegal characters (whitespace or "/")`),jf.warn(y.join(" "));return}Uy(new wg(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iVe="firebase-heartbeat-database",sVe=1,DC="firebase-heartbeat-store";let XM=null;function lre(){return XM||(XM=bUe(iVe,sVe,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(DC)}catch(s){console.warn(s)}}}}).catch(n=>{throw yg.create("idb-open",{originalErrorMessage:n.message})})),XM}async function oVe(n){try{const s=(await lre()).transaction(DC),a=await s.objectStore(DC).get(ure(n));return await s.done,a}catch(t){if(t instanceof up)jf.warn(t.message);else{const s=yg.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});jf.warn(s.message)}}}async function rX(n,t){try{const a=(await lre()).transaction(DC,"readwrite");await a.objectStore(DC).put(t,ure(n)),await a.done}catch(s){if(s instanceof up)jf.warn(s.message);else{const a=yg.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});jf.warn(a.message)}}}function ure(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aVe=1024,cVe=30;class lVe{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new dVe(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,s;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=iX();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(f=>f.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>cVe){const f=hVe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){jf.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=iX(),{heartbeatsToSend:a,unsentEntries:l}=uVe(this._heartbeatsCache.heartbeats),d=xk(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(s){return jf.warn(s),""}}}function iX(){return new Date().toISOString().substring(0,10)}function uVe(n,t=aVe){const s=[];let a=n.slice();for(const l of n){const d=s.find(f=>f.agent===l.agent);if(d){if(d.dates.push(l.date),sX(s)>t){d.dates.pop();break}}else if(s.push({agent:l.agent,dates:[l.date]}),sX(s)>t){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class dVe{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return JMe()?QMe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await oVe(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return rX(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return rX(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function sX(n){return xk(JSON.stringify({version:2,heartbeats:n})).length}function hVe(n){if(n.length===0)return-1;let t=0,s=n[0].date;for(let a=1;a<n.length;a++)n[a].date<s&&(s=n[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pVe(n){Uy(new wg("platform-logger",t=>new CUe(t),"PRIVATE")),Uy(new wg("heartbeat",t=>new lVe(t),"PRIVATE")),ep(fV,tX,n),ep(fV,tX,"esm2017"),ep("fire-js","")}pVe("");function dre(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const fVe=dre,hre=new tR("auth","Firebase",dre());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mk=new Uj("@firebase/auth");function mVe(n,...t){Mk.logLevel<=Ar.WARN&&Mk.warn(`Auth (${$y}): ${n}`,...t)}function rk(n,...t){Mk.logLevel<=Ar.ERROR&&Mk.error(`Auth (${$y}): ${n}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ld(n,...t){throw jj(n,...t)}function tp(n,...t){return jj(n,...t)}function pre(n,t,s){const a=Object.assign(Object.assign({},fVe()),{[t]:s});return new tR("auth","Firebase",a).create(t,{appName:n.name})}function Of(n){return pre(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function jj(n,...t){if(typeof n!="string"){const s=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(s,...a)}return hre.create(n,...t)}function Wn(n,t,...s){if(!n)throw jj(t,...s)}function Sf(n){const t="INTERNAL ASSERTION FAILED: "+n;throw rk(t),new Error(t)}function Bf(n,t){n||Sf(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _V(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function gVe(){return oX()==="http:"||oX()==="https:"}function oX(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _Ve(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(gVe()||KMe()||"connection"in navigator)?navigator.onLine:!0}function yVe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{constructor(t,s){this.shortDelay=t,this.longDelay=s,Bf(s>t,"Short delay should be less than long delay!"),this.isMobile=GMe()||qMe()}get(){return _Ve()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bj(n,t){Bf(n.emulator,"Emulator should always be set here");const{url:s}=n.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fre{static initialize(t,s,a){this.fetchImpl=t,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Sf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Sf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Sf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EVe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vVe=new rR(3e4,6e4);function Hf(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}async function $f(n,t,s,a,l={}){return mre(n,l,async()=>{let d={},f={};a&&(t==="GET"?f=a:d={body:JSON.stringify(a)});const y=nR(Object.assign({key:n.config.apiKey},f)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:t,headers:v},d);return $Me()||(b.referrerPolicy="no-referrer"),fre.fetch()(gre(n,n.config.apiHost,s,y),b)})}async function mre(n,t,s){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},EVe),t);try{const l=new bVe(n),d=await Promise.race([s(),l.promise]);l.clearNetworkTimeout();const f=await d.json();if("needConfirmation"in f)throw SO(n,"account-exists-with-different-credential",f);if(d.ok&&!("errorMessage"in f))return f;{const y=d.ok?f.errorMessage:f.error.message,[v,b]=y.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw SO(n,"credential-already-in-use",f);if(v==="EMAIL_EXISTS")throw SO(n,"email-already-in-use",f);if(v==="USER_DISABLED")throw SO(n,"user-disabled",f);const w=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw pre(n,w,b);Ld(n,w)}}catch(l){if(l instanceof up)throw l;Ld(n,"network-request-failed",{message:String(l)})}}async function iR(n,t,s,a,l={}){const d=await $f(n,t,s,a,l);return"mfaPendingCredential"in d&&Ld(n,"multi-factor-auth-required",{_serverResponse:d}),d}function gre(n,t,s,a){const l=`${t}${s}?${a}`;return n.config.emulator?Bj(n.config,l):`${n.config.apiScheme}://${l}`}function SVe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class bVe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(tp(this.auth,"network-request-failed")),vVe.get())})}}function SO(n,t,s){const a={appName:n.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const l=tp(n,t,a);return l.customData._tokenResponse=s,l}function aX(n){return n!==void 0&&n.enterprise!==void 0}class TVe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===t)return SVe(s.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function wVe(n,t){return $f(n,"GET","/v2/recaptchaConfig",Hf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CVe(n,t){return $f(n,"POST","/v1/accounts:delete",t)}async function _re(n,t){return $f(n,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oC(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function RVe(n,t=!1){const s=ls(n),a=await s.getIdToken(t),l=Wj(a);Wn(l&&l.exp&&l.auth_time&&l.iat,s.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,f=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:oC(JM(l.auth_time)),issuedAtTime:oC(JM(l.iat)),expirationTime:oC(JM(l.exp)),signInProvider:f||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function JM(n){return Number(n)*1e3}function Wj(n){const[t,s,a]=n.split(".");if(t===void 0||s===void 0||a===void 0)return rk("JWT malformed, contained fewer than 3 sections"),null;try{const l=ere(s);return l?JSON.parse(l):(rk("Failed to decode base64 JWT payload"),null)}catch(l){return rk("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function cX(n){const t=Wj(n);return Wn(t,"internal-error"),Wn(typeof t.exp<"u","internal-error"),Wn(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xC(n,t,s=!1){if(s)return t;try{return await t}catch(a){throw a instanceof up&&IVe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function IVe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AVe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yV{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=oC(this.lastLoginAt),this.creationTime=oC(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uk(n){var t;const s=n.auth,a=await n.getIdToken(),l=await xC(n,_re(s,{idToken:a}));Wn(l==null?void 0:l.users.length,s,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const f=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?yre(d.providerUserInfo):[],y=OVe(n.providerData,f),v=n.isAnonymous,b=!(n.email&&d.passwordHash)&&!(y!=null&&y.length),w=v?b:!1,I={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:y,metadata:new yV(d.createdAt,d.lastLoginAt),isAnonymous:w};Object.assign(n,I)}async function PVe(n){const t=ls(n);await Uk(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function OVe(n,t){return[...n.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function yre(n){return n.map(t=>{var{providerId:s}=t,a=JC(t,["providerId"]);return{providerId:s,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kVe(n,t){const s=await mre(n,{},async()=>{const a=nR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,f=gre(n,l,"/v1/token",`key=${d}`),y=await n._getAdditionalHeaders();return y["Content-Type"]="application/x-www-form-urlencoded",fre.fetch()(f,{method:"POST",headers:y,body:a})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function NVe(n,t){return $f(n,"POST","/v2/accounts:revokeToken",Hf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Wn(t.idToken,"internal-error"),Wn(typeof t.idToken<"u","internal-error"),Wn(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):cX(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){Wn(t.length!==0,"internal-error");const s=cX(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Wn(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:a,refreshToken:l,expiresIn:d}=await kVe(t,s);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,s,a){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,s){const{refreshToken:a,accessToken:l,expirationTime:d}=s,f=new n0;return a&&(Wn(typeof a=="string","internal-error",{appName:t}),f.refreshToken=a),l&&(Wn(typeof l=="string","internal-error",{appName:t}),f.accessToken=l),d&&(Wn(typeof d=="number","internal-error",{appName:t}),f.expirationTime=d),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new n0,this.toJSON())}_performRefresh(){return Sf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ig(n,t){Wn(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class bf{constructor(t){var{uid:s,auth:a,stsTokenManager:l}=t,d=JC(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new AVe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new yV(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const s=await xC(this,this.stsTokenManager.getToken(this.auth,t));return Wn(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return RVe(this,t)}reload(){return PVe(this)}_assign(t){this!==t&&(Wn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new bf(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){Wn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),s&&await Uk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ml(this.auth.app))return Promise.reject(Of(this.auth));const t=await this.getIdToken();return await xC(this,CVe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var a,l,d,f,y,v,b,w;const I=(a=s.displayName)!==null&&a!==void 0?a:void 0,k=(l=s.email)!==null&&l!==void 0?l:void 0,L=(d=s.phoneNumber)!==null&&d!==void 0?d:void 0,V=(f=s.photoURL)!==null&&f!==void 0?f:void 0,B=(y=s.tenantId)!==null&&y!==void 0?y:void 0,W=(v=s._redirectEventId)!==null&&v!==void 0?v:void 0,Q=(b=s.createdAt)!==null&&b!==void 0?b:void 0,$=(w=s.lastLoginAt)!==null&&w!==void 0?w:void 0,{uid:ie,emailVerified:ce,isAnonymous:ne,providerData:de,stsTokenManager:Y}=s;Wn(ie&&Y,t,"internal-error");const X=n0.fromJSON(this.name,Y);Wn(typeof ie=="string",t,"internal-error"),ig(I,t.name),ig(k,t.name),Wn(typeof ce=="boolean",t,"internal-error"),Wn(typeof ne=="boolean",t,"internal-error"),ig(L,t.name),ig(V,t.name),ig(B,t.name),ig(W,t.name),ig(Q,t.name),ig($,t.name);const Z=new bf({uid:ie,auth:t,email:k,emailVerified:ce,displayName:I,isAnonymous:ne,photoURL:V,phoneNumber:L,tenantId:B,stsTokenManager:X,createdAt:Q,lastLoginAt:$});return de&&Array.isArray(de)&&(Z.providerData=de.map(se=>Object.assign({},se))),W&&(Z._redirectEventId=W),Z}static async _fromIdTokenResponse(t,s,a=!1){const l=new n0;l.updateFromServerResponse(s);const d=new bf({uid:s.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await Uk(d),d}static async _fromGetAccountInfoResponse(t,s,a){const l=s.users[0];Wn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?yre(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),y=new n0;y.updateFromIdToken(a);const v=new bf({uid:l.localId,auth:t,stsTokenManager:y,isAnonymous:f}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new yV(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,b),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lX=new Map;function Tf(n){Bf(n instanceof Function,"Expected a class definition");let t=lX.get(n);return t?(Bf(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,lX.set(n,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ere{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}Ere.type="NONE";const uX=Ere;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ik(n,t,s){return`firebase:${n}:${t}:${s}`}class r0{constructor(t,s,a){this.persistence=t,this.auth=s,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=ik(this.userKey,l.apiKey,d),this.fullPersistenceKey=ik("persistence",l.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?bf._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,a="authUser"){if(!s.length)return new r0(Tf(uX),t,a);const l=(await Promise.all(s.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||Tf(uX);const f=ik(a,t.config.apiKey,t.name);let y=null;for(const b of s)try{const w=await b._get(f);if(w){const I=bf._fromJSON(t,w);b!==d&&(y=I),d=b;break}}catch{}const v=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new r0(d,t,a):(d=v[0],y&&await d._set(f,y.toJSON()),await Promise.all(s.map(async b=>{if(b!==d)try{await b._remove(f)}catch{}})),new r0(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dX(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Tre(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(vre(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Cre(t))return"Blackberry";if(Rre(t))return"Webos";if(Sre(t))return"Safari";if((t.includes("chrome/")||bre(t))&&!t.includes("edge/"))return"Chrome";if(wre(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function vre(n=Qa()){return/firefox\//i.test(n)}function Sre(n=Qa()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function bre(n=Qa()){return/crios\//i.test(n)}function Tre(n=Qa()){return/iemobile/i.test(n)}function wre(n=Qa()){return/android/i.test(n)}function Cre(n=Qa()){return/blackberry/i.test(n)}function Rre(n=Qa()){return/webos/i.test(n)}function zj(n=Qa()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function DVe(n=Qa()){var t;return zj(n)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function xVe(){return YMe()&&document.documentMode===10}function Ire(n=Qa()){return zj(n)||wre(n)||Rre(n)||Cre(n)||/windows phone/i.test(n)||Tre(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Are(n,t=[]){let s;switch(n){case"Browser":s=dX(Qa());break;case"Worker":s=`${dX(Qa())}-${n}`;break;default:s=n}const a=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${$y}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LVe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const a=d=>new Promise((f,y)=>{try{const v=t(d);f(v)}catch(v){y(v)}});a.onAbort=s,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const a of this.queue)await a(t),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const l of s)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MVe(n,t={}){return $f(n,"GET","/v2/passwordPolicy",Hf(n,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UVe=6;class VVe{constructor(t){var s,a,l,d;const f=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=f.minPasswordLength)!==null&&s!==void 0?s:UVe,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,a,l,d,f,y;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,v),this.validatePasswordCharacterOptions(t,v),v.isValid&&(v.isValid=(s=v.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(f=v.containsNumericCharacter)!==null&&f!==void 0?f:!0),v.isValid&&(v.isValid=(y=v.containsNonAlphanumericCharacter)!==null&&y!==void 0?y:!0),v}validatePasswordLengthOptions(t,s){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=t.length>=a),l&&(s.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,s,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FVe{constructor(t,s,a,l){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hX(this),this.idTokenSubscription=new hX(this),this.beforeStateQueue=new LVe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=hre,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=Tf(s)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await r0.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await _re(this,{idToken:t}),a=await bf._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(Ml(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(y,y))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,y=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(t);(!f||f===y)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Wn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await Uk(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=yVe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Ml(this.app))return Promise.reject(Of(this));const s=t?ls(t):null;return s&&Wn(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&Wn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Ml(this.app)?Promise.reject(Of(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Ml(this.app)?Promise.reject(Of(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Tf(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await MVe(this),s=new VVe(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new tR("auth","Firebase",t())}onAuthStateChanged(t,s,a){return this.registerStateListener(this.authStateSubscription,t,s,a)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,a){return this.registerStateListener(this.idTokenSubscription,t,s,a)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await NVe(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const a=await this.getOrInitRedirectPersistenceManager(s);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&Tf(t)||this._popupRedirectResolver;Wn(s,this,"argument-error"),this.redirectPersistenceManager=await r0.create(this,[Tf(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,a,l){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s);let f=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(Wn(y,this,"internal-error"),y.then(()=>{f||d(this.currentUser)}),typeof s=="function"){const v=t.addObserver(s,a,l);return()=>{f=!0,v()}}else{const v=t.addObserver(s);return()=>{f=!0,v()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Wn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Are(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(s["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(s["X-Firebase-AppCheck"]=l),s}async _getAppCheckToken(){var t;if(Ml(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&mVe(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function Mg(n){return ls(n)}class hX{constructor(t){this.auth=t,this.observer=null,this.addObserver=rUe(s=>this.observer=s)}get next(){return Wn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let U1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function jVe(n){U1=n}function Pre(n){return U1.loadJS(n)}function BVe(){return U1.recaptchaEnterpriseScript}function WVe(){return U1.gapiScript}function zVe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class GVe{constructor(){this.enterprise=new HVe}ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}class HVe{ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}const $Ve="recaptcha-enterprise",Ore="NO_RECAPTCHA";class KVe{constructor(t){this.type=$Ve,this.auth=Mg(t)}async verify(t="verify",s=!1){async function a(d){if(!s){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(f,y)=>{wVe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)y(new Error("recaptcha Enterprise site key undefined"));else{const b=new TVe(v);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,f(b.siteKey)}}).catch(v=>{y(v)})})}function l(d,f,y){const v=window.grecaptcha;aX(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:t}).then(b=>{f(b)}).catch(()=>{f(Ore)})}):y(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new GVe().execute("siteKey",{action:"verify"}):new Promise((d,f)=>{a(this.auth).then(y=>{if(!s&&aX(window.grecaptcha))l(y,d,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let v=BVe();v.length!==0&&(v+=y),Pre(v).then(()=>{l(y,d,f)}).catch(b=>{f(b)})}}).catch(y=>{f(y)})})}}async function pX(n,t,s,a=!1,l=!1){const d=new KVe(n);let f;if(l)f=Ore;else try{f=await d.verify(s)}catch{f=await d.verify(s,!0)}const y=Object.assign({},t);if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in y){const v=y.phoneEnrollmentInfo.phoneNumber,b=y.phoneEnrollmentInfo.recaptchaToken;Object.assign(y,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in y){const v=y.phoneSignInInfo.recaptchaToken;Object.assign(y,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return y}return a?Object.assign(y,{captchaResp:f}):Object.assign(y,{captchaResponse:f}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function Vk(n,t,s,a,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await pX(n,t,s,s==="getOobCode");return a(n,f)}else return a(n,t).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const y=await pX(n,t,s,s==="getOobCode");return a(n,y)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qVe(n,t){const s=M1(n,"auth");if(s.isInitialized()){const l=s.getImmediate(),d=s.getOptions();if(Ff(d,t??{}))return l;Ld(l,"already-initialized")}return s.initialize({options:t})}function YVe(n,t){const s=(t==null?void 0:t.persistence)||[],a=(Array.isArray(s)?s:[s]).map(Tf);t!=null&&t.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function XVe(n,t,s){const a=Mg(n);Wn(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=kre(t),{host:f,port:y}=JVe(t),v=y===null?"":`:${y}`,b={url:`${d}//${f}${v}/`},w=Object.freeze({host:f,port:y,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Wn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Wn(Ff(b,a.config.emulator)&&Ff(w,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=w,a.settings.appVerificationDisabledForTesting=!0,QVe()}function kre(n){const t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function JVe(n){const t=kre(n),s=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:fX(a.substr(d.length+1))}}else{const[d,f]=a.split(":");return{host:d,port:fX(f)}}}function fX(n){if(!n)return null;const t=Number(n);return isNaN(t)?null:t}function QVe(){function n(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gj{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return Sf("not implemented")}_getIdTokenResponse(t){return Sf("not implemented")}_linkToIdToken(t,s){return Sf("not implemented")}_getReauthenticationResolver(t){return Sf("not implemented")}}async function ZVe(n,t){return $f(n,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eFe(n,t){return iR(n,"POST","/v1/accounts:signInWithPassword",Hf(n,t))}async function Nre(n,t){return $f(n,"POST","/v1/accounts:sendOobCode",Hf(n,t))}async function tFe(n,t){return Nre(n,t)}async function nFe(n,t){return Nre(n,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rFe(n,t){return iR(n,"POST","/v1/accounts:signInWithEmailLink",Hf(n,t))}async function iFe(n,t){return iR(n,"POST","/v1/accounts:signInWithEmailLink",Hf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LC extends Gj{constructor(t,s,a,l=null){super("password",a),this._email=t,this._password=s,this._tenantId=l}static _fromEmailAndPassword(t,s){return new LC(t,s,"password")}static _fromEmailAndCode(t,s,a=null){return new LC(t,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Vk(t,s,"signInWithPassword",eFe);case"emailLink":return rFe(t,{email:this._email,oobCode:this._password});default:Ld(t,"internal-error")}}async _linkToIdToken(t,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Vk(t,a,"signUpPassword",ZVe);case"emailLink":return iFe(t,{idToken:s,email:this._email,oobCode:this._password});default:Ld(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i0(n,t){return iR(n,"POST","/v1/accounts:signInWithIdp",Hf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sFe="http://localhost";class Vy extends Gj{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new Vy(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):Ld("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=s,d=JC(s,["providerId","signInMethod"]);if(!a||!l)return null;const f=new Vy(a,l);return f.idToken=d.idToken||void 0,f.accessToken=d.accessToken||void 0,f.secret=d.secret,f.nonce=d.nonce,f.pendingToken=d.pendingToken||null,f}_getIdTokenResponse(t){const s=this.buildRequest();return i0(t,s)}_linkToIdToken(t,s){const a=this.buildRequest();return a.idToken=s,i0(t,a)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,i0(t,s)}buildRequest(){const t={requestUri:sFe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=nR(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oFe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function aFe(n){const t=Fw(jw(n)).link,s=t?Fw(jw(t)).deep_link_id:null,a=Fw(jw(n)).deep_link_id;return(a?Fw(jw(a)).link:null)||a||s||t||n}class Hj{constructor(t){var s,a,l,d,f,y;const v=Fw(jw(t)),b=(s=v.apiKey)!==null&&s!==void 0?s:null,w=(a=v.oobCode)!==null&&a!==void 0?a:null,I=oFe((l=v.mode)!==null&&l!==void 0?l:null);Wn(b&&w&&I,"argument-error"),this.apiKey=b,this.operation=I,this.code=w,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(f=v.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(y=v.tenantId)!==null&&y!==void 0?y:null}static parseLink(t){const s=aFe(t);try{return new Hj(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(){this.providerId=B0.PROVIDER_ID}static credential(t,s){return LC._fromEmailAndPassword(t,s)}static credentialWithLink(t,s){const a=Hj.parseLink(s);return Wn(a,"argument-error"),LC._fromEmailAndCode(t,a.code,a.tenantId)}}B0.PROVIDER_ID="password";B0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";B0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dre{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR extends Dre{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg extends sR{constructor(){super("facebook.com")}static credential(t){return Vy._fromParams({providerId:lg.PROVIDER_ID,signInMethod:lg.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return lg.credentialFromTaggedObject(t)}static credentialFromError(t){return lg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return lg.credential(t.oauthAccessToken)}catch{return null}}}lg.FACEBOOK_SIGN_IN_METHOD="facebook.com";lg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug extends sR{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return Vy._fromParams({providerId:ug.PROVIDER_ID,signInMethod:ug.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return ug.credentialFromTaggedObject(t)}static credentialFromError(t){return ug.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:a}=t;if(!s&&!a)return null;try{return ug.credential(s,a)}catch{return null}}}ug.GOOGLE_SIGN_IN_METHOD="google.com";ug.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg extends sR{constructor(){super("github.com")}static credential(t){return Vy._fromParams({providerId:dg.PROVIDER_ID,signInMethod:dg.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return dg.credentialFromTaggedObject(t)}static credentialFromError(t){return dg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return dg.credential(t.oauthAccessToken)}catch{return null}}}dg.GITHUB_SIGN_IN_METHOD="github.com";dg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg extends sR{constructor(){super("twitter.com")}static credential(t,s){return Vy._fromParams({providerId:hg.PROVIDER_ID,signInMethod:hg.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return hg.credentialFromTaggedObject(t)}static credentialFromError(t){return hg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=t;if(!s||!a)return null;try{return hg.credential(s,a)}catch{return null}}}hg.TWITTER_SIGN_IN_METHOD="twitter.com";hg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cFe(n,t){return iR(n,"POST","/v1/accounts:signUp",Hf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fy{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,a,l=!1){const d=await bf._fromIdTokenResponse(t,a,l),f=mX(a);return new Fy({user:d,providerId:f,_tokenResponse:a,operationType:s})}static async _forOperation(t,s,a){await t._updateTokensIfNecessary(a,!0);const l=mX(a);return new Fy({user:t,providerId:l,_tokenResponse:a,operationType:s})}}function mX(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk extends up{constructor(t,s,a,l){var d;super(s.code,s.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,Fk.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,s,a,l){return new Fk(t,s,a,l)}}function xre(n,t,s,a){return(t==="reauthenticate"?s._getReauthenticationResolver(n):s._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?Fk._fromErrorAndOperation(n,d,t,a):d})}async function lFe(n,t,s=!1){const a=await xC(n,t._linkToIdToken(n.auth,await n.getIdToken()),s);return Fy._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uFe(n,t,s=!1){const{auth:a}=n;if(Ml(a.app))return Promise.reject(Of(a));const l="reauthenticate";try{const d=await xC(n,xre(a,l,t,n),s);Wn(d.idToken,a,"internal-error");const f=Wj(d.idToken);Wn(f,a,"internal-error");const{sub:y}=f;return Wn(n.uid===y,a,"user-mismatch"),Fy._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Ld(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lre(n,t,s=!1){if(Ml(n.app))return Promise.reject(Of(n));const a="signIn",l=await xre(n,a,t),d=await Fy._fromIdTokenResponse(n,a,l);return s||await n._updateCurrentUser(d.user),d}async function dFe(n,t){return Lre(Mg(n),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mre(n){const t=Mg(n);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function hFe(n,t,s){const a=Mg(n);await Vk(a,{requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"},"getOobCode",nFe)}async function pFe(n,t,s){if(Ml(n.app))return Promise.reject(Of(n));const a=Mg(n),f=await Vk(a,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",cFe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&Mre(n),v}),y=await Fy._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(y.user),y}function fFe(n,t,s){return Ml(n.app)?Promise.reject(Of(n)):dFe(ls(n),B0.credential(t,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&Mre(n),a})}async function Ure(n,t){const s=ls(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await tFe(s.auth,l);d!==n.email&&await n.reload()}function mFe(n,t,s,a){return ls(n).onIdTokenChanged(t,s,a)}function gFe(n,t,s){return ls(n).beforeAuthStateChanged(t,s)}function _Fe(n,t,s,a){return ls(n).onAuthStateChanged(t,s,a)}function yFe(n){return ls(n).signOut()}const jk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vre{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(jk,"1"),this.storage.removeItem(jk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EFe=1e3,vFe=10;class Fre extends Vre{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ire(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),l=this.localCache[s];a!==l&&t(s,l,a)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((f,y,v)=>{this.notifyListeners(f,v)});return}const a=t.key;s?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!s&&this.localCache[a]===f||this.notifyListeners(a,f)},d=this.storage.getItem(a);xVe()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,vFe):l()}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:a}),!0)})},EFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}Fre.type="LOCAL";const SFe=Fre;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jre extends Vre{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}jre.type="SESSION";const Bre=jre;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bFe(n){return Promise.all(n.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V1{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(l=>l.isListeningto(t));if(s)return s;const a=new V1(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:a,eventType:l,data:d}=s.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const y=Array.from(f).map(async b=>b(s.origin,d)),v=await bFe(y);s.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}V1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $j(n="",t=10){let s="";for(let a=0;a<t;a++)s+=Math.floor(Math.random()*10);return n+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TFe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,f;return new Promise((y,v)=>{const b=$j("",20);l.port1.start();const w=setTimeout(()=>{v(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(I){const k=I;if(k.data.eventId===b)switch(k.data.status){case"ack":clearTimeout(w),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),y(k.data.response);break;default:clearTimeout(w),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:t,eventId:b,data:s},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function np(){return window}function wFe(n){np().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wre(){return typeof np().WorkerGlobalScope<"u"&&typeof np().importScripts=="function"}async function CFe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function RFe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function IFe(){return Wre()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zre="firebaseLocalStorageDb",AFe=1,Bk="firebaseLocalStorage",Gre="fbase_key";class oR{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function F1(n,t){return n.transaction([Bk],t?"readwrite":"readonly").objectStore(Bk)}function PFe(){const n=indexedDB.deleteDatabase(zre);return new oR(n).toPromise()}function EV(){const n=indexedDB.open(zre,AFe);return new Promise((t,s)=>{n.addEventListener("error",()=>{s(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(Bk,{keyPath:Gre})}catch(l){s(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(Bk)?t(a):(a.close(),await PFe(),t(await EV()))})})}async function gX(n,t,s){const a=F1(n,!0).put({[Gre]:t,value:s});return new oR(a).toPromise()}async function OFe(n,t){const s=F1(n,!1).get(t),a=await new oR(s).toPromise();return a===void 0?null:a.value}function _X(n,t){const s=F1(n,!0).delete(t);return new oR(s).toPromise()}const kFe=800,NFe=3;class Hre{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await EV(),this.db)}async _withRetries(t){let s=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(s++>NFe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Wre()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=V1._getInstance(IFe()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await CFe(),!this.activeServiceWorker)return;this.sender=new TFe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((s=a[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||RFe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await EV();return await gX(t,jk,"1"),await _X(t,jk),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>gX(a,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(a=>OFe(a,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>_X(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=F1(l,!1).getAll();return new oR(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),s.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),s.push(l));return s}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),kFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Hre.type="LOCAL";const DFe=Hre;new rR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xFe(n,t){return t?Tf(t):(Wn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kj extends Gj{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return i0(t,this._buildIdpRequest())}_linkToIdToken(t,s){return i0(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return i0(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function LFe(n){return Lre(n.auth,new Kj(n),n.bypassAuthState)}function MFe(n){const{auth:t,user:s}=n;return Wn(s,t,"internal-error"),uFe(s,new Kj(n),n.bypassAuthState)}async function UFe(n){const{auth:t,user:s}=n;return Wn(s,t,"internal-error"),lFe(s,new Kj(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $re{constructor(t,s,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:a,postBody:l,tenantId:d,error:f,type:y}=t;if(f){this.reject(f);return}const v={auth:this.auth,requestUri:s,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(v))}catch(b){this.reject(b)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return LFe;case"linkViaPopup":case"linkViaRedirect":return UFe;case"reauthViaPopup":case"reauthViaRedirect":return MFe;default:Ld(this.auth,"internal-error")}}resolve(t){Bf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Bf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VFe=new rR(2e3,1e4);class BS extends $re{constructor(t,s,a,l,d){super(t,s,l,d),this.provider=a,this.authWindow=null,this.pollId=null,BS.currentPopupAction&&BS.currentPopupAction.cancel(),BS.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Wn(t,this.auth,"internal-error"),t}async onExecution(){Bf(this.filter.length===1,"Popup operations only handle one event");const t=$j();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(tp(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(tp(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,BS.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,a;if(!((a=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tp(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,VFe.get())};t()}}BS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FFe="pendingRedirect",sk=new Map;class jFe extends $re{constructor(t,s,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let t=sk.get(this.auth._key());if(!t){try{const a=await BFe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(s){t=()=>Promise.reject(s)}sk.set(this.auth._key(),t)}return this.bypassAuthState||sk.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function BFe(n,t){const s=GFe(t),a=zFe(n);if(!await a._isAvailable())return!1;const l=await a._get(s)==="true";return await a._remove(s),l}function WFe(n,t){sk.set(n._key(),t)}function zFe(n){return Tf(n._redirectPersistence)}function GFe(n){return ik(FFe,n.config.apiKey,n.name)}async function HFe(n,t,s=!1){if(Ml(n.app))return Promise.reject(Of(n));const a=Mg(n),l=xFe(a,t),f=await new jFe(a,l,s).execute();return f&&!s&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,t)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Fe=10*60*1e3;class KFe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(s=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!qFe(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var a;if(t.error&&!Kre(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";s.onError(tp(this.auth,l))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const a=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=$Fe&&this.cachedEventUids.clear(),this.cachedEventUids.has(yX(t))}saveEventToCache(t){this.cachedEventUids.add(yX(t)),this.lastProcessedEventTime=Date.now()}}function yX(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function Kre({type:n,error:t}){return n==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function qFe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Kre(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YFe(n,t={}){return $f(n,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XFe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,JFe=/^https?/;async function QFe(n){if(n.config.emulator)return;const{authorizedDomains:t}=await YFe(n);for(const s of t)try{if(ZFe(s))return}catch{}Ld(n,"unauthorized-domain")}function ZFe(n){const t=_V(),{protocol:s,hostname:a}=new URL(t);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&a===""?s==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&f.hostname===a}if(!JFe.test(s))return!1;if(XFe.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eje=new rR(3e4,6e4);function EX(){const n=np().___jsl;if(n!=null&&n.H){for(const t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let s=0;s<n.CP.length;s++)n.CP[s]=null}}function tje(n){return new Promise((t,s)=>{var a,l,d;function f(){EX(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{EX(),s(tp(n,"network-request-failed"))},timeout:eje.get()})}if(!((l=(a=np().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=np().gapi)===null||d===void 0)&&d.load)f();else{const y=zVe("iframefcb");return np()[y]=()=>{gapi.load?f():s(tp(n,"network-request-failed"))},Pre(`${WVe()}?onload=${y}`).catch(v=>s(v))}}).catch(t=>{throw ok=null,t})}let ok=null;function nje(n){return ok=ok||tje(n),ok}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rje=new rR(5e3,15e3),ije="__/auth/iframe",sje="emulator/auth/iframe",oje={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},aje=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function cje(n){const t=n.config;Wn(t.authDomain,n,"auth-domain-config-required");const s=t.emulator?Bj(t,sje):`https://${n.config.authDomain}/${ije}`,a={apiKey:t.apiKey,appName:n.name,v:$y},l=aje.get(n.config.apiHost);l&&(a.eid=l);const d=n._getFrameworks();return d.length&&(a.fw=d.join(",")),`${s}?${nR(a).slice(1)}`}async function lje(n){const t=await nje(n),s=np().gapi;return Wn(s,n,"internal-error"),t.open({where:document.body,url:cje(n),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:oje,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const f=tp(n,"network-request-failed"),y=np().setTimeout(()=>{d(f)},rje.get());function v(){np().clearTimeout(y),l(a)}a.ping(v).then(v,()=>{d(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uje={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},dje=500,hje=600,pje="_blank",fje="http://localhost";class vX{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function mje(n,t,s,a=dje,l=hje){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let y="";const v=Object.assign(Object.assign({},uje),{width:a.toString(),height:l.toString(),top:d,left:f}),b=Qa().toLowerCase();s&&(y=bre(b)?pje:s),vre(b)&&(t=t||fje,v.scrollbars="yes");const w=Object.entries(v).reduce((k,[L,V])=>`${k}${L}=${V},`,"");if(DVe(b)&&y!=="_self")return gje(t||"",y),new vX(null);const I=window.open(t||"",y,w);Wn(I,n,"popup-blocked");try{I.focus()}catch{}return new vX(I)}function gje(n,t){const s=document.createElement("a");s.href=n,s.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _je="__/auth/handler",yje="emulator/auth/handler",Eje=encodeURIComponent("fac");async function SX(n,t,s,a,l,d){Wn(n.config.authDomain,n,"auth-domain-config-required"),Wn(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:s,redirectUrl:a,v:$y,eventId:l};if(t instanceof Dre){t.setDefaultLanguage(n.languageCode),f.providerId=t.providerId||"",nUe(t.getCustomParameters())||(f.customParameters=JSON.stringify(t.getCustomParameters()));for(const[w,I]of Object.entries({}))f[w]=I}if(t instanceof sR){const w=t.getScopes().filter(I=>I!=="");w.length>0&&(f.scopes=w.join(","))}n.tenantId&&(f.tid=n.tenantId);const y=f;for(const w of Object.keys(y))y[w]===void 0&&delete y[w];const v=await n._getAppCheckToken(),b=v?`#${Eje}=${encodeURIComponent(v)}`:"";return`${vje(n)}?${nR(y).slice(1)}${b}`}function vje({config:n}){return n.emulator?Bj(n,yje):`https://${n.authDomain}/${_je}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QM="webStorageSupport";class Sje{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Bre,this._completeRedirectFn=HFe,this._overrideRedirectResult=WFe}async _openPopup(t,s,a,l){var d;Bf((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const f=await SX(t,s,a,_V(),l);return mje(t,f,$j())}async _openRedirect(t,s,a,l){await this._originValidation(t);const d=await SX(t,s,a,_V(),l);return wFe(d),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:l,promise:d}=this.eventManagers[s];return l?Promise.resolve(l):(Bf(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(t){const s=await lje(t),a=new KFe(t);return s.register("authEvent",l=>(Wn(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=s,a}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(QM,{type:QM},l=>{var d;const f=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[QM];f!==void 0&&s(!!f),Ld(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=QFe(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return Ire()||Sre()||zj()}}const bje=Sje;var bX="@firebase/auth",TX="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tje{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Wn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wje(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Cje(n){Uy(new wg("auth",(t,{options:s})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:f,authDomain:y}=a.options;Wn(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:f,authDomain:y,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Are(n)},b=new FVe(a,l,d,v);return YVe(b,s),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,a)=>{t.getProvider("auth-internal").initialize()})),Uy(new wg("auth-internal",t=>{const s=Mg(t.getProvider("auth").getImmediate());return(a=>new Tje(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),ep(bX,TX,wje(n)),ep(bX,TX,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rje=5*60,Ije=ire("authIdTokenMaxAge")||Rje;let wX=null;const Aje=n=>async t=>{const s=t&&await t.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>Ije)return;const l=s==null?void 0:s.token;wX!==l&&(wX=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function j1(n=Fj()){const t=M1(n,"auth");if(t.isInitialized())return t.getImmediate();const s=qVe(n,{popupRedirectResolver:bje,persistence:[DFe,SFe,Bre]}),a=ire("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const f=Aje(d.toString());gFe(s,f,()=>f(s.currentUser)),mFe(s,y=>f(y))}}const l=tre("auth");return l&&XVe(s,`http://${l}`),s}function Pje(){var n,t;return(t=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&t!==void 0?t:document}jVe({loadJS(n){return new Promise((t,s)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=t,a.onerror=l=>{const d=tp("internal-error");d.customData=l,s(d)},a.type="text/javascript",a.charset="UTF-8",Pje().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Cje("Browser");var CX=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Eg,qre;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(Y,X){function Z(){}Z.prototype=X.prototype,Y.D=X.prototype,Y.prototype=new Z,Y.prototype.constructor=Y,Y.C=function(se,me,pe){for(var ue=Array(arguments.length-2),Le=2;Le<arguments.length;Le++)ue[Le-2]=arguments[Le];return X.prototype[me].apply(se,ue)}}function s(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,s),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Y,X,Z){Z||(Z=0);var se=Array(16);if(typeof X=="string")for(var me=0;16>me;++me)se[me]=X.charCodeAt(Z++)|X.charCodeAt(Z++)<<8|X.charCodeAt(Z++)<<16|X.charCodeAt(Z++)<<24;else for(me=0;16>me;++me)se[me]=X[Z++]|X[Z++]<<8|X[Z++]<<16|X[Z++]<<24;X=Y.g[0],Z=Y.g[1],me=Y.g[2];var pe=Y.g[3],ue=X+(pe^Z&(me^pe))+se[0]+3614090360&4294967295;X=Z+(ue<<7&4294967295|ue>>>25),ue=pe+(me^X&(Z^me))+se[1]+3905402710&4294967295,pe=X+(ue<<12&4294967295|ue>>>20),ue=me+(Z^pe&(X^Z))+se[2]+606105819&4294967295,me=pe+(ue<<17&4294967295|ue>>>15),ue=Z+(X^me&(pe^X))+se[3]+3250441966&4294967295,Z=me+(ue<<22&4294967295|ue>>>10),ue=X+(pe^Z&(me^pe))+se[4]+4118548399&4294967295,X=Z+(ue<<7&4294967295|ue>>>25),ue=pe+(me^X&(Z^me))+se[5]+1200080426&4294967295,pe=X+(ue<<12&4294967295|ue>>>20),ue=me+(Z^pe&(X^Z))+se[6]+2821735955&4294967295,me=pe+(ue<<17&4294967295|ue>>>15),ue=Z+(X^me&(pe^X))+se[7]+4249261313&4294967295,Z=me+(ue<<22&4294967295|ue>>>10),ue=X+(pe^Z&(me^pe))+se[8]+1770035416&4294967295,X=Z+(ue<<7&4294967295|ue>>>25),ue=pe+(me^X&(Z^me))+se[9]+2336552879&4294967295,pe=X+(ue<<12&4294967295|ue>>>20),ue=me+(Z^pe&(X^Z))+se[10]+4294925233&4294967295,me=pe+(ue<<17&4294967295|ue>>>15),ue=Z+(X^me&(pe^X))+se[11]+2304563134&4294967295,Z=me+(ue<<22&4294967295|ue>>>10),ue=X+(pe^Z&(me^pe))+se[12]+1804603682&4294967295,X=Z+(ue<<7&4294967295|ue>>>25),ue=pe+(me^X&(Z^me))+se[13]+4254626195&4294967295,pe=X+(ue<<12&4294967295|ue>>>20),ue=me+(Z^pe&(X^Z))+se[14]+2792965006&4294967295,me=pe+(ue<<17&4294967295|ue>>>15),ue=Z+(X^me&(pe^X))+se[15]+1236535329&4294967295,Z=me+(ue<<22&4294967295|ue>>>10),ue=X+(me^pe&(Z^me))+se[1]+4129170786&4294967295,X=Z+(ue<<5&4294967295|ue>>>27),ue=pe+(Z^me&(X^Z))+se[6]+3225465664&4294967295,pe=X+(ue<<9&4294967295|ue>>>23),ue=me+(X^Z&(pe^X))+se[11]+643717713&4294967295,me=pe+(ue<<14&4294967295|ue>>>18),ue=Z+(pe^X&(me^pe))+se[0]+3921069994&4294967295,Z=me+(ue<<20&4294967295|ue>>>12),ue=X+(me^pe&(Z^me))+se[5]+3593408605&4294967295,X=Z+(ue<<5&4294967295|ue>>>27),ue=pe+(Z^me&(X^Z))+se[10]+38016083&4294967295,pe=X+(ue<<9&4294967295|ue>>>23),ue=me+(X^Z&(pe^X))+se[15]+3634488961&4294967295,me=pe+(ue<<14&4294967295|ue>>>18),ue=Z+(pe^X&(me^pe))+se[4]+3889429448&4294967295,Z=me+(ue<<20&4294967295|ue>>>12),ue=X+(me^pe&(Z^me))+se[9]+568446438&4294967295,X=Z+(ue<<5&4294967295|ue>>>27),ue=pe+(Z^me&(X^Z))+se[14]+3275163606&4294967295,pe=X+(ue<<9&4294967295|ue>>>23),ue=me+(X^Z&(pe^X))+se[3]+4107603335&4294967295,me=pe+(ue<<14&4294967295|ue>>>18),ue=Z+(pe^X&(me^pe))+se[8]+1163531501&4294967295,Z=me+(ue<<20&4294967295|ue>>>12),ue=X+(me^pe&(Z^me))+se[13]+2850285829&4294967295,X=Z+(ue<<5&4294967295|ue>>>27),ue=pe+(Z^me&(X^Z))+se[2]+4243563512&4294967295,pe=X+(ue<<9&4294967295|ue>>>23),ue=me+(X^Z&(pe^X))+se[7]+1735328473&4294967295,me=pe+(ue<<14&4294967295|ue>>>18),ue=Z+(pe^X&(me^pe))+se[12]+2368359562&4294967295,Z=me+(ue<<20&4294967295|ue>>>12),ue=X+(Z^me^pe)+se[5]+4294588738&4294967295,X=Z+(ue<<4&4294967295|ue>>>28),ue=pe+(X^Z^me)+se[8]+2272392833&4294967295,pe=X+(ue<<11&4294967295|ue>>>21),ue=me+(pe^X^Z)+se[11]+1839030562&4294967295,me=pe+(ue<<16&4294967295|ue>>>16),ue=Z+(me^pe^X)+se[14]+4259657740&4294967295,Z=me+(ue<<23&4294967295|ue>>>9),ue=X+(Z^me^pe)+se[1]+2763975236&4294967295,X=Z+(ue<<4&4294967295|ue>>>28),ue=pe+(X^Z^me)+se[4]+1272893353&4294967295,pe=X+(ue<<11&4294967295|ue>>>21),ue=me+(pe^X^Z)+se[7]+4139469664&4294967295,me=pe+(ue<<16&4294967295|ue>>>16),ue=Z+(me^pe^X)+se[10]+3200236656&4294967295,Z=me+(ue<<23&4294967295|ue>>>9),ue=X+(Z^me^pe)+se[13]+681279174&4294967295,X=Z+(ue<<4&4294967295|ue>>>28),ue=pe+(X^Z^me)+se[0]+3936430074&4294967295,pe=X+(ue<<11&4294967295|ue>>>21),ue=me+(pe^X^Z)+se[3]+3572445317&4294967295,me=pe+(ue<<16&4294967295|ue>>>16),ue=Z+(me^pe^X)+se[6]+76029189&4294967295,Z=me+(ue<<23&4294967295|ue>>>9),ue=X+(Z^me^pe)+se[9]+3654602809&4294967295,X=Z+(ue<<4&4294967295|ue>>>28),ue=pe+(X^Z^me)+se[12]+3873151461&4294967295,pe=X+(ue<<11&4294967295|ue>>>21),ue=me+(pe^X^Z)+se[15]+530742520&4294967295,me=pe+(ue<<16&4294967295|ue>>>16),ue=Z+(me^pe^X)+se[2]+3299628645&4294967295,Z=me+(ue<<23&4294967295|ue>>>9),ue=X+(me^(Z|~pe))+se[0]+4096336452&4294967295,X=Z+(ue<<6&4294967295|ue>>>26),ue=pe+(Z^(X|~me))+se[7]+1126891415&4294967295,pe=X+(ue<<10&4294967295|ue>>>22),ue=me+(X^(pe|~Z))+se[14]+2878612391&4294967295,me=pe+(ue<<15&4294967295|ue>>>17),ue=Z+(pe^(me|~X))+se[5]+4237533241&4294967295,Z=me+(ue<<21&4294967295|ue>>>11),ue=X+(me^(Z|~pe))+se[12]+1700485571&4294967295,X=Z+(ue<<6&4294967295|ue>>>26),ue=pe+(Z^(X|~me))+se[3]+2399980690&4294967295,pe=X+(ue<<10&4294967295|ue>>>22),ue=me+(X^(pe|~Z))+se[10]+4293915773&4294967295,me=pe+(ue<<15&4294967295|ue>>>17),ue=Z+(pe^(me|~X))+se[1]+2240044497&4294967295,Z=me+(ue<<21&4294967295|ue>>>11),ue=X+(me^(Z|~pe))+se[8]+1873313359&4294967295,X=Z+(ue<<6&4294967295|ue>>>26),ue=pe+(Z^(X|~me))+se[15]+4264355552&4294967295,pe=X+(ue<<10&4294967295|ue>>>22),ue=me+(X^(pe|~Z))+se[6]+2734768916&4294967295,me=pe+(ue<<15&4294967295|ue>>>17),ue=Z+(pe^(me|~X))+se[13]+1309151649&4294967295,Z=me+(ue<<21&4294967295|ue>>>11),ue=X+(me^(Z|~pe))+se[4]+4149444226&4294967295,X=Z+(ue<<6&4294967295|ue>>>26),ue=pe+(Z^(X|~me))+se[11]+3174756917&4294967295,pe=X+(ue<<10&4294967295|ue>>>22),ue=me+(X^(pe|~Z))+se[2]+718787259&4294967295,me=pe+(ue<<15&4294967295|ue>>>17),ue=Z+(pe^(me|~X))+se[9]+3951481745&4294967295,Y.g[0]=Y.g[0]+X&4294967295,Y.g[1]=Y.g[1]+(me+(ue<<21&4294967295|ue>>>11))&4294967295,Y.g[2]=Y.g[2]+me&4294967295,Y.g[3]=Y.g[3]+pe&4294967295}a.prototype.u=function(Y,X){X===void 0&&(X=Y.length);for(var Z=X-this.blockSize,se=this.B,me=this.h,pe=0;pe<X;){if(me==0)for(;pe<=Z;)l(this,Y,pe),pe+=this.blockSize;if(typeof Y=="string"){for(;pe<X;)if(se[me++]=Y.charCodeAt(pe++),me==this.blockSize){l(this,se),me=0;break}}else for(;pe<X;)if(se[me++]=Y[pe++],me==this.blockSize){l(this,se),me=0;break}}this.h=me,this.o+=X},a.prototype.v=function(){var Y=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Y[0]=128;for(var X=1;X<Y.length-8;++X)Y[X]=0;var Z=8*this.o;for(X=Y.length-8;X<Y.length;++X)Y[X]=Z&255,Z/=256;for(this.u(Y),Y=Array(16),X=Z=0;4>X;++X)for(var se=0;32>se;se+=8)Y[Z++]=this.g[X]>>>se&255;return Y};function d(Y,X){var Z=y;return Object.prototype.hasOwnProperty.call(Z,Y)?Z[Y]:Z[Y]=X(Y)}function f(Y,X){this.h=X;for(var Z=[],se=!0,me=Y.length-1;0<=me;me--){var pe=Y[me]|0;se&&pe==X||(Z[me]=pe,se=!1)}this.g=Z}var y={};function v(Y){return-128<=Y&&128>Y?d(Y,function(X){return new f([X|0],0>X?-1:0)}):new f([Y|0],0>Y?-1:0)}function b(Y){if(isNaN(Y)||!isFinite(Y))return I;if(0>Y)return W(b(-Y));for(var X=[],Z=1,se=0;Y>=Z;se++)X[se]=Y/Z|0,Z*=4294967296;return new f(X,0)}function w(Y,X){if(Y.length==0)throw Error("number format error: empty string");if(X=X||10,2>X||36<X)throw Error("radix out of range: "+X);if(Y.charAt(0)=="-")return W(w(Y.substring(1),X));if(0<=Y.indexOf("-"))throw Error('number format error: interior "-" character');for(var Z=b(Math.pow(X,8)),se=I,me=0;me<Y.length;me+=8){var pe=Math.min(8,Y.length-me),ue=parseInt(Y.substring(me,me+pe),X);8>pe?(pe=b(Math.pow(X,pe)),se=se.j(pe).add(b(ue))):(se=se.j(Z),se=se.add(b(ue)))}return se}var I=v(0),k=v(1),L=v(16777216);n=f.prototype,n.m=function(){if(B(this))return-W(this).m();for(var Y=0,X=1,Z=0;Z<this.g.length;Z++){var se=this.i(Z);Y+=(0<=se?se:4294967296+se)*X,X*=4294967296}return Y},n.toString=function(Y){if(Y=Y||10,2>Y||36<Y)throw Error("radix out of range: "+Y);if(V(this))return"0";if(B(this))return"-"+W(this).toString(Y);for(var X=b(Math.pow(Y,6)),Z=this,se="";;){var me=ce(Z,X).g;Z=Q(Z,me.j(X));var pe=((0<Z.g.length?Z.g[0]:Z.h)>>>0).toString(Y);if(Z=me,V(Z))return pe+se;for(;6>pe.length;)pe="0"+pe;se=pe+se}},n.i=function(Y){return 0>Y?0:Y<this.g.length?this.g[Y]:this.h};function V(Y){if(Y.h!=0)return!1;for(var X=0;X<Y.g.length;X++)if(Y.g[X]!=0)return!1;return!0}function B(Y){return Y.h==-1}n.l=function(Y){return Y=Q(this,Y),B(Y)?-1:V(Y)?0:1};function W(Y){for(var X=Y.g.length,Z=[],se=0;se<X;se++)Z[se]=~Y.g[se];return new f(Z,~Y.h).add(k)}n.abs=function(){return B(this)?W(this):this},n.add=function(Y){for(var X=Math.max(this.g.length,Y.g.length),Z=[],se=0,me=0;me<=X;me++){var pe=se+(this.i(me)&65535)+(Y.i(me)&65535),ue=(pe>>>16)+(this.i(me)>>>16)+(Y.i(me)>>>16);se=ue>>>16,pe&=65535,ue&=65535,Z[me]=ue<<16|pe}return new f(Z,Z[Z.length-1]&-2147483648?-1:0)};function Q(Y,X){return Y.add(W(X))}n.j=function(Y){if(V(this)||V(Y))return I;if(B(this))return B(Y)?W(this).j(W(Y)):W(W(this).j(Y));if(B(Y))return W(this.j(W(Y)));if(0>this.l(L)&&0>Y.l(L))return b(this.m()*Y.m());for(var X=this.g.length+Y.g.length,Z=[],se=0;se<2*X;se++)Z[se]=0;for(se=0;se<this.g.length;se++)for(var me=0;me<Y.g.length;me++){var pe=this.i(se)>>>16,ue=this.i(se)&65535,Le=Y.i(me)>>>16,We=Y.i(me)&65535;Z[2*se+2*me]+=ue*We,$(Z,2*se+2*me),Z[2*se+2*me+1]+=pe*We,$(Z,2*se+2*me+1),Z[2*se+2*me+1]+=ue*Le,$(Z,2*se+2*me+1),Z[2*se+2*me+2]+=pe*Le,$(Z,2*se+2*me+2)}for(se=0;se<X;se++)Z[se]=Z[2*se+1]<<16|Z[2*se];for(se=X;se<2*X;se++)Z[se]=0;return new f(Z,0)};function $(Y,X){for(;(Y[X]&65535)!=Y[X];)Y[X+1]+=Y[X]>>>16,Y[X]&=65535,X++}function ie(Y,X){this.g=Y,this.h=X}function ce(Y,X){if(V(X))throw Error("division by zero");if(V(Y))return new ie(I,I);if(B(Y))return X=ce(W(Y),X),new ie(W(X.g),W(X.h));if(B(X))return X=ce(Y,W(X)),new ie(W(X.g),X.h);if(30<Y.g.length){if(B(Y)||B(X))throw Error("slowDivide_ only works with positive integers.");for(var Z=k,se=X;0>=se.l(Y);)Z=ne(Z),se=ne(se);var me=de(Z,1),pe=de(se,1);for(se=de(se,2),Z=de(Z,2);!V(se);){var ue=pe.add(se);0>=ue.l(Y)&&(me=me.add(Z),pe=ue),se=de(se,1),Z=de(Z,1)}return X=Q(Y,me.j(X)),new ie(me,X)}for(me=I;0<=Y.l(X);){for(Z=Math.max(1,Math.floor(Y.m()/X.m())),se=Math.ceil(Math.log(Z)/Math.LN2),se=48>=se?1:Math.pow(2,se-48),pe=b(Z),ue=pe.j(X);B(ue)||0<ue.l(Y);)Z-=se,pe=b(Z),ue=pe.j(X);V(pe)&&(pe=k),me=me.add(pe),Y=Q(Y,ue)}return new ie(me,Y)}n.A=function(Y){return ce(this,Y).h},n.and=function(Y){for(var X=Math.max(this.g.length,Y.g.length),Z=[],se=0;se<X;se++)Z[se]=this.i(se)&Y.i(se);return new f(Z,this.h&Y.h)},n.or=function(Y){for(var X=Math.max(this.g.length,Y.g.length),Z=[],se=0;se<X;se++)Z[se]=this.i(se)|Y.i(se);return new f(Z,this.h|Y.h)},n.xor=function(Y){for(var X=Math.max(this.g.length,Y.g.length),Z=[],se=0;se<X;se++)Z[se]=this.i(se)^Y.i(se);return new f(Z,this.h^Y.h)};function ne(Y){for(var X=Y.g.length+1,Z=[],se=0;se<X;se++)Z[se]=Y.i(se)<<1|Y.i(se-1)>>>31;return new f(Z,Y.h)}function de(Y,X){var Z=X>>5;X%=32;for(var se=Y.g.length-Z,me=[],pe=0;pe<se;pe++)me[pe]=0<X?Y.i(pe+Z)>>>X|Y.i(pe+Z+1)<<32-X:Y.i(pe+Z);return new f(me,Y.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,qre=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=b,f.fromString=w,Eg=f}).apply(typeof CX<"u"?CX:typeof self<"u"?self:typeof window<"u"?window:{});var bO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Yre,Bw,Xre,ak,vV,Jre,Qre,Zre;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,z,re){return A==Array.prototype||A==Object.prototype||(A[z]=re.value),A};function s(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof bO=="object"&&bO];for(var z=0;z<A.length;++z){var re=A[z];if(re&&re.Math==Math)return re}throw Error("Cannot find global object")}var a=s(this);function l(A,z){if(z)e:{var re=a;A=A.split(".");for(var ge=0;ge<A.length-1;ge++){var qe=A[ge];if(!(qe in re))break e;re=re[qe]}A=A[A.length-1],ge=re[A],z=z(ge),z!=ge&&z!=null&&t(re,A,{configurable:!0,writable:!0,value:z})}}function d(A,z){A instanceof String&&(A+="");var re=0,ge=!1,qe={next:function(){if(!ge&&re<A.length){var ot=re++;return{value:z(ot,A[ot]),done:!1}}return ge=!0,{done:!0,value:void 0}}};return qe[Symbol.iterator]=function(){return qe},qe}l("Array.prototype.values",function(A){return A||function(){return d(this,function(z,re){return re})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},y=this||self;function v(A){var z=typeof A;return z=z!="object"?z:A?Array.isArray(A)?"array":z:"null",z=="array"||z=="object"&&typeof A.length=="number"}function b(A){var z=typeof A;return z=="object"&&A!=null||z=="function"}function w(A,z,re){return A.call.apply(A.bind,arguments)}function I(A,z,re){if(!A)throw Error();if(2<arguments.length){var ge=Array.prototype.slice.call(arguments,2);return function(){var qe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(qe,ge),A.apply(z,qe)}}return function(){return A.apply(z,arguments)}}function k(A,z,re){return k=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:I,k.apply(null,arguments)}function L(A,z){var re=Array.prototype.slice.call(arguments,1);return function(){var ge=re.slice();return ge.push.apply(ge,arguments),A.apply(this,ge)}}function V(A,z){function re(){}re.prototype=z.prototype,A.aa=z.prototype,A.prototype=new re,A.prototype.constructor=A,A.Qb=function(ge,qe,ot){for(var Vt=Array(arguments.length-2),Jr=2;Jr<arguments.length;Jr++)Vt[Jr-2]=arguments[Jr];return z.prototype[qe].apply(ge,Vt)}}function B(A){const z=A.length;if(0<z){const re=Array(z);for(let ge=0;ge<z;ge++)re[ge]=A[ge];return re}return[]}function W(A,z){for(let re=1;re<arguments.length;re++){const ge=arguments[re];if(v(ge)){const qe=A.length||0,ot=ge.length||0;A.length=qe+ot;for(let Vt=0;Vt<ot;Vt++)A[qe+Vt]=ge[Vt]}else A.push(ge)}}class Q{constructor(z,re){this.i=z,this.j=re,this.h=0,this.g=null}get(){let z;return 0<this.h?(this.h--,z=this.g,this.g=z.next,z.next=null):z=this.i(),z}}function $(A){return/^[\s\xa0]*$/.test(A)}function ie(){var A=y.navigator;return A&&(A=A.userAgent)?A:""}function ce(A){return ce[" "](A),A}ce[" "]=function(){};var ne=ie().indexOf("Gecko")!=-1&&!(ie().toLowerCase().indexOf("webkit")!=-1&&ie().indexOf("Edge")==-1)&&!(ie().indexOf("Trident")!=-1||ie().indexOf("MSIE")!=-1)&&ie().indexOf("Edge")==-1;function de(A,z,re){for(const ge in A)z.call(re,A[ge],ge,A)}function Y(A,z){for(const re in A)z.call(void 0,A[re],re,A)}function X(A){const z={};for(const re in A)z[re]=A[re];return z}const Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function se(A,z){let re,ge;for(let qe=1;qe<arguments.length;qe++){ge=arguments[qe];for(re in ge)A[re]=ge[re];for(let ot=0;ot<Z.length;ot++)re=Z[ot],Object.prototype.hasOwnProperty.call(ge,re)&&(A[re]=ge[re])}}function me(A){var z=1;A=A.split(":");const re=[];for(;0<z&&A.length;)re.push(A.shift()),z--;return A.length&&re.push(A.join(":")),re}function pe(A){y.setTimeout(()=>{throw A},0)}function ue(){var A=Ee;let z=null;return A.g&&(z=A.g,A.g=A.g.next,A.g||(A.h=null),z.next=null),z}class Le{constructor(){this.h=this.g=null}add(z,re){const ge=We.get();ge.set(z,re),this.h?this.h.next=ge:this.g=ge,this.h=ge}}var We=new Q(()=>new $e,A=>A.reset());class $e{constructor(){this.next=this.g=this.h=null}set(z,re){this.h=z,this.g=re,this.next=null}reset(){this.next=this.g=this.h=null}}let ve,_e=!1,Ee=new Le,ke=()=>{const A=y.Promise.resolve(void 0);ve=()=>{A.then(Te)}};var Te=()=>{for(var A;A=ue();){try{A.h.call(A.g)}catch(re){pe(re)}var z=We;z.j(A),100>z.h&&(z.h++,A.next=z.g,z.g=A)}_e=!1};function be(){this.s=this.s,this.C=this.C}be.prototype.s=!1,be.prototype.ma=function(){this.s||(this.s=!0,this.N())},be.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Pe(A,z){this.type=A,this.g=this.target=z,this.defaultPrevented=!1}Pe.prototype.h=function(){this.defaultPrevented=!0};var xe=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var A=!1,z=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const re=()=>{};y.addEventListener("test",re,z),y.removeEventListener("test",re,z)}catch{}return A}();function ze(A,z){if(Pe.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var re=this.type=A.type,ge=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=z,z=A.relatedTarget){if(ne){e:{try{ce(z.nodeName);var qe=!0;break e}catch{}qe=!1}qe||(z=null)}}else re=="mouseover"?z=A.fromElement:re=="mouseout"&&(z=A.toElement);this.relatedTarget=z,ge?(this.clientX=ge.clientX!==void 0?ge.clientX:ge.pageX,this.clientY=ge.clientY!==void 0?ge.clientY:ge.pageY,this.screenX=ge.screenX||0,this.screenY=ge.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:Je[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&ze.aa.h.call(this)}}V(ze,Pe);var Je={2:"touch",3:"pen",4:"mouse"};ze.prototype.h=function(){ze.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var Ze="closure_listenable_"+(1e6*Math.random()|0),lt=0;function nt(A,z,re,ge,qe){this.listener=A,this.proxy=null,this.src=z,this.type=re,this.capture=!!ge,this.ha=qe,this.key=++lt,this.da=this.fa=!1}function Rt(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function fn(A){this.src=A,this.g={},this.h=0}fn.prototype.add=function(A,z,re,ge,qe){var ot=A.toString();A=this.g[ot],A||(A=this.g[ot]=[],this.h++);var Vt=on(A,z,ge,qe);return-1<Vt?(z=A[Vt],re||(z.fa=!1)):(z=new nt(z,this.src,ot,!!ge,qe),z.fa=re,A.push(z)),z};function Ft(A,z){var re=z.type;if(re in A.g){var ge=A.g[re],qe=Array.prototype.indexOf.call(ge,z,void 0),ot;(ot=0<=qe)&&Array.prototype.splice.call(ge,qe,1),ot&&(Rt(z),A.g[re].length==0&&(delete A.g[re],A.h--))}}function on(A,z,re,ge){for(var qe=0;qe<A.length;++qe){var ot=A[qe];if(!ot.da&&ot.listener==z&&ot.capture==!!re&&ot.ha==ge)return qe}return-1}var Zt="closure_lm_"+(1e6*Math.random()|0),Yt={};function Vn(A,z,re,ge,qe){if(Array.isArray(z)){for(var ot=0;ot<z.length;ot++)Vn(A,z[ot],re,ge,qe);return null}return re=mn(re),A&&A[Ze]?A.K(z,re,b(ge)?!!ge.capture:!1,qe):$t(A,z,re,!1,ge,qe)}function $t(A,z,re,ge,qe,ot){if(!z)throw Error("Invalid event type");var Vt=b(qe)?!!qe.capture:!!qe,Jr=vt(A);if(Jr||(A[Zt]=Jr=new fn(A)),re=Jr.add(z,re,ge,Vt,ot),re.proxy)return re;if(ge=Re(),re.proxy=ge,ge.src=A,ge.listener=re,A.addEventListener)xe||(qe=Vt),qe===void 0&&(qe=!1),A.addEventListener(z.toString(),ge,qe);else if(A.attachEvent)A.attachEvent(ht(z.toString()),ge);else if(A.addListener&&A.removeListener)A.addListener(ge);else throw Error("addEventListener and attachEvent are unavailable.");return re}function Re(){function A(re){return z.call(A.src,A.listener,re)}const z=mt;return A}function Ve(A,z,re,ge,qe){if(Array.isArray(z))for(var ot=0;ot<z.length;ot++)Ve(A,z[ot],re,ge,qe);else ge=b(ge)?!!ge.capture:!!ge,re=mn(re),A&&A[Ze]?(A=A.i,z=String(z).toString(),z in A.g&&(ot=A.g[z],re=on(ot,re,ge,qe),-1<re&&(Rt(ot[re]),Array.prototype.splice.call(ot,re,1),ot.length==0&&(delete A.g[z],A.h--)))):A&&(A=vt(A))&&(z=A.g[z.toString()],A=-1,z&&(A=on(z,re,ge,qe)),(re=-1<A?z[A]:null)&&Ge(re))}function Ge(A){if(typeof A!="number"&&A&&!A.da){var z=A.src;if(z&&z[Ze])Ft(z.i,A);else{var re=A.type,ge=A.proxy;z.removeEventListener?z.removeEventListener(re,ge,A.capture):z.detachEvent?z.detachEvent(ht(re),ge):z.addListener&&z.removeListener&&z.removeListener(ge),(re=vt(z))?(Ft(re,A),re.h==0&&(re.src=null,z[Zt]=null)):Rt(A)}}}function ht(A){return A in Yt?Yt[A]:Yt[A]="on"+A}function mt(A,z){if(A.da)A=!0;else{z=new ze(z,this);var re=A.listener,ge=A.ha||A.src;A.fa&&Ge(A),A=re.call(ge,z)}return A}function vt(A){return A=A[Zt],A instanceof fn?A:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function mn(A){return typeof A=="function"?A:(A[Bt]||(A[Bt]=function(z){return A.handleEvent(z)}),A[Bt])}function En(){be.call(this),this.i=new fn(this),this.M=this,this.F=null}V(En,be),En.prototype[Ze]=!0,En.prototype.removeEventListener=function(A,z,re,ge){Ve(this,A,z,re,ge)};function en(A,z){var re,ge=A.F;if(ge)for(re=[];ge;ge=ge.F)re.push(ge);if(A=A.M,ge=z.type||z,typeof z=="string")z=new Pe(z,A);else if(z instanceof Pe)z.target=z.target||A;else{var qe=z;z=new Pe(ge,A),se(z,qe)}if(qe=!0,re)for(var ot=re.length-1;0<=ot;ot--){var Vt=z.g=re[ot];qe=Et(Vt,ge,!0,z)&&qe}if(Vt=z.g=A,qe=Et(Vt,ge,!0,z)&&qe,qe=Et(Vt,ge,!1,z)&&qe,re)for(ot=0;ot<re.length;ot++)Vt=z.g=re[ot],qe=Et(Vt,ge,!1,z)&&qe}En.prototype.N=function(){if(En.aa.N.call(this),this.i){var A=this.i,z;for(z in A.g){for(var re=A.g[z],ge=0;ge<re.length;ge++)Rt(re[ge]);delete A.g[z],A.h--}}this.F=null},En.prototype.K=function(A,z,re,ge){return this.i.add(String(A),z,!1,re,ge)},En.prototype.L=function(A,z,re,ge){return this.i.add(String(A),z,!0,re,ge)};function Et(A,z,re,ge){if(z=A.i.g[String(z)],!z)return!0;z=z.concat();for(var qe=!0,ot=0;ot<z.length;++ot){var Vt=z[ot];if(Vt&&!Vt.da&&Vt.capture==re){var Jr=Vt.listener,mi=Vt.ha||Vt.src;Vt.fa&&Ft(A.i,Vt),qe=Jr.call(mi,ge)!==!1&&qe}}return qe&&!ge.defaultPrevented}function nr(A,z,re){if(typeof A=="function")re&&(A=k(A,re));else if(A&&typeof A.handleEvent=="function")A=k(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(z)?-1:y.setTimeout(A,z||0)}function Nt(A){A.g=nr(()=>{A.g=null,A.i&&(A.i=!1,Nt(A))},A.l);const z=A.h;A.h=null,A.m.apply(null,z)}class Ut extends be{constructor(z,re){super(),this.m=z,this.l=re,this.h=null,this.i=!1,this.g=null}j(z){this.h=arguments,this.g?this.i=!0:Nt(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function gn(A){be.call(this),this.h=A,this.g={}}V(gn,be);var ki=[];function _s(A){de(A.g,function(z,re){this.g.hasOwnProperty(re)&&Ge(z)},A),A.g={}}gn.prototype.N=function(){gn.aa.N.call(this),_s(this)},gn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ii=y.JSON.stringify,Ho=y.JSON.parse,ec=class{stringify(A){return y.JSON.stringify(A,void 0)}parse(A){return y.JSON.parse(A,void 0)}};function Ks(){}Ks.prototype.h=null;function qs(A){return A.h||(A.h=A.i())}function Rc(){}var ys={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ca(){Pe.call(this,"d")}V(Ca,Pe);function To(){Pe.call(this,"c")}V(To,Pe);var Ra={},tc=null;function pl(){return tc=tc||new En}Ra.La="serverreachability";function Ia(A){Pe.call(this,Ra.La,A)}V(Ia,Pe);function nc(A){const z=pl();en(z,new Ia(z))}Ra.STAT_EVENT="statevent";function io(A,z){Pe.call(this,Ra.STAT_EVENT,A),this.stat=z}V(io,Pe);function Ni(A){const z=pl();en(z,new io(z,A))}Ra.Ma="timingevent";function gt(A,z){Pe.call(this,Ra.Ma,A),this.size=z}V(gt,Pe);function dn(A,z){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){A()},z)}function gr(){this.g=!0}gr.prototype.xa=function(){this.g=!1};function fi(A,z,re,ge,qe,ot){A.info(function(){if(A.g)if(ot)for(var Vt="",Jr=ot.split("&"),mi=0;mi<Jr.length;mi++){var Cr=Jr[mi].split("=");if(1<Cr.length){var Ys=Cr[0];Cr=Cr[1];var vs=Ys.split("_");Vt=2<=vs.length&&vs[1]=="type"?Vt+(Ys+"="+Cr+"&"):Vt+(Ys+"=redacted&")}}else Vt=null;else Vt=ot;return"XMLHTTP REQ ("+ge+") [attempt "+qe+"]: "+z+`
`+re+`
`+Vt})}function wo(A,z,re,ge,qe,ot,Vt){A.info(function(){return"XMLHTTP RESP ("+ge+") [ attempt "+qe+"]: "+z+`
`+re+`
`+ot+" "+Vt})}function so(A,z,re,ge){A.info(function(){return"XMLHTTP TEXT ("+z+"): "+pp(A,re)+(ge?" "+ge:"")})}function Hl(A,z){A.info(function(){return"TIMEOUT: "+z})}gr.prototype.info=function(){};function pp(A,z){if(!A.g)return z;if(!z)return null;try{var re=JSON.parse(z);if(re){for(A=0;A<re.length;A++)if(Array.isArray(re[A])){var ge=re[A];if(!(2>ge.length)){var qe=ge[1];if(Array.isArray(qe)&&!(1>qe.length)){var ot=qe[0];if(ot!="noop"&&ot!="stop"&&ot!="close")for(var Vt=1;Vt<qe.length;Vt++)qe[Vt]=""}}}}return ii(re)}catch{return z}}var fl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},$l={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},bi;function oo(){}V(oo,Ks),oo.prototype.g=function(){return new XMLHttpRequest},oo.prototype.i=function(){return{}},bi=new oo;function Fi(A,z,re,ge){this.j=A,this.i=z,this.l=re,this.R=ge||1,this.U=new gn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Fd}function Fd(){this.i=null,this.g="",this.h=!1}var jd={},rc={};function Bd(A,z,re){A.L=1,A.v=sc(Ko(z)),A.m=re,A.P=!0,Wu(A,null)}function Wu(A,z){A.F=Date.now(),$r(A),A.A=Ko(A.v);var re=A.A,ge=A.R;Array.isArray(ge)||(ge=[String(ge)]),Ql(re.i,"t",ge),A.C=0,re=A.j.J,A.h=new Fd,A.g=Zy(A.j,re?z:null,!A.m),0<A.O&&(A.M=new Ut(k(A.Y,A,A.g),A.O)),z=A.U,re=A.g,ge=A.ca;var qe="readystatechange";Array.isArray(qe)||(qe&&(ki[0]=qe.toString()),qe=ki);for(var ot=0;ot<qe.length;ot++){var Vt=Vn(re,qe[ot],ge||z.handleEvent,!1,z.h||z);if(!Vt)break;z.g[Vt.key]=Vt}z=A.H?X(A.H):{},A.m?(A.u||(A.u="POST"),z["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,z)):(A.u="GET",A.g.ea(A.A,A.u,null,z)),nc(),fi(A.i,A.u,A.A,A.l,A.R,A.m)}Fi.prototype.ca=function(A){A=A.target;const z=this.M;z&&wi(A)==3?z.j():this.Y(A)},Fi.prototype.Y=function(A){try{if(A==this.g)e:{const vs=wi(this.g);var z=this.g.Ba();const oc=this.g.Z();if(!(3>vs)&&(vs!=3||this.g&&(this.h.h||this.g.oa()||Ms(this.g)))){this.J||vs!=4||z==7||(z==8||0>=oc?nc(3):nc(2)),Ic(this);var re=this.g.Z();this.X=re;t:if($o(this)){var ge=Ms(this.g);A="";var qe=ge.length,ot=wi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Aa(this),ml(this);var Vt="";break t}this.h.i=new y.TextDecoder}for(z=0;z<qe;z++)this.h.h=!0,A+=this.h.i.decode(ge[z],{stream:!(ot&&z==qe-1)});ge.length=0,this.h.g+=A,this.C=0,Vt=this.h.g}else Vt=this.g.oa();if(this.o=re==200,wo(this.i,this.u,this.A,this.l,this.R,vs,re),this.o){if(this.T&&!this.K){t:{if(this.g){var Jr,mi=this.g;if((Jr=mi.g?mi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(Jr)){var Cr=Jr;break t}}Cr=null}if(re=Cr)so(this.i,this.l,re,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,fp(this,re);else{this.o=!1,this.s=3,Ni(12),Aa(this),ml(this);break e}}if(this.P){re=!0;let ra;for(;!this.J&&this.C<Vt.length;)if(ra=Wd(this,Vt),ra==rc){vs==4&&(this.s=4,Ni(14),re=!1),so(this.i,this.l,null,"[Incomplete Response]");break}else if(ra==jd){this.s=4,Ni(15),so(this.i,this.l,Vt,"[Invalid Chunk]"),re=!1;break}else so(this.i,this.l,ra,null),fp(this,ra);if($o(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),vs!=4||Vt.length!=0||this.h.h||(this.s=1,Ni(16),re=!1),this.o=this.o&&re,!re)so(this.i,this.l,Vt,"[Invalid Chunked Response]"),Aa(this),ml(this);else if(0<Vt.length&&!this.W){this.W=!0;var Ys=this.j;Ys.g==this&&Ys.ba&&!Ys.M&&(Ys.j.info("Great, no buffering proxy detected. Bytes received: "+Vt.length),jg(Ys),Ys.M=!0,Ni(11))}}else so(this.i,this.l,Vt,null),fp(this,Vt);vs==4&&Aa(this),this.o&&!this.J&&(vs==4?rm(this.j,this):(this.o=!1,$r(this)))}else Zo(this.g),re==400&&0<Vt.indexOf("Unknown SID")?(this.s=3,Ni(12)):(this.s=0,Ni(13)),Aa(this),ml(this)}}}catch{}finally{}};function $o(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function Wd(A,z){var re=A.C,ge=z.indexOf(`
`,re);return ge==-1?rc:(re=Number(z.substring(re,ge)),isNaN(re)?jd:(ge+=1,ge+re>z.length?rc:(z=z.slice(ge,ge+re),A.C=ge+re,z)))}Fi.prototype.cancel=function(){this.J=!0,Aa(this)};function $r(A){A.S=Date.now()+A.I,Ti(A,A.I)}function Ti(A,z){if(A.B!=null)throw Error("WatchDog timer not null");A.B=dn(k(A.ba,A),z)}function Ic(A){A.B&&(y.clearTimeout(A.B),A.B=null)}Fi.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(Hl(this.i,this.A),this.L!=2&&(nc(),Ni(17)),Aa(this),this.s=2,ml(this)):Ti(this,this.S-A)};function ml(A){A.j.G==0||A.J||rm(A.j,A)}function Aa(A){Ic(A);var z=A.M;z&&typeof z.ma=="function"&&z.ma(),A.M=null,_s(A.U),A.g&&(z=A.g,A.g=null,z.abort(),z.ma())}function fp(A,z){try{var re=A.j;if(re.G!=0&&(re.g==A||ao(re.h,A))){if(!A.K&&ao(re.h,A)&&re.G==3){try{var ge=re.Da.g.parse(z)}catch{ge=null}if(Array.isArray(ge)&&ge.length==3){var qe=ge;if(qe[0]==0){e:if(!re.u){if(re.g)if(re.g.F+3e3<A.F)nm(re),vl(re);else break e;tm(re),Ni(18)}}else re.za=qe[1],0<re.za-re.T&&37500>qe[2]&&re.F&&re.v==0&&!re.C&&(re.C=dn(k(re.Za,re),6e3));if(1>=Yf(re.h)&&re.ca){try{re.ca()}catch{}re.ca=void 0}}else Yu(re,11)}else if((A.K||re.g==A)&&nm(re),!$(z))for(qe=re.Da.g.parse(z),z=0;z<qe.length;z++){let Cr=qe[z];if(re.T=Cr[0],Cr=Cr[1],re.G==2)if(Cr[0]=="c"){re.K=Cr[1],re.ia=Cr[2];const Ys=Cr[3];Ys!=null&&(re.la=Ys,re.j.info("VER="+re.la));const vs=Cr[4];vs!=null&&(re.Aa=vs,re.j.info("SVER="+re.Aa));const oc=Cr[5];oc!=null&&typeof oc=="number"&&0<oc&&(ge=1.5*oc,re.L=ge,re.j.info("backChannelRequestTimeoutMs_="+ge)),ge=re;const ra=A.g;if(ra){const Ep=ra.g?ra.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ep){var ot=ge.h;ot.g||Ep.indexOf("spdy")==-1&&Ep.indexOf("quic")==-1&&Ep.indexOf("h2")==-1||(ot.j=ot.l,ot.g=new Set,ot.h&&(mp(ot,ot.h),ot.h=null))}if(ge.D){const sm=ra.g?ra.g.getResponseHeader("X-HTTP-Session-Id"):null;sm&&(ge.ya=sm,Xr(ge.I,ge.D,sm))}}re.G=3,re.l&&re.l.ua(),re.ba&&(re.R=Date.now()-A.F,re.j.info("Handshake RTT: "+re.R+"ms")),ge=re;var Vt=A;if(ge.qa=Bg(ge,ge.J?ge.ia:null,ge.W),Vt.K){gl(ge.h,Vt);var Jr=Vt,mi=ge.L;mi&&(Jr.I=mi),Jr.B&&(Ic(Jr),$r(Jr)),ge.g=Vt}else eu(ge);0<re.i.length&&Oc(re)}else Cr[0]!="stop"&&Cr[0]!="close"||Yu(re,7);else re.G==3&&(Cr[0]=="stop"||Cr[0]=="close"?Cr[0]=="stop"?Yu(re,7):rs(re):Cr[0]!="noop"&&re.l&&re.l.ta(Cr),re.v=0)}}nc(4)}catch{}}var zd=class{constructor(A,z){this.g=A,this.map=z}};function Kl(A){this.l=A||10,y.PerformanceNavigationTiming?(A=y.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Co(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function Yf(A){return A.h?1:A.g?A.g.size:0}function ao(A,z){return A.h?A.h==z:A.g?A.g.has(z):!1}function mp(A,z){A.g?A.g.add(z):A.h=z}function gl(A,z){A.h&&A.h==z?A.h=null:A.g&&A.g.has(z)&&A.g.delete(z)}Kl.prototype.cancel=function(){if(this.i=Gd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function Gd(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let z=A.i;for(const re of A.g.values())z=z.concat(re.D);return z}return B(A.i)}function Hd(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(v(A)){for(var z=[],re=A.length,ge=0;ge<re;ge++)z.push(A[ge]);return z}z=[],re=0;for(ge in A)z[re++]=A[ge];return z}function _r(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(v(A)||typeof A=="string"){var z=[];A=A.length;for(var re=0;re<A;re++)z.push(re);return z}z=[],re=0;for(const ge in A)z[re++]=ge;return z}}}function ql(A,z){if(A.forEach&&typeof A.forEach=="function")A.forEach(z,void 0);else if(v(A)||typeof A=="string")Array.prototype.forEach.call(A,z,void 0);else for(var re=_r(A),ge=Hd(A),qe=ge.length,ot=0;ot<qe;ot++)z.call(void 0,ge[ot],re&&re[ot],A)}var Yl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function zu(A,z){if(A){A=A.split("&");for(var re=0;re<A.length;re++){var ge=A[re].indexOf("="),qe=null;if(0<=ge){var ot=A[re].substring(0,ge);qe=A[re].substring(ge+1)}else ot=A[re];z(ot,qe?decodeURIComponent(qe.replace(/\+/g," ")):"")}}}function ic(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof ic){this.h=A.h,Gu(this,A.j),this.o=A.o,this.g=A.g,_l(this,A.s),this.l=A.l;var z=A.i,re=new qo;re.i=z.i,z.g&&(re.g=new Map(z.g),re.h=z.h),Xl(this,re),this.m=A.m}else A&&(z=String(A).match(Yl))?(this.h=!1,Gu(this,z[1]||"",!0),this.o=cr(z[2]||""),this.g=cr(z[3]||"",!0),_l(this,z[4]),this.l=cr(z[5]||"",!0),Xl(this,z[6]||"",!0),this.m=cr(z[7]||"")):(this.h=!1,this.i=new qo(null,this.h))}ic.prototype.toString=function(){var A=[],z=this.j;z&&A.push(Ac(z,Jl,!0),":");var re=this.g;return(re||z=="file")&&(A.push("//"),(z=this.o)&&A.push(Ac(z,Jl,!0),"@"),A.push(encodeURIComponent(String(re)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),re=this.s,re!=null&&A.push(":",String(re))),(re=this.l)&&(this.g&&re.charAt(0)!="/"&&A.push("/"),A.push(Ac(re,re.charAt(0)=="/"?gp:$d,!0))),(re=this.i.toString())&&A.push("?",re),(re=this.m)&&A.push("#",Ac(re,_p)),A.join("")};function Ko(A){return new ic(A)}function Gu(A,z,re){A.j=re?cr(z,!0):z,A.j&&(A.j=A.j.replace(/:$/,""))}function _l(A,z){if(z){if(z=Number(z),isNaN(z)||0>z)throw Error("Bad port number "+z);A.s=z}else A.s=null}function Xl(A,z,re){z instanceof qo?(A.i=z,Qo(A.i,A.h)):(re||(z=Ac(z,Jf)),A.i=new qo(z,A.h))}function Xr(A,z,re){A.i.set(z,re)}function sc(A){return Xr(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function cr(A,z){return A?z?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function Ac(A,z,re){return typeof A=="string"?(A=encodeURI(A).replace(z,Xf),re&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function Xf(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var Jl=/[#\/\?@]/g,$d=/[#\?:]/g,gp=/[#\?]/g,Jf=/[#\?@]/g,_p=/#/g;function qo(A,z){this.h=this.g=null,this.i=A||null,this.j=!!z}function us(A){A.g||(A.g=new Map,A.h=0,A.i&&zu(A.i,function(z,re){A.add(decodeURIComponent(z.replace(/\+/g," ")),re)}))}n=qo.prototype,n.add=function(A,z){us(this),this.i=null,A=Jo(this,A);var re=this.g.get(A);return re||this.g.set(A,re=[]),re.push(z),this.h+=1,this};function Yo(A,z){us(A),z=Jo(A,z),A.g.has(z)&&(A.i=null,A.h-=A.g.get(z).length,A.g.delete(z))}function Xo(A,z){return us(A),z=Jo(A,z),A.g.has(z)}n.forEach=function(A,z){us(this),this.g.forEach(function(re,ge){re.forEach(function(qe){A.call(z,qe,ge,this)},this)},this)},n.na=function(){us(this);const A=Array.from(this.g.values()),z=Array.from(this.g.keys()),re=[];for(let ge=0;ge<z.length;ge++){const qe=A[ge];for(let ot=0;ot<qe.length;ot++)re.push(z[ge])}return re},n.V=function(A){us(this);let z=[];if(typeof A=="string")Xo(this,A)&&(z=z.concat(this.g.get(Jo(this,A))));else{A=Array.from(this.g.values());for(let re=0;re<A.length;re++)z=z.concat(A[re])}return z},n.set=function(A,z){return us(this),this.i=null,A=Jo(this,A),Xo(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[z]),this.h+=1,this},n.get=function(A,z){return A?(A=this.V(A),0<A.length?String(A[0]):z):z};function Ql(A,z,re){Yo(A,z),0<re.length&&(A.i=null,A.g.set(Jo(A,z),B(re)),A.h+=re.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],z=Array.from(this.g.keys());for(var re=0;re<z.length;re++){var ge=z[re];const ot=encodeURIComponent(String(ge)),Vt=this.V(ge);for(ge=0;ge<Vt.length;ge++){var qe=ot;Vt[ge]!==""&&(qe+="="+encodeURIComponent(String(Vt[ge]))),A.push(qe)}}return this.i=A.join("&")};function Jo(A,z){return z=String(z),A.j&&(z=z.toLowerCase()),z}function Qo(A,z){z&&!A.j&&(us(A),A.i=null,A.g.forEach(function(re,ge){var qe=ge.toLowerCase();ge!=qe&&(Yo(this,ge),Ql(this,qe,re))},A)),A.j=z}function Qf(A,z){const re=new gr;if(y.Image){const ge=new Image;ge.onload=L(Es,re,"TestLoadImage: loaded",!0,z,ge),ge.onerror=L(Es,re,"TestLoadImage: error",!1,z,ge),ge.onabort=L(Es,re,"TestLoadImage: abort",!1,z,ge),ge.ontimeout=L(Es,re,"TestLoadImage: timeout",!1,z,ge),y.setTimeout(function(){ge.ontimeout&&ge.ontimeout()},1e4),ge.src=A}else z(!1)}function Pc(A,z){const re=new gr,ge=new AbortController,qe=setTimeout(()=>{ge.abort(),Es(re,"TestPingServer: timeout",!1,z)},1e4);fetch(A,{signal:ge.signal}).then(ot=>{clearTimeout(qe),ot.ok?Es(re,"TestPingServer: ok",!0,z):Es(re,"TestPingServer: server error",!1,z)}).catch(()=>{clearTimeout(qe),Es(re,"TestPingServer: error",!1,z)})}function Es(A,z,re,ge,qe){try{qe&&(qe.onload=null,qe.onerror=null,qe.onabort=null,qe.ontimeout=null),ge(re)}catch{}}function Hu(){this.g=new ec}function yp(A,z,re){const ge=re||"";try{ql(A,function(qe,ot){let Vt=qe;b(qe)&&(Vt=ii(qe)),z.push(ge+ot+"="+encodeURIComponent(Vt))})}catch(qe){throw z.push(ge+"type="+encodeURIComponent("_badmap")),qe}}function yl(A){this.l=A.Ub||null,this.j=A.eb||!1}V(yl,Ks),yl.prototype.g=function(){return new Zl(this.l,this.j)},yl.prototype.i=function(A){return function(){return A}}({});function Zl(A,z){En.call(this),this.D=A,this.o=z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}V(Zl,En),n=Zl.prototype,n.open=function(A,z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=z,this.readyState=1,Oa(this)},n.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const z={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(z.body=A),(this.D||y).fetch(new Request(this.A,z)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Pa(this)),this.readyState=0},n.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,Oa(this)),this.g&&(this.readyState=3,Oa(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Zf(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function Zf(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}n.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var z=A.value?A.value:new Uint8Array(0);(z=this.v.decode(z,{stream:!A.done}))&&(this.response=this.responseText+=z)}A.done?Pa(this):Oa(this),this.readyState==3&&Zf(this)}},n.Ra=function(A){this.g&&(this.response=this.responseText=A,Pa(this))},n.Qa=function(A){this.g&&(this.response=A,Pa(this))},n.ga=function(){this.g&&Pa(this)};function Pa(A){A.readyState=4,A.l=null,A.j=null,A.v=null,Oa(A)}n.setRequestHeader=function(A,z){this.u.append(A,z)},n.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],z=this.h.entries();for(var re=z.next();!re.done;)re=re.value,A.push(re[0]+": "+re[1]),re=z.next();return A.join(`\r
`)};function Oa(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(Zl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function El(A){let z="";return de(A,function(re,ge){z+=ge,z+=":",z+=re,z+=`\r
`}),z}function Ce(A,z,re){e:{for(ge in re){var ge=!1;break e}ge=!0}ge||(re=El(re),typeof A=="string"?re!=null&&encodeURIComponent(String(re)):Xr(A,z,re))}function De(A){En.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}V(De,En);var tt=/^https?$/i,Jt=["POST","PUT"];n=De.prototype,n.Ha=function(A){this.J=A},n.ea=function(A,z,re,ge){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);z=z?z.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():bi.g(),this.v=this.o?qs(this.o):qs(bi),this.g.onreadystatechange=k(this.Ea,this);try{this.B=!0,this.g.open(z,String(A),!0),this.B=!1}catch(ot){Qn(this,ot);return}if(A=re||"",re=new Map(this.headers),ge)if(Object.getPrototypeOf(ge)===Object.prototype)for(var qe in ge)re.set(qe,ge[qe]);else if(typeof ge.keys=="function"&&typeof ge.get=="function")for(const ot of ge.keys())re.set(ot,ge.get(ot));else throw Error("Unknown input type for opt_headers: "+String(ge));ge=Array.from(re.keys()).find(ot=>ot.toLowerCase()=="content-type"),qe=y.FormData&&A instanceof y.FormData,!(0<=Array.prototype.indexOf.call(Jt,z,void 0))||ge||qe||re.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ot,Vt]of re)this.g.setRequestHeader(ot,Vt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Fr(this),this.u=!0,this.g.send(A),this.u=!1}catch(ot){Qn(this,ot)}};function Qn(A,z){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=z,A.m=5,wr(A),hn(A)}function wr(A){A.A||(A.A=!0,en(A,"complete"),en(A,"error"))}n.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,en(this,"complete"),en(this,"abort"),hn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),hn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Kr(this):this.bb())},n.bb=function(){Kr(this)};function Kr(A){if(A.h&&typeof f<"u"&&(!A.v[1]||wi(A)!=4||A.Z()!=2)){if(A.u&&wi(A)==4)nr(A.Ea,0,A);else if(en(A,"readystatechange"),wi(A)==4){A.h=!1;try{const Vt=A.Z();e:switch(Vt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var z=!0;break e;default:z=!1}var re;if(!(re=z)){var ge;if(ge=Vt===0){var qe=String(A.D).match(Yl)[1]||null;!qe&&y.self&&y.self.location&&(qe=y.self.location.protocol.slice(0,-1)),ge=!tt.test(qe?qe.toLowerCase():"")}re=ge}if(re)en(A,"complete"),en(A,"success");else{A.m=6;try{var ot=2<wi(A)?A.g.statusText:""}catch{ot=""}A.l=ot+" ["+A.Z()+"]",wr(A)}}finally{hn(A)}}}}function hn(A,z){if(A.g){Fr(A);const re=A.g,ge=A.v[0]?()=>{}:null;A.g=null,A.v=null,z||en(A,"ready");try{re.onreadystatechange=ge}catch{}}}function Fr(A){A.I&&(y.clearTimeout(A.I),A.I=null)}n.isActive=function(){return!!this.g};function wi(A){return A.g?A.g.readyState:0}n.Z=function(){try{return 2<wi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(A){if(this.g){var z=this.g.responseText;return A&&z.indexOf(A)==0&&(z=z.substring(A.length)),Ho(z)}};function Ms(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function Zo(A){const z={};A=(A.g&&2<=wi(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let ge=0;ge<A.length;ge++){if($(A[ge]))continue;var re=me(A[ge]);const qe=re[0];if(re=re[1],typeof re!="string")continue;re=re.trim();const ot=z[qe]||[];z[qe]=ot,ot.push(re)}Y(z,function(ge){return ge.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ea(A,z,re){return re&&re.internalChannelParams&&re.internalChannelParams[A]||z}function $u(A){this.Aa=0,this.i=[],this.j=new gr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ea("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ea("baseRetryDelayMs",5e3,A),this.cb=ea("retryDelaySeedMs",1e4,A),this.Wa=ea("forwardChannelMaxRetries",2,A),this.wa=ea("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new Kl(A&&A.concurrentRequestLimit),this.Da=new Hu,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=$u.prototype,n.la=8,n.G=1,n.connect=function(A,z,re,ge){Ni(0),this.W=A,this.H=z||{},re&&ge!==void 0&&(this.H.OSID=re,this.H.OAID=ge),this.F=this.X,this.I=Bg(this,null,this.W),Oc(this)};function rs(A){if(Kd(A),A.G==3){var z=A.U++,re=Ko(A.I);if(Xr(re,"SID",A.K),Xr(re,"RID",z),Xr(re,"TYPE","terminate"),Ku(A,re),z=new Fi(A,A.j,z),z.L=2,z.v=sc(Ko(re)),re=!1,y.navigator&&y.navigator.sendBeacon)try{re=y.navigator.sendBeacon(z.v.toString(),"")}catch{}!re&&y.Image&&(new Image().src=z.v,re=!0),re||(z.g=Zy(z.j,null),z.g.ea(z.v)),z.F=Date.now(),$r(z)}Xu(A)}function vl(A){A.g&&(jg(A),A.g.cancel(),A.g=null)}function Kd(A){vl(A),A.u&&(y.clearTimeout(A.u),A.u=null),nm(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&y.clearTimeout(A.s),A.s=null)}function Oc(A){if(!Co(A.h)&&!A.s){A.s=!0;var z=A.Ga;ve||ke(),_e||(ve(),_e=!0),Ee.add(z,A),A.B=0}}function Fg(A,z){return Yf(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=z.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=dn(k(A.Ga,A,z),qu(A,A.B)),A.B++,!0)}n.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const qe=new Fi(this,this.j,A);let ot=this.o;if(this.S&&(ot?(ot=X(ot),se(ot,this.S)):ot=this.S),this.m!==null||this.O||(qe.H=ot,ot=null),this.P)e:{for(var z=0,re=0;re<this.i.length;re++){t:{var ge=this.i[re];if("__data__"in ge.map&&(ge=ge.map.__data__,typeof ge=="string")){ge=ge.length;break t}ge=void 0}if(ge===void 0)break;if(z+=ge,4096<z){z=re;break e}if(z===4096||re===this.i.length-1){z=re+1;break e}}z=1e3}else z=1e3;z=ta(this,qe,z),re=Ko(this.I),Xr(re,"RID",A),Xr(re,"CVER",22),this.D&&Xr(re,"X-HTTP-Session-Id",this.D),Ku(this,re),ot&&(this.O?z="headers="+encodeURIComponent(String(El(ot)))+"&"+z:this.m&&Ce(re,this.m,ot)),mp(this.h,qe),this.Ua&&Xr(re,"TYPE","init"),this.P?(Xr(re,"$req",z),Xr(re,"SID","null"),qe.T=!0,Bd(qe,re,null)):Bd(qe,re,z),this.G=2}}else this.G==3&&(A?em(this,A):this.i.length==0||Co(this.h)||em(this))};function em(A,z){var re;z?re=z.l:re=A.U++;const ge=Ko(A.I);Xr(ge,"SID",A.K),Xr(ge,"RID",re),Xr(ge,"AID",A.T),Ku(A,ge),A.m&&A.o&&Ce(ge,A.m,A.o),re=new Fi(A,A.j,re,A.B+1),A.m===null&&(re.H=A.o),z&&(A.i=z.D.concat(A.i)),z=ta(A,re,1e3),re.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),mp(A.h,re),Bd(re,ge,z)}function Ku(A,z){A.H&&de(A.H,function(re,ge){Xr(z,ge,re)}),A.l&&ql({},function(re,ge){Xr(z,ge,re)})}function ta(A,z,re){re=Math.min(A.i.length,re);var ge=A.l?k(A.l.Na,A.l,A):null;e:{var qe=A.i;let ot=-1;for(;;){const Vt=["count="+re];ot==-1?0<re?(ot=qe[0].g,Vt.push("ofs="+ot)):ot=0:Vt.push("ofs="+ot);let Jr=!0;for(let mi=0;mi<re;mi++){let Cr=qe[mi].g;const Ys=qe[mi].map;if(Cr-=ot,0>Cr)ot=Math.max(0,qe[mi].g-100),Jr=!1;else try{yp(Ys,Vt,"req"+Cr+"_")}catch{ge&&ge(Ys)}}if(Jr){ge=Vt.join("&");break e}}}return A=A.i.splice(0,re),z.D=A,ge}function eu(A){if(!A.g&&!A.u){A.Y=1;var z=A.Fa;ve||ke(),_e||(ve(),_e=!0),Ee.add(z,A),A.v=0}}function tm(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=dn(k(A.Fa,A),qu(A,A.v)),A.v++,!0)}n.Fa=function(){if(this.u=null,Qy(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=dn(k(this.ab,this),A)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ni(10),vl(this),Qy(this))};function jg(A){A.A!=null&&(y.clearTimeout(A.A),A.A=null)}function Qy(A){A.g=new Fi(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var z=Ko(A.qa);Xr(z,"RID","rpc"),Xr(z,"SID",A.K),Xr(z,"AID",A.T),Xr(z,"CI",A.F?"0":"1"),!A.F&&A.ja&&Xr(z,"TO",A.ja),Xr(z,"TYPE","xmlhttp"),Ku(A,z),A.m&&A.o&&Ce(z,A.m,A.o),A.L&&(A.g.I=A.L);var re=A.g;A=A.ia,re.L=1,re.v=sc(Ko(z)),re.m=null,re.P=!0,Wu(re,A)}n.Za=function(){this.C!=null&&(this.C=null,vl(this),tm(this),Ni(19))};function nm(A){A.C!=null&&(y.clearTimeout(A.C),A.C=null)}function rm(A,z){var re=null;if(A.g==z){nm(A),jg(A),A.g=null;var ge=2}else if(ao(A.h,z))re=z.D,gl(A.h,z),ge=1;else return;if(A.G!=0){if(z.o)if(ge==1){re=z.m?z.m.length:0,z=Date.now()-z.F;var qe=A.B;ge=pl(),en(ge,new gt(ge,re)),Oc(A)}else eu(A);else if(qe=z.s,qe==3||qe==0&&0<z.X||!(ge==1&&Fg(A,z)||ge==2&&tm(A)))switch(re&&0<re.length&&(z=A.h,z.i=z.i.concat(re)),qe){case 1:Yu(A,5);break;case 4:Yu(A,10);break;case 3:Yu(A,6);break;default:Yu(A,2)}}}function qu(A,z){let re=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(re*=2),re*z}function Yu(A,z){if(A.j.info("Error code "+z),z==2){var re=k(A.fb,A),ge=A.Xa;const qe=!ge;ge=new ic(ge||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||Gu(ge,"https"),sc(ge),qe?Qf(ge.toString(),re):Pc(ge.toString(),re)}else Ni(2);A.G=0,A.l&&A.l.sa(z),Xu(A),Kd(A)}n.fb=function(A){A?(this.j.info("Successfully pinged google.com"),Ni(2)):(this.j.info("Failed to ping google.com"),Ni(1))};function Xu(A){if(A.G=0,A.ka=[],A.l){const z=Gd(A.h);(z.length!=0||A.i.length!=0)&&(W(A.ka,z),W(A.ka,A.i),A.h.i.length=0,B(A.i),A.i.length=0),A.l.ra()}}function Bg(A,z,re){var ge=re instanceof ic?Ko(re):new ic(re);if(ge.g!="")z&&(ge.g=z+"."+ge.g),_l(ge,ge.s);else{var qe=y.location;ge=qe.protocol,z=z?z+"."+qe.hostname:qe.hostname,qe=+qe.port;var ot=new ic(null);ge&&Gu(ot,ge),z&&(ot.g=z),qe&&_l(ot,qe),re&&(ot.l=re),ge=ot}return re=A.D,z=A.ya,re&&z&&Xr(ge,re,z),Xr(ge,"VER",A.la),Ku(A,ge),ge}function Zy(A,z,re){if(z&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return z=A.Ca&&!A.pa?new De(new yl({eb:re})):new De(A.pa),z.Ha(A.J),z}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function zn(){}n=zn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function im(){}im.prototype.g=function(A,z){return new na(A,z)};function na(A,z){En.call(this),this.g=new $u(z),this.l=A,this.h=z&&z.messageUrlParams||null,A=z&&z.messageHeaders||null,z&&z.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=z&&z.initMessageHeaders||null,z&&z.messageContentType&&(A?A["X-WebChannel-Content-Type"]=z.messageContentType:A={"X-WebChannel-Content-Type":z.messageContentType}),z&&z.va&&(A?A["X-WebChannel-Client-Profile"]=z.va:A={"X-WebChannel-Client-Profile":z.va}),this.g.S=A,(A=z&&z.Sb)&&!$(A)&&(this.g.m=A),this.v=z&&z.supportsCrossDomainXhr||!1,this.u=z&&z.sendRawJson||!1,(z=z&&z.httpSessionIdParam)&&!$(z)&&(this.g.D=z,A=this.h,A!==null&&z in A&&(A=this.h,z in A&&delete A[z])),this.j=new kc(this)}V(na,En),na.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},na.prototype.close=function(){rs(this.g)},na.prototype.o=function(A){var z=this.g;if(typeof A=="string"){var re={};re.__data__=A,A=re}else this.u&&(re={},re.__data__=ii(A),A=re);z.i.push(new zd(z.Ya++,A)),z.G==3&&Oc(z)},na.prototype.N=function(){this.g.l=null,delete this.j,rs(this.g),delete this.g,na.aa.N.call(this)};function eE(A){Ca.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var z=A.__sm__;if(z){e:{for(const re in z){A=re;break e}A=void 0}(this.i=A)&&(A=this.i,z=z!==null&&A in z?z[A]:void 0),this.data=z}else this.data=A}V(eE,Ca);function tE(){To.call(this),this.status=1}V(tE,To);function kc(A){this.g=A}V(kc,zn),kc.prototype.ua=function(){en(this.g,"a")},kc.prototype.ta=function(A){en(this.g,new eE(A))},kc.prototype.sa=function(A){en(this.g,new tE)},kc.prototype.ra=function(){en(this.g,"b")},im.prototype.createWebChannel=im.prototype.g,na.prototype.send=na.prototype.o,na.prototype.open=na.prototype.m,na.prototype.close=na.prototype.close,Zre=function(){return new im},Qre=function(){return pl()},Jre=Ra,vV={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},fl.NO_ERROR=0,fl.TIMEOUT=8,fl.HTTP_ERROR=6,ak=fl,$l.COMPLETE="complete",Xre=$l,Rc.EventType=ys,ys.OPEN="a",ys.CLOSE="b",ys.ERROR="c",ys.MESSAGE="d",En.prototype.listen=En.prototype.K,Bw=Rc,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,Yre=De}).apply(typeof bO<"u"?bO:typeof self<"u"?self:typeof window<"u"?window:{});const RX="@firebase/firestore",IX="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Ya.UNAUTHENTICATED=new Ya(null),Ya.GOOGLE_CREDENTIALS=new Ya("google-credentials-uid"),Ya.FIRST_PARTY=new Ya("first-party-uid"),Ya.MOCK_USER=new Ya("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let W0="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jy=new Uj("@firebase/firestore");function bS(){return jy.logLevel}function nn(n,...t){if(jy.logLevel<=Ar.DEBUG){const s=t.map(qj);jy.debug(`Firestore (${W0}): ${n}`,...s)}}function Wf(n,...t){if(jy.logLevel<=Ar.ERROR){const s=t.map(qj);jy.error(`Firestore (${W0}): ${n}`,...s)}}function S0(n,...t){if(jy.logLevel<=Ar.WARN){const s=t.map(qj);jy.warn(`Firestore (${W0}): ${n}`,...s)}}function qj(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kn(n="Unexpected state"){const t=`FIRESTORE (${W0}) INTERNAL ASSERTION FAILED: `+n;throw Wf(t),new Error(t)}function pi(n,t){n||Kn()}function tr(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const It={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ln extends up{constructor(t,s){super(t,s),this.code=t,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eie{constructor(t,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Oje{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,s){t.enqueueRetryable(()=>s(Ya.UNAUTHENTICATED))}shutdown(){}}class kje{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,s){this.changeListener=s,t.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class Nje{constructor(t){this.t=t,this.currentUser=Ya.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,s){pi(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,s(v)):Promise.resolve();let d=new kf;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new kf,t.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const v=d;t.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},y=v=>{nn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(v=>y(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?y(v):(nn("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new kf)}},0),f()}getToken(){const t=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(a=>this.i!==t?(nn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(pi(typeof a.accessToken=="string"),new eie(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return pi(t===null||typeof t=="string"),new Ya(t)}}class Dje{constructor(t,s,a){this.l=t,this.h=s,this.P=a,this.type="FirstParty",this.user=Ya.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class xje{constructor(t,s,a){this.l=t,this.h=s,this.P=a}getToken(){return Promise.resolve(new Dje(this.l,this.h,this.P))}start(t,s){t.enqueueRetryable(()=>s(Ya.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class AX{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Lje{constructor(t,s){this.A=s,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Ml(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,s){pi(this.o===void 0);const a=d=>{d.error!=null&&nn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const f=d.token!==this.R;return this.R=d.token,nn("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?s(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{nn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):nn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new AX(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(s=>s?(pi(typeof s.token=="string"),this.R=s.token,new AX(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mje(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(s);else for(let a=0;a<n;a++)s[a]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tie(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nie{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=Mje(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<s&&(a+=t.charAt(l[d]%62))}return a}}function mr(n,t){return n<t?-1:n>t?1:0}function SV(n,t){let s=0;for(;s<n.length&&s<t.length;){const a=n.codePointAt(s),l=t.codePointAt(s);if(a!==l){if(a<128&&l<128)return mr(a,l);{const d=tie(),f=Uje(d.encode(PX(n,s)),d.encode(PX(t,s)));return f!==0?f:mr(a,l)}}s+=a>65535?2:1}return mr(n.length,t.length)}function PX(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function Uje(n,t){for(let s=0;s<n.length&&s<t.length;++s)if(n[s]!==t[s])return mr(n[s],t[s]);return mr(n.length,t.length)}function b0(n,t,s){return n.length===t.length&&n.every((a,l)=>s(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OX=-62135596800,kX=1e6;class Eo{static now(){return Eo.fromMillis(Date.now())}static fromDate(t){return Eo.fromMillis(t.getTime())}static fromMillis(t){const s=Math.floor(t/1e3),a=Math.floor((t-1e3*s)*kX);return new Eo(s,a)}constructor(t,s){if(this.seconds=t,this.nanoseconds=s,s<0)throw new ln(It.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new ln(It.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(t<OX)throw new ln(It.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ln(It.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/kX}_compareTo(t){return this.seconds===t.seconds?mr(this.nanoseconds,t.nanoseconds):mr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-OX;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{static fromTimestamp(t){return new Jn(t)}static min(){return new Jn(new Eo(0,0))}static max(){return new Jn(new Eo(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NX="__name__";class Lh{constructor(t,s,a){s===void 0?s=0:s>t.length&&Kn(),a===void 0?a=t.length-s:a>t.length-s&&Kn(),this.segments=t,this.offset=s,this.len=a}get length(){return this.len}isEqual(t){return Lh.comparator(this,t)===0}child(t){const s=this.segments.slice(this.offset,this.limit());return t instanceof Lh?t.forEach(a=>{s.push(a)}):s.push(t),this.construct(s)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}forEach(t){for(let s=this.offset,a=this.limit();s<a;s++)t(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,s){const a=Math.min(t.length,s.length);for(let l=0;l<a;l++){const d=Lh.compareSegments(t.get(l),s.get(l));if(d!==0)return d}return mr(t.length,s.length)}static compareSegments(t,s){const a=Lh.isNumericId(t),l=Lh.isNumericId(s);return a&&!l?-1:!a&&l?1:a&&l?Lh.extractNumericId(t).compare(Lh.extractNumericId(s)):SV(t,s)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Eg.fromString(t.substring(4,t.length-2))}}class ts extends Lh{construct(t,s,a){return new ts(t,s,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const s=[];for(const a of t){if(a.indexOf("//")>=0)throw new ln(It.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);s.push(...a.split("/").filter(l=>l.length>0))}return new ts(s)}static emptyPath(){return new ts([])}}const Vje=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Sa extends Lh{construct(t,s,a){return new Sa(t,s,a)}static isValidIdentifier(t){return Vje.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Sa.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===NX}static keyField(){return new Sa([NX])}static fromServerFormat(t){const s=[];let a="",l=0;const d=()=>{if(a.length===0)throw new ln(It.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(a),a=""};let f=!1;for(;l<t.length;){const y=t[l];if(y==="\\"){if(l+1===t.length)throw new ln(It.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const v=t[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new ln(It.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=v,l+=2}else y==="`"?(f=!f,l++):y!=="."||f?(a+=y,l++):(d(),l++)}if(d(),f)throw new ln(It.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Sa(s)}static emptyPath(){return new Sa([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(t){this.path=t}static fromPath(t){return new An(ts.fromString(t))}static fromName(t){return new An(ts.fromString(t).popFirst(5))}static empty(){return new An(ts.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&ts.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,s){return ts.comparator(t.path,s.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new An(new ts(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC=-1;function Fje(n,t){const s=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=Jn.fromTimestamp(a===1e9?new Eo(s+1,0):new Eo(s,a));return new Cg(l,An.empty(),t)}function jje(n){return new Cg(n.readTime,n.key,MC)}class Cg{constructor(t,s,a){this.readTime=t,this.documentKey=s,this.largestBatchId=a}static min(){return new Cg(Jn.min(),An.empty(),MC)}static max(){return new Cg(Jn.max(),An.empty(),MC)}}function Bje(n,t){let s=n.readTime.compareTo(t.readTime);return s!==0?s:(s=An.comparator(n.documentKey,t.documentKey),s!==0?s:mr(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wje="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class zje{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z0(n){if(n.code!==It.FAILED_PRECONDITION||n.message!==Wje)throw n;nn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(t){return this.next(void 0,t)}next(t,s){return this.callbackAttached&&Kn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(t,this.result):new Ct((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(s,d).next(a,l)}})}toPromise(){return new Promise((t,s)=>{this.next(t,s)})}wrapUserFunction(t){try{const s=t();return s instanceof Ct?s:Ct.resolve(s)}catch(s){return Ct.reject(s)}}wrapSuccess(t,s){return t?this.wrapUserFunction(()=>t(s)):Ct.resolve(s)}wrapFailure(t,s){return t?this.wrapUserFunction(()=>t(s)):Ct.reject(s)}static resolve(t){return new Ct((s,a)=>{s(t)})}static reject(t){return new Ct((s,a)=>{a(t)})}static waitFor(t){return new Ct((s,a)=>{let l=0,d=0,f=!1;t.forEach(y=>{++l,y.next(()=>{++d,f&&d===l&&s()},v=>a(v))}),f=!0,d===l&&s()})}static or(t){let s=Ct.resolve(!1);for(const a of t)s=s.next(l=>l?Ct.resolve(l):a());return s}static forEach(t,s){const a=[];return t.forEach((l,d)=>{a.push(s.call(this,l,d))}),this.waitFor(a)}static mapArray(t,s){return new Ct((a,l)=>{const d=t.length,f=new Array(d);let y=0;for(let v=0;v<d;v++){const b=v;s(t[b]).next(w=>{f[b]=w,++y,y===d&&a(f)},w=>l(w))}})}static doWhile(t,s){return new Ct((a,l)=>{const d=()=>{t()===!0?s().next(()=>{d()},l):a()};d()})}}function Gje(n){const t=n.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function G0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B1{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=a=>this.oe(a),this._e=a=>s.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}B1.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yj=-1;function W1(n){return n==null}function Wk(n){return n===0&&1/n==-1/0}function Hje(n){return typeof n=="number"&&Number.isInteger(n)&&!Wk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rie="";function $je(n){let t="";for(let s=0;s<n.length;s++)t.length>0&&(t=DX(t)),t=Kje(n.get(s),t);return DX(t)}function Kje(n,t){let s=t;const a=n.length;for(let l=0;l<a;l++){const d=n.charAt(l);switch(d){case"\0":s+="";break;case rie:s+="";break;default:s+=d}}return s}function DX(n){return n+rie+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xX(n){let t=0;for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t++;return t}function Ug(n,t){for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t(s,n[s])}function iie(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(t,s){this.comparator=t,this.root=s||Ea.EMPTY}insert(t,s){return new gs(this.comparator,this.root.insert(t,s,this.comparator).copy(null,null,Ea.BLACK,null,null))}remove(t){return new gs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ea.BLACK,null,null))}get(t){let s=this.root;for(;!s.isEmpty();){const a=this.comparator(t,s.key);if(a===0)return s.value;a<0?s=s.left:a>0&&(s=s.right)}return null}indexOf(t){let s=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return s+a.left.size;l<0?a=a.left:(s+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((s,a)=>(t(s,a),!1))}toString(){const t=[];return this.inorderTraversal((s,a)=>(t.push(`${s}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new TO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new TO(this.root,t,this.comparator,!1)}getReverseIterator(){return new TO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new TO(this.root,t,this.comparator,!0)}}class TO{constructor(t,s,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=s?a(t.key,s):1,s&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const s={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Ea{constructor(t,s,a,l,d){this.key=t,this.value=s,this.color=a??Ea.RED,this.left=l??Ea.EMPTY,this.right=d??Ea.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,s,a,l,d){return new Ea(t??this.key,s??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,s,a),null):d===0?l.copy(null,s,null,null,null):l.copy(null,null,null,null,l.right.insert(t,s,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Ea.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,s){let a,l=this;if(s(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,s),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),s(t,l.key)===0){if(l.right.isEmpty())return Ea.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,s))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Ea.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Ea.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Kn();const t=this.left.check();if(t!==this.right.check())throw Kn();return t+(this.isRed()?0:1)}}Ea.EMPTY=null,Ea.RED=!0,Ea.BLACK=!1;Ea.EMPTY=new class{constructor(){this.size=0}get key(){throw Kn()}get value(){throw Kn()}get color(){throw Kn()}get left(){throw Kn()}get right(){throw Kn()}copy(t,s,a,l,d){return this}insert(t,s,a){return new Ea(t,s)}remove(t,s){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(t){this.comparator=t,this.data=new gs(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((s,a)=>(t(s),!1))}forEachInRange(t,s){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;s(l.key)}}forEachWhile(t,s){let a;for(a=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const s=this.data.getIteratorFrom(t);return s.hasNext()?s.getNext().key:null}getIterator(){return new LX(this.data.getIterator())}getIteratorFrom(t){return new LX(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let s=this;return s.size<t.size&&(s=t,t=this),t.forEach(a=>{s=s.add(a)}),s}isEqual(t){if(!(t instanceof vo)||this.size!==t.size)return!1;const s=this.data.getIterator(),a=t.data.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(s=>{t.push(s)}),t}toString(){const t=[];return this.forEach(s=>t.push(s)),"SortedSet("+t.toString()+")"}copy(t){const s=new vo(this.comparator);return s.data=t,s}}class LX{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{constructor(t){this.fields=t,t.sort(Sa.comparator)}static empty(){return new Vl([])}unionWith(t){let s=new vo(Sa.comparator);for(const a of this.fields)s=s.add(a);for(const a of t)s=s.add(a);return new Vl(s.toArray())}covers(t){for(const s of this.fields)if(s.isPrefixOf(t))return!0;return!1}isEqual(t){return b0(this.fields,t.fields,(s,a)=>s.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sie extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(t){this.binaryString=t}static fromBase64String(t){const s=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new sie("Invalid base64 string: "+d):d}}(t);return new Ta(s)}static fromUint8Array(t){const s=function(l){let d="";for(let f=0;f<l.length;++f)d+=String.fromCharCode(l[f]);return d}(t);return new Ta(s)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return mr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ta.EMPTY_BYTE_STRING=new Ta("");const qje=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rg(n){if(pi(!!n),typeof n=="string"){let t=0;const s=qje.exec(n);if(pi(!!s),s[1]){let l=s[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:zs(n.seconds),nanos:zs(n.nanos)}}function zs(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ig(n){return typeof n=="string"?Ta.fromBase64String(n):Ta.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oie="server_timestamp",aie="__type__",cie="__previous_value__",lie="__local_write_time__";function Xj(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[aie])===null||s===void 0?void 0:s.stringValue)===oie}function z1(n){const t=n.mapValue.fields[cie];return Xj(t)?z1(t):t}function UC(n){const t=Rg(n.mapValue.fields[lie].timestampValue);return new Eo(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yje{constructor(t,s,a,l,d,f,y,v,b){this.databaseId=t,this.appId=s,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=f,this.autoDetectLongPolling=y,this.longPollingOptions=v,this.useFetchStreams=b}}const zk="(default)";class VC{constructor(t,s){this.projectId=t,this.database=s||zk}static empty(){return new VC("","")}get isDefaultDatabase(){return this.database===zk}isEqual(t){return t instanceof VC&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uie="__type__",Xje="__max__",wO={mapValue:{}},die="__vector__",Gk="value";function Ag(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Xj(n)?4:Qje(n)?9007199254740991:Jje(n)?10:11:Kn()}function ap(n,t){if(n===t)return!0;const s=Ag(n);if(s!==Ag(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return UC(n).isEqual(UC(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const f=Rg(l.timestampValue),y=Rg(d.timestampValue);return f.seconds===y.seconds&&f.nanos===y.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(l,d){return Ig(l.bytesValue).isEqual(Ig(d.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(l,d){return zs(l.geoPointValue.latitude)===zs(d.geoPointValue.latitude)&&zs(l.geoPointValue.longitude)===zs(d.geoPointValue.longitude)}(n,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return zs(l.integerValue)===zs(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const f=zs(l.doubleValue),y=zs(d.doubleValue);return f===y?Wk(f)===Wk(y):isNaN(f)&&isNaN(y)}return!1}(n,t);case 9:return b0(n.arrayValue.values||[],t.arrayValue.values||[],ap);case 10:case 11:return function(l,d){const f=l.mapValue.fields||{},y=d.mapValue.fields||{};if(xX(f)!==xX(y))return!1;for(const v in f)if(f.hasOwnProperty(v)&&(y[v]===void 0||!ap(f[v],y[v])))return!1;return!0}(n,t);default:return Kn()}}function FC(n,t){return(n.values||[]).find(s=>ap(s,t))!==void 0}function T0(n,t){if(n===t)return 0;const s=Ag(n),a=Ag(t);if(s!==a)return mr(s,a);switch(s){case 0:case 9007199254740991:return 0;case 1:return mr(n.booleanValue,t.booleanValue);case 2:return function(d,f){const y=zs(d.integerValue||d.doubleValue),v=zs(f.integerValue||f.doubleValue);return y<v?-1:y>v?1:y===v?0:isNaN(y)?isNaN(v)?0:-1:1}(n,t);case 3:return MX(n.timestampValue,t.timestampValue);case 4:return MX(UC(n),UC(t));case 5:return SV(n.stringValue,t.stringValue);case 6:return function(d,f){const y=Ig(d),v=Ig(f);return y.compareTo(v)}(n.bytesValue,t.bytesValue);case 7:return function(d,f){const y=d.split("/"),v=f.split("/");for(let b=0;b<y.length&&b<v.length;b++){const w=mr(y[b],v[b]);if(w!==0)return w}return mr(y.length,v.length)}(n.referenceValue,t.referenceValue);case 8:return function(d,f){const y=mr(zs(d.latitude),zs(f.latitude));return y!==0?y:mr(zs(d.longitude),zs(f.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return UX(n.arrayValue,t.arrayValue);case 10:return function(d,f){var y,v,b,w;const I=d.fields||{},k=f.fields||{},L=(y=I[Gk])===null||y===void 0?void 0:y.arrayValue,V=(v=k[Gk])===null||v===void 0?void 0:v.arrayValue,B=mr(((b=L==null?void 0:L.values)===null||b===void 0?void 0:b.length)||0,((w=V==null?void 0:V.values)===null||w===void 0?void 0:w.length)||0);return B!==0?B:UX(L,V)}(n.mapValue,t.mapValue);case 11:return function(d,f){if(d===wO.mapValue&&f===wO.mapValue)return 0;if(d===wO.mapValue)return 1;if(f===wO.mapValue)return-1;const y=d.fields||{},v=Object.keys(y),b=f.fields||{},w=Object.keys(b);v.sort(),w.sort();for(let I=0;I<v.length&&I<w.length;++I){const k=SV(v[I],w[I]);if(k!==0)return k;const L=T0(y[v[I]],b[w[I]]);if(L!==0)return L}return mr(v.length,w.length)}(n.mapValue,t.mapValue);default:throw Kn()}}function MX(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return mr(n,t);const s=Rg(n),a=Rg(t),l=mr(s.seconds,a.seconds);return l!==0?l:mr(s.nanos,a.nanos)}function UX(n,t){const s=n.values||[],a=t.values||[];for(let l=0;l<s.length&&l<a.length;++l){const d=T0(s[l],a[l]);if(d)return d}return mr(s.length,a.length)}function w0(n){return bV(n)}function bV(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(s){const a=Rg(s);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(s){return Ig(s).toBase64()}(n.bytesValue):"referenceValue"in n?function(s){return An.fromName(s).toString()}(n.referenceValue):"geoPointValue"in n?function(s){return`geo(${s.latitude},${s.longitude})`}(n.geoPointValue):"arrayValue"in n?function(s){let a="[",l=!0;for(const d of s.values||[])l?l=!1:a+=",",a+=bV(d);return a+"]"}(n.arrayValue):"mapValue"in n?function(s){const a=Object.keys(s.fields||{}).sort();let l="{",d=!0;for(const f of a)d?d=!1:l+=",",l+=`${f}:${bV(s.fields[f])}`;return l+"}"}(n.mapValue):Kn()}function ck(n){switch(Ag(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=z1(n);return t?16+ck(t):16;case 5:return 2*n.stringValue.length;case 6:return Ig(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+ck(d),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return Ug(a.fields,(d,f)=>{l+=d.length+ck(f)}),l}(n.mapValue);default:throw Kn()}}function VX(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function TV(n){return!!n&&"integerValue"in n}function Jj(n){return!!n&&"arrayValue"in n}function FX(n){return!!n&&"nullValue"in n}function jX(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function lk(n){return!!n&&"mapValue"in n}function Jje(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[uie])===null||s===void 0?void 0:s.stringValue)===die}function aC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return Ug(n.mapValue.fields,(s,a)=>t.mapValue.fields[s]=aC(a)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(n.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=aC(n.arrayValue.values[s]);return t}return Object.assign({},n)}function Qje(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Xje}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(t){this.value=t}static empty(){return new al({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let s=this.value;for(let a=0;a<t.length-1;++a)if(s=(s.mapValue.fields||{})[t.get(a)],!lk(s))return null;return s=(s.mapValue.fields||{})[t.lastSegment()],s||null}}set(t,s){this.getFieldsMap(t.popLast())[t.lastSegment()]=aC(s)}setAll(t){let s=Sa.emptyPath(),a={},l=[];t.forEach((f,y)=>{if(!s.isImmediateParentOf(y)){const v=this.getFieldsMap(s);this.applyChanges(v,a,l),a={},l=[],s=y.popLast()}f?a[y.lastSegment()]=aC(f):l.push(y.lastSegment())});const d=this.getFieldsMap(s);this.applyChanges(d,a,l)}delete(t){const s=this.field(t.popLast());lk(s)&&s.mapValue.fields&&delete s.mapValue.fields[t.lastSegment()]}isEqual(t){return ap(this.value,t.value)}getFieldsMap(t){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=s.mapValue.fields[t.get(a)];lk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},s.mapValue.fields[t.get(a)]=l),s=l}return s.mapValue.fields}applyChanges(t,s,a){Ug(s,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new al(aC(this.value))}}function hie(n){const t=[];return Ug(n.fields,(s,a)=>{const l=new Sa([s]);if(lk(a)){const d=hie(a.mapValue).fields;if(d.length===0)t.push(l);else for(const f of d)t.push(l.child(f))}else t.push(l)}),new Vl(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(t,s,a,l,d,f,y){this.key=t,this.documentType=s,this.version=a,this.readTime=l,this.createTime=d,this.data=f,this.documentState=y}static newInvalidDocument(t){return new Xa(t,0,Jn.min(),Jn.min(),Jn.min(),al.empty(),0)}static newFoundDocument(t,s,a,l){return new Xa(t,1,s,Jn.min(),a,l,0)}static newNoDocument(t,s){return new Xa(t,2,s,Jn.min(),Jn.min(),al.empty(),0)}static newUnknownDocument(t,s){return new Xa(t,3,s,Jn.min(),Jn.min(),al.empty(),2)}convertToFoundDocument(t,s){return!this.createTime.isEqual(Jn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=al.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=al.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Jn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Xa&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Xa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(t,s){this.position=t,this.inclusive=s}}function BX(n,t,s){let a=0;for(let l=0;l<n.position.length;l++){const d=t[l],f=n.position[l];if(d.field.isKeyField()?a=An.comparator(An.fromName(f.referenceValue),s.key):a=T0(f,s.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function WX(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let s=0;s<n.position.length;s++)if(!ap(n.position[s],t.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(t,s="asc"){this.field=t,this.dir=s}}function Zje(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pie{}class ro extends pie{constructor(t,s,a){super(),this.field=t,this.op=s,this.value=a}static create(t,s,a){return t.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(t,s,a):new t4e(t,s,a):s==="array-contains"?new i4e(t,a):s==="in"?new s4e(t,a):s==="not-in"?new o4e(t,a):s==="array-contains-any"?new a4e(t,a):new ro(t,s,a)}static createKeyFieldInFilter(t,s,a){return s==="in"?new n4e(t,a):new r4e(t,a)}matches(t){const s=t.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(T0(s,this.value)):s!==null&&Ag(this.value)===Ag(s)&&this.matchesComparison(T0(s,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Kn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Md extends pie{constructor(t,s){super(),this.filters=t,this.op=s,this.ce=null}static create(t,s){return new Md(t,s)}matches(t){return fie(this)?this.filters.find(s=>!s.matches(t))===void 0:this.filters.find(s=>s.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,s)=>t.concat(s.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function fie(n){return n.op==="and"}function mie(n){return e4e(n)&&fie(n)}function e4e(n){for(const t of n.filters)if(t instanceof Md)return!1;return!0}function wV(n){if(n instanceof ro)return n.field.canonicalString()+n.op.toString()+w0(n.value);if(mie(n))return n.filters.map(t=>wV(t)).join(",");{const t=n.filters.map(s=>wV(s)).join(",");return`${n.op}(${t})`}}function gie(n,t){return n instanceof ro?function(a,l){return l instanceof ro&&a.op===l.op&&a.field.isEqual(l.field)&&ap(a.value,l.value)}(n,t):n instanceof Md?function(a,l){return l instanceof Md&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,f,y)=>d&&gie(f,l.filters[y]),!0):!1}(n,t):void Kn()}function _ie(n){return n instanceof ro?function(s){return`${s.field.canonicalString()} ${s.op} ${w0(s.value)}`}(n):n instanceof Md?function(s){return s.op.toString()+" {"+s.getFilters().map(_ie).join(" ,")+"}"}(n):"Filter"}class t4e extends ro{constructor(t,s,a){super(t,s,a),this.key=An.fromName(a.referenceValue)}matches(t){const s=An.comparator(t.key,this.key);return this.matchesComparison(s)}}class n4e extends ro{constructor(t,s){super(t,"in",s),this.keys=yie("in",s)}matches(t){return this.keys.some(s=>s.isEqual(t.key))}}class r4e extends ro{constructor(t,s){super(t,"not-in",s),this.keys=yie("not-in",s)}matches(t){return!this.keys.some(s=>s.isEqual(t.key))}}function yie(n,t){var s;return(((s=t.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(a=>An.fromName(a.referenceValue))}class i4e extends ro{constructor(t,s){super(t,"array-contains",s)}matches(t){const s=t.data.field(this.field);return Jj(s)&&FC(s.arrayValue,this.value)}}class s4e extends ro{constructor(t,s){super(t,"in",s)}matches(t){const s=t.data.field(this.field);return s!==null&&FC(this.value.arrayValue,s)}}class o4e extends ro{constructor(t,s){super(t,"not-in",s)}matches(t){if(FC(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=t.data.field(this.field);return s!==null&&!FC(this.value.arrayValue,s)}}class a4e extends ro{constructor(t,s){super(t,"array-contains-any",s)}matches(t){const s=t.data.field(this.field);return!(!Jj(s)||!s.arrayValue.values)&&s.arrayValue.values.some(a=>FC(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c4e{constructor(t,s=null,a=[],l=[],d=null,f=null,y=null){this.path=t,this.collectionGroup=s,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=f,this.endAt=y,this.le=null}}function zX(n,t=null,s=[],a=[],l=null,d=null,f=null){return new c4e(n,t,s,a,l,d,f)}function Qj(n){const t=tr(n);if(t.le===null){let s=t.path.canonicalString();t.collectionGroup!==null&&(s+="|cg:"+t.collectionGroup),s+="|f:",s+=t.filters.map(a=>wV(a)).join(","),s+="|ob:",s+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),W1(t.limit)||(s+="|l:",s+=t.limit),t.startAt&&(s+="|lb:",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(a=>w0(a)).join(",")),t.endAt&&(s+="|ub:",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(a=>w0(a)).join(",")),t.le=s}return t.le}function Zj(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!Zje(n.orderBy[s],t.orderBy[s]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if(!gie(n.filters[s],t.filters[s]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!WX(n.startAt,t.startAt)&&WX(n.endAt,t.endAt)}function CV(n){return An.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR{constructor(t,s=null,a=[],l=[],d=null,f="F",y=null,v=null){this.path=t,this.collectionGroup=s,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=f,this.startAt=y,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function l4e(n,t,s,a,l,d,f,y){return new aR(n,t,s,a,l,d,f,y)}function e4(n){return new aR(n)}function GX(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Eie(n){return n.collectionGroup!==null}function cC(n){const t=tr(n);if(t.he===null){t.he=[];const s=new Set;for(const d of t.explicitOrderBy)t.he.push(d),s.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(f){let y=new vo(Sa.comparator);return f.filters.forEach(v=>{v.getFlattenedFilters().forEach(b=>{b.isInequality()&&(y=y.add(b.field))})}),y})(t).forEach(d=>{s.has(d.canonicalString())||d.isKeyField()||t.he.push(new $k(d,a))}),s.has(Sa.keyField().canonicalString())||t.he.push(new $k(Sa.keyField(),a))}return t.he}function rp(n){const t=tr(n);return t.Pe||(t.Pe=u4e(t,cC(n))),t.Pe}function u4e(n,t){if(n.limitType==="F")return zX(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new $k(l.field,d)});const s=n.endAt?new Hk(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new Hk(n.startAt.position,n.startAt.inclusive):null;return zX(n.path,n.collectionGroup,t,n.filters,n.limit,s,a)}}function RV(n,t){const s=n.filters.concat([t]);return new aR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),s,n.limit,n.limitType,n.startAt,n.endAt)}function Kk(n,t,s){return new aR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,s,n.startAt,n.endAt)}function G1(n,t){return Zj(rp(n),rp(t))&&n.limitType===t.limitType}function vie(n){return`${Qj(rp(n))}|lt:${n.limitType}`}function TS(n){return`Query(target=${function(s){let a=s.path.canonicalString();return s.collectionGroup!==null&&(a+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(a+=`, filters: [${s.filters.map(l=>_ie(l)).join(", ")}]`),W1(s.limit)||(a+=", limit: "+s.limit),s.orderBy.length>0&&(a+=`, orderBy: [${s.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),s.startAt&&(a+=", startAt: ",a+=s.startAt.inclusive?"b:":"a:",a+=s.startAt.position.map(l=>w0(l)).join(",")),s.endAt&&(a+=", endAt: ",a+=s.endAt.inclusive?"a:":"b:",a+=s.endAt.position.map(l=>w0(l)).join(",")),`Target(${a})`}(rp(n))}; limitType=${n.limitType})`}function H1(n,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):An.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(n,t)&&function(a,l){for(const d of cC(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(n,t)&&function(a,l){return!(a.startAt&&!function(f,y,v){const b=BX(f,y,v);return f.inclusive?b<=0:b<0}(a.startAt,cC(a),l)||a.endAt&&!function(f,y,v){const b=BX(f,y,v);return f.inclusive?b>=0:b>0}(a.endAt,cC(a),l))}(n,t)}function d4e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Sie(n){return(t,s)=>{let a=!1;for(const l of cC(n)){const d=h4e(l,t,s);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function h4e(n,t,s){const a=n.field.isKeyField()?An.comparator(t.key,s.key):function(d,f,y){const v=f.data.field(d),b=y.data.field(d);return v!==null&&b!==null?T0(v,b):Kn()}(n.field,t,s);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return Kn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ky{constructor(t,s){this.mapKeyFn=t,this.equalsFn=s,this.inner={},this.innerSize=0}get(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,s){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,s]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,s]);l.push([t,s]),this.innerSize++}delete(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[s]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){Ug(this.inner,(s,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return iie(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p4e=new gs(An.comparator);function zf(){return p4e}const bie=new gs(An.comparator);function Ww(...n){let t=bie;for(const s of n)t=t.insert(s.key,s);return t}function Tie(n){let t=bie;return n.forEach((s,a)=>t=t.insert(s,a.overlayedDocument)),t}function gy(){return lC()}function wie(){return lC()}function lC(){return new Ky(n=>n.toString(),(n,t)=>n.isEqual(t))}const f4e=new gs(An.comparator),m4e=new vo(An.comparator);function Pr(...n){let t=m4e;for(const s of n)t=t.add(s);return t}const g4e=new vo(mr);function _4e(){return g4e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t4(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wk(t)?"-0":t}}function Cie(n){return{integerValue:""+n}}function y4e(n,t){return Hje(t)?Cie(t):t4(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $1{constructor(){this._=void 0}}function E4e(n,t,s){return n instanceof qk?function(l,d){const f={fields:{[aie]:{stringValue:oie},[lie]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&Xj(d)&&(d=z1(d)),d&&(f.fields[cie]=d),{mapValue:f}}(s,t):n instanceof C0?Iie(n,t):n instanceof R0?Aie(n,t):function(l,d){const f=Rie(l,d),y=HX(f)+HX(l.Ie);return TV(f)&&TV(l.Ie)?Cie(y):t4(l.serializer,y)}(n,t)}function v4e(n,t,s){return n instanceof C0?Iie(n,t):n instanceof R0?Aie(n,t):s}function Rie(n,t){return n instanceof Yk?function(a){return TV(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class qk extends $1{}class C0 extends $1{constructor(t){super(),this.elements=t}}function Iie(n,t){const s=Pie(t);for(const a of n.elements)s.some(l=>ap(l,a))||s.push(a);return{arrayValue:{values:s}}}class R0 extends $1{constructor(t){super(),this.elements=t}}function Aie(n,t){let s=Pie(t);for(const a of n.elements)s=s.filter(l=>!ap(l,a));return{arrayValue:{values:s}}}class Yk extends $1{constructor(t,s){super(),this.serializer=t,this.Ie=s}}function HX(n){return zs(n.integerValue||n.doubleValue)}function Pie(n){return Jj(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oie{constructor(t,s){this.field=t,this.transform=s}}function S4e(n,t){return n.field.isEqual(t.field)&&function(a,l){return a instanceof C0&&l instanceof C0||a instanceof R0&&l instanceof R0?b0(a.elements,l.elements,ap):a instanceof Yk&&l instanceof Yk?ap(a.Ie,l.Ie):a instanceof qk&&l instanceof qk}(n.transform,t.transform)}class b4e{constructor(t,s){this.version=t,this.transformResults=s}}class Lu{constructor(t,s){this.updateTime=t,this.exists=s}static none(){return new Lu}static exists(t){return new Lu(void 0,t)}static updateTime(t){return new Lu(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function uk(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class K1{}function kie(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new n4(n.key,Lu.none()):new cR(n.key,n.data,Lu.none());{const s=n.data,a=al.empty();let l=new vo(Sa.comparator);for(let d of t.fields)if(!l.has(d)){let f=s.field(d);f===null&&d.length>1&&(d=d.popLast(),f=s.field(d)),f===null?a.delete(d):a.set(d,f),l=l.add(d)}return new Vg(n.key,a,new Vl(l.toArray()),Lu.none())}}function T4e(n,t,s){n instanceof cR?function(l,d,f){const y=l.value.clone(),v=KX(l.fieldTransforms,d,f.transformResults);y.setAll(v),d.convertToFoundDocument(f.version,y).setHasCommittedMutations()}(n,t,s):n instanceof Vg?function(l,d,f){if(!uk(l.precondition,d))return void d.convertToUnknownDocument(f.version);const y=KX(l.fieldTransforms,d,f.transformResults),v=d.data;v.setAll(Nie(l)),v.setAll(y),d.convertToFoundDocument(f.version,v).setHasCommittedMutations()}(n,t,s):function(l,d,f){d.convertToNoDocument(f.version).setHasCommittedMutations()}(0,t,s)}function uC(n,t,s,a){return n instanceof cR?function(d,f,y,v){if(!uk(d.precondition,f))return y;const b=d.value.clone(),w=qX(d.fieldTransforms,v,f);return b.setAll(w),f.convertToFoundDocument(f.version,b).setHasLocalMutations(),null}(n,t,s,a):n instanceof Vg?function(d,f,y,v){if(!uk(d.precondition,f))return y;const b=qX(d.fieldTransforms,v,f),w=f.data;return w.setAll(Nie(d)),w.setAll(b),f.convertToFoundDocument(f.version,w).setHasLocalMutations(),y===null?null:y.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(I=>I.field))}(n,t,s,a):function(d,f,y){return uk(d.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):y}(n,t,s)}function w4e(n,t){let s=null;for(const a of n.fieldTransforms){const l=t.data.field(a.field),d=Rie(a.transform,l||null);d!=null&&(s===null&&(s=al.empty()),s.set(a.field,d))}return s||null}function $X(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&b0(a,l,(d,f)=>S4e(d,f))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class cR extends K1{constructor(t,s,a,l=[]){super(),this.key=t,this.value=s,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Vg extends K1{constructor(t,s,a,l,d=[]){super(),this.key=t,this.data=s,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function Nie(n){const t=new Map;return n.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const a=n.data.field(s);t.set(s,a)}}),t}function KX(n,t,s){const a=new Map;pi(n.length===s.length);for(let l=0;l<s.length;l++){const d=n[l],f=d.transform,y=t.data.field(d.field);a.set(d.field,v4e(f,y,s[l]))}return a}function qX(n,t,s){const a=new Map;for(const l of n){const d=l.transform,f=s.data.field(l.field);a.set(l.field,E4e(d,f,t))}return a}class n4 extends K1{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class C4e extends K1{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R4e{constructor(t,s,a,l){this.batchId=t,this.localWriteTime=s,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,s){const a=s.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&T4e(d,t,a[l])}}applyToLocalView(t,s){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(s=uC(a,t,s,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(s=uC(a,t,s,this.localWriteTime));return s}applyToLocalDocumentSet(t,s){const a=wie();return this.mutations.forEach(l=>{const d=t.get(l.key),f=d.overlayedDocument;let y=this.applyToLocalView(f,d.mutatedFields);y=s.has(l.key)?null:y;const v=kie(f,y);v!==null&&a.set(l.key,v),f.isValidDocument()||f.convertToNoDocument(Jn.min())}),a}keys(){return this.mutations.reduce((t,s)=>t.add(s.key),Pr())}isEqual(t){return this.batchId===t.batchId&&b0(this.mutations,t.mutations,(s,a)=>$X(s,a))&&b0(this.baseMutations,t.baseMutations,(s,a)=>$X(s,a))}}class r4{constructor(t,s,a,l){this.batch=t,this.commitVersion=s,this.mutationResults=a,this.docVersions=l}static from(t,s,a){pi(t.mutations.length===a.length);let l=function(){return f4e}();const d=t.mutations;for(let f=0;f<d.length;f++)l=l.insert(d[f].key,a[f].version);return new r4(t,s,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I4e{constructor(t,s){this.largestBatchId=t,this.mutation=s}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A4e{constructor(t,s){this.count=t,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qs,Vr;function P4e(n){switch(n){case It.OK:return Kn();case It.CANCELLED:case It.UNKNOWN:case It.DEADLINE_EXCEEDED:case It.RESOURCE_EXHAUSTED:case It.INTERNAL:case It.UNAVAILABLE:case It.UNAUTHENTICATED:return!1;case It.INVALID_ARGUMENT:case It.NOT_FOUND:case It.ALREADY_EXISTS:case It.PERMISSION_DENIED:case It.FAILED_PRECONDITION:case It.ABORTED:case It.OUT_OF_RANGE:case It.UNIMPLEMENTED:case It.DATA_LOSS:return!0;default:return Kn()}}function Die(n){if(n===void 0)return Wf("GRPC error has no .code"),It.UNKNOWN;switch(n){case Qs.OK:return It.OK;case Qs.CANCELLED:return It.CANCELLED;case Qs.UNKNOWN:return It.UNKNOWN;case Qs.DEADLINE_EXCEEDED:return It.DEADLINE_EXCEEDED;case Qs.RESOURCE_EXHAUSTED:return It.RESOURCE_EXHAUSTED;case Qs.INTERNAL:return It.INTERNAL;case Qs.UNAVAILABLE:return It.UNAVAILABLE;case Qs.UNAUTHENTICATED:return It.UNAUTHENTICATED;case Qs.INVALID_ARGUMENT:return It.INVALID_ARGUMENT;case Qs.NOT_FOUND:return It.NOT_FOUND;case Qs.ALREADY_EXISTS:return It.ALREADY_EXISTS;case Qs.PERMISSION_DENIED:return It.PERMISSION_DENIED;case Qs.FAILED_PRECONDITION:return It.FAILED_PRECONDITION;case Qs.ABORTED:return It.ABORTED;case Qs.OUT_OF_RANGE:return It.OUT_OF_RANGE;case Qs.UNIMPLEMENTED:return It.UNIMPLEMENTED;case Qs.DATA_LOSS:return It.DATA_LOSS;default:return Kn()}}(Vr=Qs||(Qs={}))[Vr.OK=0]="OK",Vr[Vr.CANCELLED=1]="CANCELLED",Vr[Vr.UNKNOWN=2]="UNKNOWN",Vr[Vr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vr[Vr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vr[Vr.NOT_FOUND=5]="NOT_FOUND",Vr[Vr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vr[Vr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vr[Vr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vr[Vr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vr[Vr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vr[Vr.ABORTED=10]="ABORTED",Vr[Vr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vr[Vr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vr[Vr.INTERNAL=13]="INTERNAL",Vr[Vr.UNAVAILABLE=14]="UNAVAILABLE",Vr[Vr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O4e=new Eg([4294967295,4294967295],0);function YX(n){const t=tie().encode(n),s=new qre;return s.update(t),new Uint8Array(s.digest())}function XX(n){const t=new DataView(n.buffer),s=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new Eg([s,a],0),new Eg([l,d],0)]}class i4{constructor(t,s,a){if(this.bitmap=t,this.padding=s,this.hashCount=a,s<0||s>=8)throw new zw(`Invalid padding: ${s}`);if(a<0)throw new zw(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new zw(`Invalid hash count: ${a}`);if(t.length===0&&s!==0)throw new zw(`Invalid padding when bitmap length is 0: ${s}`);this.Ee=8*t.length-s,this.de=Eg.fromNumber(this.Ee)}Ae(t,s,a){let l=t.add(s.multiply(Eg.fromNumber(a)));return l.compare(O4e)===1&&(l=new Eg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const s=YX(t),[a,l]=XX(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);if(!this.Re(f))return!1}return!0}static create(t,s,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),f=new i4(d,l,s);return a.forEach(y=>f.insert(y)),f}insert(t){if(this.Ee===0)return;const s=YX(t),[a,l]=XX(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);this.Ve(f)}}Ve(t){const s=Math.floor(t/8),a=t%8;this.bitmap[s]|=1<<a}}class zw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{constructor(t,s,a,l,d){this.snapshotVersion=t,this.targetChanges=s,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,s,a){const l=new Map;return l.set(t,lR.createSynthesizedTargetChangeForCurrentChange(t,s,a)),new q1(Jn.min(),l,new gs(mr),zf(),Pr())}}class lR{constructor(t,s,a,l,d){this.resumeToken=t,this.current=s,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,s,a){return new lR(a,s,Pr(),Pr(),Pr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dk{constructor(t,s,a,l){this.me=t,this.removedTargetIds=s,this.key=a,this.fe=l}}class xie{constructor(t,s){this.targetId=t,this.ge=s}}class Lie{constructor(t,s,a=Ta.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=s,this.resumeToken=a,this.cause=l}}class JX{constructor(){this.pe=0,this.ye=QX(),this.we=Ta.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(t){t.approximateByteSize()>0&&(this.be=!0,this.we=t)}Fe(){let t=Pr(),s=Pr(),a=Pr();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:s=s.add(l);break;case 1:a=a.add(l);break;default:Kn()}}),new lR(this.we,this.Se,t,s,a)}Me(){this.be=!1,this.ye=QX()}xe(t,s){this.be=!0,this.ye=this.ye.insert(t,s)}Oe(t){this.be=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,pi(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class k4e{constructor(t){this.ke=t,this.qe=new Map,this.Qe=zf(),this.$e=CO(),this.Ue=CO(),this.Ke=new gs(mr)}We(t){for(const s of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(s,t.fe):this.ze(s,t.key,t.fe);for(const s of t.removedTargetIds)this.ze(s,t.key,t.fe)}je(t){this.forEachTarget(t,s=>{const a=this.He(s);switch(t.state){case 0:this.Je(s)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(s);break;case 3:this.Je(s)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(s)&&(this.Ye(s),a.Ce(t.resumeToken));break;default:Kn()}})}forEachTarget(t,s){t.targetIds.length>0?t.targetIds.forEach(s):this.qe.forEach((a,l)=>{this.Je(l)&&s(l)})}Ze(t){const s=t.targetId,a=t.ge.count,l=this.Xe(s);if(l){const d=l.target;if(CV(d))if(a===0){const f=new An(d.path);this.ze(s,f,Xa.newNoDocument(f,Jn.min()))}else pi(a===1);else{const f=this.et(s);if(f!==a){const y=this.tt(t),v=y?this.nt(y,t,f):1;if(v!==0){this.Ye(s);const b=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(s,b)}}}}}tt(t){const s=t.ge.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=s;let f,y;try{f=Ig(a).toUint8Array()}catch(v){if(v instanceof sie)return S0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{y=new i4(f,l,d)}catch(v){return S0(v instanceof zw?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return y.Ee===0?null:y}nt(t,s,a){return s.ge.count===a-this.st(t,s.targetId)?0:2}st(t,s){const a=this.ke.getRemoteKeysForTarget(s);let l=0;return a.forEach(d=>{const f=this.ke.it(),y=`projects/${f.projectId}/databases/${f.database}/documents/${d.path.canonicalString()}`;t.mightContain(y)||(this.ze(s,d,null),l++)}),l}ot(t){const s=new Map;this.qe.forEach((d,f)=>{const y=this.Xe(f);if(y){if(d.current&&CV(y.target)){const v=new An(y.target.path);this._t(v).has(f)||this.ut(f,v)||this.ze(f,v,Xa.newNoDocument(v,t))}d.ve&&(s.set(f,d.Fe()),d.Me())}});let a=Pr();this.Ue.forEach((d,f)=>{let y=!0;f.forEachWhile(v=>{const b=this.Xe(v);return!b||b.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)}),y&&(a=a.add(d))}),this.Qe.forEach((d,f)=>f.setReadTime(t));const l=new q1(t,s,this.Ke,this.Qe,a);return this.Qe=zf(),this.$e=CO(),this.Ue=CO(),this.Ke=new gs(mr),l}Ge(t,s){if(!this.Je(t))return;const a=this.ut(t,s.key)?2:0;this.He(t).xe(s.key,a),this.Qe=this.Qe.insert(s.key,s),this.$e=this.$e.insert(s.key,this._t(s.key).add(t)),this.Ue=this.Ue.insert(s.key,this.ct(s.key).add(t))}ze(t,s,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,s)?l.xe(s,1):l.Oe(s),this.Ue=this.Ue.insert(s,this.ct(s).delete(t)),this.Ue=this.Ue.insert(s,this.ct(s).add(t)),a&&(this.Qe=this.Qe.insert(s,a))}removeTarget(t){this.qe.delete(t)}et(t){const s=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+s.addedDocuments.size-s.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let s=this.qe.get(t);return s||(s=new JX,this.qe.set(t,s)),s}ct(t){let s=this.Ue.get(t);return s||(s=new vo(mr),this.Ue=this.Ue.insert(t,s)),s}_t(t){let s=this.$e.get(t);return s||(s=new vo(mr),this.$e=this.$e.insert(t,s)),s}Je(t){const s=this.Xe(t)!==null;return s||nn("WatchChangeAggregator","Detected inactive target",t),s}Xe(t){const s=this.qe.get(t);return s&&s.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new JX),this.ke.getRemoteKeysForTarget(t).forEach(s=>{this.ze(t,s,null)})}ut(t,s){return this.ke.getRemoteKeysForTarget(t).has(s)}}function CO(){return new gs(An.comparator)}function QX(){return new gs(An.comparator)}const N4e={asc:"ASCENDING",desc:"DESCENDING"},D4e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},x4e={and:"AND",or:"OR"};class L4e{constructor(t,s){this.databaseId=t,this.useProto3Json=s}}function IV(n,t){return n.useProto3Json||W1(t)?t:{value:t}}function Xk(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Mie(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function M4e(n,t){return Xk(n,t.toTimestamp())}function ip(n){return pi(!!n),Jn.fromTimestamp(function(s){const a=Rg(s);return new Eo(a.seconds,a.nanos)}(n))}function s4(n,t){return AV(n,t).canonicalString()}function AV(n,t){const s=function(l){return new ts(["projects",l.projectId,"databases",l.database])}(n).child("documents");return t===void 0?s:s.child(t)}function Uie(n){const t=ts.fromString(n);return pi(Wie(t)),t}function PV(n,t){return s4(n.databaseId,t.path)}function ZM(n,t){const s=Uie(t);if(s.get(1)!==n.databaseId.projectId)throw new ln(It.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+n.databaseId.projectId);if(s.get(3)!==n.databaseId.database)throw new ln(It.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+n.databaseId.database);return new An(Fie(s))}function Vie(n,t){return s4(n.databaseId,t)}function U4e(n){const t=Uie(n);return t.length===4?ts.emptyPath():Fie(t)}function OV(n){return new ts(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Fie(n){return pi(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function ZX(n,t,s){return{name:PV(n,t),fields:s.value.mapValue.fields}}function V4e(n,t){let s;if("targetChange"in t){t.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Kn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(b,w){return b.useProto3Json?(pi(w===void 0||typeof w=="string"),Ta.fromBase64String(w||"")):(pi(w===void 0||w instanceof Buffer||w instanceof Uint8Array),Ta.fromUint8Array(w||new Uint8Array))}(n,t.targetChange.resumeToken),f=t.targetChange.cause,y=f&&function(b){const w=b.code===void 0?It.UNKNOWN:Die(b.code);return new ln(w,b.message||"")}(f);s=new Lie(a,l,d,y||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=ZM(n,a.document.name),d=ip(a.document.updateTime),f=a.document.createTime?ip(a.document.createTime):Jn.min(),y=new al({mapValue:{fields:a.document.fields}}),v=Xa.newFoundDocument(l,d,f,y),b=a.targetIds||[],w=a.removedTargetIds||[];s=new dk(b,w,v.key,v)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=ZM(n,a.document),d=a.readTime?ip(a.readTime):Jn.min(),f=Xa.newNoDocument(l,d),y=a.removedTargetIds||[];s=new dk([],y,f.key,f)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=ZM(n,a.document),d=a.removedTargetIds||[];s=new dk([],d,l,null)}else{if(!("filter"in t))return Kn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,f=new A4e(l,d),y=a.targetId;s=new xie(y,f)}}return s}function F4e(n,t){let s;if(t instanceof cR)s={update:ZX(n,t.key,t.value)};else if(t instanceof n4)s={delete:PV(n,t.key)};else if(t instanceof Vg)s={update:ZX(n,t.key,t.data),updateMask:q4e(t.fieldMask)};else{if(!(t instanceof C4e))return Kn();s={verify:PV(n,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(a=>function(d,f){const y=f.transform;if(y instanceof qk)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof C0)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof R0)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof Yk)return{fieldPath:f.field.canonicalString(),increment:y.Ie};throw Kn()}(0,a))),t.precondition.isNone||(s.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:M4e(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Kn()}(n,t.precondition)),s}function j4e(n,t){return n&&n.length>0?(pi(t!==void 0),n.map(s=>function(l,d){let f=l.updateTime?ip(l.updateTime):ip(d);return f.isEqual(Jn.min())&&(f=ip(d)),new b4e(f,l.transformResults||[])}(s,t))):[]}function B4e(n,t){return{documents:[Vie(n,t.path)]}}function W4e(n,t){const s={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=Vie(n,l);const d=function(b){if(b.length!==0)return Bie(Md.create(b,"and"))}(t.filters);d&&(s.structuredQuery.where=d);const f=function(b){if(b.length!==0)return b.map(w=>function(k){return{field:wS(k.field),direction:H4e(k.dir)}}(w))}(t.orderBy);f&&(s.structuredQuery.orderBy=f);const y=IV(n,t.limit);return y!==null&&(s.structuredQuery.limit=y),t.startAt&&(s.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(t.startAt)),t.endAt&&(s.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(t.endAt)),{ht:s,parent:l}}function z4e(n){let t=U4e(n.parent);const s=n.structuredQuery,a=s.from?s.from.length:0;let l=null;if(a>0){pi(a===1);const w=s.from[0];w.allDescendants?l=w.collectionId:t=t.child(w.collectionId)}let d=[];s.where&&(d=function(I){const k=jie(I);return k instanceof Md&&mie(k)?k.getFilters():[k]}(s.where));let f=[];s.orderBy&&(f=function(I){return I.map(k=>function(V){return new $k(CS(V.field),function(W){switch(W){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(V.direction))}(k))}(s.orderBy));let y=null;s.limit&&(y=function(I){let k;return k=typeof I=="object"?I.value:I,W1(k)?null:k}(s.limit));let v=null;s.startAt&&(v=function(I){const k=!!I.before,L=I.values||[];return new Hk(L,k)}(s.startAt));let b=null;return s.endAt&&(b=function(I){const k=!I.before,L=I.values||[];return new Hk(L,k)}(s.endAt)),l4e(t,l,f,d,y,"F",v,b)}function G4e(n,t){const s=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Kn()}}(t.purpose);return s==null?null:{"goog-listen-tags":s}}function jie(n){return n.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const a=CS(s.unaryFilter.field);return ro.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=CS(s.unaryFilter.field);return ro.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=CS(s.unaryFilter.field);return ro.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=CS(s.unaryFilter.field);return ro.create(f,"!=",{nullValue:"NULL_VALUE"});default:return Kn()}}(n):n.fieldFilter!==void 0?function(s){return ro.create(CS(s.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Kn()}}(s.fieldFilter.op),s.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(s){return Md.create(s.compositeFilter.filters.map(a=>jie(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Kn()}}(s.compositeFilter.op))}(n):Kn()}function H4e(n){return N4e[n]}function $4e(n){return D4e[n]}function K4e(n){return x4e[n]}function wS(n){return{fieldPath:n.canonicalString()}}function CS(n){return Sa.fromServerFormat(n.fieldPath)}function Bie(n){return n instanceof ro?function(s){if(s.op==="=="){if(jX(s.value))return{unaryFilter:{field:wS(s.field),op:"IS_NAN"}};if(FX(s.value))return{unaryFilter:{field:wS(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(jX(s.value))return{unaryFilter:{field:wS(s.field),op:"IS_NOT_NAN"}};if(FX(s.value))return{unaryFilter:{field:wS(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wS(s.field),op:$4e(s.op),value:s.value}}}(n):n instanceof Md?function(s){const a=s.getFilters().map(l=>Bie(l));return a.length===1?a[0]:{compositeFilter:{op:K4e(s.op),filters:a}}}(n):Kn()}function q4e(n){const t=[];return n.fields.forEach(s=>t.push(s.canonicalString())),{fieldPaths:t}}function Wie(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg{constructor(t,s,a,l,d=Jn.min(),f=Jn.min(),y=Ta.EMPTY_BYTE_STRING,v=null){this.target=t,this.targetId=s,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=y,this.expectedCount=v}withSequenceNumber(t){return new mg(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,s){return new mg(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new mg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new mg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y4e{constructor(t){this.Tt=t}}function X4e(n){const t=z4e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Kk(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4e{constructor(){this.Tn=new Q4e}addToCollectionParentIndex(t,s){return this.Tn.add(s),Ct.resolve()}getCollectionParents(t,s){return Ct.resolve(this.Tn.getEntries(s))}addFieldIndex(t,s){return Ct.resolve()}deleteFieldIndex(t,s){return Ct.resolve()}deleteAllFieldIndexes(t){return Ct.resolve()}createTargetIndexes(t,s){return Ct.resolve()}getDocumentsMatchingTarget(t,s){return Ct.resolve(null)}getIndexType(t,s){return Ct.resolve(0)}getFieldIndexes(t,s){return Ct.resolve([])}getNextCollectionGroupToUpdate(t){return Ct.resolve(null)}getMinOffset(t,s){return Ct.resolve(Cg.min())}getMinOffsetFromCollectionGroup(t,s){return Ct.resolve(Cg.min())}updateCollectionGroup(t,s,a){return Ct.resolve()}updateIndexEntries(t,s){return Ct.resolve()}}class Q4e{constructor(){this.index={}}add(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s]||new vo(ts.comparator),d=!l.has(a);return this.index[s]=l.add(a),d}has(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s];return l&&l.has(a)}getEntries(t){return(this.index[t]||new vo(ts.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eJ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},zie=41943040;class sl{static withCacheSize(t){return new sl(t,sl.DEFAULT_COLLECTION_PERCENTILE,sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,s,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */sl.DEFAULT_COLLECTION_PERCENTILE=10,sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sl.DEFAULT=new sl(zie,sl.DEFAULT_COLLECTION_PERCENTILE,sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sl.DISABLED=new sl(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Un(){return new I0(0)}static Kn(){return new I0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tJ="LruGarbageCollector",Z4e=1048576;function nJ([n,t],[s,a]){const l=mr(n,s);return l===0?mr(t,a):l}class e3e{constructor(t){this.Hn=t,this.buffer=new vo(nJ),this.Jn=0}Yn(){return++this.Jn}Zn(t){const s=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(s);else{const a=this.buffer.last();nJ(s,a)<0&&(this.buffer=this.buffer.delete(a).add(s))}}get maxValue(){return this.buffer.last()[0]}}class t3e{constructor(t,s,a){this.garbageCollector=t,this.asyncQueue=s,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){nn(tJ,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){G0(s)?nn(tJ,"Ignoring IndexedDB error during garbage collection: ",s):await z0(s)}await this.er(3e5)})}}class n3e{constructor(t,s){this.tr=t,this.params=s}calculateTargetCount(t,s){return this.tr.nr(t).next(a=>Math.floor(s/100*a))}nthSequenceNumber(t,s){if(s===0)return Ct.resolve(B1.ae);const a=new e3e(s);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,s,a){return this.tr.removeTargets(t,s,a)}removeOrphanedDocuments(t,s){return this.tr.removeOrphanedDocuments(t,s)}collect(t,s){return this.params.cacheSizeCollectionThreshold===-1?(nn("LruGarbageCollector","Garbage collection skipped; disabled"),Ct.resolve(eJ)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(nn("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),eJ):this.ir(t,s))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,s){let a,l,d,f,y,v,b;const w=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(nn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,f=Date.now(),this.nthSequenceNumber(t,l))).next(I=>(a=I,y=Date.now(),this.removeTargets(t,a,s))).next(I=>(d=I,v=Date.now(),this.removeOrphanedDocuments(t,a))).next(I=>(b=Date.now(),bS()<=Ar.DEBUG&&nn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-w}ms
	Determined least recently used ${l} in `+(y-f)+`ms
	Removed ${d} targets in `+(v-y)+`ms
	Removed ${I} documents in `+(b-v)+`ms
Total Duration: ${b-w}ms`),Ct.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:I})))}}function r3e(n,t){return new n3e(n,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i3e{constructor(){this.changes=new Ky(t=>t.toString(),(t,s)=>t.isEqual(s)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,s){this.assertNotApplied(),this.changes.set(t,Xa.newInvalidDocument(t).setReadTime(s))}getEntry(t,s){this.assertNotApplied();const a=this.changes.get(s);return a!==void 0?Ct.resolve(a):this.getFromCache(t,s)}getEntries(t,s){return this.getAllFromCache(t,s)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s3e{constructor(t,s){this.overlayedDocument=t,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o3e{constructor(t,s,a,l){this.remoteDocumentCache=t,this.mutationQueue=s,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,s){let a=null;return this.documentOverlayCache.getOverlay(t,s).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,s))).next(l=>(a!==null&&uC(a.mutation,l,Vl.empty(),Eo.now()),l))}getDocuments(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.getLocalViewOfDocuments(t,a,Pr()).next(()=>a))}getLocalViewOfDocuments(t,s,a=Pr()){const l=gy();return this.populateOverlays(t,l,s).next(()=>this.computeViews(t,s,l,a).next(d=>{let f=Ww();return d.forEach((y,v)=>{f=f.insert(y,v.overlayedDocument)}),f}))}getOverlayedDocuments(t,s){const a=gy();return this.populateOverlays(t,a,s).next(()=>this.computeViews(t,s,a,Pr()))}populateOverlays(t,s,a){const l=[];return a.forEach(d=>{s.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((f,y)=>{s.set(f,y)})})}computeViews(t,s,a,l){let d=zf();const f=lC(),y=function(){return lC()}();return s.forEach((v,b)=>{const w=a.get(b.key);l.has(b.key)&&(w===void 0||w.mutation instanceof Vg)?d=d.insert(b.key,b):w!==void 0?(f.set(b.key,w.mutation.getFieldMask()),uC(w.mutation,b,w.mutation.getFieldMask(),Eo.now())):f.set(b.key,Vl.empty())}),this.recalculateAndSaveOverlays(t,d).next(v=>(v.forEach((b,w)=>f.set(b,w)),s.forEach((b,w)=>{var I;return y.set(b,new s3e(w,(I=f.get(b))!==null&&I!==void 0?I:null))}),y))}recalculateAndSaveOverlays(t,s){const a=lC();let l=new gs((f,y)=>f-y),d=Pr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,s).next(f=>{for(const y of f)y.keys().forEach(v=>{const b=s.get(v);if(b===null)return;let w=a.get(v)||Vl.empty();w=y.applyToLocalView(b,w),a.set(v,w);const I=(l.get(y.batchId)||Pr()).add(v);l=l.insert(y.batchId,I)})}).next(()=>{const f=[],y=l.getReverseIterator();for(;y.hasNext();){const v=y.getNext(),b=v.key,w=v.value,I=wie();w.forEach(k=>{if(!d.has(k)){const L=kie(s.get(k),a.get(k));L!==null&&I.set(k,L),d=d.add(k)}}),f.push(this.documentOverlayCache.saveOverlays(t,b,I))}return Ct.waitFor(f)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,s,a,l){return function(f){return An.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(t,s.path):Eie(s)?this.getDocumentsMatchingCollectionGroupQuery(t,s,a,l):this.getDocumentsMatchingCollectionQuery(t,s,a,l)}getNextDocuments(t,s,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,s,a,l).next(d=>{const f=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,s,a.largestBatchId,l-d.size):Ct.resolve(gy());let y=MC,v=d;return f.next(b=>Ct.forEach(b,(w,I)=>(y<I.largestBatchId&&(y=I.largestBatchId),d.get(w)?Ct.resolve():this.remoteDocumentCache.getEntry(t,w).next(k=>{v=v.insert(w,k)}))).next(()=>this.populateOverlays(t,b,d)).next(()=>this.computeViews(t,v,b,Pr())).next(w=>({batchId:y,changes:Tie(w)})))})}getDocumentsMatchingDocumentQuery(t,s){return this.getDocument(t,new An(s)).next(a=>{let l=Ww();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,s,a,l){const d=s.collectionGroup;let f=Ww();return this.indexManager.getCollectionParents(t,d).next(y=>Ct.forEach(y,v=>{const b=function(I,k){return new aR(k,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(s,v.child(d));return this.getDocumentsMatchingCollectionQuery(t,b,a,l).next(w=>{w.forEach((I,k)=>{f=f.insert(I,k)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(t,s,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,a.largestBatchId).next(f=>(d=f,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,a,d,l))).next(f=>{d.forEach((v,b)=>{const w=b.getKey();f.get(w)===null&&(f=f.insert(w,Xa.newInvalidDocument(w)))});let y=Ww();return f.forEach((v,b)=>{const w=d.get(v);w!==void 0&&uC(w.mutation,b,Vl.empty(),Eo.now()),H1(s,b)&&(y=y.insert(v,b))}),y})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a3e{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,s){return Ct.resolve(this.dr.get(s))}saveBundleMetadata(t,s){return this.dr.set(s.id,function(l){return{id:l.id,version:l.version,createTime:ip(l.createTime)}}(s)),Ct.resolve()}getNamedQuery(t,s){return Ct.resolve(this.Ar.get(s))}saveNamedQuery(t,s){return this.Ar.set(s.name,function(l){return{name:l.name,query:X4e(l.bundledQuery),readTime:ip(l.readTime)}}(s)),Ct.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c3e{constructor(){this.overlays=new gs(An.comparator),this.Rr=new Map}getOverlay(t,s){return Ct.resolve(this.overlays.get(s))}getOverlays(t,s){const a=gy();return Ct.forEach(s,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,s,a){return a.forEach((l,d)=>{this.Et(t,s,d)}),Ct.resolve()}removeOverlaysForBatchId(t,s,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),Ct.resolve()}getOverlaysForCollection(t,s,a){const l=gy(),d=s.length+1,f=new An(s.child("")),y=this.overlays.getIteratorFrom(f);for(;y.hasNext();){const v=y.getNext().value,b=v.getKey();if(!s.isPrefixOf(b.path))break;b.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return Ct.resolve(l)}getOverlaysForCollectionGroup(t,s,a,l){let d=new gs((b,w)=>b-w);const f=this.overlays.getIterator();for(;f.hasNext();){const b=f.getNext().value;if(b.getKey().getCollectionGroup()===s&&b.largestBatchId>a){let w=d.get(b.largestBatchId);w===null&&(w=gy(),d=d.insert(b.largestBatchId,w)),w.set(b.getKey(),b)}}const y=gy(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((b,w)=>y.set(b,w)),!(y.size()>=l)););return Ct.resolve(y)}Et(t,s,a){const l=this.overlays.get(a.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(a.key,new I4e(s,a));let d=this.Rr.get(s);d===void 0&&(d=Pr(),this.Rr.set(s,d)),this.Rr.set(s,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l3e{constructor(){this.sessionToken=Ta.EMPTY_BYTE_STRING}getSessionToken(t){return Ct.resolve(this.sessionToken)}setSessionToken(t,s){return this.sessionToken=s,Ct.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o4{constructor(){this.Vr=new vo(Vo.mr),this.gr=new vo(Vo.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,s){const a=new Vo(t,s);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,s){t.forEach(a=>this.addReference(a,s))}removeReference(t,s){this.wr(new Vo(t,s))}Sr(t,s){t.forEach(a=>this.removeReference(a,s))}br(t){const s=new An(new ts([])),a=new Vo(s,t),l=new Vo(s,t+1),d=[];return this.gr.forEachInRange([a,l],f=>{this.wr(f),d.push(f.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const s=new An(new ts([])),a=new Vo(s,t),l=new Vo(s,t+1);let d=Pr();return this.gr.forEachInRange([a,l],f=>{d=d.add(f.key)}),d}containsKey(t){const s=new Vo(t,0),a=this.Vr.firstAfterOrEqual(s);return a!==null&&t.isEqual(a.key)}}class Vo{constructor(t,s){this.key=t,this.Cr=s}static mr(t,s){return An.comparator(t.key,s.key)||mr(t.Cr,s.Cr)}static pr(t,s){return mr(t.Cr,s.Cr)||An.comparator(t.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u3e{constructor(t,s){this.indexManager=t,this.referenceDelegate=s,this.mutationQueue=[],this.Fr=1,this.Mr=new vo(Vo.mr)}checkEmpty(t){return Ct.resolve(this.mutationQueue.length===0)}addMutationBatch(t,s,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new R4e(d,s,a,l);this.mutationQueue.push(f);for(const y of l)this.Mr=this.Mr.add(new Vo(y.key,d)),this.indexManager.addToCollectionParentIndex(t,y.key.path.popLast());return Ct.resolve(f)}lookupMutationBatch(t,s){return Ct.resolve(this.Or(s))}getNextMutationBatchAfterBatchId(t,s){const a=s+1,l=this.Nr(a),d=l<0?0:l;return Ct.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Ct.resolve(this.mutationQueue.length===0?Yj:this.Fr-1)}getAllMutationBatches(t){return Ct.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,s){const a=new Vo(s,0),l=new Vo(s,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],f=>{const y=this.Or(f.Cr);d.push(y)}),Ct.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,s){let a=new vo(mr);return s.forEach(l=>{const d=new Vo(l,0),f=new Vo(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,f],y=>{a=a.add(y.Cr)})}),Ct.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,s){const a=s.path,l=a.length+1;let d=a;An.isDocumentKey(d)||(d=d.child(""));const f=new Vo(new An(d),0);let y=new vo(mr);return this.Mr.forEachWhile(v=>{const b=v.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(y=y.add(v.Cr)),!0)},f),Ct.resolve(this.Br(y))}Br(t){const s=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&s.push(l)}),s}removeMutationBatch(t,s){pi(this.Lr(s.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return Ct.forEach(s.mutations,l=>{const d=new Vo(l.key,s.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,s){const a=new Vo(s,0),l=this.Mr.firstAfterOrEqual(a);return Ct.resolve(s.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,Ct.resolve()}Lr(t,s){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const s=this.Nr(t);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d3e{constructor(t){this.kr=t,this.docs=function(){return new gs(An.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,s){const a=s.key,l=this.docs.get(a),d=l?l.size:0,f=this.kr(s);return this.docs=this.docs.insert(a,{document:s.mutableCopy(),size:f}),this.size+=f-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const s=this.docs.get(t);s&&(this.docs=this.docs.remove(t),this.size-=s.size)}getEntry(t,s){const a=this.docs.get(s);return Ct.resolve(a?a.document.mutableCopy():Xa.newInvalidDocument(s))}getEntries(t,s){let a=zf();return s.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():Xa.newInvalidDocument(l))}),Ct.resolve(a)}getDocumentsMatchingQuery(t,s,a,l){let d=zf();const f=s.path,y=new An(f.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(y);for(;v.hasNext();){const{key:b,value:{document:w}}=v.getNext();if(!f.isPrefixOf(b.path))break;b.path.length>f.length+1||Bje(jje(w),a)<=0||(l.has(w.key)||H1(s,w))&&(d=d.insert(w.key,w.mutableCopy()))}return Ct.resolve(d)}getAllFromCollectionGroup(t,s,a,l){Kn()}qr(t,s){return Ct.forEach(this.docs,a=>s(a))}newChangeBuffer(t){return new h3e(this)}getSize(t){return Ct.resolve(this.size)}}class h3e extends i3e{constructor(t){super(),this.Ir=t}applyChanges(t){const s=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?s.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),Ct.waitFor(s)}getFromCache(t,s){return this.Ir.getEntry(t,s)}getAllFromCache(t,s){return this.Ir.getEntries(t,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p3e{constructor(t){this.persistence=t,this.Qr=new Ky(s=>Qj(s),Zj),this.lastRemoteSnapshotVersion=Jn.min(),this.highestTargetId=0,this.$r=0,this.Ur=new o4,this.targetCount=0,this.Kr=I0.Un()}forEachTarget(t,s){return this.Qr.forEach((a,l)=>s(l)),Ct.resolve()}getLastRemoteSnapshotVersion(t){return Ct.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ct.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Kr.next(),Ct.resolve(this.highestTargetId)}setTargetsMetadata(t,s,a){return a&&(this.lastRemoteSnapshotVersion=a),s>this.$r&&(this.$r=s),Ct.resolve()}zn(t){this.Qr.set(t.target,t);const s=t.targetId;s>this.highestTargetId&&(this.Kr=new I0(s),this.highestTargetId=s),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,s){return this.zn(s),this.targetCount+=1,Ct.resolve()}updateTargetData(t,s){return this.zn(s),Ct.resolve()}removeTargetData(t,s){return this.Qr.delete(s.target),this.Ur.br(s.targetId),this.targetCount-=1,Ct.resolve()}removeTargets(t,s,a){let l=0;const d=[];return this.Qr.forEach((f,y)=>{y.sequenceNumber<=s&&a.get(y.targetId)===null&&(this.Qr.delete(f),d.push(this.removeMatchingKeysForTargetId(t,y.targetId)),l++)}),Ct.waitFor(d).next(()=>l)}getTargetCount(t){return Ct.resolve(this.targetCount)}getTargetData(t,s){const a=this.Qr.get(s)||null;return Ct.resolve(a)}addMatchingKeys(t,s,a){return this.Ur.yr(s,a),Ct.resolve()}removeMatchingKeys(t,s,a){this.Ur.Sr(s,a);const l=this.persistence.referenceDelegate,d=[];return l&&s.forEach(f=>{d.push(l.markPotentiallyOrphaned(t,f))}),Ct.waitFor(d)}removeMatchingKeysForTargetId(t,s){return this.Ur.br(s),Ct.resolve()}getMatchingKeysForTargetId(t,s){const a=this.Ur.vr(s);return Ct.resolve(a)}containsKey(t,s){return Ct.resolve(this.Ur.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gie{constructor(t,s){this.Wr={},this.overlays={},this.Gr=new B1(0),this.zr=!1,this.zr=!0,this.jr=new l3e,this.referenceDelegate=t(this),this.Hr=new p3e(this),this.indexManager=new J4e,this.remoteDocumentCache=function(l){return new d3e(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new Y4e(s),this.Yr=new a3e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let s=this.overlays[t.toKey()];return s||(s=new c3e,this.overlays[t.toKey()]=s),s}getMutationQueue(t,s){let a=this.Wr[t.toKey()];return a||(a=new u3e(s,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,s,a){nn("MemoryPersistence","Starting transaction:",t);const l=new f3e(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,s){return Ct.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,s)))}}class f3e extends zje{constructor(t){super(),this.currentSequenceNumber=t}}class a4{constructor(t){this.persistence=t,this.ti=new o4,this.ni=null}static ri(t){return new a4(t)}get ii(){if(this.ni)return this.ni;throw Kn()}addReference(t,s,a){return this.ti.addReference(a,s),this.ii.delete(a.toString()),Ct.resolve()}removeReference(t,s,a){return this.ti.removeReference(a,s),this.ii.add(a.toString()),Ct.resolve()}markPotentiallyOrphaned(t,s){return this.ii.add(s.toString()),Ct.resolve()}removeTarget(t,s){this.ti.br(s.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,s.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,s))}Zr(){this.ni=new Set}Xr(t){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ct.forEach(this.ii,a=>{const l=An.fromPath(a);return this.si(t,l).next(d=>{d||s.removeEntry(l,Jn.min())})}).next(()=>(this.ni=null,s.apply(t)))}updateLimboDocument(t,s){return this.si(t,s).next(a=>{a?this.ii.delete(s.toString()):this.ii.add(s.toString())})}Jr(t){return 0}si(t,s){return Ct.or([()=>Ct.resolve(this.ti.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(t,s),()=>this.persistence.ei(t,s)])}}class Jk{constructor(t,s){this.persistence=t,this.oi=new Ky(a=>$je(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=r3e(this,s)}static ri(t,s){return new Jk(t,s)}Zr(){}Xr(t){return Ct.resolve()}forEachTarget(t,s){return this.persistence.getTargetCache().forEachTarget(t,s)}nr(t){const s=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>s.next(l=>a+l))}sr(t){let s=0;return this.rr(t,a=>{s++}).next(()=>s)}rr(t,s){return Ct.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?Ct.resolve():s(l)))}removeTargets(t,s,a){return this.persistence.getTargetCache().removeTargets(t,s,a)}removeOrphanedDocuments(t,s){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,f=>this.ar(t,f,s).next(y=>{y||(a++,d.removeEntry(f,Jn.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,s){return this.oi.set(s,t.currentSequenceNumber),Ct.resolve()}removeTarget(t,s){const a=s.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),Ct.resolve()}removeReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),Ct.resolve()}updateLimboDocument(t,s){return this.oi.set(s,t.currentSequenceNumber),Ct.resolve()}Jr(t){let s=t.key.toString().length;return t.isFoundDocument()&&(s+=ck(t.data.value)),s}ar(t,s,a){return Ct.or([()=>this.persistence.ei(t,s),()=>this.persistence.getTargetCache().containsKey(t,s),()=>{const l=this.oi.get(s);return Ct.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c4{constructor(t,s,a,l){this.targetId=t,this.fromCache=s,this.Hi=a,this.Ji=l}static Yi(t,s){let a=Pr(),l=Pr();for(const d of s.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new c4(t,s.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m3e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g3e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return XMe()?8:Gje(Qa())>0?6:4}()}initialize(t,s){this.ns=t,this.indexManager=s,this.Zi=!0}getDocumentsMatchingQuery(t,s,a,l){const d={result:null};return this.rs(t,s).next(f=>{d.result=f}).next(()=>{if(!d.result)return this.ss(t,s,l,a).next(f=>{d.result=f})}).next(()=>{if(d.result)return;const f=new m3e;return this._s(t,s,f).next(y=>{if(d.result=y,this.Xi)return this.us(t,s,f,y.size)})}).next(()=>d.result)}us(t,s,a,l){return a.documentReadCount<this.es?(bS()<=Ar.DEBUG&&nn("QueryEngine","SDK will not create cache indexes for query:",TS(s),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Ct.resolve()):(bS()<=Ar.DEBUG&&nn("QueryEngine","Query:",TS(s),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(bS()<=Ar.DEBUG&&nn("QueryEngine","The SDK decides to create cache indexes for query:",TS(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,rp(s))):Ct.resolve())}rs(t,s){if(GX(s))return Ct.resolve(null);let a=rp(s);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(s.limit!==null&&l===1&&(s=Kk(s,null,"F"),a=rp(s)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const f=Pr(...d);return this.ns.getDocuments(t,f).next(y=>this.indexManager.getMinOffset(t,a).next(v=>{const b=this.cs(s,y);return this.ls(s,b,f,v.readTime)?this.rs(t,Kk(s,null,"F")):this.hs(t,b,s,v)}))})))}ss(t,s,a,l){return GX(s)||l.isEqual(Jn.min())?Ct.resolve(null):this.ns.getDocuments(t,a).next(d=>{const f=this.cs(s,d);return this.ls(s,f,a,l)?Ct.resolve(null):(bS()<=Ar.DEBUG&&nn("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),TS(s)),this.hs(t,f,s,Fje(l,MC)).next(y=>y))})}cs(t,s){let a=new vo(Sie(t));return s.forEach((l,d)=>{H1(t,d)&&(a=a.add(d))}),a}ls(t,s,a,l){if(t.limit===null)return!1;if(a.size!==s.size)return!0;const d=t.limitType==="F"?s.last():s.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,s,a){return bS()<=Ar.DEBUG&&nn("QueryEngine","Using full collection scan to execute query:",TS(s)),this.ns.getDocumentsMatchingQuery(t,s,Cg.min(),a)}hs(t,s,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(s.forEach(f=>{d=d.insert(f.key,f)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l4="LocalStore",_3e=3e8;class y3e{constructor(t,s,a,l){this.persistence=t,this.Ps=s,this.serializer=l,this.Ts=new gs(mr),this.Is=new Ky(d=>Qj(d),Zj),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new o3e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>t.collect(s,this.Ts))}}function E3e(n,t,s,a){return new y3e(n,t,s,a)}async function Hie(n,t){const s=tr(n);return await s.persistence.runTransaction("Handle user change","readonly",a=>{let l;return s.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,s.As(t),s.mutationQueue.getAllMutationBatches(a))).next(d=>{const f=[],y=[];let v=Pr();for(const b of l){f.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}for(const b of d){y.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}return s.localDocuments.getDocuments(a,v).next(b=>({Rs:b,removedBatchIds:f,addedBatchIds:y}))})})}function v3e(n,t){const s=tr(n);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=s.ds.newChangeBuffer({trackRemovals:!0});return function(y,v,b,w){const I=b.batch,k=I.keys();let L=Ct.resolve();return k.forEach(V=>{L=L.next(()=>w.getEntry(v,V)).next(B=>{const W=b.docVersions.get(V);pi(W!==null),B.version.compareTo(W)<0&&(I.applyToRemoteDocument(B,b),B.isValidDocument()&&(B.setReadTime(b.commitVersion),w.addEntry(B)))})}),L.next(()=>y.mutationQueue.removeMutationBatch(v,I))}(s,a,t,d).next(()=>d.apply(a)).next(()=>s.mutationQueue.performConsistencyCheck(a)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(y){let v=Pr();for(let b=0;b<y.mutationResults.length;++b)y.mutationResults[b].transformResults.length>0&&(v=v.add(y.batch.mutations[b].key));return v}(t))).next(()=>s.localDocuments.getDocuments(a,l))})}function $ie(n){const t=tr(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",s=>t.Hr.getLastRemoteSnapshotVersion(s))}function S3e(n,t){const s=tr(n),a=t.snapshotVersion;let l=s.Ts;return s.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const f=s.ds.newChangeBuffer({trackRemovals:!0});l=s.Ts;const y=[];t.targetChanges.forEach((w,I)=>{const k=l.get(I);if(!k)return;y.push(s.Hr.removeMatchingKeys(d,w.removedDocuments,I).next(()=>s.Hr.addMatchingKeys(d,w.addedDocuments,I)));let L=k.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(I)!==null?L=L.withResumeToken(Ta.EMPTY_BYTE_STRING,Jn.min()).withLastLimboFreeSnapshotVersion(Jn.min()):w.resumeToken.approximateByteSize()>0&&(L=L.withResumeToken(w.resumeToken,a)),l=l.insert(I,L),function(B,W,Q){return B.resumeToken.approximateByteSize()===0||W.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=_3e?!0:Q.addedDocuments.size+Q.modifiedDocuments.size+Q.removedDocuments.size>0}(k,L,w)&&y.push(s.Hr.updateTargetData(d,L))});let v=zf(),b=Pr();if(t.documentUpdates.forEach(w=>{t.resolvedLimboDocuments.has(w)&&y.push(s.persistence.referenceDelegate.updateLimboDocument(d,w))}),y.push(b3e(d,f,t.documentUpdates).next(w=>{v=w.Vs,b=w.fs})),!a.isEqual(Jn.min())){const w=s.Hr.getLastRemoteSnapshotVersion(d).next(I=>s.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));y.push(w)}return Ct.waitFor(y).next(()=>f.apply(d)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,v,b)).next(()=>v)}).then(d=>(s.Ts=l,d))}function b3e(n,t,s){let a=Pr(),l=Pr();return s.forEach(d=>a=a.add(d)),t.getEntries(n,a).next(d=>{let f=zf();return s.forEach((y,v)=>{const b=d.get(y);v.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(y)),v.isNoDocument()&&v.version.isEqual(Jn.min())?(t.removeEntry(y,v.readTime),f=f.insert(y,v)):!b.isValidDocument()||v.version.compareTo(b.version)>0||v.version.compareTo(b.version)===0&&b.hasPendingWrites?(t.addEntry(v),f=f.insert(y,v)):nn(l4,"Ignoring outdated watch update for ",y,". Current version:",b.version," Watch version:",v.version)}),{Vs:f,fs:l}})}function T3e(n,t){const s=tr(n);return s.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=Yj),s.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function w3e(n,t){const s=tr(n);return s.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return s.Hr.getTargetData(a,t).next(d=>d?(l=d,Ct.resolve(l)):s.Hr.allocateTargetId(a).next(f=>(l=new mg(t,f,"TargetPurposeListen",a.currentSequenceNumber),s.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=s.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(s.Ts=s.Ts.insert(a.targetId,a),s.Is.set(t,a.targetId)),a})}async function kV(n,t,s){const a=tr(n),l=a.Ts.get(t),d=s?"readwrite":"readwrite-primary";try{s||await a.persistence.runTransaction("Release target",d,f=>a.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!G0(f))throw f;nn(l4,`Failed to update sequence numbers for target ${t}: ${f}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function rJ(n,t,s){const a=tr(n);let l=Jn.min(),d=Pr();return a.persistence.runTransaction("Execute query","readwrite",f=>function(v,b,w){const I=tr(v),k=I.Is.get(w);return k!==void 0?Ct.resolve(I.Ts.get(k)):I.Hr.getTargetData(b,w)}(a,f,rp(t)).next(y=>{if(y)return l=y.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(f,y.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(f,t,s?l:Jn.min(),s?d:Pr())).next(y=>(C3e(a,d4e(t),y),{documents:y,gs:d})))}function C3e(n,t,s){let a=n.Es.get(t)||Jn.min();s.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),n.Es.set(t,a)}class iJ{constructor(){this.activeTargetIds=_4e()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}bs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class R3e{constructor(){this.ho=new iJ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,s,a){}addLocalQueryTarget(t,s=!0){return s&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,s,a){this.Po[t]=s}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new iJ,Promise.resolve()}handleUserChange(t,s,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I3e{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sJ="ConnectivityMonitor";class oJ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){nn(sJ,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){nn(sJ,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let RO=null;function NV(){return RO===null?RO=function(){return 268435456+Math.round(2147483648*Math.random())}():RO++,"0x"+RO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eU="RestConnection",A3e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class P3e{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const s=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=s+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===zk?`project_id=${a}`:`project_id=${a}&database_id=${l}`}So(t,s,a,l,d){const f=NV(),y=this.bo(t,s.toUriEncodedString());nn(eU,`Sending RPC '${t}' ${f}:`,y,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(t,y,v,a).then(b=>(nn(eU,`Received RPC '${t}' ${f}: `,b),b),b=>{throw S0(eU,`RPC '${t}' ${f} failed with error: `,b,"url: ",y,"request:",a),b})}Co(t,s,a,l,d,f){return this.So(t,s,a,l,d)}Do(t,s,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+W0}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}bo(t,s){const a=A3e[t];return`${this.po}/v1/${s}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O3e{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Uo(t){this.ko(t)}Ko(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $a="WebChannelConnection";class k3e extends P3e{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,s,a,l){const d=NV();return new Promise((f,y)=>{const v=new Yre;v.setWithCredentials(!0),v.listenOnce(Xre.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case ak.NO_ERROR:const w=v.getResponseJson();nn($a,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(w)),f(w);break;case ak.TIMEOUT:nn($a,`RPC '${t}' ${d} timed out`),y(new ln(It.DEADLINE_EXCEEDED,"Request time out"));break;case ak.HTTP_ERROR:const I=v.getStatus();if(nn($a,`RPC '${t}' ${d} failed with status:`,I,"response text:",v.getResponseText()),I>0){let k=v.getResponseJson();Array.isArray(k)&&(k=k[0]);const L=k==null?void 0:k.error;if(L&&L.status&&L.message){const V=function(W){const Q=W.toLowerCase().replace(/_/g,"-");return Object.values(It).indexOf(Q)>=0?Q:It.UNKNOWN}(L.status);y(new ln(V,L.message))}else y(new ln(It.UNKNOWN,"Server responded with status "+v.getStatus()))}else y(new ln(It.UNAVAILABLE,"Connection failed."));break;default:Kn()}}finally{nn($a,`RPC '${t}' ${d} completed.`)}});const b=JSON.stringify(l);nn($a,`RPC '${t}' ${d} sending request:`,l),v.send(s,"POST",b,a,15)})}Wo(t,s,a){const l=NV(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],f=Zre(),y=Qre(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(v.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,s,a),v.encodeInitMessageHeaders=!0;const w=d.join("");nn($a,`Creating RPC '${t}' stream ${l}: ${w}`,v);const I=f.createWebChannel(w,v);let k=!1,L=!1;const V=new O3e({Fo:W=>{L?nn($a,`Not sending because RPC '${t}' stream ${l} is closed:`,W):(k||(nn($a,`Opening RPC '${t}' stream ${l} transport.`),I.open(),k=!0),nn($a,`RPC '${t}' stream ${l} sending:`,W),I.send(W))},Mo:()=>I.close()}),B=(W,Q,$)=>{W.listen(Q,ie=>{try{$(ie)}catch(ce){setTimeout(()=>{throw ce},0)}})};return B(I,Bw.EventType.OPEN,()=>{L||(nn($a,`RPC '${t}' stream ${l} transport opened.`),V.Qo())}),B(I,Bw.EventType.CLOSE,()=>{L||(L=!0,nn($a,`RPC '${t}' stream ${l} transport closed`),V.Uo())}),B(I,Bw.EventType.ERROR,W=>{L||(L=!0,S0($a,`RPC '${t}' stream ${l} transport errored:`,W),V.Uo(new ln(It.UNAVAILABLE,"The operation could not be completed")))}),B(I,Bw.EventType.MESSAGE,W=>{var Q;if(!L){const $=W.data[0];pi(!!$);const ie=$,ce=(ie==null?void 0:ie.error)||((Q=ie[0])===null||Q===void 0?void 0:Q.error);if(ce){nn($a,`RPC '${t}' stream ${l} received error:`,ce);const ne=ce.status;let de=function(Z){const se=Qs[Z];if(se!==void 0)return Die(se)}(ne),Y=ce.message;de===void 0&&(de=It.INTERNAL,Y="Unknown error status: "+ne+" with message "+ce.message),L=!0,V.Uo(new ln(de,Y)),I.close()}else nn($a,`RPC '${t}' stream ${l} received:`,$),V.Ko($)}}),B(y,Jre.STAT_EVENT,W=>{W.stat===vV.PROXY?nn($a,`RPC '${t}' stream ${l} detected buffering proxy`):W.stat===vV.NOPROXY&&nn($a,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{V.$o()},0),V}}function tU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y1(n){return new L4e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kie{constructor(t,s,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=s,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const s=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,s-a);l>0&&nn("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${s} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aJ="PersistentStream";class qie{constructor(t,s,a,l,d,f,y,v){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=y,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Kie(t,s)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,s){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():s&&s.code===It.RESOURCE_EXHAUSTED?(Wf(s.toString()),Wf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):s&&s.code===It.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(s)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),s=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===s&&this.V_(a,l)},a=>{t(()=>{const l=new ln(It.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,s){const a=this.R_(this.i_);this.stream=this.f_(t,s),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return nn(aJ,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return s=>{this.Ti.enqueueAndForget(()=>this.i_===t?s():(nn(aJ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class N3e extends qie{constructor(t,s,a,l,d,f){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}f_(t,s){return this.connection.Wo("Listen",t,s)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const s=V4e(this.serializer,t),a=function(d){if(!("targetChange"in d))return Jn.min();const f=d.targetChange;return f.targetIds&&f.targetIds.length?Jn.min():f.readTime?ip(f.readTime):Jn.min()}(t);return this.listener.p_(s,a)}y_(t){const s={};s.database=OV(this.serializer),s.addTarget=function(d,f){let y;const v=f.target;if(y=CV(v)?{documents:B4e(d,v)}:{query:W4e(d,v).ht},y.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){y.resumeToken=Mie(d,f.resumeToken);const b=IV(d,f.expectedCount);b!==null&&(y.expectedCount=b)}else if(f.snapshotVersion.compareTo(Jn.min())>0){y.readTime=Xk(d,f.snapshotVersion.toTimestamp());const b=IV(d,f.expectedCount);b!==null&&(y.expectedCount=b)}return y}(this.serializer,t);const a=G4e(this.serializer,t);a&&(s.labels=a),this.I_(s)}w_(t){const s={};s.database=OV(this.serializer),s.removeTarget=t,this.I_(s)}}class D3e extends qie{constructor(t,s,a,l,d,f){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(t,s){return this.connection.Wo("Write",t,s)}g_(t){return pi(!!t.streamToken),this.lastStreamToken=t.streamToken,pi(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){pi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const s=j4e(t.writeResults,t.commitTime),a=ip(t.commitTime);return this.listener.v_(a,s)}C_(){const t={};t.database=OV(this.serializer),this.I_(t)}b_(t){const s={streamToken:this.lastStreamToken,writes:t.map(a=>F4e(this.serializer,a))};this.I_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x3e{}class L3e extends x3e{constructor(t,s,a,l){super(),this.authCredentials=t,this.appCheckCredentials=s,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new ln(It.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,s,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,f])=>this.connection.So(t,AV(s,a),l,d,f)).catch(d=>{throw d.name==="FirebaseError"?(d.code===It.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new ln(It.UNKNOWN,d.toString())})}Co(t,s,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,y])=>this.connection.Co(t,AV(s,a),l,f,y,d)).catch(f=>{throw f.name==="FirebaseError"?(f.code===It.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new ln(It.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class M3e{constructor(t,s){this.asyncQueue=t,this.onlineStateHandler=s,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const s=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Wf(s),this.N_=!1):nn("OnlineStateTracker",s)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const By="RemoteStore";class U3e{constructor(t,s,a,l,d){this.localStore=t,this.datastore=s,this.asyncQueue=a,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(f=>{a.enqueueAndForget(async()=>{qy(this)&&(nn(By,"Restarting streams for network reachability change."),await async function(v){const b=tr(v);b.W_.add(4),await uR(b),b.j_.set("Unknown"),b.W_.delete(4),await X1(b)}(this))})}),this.j_=new M3e(a,l)}}async function X1(n){if(qy(n))for(const t of n.G_)await t(!0)}async function uR(n){for(const t of n.G_)await t(!1)}function Yie(n,t){const s=tr(n);s.K_.has(t.targetId)||(s.K_.set(t.targetId,t),p4(s)?h4(s):H0(s).c_()&&d4(s,t))}function u4(n,t){const s=tr(n),a=H0(s);s.K_.delete(t),a.c_()&&Xie(s,t),s.K_.size===0&&(a.c_()?a.P_():qy(s)&&s.j_.set("Unknown"))}function d4(n,t){if(n.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Jn.min())>0){const s=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}H0(n).y_(t)}function Xie(n,t){n.H_.Ne(t),H0(n).w_(t)}function h4(n){n.H_=new k4e({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>n.K_.get(t)||null,it:()=>n.datastore.serializer.databaseId}),H0(n).start(),n.j_.B_()}function p4(n){return qy(n)&&!H0(n).u_()&&n.K_.size>0}function qy(n){return tr(n).W_.size===0}function Jie(n){n.H_=void 0}async function V3e(n){n.j_.set("Online")}async function F3e(n){n.K_.forEach((t,s)=>{d4(n,t)})}async function j3e(n,t){Jie(n),p4(n)?(n.j_.q_(t),h4(n)):n.j_.set("Unknown")}async function B3e(n,t,s){if(n.j_.set("Online"),t instanceof Lie&&t.state===2&&t.cause)try{await async function(l,d){const f=d.cause;for(const y of d.targetIds)l.K_.has(y)&&(await l.remoteSyncer.rejectListen(y,f),l.K_.delete(y),l.H_.removeTarget(y))}(n,t)}catch(a){nn(By,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await Qk(n,a)}else if(t instanceof dk?n.H_.We(t):t instanceof xie?n.H_.Ze(t):n.H_.je(t),!s.isEqual(Jn.min()))try{const a=await $ie(n.localStore);s.compareTo(a)>=0&&await function(d,f){const y=d.H_.ot(f);return y.targetChanges.forEach((v,b)=>{if(v.resumeToken.approximateByteSize()>0){const w=d.K_.get(b);w&&d.K_.set(b,w.withResumeToken(v.resumeToken,f))}}),y.targetMismatches.forEach((v,b)=>{const w=d.K_.get(v);if(!w)return;d.K_.set(v,w.withResumeToken(Ta.EMPTY_BYTE_STRING,w.snapshotVersion)),Xie(d,v);const I=new mg(w.target,v,b,w.sequenceNumber);d4(d,I)}),d.remoteSyncer.applyRemoteEvent(y)}(n,s)}catch(a){nn(By,"Failed to raise snapshot:",a),await Qk(n,a)}}async function Qk(n,t,s){if(!G0(t))throw t;n.W_.add(1),await uR(n),n.j_.set("Offline"),s||(s=()=>$ie(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{nn(By,"Retrying IndexedDB access"),await s(),n.W_.delete(1),await X1(n)})}function Qie(n,t){return t().catch(s=>Qk(n,s,t))}async function J1(n){const t=tr(n),s=Pg(t);let a=t.U_.length>0?t.U_[t.U_.length-1].batchId:Yj;for(;W3e(t);)try{const l=await T3e(t.localStore,a);if(l===null){t.U_.length===0&&s.P_();break}a=l.batchId,z3e(t,l)}catch(l){await Qk(t,l)}Zie(t)&&ese(t)}function W3e(n){return qy(n)&&n.U_.length<10}function z3e(n,t){n.U_.push(t);const s=Pg(n);s.c_()&&s.S_&&s.b_(t.mutations)}function Zie(n){return qy(n)&&!Pg(n).u_()&&n.U_.length>0}function ese(n){Pg(n).start()}async function G3e(n){Pg(n).C_()}async function H3e(n){const t=Pg(n);for(const s of n.U_)t.b_(s.mutations)}async function $3e(n,t,s){const a=n.U_.shift(),l=r4.from(a,t,s);await Qie(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await J1(n)}async function K3e(n,t){t&&Pg(n).S_&&await async function(a,l){if(function(f){return P4e(f)&&f!==It.ABORTED}(l.code)){const d=a.U_.shift();Pg(a).h_(),await Qie(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await J1(a)}}(n,t),Zie(n)&&ese(n)}async function cJ(n,t){const s=tr(n);s.asyncQueue.verifyOperationInProgress(),nn(By,"RemoteStore received new credentials");const a=qy(s);s.W_.add(3),await uR(s),a&&s.j_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(t),s.W_.delete(3),await X1(s)}async function q3e(n,t){const s=tr(n);t?(s.W_.delete(2),await X1(s)):t||(s.W_.add(2),await uR(s),s.j_.set("Unknown"))}function H0(n){return n.J_||(n.J_=function(s,a,l){const d=tr(s);return d.M_(),new N3e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:V3e.bind(null,n),No:F3e.bind(null,n),Lo:j3e.bind(null,n),p_:B3e.bind(null,n)}),n.G_.push(async t=>{t?(n.J_.h_(),p4(n)?h4(n):n.j_.set("Unknown")):(await n.J_.stop(),Jie(n))})),n.J_}function Pg(n){return n.Y_||(n.Y_=function(s,a,l){const d=tr(s);return d.M_(),new D3e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:G3e.bind(null,n),Lo:K3e.bind(null,n),D_:H3e.bind(null,n),v_:$3e.bind(null,n)}),n.G_.push(async t=>{t?(n.Y_.h_(),await J1(n)):(await n.Y_.stop(),n.U_.length>0&&(nn(By,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f4{constructor(t,s,a,l,d){this.asyncQueue=t,this.timerId=s,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new kf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,s,a,l,d){const f=Date.now()+a,y=new f4(t,s,f,l,d);return y.start(a),y}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ln(It.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function m4(n,t){if(Wf("AsyncQueue",`${t}: ${n}`),G0(n))return new ln(It.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{static emptySet(t){return new s0(t.comparator)}constructor(t){this.comparator=t?(s,a)=>t(s,a)||An.comparator(s.key,a.key):(s,a)=>An.comparator(s.key,a.key),this.keyedMap=Ww(),this.sortedSet=new gs(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const s=this.keyedMap.get(t);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((s,a)=>(t(s),!1))}add(t){const s=this.delete(t.key);return s.copy(s.keyedMap.insert(t.key,t),s.sortedSet.insert(t,null))}delete(t){const s=this.get(t);return s?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(s)):this}isEqual(t){if(!(t instanceof s0)||this.size!==t.size)return!1;const s=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(s=>{t.push(s.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,s){const a=new s0;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=s,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lJ{constructor(){this.Z_=new gs(An.comparator)}track(t){const s=t.doc.key,a=this.Z_.get(s);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(s,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(s,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(s,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(s):t.type===1&&a.type===2?this.Z_=this.Z_.insert(s,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):Kn():this.Z_=this.Z_.insert(s,t)}X_(){const t=[];return this.Z_.inorderTraversal((s,a)=>{t.push(a)}),t}}class A0{constructor(t,s,a,l,d,f,y,v,b){this.query=t,this.docs=s,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=f,this.syncStateChanged=y,this.excludesMetadataChanges=v,this.hasCachedResults=b}static fromInitialDocuments(t,s,a,l,d){const f=[];return s.forEach(y=>{f.push({type:0,doc:y})}),new A0(t,s,s0.emptySet(s),f,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&G1(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const s=this.docChanges,a=t.docChanges;if(s.length!==a.length)return!1;for(let l=0;l<s.length;l++)if(s[l].type!==a[l].type||!s[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y3e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class X3e{constructor(){this.queries=uJ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(s,a){const l=tr(s),d=l.queries;l.queries=uJ(),d.forEach((f,y)=>{for(const v of y.ta)v.onError(a)})})(this,new ln(It.ABORTED,"Firestore shutting down"))}}function uJ(){return new Ky(n=>vie(n),G1)}async function tse(n,t){const s=tr(n);let a=3;const l=t.query;let d=s.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new Y3e,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await s.onListen(l,!0);break;case 1:d.ea=await s.onListen(l,!1);break;case 2:await s.onFirstRemoteStoreListen(l)}}catch(f){const y=m4(f,`Initialization of query '${TS(t.query)}' failed`);return void t.onError(y)}s.queries.set(l,d),d.ta.push(t),t.sa(s.onlineState),d.ea&&t.oa(d.ea)&&g4(s)}async function nse(n,t){const s=tr(n),a=t.query;let l=3;const d=s.queries.get(a);if(d){const f=d.ta.indexOf(t);f>=0&&(d.ta.splice(f,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return s.queries.delete(a),s.onUnlisten(a,!0);case 1:return s.queries.delete(a),s.onUnlisten(a,!1);case 2:return s.onLastRemoteStoreUnlisten(a);default:return}}function J3e(n,t){const s=tr(n);let a=!1;for(const l of t){const d=l.query,f=s.queries.get(d);if(f){for(const y of f.ta)y.oa(l)&&(a=!0);f.ea=l}}a&&g4(s)}function Q3e(n,t,s){const a=tr(n),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(s);a.queries.delete(t)}function g4(n){n.ia.forEach(t=>{t.next()})}var DV,dJ;(dJ=DV||(DV={}))._a="default",dJ.Cache="cache";class rse{constructor(t,s,a){this.query=t,this.aa=s,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new A0(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let s=!1;return this.ua?this.la(t)&&(this.aa.next(t),s=!0):this.ha(t,this.onlineState)&&(this.Pa(t),s=!0),this.ca=t,s}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let s=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),s=!0),s}ha(t,s){if(!t.fromCache||!this.ra())return!0;const a=s!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||s==="Offline")}la(t){if(t.docChanges.length>0)return!0;const s=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}Pa(t){t=A0.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==DV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ise{constructor(t){this.key=t}}class sse{constructor(t){this.key=t}}class Z3e{constructor(t,s){this.query=t,this.fa=s,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Pr(),this.mutatedKeys=Pr(),this.ya=Sie(t),this.wa=new s0(this.ya)}get Sa(){return this.fa}ba(t,s){const a=s?s.Da:new lJ,l=s?s.wa:this.wa;let d=s?s.mutatedKeys:this.mutatedKeys,f=l,y=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((w,I)=>{const k=l.get(w),L=H1(this.query,I)?I:null,V=!!k&&this.mutatedKeys.has(k.key),B=!!L&&(L.hasLocalMutations||this.mutatedKeys.has(L.key)&&L.hasCommittedMutations);let W=!1;k&&L?k.data.isEqual(L.data)?V!==B&&(a.track({type:3,doc:L}),W=!0):this.va(k,L)||(a.track({type:2,doc:L}),W=!0,(v&&this.ya(L,v)>0||b&&this.ya(L,b)<0)&&(y=!0)):!k&&L?(a.track({type:0,doc:L}),W=!0):k&&!L&&(a.track({type:1,doc:k}),W=!0,(v||b)&&(y=!0)),W&&(L?(f=f.add(L),d=B?d.add(w):d.delete(w)):(f=f.delete(w),d=d.delete(w)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const w=this.query.limitType==="F"?f.last():f.first();f=f.delete(w.key),d=d.delete(w.key),a.track({type:1,doc:w})}return{wa:f,Da:a,ls:y,mutatedKeys:d}}va(t,s){return t.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(t,s,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const f=t.Da.X_();f.sort((w,I)=>function(L,V){const B=W=>{switch(W){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kn()}};return B(L)-B(V)}(w.type,I.type)||this.ya(w.doc,I.doc)),this.Ca(a),l=l!=null&&l;const y=s&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,b=v!==this.ga;return this.ga=v,f.length!==0||b?{snapshot:new A0(this.query,t.wa,d,f,t.mutatedKeys,v===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:y}:{Ma:y}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new lJ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(s=>this.fa=this.fa.add(s)),t.modifiedDocuments.forEach(s=>{}),t.removedDocuments.forEach(s=>this.fa=this.fa.delete(s)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=Pr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const s=[];return t.forEach(a=>{this.pa.has(a)||s.push(new sse(a))}),this.pa.forEach(a=>{t.has(a)||s.push(new ise(a))}),s}Oa(t){this.fa=t.gs,this.pa=Pr();const s=this.ba(t.documents);return this.applyChanges(s,!0)}Na(){return A0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const _4="SyncEngine";class e5e{constructor(t,s,a){this.query=t,this.targetId=s,this.view=a}}class t5e{constructor(t){this.key=t,this.Ba=!1}}class n5e{constructor(t,s,a,l,d,f){this.localStore=t,this.remoteStore=s,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new Ky(y=>vie(y),G1),this.qa=new Map,this.Qa=new Set,this.$a=new gs(An.comparator),this.Ua=new Map,this.Ka=new o4,this.Wa={},this.Ga=new Map,this.za=I0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function r5e(n,t,s=!0){const a=dse(n);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await ose(a,t,s,!0),l}async function i5e(n,t){const s=dse(n);await ose(s,t,!0,!1)}async function ose(n,t,s,a){const l=await w3e(n.localStore,rp(t)),d=l.targetId,f=n.sharedClientState.addLocalQueryTarget(d,s);let y;return a&&(y=await s5e(n,t,d,f==="current",l.resumeToken)),n.isPrimaryClient&&s&&Yie(n.remoteStore,l),y}async function s5e(n,t,s,a,l){n.Ha=(I,k,L)=>async function(B,W,Q,$){let ie=W.view.ba(Q);ie.ls&&(ie=await rJ(B.localStore,W.query,!1).then(({documents:Y})=>W.view.ba(Y,ie)));const ce=$&&$.targetChanges.get(W.targetId),ne=$&&$.targetMismatches.get(W.targetId)!=null,de=W.view.applyChanges(ie,B.isPrimaryClient,ce,ne);return pJ(B,W.targetId,de.Ma),de.snapshot}(n,I,k,L);const d=await rJ(n.localStore,t,!0),f=new Z3e(t,d.gs),y=f.ba(d.documents),v=lR.createSynthesizedTargetChangeForCurrentChange(s,a&&n.onlineState!=="Offline",l),b=f.applyChanges(y,n.isPrimaryClient,v);pJ(n,s,b.Ma);const w=new e5e(t,s,f);return n.ka.set(t,w),n.qa.has(s)?n.qa.get(s).push(t):n.qa.set(s,[t]),b.snapshot}async function o5e(n,t,s){const a=tr(n),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(f=>!G1(f,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await kV(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),s&&u4(a.remoteStore,l.targetId),xV(a,l.targetId)}).catch(z0)):(xV(a,l.targetId),await kV(a.localStore,l.targetId,!0))}async function a5e(n,t){const s=tr(n),a=s.ka.get(t),l=s.qa.get(a.targetId);s.isPrimaryClient&&l.length===1&&(s.sharedClientState.removeLocalQueryTarget(a.targetId),u4(s.remoteStore,a.targetId))}async function c5e(n,t,s){const a=m5e(n);try{const l=await function(f,y){const v=tr(f),b=Eo.now(),w=y.reduce((L,V)=>L.add(V.key),Pr());let I,k;return v.persistence.runTransaction("Locally write mutations","readwrite",L=>{let V=zf(),B=Pr();return v.ds.getEntries(L,w).next(W=>{V=W,V.forEach((Q,$)=>{$.isValidDocument()||(B=B.add(Q))})}).next(()=>v.localDocuments.getOverlayedDocuments(L,V)).next(W=>{I=W;const Q=[];for(const $ of y){const ie=w4e($,I.get($.key).overlayedDocument);ie!=null&&Q.push(new Vg($.key,ie,hie(ie.value.mapValue),Lu.exists(!0)))}return v.mutationQueue.addMutationBatch(L,b,Q,y)}).next(W=>{k=W;const Q=W.applyToLocalDocumentSet(I,B);return v.documentOverlayCache.saveOverlays(L,W.batchId,Q)})}).then(()=>({batchId:k.batchId,changes:Tie(I)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(f,y,v){let b=f.Wa[f.currentUser.toKey()];b||(b=new gs(mr)),b=b.insert(y,v),f.Wa[f.currentUser.toKey()]=b}(a,l.batchId,s),await dR(a,l.changes),await J1(a.remoteStore)}catch(l){const d=m4(l,"Failed to persist write");s.reject(d)}}async function ase(n,t){const s=tr(n);try{const a=await S3e(s.localStore,t);t.targetChanges.forEach((l,d)=>{const f=s.Ua.get(d);f&&(pi(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?pi(f.Ba):l.removedDocuments.size>0&&(pi(f.Ba),f.Ba=!1))}),await dR(s,a,t)}catch(a){await z0(a)}}function hJ(n,t,s){const a=tr(n);if(a.isPrimaryClient&&s===0||!a.isPrimaryClient&&s===1){const l=[];a.ka.forEach((d,f)=>{const y=f.view.sa(t);y.snapshot&&l.push(y.snapshot)}),function(f,y){const v=tr(f);v.onlineState=y;let b=!1;v.queries.forEach((w,I)=>{for(const k of I.ta)k.sa(y)&&(b=!0)}),b&&g4(v)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function l5e(n,t,s){const a=tr(n);a.sharedClientState.updateQueryState(t,"rejected",s);const l=a.Ua.get(t),d=l&&l.key;if(d){let f=new gs(An.comparator);f=f.insert(d,Xa.newNoDocument(d,Jn.min()));const y=Pr().add(d),v=new q1(Jn.min(),new Map,new gs(mr),f,y);await ase(a,v),a.$a=a.$a.remove(d),a.Ua.delete(t),y4(a)}else await kV(a.localStore,t,!1).then(()=>xV(a,t,s)).catch(z0)}async function u5e(n,t){const s=tr(n),a=t.batch.batchId;try{const l=await v3e(s.localStore,t);lse(s,a,null),cse(s,a),s.sharedClientState.updateMutationState(a,"acknowledged"),await dR(s,l)}catch(l){await z0(l)}}async function d5e(n,t,s){const a=tr(n);try{const l=await function(f,y){const v=tr(f);return v.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let w;return v.mutationQueue.lookupMutationBatch(b,y).next(I=>(pi(I!==null),w=I.keys(),v.mutationQueue.removeMutationBatch(b,I))).next(()=>v.mutationQueue.performConsistencyCheck(b)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(b,w,y)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,w)).next(()=>v.localDocuments.getDocuments(b,w))})}(a.localStore,t);lse(a,t,s),cse(a,t),a.sharedClientState.updateMutationState(t,"rejected",s),await dR(a,l)}catch(l){await z0(l)}}function cse(n,t){(n.Ga.get(t)||[]).forEach(s=>{s.resolve()}),n.Ga.delete(t)}function lse(n,t,s){const a=tr(n);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(s?d.reject(s):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function xV(n,t,s=null){n.sharedClientState.removeLocalQueryTarget(t);for(const a of n.qa.get(t))n.ka.delete(a),s&&n.La.Ja(a,s);n.qa.delete(t),n.isPrimaryClient&&n.Ka.br(t).forEach(a=>{n.Ka.containsKey(a)||use(n,a)})}function use(n,t){n.Qa.delete(t.path.canonicalString());const s=n.$a.get(t);s!==null&&(u4(n.remoteStore,s),n.$a=n.$a.remove(t),n.Ua.delete(s),y4(n))}function pJ(n,t,s){for(const a of s)a instanceof ise?(n.Ka.addReference(a.key,t),h5e(n,a)):a instanceof sse?(nn(_4,"Document no longer in limbo: "+a.key),n.Ka.removeReference(a.key,t),n.Ka.containsKey(a.key)||use(n,a.key)):Kn()}function h5e(n,t){const s=t.key,a=s.path.canonicalString();n.$a.get(s)||n.Qa.has(a)||(nn(_4,"New document in limbo: "+s),n.Qa.add(a),y4(n))}function y4(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const t=n.Qa.values().next().value;n.Qa.delete(t);const s=new An(ts.fromString(t)),a=n.za.next();n.Ua.set(a,new t5e(s)),n.$a=n.$a.insert(s,a),Yie(n.remoteStore,new mg(rp(e4(s.path)),a,"TargetPurposeLimboResolution",B1.ae))}}async function dR(n,t,s){const a=tr(n),l=[],d=[],f=[];a.ka.isEmpty()||(a.ka.forEach((y,v)=>{f.push(a.Ha(v,t,s).then(b=>{var w;if((b||s)&&a.isPrimaryClient){const I=b?!b.fromCache:(w=s==null?void 0:s.targetChanges.get(v.targetId))===null||w===void 0?void 0:w.current;a.sharedClientState.updateQueryState(v.targetId,I?"current":"not-current")}if(b){l.push(b);const I=c4.Yi(v.targetId,b);d.push(I)}}))}),await Promise.all(f),a.La.p_(l),await async function(v,b){const w=tr(v);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>Ct.forEach(b,k=>Ct.forEach(k.Hi,L=>w.persistence.referenceDelegate.addReference(I,k.targetId,L)).next(()=>Ct.forEach(k.Ji,L=>w.persistence.referenceDelegate.removeReference(I,k.targetId,L)))))}catch(I){if(!G0(I))throw I;nn(l4,"Failed to update sequence numbers: "+I)}for(const I of b){const k=I.targetId;if(!I.fromCache){const L=w.Ts.get(k),V=L.snapshotVersion,B=L.withLastLimboFreeSnapshotVersion(V);w.Ts=w.Ts.insert(k,B)}}}(a.localStore,d))}async function p5e(n,t){const s=tr(n);if(!s.currentUser.isEqual(t)){nn(_4,"User change. New user:",t.toKey());const a=await Hie(s.localStore,t);s.currentUser=t,function(d,f){d.Ga.forEach(y=>{y.forEach(v=>{v.reject(new ln(It.CANCELLED,f))})}),d.Ga.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await dR(s,a.Rs)}}function f5e(n,t){const s=tr(n),a=s.Ua.get(t);if(a&&a.Ba)return Pr().add(a.key);{let l=Pr();const d=s.qa.get(t);if(!d)return l;for(const f of d){const y=s.ka.get(f);l=l.unionWith(y.view.Sa)}return l}}function dse(n){const t=tr(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=ase.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=f5e.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=l5e.bind(null,t),t.La.p_=J3e.bind(null,t.eventManager),t.La.Ja=Q3e.bind(null,t.eventManager),t}function m5e(n){const t=tr(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=u5e.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=d5e.bind(null,t),t}class Zk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Y1(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,s){return null}nu(t,s){return null}eu(t){return E3e(this.persistence,new g3e,t.initialUser,this.serializer)}Xa(t){return new Gie(a4.ri,this.serializer)}Za(t){return new R3e}async terminate(){var t,s;(t=this.gcScheduler)===null||t===void 0||t.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Zk.provider={build:()=>new Zk};class g5e extends Zk{constructor(t){super(),this.cacheSizeBytes=t}tu(t,s){pi(this.persistence.referenceDelegate instanceof Jk);const a=this.persistence.referenceDelegate.garbageCollector;return new t3e(a,t.asyncQueue,s)}Xa(t){const s=this.cacheSizeBytes!==void 0?sl.withCacheSize(this.cacheSizeBytes):sl.DEFAULT;return new Gie(a=>Jk.ri(a,s),this.serializer)}}class LV{async initialize(t,s){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>hJ(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=p5e.bind(null,this.syncEngine),await q3e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new X3e}()}createDatastore(t){const s=Y1(t.databaseInfo.databaseId),a=function(d){return new k3e(d)}(t.databaseInfo);return function(d,f,y,v){return new L3e(d,f,y,v)}(t.authCredentials,t.appCheckCredentials,a,s)}createRemoteStore(t){return function(a,l,d,f,y){return new U3e(a,l,d,f,y)}(this.localStore,this.datastore,t.asyncQueue,s=>hJ(this.syncEngine,s,0),function(){return oJ.D()?new oJ:new I3e}())}createSyncEngine(t,s){return function(l,d,f,y,v,b,w){const I=new n5e(l,d,f,y,v,b);return w&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,s)}async terminate(){var t,s;await async function(l){const d=tr(l);nn(By,"RemoteStore shutting down."),d.W_.add(5),await uR(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}LV.provider={build:()=>new LV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hse{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):Wf("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,s){setTimeout(()=>{this.muted||t(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Og="FirestoreClient";class _5e{constructor(t,s,a,l,d){this.authCredentials=t,this.appCheckCredentials=s,this.asyncQueue=a,this.databaseInfo=l,this.user=Ya.UNAUTHENTICATED,this.clientId=nie.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async f=>{nn(Og,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(a,f=>(nn(Og,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new kf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(s){const a=m4(s,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function nU(n,t){n.asyncQueue.verifyOperationInProgress(),nn(Og,"Initializing OfflineComponentProvider");const s=n.configuration;await t.initialize(s);let a=s.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await Hie(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function fJ(n,t){n.asyncQueue.verifyOperationInProgress();const s=await y5e(n);nn(Og,"Initializing OnlineComponentProvider"),await t.initialize(s,n.configuration),n.setCredentialChangeListener(a=>cJ(t.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>cJ(t.remoteStore,l)),n._onlineComponents=t}async function y5e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){nn(Og,"Using user provided OfflineComponentProvider");try{await nU(n,n._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!function(l){return l.name==="FirebaseError"?l.code===It.FAILED_PRECONDITION||l.code===It.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(s))throw s;S0("Error using user provided cache. Falling back to memory cache: "+s),await nU(n,new Zk)}}else nn(Og,"Using default OfflineComponentProvider"),await nU(n,new g5e(void 0));return n._offlineComponents}async function pse(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(nn(Og,"Using user provided OnlineComponentProvider"),await fJ(n,n._uninitializedComponentsProvider._online)):(nn(Og,"Using default OnlineComponentProvider"),await fJ(n,new LV))),n._onlineComponents}function E5e(n){return pse(n).then(t=>t.syncEngine)}async function fse(n){const t=await pse(n),s=t.eventManager;return s.onListen=r5e.bind(null,t.syncEngine),s.onUnlisten=o5e.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=i5e.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=a5e.bind(null,t.syncEngine),s}function v5e(n,t,s={}){const a=new kf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,y,v,b){const w=new hse({next:k=>{w.su(),f.enqueueAndForget(()=>nse(d,I));const L=k.docs.has(y);!L&&k.fromCache?b.reject(new ln(It.UNAVAILABLE,"Failed to get document because the client is offline.")):L&&k.fromCache&&v&&v.source==="server"?b.reject(new ln(It.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(k)},error:k=>b.reject(k)}),I=new rse(e4(y.path),w,{includeMetadataChanges:!0,Ta:!0});return tse(d,I)}(await fse(n),n.asyncQueue,t,s,a)),a.promise}function S5e(n,t,s={}){const a=new kf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,y,v,b){const w=new hse({next:k=>{w.su(),f.enqueueAndForget(()=>nse(d,I)),k.fromCache&&v.source==="server"?b.reject(new ln(It.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(k)},error:k=>b.reject(k)}),I=new rse(y,w,{includeMetadataChanges:!0,Ta:!0});return tse(d,I)}(await fse(n),n.asyncQueue,t,s,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mse(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mJ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gse(n,t,s){if(!s)throw new ln(It.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function b5e(n,t,s,a){if(t===!0&&a===!0)throw new ln(It.INVALID_ARGUMENT,`${n} and ${s} cannot be used together.`)}function gJ(n){if(!An.isDocumentKey(n))throw new ln(It.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function _J(n){if(An.isDocumentKey(n))throw new ln(It.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Q1(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":Kn()}function Ud(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new ln(It.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=Q1(n);throw new ln(It.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _se="firestore.googleapis.com",yJ=!0;class EJ{constructor(t){var s,a;if(t.host===void 0){if(t.ssl!==void 0)throw new ln(It.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=_se,this.ssl=yJ}else this.host=t.host,this.ssl=(s=t.ssl)!==null&&s!==void 0?s:yJ;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=zie;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Z4e)throw new ln(It.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}b5e("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=mse((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new ln(It.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new ln(It.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new ln(It.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Z1{constructor(t,s,a,l){this._authCredentials=t,this._appCheckCredentials=s,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new EJ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ln(It.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new ln(It.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new EJ(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new Oje;switch(a.type){case"firstParty":return new xje(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new ln(It.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const a=mJ.get(s);a&&(nn("ComponentProvider","Removing Datastore"),mJ.delete(s),a.terminate())}(this),Promise.resolve()}}function T5e(n,t,s,a={}){var l;const d=(n=Ud(n,Z1))._getSettings(),f=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),y=`${t}:${s}`;d.host!==_se&&d.host!==y&&S0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:y,ssl:!1,emulatorOptions:a});if(!Ff(v,f)&&(n._setSettings(v),a.mockUserToken)){let b,w;if(typeof a.mockUserToken=="string")b=a.mockUserToken,w=Ya.MOCK_USER;else{b=sre(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const I=a.mockUserToken.sub||a.mockUserToken.user_id;if(!I)throw new ln(It.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new Ya(I)}n._authCredentials=new kje(new eie(b,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy{constructor(t,s,a){this.converter=s,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new Yy(this.firestore,t,this._query)}}class Tc{constructor(t,s,a){this.converter=s,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new vg(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Tc(this.firestore,t,this._key)}}class vg extends Yy{constructor(t,s,a){super(t,s,e4(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Tc(this.firestore,null,new An(t))}withConverter(t){return new vg(this.firestore,t,this._path)}}function kg(n,t,...s){if(n=ls(n),gse("collection","path",t),n instanceof Z1){const a=ts.fromString(t,...s);return _J(a),new vg(n,null,a)}{if(!(n instanceof Tc||n instanceof vg))throw new ln(It.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(ts.fromString(t,...s));return _J(a),new vg(n.firestore,null,a)}}function Hr(n,t,...s){if(n=ls(n),arguments.length===1&&(t=nie.newId()),gse("doc","path",t),n instanceof Z1){const a=ts.fromString(t,...s);return gJ(a),new Tc(n,null,new An(a))}{if(!(n instanceof Tc||n instanceof vg))throw new ln(It.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(ts.fromString(t,...s));return gJ(a),new Tc(n.firestore,n instanceof vg?n.converter:null,new An(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vJ="AsyncQueue";class SJ{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Kie(this,"async_queue_retry"),this.Su=()=>{const a=tU();a&&nn(vJ,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.bu=t;const s=tU();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const s=tU();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.Su)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const s=new kf;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!G0(t))throw t;nn(vJ,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const s=this.bu.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(f){let y=f.message||"";return f.stack&&(y=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),y}(a);throw Wf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.bu=s,s}enqueueAfterDelay(t,s,a){this.Du(),this.wu.indexOf(t)>-1&&(s=0);const l=f4.createAndSchedule(this,t,s,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&Kn()}verifyOperationInProgress(){}async Mu(){let t;do t=this.bu,await t;while(t!==this.bu)}xu(t){for(const s of this.fu)if(s.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((s,a)=>s.targetTimeMs-a.targetTimeMs);for(const s of this.fu)if(s.skipDelay(),t!=="all"&&s.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const s=this.fu.indexOf(t);this.fu.splice(s,1)}}class Xy extends Z1{constructor(t,s,a,l){super(t,s,a,l),this.type="firestore",this._queue=new SJ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new SJ(t),this._firestoreClient=void 0,await t}}}function MV(n,t){const s=typeof n=="object"?n:Fj(),a=typeof n=="string"?n:zk,l=M1(s,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=nre("firestore");d&&T5e(l,...d)}return l}function E4(n){if(n._terminated)throw new ln(It.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||w5e(n),n._firestoreClient}function w5e(n){var t,s,a;const l=n._freezeSettings(),d=function(y,v,b,w){return new Yje(y,v,b,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,mse(w.experimentalLongPollingOptions),w.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((s=l.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new _5e(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(y){const v=y==null?void 0:y._online.build();return{_offline:y==null?void 0:y._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0{constructor(t){this._byteString=t}static fromBase64String(t){try{return new P0(Ta.fromBase64String(t))}catch(s){throw new ln(It.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(t){return new P0(Ta.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eN{constructor(...t){for(let s=0;s<t.length;++s)if(t[s].length===0)throw new ln(It.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Sa(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4{constructor(t,s){if(!isFinite(t)||t<-90||t>90)throw new ln(It.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(s)||s<-180||s>180)throw new ln(It.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=t,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return mr(this._lat,t._lat)||mr(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S4{constructor(t){this._values=(t||[]).map(s=>s)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C5e=/^__.*__$/;class R5e{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return this.fieldMask!==null?new Vg(t,this.data,this.fieldMask,s,this.fieldTransforms):new cR(t,this.data,s,this.fieldTransforms)}}class yse{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return new Vg(t,this.data,this.fieldMask,s,this.fieldTransforms)}}function Ese(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Kn()}}class tN{constructor(t,s,a,l,d,f){this.settings=t,this.databaseId=s,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new tN(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Uu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Ku(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return e1(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(s=>t.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>t.isPrefixOf(s.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(Ese(this.Lu)&&C5e.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class I5e{constructor(t,s,a){this.databaseId=t,this.ignoreUndefinedProperties=s,this.serializer=a||Y1(t)}ju(t,s,a,l=!1){return new tN({Lu:t,methodName:s,zu:a,path:Sa.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function nN(n){const t=n._freezeSettings(),s=Y1(n._databaseId);return new I5e(n._databaseId,!!t.ignoreUndefinedProperties,s)}function vse(n,t,s,a,l,d={}){const f=n.ju(d.merge||d.mergeFields?2:0,t,s,l);w4("Data must be an object, but it was:",f,a);const y=bse(a,f);let v,b;if(d.merge)v=new Vl(f.fieldMask),b=f.fieldTransforms;else if(d.mergeFields){const w=[];for(const I of d.mergeFields){const k=UV(t,I,s);if(!f.contains(k))throw new ln(It.INVALID_ARGUMENT,`Field '${k}' is specified in your field mask but missing from your input data.`);wse(w,k)||w.push(k)}v=new Vl(w),b=f.fieldTransforms.filter(I=>v.covers(I.field))}else v=null,b=f.fieldTransforms;return new R5e(new al(y),v,b)}class rN extends hR{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof rN}}function Sse(n,t,s){return new tN({Lu:3,zu:t.settings.zu,methodName:n._methodName,Qu:s},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class b4 extends hR{constructor(t,s){super(t),this.Hu=s}_toFieldTransform(t){const s=Sse(this,t,!0),a=this.Hu.map(d=>Jy(d,s)),l=new C0(a);return new Oie(t.path,l)}isEqual(t){return t instanceof b4&&Ff(this.Hu,t.Hu)}}class T4 extends hR{constructor(t,s){super(t),this.Hu=s}_toFieldTransform(t){const s=Sse(this,t,!0),a=this.Hu.map(d=>Jy(d,s)),l=new R0(a);return new Oie(t.path,l)}isEqual(t){return t instanceof T4&&Ff(this.Hu,t.Hu)}}function A5e(n,t,s,a){const l=n.ju(1,t,s);w4("Data must be an object, but it was:",l,a);const d=[],f=al.empty();Ug(a,(v,b)=>{const w=C4(t,v,s);b=ls(b);const I=l.Uu(w);if(b instanceof rN)d.push(w);else{const k=Jy(b,I);k!=null&&(d.push(w),f.set(w,k))}});const y=new Vl(d);return new yse(f,y,l.fieldTransforms)}function P5e(n,t,s,a,l,d){const f=n.ju(1,t,s),y=[UV(t,a,s)],v=[l];if(d.length%2!=0)throw new ln(It.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let k=0;k<d.length;k+=2)y.push(UV(t,d[k])),v.push(d[k+1]);const b=[],w=al.empty();for(let k=y.length-1;k>=0;--k)if(!wse(b,y[k])){const L=y[k];let V=v[k];V=ls(V);const B=f.Uu(L);if(V instanceof rN)b.push(L);else{const W=Jy(V,B);W!=null&&(b.push(L),w.set(L,W))}}const I=new Vl(b);return new yse(w,I,f.fieldTransforms)}function O5e(n,t,s,a=!1){return Jy(s,n.ju(a?4:3,t))}function Jy(n,t){if(Tse(n=ls(n)))return w4("Unsupported field value:",t,n),bse(n,t);if(n instanceof hR)return function(a,l){if(!Ese(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let f=0;for(const y of a){let v=Jy(y,l.Ku(f));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),f++}return{arrayValue:{values:d}}}(n,t)}return function(a,l){if((a=ls(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return y4e(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=Eo.fromDate(a);return{timestampValue:Xk(l.serializer,d)}}if(a instanceof Eo){const d=new Eo(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:Xk(l.serializer,d)}}if(a instanceof v4)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof P0)return{bytesValue:Mie(l.serializer,a._byteString)};if(a instanceof Tc){const d=l.databaseId,f=a.firestore._databaseId;if(!f.isEqual(d))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:s4(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof S4)return function(f,y){return{mapValue:{fields:{[uie]:{stringValue:die},[Gk]:{arrayValue:{values:f.toArray().map(b=>{if(typeof b!="number")throw y.Wu("VectorValues must only contain numeric values.");return t4(y.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${Q1(a)}`)}(n,t)}function bse(n,t){const s={};return iie(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ug(n,(a,l)=>{const d=Jy(l,t.qu(a));d!=null&&(s[a]=d)}),{mapValue:{fields:s}}}function Tse(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Eo||n instanceof v4||n instanceof P0||n instanceof Tc||n instanceof hR||n instanceof S4)}function w4(n,t,s){if(!Tse(s)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(s)){const a=Q1(s);throw a==="an object"?t.Wu(n+" a custom object"):t.Wu(n+" "+a)}}function UV(n,t,s){if((t=ls(t))instanceof eN)return t._internalPath;if(typeof t=="string")return C4(n,t);throw e1("Field path arguments must be of type string or ",n,!1,void 0,s)}const k5e=new RegExp("[~\\*/\\[\\]]");function C4(n,t,s){if(t.search(k5e)>=0)throw e1(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,s);try{return new eN(...t.split("."))._internalPath}catch{throw e1(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,s)}}function e1(n,t,s,a,l){const d=a&&!a.isEmpty(),f=l!==void 0;let y=`Function ${t}() called with invalid data`;s&&(y+=" (via `toFirestore()`)"),y+=". ";let v="";return(d||f)&&(v+=" (found",d&&(v+=` in field ${a}`),f&&(v+=` in document ${l}`),v+=")"),new ln(It.INVALID_ARGUMENT,y+n+v)}function wse(n,t){return n.some(s=>s.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cse{constructor(t,s,a,l,d){this._firestore=t,this._userDataWriter=s,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new Tc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new N5e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const s=this._document.data.field(R4("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s)}}}class N5e extends Cse{data(){return super.data()}}function R4(n,t){return typeof t=="string"?C4(n,t):t instanceof eN?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D5e(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ln(It.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class I4{}class Rse extends I4{}function VV(n,t,...s){let a=[];t instanceof I4&&a.push(t),a=a.concat(s),function(d){const f=d.filter(v=>v instanceof A4).length,y=d.filter(v=>v instanceof iN).length;if(f>1||f>0&&y>0)throw new ln(It.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class iN extends Rse{constructor(t,s,a){super(),this._field=t,this._op=s,this._value=a,this.type="where"}static _create(t,s,a){return new iN(t,s,a)}_apply(t){const s=this._parse(t);return Ise(t._query,s),new Yy(t.firestore,t.converter,RV(t._query,s))}_parse(t){const s=nN(t.firestore);return function(d,f,y,v,b,w,I){let k;if(b.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new ln(It.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){wJ(I,w);const V=[];for(const B of I)V.push(TJ(v,d,B));k={arrayValue:{values:V}}}else k=TJ(v,d,I)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||wJ(I,w),k=O5e(y,f,I,w==="in"||w==="not-in");return ro.create(b,w,k)}(t._query,"where",s,t.firestore._databaseId,this._field,this._op,this._value)}}function bJ(n,t,s){const a=t,l=R4("where",n);return iN._create(l,a,s)}class A4 extends I4{constructor(t,s){super(),this.type=t,this._queryConstraints=s}static _create(t,s){return new A4(t,s)}_parse(t){const s=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return s.length===1?s[0]:Md.create(s,this._getOperator())}_apply(t){const s=this._parse(t);return s.getFilters().length===0?t:(function(l,d){let f=l;const y=d.getFlattenedFilters();for(const v of y)Ise(f,v),f=RV(f,v)}(t._query,s),new Yy(t.firestore,t.converter,RV(t._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class P4 extends Rse{constructor(t,s,a){super(),this.type=t,this._limit=s,this._limitType=a}static _create(t,s,a){return new P4(t,s,a)}_apply(t){return new Yy(t.firestore,t.converter,Kk(t._query,this._limit,this._limitType))}}function x5e(n){return P4._create("limit",n,"F")}function TJ(n,t,s){if(typeof(s=ls(s))=="string"){if(s==="")throw new ln(It.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Eie(t)&&s.indexOf("/")!==-1)throw new ln(It.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const a=t.path.child(ts.fromString(s));if(!An.isDocumentKey(a))throw new ln(It.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return VX(n,new An(a))}if(s instanceof Tc)return VX(n,s._key);throw new ln(It.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Q1(s)}.`)}function wJ(n,t){if(!Array.isArray(n)||n.length===0)throw new ln(It.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Ise(n,t){const s=function(l,d){for(const f of l)for(const y of f.getFlattenedFilters())if(d.indexOf(y.op)>=0)return y.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(s!==null)throw s===t.op?new ln(It.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new ln(It.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}class L5e{convertValue(t,s="none"){switch(Ag(t)){case 0:return null;case 1:return t.booleanValue;case 2:return zs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,s);case 5:return t.stringValue;case 6:return this.convertBytes(Ig(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,s);case 11:return this.convertObject(t.mapValue,s);case 10:return this.convertVectorValue(t.mapValue);default:throw Kn()}}convertObject(t,s){return this.convertObjectMap(t.fields,s)}convertObjectMap(t,s="none"){const a={};return Ug(t,(l,d)=>{a[l]=this.convertValue(d,s)}),a}convertVectorValue(t){var s,a,l;const d=(l=(a=(s=t.fields)===null||s===void 0?void 0:s[Gk].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(f=>zs(f.doubleValue));return new S4(d)}convertGeoPoint(t){return new v4(zs(t.latitude),zs(t.longitude))}convertArray(t,s){return(t.values||[]).map(a=>this.convertValue(a,s))}convertServerTimestamp(t,s){switch(s){case"previous":const a=z1(t);return a==null?null:this.convertValue(a,s);case"estimate":return this.convertTimestamp(UC(t));default:return null}}convertTimestamp(t){const s=Rg(t);return new Eo(s.seconds,s.nanos)}convertDocumentKey(t,s){const a=ts.fromString(t);pi(Wie(a));const l=new VC(a.get(1),a.get(3)),d=new An(a.popFirst(5));return l.isEqual(s)||Wf(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ase(n,t,s){let a;return a=n?s&&(s.merge||s.mergeFields)?n.toFirestore(t,s):n.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gw{constructor(t,s){this.hasPendingWrites=t,this.fromCache=s}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Pse extends Cse{constructor(t,s,a,l,d,f){super(t,s,a,l,f),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const s=new hk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,s={}){if(this._document){const a=this._document.data.field(R4("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,s.serverTimestamps)}}}class hk extends Pse{data(t={}){return super.data(t)}}class M5e{constructor(t,s,a,l){this._firestore=t,this._userDataWriter=s,this._snapshot=l,this.metadata=new Gw(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(s=>t.push(s)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,s){this._snapshot.docs.forEach(a=>{t.call(s,new hk(this._firestore,this._userDataWriter,a.key,a,new Gw(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const s=!!t.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new ln(It.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(y=>{const v=new hk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new Gw(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);return y.doc,{type:"added",doc:v,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(y=>d||y.type!==3).map(y=>{const v=new hk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new Gw(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,w=-1;return y.type!==0&&(b=f.indexOf(y.doc.key),f=f.delete(y.doc.key)),y.type!==1&&(f=f.add(y.doc),w=f.indexOf(y.doc.key)),{type:U5e(y.type),doc:v,oldIndex:b,newIndex:w}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function U5e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jo(n){n=Ud(n,Tc);const t=Ud(n.firestore,Xy);return v5e(E4(t),n._key).then(s=>j5e(t,n,s))}class Ose extends L5e{constructor(t){super(),this.firestore=t}convertBytes(t){return new P0(t)}convertReference(t){const s=this.convertDocumentKey(t,this.firestore._databaseId);return new Tc(this.firestore,null,s)}}function Wy(n){n=Ud(n,Yy);const t=Ud(n.firestore,Xy),s=E4(t),a=new Ose(t);return D5e(n._query),S5e(s,n._query).then(l=>new M5e(t,a,n,l))}function O0(n,t,s){n=Ud(n,Tc);const a=Ud(n.firestore,Xy),l=Ase(n.converter,t,s);return sN(a,[vse(nN(a),"setDoc",n._key,l,n.converter!==null,s).toMutation(n._key,Lu.none())])}function So(n,t,s,...a){n=Ud(n,Tc);const l=Ud(n.firestore,Xy),d=nN(l);let f;return f=typeof(t=ls(t))=="string"||t instanceof eN?P5e(d,"updateDoc",n._key,t,s,a):A5e(d,"updateDoc",n._key,t),sN(l,[f.toMutation(n._key,Lu.exists(!0))])}function V5e(n){return sN(Ud(n.firestore,Xy),[new n4(n._key,Lu.none())])}function F5e(n,t){const s=Ud(n.firestore,Xy),a=Hr(n),l=Ase(n.converter,t);return sN(s,[vse(nN(n.firestore),"addDoc",a._key,l,n.converter!==null,{}).toMutation(a._key,Lu.exists(!1))]).then(()=>a)}function sN(n,t){return function(a,l){const d=new kf;return a.asyncQueue.enqueueAndForget(async()=>c5e(await E5e(a),l,d)),d.promise}(E4(n),t)}function j5e(n,t,s){const a=s.docs.get(t._key),l=new Ose(n);return new Pse(n,l,t._key,a,new Gw(s.hasPendingWrites,s.fromCache),t.converter)}function B5e(...n){return new b4("arrayUnion",n)}function W5e(...n){return new T4("arrayRemove",n)}(function(t,s=!0){(function(l){W0=l})($y),Uy(new wg("firestore",(a,{instanceIdentifier:l,options:d})=>{const f=a.getProvider("app").getImmediate(),y=new Xy(new Nje(a.getProvider("auth-internal")),new Lje(f,a.getProvider("app-check-internal")),function(b,w){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new ln(It.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new VC(b.options.projectId,w)}(f,l),f);return d=Object.assign({useFetchStreams:s},d),y._setSettings(d),y},"PUBLIC").setMultipleInstances(!0)),ep(RX,IX,t),ep(RX,IX,"esm2017")})();var z5e="firebase",G5e="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ep(z5e,G5e,"app");const H5e=[{key:"VITE_FIREBASE_API_KEY",value:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU"},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:"disruptive-metaverse.firebaseapp.com"},{key:"VITE_FIREBASE_PROJECT_ID",value:"disruptive-metaverse"},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:"disruptive-metaverse.appspot.com"},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:"294433070603"},{key:"VITE_FIREBASE_APP_ID",value:"1:294433070603:web:136cddd196eea9614fb10e"}],FV=H5e.filter(n=>!n.value);if(FV.length>0){const t=`Missing environment variables: ${FV.map(s=>s.key).join(", ")}. Using fallback values. For production, it's recommended to set up your .env file.`;J.warn(t),console.warn(t)}const $5e={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},K5e=FV.length>0;J.log(`Firebase initializing with ${K5e?"fallback":"environment"} configuration`);let rU,O4,vr;try{rU=cre($5e),O4=j1(rU),vr=MV(rU),J.log("Firebase initialized successfully")}catch(n){J.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const Hw=n=>!0,CJ=(n,t)=>{const a=(n+t.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return a+l},kse=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return J.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const t=n.toLowerCase().trim();J.log(`userFirestore: Checking if username "${t}" is taken`);const s=kg(vr,"users"),a=VV(s,x5e(100)),l=await Wy(a);let d=!1;return l.forEach(f=>{const y=f.data();y.username&&y.username.toLowerCase()===t&&(d=!0)}),J.log(`userFirestore: Username "${t}" is ${d?"taken":"available"}`),d}catch(t){return J.error("userFirestore: Error checking username availability:",t),!0}},q5e=async(n,t)=>{let s=CJ(n,t),a=0;const l=10;for(;a<l;){if(!await kse(s))return s;s=CJ(n,t),a++}return s+Math.floor(Math.random()*100)},Fu=async n=>{try{J.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const t=Hr(vr,"users",n),s=await jo(t);if(s.exists()){const a=s.data();return J.log("userFirestore: Found PUBLIC Profile for : "+a.Nickname),delete a.email,delete a.emailVerified,a}else return J.error("userFirestore: user profile document not found"),null}catch(t){throw J.error("userFirestore: Error fetching user public profile data:",t),t}},Y5e=async(n,t,s)=>{try{if(J.log("userFirestore: Starting registerUser process"),J.log("userFirestore: Fields in additionalData:",Object.keys(s||{}).join(", ")),!s)throw J.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const a={firstName:s.firstName||"",lastName:s.lastName||"",companyName:s.companyName||"",linkedInProfile:s.linkedInProfile||"",username:s.username||"",Nickname:s.Nickname||"",rpmURL:s.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};J.log("userFirestore: Critical fields captured for registration"),J.log("userFirestore: Creating user auth record");const d=(await pFe(O4,n,t)).user;await Ure(d),J.log("userFirestore: Verification email sent"),J.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(L=>setTimeout(L,5e3));const f=Hr(vr,"users",d.uid),y=await jo(f);if(y.exists()){J.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const L=y.data(),V={};L.firstName||(V.firstName=a.firstName),L.lastName||(V.lastName=a.lastName),L.Nickname||(V.Nickname=a.Nickname),L.username||(V.username=a.username),L.companyName||(V.companyName=a.companyName),L.linkedInProfile||(V.linkedInProfile=a.linkedInProfile),L.rpmURL||(V.rpmURL=a.rpmURL),Object.keys(V).length>0&&(J.log("userFirestore: Updating document with fields:",Object.keys(V).join(", ")),await So(f,{...V,lastUpdated:new Date}))}else{J.error("userFirestore: Cloud Function failed to create user document, creating manually"),await O0(f,{...a,id:d.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const L=Hr(vr,"users",d.uid,"private","data");await O0(L,{email:d.email,emailVerified:!1})}const v=await jo(f);if(!v.exists())throw new Error("User document does not exist even after creation attempts");let b=v.data();b.firstName||(b.firstName=a.firstName),b.lastName||(b.lastName=a.lastName),b.Nickname||(b.Nickname=a.Nickname),b.username||(b.username=a.username),b.companyName||(b.companyName=a.companyName);let w=!1,I={};for(const L in a)(!b[L]||b[L]==="")&&(I[L]=a[L],w=!0);(!b.groups||!b.groups.includes("users"))&&(I.groups=b.groups?[...b.groups,"users"]:["users"],w=!0,J.log("userFirestore: Adding user to users group")),w&&(J.log("userFirestore: Updating user document with missing fields"),J.log("userFirestore: Fields being updated:",Object.keys(I).join(", ")),await So(f,I),b=(await jo(f)).data());const k={...d,...b,firstName:a.firstName,lastName:a.lastName,Nickname:a.Nickname,username:a.username,companyName:a.companyName,linkedInProfile:a.linkedInProfile};return J.log("userFirestore: Registration complete, returning user data"),J.log("userFirestore: Fields included in return data:",Object.keys(k).join(", ")),k}catch(a){throw J.error("userFirestore: Error creating user:",a),a}},Nse=async(n,t)=>{try{J.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const s=Hr(vr,"users",n);await So(s,{rpmURL:t,lastUpdated:new Date().toISOString()}),J.log("userFirestore: rpmURL updated successfully.")}catch(s){throw J.error("userFirestore: Error updating rpmURL:",s),s}},X5e=async(n,t)=>{try{const s=await Fu(n);return s&&s.groups?s.groups.includes(t):!1}catch(s){return J.error("userFirestore: Error checking group membership:",s),!1}};var J5e={};const t1=()=>{const n=typeof process<"u"&&J5e&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n},Q5e=(n,t)=>{if(!t1())return J.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},Z5e=(n,t)=>{if(!t1())return J.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},k4=typeof t1=="function"?t1():!1;k4&&J.warn(" SECURITY WARNING: Permission overrides are ENABLED. This should only happen in development.");const eBe=async(n,t)=>{if(k4)return Q5e();if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${t}_owners`;if(n.groups.includes(l))return console.log(`User ${n.uid} is an owner via groups property`),!0}const a=j1().currentUser;if(a&&a.uid===n.uid)try{const d=(await a.getIdTokenResult(!0)).claims.groups||[],f=`space_${t}_owners`;if(d.includes(f))return console.log(`User ${n.uid} is an owner via Firebase token claims`),!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(s){return J.error("Error checking space owner permissions:",s),!1}},N4=async(n,t)=>{if(k4)return Z5e();try{if(J.log(`userPermissions: Checking if user ${n} belongs to group ${t}`),t==="users")return J.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const s=await Fu(n);if(J.log(`userPermissions: User profile for ${n}:`,s),s&&s.groups&&Array.isArray(s.groups)){if(J.log(`userPermissions: User ${n} has groups:`,s.groups),s.groups.includes(t))return J.log(`userPermissions: User ${n} belongs to group ${t} (from user document)`),!0}else J.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(t==="disruptiveAdmin")try{const l=j1().currentUser;if(l&&l.uid===n){const d=await l.getIdTokenResult();if(J.log(`userPermissions: Token claims for ${n}:`,d.claims),d.claims&&d.claims.groups&&Array.isArray(d.claims.groups)&&d.claims.groups.includes(t))return J.log(`userPermissions: User ${n} belongs to group ${t} (from token claims)`),!0}}catch(a){J.error("userPermissions: Error checking token claims:",a)}}return J.log(`userPermissions: User ${n} does not belong to group ${t}`),!1}catch(s){return J.error("userPermissions: Error checking if user belongs to group:",s),!1}},tBe=["email","name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Dd={sendUserToUnity:"sendUserToUnity"};class nBe{constructor(){this.events={}}subscribe(t,s){this.events[t]||(this.events[t]=[]),this.events[t].push(s)}publish(t,s){const a=this.events[t];a?(a.forEach(l=>{l(s)}),J.log(`EventBus: Published event '${t}'`)):J.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,s){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(s);a>-1&&this.events[t].splice(a,1)}}const xd=new nBe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dse="firebasestorage.googleapis.com",xse="storageBucket",rBe=2*60*1e3,iBe=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls extends up{constructor(t,s,a=0){super(iU(t),`Firebase Storage: ${s} (${iU(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ls.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return iU(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var xs;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(xs||(xs={}));function iU(n){return"storage/"+n}function D4(){const n="An unknown error occurred, please check the error payload for server response.";return new Ls(xs.UNKNOWN,n)}function sBe(n){return new Ls(xs.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function oBe(n){return new Ls(xs.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function aBe(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Ls(xs.UNAUTHENTICATED,n)}function cBe(){return new Ls(xs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function lBe(n){return new Ls(xs.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function uBe(){return new Ls(xs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function dBe(){return new Ls(xs.CANCELED,"User canceled the upload/download.")}function hBe(n){return new Ls(xs.INVALID_URL,"Invalid URL '"+n+"'.")}function pBe(n){return new Ls(xs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function fBe(){return new Ls(xs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+xse+"' property when initializing the app?")}function mBe(){return new Ls(xs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function gBe(){return new Ls(xs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function _Be(n){return new Ls(xs.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function jV(n){return new Ls(xs.INVALID_ARGUMENT,n)}function Lse(){return new Ls(xs.APP_DELETED,"The Firebase app was deleted.")}function yBe(n){return new Ls(xs.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function dC(n,t){return new Ls(xs.INVALID_FORMAT,"String does not match format '"+n+"': "+t)}function gw(n){throw new Ls(xs.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{constructor(t,s){this.bucket=t,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,s){let a;try{a=Fl.makeFromUrl(t,s)}catch{return new Fl(t,"")}if(a.path==="")return a;throw pBe(t)}static makeFromUrl(t,s){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(ce){ce.path.charAt(ce.path.length-1)==="/"&&(ce.path_=ce.path_.slice(0,-1))}const f="(/(.*))?$",y=new RegExp("^gs://"+l+f,"i"),v={bucket:1,path:3};function b(ce){ce.path_=decodeURIComponent(ce.path)}const w="v[A-Za-z0-9_]+",I=s.replace(/[.]/g,"\\."),k="(/([^?#]*).*)?$",L=new RegExp(`^https?://${I}/${w}/b/${l}/o${k}`,"i"),V={bucket:1,path:3},B=s===Dse?"(?:storage.googleapis.com|storage.cloud.google.com)":s,W="([^?#]*)",Q=new RegExp(`^https?://${B}/${l}/${W}`,"i"),ie=[{regex:y,indices:v,postModify:d},{regex:L,indices:V,postModify:b},{regex:Q,indices:{bucket:1,path:2},postModify:b}];for(let ce=0;ce<ie.length;ce++){const ne=ie[ce],de=ne.regex.exec(t);if(de){const Y=de[ne.indices.bucket];let X=de[ne.indices.path];X||(X=""),a=new Fl(Y,X),ne.postModify(a);break}}if(a==null)throw hBe(t);return a}}class EBe{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vBe(n,t,s){let a=1,l=null,d=null,f=!1,y=0;function v(){return y===2}let b=!1;function w(...W){b||(b=!0,t.apply(null,W))}function I(W){l=setTimeout(()=>{l=null,n(L,v())},W)}function k(){d&&clearTimeout(d)}function L(W,...Q){if(b){k();return}if(W){k(),w.call(null,W,...Q);return}if(v()||f){k(),w.call(null,W,...Q);return}a<64&&(a*=2);let ie;y===1?(y=2,ie=0):ie=(a+Math.random())*1e3,I(ie)}let V=!1;function B(W){V||(V=!0,k(),!b&&(l!==null?(W||(y=2),clearTimeout(l),I(0)):W||(y=1)))}return I(0),d=setTimeout(()=>{f=!0,B(!0)},s),B}function SBe(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bBe(n){return n!==void 0}function TBe(n){return typeof n=="object"&&!Array.isArray(n)}function x4(n){return typeof n=="string"||n instanceof String}function RJ(n){return L4()&&n instanceof Blob}function L4(){return typeof Blob<"u"}function IJ(n,t,s,a){if(a<t)throw jV(`Invalid value for '${n}'. Expected ${t} or greater.`);if(a>s)throw jV(`Invalid value for '${n}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oN(n,t,s){let a=t;return s==null&&(a=`https://${t}`),`${s}://${a}/v0${n}`}function Mse(n){const t=encodeURIComponent;let s="?";for(const a in n)if(n.hasOwnProperty(a)){const l=t(a)+"="+t(n[a]);s=s+l+"&"}return s=s.slice(0,-1),s}var Oy;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Oy||(Oy={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wBe(n,t){const s=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=t.indexOf(n)!==-1;return s||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CBe{constructor(t,s,a,l,d,f,y,v,b,w,I,k=!0){this.url_=t,this.method_=s,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=f,this.callback_=y,this.errorCallback_=v,this.timeout_=b,this.progressCallback_=w,this.connectionFactory_=I,this.retry=k,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((L,V)=>{this.resolve_=L,this.reject_=V,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new IO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const f=y=>{const v=y.loaded,b=y.lengthComputable?y.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,b)};this.progressCallback_!==null&&d.addUploadProgressListener(f),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(f),this.pendingConnection_=null;const y=d.getErrorCode()===Oy.NO_ERROR,v=d.getStatus();if(!y||wBe(v,this.additionalRetryCodes_)&&this.retry){const w=d.getErrorCode()===Oy.ABORT;a(!1,new IO(!1,null,w));return}const b=this.successCodes_.indexOf(v)!==-1;a(!0,new IO(b,d))})},s=(a,l)=>{const d=this.resolve_,f=this.reject_,y=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(y,y.getResponse());bBe(v)?d(v):d()}catch(v){f(v)}else if(y!==null){const v=D4();v.serverResponse=y.getErrorText(),this.errorCallback_?f(this.errorCallback_(y,v)):f(v)}else if(l.canceled){const v=this.appDelete_?Lse():dBe();f(v)}else{const v=uBe();f(v)}};this.canceled_?s(!1,new IO(!1,null,!0)):this.backoffId_=vBe(t,s,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&SBe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class IO{constructor(t,s,a){this.wasSuccessCode=t,this.connection=s,this.canceled=!!a}}function RBe(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function IBe(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function ABe(n,t){t&&(n["X-Firebase-GMPID"]=t)}function PBe(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function OBe(n,t,s,a,l,d,f=!0){const y=Mse(n.urlParams),v=n.url+y,b=Object.assign({},n.headers);return ABe(b,t),RBe(b,s),IBe(b,d),PBe(b,a),new CBe(v,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kBe(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function NBe(...n){const t=kBe();if(t!==void 0){const s=new t;for(let a=0;a<n.length;a++)s.append(n[a]);return s.getBlob()}else{if(L4())return new Blob(n);throw new Ls(xs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function DBe(n,t,s){return n.webkitSlice?n.webkitSlice(t,s):n.mozSlice?n.mozSlice(t,s):n.slice?n.slice(t,s):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xBe(n){if(typeof atob>"u")throw _Be("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class sU{constructor(t,s){this.data=t,this.contentType=s||null}}function LBe(n,t){switch(n){case Hh.RAW:return new sU(Use(t));case Hh.BASE64:case Hh.BASE64URL:return new sU(Vse(n,t));case Hh.DATA_URL:return new sU(UBe(t),VBe(t))}throw D4()}function Use(n){const t=[];for(let s=0;s<n.length;s++){let a=n.charCodeAt(s);if(a<=127)t.push(a);else if(a<=2047)t.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(s<n.length-1&&(n.charCodeAt(s+1)&64512)===56320))t.push(239,191,189);else{const d=a,f=n.charCodeAt(++s);a=65536|(d&1023)<<10|f&1023,t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?t.push(239,191,189):t.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(t)}function MBe(n){let t;try{t=decodeURIComponent(n)}catch{throw dC(Hh.DATA_URL,"Malformed data URL.")}return Use(t)}function Vse(n,t){switch(n){case Hh.BASE64:{const l=t.indexOf("-")!==-1,d=t.indexOf("_")!==-1;if(l||d)throw dC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Hh.BASE64URL:{const l=t.indexOf("+")!==-1,d=t.indexOf("/")!==-1;if(l||d)throw dC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let s;try{s=xBe(t)}catch(l){throw l.message.includes("polyfill")?l:dC(n,"Invalid character found")}const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}class Fse{constructor(t){this.base64=!1,this.contentType=null;const s=t.match(/^data:([^,]+)?,/);if(s===null)throw dC(Hh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=s[1]||null;a!=null&&(this.base64=FBe(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=t.substring(t.indexOf(",")+1)}}function UBe(n){const t=new Fse(n);return t.base64?Vse(Hh.BASE64,t.rest):MBe(t.rest)}function VBe(n){return new Fse(n).contentType}function FBe(n,t){return n.length>=t.length?n.substring(n.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pg{constructor(t,s){let a=0,l="";RJ(t)?(this.data_=t,a=t.size,l=t.type):t instanceof ArrayBuffer?(s?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),a=this.data_.length):t instanceof Uint8Array&&(s?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),a=t.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(t,s){if(RJ(this.data_)){const a=this.data_,l=DBe(a,t,s);return l===null?null:new pg(l)}else{const a=new Uint8Array(this.data_.buffer,t,s-t);return new pg(a,!0)}}static getBlob(...t){if(L4()){const s=t.map(a=>a instanceof pg?a.data_:a);return new pg(NBe.apply(null,s))}else{const s=t.map(f=>x4(f)?LBe(Hh.RAW,f).data:f.data_);let a=0;s.forEach(f=>{a+=f.byteLength});const l=new Uint8Array(a);let d=0;return s.forEach(f=>{for(let y=0;y<f.length;y++)l[d++]=f[y]}),new pg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jse(n){let t;try{t=JSON.parse(n)}catch{return null}return TBe(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jBe(n){if(n.length===0)return null;const t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function BBe(n,t){const s=t.split("/").filter(a=>a.length>0).join("/");return n.length===0?s:n+"/"+s}function Bse(n){const t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WBe(n,t){return t}class yc{constructor(t,s,a,l){this.server=t,this.local=s||t,this.writable=!!a,this.xform=l||WBe}}let AO=null;function zBe(n){return!x4(n)||n.length<2?n:Bse(n)}function Wse(){if(AO)return AO;const n=[];n.push(new yc("bucket")),n.push(new yc("generation")),n.push(new yc("metageneration")),n.push(new yc("name","fullPath",!0));function t(d,f){return zBe(f)}const s=new yc("name");s.xform=t,n.push(s);function a(d,f){return f!==void 0?Number(f):f}const l=new yc("size");return l.xform=a,n.push(l),n.push(new yc("timeCreated")),n.push(new yc("updated")),n.push(new yc("md5Hash",null,!0)),n.push(new yc("cacheControl",null,!0)),n.push(new yc("contentDisposition",null,!0)),n.push(new yc("contentEncoding",null,!0)),n.push(new yc("contentLanguage",null,!0)),n.push(new yc("contentType",null,!0)),n.push(new yc("metadata","customMetadata",!0)),AO=n,AO}function GBe(n,t){function s(){const a=n.bucket,l=n.fullPath,d=new Fl(a,l);return t._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:s})}function HBe(n,t,s){const a={};a.type="file";const l=s.length;for(let d=0;d<l;d++){const f=s[d];a[f.local]=f.xform(a,t[f.server])}return GBe(a,n),a}function zse(n,t,s){const a=jse(t);return a===null?null:HBe(n,a,s)}function $Be(n,t,s,a){const l=jse(t);if(l===null||!x4(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const f=encodeURIComponent;return d.split(",").map(b=>{const w=n.bucket,I=n.fullPath,k="/b/"+f(w)+"/o/"+f(I),L=oN(k,s,a),V=Mse({alt:"media",token:b});return L+V})[0]}function KBe(n,t){const s={},a=t.length;for(let l=0;l<a;l++){const d=t[l];d.writable&&(s[d.server]=n[d.local])}return JSON.stringify(s)}class M4{constructor(t,s,a,l){this.url=t,this.method=s,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gse(n){if(!n)throw D4()}function qBe(n,t){function s(a,l){const d=zse(n,l,t);return Gse(d!==null),d}return s}function YBe(n,t){function s(a,l){const d=zse(n,l,t);return Gse(d!==null),$Be(d,l,n.host,n._protocol)}return s}function Hse(n){function t(s,a){let l;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?l=cBe():l=aBe():s.getStatus()===402?l=oBe(n.bucket):s.getStatus()===403?l=lBe(n.path):l=a,l.status=s.getStatus(),l.serverResponse=a.serverResponse,l}return t}function $se(n){const t=Hse(n);function s(a,l){let d=t(a,l);return a.getStatus()===404&&(d=sBe(n.path)),d.serverResponse=l.serverResponse,d}return s}function XBe(n,t,s){const a=t.fullServerUrl(),l=oN(a,n.host,n._protocol),d="GET",f=n.maxOperationRetryTime,y=new M4(l,d,YBe(n,s),f);return y.errorHandler=$se(t),y}function JBe(n,t){const s=t.fullServerUrl(),a=oN(s,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function f(v,b){}const y=new M4(a,l,f,d);return y.successCodes=[200,204],y.errorHandler=$se(t),y}function QBe(n,t){return n&&n.contentType||t&&t.type()||"application/octet-stream"}function ZBe(n,t,s){const a=Object.assign({},s);return a.fullPath=n.path,a.size=t.size(),a.contentType||(a.contentType=QBe(null,t)),a}function e6e(n,t,s,a,l){const d=t.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function y(){let ie="";for(let ce=0;ce<2;ce++)ie=ie+Math.random().toString().slice(2);return ie}const v=y();f["Content-Type"]="multipart/related; boundary="+v;const b=ZBe(t,a,l),w=KBe(b,s),I="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+v+`\r
Content-Type: `+b.contentType+`\r
\r
`,k=`\r
--`+v+"--",L=pg.getBlob(I,a,k);if(L===null)throw mBe();const V={name:b.fullPath},B=oN(d,n.host,n._protocol),W="POST",Q=n.maxUploadRetryTime,$=new M4(B,W,qBe(n,s),Q);return $.urlParams=V,$.headers=f,$.body=L.uploadData(),$.errorHandler=Hse(t),$}class t6e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Oy.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Oy.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Oy.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,s,a,l){if(this.sent_)throw gw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(s,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw gw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw gw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw gw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw gw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class n6e extends t6e{initXhr(){this.xhr_.responseType="text"}}function U4(){return new n6e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zy{constructor(t,s){this._service=t,s instanceof Fl?this._location=s:this._location=Fl.makeFromUrl(s,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,s){return new zy(t,s)}get root(){const t=new Fl(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Bse(this._location.path)}get storage(){return this._service}get parent(){const t=jBe(this._location.path);if(t===null)return null;const s=new Fl(this._location.bucket,t);return new zy(this._service,s)}_throwIfRoot(t){if(this._location.path==="")throw yBe(t)}}function r6e(n,t,s){n._throwIfRoot("uploadBytes");const a=e6e(n.storage,n._location,Wse(),new pg(t,!0),s);return n.storage.makeRequestWithTokens(a,U4).then(l=>({metadata:l,ref:n}))}function i6e(n){n._throwIfRoot("getDownloadURL");const t=XBe(n.storage,n._location,Wse());return n.storage.makeRequestWithTokens(t,U4).then(s=>{if(s===null)throw gBe();return s})}function s6e(n){n._throwIfRoot("deleteObject");const t=JBe(n.storage,n._location);return n.storage.makeRequestWithTokens(t,U4)}function o6e(n,t){const s=BBe(n._location.path,t),a=new Fl(n._location.bucket,s);return new zy(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a6e(n){return/^[A-Za-z]+:\/\//.test(n)}function c6e(n,t){return new zy(n,t)}function Kse(n,t){if(n instanceof V4){const s=n;if(s._bucket==null)throw fBe();const a=new zy(s,s._bucket);return t!=null?Kse(a,t):a}else return t!==void 0?o6e(n,t):n}function l6e(n,t){if(t&&a6e(t)){if(n instanceof V4)return c6e(n,t);throw jV("To use ref(service, url), the first argument must be a Storage instance.")}else return Kse(n,t)}function AJ(n,t){const s=t==null?void 0:t[xse];return s==null?null:Fl.makeFromBucketSpec(s,n)}function u6e(n,t,s,a={}){n.host=`${t}:${s}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:sre(l,n.app.options.projectId))}class V4{constructor(t,s,a,l,d){this.app=t,this._authProvider=s,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=Dse,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=rBe,this._maxUploadRetryTime=iBe,this._requests=new Set,l!=null?this._bucket=Fl.makeFromBucketSpec(l,this._host):this._bucket=AJ(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Fl.makeFromBucketSpec(this._url,t):this._bucket=AJ(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){IJ("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){IJ("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const s=await t.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(Ml(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new zy(this,t)}_makeRequest(t,s,a,l,d=!0){if(this._deleted)return new EBe(Lse());{const f=OBe(t,this._appId,a,l,s,this._firebaseVersion,d);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(t,s){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,s,a,l).getPromise()}}const PJ="@firebase/storage",OJ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qse="storage";function aN(n,t,s){return n=ls(n),r6e(n,t,s)}function pR(n){return n=ls(n),i6e(n)}function cN(n){return n=ls(n),s6e(n)}function Kf(n,t){return n=ls(n),l6e(n,t)}function qf(n=Fj(),t){n=ls(n);const a=M1(n,qse).getImmediate({identifier:t}),l=nre("storage");return l&&d6e(a,...l),a}function d6e(n,t,s,a={}){u6e(n,t,s,a)}function h6e(n,{instanceIdentifier:t}){const s=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new V4(s,a,l,t,$y)}function p6e(){Uy(new wg(qse,h6e,"PUBLIC").setMultipleInstances(!0)),ep(PJ,OJ,""),ep(PJ,OJ,"esm2017")}p6e();const pk=async n=>{const t=qf(),s=Kf(t,n);try{return await pR(s)}catch(a){throw J.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let Gy={};const Nf=async n=>{try{const t=Hr(vr,"spaces",n),s=await jo(t);if(s.exists()){let a=s.data();const l=a.name,d=a.description;if(a.webglBuildId){const f=Hr(vr,"webglBuilds",a.webglBuildId),y=await jo(f);if(y.exists()){const v=y.data();a={...a,...v,name:l||v.name,description:d||v.description}}else J.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await f6e(a),a=m6e(a),console.log("Space data:",a),J.log(`spacesFirestore: Caching space data for: ${n}`),Gy[n]=a,a}else return J.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(t){throw J.error("spacesFirestore: Error fetching item data:",t),t}},f6e=async n=>{const s=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await pk(l))});return await Promise.all(s),n},m6e=n=>{const{gsUrlCode:t,gsUrlData:s,gsUrlFramework:a,gsUrlLoader:l,...d}=n;return{...d,codeUrl:t,dataUrl:s,frameworkUrl:a,loaderUrl:l}};let oU={};const Yse=async n=>{J.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(oU[n])return J.log("spacesFirestore: Returning cached videos for space:",n),oU[n];const t=kg(vr,`spaces/${n}/videos`),s=await Wy(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),oU[n]=a,a}catch(t){throw J.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},g6e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and logoFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=qf(),a=Date.now(),l=t.name.split(".").pop(),d=`logo_${a}.${l}`,f=Kf(s,`spaces/${n}/logo/${d}`);J.log(`Uploading logo for space ${n}`);const y=await aN(f,t),v=await pR(y.ref),b=Hr(vr,"spaces",n);return await So(b,{logoUrl:v,logoGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),J.log(`Successfully uploaded logo for space ${n}`),v}catch(s){throw J.error("Error uploading space logo:",s),s}},_6e=async n=>{try{const t=Hr(vr,"spaces",n),s=await jo(t);if(!s.exists())return J.warn(`No space found with ID: ${n}`),!1;const a=s.data();if(a.logoGsUrl){const l=qf(),d=Kf(l,a.logoGsUrl);try{await cN(d),J.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(f){J.warn(`Could not delete logo file from storage: ${f.message}`)}}return await So(t,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),J.log(`Successfully removed logo for space ${n}`),!0}catch(t){throw J.error("Error deleting space logo:",t),t}},y6e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=qf(),a=Date.now(),l=t.name.split(".").pop(),d=`background_${a}.${l}`,f=Kf(s,`spaces/${n}/background/${d}`);J.log(`Uploading background for space ${n}`);const y=await aN(f,t),v=await pR(y.ref),b=Hr(vr,"spaces",n);return await So(b,{backgroundUrl:v,backgroundGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${y.ref.bucket}/${y.ref.fullPath}`,updatedAt:new Date().toISOString()}),J.log(`Successfully uploaded background for space ${n}`),v}catch(s){throw J.error("Error uploading space background:",s),s}},E6e=async n=>{try{const t=Hr(vr,"spaces",n),s=await jo(t);if(!s.exists())return J.warn(`No space found with ID: ${n}`),!1;const a=s.data();if(a.backgroundGsUrl){const l=qf(),d=Kf(l,a.backgroundGsUrl);try{await cN(d),J.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(f){J.warn(`Could not delete background file from storage: ${f.message}`)}}return await So(t,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),J.log(`Successfully removed background references for space ${n}`),!0}catch(t){throw J.error("Error deleting space background:",t),t}},v6e=async(n,t)=>{try{J.log(`spacesFirestore: Updating settings for space: ${n}`,t);const s=Hr(vr,"spaces",n),a=await jo(s);if(!a.exists())throw new Error(`Space with ID ${n} not found`);const l=a.data(),d={...t,accessibleToAllUsers:t.accessibleToAllUsers!==void 0?t.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await So(s,d),Gy[n]&&delete Gy[n],J.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(s){throw J.error(`spacesFirestore: Error updating settings for space: ${n}`,s),s}},S6e=async(n,t)=>{try{J.log(`spacesFirestore: Setting accessibleToAllUsers=${t} for space: ${n}`);const s=Hr(vr,"spaces",n);if(!(await jo(s)).exists())throw new Error(`Space with ID ${n} not found`);await So(s,{accessibleToAllUsers:t,updatedAt:new Date().toISOString()}),Gy[n]&&delete Gy[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:t}})),J.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(s){throw J.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,s),s}},BV=async(n,t)=>{try{J.log(`spacesFirestore: Updating HLS stream for space: ${n}`,t);const s=Hr(vr,"spaces",n);if(!(await jo(s)).exists())throw new Error(`Space with ID ${n} not found`);const{streamUrl:l,playerIndex:d="0",enabled:f=!0,rtmpUrl:y="",streamKey:v=""}=t,b={HLSStreamURL:{streamUrl:l,playerIndex:d,enabled:f,rtmpUrl:y,streamKey:v,updatedAt:new Date().toISOString()},updatedAt:new Date().toISOString()};return await So(s,b),Gy[n]&&delete Gy[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceHLSStreamUpdated",{detail:{spaceId:n,streamUrl:l,playerIndex:d,enabled:f,rtmpUrl:y,streamKey:v}})),J.log(`spacesFirestore: Successfully updated HLS stream for space: ${n}`),!0}catch(s){throw J.error(`spacesFirestore: Error updating HLS stream for space: ${n}`,s),s}},Xse=async n=>{try{J.log(`spacesFirestore: Getting HLS stream for space: ${n}`);const t=Hr(vr,"spaces",n),s=await jo(t);if(!s.exists())return J.warn(`spacesFirestore: Space with ID ${n} not found`),null;const a=s.data();return a.HLSStreamURL?(J.log(`spacesFirestore: Found HLS stream for space: ${n}`,a.HLSStreamURL),a.HLSStreamURL):(J.log(`spacesFirestore: No HLS stream found for space: ${n}`),null)}catch(t){throw J.error(`spacesFirestore: Error getting HLS stream for space: ${n}`,t),t}},b6e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and videoFile");if(!t.type.startsWith("video/"))throw new Error("File must be a video");const s=5*1024*1024;if(t.size>s)throw new Error("Video file must be smaller than 5MB");const a=qf(),l=Date.now(),d=t.name.split(".").pop(),f=`video_bg_${l}.${d}`,y=Kf(a,`spaces/${n}/video_background/${f}`);J.log(`Uploading video background for space ${n}`);const v=await aN(y,t),b=await pR(v.ref),w=Hr(vr,"spaces",n);return await So(w,{videoBackgroundUrl:b,videoBackgroundGsUrl:`gs://${v.ref.bucket}/${v.ref.fullPath}`,videoBackgroundFileName:f,updatedAt:new Date().toISOString()}),J.log(`Successfully uploaded video background for space ${n}`),b}catch(s){throw J.error("Error uploading space video background:",s),s}},T6e=async n=>{try{if(!n)throw new Error("Missing required parameter: spaceId");const t=Hr(vr,"spaces",n),s=await jo(t);if(!s.exists())throw new Error(`Space with ID ${n} not found`);const a=s.data();if(!a.videoBackgroundGsUrl){J.log(`No video background found for space ${n}`);return}const l=qf(),f=a.videoBackgroundGsUrl.replace("gs://",""),[y,...v]=f.split("/"),b=v.join("/"),w=Kf(l,b);try{await cN(w),J.log(`Deleted video background file from storage for space ${n}`)}catch(I){J.error(`Failed to delete video background file, it may not exist: ${I.message}`)}await So(t,{videoBackgroundUrl:null,videoBackgroundGsUrl:null,videoBackgroundFileName:null,updatedAt:new Date().toISOString()}),J.log(`Successfully removed video background for space ${n}`)}catch(t){throw J.error("Error deleting space video background:",t),t}},Cc=D.createContext(null),w6e=D.createContext(null),C6e=({children:n})=>{const[t,s]=D.useState(null),a=D.useRef(null),[l,d]=D.useState(!0),[f,y]=D.useState(!1),v=j1(),b=ne=>ne?ne.Nickname?ne.Nickname:`${ne.firstName} ${ne.lastName}`:"Anon";D.useEffect(()=>{const ne=_Fe(v,async de=>{if(J.log("UserProvider: Firebase onAuthStateChanged() fired"),de)try{const Y=await Fu(de.uid),X=b(Y),Z={uid:de.uid,email:de.email,emailVerified:de.emailVerified,...Y,displayName:X};J.log(`UserProvider: User authenticated: ${de.uid}`),s(Z),a.current=Z,L(Z)}catch(Y){J.error("UserProvider: Error fetching user profile data:",Y)}else s(null),a.current=null;d(!1)});return()=>{ne&&ne()}},[]);const w=async(ne,de,Y)=>{try{y(!0),J.log("UserProvider: Starting registration process"),J.log("UserProvider: Registration includes fields:",Object.keys(Y||{}).join(", "));const X={...Y},Z=["firstName","lastName","username","companyName","linkedInProfile"],se=Z.filter(ve=>!X[ve]);se.length>0&&J.warn(`UserProvider: Registration missing fields: ${se.join(", ")}`);const me=X.firstName&&X.lastName?`${X.firstName}${X.lastName.charAt(0).toUpperCase()}`:"";J.log("UserProvider: Generated default nickname for registration");const pe={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:X.Nickname||me,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...X};J.log("UserProvider: Prepared registration data with fields:",Object.keys(pe).join(", "));const ue=await Y5e(ne,de,pe);J.log("UserProvider: Registration successful, received user data");const Le=Z.filter(ve=>!ue[ve]);Le.length>0&&J.warn(`UserProvider: Returned user data missing fields: ${Le.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(ve=>{ue[ve]||(J.warn(`UserProvider: ${ve} is missing in returned data, using original value`),ue[ve]=pe[ve])});const $e={uid:ue.uid,email:ue.email,...ue,displayName:b(ue)};return J.log("UserProvider: Created user object with fields:",Object.keys($e).join(", ")),s($e),a.current=$e,J.log("UserProvider: User registered successfully with groups:",pe.groups),await new Promise(ve=>setTimeout(ve,2e3)),y(!1),$e}catch(X){throw y(!1),J.error("UserProvider: Error during registration:",X),X}},I=async(ne,de,Y)=>{try{if(J.log("UserProvider: Signing in user"),!Y)throw new Error("CAPTCHA verification is required");const Z=(await fFe(v,ne,de)).user;return J.log("UserProvider: User signed in successfully:",Z.email),Z}catch(X){throw J.error("UserProvider: Error signing in:",X),X}},k=async()=>{try{await yFe(v),s(null),J.log("UserProvider: User signed out.")}catch(ne){throw J.error("UserProvider: Error signing out:",ne),ne}},L=()=>{const ne=a.current;if(ne){const de=V(ne);J.log("UserProvider: sendUserToUnity() using the eventBus",de),xd.publish(Dd.sendUserToUnity,de)}else J.log("UserProvider: No current user to send to Unity.")},V=ne=>{const de={};return[...tBe,"uid"].forEach(X=>{ne.hasOwnProperty(X)&&(de[X]=ne[X])}),de},B=async ne=>!t||!t.uid?!1:await N4(t.uid,ne),W=async ne=>{if(!t||!t.uid)return!1;try{const de=await Nf(ne);if(de.usersAllowed.includes(t.uid)||de.userAdmin.includes(t.uid)||de.usersModerators.includes(t.uid))return!0;if(t.groups&&Array.isArray(t.groups)){const X=`space_${ne}_owners`,Z=`space_${ne}_hosts`;if(t.groups.includes(X)||t.groups.includes(Z))return J.log(`UserProvider: User ${t.uid} has access to space ${ne} as owner/host`),!0}return de.accessibleToAllUsers===!0&&t.groups?t.groups.includes("users"):!1}catch(de){return J.error("UserProvider: Error verifying user access to space:",de),!1}},Q=async ne=>{if(!t||!t.uid)return!1;try{return(await Nf(ne)).userAdmin.includes(t.uid)}catch(de){return J.error("UserProvider: Error verifying user admin status for space:",de),!1}},$=async ne=>{if(!t||!t.uid)return!1;try{return(await Nf(ne)).usersModerators.includes(t.uid)}catch(de){return J.error("UserProvider: Error verifying user moderator status for space:",de),!1}},ie=async()=>{try{const ne=v.currentUser;return ne&&!ne.emailVerified?(await Ure(ne),J.log("UserProvider: Verification email resent to:",ne.email),!0):!1}catch(ne){throw J.error("UserProvider: Error resending verification email:",ne),ne}},ce=async()=>{try{const ne=v.currentUser;if(!ne)return J.warn("UserProvider: updateUser called but no current user exists"),null;J.log("UserProvider: Updating user data from Firestore");const de=await Fu(ne.uid);if(!de)return J.error("UserProvider: Failed to fetch updated user profile"),null;const Y=b(de),X={uid:ne.uid,email:ne.email,emailVerified:ne.emailVerified,...de,displayName:Y};return J.log("UserProvider: User data updated with fields:",Object.keys(X).join(", ")),s(X),a.current=X,L(X),X}catch(ne){throw J.error("UserProvider: Error updating user data:",ne),ne}};return C.jsx(w6e.Provider,{value:{registrationInProgress:f},children:C.jsx(Cc.Provider,{value:{user:t,loading:l,register:w,signIn:I,signOut:k,sendUserToUnity:L,isUserInGroup:B,userHasAccessToSpace:W,userIsAdminOfSpace:Q,userIsModeratorOfSpace:$,resendVerificationEmail:ie,updateUser:ce},children:n})})},Jse=D.createContext(),Vd=()=>D.useContext(Jse),R6e=({children:n})=>{const[t,s]=D.useState(!1),a=D.useRef(null),[l,d]=D.useState(!1);D.useEffect(()=>{const v=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const f=D.useCallback(v=>{a.current=v},[]),y=D.useCallback(()=>{const v=a.current;if(!v)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const w=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(w.webkitEnterFullscreen)try{w.webkitEnterFullscreen(),s(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(w.webkitRequestFullscreen){w.webkitRequestFullscreen(),s(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),s(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),s(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{s(!1)}).catch(w=>console.error("Error exiting fullscreen:",w)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),s(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),s(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),s(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{s(!0)}).catch(w=>console.error("Error entering fullscreen:",w)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),s(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),s(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),s(!0))}catch(w){console.error("Fullscreen error:",w)}},[l]);return D.useEffect(()=>{const v=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s(!!b)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),C.jsx(Jse.Provider,{value:{isFullscreen:t,toggleFullscreen:y,fullscreenRef:a,setFullscreenRef:f,isMobile:l},children:C.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})};var aU={},_w={},yw={},kJ;function I6e(){if(kJ)return yw;kJ=1,Object.defineProperty(yw,"__esModule",{value:!0}),yw.useUnityCanvasId=void 0;var n=Mu(),t=0,s="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[s,++t].join("-")},[]);return d};return yw.useUnityCanvasId=a,yw}var df={},Ew={},NJ;function Qse(){if(NJ)return Ew;NJ=1,Object.defineProperty(Ew,"__esModule",{value:!0}),Ew.UnityLoaderStatus=void 0;var n;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(n||(Ew.UnityLoaderStatus=n={})),Ew}var vw={},DJ;function F4(){return DJ||(DJ=1,Object.defineProperty(vw,"__esModule",{value:!0}),vw.isBrowserEnvironment=void 0,vw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),vw}var xJ;function A6e(){if(xJ)return df;xJ=1;var n=df&&df.__awaiter||function(f,y,v,b){function w(I){return I instanceof v?I:new v(function(k){k(I)})}return new(v||(v=Promise))(function(I,k){function L(W){try{B(b.next(W))}catch(Q){k(Q)}}function V(W){try{B(b.throw(W))}catch(Q){k(Q)}}function B(W){W.done?I(W.value):w(W.value).then(L,V)}B((b=b.apply(f,y||[])).next())})},t=df&&df.__generator||function(f,y){var v={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},b,w,I,k=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return k.next=L(0),k.throw=L(1),k.return=L(2),typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function L(B){return function(W){return V([B,W])}}function V(B){if(b)throw new TypeError("Generator is already executing.");for(;k&&(k=0,B[0]&&(v=0)),v;)try{if(b=1,w&&(I=B[0]&2?w.return:B[0]?w.throw||((I=w.return)&&I.call(w),0):w.next)&&!(I=I.call(w,B[1])).done)return I;switch(w=0,I&&(B=[B[0]&2,I.value]),B[0]){case 0:case 1:I=B;break;case 4:return v.label++,{value:B[1],done:!1};case 5:v.label++,w=B[1],B=[0];continue;case 7:B=v.ops.pop(),v.trys.pop();continue;default:if(I=v.trys,!(I=I.length>0&&I[I.length-1])&&(B[0]===6||B[0]===2)){v=0;continue}if(B[0]===3&&(!I||B[1]>I[0]&&B[1]<I[3])){v.label=B[1];break}if(B[0]===6&&v.label<I[1]){v.label=I[1],I=B;break}if(I&&v.label<I[2]){v.label=I[2],v.ops.push(B);break}I[2]&&v.ops.pop(),v.trys.pop();continue}B=y.call(f,v)}catch(W){B=[6,W],w=0}finally{b=I=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(df,"__esModule",{value:!0}),df.useUnityInstance=void 0;var s=Mu(),a=Qse(),l=F4(),d=function(f,y,v,b){(0,s.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var w,I;return t(this,function(k){switch(k.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==a.UnityLoaderStatus.Loaded||y===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];k.label=1;case 1:return k.trys.push([1,3,,4]),[4,window.createUnityInstance(y,v,b.setLoadingProgression)];case 2:return w=k.sent(),b.setUnityInstance(w),b.setInitialisationError(null),[3,4];case 3:return I=k.sent(),b.setUnityInstance(null),b.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[f,y,v,b])};return df.useUnityInstance=d,df}var Sw={},LJ;function P6e(){if(LJ)return Sw;LJ=1,Object.defineProperty(Sw,"__esModule",{value:!0}),Sw.useUnityArguments=void 0;var n=Mu(),t=function(s){return(0,n.useMemo)(function(){return{dataUrl:s.unityProvider.unityConfig.dataUrl,frameworkUrl:s.unityProvider.unityConfig.frameworkUrl,codeUrl:s.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:s.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:s.unityProvider.unityConfig.memoryUrl,symbolsUrl:s.unityProvider.unityConfig.symbolsUrl,workerUrl:s.unityProvider.unityConfig.workerUrl,companyName:s.unityProvider.unityConfig.companyName,productName:s.unityProvider.unityConfig.productName,productVersion:s.unityProvider.unityConfig.productVersion,webglContextAttributes:s.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:s.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:s.devicePixelRatio||1,autoSyncPersistentDataPath:s.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof s.matchWebGLToCanvasSize=="boolean"?s.matchWebGLToCanvasSize:!0,disabledCanvasEvents:s.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return Sw.useUnityArguments=t,Sw}var bw={},MJ;function O6e(){if(MJ)return bw;MJ=1,Object.defineProperty(bw,"__esModule",{value:!0}),bw.useUnityLoader=void 0;var n=Mu(),t=F4(),s=Qse(),a=function(l){var d=(0,n.useState)(s.UnityLoaderStatus.Loading),f=d[0],y=d[1];return(0,n.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){y(s.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):y(v.getAttribute("data-status")==="loaded"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error);var b=function(w){return y(w.type==="load"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error)};return v.addEventListener("load",b),v.addEventListener("error",b),function(){v!==null&&(v.removeEventListener("load",b),v.removeEventListener("error",b),window.document.body.removeChild(v))}}},[l.loaderUrl]),f};return bw.useUnityLoader=a,bw}var UJ;function k6e(){if(UJ)return _w;UJ=1,Object.defineProperty(_w,"__esModule",{value:!0}),_w.Unity=void 0;var n=Mu(),t=Mu(),s=I6e(),a=A6e(),l=P6e(),d=O6e(),f=(0,t.forwardRef)(function(y,v){var b=(0,t.useRef)(null),w=(0,s.useUnityCanvasId)(y),I=(0,l.useUnityArguments)(y),k=(0,d.useUnityLoader)(y.unityProvider.unityConfig);return(0,a.useUnityInstance)(k,b.current,I,y.unityProvider),(0,n.useImperativeHandle)(v,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:w,style:y.style,className:y.className,tabIndex:y.tabIndex})});return _w.Unity=f,_w}var hf={},Tw={},VJ;function Zse(){if(VJ)return Tw;VJ=1,Object.defineProperty(Tw,"__esModule",{value:!0}),Tw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return Tw.errorMessages=n,Tw}var ay={},FJ;function N6e(){if(FJ)return ay;FJ=1;var n=ay&&ay.__spreadArray||function(y,v,b){if(b||arguments.length===2)for(var w=0,I=v.length,k;w<I;w++)(k||!(w in v))&&(k||(k=Array.prototype.slice.call(v,0,w)),k[w]=v[w]);return y.concat(k||Array.prototype.slice.call(v))};Object.defineProperty(ay,"__esModule",{value:!0}),ay.useEventSystem=void 0;var t=Mu(),s=Zse(),a=F4(),l=[],d=function(y){for(var v=[],b=1;b<arguments.length;b++)v[b-1]=arguments[b];var w=void 0;return l.forEach(function(I){w=I.apply(void 0,n([y],v,!1))}),w};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var f=function(){var y=(0,t.useRef)([]),v=(0,t.useCallback)(function(I,k){y.current=n(n([],y.current,!0),[{eventName:I,callback:k}],!1)},[y]),b=(0,t.useCallback)(function(I,k){y.current=y.current.filter(function(L){return L.eventName!==I&&L.callback!==k})},[y]),w=(0,t.useCallback)(function(I){for(var k=[],L=1;L<arguments.length;L++)k[L-1]=arguments[L];var V=y.current.find(function(B){return B.eventName===I});if(typeof V>"u"){console.warn(s.errorMessages.noEventListener,{eventName:I});return}return V.callback.apply(V,k)},[y]);return(0,t.useEffect)(function(){return l.push(w),function(){l.splice(l.indexOf(w),1)}},[w]),{addEventListener:v,removeEventListener:b}};return ay.useEventSystem=f,ay}var ww={},jJ;function D6e(){if(jJ)return ww;jJ=1,Object.defineProperty(ww,"__esModule",{value:!0}),ww.useNullableState=void 0;var n=Mu(),t=function(s){return(0,n.useState)(s||null)};return ww.useNullableState=t,ww}var BJ;function x6e(){if(BJ)return hf;BJ=1;var n=hf&&hf.__awaiter||function(y,v,b,w){function I(k){return k instanceof b?k:new b(function(L){L(k)})}return new(b||(b=Promise))(function(k,L){function V(Q){try{W(w.next(Q))}catch($){L($)}}function B(Q){try{W(w.throw(Q))}catch($){L($)}}function W(Q){Q.done?k(Q.value):I(Q.value).then(V,B)}W((w=w.apply(y,v||[])).next())})},t=hf&&hf.__generator||function(y,v){var b={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},w,I,k,L=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return L.next=V(0),L.throw=V(1),L.return=V(2),typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function V(W){return function(Q){return B([W,Q])}}function B(W){if(w)throw new TypeError("Generator is already executing.");for(;L&&(L=0,W[0]&&(b=0)),b;)try{if(w=1,I&&(k=W[0]&2?I.return:W[0]?I.throw||((k=I.return)&&k.call(I),0):I.next)&&!(k=k.call(I,W[1])).done)return k;switch(I=0,k&&(W=[W[0]&2,k.value]),W[0]){case 0:case 1:k=W;break;case 4:return b.label++,{value:W[1],done:!1};case 5:b.label++,I=W[1],W=[0];continue;case 7:W=b.ops.pop(),b.trys.pop();continue;default:if(k=b.trys,!(k=k.length>0&&k[k.length-1])&&(W[0]===6||W[0]===2)){b=0;continue}if(W[0]===3&&(!k||W[1]>k[0]&&W[1]<k[3])){b.label=W[1];break}if(W[0]===6&&b.label<k[1]){b.label=k[1],k=W;break}if(k&&b.label<k[2]){b.label=k[2],b.ops.push(W);break}k[2]&&b.ops.pop(),b.trys.pop();continue}W=v.call(y,b)}catch(Q){W=[6,Q],I=0}finally{w=k=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}};Object.defineProperty(hf,"__esModule",{value:!0}),hf.useUnityContext=void 0;var s=Mu(),a=Zse(),l=N6e(),d=D6e(),f=function(y){var v=(0,d.useNullableState)(),b=v[0],w=v[1],I=(0,s.useState)(0),k=I[0],L=I[1],V=(0,s.useState)(!1),B=V[0],W=V[1],Q=(0,d.useNullableState)(),$=Q[0],ie=Q[1],ce=(0,l.useEventSystem)(),ne=(0,s.useRef)({setLoadingProgression:L,setInitialisationError:ie,setUnityInstance:w,setIsLoaded:W,unityConfig:y}),de=(0,s.useCallback)(function(pe){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(pe===!0?1:0)},[b]),Y=(0,s.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),X=(0,s.useCallback)(function(pe,ue,Le){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(pe,ue,Le)},[b]),Z=(0,s.useCallback)(function(pe,ue){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(pe,ue)},[b]),se=(0,s.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),me=(0,s.useCallback)(function(){return n(void 0,void 0,void 0,function(){var pe;return t(this,function(ue){switch(ue.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(pe=b.Module.canvas,document.body.appendChild(pe),pe.style.display="none",[4,se()]);case 1:return ue.sent(),pe.remove(),[2]}})})},[b]);return(0,s.useEffect)(function(){W(k===1)},[k]),{unityProvider:ne.current,loadingProgression:k,initialisationError:$,isLoaded:B,UNSAFE__unityInstance:b,requestFullscreen:de,requestPointerLock:Y,sendMessage:X,takeScreenshot:Z,unload:se,UNSAFE__detachAndUnloadImmediate:me,addEventListener:ce.addEventListener,removeEventListener:ce.removeEventListener}};return hf.useUnityContext=f,hf}var WJ;function L6e(){return WJ||(WJ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var t=k6e();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return t.Unity}});var s=x6e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return s.useUnityContext}})}(aU)),aU}var eoe=L6e();const Ad="[UnityProvider]",WV=D.createContext(),M6e=({spaceID:n,children:t,loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:f,showLoginButton:y,showDisruptiveLogo:v})=>{J.log(`${Ad} Initializing with spaceID:`,n),J.log(`${Ad} Unity URLs:`,{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:w,isLoaded:I,sendMessage:k,addEventListener:L,removeEventListener:V,error:B}=eoe.useUnityContext({loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d}),W={unityProvider:b,loadingProgression:w,isLoaded:I,sendMessage:k,addEventListener:L,removeEventListener:V,error:B,spaceID:n},Q=D.useRef(null),$=D.useRef(Date.now());D.useEffect(()=>{const de=()=>{document.hidden?(J.log(`${Ad} Page hidden, starting keep-alive`),ie()):(J.log(`${Ad} Page visible, stopping keep-alive`),ce())};return document.addEventListener("visibilitychange",de),()=>{document.removeEventListener("visibilitychange",de),ce()}},[]),D.useEffect(()=>{const de=()=>{$.current=Date.now(),document.hidden&&k("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",de),window.addEventListener("keydown",de),window.addEventListener("touchstart",de),()=>{window.removeEventListener("mousemove",de),window.removeEventListener("keydown",de),window.removeEventListener("touchstart",de)}},[k]);const ie=()=>{Q.current||(Q.current=setInterval(()=>{I&&document.hidden&&(k("WebGLInputManager","KeepAlive"),J.debug(`${Ad} Sent keep-alive message`))},1e4))},ce=()=>{Q.current&&(clearInterval(Q.current),Q.current=null)};D.useEffect(()=>(J.log(`${Ad} Component mounted`),()=>{J.log(`${Ad} Component unmounting`),ce()}),[]),D.useEffect(()=>{J.log(`${Ad} Loading progress:`,w)},[w]),D.useEffect(()=>{I&&(J.log(`${Ad} Unity instance loaded for:`,n),document.hidden&&ie())},[I,n]),D.useEffect(()=>{B&&J.error(`${Ad} Unity error:`,B)},[B]),J.log(`${Ad} Rendering provider with instance:`,W),D.useEffect(()=>{J.log("UnityProvider: Unity build URLs:",{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d})},[s,a,l,d]);const ne=[];if(s||ne.push("loaderUrl"),a||ne.push("dataUrl"),l||ne.push("frameworkUrl"),d||ne.push("codeUrl"),ne.length>0)return J.error(`UnityProvider: Missing required Unity build URLs: ${ne.join(", ")}`),C.jsx(WV.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${ne.join(", ")}`),spaceID:n},children:t});try{return D.useEffect(()=>{J.log("UnityProvider: Unity context created:",b),b?J.log("UnityProvider: Unity provider is available"):J.error("UnityProvider: Unity provider is not available"),I?J.log("UnityProvider: Unity is loaded"):J.log("UnityProvider: Unity is not loaded yet")},[b,I]),C.jsx(WV.Provider,{value:W,children:t})}catch(de){return J.error("UnityProvider: Error creating Unity context:",de),C.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[C.jsx("h3",{children:"Unity Error"}),C.jsxs("p",{children:["Error creating Unity context: ",de.message]}),C.jsx("p",{children:"Please check the console for more details."})]})}},wa=()=>D.useContext(WV),dp=()=>{const{sendMessage:n,isLoaded:t}=wa(),s=D.useRef([]),a=D.useCallback(()=>{if(t)for(;s.current.length>0;){const{eventName:d,data:f}=s.current.shift();J.log("useSendUnityEvent: Processing queued event to Unity:",d,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(f)}))}catch(y){J.error("useSendUnityEvent: Error sending event to Unity:",y),s.current.unshift({eventName:d,data:f});break}}},[n,t]);return D.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),D.useCallback((d,f)=>{J.log("useSendUnityEvent: Queuing event for Unity:",d),s.current.push({eventName:d,data:f}),a()},[a])},hp=()=>{const{addEventListener:n,removeEventListener:t}=wa();return D.useCallback((s,a)=>{const l=d=>{J.log(s+" unity message received.");let f=null;if(d)try{f=JSON.parse(d)}catch(y){J.warn("Failed to parse JSON data from Unity message:",y)}a(f)};return n(s,l),()=>{t(s,l)}},[n,t])},toe=()=>{const[n,t]=D.useState({}),[s,a]=D.useState(!1),[l,d]=D.useState(null),[f,y]=D.useState(0),v=dp(),b=hp(),{spaceID:w,sendMessage:I,isLoaded:k}=wa(),L=D.useCallback((Q,$)=>{if(!Q)return;J.log(`useHLSStream: Sending stream URL to Unity: ${Q} for player ${$}`);const ie={identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:Q};if(v("SetHLSStream",ie),k&&I)try{J.log("useHLSStream: Sending with ReactIncomingEvent approach"),I("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(ie)})),J.log("useHLSStream: Sending with direct HLSStream approach"),I("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:Q})),J.log("useHLSStream: Sending with most direct approach possible"),I("LiveProjector","SetStreamUrl",Q),I("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:$.toString(),Url:Q}))}catch(ce){J.error("useHLSStream: Error with direct message:",ce)}else J.warn("useHLSStream: Unity not loaded, could not send direct message")},[v,I,k]);D.useEffect(()=>{w&&V(w)},[w]);const V=async Q=>{try{if(!Q){J.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}a(!0),J.log(`useHLSStream: Loading stream from Firebase for space ${Q}`);const $=await Xse(Q);if($&&$.streamUrl)if(J.log(`useHLSStream: Loaded stream data from Firebase for space ${Q}`,$),d($),k)J.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{L($.streamUrl,$.playerIndex||"0")},500),setTimeout(()=>{J.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),L($.streamUrl,$.playerIndex||"0")},2e3);else{J.warn("useHLSStream: Unity is not loaded yet, will try again later");const ie=setInterval(()=>{k&&(J.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),L($.streamUrl,$.playerIndex||"0"),clearInterval(ie))},1e3);setTimeout(()=>{clearInterval(ie)},3e4)}else J.log(`useHLSStream: No saved stream found for space ${Q}`),d(null)}catch($){J.error(`useHLSStream: Error loading stream from Firebase for space ${Q}`,$)}finally{a(!1)}},B=D.useCallback(async()=>{w&&(J.log(`useHLSStream: Forcing reload of stream data for space ${w}`),y(Q=>Q+1),await V(w))},[w]),W=D.useCallback(async(Q,$=0,ie={})=>{try{if(!Q||!Q.trim()){J.error("useHLSStream: Invalid stream URL");return}a(!0),J.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${$}]`,Q);const{enabled:ce=!0,rtmpUrl:ne="",streamKey:de="",skipSendToUnity:Y=!1}=ie;if(Y||L(Q,$),w)try{const X={streamUrl:Q,playerIndex:$.toString(),enabled:ce,rtmpUrl:ne,streamKey:de,updatedAt:new Date().toISOString()};J.log(`useHLSStream: Saving stream URL to Firebase for space ${w}`,X),await BV(w,X),d(X)}catch(X){throw J.error(`useHLSStream: Error saving stream URL to Firebase for space ${w}`,X),X}else J.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{a(!1)}},[L,w]);return D.useEffect(()=>{const $=b("SetHLSStream",ie=>{if(ie)try{J.log("useHLSStream: Received player status update",ie);const{identifier:ce,playerIndex:ne,isReady:de,isPlaying:Y}=ie,X=`${ce}_${ne}`;t(Z=>({...Z,[X]:{identifier:ce,playerIndex:ne,isReady:de,isPlaying:Y}}))}catch(ce){J.error("useHLSStream: Error handling player status update",ce)}});return()=>{$()}},[b]),D.useEffect(()=>{if(l&&l.streamUrl){J.log("useHLSStream: Resending saved stream URL to Unity");const Q=setTimeout(()=>{L(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(Q)}},[l,n,L,f]),D.useEffect(()=>{const Q=$=>{if($.detail){if(J.log("useHLSStream: Received stream update event",$.detail),w===$.detail.spaceId)J.log(`useHLSStream: Stream update is for our space ${w}, loading stream data`),V(w);else if($.detail.streamUrl){J.log(`useHLSStream: Using stream URL directly from event: ${$.detail.streamUrl}`);const ie=$.detail.playerIndex||"0";L($.detail.streamUrl,ie),d($.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",Q),window.addEventListener("SpaceStreamUpdated",Q),()=>{window.removeEventListener("SpaceHLSStreamUpdated",Q),window.removeEventListener("SpaceStreamUpdated",Q)}},[w,L]),{setHLSStreamUrl:W,playerStatus:n,isLoading:s,savedStreamData:l,reloadStreamData:B}},U6e=()=>{const[n,t]=D.useState(!1),s=hp();return D.useEffect(()=>{const l=s("FirstSceneLoaded",()=>{J.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[s]),n},V6e=()=>{const[n,t]=D.useState(null),s=hp();return console.log(" Nameplate click hook initialized"),D.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=s("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const y=typeof f=="string"?JSON.parse(f):f;t({playerName:y.playerName,playerId:y.playerId,uid:y.uid,isLocalPlayer:y.isLocalPlayer}),console.log(" Processed nameplate data:",y)}catch(y){console.error(" Error processing nameplate data:",y)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[s]),[n,()=>{console.log(" Resetting nameplate data"),t(null)}]},F6e=()=>{const n=hp(),{sendUserToUnity:t}=D.useContext(Cc);return D.useEffect(()=>{const a=n("RequestUserForUnity",()=>{J.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[n,t]),!0},zJ=async(n,t,s,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:f=null}=a;if(!n||!t)throw new Error("Missing required parameters: spaceId and mediaScreenId");let y=null;if(s){if(!s.type.startsWith("image/"))throw new Error("File must be an image");const v=qf(),b=Date.now(),w=s.name.split(".").pop(),I=`${t}_${b}.${w}`,k=Kf(v,`spaces/${n}/mediaScreens/${I}`);J.log(`Uploading image for media screen ${t} in space ${n}`);const L=await aN(k,s);y=await pR(L.ref);const V=Hr(vr,`spaces/${n}/mediaScreens`,t);await O0(V,{imageUrl:y,gsUrl:`gs://${L.ref.bucket}/${L.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){y=f;const v=Hr(vr,`spaces/${n}/mediaScreens`,t);await O0(v,{videoUrl:f,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return J.log(`Successfully uploaded ${l} for media screen ${t} (display as video: ${d})`),y}catch(l){throw J.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},j4=async n=>{J.log(`Getting media screen images for space: ${n}`);try{const t=kg(vr,`spaces/${n}/mediaScreens`),s=await Wy(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(t){throw J.error("Error fetching media screen images from Firestore:",t),t}},wf=async(n,t)=>{try{const s=Hr(vr,`spaces/${n}/mediaScreens`,t),a=await jo(s);return a.exists()?{id:a.id,...a.data()}:(J.warn(`No media screen found with ID: ${t}`),null)}catch(s){throw J.error("Error fetching media screen image:",s),s}},j6e=async(n,t)=>{try{const s=await wf(n,t);if(!s)return J.warn(`No media screen found with ID: ${t} to delete`),!1;if(s.gsUrl){const l=qf(),d=Kf(l,s.gsUrl);try{await cN(d),J.log(`Deleted file from storage: ${s.gsUrl}`)}catch(f){J.warn(`Could not delete file from storage: ${f.message}`)}}const a=Hr(vr,`spaces/${n}/mediaScreens`,t);return s.mediaType==="video"?(await So(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),J.log(`Successfully removed video for media screen ${t}`)):(await So(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),J.log(`Successfully removed image for media screen ${t}`)),!0}catch(s){throw J.error("Error deleting media screen image:",s),s}},B6e=async(n,t,s)=>{try{if(!n||!t||typeof s!="boolean")throw new Error("Missing or invalid required parameters");const a=await wf(n,t);if(!a||!a.imageUrl&&!a.videoUrl)return J.warn(`No media screen content found with ID: ${t} to update`),!1;const l=Hr(vr,`spaces/${n}/mediaScreens`,t);return await So(l,{displayAsVideo:s,updatedAt:new Date().toISOString()}),J.log(`Successfully updated display mode for media screen ${t} to ${s?"video":"image"}`),!0}catch(a){throw J.error("Error updating media screen display mode:",a),a}},W6e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},noe=()=>{const{spaceID:n}=wa(),t=dp(),[s,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){J.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{J.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!s){J.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}J.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await j4(n);J.log("Fetched Media Screen Images",d),d.forEach(f=>{const{id:y,imageUrl:v,displayAsVideo:b,videoUrl:w}=f;let I=null;(!b||!w)&&(I=v?W6e(v):null),t("SetMediaScreenImage",{mediaScreenId:y,imageUrl:I,videoUrl:w||null,displayAsVideo:b||!1,timestamp:Date.now()}),J.log(`Sent media screen data for ${y} to Unity (displayAsVideo: ${b})`),b&&w&&(t("SetMediaScreenDisplayMode",{mediaScreenId:y,displayAsVideo:!0,videoUrl:w,timestamp:Date.now()}),J.log(`Set display mode to video for screen ${y}`))})}catch(d){J.error("Error fetching media screen images:",d)}})()},[t,n,s])},z6e=()=>{const{spaceID:n}=wa(),t=dp(),[s,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){J.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{J.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!s){J.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}J.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await Yse(n),f=async b=>{const w=`https://vimeo.com/api/oembed.json?url=${b}`,I=await fetch(w);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const k=await I.json(),L=k.thumbnail_url.replace(/_\d+x\d+/,""),V=["640x360","295x166"];let B=null;for(let W of V){const Q=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${W}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Q,{method:"HEAD"})).ok){B=Q;break}}catch($){console.warn(`Failed to validate thumbnail URL: ${Q}`,$)}}return B||k.thumbnail_url},y=d.map(async b=>{const w=await f(b.url);return{gameObjectName:b.id,thumbnailUrl:w}}),v=await Promise.all(y);J.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:b,thumbnailUrl:w})=>{t("SetThumbnail",{gameObjectName:b,thumbnailUrl:w})})}catch(d){J.error("Error fetching thumbnails:",d)}})()},[t,n,s])},roe=()=>{const[n,t]=D.useState([]),s=hp();return D.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(J.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=L=>{if(a){J.log("UpdatePlayerList unity message received.");try{let V=[];if(typeof L=="object"&&L!==null?V=L.players||[]:V=JSON.parse(L).players||[],Array.isArray(V)){const B=Array.from(new Map(V.map(W=>[W.playerId,W])).values());t(B),l&&(clearTimeout(l),l=null)}}catch(V){J.error("Error handling player list data:",V),l||(l=setTimeout(d,1e3))}}},y=()=>{J.log("Player disconnected, requesting fresh player list"),d()},v=()=>{J.log("Player left, requesting fresh player list"),d()};d();const b=s("UpdatePlayerList",f),w=s("PlayerDisconnected",y),I=s("PlayerLeft",v),k=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof w=="function"&&w(),typeof I=="function"&&I(),clearInterval(k)}},[s]),n},ioe=()=>{const n=dp(),{isLoaded:t}=wa(),[s,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){J.log("usePlacePrefab: Unity already ready (via window flag)"),a(!0);return}const f=()=>{J.log("usePlacePrefab: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",f),()=>{window.removeEventListener("PlayerInstantiated",f)}},[]);const l=D.useCallback((f,y,v,b)=>{const w=y||{x:0,y:1,z:0},I=v||{x:0,y:0,z:0},k=b||{x:1,y:1,z:1};try{const L={prefabName:f||"TestPrefab",position:w,rotation:I,scale:k};return J.log("Sending prefab placement to Unity:",L),n("PlacePrefab",L),!0}catch(L){return J.error("Error placing prefab:",L),!1}},[n]),d=D.useCallback((f,y,v,b)=>{const w=y||{x:0,y:1,z:0},I=v||{x:0,y:0,z:0},k=b||{x:1,y:1,z:1};if(!window.unityInstance)return J.error("Unity not loaded, cannot place prefab directly"),!1;try{const L={prefabName:f||"TestPrefab",position:w,rotation:I,scale:k},V={eventName:"PlacePrefab",data:JSON.stringify(L)};return J.log("Directly sending prefab placement to Unity:",L),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(V)),!0}catch(L){return J.error("Error directly placing prefab:",L),!1}},[]);return{placePrefab:l,directPlacePrefab:d,isUnityLoaded:s&&t}},G6e=n=>{const[t,s]=D.useState(null),a=hp(),{spaceID:l}=wa();return D.useEffect(()=>{let f=!0;const v=a("PlayVideo",async b=>{try{const{gameObjectName:w}=b;if(!w){J.error("Game object name is missing in Unity event data.");return}const I=await Yse(l);J.log("SPACES VIDEOS",I);const k=I.find(L=>L.id===w);k&&f?(s(k.url),J.log("Video URL set to:",k.url)):console.error("Video not found for game object:",w)}catch(w){console.error("Error fetching space videos:",w)}});return()=>{f=!1,v()}},[a,l,n]),[t,()=>{s(null)}]};let PO;const H6e=new Uint8Array(16);function $6e(){if(!PO&&(PO=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!PO))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return PO(H6e)}const ga=[];for(let n=0;n<256;++n)ga.push((n+256).toString(16).slice(1));function K6e(n,t=0){return ga[n[t+0]]+ga[n[t+1]]+ga[n[t+2]]+ga[n[t+3]]+"-"+ga[n[t+4]]+ga[n[t+5]]+"-"+ga[n[t+6]]+ga[n[t+7]]+"-"+ga[n[t+8]]+ga[n[t+9]]+"-"+ga[n[t+10]]+ga[n[t+11]]+ga[n[t+12]]+ga[n[t+13]]+ga[n[t+14]]+ga[n[t+15]]}const q6e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),GJ={randomUUID:q6e};function Y6e(n,t,s){if(GJ.randomUUID&&!n)return GJ.randomUUID();n=n||{};const a=n.random||(n.rng||$6e)();return a[6]=a[6]&15|64,a[8]=a[8]&63|128,K6e(a)}const lN="spaces",uN="objects",X6e=async(n,t,s)=>{try{const a=Hr(vr,lN,n,uN,t),l={...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),spaceId:n,objectId:t};return await O0(a,l),J.log(`Saved object ${t} to space ${n}`),!0}catch(a){return J.error("Error saving object to space:",a),!1}},HJ=async n=>{try{const t=kg(vr,lN,n,uN),s=await Wy(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),J.log(`Retrieved ${a.length} objects for space ${n}`),a}catch(t){return J.error("Error getting space objects:",t),[]}},J6e=async(n,t)=>{try{const s=Hr(vr,lN,n,uN,t);return await V5e(s),J.log(`Deleted object ${t} from space ${n}`),!0}catch(s){return J.error("Error deleting space object:",s),!1}},Q6e=async(n,t,s)=>{try{const a=Hr(vr,lN,n,uN,t),l={...s,updatedAt:new Date().toISOString()};return await So(a,l),J.log(`Updated object ${t} in space ${n}`),!0}catch(a){return J.error("Error updating space object:",a),!1}},Z6e=n=>{const[t,s]=D.useState([]),[a,l]=D.useState(!0),{placePrefab:d,isUnityLoaded:f}=ioe();D.useEffect(()=>{(async()=>{if(n){l(!0);try{const k=await HJ(n);s(k),k.forEach(L=>{d(L.prefabName,L.position,L.rotation,L.scale)})}catch(k){J.error("Error loading space objects:",k)}finally{l(!1)}}})()},[n,d]);const y=D.useCallback(async(I,k,L,V)=>{if(!n)return!1;const B=Y6e(),W={prefabName:I,position:k,rotation:L,scale:V,objectId:B},Q=await X6e(n,B,W);return Q&&(s($=>[...$,{id:B,...W}]),d(I,k,L,V)),Q},[n,d]),v=D.useCallback(async I=>{if(!n)return!1;const k=await J6e(n,I);return k&&s(L=>L.filter(V=>V.id!==I)),k},[n]),b=D.useCallback(async(I,k)=>{if(!n)return!1;const L=await Q6e(n,I,k);return L&&s(V=>V.map(B=>B.id===I?{...B,...k}:B)),L},[n]),w=D.useCallback(async()=>{if(n){l(!0);try{const I=await HJ(n);s(I),I.forEach(k=>{d(k.prefabName,k.position,k.rotation,k.scale)})}catch(I){J.error("Error reloading space objects:",I)}finally{l(!1)}}},[n,d]);return{objects:t,isLoading:a,saveObject:y,deleteObject:v,updateObject:b,reloadObjects:w,isUnityLoaded:f}},e8e=n=>({opacity:1});var fR=n=>n.type==="checkbox",_y=n=>n instanceof Date,vc=n=>n==null;const soe=n=>typeof n=="object";var $s=n=>!vc(n)&&!Array.isArray(n)&&soe(n)&&!_y(n),t8e=n=>$s(n)&&n.target?fR(n.target)?n.target.checked:n.target.value:n,n8e=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,r8e=(n,t)=>n.has(n8e(t)),i8e=n=>{const t=n.constructor&&n.constructor.prototype;return $s(t)&&t.hasOwnProperty("isPrototypeOf")},B4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ou(n){let t;const s=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)t=new Date(n);else if(n instanceof Set)t=new Set(n);else if(!(B4&&(n instanceof Blob||a))&&(s||$s(n)))if(t=s?[]:{},!s&&!i8e(n))t=n;else for(const l in n)n.hasOwnProperty(l)&&(t[l]=Ou(n[l]));else return n;return t}var dN=n=>Array.isArray(n)?n.filter(Boolean):[],eo=n=>n===void 0,un=(n,t,s)=>{if(!t||!$s(n))return s;const a=dN(t.split(/[,[\].]+?/)).reduce((l,d)=>vc(l)?l:l[d],n);return eo(a)||a===n?eo(n[t])?s:n[t]:a},Mh=n=>typeof n=="boolean",W4=n=>/^\w*$/.test(n),ooe=n=>dN(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Zi=(n,t,s)=>{let a=-1;const l=W4(t)?[t]:ooe(t),d=l.length,f=d-1;for(;++a<d;){const y=l[a];let v=s;if(a!==f){const b=n[y];v=$s(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(y==="__proto__"||y==="constructor"||y==="prototype")return;n[y]=v,n=n[y]}return n};const $J={BLUR:"blur",FOCUS_OUT:"focusout"},Nd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},pf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};di.createContext(null);var s8e=(n,t,s,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const f=d;return t._proxyFormState[f]!==Nd.all&&(t._proxyFormState[f]=!a||Nd.all),n[f]}});return l},il=n=>$s(n)&&!Object.keys(n).length,o8e=(n,t,s,a)=>{s(n);const{name:l,...d}=n;return il(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(f=>t[f]===Nd.all)},fk=n=>Array.isArray(n)?n:[n];function a8e(n){const t=di.useRef(n);t.current=n,di.useEffect(()=>{const s=!n.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{s&&s.unsubscribe()}},[n.disabled])}var $h=n=>typeof n=="string",c8e=(n,t,s,a,l)=>$h(n)?(a&&t.watch.add(n),un(s,n,l)):Array.isArray(n)?n.map(d=>(a&&t.watch.add(d),un(s,d))):(a&&(t.watchAll=!0),s),l8e=(n,t,s,a,l)=>t?{...s[n],types:{...s[n]&&s[n].types?s[n].types:{},[a]:l||!0}}:{},KJ=n=>({isOnSubmit:!n||n===Nd.onSubmit,isOnBlur:n===Nd.onBlur,isOnChange:n===Nd.onChange,isOnAll:n===Nd.all,isOnTouch:n===Nd.onTouched}),qJ=(n,t,s)=>!s&&(t.watchAll||t.watch.has(n)||[...t.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const hC=(n,t,s,a)=>{for(const l of s||Object.keys(n)){const d=un(n,l);if(d){const{_f:f,...y}=d;if(f){if(f.refs&&f.refs[0]&&t(f.refs[0],l)&&!a)return!0;if(f.ref&&t(f.ref,f.name)&&!a)return!0;if(hC(y,t))break}else if($s(y)&&hC(y,t))break}}};var u8e=(n,t,s)=>{const a=fk(un(n,s));return Zi(a,"root",t[s]),Zi(n,s,a),n},z4=n=>n.type==="file",Wh=n=>typeof n=="function",n1=n=>{if(!B4)return!1;const t=n?n.ownerDocument:0;return n instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},mk=n=>$h(n),G4=n=>n.type==="radio",r1=n=>n instanceof RegExp;const YJ={value:!1,isValid:!1},XJ={value:!0,isValid:!0};var aoe=n=>{if(Array.isArray(n)){if(n.length>1){const t=n.filter(s=>s&&s.checked&&!s.disabled).map(s=>s.value);return{value:t,isValid:!!t.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!eo(n[0].attributes.value)?eo(n[0].value)||n[0].value===""?XJ:{value:n[0].value,isValid:!0}:XJ:YJ}return YJ};const JJ={isValid:!1,value:null};var coe=n=>Array.isArray(n)?n.reduce((t,s)=>s&&s.checked&&!s.disabled?{isValid:!0,value:s.value}:t,JJ):JJ;function QJ(n,t,s="validate"){if(mk(n)||Array.isArray(n)&&n.every(mk)||Mh(n)&&!n)return{type:s,message:mk(n)?n:"",ref:t}}var SS=n=>$s(n)&&!r1(n)?n:{value:n,message:""},ZJ=async(n,t,s,a,l,d)=>{const{ref:f,refs:y,required:v,maxLength:b,minLength:w,min:I,max:k,pattern:L,validate:V,name:B,valueAsNumber:W,mount:Q}=n._f,$=un(s,B);if(!Q||t.has(B))return{};const ie=y?y[0]:f,ce=pe=>{l&&ie.reportValidity&&(ie.setCustomValidity(Mh(pe)?"":pe||""),ie.reportValidity())},ne={},de=G4(f),Y=fR(f),X=de||Y,Z=(W||z4(f))&&eo(f.value)&&eo($)||n1(f)&&f.value===""||$===""||Array.isArray($)&&!$.length,se=l8e.bind(null,B,a,ne),me=(pe,ue,Le,We=pf.maxLength,$e=pf.minLength)=>{const ve=pe?ue:Le;ne[B]={type:pe?We:$e,message:ve,ref:f,...se(pe?We:$e,ve)}};if(d?!Array.isArray($)||!$.length:v&&(!X&&(Z||vc($))||Mh($)&&!$||Y&&!aoe(y).isValid||de&&!coe(y).isValid)){const{value:pe,message:ue}=mk(v)?{value:!!v,message:v}:SS(v);if(pe&&(ne[B]={type:pf.required,message:ue,ref:ie,...se(pf.required,ue)},!a))return ce(ue),ne}if(!Z&&(!vc(I)||!vc(k))){let pe,ue;const Le=SS(k),We=SS(I);if(!vc($)&&!isNaN($)){const $e=f.valueAsNumber||$&&+$;vc(Le.value)||(pe=$e>Le.value),vc(We.value)||(ue=$e<We.value)}else{const $e=f.valueAsDate||new Date($),ve=ke=>new Date(new Date().toDateString()+" "+ke),_e=f.type=="time",Ee=f.type=="week";$h(Le.value)&&$&&(pe=_e?ve($)>ve(Le.value):Ee?$>Le.value:$e>new Date(Le.value)),$h(We.value)&&$&&(ue=_e?ve($)<ve(We.value):Ee?$<We.value:$e<new Date(We.value))}if((pe||ue)&&(me(!!pe,Le.message,We.message,pf.max,pf.min),!a))return ce(ne[B].message),ne}if((b||w)&&!Z&&($h($)||d&&Array.isArray($))){const pe=SS(b),ue=SS(w),Le=!vc(pe.value)&&$.length>+pe.value,We=!vc(ue.value)&&$.length<+ue.value;if((Le||We)&&(me(Le,pe.message,ue.message),!a))return ce(ne[B].message),ne}if(L&&!Z&&$h($)){const{value:pe,message:ue}=SS(L);if(r1(pe)&&!$.match(pe)&&(ne[B]={type:pf.pattern,message:ue,ref:f,...se(pf.pattern,ue)},!a))return ce(ue),ne}if(V){if(Wh(V)){const pe=await V($,s),ue=QJ(pe,ie);if(ue&&(ne[B]={...ue,...se(pf.validate,ue.message)},!a))return ce(ue.message),ne}else if($s(V)){let pe={};for(const ue in V){if(!il(pe)&&!a)break;const Le=QJ(await V[ue]($,s),ie,ue);Le&&(pe={...Le,...se(ue,Le.message)},ce(Le.message),a&&(ne[B]=pe))}if(!il(pe)&&(ne[B]={ref:ie,...pe},!a))return ne}}return ce(!0),ne};function d8e(n,t){const s=t.slice(0,-1).length;let a=0;for(;a<s;)n=eo(n)?a++:n[t[a++]];return n}function h8e(n){for(const t in n)if(n.hasOwnProperty(t)&&!eo(n[t]))return!1;return!0}function yo(n,t){const s=Array.isArray(t)?t:W4(t)?[t]:ooe(t),a=s.length===1?n:d8e(n,s),l=s.length-1,d=s[l];return a&&delete a[d],l!==0&&($s(a)&&il(a)||Array.isArray(a)&&h8e(a))&&yo(n,s.slice(0,-1)),n}var cU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},zV=n=>vc(n)||!soe(n);function fg(n,t){if(zV(n)||zV(t))return n===t;if(_y(n)&&_y(t))return n.getTime()===t.getTime();const s=Object.keys(n),a=Object.keys(t);if(s.length!==a.length)return!1;for(const l of s){const d=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const f=t[l];if(_y(d)&&_y(f)||$s(d)&&$s(f)||Array.isArray(d)&&Array.isArray(f)?!fg(d,f):d!==f)return!1}}return!0}var loe=n=>n.type==="select-multiple",p8e=n=>G4(n)||fR(n),lU=n=>n1(n)&&n.isConnected,uoe=n=>{for(const t in n)if(Wh(n[t]))return!0;return!1};function i1(n,t={}){const s=Array.isArray(n);if($s(n)||s)for(const a in n)Array.isArray(n[a])||$s(n[a])&&!uoe(n[a])?(t[a]=Array.isArray(n[a])?[]:{},i1(n[a],t[a])):vc(n[a])||(t[a]=!0);return t}function doe(n,t,s){const a=Array.isArray(n);if($s(n)||a)for(const l in n)Array.isArray(n[l])||$s(n[l])&&!uoe(n[l])?eo(t)||zV(s[l])?s[l]=Array.isArray(n[l])?i1(n[l],[]):{...i1(n[l])}:doe(n[l],vc(t)?{}:t[l],s[l]):s[l]=!fg(n[l],t[l]);return s}var Cw=(n,t)=>doe(n,t,i1(t)),hoe=(n,{valueAsNumber:t,valueAsDate:s,setValueAs:a})=>eo(n)?n:t?n===""?NaN:n&&+n:s&&$h(n)?new Date(n):a?a(n):n;function uU(n){const t=n.ref;return z4(t)?t.files:G4(t)?coe(n.refs).value:loe(t)?[...t.selectedOptions].map(({value:s})=>s):fR(t)?aoe(n.refs).value:hoe(eo(t.value)?n.ref.value:t.value,n)}var f8e=(n,t,s,a)=>{const l={};for(const d of n){const f=un(t,d);f&&Zi(l,d,f._f)}return{criteriaMode:s,names:[...n],fields:l,shouldUseNativeValidation:a}},Rw=n=>eo(n)?n:r1(n)?n.source:$s(n)?r1(n.value)?n.value.source:n.value:n;const eQ="AsyncFunction";var m8e=n=>!!n&&!!n.validate&&!!(Wh(n.validate)&&n.validate.constructor.name===eQ||$s(n.validate)&&Object.values(n.validate).find(t=>t.constructor.name===eQ)),g8e=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function tQ(n,t,s){const a=un(n,s);if(a||W4(s))return{error:a,name:s};const l=s.split(".");for(;l.length;){const d=l.join("."),f=un(t,d),y=un(n,d);if(f&&!Array.isArray(f)&&s!==d)return{name:s};if(y&&y.type)return{name:d,error:y};l.pop()}return{name:s}}var _8e=(n,t,s,a,l)=>l.isOnAll?!1:!s&&l.isOnTouch?!(t||n):(s?a.isOnBlur:l.isOnBlur)?!n:(s?a.isOnChange:l.isOnChange)?n:!0,y8e=(n,t)=>!dN(un(n,t)).length&&yo(n,t);const E8e={mode:Nd.onSubmit,reValidateMode:Nd.onChange,shouldFocusError:!0};function v8e(n={}){let t={...E8e,...n},s={submitCount:0,isDirty:!1,isLoading:Wh(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=$s(t.defaultValues)||$s(t.values)?Ou(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:Ou(l),f={action:!1,mount:!1,watch:!1},y={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,b=0;const w={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:cU(),array:cU(),state:cU()},k=KJ(t.mode),L=KJ(t.reValidateMode),V=t.criteriaMode===Nd.all,B=Re=>Ve=>{clearTimeout(b),b=setTimeout(Re,Ve)},W=async Re=>{if(!t.disabled&&(w.isValid||Re)){const Ve=t.resolver?il((await X()).errors):await se(a,!0);Ve!==s.isValid&&I.state.next({isValid:Ve})}},Q=(Re,Ve)=>{!t.disabled&&(w.isValidating||w.validatingFields)&&((Re||Array.from(y.mount)).forEach(Ge=>{Ge&&(Ve?Zi(s.validatingFields,Ge,Ve):yo(s.validatingFields,Ge))}),I.state.next({validatingFields:s.validatingFields,isValidating:!il(s.validatingFields)}))},$=(Re,Ve=[],Ge,ht,mt=!0,vt=!0)=>{if(ht&&Ge&&!t.disabled){if(f.action=!0,vt&&Array.isArray(un(a,Re))){const Bt=Ge(un(a,Re),ht.argA,ht.argB);mt&&Zi(a,Re,Bt)}if(vt&&Array.isArray(un(s.errors,Re))){const Bt=Ge(un(s.errors,Re),ht.argA,ht.argB);mt&&Zi(s.errors,Re,Bt),y8e(s.errors,Re)}if(w.touchedFields&&vt&&Array.isArray(un(s.touchedFields,Re))){const Bt=Ge(un(s.touchedFields,Re),ht.argA,ht.argB);mt&&Zi(s.touchedFields,Re,Bt)}w.dirtyFields&&(s.dirtyFields=Cw(l,d)),I.state.next({name:Re,isDirty:pe(Re,Ve),dirtyFields:s.dirtyFields,errors:s.errors,isValid:s.isValid})}else Zi(d,Re,Ve)},ie=(Re,Ve)=>{Zi(s.errors,Re,Ve),I.state.next({errors:s.errors})},ce=Re=>{s.errors=Re,I.state.next({errors:s.errors,isValid:!1})},ne=(Re,Ve,Ge,ht)=>{const mt=un(a,Re);if(mt){const vt=un(d,Re,eo(Ge)?un(l,Re):Ge);eo(vt)||ht&&ht.defaultChecked||Ve?Zi(d,Re,Ve?vt:uU(mt._f)):We(Re,vt),f.mount&&W()}},de=(Re,Ve,Ge,ht,mt)=>{let vt=!1,Bt=!1;const mn={name:Re};if(!t.disabled){const En=!!(un(a,Re)&&un(a,Re)._f&&un(a,Re)._f.disabled);if(!Ge||ht){w.isDirty&&(Bt=s.isDirty,s.isDirty=mn.isDirty=pe(),vt=Bt!==mn.isDirty);const en=En||fg(un(l,Re),Ve);Bt=!!(!En&&un(s.dirtyFields,Re)),en||En?yo(s.dirtyFields,Re):Zi(s.dirtyFields,Re,!0),mn.dirtyFields=s.dirtyFields,vt=vt||w.dirtyFields&&Bt!==!en}if(Ge){const en=un(s.touchedFields,Re);en||(Zi(s.touchedFields,Re,Ge),mn.touchedFields=s.touchedFields,vt=vt||w.touchedFields&&en!==Ge)}vt&&mt&&I.state.next(mn)}return vt?mn:{}},Y=(Re,Ve,Ge,ht)=>{const mt=un(s.errors,Re),vt=w.isValid&&Mh(Ve)&&s.isValid!==Ve;if(t.delayError&&Ge?(v=B(()=>ie(Re,Ge)),v(t.delayError)):(clearTimeout(b),v=null,Ge?Zi(s.errors,Re,Ge):yo(s.errors,Re)),(Ge?!fg(mt,Ge):mt)||!il(ht)||vt){const Bt={...ht,...vt&&Mh(Ve)?{isValid:Ve}:{},errors:s.errors,name:Re};s={...s,...Bt},I.state.next(Bt)}},X=async Re=>{Q(Re,!0);const Ve=await t.resolver(d,t.context,f8e(Re||y.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return Q(Re),Ve},Z=async Re=>{const{errors:Ve}=await X(Re);if(Re)for(const Ge of Re){const ht=un(Ve,Ge);ht?Zi(s.errors,Ge,ht):yo(s.errors,Ge)}else s.errors=Ve;return Ve},se=async(Re,Ve,Ge={valid:!0})=>{for(const ht in Re){const mt=Re[ht];if(mt){const{_f:vt,...Bt}=mt;if(vt){const mn=y.array.has(vt.name),En=mt._f&&m8e(mt._f);En&&w.validatingFields&&Q([ht],!0);const en=await ZJ(mt,y.disabled,d,V,t.shouldUseNativeValidation&&!Ve,mn);if(En&&w.validatingFields&&Q([ht]),en[vt.name]&&(Ge.valid=!1,Ve))break;!Ve&&(un(en,vt.name)?mn?u8e(s.errors,en,vt.name):Zi(s.errors,vt.name,en[vt.name]):yo(s.errors,vt.name))}!il(Bt)&&await se(Bt,Ve,Ge)}}return Ge.valid},me=()=>{for(const Re of y.unMount){const Ve=un(a,Re);Ve&&(Ve._f.refs?Ve._f.refs.every(Ge=>!lU(Ge)):!lU(Ve._f.ref))&&Je(Re)}y.unMount=new Set},pe=(Re,Ve)=>!t.disabled&&(Re&&Ve&&Zi(d,Re,Ve),!fg(Te(),l)),ue=(Re,Ve,Ge)=>c8e(Re,y,{...f.mount?d:eo(Ve)?l:$h(Re)?{[Re]:Ve}:Ve},Ge,Ve),Le=Re=>dN(un(f.mount?d:l,Re,t.shouldUnregister?un(l,Re,[]):[])),We=(Re,Ve,Ge={})=>{const ht=un(a,Re);let mt=Ve;if(ht){const vt=ht._f;vt&&(!vt.disabled&&Zi(d,Re,hoe(Ve,vt)),mt=n1(vt.ref)&&vc(Ve)?"":Ve,loe(vt.ref)?[...vt.ref.options].forEach(Bt=>Bt.selected=mt.includes(Bt.value)):vt.refs?fR(vt.ref)?vt.refs.length>1?vt.refs.forEach(Bt=>(!Bt.defaultChecked||!Bt.disabled)&&(Bt.checked=Array.isArray(mt)?!!mt.find(mn=>mn===Bt.value):mt===Bt.value)):vt.refs[0]&&(vt.refs[0].checked=!!mt):vt.refs.forEach(Bt=>Bt.checked=Bt.value===mt):z4(vt.ref)?vt.ref.value="":(vt.ref.value=mt,vt.ref.type||I.values.next({name:Re,values:{...d}})))}(Ge.shouldDirty||Ge.shouldTouch)&&de(Re,mt,Ge.shouldTouch,Ge.shouldDirty,!0),Ge.shouldValidate&&ke(Re)},$e=(Re,Ve,Ge)=>{for(const ht in Ve){const mt=Ve[ht],vt=`${Re}.${ht}`,Bt=un(a,vt);(y.array.has(Re)||$s(mt)||Bt&&!Bt._f)&&!_y(mt)?$e(vt,mt,Ge):We(vt,mt,Ge)}},ve=(Re,Ve,Ge={})=>{const ht=un(a,Re),mt=y.array.has(Re),vt=Ou(Ve);Zi(d,Re,vt),mt?(I.array.next({name:Re,values:{...d}}),(w.isDirty||w.dirtyFields)&&Ge.shouldDirty&&I.state.next({name:Re,dirtyFields:Cw(l,d),isDirty:pe(Re,vt)})):ht&&!ht._f&&!vc(vt)?$e(Re,vt,Ge):We(Re,vt,Ge),qJ(Re,y)&&I.state.next({...s}),I.values.next({name:f.mount?Re:void 0,values:{...d}})},_e=async Re=>{f.mount=!0;const Ve=Re.target;let Ge=Ve.name,ht=!0;const mt=un(a,Ge),vt=()=>Ve.type?uU(mt._f):t8e(Re),Bt=mn=>{ht=Number.isNaN(mn)||_y(mn)&&isNaN(mn.getTime())||fg(mn,un(d,Ge,mn))};if(mt){let mn,En;const en=vt(),Et=Re.type===$J.BLUR||Re.type===$J.FOCUS_OUT,nr=!g8e(mt._f)&&!t.resolver&&!un(s.errors,Ge)&&!mt._f.deps||_8e(Et,un(s.touchedFields,Ge),s.isSubmitted,L,k),Nt=qJ(Ge,y,Et);Zi(d,Ge,en),Et?(mt._f.onBlur&&mt._f.onBlur(Re),v&&v(0)):mt._f.onChange&&mt._f.onChange(Re);const Ut=de(Ge,en,Et,!1),gn=!il(Ut)||Nt;if(!Et&&I.values.next({name:Ge,type:Re.type,values:{...d}}),nr)return w.isValid&&(t.mode==="onBlur"&&Et?W():Et||W()),gn&&I.state.next({name:Ge,...Nt?{}:Ut});if(!Et&&Nt&&I.state.next({...s}),t.resolver){const{errors:ki}=await X([Ge]);if(Bt(en),ht){const _s=tQ(s.errors,a,Ge),ii=tQ(ki,a,_s.name||Ge);mn=ii.error,Ge=ii.name,En=il(ki)}}else Q([Ge],!0),mn=(await ZJ(mt,y.disabled,d,V,t.shouldUseNativeValidation))[Ge],Q([Ge]),Bt(en),ht&&(mn?En=!1:w.isValid&&(En=await se(a,!0)));ht&&(mt._f.deps&&ke(mt._f.deps),Y(Ge,En,mn,Ut))}},Ee=(Re,Ve)=>{if(un(s.errors,Ve)&&Re.focus)return Re.focus(),1},ke=async(Re,Ve={})=>{let Ge,ht;const mt=fk(Re);if(t.resolver){const vt=await Z(eo(Re)?Re:mt);Ge=il(vt),ht=Re?!mt.some(Bt=>un(vt,Bt)):Ge}else Re?(ht=(await Promise.all(mt.map(async vt=>{const Bt=un(a,vt);return await se(Bt&&Bt._f?{[vt]:Bt}:Bt)}))).every(Boolean),!(!ht&&!s.isValid)&&W()):ht=Ge=await se(a);return I.state.next({...!$h(Re)||w.isValid&&Ge!==s.isValid?{}:{name:Re},...t.resolver||!Re?{isValid:Ge}:{},errors:s.errors}),Ve.shouldFocus&&!ht&&hC(a,Ee,Re?mt:y.mount),ht},Te=Re=>{const Ve={...f.mount?d:l};return eo(Re)?Ve:$h(Re)?un(Ve,Re):Re.map(Ge=>un(Ve,Ge))},be=(Re,Ve)=>({invalid:!!un((Ve||s).errors,Re),isDirty:!!un((Ve||s).dirtyFields,Re),error:un((Ve||s).errors,Re),isValidating:!!un(s.validatingFields,Re),isTouched:!!un((Ve||s).touchedFields,Re)}),Pe=Re=>{Re&&fk(Re).forEach(Ve=>yo(s.errors,Ve)),I.state.next({errors:Re?s.errors:{}})},xe=(Re,Ve,Ge)=>{const ht=(un(a,Re,{_f:{}})._f||{}).ref,mt=un(s.errors,Re)||{},{ref:vt,message:Bt,type:mn,...En}=mt;Zi(s.errors,Re,{...En,...Ve,ref:ht}),I.state.next({name:Re,errors:s.errors,isValid:!1}),Ge&&Ge.shouldFocus&&ht&&ht.focus&&ht.focus()},ze=(Re,Ve)=>Wh(Re)?I.values.subscribe({next:Ge=>Re(ue(void 0,Ve),Ge)}):ue(Re,Ve,!0),Je=(Re,Ve={})=>{for(const Ge of Re?fk(Re):y.mount)y.mount.delete(Ge),y.array.delete(Ge),Ve.keepValue||(yo(a,Ge),yo(d,Ge)),!Ve.keepError&&yo(s.errors,Ge),!Ve.keepDirty&&yo(s.dirtyFields,Ge),!Ve.keepTouched&&yo(s.touchedFields,Ge),!Ve.keepIsValidating&&yo(s.validatingFields,Ge),!t.shouldUnregister&&!Ve.keepDefaultValue&&yo(l,Ge);I.values.next({values:{...d}}),I.state.next({...s,...Ve.keepDirty?{isDirty:pe()}:{}}),!Ve.keepIsValid&&W()},Ze=({disabled:Re,name:Ve,field:Ge,fields:ht})=>{(Mh(Re)&&f.mount||Re||y.disabled.has(Ve))&&(Re?y.disabled.add(Ve):y.disabled.delete(Ve),de(Ve,uU(Ge?Ge._f:un(ht,Ve)._f),!1,!1,!0))},lt=(Re,Ve={})=>{let Ge=un(a,Re);const ht=Mh(Ve.disabled)||Mh(t.disabled);return Zi(a,Re,{...Ge||{},_f:{...Ge&&Ge._f?Ge._f:{ref:{name:Re}},name:Re,mount:!0,...Ve}}),y.mount.add(Re),Ge?Ze({field:Ge,disabled:Mh(Ve.disabled)?Ve.disabled:t.disabled,name:Re}):ne(Re,!0,Ve.value),{...ht?{disabled:Ve.disabled||t.disabled}:{},...t.progressive?{required:!!Ve.required,min:Rw(Ve.min),max:Rw(Ve.max),minLength:Rw(Ve.minLength),maxLength:Rw(Ve.maxLength),pattern:Rw(Ve.pattern)}:{},name:Re,onChange:_e,onBlur:_e,ref:mt=>{if(mt){lt(Re,Ve),Ge=un(a,Re);const vt=eo(mt.value)&&mt.querySelectorAll&&mt.querySelectorAll("input,select,textarea")[0]||mt,Bt=p8e(vt),mn=Ge._f.refs||[];if(Bt?mn.find(En=>En===vt):vt===Ge._f.ref)return;Zi(a,Re,{_f:{...Ge._f,...Bt?{refs:[...mn.filter(lU),vt,...Array.isArray(un(l,Re))?[{}]:[]],ref:{type:vt.type,name:Re}}:{ref:vt}}}),ne(Re,!1,void 0,vt)}else Ge=un(a,Re,{}),Ge._f&&(Ge._f.mount=!1),(t.shouldUnregister||Ve.shouldUnregister)&&!(r8e(y.array,Re)&&f.action)&&y.unMount.add(Re)}}},nt=()=>t.shouldFocusError&&hC(a,Ee,y.mount),Rt=Re=>{Mh(Re)&&(I.state.next({disabled:Re}),hC(a,(Ve,Ge)=>{const ht=un(a,Ge);ht&&(Ve.disabled=ht._f.disabled||Re,Array.isArray(ht._f.refs)&&ht._f.refs.forEach(mt=>{mt.disabled=ht._f.disabled||Re}))},0,!1))},fn=(Re,Ve)=>async Ge=>{let ht;Ge&&(Ge.preventDefault&&Ge.preventDefault(),Ge.persist&&Ge.persist());let mt=Ou(d);if(y.disabled.size)for(const vt of y.disabled)Zi(mt,vt,void 0);if(I.state.next({isSubmitting:!0}),t.resolver){const{errors:vt,values:Bt}=await X();s.errors=vt,mt=Bt}else await se(a);if(yo(s.errors,"root"),il(s.errors)){I.state.next({errors:{}});try{await Re(mt,Ge)}catch(vt){ht=vt}}else Ve&&await Ve({...s.errors},Ge),nt(),setTimeout(nt);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:il(s.errors)&&!ht,submitCount:s.submitCount+1,errors:s.errors}),ht)throw ht},Ft=(Re,Ve={})=>{un(a,Re)&&(eo(Ve.defaultValue)?ve(Re,Ou(un(l,Re))):(ve(Re,Ve.defaultValue),Zi(l,Re,Ou(Ve.defaultValue))),Ve.keepTouched||yo(s.touchedFields,Re),Ve.keepDirty||(yo(s.dirtyFields,Re),s.isDirty=Ve.defaultValue?pe(Re,Ou(un(l,Re))):pe()),Ve.keepError||(yo(s.errors,Re),w.isValid&&W()),I.state.next({...s}))},on=(Re,Ve={})=>{const Ge=Re?Ou(Re):l,ht=Ou(Ge),mt=il(Re),vt=mt?l:ht;if(Ve.keepDefaultValues||(l=Ge),!Ve.keepValues){if(Ve.keepDirtyValues){const Bt=new Set([...y.mount,...Object.keys(Cw(l,d))]);for(const mn of Array.from(Bt))un(s.dirtyFields,mn)?Zi(vt,mn,un(d,mn)):ve(mn,un(vt,mn))}else{if(B4&&eo(Re))for(const Bt of y.mount){const mn=un(a,Bt);if(mn&&mn._f){const En=Array.isArray(mn._f.refs)?mn._f.refs[0]:mn._f.ref;if(n1(En)){const en=En.closest("form");if(en){en.reset();break}}}}a={}}d=t.shouldUnregister?Ve.keepDefaultValues?Ou(l):{}:Ou(vt),I.array.next({values:{...vt}}),I.values.next({values:{...vt}})}y={mount:Ve.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!w.isValid||!!Ve.keepIsValid||!!Ve.keepDirtyValues,f.watch=!!t.shouldUnregister,I.state.next({submitCount:Ve.keepSubmitCount?s.submitCount:0,isDirty:mt?!1:Ve.keepDirty?s.isDirty:!!(Ve.keepDefaultValues&&!fg(Re,l)),isSubmitted:Ve.keepIsSubmitted?s.isSubmitted:!1,dirtyFields:mt?{}:Ve.keepDirtyValues?Ve.keepDefaultValues&&d?Cw(l,d):s.dirtyFields:Ve.keepDefaultValues&&Re?Cw(l,Re):Ve.keepDirty?s.dirtyFields:{},touchedFields:Ve.keepTouched?s.touchedFields:{},errors:Ve.keepErrors?s.errors:{},isSubmitSuccessful:Ve.keepIsSubmitSuccessful?s.isSubmitSuccessful:!1,isSubmitting:!1})},Zt=(Re,Ve)=>on(Wh(Re)?Re(d):Re,Ve);return{control:{register:lt,unregister:Je,getFieldState:be,handleSubmit:fn,setError:xe,_executeSchema:X,_getWatch:ue,_getDirty:pe,_updateValid:W,_removeUnmounted:me,_updateFieldArray:$,_updateDisabledField:Ze,_getFieldArray:Le,_reset:on,_resetDefaultValues:()=>Wh(t.defaultValues)&&t.defaultValues().then(Re=>{Zt(Re,t.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:Re=>{s={...s,...Re}},_disableForm:Rt,_subjects:I,_proxyFormState:w,_setErrors:ce,get _fields(){return a},get _formValues(){return d},get _state(){return f},set _state(Re){f=Re},get _defaultValues(){return l},get _names(){return y},set _names(Re){y=Re},get _formState(){return s},set _formState(Re){s=Re},get _options(){return t},set _options(Re){t={...t,...Re}}},trigger:ke,register:lt,handleSubmit:fn,watch:ze,setValue:ve,getValues:Te,reset:Zt,resetField:Ft,clearErrors:Pe,unregister:Je,setError:xe,setFocus:(Re,Ve={})=>{const Ge=un(a,Re),ht=Ge&&Ge._f;if(ht){const mt=ht.refs?ht.refs[0]:ht.ref;mt.focus&&(mt.focus(),Ve.shouldSelect&&Wh(mt.select)&&mt.select())}},getFieldState:be}}function poe(n={}){const t=di.useRef(void 0),s=di.useRef(void 0),[a,l]=di.useState({isDirty:!1,isValidating:!1,isLoading:Wh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:Wh(n.defaultValues)?void 0:n.defaultValues});t.current||(t.current={...v8e(n),formState:a});const d=t.current.control;return d._options=n,a8e({subject:d._subjects.state,next:f=>{o8e(f,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),di.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),di.useEffect(()=>{if(d._proxyFormState.isDirty){const f=d._getDirty();f!==a.isDirty&&d._subjects.state.next({isDirty:f})}},[d,a.isDirty]),di.useEffect(()=>{n.values&&!fg(n.values,s.current)?(d._reset(n.values,d._options.resetOptions),s.current=n.values,l(f=>({...f}))):d._resetDefaultValues()},[n.values,d]),di.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),di.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),di.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),t.current.formState=s8e(a,d),t.current}var S8e=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function GV(){return GV=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(n[a]=s[a])}return n},GV.apply(this,arguments)}function b8e(n,t){if(n==null)return{};var s={},a=Object.keys(n),l,d;for(d=0;d<a.length;d++)l=a[d],!(t.indexOf(l)>=0)&&(s[l]=n[l]);return s}function OO(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function T8e(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,HV(n,t)}function HV(n,t){return HV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,l){return a.__proto__=l,a},HV(n,t)}var hN=function(n){T8e(t,n);function t(){var a;return a=n.call(this)||this,a.handleExpired=a.handleExpired.bind(OO(a)),a.handleErrored=a.handleErrored.bind(OO(a)),a.handleChange=a.handleChange.bind(OO(a)),a.handleRecaptchaRef=a.handleRecaptchaRef.bind(OO(a)),a}var s=t.prototype;return s.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},s.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},s.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},s.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},s.executeAsync=function(){var l=this;return new Promise(function(d,f){l.executionResolve=d,l.executionReject=f,l.execute()})},s.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},s.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},s.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},s.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},s.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},s.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var d=document.createElement("div");this._widgetId=l(d,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(d)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},s.componentDidMount=function(){this.explicitRender()},s.componentDidUpdate=function(){this.explicitRender()},s.handleRecaptchaRef=function(l){this.captcha=l},s.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var d=b8e(l,S8e);return D.createElement("div",GV({},d,{ref:this.handleRecaptchaRef}))},t}(D.Component);hN.displayName="ReCAPTCHA";hN.propTypes={sitekey:vn.string.isRequired,onChange:vn.func,grecaptcha:vn.object,theme:vn.oneOf(["dark","light"]),type:vn.oneOf(["image","audio"]),tabindex:vn.number,onExpired:vn.func,onErrored:vn.func,size:vn.oneOf(["compact","normal","invisible"]),stoken:vn.string,hl:vn.string,badge:vn.oneOf(["bottomright","bottomleft","inline"]),isolated:vn.bool};hN.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function $V(){return $V=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(n[a]=s[a])}return n},$V.apply(this,arguments)}function w8e(n,t){if(n==null)return{};var s={},a=Object.keys(n),l,d;for(d=0;d<a.length;d++)l=a[d],!(t.indexOf(l)>=0)&&(s[l]=n[l]);return s}function C8e(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.__proto__=t}var Pd={},R8e=0;function I8e(n,t){return t=t||{},function(a){var l=a.displayName||a.name||"Component",d=function(y){C8e(v,y);function v(w,I){var k;return k=y.call(this,w,I)||this,k.state={},k.__scriptURL="",k}var b=v.prototype;return b.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+R8e++),this.__scriptLoaderID},b.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},b.asyncScriptLoaderHandleLoad=function(I){var k=this;this.setState(I,function(){return k.props.asyncScriptOnLoad&&k.props.asyncScriptOnLoad(k.state)})},b.asyncScriptLoaderTriggerOnScriptLoaded=function(){var I=Pd[this.__scriptURL];if(!I||!I.loaded)throw new Error("Script is not loaded.");for(var k in I.observers)I.observers[k](I);delete window[t.callbackName]},b.componentDidMount=function(){var I=this,k=this.setupScriptURL(),L=this.asyncScriptLoaderGetScriptLoaderID(),V=t,B=V.globalName,W=V.callbackName,Q=V.scriptId;if(B&&typeof window[B]<"u"&&(Pd[k]={loaded:!0,observers:{}}),Pd[k]){var $=Pd[k];if($&&($.loaded||$.errored)){this.asyncScriptLoaderHandleLoad($);return}$.observers[L]=function(Y){return I.asyncScriptLoaderHandleLoad(Y)};return}var ie={};ie[L]=function(Y){return I.asyncScriptLoaderHandleLoad(Y)},Pd[k]={loaded:!1,observers:ie};var ce=document.createElement("script");ce.src=k,ce.async=!0;for(var ne in t.attributes)ce.setAttribute(ne,t.attributes[ne]);Q&&(ce.id=Q);var de=function(X){if(Pd[k]){var Z=Pd[k],se=Z.observers;for(var me in se)X(se[me])&&delete se[me]}};W&&typeof window<"u"&&(window[W]=function(){return I.asyncScriptLoaderTriggerOnScriptLoaded()}),ce.onload=function(){var Y=Pd[k];Y&&(Y.loaded=!0,de(function(X){return W?!1:(X(Y),!0)}))},ce.onerror=function(){var Y=Pd[k];Y&&(Y.errored=!0,de(function(X){return X(Y),!0}))},document.body.appendChild(ce)},b.componentWillUnmount=function(){var I=this.__scriptURL;if(t.removeOnUnmount===!0)for(var k=document.getElementsByTagName("script"),L=0;L<k.length;L+=1)k[L].src.indexOf(I)>-1&&k[L].parentNode&&k[L].parentNode.removeChild(k[L]);var V=Pd[I];V&&(delete V.observers[this.asyncScriptLoaderGetScriptLoaderID()],t.removeOnUnmount===!0&&delete Pd[I])},b.render=function(){var I=t.globalName,k=this.props;k.asyncScriptOnLoad;var L=k.forwardedRef,V=w8e(k,["asyncScriptOnLoad","forwardedRef"]);return I&&typeof window<"u"&&(V[I]=typeof window[I]<"u"?window[I]:void 0),V.ref=L,D.createElement(a,V)},v}(D.Component),f=D.forwardRef(function(y,v){return D.createElement(d,$V({},y,{forwardedRef:v}))});return f.displayName="AsyncScriptLoader("+l+")",f.propTypes={asyncScriptOnLoad:vn.func},jRe(f,a)}}var KV="onloadcallback",A8e="grecaptcha";function qV(){return typeof window<"u"&&window.recaptchaOptions||{}}function P8e(){var n=qV(),t=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+t+"/recaptcha/enterprise.js?onload="+KV+"&render=explicit":"https://"+t+"/recaptcha/api.js?onload="+KV+"&render=explicit"}const foe=I8e(P8e,{callbackName:KV,globalName:A8e,attributes:qV().nonce?{nonce:qV().nonce}:{}})(hN),pN=(n,t="generic-modal")=>{D.useEffect(()=>{if(!window.unityInstance)return;const s=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),J.log(`Unity input disabled for ${t}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=t}catch(l){J.error(`Failed to disable Unity input for ${t}:`,l)}},a=()=>{try{window.unityInputDisabledBy===t?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),J.log(`Unity input re-enabled (was disabled by ${t})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):J.log(`Not re-enabling Unity input for ${t} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){J.error(`Failed to enable Unity input for ${t}:`,l)}};return n?s():a(),()=>{n&&a()}},[n,t])},moe=({isOpen:n,onClose:t,userData:s,onConfirm:a,fullscreenRef:l})=>{const[d,f]=D.useState((s==null?void 0:s.username)||""),[y,v]=D.useState((s==null?void 0:s.Nickname)||""),[b,w]=D.useState(!1),[I,k]=D.useState(null),[L,V]=D.useState(!1),B=hl(),W=ce=>!(!ce||ce.trim()===""||!/^[a-z0-9]{1,15}$/.test(ce)),Q=async ce=>{var ne,de;if(!W(ce))return!ce||ce.trim()===""?k("Username cannot be empty"):k("Username must be 1-15 characters, lowercase letters and numbers only"),!1;w(!0),k(null);try{let Y=!1,X=0;const Z=3;for(;X<Z;)try{Y=await kse(ce);break}catch(se){if(J.error(`Attempt ${X+1}: Error checking username:`,se),X++,X>=Z)throw se;await new Promise(me=>setTimeout(me,1e3))}return Y?(k("Username is already taken"),!1):!0}catch(Y){return J.error("Error checking username after retries:",Y),Y.code==="permission-denied"||(ne=Y.message)!=null&&ne.includes("permissions")?k("Username check unavailable. Please try again or pick a unique name."):k("Error checking username availability. Please try again."),Y.code==="permission-denied"||((de=Y.message)==null?void 0:de.includes("permissions"))}finally{w(!1)}};D.useEffect(()=>{if(!d){k("Username cannot be empty");return}if(d!==(s==null?void 0:s.username)){const ce=setTimeout(async()=>{await Q(d)},500);return()=>clearTimeout(ce)}},[d]),D.useEffect(()=>{if(s&&s.firstName&&s.lastName){const ce=`${s.firstName}${s.lastName.charAt(0).toUpperCase()}`;v(ce)}},[s]);const $=async()=>{V(!0);try{if(!await Q(d)){V(!1);return}if(y.length>15){k("Display Name must be at most 15 characters"),V(!1);return}Hw(y),J.log("UsernameConfirmation: Preparing to confirm user registration");const ne=s.firstName&&s.lastName?`${s.firstName}${s.lastName.charAt(0).toUpperCase()}`:"",de={...s,firstName:s.firstName||"",lastName:s.lastName||"",companyName:s.companyName||"",linkedInProfile:s.linkedInProfile||"",username:d,Nickname:y||ne,email:s.email,password:s.password};J.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(de).join(", ")),await a(de),t()}catch(ce){J.error("Error during username confirmation:",ce),B({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{V(!1)}},ie=()=>{L||t()};return C.jsxs(Bo,{isOpen:n,onClose:ie,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!L,closeOnEsc:!L,children:[C.jsx(Go,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsxs(Wo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[C.jsxs(wc,{children:[C.jsx(NC,{size:"lg",mb:2,children:"Customize Your Profile"}),C.jsx(at,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),C.jsx(ba,{color:"gray.400",isDisabled:L}),C.jsx(zo,{children:C.jsxs(Ui,{spacing:6,align:"stretch",children:[C.jsxs(hi,{isInvalid:!!I,children:[C.jsx(Zs,{children:"Username"}),C.jsxs(Iy,{children:[C.jsx(Cj,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),C.jsx(es,{placeholder:"username",value:d,onChange:ce=>f(ce.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),I?C.jsx(Fh,{children:I}):C.jsx(JS,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),C.jsxs(hi,{children:[C.jsx(Zs,{children:"Nickname"}),C.jsx(es,{placeholder:"Nickname",value:y,onChange:ce=>v(ce.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),C.jsx(JS,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),C.jsx(Vf,{children:C.jsxs(Wi,{gap:3,width:"100%",children:[C.jsx(Lr,{variant:"outline",onClick:ie,flex:"1",isDisabled:L,children:"Back"}),C.jsx(Lr,{colorScheme:"blue",onClick:$,isLoading:L||b,isDisabled:!!I||!d||L,flex:"2",children:"Finish"})]})})]})]})};moe.propTypes={isOpen:vn.bool.isRequired,onClose:vn.func.isRequired,userData:vn.object.isRequired,onConfirm:vn.func.isRequired,fullscreenRef:vn.object};const O8e="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function H4({mode:n,label:t,buttonProps:s={},isOpen:a,onClose:l}){const{register:d,handleSubmit:f,formState:{errors:y}}=poe(),{register:v}=D.useContext(Cc),b=hl(),{fullscreenRef:w}=Vd(),[I,k]=D.useState(!1),[L,V]=D.useState(!1),[B,W]=D.useState(null),Q=D.useRef(null),[$,ie]=D.useState(!1),[ce,ne]=D.useState(null),[de,Y]=D.useState(!1),X=a!==void 0?a:I,Z=l||(()=>k(!1));pN(X||$),D.useEffect(()=>{!X&&Q.current&&(Q.current.reset(),W(null))},[X]);const se=We=>{W(We)},me=async We=>{J.log("Register.jsx: Processing registration form submission");const{email:$e,password:ve,confirmPassword:_e,...Ee}=We;if(J.log("Register.jsx: Registration data fields:",Object.keys(Ee).join(", ")),!B){b({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(ve!==_e){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}Hw(Ee.firstName),Hw(Ee.lastName),Hw(Ee.companyName),V(!0);try{const ke=await q5e(Ee.firstName||"",Ee.lastName||""),Te=Ee.firstName&&Ee.lastName?`${Ee.firstName}${Ee.lastName.charAt(0).toUpperCase()}`:"";Te&&Hw(Te),J.log("Register.jsx: Generated username and nickname for new user");const be={...Ee,firstName:Ee.firstName||"",lastName:Ee.lastName||"",companyName:Ee.companyName||"",linkedInProfile:Ee.linkedInProfile||"",email:$e,password:ve,username:ke,Nickname:Te,captchaToken:B};J.log("Register.jsx: Prepared registration data with fields:",Object.keys(be).join(", ")),ne(be),ie(!0)}catch(ke){J.error("User: Registration Error:",ke);let Te="An error occurred during registration. Please try again.",be=!1;ke.code==="auth/email-already-in-use"?(Te="This email address is already registered. Please sign in instead.",be=!0):ke.code==="auth/invalid-email"?Te="The email address is not valid. Please check and try again.":ke.code==="auth/weak-password"?Te="The password is too weak. Please choose a stronger password.":ke.message&&(Te=ke.message),b({title:"Registration Failed",description:C.jsxs(C.Fragment,{children:[Te,be&&C.jsx(at,{mt:2,children:C.jsx(Ul,{color:"blue.400",onClick:()=>{Z(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{V(!1),Q.current&&Q.current.reset()}},pe=async We=>{V(!0);try{J.log("Register.jsx: Completing registration with confirmed username");const{email:$e,password:ve,..._e}=We,Ee={..._e,firstName:_e.firstName||"",lastName:_e.lastName||"",companyName:_e.companyName||"",linkedInProfile:_e.linkedInProfile||"",username:_e.username||"",Nickname:_e.Nickname||""};J.log("Register.jsx: Final registration data includes fields:",Object.keys(Ee).join(", "));const ke=await v($e,ve,Ee);Z(),ie(!1),J.log("User: Registration process complete."),b({title:"Registration Successful",description:"Please check your email for a verification link. You'll need to verify your email before signing in.",status:"success",duration:8e3,isClosable:!0,position:"top"}),ne(null),Y(!1)}catch($e){J.error("User: Registration Error during final step:",$e);let ve="An error occurred during registration. Please try again.";$e.code==="auth/email-already-in-use"?ve="This email address is already in use. Please try another one.":$e.message&&(ve=$e.message),b({title:"Registration Failed",description:ve,status:"error",duration:5e3,isClosable:!0,position:"top"}),ie(!1),ne(null),Y(!1)}finally{V(!1)}},ue=()=>{l?l():k(!I)},Le=n==="link"?C.jsx(Ul,{variant:"header",onClick:ue,children:t}):C.jsx(Lr,{onClick:ue,...s,children:t});return C.jsxs(C.Fragment,{children:[!a&&Le,C.jsxs(Bo,{isOpen:X&&!$,onClose:Z,size:"md",portalProps:{containerRef:w},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(Go,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsxs(Wo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:We=>{We.stopPropagation()},children:[C.jsxs(wc,{p:8,textAlign:"center",children:[C.jsx(NC,{size:"lg",mb:2,children:"Create Account"}),C.jsx(at,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),C.jsx(ba,{color:"gray.400"}),C.jsx(zo,{px:8,children:C.jsx("form",{onSubmit:f(me),children:C.jsxs(Ui,{spacing:4,children:[C.jsxs(hi,{isInvalid:y.companyName,isRequired:!0,children:[C.jsx(es,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required",setValueAs:We=>We===""?"":We})}),C.jsx(Fh,{children:y.companyName&&y.companyName.message})]}),C.jsxs(Wi,{gap:4,w:"100%",children:[C.jsxs(hi,{isInvalid:y.firstName,isRequired:!0,children:[C.jsx(es,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required",setValueAs:We=>We===""?"":We})}),C.jsx(Fh,{children:y.firstName&&y.firstName.message})]}),C.jsxs(hi,{isInvalid:y.lastName,isRequired:!0,children:[C.jsx(es,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required",setValueAs:We=>We===""?"":We})}),C.jsx(Fh,{children:y.lastName&&y.lastName.message})]})]}),C.jsxs(hi,{isInvalid:y.email,isRequired:!0,children:[C.jsx(es,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),C.jsx(Fh,{children:y.email&&y.email.message})]}),C.jsxs(Wi,{gap:4,w:"100%",children:[C.jsxs(hi,{isInvalid:y.password,isRequired:!0,children:[C.jsx(es,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),C.jsx(Fh,{children:y.password&&y.password.message})]}),C.jsxs(hi,{isInvalid:y.confirmPassword,isRequired:!0,children:[C.jsx(es,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),C.jsx(Fh,{children:y.confirmPassword&&y.confirmPassword.message})]})]}),C.jsx(hi,{children:C.jsx(es,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile",{setValueAs:We=>We===""?"":We})})}),C.jsx(St,{width:"100%",display:"flex",justifyContent:"center",my:4,children:C.jsx(foe,{ref:Q,sitekey:O8e,onChange:se,theme:"dark"})})]})})}),C.jsxs(Vf,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(Lr,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(me),isLoading:L,loadingText:"Processing",isDisabled:!B,children:"Next: Set Your Username"}),C.jsxs(at,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",C.jsx(Ul,{color:"blue.400",onClick:()=>{Z(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),$&&C.jsx(moe,{isOpen:$,onClose:()=>ie(!1),userData:ce,onConfirm:pe,fullscreenRef:w,isRegistering:de})]})}H4.propTypes={mode:vn.oneOf(["button","link"]),label:vn.string,buttonProps:vn.object,isOpen:vn.bool,onClose:vn.func};const k8e=xg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),N8e=xg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),D8e=xg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),x8e=xg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),nQ=xg({displayName:"EmailIcon",path:C.jsxs("g",{fill:"currentColor",children:[C.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),C.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),L8e=xg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),M8e=xg({displayName:"QuestionOutlineIcon",path:C.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[C.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),C.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),C.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),U8e=xg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"}),V8e="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function $4({mode:n="button",label:t="Sign In",buttonProps:s={},initialIsOpen:a=!1}){const{signIn:l}=D.useContext(Cc),{fullscreenRef:d}=Vd(),f=hl(),{register:y,handleSubmit:v,formState:{errors:b}}=poe(),[w,I]=D.useState(!1),[k,L]=D.useState(a),[V,B]=D.useState(!1),[W,Q]=D.useState(!1),[$,ie]=D.useState(""),[ce,ne]=D.useState(!1),[de,Y]=D.useState(null),X=D.useRef(null);pN(k||W),D.useEffect(()=>{const $e=()=>{L(!0)};return window.addEventListener("openSignInModal",$e),()=>{window.removeEventListener("openSignInModal",$e)}},[]);const Z=$e=>{Y($e)},se=async $e=>{if(!de){f({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}I(!0);try{await l($e.email,$e.password,de),J.log("User: Sign-in process complete."),L(!1),window.location.reload()}catch(ve){J.error("User: SignIn Error:",ve);const _e=ve.message||"An error occurred while logging in. Please check your credentials.",Ee=_e.includes("verify your email");f({title:Ee?"Email Verification Required":"Error",description:_e,status:Ee?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}finally{I(!1),X.current&&X.current.reset()}},me=async()=>{if(!$){f({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:d.current});return}try{ne(!0),await hFe(O4,$),f({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:d.current}),Q(!1)}catch($e){J.error("User: Reset Password Error:",$e),f({title:"Error",description:$e.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:d.current})}finally{ne(!1)}},pe=()=>L($e=>!$e),ue=()=>{L(!1),B(!0)},Le=()=>{Q(!0)},We=n==="link"?C.jsx(Ul,{variant:"header",onClick:pe,children:t}):C.jsx(Lr,{onClick:pe,...s,children:t});return C.jsxs(C.Fragment,{children:[We,C.jsxs(Bo,{isOpen:k,onClose:pe,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(Go,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsx("form",{onSubmit:v(se),children:C.jsxs(Wo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:$e=>{$e.stopPropagation()},children:[C.jsxs(wc,{p:8,textAlign:"center",children:[C.jsx(NC,{size:"lg",mb:2,children:"Welcome Back"}),C.jsx(at,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),C.jsx(ba,{color:"gray.400"}),C.jsx(zo,{px:8,pb:8,children:C.jsxs(Ui,{spacing:4,children:[C.jsxs(hi,{isInvalid:b.email,children:[C.jsxs(Iy,{children:[C.jsx(rC,{pointerEvents:"none",children:C.jsx(nQ,{color:"gray.500"})}),C.jsx(es,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...y("email",{required:"Email is required."})})]}),C.jsx(Fh,{children:b.email&&b.email.message})]}),C.jsxs(hi,{isInvalid:b.password,children:[C.jsxs(Iy,{children:[C.jsx(rC,{pointerEvents:"none",children:C.jsx(D8e,{color:"gray.500"})}),C.jsx(es,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...y("password",{required:"Password is required."})})]}),C.jsx(Fh,{children:b.password&&b.password.message})]}),C.jsx(St,{alignSelf:"flex-end",children:C.jsx(Ul,{color:"blue.400",fontSize:"sm",onClick:Le,children:"Forgot Password?"})}),C.jsx(Wi,{width:"100%",justifyContent:"center",my:4,children:C.jsx(foe,{ref:X,sitekey:V8e,onChange:Z,theme:"dark"})})]})}),C.jsxs(Vf,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(Lr,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:w,loadingText:"Signing In",isDisabled:!de,children:"Sign In"}),C.jsxs(at,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",C.jsx(Ul,{color:"blue.400",onClick:ue,children:"Sign Up"})]})]})]})})]}),C.jsxs(Bo,{isOpen:W,onClose:()=>Q(!1),size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(Go,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsxs(Wo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:$e=>{$e.stopPropagation()},children:[C.jsxs(wc,{p:8,textAlign:"center",children:[C.jsx(NC,{size:"lg",mb:2,children:"Reset Password"}),C.jsx(at,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),C.jsx(ba,{color:"gray.400"}),C.jsx(zo,{px:8,pb:4,children:C.jsx(hi,{children:C.jsxs(Iy,{children:[C.jsx(rC,{pointerEvents:"none",children:C.jsx(nQ,{color:"gray.500"})}),C.jsx(es,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:$,onChange:$e=>ie($e.target.value)})]})})}),C.jsxs(Vf,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(Lr,{colorScheme:"blue",size:"lg",width:"100%",onClick:me,isLoading:ce,loadingText:"Sending",children:"Send Reset Link"}),C.jsxs(at,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",C.jsx(Ul,{color:"blue.400",onClick:()=>Q(!1),children:"Back to Sign In"})]})]})]})]}),C.jsx(H4,{mode:"link",isOpen:V,onClose:()=>B(!1)})]})}$4.propTypes={mode:vn.oneOf(["button","link"]),label:vn.string,buttonProps:vn.object,initialIsOpen:vn.bool};function F8e(){const{loadingProgression:n,isLoaded:t,error:s}=wa(),{user:a}=D.useContext(Cc),[l,d]=D.useState(!1),[f,y]=D.useState(!1),[v,b]=D.useState(!1),[w,I]=D.useState(!1),k=D.useRef(!1),L=D.useRef(!1),V=D.useRef(null),B=D.useRef(null),W=D.useRef(null),Q=hp(),$=D.useRef(null),ie=D.useRef(null),ce=D.useRef(null);D.useRef(null),D.useEffect(()=>{d(!a&&n===0)},[a,n]),D.useEffect(()=>{const Y=document.createElement("style");return Y.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(Y),$.current=Y,()=>{$.current&&document.head.removeChild($.current)}},[]),D.useEffect(()=>{const Y=()=>{const X=document.getElementById("unity-canvas"),Z=document.getElementById("unity-container");X&&(V.current=X,X.style.zIndex="1"),Z&&(B.current=Z,Z.style.zIndex="1"),X&&Z&&ce.current&&(clearInterval(ce.current),ce.current=null)};return Y(),ce.current=setInterval(Y,100),()=>{ce.current&&(clearInterval(ce.current),ce.current=null)}},[]),D.useEffect(()=>{window.isFirstSceneLoaded&&(L.current=!0,I(!0));const X=Q("FirstSceneLoaded",()=>{L.current=!0,I(!0),window.isFirstSceneLoaded=!0}),Z=setTimeout(()=>{L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{X(),clearTimeout(Z)}},[Q]),D.useEffect(()=>{window.isPlayerInstantiated&&(k.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0));const Y=()=>{k.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",Y);const X=Q("PlayerInstantiated",Y),Z=setTimeout(()=>{k.current||(k.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",Y),X(),clearTimeout(Z)}},[Q]),D.useEffect(()=>(w&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),ie.current&&clearTimeout(ie.current),ie.current=setTimeout(()=>{V.current&&(V.current.style.opacity="1",V.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="1",B.current.style.removeProperty("opacity")),W.current&&(W.current.style.opacity="0",W.current.style.pointerEvents="none",setTimeout(()=>{W.current&&(W.current.style.display="none")},1500))},2e3)),()=>{ie.current&&clearTimeout(ie.current)}),[w,v]);const ne=()=>t?t&&!w&&!v?"Scene initializing":w&&!v?"Player initializing":"Ready":"World loading",de=()=>t?t&&!w&&!v?85:w&&!v?95:100:n*80;return C.jsx(C.Fragment,{children:l?C.jsx(St,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:C.jsxs(Ui,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[C.jsx(at,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),C.jsx(at,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),C.jsx(Lr,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>y(!0),children:"Sign In"})]})}):C.jsx(St,{ref:W,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:C.jsxs(Wi,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[C.jsx(at,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),C.jsx(at,{fontSize:"sm",children:ne()}),C.jsx(Py,{value:de(),size:"lg",width:"100%",marginY:2})]})})})}function goe({mode:n="button",label:t="Sign Out"}){const s=hl(),{signOut:a}=D.useContext(Cc),{fullscreenRef:l}=Vd(),d=async()=>{try{await a(),s({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(y){console.error("SignOut Error:",y),s({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?C.jsx(Ul,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return C.jsx(C.Fragment,{children:f})}goe.propTypes={mode:vn.oneOf(["button","link"]),label:vn.string};function j8e(){const{user:n}=D.useContext(Cc);return C.jsx("div",{children:n!==null?C.jsx("div",{children:C.jsx(goe,{})}):C.jsxs("div",{children:[C.jsx(H4,{}),C.jsx($4,{})]})})}function B8e(){const{fullscreenRef:n}=Vd(),[t,s]=D.useState(!1),a=()=>{s(!t)};return C.jsxs(C.Fragment,{children:[C.jsx(Pf,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:C.jsx(Fo,{"aria-label":"Controller Help",icon:C.jsx(M8e,{}),onClick:a,variant:"iconButton"})}),C.jsxs(Bo,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:n},children:[C.jsx(Go,{}),C.jsxs(Wo,{children:[C.jsx(wc,{children:"Notes"}),C.jsx(ba,{}),C.jsx(zo,{children:C.jsx(at,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),C.jsx(Vf,{children:C.jsx(Lr,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var _oe={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},rQ=di.createContext&&di.createContext(_oe),Sg=function(){return Sg=Object.assign||function(n){for(var t,s=1,a=arguments.length;s<a;s++){t=arguments[s];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(n[l]=t[l])}return n},Sg.apply(this,arguments)},W8e=function(n,t){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(s[a[l]]=n[a[l]]);return s};function yoe(n){return n&&n.map(function(t,s){return di.createElement(t.tag,Sg({key:s},t.attr),yoe(t.child))})}function Tr(n){return function(t){return di.createElement(z8e,Sg({attr:Sg({},n.attr)},t),yoe(n.child))}}function z8e(n){var t=function(s){var a=n.attr,l=n.size,d=n.title,f=W8e(n,["attr","size","title"]),y=l||s.size||"1em",v;return s.className&&(v=s.className),n.className&&(v=(v?v+" ":"")+n.className),di.createElement("svg",Sg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,a,f,{className:v,style:Sg(Sg({color:n.color||s.color},s.style),n.style),height:y,width:y,xmlns:"http://www.w3.org/2000/svg"}),d&&di.createElement("title",null,d),n.children)};return rQ!==void 0?di.createElement(rQ.Consumer,null,function(s){return t(s)}):t(_oe)}function Eoe(n){return Tr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function G8e(n){return Tr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function iQ(n){return Tr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function sQ(n){return Tr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function YV(n){return Tr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function H8e(n){return Tr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function $8e(n){return Tr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function K8e(n){return Tr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function voe(n){return Tr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function q8e(n){return Tr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function Y8e(n){return Tr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function XV(n){return Tr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function JV(n){return Tr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function X8e(n){return Tr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function J8e(n){return Tr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function Q8e(n){return Tr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function QV(n){return Tr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function Z8e(n){return Tr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function eWe(n){return Tr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function tWe(n){return Tr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function nWe(n){return Tr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function rWe(n){return Tr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function Soe({open:n,onClose:t}){const s=D.useRef(null),a=dp(),{user:l}=D.useContext(Cc),d=v=>{s.current&&!s.current.contains(v.target)&&t()},f=async v=>{const b=y(v);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&s.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const w=b.data.url;if(console.log(`Avatar URL: ${w}`),a("AvatarUrlFromReact",{url:w}),l&&l.uid)try{await Nse(l.uid,w),t()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},y=v=>{try{return JSON.parse(v.data)}catch{return null}};return D.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",f)}),[n]),n&&C.jsx(Bu,{children:C.jsx(St,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:C.jsx(St,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:C.jsx("iframe",{ref:s,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function iWe({isOpen:n,onClose:t}){const[s,a]=D.useState(!1),[l,d]=D.useState(null),{user:f}=D.useContext(Cc),y=dp(),v=V=>{V.stopPropagation(),a(!0)},b=()=>{a(!1),t()},w=async V=>{if(d(V),f&&f.uid)try{await Nse(f.uid,V.url),y("AvatarUrlFromReact",{url:V.url}),t()}catch(B){console.error("Error updating RPM URL:",B)}else console.error("No authenticated user found to update rpmURL.")},I=rIe("gray.200","whiteAlpha.300"),k="rgba(0, 0, 0, 0.3)",L=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return C.jsxs(C.Fragment,{children:[C.jsx(Bu,{children:C.jsxs(Bo,{isOpen:n,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[C.jsx(Go,{bg:"rgba(0, 0, 0, 0.7)"}),C.jsxs(Wo,{bg:"gray.800",color:"white",maxW:"900px",children:[C.jsx(wc,{fontSize:"lg",children:"Customise Your Avatar"}),C.jsx(ba,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),C.jsx(zo,{pb:4,children:C.jsxs(Ui,{spacing:4,align:"stretch",children:[C.jsx(at,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),C.jsxs(rne,{columns:5,spacing:2,children:[C.jsx(St,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:k},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:C.jsxs(Ui,{spacing:1,children:[C.jsx(yn,{as:J8e,boxSize:4}),C.jsx(at,{fontSize:"xs",children:"Create Custom Avatar"})]})}),L.map(V=>C.jsxs(St,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===V.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>w(V),_hover:{bg:k},transition:"all 0.2s",aspectRatio:"1",children:[C.jsx(Gh,{src:V.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:V.name,width:"100%",height:"100%",objectFit:"cover"}),C.jsx(St,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:C.jsx(at,{fontSize:"xs",children:V.name})})]},V.id))]})]})})]})]})}),s&&C.jsx(Soe,{open:s,onClose:b})]})}function sWe(){const{fullscreenRef:n}=Vd(),[t,s]=D.useState(!1),[a,l]=D.useState(!1),[d,f]=D.useState(!1),[y,v]=D.useState(!1),{user:b}=D.useContext(Cc),[w,I]=D.useState(null),[k,L]=D.useState(!0),V=($,ie)=>!$||!ie?"?":`${$.charAt(0)}${ie.charAt(0)}`.toUpperCase(),B=async()=>{if(b!=null&&b.uid){L(!0);try{const $=await Fu(b.uid);I({rpmURL:$.rpmURL?$.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:$.firstName,lastName:$.lastName})}catch($){console.error("Error fetching profile data:",$)}finally{L(!1)}}};D.useEffect(()=>{B()},[b==null?void 0:b.uid]),D.useEffect(()=>{const $=()=>{s(!0)};return window.addEventListener("PlayerInstantiated",$),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const W=()=>l(!a),Q=()=>{l(!1),B()};return t?C.jsxs(C.Fragment,{children:[C.jsx(Pf,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:y,portalProps:{containerRef:n},children:C.jsxs(St,{position:"relative",onMouseEnter:()=>{f(!0),v(!0)},onMouseLeave:()=>{f(!1),v(!1)},cursor:"pointer",onClick:W,children:[C.jsx(sp,{src:k||w==null?void 0:w.rpmURL,size:"md",borderRadius:"full",bg:"white",name:k?V(w==null?void 0:w.firstName,w==null?void 0:w.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&C.jsx(St,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:C.jsx(at,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),C.jsx(iWe,{isOpen:a,onClose:Q})]}):null}function oWe(n){return Tr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function aWe(n){return Tr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function cWe(){const{isFullscreen:n,toggleFullscreen:t,fullscreenRef:s,isMobile:a}=Vd(),l=hl();D.useEffect(()=>{const f=y=>{console.error("Fullscreen error:",y),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const d=()=>{s.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return C.jsx(Pf,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:s},children:C.jsx(Fo,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?C.jsx(oWe,{}):C.jsx(aWe,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const oQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function lWe(){const{isOpen:n,onOpen:t,onClose:s}=Df(),{fullscreenRef:a}=Vd(),[l,d]=G6e(!1);D.useEffect(()=>{J.log("VideoPlayer: Current video URL:",l),l&&(J.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const f=()=>{J.log("VideoPlayer: Closing modal"),d(),s()};return C.jsx(Bu,{containerRef:a,children:C.jsxs(Bo,{isOpen:n,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[C.jsx(Go,{bg:"rgba(0, 0, 0, 0.8)"}),C.jsxs(Wo,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[C.jsx(ba,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),C.jsx(zo,{p:0,width:"100%",children:l&&C.jsx(St,{style:oQ.iframeContainer,children:C.jsx("iframe",{src:l,style:oQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function uWe({isOpen:n,onClose:t,playerName:s,playerId:a,uid:l}){const[d,f]=D.useState(null),[y,v]=D.useState(!0),[b,w]=D.useState(null);return D.useEffect(()=>{n&&(async()=>{if(v(!0),w(null),!l){J.warn("NameplateModal: No UID provided for player:",s),w("No user ID available for this player"),v(!1);return}try{J.log("NameplateModal: Fetching profile for UID:",l);const k=await Fu(l);k?f({firstName:k.firstName,lastName:k.lastName,linkedinUrl:k.linkedinUrl,websiteUrl:k.websiteUrl,rpmURL:k.rpmURL?k.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):w("Could not find profile data for this player")}catch(k){J.error("Error fetching profile data:",k),w("Error loading profile data")}finally{v(!1)}})()},[l,n,s]),C.jsxs(Bo,{isOpen:n,onClose:t,isCentered:!0,size:"md",children:[C.jsx(Go,{backdropFilter:"blur(10px)"}),C.jsxs(Wo,{bg:"gray.900",color:"white",borderRadius:"xl",children:[C.jsx(wc,{children:"Player Info"}),C.jsx(ba,{}),C.jsx(zo,{pb:6,children:y?C.jsx(Ste,{py:8,children:C.jsx(cp,{size:"xl",color:"blue.400"})}):b?C.jsxs(yf,{status:"warning",variant:"solid",borderRadius:"md",children:[C.jsx(Ef,{}),b]}):C.jsxs(Ui,{spacing:4,align:"center",children:[C.jsx(sp,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:s,borderWidth:"2px",borderColor:"whiteAlpha.300"}),C.jsxs(Ui,{spacing:1,children:[C.jsx(at,{fontSize:"2xl",fontWeight:"bold",children:s}),(d==null?void 0:d.firstName)&&C.jsxs(at,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),C.jsxs(at,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&C.jsxs(C.Fragment,{children:[C.jsx(gg,{borderColor:"whiteAlpha.300"}),C.jsxs(ui,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&C.jsx(Ul,{href:d.linkedinUrl,isExternal:!0,children:C.jsx(Fo,{icon:C.jsx(Eoe,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&C.jsx(Ul,{href:d.websiteUrl,isExternal:!0,children:C.jsx(Fo,{icon:C.jsx(voe,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const dWe=({isVisible:n,onToggleVisibility:t,spaceID:s})=>{const[a]=jDe("(max-width: 768px)"),[l,d]=D.useState(!1);D.useEffect(()=>{(()=>{const _e=navigator.userAgent||navigator.vendor||window.opera,ke=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(_e);d(ke),ke&&J.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const f=a||l,y=roe(),[v,b]=D.useState(!1),[w,I]=D.useState([]),[k,L]=D.useState(!1),[V,B]=D.useState({}),[W,Q]=D.useState({}),[$,ie]=D.useState(null),[ce,ne]=D.useState(!1),de=hl(),Y=window.currentUser||{},Z=(()=>{if(s)return s;if(window.spaceID)return window.spaceID;const _e=(window.location.pathname||"").split("/"),Ee=_e[_e.length-1];if(Ee&&Ee.length>5)return Ee;const ke=document.body.getAttribute("data-space-id");if(ke)return ke;const Te=localStorage.getItem("currentSpaceId");return Te||"fallback-space-id"})();D.useEffect(()=>{(async()=>{try{const Ee=await Nf(Z);Ee&&Ee.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),ne(!0)):ne(!1)}catch(Ee){console.error("UnityPlayerList: Error checking if voice is disabled:",Ee)}})();const _e=Ee=>{Ee.detail&&typeof Ee.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",Ee.detail.voiceDisabled),ne(Ee.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",_e),()=>{window.removeEventListener("SpaceVoiceSettingChanged",_e)}},[Z]),D.useEffect(()=>{const ve={};y.forEach(_e=>{if(_e.uid){if(_e.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)ve[_e.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const Ee=window.agoraClient.client.remoteUsers,ke=Ee.find(Te=>String(Te.uid)===String(_e.uid));if(ke)ve[_e.uid]=ke.uid;else{const Te=Ee.find(be=>typeof be.uid=="string"&&be.uid.includes(_e.uid));if(Te)ve[_e.uid]=Te.uid;else{const be=Ee.find(Pe=>typeof _e.uid=="string"&&_e.uid.includes(String(Pe.uid)));if(be)ve[_e.uid]=be.uid;else{const Pe=Ee.filter(xe=>!(typeof xe.uid=="string"&&xe.uid.startsWith("screen-")));Pe.length===1&&!_e.isLocalPlayer&&(ve[_e.uid]=Pe[0].uid)}}}}}}),Q(ve)},[y]);const se=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const ve=window.agoraClient.isVoiceEnabled;ve!==k&&L(ve)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ve=window.agoraClient.client.remoteUsers,_e={};ve.forEach(Ee=>{typeof Ee.uid=="string"&&Ee.uid.startsWith("screen-")||(_e[Ee.uid]=!!Ee.audioTrack&&!Ee.audioTrack.muted)}),JSON.stringify(_e)!==JSON.stringify(V)&&B(_e)}};D.useEffect(()=>{const ve=setInterval(se,500),_e=Ee=>{Ee.detail&&typeof Ee.detail.enabled=="boolean"&&L(Ee.detail.enabled)};return window.addEventListener("VoiceToggled",_e),se(),()=>{clearInterval(ve),window.removeEventListener("VoiceToggled",_e)}},[]),D.useEffect(()=>{const ve=()=>{J.log("UnityPlayerList: Player instantiated, showing list"),b(!0)};return window.addEventListener("PlayerInstantiated",ve),window.isPlayerInstantiated&&(J.log("UnityPlayerList: Player was already instantiated"),b(!0)),()=>{window.removeEventListener("PlayerInstantiated",ve)}},[]),D.useEffect(()=>{(async()=>{const _e=await Promise.all(y.map(async Ee=>{if(Ee.uid)try{const ke=await Fu(Ee.uid);let Te=null;if(ke.groups){const be=`space_${Z}_owners`,Pe=`space_${Z}_hosts`;ke.groups.includes(be)?Te="owner":ke.groups.includes(Pe)&&(Te="host")}return ue({uid:Ee.uid})&&ie(Te),{...Ee,firstName:ke.firstName,lastName:ke.lastName,linkedInProfile:ke.linkedInProfile,websiteUrl:ke.websiteUrl,rpmURL:ke.rpmURL?ke.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:Te}}catch(ke){return J.error(`Error fetching data for player ${Ee.playerName}:`,ke),Ee}return Ee}));I(_e)})()},[y,Z]);const me=[...w].sort((ve,_e)=>ve.isLocalPlayer?-1:_e.isLocalPlayer?1:0),pe=()=>{J.log("UnityPlayerList: Toggling visibility"),t&&t()},ue=ve=>!!(ve.isLocalPlayer||Y&&Y.uid&&ve.uid===Y.uid),Le=ve=>{try{if(ue(ve))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:k;if(ve.uid){if(V[ve.uid])return!0;const _e=W[ve.uid];if(_e&&V[_e])return!0;const Ee=parseInt(ve.uid);if(!isNaN(Ee)&&V[Ee])return!0}return!1}catch(_e){return console.error("Error in hasActiveMic:",_e),!1}},We=({player:ve})=>{const _e=ve.role;return _e==="owner"?C.jsxs(ui,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[C.jsx(yn,{as:YV,color:"green.400",boxSize:5}),C.jsx(vf,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):_e==="host"?C.jsxs(ui,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[C.jsx(yn,{as:QV,color:"purple.400",boxSize:5}),C.jsx(vf,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},$e=(ve,_e)=>{switch(console.log(`Action "${ve}" performed on player: ${_e.playerName}`),ve){case"mute":de({title:"Player Muted",description:`${_e.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":de({title:"Player Kicked",description:`${_e.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":de({title:"Player Promoted",description:`${_e.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return C.jsxs(St,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!f?"visible":"hidden",role:"group",children:[C.jsx(St,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:C.jsx(Fo,{icon:C.jsx(L8e,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:pe,_hover:{opacity:.8}})}),C.jsxs(at,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",y.length]}),C.jsx(St,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:C.jsx(Ui,{align:"stretch",spacing:1,width:"100%",children:me.map((ve,_e)=>{const Ee=ue(ve),ke=!ce&&Le(ve);return C.jsx(St,{children:C.jsxs(Dne,{placement:"left",trigger:"hover",children:[C.jsx(Vne,{children:C.jsxs(ui,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[C.jsx(sp,{size:"xs",src:ve.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),C.jsx(at,{fontSize:"xs",children:ve.playerName}),ve.role==="owner"&&C.jsx(yn,{as:YV,color:"green.400",boxSize:2.5}),ve.role==="host"&&C.jsx(yn,{as:QV,color:"purple.400",boxSize:2.5}),C.jsx(Dk,{}),$==="owner"&&C.jsxs(C1,{closeOnSelect:!0,placement:"bottom-end",children:[C.jsx(R1,{as:Fo,"aria-label":"Options",icon:C.jsx($8e,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:Te=>Te.stopPropagation()}),C.jsxs(I1,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[C.jsx(e0,{icon:C.jsx(nWe,{}),onClick:()=>$e("mute",ve),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:ce,children:"Mute Player"}),C.jsx(e0,{icon:C.jsx(Z8e,{}),onClick:()=>$e("promote",ve),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),C.jsx(yne,{borderColor:"whiteAlpha.300"}),C.jsx(e0,{icon:C.jsx(G8e,{}),onClick:()=>$e("kick",ve),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!ce&&(ke?C.jsx(St,{color:"green.400",children:C.jsx(JV,{})}):C.jsx(St,{color:"red.400",children:C.jsx(XV,{})})),Ee&&C.jsx(at,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),C.jsx(Une,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:C.jsx(Lne,{children:C.jsxs(Ui,{align:"center",spacing:3,children:[C.jsx(sp,{size:"xl",src:ve.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),C.jsx(at,{fontSize:"xl",fontWeight:"bold",children:ve.playerName}),C.jsx(We,{player:ve}),ve.firstName&&C.jsxs(at,{fontSize:"sm",color:"gray.300",children:[ve.firstName," ",ve.lastName]}),C.jsxs(ui,{spacing:4,pt:2,children:[ve.linkedInProfile&&C.jsx(Ul,{href:ve.linkedInProfile,isExternal:!0,children:C.jsx(Fo,{icon:C.jsx(Eoe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),ve.websiteUrl&&C.jsx(Ul,{href:ve.websiteUrl,isExternal:!0,children:C.jsx(Fo,{icon:C.jsx(voe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!ce&&C.jsx(Fo,{icon:ke?C.jsx(JV,{}):C.jsx(XV,{}),variant:"ghost",colorScheme:ke?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),ce&&C.jsx(Fo,{icon:C.jsx(tWe,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},_e)})})})]})};var gk={exports:{}},hWe=gk.exports,aQ;function pWe(){return aQ||(aQ=1,function(n,t){(function(s,a){n.exports=a()})(hWe,function(){function s(e,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof py<"u"?py:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},f=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),y=f,v=Function.prototype,b=v.call,w=y&&v.bind.bind(b,b),I=y?w:function(e){return function(){return b.apply(e,arguments)}},k=I({}.isPrototypeOf),L=function(e){return e&&e.Math==Math&&e},V=L(typeof globalThis=="object"&&globalThis)||L(typeof window=="object"&&window)||L(typeof self=="object"&&self)||L(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),B=f,W=Function.prototype,Q=W.apply,$=W.call,ie=typeof Reflect=="object"&&Reflect.apply||(B?$.bind(Q):function(){return $.apply(Q,arguments)}),ce=I,ne=ce({}.toString),de=ce("".slice),Y=function(e){return de(ne(e),8,-1)},X=Y,Z=I,se=function(e){if(X(e)==="Function")return Z(e)},me=typeof document=="object"&&document.all,pe={all:me,IS_HTMLDDA:me===void 0&&me!==void 0},ue=pe.all,Le=pe.IS_HTMLDDA?function(e){return typeof e=="function"||e===ue}:function(e){return typeof e=="function"},We={},$e=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),ve=f,_e=Function.prototype.call,Ee=ve?_e.bind(_e):function(){return _e.apply(_e,arguments)},ke={},Te={}.propertyIsEnumerable,be=Object.getOwnPropertyDescriptor,Pe=be&&!Te.call({1:2},1);ke.f=Pe?function(e){var r=be(this,e);return!!r&&r.enumerable}:Te;var xe,ze,Je=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},Ze=d,lt=Y,nt=Object,Rt=I("".split),fn=Ze(function(){return!nt("z").propertyIsEnumerable(0)})?function(e){return lt(e)=="String"?Rt(e,""):nt(e)}:nt,Ft=function(e){return e==null},on=Ft,Zt=TypeError,Yt=function(e){if(on(e))throw Zt("Can't call method on "+e);return e},Vn=fn,$t=Yt,Re=function(e){return Vn($t(e))},Ve=Le,Ge=pe.all,ht=pe.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Ve(e)||e===Ge}:function(e){return typeof e=="object"?e!==null:Ve(e)},mt={},vt=mt,Bt=V,mn=Le,En=function(e){return mn(e)?e:void 0},en=function(e,r){return arguments.length<2?En(vt[e])||En(Bt[e]):vt[e]&&vt[e][r]||Bt[e]&&Bt[e][r]},Et=typeof navigator<"u"&&String(navigator.userAgent)||"",nr=V,Nt=Et,Ut=nr.process,gn=nr.Deno,ki=Ut&&Ut.versions||gn&&gn.version,_s=ki&&ki.v8;_s&&(ze=(xe=_s.split("."))[0]>0&&xe[0]<4?1:+(xe[0]+xe[1])),!ze&&Nt&&(!(xe=Nt.match(/Edge\/(\d+)/))||xe[1]>=74)&&(xe=Nt.match(/Chrome\/(\d+)/))&&(ze=+xe[1]);var ii=ze,Ho=ii,ec=d,Ks=V.String,qs=!!Object.getOwnPropertySymbols&&!ec(function(){var e=Symbol();return!Ks(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ho&&Ho<41}),Rc=qs&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ys=en,Ca=Le,To=k,Ra=Object,tc=Rc?function(e){return typeof e=="symbol"}:function(e){var r=ys("Symbol");return Ca(r)&&To(r.prototype,Ra(e))},pl=String,Ia=function(e){try{return pl(e)}catch{return"Object"}},nc=Le,io=Ia,Ni=TypeError,gt=function(e){if(nc(e))return e;throw Ni(io(e)+" is not a function")},dn=gt,gr=Ft,fi=function(e,r){var i=e[r];return gr(i)?void 0:dn(i)},wo=Ee,so=Le,Hl=ht,pp=TypeError,fl={exports:{}},$l=V,bi=Object.defineProperty,oo=function(e,r){try{bi($l,e,{value:r,configurable:!0,writable:!0})}catch{$l[e]=r}return r},Fi="__core-js_shared__",Fd=V[Fi]||oo(Fi,{}),jd=Fd;(fl.exports=function(e,r){return jd[e]||(jd[e]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var rc=fl.exports,Bd=Yt,Wu=Object,$o=function(e){return Wu(Bd(e))},Wd=$o,$r=I({}.hasOwnProperty),Ti=Object.hasOwn||function(e,r){return $r(Wd(e),r)},Ic=I,ml=0,Aa=Math.random(),fp=Ic(1 .toString),zd=function(e){return"Symbol("+(e===void 0?"":e)+")_"+fp(++ml+Aa,36)},Kl=rc,Co=Ti,Yf=zd,ao=qs,mp=Rc,gl=V.Symbol,Gd=Kl("wks"),Hd=mp?gl.for||gl:gl&&gl.withoutSetter||Yf,_r=function(e){return Co(Gd,e)||(Gd[e]=ao&&Co(gl,e)?gl[e]:Hd("Symbol."+e)),Gd[e]},ql=Ee,Yl=ht,zu=tc,ic=fi,Ko=function(e,r){var i,o;if(so(i=e.toString)&&!Hl(o=wo(i,e))||so(i=e.valueOf)&&!Hl(o=wo(i,e)))return o;throw pp("Can't convert object to primitive value")},Gu=TypeError,_l=_r("toPrimitive"),Xl=function(e,r){if(!Yl(e)||zu(e))return e;var i,o=ic(e,_l);if(o){if(i=ql(o,e,r),!Yl(i)||zu(i))return i;throw Gu("Can't convert object to primitive value")}return Ko(e)},Xr=tc,sc=function(e){var r=Xl(e,"string");return Xr(r)?r:r+""},cr=ht,Ac=V.document,Xf=cr(Ac)&&cr(Ac.createElement),Jl=function(e){return Xf?Ac.createElement(e):{}},$d=Jl,gp=!$e&&!d(function(){return Object.defineProperty($d("div"),"a",{get:function(){return 7}}).a!=7}),Jf=$e,_p=Ee,qo=ke,us=Je,Yo=Re,Xo=sc,Ql=Ti,Jo=gp,Qo=Object.getOwnPropertyDescriptor;We.f=Jf?Qo:function(e,r){if(e=Yo(e),r=Xo(r),Jo)try{return Qo(e,r)}catch{}if(Ql(e,r))return us(!_p(qo.f,e,r),e[r])};var Qf=d,Pc=Le,Es=/#|\.prototype\./,Hu=function(e,r){var i=yl[yp(e)];return i==Zf||i!=Zl&&(Pc(r)?Qf(r):!!r)},yp=Hu.normalize=function(e){return String(e).replace(Es,".").toLowerCase()},yl=Hu.data={},Zl=Hu.NATIVE="N",Zf=Hu.POLYFILL="P",Pa=Hu,Oa=gt,El=f,Ce=se(se.bind),De=function(e,r){return Oa(e),r===void 0?e:El?Ce(e,r):function(){return e.apply(r,arguments)}},tt={},Jt=$e&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Qn=ht,wr=String,Kr=TypeError,hn=function(e){if(Qn(e))return e;throw Kr(wr(e)+" is not an object")},Fr=$e,wi=gp,Ms=Jt,Zo=hn,ea=sc,$u=TypeError,rs=Object.defineProperty,vl=Object.getOwnPropertyDescriptor,Kd="enumerable",Oc="configurable",Fg="writable";tt.f=Fr?Ms?function(e,r,i){if(Zo(e),r=ea(r),Zo(i),typeof e=="function"&&r==="prototype"&&"value"in i&&Fg in i&&!i[Fg]){var o=vl(e,r);o&&o[Fg]&&(e[r]=i.value,i={configurable:Oc in i?i[Oc]:o[Oc],enumerable:Kd in i?i[Kd]:o[Kd],writable:!1})}return rs(e,r,i)}:rs:function(e,r,i){if(Zo(e),r=ea(r),Zo(i),wi)try{return rs(e,r,i)}catch{}if("get"in i||"set"in i)throw $u("Accessors not supported");return"value"in i&&(e[r]=i.value),e};var em=tt,Ku=Je,ta=$e?function(e,r,i){return em.f(e,r,Ku(1,i))}:function(e,r,i){return e[r]=i,e},eu=V,tm=ie,jg=se,Qy=Le,nm=We.f,rm=Pa,qu=mt,Yu=De,Xu=ta,Bg=Ti,Zy=function(e){var r=function(i,o,c){if(this instanceof r){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,c)}return tm(e,this,arguments)};return r.prototype=e.prototype,r},zn=function(e,r){var i,o,c,u,h,m,_,E,S,R=e.target,P=e.global,N=e.stat,G=e.proto,F=P?eu:N?eu[R]:(eu[R]||{}).prototype,j=P?qu:qu[R]||Xu(qu,R,{})[R],q=j.prototype;for(u in r)o=!(i=rm(P?u:R+(N?".":"#")+u,e.forced))&&F&&Bg(F,u),m=j[u],o&&(_=e.dontCallGetSet?(S=nm(F,u))&&S.value:F[u]),h=o&&_?_:r[u],o&&typeof m==typeof h||(E=e.bind&&o?Yu(h,eu):e.wrap&&o?Zy(h):G&&Qy(h)?jg(h):h,(e.sham||h&&h.sham||m&&m.sham)&&Xu(E,"sham",!0),Xu(j,u,E),G&&(Bg(qu,c=R+"Prototype")||Xu(qu,c,{}),Xu(qu[c],u,h),e.real&&q&&(i||!q[u])&&Xu(q,u,h)))},im=Math.ceil,na=Math.floor,eE=Math.trunc||function(e){var r=+e;return(r>0?na:im)(r)},tE=eE,kc=function(e){var r=+e;return r!=r||r===0?0:tE(r)},A=kc,z=Math.max,re=Math.min,ge=function(e,r){var i=A(e);return i<0?z(i+r,0):re(i,r)},qe=kc,ot=Math.min,Vt=function(e){return e>0?ot(qe(e),9007199254740991):0},Jr=Vt,mi=function(e){return Jr(e.length)},Cr=Re,Ys=ge,vs=mi,oc=function(e){return function(r,i,o){var c,u=Cr(r),h=vs(u),m=Ys(o,h);if(e&&i!=i){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((e||m in u)&&u[m]===i)return e||m||0;return!e&&-1}},ra={includes:oc(!0),indexOf:oc(!1)},Ep=ra.includes;zn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return Ep(this,e,arguments.length>1?arguments[1]:void 0)}});var sm=mt,ac=function(e){return sm[e+"Prototype"]},mR=ac("Array").includes,gR=ht,om=Y,fN=_r("match"),_R=function(e){var r;return gR(e)&&((r=e[fN])!==void 0?!!r:om(e)=="RegExp")},mN=_R,yR=TypeError,$0={};$0[_r("toStringTag")]="z";var vp=String($0)==="[object z]",Wg=vp,gN=Le,Sp=Y,_N=_r("toStringTag"),ER=Object,K0=Sp(function(){return arguments}())=="Arguments",Nc=Wg?Sp:function(e){var r,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(r=ER(e),_N))=="string"?i:K0?Sp(r):(o=Sp(r))=="Object"&&gN(r.callee)?"Arguments":o},vR=Nc,SR=String,ka=function(e){if(vR(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return SR(e)},yN=_r("match"),EN=zn,vN=function(e){if(mN(e))throw yR("The method doesn't accept regular expressions");return e},SN=Yt,bR=ka,Sl=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[yN]=!1,"/./"[e](r)}catch{}}return!1},zg=I("".indexOf);EN({target:"String",proto:!0,forced:!Sl("includes")},{includes:function(e){return!!~zg(bR(SN(this)),bR(vN(e)),arguments.length>1?arguments[1]:void 0)}});var TR=ac("String").includes,q0=k,wR=mR,CR=TR,Gg=Array.prototype,Y0=String.prototype,bN=function(e){var r=e.includes;return e===Gg||q0(Gg,e)&&r===Gg.includes?wR:typeof e=="string"||e===Y0||q0(Y0,e)&&r===Y0.includes?CR:r},st=l(bN),X0=gt,Hg=$o,J0=fn,RR=mi,nE=TypeError,am=function(e){return function(r,i,o,c){X0(i);var u=Hg(r),h=J0(u),m=RR(u),_=e?m-1:0,E=e?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=E;break}if(_+=E,e?_<0:m<=_)throw nE("Reduce of empty array with no initial value")}for(;e?_>=0:m>_;_+=E)_ in h&&(c=i(c,h[_],_,u));return c}},Q0={left:am(!1)},IR=d,bp=function(e,r){var i=[][e];return!!i&&IR(function(){i.call(null,r||function(){return 1},1)})},Tp=typeof process<"u"&&Y(process)=="process",AR=Q0.left;zn({target:"Array",proto:!0,forced:!Tp&&ii>79&&ii<83||!bp("reduce")},{reduce:function(e){var r=arguments.length;return AR(this,e,r,r>1?arguments[1]:void 0)}});var PR=ac("Array").reduce,OR=k,kR=PR,rE=Array.prototype,qd=function(e){var r=e.reduce;return e===rE||OR(rE,e)&&r===rE.reduce?kR:r},iE=qd,cc=l(iE),TN=Y,$g=Array.isArray||function(e){return TN(e)=="Array"},Kg=zn,wN=$g,NR=I([].reverse),Z0=[1,2];Kg({target:"Array",proto:!0,forced:String(Z0)===String(Z0.reverse())},{reverse:function(){return wN(this)&&(this.length=this.length),NR(this)}});var Di=ac("Array").reverse,eb=k,sE=Di,wp=Array.prototype,DR=function(e){var r=e.reverse;return e===wp||eb(wp,e)&&r===wp.reverse?sE:r},oE=DR,cm=l(oE),aE=zd,Cp=rc("keys"),qg=function(e){return Cp[e]||(Cp[e]=aE(e))},CN=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),RN=Ti,xR=Le,cE=$o,lE=CN,uE=qg("IE_PROTO"),Yg=Object,tb=Yg.prototype,Xg=lE?Yg.getPrototypeOf:function(e){var r=cE(e);if(RN(r,uE))return r[uE];var i=r.constructor;return xR(i)&&r instanceof i?i.prototype:r instanceof Yg?tb:null},IN=I,LR=gt,AN=Le,PN=String,nb=TypeError,Yd=function(e,r,i){try{return IN(LR(Object.getOwnPropertyDescriptor(e,r)[i]))}catch{}},MR=hn,lm=function(e){if(typeof e=="object"||AN(e))return e;throw nb("Can't set "+PN(e)+" as a prototype")},tu=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,i={};try{(e=Yd(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(o,c){return MR(o),lm(c),r?e(o,c):o.__proto__=c,o}}():void 0),Xd={},Dc={},Jg=Ti,ON=Re,kN=ra.indexOf,Rp=Dc,um=I([].push),Ip=function(e,r){var i,o=ON(e),c=0,u=[];for(i in o)!Jg(Rp,i)&&Jg(o,i)&&um(u,i);for(;r.length>c;)Jg(o,i=r[c++])&&(~kN(u,i)||um(u,i));return u},dm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],rb=Ip,hm=dm.concat("length","prototype");Xd.f=Object.getOwnPropertyNames||function(e){return rb(e,hm)};var xc={};xc.f=Object.getOwnPropertySymbols;var xi=en,Ci=Xd,Jd=xc,Ro=hn,Na=I([].concat),Ap=xi("Reflect","ownKeys")||function(e){var r=Ci.f(Ro(e)),i=Jd.f;return i?Na(r,i(e)):r},Pp=Ti,Da=Ap,dE=We,UR=tt,hE={},pE=Ip,VR=dm,Lc=Object.keys||function(e){return pE(e,VR)},fE=$e,ib=Jt,FR=tt,NN=hn,Qd=Re,pm=Lc;hE.f=fE&&!ib?Object.defineProperties:function(e,r){NN(e);for(var i,o=Qd(r),c=pm(r),u=c.length,h=0;u>h;)FR.f(e,i=c[h++],o[i]);return e};var Ju,Qg=en("document","documentElement"),mE=hn,Mc=hE,lc=dm,Op=Dc,Qu=Qg,Zu=Jl,ed="prototype",gE="script",_E=qg("IE_PROTO"),Zg=function(){},xa=function(e){return"<"+gE+">"+e+"</"+gE+">"},La=function(e){e.write(xa("")),e.close();var r=e.parentWindow.Object;return e=null,r},gi=function(){try{Ju=new ActiveXObject("htmlfile")}catch{}var e,r,i;gi=typeof document<"u"?document.domain&&Ju?La(Ju):(r=Zu("iframe"),i="java"+gE+":",r.style.display="none",Qu.appendChild(r),r.src=String(i),(e=r.contentWindow.document).open(),e.write(xa("document.F=Object")),e.close(),e.F):La(Ju);for(var o=lc.length;o--;)delete gi[ed][lc[o]];return gi()};Op[_E]=!0;var ia=Object.create||function(e,r){var i;return e!==null?(Zg[ed]=mE(e),i=new Zg,Zg[ed]=null,i[_E]=e):i=gi(),r===void 0?i:Mc.f(i,r)},jR=ht,BR=ta,yE=Error,sb=I("".replace),WR=String(yE("zxcasd").stack),e_=/\n\s*at [^:]*:[^\n]*/,zR=e_.test(WR),fm=Je,ob=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",fm(1,7)),e.stack!==7)}),DN=ta,t_=function(e,r){if(zR&&typeof e=="string"&&!yE.prepareStackTrace)for(;r--;)e=sb(e,e_,"");return e},EE=ob,ab=Error.captureStackTrace,Zd={},mm=Zd,GR=_r("iterator"),vE=Array.prototype,n_=function(e){return e!==void 0&&(mm.Array===e||vE[GR]===e)},gm=Nc,SE=fi,cb=Ft,lb=Zd,ub=_r("iterator"),td=function(e){if(!cb(e))return SE(e,ub)||SE(e,"@@iterator")||lb[gm(e)]},Uc=Ee,kp=gt,db=hn,HR=Ia,nd=td,eh=TypeError,r_=function(e,r){var i=arguments.length<2?nd(e):r;if(kp(i))return db(Uc(i,e));throw eh(HR(e)+" is not iterable")},$R=Ee,nu=hn,th=fi,i_=function(e,r,i){var o,c;nu(e);try{if(!(o=th(e,"return"))){if(r==="throw")throw i;return i}o=$R(o,e)}catch(u){c=!0,o=u}if(r==="throw")throw i;if(c)throw o;return nu(o),i},KR=De,bE=Ee,qR=hn,s_=Ia,ru=n_,o_=mi,_m=k,Np=r_,hb=td,Dp=i_,YR=TypeError,ym=function(e,r){this.stopped=e,this.result=r},ji=ym.prototype,nh=function(e,r,i){var o,c,u,h,m,_,E,S=i&&i.that,R=!(!i||!i.AS_ENTRIES),P=!(!i||!i.IS_RECORD),N=!(!i||!i.IS_ITERATOR),G=!(!i||!i.INTERRUPTED),F=KR(r,S),j=function(ee){return o&&Dp(o,"normal",ee),new ym(!0,ee)},q=function(ee){return R?(qR(ee),G?F(ee[0],ee[1],j):F(ee[0],ee[1])):G?F(ee,j):F(ee)};if(P)o=e.iterator;else if(N)o=e;else{if(!(c=hb(e)))throw YR(s_(e)+" is not iterable");if(ru(c)){for(u=0,h=o_(e);h>u;u++)if((m=q(e[u]))&&_m(ji,m))return m;return new ym(!1)}o=Np(e,c)}for(_=P?e.next:o.next;!(E=bE(_,o)).done;){try{m=q(E.value)}catch(ee){Dp(o,"throw",ee)}if(typeof m=="object"&&m&&_m(ji,m))return m}return new ym(!1)},pb=ka,fb=zn,TE=k,mb=Xg,iu=tu,Hi=function(e,r,i){for(var o=Da(r),c=UR.f,u=dE.f,h=0;h<o.length;h++){var m=o[h];Pp(e,m)||i&&Pp(i,m)||c(e,m,u(r,m))}},Ss=ia,bs=ta,Em=Je,a_=function(e,r){jR(r)&&"cause"in r&&BR(e,"cause",r.cause)},c_=function(e,r,i,o){EE&&(ab?ab(e,r):DN(e,"stack",t_(i,o)))},xN=nh,Io=function(e,r){return e===void 0?arguments.length<2?"":r:pb(e)},gb=_r("toStringTag"),vm=Error,_b=[].push,sa=function(e,r){var i,o=TE(Ma,this);iu?i=iu(vm(),o?mb(this):Ma):(i=o?this:Ss(Ma),bs(i,gb,"Error")),r!==void 0&&bs(i,"message",Io(r)),c_(i,sa,i.stack,1),arguments.length>2&&a_(i,arguments[2]);var c=[];return xN(e,_b,{that:c}),bs(i,"errors",c),i};iu?iu(sa,vm):Hi(sa,vm,{name:!0});var Ma=sa.prototype=Ss(vm.prototype,{constructor:Em(1,sa),message:Em(1,""),name:Em(1,"AggregateError")});fb({global:!0},{AggregateError:sa});var rh,xp,Sm,XR=Le,yb=V.WeakMap,JR=XR(yb)&&/native code/.test(String(yb)),Eb=V,QR=ht,ZR=ta,wE=Ti,CE=Fd,l_=qg,eI=Dc,u_="Object already initialized",bm=Eb.TypeError,tI=Eb.WeakMap;if(JR||CE.state){var Vc=CE.state||(CE.state=new tI);Vc.get=Vc.get,Vc.has=Vc.has,Vc.set=Vc.set,rh=function(e,r){if(Vc.has(e))throw bm(u_);return r.facade=e,Vc.set(e,r),r},xp=function(e){return Vc.get(e)||{}},Sm=function(e){return Vc.has(e)}}else{var Lp=l_("state");eI[Lp]=!0,rh=function(e,r){if(wE(e,Lp))throw bm(u_);return r.facade=e,ZR(e,Lp,r),r},xp=function(e){return wE(e,Lp)?e[Lp]:{}},Sm=function(e){return wE(e,Lp)}}var ih,vb,Sb,rd={set:rh,get:xp,has:Sm,enforce:function(e){return Sm(e)?xp(e):rh(e,{})},getterFor:function(e){return function(r){var i;if(!QR(r)||(i=xp(r)).type!==e)throw bm("Incompatible receiver, "+e+" required");return i}}},RE=$e,nI=Ti,bb=Function.prototype,LN=RE&&Object.getOwnPropertyDescriptor,Tb=nI(bb,"name"),rI={PROPER:Tb&&(function(){}).name==="something",CONFIGURABLE:Tb&&(!RE||RE&&LN(bb,"name").configurable)},MN=ta,id=function(e,r,i,o){return o&&o.enumerable?e[r]=i:MN(e,r,i),e},iI=d,sI=Le,IE=ht,UN=ia,oI=Xg,VN=id,uc=_r("iterator"),AE=!1;[].keys&&("next"in(Sb=[].keys())?(vb=oI(oI(Sb)))!==Object.prototype&&(ih=vb):AE=!0);var PE=!IE(ih)||iI(function(){var e={};return ih[uc].call(e)!==e});sI((ih=PE?{}:UN(ih))[uc])||VN(ih,uc,function(){return this});var wb={IteratorPrototype:ih,BUGGY_SAFARI_ITERATORS:AE},aI=Nc,cI=vp?{}.toString:function(){return"[object "+aI(this)+"]"},Cb=vp,Tm=tt.f,Rb=ta,Ib=Ti,FN=cI,Ab=_r("toStringTag"),sd=function(e,r,i,o){if(e){var c=i?e:e.prototype;Ib(c,Ab)||Tm(c,Ab,{configurable:!0,value:r}),o&&!Cb&&Rb(c,"toString",FN)}},lI=wb.IteratorPrototype,uI=ia,dI=Je,jN=sd,Ua=Zd,oa=function(){return this},OE=function(e,r,i,o){var c=r+" Iterator";return e.prototype=uI(lI,{next:dI(+!o,i)}),jN(e,c,!1,!0),Ua[c]=oa,e},hI=zn,pI=Ee,fI=rI,mI=OE,Pb=Xg,gI=sd,kE=id,Ob=Zd,_I=wb,kb=fI.PROPER,wm=_I.BUGGY_SAFARI_ITERATORS,NE=_r("iterator"),DE="keys",Mp="values",yI="entries",EI=function(){return this},xE=function(e,r,i,o,c,u,h){mI(i,r,o);var m,_,E,S=function(q){if(q===c&&F)return F;if(!wm&&q in N)return N[q];switch(q){case DE:case Mp:case yI:return function(){return new i(this,q)}}return function(){return new i(this)}},R=r+" Iterator",P=!1,N=e.prototype,G=N[NE]||N["@@iterator"]||c&&N[c],F=!wm&&G||S(c),j=r=="Array"&&N.entries||G;if(j&&(m=Pb(j.call(new e)))!==Object.prototype&&m.next&&(gI(m,R,!0,!0),Ob[R]=EI),kb&&c==Mp&&G&&G.name!==Mp&&(P=!0,F=function(){return pI(G,this)}),c)if(_={values:S(Mp),keys:u?F:S(DE),entries:S(yI)},h)for(E in _)(wm||P||!(E in N))&&kE(N,E,_[E]);else hI({target:r,proto:!0,forced:wm||P},_);return h&&N[NE]!==F&&kE(N,NE,F,{}),Ob[r]=F,_},LE=function(e,r){return{value:e,done:r}},ME=Re,su=Zd,vI=rd;tt.f;var SI=xE,UE=LE,Nb="Array Iterator",bI=vI.set,d_=vI.getterFor(Nb);SI(Array,"Array",function(e,r){bI(this,{type:Nb,target:ME(e),index:0,kind:r})},function(){var e=d_(this),r=e.target,i=e.kind,o=e.index++;return!r||o>=r.length?(e.target=void 0,UE(void 0,!0)):UE(i=="keys"?o:i=="values"?r[o]:[o,r[o]],!1)},"values"),su.Arguments=su.Array;var Ao=tt,VE=function(e,r,i){return Ao.f(e,r,i)},BN=en,FE=VE,Po=$e,TI=_r("species"),tn=k,Cm=TypeError,h_=function(e,r){if(tn(r,e))return e;throw Cm("Incorrect invocation")},wI=Le,Db=Fd,p_=I(Function.toString);wI(Db.inspectSource)||(Db.inspectSource=function(e){return p_(e)});var f_=Db.inspectSource,xb=I,CI=d,Lb=Le,RI=Nc,Mb=f_,jE=function(){},co=[],Fc=en("Reflect","construct"),ou=/^\s*(?:class|function)\b/,II=xb(ou.exec),AI=!ou.exec(jE),aa=function(e){if(!Lb(e))return!1;try{return Fc(jE,co,e),!0}catch{return!1}},Ub=function(e){if(!Lb(e))return!1;switch(RI(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return AI||!!II(ou,Mb(e))}catch{return!0}};Ub.sham=!0;var Va,Rm,Vb,BE,m_=!Fc||CI(function(){var e;return aa(aa.call)||!aa(Object)||!aa(function(){e=!0})||e})?Ub:aa,PI=m_,WN=Ia,WE=TypeError,zE=hn,jc=function(e){if(PI(e))return e;throw WE(WN(e)+" is not a constructor")},Or=Ft,Xs=_r("species"),is=function(e,r){var i,o=zE(e).constructor;return o===void 0||Or(i=zE(o)[Xs])?r:jc(i)},Ts=I([].slice),dc=TypeError,bl=function(e,r){if(e<r)throw dc("Not enough arguments");return e},ws=/(?:ipad|iphone|ipod).*applewebkit/i.test(Et),lo=V,Up=ie,GE=De,HE=Le,g_=Ti,ca=d,$E=Qg,Im=Ts,au=Jl,KE=bl,Fb=ws,sh=Tp,Am=lo.setImmediate,cu=lo.clearImmediate,qE=lo.process,Vp=lo.Dispatch,jb=lo.Function,__=lo.MessageChannel,YE=lo.String,uo=0,Bc={},Wc="onreadystatechange";ca(function(){Va=lo.location});var Oo=function(e){if(g_(Bc,e)){var r=Bc[e];delete Bc[e],r()}},XE=function(e){return function(){Oo(e)}},JE=function(e){Oo(e.data)},QE=function(e){lo.postMessage(YE(e),Va.protocol+"//"+Va.host)};Am&&cu||(Am=function(e){KE(arguments.length,1);var r=HE(e)?e:jb(e),i=Im(arguments,1);return Bc[++uo]=function(){Up(r,void 0,i)},Rm(uo),uo},cu=function(e){delete Bc[e]},sh?Rm=function(e){qE.nextTick(XE(e))}:Vp&&Vp.now?Rm=function(e){Vp.now(XE(e))}:__&&!Fb?(BE=(Vb=new __).port2,Vb.port1.onmessage=JE,Rm=GE(BE.postMessage,BE)):lo.addEventListener&&HE(lo.postMessage)&&!lo.importScripts&&Va&&Va.protocol!=="file:"&&!ca(QE)?(Rm=QE,lo.addEventListener("message",JE,!1)):Rm=Wc in au("script")?function(e){$E.appendChild(au("script"))[Wc]=function(){$E.removeChild(this),Oo(e)}}:function(e){setTimeout(XE(e),0)});var ZE={set:Am,clear:cu},od=function(){this.head=null,this.tail=null};od.prototype={add:function(e){var r={item:e,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Fp,y_,ad,E_,oh,Bb=od,OI=/ipad|iphone|ipod/i.test(Et)&&typeof Pebble<"u",Wb=/web0s(?!.*chrome)/i.test(Et),lu=V,kI=De,zN=We.f,ev=ZE.set,NI=Bb,jp=ws,GN=OI,Pm=Wb,tv=Tp,$i=lu.MutationObserver||lu.WebKitMutationObserver,DI=lu.document,zb=lu.process,nv=lu.Promise,xI=zN(lu,"queueMicrotask"),rv=xI&&xI.value;if(!rv){var v_=new NI,iv=function(){var e,r;for(tv&&(e=zb.domain)&&e.exit();r=v_.get();)try{r()}catch(i){throw v_.head&&Fp(),i}e&&e.enter()};jp||tv||Pm||!$i||!DI?!GN&&nv&&nv.resolve?((E_=nv.resolve(void 0)).constructor=nv,oh=kI(E_.then,E_),Fp=function(){oh(iv)}):tv?Fp=function(){zb.nextTick(iv)}:(ev=kI(ev,lu),Fp=function(){ev(iv)}):(y_=!0,ad=DI.createTextNode(""),new $i(iv).observe(ad,{characterData:!0}),Fp=function(){ad.data=y_=!y_}),rv=function(e){v_.head||Fp(),v_.add(e)}}var hc=rv,ah=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},Bp=V.Promise,cd=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",sv=!cd&&!Tp&&typeof window=="object"&&typeof document=="object",Wp=V,ch=Bp,Gb=Le,Hb=Pa,HN=f_,$b=_r,$N=sv,LI=cd,ov=ii,S_=ch&&ch.prototype,av=$b("species"),Kb=Gb(Wp.PromiseRejectionEvent),qb=Hb("Promise",function(){var e=HN(ch),r=e!==String(ch);if(!r&&ov===66||!S_.catch||!S_.finally)return!0;if(!ov||ov<51||!/native code/.test(e)){var i=new ch(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((i.constructor={})[av]=o,!(i.then(function(){})instanceof o))return!0}return!r&&($N||LI)&&!Kb}),b_={CONSTRUCTOR:qb,REJECTION_EVENT:Kb},Tl={},cv=gt,lv=TypeError,Yb=function(e){var r,i;this.promise=new e(function(o,c){if(r!==void 0||i!==void 0)throw lv("Bad Promise constructor");r=o,i=c}),this.resolve=cv(r),this.reject=cv(i)};Tl.f=function(e){return new Yb(e)};var Om,Xb,KN=zn,zp=Tp,lh=V,ld=Ee,qN=id,uv=sd,p=function(e){var r=BN(e);Po&&r&&!r[TI]&&FE(r,TI,{configurable:!0,get:function(){return this}})},g=gt,T=Le,O=ht,U=h_,H=is,le=ZE.set,Ie=hc,Ue=function(e,r){try{arguments.length==1?console.error(e):console.error(e,r)}catch{}},rt=ah,Ot=Bb,kt=rd,Pt=Bp,qt=b_,rn=Tl,sn="Promise",ss=qt.CONSTRUCTOR,Xe=qt.REJECTION_EVENT,Fe=kt.getterFor(sn),et=kt.set,Lt=Pt&&Pt.prototype,an=Pt,Sn=Lt,Cn=lh.TypeError,Fn=lh.document,Cs=lh.process,Rr=rn.f,uh=Rr,YN=!!(Fn&&Fn.createEvent&&lh.dispatchEvent),Y4="unhandledrejection",X4=function(e){var r;return!(!O(e)||!T(r=e.then))&&r},J4=function(e,r){var i,o,c,u=r.value,h=r.state==1,m=h?e.ok:e.fail,_=e.resolve,E=e.reject,S=e.domain;try{m?(h||(r.rejection===2&&Loe(r),r.rejection=1),m===!0?i=u:(S&&S.enter(),i=m(u),S&&(S.exit(),c=!0)),i===e.promise?E(Cn("Promise-chain cycle")):(o=X4(i))?ld(o,i,_,E):_(i)):E(u)}catch(R){S&&!c&&S.exit(),E(R)}},Q4=function(e,r){e.notified||(e.notified=!0,Ie(function(){for(var i,o=e.reactions;i=o.get();)J4(i,e);e.notified=!1,r&&!e.rejection&&xoe(e)}))},Z4=function(e,r,i){var o,c;YN?((o=Fn.createEvent("Event")).promise=r,o.reason=i,o.initEvent(e,!1,!0),lh.dispatchEvent(o)):o={promise:r,reason:i},!Xe&&(c=lh["on"+e])?c(o):e===Y4&&Ue("Unhandled promise rejection",i)},xoe=function(e){ld(le,lh,function(){var r,i=e.facade,o=e.value;if(e3(e)&&(r=rt(function(){zp?Cs.emit("unhandledRejection",o,i):Z4(Y4,i,o)}),e.rejection=zp||e3(e)?2:1,r.error))throw r.value})},e3=function(e){return e.rejection!==1&&!e.parent},Loe=function(e){ld(le,lh,function(){var r=e.facade;zp?Cs.emit("rejectionHandled",r):Z4("rejectionhandled",r,e.value)})},dv=function(e,r,i){return function(o){e(r,o,i)}},hv=function(e,r,i){e.done||(e.done=!0,i&&(e=i),e.value=r,e.state=2,Q4(e,!0))},XN=function(e,r,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===r)throw Cn("Promise can't be resolved itself");var o=X4(r);o?Ie(function(){var c={done:!1};try{ld(o,r,dv(XN,c,e),dv(hv,c,e))}catch(u){hv(c,u,e)}}):(e.value=r,e.state=1,Q4(e,!1))}catch(c){hv({done:!1},c,e)}}};ss&&(Sn=(an=function(e){U(this,Sn),g(e),ld(Om,this);var r=Fe(this);try{e(dv(XN,r),dv(hv,r))}catch(i){hv(r,i)}}).prototype,(Om=function(e){et(this,{type:sn,done:!1,notified:!1,parent:!1,reactions:new Ot,rejection:!1,state:0,value:void 0})}).prototype=qN(Sn,"then",function(e,r){var i=Fe(this),o=Rr(H(this,an));return i.parent=!0,o.ok=!T(e)||e,o.fail=T(r)&&r,o.domain=zp?Cs.domain:void 0,i.state==0?i.reactions.add(o):Ie(function(){J4(o,i)}),o.promise}),Xb=function(){var e=new Om,r=Fe(e);this.promise=e,this.resolve=dv(XN,r),this.reject=dv(hv,r)},rn.f=Rr=function(e){return e===an||e===void 0?new Xb(e):uh(e)}),KN({global:!0,wrap:!0,forced:ss},{Promise:an}),uv(an,sn,!1,!0),p(sn);var t3=_r("iterator"),n3=!1;try{var Moe=0,r3={next:function(){return{done:!!Moe++}},return:function(){n3=!0}};r3[t3]=function(){return this},Array.from(r3,function(){throw 2})}catch{}var Uoe=Bp,Voe=function(e,r){if(!n3)return!1;var i=!1;try{var o={};o[t3]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},MI=b_.CONSTRUCTOR||!Voe(function(e){Uoe.all(e).then(void 0,function(){})}),Foe=Ee,joe=gt,Boe=Tl,Woe=ah,zoe=nh;zn({target:"Promise",stat:!0,forced:MI},{all:function(e){var r=this,i=Boe.f(r),o=i.resolve,c=i.reject,u=Woe(function(){var h=joe(r.resolve),m=[],_=0,E=1;zoe(e,function(S){var R=_++,P=!1;E++,Foe(h,r,S).then(function(N){P||(P=!0,m[R]=N,--E||o(m))},c)}),--E||o(m)});return u.error&&c(u.value),i.promise}});var Goe=zn,Hoe=b_.CONSTRUCTOR;Bp&&Bp.prototype,Goe({target:"Promise",proto:!0,forced:Hoe,real:!0},{catch:function(e){return this.then(void 0,e)}});var $oe=Ee,Koe=gt,qoe=Tl,Yoe=ah,Xoe=nh;zn({target:"Promise",stat:!0,forced:MI},{race:function(e){var r=this,i=qoe.f(r),o=i.reject,c=Yoe(function(){var u=Koe(r.resolve);Xoe(e,function(h){$oe(u,r,h).then(i.resolve,o)})});return c.error&&o(c.value),i.promise}});var Joe=Ee,Qoe=Tl;zn({target:"Promise",stat:!0,forced:b_.CONSTRUCTOR},{reject:function(e){var r=Qoe.f(this);return Joe(r.reject,void 0,e),r.promise}});var Zoe=hn,eae=ht,tae=Tl,i3=function(e,r){if(Zoe(e),eae(r)&&r.constructor===e)return r;var i=tae.f(e);return(0,i.resolve)(r),i.promise},nae=zn,rae=Bp,iae=b_.CONSTRUCTOR,sae=i3,oae=en("Promise"),aae=!iae;nae({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return sae(aae&&this===oae?rae:this,e)}});var cae=Ee,lae=gt,uae=Tl,dae=ah,hae=nh;zn({target:"Promise",stat:!0,forced:MI},{allSettled:function(e){var r=this,i=uae.f(r),o=i.resolve,c=i.reject,u=dae(function(){var h=lae(r.resolve),m=[],_=0,E=1;hae(e,function(S){var R=_++,P=!1;E++,cae(h,r,S).then(function(N){P||(P=!0,m[R]={status:"fulfilled",value:N},--E||o(m))},function(N){P||(P=!0,m[R]={status:"rejected",reason:N},--E||o(m))})}),--E||o(m)});return u.error&&c(u.value),i.promise}});var pae=Ee,fae=gt,mae=en,gae=Tl,_ae=ah,yae=nh,s3="No one promise resolved";zn({target:"Promise",stat:!0,forced:MI},{any:function(e){var r=this,i=mae("AggregateError"),o=gae.f(r),c=o.resolve,u=o.reject,h=_ae(function(){var m=fae(r.resolve),_=[],E=0,S=1,R=!1;yae(e,function(P){var N=E++,G=!1;S++,pae(m,r,P).then(function(F){G||R||(R=!0,c(F))},function(F){G||R||(G=!0,_[N]=F,--S||u(new i(_,s3)))})}),--S||u(new i(_,s3))});return h.error&&u(h.value),o.promise}});var Eae=zn,JN=Bp,vae=d,Sae=en,bae=Le,Tae=is,o3=i3,wae=JN&&JN.prototype;Eae({target:"Promise",proto:!0,real:!0,forced:!!JN&&vae(function(){wae.finally.call({then:function(){}},function(){})})},{finally:function(e){var r=Tae(this,Sae("Promise")),i=bae(e);return this.then(i?function(o){return o3(r,e()).then(function(){return o})}:e,i?function(o){return o3(r,e()).then(function(){throw o})}:e)}});var QN=I,Cae=kc,Rae=ka,Iae=Yt,Aae=QN("".charAt),a3=QN("".charCodeAt),Pae=QN("".slice),c3=function(e){return function(r,i){var o,c,u=Rae(Iae(r)),h=Cae(i),m=u.length;return h<0||h>=m?e?"":void 0:(o=a3(u,h))<55296||o>56319||h+1===m||(c=a3(u,h+1))<56320||c>57343?e?Aae(u,h):o:e?Pae(u,h,h+2):c-56320+(o-55296<<10)+65536}},ZN={codeAt:c3(!1),charAt:c3(!0)},Oae=ZN.charAt,kae=ka,l3=rd,Nae=xE,u3=LE,d3="String Iterator",Dae=l3.set,xae=l3.getterFor(d3);Nae(String,"String",function(e){Dae(this,{type:d3,string:kae(e),index:0})},function(){var e,r=xae(this),i=r.string,o=r.index;return o>=i.length?u3(void 0,!0):(e=Oae(i,o),r.index+=e.length,u3(e,!1))});var Lae=mt.Promise,Mae={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Uae=V,Vae=Nc,Fae=ta,h3=Zd,p3=_r("toStringTag");for(var eD in Mae){var f3=Uae[eD],tD=f3&&f3.prototype;tD&&Vae(tD)!==p3&&Fae(tD,p3,eD),h3[eD]=h3.Array}var m3=Lae,ut=l(m3),jae=ac("Array").values,Bae=Nc,Wae=Ti,zae=k,Gae=jae,nD=Array.prototype,Hae={DOMTokenList:!0,NodeList:!0},$ae=function(e){var r=e.values;return e===nD||zae(nD,e)&&r===nD.values||Wae(Hae,Bae(e))?Gae:r},zc=l($ae),Kae=d,qae=_r("iterator"),rD=!Kae(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),r=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),o+=u+c}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!r.size&&!0||!r.sort||e.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[qae]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Yae=id,Xae=sc,Jae=tt,Qae=Je,UI=function(e,r,i){var o=Xae(r);o in e?Jae.f(e,o,Qae(0,i)):e[o]=i},g3=ge,Zae=mi,ece=UI,tce=Array,nce=Math.max,iD=function(e,r,i){for(var o=Zae(e),c=g3(r,o),u=g3(i===void 0?o:i,o),h=tce(nce(u-c,0)),m=0;c<u;c++,m++)ece(h,m,e[c]);return h.length=m,h},_3=iD,rce=Math.floor,sD=function(e,r){var i=e.length,o=rce(i/2);return i<8?ice(e,r):sce(e,sD(_3(e,0,o),r),sD(_3(e,o),r),r)},ice=function(e,r){for(var i,o,c=e.length,u=1;u<c;){for(o=u,i=e[u];o&&r(e[o-1],i)>0;)e[o]=e[--o];o!==u++&&(e[o]=i)}return e},sce=function(e,r,i,o){for(var c=r.length,u=i.length,h=0,m=0;h<c||m<u;)e[h+m]=h<c&&m<u?o(r[h],i[m])<=0?r[h++]:i[m++]:h<c?r[h++]:i[m++];return e},y3=sD,oD=zn,pv=V,VI=Ee,dh=I,fv=$e,E3=rD,v3=id,oce=VE,ace=function(e,r,i){for(var o in r)i&&i.unsafe&&e[o]?e[o]=r[o]:Yae(e,o,r[o],i);return e},cce=sd,lce=OE,aD=rd,S3=h_,cD=Le,uce=Ti,dce=De,hce=Nc,pce=hn,b3=ht,pc=ka,fce=ia,T3=Je,lD=r_,mce=td,mv=bl,gce=y3,_ce=_r("iterator"),Jb="URLSearchParams",w3=Jb+"Iterator",C3=aD.set,uu=aD.getterFor(Jb),yce=aD.getterFor(w3),Ece=Object.getOwnPropertyDescriptor,uD=function(e){if(!fv)return pv[e];var r=Ece(pv,e);return r&&r.value},R3=uD("fetch"),FI=uD("Request"),Qb=uD("Headers"),dD=FI&&FI.prototype,I3=Qb&&Qb.prototype,vce=pv.RegExp,Sce=pv.TypeError,A3=pv.decodeURIComponent,bce=pv.encodeURIComponent,Tce=dh("".charAt),P3=dh([].join),T_=dh([].push),hD=dh("".replace),wce=dh([].shift),O3=dh([].splice),k3=dh("".split),Cce=dh("".slice),Rce=/\+/g,N3=Array(4),Ice=function(e){return N3[e-1]||(N3[e-1]=vce("((?:%[\\da-f]{2}){"+e+"})","gi"))},Ace=function(e){try{return A3(e)}catch{return e}},D3=function(e){var r=hD(e,Rce," "),i=4;try{return A3(r)}catch{for(;i;)r=hD(r,Ice(i--),Ace);return r}},Pce=/[!'()~]|%20/g,Oce={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},kce=function(e){return Oce[e]},x3=function(e){return hD(bce(e),Pce,kce)},pD=lce(function(e,r){C3(this,{type:w3,iterator:lD(uu(e).entries),kind:r})},"Iterator",function(){var e=yce(this),r=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),i},!0),L3=function(e){this.entries=[],this.url=null,e!==void 0&&(b3(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Tce(e,0)==="?"?Cce(e,1):e:pc(e)))};L3.prototype={type:Jb,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var r,i,o,c,u,h,m,_=mce(e);if(_)for(i=(r=lD(e,_)).next;!(o=VI(i,r)).done;){if(u=(c=lD(pce(o.value))).next,(h=VI(u,c)).done||(m=VI(u,c)).done||!VI(u,c).done)throw Sce("Expected sequence with length 2");T_(this.entries,{key:pc(h.value),value:pc(m.value)})}else for(var E in e)uce(e,E)&&T_(this.entries,{key:E,value:pc(e[E])})},parseQuery:function(e){if(e)for(var r,i,o=k3(e,"&"),c=0;c<o.length;)(r=o[c++]).length&&(i=k3(r,"="),T_(this.entries,{key:D3(wce(i)),value:D3(P3(i,"="))}))},serialize:function(){for(var e,r=this.entries,i=[],o=0;o<r.length;)e=r[o++],T_(i,x3(e.key)+"="+x3(e.value));return P3(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var jI=function(){S3(this,gv);var e=C3(this,new L3(arguments.length>0?arguments[0]:void 0));fv||(this.size=e.entries.length)},gv=jI.prototype;if(ace(gv,{append:function(e,r){var i=uu(this);mv(arguments.length,2),T_(i.entries,{key:pc(e),value:pc(r)}),fv||this.length++,i.updateURL()},delete:function(e){for(var r=uu(this),i=mv(arguments.length,1),o=r.entries,c=pc(e),u=i<2?void 0:arguments[1],h=u===void 0?u:pc(u),m=0;m<o.length;){var _=o[m];if(_.key!==c||h!==void 0&&_.value!==h)m++;else if(O3(o,m,1),h!==void 0)break}fv||(this.size=o.length),r.updateURL()},get:function(e){var r=uu(this).entries;mv(arguments.length,1);for(var i=pc(e),o=0;o<r.length;o++)if(r[o].key===i)return r[o].value;return null},getAll:function(e){var r=uu(this).entries;mv(arguments.length,1);for(var i=pc(e),o=[],c=0;c<r.length;c++)r[c].key===i&&T_(o,r[c].value);return o},has:function(e){for(var r=uu(this).entries,i=mv(arguments.length,1),o=pc(e),c=i<2?void 0:arguments[1],u=c===void 0?c:pc(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(e,r){var i=uu(this);mv(arguments.length,1);for(var o,c=i.entries,u=!1,h=pc(e),m=pc(r),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?O3(c,_--,1):(u=!0,o.value=m));u||T_(c,{key:h,value:m}),fv||(this.size=c.length),i.updateURL()},sort:function(){var e=uu(this);gce(e.entries,function(r,i){return r.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var r,i=uu(this).entries,o=dce(e,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)o((r=i[c++]).value,r.key,this)},keys:function(){return new pD(this,"keys")},values:function(){return new pD(this,"values")},entries:function(){return new pD(this,"entries")}},{enumerable:!0}),v3(gv,_ce,gv.entries,{}),v3(gv,"toString",function(){return uu(this).serialize()},{enumerable:!0}),fv&&oce(gv,"size",{get:function(){return uu(this).entries.length},configurable:!0,enumerable:!0}),cce(jI,Jb),oD({global:!0,forced:!E3},{URLSearchParams:jI}),!E3&&cD(Qb)){var Nce=dh(I3.has),Dce=dh(I3.set),M3=function(e){if(b3(e)){var r,i=e.body;if(hce(i)===Jb)return r=e.headers?new Qb(e.headers):new Qb,Nce(r,"content-type")||Dce(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),fce(e,{body:T3(0,pc(i)),headers:T3(0,r)})}return e};if(cD(R3)&&oD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return R3(e,arguments.length>1?M3(arguments[1]):{})}}),cD(FI)){var fD=function(e){return S3(this,dD),new FI(e,arguments.length>1?M3(arguments[1]):{})};dD.constructor=fD,fD.prototype=dD,oD({global:!0,dontCallGetSet:!0,forced:!0},{Request:fD})}}var du,xce={URLSearchParams:jI,getState:uu},Lce=mt.URLSearchParams,U3=$e,Mce=I,Uce=Ee,Vce=d,mD=Lc,Fce=xc,jce=ke,Bce=$o,Wce=fn,_v=Object.assign,V3=Object.defineProperty,zce=Mce([].concat),Gce=!_v||Vce(function(){if(U3&&_v({b:1},_v(V3({},"a",{enumerable:!0,get:function(){V3(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(c){r[c]=c}),_v({},e)[i]!=7||mD(_v({},r)).join("")!=o})?function(e,r){for(var i=Bce(e),o=arguments.length,c=1,u=Fce.f,h=jce.f;o>c;)for(var m,_=Wce(arguments[c++]),E=u?zce(mD(_),u(_)):mD(_),S=E.length,R=0;S>R;)m=E[R++],U3&&!Uce(h,_,m)||(i[m]=_[m]);return i}:_v,Hce=hn,$ce=i_,Kce=De,qce=Ee,Yce=$o,Xce=function(e,r,i,o){try{return o?r(Hce(i)[0],i[1]):r(i)}catch(c){$ce(e,"throw",c)}},Jce=n_,Qce=m_,Zce=mi,F3=UI,ele=r_,tle=td,j3=Array,w_=I,gD=2147483647,nle=/[^\0-\u007E]/,B3=/[.\u3002\uFF0E\uFF61]/g,W3="Overflow: input needs wider integers to process",z3=RangeError,rle=w_(B3.exec),yv=Math.floor,_D=String.fromCharCode,G3=w_("".charCodeAt),H3=w_([].join),km=w_([].push),ile=w_("".replace),sle=w_("".split),ole=w_("".toLowerCase),$3=function(e){return e+22+75*(e<26)},ale=function(e,r,i){var o=0;for(e=i?yv(e/700):e>>1,e+=yv(e/r);e>455;)e=yv(e/35),o+=36;return yv(o+36*e/(e+38))},cle=function(e){var r=[];e=function(q){for(var ee=[],he=0,Se=q.length;he<Se;){var we=G3(q,he++);if(we>=55296&&we<=56319&&he<Se){var ye=G3(q,he++);(64512&ye)==56320?km(ee,((1023&we)<<10)+(1023&ye)+65536):(km(ee,we),he--)}else km(ee,we)}return ee}(e);var i,o,c=e.length,u=128,h=0,m=72;for(i=0;i<e.length;i++)(o=e[i])<128&&km(r,_D(o));var _=r.length,E=_;for(_&&km(r,"-");E<c;){var S=gD;for(i=0;i<e.length;i++)(o=e[i])>=u&&o<S&&(S=o);var R=E+1;if(S-u>yv((gD-h)/R))throw z3(W3);for(h+=(S-u)*R,u=S,i=0;i<e.length;i++){if((o=e[i])<u&&++h>gD)throw z3(W3);if(o==u){for(var P=h,N=36;;){var G=N<=m?1:N>=m+26?26:N-m;if(P<G)break;var F=P-G,j=36-G;km(r,_D($3(G+F%j))),P=yv(F/j),N+=36}km(r,_D($3(P))),m=ale(h,R,E==_),h=0,E++}}h++,u++}return H3(r,"")},lle=zn,yD=$e,ule=rD,ED=V,K3=De,hu=I,BI=id,pu=VE,dle=h_,vD=Ti,SD=Gce,Ev=function(e){var r=Yce(e),i=Qce(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=Kce(c,o>2?arguments[2]:void 0));var h,m,_,E,S,R,P=tle(r),N=0;if(!P||this===j3&&Jce(P))for(h=Zce(r),m=i?new this(h):j3(h);h>N;N++)R=u?c(r[N],N):r[N],F3(m,N,R);else for(S=(E=ele(r,P)).next,m=i?new this:[];!(_=qce(S,E)).done;N++)R=u?Xce(E,c,[_.value,N],!0):_.value,F3(m,N,R);return m.length=N,m},ud=iD,hle=ZN.codeAt,ple=function(e){var r,i,o=[],c=sle(ile(ole(e),B3,"."),".");for(r=0;r<c.length;r++)i=c[r],km(o,rle(nle,i)?"xn--"+cle(i):i);return H3(o,".")},Gp=ka,fle=sd,mle=bl,q3=xce,Y3=rd,gle=Y3.set,WI=Y3.getterFor("URL"),_le=q3.URLSearchParams,yle=q3.getState,Zb=ED.URL,bD=ED.TypeError,zI=ED.parseInt,Ele=Math.floor,X3=Math.pow,fu=hu("".charAt),dd=hu(/./.exec),eT=hu([].join),vle=hu(1 .toString),Sle=hu([].pop),vv=hu([].push),TD=hu("".replace),ble=hu([].shift),Tle=hu("".split),tT=hu("".slice),GI=hu("".toLowerCase),wle=hu([].unshift),wD="Invalid scheme",C_="Invalid host",J3="Invalid port",Q3=/[a-z]/i,Cle=/[\d+-.a-z]/i,CD=/\d/,Rle=/^0x/i,Ile=/^[0-7]+$/,Ale=/^\d+$/,Z3=/^[\da-f]+$/i,Ple=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Ole=/[\0\t\n\r #/:<>?@[\\\]^|]/,kle=/^[\u0000-\u0020]+/,Nle=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Dle=/[\t\n\r]/g,nT=function(e){var r,i,o,c;if(typeof e=="number"){for(r=[],i=0;i<4;i++)wle(r,e%256),e=Ele(e/256);return eT(r,".")}if(typeof e=="object"){for(r="",o=function(u){for(var h=null,m=1,_=null,E=0,S=0;S<8;S++)u[S]!==0?(E>m&&(h=_,m=E),_=null,E=0):(_===null&&(_=S),++E);return E>m&&(h=_,m=E),h}(e),i=0;i<8;i++)c&&e[i]===0||(c&&(c=!1),o===i?(r+=i?":":"::",c=!0):(r+=vle(e[i],16),i<7&&(r+=":")));return"["+r+"]"}return e},HI={},e5=SD({},HI,{" ":1,'"':1,"<":1,">":1,"`":1}),t5=SD({},e5,{"#":1,"?":1,"{":1,"}":1}),RD=SD({},t5,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Nm=function(e,r){var i=hle(e,0);return i>32&&i<127&&!vD(r,e)?e:encodeURIComponent(e)},$I={ftp:21,file:null,http:80,https:443,ws:80,wss:443},rT=function(e,r){var i;return e.length==2&&dd(Q3,fu(e,0))&&((i=fu(e,1))==":"||!r&&i=="|")},n5=function(e){var r;return e.length>1&&rT(tT(e,0,2))&&(e.length==2||(r=fu(e,2))==="/"||r==="\\"||r==="?"||r==="#")},xle=function(e){return e==="."||GI(e)==="%2e"},ID={},r5={},AD={},i5={},s5={},PD={},o5={},a5={},KI={},qI={},OD={},kD={},ND={},DD={},c5={},xD={},Sv={},hh={},l5={},R_={},Hp={},LD=function(e,r,i){var o,c,u,h=Gp(e);if(r){if(c=this.parse(h))throw bD(c);this.searchParams=null}else{if(i!==void 0&&(o=new LD(i,!0)),c=this.parse(h,null,o))throw bD(c);(u=yle(new _le)).bindURL(this),this.searchParams=u}};LD.prototype={type:"URL",parse:function(e,r,i){var o,c,u,h,m,_=this,E=r||ID,S=0,R="",P=!1,N=!1,G=!1;for(e=Gp(e),r||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=TD(e,kle,""),e=TD(e,Nle,"$1")),e=TD(e,Dle,""),o=Ev(e);S<=o.length;){switch(c=o[S],E){case ID:if(!c||!dd(Q3,c)){if(r)return wD;E=AD;continue}R+=GI(c),E=r5;break;case r5:if(c&&(dd(Cle,c)||c=="+"||c=="-"||c=="."))R+=GI(c);else{if(c!=":"){if(r)return wD;R="",E=AD,S=0;continue}if(r&&(_.isSpecial()!=vD($I,R)||R=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=R,r)return void(_.isSpecial()&&$I[_.scheme]==_.port&&(_.port=null));R="",_.scheme=="file"?E=DD:_.isSpecial()&&i&&i.scheme==_.scheme?E=i5:_.isSpecial()?E=a5:o[S+1]=="/"?(E=s5,S++):(_.cannotBeABaseURL=!0,vv(_.path,""),E=l5)}break;case AD:if(!i||i.cannotBeABaseURL&&c!="#")return wD;if(i.cannotBeABaseURL&&c=="#"){_.scheme=i.scheme,_.path=ud(i.path),_.query=i.query,_.fragment="",_.cannotBeABaseURL=!0,E=Hp;break}E=i.scheme=="file"?DD:PD;continue;case i5:if(c!="/"||o[S+1]!="/"){E=PD;continue}E=KI,S++;break;case s5:if(c=="/"){E=qI;break}E=hh;continue;case PD:if(_.scheme=i.scheme,c==du)_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=ud(i.path),_.query=i.query;else if(c=="/"||c=="\\"&&_.isSpecial())E=o5;else if(c=="?")_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=ud(i.path),_.query="",E=R_;else{if(c!="#"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=ud(i.path),_.path.length--,E=hh;continue}_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=ud(i.path),_.query=i.query,_.fragment="",E=Hp}break;case o5:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,E=hh;continue}E=qI}else E=KI;break;case a5:if(E=KI,c!="/"||fu(R,S+1)!="/")continue;S++;break;case KI:if(c!="/"&&c!="\\"){E=qI;continue}break;case qI:if(c=="@"){P&&(R="%40"+R),P=!0,u=Ev(R);for(var F=0;F<u.length;F++){var j=u[F];if(j!=":"||G){var q=Nm(j,RD);G?_.password+=q:_.username+=q}else G=!0}R=""}else if(c==du||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(P&&R=="")return"Invalid authority";S-=Ev(R).length+1,R="",E=OD}else R+=c;break;case OD:case kD:if(r&&_.scheme=="file"){E=xD;continue}if(c!=":"||N){if(c==du||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&R=="")return C_;if(r&&R==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(R))return h;if(R="",E=Sv,r)return;continue}c=="["?N=!0:c=="]"&&(N=!1),R+=c}else{if(R=="")return C_;if(h=_.parseHost(R))return h;if(R="",E=ND,r==kD)return}break;case ND:if(!dd(CD,c)){if(c==du||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||r){if(R!=""){var ee=zI(R,10);if(ee>65535)return J3;_.port=_.isSpecial()&&ee===$I[_.scheme]?null:ee,R=""}if(r)return;E=Sv;continue}return J3}R+=c;break;case DD:if(_.scheme="file",c=="/"||c=="\\")E=c5;else{if(!i||i.scheme!="file"){E=hh;continue}if(c==du)_.host=i.host,_.path=ud(i.path),_.query=i.query;else if(c=="?")_.host=i.host,_.path=ud(i.path),_.query="",E=R_;else{if(c!="#"){n5(eT(ud(o,S),""))||(_.host=i.host,_.path=ud(i.path),_.shortenPath()),E=hh;continue}_.host=i.host,_.path=ud(i.path),_.query=i.query,_.fragment="",E=Hp}}break;case c5:if(c=="/"||c=="\\"){E=xD;break}i&&i.scheme=="file"&&!n5(eT(ud(o,S),""))&&(rT(i.path[0],!0)?vv(_.path,i.path[0]):_.host=i.host),E=hh;continue;case xD:if(c==du||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&rT(R))E=hh;else if(R==""){if(_.host="",r)return;E=Sv}else{if(h=_.parseHost(R))return h;if(_.host=="localhost"&&(_.host=""),r)return;R="",E=Sv}continue}R+=c;break;case Sv:if(_.isSpecial()){if(E=hh,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=du&&(E=hh,c!="/"))continue}else _.fragment="",E=Hp;else _.query="",E=R_;break;case hh:if(c==du||c=="/"||c=="\\"&&_.isSpecial()||!r&&(c=="?"||c=="#")){if((m=GI(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||vv(_.path,"")):xle(R)?c=="/"||c=="\\"&&_.isSpecial()||vv(_.path,""):(_.scheme=="file"&&!_.path.length&&rT(R)&&(_.host&&(_.host=""),R=fu(R,0)+":"),vv(_.path,R)),R="",_.scheme=="file"&&(c==du||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)ble(_.path);c=="?"?(_.query="",E=R_):c=="#"&&(_.fragment="",E=Hp)}else R+=Nm(c,t5);break;case l5:c=="?"?(_.query="",E=R_):c=="#"?(_.fragment="",E=Hp):c!=du&&(_.path[0]+=Nm(c,HI));break;case R_:r||c!="#"?c!=du&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":Nm(c,HI)):(_.fragment="",E=Hp);break;case Hp:c!=du&&(_.fragment+=Nm(c,e5))}S++}},parseHost:function(e){var r,i,o;if(fu(e,0)=="["){if(fu(e,e.length-1)!="]"||(r=function(c){var u,h,m,_,E,S,R,P=[0,0,0,0,0,0,0,0],N=0,G=null,F=0,j=function(){return fu(c,F)};if(j()==":"){if(fu(c,1)!=":")return;F+=2,G=++N}for(;j();){if(N==8)return;if(j()!=":"){for(u=h=0;h<4&&dd(Z3,j());)u=16*u+zI(j(),16),F++,h++;if(j()=="."){if(h==0||(F-=h,N>6))return;for(m=0;j();){if(_=null,m>0){if(!(j()=="."&&m<4))return;F++}if(!dd(CD,j()))return;for(;dd(CD,j());){if(E=zI(j(),10),_===null)_=E;else{if(_==0)return;_=10*_+E}if(_>255)return;F++}P[N]=256*P[N]+_,++m!=2&&m!=4||N++}if(m!=4)return;break}if(j()==":"){if(F++,!j())return}else if(j())return;P[N++]=u}else{if(G!==null)return;F++,G=++N}}if(G!==null)for(S=N-G,N=7;N!=0&&S>0;)R=P[N],P[N--]=P[G+S-1],P[G+--S]=R;else if(N!=8)return;return P}(tT(e,1,-1)),!r))return C_;this.host=r}else if(this.isSpecial()){if(e=ple(e),dd(Ple,e)||(r=function(c){var u,h,m,_,E,S,R,P=Tle(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((_=P[m])=="")return c;if(E=10,_.length>1&&fu(_,0)=="0"&&(E=dd(Rle,_)?16:8,_=tT(_,E==8?1:2)),_==="")S=0;else{if(!dd(E==10?Ale:E==8?Ile:Z3,_))return c;S=zI(_,E)}vv(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=X3(256,5-u))return null}else if(S>255)return null;for(R=Sle(h),m=0;m<h.length;m++)R+=h[m]*X3(256,3-m);return R}(e),r===null))return C_;this.host=r}else{if(dd(Ole,e))return C_;for(r="",i=Ev(e),o=0;o<i.length;o++)r+=Nm(i[o],HI);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return vD($I,this.scheme)},shortenPath:function(){var e=this.path,r=e.length;!r||this.scheme=="file"&&r==1&&rT(e[0],!0)||e.length--},serialize:function(){var e=this,r=e.scheme,i=e.username,o=e.password,c=e.host,u=e.port,h=e.path,m=e.query,_=e.fragment,E=r+":";return c!==null?(E+="//",e.includesCredentials()&&(E+=i+(o?":"+o:"")+"@"),E+=nT(c),u!==null&&(E+=":"+u)):r=="file"&&(E+="//"),E+=e.cannotBeABaseURL?h[0]:h.length?"/"+eT(h,"/"):"",m!==null&&(E+="?"+m),_!==null&&(E+="#"+_),E},setHref:function(e){var r=this.parse(e);if(r)throw bD(r);this.searchParams.update()},getOrigin:function(){var e=this.scheme,r=this.port;if(e=="blob")try{return new bv(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+nT(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Gp(e)+":",ID)},getUsername:function(){return this.username},setUsername:function(e){var r=Ev(Gp(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=Nm(r[i],RD)}},getPassword:function(){return this.password},setPassword:function(e){var r=Ev(Gp(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=Nm(r[i],RD)}},getHost:function(){var e=this.host,r=this.port;return e===null?"":r===null?nT(e):nT(e)+":"+r},setHost:function(e){this.cannotBeABaseURL||this.parse(e,OD)},getHostname:function(){var e=this.host;return e===null?"":nT(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,kD)},getPort:function(){var e=this.port;return e===null?"":Gp(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Gp(e))==""?this.port=null:this.parse(e,ND))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+eT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Sv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Gp(e))==""?this.query=null:(fu(e,0)=="?"&&(e=tT(e,1)),this.query="",this.parse(e,R_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Gp(e))!=""?(fu(e,0)=="#"&&(e=tT(e,1)),this.fragment="",this.parse(e,Hp)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var bv=function(e){var r=dle(this,fc),i=mle(arguments.length,1)>1?arguments[1]:void 0,o=gle(r,new LD(e,!1,i));yD||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},fc=bv.prototype,mu=function(e,r){return{get:function(){return WI(this)[e]()},set:r&&function(i){return WI(this)[r](i)},configurable:!0,enumerable:!0}};if(yD&&(pu(fc,"href",mu("serialize","setHref")),pu(fc,"origin",mu("getOrigin")),pu(fc,"protocol",mu("getProtocol","setProtocol")),pu(fc,"username",mu("getUsername","setUsername")),pu(fc,"password",mu("getPassword","setPassword")),pu(fc,"host",mu("getHost","setHost")),pu(fc,"hostname",mu("getHostname","setHostname")),pu(fc,"port",mu("getPort","setPort")),pu(fc,"pathname",mu("getPathname","setPathname")),pu(fc,"search",mu("getSearch","setSearch")),pu(fc,"searchParams",mu("getSearchParams")),pu(fc,"hash",mu("getHash","setHash"))),BI(fc,"toJSON",function(){return WI(this).serialize()},{enumerable:!0}),BI(fc,"toString",function(){return WI(this).serialize()},{enumerable:!0}),Zb){var u5=Zb.createObjectURL,d5=Zb.revokeObjectURL;u5&&BI(bv,"createObjectURL",K3(u5,Zb)),d5&&BI(bv,"revokeObjectURL",K3(d5,Zb))}fle(bv,"URL"),lle({global:!0,forced:!ule,sham:!yD},{URL:bv});var Lle=zn,Mle=d,Ule=bl,h5=ka,Vle=rD,p5=en("URL");Lle({target:"URL",stat:!0,forced:!(Vle&&Mle(function(){p5.canParse()}))},{canParse:function(e){var r=Ule(arguments.length,1),i=h5(e),o=r<2||arguments[1]===void 0?void 0:h5(arguments[1]);try{return!!new p5(i,o)}catch{return!1}}});var YI=l(mt.URL);let f5=!0,m5=!0;function XI(e,r,i){const o=e.match(r);return o&&o.length>=i&&parseInt(o[i],10)}function I_(e,r,i){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const _=E=>{const S=i(E);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const _=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Fle(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(f5=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function jle(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(m5=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function g5(){if(typeof window=="object"){if(f5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function MD(e,r){m5&&console.warn(e+" is deprecated, please use "+r+" instead.")}function _5(e){return Object.prototype.toString.call(e)==="[object Object]"}function y5(e){var r;return _5(e)?cc(r=Object.keys(e)).call(r,function(i,o){const c=_5(e[o]),u=c?y5(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[o]:u})},{}):e}function UD(e,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?UD(e,e.get(r[o]),i):o.endsWith("Ids")&&r[o].forEach(c=>{UD(e,e.get(c),i)})}))}function E5(e,r,i){const o=i?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===o&&m.trackId===h.id&&UD(e,m,c)})}),c}const v5=g5;function S5(e,r){const i=e&&e.navigator;if(!i.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const E=typeof h[_]=="object"?h[_]:{ideal:h[_]};E.exact!==void 0&&typeof E.exact=="number"&&(E.min=E.max=E.exact);const S=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(E.ideal!==void 0){m.optional=m.optional||[];let R={};typeof E.ideal=="number"?(R[S("min",_)]=E.ideal,m.optional.push(R),R={},R[S("max",_)]=E.ideal,m.optional.push(R)):(R[S("",_)]=E.ideal,m.optional.push(R))}E.exact!==void 0&&typeof E.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=E.exact):["min","max"].forEach(R=>{E[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,_)]=E[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(E,S,R){S in E&&!(R in E)&&(E[R]=E[S],delete E[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const E=r.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||E)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return i.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(N=>N.kind==="videoinput")).find(N=>S.some(G=>{var F;return st(F=N.label.toLowerCase()).call(F,G)}));return!P&&R.length&&st(S).call(S,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=_.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=o(h.video),v5("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return v5("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,m,_){c(h,E=>{i.webkitGetUserMedia(E,m,S=>{_&&_(u(S))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return c(m,_=>h(_).then(E=>{if(_.audio&&!E.getAudioTracks().length||_.video&&!E.getVideoTracks().length)throw E.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return E},E=>ut.reject(u(E))))}}}function b5(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function T5(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else I_(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function w5(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let _=c.apply(this,arguments);return _||(_=r(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function C5(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,o,c]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);const u=function(m){const _={};return m.result().forEach(E=>{const S={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};E.names().forEach(R=>{S[R]=E.stat(R)}),_[S.id]=S}),_},h=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){o(h(u(_)))};return r.apply(this,[m,i])}return new ut((m,_)=>{r.apply(this,[function(E){m(h(u(E)))},_])}).then(o,c)}}function R5(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>E5(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(c=>c._pc=this),o}),I_(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>E5(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===i&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||o&&c?ut.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():ut.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function I5(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function A5(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return I5(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(E=>this._reverseStreams[E.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(E=>{if(this.getSenders().find(R=>R.track===E))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const E=new e.MediaStream(_.getTracks());this._streams[_.id]=E,this._reverseStreams[E.id]=_,_=E}o.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,E){let S=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],N=_._streams[P.id];S=S.replace(new RegExp(N.id,"g"),P.id)}),new RTCSessionDescription({type:E.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(N=>N===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(N=>N.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[E.id];if(P)P.addTrack(_),ut.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const N=new e.MediaStream([_]);this._streams[E.id]=N,this._reverseStreams[N.id]=E,this.addStream(N)}return this.getSenders().find(N=>N.track===_)},["createOffer","createAnswer"].forEach(function(_){const E=e.RTCPeerConnection.prototype[_],S={[_](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?E.apply(this,[P=>{const N=u(this,P);R[0].apply(null,[N])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):E.apply(this,arguments).then(P=>u(this,P))}};e.RTCPeerConnection.prototype[_]=S[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,E){let S=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],N=_._streams[P.id];S=S.replace(new RegExp(P.id,"g"),N.id)}),new RTCSessionDescription({type:E.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>_.track===R)&&(E=this._streams[S])}),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function VD(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]})}function P5(e,r){I_(e,"negotiationneeded",i=>{const o=i.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var O5=Object.freeze({__proto__:null,fixNegotiationNeeded:P5,shimAddTrackRemoveTrack:A5,shimAddTrackRemoveTrackWithNative:I5,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof r=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(o=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:w5,shimGetStats:C5,shimGetUserMedia:S5,shimMediaStream:b5,shimOnTrack:T5,shimPeerConnection:VD,shimSenderReceiverGetStats:R5});function k5(e,r){const i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){MD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,m,_){m in h&&!(_ in h)&&(h[_]=h[m],delete h[m])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function N5(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function FD(e,r){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(_=>{_.type=i[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((E,S)=>{m.set(S,Object.assign({},E,{type:i[E.type]||E.type}))})}return m}).then(u,h)}}function D5(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ut.resolve(new Map)}}function x5(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i}),I_(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function L5(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(r){MD("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&st(o=r.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function M5(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function U5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const o=i.length>0;o&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function V5(e){if(typeof e!="object"||!e.RTCRtpSender)return;const r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){const i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function F5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ut.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function j5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ut.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var B5=Object.freeze({__proto__:null,shimAddTransceiver:U5,shimCreateAnswer:j5,shimCreateOffer:F5,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,ut.reject(o)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:V5,shimGetUserMedia:k5,shimOnTrack:N5,shimPeerConnection:FD,shimRTCDataChannel:M5,shimReceiverGetStats:x5,shimRemoveStream:L5,shimSenderGetStats:D5});function W5(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),st(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>r.call(this,c,i)),i.getVideoTracks().forEach(c=>r.call(this,c,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?st(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);const o=r.getTracks();this.getSenders().forEach(c=>{st(o).call(o,c.track)&&this.removeTrack(c)})})}}function z5(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),st(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),r.apply(i,arguments)}}}function G5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(_,E){const S=arguments.length>=2?arguments[2]:arguments[0],R=i.apply(this,[S]);return E?(R.then(_,E),ut.resolve()):R},r.createAnswer=function(_,E){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return E?(R.then(_,E),ut.resolve()):R};let m=function(_,E,S){const R=c.apply(this,[_]);return S?(R.then(E,S),ut.resolve()):R};r.setLocalDescription=m,m=function(_,E,S){const R=u.apply(this,[_]);return S?(R.then(E,S),ut.resolve()):R},r.setRemoteDescription=m,m=function(_,E,S){const R=h.apply(this,[_]);return S?(R.then(E,S),ut.resolve()):R},r.addIceCandidate=m}function H5(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,o=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=c=>o($5(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(i,o,c){r.mediaDevices.getUserMedia(i).then(o,c)}).bind(r))}function $5(e){return e&&e.video!==void 0?Object.assign({},e,{video:y5(e.video)}):e}function K5(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(MD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new r(i,o)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function q5(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Y5(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function X5(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var J5=Object.freeze({__proto__:null,shimAudioContext:X5,shimCallbacksAPI:G5,shimConstraints:$5,shimCreateOfferLegacy:Y5,shimGetUserMedia:H5,shimLocalStreamsAPI:W5,shimRTCIceServerUrls:K5,shimRemoteStreamsAPI:z5,shimTrackEventTransceiver:q5}),Q5=`	
\v\f\r \u2028\u2029\uFEFF`,Ble=Yt,Wle=ka,jD=Q5,Z5=I("".replace),zle=RegExp("^["+jD+"]+"),Gle=RegExp("(^|[^"+jD+"])["+jD+"]+$"),Hle=function(e){return function(r){var i=Wle(Ble(r));return 1&e&&(i=Z5(i,zle,"")),2&e&&(i=Z5(i,Gle,"$1")),i}},$le={trim:Hle(3)},Kle=rI.PROPER,qle=d,eB=Q5,Yle=$le.trim;zn({target:"String",proto:!0,forced:function(e){return qle(function(){return!!eB[e]()||""[e]()!==""||Kle&&eB[e].name!==e})}("trim")},{trim:function(){return Yle(this)}});var Xle=ac("String").trim,Jle=k,Qle=Xle,BD=String.prototype,Zle=function(e){var r=e.trim;return typeof e=="string"||e===BD||Jle(BD,e)&&r===BD.trim?Qle:r},ho=l(Zle),tB={exports:{}};(function(e){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(i){return i.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(i){const o=r.splitSections(i);return o&&o[0]},r.getMediaSections=function(i){const o=r.splitSections(i);return o.shift(),o},r.matchPrefix=function(i,o){return r.splitLines(i).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},r.writeCandidate=function(i){const o=[];o.push(i.foundation);const c=i.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);const u=i.type;return o.push("typ"),o.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let o=i.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(i){const o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){const o={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(i){let o="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},r.parseRtcpFb=function(i){const o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(i){let o="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(i){const o=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,o),10)},u=i.indexOf(":",o);return u>-1?(c.attribute=i.substring(o+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(o+1),c},r.parseSsrcGroup=function(i){const o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(i){const o=r.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(i){const o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:r.matchPrefix(i+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,o){let c="a=setup:"+o+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(i){const o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,o){return r.matchPrefix(i+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,o){const c=r.matchPrefix(i+o,"a=ice-ufrag:")[0],u=r.matchPrefix(i+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(i){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(i)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],_=r.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(_){const E=r.parseRtpMap(_),S=r.matchPrefix(i,"a=fmtp:"+m+" ");switch(E.parameters=S.length?r.parseFmtp(S[0]):{},E.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(E.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(i,o){let c="";c+="m="+i+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(i){const o=[],c=r.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(i,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),_=m.length>0&&m[0].ssrc;let E;const S=r.matchPrefix(i,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(N=>parseInt(N,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(E=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let N={ssrc:_,codecPayloadType:parseInt(P.parameters.apt,10)};_&&E&&(N.rtx={ssrc:E}),o.push(N),u&&(N=JSON.parse(JSON.stringify(N)),N.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(N))}}),o.length===0&&_&&o.push({ssrc:_});let R=r.matchPrefix(i,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(P=>{P.maxBitrate=R})),o},r.parseRtcpParameters=function(i){const o={},c=r.matchPrefix(i,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=r.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=r.matchPrefix(i,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},r.parseMsid=function(i){let o;const c=r.matchPrefix(i,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=r.matchPrefix(i,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(i){const o=r.parseMLine(i),c=r.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=r.matchPrefix(i,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},r.writeSctpDescription=function(i,o){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,o,c){let u;const h=o!==void 0?o:2;return u=i||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,o){const c=r.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){const o=r.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(i){const o=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const o=r.splitLines(i);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=r})(tB);var nB=tB.exports,Tv=l(nB),eue=s({__proto__:null,default:Tv},[nB]);function JI(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const r=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const o=new r(i),c=Tv.parseCandidate(i.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(i)},e.RTCIceCandidate.prototype=r.prototype,I_(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function WD(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||I_(e,"icecandidate",r=>{if(r.candidate){const i=Tv.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function QI(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(m){if(!m||!m.sdp)return!1;const _=Tv.splitSections(m.sdp);return _.shift(),_.some(E=>{const S=Tv.parseMLine(E);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const E=parseInt(_[1],10);return E!=E?-1:E},c=function(m){let _=65536;return r.browser==="firefox"&&(_=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),_},u=function(m,_){let E=65536;r.browser==="firefox"&&r.version===57&&(E=65535);const S=Tv.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?E=parseInt(S[0].substr(19),10):r.browser==="firefox"&&_!==-1&&(E=2147483637),E},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=o(arguments[0]),_=c(m),E=u(arguments[0],m);let S;S=_===0&&E===0?Number.POSITIVE_INFINITY:_===0||E===0?Math.max(_,E):Math.min(_,E);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function ZI(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function r(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return r(o,this),o},I_(e,"datachannel",o=>(r(o.channel,o.target),o))}function zD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const o=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function GD(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>ho(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return i.apply(this,arguments)}}function eA(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ut.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ut.resolve())})}function tA(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var tue=Object.freeze({__proto__:null,removeExtmapAllowMixed:GD,shimAddIceCandidateNullOrEmpty:eA,shimConnectionState:zD,shimMaxMessageSize:QI,shimParameterlessSetLocalDescription:tA,shimRTCIceCandidate:JI,shimRTCIceCandidateRelayProtocol:WD,shimSendThrowTypeError:ZI});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=g5,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=XI(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=XI(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=XI(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:tue,extractVersion:XI,disableLog:Fle,disableWarnings:jle,sdp:eue};switch(o.browser){case"chrome":if(!O5||!VD||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=O5,eA(e,o),tA(e),S5(e,o),b5(e),VD(e,o),T5(e),A5(e,o),w5(e),C5(e),R5(e),P5(e,o),JI(e),WD(e),zD(e),QI(e,o),ZI(e),GD(e,o);break;case"firefox":if(!B5||!FD||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=B5,eA(e,o),tA(e),k5(e,o),FD(e,o),N5(e),L5(e),D5(e),x5(e),M5(e),U5(e),V5(e),F5(e),j5(e),JI(e),zD(e),QI(e,o),ZI(e);break;case"safari":if(!J5||!r.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=J5,eA(e,o),tA(e),K5(e),Y5(e),G5(e),W5(e),z5(e),q5(e),H5(e),X5(e),JI(e),WD(e),QI(e,o),ZI(e),GD(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var rB=Ia,nue=TypeError,iB=Et.match(/firefox\/(\d+)/i),rue=!!iB&&+iB[1],iue=/MSIE|Trident/.test(Et),sB=Et.match(/AppleWebKit\/(\d+)\./),sue=!!sB&&+sB[1],oue=zn,oB=I,aue=gt,cue=$o,aB=mi,lue=function(e,r){if(!delete e[r])throw nue("Cannot delete property "+rB(r)+" of "+rB(e))},cB=ka,HD=d,uue=y3,due=bp,lB=rue,hue=iue,uB=ii,dB=sue,Dm=[],hB=oB(Dm.sort),pue=oB(Dm.push),fue=HD(function(){Dm.sort(void 0)}),mue=HD(function(){Dm.sort(null)}),gue=due("sort"),pB=!HD(function(){if(uB)return uB<70;if(!(lB&&lB>3)){if(hue)return!0;if(dB)return dB<603;var e,r,i,o,c="";for(e=65;e<76;e++){switch(r=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)Dm.push({k:r+o,v:i})}for(Dm.sort(function(u,h){return h.v-u.v}),o=0;o<Dm.length;o++)r=Dm[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});oue({target:"Array",proto:!0,forced:fue||!mue||!gue||!pB},{sort:function(e){e!==void 0&&aue(e);var r=cue(this);if(pB)return e===void 0?hB(r):hB(r,e);var i,o,c=[],u=aB(r);for(o=0;o<u;o++)o in r&&pue(c,r[o]);for(uue(c,function(h){return function(m,_){return _===void 0?-1:m===void 0?1:h!==void 0?+h(m,_)||0:cB(m)>cB(_)?1:-1}}(e)),i=aB(c),o=0;o<i;)r[o]=c[o++];for(;o<u;)lue(r,o++);return r}});var _ue=ac("Array").sort,yue=k,Eue=_ue,$D=Array.prototype,vue=function(e){var r=e.sort;return e===$D||yue($D,e)&&r===$D.sort?Eue:r},iT=l(vue),KD=V;zn({global:!0,forced:KD.globalThis!==KD},{globalThis:KD});var fB=l(V),qD={exports:{}};(function(e,r){(function(i,o){var c="function",u="undefined",h="object",m="string",_="major",E="model",S="name",R="type",P="vendor",N="version",G="architecture",F="console",j="mobile",q="tablet",ee="smarttv",he="wearable",Se="embedded",we="Amazon",ye="Apple",Ne="ASUS",Ye="BlackBerry",dt="Browser",ft="Chrome",Rn="Firefox",In="Google",pr="Huawei",ai="LG",Yr="Microsoft",ma="Motorola",je="Opera",it="Samsung",wt="Sharp",He="Sony",M="Xiaomi",ae="Zebra",fe="Facebook",Qe="Chromium OS",Xt="Mac OS",ar=function(Pi){for(var Ji={},Ir=0;Ir<Pi.length;Ir++)Ji[Pi[Ir].toUpperCase()]=Pi[Ir];return Ji},Xi=function(Pi,Ji){return typeof Pi===m&&Ga(Ji).indexOf(Ga(Pi))!==-1},Ga=function(Pi){return Pi.toLowerCase()},lf=function(Pi,Ji){if(typeof Pi===m)return Pi=Pi.replace(/^\s\s*/,""),typeof Ji===u?Pi:Pi.substring(0,350)},iy=function(Pi,Ji){for(var Ir,_c,kh,ci,$n,Ha,tg=0;tg<Ji.length&&!$n;){var Cd=Ji[tg],B$=Ji[tg+1];for(Ir=_c=0;Ir<Cd.length&&!$n&&Cd[Ir];)if($n=Cd[Ir++].exec(Pi))for(kh=0;kh<B$.length;kh++)Ha=$n[++_c],typeof(ci=B$[kh])===h&&ci.length>0?ci.length===2?typeof ci[1]==c?this[ci[0]]=ci[1].call(this,Ha):this[ci[0]]=ci[1]:ci.length===3?typeof ci[1]!==c||ci[1].exec&&ci[1].test?this[ci[0]]=Ha?Ha.replace(ci[1],ci[2]):o:this[ci[0]]=Ha?ci[1].call(this,Ha,ci[2]):o:ci.length===4&&(this[ci[0]]=Ha?ci[3].call(this,Ha.replace(ci[1],ci[2])):o):this[ci]=Ha||o;tg+=2}},aw=function(Pi,Ji){for(var Ir in Ji)if(typeof Ji[Ir]===h&&Ji[Ir].length>0){for(var _c=0;_c<Ji[Ir].length;_c++)if(Xi(Ji[Ir][_c],Pi))return Ir==="?"?o:Ir}else if(Xi(Ji[Ir],Pi))return Ir==="?"?o:Ir;return Pi},QP={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},ZP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[N,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[N,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,N],[/opios[\/ ]+([\w\.]+)/i],[N,[S,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[N,[S,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,N],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[N,[S,"UC"+dt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[N,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[N,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[N,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[N,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[N,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+dt],N],[/\bfocus\/([\w\.]+)/i],[N,[S,Rn+" Focus"]],[/\bopt\/([\w\.]+)/i],[N,[S,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[N,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[N,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[N,[S,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[N,[S,"MIUI "+dt]],[/fxios\/([-\w\.]+)/i],[N,[S,Rn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+dt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+dt],N],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],N],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,N],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,fe],N],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,N],[/\bgsa\/([\w\.]+) .*safari\//i],[N,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[N,[S,ft+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,ft+" WebView"],N],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[N,[S,"Android "+dt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,N],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[N,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[N,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[N,aw,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,N],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],N],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[N,[S,Rn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,N],[/(cobalt)\/([\w\.]+)/i],[S,[N,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,Ga]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",Ga]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,Ga]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[P,it],[R,q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[E,[P,it],[R,j]],[/\((ip(?:hone|od)[\w ]*);/i],[E,[P,ye],[R,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[P,ye],[R,q]],[/(macintosh);/i],[E,[P,ye]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[P,wt],[R,j]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[P,pr],[R,q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[P,pr],[R,j]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[E,/_/g," "],[P,M],[R,j]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[P,M],[R,q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[P,"OPPO"],[R,j]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[P,"Vivo"],[R,j]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[E,[P,"Realme"],[R,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[P,ma],[R,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[P,ma],[R,q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[P,ai],[R,q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[P,ai],[R,j]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[P,"Lenovo"],[R,q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[P,"Nokia"],[R,j]],[/(pixel c)\b/i],[E,[P,In],[R,q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[P,In],[R,j]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[P,He],[R,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[P,He],[R,q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[P,"OnePlus"],[R,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[P,we],[R,q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[P,we],[R,j]],[/(playbook);[-\w\),; ]+(rim)/i],[E,P,[R,q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[P,Ye],[R,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[P,Ne],[R,q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[P,Ne],[R,j]],[/(nexus 9)/i],[E,[P,"HTC"],[R,q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[E,/_/g," "],[R,j]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[P,"Acer"],[R,q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[P,"Meizu"],[R,j]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,E,[R,j]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,E,[R,q]],[/(surface duo)/i],[E,[P,Yr],[R,q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[P,"Fairphone"],[R,j]],[/(u304aa)/i],[E,[P,"AT&T"],[R,j]],[/\bsie-(\w*)/i],[E,[P,"Siemens"],[R,j]],[/\b(rct\w+) b/i],[E,[P,"RCA"],[R,q]],[/\b(venue[\d ]{2,7}) b/i],[E,[P,"Dell"],[R,q]],[/\b(q(?:mv|ta)\w+) b/i],[E,[P,"Verizon"],[R,q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[P,"Barnes & Noble"],[R,q]],[/\b(tm\d{3}\w+) b/i],[E,[P,"NuVision"],[R,q]],[/\b(k88) b/i],[E,[P,"ZTE"],[R,q]],[/\b(nx\d{3}j) b/i],[E,[P,"ZTE"],[R,j]],[/\b(gen\d{3}) b.+49h/i],[E,[P,"Swiss"],[R,j]],[/\b(zur\d{3}) b/i],[E,[P,"Swiss"],[R,q]],[/\b((zeki)?tb.*\b) b/i],[E,[P,"Zeki"],[R,q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],E,[R,q]],[/\b(ns-?\w{0,9}) b/i],[E,[P,"Insignia"],[R,q]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[P,"NextBook"],[R,q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],E,[R,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],E,[R,j]],[/\b(ph-1) /i],[E,[P,"Essential"],[R,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[P,"Envizen"],[R,q]],[/\b(trio[-\w\. ]+) b/i],[E,[P,"MachSpeed"],[R,q]],[/\btu_(1491) b/i],[E,[P,"Rotor"],[R,q]],[/(shield[\w ]+) b/i],[E,[P,"Nvidia"],[R,q]],[/(sprint) (\w+)/i],[P,E,[R,j]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[P,Yr],[R,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[P,ae],[R,q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[P,ae],[R,j]],[/smart-tv.+(samsung)/i],[P,[R,ee]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[P,it],[R,ee]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,ai],[R,ee]],[/(apple) ?tv/i],[P,[E,ye+" TV"],[R,ee]],[/crkey/i],[[E,ft+"cast"],[P,In],[R,ee]],[/droid.+aft(\w)( bui|\))/i],[E,[P,we],[R,ee]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[P,wt],[R,ee]],[/(bravia[\w ]+)( bui|\))/i],[E,[P,He],[R,ee]],[/(mitv-\w{5}) bui/i],[E,[P,M],[R,ee]],[/Hbbtv.*(technisat) (.*);/i],[P,E,[R,ee]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,lf],[E,lf],[R,ee]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,ee]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,E,[R,F]],[/droid.+; (shield) bui/i],[E,[P,"Nvidia"],[R,F]],[/(playstation [345portablevi]+)/i],[E,[P,He],[R,F]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[P,Yr],[R,F]],[/((pebble))app/i],[P,E,[R,he]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[P,ye],[R,he]],[/droid.+; (glass) \d/i],[E,[P,In],[R,he]],[/droid.+; (wt63?0{2,3})\)/i],[E,[P,ae],[R,he]],[/(quest( 2| pro)?)/i],[E,[P,fe],[R,he]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,Se]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[E,[R,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[R,q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,j]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[N,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[N,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,N],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[N,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,N],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[N,aw,QP]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[N,aw,QP]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[N,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Xt],[N,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[N,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,N],[/\(bb(10);/i],[N,[S,Ye]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[N,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[N,[S,Rn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[N,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[N,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[N,[S,ft+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Qe],N],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,N],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],N],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,N]]},xl=function(Pi,Ji){if(typeof Pi===h&&(Ji=Pi,Pi=o),!(this instanceof xl))return new xl(Pi,Ji).getResult();var Ir=typeof i!==u&&i.navigator?i.navigator:o,_c=Pi||(Ir&&Ir.userAgent?Ir.userAgent:""),kh=Ir&&Ir.userAgentData?Ir.userAgentData:o,ci=Ji?function($n,Ha){var tg={};for(var Cd in $n)Ha[Cd]&&Ha[Cd].length%2==0?tg[Cd]=Ha[Cd].concat($n[Cd]):tg[Cd]=$n[Cd];return tg}(ZP,Ji):ZP;return this.getBrowser=function(){var $n={};return $n[S]=o,$n[N]=o,iy.call($n,_c,ci.browser),$n[_]=function(Ha){return typeof Ha===m?Ha.replace(/[^\d\.]/g,"").split(".")[0]:o}($n[N]),Ir&&Ir.brave&&typeof Ir.brave.isBrave==c&&($n[S]="Brave"),$n},this.getCPU=function(){var $n={};return $n[G]=o,iy.call($n,_c,ci.cpu),$n},this.getDevice=function(){var $n={};return $n[P]=o,$n[E]=o,$n[R]=o,iy.call($n,_c,ci.device),!$n[R]&&kh&&kh.mobile&&($n[R]=j),$n[E]=="Macintosh"&&Ir&&typeof Ir.standalone!==u&&Ir.maxTouchPoints&&Ir.maxTouchPoints>2&&($n[E]="iPad",$n[R]=q),$n},this.getEngine=function(){var $n={};return $n[S]=o,$n[N]=o,iy.call($n,_c,ci.engine),$n},this.getOS=function(){var $n={};return $n[S]=o,$n[N]=o,iy.call($n,_c,ci.os),!$n[S]&&kh&&kh.platform!="Unknown"&&($n[S]=kh.platform.replace(/chrome os/i,Qe).replace(/macos/i,Xt)),$n},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return _c},this.setUA=function($n){return _c=typeof $n===m&&$n.length>350?lf($n,350):$n,this},this.setUA(_c),this};xl.VERSION="0.7.34",xl.BROWSER=ar([S,N,_]),xl.CPU=ar([G]),xl.DEVICE=ar([E,P,R,F,j,ee,q,he,Se]),xl.ENGINE=xl.OS=ar([S,N]),e.exports&&(r=e.exports=xl),r.UAParser=xl;var eg=typeof i!==u&&(i.jQuery||i.Zepto);if(eg&&!eg.ua){var sy=new xl;eg.ua=sy.getResult(),eg.ua.get=function(){return sy.getUA()},eg.ua.set=function(Pi){sy.setUA(Pi);var Ji=sy.getResult();for(var Ir in Ji)eg.ua[Ir]=Ji[Ir]}}})(typeof window=="object"?window:a)})(qD,qD.exports);var Sue=l(qD.exports),bue=Nc,Tue=Ti,wue=Ft,Cue=Zd,Rue=_r("iterator"),Iue=Object,Aue=function(e){if(wue(e))return!1;var r=Iue(e);return r[Rue]!==void 0||"@@iterator"in r||Tue(Cue,bue(r))},Pue=l(Aue),mB=ZE.clear;zn({global:!0,bind:!0,forced:V.clearImmediate!==mB},{clearImmediate:mB});var Oue=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",gB=V,kue=ie,Nue=Le,Due=Oue,xue=Et,Lue=Ts,Mue=bl,Uue=gB.Function,Vue=/MSIE .\./.test(xue)||Due&&function(){var e=gB.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),Fue=zn,_B=V,yB=ZE.set,jue=function(e,r){var i=1;return Vue?function(o,c){var u=Mue(arguments.length,1)>i,h=Nue(o)?o:Uue(o),m=u?Lue(arguments,i):[],_=u?function(){kue(h,this,m)}:h;return e(_)}:e},EB=_B.setImmediate?jue(yB):yB;Fue({global:!0,bind:!0,forced:_B.setImmediate!==EB},{setImmediate:EB});var vB=l(mt.setImmediate),Bue=zn,Wue=hc,zue=gt,Gue=bl,Hue=Tp,$ue=V.process;Bue({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){Gue(arguments.length,1),zue(e);var r=Hue&&$ue.domain;Wue(r?r.bind(e):e)}});var SB=l(mt.queueMicrotask);function bB(e,r){return function(){return e.apply(r,arguments)}}const{toString:Kue}=Object.prototype,{getPrototypeOf:YD}=Object,nA=(XD=Object.create(null),e=>{const r=Kue.call(e);return XD[r]||(XD[r]=r.slice(8,-1).toLowerCase())});var XD;const hd=e=>(e=e.toLowerCase(),r=>nA(r)===e),rA=e=>r=>typeof r===e,{isArray:wv}=Array,sT=rA("undefined"),TB=hd("ArrayBuffer"),que=rA("string"),wl=rA("function"),wB=rA("number"),iA=e=>e!==null&&typeof e=="object",sA=e=>{if(nA(e)!=="object")return!1;const r=YD(e);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in e||Pue(e))},Yue=hd("Date"),Xue=hd("File"),Jue=hd("Blob"),Que=hd("FileList"),Zue=hd("URLSearchParams"),[ede,tde,nde,rde]=["ReadableStream","Request","Response","Headers"].map(hd);function oT(e,r){let i,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),wv(e))for(i=0,o=e.length;i<o;i++)r.call(null,e[i],i,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(i=0;i<h;i++)m=u[i],r.call(null,e[m],m,e)}}function CB(e,r){r=r.toLowerCase();const i=Object.keys(e);let o,c=i.length;for(;c-- >0;)if(o=i[c],r===o.toLowerCase())return o;return null}const A_=fB!==void 0?fB:typeof self<"u"?self:typeof window<"u"?window:py,RB=e=>!sT(e)&&e!==A_,ide=(JD=typeof Uint8Array<"u"&&YD(Uint8Array),e=>JD&&e instanceof JD);var JD;const sde=hd("HTMLFormElement"),IB=(e=>{let{hasOwnProperty:r}=e;return(i,o)=>r.call(i,o)})(Object.prototype),ode=hd("RegExp"),AB=(e,r)=>{const i=Object.getOwnPropertyDescriptors(e),o={};oT(i,(c,u)=>{let h;(h=r(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},QD="abcdefghijklmnopqrstuvwxyz",PB="0123456789",OB={DIGIT:PB,ALPHA:QD,ALPHA_DIGIT:QD+QD.toUpperCase()+PB},ade=hd("AsyncFunction"),kB=(NB=typeof vB=="function",DB=wl(A_.postMessage),NB?vB:DB?(ZD="axios@".concat(Math.random()),oA=[],A_.addEventListener("message",e=>{let{source:r,data:i}=e;r===A_&&i===ZD&&oA.length&&oA.shift()()},!1),e=>{oA.push(e),A_.postMessage(ZD,"*")}):e=>setTimeout(e));var NB,DB,ZD,oA;const cde=SB!==void 0?SB.bind(A_):typeof process<"u"&&process.nextTick||kB;var ct={isArray:wv,isArrayBuffer:TB,isBuffer:function(e){return e!==null&&!sT(e)&&e.constructor!==null&&!sT(e.constructor)&&wl(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||wl(e.append)&&((r=nA(e))==="formdata"||r==="object"&&wl(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&TB(e.buffer),r},isString:que,isNumber:wB,isBoolean:e=>e===!0||e===!1,isObject:iA,isPlainObject:sA,isReadableStream:ede,isRequest:tde,isResponse:nde,isHeaders:rde,isUndefined:sT,isDate:Yue,isFile:Xue,isBlob:Jue,isRegExp:ode,isFunction:wl,isStream:e=>iA(e)&&wl(e.pipe),isURLSearchParams:Zue,isTypedArray:ide,isFileList:Que,forEach:oT,merge:function e(){const{caseless:r}=RB(this)&&this||{},i={},o=(c,u)=>{const h=r&&CB(i,u)||u;sA(i[h])&&sA(c)?i[h]=e(i[h],c):sA(c)?i[h]=e({},c):wv(c)?i[h]=c.slice():i[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&oT(arguments[c],o);return i},extend:function(e,r,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return oT(r,(c,u)=>{i&&wl(c)?e[u]=bB(c,i):e[u]=c},{allOwnKeys:o}),e},trim:e=>ho(e)?ho(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,r,i,o)=>{e.prototype=Object.create(r.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,r,i,o)=>{let c,u,h;const m={};if(r=r||{},e==null)return r;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,r)||m[h]||(r[h]=e[h],m[h]=!0);e=i!==!1&&YD(e)}while(e&&(!i||i(e,r))&&e!==Object.prototype);return r},kindOf:nA,kindOfTest:hd,endsWith:(e,r,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=r.length;const o=e.indexOf(r,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(wv(e))return e;let r=e.length;if(!wB(r))return null;const i=new Array(r);for(;r-- >0;)i[r]=e[r];return i},forEachEntry:(e,r)=>{const i=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=i.next())&&!o.done;){const c=o.value;r.call(e,c[0],c[1])}},matchAll:(e,r)=>{let i;const o=[];for(;(i=e.exec(r))!==null;)o.push(i);return o},isHTMLForm:sde,hasOwnProperty:IB,hasOwnProp:IB,reduceDescriptors:AB,freezeMethods:e=>{AB(e,(r,i)=>{if(wl(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const o=e[i];wl(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,r)=>{const i={},o=c=>{c.forEach(u=>{i[u]=!0})};return wv(e)?o(e):o(String(e).split(r)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,r)=>e!=null&&Number.isFinite(e=+e)?e:r,findKey:CB,global:A_,isContextDefined:RB,ALPHABET:OB,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:OB.ALPHA_DIGIT,i="";const{length:o}=r;for(;e--;)i+=r[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&wl(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const r=new Array(10),i=(o,c)=>{if(iA(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const u=wv(o)?[]:{};return oT(o,(h,m)=>{const _=i(h,c+1);!sT(_)&&(u[m]=_)}),r[c]=void 0,u}}return o};return i(e,0)},isAsyncFn:ade,isThenable:e=>e&&(iA(e)||wl(e))&&wl(e.then)&&wl(e.catch),setImmediate:kB,asap:cde};function sr(e,r,i,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}ct.inherits(sr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ct.toJSONObject(this.config),code:this.code,status:this.status}}});const xB=sr.prototype,LB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{LB[e]={value:e}}),Object.defineProperties(sr,LB),Object.defineProperty(xB,"isAxiosError",{value:!0}),sr.from=(e,r,i,o,c,u)=>{const h=Object.create(xB);return ct.toFlatObject(e,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),sr.call(h,e.message,r,i,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function ex(e){return ct.isPlainObject(e)||ct.isArray(e)}function MB(e){return ct.endsWith(e,"[]")?e.slice(0,-2):e}function UB(e,r,i){return e?e.concat(r).map(function(o,c){return o=MB(o),!i&&c?"["+o+"]":o}).join(i?".":""):r}const lde=ct.toFlatObject(ct,{},null,function(e){return/^is[A-Z]/.test(e)});function aA(e,r,i){if(!ct.isObject(e))throw new TypeError("target must be an object");r=r||new FormData;const o=(i=ct.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,N){return!ct.isUndefined(N[P])})).metaTokens,c=i.visitor||E,u=i.dots,h=i.indexes,m=(i.Blob||typeof Blob<"u"&&Blob)&&ct.isSpecCompliantForm(r);if(!ct.isFunction(c))throw new TypeError("visitor must be a function");function _(P){if(P===null)return"";if(ct.isDate(P))return P.toISOString();if(!m&&ct.isBlob(P))throw new sr("Blob is not supported. Use a Buffer instead.");return ct.isArrayBuffer(P)||ct.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function E(P,N,G){let F=P;if(P&&!G&&typeof P=="object"){if(ct.endsWith(N,"{}"))N=o?N:N.slice(0,-2),P=JSON.stringify(P);else if(ct.isArray(P)&&function(j){return ct.isArray(j)&&!j.some(ex)}(P)||(ct.isFileList(P)||ct.endsWith(N,"[]"))&&(F=ct.toArray(P)))return N=MB(N),F.forEach(function(j,q){!ct.isUndefined(j)&&j!==null&&r.append(h===!0?UB([N],q,u):h===null?N:N+"[]",_(j))}),!1}return!!ex(P)||(r.append(UB(G,N,u),_(P)),!1)}const S=[],R=Object.assign(lde,{defaultVisitor:E,convertValue:_,isVisitable:ex});if(!ct.isObject(e))throw new TypeError("data must be an object");return function P(N,G){if(!ct.isUndefined(N)){if(S.indexOf(N)!==-1)throw Error("Circular reference detected in "+G.join("."));S.push(N),ct.forEach(N,function(F,j){(!(ct.isUndefined(F)||F===null)&&c.call(r,F,ct.isString(j)?ho(j).call(j):j,G,R))===!0&&P(F,G?G.concat(j):[j])}),S.pop()}}(e),r}function VB(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function tx(e,r){this._pairs=[],e&&aA(e,this,r)}const FB=tx.prototype;function ude(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function jB(e,r,i){if(!r)return e;const o=i&&i.encode||ude;ct.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(r,i):ct.isURLSearchParams(r)?r.toString():new tx(r,i).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}FB.append=function(e,r){this._pairs.push([e,r])},FB.toString=function(e){const r=e?function(i){return e.call(this,i,VB)}:VB;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var BB=class{constructor(){this.handlers=[]}use(e,r,i){return this.handlers.push({fulfilled:e,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ct.forEach(this.handlers,function(r){r!==null&&e(r)})}},WB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},zB={exports:{}},dde=zn,hde=$e,GB=tt.f;dde({target:"Object",stat:!0,forced:Object.defineProperty!==GB,sham:!hde},{defineProperty:GB});var HB=mt.Object,pde=zB.exports=function(e,r,i){return HB.defineProperty(e,r,i)};HB.defineProperty.sham&&(pde.sham=!0);var $B=l(zB.exports),fde=TypeError,KB=$g,mde=m_,gde=ht,_de=_r("species"),qB=Array,yde=function(e){var r;return KB(e)&&(r=e.constructor,(mde(r)&&(r===qB||KB(r.prototype))||gde(r)&&(r=r[_de])===null)&&(r=void 0)),r===void 0?qB:r},YB=function(e,r){return new(yde(e))(r===0?0:r)},Ede=d,vde=ii,Sde=_r("species"),XB=function(e){return vde>=51||!Ede(function(){var r=[];return(r.constructor={})[Sde]=function(){return{foo:1}},r[e](Boolean).foo!==1})},bde=zn,Tde=d,wde=$g,Cde=ht,Rde=$o,Ide=mi,JB=function(e){if(e>9007199254740991)throw fde("Maximum allowed index exceeded");return e},QB=UI,Ade=YB,Pde=XB,Ode=ii,ZB=_r("isConcatSpreadable"),kde=Ode>=51||!Tde(function(){var e=[];return e[ZB]=!1,e.concat()[0]!==e}),Nde=function(e){if(!Cde(e))return!1;var r=e[ZB];return r!==void 0?!!r:wde(e)};bde({target:"Array",proto:!0,forced:!kde||!Pde("concat")},{concat:function(e){var r,i,o,c,u,h=Rde(this),m=Ade(h,0),_=0;for(r=-1,o=arguments.length;r<o;r++)if(Nde(u=r===-1?h:arguments[r]))for(c=Ide(u),JB(_+c),i=0;i<c;i++,_++)i in u&&QB(m,_,u[i]);else JB(_+1),QB(m,_++,u);return m.length=_,m}});var e6={},Dde=Y,xde=Re,t6=Xd.f,Lde=iD,n6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e6.f=function(e){return n6&&Dde(e)=="Window"?function(r){try{return t6(r)}catch{return Lde(n6)}}(e):t6(xde(e))};var Cv={},Mde=_r;Cv.f=Mde;var r6=mt,Ude=Ti,Vde=Cv,Fde=tt.f,Rs=function(e){var r=r6.Symbol||(r6.Symbol={});Ude(r,e)||Fde(r,e,{value:Vde.f(e)})},jde=Ee,Bde=en,Wde=_r,zde=id,i6=function(){var e=Bde("Symbol"),r=e&&e.prototype,i=r&&r.valueOf,o=Wde("toPrimitive");r&&!r[o]&&zde(r,o,function(c){return jde(i,this)},{})},Gde=De,Hde=fn,$de=$o,Kde=mi,qde=YB,s6=I([].push),Yde=function(e){var r=e==1,i=e==2,o=e==3,c=e==4,u=e==6,h=e==7,m=e==5||u;return function(_,E,S,R){for(var P,N,G=$de(_),F=Hde(G),j=Gde(E,S),q=Kde(F),ee=0,he=R||qde,Se=r?he(_,q):i||h?he(_,0):void 0;q>ee;ee++)if((m||ee in F)&&(N=j(P=F[ee],ee,G),e))if(r)Se[ee]=N;else if(N)switch(e){case 3:return!0;case 5:return P;case 6:return ee;case 2:s6(Se,P)}else switch(e){case 4:return!1;case 7:s6(Se,P)}return u?-1:o||c?c:Se}},o6={forEach:Yde(0)},cA=zn,nx=V,rx=Ee,Xde=I,Rv=$e,Iv=qs,Jde=d,ko=Ti,Qde=k,ix=hn,lA=Re,sx=sc,Zde=ka,ox=Je,aT=ia,a6=Lc,ehe=Xd,c6=e6,the=xc,l6=We,u6=tt,nhe=hE,d6=ke,h6=id,rhe=VE,ax=rc,p6=Dc,f6=zd,ihe=_r,she=Cv,ohe=Rs,ahe=i6,che=sd,m6=rd,uA=o6.forEach,Gc=qg("hidden"),dA="Symbol",cT="prototype",lhe=m6.set,g6=m6.getterFor(dA),pd=Object[cT],P_=nx.Symbol,hA=P_&&P_[cT],uhe=nx.TypeError,cx=nx.QObject,_6=l6.f,O_=u6.f,y6=c6.f,dhe=d6.f,E6=Xde([].push),$p=ax("symbols"),lT=ax("op-symbols"),hhe=ax("wks"),lx=!cx||!cx[cT]||!cx[cT].findChild,ux=Rv&&Jde(function(){return aT(O_({},"a",{get:function(){return O_(this,"a",{value:7}).a}})).a!=7})?function(e,r,i){var o=_6(pd,r);o&&delete pd[r],O_(e,r,i),o&&e!==pd&&O_(pd,r,o)}:O_,dx=function(e,r){var i=$p[e]=aT(hA);return lhe(i,{type:dA,tag:e,description:r}),Rv||(i.description=r),i},pA=function(e,r,i){e===pd&&pA(lT,r,i),ix(e);var o=sx(r);return ix(i),ko($p,o)?(i.enumerable?(ko(e,Gc)&&e[Gc][o]&&(e[Gc][o]=!1),i=aT(i,{enumerable:ox(0,!1)})):(ko(e,Gc)||O_(e,Gc,ox(1,{})),e[Gc][o]=!0),ux(e,o,i)):O_(e,o,i)},hx=function(e,r){ix(e);var i=lA(r),o=a6(i).concat(T6(i));return uA(o,function(c){Rv&&!rx(v6,i,c)||pA(e,c,i[c])}),e},v6=function(e){var r=sx(e),i=rx(dhe,this,r);return!(this===pd&&ko($p,r)&&!ko(lT,r))&&(!(i||!ko(this,r)||!ko($p,r)||ko(this,Gc)&&this[Gc][r])||i)},S6=function(e,r){var i=lA(e),o=sx(r);if(i!==pd||!ko($p,o)||ko(lT,o)){var c=_6(i,o);return!c||!ko($p,o)||ko(i,Gc)&&i[Gc][o]||(c.enumerable=!0),c}},b6=function(e){var r=y6(lA(e)),i=[];return uA(r,function(o){ko($p,o)||ko(p6,o)||E6(i,o)}),i},T6=function(e){var r=e===pd,i=y6(r?lT:lA(e)),o=[];return uA(i,function(c){!ko($p,c)||r&&!ko(pd,c)||E6(o,$p[c])}),o};Iv||(P_=function(){if(Qde(hA,this))throw uhe("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Zde(arguments[0]):void 0,r=f6(e),i=function(o){this===pd&&rx(i,lT,o),ko(this,Gc)&&ko(this[Gc],r)&&(this[Gc][r]=!1),ux(this,r,ox(1,o))};return Rv&&lx&&ux(pd,r,{configurable:!0,set:i}),dx(r,e)},h6(hA=P_[cT],"toString",function(){return g6(this).tag}),h6(P_,"withoutSetter",function(e){return dx(f6(e),e)}),d6.f=v6,u6.f=pA,nhe.f=hx,l6.f=S6,ehe.f=c6.f=b6,the.f=T6,she.f=function(e){return dx(ihe(e),e)},Rv&&rhe(hA,"description",{configurable:!0,get:function(){return g6(this).description}})),cA({global:!0,wrap:!0,forced:!Iv,sham:!Iv},{Symbol:P_}),uA(a6(hhe),function(e){ohe(e)}),cA({target:dA,stat:!0,forced:!Iv},{useSetter:function(){lx=!0},useSimple:function(){lx=!1}}),cA({target:"Object",stat:!0,forced:!Iv,sham:!Rv},{create:function(e,r){return r===void 0?aT(e):hx(aT(e),r)},defineProperty:pA,defineProperties:hx,getOwnPropertyDescriptor:S6}),cA({target:"Object",stat:!0,forced:!Iv},{getOwnPropertyNames:b6}),ahe(),che(P_,dA),p6[Gc]=!0;var w6=qs&&!!Symbol.for&&!!Symbol.keyFor,phe=zn,fhe=en,mhe=Ti,ghe=ka,C6=rc,_he=w6,px=C6("string-to-symbol-registry"),yhe=C6("symbol-to-string-registry");phe({target:"Symbol",stat:!0,forced:!_he},{for:function(e){var r=ghe(e);if(mhe(px,r))return px[r];var i=fhe("Symbol")(r);return px[r]=i,yhe[i]=r,i}});var Ehe=zn,vhe=Ti,She=tc,bhe=Ia,The=w6,R6=rc("symbol-to-string-registry");Ehe({target:"Symbol",stat:!0,forced:!The},{keyFor:function(e){if(!She(e))throw TypeError(bhe(e)+" is not a symbol");if(vhe(R6,e))return R6[e]}});var I6=$g,whe=Le,A6=Y,Che=ka,P6=I([].push),Rhe=zn,O6=en,k6=ie,Ihe=Ee,uT=I,N6=d,D6=Le,x6=tc,L6=Ts,Ahe=function(e){if(whe(e))return e;if(I6(e)){for(var r=e.length,i=[],o=0;o<r;o++){var c=e[o];typeof c=="string"?P6(i,c):typeof c!="number"&&A6(c)!="Number"&&A6(c)!="String"||P6(i,Che(c))}var u=i.length,h=!0;return function(m,_){if(h)return h=!1,_;if(I6(this))return _;for(var E=0;E<u;E++)if(i[E]===m)return _}}},Phe=qs,Ohe=String,xm=O6("JSON","stringify"),fA=uT(/./.exec),M6=uT("".charAt),khe=uT("".charCodeAt),Nhe=uT("".replace),Dhe=uT(1 .toString),xhe=/[\uD800-\uDFFF]/g,U6=/^[\uD800-\uDBFF]$/,V6=/^[\uDC00-\uDFFF]$/,F6=!Phe||N6(function(){var e=O6("Symbol")();return xm([e])!="[null]"||xm({a:e})!="{}"||xm(Object(e))!="{}"}),j6=N6(function(){return xm("\uDF06\uD834")!=='"\\udf06\\ud834"'||xm("\uDEAD")!=='"\\udead"'}),Lhe=function(e,r){var i=L6(arguments),o=Ahe(r);if(D6(o)||e!==void 0&&!x6(e))return i[1]=function(c,u){if(D6(o)&&(u=Ihe(o,this,Ohe(c),u)),!x6(u))return u},k6(xm,null,i)},Mhe=function(e,r,i){var o=M6(i,r-1),c=M6(i,r+1);return fA(U6,e)&&!fA(V6,c)||fA(V6,e)&&!fA(U6,o)?"\\u"+Dhe(khe(e,0),16):e};xm&&Rhe({target:"JSON",stat:!0,forced:F6||j6},{stringify:function(e,r,i){var o=L6(arguments),c=k6(F6?Lhe:xm,null,o);return j6&&typeof c=="string"?Nhe(c,xhe,Mhe):c}});var B6=xc,Uhe=$o;zn({target:"Object",stat:!0,forced:!qs||d(function(){B6.f(1)})},{getOwnPropertySymbols:function(e){var r=B6.f;return r?r(Uhe(e)):[]}}),Rs("asyncIterator"),Rs("hasInstance"),Rs("isConcatSpreadable"),Rs("iterator"),Rs("match"),Rs("matchAll"),Rs("replace"),Rs("search"),Rs("species"),Rs("split");var Vhe=i6;Rs("toPrimitive"),Vhe();var Fhe=en,jhe=sd;Rs("toStringTag"),jhe(Fhe("Symbol"),"Symbol"),Rs("unscopables"),sd(V.JSON,"JSON",!0);var Bhe=mt.Symbol,Whe=_r,zhe=tt.f,W6=Whe("metadata"),z6=Function.prototype;z6[W6]===void 0&&zhe(z6,W6,{value:null}),Rs("dispose"),Rs("metadata");var Ghe=Bhe;Rs("asyncDispose");var Hhe=I,fx=en("Symbol"),$he=fx.keyFor,Khe=Hhe(fx.prototype.valueOf),G6=fx.isRegisteredSymbol||function(e){try{return $he(Khe(e))!==void 0}catch{return!1}};zn({target:"Symbol",stat:!0},{isRegisteredSymbol:G6});for(var qhe=rc,H6=en,Yhe=I,Xhe=tc,Jhe=_r,mA=H6("Symbol"),$6=mA.isWellKnownSymbol,K6=H6("Object","getOwnPropertyNames"),Qhe=Yhe(mA.prototype.valueOf),q6=qhe("wks"),mx=0,Y6=K6(mA),Zhe=Y6.length;mx<Zhe;mx++)try{var X6=Y6[mx];Xhe(mA[X6])&&Jhe(X6)}catch{}var J6=function(e){if($6&&$6(e))return!0;try{for(var r=Qhe(e),i=0,o=K6(q6),c=o.length;i<c;i++)if(q6[o[i]]==r)return!0}catch{}return!1};zn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:J6}),Rs("matcher"),Rs("observable"),zn({target:"Symbol",stat:!0},{isRegistered:G6}),zn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:J6}),Rs("metadataKey"),Rs("patternMatch"),Rs("replaceAll");var Av=l(Ghe),Q6=l(Cv.f("iterator"));function dT(e){return dT=typeof Av=="function"&&typeof Q6=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Av=="function"&&r.constructor===Av&&r!==Av.prototype?"symbol":typeof r},dT(e)}var epe=l(Cv.f("toPrimitive"));function tpe(e){var r=function(i,o){if(dT(i)!=="object"||i===null)return i;var c=i[epe];if(c!==void 0){var u=c.call(i,o);if(dT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return dT(r)==="symbol"?r:String(r)}function K(e,r,i){return(r=tpe(r))in e?$B(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}var Z6=l(Lce),npe={isBrowser:!0,classes:{URLSearchParams:Z6!==void 0?Z6:tx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const gx=typeof window<"u"&&typeof document<"u",_x=typeof navigator=="object"&&navigator||void 0,rpe=gx&&(!_x||["ReactNative","NativeScript","NS"].indexOf(_x.product)<0),ipe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",spe=gx&&window.location.href||"http://localhost";function e8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function t8(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?e8(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):e8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Fa=t8(t8({},Object.freeze({__proto__:null,hasBrowserEnv:gx,hasStandardBrowserEnv:rpe,hasStandardBrowserWebWorkerEnv:ipe,navigator:_x,origin:spe})),npe),ope=hn,ape=Ee,cpe=Ti,lpe=k,upe=function(){var e=ope(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},n8=RegExp.prototype,r8=function(e){var r=e.flags;return r!==void 0||"flags"in n8||cpe(e,"flags")||!lpe(n8,e)?r:ape(upe,e)},dpe=ZN.charAt,i8=Ee,hpe=hn,ppe=Le,fpe=Y,mpe=/./.exec,gpe=TypeError,_pe=zn,s8=Ee,o8=se,ype=OE,gA=LE,a8=Yt,c8=Vt,hT=ka,Epe=hn,vpe=Ft,Spe=Y,bpe=_R,l8=r8,Tpe=fi,wpe=d,Cpe=is,Rpe=function(e,r,i){return r+(i?dpe(e,r).length:1)},Ipe=function(e,r){var i=e.exec;if(ppe(i)){var o=i8(i,e,r);return o!==null&&hpe(o),o}if(fpe(e)==="RegExp")return i8(mpe,e,r);throw gpe("RegExp#exec called on incompatible receiver")},u8=rd,Ape=_r("matchAll"),d8="RegExp String",h8=d8+" Iterator",Ppe=u8.set,Ope=u8.getterFor(h8),kpe=TypeError,yx=o8("".indexOf),_A=o8("".matchAll),Ex=!!_A&&!wpe(function(){_A("a",/./)}),Npe=ype(function(e,r,i,o){Ppe(this,{type:h8,regexp:e,string:r,global:i,unicode:o,done:!1})},d8,function(){var e=Ope(this);if(e.done)return gA(void 0,!0);var r=e.regexp,i=e.string,o=Ipe(r,i);return o===null?(e.done=!0,gA(void 0,!0)):e.global?(hT(o[0])===""&&(r.lastIndex=Rpe(i,c8(r.lastIndex),e.unicode)),gA(o,!1)):(e.done=!0,gA(o,!1))}),p8=function(e){var r,i,o,c=Epe(this),u=hT(e),h=Cpe(c,RegExp),m=hT(l8(c));return r=new h(h===RegExp?c.source:c,m),i=!!~yx(m,"g"),o=!!~yx(m,"u"),r.lastIndex=c8(c.lastIndex),new Npe(r,u,i,o)};_pe({target:"String",proto:!0,forced:Ex},{matchAll:function(e){var r,i,o,c,u=a8(this);if(vpe(e)){if(Ex)return _A(u,e)}else{if(bpe(e)&&(r=hT(a8(l8(e))),!~yx(r,"g")))throw kpe("`.matchAll` does not allow non-global regexes");if(Ex)return _A(u,e);if((o=Tpe(e,Ape))===void 0&&Spe(e)=="RegExp"&&(o=p8),o)return s8(o,e,u)}return i=hT(u),c=new RegExp(e,"g"),s8(p8,c,i)}});var Dpe=ac("String").matchAll,xpe=k,Lpe=Dpe,vx=String.prototype,Mpe=function(e){var r=e.matchAll;return typeof e=="string"||e===vx||xpe(vx,e)&&r===vx.matchAll?Lpe:r},Upe=l(Mpe);function f8(e){function r(i,o,c,u){let h=i[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),_=u>=i.length;return h=!h&&ct.isArray(c)?c.length:h,_?(ct.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&ct.isObject(c[h])||(c[h]=[]),r(i,o,c[h],u)&&ct.isArray(c[h])&&(c[h]=function(E){const S={},R=Object.keys(E);let P;const N=R.length;let G;for(P=0;P<N;P++)G=R[P],S[G]=E[G];return S}(c[h])),!m)}if(ct.isFormData(e)&&ct.isFunction(e.entries)){const i={};return ct.forEachEntry(e,(o,c)=>{r(function(u){return Upe(ct).call(ct,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,i,0)}),i}return null}const Sx={transitional:WB,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const i=r.getContentType()||"",o=i.indexOf("application/json")>-1,c=ct.isObject(e);if(c&&ct.isHTMLForm(e)&&(e=new FormData(e)),ct.isFormData(e))return o?JSON.stringify(f8(e)):e;if(ct.isArrayBuffer(e)||ct.isBuffer(e)||ct.isStream(e)||ct.isFile(e)||ct.isBlob(e)||ct.isReadableStream(e))return e;if(ct.isArrayBufferView(e))return e.buffer;if(ct.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return aA(h,new Fa.classes.URLSearchParams,Object.assign({visitor:function(_,E,S,R){return Fa.isNode&&ct.isBuffer(_)?(this.append(E,_.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((u=ct.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return aA(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,_){if(ct.isString(h))try{return(m||JSON.parse)(h),ho(ct).call(ct,h)}catch(E){if(E.name!=="SyntaxError")throw E}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const r=this.transitional||Sx.transitional,i=r&&r.forcedJSONParsing,o=this.responseType==="json";if(ct.isResponse(e)||ct.isReadableStream(e))return e;if(e&&ct.isString(e)&&(i&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?sr.from(u,sr.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Fa.classes.FormData,Blob:Fa.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ct.forEach(["delete","get","head","post","put","patch"],e=>{Sx.headers[e]={}});var bx=Sx;const Vpe=ct.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),m8=Symbol("internals");function pT(e){var r;return e&&ho(r=String(e)).call(r).toLowerCase()}function yA(e){return e===!1||e==null?e:ct.isArray(e)?e.map(yA):String(e)}function Tx(e,r,i,o,c){return ct.isFunction(o)?o.call(this,r,i):(c&&(r=i),ct.isString(r)?ct.isString(o)?r.indexOf(o)!==-1:ct.isRegExp(o)?o.test(r):void 0:void 0)}class EA{constructor(r){r&&this.set(r)}set(r,i,o){const c=this;function u(_,E,S){const R=pT(E);if(!R)throw new Error("header name must be a non-empty string");const P=ct.findKey(c,R);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||E]=yA(_))}const h=(_,E)=>ct.forEach(_,(S,R)=>u(S,R,E));if(ct.isPlainObject(r)||r instanceof this.constructor)h(r,i);else if(ct.isString(r)&&(r=ho(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ho(m=r).call(m)))h((_=>{const E={};let S,R,P;return _&&_.split(`
`).forEach(function(N){var G,F;P=N.indexOf(":"),S=ho(G=N.substring(0,P)).call(G).toLowerCase(),R=ho(F=N.substring(P+1)).call(F),!S||E[S]&&Vpe[S]||(S==="set-cookie"?E[S]?E[S].push(R):E[S]=[R]:E[S]=E[S]?E[S]+", "+R:R)}),E})(r),i);else if(ct.isHeaders(r))for(const[_,E]of r.entries())u(E,_,o);else r!=null&&u(i,r,o);var m;return this}get(r,i){if(r=pT(r)){const o=ct.findKey(this,r);if(o){const c=this[o];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(u);)h[_[1]]=_[2];return h}(c);if(ct.isFunction(i))return i.call(this,c,o);if(ct.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,i){if(r=pT(r)){const o=ct.findKey(this,r);return!(!o||this[o]===void 0||i&&!Tx(0,this[o],o,i))}return!1}delete(r,i){const o=this;let c=!1;function u(h){if(h=pT(h)){const m=ct.findKey(o,h);!m||i&&!Tx(0,o[m],m,i)||(delete o[m],c=!0)}}return ct.isArray(r)?r.forEach(u):u(r),c}clear(r){const i=Object.keys(this);let o=i.length,c=!1;for(;o--;){const u=i[o];r&&!Tx(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const i=this,o={};return ct.forEach(this,(c,u)=>{var h;const m=ct.findKey(o,u);if(m)return i[m]=yA(c),void delete i[u];const _=r?function(E){return ho(E).call(E).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,P)=>R.toUpperCase()+P)}(u):ho(h=String(u)).call(h);_!==u&&delete i[u],i[_]=yA(c),o[_]=!0}),this}concat(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(r){const i=Object.create(null);return ct.forEach(this,(o,c)=>{o!=null&&o!==!1&&(i[c]=r&&ct.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[i,o]=r;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const i=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(r){const i=(this[m8]=this[m8]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=pT(u);i[h]||(function(m,_){const E=ct.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+E,{value:function(R,P,N){return this[S].call(this,_,R,P,N)},configurable:!0})})}(o,u),i[h]=!0)}return ct.isArray(r)?r.forEach(c):c(r),this}}EA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ct.reduceDescriptors(EA.prototype,(e,r)=>{let{value:i}=e,o=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(c){this[o]=c}}}),ct.freezeMethods(EA);var fd=EA;function wx(e,r){const i=this||bx,o=r||i,c=fd.from(o.headers);let u=o.data;return ct.forEach(e,function(h){u=h.call(i,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function g8(e){return!(!e||!e.__CANCEL__)}function Pv(e,r,i){sr.call(this,e??"canceled",sr.ERR_CANCELED,r,i),this.name="CanceledError"}function _8(e,r,i){const o=i.config.validateStatus;i.status&&o&&!o(i.status)?r(new sr("Request failed with status code "+i.status,[sr.ERR_BAD_REQUEST,sr.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}ct.inherits(Pv,sr,{__CANCEL__:!0});const vA=function(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),_=new Array(u);let E,S=0,R=0;return h=h!==void 0?h:1e3,function(P){const N=Date.now(),G=_[R];E||(E=N),m[S]=P,_[S]=N;let F=R,j=0;for(;F!==S;)j+=m[F++],F%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),N-E<h)return;const q=G&&N-G;return q?Math.round(1e3*j/q):void 0}}(50,250);return function(u,h){let m,_,E=0,S=1e3/h;const R=function(P){E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),u.apply(null,P)};return[function(){const P=Date.now(),N=P-E;for(var G=arguments.length,F=new Array(G),j=0;j<G;j++)F[j]=arguments[j];N>=S?R(F,P):(m=F,_||(_=setTimeout(()=>{_=null,R(m)},S-N)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,_=h-o,E=c(_);o=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:_,rate:E||void 0,estimated:E&&m&&h<=m?(m-h)/E:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},i)},y8=(e,r)=>{const i=e!=null;return[o=>r[0]({lengthComputable:i,total:e,loaded:o}),r[1]]},E8=e=>function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return ct.asap(()=>e(...i))};var Fpe=Fa.hasStandardBrowserEnv?((e,r)=>i=>(i=new YI(i,Fa.origin),e.protocol===i.protocol&&e.host===i.host&&(r||e.port===i.port)))(new YI(Fa.origin),Fa.navigator&&/(msie|trident)/i.test(Fa.navigator.userAgent)):()=>!0,jpe=Fa.hasStandardBrowserEnv?{write(e,r,i,o,c,u){const h=[e+"="+encodeURIComponent(r)];ct.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),ct.isString(o)&&h.push("path="+o),ct.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function v8(e,r){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(r)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,r):r}function S8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const b8=e=>e instanceof fd?function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?S8(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):S8(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e):e;function k_(e,r){r=r||{};const i={};function o(E,S,R,P){return ct.isPlainObject(E)&&ct.isPlainObject(S)?ct.merge.call({caseless:P},E,S):ct.isPlainObject(S)?ct.merge({},S):ct.isArray(S)?S.slice():S}function c(E,S,R,P){return ct.isUndefined(S)?ct.isUndefined(E)?void 0:o(void 0,E,0,P):o(E,S,0,P)}function u(E,S){if(!ct.isUndefined(S))return o(void 0,S)}function h(E,S){return ct.isUndefined(S)?ct.isUndefined(E)?void 0:o(void 0,E):o(void 0,S)}function m(E,S,R){return R in r?o(E,S):R in e?o(void 0,E):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(E,S,R)=>c(b8(E),b8(S),0,!0)};return ct.forEach(Object.keys(Object.assign({},e,r)),function(E){const S=_[E]||c,R=S(e[E],r[E],E);ct.isUndefined(R)&&S!==m||(i[E]=R)}),i}var T8=e=>{const r=k_({},e);let i,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:_}=r;if(r.headers=m=fd.from(m),r.url=jB(v8(r.baseURL,r.url),e.params,e.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),ct.isFormData(o)){if(Fa.hasStandardBrowserEnv||Fa.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((i=m.getContentType())!==!1){const[E,...S]=i?i.split(";").map(R=>ho(R).call(R)).filter(Boolean):[];m.setContentType([E||"multipart/form-data",...S].join("; "))}}if(Fa.hasStandardBrowserEnv&&(c&&ct.isFunction(c)&&(c=c(r)),c||c!==!1&&Fpe(r.url))){const E=u&&h&&jpe.read(h);E&&m.set(u,E)}return r},Bpe=typeof XMLHttpRequest<"u"&&function(e){return new ut(function(r,i){const o=T8(e);let c=o.data;const u=fd.from(o.headers).normalize();let h,m,_,E,S,{responseType:R,onUploadProgress:P,onDownloadProgress:N}=o;function G(){E&&E(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let F=new XMLHttpRequest;function j(){if(!F)return;const ee=fd.from("getAllResponseHeaders"in F&&F.getAllResponseHeaders());_8(function(he){r(he),G()},function(he){i(he),G()},{data:R&&R!=="text"&&R!=="json"?F.response:F.responseText,status:F.status,statusText:F.statusText,headers:ee,config:e,request:F}),F=null}F.open(o.method.toUpperCase(),o.url,!0),F.timeout=o.timeout,"onloadend"in F?F.onloadend=j:F.onreadystatechange=function(){F&&F.readyState===4&&(F.status!==0||F.responseURL&&F.responseURL.indexOf("file:")===0)&&setTimeout(j)},F.onabort=function(){F&&(i(new sr("Request aborted",sr.ECONNABORTED,e,F)),F=null)},F.onerror=function(){i(new sr("Network Error",sr.ERR_NETWORK,e,F)),F=null},F.ontimeout=function(){let ee=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const he=o.transitional||WB;o.timeoutErrorMessage&&(ee=o.timeoutErrorMessage),i(new sr(ee,he.clarifyTimeoutError?sr.ETIMEDOUT:sr.ECONNABORTED,e,F)),F=null},c===void 0&&u.setContentType(null),"setRequestHeader"in F&&ct.forEach(u.toJSON(),function(ee,he){F.setRequestHeader(he,ee)}),ct.isUndefined(o.withCredentials)||(F.withCredentials=!!o.withCredentials),R&&R!=="json"&&(F.responseType=o.responseType),N&&([_,S]=vA(N,!0),F.addEventListener("progress",_)),P&&F.upload&&([m,E]=vA(P),F.upload.addEventListener("progress",m),F.upload.addEventListener("loadend",E)),(o.cancelToken||o.signal)&&(h=ee=>{F&&(i(!ee||ee.type?new Pv(null,e,F):ee),F.abort(),F=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const q=function(ee){const he=/^([-+\w]{1,25})(:?\/\/|:)/.exec(ee);return he&&he[1]||""}(o.url);q&&Fa.protocols.indexOf(q)===-1?i(new sr("Unsupported protocol "+q+":",sr.ERR_BAD_REQUEST,e)):F.send(c||null)})},Wpe=(e,r)=>{const{length:i}=e=e?e.filter(Boolean):[];if(r||i){let o,c=new AbortController;const u=function(E){if(!o){o=!0,m();const S=E instanceof Error?E:this.reason;c.abort(S instanceof sr?S:new Pv(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new sr("timeout ".concat(r," of ms exceeded"),sr.ETIMEDOUT))},r);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(E=>{E.unsubscribe?E.unsubscribe(u):E.removeEventListener("abort",u)}),e=null)};e.forEach(E=>E.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>ct.asap(m),_}},zpe=m3,Gpe=Tl;zn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=Gpe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var Hpe=Tl,$pe=ah;zn({target:"Promise",stat:!0,forced:!0},{try:function(e){var r=Hpe.f(this),i=$pe(e);return(i.error?r.reject:r.resolve)(i.value),r.promise}});var Cx=l(zpe),w8=Cv.f("asyncIterator"),Kpe=l(w8);function Rx(e,r){this.v=e,this.k=r}function fT(e){var r,i;function o(u,h){try{var m=e[u](h),_=m.value,E=_ instanceof Rx;Cx.resolve(E?_.v:_).then(function(S){if(E){var R=u==="return"?"return":"next";if(!_.k||S.done)return o(R,S);S=e[R](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):i=null}this._invoke=function(u,h){return new Cx(function(m,_){var E={key:u,arg:h,resolve:m,reject:_,next:null};i?i=i.next=E:(r=i=E,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function Cl(e){return function(){return new fT(e.apply(this,arguments))}}function Nn(e){return new Rx(e,0)}function SA(e){var r={},i=!1;function o(c,u){return i=!0,{done:!1,value:new Rx(u=new Cx(function(h){h(e[c](u))}),1)}}return r[Av!==void 0&&Q6||"@@iterator"]=function(){return this},r.next=function(c){return i?(i=!1,c):o("next",c)},typeof e.throw=="function"&&(r.throw=function(c){if(i)throw i=!1,c;return o("throw",c)}),typeof e.return=="function"&&(r.return=function(c){return i?(i=!1,c):o("return",c)}),r}fT.prototype[typeof Av=="function"&&Kpe||"@@asyncIterator"]=function(){return this},fT.prototype.next=function(e){return this._invoke("next",e)},fT.prototype.throw=function(e){return this._invoke("throw",e)},fT.prototype.return=function(e){return this._invoke("return",e)};var Ix=l(w8);function Ax(e){var r,i,o,c=2;for(typeof Symbol<"u"&&(i=Ix,o=Symbol.iterator);c--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new bA(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function bA(e){function r(i){if(Object(i)!==i)return ut.reject(new TypeError(i+" is not an object."));var o=i.done;return ut.resolve(i.value).then(function(c){return{value:c,done:o}})}return bA=function(i){this.s=i,this.n=i.next},bA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?ut.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?ut.reject(i):r(o.apply(this.s,arguments))}},new bA(e)}const qpe=function*(e,r){let i=e.byteLength;if(!r||i<r)return void(yield e);let o,c=0;for(;c<i;)o=c+r,yield e.slice(c,o),c=o},Ype=function(){var e=Cl(function*(r,i){var o,c=!1,u=!1;try{for(var h,m=Ax(Xpe(r));c=!(h=yield Nn(m.next())).done;c=!1){const _=h.value;yield*SA(Ax(qpe(_,i)))}}catch(_){u=!0,o=_}finally{try{c&&m.return!=null&&(yield Nn(m.return()))}finally{if(u)throw o}}});return function(r,i){return e.apply(this,arguments)}}(),Xpe=function(){var e=Cl(function*(r){if(r[Ix])return void(yield*SA(Ax(r)));const i=r.getReader();try{for(;;){const{done:o,value:c}=yield Nn(i.read());if(o)break;yield c}}finally{yield Nn(i.cancel())}});return function(r){return e.apply(this,arguments)}}(),C8=(e,r,i,o)=>{const c=Ype(e,r);let u,h=0,m=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:E,value:S}=await c.next();if(E)return m(),void _.close();let R=S.byteLength;if(i){let P=h+=R;i(P)}_.enqueue(new Uint8Array(S))}catch(E){throw m(E),E}},cancel:_=>(m(_),c.return())},{highWaterMark:2})};function R8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function I8(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?R8(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):R8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const TA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",A8=TA&&typeof ReadableStream=="function",Jpe=TA&&(typeof TextEncoder=="function"?(P8=new TextEncoder,e=>P8.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var P8;const O8=function(e){try{for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return!!e(...i)}catch{return!1}},Qpe=A8&&O8(()=>{let e=!1;const r=new Request(Fa.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!r}),Px=A8&&O8(()=>ct.isReadableStream(new Response("").body)),wA={stream:Px&&(e=>e.body)};var k8;TA&&(k8=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!wA[e]&&(wA[e]=ct.isFunction(k8[e])?r=>r[e]():(r,i)=>{throw new sr("Response type '".concat(e,"' is not supported"),sr.ERR_NOT_SUPPORT,i)})}));const Zpe=async(e,r)=>{const i=ct.toFiniteNumber(e.getContentLength());return i??(async o=>o==null?0:ct.isBlob(o)?o.size:ct.isSpecCompliantForm(o)?(await new Request(Fa.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:ct.isArrayBufferView(o)||ct.isArrayBuffer(o)?o.byteLength:(ct.isURLSearchParams(o)&&(o+=""),ct.isString(o)?(await Jpe(o)).byteLength:void 0))(r)};var efe=TA&&(async e=>{let{url:r,method:i,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:_,responseType:E,headers:S,withCredentials:R="same-origin",fetchOptions:P}=T8(e);E=E?(E+"").toLowerCase():"text";let N,G=Wpe([c,u&&u.toAbortSignal()],h);const F=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let j;try{if(_&&Qpe&&i!=="get"&&i!=="head"&&(j=await Zpe(S,o))!==0){let we,ye=new Request(r,{method:"POST",body:o,duplex:"half"});if(ct.isFormData(o)&&(we=ye.headers.get("content-type"))&&S.setContentType(we),ye.body){const[Ne,Ye]=y8(j,vA(E8(_)));o=C8(ye.body,65536,Ne,Ye)}}ct.isString(R)||(R=R?"include":"omit");const q="credentials"in Request.prototype;N=new Request(r,I8(I8({},P),{},{signal:G,method:i.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:q?R:void 0}));let ee=await fetch(N);const he=Px&&(E==="stream"||E==="response");if(Px&&(m||he&&F)){const we={};["status","statusText","headers"].forEach(dt=>{we[dt]=ee[dt]});const ye=ct.toFiniteNumber(ee.headers.get("content-length")),[Ne,Ye]=m&&y8(ye,vA(E8(m),!0))||[];ee=new Response(C8(ee.body,65536,Ne,()=>{Ye&&Ye(),F&&F()}),we)}E=E||"text";let Se=await wA[ct.findKey(wA,E)||"text"](ee,e);return!he&&F&&F(),await new ut((we,ye)=>{_8(we,ye,{data:Se,headers:fd.from(ee.headers),status:ee.status,statusText:ee.statusText,config:e,request:N})})}catch(q){throw F&&F(),q&&q.name==="TypeError"&&/fetch/i.test(q.message)?Object.assign(new sr("Network Error",sr.ERR_NETWORK,e,N),{cause:q.cause||q}):sr.from(q,q&&q.code,e,N)}});const Ox={http:null,xhr:Bpe,fetch:efe};ct.forEach(Ox,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const N8=e=>"- ".concat(e),tfe=e=>ct.isFunction(e)||e===null||e===!1;var D8={getAdapter:e=>{e=ct.isArray(e)?e:[e];const{length:r}=e;let i,o;const c={};for(let u=0;u<r;u++){let h;if(i=e[u],o=i,!tfe(i)&&(o=Ox[(h=String(i)).toLowerCase()],o===void 0))throw new sr("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,_]=h;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new sr("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(N8).join(`
`):" "+N8(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:Ox};function kx(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Pv(null,e)}function x8(e){return kx(e),e.headers=fd.from(e.headers),e.data=wx.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),D8.getAdapter(e.adapter||bx.adapter)(e).then(function(r){return kx(e),r.data=wx.call(e,e.transformResponse,r),r.headers=fd.from(r.headers),r},function(r){return g8(r)||(kx(e),r&&r.response&&(r.response.data=wx.call(e,e.transformResponse,r.response),r.response.headers=fd.from(r.response.headers))),ut.reject(r)})}const L8="1.7.9",CA={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{CA[e]=function(i){return typeof i===e||"a"+(r<1?"n ":" ")+e}});const M8={};CA.transitional=function(e,r,i){function o(c,u){return"[Axios v"+L8+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(e===!1)throw new sr(o(u," has been removed"+(r?" in "+r:"")),sr.ERR_DEPRECATED);return r&&!M8[u]&&(M8[u]=!0,console.warn(o(u," has been deprecated since v"+r+" and will be removed in the near future"))),!e||e(c,u,h)}},CA.spelling=function(e){return(r,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var RA={assertOptions:function(e,r,i){if(typeof e!="object")throw new sr("options must be an object",sr.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=r[u];if(h){const m=e[u],_=m===void 0||h(m,u,e);if(_!==!0)throw new sr("option "+u+" must be "+_,sr.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new sr("Unknown option "+u,sr.ERR_BAD_OPTION)}},validators:CA};const ph=RA.validators;let IA=class{constructor(e){this.defaults=e,this.interceptors={request:new BB,response:new BB}}async request(e,r){try{return await this._request(e,r)}catch(i){if(i instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(e,r){typeof e=="string"?(r=r||{}).url=e:r=e||{},r=k_(this.defaults,r);const{transitional:i,paramsSerializer:o,headers:c}=r;i!==void 0&&RA.assertOptions(i,{silentJSONParsing:ph.transitional(ph.boolean),forcedJSONParsing:ph.transitional(ph.boolean),clarifyTimeoutError:ph.transitional(ph.boolean)},!1),o!=null&&(ct.isFunction(o)?r.paramsSerializer={serialize:o}:RA.assertOptions(o,{encode:ph.function,serialize:ph.function},!0)),RA.assertOptions(r,{baseUrl:ph.spelling("baseURL"),withXsrfToken:ph.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&ct.merge(c.common,c[r.method]);c&&ct.forEach(["delete","get","head","post","put","patch","common"],N=>{delete c[N]}),r.headers=fd.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(r)===!1||(m=m&&N.synchronous,h.unshift(N.fulfilled,N.rejected))});const _=[];let E;this.interceptors.response.forEach(function(N){_.push(N.fulfilled,N.rejected)});let S,R=0;if(!m){const N=[x8.bind(this),void 0];for(N.unshift.apply(N,h),N.push.apply(N,_),S=N.length,E=ut.resolve(r);R<S;)E=E.then(N[R++],N[R++]);return E}S=h.length;let P=r;for(R=0;R<S;){const N=h[R++],G=h[R++];try{P=N(P)}catch(F){G.call(this,F);break}}try{E=x8.call(this,P)}catch(N){return ut.reject(N)}for(R=0,S=_.length;R<S;)E=E.then(_[R++],_[R++]);return E}getUri(e){return jB(v8((e=k_(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};ct.forEach(["delete","get","head","options"],function(e){IA.prototype[e]=function(r,i){return this.request(k_(i||{},{method:e,url:r,data:(i||{}).data}))}}),ct.forEach(["post","put","patch"],function(e){function r(i){return function(o,c,u){return this.request(k_(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}IA.prototype[e]=r(),IA.prototype[e+"Form"]=r(!0)});var AA=IA;class Nx{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new ut(function(c){i=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new ut(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},r(function(c,u,h){o.reason||(o.reason=new Pv(c,u,h),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const r=new AbortController,i=o=>{r.abort(o)};return this.subscribe(i),r.signal.unsubscribe=()=>this.unsubscribe(i),r.signal}static source(){let r;return{token:new Nx(function(o){r=o}),cancel:r}}}var nfe=Nx;const Dx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Dx).forEach(e=>{let[r,i]=e;Dx[i]=r});var rfe=Dx;const Js=function e(r){const i=new AA(r),o=bB(AA.prototype.request,i);return ct.extend(o,AA.prototype,i,{allOwnKeys:!0}),ct.extend(o,i,null,{allOwnKeys:!0}),o.create=function(c){return e(k_(r,c))},o}(bx);Js.Axios=AA,Js.CanceledError=Pv,Js.CancelToken=nfe,Js.isCancel=g8,Js.VERSION=L8,Js.toFormData=aA,Js.AxiosError=sr,Js.Cancel=Js.CanceledError,Js.all=function(e){return ut.all(e)},Js.spread=function(e){return function(r){return e.apply(null,r)}},Js.isAxiosError=function(e){return ct.isObject(e)&&e.isAxiosError===!0},Js.mergeConfig=k_,Js.AxiosHeaders=fd,Js.formToJSON=e=>f8(ct.isHTMLForm(e)?new FormData(e):e),Js.getAdapter=D8.getAdapter,Js.HttpStatusCode=rfe,Js.default=Js;var la=Js;const ife=()=>{};function mT(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:ife};return e.promise=new ut((r,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,r(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}const PA=new Map,OA=new Map,fh=new Map;let Ki=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Gn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const U8=new Sue;let md=U8.getResult(),xx=null;function Dn(e){if(!xx){md=U8.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Gn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Gn.CHROME;case"Safari":case"Mobile Safari":return Gn.SAFARI;case"Edge":return Gn.EDGE;case"Firefox":return Gn.FIREFOX;case"QQ":case"QQBrowser":return Gn.QQ;case"Opera":return Gn.OPERA;case"WeChat":return Gn.WECHAT;default:return m.browser.name||""}}(md),i=V8(md),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(md),c=md.os.version,u=V8(md,!1),h=md.device.type;if(!(r&&i&&o&&c))return{name:r,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h};xx={name:r,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h}}return xx}function V8(e){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?r.split(".")[0]:r}function kA(){return Dn().os}function F8(){const e=Dn();return"".concat(e.os," ").concat(e.osVersion)}function NA(){const e=Dn();return!!(md.engine.name==="WebKit"&&e.os===Ki.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Gn.SAFARI||No()&&e.name!==Gn.SAFARI)}function Kp(){return Dn().name===Gn.CHROME}function Is(){return Dn().name===Gn.SAFARI}function j8(){return Dn().name===Gn.EDGE}function jr(){return Dn().name===Gn.FIREFOX}function No(){return Dn().os===Ki.IOS}function gT(e){const r=Dn();return!(r.name!==Gn.CHROME||!r.osVersion)&&Number(r.version)>=e}function B8(e){const r=Dn();return!(r.name!==Gn.CHROME||!r.osVersion)&&Number(r.version)<e}function Lx(e,r,i){const o=Dn();return!(o.name!==e||!o.osVersion)&&(i?Number(o.version)>=r&&Number(o.version)<=i:Number(o.version)===r)}function Mx(e){const r=Dn();return!(r.name!==Gn.EDGE||!r.osVersion)&&Number(r.version)>=e}function W8(e){const r=Dn();return!(r.name!==Gn.SAFARI||!r.osVersion)&&Number(r.version)>=e}function z8(e,r,i){const o=Dn();if(o.os!==Ki.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e}function G8(e,r,i){const o=Dn();if(o.name!==Gn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return i?r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e:r?Number(c[0])===e&&Number(c[1])<=r||Number(c[0])<e:Number(c[0])<=e}function Ux(e){const r=Dn();return!(r.name!==Gn.OPERA||!r.osVersion)&&Number(r.version)>=e}function H8(){const e=Dn();if(e.os!==Ki.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Ov(){const e=Dn();if(e.os!==Ki.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15}function Vx(){const e=Dn();if(e.os!==Ki.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===16}function $8(){const e=Dn();if(e.os!==Ki.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function gu(){return Is()&&navigator.maxTouchPoints>0}function K8(){return Dn().name===Gn.WECHAT}function q8(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Fx(){const e=kA();return function(){const{deviceType:r}=Dn();return r==="mobile"||r==="tablet"}()||e===Ki.ANDROID||e===Ki.IOS||e===Ki.HARMONY_OS}function qp(){const e=Dn();return e.name!==Gn.EDGE&&e.name!==Gn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function DA(){return kA()===Ki.ANDROID}function _T(){const e=Dn();return DA()&&(e.name===Gn.CHROME||e.name===Gn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Y8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function _t(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Y8(Object(i),!0).forEach(function(o){Kt(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Y8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Kt(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}let te=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Me=class extends Error{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),Kt(this,"code",void 0),Kt(this,"message",void 0),Kt(this,"data",void 0),Kt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return e==="error"&&(r||console).error(this.toString()),e==="warning"&&(r||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Yp(e,r){if(typeof e!="boolean")throw new Me(te.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Bi(e,r,i){if(!st(i).call(i,e))throw new Me(te.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function or(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Me(te.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function jx(e,r){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Me(te.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));e.min!==void 0&&or(e.min,"".concat(r,".min"),0,1/0),e.max!==void 0&&or(e.max,"".concat(r,".max"),1,1/0),e.exact!==void 0&&or(e.exact,"".concat(r,".exact"),1,1/0),e.ideal!==void 0&&or(e.ideal,"".concat(r,".ideal"),1,1/0)}else or(e,r,1,1/0)}function ds(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Me(te.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!X8(e,i,o,c))throw new Me(te.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Xp(e,r){if(!Array.isArray(e))throw new Me(te.INVALID_PARAMS,"".concat(r," should be an array"))}function Br(e){return e==null}function X8(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var yT=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(yT||{}),Bx=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(Bx||{});const J8=new class{constructor(){Kt(this,"_clientSize",null),Kt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Kt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Kt(this,"getStyle",e=>window.getComputedStyle(e,null)),Kt(this,"checkCssVisibleProperty",e=>{var r;let i=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||st(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(i=!1),!!i&&(m&&m.split(" ").filter(_=>{var E;const S=_.split("(")[0];return st(E=["brightness","blur","opacity"]).call(E,S)}).map(_=>{const[E,S]=_.split(/\(|\)/);return[E,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[E,S]=_;switch(E){case"brightness":(S<.1||S>3)&&(i=!1);break;case"blur":S>3&&(i=!1);break;case"opacity":S<.1&&(i=!1)}}),i)}),Kt(this,"checkPropertyUpToAllParentNodes",(e,r)=>{let i=!0,o=!0;const c=h=>r(h);let u=e;for(;u&&o;)c(u)||(i=!1,o=!1),u=u.parentElement,u||(o=!1);return i}),Kt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Kt(this,"getSizeAboutClient",e=>{const{width:r,height:i,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:r,height:i,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),Kt(this,"checkActualSize",()=>{const{width:e,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,r,i)}),Kt(this,"elementFromPoint",(e,r)=>document.elementFromPoint?document.elementFromPoint(e,r):null),Kt(this,"checkCoverForAPoint",(e,r,i)=>{const o=this.elementFromPoint(e,r);return o!==null&&o!==i}),Kt(this,"getPointPositionList",()=>{const{width:e,height:r,left:i,top:o}=this._clientSize,c=e/6,u=r/6,h=[],m=10**6;for(let _=0;_<5;_++)for(let E=0;E<5;E++){const S=(i*m+(_===0?.1:_===4?(c*_*m-1e5)/m:c*_)*m)/m,R=(o*m+(E===0?.1:E===4?(u*E*m-1e5)/m:u*E)*m)/m;h.push({x:S,y:R})}return[...h]}),Kt(this,"checkElementCover",e=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,e)).filter(r=>!!r).length>6),Kt(this,"checkSizeIsVisible",(e,r,i)=>(e>50||i/e<=10)&&(r>50||i/r<=10)),Kt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:r,top:i,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,_,E,S;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(r<0)return!1;if(_=r<u?r:u,i<0)E=0;else{if(!(i<c))return!1;E=i}if(o<0)return!1;S=o<c?o:c;const R=_-m,P=S-E;return this.checkSizeIsVisible(R,P,h)}),Kt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Kt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(yT.COVERED);{const r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(yT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(yT.SIZE)}}return this.returnHiddenResult(yT.STYLE)}return this.returnHiddenResult(Bx.UNMOUNTED)}return this.returnHiddenResult(Bx.INVALID_HTML_ELEMENT)}),Kt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function Wx(e){return new TextEncoder().encode(e)}const Q8=function(e,r){const i=new Uint8Array(e.byteLength+r.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(r),e.byteLength),i},zx=async e=>function(r,i){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",Wx(e)),16);let Mr=class{constructor(){Kt(this,"_events",{}),Kt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(r=>r.listener):[]}on(e,r){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(e,r){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(e,r){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,r);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const r=this._events[e].map(u=>u);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,r){let i=e.length;for(;i--;)if(e[i].listener===r)return i;return-1}},ET=null;function Z8(){if(ET)return ET;if(window.electron)return ET=window.electron;if(!window.require)return null;try{return ET=window.require("electron"),ET}catch{return null}}let Ri=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Wr=function(e){return e.TRACER="tracer",e}({});function eW(e){return or(e.timeout,"config.timeout",0,1e5),or(e.timeoutFactor,"config.timeoutFactor",0,100,!1),or(e.maxRetryCount,"config.maxRetryConfig",0,1/0),or(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let sfe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),qn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function vT(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function tW(e){return ds(e.turnServerURL,"turnServerURL"),ds(e.username,"username"),ds(e.password,"password"),e.udpport&&or(e.udpport,"udpport",1,99999,!0),e.forceturn&&Yp(e.forceturn,"forceturn"),e.security&&Yp(e.security,"security"),e.tcpport&&or(e.tcpport,"tcpport",1,99999,!0),!0}function Gx(e){return e.level!==void 0&&Bi(e.level,"level",[1,2,3]),e.delay!==void 0&&or(e.delay,"delay",0,3e3,!0),!0}let bn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),As=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),mc=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),kv=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Ps(e,r){for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return e.getListeners(r).length===0?ut.reject(new Me(te.UNEXPECTED_ERROR,"can not emit promise")):new ut((u,h)=>{e.emit(r,...o,u,h)})}function ur(e,r){if(e.getListeners(r).length===0)return ut.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return Ps(e,r,...o)}function Hc(e,r){if(e.getListeners(r).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return ST(e,r,...o)}function ST(e,r){let i=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(r,...u,m=>{i=m},m=>{o=m}),o!==null)throw o;if(i===null)throw new Me(te.UNEXPECTED_ERROR,"handler is not sync");return i}const _i=new class extends Mr{set networkState(e){this.emit(kv.NETWORK_STATE_CHANGE,e,this._networkState),e===mc.ONLINE?this.emit(kv.ONLINE):e===mc.OFFLINE&&(this.onlineWaiter=new ut(r=>{this.once(kv.ONLINE,()=>{this.onlineWaiter=void 0,r(mc.ONLINE)})}),this.emit(kv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===mc.ONLINE}constructor(){super(),Kt(this,"_moduleName","network-indicator"),Kt(this,"_networkState",mc.ONLINE),Kt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=mc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=mc.OFFLINE})}};function xA(e,r){const i=e.indexOf(r);i!==-1&&e.splice(i,1)}function Nv(e){const r=[];return e.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function LA(e){ut!==void 0?ut.resolve().then(e):setTimeout(e,0)}function zr(e){return JSON.parse(JSON.stringify(e))}function N_(e){try{return zr(e)}catch{return e}}const nW={};function Lm(e,r){nW[r]||(nW[r]=!0,e())}function D_(e){const r=window.atob(e),i=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)i[o]=r.charCodeAt(o);return i}function Mm(e){let r="";for(let i=0;i<e.length;i+=1)r+=String.fromCharCode(e[i]);return window.btoa(r)}function rW(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>r)i=i.slice(0,r);else if(i.length<r){const o=new Uint8Array(r);o.set(i),i=o}return i}function iW(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=cc(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function mh(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function sW(e){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{r+=typeof i=="string"?mh(i):i.size}),r+138}function ofe(e){const r=new Me(te.TIMEOUT,"timeout");return new ut((i,o)=>{window.setTimeout(()=>o(r),e)})}function hs(e){return new ut(r=>{window.setTimeout(r,e)})}function dr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(r).concat(i):"".concat(r).concat(i)+dr(e-i.length,"")}function x_(){return dr(32,"").toUpperCase()}const MA=()=>{},oW=new class{constructor(){Kt(this,"fnMap",new Map)}throttleByKey(e,r,i,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==i){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const E=this.fnMap.get(r);E&&E.fn(...E.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:_,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,_t(_t({},m),{},{fn:e,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(r);_&&_.fn(..._.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:m,args:u,skipFn:o})}}},aW=oW.throttleByKey.bind(oW);function cW(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function Hx(e,r){if(!cW(e)||!cW(r)||Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(e)){const i=[...e];for(let o=0;o<r.length;o++)i[o]=Hx(e[o],r[o]);return i}{const i=_t({},e);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=Hx(e[o],r[o]):i[o]=r[o]);return i}}function lW(e,r){let i=[0];if(i=new Array(r).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==r););return i}function $x(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function uW(e){const r="0123456789abcdef";function i(he){let Se,we="";for(Se=0;Se<=3;Se++)we+=r.charAt(he>>8*Se+4&15)+r.charAt(he>>8*Se&15);return we}function o(he,Se){const we=(65535&he)+(65535&Se);return(he>>16)+(Se>>16)+(we>>16)<<16|65535&we}function c(he,Se,we,ye,Ne,Ye){return o(function(dt,ft){return dt<<ft|dt>>>32-ft}(o(o(Se,he),o(ye,Ye)),Ne),we)}function u(he,Se,we,ye,Ne,Ye,dt){return c(Se&we|~Se&ye,he,Se,Ne,Ye,dt)}function h(he,Se,we,ye,Ne,Ye,dt){return c(Se&ye|we&~ye,he,Se,Ne,Ye,dt)}function m(he,Se,we,ye,Ne,Ye,dt){return c(Se^we^ye,he,Se,Ne,Ye,dt)}function _(he,Se,we,ye,Ne,Ye,dt){return c(we^(Se|~ye),he,Se,Ne,Ye,dt)}const E=function(he){let Se;const we=1+(he.length+8>>6),ye=new Array(16*we);for(Se=0;Se<16*we;Se++)ye[Se]=0;for(Se=0;Se<he.length;Se++)ye[Se>>2]|=he.charCodeAt(Se)<<Se%4*8;return ye[Se>>2]|=128<<Se%4*8,ye[16*we-2]=8*he.length,ye}(e);let S,R,P,N,G,F=1732584193,j=-271733879,q=-1732584194,ee=271733878;for(S=0;S<E.length;S+=16)R=F,P=j,N=q,G=ee,F=u(F,j,q,ee,E[S+0],7,-680876936),ee=u(ee,F,j,q,E[S+1],12,-389564586),q=u(q,ee,F,j,E[S+2],17,606105819),j=u(j,q,ee,F,E[S+3],22,-1044525330),F=u(F,j,q,ee,E[S+4],7,-176418897),ee=u(ee,F,j,q,E[S+5],12,1200080426),q=u(q,ee,F,j,E[S+6],17,-1473231341),j=u(j,q,ee,F,E[S+7],22,-45705983),F=u(F,j,q,ee,E[S+8],7,1770035416),ee=u(ee,F,j,q,E[S+9],12,-1958414417),q=u(q,ee,F,j,E[S+10],17,-42063),j=u(j,q,ee,F,E[S+11],22,-1990404162),F=u(F,j,q,ee,E[S+12],7,1804603682),ee=u(ee,F,j,q,E[S+13],12,-40341101),q=u(q,ee,F,j,E[S+14],17,-1502002290),j=u(j,q,ee,F,E[S+15],22,1236535329),F=h(F,j,q,ee,E[S+1],5,-165796510),ee=h(ee,F,j,q,E[S+6],9,-1069501632),q=h(q,ee,F,j,E[S+11],14,643717713),j=h(j,q,ee,F,E[S+0],20,-373897302),F=h(F,j,q,ee,E[S+5],5,-701558691),ee=h(ee,F,j,q,E[S+10],9,38016083),q=h(q,ee,F,j,E[S+15],14,-660478335),j=h(j,q,ee,F,E[S+4],20,-405537848),F=h(F,j,q,ee,E[S+9],5,568446438),ee=h(ee,F,j,q,E[S+14],9,-1019803690),q=h(q,ee,F,j,E[S+3],14,-187363961),j=h(j,q,ee,F,E[S+8],20,1163531501),F=h(F,j,q,ee,E[S+13],5,-1444681467),ee=h(ee,F,j,q,E[S+2],9,-51403784),q=h(q,ee,F,j,E[S+7],14,1735328473),j=h(j,q,ee,F,E[S+12],20,-1926607734),F=m(F,j,q,ee,E[S+5],4,-378558),ee=m(ee,F,j,q,E[S+8],11,-2022574463),q=m(q,ee,F,j,E[S+11],16,1839030562),j=m(j,q,ee,F,E[S+14],23,-35309556),F=m(F,j,q,ee,E[S+1],4,-1530992060),ee=m(ee,F,j,q,E[S+4],11,1272893353),q=m(q,ee,F,j,E[S+7],16,-155497632),j=m(j,q,ee,F,E[S+10],23,-1094730640),F=m(F,j,q,ee,E[S+13],4,681279174),ee=m(ee,F,j,q,E[S+0],11,-358537222),q=m(q,ee,F,j,E[S+3],16,-722521979),j=m(j,q,ee,F,E[S+6],23,76029189),F=m(F,j,q,ee,E[S+9],4,-640364487),ee=m(ee,F,j,q,E[S+12],11,-421815835),q=m(q,ee,F,j,E[S+15],16,530742520),j=m(j,q,ee,F,E[S+2],23,-995338651),F=_(F,j,q,ee,E[S+0],6,-198630844),ee=_(ee,F,j,q,E[S+7],10,1126891415),q=_(q,ee,F,j,E[S+14],15,-1416354905),j=_(j,q,ee,F,E[S+5],21,-57434055),F=_(F,j,q,ee,E[S+12],6,1700485571),ee=_(ee,F,j,q,E[S+3],10,-1894986606),q=_(q,ee,F,j,E[S+10],15,-1051523),j=_(j,q,ee,F,E[S+1],21,-2054922799),F=_(F,j,q,ee,E[S+8],6,1873313359),ee=_(ee,F,j,q,E[S+15],10,-30611744),q=_(q,ee,F,j,E[S+6],15,-1560198380),j=_(j,q,ee,F,E[S+13],21,1309151649),F=_(F,j,q,ee,E[S+4],6,-145523070),ee=_(ee,F,j,q,E[S+11],10,-1120210379),q=_(q,ee,F,j,E[S+2],15,718787259),j=_(j,q,ee,F,E[S+9],21,-343485551),F=o(F,R),j=o(j,P),q=o(q,N),ee=o(ee,G);return i(F)+i(j)+i(q)+i(ee)}let afe=1,dW=console,Us=class{static setLogger(e){dW=e}constructor(e,r){Kt(this,"id",void 0),Kt(this,"lockingPromise",ut.resolve()),Kt(this,"locks",0),Kt(this,"name",""),Kt(this,"lockId",void 0),this.lockId=afe++,e&&(this.name=e),r&&(this.id=r),this.logger("created")}logger(e,r){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(r??"");dW.debug("".concat(i," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let r;this.locks+=1,this.logger("locked",e);const i=new ut(c=>{r=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function Dv(e,r){return function(i,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(o));try{for(var _=arguments.length,E=new Array(_),S=0;S<_;S++)E[S]=arguments[S];return await u.apply(this,E)}finally{m()}},c}}const Ii={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Kx(e,r){const i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,e));return Math.min(r.maxRetryTimeout,i)}function gd(e,r,i,o){const c=Object.assign({},Ii,o);let u=c.timeout;const h=async()=>{await function(E){return new ut(S=>{window.setTimeout(S,E)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const _=new ut(async(E,S)=>{r=r||(()=>!1),i=i||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new Me(te.OPERATION_ABORTED));try{const P=await e();if(!r(P,R)||R+1===c.maxRetryCount)return E(P);await h()}catch(P){if(!i(P,R)||R+1===c.maxRetryCount)return S(P);await h()}}});return _.cancel=()=>m=!0,_}let UA,hW=class{constructor(e){Kt(this,"input",[]),Kt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:cc(e=this.input).call(e,(r,i)=>r+i)/this.input.length}},VA=0,qx=0;function Yx(e,r,i,o){return new ut((c,u)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),VA+=mh(r.data)):i&&(r.data.size?VA+=r.data.size:r.data instanceof FormData?VA+=sW(r.data):VA+=mh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,la.request(r).then(h=>{typeof h.data=="string"?qx+=mh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?qx+=h.data.byteLength:qx+=mh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{la.isCancel(h)?u(new Me(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Me(te.NETWORK_TIMEOUT,h.message)):h.response?u(new Me(te.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Me(te.NETWORK_ERROR,h.message))})})}async function cfe(e,r){const i=new Blob([r.data],{type:"buffer"});return await Yx(e,_t(_t({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const pW=()=>window.isSecureContext!==void 0;function _u(e){if(Array.isArray(e))return e.map(i=>i);if(!fW(e))return e;const r={};for(const i in e){const o=e[i];fW(o)||Array.isArray(o)?r[i]=_u(o):r[i]=o}return r}function fW(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let Xx=class{constructor(e){Kt(this,"input",[]),Kt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const gh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},bT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:gh,remoteCandidate:gh},updateInterval:0},mW={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},gW={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},_W={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},yW={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let Jx=class{constructor(e,r){Kt(this,"onFirstVideoReceived",void 0),Kt(this,"onFirstVideoDecoded",void 0),Kt(this,"onFirstAudioReceived",void 0),Kt(this,"onFirstVideoDecodedTimeout",void 0),Kt(this,"onFirstAudioDecoded",void 0),Kt(this,"onSelectedLocalCandidateChanged",void 0),Kt(this,"onSelectedRemoteCandidateChanged",void 0),Kt(this,"videoIsReady",!1),Kt(this,"videoIsReady2",{}),Kt(this,"pc",void 0),Kt(this,"options",void 0),Kt(this,"intervalTimer",void 0),Kt(this,"stats",_u(bT)),Kt(this,"isFirstVideoReceived",{}),Kt(this,"isFirstVideoDecoded",{}),Kt(this,"isFirstAudioReceived",{}),Kt(this,"isFirstAudioDecoded",{}),Kt(this,"isFirstVideoDecodedTimeout",{}),Kt(this,"lossRateWindowStats",[]),this.pc=e,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ut(e=>{e({local:_t({},gh),remote:_t({},gh)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,r){this.videoIsReady2[e]=r}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of i)e[m].forEach((_,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const S=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,R=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||R<=0?0:R/(S+R)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},lfe=class extends Jx{constructor(){super(...arguments),Kt(this,"_stats",bT),Kt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),r=this.statsResponsesToObjects(e);this._stats=_u(bT);const i=r.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(r=>{var i;const o=st(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=_u(gW);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=_u(mW),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:_t({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=_u(yW);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=_u(_W);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new ut((e,r)=>{this.pc.getStats(e,r)})}statsResponsesToObjects(e){const r=[];return e.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{o[c]=i.stat(c)}),r.push(o)}),r}},TT=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),FA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Qx=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),$c=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var xv=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(xv||{});function wT(e,r,i,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:xv.kNone;if(!r)return;const u=Number(r[i]);if(typeof u!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const m=Number(e[i]);if(typeof m!="number")return;const _=Number(e[o]);if(typeof _!="number")return;const E=h-_;return E?(u-m)/E*c:void 0}let EW=class extends Jx{constructor(){super(...arguments),Kt(this,"_stats",bT),Kt(this,"report",void 0),Kt(this,"lastDecodeVideoReceiverStats",new Map),Kt(this,"lastVideoFramesRecv",new Map),Kt(this,"lastVideoFramesSent",new Map),Kt(this,"lastVideoFramesDecode",new Map),Kt(this,"lastVideoFramesOutput",new Map),Kt(this,"lastVideoJBDelay",new Map),Kt(this,"lastAudioJBDelay",new Map),Kt(this,"mediaBytesSent",new Map),Kt(this,"mediaBytesRetransmit",new Map),Kt(this,"mediaBytesTargetEncode",new Map),Kt(this,"lastDecodeAudioReceiverStats",new Map),Kt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=_u(bT),this.report.forEach(e=>{switch(e.type){case $c.OUTBOUND:case $c.INBOUND:{const r=e.mediaType||e.kind,i=!r&&"frameWidth"in e,o=!r&&!("frameWidth"in e);e.type===$c.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(e):(r==="video"||i)&&this.processVideoOutboundStats(e):e.type===$c.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(e):(r==="video"||i)&&this.processVideoInboundStats(e));break}case $c.TRANSPORT:{const r=this.report.get(e.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case $c.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),r={local:_t({},gh),remote:_t({},gh)};return e.forEach(i=>{let o;if(i.type===$c.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===$c.CANDIDATE_PAIR&&i.selected&&(o=i),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(r.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const r=this.report.get(e.localCandidateId);r&&this.processCandidateStats(r)}if(e.remoteCandidateId){const r=this.report.get(e.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(e){let r;e.type===$c.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),e.type===$c.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=e.type,r.id=e.id,e.address&&(r.address=e.address),e.candidateType&&(r.candidateType=e.candidateType),e.port&&(r.port=e.port),e.priority&&(r.priority=e.priority),e.protocol&&(r.protocol=e.protocol),e.relayProtocol&&(r.relayProtocol=e.relayProtocol),e.type===$c.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(_t({},r),_t({},this.stats.selectedCandidatePair.localCandidate)),e.type===$c.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(_t({},r),_t({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let r=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);r||(r=_u(yW),this._stats.audioRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.packetsDiscarded=e.packetsDiscarded,r.bytes=e.bytesReceived,r.jitterMs=1e3*e.jitter,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived,r.totalProcessingDelay=e.totalProcessingDelay,r.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=wT(i,r,"totalProcessingDelay","jitterBufferEmittedCount",xv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),r.receivedFrames||(r.receivedFrames=e.packetsReceived),r.droppedFrames||(r.droppedFrames=e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof e.concealedSamples=="number"&&(r.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,_t({},r))}processVideoInboundStats(e){let r=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);r||(r=_u(mW),this._stats.videoRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.bytes=e.bytesReceived,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.framesDecodeCount=e.framesDecoded,r.framesDroppedCount=e.framesDropped,r.totalInterFrameDelay=e.totalInterFrameDelay,r.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,r.totalFreezesDuration=e.totalFreezesDuration,r.totalProcessingDelay=e.totalProcessingDelay,r.packetsDiscarded=e.packetsDiscarded,r.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,r.totalAssemblyTime=e.totalAssemblyTime,r.keyFramesDecoded=e.keyFramesDecoded,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){const h=i.stats,m=u-i.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?r.qpSumPerFrame=e.qpSum/e.framesDecoded:r.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(r.decodeMs=1e3*e.totalDecodeTime,r.avgDecodeMs=wT(i==null?void 0:i.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=wT(i==null?void 0:i.stats,r,"totalProcessingDelay","framesDecodeCount",xv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=wT(i==null?void 0:i.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",xv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=wT(i==null?void 0:i.stats,r,"totalInterFrameDelay","framesDecodeCount",xv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((e.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(r.framesRateFirefox=e.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:_t({},r),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let r=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);r||(r=_u(gW),this._stats.videoSend.push(r));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const o=new Xx(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new Xx(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new Xx(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(r.ssrc=e.ssrc,r.bytes=e.bytesSent,r.packets=e.packetsSent,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.frameCount=e.framesEncoded,r.adaptionChangeReason=e.qualityLimitationReason,r.scalabilityMode=e.scalabilityMode,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,r.hugeFramesSent=e.hugeFramesSent,r.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)r.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?r.qpSumPerFrame=e.qpSum/e.framesEncoded:r.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,r),this.processVideoTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const o=this.findRemoteStatsId(e.ssrc,$c.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(e){let r=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(r||(r=_u(_W),this._stats.audioSend.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsSent,r.bytes=e.bytesSent,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const i=this.findRemoteStatsId(e.ssrc,$c.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}findRemoteStatsId(e,r){var i;const o=Array.from(zc(i=this.report).call(i)).find(c=>c.type===r&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,r){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,r){const i=this.report.get(e);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,r,i){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof _!="number")return;let E=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:e.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof E=="number"&&typeof S=="number"||(E=0,S=0),R==null){const P=Date.now(),N=this.lastVideoFramesSent.get(i.ssrc);N&&P-N.lts>=800?(R=Math.round((_-N.count)/((P-N.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:P,rate:R})):N?R=N.rate:this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:P,rate:0})}i.sentFrame={width:E,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,r,i){var o,c,u,h,m;const _=r?this.report.get(r):void 0,E=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,R=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,P=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,N=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof E=="number"){const G=this.lastVideoFramesRecv.get(i.ssrc),F=Date.now();i.framesReceivedCount=E;let j=0;G&&F-G.lts>=800?(j=Math.round((E-G.count)/((F-G.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:E,lts:F,rate:j})):G?j=G.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:E,lts:F,rate:0}),i.receivedFrame={width:S||0,height:R||0,frameRate:j||0},i.decodedFrame={width:S||0,height:R||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:S||0,height:R||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(P&&N){const G=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let F=G.jitterBufferMs;const j=N-G.jitterBufferEmittedCount;j>0&&(F=1e3*(P-G.jitterBufferDelay)/j),i.jitterBufferMs=F,i.currentDelayMs=Math.round(F),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:N,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,r,i){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,E=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=_,i.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(e,r,i){var o,c,u,h,m,_,E;const S=r?this.report.get(r):void 0,R=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,N=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,G=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,F=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,j=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,q=(E=S==null?void 0:S.concealedSamples)!==null&&E!==void 0?E:e.concealedSamples;if(typeof P=="number"&&(i.totalSamplesReceived=P),R&&P&&(i.accelerateRate=R/P),N&&G){const he=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Se=he.jitterBufferMs;const we=G-he.jitterBufferEmittedCount;we>0&&(Se=1e3*(N-he.jitterBufferDelay)/we),i.jitterBufferMs=Math.round(Se),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:N,jitterBufferEmittedCount:G,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=F;let ee=1920;j&&P&&(ee=P/j/50,i.receivedFrames=Math.round(P/ee)),q&&(i.droppedFrames=Math.round(q/ee))}processRemoteInboundStats(e,r){const i=this.report.get(e);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(e){const r=this.report.get(e);if(!r)return"";const i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,r=null,i=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const o=r!==null?e-r:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},ufe=class extends Jx{updateStats(){return ut.resolve()}};function Zx(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new lfe(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new EW(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof ut||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(e)?new EW(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new ufe(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const vW="websdk_ng_install_id";function eL(){try{if(oe("INSTALL_ID"))return oe("INSTALL_ID");let e=window.localStorage.getItem(vW);return e||(e=x_(),window.localStorage.setItem(vW,e)),rr("INSTALL_ID",e),e}catch{return}}const Rl=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const i=r[1],o=r[2];return"".concat(i,".").concat(o)}return"4.0.0.999"}("4.23.2"),tL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let L_=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Os=function(){const e="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const o=i.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Os;const jA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},nL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},rL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",iL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},Sr=_t(_t(_t({},iL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:nL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},jA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function rr(e,r,i){var o,c,u;st(o=Object.keys(Sr)).call(o,e)&&(!i&&st(c=Object.keys(_d)).call(c,e)||(Sr[e]=r,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(Sr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(Sr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,Sr.USE_NEW_NETWORK_CONFIG=u,u&&(Sr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Sr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Sr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Sr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Sr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Sr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Sr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&r&&(Sr.ENABLE_INSTANT_VIDEO=!0,Sr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&r&&(Sr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&r&&(Sr.NEW_TURN_MODE||(Sr.NEW_TURN_MODE=4))))}function oe(e){return Sr[e]}tL||(Sr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Sr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Sr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Sr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Sr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Sr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Sr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Sr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Sr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Sr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Sr.AREAS=["NORTH_AMERICA","OVERSEA"]);let SW=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const _d={};var Tn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Tn||{});let BA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const bW=128,dfe=96,TW=1e3,Lv=10;let hfe=0;var wW=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>dt,Printer:()=>ai,parse:()=>it,print:()=>wt});const h=`
`,m="".concat("\r").concat(h),_=" ";let E;function S(He){return He>="0"&&He<="9"}function R(He){return He>="!"&&He<="~"}function P(He){return R(He)||He>=""&&He<=""}function N(He){return He==="!"||He>="#"&&He<="'"||He>="*"&&He<="+"||He>="-"&&He<="."||He>="0"&&He<="9"||He>="A"&&He<="Z"||He>="^"&&He<="~"}function G(He){return He>="1"&&He<="9"}function F(He){return He>="A"&&He<="Z"||He>="a"&&He<="z"}function j(He){return He==="d"||He==="h"||He==="m"||He==="s"}function q(He){return He>""&&He<"	"||He>"\v"&&He<"\f"||He>""&&He<""}function ee(He){return F(He)||S(He)||He==="+"||He==="/"}function he(He){return S(He)||F(He)||He==="+"||He==="/"||He==="-"||He==="_"}function Se(He){return F(He)||S(He)||He==="+"||He==="/"}function we(He,M){var ae=Object.keys(He);if(Object.getOwnPropertySymbols){var fe=Object.getOwnPropertySymbols(He);M&&(fe=fe.filter(function(Qe){return Object.getOwnPropertyDescriptor(He,Qe).enumerable})),ae.push.apply(ae,fe)}return ae}function ye(He){for(var M=1;M<arguments.length;M++){var ae=arguments[M]!=null?arguments[M]:{};M%2?we(Object(ae),!0).forEach(function(fe){Ne(He,fe,ae[fe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(He,Object.getOwnPropertyDescriptors(ae)):we(Object(ae)).forEach(function(fe){Object.defineProperty(He,fe,Object.getOwnPropertyDescriptor(ae,fe))})}return He}function Ne(He,M,ae){return M in He?Object.defineProperty(He,M,{value:ae,enumerable:!0,configurable:!0,writable:!0}):He[M]=ae,He}(function(He){He.VERSION="v",He.ORIGIN="o",He.SESSION_NAME="s",He.INFORMATION="i",He.URI="u",He.EMAIL="e",He.PHONE="p",He.CONNECTION="c",He.BANDWIDTH="b",He.TIME="t",He.REPEAT="r",He.ZONE_ADJUSTMENTS="z",He.KEY="k",He.ATTRIBUTE="a",He.MEDIA="m"})(E||(E={}));class Ye{consumeText(M,ae){let fe=ae;for(;fe<M.length;){const Qe=M[fe];if(Qe==="\0"||Qe==="\r"||Qe===h)break;fe+=1}if(fe-ae==0)throw new Error("Invalid text, at ".concat(M));return fe}consumeUnicastAddress(M,ae,fe){return this.consumeTill(M,ae,_)}consumeOneOrMore(M,ae,fe){let Qe=ae;for(;fe(M[Qe]);)Qe++;if(Qe-ae==0)throw new Error("Invalid rule at ".concat(ae,"."));return Qe}consumeSpace(M,ae){if(M[ae]===_)return ae+1;throw new Error("Invalid space at ".concat(ae,"."))}consumeIP4Address(M,ae){let fe=ae;for(let Qe=0;Qe<4;Qe++)if(fe=this.consumeDecimalUChar(M,fe),Qe!==3){if(M[fe]!==".")throw new Error("Invalid IP4 address.");fe++}return fe}consumeDecimalUChar(M,ae){let fe=ae;for(let Xt=0;Xt<3&&S(M[fe]);Xt++,fe++);if(fe-ae==0)throw new Error("Invalid decimal uchar.");const Qe=parseInt(M.slice(ae,fe));if(Qe>=0&&Qe<=255)return fe;throw new Error("Invalid decimal uchar")}consumeIP6Address(M,ae){let fe=this.consumeHexpart(M,ae);return M[fe]===":"&&(fe+=1,fe=this.consumeIP4Address(M,fe)),fe}consumeHexpart(M,ae){let fe=ae;if(M[fe]===":"&&M[fe+1]===":"){fe+=2;try{fe=this.consumeHexseq(M,fe)}catch{}return fe}if(fe=this.consumeHexseq(M,fe),M[fe]===":"&&M[fe+1]===":"){fe+=2;try{fe=this.consumeHexseq(M,fe)}catch{}return fe}return fe}consumeHexseq(M,ae){let fe=ae;for(;fe=this.consumeHex4(M,fe),M[fe]===":"&&M[fe+1]!==":";)fe+=1;return fe}consumeHex4(M,ae){let fe=0;for(;fe<4;fe++)if(!((Qe=M[ae+fe])>="0"&&Qe<="9"||Qe>="a"&&Qe<="f"||Qe>="A"&&Qe<="F")){if(fe===0)throw new Error("Invalid hex 4");break}var Qe;return ae+fe}consumeFQDN(M,ae){let fe=ae;for(;S(M[fe])||F(M[fe])||M[fe]==="-"||M[fe]===".";)fe+=1;if(fe-ae<4)throw new Error("Invalid FQDN");return fe}consumeExtnAddr(M,ae){return this.consumeOneOrMore(M,ae,P)}consumeMulticastAddress(M,ae,fe){switch(fe){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(M,ae);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(M,ae);default:try{return this.consumeFQDN(M,ae)}catch{return this.consumeExtnAddr(M,ae)}}}consumeIP6MulticastAddress(M,ae){const fe=this.consumeHexpart(M,ae);return M[fe]==="/"?this.consumeInteger(M,fe+1):fe}consumeIP4MulticastAddress(M,ae){let fe=ae+3;const Qe=M.slice(ae,fe),Xt=parseInt(Qe);if(Xt<224||Xt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let ar=0;ar<3;ar++){if(M[fe]!==".")throw new Error("Invalid IP4 multicast address.");fe+=1,fe=this.consumeDecimalUChar(M,fe)}return M[fe]==="/"&&(fe+=1),fe=this.consumeTTL(M,fe),M[fe]==="/"&&(fe=this.consumeInteger(M,fe)),fe}consumeInteger(M,ae){if(!G(M[ae]))throw new Error("Invalid integer.");for(ae+=1;S(M[ae]);)ae+=1;return ae}consumeTTL(M,ae){if(M[ae]==="0")return ae+1;if(!G(M[ae]))throw new Error("Invalid TTL.");ae+=1;for(let fe=0;fe<2&&S(M[ae]);fe++)ae+=1;return ae}consumeToken(M,ae){return this.consumeOneOrMore(M,ae,N)}consumeTime(M,ae){let fe=ae;if(M[fe]==="0")return fe+1;for(G(M[fe])&&(fe+=1);S(M[fe]);)fe++;if(fe-ae<10)throw new Error("Invalid time");return fe}consumeAddress(M,ae){return this.consumeTill(M,ae,_)}consumeTypedTime(M,ae){let fe=ae;return fe=this.consumeOneOrMore(M,fe,S),j(M[fe])?fe+1:fe}consumeRepeatInterval(M,ae){if(!G(M[ae]))throw new Error("Invalid repeat interval");for(ae+=1;S(M[ae]);)ae+=1;return j(M[ae])&&(ae+=1),ae}consumePort(M,ae){return this.consumeOneOrMore(M,ae,S)}consume(M,ae,fe){for(let Qe=0;Qe<fe.length;Qe++){if(ae+Qe>=M.length)throw new Error("consume exceeding value length");if(M[ae+Qe]!==fe[Qe])throw new Error("consume ".concat(fe," failed at ").concat(Qe))}return ae+fe.length}consumeTill(M,ae,fe){let Qe=ae;for(;Qe<M.length&&(typeof fe!="string"||M[Qe]!==fe)&&(typeof fe!="function"||!fe(M[Qe]));)Qe++;return Qe}}class dt extends Ye{constructor(){super(),Ne(this,"records",[]),Ne(this,"currentLine",0)}parse(M){const ae=this.probeEOL(M);this.records=M.split(ae).filter(sy=>!!ho(sy).call(sy)).map(this.parseLine),this.currentLine=0;const fe=this.parseVersion(),Qe=this.parseOrigin(),Xt=this.parseSessionName(),ar=this.parseInformation(),Xi=this.parseUri(),Ga=this.parseEmail(),lf=this.parsePhone(),iy=this.parseConnection(),aw=this.parseBandWidth(),QP=this.parseTimeFields(),ZP=this.parseKey(),xl=this.parseSessionAttribute(),eg=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:fe,origin:Qe,sessionName:Xt,information:ar,uri:Xi,emails:Ga,phones:lf,connection:iy,bandwidths:aw,timeFields:QP,key:ZP,attributes:xl,mediaDescriptions:eg}}getCurrentRecord(){const M=this.records[this.currentLine];if(!M)throw new Error("Record doesn't exit.");return M}probeEOL(M){for(let ae=0;ae<M.length;ae++)if(M[ae]===h)return M[ae-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(M,ae){if(M.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const fe=M[0];if(M[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:fe,value:M.slice(2),line:ae,cur:0}}parseSessionAttribute(){const M=new Rn;for(;this.currentLine<this.records.length;){const ae=this.getCurrentRecord();if(ae.type!==E.ATTRIBUTE)break;const fe={attField:this.extractOneOrMore(ae,Qe=>N(Qe)&&Qe!==":"),_cur:0};ae.value[ae.cur]===":"&&(ae.cur+=1,fe.attValue=this.extractOneOrMore(ae,q)),M.parse(fe),this.currentLine++}return M.digest()}parseMediaAttributes(M){const ae=new In(M);for(;this.currentLine<this.records.length;){const fe=this.getCurrentRecord();if(fe.type!==E.ATTRIBUTE)break;const Qe={attField:this.extractOneOrMore(fe,Xt=>N(Xt)&&Xt!==":"),_cur:0};fe.value[fe.cur]===":"&&(fe.cur+=1,Qe.attValue=this.extractOneOrMore(fe,q)),ae.parse(Qe),this.currentLine++}return ae.digest()}parseKey(){const M=this.getCurrentRecord();if(M.type===E.KEY){if(M.value==="prompt"||M.value==="clear:"||M.value==="base64:"||M.value==="uri:")return M.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const M=this.getCurrentRecord();if(M.type===E.ZONE_ADJUSTMENTS){const ae=[];for(;;)try{const fe=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);let Qe=!1;M.value[M.cur]==="-"&&(Qe=!0,M.cur+=1);const Xt=this.extract(M,this.consumeTypedTime);ae.push({time:fe,typedTime:Xt,back:Qe})}catch{break}if(ae.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ae}return[]}parseRepeat(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==E.REPEAT)break;{const fe=this.extract(ae,this.consumeRepeatInterval),Qe=this.parseTypedTime(ae);M.push({repeatInterval:fe,typedTimes:Qe}),this.currentLine++}}return M}parseTypedTime(M){const ae=[];for(;;)try{this.consumeSpaceForRecord(M),ae.push(this.extract(M,this.consumeTypedTime))}catch{break}if(ae.length===0)throw new Error("Invalid typed time.");return ae}parseTime(){const M=this.getCurrentRecord(),ae=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);const fe=this.extract(M,this.consumeTime);return this.currentLine++,{startTime:ae,stopTime:fe}}parseBandWidth(){const M=[];for(;this.currentLine<this.records.length;){const ae=this.getCurrentRecord();if(ae.type!==E.BANDWIDTH)break;{const fe=this.extractOneOrMore(ae,N);if(ae.value[ae.cur]!==":")throw new Error("Invalid bandwidth field.");ae.cur++;const Qe=this.extractOneOrMore(ae,S);M.push({bwtype:fe,bandwidth:Qe}),this.currentLine++}}return M}parseVersion(){const M=this.getCurrentRecord();if(M.type!==E.VERSION)throw new Error("first sdp record must be version");const ae=M.value.slice(0,this.consumeOneOrMore(M.value,0,S));if(ae.length!==M.value.length)throw new Error('invalid proto version, "v='.concat(M.value,'"'));return this.currentLine++,ae}parseOrigin(){const M=this.getCurrentRecord();if(M.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const ae=this.extractOneOrMore(M,P);this.consumeSpaceForRecord(M);const fe=this.extractOneOrMore(M,S);this.consumeSpaceForRecord(M);const Qe=this.extractOneOrMore(M,S);this.consumeSpaceForRecord(M);const Xt=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const ar=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const Xi=this.extract(M,this.consumeUnicastAddress);return this.currentLine++,{username:ae,sessId:fe,sessVersion:Qe,nettype:Xt,addrtype:ar,unicastAddress:Xi}}parseSessionName(){const M=this.getCurrentRecord();if(M.type===E.SESSION_NAME){const ae=this.extract(M,this.consumeText);return this.currentLine++,ae}}parseInformation(){const M=this.getCurrentRecord();if(M.type!==E.INFORMATION)return;const ae=this.extract(M,this.consumeText);return this.currentLine++,ae}parseUri(){const M=this.getCurrentRecord();if(M.type===E.URI)return this.currentLine++,M.value}parseEmail(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==E.EMAIL)break;M.push(ae.value),this.currentLine++}return M}parsePhone(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==E.PHONE)break;M.push(ae.value),this.currentLine++}return M}parseConnection(){const M=this.getCurrentRecord();if(M.type===E.CONNECTION){const ae=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const fe=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const Qe=this.extract(M,this.consumeAddress);return this.currentLine++,{nettype:ae,addrtype:fe,address:Qe}}}parseMedia(){const M=this.getCurrentRecord(),ae=this.extract(M,this.consumeToken);this.consumeSpaceForRecord(M);let fe=this.extract(M,this.consumePort);M.value[M.cur]==="/"&&(M.cur+=1,fe+=this.extract(M,this.consumeInteger)),this.consumeSpaceForRecord(M);const Qe=[];for(Qe.push(this.extract(M,this.consumeToken));M.value[M.cur]==="/";)M.cur+=1,Qe.push(this.extract(M,this.consumeToken));if(Qe.length===0)throw new Error("Invalid proto");const Xt=this.parseFmt(M);return this.currentLine++,{mediaType:ae,port:fe,protos:Qe,fmts:Xt}}parseTimeFields(){const M=[];for(;this.getCurrentRecord().type===E.TIME;){const ae=this.parseTime(),fe=this.parseRepeat(),Qe=this.parseZone();M.push({time:ae,repeats:fe,zones:Qe})}return M}parseMediaDescription(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const ae=this.parseMedia(),fe=this.parseInformation(),Qe=this.parseConnections(),Xt=this.parseBandWidth(),ar=this.parseKey(),Xi=this.parseMediaAttributes(ae);M.push({media:ae,information:fe,connections:Qe,bandwidths:Xt,key:ar,attributes:Xi})}return M}parseConnections(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)M.push(this.parseConnection());return M}parseFmt(M){const ae=[];for(;;)try{this.consumeSpaceForRecord(M),ae.push(this.extract(M,this.consumeToken))}catch{break}if(ae.length===0)throw new Error("Invalid fmts");return ae}extract(M,ae){for(var fe=arguments.length,Qe=new Array(fe>2?fe-2:0),Xt=2;Xt<fe;Xt++)Qe[Xt-2]=arguments[Xt];const ar=ae.call(this,M.value,M.cur,...Qe),Xi=M.value.slice(M.cur,ar);return M.cur=ar,Xi}extractOneOrMore(M,ae){const fe=this.consumeOneOrMore(M.value,M.cur,ae),Qe=M.value.slice(M.cur,fe);return M.cur=fe,Qe}consumeSpaceForRecord(M){if(M.value[M.cur]!==_)throw new Error("Invalid space at ".concat(M.cur,"."));M.cur+=1}}class ft extends Ye{constructor(){super(...arguments),Ne(this,"attributes",void 0),Ne(this,"digested",!1)}extractOneOrMore(M,ae,fe){const Qe=this.consumeOneOrMore(M.attValue,M._cur,ae),Xt=M.attValue.slice(M._cur,Qe),[ar,Xi]=fe||[];if(typeof ar=="number"&&Xt.length<ar)throw new Error("error in length, should be more or equal than ".concat(ar," characters."));if(typeof Xi=="number"&&Xt.length>Xi)throw new Error("error in length, should be less or equal than ".concat(Xi," characters."));return M._cur=Qe,Xt}consumeAttributeSpace(M){if(M.attValue[M._cur]!==_)throw new Error("Invalid space at ".concat(M._cur,"."));M._cur+=1}extract(M,ae){if(!M.attValue)throw new Error("Nothing to extract from attValue.");for(var fe=arguments.length,Qe=new Array(fe>2?fe-2:0),Xt=2;Xt<fe;Xt++)Qe[Xt-2]=arguments[Xt];const ar=ae.call(this,M.attValue,M._cur,...Qe),Xi=M.attValue.slice(M._cur,ar);return M._cur=ar,Xi}atEnd(M){if(!M.attValue)throw new Error;return M._cur>=M.attValue.length}peekChar(M){if(!M.attValue)throw new Error;return M.attValue[M._cur]}peek(M,ae){if(!M.attValue)throw new Error;for(let fe=0;fe<ae.length;fe++)if(ae[fe]!==M.attValue[M._cur+fe])return!1;return!0}parseIceUfrag(M){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(M,ee,[4,256])}parseIcePwd(M){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(M,ee,[22,256])}parseIceOptions(M){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ae=[];for(;!this.atEnd(M);){ae.push(this.extractOneOrMore(M,ee));try{this.consumeAttributeSpace(M)}catch(fe){if(this.atEnd(M))break;throw fe}}this.attributes.iceOptions=ae}parseFingerprint(M){const ae=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const fe=this.extract(M,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ae,fingerprint:fe})}parseExtmap(M){const ae=this.extractOneOrMore(M,S);let fe;this.peekChar(M)==="/"&&(this.extract(M,this.consume,"/"),fe=this.extract(M,this.consumeToken)),this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeTill,_),Xt=ye(ye({entry:parseInt(ae,10)},fe&&{direction:fe}),{},{extensionName:Qe});this.peekChar(M)===_&&(this.consumeAttributeSpace(M),Xt.extensionAttributes=this.extract(M,this.consumeTill)),this.attributes.extmaps.push(Xt)}parseSetup(M){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ae=this.extract(M,this.consumeTill);if(ae!=="active"&&ae!=="passive"&&ae!=="actpass"&&ae!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ae}}class Rn extends ft{constructor(){super(...arguments),Ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"group":this.parseGroup(M);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"fingerprint":this.parseFingerprint(M);break;case"setup":this.parseSetup(M);break;case"tls-id":this.parseTlsId(M);break;case"identity":this.parseIdentity(M);break;case"extmap":this.parseExtmap(M);break;case"msid-semantic":this.parseMsidSemantic(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(ae){throw console.error("parsing session attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),ae}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(M){const ae=this.extract(M,this.consumeToken),fe=[];for(;!this.atEnd(M)&&this.peekChar(M)===_;)this.consumeAttributeSpace(M),fe.push(this.extract(M,this.consumeToken));this.attributes.groups.push({semantic:ae,identificationTag:fe})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(M){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(M,he)}parseIdentity(M){const ae=this.extractOneOrMore(M,Se),fe=[];for(;!this.atEnd(M)&&this.peekChar(M)===_;){this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeToken);this.extract(M,this.consume,"=");const Xt=this.extractOneOrMore(M,ar=>ar!==_&&q(ar));fe.push({name:Qe,value:Xt})}this.attributes.identities.push({assertionValue:ae,extensions:fe})}parseMsidSemantic(M){this.peekChar(M)===_&&this.consumeAttributeSpace(M);const ae={semantic:this.extract(M,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(M)}catch{break}if(this.peekChar(M)==="*"){this.extract(M,this.consume,"*"),ae.applyForAll=!0;break}{const fe=this.extract(M,this.consumeTill,_);ae.identifierList.push(fe)}}this.attributes.msidSemantic=ae}}class In extends ft{constructor(M){super(),Ne(this,"attributes",void 0),M.protos.indexOf("RTP")!==-1||M.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"extmap":this.parseExtmap(M);break;case"setup":this.parseSetup(M);break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"candidate":this.parseCandidate(M);break;case"remote-candidate":this.parseRemoteCandidate(M);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(M);break;case"rtpmap":this.parseRtpmap(M);break;case"ptime":this.parsePtime(M);break;case"maxptime":this.parseMaxPtime(M);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(M);break;case"ssrc":this.parseSSRC(M);break;case"fmtp":this.parseFmtp(M);break;case"rtcp-fb":this.parseRtcpFb(M);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(M);break;case"mid":this.parseMid(M);break;case"msid":this.parseMsid(M);break;case"imageattr":this.parseImageAttr(M);break;case"rid":this.parseRid(M);break;case"simulcast":this.parseSimulcast(M);break;case"sctp-port":this.parseSctpPort(M);break;case"max-message-size":this.parseMaxMessageSize(M);break;case"ssrc-group":this.parseSSRCGroup(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(ae){throw console.error("parsing media attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),ae}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}parseCandidate(M){const ae=this.extractOneOrMore(M,ee,[1,32]);this.consumeAttributeSpace(M);const fe=this.extractOneOrMore(M,S,[1,5]);this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const Xt=this.extractOneOrMore(M,S,[1,10]);this.consumeAttributeSpace(M);const ar=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const Xi=this.extract(M,this.consumePort);this.consumeAttributeSpace(M),this.extract(M,this.consume,"typ"),this.consumeAttributeSpace(M);const Ga={foundation:ae,componentId:fe,transport:Qe,priority:Xt,connectionAddress:ar,port:Xi,type:this.extract(M,this.consumeToken),extension:{}};for(this.peek(M," raddr")&&(this.extract(M,this.consume," raddr"),this.consumeAttributeSpace(M),Ga.relAddr=this.extract(M,this.consumeAddress)),this.peek(M," rport")&&(this.extract(M,this.consume," rport"),this.consumeAttributeSpace(M),Ga.relPort=this.extract(M,this.consumePort));this.peekChar(M)===_;){this.consumeAttributeSpace(M);const lf=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M),Ga.extension[lf]=this.extractOneOrMore(M,R)}this.attributes.candidates.push(Ga)}parseRemoteCandidate(M){const ae=[];for(;;){const fe=this.extractOneOrMore(M,S,[1,5]);this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const Xt=this.extract(M,this.consumePort);ae.push({componentId:fe,connectionAddress:Qe,port:Xt});try{this.consumeAttributeSpace(M)}catch{break}}this.attributes.remoteCandidatesList.push(ae)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(M){const ae=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const fe=this.extract(M,this.consumeTill,"/");this.extract(M,this.consume,"/");const Qe={encodingName:fe,clockRate:this.extractOneOrMore(M,S)};this.atEnd(M)||this.peekChar(M)!=="/"||(this.extract(M,this.consume,"/"),Qe.encodingParameters=parseInt(this.extract(M,this.consumeTill),10));const Xt=this.attributes.payloads.find(ar=>ar.payloadType===parseInt(ae,10));Xt?Xt.rtpMap=Qe:this.attributes.payloads.push({payloadType:parseInt(ae,10),rtpMap:Qe,rtcpFeedbacks:[]})}parsePtime(M){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(M,this.consumeTill)}parseMaxPtime(M){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(M,this.consumeTill)}parseDirection(M){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=M.attField}parseSSRC(M){const ae=this.extractOneOrMore(M,S);this.consumeAttributeSpace(M);const fe=this.extract(M,this.consumeTill,":");let Qe;this.peekChar(M)===":"&&(this.extract(M,this.consume,":"),Qe=this.extract(M,this.consumeTill));const Xt=this.attributes.ssrcs.find(ar=>ar.ssrcId===parseInt(ae,10));Xt?Xt.attributes[fe]=Qe:this.attributes.ssrcs.push({ssrcId:parseInt(ae,10),attributes:{[fe]:Qe}})}parseFmtp(M){const ae=this.extract(M,this.consumeTill,_);this.consumeAttributeSpace(M);const fe=this.extract(M,this.consumeTill),Qe={};fe.split(";").forEach(ar=>{let[Xi,Ga]=ar.split("=");Xi=ho(Xi).call(Xi);const lf=typeof Ga=="string"?ho(Ga).call(Ga):null;typeof Xi=="string"&&Xi.length>0&&(Qe[Xi]=lf)});const Xt=this.attributes.payloads.find(ar=>ar.payloadType===parseInt(ae,10));Xt?Xt.fmtp={parameters:Qe}:this.attributes.payloads.push({payloadType:parseInt(ae,10),rtcpFeedbacks:[],fmtp:{parameters:Qe}})}parseFmtParameters(M){const ae={},fe=this.extract(M,this.consumeTill,"=");M._cur++;const Qe=this.extract(M,this.consumeTill,";");for(ae[fe]=Qe;M.attValue[M._cur]===";";){const Xt=this.extract(M,this.consumeTill,"=");M._cur++;const ar=this.extract(M,this.consumeTill,";");ae[Xt]=ar}return ae}parseRtcpFb(M){let ae="";ae=this.peekChar(M)==="*"?this.extract(M,this.consume,"*"):this.extract(M,this.consumeTill,_),this.consumeAttributeSpace(M);const fe=this.extract(M,this.consumeTill,_);let Qe;if(fe==="trr-int")Qe={type:fe,interval:this.extract(M,this.consumeTill)};else{const Xt={type:fe};this.peekChar(M)===_&&(this.consumeAttributeSpace(M),Xt.parameter=this.extract(M,this.consumeToken),this.peekChar(M)===_&&(Xt.additional=this.extract(M,this.consumeTill))),Qe=Xt}if(ae==="*")this.attributes.rtcpFeedbackWildcards.push(Qe);else{const Xt=this.attributes.payloads.find(ar=>ar.payloadType===parseInt(ae,10));Xt?Xt.rtcpFeedbacks.push(Qe):this.attributes.payloads.push({payloadType:parseInt(ae,10),rtcpFeedbacks:[Qe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(M){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ae={port:this.extract(M,this.consumePort)};this.peekChar(M)===_&&(this.consumeAttributeSpace(M),ae.netType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),ae.addressType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),ae.address=this.extract(M,this.consumeAddress)),this.attributes.rtcp=ae}parseMsid(M){const ae={id:this.extractOneOrMore(M,N,[1,64])};this.peekChar(M)===_&&(this.consumeAttributeSpace(M),ae.appdata=this.extractOneOrMore(M,N,[1,64])),this.attributes.msids.push(ae)}parseImageAttr(M){this.attributes.imageattr.push(M.attValue)}parseRid(M){const ae=this.extractOneOrMore(M,Qe=>F(Qe)||S(Qe)||Qe==="_"||Qe==="-");this.consumeAttributeSpace(M);const fe={id:ae,direction:this.extract(M,this.consumeToken),params:[]};if(this.peekChar(M)===_){if(this.consumeAttributeSpace(M),this.peek(M,"pt=")){this.extract(M,this.consume,"pt=");const Qe=[];for(;;){const Xt=this.extract(M,this.consumeToken);Qe.push(Xt);try{this.extract(M,this.consume,",")}catch{break}}fe.payloads=Qe,this.peekChar(M)===_&&this.extract(M,this.consume,_)}for(;;){const Qe=this.extract(M,this.consumeToken);switch(Qe){case"depend":{const Xt={type:Qe,rids:this.extract(M,this.consume,"=").split(",")};fe.params.push(Xt);break}default:{const Xt={type:Qe};this.peekChar(M)==="="&&(this.extract(M,this.consume,"="),Xt.val=this.extract(M,this.consumeTill,";")),fe.params.push(Xt)}}try{this.extract(M,this.consume,";")}catch{break}}}this.attributes.rids.push(fe)}parseSimulcast(M){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=M.attValue,this.extract(M,this.consumeTill)}parseSctpPort(M){this.attributes.sctpPort=this.extractOneOrMore(M,S,[1,5])}parseMaxMessageSize(M){this.attributes.maxMessageSize=this.extractOneOrMore(M,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(M){this.attributes.mid=this.extract(M,this.consumeToken)}parseSSRCGroup(M){const ae=this.extract(M,this.consumeToken),fe=[];for(;;)try{this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeInteger);fe.push(parseInt(Qe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ae,ssrcIds:fe})}}function pr(He,M,ae){return M in He?Object.defineProperty(He,M,{value:ae,enumerable:!0,configurable:!0,writable:!0}):He[M]=ae,He}class ai{constructor(){pr(this,"eol",m)}print(M,ae){let fe="";return ae&&(this.eol=ae),fe+=this.printVersion(M.version),fe+=this.printOrigin(M.origin),fe+=this.printSessionName(M.sessionName),fe+=this.printInformation(M.information),fe+=this.printUri(M.uri),fe+=this.printEmail(M.emails),fe+=this.printPhone(M.phones),fe+=this.printConnection(M.connection),fe+=this.printBandwidth(M.bandwidths),fe+=this.printTimeFields(M.timeFields),fe+=this.printKey(M.key),fe+=this.printSessionAttributes(M.attributes),fe+=this.printMediaDescription(M.mediaDescriptions),fe}printVersion(M){return"v=".concat(M).concat(this.eol)}printOrigin(M){return"o=".concat(M.username," ").concat(M.sessId," ").concat(M.sessVersion," ").concat(M.nettype," ").concat(M.addrtype," ").concat(M.unicastAddress).concat(this.eol)}printSessionName(M){return M?"s=".concat(M).concat(this.eol):""}printInformation(M){return M?"i=".concat(M).concat(this.eol):""}printUri(M){return M?"u=".concat(M).concat(this.eol):""}printEmail(M){let ae="";for(const fe of M)ae+="e=".concat(fe).concat(this.eol);return ae}printPhone(M){let ae="";for(const fe of M)ae+="e=".concat(fe).concat(this.eol);return ae}printConnection(M){return M?"c=".concat(M.nettype," ").concat(M.addrtype," ").concat(M.address).concat(this.eol):""}printBandwidth(M){let ae="";for(const fe of M)ae+="b=".concat(fe.bwtype,":").concat(fe.bandwidth).concat(this.eol);return ae}printTimeFields(M){let ae="";for(const fe of M){ae+="t=".concat(fe.time.startTime," ").concat(fe.time.startTime).concat(this.eol);for(const Qe of fe.repeats)ae+="r=".concat(Qe.repeatInterval," ").concat(Qe.typedTimes.join(" ")).concat(this.eol);fe.zoneAdjustments&&(ae+="z=",ae+="z=".concat(fe.zoneAdjustments.map(Qe=>"".concat(Qe.time," ").concat(Qe.back?"-":""," ").concat(Qe.typedTime)).join(" ")).concat(this.eol),ae+=this.eol)}return ae}printKey(M){return M?"k=".concat(M).concat(this.eol):""}printAttributes(M){let ae="";for(const fe of M)ae+="a=".concat(fe.attField).concat(fe.attValue?":".concat(fe.attValue):"").concat(this.eol);return ae}printMediaDescription(M){let ae="";for(const fe of M)ae+=this.printMedia(fe.media),ae+=this.printInformation(fe.information),ae+=this.printConnections(fe.connections),ae+=this.printBandwidth(fe.bandwidths),ae+=this.printKey(fe.key),ae+=this.printMediaAttributes(fe);return ae}printConnections(M){let ae="";for(const fe of M)ae+=this.printConnection(fe);return ae}printMedia(M){return"m=".concat(M.mediaType," ").concat(M.port," ").concat(M.protos.join("/")," ").concat(M.fmts.join(" ")).concat(this.eol)}printSessionAttributes(M){return new ma(this.eol).print(M)}printMediaAttributes(M){return new je(this.eol).print(M)}}class Yr{constructor(M){pr(this,"eol",void 0),this.eol=M}printIceUfrag(M){return M===void 0?"":"a=ice-ufrag:".concat(M).concat(this.eol)}printIcePwd(M){return M===void 0?"":"a=ice-pwd:".concat(M).concat(this.eol)}printIceOptions(M){return M===void 0?"":"a=ice-options:".concat(M.join(_)).concat(this.eol)}printFingerprints(M){return M.length>0?M.map(ae=>"a=fingerprint:".concat(ae.hashFunction).concat(_).concat(ae.fingerprint)).join(this.eol)+this.eol:""}printExtmap(M){return M.map(ae=>"a=extmap:".concat(ae.entry).concat(ae.direction?"/".concat(ae.direction):"").concat(_).concat(ae.extensionName).concat(ae.extensionAttributes?"".concat(_).concat(ae.extensionAttributes):"").concat(this.eol)).join("")}printSetup(M){return M===void 0?"":"a=setup:".concat(M).concat(this.eol)}printUnrecognized(M){return M.map(ae=>"a=".concat(ae.attField).concat(ae.attValue?":".concat(ae.attValue):"").concat(this.eol)).join("")}}class ma extends Yr{print(M){let ae="";return ae+=this.printGroups(M.groups),ae+=this.printMsidSemantic(M.msidSemantic),ae+=this.printIceLite(M.iceLite),ae+=this.printIceUfrag(M.iceUfrag),ae+=this.printIcePwd(M.icePwd),ae+=this.printIceOptions(M.iceOptions),ae+=this.printFingerprints(M.fingerprints),ae+=this.printSetup(M.setup),ae+=this.printTlsId(M.tlsId),ae+=this.printIdentity(M.identities),ae+=this.printExtmap(M.extmaps),ae+=this.printUnrecognized(M.unrecognized),ae}printGroups(M){let ae="";return M.length>0&&(ae+=M.map(fe=>"a=group:".concat(fe.semantic).concat(fe.identificationTag.map(Qe=>"".concat(_).concat(Qe)).join("")).concat(this.eol)).join("")),ae}printIceLite(M){return M===void 0?"":"a=ice-lite"+this.eol}printTlsId(M){return M?"a=tls-id:".concat(M).concat(this.eol):""}printIdentity(M){return M.length===0?"":M.map(ae=>"a=identity:".concat(ae.assertionValue).concat(ae.extensions.map(fe=>"".concat(_).concat(fe.name).concat(fe.value?"=".concat(fe.value):"")))).join(this.eol)+this.eol}printMsidSemantic(M){if(!M)return"";let ae="a=msid-semantic:".concat(M.semantic);return M.applyForAll?ae+="".concat(_,"*"):M.identifierList.length>0&&(ae+=M.identifierList.map(fe=>"".concat(_).concat(fe))),ae+this.eol}}class je extends Yr{print(M){const ae=M.attributes;let fe="";return fe+=this.printRTCP(ae.rtcp),fe+=this.printIceUfrag(ae.iceUfrag),fe+=this.printIcePwd(ae.icePwd),fe+=this.printIceOptions(ae.iceOptions),fe+=this.printCandidates(ae.candidates),fe+=this.printRemoteCandidatesList(ae.remoteCandidatesList),fe+=this.printEndOfCandidates(ae.endOfCandidates),fe+=this.printFingerprints(ae.fingerprints),fe+=this.printSetup(ae.setup),fe+=this.printMid(ae.mid),fe+=this.printExtmap(ae.extmaps),fe+=this.printRTPRelated(ae),fe+=this.printPtime(ae.ptime),fe+=this.printMaxPtime(ae.maxPtime),fe+=this.printDirection(ae.direction),fe+=this.printSSRCGroups(ae.ssrcGroups),fe+=this.printSSRC(ae.ssrcs),fe+=this.printRTCPMux(ae.rtcpMux),fe+=this.printRTCPMuxOnly(ae.rtcpMuxOnly),fe+=this.printRTCPRsize(ae.rtcpRsize),fe+=this.printMSId(ae.msids),fe+=this.printImageattr(ae.imageattr),fe+=this.printRid(ae.rids),fe+=this.printSimulcast(ae.simulcast),fe+=this.printSCTPPort(ae.sctpPort),fe+=this.printMaxMessageSize(ae.maxMessageSize),fe+=this.printUnrecognized(ae.unrecognized),fe}printCandidates(M){return M.map(ae=>"a=candidate:".concat(ae.foundation).concat(_).concat(ae.componentId).concat(_).concat(ae.transport).concat(_).concat(ae.priority).concat(_).concat(ae.connectionAddress).concat(_).concat(ae.port).concat(_,"typ").concat(_).concat(ae.type).concat(ae.relAddr?"".concat(_,"raddr").concat(_).concat(ae.relAddr):"").concat(ae.relPort?"".concat(_,"rport").concat(_).concat(ae.relPort):"").concat(Object.keys(ae.extension).map(fe=>"".concat(_).concat(fe).concat(_).concat(ae.extension[fe])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(M){return M.map(ae=>"a=remote-candidates:".concat(ae.join(_)).concat(this.eol)).join("")}printEndOfCandidates(M){return M===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(M){if(!M.payloads)return"";const ae=M.payloads;let fe="";fe+=M.rtcpFeedbackWildcards.map(Qe=>this.printRTCPFeedback("*",Qe)).join("");for(const Qe of ae)fe+=this.printRtpMap(Qe.payloadType,Qe.rtpMap),fe+=this.printFmtp(Qe.payloadType,Qe.fmtp),fe+=Qe.rtcpFeedbacks.map(Xt=>this.printRTCPFeedback(Qe.payloadType,Xt)).join("");return fe}printFmtp(M,ae){if(!ae)return"";const fe=Object.keys(ae.parameters);return fe.length===1&&ae.parameters[fe[0]]===null?"a=fmtp:".concat(M).concat(_).concat(fe[0]).concat(this.eol):"a=fmtp:".concat(M).concat(_).concat(Object.keys(ae.parameters).map(Qe=>"".concat(Qe,"=").concat(ae.parameters[Qe])).join(";")).concat(this.eol)}printRtpMap(M,ae){return ae?"a=rtpmap:".concat(M).concat(_).concat(ae.encodingName,"/").concat(ae.clockRate).concat(ae.encodingParameters?"/".concat(ae.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(M,ae){let fe="a=rtcp-fb:".concat(M).concat(_),Qe=ae;return Qe.type==="trr-int"?fe+="ttr-int".concat(_).concat(Qe.interval):(fe+="".concat(Qe.type),Qe.parameter&&(fe+="".concat(_).concat(Qe.parameter),Qe.additional&&(fe+="".concat(_).concat(Qe.additional)))),fe+this.eol}printPtime(M){return M===void 0?"":"a=ptime:".concat(M).concat(this.eol)}printMaxPtime(M){return M===void 0?"":"a=maxptime:".concat(M).concat(this.eol)}printDirection(M){return M===void 0?"":"a=".concat(M).concat(this.eol)}printSSRC(M){return M.map(ae=>Object.keys(ae.attributes).map(fe=>"a=ssrc:".concat(ae.ssrcId.toString(10)).concat(_).concat(fe).concat(ae.attributes[fe]?":".concat(ae.attributes[fe]):"").concat(this.eol)).join("")).join("")}printRTCPMux(M){return M===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(M){return M===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(M){return M===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(M){if(M===void 0)return"";let ae="a=rtcp:".concat(M.port);return M.netType&&(ae+="".concat(_).concat(M.netType)),M.addressType&&(ae+="".concat(_).concat(M.addressType)),M.address&&(ae+="".concat(_).concat(M.address)),ae+this.eol}printMSId(M){return M.map(ae=>"a=msid:".concat(ae.id).concat(ae.appdata?"".concat(_).concat(ae.appdata):"").concat(this.eol)).join("")}printImageattr(M){return M.map(ae=>"a=imageattr:".concat(ae).concat(this.eol)).join("")}printRid(M){return M.map(ae=>{let fe="a=rid:".concat(ae.id).concat(_).concat(ae.direction);return ae.payloads&&(fe+="".concat(_,"pt=").concat(ae.payloads.join(","))),ae.params.length>0&&(fe+="".concat(_).concat(ae.params.map(Qe=>Qe.type==="depend"?"depend=".concat(Qe.rids.join(",")):"".concat(Qe.type,"=").concat(Qe.val)).join(";"))),fe+this.eol}).join("")}printSimulcast(M){return M===void 0?"":"a=simulcast:".concat(M).concat(this.eol)}printSCTPPort(M){return M===void 0?"":"a=sctp-port:".concat(M).concat(this.eol)}printMaxMessageSize(M){return M===void 0?"":"a=max-message-size:".concat(M).concat(this.eol)}printMid(M){return M===void 0?"":"a=mid:".concat(M).concat(this.eol)}printSSRCGroups(M){return M.map(ae=>"a=ssrc-group:".concat(ae.semantic).concat(ae.ssrcIds.map(fe=>"".concat(_).concat(fe.toString(10))).join("")).concat(this.eol)).join("")}}function it(He){return new dt().parse(He)}function wt(He,M){return new ai().print(He,M)}}},r={};function i(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return e[o](c,c.exports,i),c.exports}return i.d=(o,c)=>{for(var u in c)i.o(c,u)&&!i.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();function ja(e){return wW.parse(e)}function Um(e,r){return wW.print(e,r)}var pfe=ac("Array").keys,ffe=Nc,mfe=Ti,gfe=k,_fe=pfe,sL=Array.prototype,yfe={DOMTokenList:!0,NodeList:!0},Efe=function(e){var r=e.keys;return e===sL||gfe(sL,e)&&r===sL.keys||mfe(yfe,ffe(e))?_fe:r},Kc=l(Efe);function CW(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function cn(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?CW(Object(i),!0).forEach(function(o){Gr(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):CW(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Gr(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}const RW=new class extends Mr{constructor(){super(...arguments),Gr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:r}=e;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class vfe{constructor(r){Gr(this,"logger",void 0),Gr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function oL(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function IW(){const e=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Il={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},WA=Date.now(),CT=e=>{for(const r in Il)if(Object.prototype.hasOwnProperty.call(Il,r)&&Il[r]===e)return r;return"DEFAULT"},x=new class{constructor(){Gr(this,"proxyServerURL",void 0),Gr(this,"logLevel",Il.DEBUG),Gr(this,"uploadState","collecting"),Gr(this,"uploadLogWaitingList",[]),Gr(this,"uploadLogUploadingList",[]),Gr(this,"uploadErrorCount",0),Gr(this,"currentLogID",0),Gr(this,"url",void 0),Gr(this,"extLog",(e,r)=>{this.appendLogToWaitingList(e,...r)})}debug(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Il.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Il.INFO].concat(r);this.log.apply(this,o)}warning(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Il.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Il.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[Il.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){rr("UPLOAD_LOG",!0)}disableLogUpload(){rr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new vfe(this).prefix(e)}log(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-WA<100)return void setTimeout(()=>{this.log(...r)},Date.now()-WA);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=oL()+" Agora-SDK [".concat(CT(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=oL()+" %cAgora-SDK [".concat(CT(o),"]:");let u=[];if(!oe("USE_NEW_LOG"))switch(o){case Il.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case Il.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case Il.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case Il.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-WA<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-WA);const o=Math.max(0,Math.min(4,r[0]));r[0]=oL()+" Agora-SDK [".concat(CT(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(e){if(!oe("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=IW()+" Agora-SDK [".concat(CT(e),"]:"):i[0]=IW()+" Agora-SDK [".concat(CT(e),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,r={sdk_version:Rl,process_id:oe("PROCESS_ID"),payload:JSON.stringify(e)};return gd(async()=>{const i=await la.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(oe("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(oe("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{const o={status:-1,message:i.message,errorRange:e.map(c=>c.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),RW.reportLogUploadError(o),!0},{timeout:oe("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:oe("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,oe("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var AW;function Sfe(e){return ds(e.reportId,"params.reportId",0,100,!1),ds(e.category,"params.category",0,100,!1),ds(e.event,"params.event",0,100,!1),ds(e.label,"params.label",0,100,!1),or(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(AW={}).FREE="free",AW.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const bfe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let qi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),kr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Tfe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function jt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,o){const c=o.value;if(typeof c=="function"){const u=e.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,_=new Array(m),E=0;E<m;E++)_[E]=arguments[E];let S=_;if(e.argsMap)try{S=e.argsMap(this,..._)}catch(P){x.warning(P),S=[]}try{JSON.stringify(S)}catch{x.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),S=[]}const R=(e.report||At).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:S,tag:Wr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const P=c.apply(this,_);return P instanceof ut?P.then(N=>(R.onSuccess(e.reportResult&&N),N)).catch(N=>{throw R.onError(N),N}):(R.onSuccess(e.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return o}}const At=new class{constructor(){Gr(this,"baseInfoMap",new Map),Gr(this,"proxyServer",void 0),Gr(this,"eventUploadTimer",void 0),Gr(this,"setSessionIdTimer",void 0),Gr(this,"url",void 0),Gr(this,"sids",new Set),Gr(this,"backupUrl",void 0),Gr(this,"_appId",void 0),Gr(this,"_aid",0),Gr(this,"keyEventUploadPendingItems",[]),Gr(this,"normalEventUploadPendingItems",[]),Gr(this,"apiInvokeUploadPendingItems",[]),Gr(this,"apiInvokeCount",0),Gr(this,"apiInvokeLoggedCount",0),Gr(this,"ltsList",[]),Gr(this,"lastSendNormalEventTime",Date.now()),Gr(this,"customReportCounterTimer",void 0),Gr(this,"customReportCount",0),Gr(this,"extApiInvoke",async e=>{for(const r of e){const i=cn(cn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Wr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),oe("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),oe("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,r=>{let[i,o]=r;return i+o}),16)||0}reportApiInvoke(e,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!oe("SHOW_REPORT_INVOKER_LOG"),h=!!oe("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function E(N,G){if(m){let F="[apiInvoke-".concat(_,"]");r.id&&(F+="[".concat(r.id,"]")),r.name&&(F+="[".concat(r.name,"]")),x.info("".concat(F," ").concat(N),N==="start"?r.options:G||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:e,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});E("start");let R=!1;hs(r.timeout).then(()=>{R||(this.sendApiInvoke(cn(cn({},S()),{},{error:te.API_INVOKE_TIMEOUT,success:!1})),E("timeout"))});const P=new Me(te.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:N=>{const G=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(cn(cn({},S()),{},{success:!0},r.reportResult&&{result:N})),E("onSuccess"),N};return i?aW(G,r.name+"Success",i,()=>R=!0):G()},onError:N=>{const G=()=>{if(R)throw N;R=!0,this.sendApiInvoke(cn(cn({},S()),{},{success:!1,error:N})),E("onFailure",N.toString())};return i?aW(G,r.name+"Error",i,()=>R=!0):G()}}}sessionInit(e,r){if(this.baseInfoMap.has(e))return;const i=Date.now(),o=this.createBaseInfo(e,i);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:oe("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:tL?"global":"oversea",areas:oe("AREAS")&&oe("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:E,clientRole:S}=r,R=Date.now(),P=cn(cn({},o),{},{eventType:qi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:rL,lts:R,elapse:R-i,extend:JSON.stringify(c),mode:r.mode,process:oe("PROCESS_ID"),appType:oe("APP_TYPE"),success:!0,version:Rl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:E,clientType:st(N=window.navigator.userAgent).call(N,"AgoraWebView")?42:20,clientRole:S,serviceId:oe("PROCESS_ID"),extensionID:oe("PLUGIN_INFO").join(",")||""});var N;this.send({type:kr.SESSION,data:P},!0)}joinChooseServer(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{role:r.role,eventType:qi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:kr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{eventType:qi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-i.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:kr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:_}=r,E=c-(u&&h?h:i.startTime),S=cn(cn({},o),{},{eventType:qi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:E,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:eL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=S.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=c),u)this.send({type:kr.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(_){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),F=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:F&&F.length?F[0].split("=")[1]:"",isProxy:_?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),F=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:F&&F.length?F[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const N=Object.assign({},S,P,{eventType:qi.REJOIN_GATEWAY});this.send({type:kr.RE_JOIN_GATEWAY,data:N},!0)}}joinChannelTimeout(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=Date.now(),c=cn(cn({},i.info),{},{lts:o,timeout:r,elapse:o-i.startTime});this.send({type:kr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{eventType:qi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:kr.PUBLISH,data:u},!0)}subscribe(e,r,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=cn(cn({},c),{},{eventType:qi.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:kr.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var r;const i=[...Kc(r=this.baseInfoMap).call(r)],o=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=cn(cn({},u),{},{eventType:qi.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:kr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=cn(cn(cn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:i,data:m},!0)}firstRemoteFrame(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=cn(cn(cn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:i,data:m},!0)}abTest(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:qi.AB_TEST,lts:c});this.send({type:kr.AB_TEST,data:u},!0)}pcStats(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:qi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:kr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,r){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:qi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:kr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=cn(cn(cn({},u),o),{},{eventType:r,lts:h});this.send({type:i,data:m},!0)}streamSwitch(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{eventType:qi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-i.startTime,success:r.succ});this.send({type:kr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{eventType:qi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:kr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{eventType:qi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:kr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?x.debug("reportProxyServerurl: ".concat(e)):x.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:kr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now();(function(u,h,m){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const E=mh(JSON.stringify(u));let S=0;const R=[];let P=0;for(let N=0;N<_.length;N++)P+=_.charCodeAt(N)<=127?1:3,P<=m-E||(R[R.length]=_t(_t({},u),{},{[h]:_.substring(S,N)}),S=N,P=_.charCodeAt(N)<=127?1:3);return S!==_.length-1&&(R[R.length]=_t(_t({},u),{},{[h]:_.substring(S)})),R})(cn(cn(cn({},o),r),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:kr.WORKER_EVENT,data:u},!0))}apworkerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{elapse:c-i.startTime,lts:c});this.send({type:kr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{elapse:c-i.startTime,lts:c,extend:r.extend||void 0});this.send({type:kr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=cn(cn(cn({},o),r),{},{elapse:c-i.startTime,lts:c});this.send({type:kr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,r){if(this.customReportCount+=r.length,this.customReportCount>oe("CUSTOM_REPORT_LIMIT"))throw new Me(te.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),o=r.map(c=>({type:kr.USER_ANALYTICS,data:cn(cn({sid:e},c),{},{lts:i})}));try{oe("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw x.error("send custom report message failed",c.toString()),new Me(te.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const r=oe("NOT_REPORT_EVENT");if(e.tag&&st(r)&&st(r).call(r,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=i.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Me){const{code:_,message:E}=e.error;h=_||E||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:kr.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const r=Array.from(this.sids).find(i=>i!==null);r&&e.forEach(i=>{i&&(i.sid=r,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,r){if(r)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,r){const i=[],o=[];for(;e.length;){const u=e.shift();i.length<20?i.push(u):o.push(u)}e.push(...o);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),iT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),oe("ENABLE_EVENT_REPORT")&&i.length&&(oe("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{oe("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-oe("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){_i.networkState===mc.OFFLINE&&await ut.race([_i.onlineWaiter,hs(2*Ii.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=Wx(JSON.stringify(h.data)),_=new ArrayBuffer(5),E=(R=>{let P=0;return Object.entries(kr).forEach(N=>{let[G,F]=N;F===R.type&&(P=Tfe[G])}),P})(h),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&E),S.setUint8(3,E>>>8&255),S.setUint8(4,E>>>16&255),u=Q8(u,new Uint8Array(_)),u=Q8(u,m)}),u},i="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await Yx(o,{timeout:1e4,data:r(e),headers:cn(cn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),o=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:i,aid:o};_i.networkState===mc.OFFLINE&&await ut.race([_i.onlineWaiter,hs(2*Ii.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(oe("EVENT_REPORT_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(u)));try{r?await cfe(h,{timeout:1e4,data:c}):await Yx(h,{timeout:1e4,data:c})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(e,r){const i=Object.assign({},bfe);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:r}),i}reportResourceTiming(e,r){const i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:Wr.TRACER}).onSuccess()}};RW.on("REPORT_LOG_UPLOAD",e=>{e.networkState=_i.networkState,At.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Wr.TRACER}).onSuccess("logUploadError")});class Oe extends Me{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Gr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const ps={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function jn(){return ps}function PW(){return"setSinkId"in HTMLAudioElement.prototype&&(!oe("RESTRICTION_SET_PLAYBACK_DEVICE")||(Kp()||j8())&&!Fx())}function OW(){return!ps.supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&qp()}let fs=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Mv(e,r,i){return{sampleRate:e,stereo:r,bitrate:i}}function xn(e,r,i,o,c){return{width:e,height:r,frameRate:i,bitrateMin:o,bitrateMax:c}}function yu(e,r,i,o,c){return{width:{max:e},height:{max:r},frameRate:i,bitrateMin:o,bitrateMax:c}}function aL(e,r){return{numSpatialLayers:e,numTemporalLayers:r}}const wfe={"90p":xn(160,90),"90p_1":xn(160,90),"120p":xn(160,120,15,30,65),"120p_1":xn(160,120,15,30,65),"120p_3":xn(120,120,15,30,50),"120p_4":xn(212,120),"180p":xn(320,180,15,30,140),"180p_1":xn(320,180,15,30,140),"180p_3":xn(180,180,15,30,100),"180p_4":xn(240,180,15,30,120),"240p":xn(320,240,15,40,200),"240p_1":xn(320,240,15,40,200),"240p_3":xn(240,240,15,40,140),"240p_4":xn(424,240,15,40,220),"360p":xn(640,360,15,80,400),"360p_1":xn(640,360,15,80,400),"360p_3":xn(360,360,15,80,260),"360p_4":xn(640,360,30,80,600),"360p_6":xn(360,360,30,80,400),"360p_7":xn(480,360,15,80,320),"360p_8":xn(480,360,30,80,490),"360p_9":xn(640,360,15,80,800),"360p_10":xn(640,360,24,80,800),"360p_11":xn(640,360,24,80,1e3),"480p":xn(640,480,15,100,500),"480p_1":xn(640,480,15,100,500),"480p_2":xn(640,480,30,100,1e3),"480p_3":xn(480,480,15,100,400),"480p_4":xn(640,480,30,100,750),"480p_6":xn(480,480,30,100,600),"480p_8":xn(848,480,15,100,610),"480p_9":xn(848,480,30,100,930),"480p_10":xn(640,480,10,100,400),"720p":xn(1280,720,15,120,1130),"720p_auto":xn(1280,720,30,900,3e3),"720p_1":xn(1280,720,15,120,1130),"720p_2":xn(1280,720,30,120,2e3),"720p_3":xn(1280,720,30,120,1710),"720p_5":xn(960,720,15,120,910),"720p_6":xn(960,720,30,120,1380),"1080p":xn(1920,1080,15,120,2080),"1080p_1":xn(1920,1080,15,120,2080),"1080p_2":xn(1920,1080,30,120,3e3),"1080p_3":xn(1920,1080,30,120,3150),"1080p_5":xn(1920,1080,60,120,4780),"1440p":xn(2560,1440,30,120,4850),"1440p_1":xn(2560,1440,30,120,4850),"1440p_2":xn(2560,1440,60,120,7350),"4k":xn(3840,2160,30,120,8910),"4k_1":xn(3840,2160,30,120,8910),"4k_3":xn(3840,2160,60,120,13500)},Cfe={"480p":yu(640,480,5),"480p_1":yu(640,480,5),"480p_2":yu(640,480,30),"480p_3":yu(640,480,15),"720p":yu(1280,720,5),"720p_auto":xn(1280,720,30,900,3e3),"720p_1":yu(1280,720,5),"720p_2":yu(1280,720,30),"720p_3":yu(1280,720,15),"1080p":yu(1920,1080,5),"1080p_1":yu(1920,1080,5),"1080p_2":yu(1920,1080,30),"1080p_3":yu(1920,1080,15)},Rfe={"1SL1TL":aL(1,1),"3SL3TL":aL(3,3),"2SL3TL":aL(2,3)};function _h(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},wfe[e]):e}function cL(e){return typeof e=="string"?Object.assign({},Cfe[e]):e}function zA(e){return typeof e=="string"?Object.assign({},Rfe[e]):e}const Ife={speech_low_quality:Mv(16e3,!1),speech_standard:Mv(32e3,!1,18),music_standard:Mv(48e3,!1),standard_stereo:Mv(48e3,!0,56),high_quality:Mv(48e3,!1,128),high_quality_stereo:Mv(48e3,!0,192)};function GA(e){return typeof e=="string"?Object.assign({},Ife[e]):e}const Uv=[];function kW(e){return Bi(e,"mediaSource",["screen","window","application"]),!0}let bt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),hr=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Vv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Afe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Pfe=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),M_=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Fv=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),jv=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Bv=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),qc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const lL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},uL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},NW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Ofe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},DW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Do=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Yc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),RT=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),U_=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),po=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),yh=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const dL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let HA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function xW(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Nr(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?xW(Object(i),!0).forEach(function(o){Ae(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xW(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Ae(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function Ln(e,r,i,o,c){var u,h,m={};return Object.keys(o).forEach(function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=cc(u=cm(h=i.slice()).call(h)).call(u,function(_,E){return E(e,r,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(e,r,m),m=null),m}class LW extends Mr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(M_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,i){super(),Ae(this,"trackMediaType",void 0),Ae(this,"_ID",void 0),Ae(this,"_rtpTransceiver",void 0),Ae(this,"_lowRtpTransceiver",void 0),Ae(this,"_hints",[]),Ae(this,"_isClosed",!1),Ae(this,"_originMediaStreamTrack",void 0),Ae(this,"mediaStreamTrack",void 0),Ae(this,"_external",{}),this._ID=i||dr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){st(Uv).call(Uv,o)||Uv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Lm(()=>{var i;At.reportApiInvoke(null,{name:Ri.GET_MEDIA_STREAM_TRACK,options:[],tag:Wr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Vv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const i=Uv.indexOf(r);i!==-1&&Uv.splice(i,1)}(this),this.emit(Fv.CLOSED),this.removeAllListeners(M_.SEI_RECEIVED)}_updateRtpTransceiver(r,i){if(i===Vv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(M_.TRANSCEIVER_UPDATED,r,i)}}class Wv extends LW{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,i){super(r,i),Ae(this,"_enabled",!0),Ae(this,"_muted",!1),Ae(this,"_isExternalTrack",!1),Ae(this,"_isClosed",!1),Ae(this,"_enabledMutex",void 0),Ae(this,"processor",void 0),Ae(this,"_processorContext",void 0),Ae(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Us("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return(r=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(bt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,bt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Fv.TRACK_ENDED)}stateCheck(r,i){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),Yp(i,r),this._enabled&&this._muted&&r==="enabled"&&i===!1)throw new Me(te.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&i===!0)throw new Me(te.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ut.resolve([])}}const MW=window.AudioContext||window.webkitAudioContext;let Xc=null;const ir=new class extends Mr{constructor(){super(...arguments),Ae(this,"prevState",void 0),Ae(this,"curState",void 0),Ae(this,"currentTime",void 0),Ae(this,"currentTimeStuckAt",void 0),Ae(this,"interruptDetectorTrack",void 0),Ae(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(fs.IOS_15_16_INTERRUPTION_START)}),Ae(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(Xc&&await Xc.suspend(),this.emit(fs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){x.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){x.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function zv(){if(!Xc){if(function(){if(!MW)return void x.error("your browser is not support web audio");x.info("create audio context");const e=Nr({},oe("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(e)),Xc=new MW(e),ir.curState=Xc.state,Xc.onstatechange=()=>{ir.prevState=ir.curState,ir.curState=Xc?Xc.state:void 0;const{prevState:r,curState:i}=ir,o=i==="running",c=i==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",_=Dn().osVersion;(No()||gu())&&u&&c&&(x.info("ios".concat(_,"-interruption-start")),ir.emit(fs.IOS_INTERRUPTION_START)),(No()||gu())&&(h||m)&&o&&(x.info("ios".concat(_,"-interruption-end")),ir.emit(fs.IOS_INTERRUPTION_END)),r!==i&&ir.emit(fs.STATE_CHANGE,i,r)},setInterval(()=>{var r;const i=(r=Xc)===null||r===void 0?void 0:r.currentTime;ir.currentTime!==i?(ir.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(i)),ir.currentTimeStuckAt=void 0),ir.currentTime=i):(i!==ir.currentTimeStuckAt&&(At.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Wr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(i))),ir.currentTimeStuckAt=i)},5e3),async function(r){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(F){r.state==="running"?_(!1):No()||gu()?r.state==="suspended"&&(_(!0),F&&r.resume().then(E,E)):r.state!=="closed"&&(_(!0),F&&r.resume().then(E,E))}function _(F){if(c!==F){c=F;for(let j=0,q=i;j<q.length;j+=1){const ee=q[j];F?window.addEventListener(ee,S,{capture:!0,passive:!0}):window.removeEventListener(ee,S,{capture:!0,passive:!0})}}}function E(){m(!1)}function S(){m(!0)}function R(F){if(!h)if(o.paused)if(F){let j;P(!1),h=!0;try{j=o.play(),j?j.then(N,N):(o.addEventListener("playing",N),o.addEventListener("abort",N),o.addEventListener("error",N))}catch{N()}}else P(!0);else P(!1)}function P(F){if(u!==F){u=F;for(let j=0,q=i;j<q.length;j++){const ee=q[j];F?window.addEventListener(ee,G,{capture:!0,passive:!0}):window.removeEventListener(ee,G,{capture:!0,passive:!0})}}}function N(){o.removeEventListener("playing",N),o.removeEventListener("abort",N),o.removeEventListener("error",N),h=!1,R(!1)}function G(){R(!0)}if(No()){const F=r.createMediaStreamDestination(),j=document.createElement("div");j.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=j.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=F.stream,R(!0)}ir.on(fs.STATE_CHANGE,function(){m(!0)}),m(!1)}(Xc)}(),!Xc)throw new Me(te.NOT_SUPPORTED,"can not create audio context");return Xc}return Xc}function V_(e){if(function(){if(hL!==null)return hL;const o=zv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),hL=m,m}())return;const r=e.connect,i=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),st(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),r.call(e,o,c,u)):r.call(e,o,c)),e},e.disconnect=(o,c,u)=>{i.call(e),o?xA(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)r.call(e,h)}}let hL=null;function pL(e,r){let i=!1;const o=1/r;if(oe("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=zv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{i=!0}}class UW{constructor(){Ae(this,"context",void 0),Ae(this,"analyserNode",void 0),Ae(this,"sourceNode",void 0),this.context=zv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||No()||gu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const i=cc(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class VW extends Mr{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Ae(this,"outputNode",void 0),Ae(this,"outputTrack",void 0),Ae(this,"isPlayed",!1),Ae(this,"sourceNode",void 0),Ae(this,"context",void 0),Ae(this,"audioBufferNode",void 0),Ae(this,"destNode",void 0),Ae(this,"audioOutputLevel",0),Ae(this,"volumeLevelAnalyser",void 0),Ae(this,"_processedNode",void 0),Ae(this,"playNode",void 0),Ae(this,"isDestroyed",!1),Ae(this,"onNoAudioInput",void 0),Ae(this,"isNoAudioInput",!1),Ae(this,"_noAudioInputCount",0),this.context=zv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),V_(this.outputNode),this.volumeLevelAnalyser=new UW}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(qc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!jn().webAudioMediaStreamDest)throw new Me(te.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&LA(()=>{ir.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;No()||gu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await hs(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;(r=this.processedNode)===null||r===void 0||r.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class FW extends VW{get isFreeze(){return!1}constructor(r,i,o){var c;if(super(),Ae(this,"sourceNode",void 0),Ae(this,"track",void 0),Ae(this,"clonedTrack",void 0),Ae(this,"audioElement",void 0),Ae(this,"isCurrentTrackCloned",!1),Ae(this,"isRemoteTrack",!1),Ae(this,"originVolumeLevelAnalyser",void 0),Ae(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),V_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const E=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(E,this.context.currentTime),V_(this.outputNode),this.emit(qc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Me(te.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),V_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));V_(_),this.originVolumeLevelAnalyser=new UW,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Dn();i&&h.os===Ki.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(ir.on(fs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),V_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(qc.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),ir.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),x.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([i]));V_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function jW(e,r,i){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function kfe(e,r){const i=await BW(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ut((m,_)=>{const E=document.createElement("div");E.innerText="share screen",E.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const N=document.createElement("div");N.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(q);const ee=new Error("NotAllowedError");ee.name="NotAllowedError",_(ee)};let F=h;const j=document.createElement("div");if(h){const ee=document.createElement("input");ee.setAttribute("type","checkbox");const he=document.createElement("span");ee.setAttribute("style","margin-right: 6px;"),he.innerText="Share audio",ee.checked=F,ee.onchange=()=>{F=ee.checked},j.appendChild(ee),j.appendChild(he)}N.appendChild(j),N.appendChild(G),S.appendChild(R),S.appendChild(P),S.appendChild(N);const q=document.createElement("div");q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),q.appendChild(E),q.appendChild(S),document.body.appendChild(q),u.map(ee=>{if(ee.id){const he=document.createElement("div");he.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Se=ee.thumbnail;try{const{width:we}=Se.getSize();we>1920&&(Se=Se.resize({width:1920}))}catch(we){throw we&&we.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),we}he.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Se.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+ee.name.replace(/[\u00A0-\u9999<>\&]/g,function(we){return"&#"+we.charCodeAt(0)+";"})+"</span>",he.onclick=()=>{document.body.removeChild(q),m({sourceId:ee.id,audio:F})},P.appendChild(he)}})})}(i,r);return await jW(o,e,c)}async function BW(e){let r=["window","screen"];e!=="application"&&e!=="window"||(r=["window"]),e==="screen"&&(r=["screen"]);const i=Z8();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new Me(te.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new ut((u,h)=>{i.desktopCapturer.getSources({types:r},(m,_)=>{m?h(m):u(_)})}));try{return await o}catch(u){throw new Me(te.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const fL=new Us("safari");let WW=!1,zW=!1;async function Jc(e,r){let i=0,o=null;for(;i<2;)try{o=await Nfe(e,r,i>0);break}catch(c){if(c instanceof Me)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const u=$A(c.name||c.code||c,c.message);if(u.code===te.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await hs(500);continue}throw x.error("[".concat(r,"] ").concat(u.toString())),u}if(!o)throw new Me(te.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Nfe(e,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Me(te.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=jn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return x.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(Z8())e.screen.sourceId?Gv(c,await jW(e.screen.sourceId,e.screen,!!e.screenAudio)):Gv(c,await kfe(e.screen,!!e.screenAudio));else if(Kp()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Me(te.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=e.screen.extensionId,m=r,new ut((N,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},F=>{if(!F||!F.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),F),void G(new Me(te.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));N(F.streamId)})}catch(F){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),F.toString()),G(new Me(te.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=P,Gv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&kW(e.screen.mediaSource);const P={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:N,surfaceSwitching:G,systemAudio:F,preferCurrentTab:j}=e.screen,q={selfBrowserSurface:N,surfaceSwitching:G,systemAudio:F,preferCurrentTab:j};!N&&delete q.selfBrowserSurface,!G&&delete q.surfaceSwitching,!F&&delete q.systemAudio,!j&&delete q.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:e.screenAudio,controls:q})),Gv(c,await navigator.mediaDevices.getDisplayMedia(Nr({video:P,audio:e.screenAudio},q)))}else{if(!jr())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new Me(te.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&kW(e.screen.mediaSource);const P={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),Gv(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},E=oe("MEDIA_DEVICE_CONSTRAINTS");if(E)try{typeof E=="string"&&(E=JSON.parse(E)),_=Hx(_,E)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(_)),Dn();let S,R=null;(Is()||No()||NA())&&(R=await fL.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(P){throw R&&R(),P}return _.audio&&(WW=!0),_.video&&(zW=!0),Gv(c,S),R&&R(),c}function $A(e,r){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Me(te.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Me(te.DEVICE_NOT_FOUND,"".concat(e,": ").concat(r));case"NotSupportedError":return new Me(te.NOT_SUPPORTED,"".concat(e,": ").concat(r));case"NotReadableError":return new Me(te.NOT_READABLE,"".concat(e,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Me(te.PERMISSION_DENIED,"".concat(e,": ").concat(r));case"ConstraintNotSatisfiedError":return new Me(te.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(r));default:return x.error("getUserMedia unexpected error",e),new Me(te.UNEXPECTED_ERROR,"".concat(e,": ").concat(r))}}function Gv(e,r){const i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(i&&e.removeTrack(i),e.addTrack(c))}const Qc=new class extends Mr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(U_.STATE_CHANGE,e),this._state=e)}constructor(){super(),Ae(this,"_state",RT.IDLE),Ae(this,"isAccessMicrophonePermission",!1),Ae(this,"isAccessCameraPermission",!1),Ae(this,"lastAccessMicrophonePermission",!1),Ae(this,"lastAccessCameraPermission",!1),Ae(this,"checkdeviceMatched",!1),Ae(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(oe("ENUMERATE_DEVICES_INTERVAL")||(DA()||kA()===Ki.HARMONY_OS)&&qp())&&this.updateDevicesInfo()},oe("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>x.error(e.toString()))}async enumerateDevices(e,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Me(te.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,_=null,E=null;if(!i&&(u||h)){if(fL.isLocked&&(x.debug("[device manager] wait GUM lock"),(await fL.lock())(),x.debug("[device manager] GUM unlock")),WW&&(u=!1,this.isAccessMicrophonePermission=!0),zW&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",e,r,u,h),u&&h){try{E=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=$A(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const R=$A(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const R=$A(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",e,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),m=null,_=null,E=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),m=null,_=null,E=null,new Me(te.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(e){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(r=i.device.deviceId)}),r}async getDeviceById(e){const r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!r)throw new Me(te.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=RT.INITING;try{await this.updateDevicesInfo(),this.state=RT.INITEND}catch(e){throw x.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=RT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Me(te.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):x.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",i.push(c))}),this.state!==RT.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(U_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(U_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(U_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const r=e.filter(c=>c.kind==="audioinput"),i=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){o.video=!0;break}return o}};let mL=!1;const Zc=new class extends Mr{constructor(){super(...arguments),Ae(this,"onAutoplayFailed",void 0),Ae(this,"onAudioAutoplayFailed",void 0)}};function GW(){if(Dn(),!mL){const e=r=>{r.preventDefault(),mL=!1,_T()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};mL=!0,_T()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Zc.onAutoplayFailed?Zc.onAutoplayFailed():Zc.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Zc.emit("autoplay-failed")}}function HW(e,r,i,o){if(!e)return;const c=At.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),m=Nr(Nr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Zc.onAutoplayFailed||Zc.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:o,extend:void 0});At.send({type:kr.AUTOPLAY_FAILED,data:m},!0)}const Dfe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ua=new class{constructor(){Ae(this,"onAutoplayFailed",void 0),Ae(this,"elementMap",new Map),Ae(this,"elementStateMap",new Map),Ae(this,"elementsNeedToResume",[]),Ae(this,"sinkIdMap",new Map),Ae(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,o]=r;const c=this.elementStateMap.get(i),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if(ir.curState==="running")return Ov()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Ae(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,i]=e;const o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),ir.on(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ir.on(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),ir.on(fs.STATE_CHANGE,()=>{No()&&ir.prevState==="suspended"&&ir.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,r){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,r),i)try{await i.setSinkId(r)}catch(o){throw new Me(te.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,r,i,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,po.INIT),this.setVolume(r,i);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&HW(o,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),LA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),GW()}))})}updateTrack(e,r){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([r]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,r){const i=this.elementMap.get(e);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}stop(e){const r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!r)return;const i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,r){Dfe.forEach(i=>{r.addEventListener(i,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(x.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{x.debug("Auto resume audio element success")}).catch(i=>{x.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new ut(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{_T()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function si(){return function(e,r,i){const o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new Me(te.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof ut?new ut((_,E)=>{m.then(_).catch(E)}):m}),i}}class $W extends Mr{constructor(r){super(),Ae(this,"name","VideoProcessorDestination"),Ae(this,"ID","0"),Ae(this,"_source",void 0),Ae(this,"videoContext",void 0),Ae(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Me(te.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Me(te.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Do.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Do.ON_TRACK,void 0)}}class KW extends Mr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),Ae(this,"constraintsMap",new Map),Ae(this,"statsRegistry",[]),Ae(this,"usageRegistry",[]),Ae(this,"trackId",void 0),Ae(this,"direction",void 0),Ae(this,"_chained",!1),this.trackId=r,this.direction=i}async getConstraints(){return await Ps(this,Yc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,i){var o;return x.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),ur(this,Yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(zc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),ur(this,Yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(zc(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){x.error(new Me(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof ut&&(o=await o),r.push(Nr(Nr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class qW extends Mr{constructor(r){super(),Ae(this,"name","AudioProcessorDestination"),Ae(this,"ID","0"),Ae(this,"inputTrack",void 0),Ae(this,"inputNode",void 0),Ae(this,"audioProcessorContext",void 0),Ae(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Me(te.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Me(te.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Do.ON_TRACK,void 0),this.emit(Do.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Do.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Do.ON_NODE,this.inputNode))}}class YW extends Mr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,o){super(),Ae(this,"constraintsMap",new Map),Ae(this,"statsRegistry",[]),Ae(this,"audioContext",void 0),Ae(this,"trackId",void 0),Ae(this,"direction",void 0),Ae(this,"usageRegistry",[]),Ae(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=o}async getConstraints(){return Ps(this,Yc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,i){var o;return x.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),ur(this,Yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(zc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),ur(this,Yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(zc(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){x.error(new Me(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof ut&&(o=await o),r.push(Nr(Nr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class gL extends Mr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Ae(this,"context",void 0),Ae(this,"processSourceNode",void 0),Ae(this,"outputTrack",void 0),Ae(this,"processedNode",void 0),Ae(this,"clonedTrack",void 0),Ae(this,"outputNode",void 0),this.outputNode=new xfe}setVolume(){}createOutputTrack(){throw new Me(te.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class xfe{disconnect(){}connect(){}}function XW(e){return new ut((r,i)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=No()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&jr()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(MA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function KA(e){const r={};e.facingMode&&(r.facingMode=e.facingMode),e.cameraId&&(r.deviceId={exact:e.cameraId});const i=_h(e.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!q8()&&i.frameRate&&(r.frameRate=i.frameRate),j8()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),jr()&&(r.frameRate={ideal:30,max:30}),r}function JW(e){const r={};return q8()||(e.AGC!==void 0&&(r.autoGainControl=e.AGC),e.AEC!==void 0&&(r.echoCancellation=e.AEC),e.ANS!==void 0&&(r.noiseSuppression=e.ANS,Kp()&&e.ANS&&(r.googHighpassFilter=e.ANS))),r}function QW(e){const r=JW(e);if(e.encoderConfig){const i=GA(e.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return e.microphoneId&&(r.deviceId={exact:e.microphoneId}),DA()&&(r.sampleRate=void 0),r}const Lfe=e=>{const r=e._encoderConfig;if(!r)return;const{frameRate:i,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=o,height:m=c}=r;if(!u||!h||!m)return;h=$x(h),m=$x(m),u=$x(u);const{max:_,min:E}=function(N,G,F){const j=200*Math.pow(F/15,.6)*Math.pow(N*G/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(h,m,u),{bitrateMax:S,bitrateMin:R}=r||{};S||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:P}=oe("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:S||_,bitrateMin:R||E,scaleResolutionDownBy:1,scale:0}},ZW=async(e,r,i)=>await(async(o,c,u)=>{const h=function(E){const S=[];for(let R=0;R<E.length;R+=2)S.push(parseInt(E.slice(R,R+2),16));return Uint8Array.from(S)}(uW(""+c+u)).slice(0,16),m=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,o))})(e.buffer,r,i),_L=e=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new ut((i,o)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await ez(c);i({buffer:u,width:r.width,height:r.height})}else o(new Me(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},ez=async e=>{const r=await e.arrayBuffer();return new Uint8Array(r)};var tz,nz,rz,iz,sz,oz,az,cz,lz,uz,dz,hz,pz,fz,mz,gz,_z,yz,Ur,Ez,vz,Sz,bz,Tz,wz,Eh,Cz,Rz,Iz,Az,Pz,Oz,kz,Nz,Dz,xz,Lz,Mz,Uz,ks;let qr=(tz=jt({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),nz=jt({argsMap:(e,r)=>[e.getTrackId(),r]}),rz=si(),iz=Dv("LocalAudioTrack","_enabledMutex"),sz=jt({argsMap:(e,r)=>[e.getTrackId(),r]}),oz=si(),az=Dv("LocalAudioTrack","_enabledMutex"),cz=jt({argsMap:(e,r)=>[e.getTrackId(),r]}),lz=si(),uz=si(),dz=si(),hz=jt({argsMap:e=>[e.getTrackId()]}),pz=si(),fz=jt({argsMap:e=>[e.getTrackId()]}),mz=si(),gz=jt({argsMap:e=>[e.getTrackId()]}),_z=jt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),yz=jt({argsMap:e=>[e.getTrackId()]}),Ln((Ur=class extends Wv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ua.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,r,i,o){super(e,i),Ae(this,"trackMediaType",Bv.AUDIO),Ae(this,"_encoderConfig",void 0),Ae(this,"_trackSource",void 0),Ae(this,"metadata",[]),Ae(this,"_enabled",!0),Ae(this,"_volume",100),Ae(this,"_useAudioElement",!0),Ae(this,"_bypassWebAudio",!1),Ae(this,"processor",void 0),Ae(this,"_processorContext",void 0),Ae(this,"_processorDestination",void 0),Ae(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new gL,oe("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),oe("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Is()&&!Xc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){or(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ua.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,ur(this,bt.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!PW())throw new Me(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ua.setSinkID(this.getTrackId(),e)}async setEnabled(e,r,i){return this._setEnabled(e,r,i)}async _setEnabled(e,r,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await ur(this,bt.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await ur(this,bt.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await ur(this,bt.NEED_MUTE_TRACK,this):await ur(this,bt.NEED_UNMUTE_TRACK,this))}getStats(){return Lm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Hc(this,bt.GET_STATS)||Nr({},lL)}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(qc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(qc.ON_AUDIO_BUFFER),this._source.on(qc.ON_AUDIO_BUFFER,i=>e(i))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ua.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ua.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ua.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,r){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,bt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ut.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Me(te.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Me(te.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(e){e.on(Do.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await ur(this,bt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,bt.NEED_REPLACE_TRACK,this))}),e.on(Do.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Do.ON_TRACK),e.removeAllListeners(Do.ON_NODE)}bindProcessorContextEvents(e){e.on(Yc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Yc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof gL&&(this._trackSource=new FW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new YW(this._source.context,this.getTrackId(),"local"),r=new qW(e);return this._processorContext=e,this._processorDestination=r,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(r),this._source.on(qc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ua.stop(this.getTrackId()),this._source.play()),ur(this,bt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:r}}}).prototype,"setVolume",[tz],Object.getOwnPropertyDescriptor(Ur.prototype,"setVolume"),Ur.prototype),Ln(Ur.prototype,"setPlaybackDevice",[nz,rz],Object.getOwnPropertyDescriptor(Ur.prototype,"setPlaybackDevice"),Ur.prototype),Ln(Ur.prototype,"setEnabled",[iz,sz,oz],Object.getOwnPropertyDescriptor(Ur.prototype,"setEnabled"),Ur.prototype),Ln(Ur.prototype,"setMuted",[az,cz,lz],Object.getOwnPropertyDescriptor(Ur.prototype,"setMuted"),Ur.prototype),Ln(Ur.prototype,"getStats",[uz],Object.getOwnPropertyDescriptor(Ur.prototype,"getStats"),Ur.prototype),Ln(Ur.prototype,"setAudioFrameCallback",[dz],Object.getOwnPropertyDescriptor(Ur.prototype,"setAudioFrameCallback"),Ur.prototype),Ln(Ur.prototype,"play",[hz,pz],Object.getOwnPropertyDescriptor(Ur.prototype,"play"),Ur.prototype),Ln(Ur.prototype,"stop",[fz,mz],Object.getOwnPropertyDescriptor(Ur.prototype,"stop"),Ur.prototype),Ln(Ur.prototype,"close",[gz],Object.getOwnPropertyDescriptor(Ur.prototype,"close"),Ur.prototype),Ln(Ur.prototype,"pipe",[_z],Object.getOwnPropertyDescriptor(Ur.prototype,"pipe"),Ur.prototype),Ln(Ur.prototype,"unpipe",[yz],Object.getOwnPropertyDescriptor(Ur.prototype,"unpipe"),Ur.prototype),Ur),qA=(Ez=jt({argsMap:(e,r)=>[e.getTrackId(),r]}),vz=si(),Sz=Dv("MicrophoneAudioTrack","_enabledMutex"),bz=jt({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),Tz=si(),wz=jt({argsMap:e=>[e.getTrackId()]}),Ln((Eh=class extends qr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,r,i,o){super(e,r.encoderConfig?GA(r.encoderConfig):{},o,oe("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Ae(this,"_config",void 0),Ae(this,"_deviceName","default"),Ae(this,"_constraints",void 0),Ae(this,"_originalConstraints",void 0),Ae(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Ov()||Vx())&&ir.bindInterruptDetectorTrack(this)}async setDevice(e){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const r=await Qc.getDeviceById(e),i={};i.audio=Nr({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await Jc(i,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await Jc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Qc.getDeviceById(e);this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,r,i){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),e),oe("AUTO_RESET_AUDIO_ROUTE")&&(No()||gu())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await ur(this,bt.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Nr({},this._constraints),u=Qc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await Jc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await ur(this,bt.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Ov()||Vx())&&ir.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((No()||gu())&&this._enabled&&!this._isClosed&&ir.duringInterruption){const e=async()=>{ir.off(fs.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ir.on(fs.IOS_INTERRUPTION_END,e)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Fv.TRACK_ENDED)}async renewMediaStreamTrack(e){const r=e||this._constraints,i=Qc.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await Jc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Yc.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Yc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Ez,vz],Object.getOwnPropertyDescriptor(Eh.prototype,"setDevice"),Eh.prototype),Ln(Eh.prototype,"setEnabled",[Sz,bz,Tz],Object.getOwnPropertyDescriptor(Eh.prototype,"setEnabled"),Eh.prototype),Ln(Eh.prototype,"close",[wz],Object.getOwnPropertyDescriptor(Eh.prototype,"close"),Eh.prototype),Eh),Mfe=(Cz=jt({argsMap:(e,r)=>[e.getTrackId(),r,e.duration]}),Rz=si(),Iz=jt({argsMap:e=>[e.getTrackId()]}),Az=si(),Pz=jt({argsMap:e=>[e.getTrackId()]}),Oz=si(),kz=jt({argsMap:e=>[e.getTrackId()]}),Nz=si(),Dz=jt({argsMap:e=>[e.getTrackId()]}),xz=si(),Lz=jt({argsMap:e=>[e.getTrackId()]}),Mz=jt({argsMap:e=>[e.getTrackId()]}),Uz=si(),Ln((ks=class extends qr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,r,i,o){super(r.createOutputTrack(),i,o),Ae(this,"source",void 0),Ae(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=r,this._bufferSource.on(qc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Fv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){or(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Cz,Rz],Object.getOwnPropertyDescriptor(ks.prototype,"startProcessAudioBuffer"),ks.prototype),Ln(ks.prototype,"pauseProcessAudioBuffer",[Iz,Az],Object.getOwnPropertyDescriptor(ks.prototype,"pauseProcessAudioBuffer"),ks.prototype),Ln(ks.prototype,"seekAudioBuffer",[Pz,Oz],Object.getOwnPropertyDescriptor(ks.prototype,"seekAudioBuffer"),ks.prototype),Ln(ks.prototype,"resumeProcessAudioBuffer",[kz,Nz],Object.getOwnPropertyDescriptor(ks.prototype,"resumeProcessAudioBuffer"),ks.prototype),Ln(ks.prototype,"stopProcessAudioBuffer",[Dz,xz],Object.getOwnPropertyDescriptor(ks.prototype,"stopProcessAudioBuffer"),ks.prototype),Ln(ks.prototype,"close",[Lz],Object.getOwnPropertyDescriptor(ks.prototype,"close"),ks.prototype),Ln(ks.prototype,"setAudioBufferPlaybackSpeed",[Mz,Uz],Object.getOwnPropertyDescriptor(ks.prototype,"setAudioBufferPlaybackSpeed"),ks.prototype),ks);class Li extends qr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=zv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,dr(8,"track-mix-")),Ae(this,"trackList",void 0),Ae(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}xA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof Li?i.emit(M_.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}}class Ufe extends VW{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(qc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ae(this,"audioBuffer",void 0),Ae(this,"sourceNode",void 0),Ae(this,"startPlayTime",0),Ae(this,"startPlayOffset",0),Ae(this,"pausePlayTime",0),Ae(this,"options",void 0),Ae(this,"currentLoopCount",0),Ae(this,"currentPlaybackSpeed",100),Ae(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Vz=new Map;class yL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var i;r!==this._videoState&&(this._videoState=r,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(r){Ae(this,"trackId",void 0),Ae(this,"config",void 0),Ae(this,"onFirstVideoFrameDecoded",void 0),Ae(this,"onVideoStateChanged",void 0),Ae(this,"freezeTimeCounterList",[]),Ae(this,"renderFreezeAccTime",0),Ae(this,"isKeepLastFrame",!1),Ae(this,"timeUpdatedCount",0),Ae(this,"freezeTime",0),Ae(this,"playbackTime",0),Ae(this,"lastTimeUpdatedTime",0),Ae(this,"autoplayFailed",!1),Ae(this,"videoTrack",void 0),Ae(this,"videoElement",void 0),Ae(this,"cacheVideoElement",void 0),Ae(this,"renderStats",void 0),Ae(this,"_videoState",yh.VideoStateStopped),Ae(this,"videoElementCheckInterval",void 0),Ae(this,"videoElementFreezeTimeout",void 0),Ae(this,"_videoElementStatus",po.NONE),Ae(this,"isGettingVideoDimensions",!1),Ae(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Ae(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&ir.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(F8())),$8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Ae(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=po.PLAYING;break;case"loadeddata":if(this.videoState=yh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=po.CANPLAY;break;case"stalled":this.videoElementStatus=po.STALLED;break;case"suspend":this.videoElementStatus=po.SUSPEND;break;case"pause":this.videoElementStatus=po.PAUSED,No()||gu()||Is()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=po.WAITING;break;case"abort":this.videoElementStatus=po.ABORT;break;case"ended":this.videoElementStatus=po.ENDED;break;case"emptied":this.videoElementStatus=po.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=po.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,Jp.lastVisibleTime<Jp.lastHiddenTime||u<Jp.lastHiddenTime||u<Jp.lastVisibleTime)return;for(c>oe("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Ae(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(F8())),$8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),ir.on(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ir.on(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{r&&HW(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Dn();if((o.name==="Safari"&&Number(o.version)===15||Ov())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");if(!i)return x.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);const o=i.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new ut((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const _=await ez(m);u({buffer:_,width:o.width,height:o.height})}else h(new Me(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,i<0?.1:i>1?1:i)})):await _L(r)}destroy(){this.renderStats=void 0,ir.off(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ir.off(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=yh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=po.INIT,!this.videoElementCheckInterval&&(Fz.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=po.DESTROYED)},1e3),oe("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===yh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=yh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(E,S)=>{if(this.videoElementStatus===po.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const N=S.presentationTime-u.presentationTime;this.videoState===yh.VideoStateStarting&&(this.videoState=yh.VideoStateDecoding),this.videoState===yh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION"))),N<oe("VIDEO_FREEZE_DURATION")&&this.videoState===yh.VideoStateFrozen&&(this.videoState=yh.VideoStateDecoding),N>oe("VIDEO_FREEZE_DURATION")&&Jp.lastVisibleTime>=Jp.lastHiddenTime&&u.timestamp>Jp.lastVisibleTime&&u.timestamp>Jp.lastHiddenTime&&(this.renderFreezeAccTime+=N)}u=Nr(Nr({},S),{},{timestamp:E})}var R,P;oe("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,_))};(r=(i=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(i,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),DA()&&!oe("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Dn();o.name==="Safari"&&Number(o.version)===15||Ov()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,jr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,jr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{x.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){Fz.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=po.NONE}handleAutoPlayFailed(){const r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{x.error(o)}),this.autoplayFailed=!1,_T()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};_T()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),GW()}}const Fz=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class jz extends yL{constructor(r){super(r),Ae(this,"container",void 0),Ae(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const i=r.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await _L(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",oe("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Bz,Wz,zz,Gz,Hz,$z,Kz,qz,Yz,Xz,Jz,Qz,Zz,eG,tG,nG,rG,iG,sG,oG,aG,cG,lG,uG,Pn,dG,hG,pG,fG,mG,gG,_G,yG,el;let br=(Bz=jt({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),Wz=si(),zz=jt({argsMap:e=>[e.getTrackId()]}),Gz=Dv("LocalVideoTrack","_enabledMutex"),Hz=jt({argsMap:(e,r)=>[e.getTrackId(),r]}),$z=si(),Kz=Dv("LocalVideoTrack","_enabledMutex"),qz=jt({argsMap:(e,r)=>[e.getTrackId(),r]}),Yz=si(),Xz=jt({argsMap:(e,r)=>[e.getTrackId(),r]}),Jz=si(),Qz=si(),Zz=jt({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),eG=si(),tG=si(),nG=si(),rG=si(),iG=si(),sG=si(),oG=si(),aG=jt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),cG=jt({argsMap:e=>[e.getTrackId()]}),lG=jt({argsMap:e=>[e.getTrackId()]}),uG=jt({argsMap:(e,r,i)=>[e.getTrackId(),r.label,i]}),Pn=class boe extends Wv{get videoHeight(){if(Is()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Is()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==po.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,o,c,u,h){if(super(r,u),Ae(this,"trackMediaType",Bv.VIDEO),Ae(this,"_player",void 0),Ae(this,"isUseScaleResolutionDownBy",!1),Ae(this,"_videoVisibleTimer",null),Ae(this,"_previousVideoVisibleStatus",void 0),Ae(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ae(this,"_encoderConfig",void 0),Ae(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Ae(this,"_optimizationMode",void 0),Ae(this,"_videoHeight",void 0),Ae(this,"_videoWidth",void 0),Ae(this,"_forceBitrateLimit",void 0),Ae(this,"_enabled",!0),Ae(this,"_processorDestination",void 0),Ae(this,"_processorContext",void 0),Is()){const{width:m,height:_}=r.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(hr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(Lx(Gn.CHROME,115)&&kA().indexOf("Windows")!==-1){const m=function(_,E){if("VideoFrame"in window&&"TransformStream"in window&&jn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),R=new MediaStreamTrackGenerator({kind:"video"});let P,N,G=Date.now();const F=()=>{j&&(clearInterval(j),j=void 0),P&&(P.close(),P=void 0),_.stop(),N=void 0,R.removeEventListener("ended",F)};let j=window.setInterval(()=>{if(N&&P&&Date.now()-G>1e3)try{R.readyState==="live"?N.enqueue(P.clone()):F()}catch{F()}},1e3);const q=new TransformStream({transform:(ee,he)=>{R.readyState==="live"?(N=he,G=Date.now(),P===void 0?(P=ee,he.enqueue(ee.clone())):(he.enqueue(P),P=ee)):ee.close()}});return R.addEventListener("ended",F),S.readable.pipeThrough(q).pipeTo(R.writable),R}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}i&&this._hints.indexOf(hr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new KW(this.getTrackId(),"local"),this._processorDestination=new $W(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const o=Nr(Nr(Nr({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new yL(o):this._player=new jz(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Fv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await ur(this,bt.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await ur(this,bt.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await ur(this,bt.NEED_MUTE_TRACK,this):await ur(this,bt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,i){if(!this._enabled)throw new Me(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=_h(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=KA({encoderConfig:r});(Is()||No()||gu())&&(o.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Me(te.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ur(this,bt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(x)}}getStats(){return Lm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Hc(this,bt.GET_STATS)||Nr({},uL)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await _L(r)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(te.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=r,await ur(this,bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(te.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){XW(this._originMediaStreamTrack).then(r=>{let[i,o]=r;this._videoHeight=o,this._videoWidth=i}).catch(MA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Me(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=_h(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ur(this,bt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!i||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(_,E,S,R,P){const N=oe("BITRATE_ADAPTER_TYPE");if(N==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var G;const j=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*E/640/360,.75));P=N==="STANDARD_BITRATE"?4*j:2*j,R=(G=R)!==null&&G!==void 0?G:j}else{var F;R=(F=R)!==null&&F!==void 0?F:Math.floor(P/10)}return{min:R,max:P}}(r,i,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,i;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=J8.checkOneElementVisible(u),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const E=At.reportApiInvoke(null,{tag:Wr.TRACER,name:Ri.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new Me(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Me(te.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Nr(Nr({},o),_h(r))),o=N_(o);const c=dr(8,"track-video-cloned-"),u=new boe(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,N_(this._scalabilityMode),this._optimizationMode,c,N_(this._hints));return r&&o&&u.setEncoderConfiguration(o),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new Me(te.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Me(te.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Lm(()=>{At.reportApiInvoke(null,{name:Ri.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Wr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!oe("ENABLE_VIDEO_SEI")||!oe("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Me(te.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void x.warning("Video track is not published, SEI can not be send");const o=i.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Do.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await ur(this,bt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,bt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Do.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Yc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Yc.REQUEST_CONSTRAINTS)}},Ln(Pn.prototype,"play",[Bz,Wz],Object.getOwnPropertyDescriptor(Pn.prototype,"play"),Pn.prototype),Ln(Pn.prototype,"stop",[zz],Object.getOwnPropertyDescriptor(Pn.prototype,"stop"),Pn.prototype),Ln(Pn.prototype,"setEnabled",[Gz,Hz,$z],Object.getOwnPropertyDescriptor(Pn.prototype,"setEnabled"),Pn.prototype),Ln(Pn.prototype,"setMuted",[Kz,qz,Yz],Object.getOwnPropertyDescriptor(Pn.prototype,"setMuted"),Pn.prototype),Ln(Pn.prototype,"setEncoderConfiguration",[Xz,Jz],Object.getOwnPropertyDescriptor(Pn.prototype,"setEncoderConfiguration"),Pn.prototype),Ln(Pn.prototype,"getStats",[Qz],Object.getOwnPropertyDescriptor(Pn.prototype,"getStats"),Pn.prototype),Ln(Pn.prototype,"setBeautyEffect",[Zz,eG],Object.getOwnPropertyDescriptor(Pn.prototype,"setBeautyEffect"),Pn.prototype),Ln(Pn.prototype,"getCurrentFrameData",[tG],Object.getOwnPropertyDescriptor(Pn.prototype,"getCurrentFrameData"),Pn.prototype),Ln(Pn.prototype,"getCurrentFrameImage",[nG],Object.getOwnPropertyDescriptor(Pn.prototype,"getCurrentFrameImage"),Pn.prototype),Ln(Pn.prototype,"setBitrateLimit",[rG],Object.getOwnPropertyDescriptor(Pn.prototype,"setBitrateLimit"),Pn.prototype),Ln(Pn.prototype,"setOptimizationMode",[iG],Object.getOwnPropertyDescriptor(Pn.prototype,"setOptimizationMode"),Pn.prototype),Ln(Pn.prototype,"setScalabiltyMode",[sG],Object.getOwnPropertyDescriptor(Pn.prototype,"setScalabiltyMode"),Pn.prototype),Ln(Pn.prototype,"updateMediaStreamTrackResolution",[oG],Object.getOwnPropertyDescriptor(Pn.prototype,"updateMediaStreamTrackResolution"),Pn.prototype),Ln(Pn.prototype,"pipe",[aG],Object.getOwnPropertyDescriptor(Pn.prototype,"pipe"),Pn.prototype),Ln(Pn.prototype,"unpipe",[cG],Object.getOwnPropertyDescriptor(Pn.prototype,"unpipe"),Pn.prototype),Ln(Pn.prototype,"close",[lG],Object.getOwnPropertyDescriptor(Pn.prototype,"close"),Pn.prototype),Ln(Pn.prototype,"replaceTrack",[uG],Object.getOwnPropertyDescriptor(Pn.prototype,"replaceTrack"),Pn.prototype),Pn),EL=(dG=jt({argsMap:(e,r)=>[e.getTrackId(),r]}),hG=si(),pG=Dv("CameraVideoTrack","_enabledMutex"),fG=jt({argsMap:(e,r)=>[e.getTrackId(),r]}),mG=si(),gG=jt({argsMap:(e,r)=>[e.getTrackId(),r]}),_G=si(),yG=jt({argsMap:e=>[e.getTrackId()]}),el=class Toe extends br{get __className__(){return"CameraVideoTrack"}constructor(r,i,o,c,u,h){super(r,_h(i.encoderConfig),c,u,h),Ae(this,"_config",void 0),Ae(this,"_originalConstraints",void 0),Ae(this,"_constraints",void 0),Ae(this,"_enabled",!0),Ae(this,"_deviceName","default"),Ae(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Ov()||Vx())&&!function(){const m=Dn();if(m.os!==Ki.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&K8()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=_h(this._config.encoderConfig),ir.on(fs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ir.on(fs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await Qc.getDeviceById(r),o={};o.video=Nr({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Jc(o,this.getTrackId())}catch(u){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Jc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Qc.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const i={video:Nr(Nr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await Jc(i,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await Jc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Nr({},i.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await Jc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await ur(this,bt.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await ur(this,bt.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new Me(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=_h(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=zr(this._config);o.encoderConfig=r;const c=KA(o);(Is()||No()||gu())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Me(te.UNEXPECTED_ERROR,u.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ur(this,bt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((No()||gu())&&this._enabled&&!this._isClosed&&ir.duringInterruption){const r=async()=>{ir.off(fs.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ir.on(fs.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Fv.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,o=Qc.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){const c=await Jc({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),ir.off(fs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ir.off(fs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Nr(Nr({},o),_h(r))),o=N_(o);const c=dr(8,"track-cam-cloned-"),u=new Toe(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,N_(Nr(Nr({},this._config),{},{encoderConfig:o})),N_(this._constraints),N_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&u.setEncoderConfiguration(o),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(Yc.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}}),this.processorContext.on(Yc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Ln(el.prototype,"setDevice",[dG,hG],Object.getOwnPropertyDescriptor(el.prototype,"setDevice"),el.prototype),Ln(el.prototype,"setEnabled",[pG,fG,mG],Object.getOwnPropertyDescriptor(el.prototype,"setEnabled"),el.prototype),Ln(el.prototype,"setEncoderConfiguration",[gG,_G],Object.getOwnPropertyDescriptor(el.prototype,"setEncoderConfiguration"),el.prototype),Ln(el.prototype,"close",[yG],Object.getOwnPropertyDescriptor(el.prototype,"close"),el.prototype),el);function vL(e,r,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=Nr(Nr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?x.debug("[".concat(e,"] set content hint to"),i.optimizationMode):x.debug("[".concat(e,"] set content hint failed")))):x.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var EG,vG,SG,bG,Al,TG,wG,CG,RG,IG,AG,fo;class PG extends LW{getUserId(){return this._userId}constructor(r,i,o,c){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(dr(5,""))),Ae(this,"_userId",void 0),Ae(this,"_uintId",void 0),Ae(this,"_isDestroyed",!1),Ae(this,"store",void 0),Ae(this,"processor",void 0),Ae(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Hv=(EG=jt({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),vG=jt({argsMap:e=>[e.getTrackId()]}),SG=jt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),bG=jt({argsMap:e=>[e.getTrackId()]}),Ln((Al=class extends PG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==po.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,r,i,o){super(e,r,i,o),Ae(this,"_videoVisibleTimer",null),Ae(this,"_previousVideoVisibleStatus",void 0),Ae(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ae(this,"trackMediaType",Bv.VIDEO),Ae(this,"_videoWidth",void 0),Ae(this,"_videoHeight",void 0),Ae(this,"_player",void 0),Ae(this,"processorDestination",void 0),Ae(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new KW(this.getTrackId(),"remote"),this.processorDestination=new $W(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Lm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Hc(this,bt.GET_STATS)||Nr({},DW)}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const i=Nr(Nr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new yL(i):this._player=new jz(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(jv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(jv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(jv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){XW(this._originMediaStreamTrack).then(e=>{let[r,i]=e;this._videoHeight=i,this._videoWidth=r}).catch(MA)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,r;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=J8.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=At.reportApiInvoke(null,{tag:Wr.TRACER,name:Ri.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new Me(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Me(te.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Do.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Do.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(M_.SEI_RECEIVED,e)}}).prototype,"play",[EG],Object.getOwnPropertyDescriptor(Al.prototype,"play"),Al.prototype),Ln(Al.prototype,"stop",[vG],Object.getOwnPropertyDescriptor(Al.prototype,"stop"),Al.prototype),Ln(Al.prototype,"pipe",[SG],Object.getOwnPropertyDescriptor(Al.prototype,"pipe"),Al.prototype),Ln(Al.prototype,"unpipe",[bG],Object.getOwnPropertyDescriptor(Al.prototype,"unpipe"),Al.prototype),Al),$v=(TG=jt({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),wG=jt({argsMap:(e,r)=>[e.getTrackId(),r]}),CG=jt({argsMap:e=>[e.getTrackId()]}),RG=jt({argsMap:e=>[e.getTrackId()]}),IG=jt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),AG=jt({argsMap:e=>[e.getTrackId()]}),Ln((fo=class extends PG{get isPlaying(){return this._useAudioElement?ua.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,r,i,o){super(e,r,i,o),Ae(this,"trackMediaType",Bv.AUDIO),Ae(this,"_source",void 0),Ae(this,"_useAudioElement",!0),Ae(this,"_volume",100),Ae(this,"processorContext",void 0),Ae(this,"processorDestination",void 0),Ae(this,"_played",!1),Ae(this,"_bypassWebAudio",!1),oe("DISABLE_WEBAUDIO")?(this._source=new gL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new FW(e,!0),oe("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(qc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(jv.FIRST_FRAME_DECODED)}),this.processorContext=new YW(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new qW(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(qc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(qc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(qc.ON_AUDIO_BUFFER),this._source.on(qc.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?ua.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!PW())throw new Me(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ua.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Lm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Hc(this,bt.GET_STATS)||Nr({},NW)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),ua.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ua.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ua.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Me(te.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Me(te.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Me(te.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Do.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Do.ON_NODE,e=>{this._source.processedNode=e;const r=!e;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Do.ON_TRACK),this.processorDestination.removeAllListeners(Do.ON_NODE)}}).prototype,"setVolume",[TG],Object.getOwnPropertyDescriptor(fo.prototype,"setVolume"),fo.prototype),Ln(fo.prototype,"setPlaybackDevice",[wG],Object.getOwnPropertyDescriptor(fo.prototype,"setPlaybackDevice"),fo.prototype),Ln(fo.prototype,"play",[CG],Object.getOwnPropertyDescriptor(fo.prototype,"play"),fo.prototype),Ln(fo.prototype,"stop",[RG],Object.getOwnPropertyDescriptor(fo.prototype,"stop"),fo.prototype),Ln(fo.prototype,"pipe",[IG],Object.getOwnPropertyDescriptor(fo.prototype,"pipe"),fo.prototype),Ln(fo.prototype,"unpipe",[AG],Object.getOwnPropertyDescriptor(fo.prototype,"unpipe"),fo.prototype),fo);const Jp=new class extends Mr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Ae(this,"_lastHiddenTime",0),Ae(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class OG extends Mr{constructor(r,i){super(),Ae(this,"trackMediaType",Bv.DATA),Ae(this,"_version",1),Ae(this,"_type",3),Ae(this,"_config",void 0),Ae(this,"_originDataChannel",void 0),Ae(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Ae(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Ae(this,"_datachannelEventMap",new Map),this._config=r,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return oe("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ut((r,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;i(new Me(te.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Me(te.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new Me(te.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[HA.OPEN,HA.CLOSE,HA.ERROR].forEach(i=>{const o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),r.addEventListener(i,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,c]=i;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class Vfe extends OG{constructor(r){super(r),Ae(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(oe("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(HA.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Ffe extends OG{send(r){if(this._originDataChannel){let i=r;i=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function YA(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>YI.revokeObjectURL(e),0),new Worker(YI.createObjectURL(e))}const kG=71,SL=1,bL=2,TL=1,NG=2;var Qp=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Qp||{});function DG(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==kG)return;const o=e.getUint16(1),c=SL+bL+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:i,tlvLen:o,tlv:[],frame:u};let m=SL+bL;for(;m<c;){const _=e.getUint8(m),E=e.getUint16(m+TL),S=TL+NG;if(_===Qp.AUDIO_LEVEL){let R=e.getUint8(m+S);for(let P=1;P<E;P++)R=R<<8|e.getUint8(m+S+P);h.tlv.push({tag:_,length:E,value:r?127^R>>1:127&R})}else if(_===Qp.METADATA||_===Qp.AUDIO_64_BIT_PTS){const R=new Uint8Array(E);for(let P=0;P<E;P++)R[P]=e.getUint8(m+S+P);h.tlv.push({tag:_,length:E,value:R})}m+=S+E}return h}const XA=new Map,JA=127,F_=1e-10,wL=139/13,QA=new Map;function CL(e,r,i){const o="".concat(e,"-").concat(r,"-").concat(i);let c=0;return QA.has(o)?c=QA.get(o):(c=Math.log(function(h,m){const _=h-m;m<_&&(m=_);let E=1;for(let S=h,R=1;S>m;S--,R++)E=E*S/R;return E}(r,e))+e*Math.log(.5)+(r-e)*Math.log(1-.5)-Math.log(i)+i*e,QA.set(o,c)),c<F_&&(c=F_),c}function xG(e,r,i){const o=r.length,c=e.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let _=0;for(let E=m+c;m<E;m++)e[m]>i&&_++;r[h]!==_&&(r[h]=_,u=!0)}return u}window.cache=QA;let jfe=0;class LG{constructor(r){Ae(this,"id",void 0),Ae(this,"immediates",[]),Ae(this,"lastNonSilence",-1),Ae(this,"immediateSpeechActivityScore",F_),Ae(this,"lastLevelChangedTime",Date.now()),Ae(this,"levels",[]),Ae(this,"longs",[]),Ae(this,"longSpeechActivityScore",F_),Ae(this,"mediums",[]),Ae(this,"mediumSpeechActivityScore",F_),Ae(this,"minLevel",0),Ae(this,"nextMinLevel",0),Ae(this,"nextMinLevelWindowLength",0),Ae(this,"energyScore",0),this.id=r||"".concat(jfe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,i=this.levels,o=this.minLevel+wL;let c=!1;for(let u=0;u<r.length;++u){let h=i[u];h<o&&(h=0);const m=Math.floor(h/wL);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return xG(this.mediums,this.longs,4)}computeMediums(){return xG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=CL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=CL(this.longs[0],10,47),this.longSpeechActivityScore>F_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=CL(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(cm(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let o=r;return r<0&&(o=0),r>JA&&(o=JA),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+wL?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>JA&&(i=JA),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Bfe{constructor(r){Ae(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?r=!0:setTimeout(this.execute.bind(this),i)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class RL{constructor(r,i,o){Ae(this,"isDominant",void 0),Ae(this,"energyRanking",void 0),Ae(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=i,this.energyScore=o}}class Wfe extends Mr{constructor(r){super(),Ae(this,"dominantId",null),Ae(this,"lastDecisionTime",0),Ae(this,"lastLevelChangedTime",0),Ae(this,"lastLevelIdleTime",0),Ae(this,"relativeSpeechActivities",[]),Ae(this,"speakers",new Map),Ae(this,"enableSilence",!1),Ae(this,"timeoutToSilenceInterval",0),Ae(this,"decisionMaker",null),Ae(this,"loudest",[]),Ae(this,"numLoudestToTrack",3),Ae(this,"energyExpireTimeMs",250),Ae(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,i!=null&&(this.energyExpireTimeMs=i),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(i=>i.id===r)}levelChanged(r,i){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(i,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(r){r.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(r){let i=this.speakers.get(r);return i||(i=new LG(r),this.speakers.set(r,i),this.maybeStartDecisionMaker()),i}updateLoudestList(r,i,o){const c=r.id===this.dominantId;if(i<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==r;)++_;return new RL(c,_,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new RL(c,0,r.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new RL(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Bfe(this),this.decisionMaker.execute())}makeDecision(r){let i=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=zc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const _=this.relativeSpeechActivities;let E=2;for(const S of this.speakers.entries()){const[R,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let j=0;j<_.length;++j){const q=m==null?F_:m.getSpeechActivityScore(j);_[j]=Math.log(P.getSpeechActivityScore(j)/q)}const N=_[0],G=_[1],F=_[2];N>3&&G>2&&F>0&&G>E&&(E=G,u=R)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===i||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),i=300-(r-this.lastLevelIdleTime);let o=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=i;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const i=[];for(const c of zc(o=this.speakers).call(o)){var o;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const Kv=new Map;let yd=null,ZA=null;const MG=3;let j_=[];const Ed=new Map,eP=new Map;class zfe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,i){Ae(this,"id",void 0),Ae(this,"track",void 0),Ae(this,"score",0),Ae(this,"active",!0),Ae(this,"muted",!1),Ae(this,"timer",0),Ae(this,"actives",0),Ae(this,"inactives",0),this.id=r,this.track=i,this.setActive(Ed.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:o}=function(){const c=[],u=[];return Array.from(zc(Ed).call(Ed)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(i){let o;return Array.from(zc(Ed).call(Ed)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(i){let o;return Array.from(zc(Ed).call(Ed)).forEach(c=>{c.active||c.id===i||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let tP;function UG(e){const r=Ed.get(e);r&&(Ed.delete(e),r.clearTimer())}const nP=new Map,Gfe=new Map;function Hfe(e,r,i){let o=new Uint8Array(e,r,i),c=[],u=0;for(;c.length<i;)u+3<i&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const rP=new Map,IT=new Map;(function(){const e=Dn();ps.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ps.getStreamFromExtension=e.name===Gn.CHROME&&Number(e.version)>34,ps.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),ps.supportMinBitrate=e.name===Gn.CHROME||e.name===Gn.EDGE,ps.supportSetRtpSenderParameters=function(){const r=Dn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!qp()||!(!Is()&&!NA())||r.name===Gn.FIREFOX&&Number(r.version)>=64)}(),e.name===Gn.SAFARI&&(Number(e.version)>=14?ps.supportDualStream=!0:ps.supportDualStream=!1),ps.webAudioMediaStreamDest=function(){const r=Dn();return!(r.name===Gn.SAFARI&&Number(r.version)<12)}(),ps.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ps.supportWebGL=typeof WebGLRenderingContext<"u",ps.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,qp()||(ps.webAudioWithAEC=!0),ps.supportShareAudio=function(){const r=Dn();return(r.os===Ki.WIN_10||r.os===Ki.WIN_81||r.os===Ki.WIN_7||r.os===Ki.LINUX||r.os===Ki.MAC_OS||r.os===Ki.CHROMIUM_OS)&&r.name===Gn.CHROME&&Number(r.version)>=74}(),ps.supportDataChannel=!!(gT(76)||function(r){const i=Dn();return!(i.name!==Gn.FIREFOX||!i.osVersion)&&Number(i.version)>=r}(68)||W8(14)),ps.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!jr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),ps.supportWebRTCEncodedTransform=function(){const r=Dn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),ps.supportWebRTCInsertableStream=function(){const r=Dn();return(r.name===Gn.CHROME||r.name===Gn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ps.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ps.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,LA(()=>{ps.supportDualStreamEncoding=function(){const r=Dn();return!!oe("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&oe("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",e),x.info("browser compatibility: ",ps)})})();const $fe=["CHINA","GLOBAL"],VG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],B_=[],qv=[];function W_(e,r){return!!r&&B_.some(i=>i.uid===e&&i.channelName===r)}function IL(){return qv.length>0}var Kfe=o6.forEach,FG=bp("forEach")?[].forEach:function(e){return Kfe(this,e,arguments.length>1?arguments[1]:void 0)};zn({target:"Array",proto:!0,forced:[].forEach!=FG},{forEach:FG});var qfe=ac("Array").forEach,Yfe=Nc,Xfe=Ti,Jfe=k,Qfe=qfe,AL=Array.prototype,Zfe={DOMTokenList:!0,NodeList:!0},eme=function(e){var r=e.forEach;return e===AL||Jfe(AL,e)&&r===AL.forEach||Xfe(Zfe,Yfe(e))?Qfe:r},tme=l(eme),nme=$o,jG=Lc;zn({target:"Object",stat:!0,forced:d(function(){jG(1)})},{keys:function(e){return jG(nme(e))}});var BG=l(mt.Object.keys),rme=l(iE),ime=l(oE),sme=zn,WG=$g,ome=m_,ame=ht,zG=ge,cme=mi,lme=Re,ume=UI,dme=_r,hme=Ts,pme=XB("slice"),fme=dme("species"),PL=Array,mme=Math.max;sme({target:"Array",proto:!0,forced:!pme},{slice:function(e,r){var i,o,c,u=lme(this),h=cme(u),m=zG(e,h),_=zG(r===void 0?h:r,h);if(WG(u)&&(i=u.constructor,(ome(i)&&(i===PL||WG(i.prototype))||ame(i)&&(i=i[fme])===null)&&(i=void 0),i===PL||i===void 0))return hme(u,m,_);for(o=new(i===void 0?PL:i)(mme(_-m,0)),c=0;m<_;m++,c++)m in u&&ume(o,c,u[m]);return o.length=c,o}});var gme=ac("Array").slice,_me=k,yme=gme,OL=Array.prototype,Eme=function(e){var r=e.slice;return e===OL||_me(OL,e)&&r===OL.slice?yme:r},vme=l(Eme);function Tt(e,r,i,o,c){var u,h,m,_={};return tme(u=BG(o)).call(u,function(E){_[E]=o[E]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=rme(h=ime(m=vme(i).call(i)).call(m)).call(h,function(E,S){return S(e,r,E)||E},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&($B(e,r,_),_=null),_}let iP=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),kL=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Eu=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),xo=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Mt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),fr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Ht=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Gt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),AT=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),wn=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Lo=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Qt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function sP(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw x.error("Invalid Channel Name ".concat(e)),new Oe(te.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function oP(e){if(r=e,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||X8(e,1,255)))throw new Oe(te.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof e=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Zp=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Sme={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},NL={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function DL(e,r){ds(e.url,"".concat(r,".url"),1,1e3,!1),Br(e.x)||or(e.x,"".concat(r,".x"),0,1e4),Br(e.y)||or(e.y,"".concat(r,".y"),0,1e4),Br(e.width)||or(e.width,"".concat(r,".width"),0,1e4),Br(e.height)||or(e.height,"".concat(r,".height"),0,1e4),Br(e.zOrder)||or(e.zOrder,"".concat(r,".zOrder"),0,255),Br(e.alpha)||or(e.alpha,"".concat(r,".alpha"),0,1,!1)}const bme={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Vm=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),xL=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Mi=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function GG(e){if(!e.channelName)throw new Oe(te.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Oe(te.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&ds(e.token,"info.token",1,2047),oP(e.uid),sP(e.channelName),!0}let Mo=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),ef=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Ba=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Yv=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Xn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),os=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),aP=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Yi=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Hn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const HG=[Hn.AFRICA,Hn.ASIA,Hn.CHINA,Hn.EUROPE,Hn.GLOBAL,Hn.INDIA,Hn.JAPAN,Hn.NORTH_AMERICA,Hn.OCEANIA,Hn.OVERSEA,Hn.SOUTH_AMERICA];let Vs=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const cP={CHINA:{},ASIA:{CODE:Vs.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Vs.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Vs.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Vs.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Vs.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Vs.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Vs.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Vs.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Vs.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Vs.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Vs.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Vs.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Vs.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};tL&&(cP.CHINA={CODE:Vs.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let PT=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function $G(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class KG extends Mr{constructor(r,i){super(),K(this,"onICEConnectionStateChange",void 0),K(this,"onConnectionStateChange",void 0),K(this,"onDTLSTransportStateChange",void 0),K(this,"onDTLSTransportError",void 0),K(this,"onICETransportStateChange",void 0),K(this,"onFirstAudioReceived",void 0),K(this,"onFirstVideoReceived",void 0),K(this,"onFirstAudioDecoded",void 0),K(this,"onFirstVideoDecoded",void 0),K(this,"onFirstVideoDecodedTimeout",void 0),K(this,"onSelectedLocalCandidateChanged",void 0),K(this,"onSelectedRemoteCandidateChanged",void 0),K(this,"onICECandidateError",void 0),K(this,"getLocalVideoStats",void 0)}}class qG extends KG{constructor(r,i){super(r,i),K(this,"establishPromise",void 0)}}let yt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Fs=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),tf=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const YG=["disconnected","failed"];let Ke=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Yn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),xt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),vu=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Su=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),as=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),XG=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),vh=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Pl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),vd=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Xv=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),oi=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Jv=function(e){return e.ABORT="abort",e}({}),Fm=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Tme=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const wme={[iP.ACCESS_POINT]:{[xo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[xo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[xo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[xo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[xo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[xo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[xo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[iP.UNILBS]:{[Eu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Eu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Eu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Eu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Eu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Eu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Eu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Eu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Eu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Eu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Eu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Eu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[iP.STRING_UID_ALLOCATOR]:{[kL.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[kL.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[kL.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Qv(e){const r=wme[Math.floor(e/1e4)];if(!r)return{desc:"unknown error",retry:!1};const i=r[e%1e4];if(!i){if(Math.floor(e/1e4)===iP.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const Cme={[Mt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Mt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Mt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Mt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Mt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Mt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Mt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Mt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Mt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Mt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Mt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Mt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Mt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Mt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Mt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Mt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Mt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Mt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Mt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Mt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Mt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Mt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Mt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Mt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Mt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Mt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Mt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Mt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Mt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Mt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Mt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Mt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Mt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Mt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Mt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Mt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Mt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Mt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Mt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Mt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Mt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Mt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Mt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Mt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Mt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Mt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Mt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Mt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Mt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Mt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Mt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Mt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Mt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Mt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Mt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Mt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Mt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Mt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Mt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Mt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function OT(e){return Cme[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function JG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function LL(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?JG(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):JG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function QG(e,r){if(typeof e=="string")return e;const{proxy:i,host:o,port:c}=e;if(r){const u=oe("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const Rme=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Ime=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Ame=/wss:\/\/(.+):([0-9]+)\/?/,Pme=/wss:\/\/(.[^\/]+)\/?/;let Ome=0;class kme{constructor(r,i){K(this,"id",0),K(this,"store",void 0),K(this,"recordIndex",void 0),K(this,"websockets",[]),K(this,"try443PortDuration",2e3),K(this,"forceCloseWSDuration",5e3),K(this,"try443PortTimeout",null),K(this,"forceCloseTimeout",null),K(this,"isTry443PortFailed",!1),K(this,"isNormalPortFailed",!1),K(this,"useDoubleDomain",!1),K(this,"useProxy",!1),K(this,"startTime",Date.now()),this.id=++Ome,this.try443PortDuration=oe("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const i=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(r,i,o){this.logger("createWebSocket:",r,{isTry443Port:i,hasTimeoutDetection:o});const c=oe("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var N;return st(N=r.host).call(N,P)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(P=>{_.push(QG(LL(LL({},r),{},{host:r.host.replace(m,P)}),i))});else{const P=LL({},r);if(i&&m){const N=c.find(G=>G!==m);N&&(P.host=P.host.replace(m,N))}_.push(QG(P,i))}try{_.forEach(P=>{const N=new WebSocket(P);N.binaryType="arraybuffer",h.push(N),this.logger("ws is connecting:",N.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(N=>N.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,i,o);if(!i&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new Oe(te.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const E=mT();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(N=>{N!==P&&(N.onopen=null,N.onclose=null,N.onmessage=null,N.close(),this.logger("close backup websocket: ".concat(N.url)))}),this.websockets.length=0,E.resolve(P)},P.onclose=N=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const G=h.every(F=>F.readyState===WebSocket.CLOSED||F.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(N.reason)),E.reject({code:N.code,reason:aP.A_ROUND_WS_FAILED})):!i&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),i?this.isTry443PortFailed=G:this.isNormalPortFailed=G},P.onmessage=N=>this.logger("".concat(P.url," onmessage: ").concat(N.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(E.isResolved)return S();Dn().os===Ki.MAC_OS&&jr()&&S(),this.createWebSocket(r,!0,!0).then(P=>{E.resolve(P)}).catch(P=>{this.isNormalPortFailed&&E.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",E.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",E.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),E.promise}chooseBestWebsocket(r,i,o,c){return this.useDoubleDomain=!!i,typeof r=="string"&&(r=function(u){let h,m,_;return[,h,m,_]=u.match(Rme)||[],h||([,m,_]=u.match(Ime)||[]),m&&_||([,m,_]=u.match(Ame)||[]),m&&_||([,m]=u.match(Pme)||[]),m||x.warning("un-destructible url: ",u),{proxy:h,host:m,port:_||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function ZG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class e9 extends Mr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;st(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(Qt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Qt.CONNECTED):this._state==="closed"?this.emit(Qt.CLOSED):this._state==="failed"&&this.emit(Qt.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),K(this,"connectionID",0),K(this,"currentURLIndex",0),K(this,"urls",[]),K(this,"_reconnectMode","tryNext"),K(this,"reconnectReason",void 0),K(this,"_initMutex",void 0),K(this,"name",void 0),K(this,"_state","closed"),K(this,"reconnectInterrupter",void 0),K(this,"websocket",void 0),K(this,"retryConfig",void 0),K(this,"reconnectCount",0),K(this,"forceCloseTimeout",5e3),K(this,"onlineReconnectListener",void 0),K(this,"useCompress",void 0),K(this,"tryDoubleDomain",!1),K(this,"use443PortOnly",!1),K(this,"wsInflateLength",0),K(this,"wsDeflateLength",0),K(this,"closeEstablishingWs",()=>{}),K(this,"store",void 0),K(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var N=arguments[P]!=null?arguments[P]:{};P%2?ZG(Object(N),!0).forEach(function(G){K(R,G,N[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(N)):ZG(Object(N)).forEach(function(G){Object.defineProperty(R,G,Object.getOwnPropertyDescriptor(N,G))})}return R}({},i),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Us("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:_}=i,E=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*_)/10);mc.ONLINE&&(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S),_i.on(kv.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===mc.ONLINE?(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=r,this.state="connecting";try{const c=mT(),u=this.urls[this.currentURLIndex];oe("ENABLE_PREALLOC_PC")&&this.emit(XG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Qt.CLOSED,()=>{c.reject(new Me(te.WS_DISCONNECT))}),this.once(Qt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Me(te.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new Me(te.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var i;const o=mT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Me(te.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=Hc(this,Qt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,N=await this.reconnectWithAction(P);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!N)return o.reject(new Me(te.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(Qt.ON_MESSAGE,S)},m=S=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),oe("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=oe("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const _=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const R=this.state==="closed",P=S instanceof Me,N=P&&S.code===te.WS_ABORT,G=P&&S.code===te.WS_ERR,F=P?S.message:S&&(S.reason||S.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(F)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:N?"aborted":"error",errors:[S]},_),R||G?(o.reject(R?new Me(te.WS_DISCONNECT,"websocket is closed: ".concat(F)):new Me(te.WS_ERR,"init websocket failed: ".concat(F))),G&&x.error("[".concat(this.name,"] init websocket failed: ").concat(F))):u&&u(S)}return o.promise}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||_i.isOnline||!_i.onlineWaiter||(this.onlineReconnectListener=_i.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){const h=Kx(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await ut.race([hs(h),this.onlineReconnectListener||new ut(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Qt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Ps(this,Qt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&st(m).call(m,"dynamic key expired")?(this.emit(Qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,i)}return!0}}class ML extends e9{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){const o=mT(),c=function(h,m){return new kme(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Me(te.WS_ABORT,"choose best websocket aborted"))};const u=oe("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class kT extends e9{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){return new ut((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new Me(te.WS_ABORT,"choose best websocket aborted"))};const m=oe("GATEWAY_DOMAINS");let _;const E=r.indexOf("?h="),S=m.find(G=>E!==-1?st(r).call(r,G,E):st(r).call(r,G));x.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var P;const G=Date.now();try{m.forEach(F=>{const j=E===-1?r.replace(S,F):r.substr(0,E)+r.substr(E).replace(S,F),q=new WebSocket(j);q.binaryType="arraybuffer",h.push(q),x.debug("[choose-best-ws] ws is connecting:",q.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(j=>j.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(F=>F.url),service:"gateway"},i),h.forEach(F=>{F.onopen=()=>{if(u)return;const j=Date.now()-G;x.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),h.filter(q=>q!==F).forEach(q=>{x.debug("[choose-best-ws]close backup websocket: ".concat(q.url)),q.close()}),u=!0,o(F)},F.onclose=j=>{_=j,!u&&(h.find(q=>!(q.readyState===WebSocket.CLOSED||q.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},F.onmessage=j=>{x.debug("[choose-best-ws]".concat(F.url," onmessage: ").concat(j.data))}}),hs(this.forceCloseTimeout).then(()=>{h.forEach(F=>{F.readyState!==WebSocket.OPEN&&F.close()})})}if(R){var N;let G;x.debug("[choose-best-ws] use single url: ",r),(N=this.store)===null||N===void 0||N.recordJoinChannelService({urls:[r],service:"gateway"},i);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(F){const j=new Me(te.WS_ERR,"init websocket failed! Error: ".concat(F.toString()));return x.error("[".concat(this.name,"]").concat(j)),void c(j)}G.onopen=()=>{o(G)},G.onclose=F=>{c(F)},G.onmessage=F=>{x.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(F.data))},hs(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Nme extends Mr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===fr.CONNECTED?this.emit(Ht.WS_CONNECTED):r===fr.RECONNECTING?this.emit(Ht.WS_RECONNECTING,this._websocketReconnectReason):r===fr.CLOSED&&this.emit(Ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",fr.CLOSED),K(this,"reconnectToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new hW(5)),K(this,"pingpongTimer",void 0),K(this,"wsInflateDataTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Ht.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===wn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===wn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(qn.UID_BANNED);break;case 15:this.close(qn.IP_BANNED);break;case 16:this.close(qn.CHANNEL_BANNED)}if(c._type===wn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Mt.ERR_LICENSE_MISSING:this.close(qn.LICENSE_MISSING);break;case Mt.ERR_LICENSE_EXPIRED:this.close(qn.LICENSE_EXPIRED);break;case Mt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(qn.LICENSE_MINUTES_EXCEEDED);break;case Mt.ERR_LICENSE_PERIOD_INVALID:this.close(qn.LICENSE_PERIOD_INVALID);break;case Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(qn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Mt.ERR_LICENSE_ILLEGAL:this.close(qn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new ML("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===fr.CONNECTED&&this.reconnect("retry",As.OFFLINE)})}async request(r,i,o,c){const u=dr(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,_=()=>new ut((G,F)=>{if(this.connectionState===fr.CONNECTED)return G();const j=()=>{this.off(Ht.WS_CLOSED,q),G()},q=()=>{this.off(Ht.WS_CONNECTED,j),F(new Oe(te.WS_ABORT))};this.once(Ht.WS_CONNECTED,j),this.once(Ht.WS_CLOSED,q),r!==Gt.PUBLISH&&r!==Gt.PUBLISH_DATASTREAM&&r!==Gt.SUBSCRIBE&&r!==Gt.SUBSCRIBE_DATASTREAM&&r!==Gt.UNSUBSCRIBE&&r!==Gt.UNSUBSCRIBE_DATASTREAM&&r!==Gt.UNPUBLISH&&r!==Gt.UNPUBLISH_DATASTREAM&&r!==Gt.CONTROL&&r!==Gt.RESTART_ICE||this.once(Ht.DISCONNECT_P2P,()=>{F(new Oe(te.DISCONNECT_P2P))}),r!==Gt.PUBLISH&&r!==Gt.RESTART_ICE||this.once(Ht.ABORT_P2P_EXECUTION,()=>{F(new Oe(te.DISCONNECT_P2P))})});if(this.connectionState!==fr.CONNECTING&&this.connectionState!==fr.RECONNECTING||r===Gt.JOIN||r===Gt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const E=new ut((G,F)=>{let j=!1;const q=(he,Se)=>{j=!0,G({isSuccess:he==="success",message:Se||{}}),this.off(Ht.WS_CLOSED,ee),this.off(Ht.WS_RECONNECTING,ee),this.emit(Ht.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),q);const ee=()=>{F(new Oe(te.WS_ABORT,"type: ".concat(r))),this.off(Ht.WS_CLOSED,ee),this.off(Ht.WS_RECONNECTING,ee),this.off("res-@".concat(u),q)};this.once(Ht.WS_CLOSED,ee),this.once(Ht.WS_RECONNECTING,ee),hs(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Ht.REQUEST_TIMEOUT,r,i))})});let S=null;try{S=await E}catch(G){if(this.connectionState===fr.CLOSED||r===Gt.LEAVE)throw new Oe(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===Gt.JOIN||r===Gt.REJOIN?null:(await _(),await this.request(r,i))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=OT(R),N=new Oe(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Mt.ERR_TOO_MANY_BROADCASTERS?((r===Gt.JOIN||r===Gt.REJOIN)&&(this.initError=N,this.close()),N.throw()):P.action==="failed"?N.throw():P.action==="quit"?(this.initError=N,this.close(),N.throw()):(R===Mt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",As.MULTI_IP)):this.reconnect(P.action,As.SERVER_ERROR),r===Gt.JOIN||r===Gt.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new ut(o=>{const c=u=>{(!i||i(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(AT.WRTC_STATS,i)}upload(r,i){const o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{const u=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==fr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const o={_type:r,_message:i};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ut((i,o)=>{this.once(Ht.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Ht.WS_CLOSED,c=>o(this.initError||new Oe(te.WS_ABORT,c))),this.connectionState=fr.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||qn.LEAVE,this.connectionState=fr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Ht.ABORT_P2P_EXECUTION);const r=await Ps(this,Ht.REQUEST_JOIN_INFO),i=await this.request(Gt.JOIN,r);if(!i)return this.emit(Ht.REPORT_JOIN_GATEWAY,aP.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(te.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=ST(this,Ht.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(Gt.REJOIN,r);return!!i&&(this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(wn.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(wn.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(wn.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(wn.MUTE_AUDIO,{uid:o.uid}):this.emit(wn.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(wn.MUTE_VIDEO,{uid:o.uid}):this.emit(wn.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(wn.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(wn.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(wn.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(wn.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(wn.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const i=OT(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Ht.RECOVER_NOTIFICATION,r.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(qn.UID_BANNED),void this.close()):void this.reconnect(i.action,As.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",As.TIMEOUT):this.request(Gt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),oe("REPORT_STATS")&&this.send(Gt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();r!==0&&i!==0&&this.upload(AT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Qt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Ht.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Qt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Qt.CLOSED,()=>{this.connectionState=fr.CLOSED}),this.websocket.on(Qt.FAILED,()=>{this._disconnectedReason=qn.NETWORK_ERROR,this.connectionState=fr.CLOSED}),this.websocket.on(Qt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===fr.CONNECTED?this.connectionState=fr.RECONNECTING:this.connectionState=fr.CONNECTING}),this.websocket.on(Qt.WILL_RECONNECT,(r,i,o)=>{const c=ST(this,Ht.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",i=aP.P2P_DISCONNECTED),u&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Ht.REPORT_JOIN_GATEWAY,i||aP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Ht.DISCONNECT_P2P)),o(r)}),this.websocket.on(Qt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",As.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Ht.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Mt.ERR_NO_AUTHORIZED)return this.initError=new Oe(te.TOKEN_EXPIRE,"dynamic key expired"),void this.close(qn.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",As.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Qt.REQUEST_NEW_URLS,(r,i)=>{Ps(this,Ht.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(XG.PRE_CONNECT_PC,()=>{this.emit(Ht.PRE_CONNECT_PC)})}}let Dme=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),yi=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function t9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function lP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?t9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function jm(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(oe("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function UL(e,r){e.addresses||(e.addresses=[]);const i=function(m,_){if(oe("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:N}=R;return{address:"".concat(P,":").concat(N)}});const E=oe("GATEWAY_DOMAINS");let S=E[1]&&st(_).call(_,E[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:N,ip:G}=R;if(P)return{address:"".concat(P,".").concat(E[S++%E.length],":").concat(N)};const F=/^[\.\:\d]+$/.test(G),j=F?"".concat(G.replace(/[^\d]/g,"-"),".").concat(E[S++%E.length],":").concat(N):"".concat(G,":").concat(N);return F||x.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:N,address:j}})}(e.addresses,r),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let _=0;_<m.length;_++){var c;const E=ho(c=m[_]).call(c);i[_]&&E&&(i[_].ip6=E)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,_]=u.split(":");m&&_&&(h={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function gc(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function n9(e){const r=e._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?"".concat(gc(r.width),"x").concat(gc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function r9(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function NT(e,r){let i,o,c;switch(r){case yi.CHOOSE_SERVER:o=4096,c="choose server";break;case yi.CLOUD_PROXY:o=1048576,c="proxy";break;case yi.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case yi.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Oe(te.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>lP(lP({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:lP(lP({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!i)throw new Oe(te.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function i9(e,r){return await ut.all(e.addresses.map(async i=>({address:oe("USE_TURN_IP")?i.ip:jm(i.ip),tcpport:i.port,udpport:i.port,username:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Os.username,password:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await zx(r.toString()):Os.password})))}function VL(e,r){const i=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||i.height,c=r.videoWidth||i.width;return o&&c?Math.max(Math.min(o,c)/Math.min(gc(e.height),gc(e.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Bm(e){let{candidateType:r,relayProtocol:i,type:o,address:c,port:u,protocol:h}=e;const m={candidateType:r,relayProtocol:i,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=u}return m}function uP(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oe("SVC_MODE");if(oe("ENABLE_SVC"))return function(r){return r in FA}(e)?e:FA.L1T3}const s9={[yt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[yt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function dP(e,r,i){r.forEach(o=>{var c;const u=s9[e].find(m=>{var _;let{key:E}=m;return st(_=o.extensionName).call(_,E)});if(!u)return;const h=i.find(m=>{let{extensionName:_}=m;return st(_).call(_,u.key)});h&&st(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function Zv(e,r){r.forEach(i=>{var o;const c=s9[e].find(u=>{var h;let{key:m}=u;return st(h=i.extensionName).call(h,m)});st(o=i.extensionName).call(o,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function o9(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||st(e).call(e,"abs-send-time")}function hP(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||st(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function a9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function c9(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?a9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function DT(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:_}=r,{useXR:E}=i;let S=[],R=[],P=[],N=[],G=!1,F=!1;if(ja(e).mediaDescriptions.forEach(q=>{o&&o!==q.attributes.direction||(q.media.mediaType!=="video"||G||(R=q.attributes.payloads,N=q.attributes.extmaps,G=!0),q.media.mediaType!=="audio"||F||(S=q.attributes.payloads,P=q.attributes.extmaps,F=!0))}),!N||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(q=>{var ee;(ee=q.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),E&&q.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(q=>{var ee;(ee=q.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),E&&q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(q=>{var ee;return((ee=q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"}),R=R.filter(q=>{var ee;return((ee=q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(q=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=q.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),h&&(S=S.filter(q=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=q.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(q=>{var ee;return st(m).call(m,((ee=q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const q=R.filter(ee=>{var he;return st(_).call(_,((he=ee.rtpMap)===null||he===void 0?void 0:he.encodingName.toLowerCase())||"")});R=q.concat(c?[]:BL(q,R))}const j=oe("UNSUPPORTED_VIDEO_CODEC");return j&&j.length>0&&(R=R.filter(q=>!(q.rtpMap&&st(j).call(j,q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:P,videoExtensions:N}}function Wm(e){const r=ja(e);let i,o;for(const c of r.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function l9(e,r){const i=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const _=(m=o.find(E=>E.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];i.push({ssrcId:h,rtx:r?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];i.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function u9(e,r,i){const{cname:o}=e;let c=[];r&&(c=d9(r)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),x.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=fP(e.rtpCapabilities),E=[];return Array.isArray(i)&&i.length>0&&i.forEach(S=>{E.push({kind:yt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:yt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:m,cname:o,preSSRCs:E}}function d9(e){let r=[];return e.ip&&typeof e.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),r}function z_(e,r,i){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u;const _=dr(8,"track-"),E={ssrcId:h,attributes:c9({label:_,mslabel:i=i||dr(10,""),msid:"".concat(i," ").concat(_)},r&&{cname:r})};if(o.push(E),m!==void 0){const S={ssrcId:m,attributes:c9({label:_,mslabel:i,msid:"".concat(i," ").concat(_)},r&&{cname:r})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function eS(e,r){r instanceof qr&&e.attributes.payloads.forEach(i=>{var o;const c=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!jr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function FL(e){const r=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&e.attributes.unrecognized.splice(r,1)}function jL(e,r){var i;if(!(r instanceof br&&r._encoderConfig&&r._hints.indexOf(hr.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;jn().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),jn().supportMinBitrate&&!st(i=r._hints).call(i,hr.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(oe("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function h9(e){if(e.media.mediaType!=="video")return;const r=Dn();if(r.name!==Gn.SAFARI&&r.os!==Ki.IOS)return;const i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function pP(e,r,i){if(!r)return;let o,c;if(e.media.mediaType==="video"?(o=i.videoExtensions,c=i.videoCodecs):(o=i.audioExtensions,c=i.audioCodecs),r.twcc===!0){const u=o.find(h=>hP(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>hP(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,E){return E.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(E=>E.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>hP(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=o.find(h=>o9(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,E){return E.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(E=>E.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=e.attributes.extmaps.findIndex(h=>o9(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function p9(e,r,i){if(jr()||e.media.mediaType!=="video"||!(r instanceof br)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!oe("SIMULCAST")||i==="vp9"&&oe("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:zr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:zr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function f9(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const o=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=arguments.length>2?arguments[2]:void 0;const S=DT(E,m,_,"sendonly"),R=DT(E,m,_,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bu(S,R,"videoExtensions",P,N,G),bu(S,R,"videoCodecs",P,N,G),bu(S,R,"audioExtensions",P,N,G),bu(S,R,"audioCodecs",P,N,G),oe("RAISE_H264_BASELINE_PRIORITY")){const F=[],j=[];G.videoCodecs.forEach((q,ee)=>{var he;if(((he=q.rtpMap)===null||he===void 0?void 0:he.encodingName.toLocaleLowerCase())==="h264"){var Se,we;const ye=G.videoCodecs[ee+1],Ne=ye&&E9(q,ye),Ye=(Se=q.fmtp)===null||Se===void 0?void 0:Se.parameters["profile-level-id"],dt=(we=q.fmtp)===null||we===void 0?void 0:we.parameters["packetization-mode"];!Ye||Ye!==oe("FIRST_H264_PROFILE_LEVEL_ID")||oe("FIRST_PACKETIZATION_MODE")&&dt!==oe("FIRST_PACKETIZATION_MODE")?Ne?j.push([q,ye]):j.push([q]):Ne?F.push([q,ye]):F.push([q])}}),F.length>0&&j.length>0&&(x.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((q,ee)=>{var he;if(((he=q.rtpMap)===null||he===void 0?void 0:he.encodingName.toLocaleLowerCase())==="h264"){const Se=E9(q,G.videoCodecs[ee+1]),we=F.shift()||j.shift()||[];we.length>0&&(Se?G.videoCodecs.splice(ee,2,...we):G.videoCodecs.splice(ee,1,...we))}}),N.videoCodecs=N.videoCodecs.filter(q=>{var ee,he;return!(((ee=q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((he=q.fmtp)===null||he===void 0?void 0:he.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))}),oe("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>{var ee,he;return!(((ee=q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((he=q.fmtp)===null||he===void 0?void 0:he.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:N,sendrecv:G}}(e,r,o);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function m9(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=DT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bu(e,r,"videoExtensions",i,o,c),bu(e,r,"videoCodecs",i,o,c),bu(e,r,"audioExtensions",i,o,c),bu(e,r,"audioCodecs",i,o,c),oe("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:c}}function bu(e,r,i,o,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return e[i].forEach(m=>{r[i].some((_,E)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return h.push(E),!0})?u[i].push(m):o[i].push(m)}),void r[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return e[i].forEach(m=>{r[i].some((_,E)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return h.push(E),!0})?u[i].push(m):o[i].push(m)}),void r[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}}function fP(e){const{send:r,recv:i,sendrecv:o}=e;if(!o){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...o.audioCodecs],u.videoCodecs=[...i.videoCodecs,...o.videoCodecs],u.audioExtensions=[...i.audioExtensions,...o.audioExtensions],u.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function tS(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function xT(e,r,i,o){let c=[];if(e===yt.VIDEO){if(oe("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===oe("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],_=[];if(i.videoCodecs.forEach(E=>{const S=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"";st(S).call(S,o)?u.push(E):st(S).call(S,"vp9")?h.push(E):st(S).call(S,"vp8")?m.push(E):st(S).call(S,"h264")&&_.push(E)}),u.length===0){let E="";h.length!==0?(u=h,E="vp9"):m.length!==0?(u=m,E="vp8"):_.length!==0&&(u=_,E="h264"),x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(E))}u.length!==0&&(c=r.videoCodecs.filter(E=>u.some(S=>S.payloadType===E.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const u=BL(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function BL(e,r){const i=e.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&st(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function LT(e,r,i){const o=r.toString(),c=_9(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=g9(h,i||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function g9(e,r,i){const o=ja(e),{useXR:c}=r;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!st(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&tS(u),c&&st(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Um(o)}function _9(e,r,i,o){if(oe("SDP_LOGGING"))return x.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(o,`
`),e),r==="offer"?c=>{_9(c,"answer",i==="local"?"remote":"local",o)}:void 0}function y9(e){const r=oe("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(i=>st(e).call(e,i))}function E9(e,r){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===r.payloadType.toString()}catch{return!1}}function v9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Ol(e,r){return typeof oe(e)===r?oe(e):void 0}function xme(){try{const e=oe("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?v9(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):v9(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e)}catch(e){return x.debug("handle gateway attributes failed: ",e),{}}}const S9={};function zm(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(e.name)),S9[e.name]=e}function nf(e){const r=S9[e];if(!r)throw new Me(te.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return r}function b9(e,r){return nf("DataStream").create(e,r)}function mP(){return nf("InterceptFrame").create()}function T9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function rf(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?T9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):T9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const WL=new Map;class Lme extends Mr{get state(){return this._state}set state(r){if(r===this._state)return;const i=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(os.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit(os.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){var o,c,u;super(),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"key",void 0),K(this,"ntpOffset",0),K(this,"signal",void 0),K(this,"role",void 0),K(this,"inChannelInfo",{joinAt:null,duration:0}),K(this,"spec",void 0),K(this,"_state","DISCONNECTED"),K(this,"_statsCollector",void 0),K(this,"_disconnectedReason",void 0),K(this,"isSignalRecover",!1),K(this,"hasChangeBGPAddress",!1),K(this,"trafficStatsInterval",void 0),K(this,"networkQualityInterval",void 0),K(this,"_joinGatewayStartTime",0),K(this,"_signalTimeout",!1),K(this,"_clientRoleOptions",void 0),K(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useP2P?(o={spec:rf(rf({},i),{},{retryConfig:i.websocketRetryConfig}),store:r},(c=(u=nf("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Nme(rf(rf({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(r,i,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=WL.get(r.cname);if(u||(u=new Map,WL.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const E=new Oe(te.UID_CONFLICT);throw At.joinGateway(r.sid,{lts:c,succ:!1,ec:E.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),E}u.set(r.uid,!0),this.joinInfo=r,this.key=i;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const E=r.gatewayAddrs.map(S=>{let{address:R}=S;const[P,N]=R.split(":"),G={host:P,port:N};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(E)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(E){var _;throw x.error("[".concat(this.store.clientId,"] User join failed"),E.toString()),At.joinGateway(r.sid,{lts:c,succ:!1,ec:((_=E.data)===null||_===void 0?void 0:_.desc)||E.code,errorMsg:E.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),E}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(E=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),E.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(os.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(os.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(os.NETWORK_QUALITY,{uplinkNetworkQuality:r9(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:r9(this._statsCollector.trafficStats.B_dnq)}):this.emit(os.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==qn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==fr.CONNECTED||await function(o,c){return c===1/0?o:ut.race([o,ofe(c)])}(this.signal.request(Gt.LEAVE,void 0,!0),3e3)}catch(o){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==qn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:oe("PUB_EXTEND"),twcc:!!oe("PUBLISH_TWCC"),rtx:!!oe("USE_PUB_RTX")};try{return(await this.signal.request(Gt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Mt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,i),this.publish(r,i,!1);throw u}}async publishDataChannel(r,i,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Gt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Mt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,i),this.publishDataChannel(r,i,!1);throw h}}async unpublish(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Gt.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ut.all(r.map(i=>this.signal.request(Gt.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){x.warning("unpublish datachannels warning: ",i)}}async presubscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX")||void 0,extend:oe("SUB_EXTEND"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Gt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,i,!1);throw u}}async subscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX"),extend:oe("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return(await this.signal.request(Gt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,i),await this.subscribe(r,i,!1);throw u}}async subscribeDataChannel(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Gt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,i),await this.subscribeDataChannel(r,i,!1);throw u}}async subscribeAll(r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!oe("USE_SUB_RTX"),twcc:!!oe("SUBSCRIBE_TWCC"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Gt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(i&&c.data&&c.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(i)return this.signal.request(Gt.SET_VIDEO_PROFILE,i);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,i){try{await this.signal.request(Gt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:i},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ut.all(r.map(o=>this.signal.request(Gt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){x.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(Gt.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(r){const{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Gt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Gt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Gt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,i){i&&(this._clientRoleOptions=Object.assign({},i)),oe("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),oe("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Gt.SET_CLIENT_ROLE,{role:r,level:c,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,i){await this.signal.request(Gt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Gt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,i){await this.signal.request(Gt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})}async pickSVCLayer(r,i){await this.signal.request(Gt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Gt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,i,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),rf({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Gt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=WL.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:Os.username,password:Os.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(rf(rf({},Os),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Gt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(i=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&LA(()=>{this.emit(os.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Oe(te.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let o=oe("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(os.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,st(qv).call(qv,c)||qv.push(c);const u=!(jr()||B8(87)||OW())&&typeof oe("ENABLE_PRE_SUB")=="boolean"&&oe("ENABLE_PRE_SUB"),h=!OW()&&Ol("ENABLE_PREALLOC_PC","boolean"),m=xme(),_=gT(87)||function(){const S=Dn();if(S.name!==Gn.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),E=rf({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Rl,browser:navigator.userAgent,process_id:oe("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:oe("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:rf({enableEncodedTransform:!!oe("ENABLE_AUDIO_METADATA")&&_||!!oe("ENABLE_AUDIO_TOPN")&&Lx(Gn.CHROME,87,116)||void 0,enableAudioMetadata:!!oe("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!oe("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:oe("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:oe("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:oe("TOPN_SWITCH_HOLD_MS"),topnAudioGain:oe("TOPN_AUDIO_GAIN"),enablePublishedUserList:oe("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:oe("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Ol("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Ol("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Ol("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:oe("USE_PUB_RTX")===!0||oe("USE_SUB_RTX")===!0||void 0,disableFEC:oe("DISABLE_FEC"),enableNTPReport:!!oe("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!oe("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!oe("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ol("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!oe("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!oe("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ol("USE_XR","boolean"),enableLossbasedBwe:Ol("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!oe("ENABLE_AUT_CC")||void 0,enableCCFallback:Ol("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?Ol("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ol("PUBLISH_TWCC","boolean"),enableSubTWCC:Ol("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ol("USE_PUB_RTX","boolean"),enableSubRTX:Ol("USE_SUB_RTX","boolean"),enableSubSVC:oe("ENABLE_SVC")?oe("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0,enableSvcExtended:oe("ENABLE_SVC")&&Array.isArray(oe("SVC_EXTENDED"))&&oe("SVC_EXTENDED").length!==0?oe("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(E.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(E.aes_mode=this.joinInfo.aesmode,oe("ENCRYPT_AES")?(E.aes_secret=this.joinInfo.aespassword,E.aes_encrypt=!0):E.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(E.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(E.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(E.default_video_stream=this.joinInfo.defaultVideoStream),E}getRejoinMessage(){if(!this.joinInfo)throw new Oe(te.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ht.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Ht.WS_RECONNECTING,r=>{this.joinInfo&&At.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||As.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",At.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Ht.WS_CLOSED,r=>{let i;switch(r){case qn.LEAVE:i=As.LEAVE;break;case qn.UID_BANNED:case qn.IP_BANNED:case qn.CHANNEL_BANNED:case qn.SERVER_ERROR:i=As.SERVER_ERROR;break;case qn.FALLBACK:i=As.FALLBACK;break;case qn.LICENSE_MISSING:case qn.LICENSE_EXPIRED:case qn.LICENSE_MINUTES_EXCEEDED:case qn.LICENSE_PERIOD_INVALID:case qn.LICENSE_MULTIPLE_SDK_SERVICE:case qn.LICENSE_ILLEGAL:case qn.TOKEN_EXPIRE:i=r;break;default:i=As.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+As.NETWORK_ERROR)),this.joinInfo&&At.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===qn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=r,r!==qn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Ht.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=oe("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(At.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));rr("EVENT_REPORT_DOMAIN",r[1]),rr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),rr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(wn.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Ht.REQUEST_RECOVER,(r,i,o)=>{if(!this.joinInfo)return o(new Oe(te.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ps(this,os.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on(Ht.REQUEST_JOIN_INFO,async(r,i,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=zr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(oe("NEW_TURN_MODE")&&u){let E=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;E.length>0&&(E=[E[R%E.length]],u.servers=E),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:_}=await Ps(this,os.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(E){i(E)}}),this.signal.on(Ht.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Ht.REPORT_JOIN_GATEWAY,(r,i)=>{if(!this.joinInfo)return;let o,c="";var u;r instanceof Oe?(o=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):o=r,At.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Ht.IS_P2P_DISCONNECTED,r=>{r(ST(this,os.IS_P2P_DISCONNECTED))}),this.signal.on(Ht.DISCONNECT_P2P,()=>{this.emit(os.DISCONNECT_P2P)}),this.signal.on(Ht.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ht.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Ht.JOIN_RESPONSE,r=>{const i=this.getCurrentGatewayAddress();this.emit(os.JOIN_RESPONSE,r,i)}),this.signal.on(Ht.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),i=oe("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&i){const o=d9(r);this.emit(os.PRE_CONNECT_PC,{candidates:o,fingerprint:i})}}}),this.signal.on(Ht.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof oe("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(oe("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,i){try{await this.signal.request(Gt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,i){try{await this.signal.request(Gt.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw x.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,i){try{await this.signal.request(Gt.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,i){try{await this.signal.request(Gt.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw x.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const i={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Gt.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,i){const o={action:r.find(c=>c.stream_type===Xn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(Gt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,i){const o={action:r.find(c=>c.stream_type===Xn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(Gt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,i){const o={action:r===yt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Gt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,i){const o={action:r===yt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Gt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Gt.RESTART_ICE,i,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,i){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,i||As.P2P_FAILED)}getCurrentGatewayAddress(){var r,i;if(!oe("GATEWAY_WSS_ADDRESS"))return oe("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Gt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let gP=0,zL=0;function Sd(e,r,i,o){return new ut((c,u)=>{r.timeout=r.timeout||oe("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),gP+=mh(r.data)):i&&(r.data.size?gP+=r.data.size:r.data instanceof FormData?gP+=sW(r.data):gP+=mh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,la.request(r).then(h=>{typeof h.data=="string"?zL+=mh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?zL+=h.data.byteLength:zL+=mh(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{la.isCancel(h)?u(new Oe(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Oe(te.NETWORK_TIMEOUT,h.message)):h.response?u(new Oe(te.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Oe(te.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function r(je){var it=0;return function(){return it<je.length?{done:!1,value:je[it++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(je,it,wt){return je==Array.prototype||je==Object.prototype||(je[it]=wt.value),je},o,c=function(je){je=[typeof globalThis=="object"&&globalThis,je,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var it=0;it<je.length;++it){var wt=je[it];if(wt&&wt.Math==Math)return wt}throw Error("Cannot find global object")}(this);function u(je,it){if(it)e:{var wt=c;je=je.split(".");for(var He=0;He<je.length-1;He++){var M=je[He];if(!(M in wt))break e;wt=wt[M]}(it=it(He=wt[je=je[je.length-1]]))!=He&&it!=null&&i(wt,je,{configurable:!0,writable:!0,value:it})}}function h(je){return(je={next:je})[Symbol.iterator]=function(){return this},je}function m(je){var it=typeof Symbol<"u"&&Symbol.iterator&&je[Symbol.iterator];return it?it.call(je):{next:r(je)}}if(u("Symbol",function(je){function it(M,ae){this.A=M,i(this,"description",{configurable:!0,writable:!0,value:ae})}if(je)return je;it.prototype.toString=function(){return this.A};var wt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",He=0;return function M(ae){if(this instanceof M)throw new TypeError("Symbol is not a constructor");return new it(wt+(ae||"")+"_"+He++,ae)}}),u("Symbol.iterator",function(je){if(je)return je;je=Symbol("Symbol.iterator");for(var it="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),wt=0;wt<it.length;wt++){var He=c[it[wt]];typeof He=="function"&&typeof He.prototype[je]!="function"&&i(He.prototype,je,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return je}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var E={};try{E.__proto__={a:!0},_=E.a;break e}catch{}_=!1}o=_?function(je,it){if(je.__proto__=it,je.__proto__!==it)throw new TypeError(je+" is not extensible");return je}:null}var S=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(je){if(je.m)throw new TypeError("Generator is already running");je.m=!0}function N(je,it){return je.h=3,{value:it}}function G(je){this.g=new R,this.G=je}function F(je,it,wt,He){try{var M=it.call(je.g.j,wt);if(!(M instanceof Object))throw new TypeError("Iterator result "+M+" is not an object");if(!M.done)return je.g.m=!1,M;var ae=M.value}catch(fe){return je.g.j=null,je.g.s(fe),j(je)}return je.g.j=null,He.call(je.g,ae),j(je)}function j(je){for(;je.g.h;)try{var it=je.G(je.g);if(it)return je.g.m=!1,{value:it.value,done:!1}}catch(wt){je.g.v=void 0,je.g.s(wt)}if(je.g.m=!1,je.g.l){if(it=je.g.l,je.g.l=null,it.F)throw it.D;return{value:it.return,done:!0}}return{value:void 0,done:!0}}function q(je){this.next=function(it){return je.o(it)},this.throw=function(it){return je.s(it)},this.return=function(it){return function(wt,He){P(wt.g);var M=wt.g.j;return M?F(wt,"return"in M?M.return:function(ae){return{value:ae,done:!0}},He,wt.g.return):(wt.g.return(He),j(wt))}(je,it)},this[Symbol.iterator]=function(){return this}}function ee(je,it){return it=new q(new G(it)),S&&je.prototype&&S(it,je.prototype),it}if(R.prototype.o=function(je){this.v=je},R.prototype.s=function(je){this.l={D:je,F:!0},this.h=this.C||this.u},R.prototype.return=function(je){this.l={return:je},this.h=this.u},G.prototype.o=function(je){return P(this.g),this.g.j?F(this,this.g.j.next,je,this.g.o):(this.g.o(je),j(this))},G.prototype.s=function(je){return P(this.g),this.g.j?F(this,this.g.j.throw,je,this.g.o):(this.g.s(je),j(this))},u("Array.prototype.entries",function(je){return je||function(){return function(it,wt){it instanceof String&&(it+="");var He=0,M=!1,ae={next:function(){if(!M&&He<it.length){var fe=He++;return{value:wt(fe,it[fe]),done:!1}}return M=!0,{done:!0,value:void 0}}};return ae[Symbol.iterator]=function(){return ae},ae}(this,function(it,wt){return[it,wt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var he=function(je,it){for(var wt=0;wt<je.length;wt++)it(je[wt])},Se=function(je){return je.replace(/\r?\n|\r/g,`\r
`)},we=function(je,it,wt){return it instanceof Blob?(wt=wt!==void 0?wt+"":typeof it.name=="string"?it.name:"blob",it.name===wt&&Object.prototype.toString.call(it)!=="[object Blob]"||(it=new File([it],wt)),[String(je),it]):[String(je),String(it)]},ye=function(je,it){if(je.length<it)throw new TypeError(it+" argument required, but only "+je.length+" present.")},Ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ye=Ne.FormData,dt=Ne.XMLHttpRequest&&Ne.XMLHttpRequest.prototype.send,ft=Ne.Request&&Ne.fetch,Rn=Ne.navigator&&Ne.navigator.sendBeacon,In=Ne.Element&&Ne.Element.prototype,pr=Ne.Symbol&&Symbol.toStringTag;pr&&(Blob.prototype[pr]||(Blob.prototype[pr]="Blob"),"File"in Ne&&!File.prototype[pr]&&(File.prototype[pr]="File"));try{new File([],"")}catch{Ne.File=function(it,wt,He){return it=new Blob(it,He||{}),Object.defineProperties(it,{name:{value:wt},lastModified:{value:+(He&&He.lastModified!==void 0?new Date(He.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),pr&&Object.defineProperty(it,pr,{value:"File"}),it}}var ai=function(je){return je.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Yr=function(je){this.i=[];var it=this;je&&he(je.elements,function(wt){if(wt.name&&!wt.disabled&&wt.type!=="submit"&&wt.type!=="button"&&!wt.matches("form fieldset[disabled] *"))if(wt.type==="file"){var He=wt.files&&wt.files.length?wt.files:[new File([],"",{type:"application/octet-stream"})];he(He,function(M){it.append(wt.name,M)})}else wt.type==="select-multiple"||wt.type==="select-one"?he(wt.options,function(M){!M.disabled&&M.selected&&it.append(wt.name,M.value)}):wt.type==="checkbox"||wt.type==="radio"?wt.checked&&it.append(wt.name,wt.value):(He=wt.type==="textarea"?Se(wt.value):wt.value,it.append(wt.name,He))})};if((e=Yr.prototype).append=function(je,it,wt){ye(arguments,2),this.i.push(we(je,it,wt))},e.delete=function(je){ye(arguments,1);var it=[];je=String(je),he(this.i,function(wt){wt[0]!==je&&it.push(wt)}),this.i=it},e.entries=function je(){var it,wt=this;return ee(je,function(He){if(He.h==1&&(it=0),He.h!=3)return it<wt.i.length?He=N(He,wt.i[it]):(He.h=0,He=void 0),He;it++,He.h=2})},e.forEach=function(je,it){ye(arguments,1);for(var wt=m(this),He=wt.next();!He.done;He=wt.next()){var M=m(He.value);He=M.next().value,M=M.next().value,je.call(it,M,He,this)}},e.get=function(je){ye(arguments,1);var it=this.i;je=String(je);for(var wt=0;wt<it.length;wt++)if(it[wt][0]===je)return it[wt][1];return null},e.getAll=function(je){ye(arguments,1);var it=[];return je=String(je),he(this.i,function(wt){wt[0]===je&&it.push(wt[1])}),it},e.has=function(je){ye(arguments,1),je=String(je);for(var it=0;it<this.i.length;it++)if(this.i[it][0]===je)return!0;return!1},e.keys=function je(){var it,wt,He,M,ae=this;return ee(je,function(fe){if(fe.h==1&&(it=m(ae),wt=it.next()),fe.h!=3)return wt.done?void(fe.h=0):(He=wt.value,M=m(He),N(fe,M.next().value));wt=it.next(),fe.h=2})},e.set=function(je,it,wt){ye(arguments,2),je=String(je);var He=[],M=we(je,it,wt),ae=!0;he(this.i,function(fe){fe[0]===je?ae&&(ae=!He.push(M)):He.push(fe)}),ae&&He.push(M),this.i=He},e.values=function je(){var it,wt,He,M,ae=this;return ee(je,function(fe){if(fe.h==1&&(it=m(ae),wt=it.next()),fe.h!=3)return wt.done?void(fe.h=0):(He=wt.value,(M=m(He)).next(),N(fe,M.next().value));wt=it.next(),fe.h=2})},Yr.prototype._asNative=function(){for(var je=new Ye,it=m(this),wt=it.next();!wt.done;wt=it.next()){var He=m(wt.value);wt=He.next().value,He=He.next().value,je.append(wt,He)}return je},Yr.prototype._blob=function(){var je="----formdata-polyfill-"+Math.random(),it=[],wt="--"+je+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(He,M){return typeof He=="string"?it.push(wt+ai(Se(M))+`"\r
\r
`+Se(He)+`\r
`):it.push(wt+ai(Se(M))+'"; filename="'+ai(He.name)+`"\r
Content-Type: `+(He.type||"application/octet-stream")+`\r
\r
`,He,`\r
`)}),it.push("--"+je+"--"),new Blob(it,{type:"multipart/form-data; boundary="+je})},Yr.prototype[Symbol.iterator]=function(){return this.entries()},Yr.prototype.toString=function(){return"[object FormData]"},In&&!In.matches&&(In.matches=In.matchesSelector||In.mozMatchesSelector||In.msMatchesSelector||In.oMatchesSelector||In.webkitMatchesSelector||function(je){for(var it=(je=(this.document||this.ownerDocument).querySelectorAll(je)).length;0<=--it&&je.item(it)!==this;);return-1<it}),pr&&(Yr.prototype[pr]="FormData"),dt){var ma=Ne.XMLHttpRequest.prototype.setRequestHeader;Ne.XMLHttpRequest.prototype.setRequestHeader=function(je,it){ma.call(this,je,it),je.toLowerCase()==="content-type"&&(this.B=!0)},Ne.XMLHttpRequest.prototype.send=function(je){je instanceof Yr?(je=je._blob(),this.B||this.setRequestHeader("Content-Type",je.type),dt.call(this,je)):dt.call(this,je)}}ft&&(Ne.fetch=function(je,it){return it&&it.body&&it.body instanceof Yr&&(it.body=it.body._blob()),ft.call(this,je,it)}),Rn&&(Ne.navigator.sendBeacon=function(je,it){return it instanceof Yr&&(it=it._asNative()),Rn.call(this,je,it)}),Ne.FormData=Yr}})();const MT=()=>{const e=oe("AREAS");return e.length===0&&e.push(Hn.GLOBAL),cc(e).call(e,(r,i,o)=>{const c=w9(i);return c?o===0?c:"".concat(r,",").concat(c):r},"")},w9=e=>e===Hn.OVERSEA?"".concat(Vs.ASIA,",").concat(Vs.EUROPE,",").concat(Vs.AFRICA,",").concat(Vs.NORTH_AMERICA,",").concat(Vs.SOUTH_AMERICA,",").concat(Vs.OCEANIA):Vs[e],Mme=e=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const o=cP[i],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(o[u]))})}),r},_P={GLOBAL:{ASIA:[Hn.CHINA,Hn.JAPAN,Hn.INDIA,Hn.KOREA,Hn.HKMC],EUROPE:[],NORTH_AMERICA:[Hn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},yP=Object.keys(_P[Hn.GLOBAL]),GL=[Hn.CHINA,Hn.NORTH_AMERICA,Hn.EUROPE,Hn.ASIA,Hn.JAPAN,Hn.INDIA,Hn.OCEANIA,Hn.SOUTH_AMERICA,Hn.AFRICA,Hn.KOREA,Hn.HKMC,Hn.US],Ume=function(e,r){let i=[];if(st(e).call(e,Hn.GLOBAL)){const u=[Hn.GLOBAL,Hn.OVERSEA],h=Object.keys(cP);if(r===Hn.GLOBAL)throw new Oe(te.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Hn.CHINA)i=[Hn.OVERSEA];else if(c=r,st(yP).call(yP,c)){const m=(o=r,_P[Hn.GLOBAL][o]||[]),_=[...u,r,...m];i=h.filter(E=>!st(_).call(_,E))}else if(function(m){let _=!1;return yP.forEach(E=>{var S;st(S=_P[Hn.GLOBAL][E]).call(S,m)&&(_=!0)}),_}(r)){const m=function(E){let S;return yP.forEach(R=>{var P;st(P=_P[Hn.GLOBAL][R]).call(P,E)&&(S=R)}),S}(r),_=[...u,m,r];i=h.filter(E=>!st(_).call(_,E))}else i=e;i=function(m){const _=[];return GL.forEach(E=>{st(m).call(m,E)&&_.push(E)}),_.concat(m.filter(E=>!st(GL).call(GL,E)))}(i)}else i=e;var o,c;return i};function C9(e){var r,i;if(!e&&st(r=oe("AREAS")).call(r,Hn.EXTENSIONS))return x.debug("update area from ap : reset"),void HL($fe,!0);if(!st(i=oe("AREAS")).call(i,Hn.GLOBAL)||!e)return;let o=cP.EXTENSIONS;o&&(o={CODE:w9(Hn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},x.debug("update area from ap success: ".concat(e,",config is "),o),rr("AREAS",[Hn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?rr(c,o[c][0]):rr(c,o[c])}))}function HL(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=At.reportApiInvoke(null,{name:Ri.SET_AREA,options:e,tag:Wr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!st(HG).call(HG,u))throw new Oe(te.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new Oe(te.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?Ume(m,h):m}if(!r){if(_d.AREAS){const u=new Oe(te.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void x.warning("setArea is prohibited because of config-distribute")}if(st(o).call(o,Hn.GLOBAL)&&oe("AREAS")===Hn.EXTENSIONS){const u=new Oe(te.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void x.warning("setArea is prohibited because of ap extensions")}}rr("AREAS",o,r);const c=Mme(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?rr(u,c[u][0]):rr(u,c[u])}),x.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function R9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Sh(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?R9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):R9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let $L=1;function Vme(e,r,i,o,c){$L+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:$L,requestId:$L,version:Rl,cname:i.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,_,E=e[0];return gd(async()=>{m=Date.now();const S=await Sd(E,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,S.code!==0){const N=new Oe(te.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw x.error(N.toString()),N}const R=JSON.parse(S.json_body);if(R.code!==200){const N=new Oe(te.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:_});throw x.error(N.toString()),N}if(!R.servers||R.servers.length===0){const N=new Oe(te.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:_});throw x.error(N.toString()),N}const P=function(N,G){return{addressList:N.servers.map(F=>"wss://".concat(F.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(F.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:N.workerToken,vid:N.vid}}(R,r);return oe("LIVE_STREAMING_ADDRESS")&&(P.addressList=oe("LIVE_STREAMING_ADDRESS")instanceof Array?oe("LIVE_STREAMING_ADDRESS"):[oe("LIVE_STREAMING_ADDRESS")]),Sh(Sh({},P),{},{responseTime:_})},(S,R)=>(At.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:_,serverIp:e[R%e.length]}),!1),(S,R)=>(At.apworkerEvent(i.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:_,serverIp:e[R%e.length]}),!!(S.code!==te.OPERATION_ABORTED&&S.code!==te.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(E=e[(R+1)%e.length],!0)),c)}let KL=1;function I9(e,r,i,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:m}=r,_=Date.now();let E;const S=r.role,[R,P]=YL(r,u,[yi.CHOOSE_SERVER]);let N=_i.networkState;return gd(async()=>{N&&_i.networkState===mc.OFFLINE&&_i.onlineWaiter&&await ut.race([_i.onlineWaiter,hs(o&&o.maxRetryTimeout||Ii.maxRetryTimeout)]),N=_i.networkState;const{data:G,headers:F}=await Sd(c,{data:R,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=F.http3==="1"?1:-1,At.reportResourceTiming(c,m),P9(G,c,r,_,[yi.CHOOSE_SERVER],E);const j=NT(G,yi.CHOOSE_SERVER);return qL(j),UL(j,c)},G=>(G&&At.joinChooseServer(m,{role:S,lts:_,succ:!0,csAddr:c,opid:P,serverList:G.gatewayAddrs.map(F=>F.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[yi.CHOOSE_SERVER].toString(),isHttp3:E,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==te.OPERATION_ABORTED&&(G.code===te.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(At.joinChooseServer(m,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:P,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[yi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:N}),isHttp3:E,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),o)}function A9(e,r,i,o){let c,{url:u,areaCode:h,serviceIds:m}=e;const _=Date.now(),E=r.role,[S,R]=YL(r,h,m);let P;return gd(async()=>{P&&_i.networkState===mc.OFFLINE&&_i.onlineWaiter&&await ut.race([_i.onlineWaiter,hs(o&&o.maxRetryTimeout||Ii.maxRetryTimeout)]),P=_i.networkState;const{data:N,headers:G}=await Sd(u,{data:S,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,At.reportResourceTiming(u,r.sid),P9(N,u,r,_,m,c);const F=NT(N,yi.CHOOSE_SERVER),j=NT(N,r.cloudProxyServer==="proxy5"?yi.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?yi.CLOUD_PROXY:yi.CLOUD_PROXY_FALLBACK);return qL(F),{gatewayInfo:UL(F,u),proxyInfo:j,url:u}},N=>(N.gatewayInfo&&At.joinChooseServer(r.sid,{role:E,lts:_,succ:!0,csAddr:u,serverList:N.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:R,cid:N.gatewayInfo.cid.toString(),uid:N.gatewayInfo.uid.toString(),csIp:N.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:N.gatewayInfo.res.detail&&N.gatewayInfo.res.detail[38]}),N.proxyInfo&&At.joinWebProxyAP(r.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:N.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),N=>N.code!==te.OPERATION_ABORTED&&(N.code===te.CAN_NOT_GET_GATEWAY_SERVER?N.data.retry:(At.joinWebProxyAP(r.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:N.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),N),!0)),o)}const P9=(e,r,i,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:_}=i,E=[],S=R=>{R.flag===4096?At.joinChooseServer(h,{role:i.role,lts:o,succ:!1,csAddr:r,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||At.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const N={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:R.buffer.flag};E.push(N),S(N)}if(P!==0){const N=Qv(P),G={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,N.desc,{desc:N.desc,retry:N.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(G.error.toString()):E.push(G),S(G)}}),E.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(E.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,E.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!E.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(E.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},qL=e=>{var r,i,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(oe("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?C9(e.detail[23].toLowerCase()):C9()),(r=e.detail)!==null&&r!==void 0&&r[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const h=e.detail[19],m=h==null?void 0:h.split(";");for(let _=0;_<m.length;_++){var u;const E=ho(u=m[_]).call(u);e.addresses[_]&&m&&(e.addresses[_].fingerprint=E)}}if(oe("GATEWAY_ADDRESS")&&oe("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",oe("GATEWAY_ADDRESS"));const h=oe("GATEWAY_ADDRESS").map(m=>{var _,E;const S=(_=(E=e.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||E===void 0?void 0:E.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},Fme=(e,r)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const o=Qv(i.buffer.code);throw new Oe(te.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new Oe(te.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},YL=(e,r,i)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Sh(Sh(Sh({6:e.stringUid,11:r,12:oe("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},jme=(e,r)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:r,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]};let nS=0;function rS(e){return ut.all(e.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}const UT=async e=>{let{fragementLength:r,referenceList:i,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const m=r;let _,E=0;const S=async()=>{const R=(()=>{const P=h*m,N=P+m;return i.slice(P,N).map(o)})();u&&u.push(...R);try{_=await rS(R)}catch(P){if(E+=m,h++,!(E>=i.length))return void await S();c(P)}R.forEach(P=>P.cancel())};return await S(),_},O9=async e=>{let{referenceList:r,asyncMapHandler:i,closeFn:o}=e;const c=r.length;let u=0;const h=async()=>{const m=i(r.shift());try{return await m}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function XL(e,r,i,o){return{gatewayInfo:await async function(u,h,m,_){let E=null;const S=[],R=async()=>{const N=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:MT()})),G=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),F=await UT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to choose_server:"),j.url),I9(j,u,h,m)),allFailedhandler:j=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F},P=async()=>{if(await hs(1e3),E!==null)return E;const N=oe("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:MT()})),G=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),F=await UT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),j.url),I9(j,u,h,m)),allFailedhandler:j=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F};try{return E=await rS([R(),P()]),S.length&&S.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),E}catch(N){throw N[0]}}(e,r,i,o)}}async function k9(e,r,i,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await XL(e,r,i,c);if(oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:N}=await x9(e,r,i,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:P};const G=N.map(F=>({turnServerURL:F.address,tcpport:F.tcpport||Os.tcpport,udpport:F.udpport||Os.udpport,username:F.username||Os.username,password:F.password||Os.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const F=(h=e.uid)!==null&&h!==void 0?h:P.uid,j="glb:".concat(F.toString()),q=await zx(j),ee=N.map(he=>({turnServerURL:he.address,tcpport:he.tcpport||Os.tcpport,udpport:he.udpport||Os.udpport,username:j,password:q,forceturn:!1,security:!0}));G.push(...ee)}return e.turnServer={mode:"manual",servers:G},{gatewayInfo:P}}return await XL(e,r,i,c)}const{proxyInfo:m,gatewayInfo:_}=await x9(e,r,i,c),E={gatewayInfo:_},S=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:Os.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:Os.udpport,username:P.username||Os.username,password:P.password||Os.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const P=(R=e.uid)!==null&&R!==void 0?R:_.uid,N="glb:".concat(P.toString()),G=await zx(N),F=m.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||Os.tcpport,udpport:u==="proxy4"?void 0:j.udpport||Os.udpport,username:N,password:G,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...F)}return e.turnServer={mode:"manual",servers:S},x.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),E}async function N9(e,r,i,o,c){const u=oe("ACCOUNT_REGISTER").slice(0,oe("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(_=>"https://".concat(r.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(E,S,R,P,N){const G=Date.now(),F={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let j=E[0];const q=await gd(()=>Sd(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:F,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(ee,he)=>{if(ee.code===0){if(ee.uid<=0||ee.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(S," => ").concat(ee.uid),ee),At.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:j,stringUid:F.string_uid,uid:ee.uid,errorCode:te.INVALID_UINT_UID_FROM_STRING_UID,extend:F}),new Oe(te.INVALID_UINT_UID_FROM_STRING_UID);return At.reqUserAccount(F.sid,{lts:G,success:!0,serverAddr:j,stringUid:F.string_uid,uid:ee.uid,errorCode:null,extend:F}),!1}const Se=Qv(ee.code);return Se.retry&&(j=E[(he+1)%E.length]),At.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:j,stringUid:F.string_uid,uid:ee.uid,errorCode:Se.desc,extend:F}),Se.retry},(ee,he)=>ee.code!==te.OPERATION_ABORTED&&(At.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:j,stringUid:F.string_uid,uid:null,errorCode:ee.code,extend:F}),j=E[(he+1)%E.length],!0),N);if(q.code!==0){const ee=Qv(q.code);throw new Oe(te.UNEXPECTED_RESPONSE,ee.desc)}return q}(h,e,r,i,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function Bme(e,r,i){const o=oe("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await O9({referenceList:c,asyncMapHandler:h=>async function(m,_,E,S){const R=Date.now(),P={sid:E.sid,opid:10,appid:E.appId,string_uid:_};try{const N=await Sd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(N.code!==0){const G=Qv(N.code);throw new Oe(te.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(N.uid<=0||N.uid>=Math.pow(2,32))throw new Oe(te.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:N.uid,elapse:Date.now()-R}}catch(N){throw N}}(h,e,r,i),closeFn:h=>h.code===te.OPERATION_ABORTED||h.code===te.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function Wme(e,r,i){const o=oe("CDS_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(E,S,R,P){const N=Dn(),G={flag:64,cipher_method:0,features:Sh(Sh(Sh(Sh(Sh({install_id:eL(),device:N.name,system:N.os,system_general:navigator.userAgent,vendor:S.appId,version:Rl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:Dme.WEB_RTC,browser_name:N.name,browser_version:N.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),N.os&&{os_name:N.os}),N.osVersion&&{os_version:N.osVersion}),{},{detail:""})};return gd(()=>Sd(E,{data:G,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,F=>F.code!==te.OPERATION_ABORTED,P)}(_,e,r,i));let u=null,h=null,m={};try{u=await rS(c)}catch(_){if(_.code===te.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),At.reportApiInvoke(e.sid,{name:Ri.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(_){if(!_.test_tags)return{};const E=_.test_tags,S=Object.keys(E),R={};return S.forEach(P=>{var N;const G=ho(N=P.slice(4)).call(N),F=JSON.parse(E[P]),j=F[1];R[G]={tag:F[0]||"",value:j}}),R}(u)}catch{}return m}async function D9(e,r){const i=oe("WEBCS_DOMAIN").concat(oe("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:MT(),serviceIds:[yi.CHOOSE_SERVER,yi.CLOUD_PROXY_FALLBACK]}));try{return await O9({referenceList:i,asyncMapHandler:c=>async function(u,h,m){let _,{url:E,areaCode:S,serviceIds:R}=u;const P=Date.now(),[N,G]=YL(h,S,R);let F=_i.networkState;try{F&&_i.networkState===mc.OFFLINE&&_i.onlineWaiter&&await ut.race([_i.onlineWaiter,hs(Ii.maxRetryTimeout)]),F=_i.networkState;const{data:j,headers:q}=await Sd(E,{data:N,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=q.http3==="1"?1:-1,(we=>{const ye=[];if(we.response_body.forEach(Ne=>{const Ye=Ne.buffer.code;if(Ne.uri===23&&Ye===0&&!Ne.buffer.edges_services)if(Ne.buffer.flag===4194310)Ne.buffer.edges_services=[];else{const dt={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:we.detail[502]}),flag:Ne.buffer.flag};ye.push(dt)}if(Ye!==0){const dt=Qv(Ye),ft={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,dt.desc,{desc:dt.desc,retry:dt.retry,csIp:we.detail[502]}),flag:Ne.buffer.flag};Ne.buffer.flag===4194310?x.warning(ft.error.toString()):ye.push(ft)}}),ye.length)throw new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,ye.map(Ne=>"flag: ".concat(Ne.flag,", message: ").concat(Ne.error.message)).join(" | "),{retry:!!ye.find(Ne=>Ne.error.data.retry),csIp:we.detail[502],desc:[...new Set(ye.map(Ne=>{var Ye;return Ne==null||(Ye=Ne.error)===null||Ye===void 0||(Ye=Ye.data)===null||Ye===void 0?void 0:Ye.desc}).filter(Ne=>!!Ne))]})})(j);const he=NT(j,yi.CHOOSE_SERVER),Se=NT(j,yi.CLOUD_PROXY_FALLBACK);return qL(he),{gatewayInfo:UL(he,E),proxyInfo:Se,opid:G,requestTime:P,url:E,isHttp3:_,elapse:Date.now()-P}}catch(j){throw j}}(c,e,r),closeFn:c=>c.code===te.OPERATION_ABORTED||c.code===te.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function x9(e,r,i,o){const c=oe("PROXY_SERVER_TYPE3"),u=(N,G,F)=>{let j=F||c;return Array.isArray(j)&&(j=G%2==0?c[1]:c[0]),"https://".concat(j,"/ap/?url=").concat(N)};let h=null;const m=[],_=async()=>{const N=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((j,q)=>{let ee;return ee=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),q),{url:ee,areaCode:MT(),serviceIds:[yi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?yi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?yi.CLOUD_PROXY:yi.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),F=await UT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(x.debug("[".concat(e.clientId,"] Connect to choose_server:"),j.url),A9(j,e,r,i)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F},E=async()=>{if(await hs(1e3),h!==null)return h;const N=oe("WEBCS_DOMAIN_BACKUP_LIST").map((j,q)=>{let ee;return ee=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),q),{url:ee,areaCode:MT(),serviceIds:[yi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?yi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?yi.CLOUD_PROXY:yi.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),F=await UT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(x.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),j.url),A9(j,e,r,i)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F};let S,R,P;try{({gatewayInfo:S,proxyInfo:R,url:P}=await rS([_(),E()]))}catch(N){throw N[0]}if(m.length&&m.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),!S||!R)throw new Oe(te.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=P,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const N=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];st(c).call(c,N)&&(e.proxyServer=N,x.setProxyServer(N),At.setProxyServer(N))}return h={gatewayInfo:S,proxyInfo:await i9(R,S.uid)},h}async function zme(e,r,i){const o=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,_,E){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Rl,cname:m.cname,uid:m.uid.toString(),requestId:KL,seq:KL};KL+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return gd(async()=>{const P=await Sd(h,{data:R,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw x.error(G.toString()),G}const N=JSON.parse(P.json_body);if(N.code!==200){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(N.code,", reason: ").concat(N.reason));throw x.error(G.toString()),G}if(!N.servers||N.servers.length===0){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(G.toString()),G}return{vid:N.vid,workerToken:N.workerToken,addressList:(oe("CHANNEL_MEDIA_RELAY_SERVERS")||N.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,P=>!!(P.code!==te.OPERATION_ABORTED&&P.code!==te.UNEXPECTED_RESPONSE||P.data&&P.data.retry),E)}(u,e,r,i));try{const u=await rS(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function Gme(e,r,i){let o=null;const c=[],u=async h=>{const m=oe(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await hs(1e3),o!==null)?o:await UT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(x.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(E,S,R,P){const[N]=jme(S,[yi.CHOOSE_SERVER]);let G=_i.networkState;return gd(async()=>{G&&_i.networkState===mc.OFFLINE&&_i.onlineWaiter&&await ut.race([_i.onlineWaiter,hs(P&&P.maxRetryTimeout||Ii.maxRetryTimeout)]),G=_i.networkState;const F=await Sd(E,{data:N,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return Fme(F,E)},()=>!1,F=>F.code!==te.OPERATION_ABORTED&&(F.code===te.UPDATE_TICKET_FAILED?F.data.retry:(x.warning("[".concat(S.clientId,"] update ticket network error, retry"),F),!0)),P)}(_,e,r,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await rS([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function L9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function JL(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?L9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):L9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Hme extends Mr{get isSuccess(){return!!this.configs}constructor(r,i){super(),K(this,"configs",void 0),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"cancelToken",void 0),K(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),K(this,"interval",void 0),K(this,"mutex",void 0),K(this,"mutableParamsRead",!1),K(this,"configCache",{}),K(this,"limit_bitrate",void 0),this.mutex=new Us("config-distribute",r),this.store=i}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),oe("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},oe("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,At.reportApiInvoke(null,{options:void 0,name:Ri.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Wr.TRACER}).onSuccess(JSON.stringify(_d))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const i=await this.mutex.lock();try{r=await Wme(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var u;const h=iT(u=Object.keys(c).filter(E=>/^webrtc_ng_global_parameter/.test(E))).call(u);for(let E=0;E<h.length;E++)for(let S=h.length-1;S>E;S--){const R=h[S],P=c[R].value;if(typeof P.__priority=="number"){const N=P.__priority,G=h[S-1],F=c[G].value;if(typeof F.__priority=="number"){if(!(N>F.__priority))continue;{const j=R;h[S]=h[S-1],h[S-1]=j}}else{const j=R;h[S]=h[S-1],h[S-1]=j}}}const m=Date.now();let _={};return h.forEach(E=>{const S=c[E].value.__expires;S&&S<=m||(_[E]=c[E])}),_}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Oe(te.NETWORK_RESPONSE_ERROR,o);x.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){$G(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(PT.UPDATE_BITRATE_LIMIT,r):this.emit(PT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&JL({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const i={},o=Object.keys(r),c=[];o.forEach(u=>{const h=r[u].value;i[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const _=h.__type,E=r[u].value,S=r[u].tag;let R=0;_?_===SW.REALTIME&&(R=1):Object.keys(E).some(P=>Object.prototype.hasOwnProperty.call(iL,P)||!IL()&&Object.prototype.hasOwnProperty.call(jA,P)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:_,isApplied:E}=u;this.store.sessionId&&At.abTest(this.store.sessionId,{intSucc:1,isApplied:E,tag:h,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){x.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(r){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,_=m.__expires,E=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=JL(JL({value:m[S]},_&&{expires:_}),E&&{type:E}))})}),u}(r);try{var o;const c=(o=i.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete i.LIMIT_BITRATE,c&&$G(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(r),function(m){try{const _=Date.now();Object.keys(m).forEach(E=>{const{value:S,type:R,expires:P}=m[E];P&&P<=_||((R===SW.REALTIME||Object.prototype.hasOwnProperty.call(iL,E))&&(_d[E]=S,Sr[E]=S,x.debug("Update realtime parameters from config distribute",E,S)),R||IL()||!Object.prototype.hasOwnProperty.call(jA,E)||(_d[E]=S,Sr[E]=S,x.debug("Update gateway parameters from config distribute",E,S)))})}catch(_){x.error("Error update config immediately: ".concat(m),_.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(u))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const i=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Sr,o)){const{value:c,expires:u}=r[o];if(u&&u<=i)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(Sr[o],c)||(_d[o]=c,Sr[o]=c,this.emit(PT.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(i){x.error("Error handling global parameter config:",i.message)}}}class $me extends Mr{constructor(){super(...arguments),K(this,"resultStorage",new Map)}setLocalAudioStats(r,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(r,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,i){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(r,i,o){if(oe("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=st(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",M9[r],r,i),!c.isPrevNormal&&h&&this.emit("exception",M9[r]+2e3,r+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,i){return i instanceof Li&&!i.isActive||!!i.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=gc(i._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,i){return!!i.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,i){return i instanceof Li&&!i.isActive||!!i.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const M9={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},js=new class{markSubscribeStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(r))}markPublishStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(r))}measureFromSubscribeStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(r));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(r));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function U9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function G_(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?U9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):U9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class VT{constructor(r){K(this,"store",void 0),K(this,"onStatsException",void 0),K(this,"onUploadPublishDuration",void 0),K(this,"onStatsChanged",void 0),K(this,"localStats",new Map),K(this,"remoteStats",new Map),K(this,"updateStatsInterval",void 0),K(this,"trafficStats",void 0),K(this,"trafficStatsPeerList",[]),K(this,"uplinkStats",void 0),K(this,"exceptionMonitor",void 0),K(this,"p2pChannel",void 0),K(this,"scalabilityMode",FA.L1T1),K(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new $me,this.exceptionMonitor.on("exception",(i,o,c)=>{this.onStatsException&&this.onStatsException(i,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ke.LocalAudioTrack)||G_({},lL)}getLocalVideoTrackStats(){return this.localStats.get(Ke.LocalVideoTrack)||G_({},uL)}getRemoteAudioTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(o[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRemoteNetworkQualityStats(r){const i={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(i[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getRemoteVideoTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(o[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRTCStats(){let r=0,i=0,o=0,c=0;const u=this.localStats.get(Ke.LocalAudioTrack);u&&(r+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get(Ke.LocalVideoTrack);h&&(r+=h.sendBytes,i+=h.sendBitrate);const m=this.localStats.get(Ke.LocalVideoLowTrack);m&&(r+=m.sendBytes,i+=m.sendBitrate),this.remoteStats.forEach(E=>{let{audioStats:S,videoStats:R}=E;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:i,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?js.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?js.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,o){if(!r)return!1;const c=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||i.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[o,c]=i;switch(o){case Ke.LocalVideoTrack:case Ke.LocalVideoLowTrack:{const h=c,m=G_({},uL),_=r.getStats(),E=r.getLocalMedia(o);if(_){const S=_.videoSend.find(R=>R.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){const R=r.getLocalVideoSize(),P=r.getEncoderConfig(Ke.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&E&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,E.track,m);break}case Ke.LocalAudioTrack:{const h=c,m=G_({},lL),_=r.getStats(),E=r.getLocalMedia(o);if(_){const S=_.audioSend.find(R=>R.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ke.LocalAudioTrack,m),m&&E&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,E.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:_}]=i;const E=m,S=h,R=_,P=G_({},NW),N=G_({},DW),G=G_({},Ofe),{audioTrack:F,videoTrack:j,audioSSRC:q,videoSSRC:ee}=r.getRemoteMedia(u);let he;he=this.store.useP2P?r.getStats(!0):r.getStats();const Se=(o=he)===null||o===void 0?void 0:o.audioRecv.find(Ye=>Ye.ssrc===q),we=(c=he)===null||c===void 0?void 0:c.videoRecv.find(Ye=>Ye.ssrc===ee),ye=this.trafficStats&&this.trafficStats.peer_delay.find(Ye=>Ye.peer_uid===u);if(Se&&(Se.codec!=="opus"&&Se.codec!=="aac"&&Se.codec!=="PCMU"&&Se.codec!=="PCMA"&&Se.codec!=="G722"||(P.codecType=Se.codec),Se.outputLevel?P.receiveLevel=Math.round(32767*Se.outputLevel):F&&(P.receiveLevel=Math.round(32767*F.getVolumeLevel())),P.receiveBytes=Se.bytes,P.receivePackets=Se.packets,P.receivePacketsLost=Se.packetsLost,P.receivePacketsDiscarded=Se.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=E?8*Math.max(0,P.receiveBytes-E.receiveBytes):0,P.totalDuration=E?E.totalDuration+1:1,P.totalFreezeTime=E?E.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=Se.jitterBufferMs,P.totalDuration>10&&VT.isRemoteAudioFreeze(F)&&(P.totalFreezeTime+=1)),we){var Ne;we.codec!=="H264"&&we.codec!=="H265"&&we.codec!=="VP8"&&we.codec!=="VP9"&&we.codec!=="AV1X"&&we.codec!=="AV1"||(N.codecType=we.codec),N.receiveBytes=we.bytes,N.receiveBitrate=S?8*Math.max(0,N.receiveBytes-S.receiveBytes):0,N.decodeFrameRate=we.decodeFrameRate<0?0:we.decodeFrameRate,N.renderFrameRate=we.decodeFrameRate<0?0:we.decodeFrameRate,we.outputFrame&&(N.renderFrameRate=we.outputFrame.frameRate),we.receivedFrame?(N.receiveFrameRate=we.receivedFrame.frameRate,N.receiveResolutionHeight=we.receivedFrame.height,N.receiveResolutionWidth=we.receivedFrame.width):j&&(N.receiveResolutionHeight=j._videoHeight||0,N.receiveResolutionWidth=j._videoWidth||0),we.framesRateFirefox!==void 0&&(N.receiveFrameRate=Math.round(we.framesRateFirefox)),N.receivePackets=we.packets,N.receivePacketsLost=we.packetsLost,N.packetLossRate=N.receivePacketsLost/(N.receivePackets+N.receivePacketsLost);const Ye=S?S.totalFreezeTime:0,dt=S?S.totalDuration:0;N.totalDuration=S?S.totalDuration+1:1,N.totalFreezeTime=(Ne=we.totalFreezesDuration)!==null&&Ne!==void 0?Ne:Ye||0,N.receiveDelay=we.jitterBufferMs||0;const ft=!!ee&&r.getRemoteVideoIsReady(ee);we.totalFreezesDuration===void 0&&j&&ft&&VT.isRemoteVideoFreeze(j,we,R)&&(N.totalFreezeTime+=1),N.freezeRate=Math.max(0,Math.min((N.totalFreezeTime-Ye)/(N.totalDuration-dt),1))}ye&&(P.end2EndDelay=ye.B_ad,N.end2EndDelay=ye.B_vd,P.transportDelay=ye.B_ed,N.transportDelay=ye.B_ed,P.currentPacketLossRate=ye.B_ealr4/100,N.currentPacketLossRate=ye.B_evlr4/100,G.uplinkNetworkQuality=ye.B_punq?ye.B_punq:0,G.downlinkNetworkQuality=ye.B_pdnq?ye.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:N,videoPcStats:we,networkStats:G}),F&&this.exceptionMonitor.setRemoteAudioStats(F,P),j&&this.exceptionMonitor.setRemoteVideoStats(j,N)})}}class V9{constructor(){K(this,"destChannelMediaInfos",new Map),K(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){GG(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){GG(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){sP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function F9(e){if(!(e instanceof V9))return new Oe(te.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!r)return new Oe(te.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new Oe(te.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Gm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,i){K(this,"uid",void 0),K(this,"_uintid",void 0),K(this,"_trust_in_room_",!0),K(this,"_trust_audio_enabled_state_",!0),K(this,"_trust_video_enabled_state_",!0),K(this,"_trust_audio_mute_state_",!0),K(this,"_trust_video_mute_state_",!0),K(this,"_audio_muted_",!1),K(this,"_video_muted_",!1),K(this,"_audio_enabled_",!0),K(this,"_video_enabled_",!0),K(this,"_audio_added_",!1),K(this,"_video_added_",!1),K(this,"_is_pre_created",!1),K(this,"_video_pre_subscribed",!1),K(this,"_audio_pre_subscribed",!1),K(this,"_trust_video_stream_added_state_",!0),K(this,"_trust_audio_stream_added_state_",!0),K(this,"_audioTrack",void 0),K(this,"_videoTrack",void 0),K(this,"_dataChannels",[]),K(this,"_audioSSRC",void 0),K(this,"_videoSSRC",void 0),K(this,"_audioOrtc",void 0),K(this,"_videoOrtc",void 0),K(this,"_cname",void 0),K(this,"_rtxSsrcId",void 0),K(this,"_videoMid",void 0),K(this,"_audioMid",void 0),this.uid=r,this._uintid=i}}function j9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function B9(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?j9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):j9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const FT="9",W9=4e4;function z9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function sf(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?z9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):z9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var iS=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(iS||{});const EP=new Map;function G9(e,r,i,o){let{scale:c}=e;if(c===0&&o===iS.UP||c>=r.length-1&&o===iS.DOWN)return e;let u=sf(sf({},e),{},{scale:o===iS.DOWN?++c:--c});switch(i){case"maintain-framerate":u=sf(sf({},u),r[c].motion);break;case"maintain-resolution":u=sf(sf({},u),r[c].detail);break;case"balanced":u=sf(sf({},u),r[c].balanced)}return u}function H9(e,r){if(r){const i={overUse:0,underUse:0,adaptationList:$9(r)};EP.set(e,i)}else EP.delete(e)}function $9(e){const r=sf({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:E,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:N,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:F,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:q,MOTION_RESOLUTION_FACTOR:ee,MOTION_BITRATE_FACTOR:he,DETAIL_FRAMERATE_FACTOR:Se,DETAIL_BITRATE_FACTOR:we}=nL,ye=Math.min(r.frameRate,m),Ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(N,1)*ye),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u}}];for(let Ye=1;Ye<=_;Ye++){const dt={bwe_up:Math.round(Math.pow(R,Ye)*i),bwe_down:Math.round(Math.pow(P,Ye+1)*i),fps_up:Math.round(Math.pow(G,Ye)*ye),fps_down:Math.round(Math.pow(N,Ye+1)*ye)},ft={scaleResolutionDownBy:c/Math.pow(q,Ye),frameRate:Math.max(Math.round(Math.pow(j,Ye)*o),h),bitrateMax:Math.max(Math.round(Math.pow(F,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(F,Ye)*u),E)},Rn={scaleResolutionDownBy:c/Math.pow(ee,Ye),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(he,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(he,Ye)*u),E)},In={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Se,Ye)*o),h),bitrateMax:Math.max(Math.round(Math.pow(we,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(we,Ye)*u),E)};Ne.push({scale:Ye,threshold:dt,balanced:ft,motion:Rn,detail:In})}return Ne}function Kme(e,r,i,o,c,u){const h=EP.get(e)||{overUse:0,underUse:0,adaptationList:$9(c)},{adaptationList:m}=h;EP.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:E}=nL,{scale:S}=o;let R,P;return typeof r=="number"&&r>0&&function(N,G,F,j){if(G>=F.length)return!1;let{threshold:{fps_down:q}}=F[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(q=F[0].threshold.fps_down),N<q}(r,S,m,u)&&(h.overUse++,P=TT.CPU,h.overUse>_)||typeof i=="number"&&i>0&&function(N,G,F){if(G>=F.length)return!1;const{threshold:{bwe_down:j}}=F[G];return N<j}(i,S,m)&&(h.overUse++,P=TT.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,R=G9(o,m,u,iS.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(N,G,F,j){if(G===0)return;let{threshold:{fps_up:q}}=F[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(q=F[1].threshold.fps_up),N>q}(r,S,m,u)&&function(N,G,F){if(G===0)return;const{threshold:{bwe_up:j}}=F[G];return N>j}(i,S,m)&&(h.underUse++,h.underUse>E&&(h.overUse=0,h.underUse=0,R=G9(o,m,u,iS.UP),R.scale===0&&(P=TT.NONE))),[R,P])}function K9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function QL(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?K9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):K9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function qme(e){var r;return!!oe("ENABLE_AG_ADAPTATION")&&!!(e instanceof EL||st(r=e._hints).call(r,hr.CUSTOM_TRACK))&&(!!oe("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){const o=Dn();if(o.os!==Ki.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=i}(14)&&z8(17,4)||W8(14)&&G8(17,4,!0)))}const vP=new Map;function SP(e,r){const i=vP.get(e);if(i){const{timer:o}=i;window.clearTimeout(o),vP.delete(e)}r.qualityLimitationReason=TT.NONE,H9(e)}function Yme(e,r){var i;let o;switch(r){case Ke.LocalAudioTrack:o=Xn.Audio;break;case Ke.LocalVideoTrack:o=st(i=e._hints).call(i,hr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:o=Xn.Low}return o}function ZL(e){const r=jn();if(e.some(i=>i._bypassWebAudio))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function e2(e,r){ZL(e);const i=new Li;return e.forEach(o=>i.addAudioTrack(o)),i}const Xme=!jn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&qp();function bP(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return Xme?(i={spec:r,store:e},nf("PlanBConnection").create(i)):new bh(r,e)}function t2(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function q9(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(vT(e.turnServer.servers))return!1;if(oe("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var On;function Y9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function bd(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Y9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Y9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let bh=(On=class dy extends qG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return st(i=Object.keys(BA)).call(i,r)}))]}constructor(r,i){super(r,i),K(this,"id",dr(5,"connection-")),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"forceTurn",!1),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"transportEventReceiver",void 0),K(this,"statsFilter",void 0),K(this,"extension",{useXR:oe("USE_XR")}),K(this,"localCapabilities",void 0),K(this,"remoteCodecs",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"isPreallocation",!1),K(this,"preSSRCMap",new Map),K(this,"dataStreamChannelMap",new Map),K(this,"establishPromise",void 0),K(this,"recoveredDataChannelIds",[]),K(this,"currentDataChannelId",1),K(this,"supportAV1RtpSpec",!1),K(this,"mutex",void 0),K(this,"qualityLimitationReason",TT.NONE),K(this,"isFirstConnected",!1),this.store=i,this.forceTurn=q9(r),this.mutex=new Us("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(dy.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Zx(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,jr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const i=this.preSSRCMap.get(r);if(i!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Wm(o.sdp),u=await f9({filterRTX:!oe("USE_PUB_RTX")&&!oe("USE_SUB_RTX"),filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterVideoCodec:oe("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=fP(u),this.initialOffer=o,oe("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:FA.L1T3}]});const E=await _.createOffer();if(!E.sdp)return void _.close();const S=ja(E.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&y9(o.sdp)&&(h=zr(u),(i=h).send&&(Zv(yt.VIDEO,i.send.videoExtensions),Zv(yt.AUDIO,i.send.audioExtensions)),i.recv&&(Zv(yt.VIDEO,i.recv.videoExtensions),Zv(yt.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(Zv(yt.VIDEO,i.sendrecv.videoExtensions),Zv(yt.AUDIO,i.sendrecv.audioExtensions))),bd(bd({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new Me(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var i}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&y9(this.initialOffer.sdp)&&(i=r.rtpCapabilities,o=this.localCapabilities,i.send&&(dP(yt.VIDEO,i.send.videoExtensions,o.send.videoExtensions),dP(yt.AUDIO,i.send.audioExtensions,o.send.audioExtensions)),i.recv&&(dP(yt.VIDEO,i.recv.videoExtensions,o.recv.videoExtensions),dP(yt.AUDIO,i.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return zr(this._localCapabilities)}get rtpCapabilities(){return zr(this._rtpCapabilities)}get candidates(){return zr(this._candidates)}get iceParameters(){return zr(this._iceParameters)}get dtlsParameters(){return zr(this._dtlsParameters)}constructor(E){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_originCandidates",void 0),K(this,"_iceParameters",void 0),K(this,"_isUseExtmapAllowMixed",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),K(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,E=zr(E);const{iceParameters:R,dtlsParameters:P,candidates:N,rtpCapabilities:G,setup:F,localCapabilities:j,cname:q}=E;this._rtpCapabilities=G,this._candidates=N,this._originCandidates=zr(N),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=j,this.setup=F,this.cname=q,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(E){const S=this.candidates,R=this.dtlsParameters,P=this.iceParameters,N=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let F=1;F<E;F++){const j=2*F+2e4,q=2*F+W9,{ssrcs:ee,ssrcGroups:he}=z_([{ssrcId:j}],this.cname),{ssrcs:Se,ssrcGroups:we}=z_([{ssrcId:q,rtx:oe("USE_SUB_RTX")?q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:FT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.videoCodecs.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:N.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Se,ssrcGroups:we,rtcpFeedbackWildcards:[],payloads:N.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:FT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.audioCodecs.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:N.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ee,ssrcGroups:he,rtcpFeedbackWildcards:[],payloads:N.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Um(this.sessionDesc)}send(E,S,R,P){const{ssrcs:N,ssrcGroups:G}=z_(S,this.cname,oe("SYNC_GROUP")?R:void 0),F=this.findPreloadMediaDesc(N);if(F){if(jr()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,F.attributes.mid),P&&(P.twcc||P.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(F);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(F,P),{mid:F.attributes.mid,needExchangeSDP:!0}}return{mid:F.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(E,N);let q;return j===-1||j===1&&(Is()||function(){const ee=Dn();return!(ee.name!==Gn.CHROME||!ee.osVersion)&&Number(ee.version)<=90}()||oe("ENABLE_ENCODED_TRANSFORM")&&Kp())||j===0&&oe("USE_SUB_RTX")||H8()?(q=this.createOrRecycleSendMedia(E,N,G,"sendonly",P),this.updateBundleMids()):(q=zr(this.sessionDesc.mediaDescriptions[j]),q.attributes.direction="sendonly",q.attributes.ssrcs=N,q.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(q,P)),jr()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,q.attributes.mid),{mid:q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:E,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:E.attributes.mid,needExchangeSDP:S}}batchSend(E){const S=E.map(N=>{let{kind:G,ssrcMsg:F,mslabel:j}=N;return this.send(G,F,j)}),R=[];let P=!1;return S.forEach(N=>{let{mid:G,needExchangeSDP:F}=N;F&&(P=!0),R.push(G)}),{mids:R,needExchangeSDP:P}}stopSending(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&E.indexOf(R.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||jr()||H8()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(E){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(E){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(E).call(E,R.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(E).call(E,R.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(E,S,R,P){E.forEach((N,G)=>{this.createOrRecycleRecvMedia(N,[],"recvonly",S,R,P[G])}),this.updateBundleMids()}stopReceiving(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>E.indexOf(R.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(E){const S=this.sessionDesc||ja((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=E;const P=this.rtpCapabilities.send,N=this.localCapabilities.send;for(const G of S.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(P.videoCodecs.length===0){const F=N.videoCodecs.filter(j=>{var q,ee;return(q=j.rtpMap)===null||q===void 0?void 0:st(ee=q.encodingName.toLowerCase()).call(ee,"vp8")})||[N.videoCodecs[0]];G.media.fmts=F.map(j=>j.payloadType.toString(10)),G.attributes.payloads=F,G.attributes.extmaps=[]}else if(G.media.fmts=P.videoCodecs.map(F=>F.payloadType.toString(10)),G.attributes.payloads=P.videoCodecs,G.attributes.extmaps=P.videoExtensions,oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:F,ssrcGroups:j}=z_([{ssrcId:W9,rtx:oe("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=F,G.attributes.ssrcGroups=j}}if(G.media.mediaType==="audio"){if(P.audioCodecs.length===0){const F=N.audioCodecs.filter(j=>{var q,ee;return(q=j.rtpMap)===null||q===void 0?void 0:st(ee=q.encodingName.toLowerCase()).call(ee,"opus")})||[N.audioCodecs[0]];G.media.fmts=F.map(j=>j.payloadType.toString(10)),G.attributes.payloads=F,G.attributes.extmaps=[]}else if(G.media.fmts=P.audioCodecs.map(F=>F.payloadType.toString(10)),G.attributes.payloads=P.audioCodecs,G.attributes.extmaps=P.audioExtensions,tS(G),oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:F,ssrcGroups:j}=z_([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=F,G.attributes.ssrcGroups=j}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(E){const S=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(S.forEach(P=>{R.push(B9(B9({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(E){case Fs.TCP_RELAY:this._candidates=R;break;case Fs.UDP_TCP_RELAY:case Fs.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(E){E=zr(E),this._iceParameters=E,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=E.iceUfrag,S.attributes.icePwd=E.icePwd})}predictReceivingMids(E){const S=[];for(let R=0;R<E;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(E,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===E&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(jr()){if(P){const N=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(N||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!N||N!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const E="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:FT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(E),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(E,S,R,P,N,G){const F=E._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,q=xT(F,j,this.localCapabilities.send,F===yt.VIDEO?P:N),ee=F===yt.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const he="".concat(this.currentMidIndex);let Se={media:{mediaType:F,port:FT,protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(he)}};Se=this.mungRecvMediaDsec(Se,E,G);const we=this.findFirstClosedMedia(F);if(we){const ye=this.sessionDesc.mediaDescriptions.indexOf(we);this.sessionDesc.mediaDescriptions[ye]=Se}else this.sessionDesc.mediaDescriptions.push(Se);return Se}updateRemoteCodec(E,S,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Se=>Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||"").filter(Se=>{var we;return st(we=Object.keys(BA)).call(we,Se)}))],N=new Set(S);if(P.every(Se=>N.has(Se)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(Se=>S.some(we=>{var ye;return st(ye=Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||"").call(ye,we)}));if(G.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const F=[...new Set(G.map(Se=>Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||""))];let j;if(x.debug("updateRemoteCodec, from ".concat(P," to ").concat(F)),E.length===0)j=this.sessionDesc.mediaDescriptions.filter(Se=>Se.media.mediaType==="video"&&Se.attributes.direction==="recvonly");else if(j=this.sessionDesc.mediaDescriptions.filter(Se=>Se.attributes.mid&&st(E).call(E,Se.attributes.mid)&&Se.attributes.direction==="recvonly"),j.length!==E.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(E,", codecs: ").concat(S)),!1;if(oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const Se=BL(G,this.rtpCapabilities.recv.videoCodecs);G.push(...Se)}this._rtpCapabilities.recv.videoCodecs=G;const q=this.localCapabilities.send,ee=this.rtpCapabilities.recv,he=xT(yt.VIDEO,ee,q,R);return j.forEach(Se=>{const we=he.map(ye=>ye.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(Se.attributes.mid,", from"),Se.attributes.payloads,"to",he),Se.attributes.payloads=he,Se.media.fmts=we}),!0}createOrRecycleSendMedia(E,S,R,P,N){const G=this.rtpCapabilities.send,F=E===yt.VIDEO?G.videoCodecs:G.audioCodecs,j=E===yt.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const q="".concat(this.currentMidIndex);let ee={media:{mediaType:E,port:FT,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map(Se=>Se.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};ee=this.mungSendMediaDesc(ee,N);const he=this.findFirstClosedMedia(E);if(he){const Se=this.sessionDesc.mediaDescriptions.indexOf(he);this.sessionDesc.mediaDescriptions[Se]=ee}else this.sessionDesc.mediaDescriptions.push(ee);return ee}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(E=>E.media.port!=="0").map(E=>E.attributes.mid)}mungRecvMediaDsec(E,S,R){const P=zr(E);return FL(P),eS(P,S),jL(P,S),h9(P),pP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(E,S){const R=zr(E);return pP(R,S,this.localCapabilities.recv),tS(R),R}updateRecvMedia(E,S){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===E);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(E){this.currentMidIndex+=E}findFirstClosedMedia(E){return this.sessionDesc.mediaDescriptions.find(S=>jr()?S.media.port==="0"&&S.media.mediaType===E:S.media.port==="0")}findPreloadMediaDesc(E){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===E[0].ssrcId})}getSSRC(E){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E))===null||S===void 0?void 0:S.attributes.ssrcs}}(bd(bd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=g9(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),oe("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(oe("PRELOAD_MEDIA_COUNT"));const E=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:E});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=r;if(Array.isArray(_)&&_.length>0){const{mids:E}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));E.forEach((S,R)=>{this.preSSRCMap.set(_[R].ssrcId,S)}),await LT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var i,o}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=r;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await LT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,o){var c=this;return Cl(function*(){const u=yield Nn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=uP();r.forEach(j=>{const q=c.peerConnection.addTransceiver(j._mediaStreamTrack,bd({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(q),j._updateRtpTransceiver(q)}),jr()&&oe("SIMULCAST")===!0&&(yield Nn(c.applySimulcastForFirefox(h,r)));const _=yield Nn(c.peerConnection.createOffer()),E=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(_.sdp,r,E),R=ja(S),P=E.map(j=>{const q=R.mediaDescriptions.find(ee=>ee.attributes.mid===j);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return l9(q,oe("USE_PUB_RTX"))});let N;try{N=yield P}catch(j){N=[],c.remoteSDP.receive(r,i,o,N);const q=c.remoteSDP.toString();throw yield Nn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Nn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Nn(c.stopSending(E,!0)),j}c.remoteSDP.receive(r,i,o,N);const G=c.remoteSDP.toString(),F=c.logSDPExchange(S,"offer","local","send");return yield Nn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Nn(c.applySimulcastEncodings(h,r)),yield Nn(c.applySendEncodings(h,r)),F==null||F(G),yield Nn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((j,q)=>{const ee=E[q];return{localSSRC:P[q],id:ee,transceiver:j}})}catch(h){throw h instanceof Me?h:new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:oe("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}i.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Me?o:new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof Me?i:new Me(te.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var E;SP(this.id+_.mid,this),_.direction="inactive",(E=_.stop)===null||E===void 0||E.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);h&&(await LT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await LT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,_]=h;if(_===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Cl(function*(){const o=yield Nn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=jn().supportPCSetConfiguration,u=oe("FORCE_TURN_TCP")||i.forceTurn;if(r===Fs.RELAY&&!c)return;if(c&&!u){const R=r===Fs.RELAY?"relay":"all",P=i.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(x.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,i.peerConnection.setConfiguration(P))}i.remoteSDP.updateCandidates(r);const h=yield Nn(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Wm(h.sdp),{remoteIceParameters:_}=yield m.iceParameters;i.remoteSDP.restartICE(_);const E=i.remoteSDP.toString(),S=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Nn(i.peerConnection.setLocalDescription(h)),S==null||S(E),yield Nn(i.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){x.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Fs.TCP_RELAY),await LT(this.peerConnection,this.remoteSDP,this.extension)}catch(i){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{SP(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return bd(bd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Me(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(i)?jr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:bd(bd({},gh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:bd(bd({},gh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(vT(r.turnServer.servers)?i.iceServers=r.turnServer.servers:oe("NEW_TURN_MODE")&&i.iceServers?(oe("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...dy.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...dy.newTurnServerConfigToIceServers(r.turnServer.servers)),oe("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...dy.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...dy.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),oe("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&jn().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(jm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!oe("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{const c=oe("NEW_TURN_MODE");c===1?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(jm(o.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(jm(o.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=i.iceTransport;o&&(o.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o,c;if(i||(i=this.peerConnection.getSenders().find(j=>j.track===r._mediaStreamTrack)),!i)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(F,j){return F.getTransceivers().find(q=>q.sender.track===j||q.receiver.track===j)}(this.peerConnection,r._mediaStreamTrack),_=Lfe(r);if(qme(r)&&m&&i&&_&&this.getLocalVideoStats&&st(o=["vp8","vp9"]).call(o,this.store.codec)){var E;const F=u.degradationPreference||(st(E=r._hints).call(E,hr.CUSTOM_TRACK)?oe("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(j,q,ee,he,Se,we){if(SP(j,ee),Se(q),he!=="balanced"&&he!=="maintain-framerate"&&he!=="maintain-resolution")return;let ye=-1;H9(j,q);const Ne=window.setInterval(()=>{const dt=vP.get(j);if(!oe("ENABLE_AG_ADAPTATION")||!dt)return SP(j,ee),void Se(q);const ft=we();if(ft.sendPackets>0&&ft.OutgoingAvailableBandwidth>0){if(ye===-1)return void(ye=Date.now());if(Date.now()-ye<1e3)return;const Rn=ft.sendFrameRate,In=ft.OutgoingAvailableBandwidth,[pr,ai]=Kme(j,Rn,In,dt.adaptationConfig,q,he);ai&&(ee.qualityLimitationReason=ai),pr&&dt.adaptationConfig.scale!==pr.scale&&(x.debug("[".concat(j,"] applyAdaptation: ").concat(ee.qualityLimitationReason,`
           sendFps `).concat(Rn,", bwe ").concat(In,", switch from ").concat(dt.adaptationConfig.scale," to ").concat(pr.scale," ")),dt.adaptationConfig=QL(QL({},dt.adaptationConfig),pr),Se(pr))}},oe("CHECK_LOCAL_STATS_INTERVAL")),Ye=QL({},q);vP.set(j,{timer:Ne,adaptationConfig:Ye,originConfig:q,adaptationFunc:Se}),x.debug("[".concat(j,"] start adaptation, originConfig: ").concat(JSON.stringify(q),", degradationPreference: ").concat(he))})(this.id+m.mid,_,this,F,j=>{i&&this.updateAdaptation(i,j)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:F,frameRate:j,scaleResolutionDownBy:q}=r._encoderConfig;F&&(h.maxBitrate=1e3*F),(st(S=r._hints).call(S,hr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(j&&(h.maxFramerate=gc(j)),q&&q>=1&&(h.scaleResolutionDownBy=q))}const{maxFramerate:R}=oe("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),oe("DSCP_TYPE")&&qp()){var P;const F=oe("DSCP_TYPE");st(P=["very-low","low","medium","high"]).call(P,F)&&(h.networkPriority=F)}const N=i.getParameters(),G=(c=N.encodings)===null||c===void 0?void 0:c[0];jr()&&!G&&(u.encodings=[h]),G&&Object.assign(G,h),Object.assign(N,u),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(N.encodings))),await i.setParameters(N),await async function(F,j,q){try{var ee;if(!jn().supportSetRtpSenderParameters||!function(Ne){return Ne==="vp9"||Ne==="av1"}(F)||!oe("ENABLE_SVC"))return;const he={},Se={},we=j.getParameters(),ye=(ee=we.encodings)===null||ee===void 0?void 0:ee[0];Se.scalabilityMode=uP(q),ye&&Object.assign(ye,Se),Object.assign(we,he),await j.setParameters(we),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(we.encodings)))}catch(he){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",he)}}(this.store.codec,i,oe("SVC_MODE"))}async updateAdaptation(r,i){var o,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!jn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:_}=i;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=gc(m)),_&&_>=1&&st(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const E=r.getParameters(),S=(c=E.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(E,{});try{await r.setParameters(E),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(E.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!jn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];u instanceof br&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){const c=ja(r);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(E=>E.attributes.mid===m);_&&(eS(_,u),p9(_,u,this.store.codec))}),Um(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const E=r[_],S=i[_];if(S instanceof br&&!st(o=S._hints).call(o,hr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const N=E.sender.getParameters();await E.sender.setParameters(Object.assign(N,R))}}}async applySimulcastEncodings(r,i){if(!jr()&&r.length===i.length)for(let o=0;o<r.length;o++){const c=i[o];if(c instanceof br&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var i,o,c,u,h;return!!(r instanceof br&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!st(i=r._hints).call(i,hr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,o,c){if(oe("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(jn().supportPCSetConfiguration){const i=dy.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},Tt(On.prototype,"updateRemoteRTPCapabilities",[da],Object.getOwnPropertyDescriptor(On.prototype,"updateRemoteRTPCapabilities"),On.prototype),Tt(On.prototype,"connect",[da],Object.getOwnPropertyDescriptor(On.prototype,"connect"),On.prototype),Tt(On.prototype,"updateRemoteConnect",[da],Object.getOwnPropertyDescriptor(On.prototype,"updateRemoteConnect"),On.prototype),Tt(On.prototype,"createDataChannels",[da],Object.getOwnPropertyDescriptor(On.prototype,"createDataChannels"),On.prototype),Tt(On.prototype,"receive",[da],Object.getOwnPropertyDescriptor(On.prototype,"receive"),On.prototype),Tt(On.prototype,"batchReceive",[da],Object.getOwnPropertyDescriptor(On.prototype,"batchReceive"),On.prototype),Tt(On.prototype,"stopReceiving",[da],Object.getOwnPropertyDescriptor(On.prototype,"stopReceiving"),On.prototype),Tt(On.prototype,"muteRemote",[da],Object.getOwnPropertyDescriptor(On.prototype,"muteRemote"),On.prototype),Tt(On.prototype,"unmuteRemote",[da],Object.getOwnPropertyDescriptor(On.prototype,"unmuteRemote"),On.prototype),Tt(On.prototype,"muteLocal",[da],Object.getOwnPropertyDescriptor(On.prototype,"muteLocal"),On.prototype),Tt(On.prototype,"unmuteLocal",[da],Object.getOwnPropertyDescriptor(On.prototype,"unmuteLocal"),On.prototype),Tt(On.prototype,"close",[da],Object.getOwnPropertyDescriptor(On.prototype,"close"),On.prototype),Tt(On.prototype,"updateEncoderConfig",[da],Object.getOwnPropertyDescriptor(On.prototype,"updateEncoderConfig"),On.prototype),Tt(On.prototype,"updateSendParameters",[da],Object.getOwnPropertyDescriptor(On.prototype,"updateSendParameters"),On.prototype),Tt(On.prototype,"replaceTrack",[da],Object.getOwnPropertyDescriptor(On.prototype,"replaceTrack"),On.prototype),Tt(On.prototype,"updateAdaptation",[da],Object.getOwnPropertyDescriptor(On.prototype,"updateAdaptation"),On.prototype),Tt(On.prototype,"getRemoteSSRC",[da],Object.getOwnPropertyDescriptor(On.prototype,"getRemoteSSRC"),On.prototype),On);function da(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function n2(e,r){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=gc(r.width),o.height=gc(r.height);const c=gc(r.framerate||15);document.body.append(i),document.body.append(o);let u=e._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play();const h=o.getContext("2d");if(!h)throw new Oe(te.UNEXPECTED_ERROR,"can not get canvas context");const m=jn(),_=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const S=i.videoWidth,R=i.videoHeight/S,P=o.width*R;Math.abs(P-o.height)>=2&&(x.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(P)),o.height=P)}h.drawImage(i,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,i.srcObject=new MediaStream([u]))},o.stopCapture=pL(()=>o.startCapture&&o.startCapture(),c);const E=_.stop;return _.stop=()=>{E.call(_),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),x.debug("clean low stream renderer")},_}var TP=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(TP||{}),Ei=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(Ei||{}),H_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(H_||{}),vi=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(vi||{}),$_=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}($_||{}),X9=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(X9||{}),Th=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(Th||{}),ha=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(ha||{}),J9=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(J9||{}),pa=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(pa||{}),wP=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(wP||{});const K_=1e3,q_=6,CP=3,Jme=Math.max(q_,CP);function zt(e,r,i){i!=null&&Number.isFinite(i)&&(e[r]=Math.round(Math.max(0,i)))}function Q9(e){const r={[pa.CONN_TYPE]:0,[pa.RTT]:e.rtt,[pa.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[pa.CONN_TYPE]=1),i==="tcp"&&(r[pa.CONN_TYPE]=3),i==="tls"&&(r[pa.CONN_TYPE]=4);break}case"srflx":r[pa.CONN_TYPE]=2;break;case"unknown":r[pa.CONN_TYPE]=5;break;default:r[pa.CONN_TYPE]=0}return r}function Z9(e){let r=0;switch(e){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class eH extends Mr{constructor(r){super(),K(this,"store",void 0),K(this,"uploadWRTCStatsTimer",void 0),K(this,"uploadOutboundDenoiserStatsTimer",void 0),K(this,"uploadExtStatsTimer",void 0),K(this,"uploadExtUsageStatsTimer",void 0),K(this,"uploadInboundExtStatsTimer",void 0),K(this,"requestStats",void 0),K(this,"requestTransportStats",void 0),K(this,"requestLocalMedia",void 0),K(this,"requestRemoteMedia",void 0),K(this,"requestAllTracks",void 0),K(this,"requestVideoIsReady",void 0),K(this,"requestUploadStats",void 0),K(this,"requestUpload",void 0),K(this,"uploadOutboundStarted",!1),K(this,"uploadInboundStarted",!1),K(this,"uploadTransportStarted",!1),K(this,"uploadBaseStatsStarted",!1),K(this,"uploadExtensionUsageStarted",!1),K(this,"lastRecvStats",void 0),K(this,"lastSendStats",void 0),K(this,"lastRefRecvStats",void 0),K(this,"lastRefSendStats",void 0),K(this,"lastFullRecvStats",void 0),K(this,"lastFullSendStats",void 0),K(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const i=r%CP==0,o=r%q_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const E=this.getTransportStats(c,u,i);E&&(m.misc=[E])}if(this.uploadOutboundStarted&&c){const E=this.getOutboundStats(c,o?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,o);E&&(m.outbound=[E])}if(this.uploadInboundStarted&&u){const E=this.getInboundStats(u,o?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,o);E&&(m.inbound=E)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[wP.RTC_PEER_CONNECTION_STATE]=Qx[_]):m.misc=[{addition:{[wP.RTC_PEER_CONNECTION_STATE]:Qx[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,o;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[wP.RTC_PEER_CONNECTION_STATE]:Qx[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Jme+1&&(r=1)},K_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,i,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[pa.RTT]:r.rtt,[pa.CONN_TYPE]:void 0,[pa.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=Q9(r);if(this.store.useP2P){if(i){const u=Q9(i);c[pa.CONN_TYPE]+=u[pa.CONN_TYPE]<<3}c[pa.CONN_TYPE]+=110}else c[pa.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,_;return u.forEach(E=>{let[S,{track:R,ssrcs:P}]=E;switch(S){case Ke.LocalVideoLowTrack:case Ke.LocalVideoTrack:if(S===Ke.LocalVideoTrack){const N=function(j,q,ee,he,Se,we){const ye=q.videoSend.find(ft=>ft.ssrc===j);if(!ye)return;const Ne={},{sentFrame:Ye,inputFrame:dt}=ye;if(we&&(zt(Ne,Ei.QP_SUM,ye.qpSumPerFrame),dt&&Ye)){const ft=dt.frameRate,Rn=Ye.frameRate;Ne[Ei.FREEZE]=function(In,pr){let ai=!0;return ai=!(In<=5)&&(In<=10?pr<3:In<=20?pr<4:pr<5),ai}(ft,Rn)?1:0}if(Se){switch(Ye&&(zt(Ne,Ei.HEIGHT,Ye.height),zt(Ne,Ei.WIDTH,Ye.width),zt(Ne,Ei.FRAME_RATE,Ye.frameRate)),Ne[Ei.DISABLED]=he._originMediaStreamTrack&&!he._originMediaStreamTrack.enabled||he._mediaStreamTrack&&!he._mediaStreamTrack.enabled?1:0,ye.adaptionChangeReason){case"none":Ne[Ei.ADAPTATION]=0;break;case"cpu":Ne[Ei.ADAPTATION]=1;break;case"bandwidth":Ne[Ei.ADAPTATION]=2;break;case"other":Ne[Ei.ADAPTATION]=3}let ft=0;ye.adaptionChangeReason&&(ft+=Z9(ye.adaptionChangeReason)),q.qualityLimitationReason&&(ft+=Z9(q.qualityLimitationReason)<<3),Ne[Ei.ADAPTATION]=ft,Ne[Ei.PLAYER_STATUS]=dL[he._player?he._player.videoElementStatus:"uninit"],zt(Ne,Ei.NACKS,ye.nacksCount),zt(Ne,Ei.PLIS,ye.plisCount),zt(Ne,Ei.FIRS,ye.firsCount),zt(Ne,Ei.AVG_ENCODE,ye.avgEncodeMs),zt(Ne,Ei.HUGE_FRAME_SENT,ye.hugeFramesSent),zt(Ne,Ei.BYTES_RETRANSMIT,ye.retransmittedBytesSent),zt(Ne,Ei.PACKAGES_RETRANSMIT,ye.retransmittedPacketsSent),zt(Ne,Ei.KEY_FRAMES_ENCODED,ye.keyFramesEncoded);const Rn=ee&&ee.videoSend.find(In=>In.ssrc===j);if(Rn){let In=Se?K_:K_*q_;Rn.timestamp&&ye.timestamp&&(In=ye.timestamp-Rn.timestamp),Rn.packets!=null&&ye.packets!=null&&zt(Ne,Ei.PACKAGE_RATE,1e3*(ye.packets-Rn.packets)/In),ye.packetsLost!=null&&Rn.packetsLost!=null&&zt(Ne,Ei.PACKAGE_LOST,ye.packetsLost-Rn.packetsLost),Rn.bytes!=null&&ye.bytes!=null&&zt(Ne,Ei.BITRATE,8*(ye.bytes-Rn.bytes)/In)}}return Ne}(P[0].ssrcId,r,i,R,o,c),G=R&&function(j,q,ee,he){const Se=q.videoSend.find(ye=>ye.ssrc===j);if(!Se)return null;const we={};if(he){const ye=Se.inputFrame,Ne=ye&&ye.height||ee.videoHeight||0,Ye=ye&&ye.width||ee.videoWidth||0,dt=ye&&ye.frameRate||0;zt(we,TP.HEIGHT,Ne),zt(we,TP.WIDTH,Ye),zt(we,TP.FRAME_RATE,dt)}return we}(P[0].ssrcId,r,R,o),F=function(j,q){const ee={};return q&&(zt(ee,Ei.RETRANSMIT,j.bitrate.retransmit),zt(ee,Ei.TARGET_ENCODED,j.bitrate.targetEncoded),zt(ee,Ei.ACTUAL_ENCODED,j.bitrate.actualEncoded),zt(ee,Ei.TRANSMIT,j.bitrate.transmit),zt(ee,Ei.BANDWIDTH,j.sendBandwidth)),ee}(r,o);m=Object.assign({},N,G,F)}else _=function(N,G,F,j){const q=G.videoSend.find(he=>he.ssrc===N);if(!q)return;const ee={};if(j){const he=q.sentFrame;if(he&&(zt(ee,H_.HEIGHT,he.height),zt(ee,H_.WIDTH,he.width),zt(ee,H_.FRAME_RATE,he.frameRate)),F){const Se=F.videoSend.find(we=>we.ssrc===N);if(Se){let we=K_*q_;Se.timestamp&&q.timestamp&&(we=q.timestamp-Se.timestamp),Se.packets!=null&&q.packets!=null&&zt(ee,H_.PACKAGE_RATE,1e3*(q.packets-Se.packets)/we),q.packetsLost!=null&&Se.packetsLost!=null&&zt(ee,H_.PACKAGE_LOST,q.packetsLost-Se.packetsLost),Se.bytes!=null&&q.bytes!=null&&zt(ee,H_.BITRATE,8*(q.bytes-Se.bytes)/we)}}}return ee}(P[0].ssrcId,r,i,o);break;case Ke.LocalAudioTrack:h=R&&function(N,G,F,j,q){const ee=G.audioSend.find(Se=>Se.ssrc===N);if(!ee)return;const he={};if(q){he[Th.DISABLED]=j._originMediaStreamTrack&&!j._originMediaStreamTrack.enabled||j._mediaStreamTrack&&!j._mediaStreamTrack.enabled?1:0;const Se=100*j._source.getAccurateVolumeLevel(),we=ee.inputLevel;if(we!=null){const Ne=Math.ceil(50*Math.log10(100*we+1));zt(he,Th.LEVEL,Ne)}zt(he,X9.PCM_LEVEL,Se),zt(he,Th.AEC_RETURN_LOSS,ee.aecReturnLoss),zt(he,Th.AEC_RETURN_LOSS_ENH,ee.aecReturnLossEnhancement),zt(he,Th.BYTES_RETRANSMIT,ee.retransmittedBytesSent),zt(he,Th.PACKAGES_RETRANSMIT,ee.retransmittedPacketsSent),he[Th.FREEZE]=0;const ye=F&&F.audioSend.find(Ne=>Ne.ssrc===N);if(ye){let Ne=K_*q_;ye.timestamp&&ee.timestamp&&(Ne=ee.timestamp-ye.timestamp),ye.bytes!=null&&ee.bytes!=null&&zt(he,Th.BITRATE,8*(ee.bytes-ye.bytes)/Ne),ye.packets!=null&&ee.packets!=null&&zt(he,Th.PACKAGE_RATE,1e3*(ee.packets-ye.packets)/Ne)}}return he}(P[0].ssrcId,r,i,R,o)}}),{high:m,low:_,audio:h}}getInboundStats(r,i,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[_,E]=m;const S={peer:_.uid};if(E.has(yt.VIDEO)&&_.videoTrack){const R=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,P=_.videoTrack?function(N,G,F,j,q,ee,he,Se){const we=G.videoRecv.find(In=>In.ssrc===N);if(!we)return;const ye={},{receivedFrame:Ne,outputFrame:Ye,decodeFrameRate:dt}=we,ft=F&&F.videoRecv.find(In=>In.ssrc===N);if(zt(ye,$_.FRAME_RATE_DECODE,dt),we.framesRateFirefox&&zt(ye,vi.FRAME_RATE,we.framesRateFirefox),Ne&&zt(ye,vi.FRAME_RATE,Ne.frameRate),zt(ye,vi.FRAMES_DROPPED,we.framesDroppedCount),zt(ye,vi.BYTES_RETRANSMIT,we.retransmittedBytesReceived),zt(ye,vi.PACKAGES_RETRANSMIT,we.retransmittedPacketsReceived),zt(ye,vi.PACKAGES_DISCARDED,we.packetsDiscarded),zt(ye,vi.AVG_DECODE,we.avgDecodeMs),zt(ye,vi.AVG_PROCESSING_DELAY,we.avgProcessingDelayMs),zt(ye,vi.AVG_ASSEMBLY_TIME,we.avgFramesAssembledFromMultiplePacketsMs),zt(ye,vi.AVG_INTER_FRAME_DELAY,we.avgInterFrameDelayMs),zt(ye,vi.KEY_FRAMES_DECODED,we.keyFramesDecoded),ft){const In=G.timestamp-F.timestamp||K_*(Se?q_:he?CP:1);we.packetsLost!=null&&ft.packetsLost!=null&&zt(ye,vi.PACKAGE_LOST,we.packetsLost-ft.packetsLost),ft.bytes!=null&&we.bytes!=null&&zt(ye,vi.BITRATE,8*(we.bytes-ft.bytes)/In),ft.packets!=null&&we.packets!=null&&zt(ye,vi.PACKAGE_RATE,1e3*(we.packets-ft.packets)/In)}if(Se&&(zt(ye,vi.QP_SUM,we.qpSumPerFrame),ye[vi.FREEZE]=q&&VT.isRemoteVideoFreeze(j,we,ft)?1:0),he){var Rn;Ne?(zt(ye,vi.HEIGHT,Ne.height),zt(ye,vi.WIDTH,Ne.width)):j&&(zt(ye,vi.HEIGHT,j._videoHeight||0),zt(ye,vi.WIDTH,j._videoWidth||0)),Ye&&zt(ye,$_.FRAME_RATE_OUTPUT,Ye.frameRate);const In=(Rn=j._player)===null||Rn===void 0?void 0:Rn.rendFrameRate.toFixed(0);if(In&&zt(ye,$_.FRAME_RATE_RENDER,+In),zt(ye,vi.JITTER_BUFFER,we.jitterBufferMs),zt(ye,vi.CURRENT_DELAY,we.currentDelayMs),zt(ye,vi.FIRS,we.firsCount),zt(ye,vi.NACKS,we.nacksCount),zt(ye,vi.PLIS,we.plisCount),j){ye[vi.DISABLED]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const pr=j._player;if(pr){const{freezeTimeCounterList:ai,renderFreezeAccTime:Yr,videoElementStatus:ma}=pr;if(ai&&ai.length>0&&zt(ye,$_.FREEZE_TIME,ai.splice(0,1)[0]),ee&&Jp.visibility==="visible"&&ma===po.PLAYING&&jn().supportRequestVideoFrameCallback){const je=Math.min(6e3,Yr);pr.renderFreezeAccTime=Math.max(0,Yr-je),zt(ye,$_.FREEZE_TIME_RENDER,je)}if(typeof we.totalFreezesDuration=="number"){const je=ft&&ft.totalFreezesDuration?we.totalFreezesDuration-ft.totalFreezesDuration:we.totalFreezesDuration;zt(ye,$_.FREEZE_DURATION,1e3*je)}}}if(ye[vi.PLAYER_STATUS]=dL[j._player?j._player.videoElementStatus:"uninit"],ft&&we.totalInterFrameDelay!==void 0&&we.totalSquaredInterFrameDelay!==void 0&&ft.totalInterFrameDelay!==void 0&&ft.totalSquaredInterFrameDelay!==void 0){const pr=we.totalInterFrameDelay-ft.totalInterFrameDelay,ai=we.totalSquaredInterFrameDelay-ft.totalSquaredInterFrameDelay,Yr=we.framesDecodeCount-ft.framesDecodeCount,ma=pr/Yr*1e3,je=Math.round(1e3*Math.sqrt((ai-Math.pow(pr,2)/Yr)/Yr));!isNaN(je)&&ma+je>Math.max(3*ma,ma+150)&&(ye[vi.I_FRAME_DELAY]=je)}}return ye}(_._videoSSRC,r,i,_.videoTrack,R===!0,this.needUploadRenderFreezeTime,o,c):void 0;P&&(S.video=P)}if(E.has(yt.AUDIO)&&_.audioTrack){const R=_.audioTrack?function(P,N,G,F,j,q){const ee=N.audioRecv.find(ye=>ye.ssrc===P);if(!ee)return;const he={},Se=G&&G.audioRecv.find(ye=>ye.ssrc===P);if(zt(he,ha.JITTER,ee.jitterMs),zt(he,ha.BYTES_RETRANSMIT,ee.retransmittedBytesReceived),zt(he,ha.PACKAGES_RETRANSMIT,ee.retransmittedPacketsReceived),zt(he,ha.PACKAGES_DISCARDED,ee.packetsDiscarded),zt(he,ha.AVG_PROCESSING_DELAY,ee.avgProcessingDelayMs),Se){const ye=N.timestamp-G.timestamp||K_*(q?q_:j?CP:1);ee.packets!=null&&Se.packets!=null&&zt(he,ha.PACKAGE_RATE,1e3*(ee.packets-Se.packets)/ye),j&&Se.bytes!=null&&ee.bytes!=null&&zt(he,ha.BITRATE,8*(ee.bytes-Se.bytes)/ye),ee.packetsLost!=null&&Se.packetsLost!=null&&zt(he,ha.PACKAGE_LOST,ee.packetsLost-Se.packetsLost)}if(q){const{receivedFrames:ye,droppedFrames:Ne}=ee;ye!=null&&Ne!=null&&(he[ha.FREEZE]=(we=ye)===0||100*Ne/we>20?1:0)}var we;if(j){const ye=100*F._source.getAccurateVolumeLevel(),Ne=ee.outputLevel;if(Ne!=null){const Ye=Math.ceil(50*Math.log10(100*Ne+1));zt(he,J9.LEVEL,Ye)}if(zt(he,ha.PCM_LEVEL,ye),F&&(he[ha.DISABLED]=F._originMediaStreamTrack.enabled&&F._mediaStreamTrack.enabled?0:1),zt(he,ha.JITTER_BUFFER,ee.jitterBufferMs),zt(he,ha.CURRENT_DELAY,ee.jitterBufferMs),he[ha.PLAYER_STATUS]=dL[ua.getPlayerState(F.getTrackId())],Se){const Ye=ee.concealedSamples-Se.concealedSamples;Ye>0&&zt(he,ha.CONCEALED_SAMPLES,Ye);const dt=ee.totalSamplesReceived-Se.totalSamplesReceived;dt>0&&zt(he,ha.TOTAL_SAMPLES_RECEIVED,dt)}}return he}(_._audioSSRC,r,i,_.audioTrack,o,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(i=>i instanceof qA);if(r&&r._external.getDenoiserStats){const i=r._external.getDenoiserStats();i&&this.requestUpload(AT.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[i,o]=r;o.has(yt.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(yt.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),o={connectionInterval:oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const E of u)!E.muted&&E.enabled&&(c=c.concat(await E.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[E,S]of h)S.has(yt.VIDEO)&&E.videoTrack&&(c=c.concat(await E.videoTrack.getProcessorUsage())),S.has(yt.AUDIO)&&E.audioTrack&&(c=c.concat(await E.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(E,S){const R={};for(const{id:F,value:j,level:q,direction:ee}of E){var P;const he=(P=S.get(F))!==null&&P!==void 0?P:0,Se=j===2?he+oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:he;var N,G;S.set(F,Se),R[F]?(j===2&&(R[F].value=j),q>R[F].level&&(R[F].level=q),ee==="remote"&&(R[F].remoteUidCount+=1),R[F].totalTs=(N=S.get(F))!==null&&N!==void 0?N:0):R[F]={value:j,level:q,remoteUidCount:ee==="local"?0:1,totalTs:(G=S.get(F))!==null&&G!==void 0?G:0}}return Object.keys(R).map(F=>{const{level:j,value:q,totalTs:ee}=R[F];return{id:F,level:j,value:q,totalTs:ee}})}(c,r);const m=Date.now(),_=m>i?m:i+1;this.requestUpload&&this.requestUpload(AT.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},oe("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Qme=oe("ICE_RESTART_INTERVAL");let RP=new Map,sS=new Map,Hm=[Fs.UDP_TCP_RELAY,Fs.TCP_RELAY,Fs.RELAY],r2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jn().supportPCSetConfiguration;function tH(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=RP.get(e.id);i&&(window.clearTimeout(i),RP.delete(e.id));const o=sS.get(e.id);r&&o&&o.index===Hm.length-1&&(x.debug("[".concat(e.id,"] reset ICE restart policy")),sS.delete(e.id))}function nH(e,r,i){if(RP.size===0&&sS.size===0&&(Array.isArray(oe("RESTART_SEQUENCE"))&&oe("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let E=0;E<m.length;E+=1){const S=m[E];if(m.filter(R=>R===S).length!==_.filter(R=>R===S).length)return!1}return!0}(Hm,oe("RESTART_SEQUENCE"))&&(Hm=oe("RESTART_SEQUENCE").filter(m=>{var _;if(st(_=Object.values(Fs)).call(_,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(Hm.join(" => ")))),r2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jn().supportPCSetConfiguration),Hm.length===0)return void i();let o,{index:c=0,type:u}=sS.get(e.id)||{};if(r2&&u===Fs.RELAY)return void i();let h=u&&c>=Hm.length-1;if(r2)u=Fs.RELAY;else{if(h)return void i();u?(c++,u=Hm[c]):(u=Hm[0],c=0)}x.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),sS.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>nH(e,r,i),Qme),RP.set(e.id,o)}var _n;function rH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function wh(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?rH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):rH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function iH(e){var r,i,o,c=2;for(typeof Symbol<"u"&&(i=Ix,o=Symbol.iterator);c--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new IP(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function IP(e){function r(i){if(Object(i)!==i)return ut.reject(new TypeError(i+" is not an object."));var o=i.done;return ut.resolve(i.value).then(function(c){return{value:c,done:o}})}return IP=function(i){this.s=i,this.n=i.next},IP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?ut.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?ut.reject(i):r(o.apply(this.s,arguments))}},new IP(e)}let jT=(_n=class extends Mr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(xt.StateChange,r,this._state)}constructor(e,r){super(),K(this,"isPlanB",void 0),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"connection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"remoteDataChannelMap",new Map),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"pendingLocalDataChannels",[]),K(this,"pendingRemoteDataChannels",[]),K(this,"statsCollector",void 0),K(this,"shouldForwardP2PCreation",void 0),K(this,"iceFailedCount",0),K(this,"dtlsFailedCount",0),K(this,"mutex",void 0),K(this,"_state",Yn.Disconnected),K(this,"_pcStatsUploadType",oe("NEW_ICE_RESTART")?tf.FIRST_CONNECTION:tf.OLD_FIRST_CONNECTION),K(this,"_isStartRestartIce",!1),K(this,"_restartTimer",void 0),K(this,"_isTryConnecting",!1),K(this,"_iceError",null),K(this,"_forceTurn",!1),K(this,"_isWaitPcToRePub",!1),K(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Yn.Connected)return void c(new Me(te.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const _=this.createMuteMessage(h);await ur(this,xt.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Yn.Connected)return void c(new Me(te.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");if(m){const E=m[1];if(E.track._originMediaStreamTrack.stop(),!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const S=i._mediaStreamTrack.clone();E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}else{const S=n2(i,ST(this,xt.RequestLowStreamParameter));E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}await new ut((S,R)=>{this.handleReplaceTrack(E.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const _=this.createUnmuteMessage(h);await ur(this,xt.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.connection||!_||_.track!==i||this.state!==Yn.Connected)return void o();const{id:E,track:S}=_;await this.connection.updateSendParameters(E,S),await this.connection.updateEncoderConfig(E,S),this.emit(xt.UpdateVideoEncoder,S),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==Yn.Connected)return void o();const{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceMixingTrack",async(i,o,c,u)=>{if(!this.connection||this.state!==Yn.Connected)return void o();const h=e2([i]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),o()}catch(E){c(E)}finally{var _;(_=m)===null||_===void 0||_()}}),K(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return i===R});if(!this.connection||!E||this.state!==Yn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(i,E[1].id)),this.isPlanB){const S=E[1];S.id=i._mediaStreamTrack.id,this.localTrackMap.set(E[0],S)}if(E[0]===Ke.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(S){const R=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ut((P,N)=>{this.handleReplaceTrack(S.track,P,N,!0)})}}o()}catch(E){c(E)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),K(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),K(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new eH(this.store),this.bindStatsUploaderEvents(),this.mutex=new Us("P2PChannel-mutex",this.store.clientId),this.isPlanB=!jn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&qp(),this.shouldForwardP2PCreation=oe("FORWARD_P2P_CREATION")&&jn().supportPCSetConfiguration&&Fx(),this.shouldForwardP2PCreation&&(this.connection=bP(this.store),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var r;this.state=Yn.New,this._forceTurn=q9(e),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=bP(this.store,e),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Me(te.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=oe("NEW_ICE_RESTART")?tf.FIRST_CONNECTION:tf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Me(te.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");oe("ENABLE_PREALLOC_PC")&&this.state===Yn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Yn.Connected)}updateRemoteRTPCapabilities(e){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return st(u=[Ke.LocalVideoLowTrack,Ke.LocalVideoTrack]).call(u,h)}),i=r.map(c=>{let[,{id:u}]=c;return u}),o=r.map(c=>{let[u]=c;return u});if(this.connection instanceof bh){if(At.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!st(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>st(e).call(e,u));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof bh&&this.connection.peerConnectionState!=="closed"&&st(e=[Yn.New,Yn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Yn.Connected){if(this.state===Yn.Disconnected)throw new Me(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;st(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}const r=this.filterTobePublishedDataChannels(e);return r.length===0?[]:(r.forEach(i=>{const o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);const o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,r,i){var o=this;return Cl(function*(){const c=yield Nn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&st(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Yn.Connected||h){if(o.state===Yn.Disconnected)throw new Me(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const _=e.filter(E=>o.pendingLocalTracks.indexOf(E)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,js.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(e,r,i);if(m.length===0)return void(yield Nn(o.tryToUnmuteAudio(e)));yield*SA(iH(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(e,r){var i=this;return Cl(function*(){r.forEach(P=>{let{track:N,type:G}=P;const F=Date.now();i.store.publish(N.getTrackId(),G===Ke.LocalAudioTrack?"audio":"video",F)}),i.bindLocalTrackEvents(r);const o=r.map(P=>{let{track:N}=P;return N}),c=yield Nn(e.send(o,i.store.codec,i.store.audioCodec)),u=(yield Nn(c.next())).value,h=i.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===te.WS_ABORT&&r.forEach(N=>{let{track:G}=N;i.pendingLocalTracks.indexOf(G)===-1&&i.pendingLocalTracks.push(G)}),i.unbindLocalTrackEvents(r),P}const _=i.mapPubResToRemoteConfig(h,m,o),E=(yield Nn(c.next(_))).value;if(i.state===Yn.Disconnected)throw new Me(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");oe("ENABLE_VIDEO_SEI");const S=oe("ENABLE_ENCODED_TRANSFORM"),R=oe("ENABLE_AUDIO_METADATA");o.forEach(async P=>{const N=P.getRTCRtpTransceiver();if(!N||!S)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:F}=mP();P.trackMediaType===yt.VIDEO?await G(N.sender,P):P.trackMediaType===yt.AUDIO&&await F(N.sender,{metadata:R?()=>{const j=P.metadata.shift();return j&&j.value}:void 0})}),r.forEach(P=>{let{type:N}=P;i.statsCollector.addLocalStats(N)}),i.assignLocalTracks(r,E),i.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:N,type:G}=P;const F=Date.now();i.store.publish(N.getTrackId(),G===Ke.LocalAudioTrack?"audio":"video",void 0,F)})})()}async updateVideoStreamParameter(e,r){const i=this.localTrackMap.get(r);if(!i||!this.connection)return;if(!(i.track instanceof br))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=i,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=VL(u,h)),m.maxFramerate=u.framerate?gc(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(e,o);if(o._encoderConfig||(o._encoderConfig={}),r!==Ke.LocalVideoLowTrack||!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return x.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const _=h.canvas;m.width&&(_.width=gc(m.width)),m.height&&(_.height=gc(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=pL(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},gc(m.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var r=this;return Cl(function*(){if(!r.connection||r.state!==Yn.Connected)return;const i=yield Nn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Ke.LocalVideoTrack);if(!c)throw new Me(te.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ke.LocalVideoLowTrack))throw new Me(te.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,e),type:Ke.LocalVideoLowTrack}];if(yield*SA(iH(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get(Ke.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield Nn(r.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ps(this,xt.RequestRePublish,this.pendingLocalTracks),this.emit(xt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Ps(this,xt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:i,kind:o}=this.pendingRemoteTracks[r];(o!==yt.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==yt.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(e)await Ps(this,xt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===yt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(xt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Yn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(e){if(!this.connection||this.state!==Yn.Connected)return void e.forEach(i=>{const o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(e);return r.length!==0?(r.forEach(i=>{const o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Yn.Connected)return;const e=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(!e)return;e.track.close();const r=[[Ke.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,r)}async doUnpublish(e,r){const i=this.createGatewayUnpublishMessage(r);return await e.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,r){if(!this.connection||this.state!==Yn.Connected)throw new Me(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:_}=h;return m.uid===e.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(o=>o.id)}async subscribe(e,r,i,o,c){var u;if(!this.connection||this.state!==Yn.Connected)throw new Me(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(r))return;let h,m,_;const E=this.connection.getPreMedia(i);if(E)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),_=E.transceiver,h=E.track,m=E.id;else if(c){const P=c.find(G=>{let{stream_type:F}=G;return F===r});if(!P)throw new Me(te.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const N=await this.connection.receive(r,P.ssrcs,String(e._uintid),P.attributes);this.connection instanceof bh&&(_=N.transceiver),h=N.track,m=N.id}else{const P=await this.connection.receive(r,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof bh&&(_=P.transceiver),h=P.track,m=P.id}if(r===yt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new $v(h,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new Hv(h,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:N}=mP();r==yt.VIDEO?await P(_.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(G=>{var F;return(F=e._videoTrack)===null||F===void 0?void 0:F._onSei(G)})}):r==yt.AUDIO&&await N(_.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(xt.AudioMetadata,G)}})}const S=this.remoteUserMap.get(e);S?S.set(r,m):this.remoteUserMap.set(e,new Map([[r,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:N,kind:G}=P;return N.uid===e.uid&&r===G});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(xt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Yn.Connected)throw new Me(te.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],i=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?i.set(c.ssrcId,u):r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{i.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const m=i.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:E,transceiver:S}=m;if(S&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:G}=mP();u==yt.VIDEO?await N(S.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(F=>{var j;return(j=c._videoTrack)===null||j===void 0?void 0:j._onSei(F)})}):u==yt.AUDIO&&await G(S.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:F=>{this.safeEmit(xt.AudioMetadata,F)}})}if(u===yt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new $v(_,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new Hv(_,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),oe("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:G}=mP();u==yt.VIDEO?await N(S.receiver,{onSei:F=>{var j;(j=c._videoTrack)===null||j===void 0||j._onSei(F)}}):u==yt.AUDIO&&await G(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,E):this.remoteUserMap.set(c,new Map([[u,E]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(N=>{let{user:G,kind:F}=N;return G.uid===c.uid&&u===F});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(xt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,r,i){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:_}=h;return r!==void 0?m.uid===e.uid&&r===_:m.uid===e.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Yn.Connected||i||o.forEach(h=>{let{kind:m}=h;var _;if(m===yt.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(m===yt.VIDEO){var E;(E=e._videoTrack)===null||E===void 0||E._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Yn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:_}]=h;var E,S;if(_===yt.VIDEO&&m._videoSSRC&&((E=this.connection)===null||E===void 0||E.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===yt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),i||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(_===yt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!i&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,r);if(i.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return i.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let r=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:E}=m;return u!==void 0?_.uid===c.uid&&u===E:_.uid===c.uid});h.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),r=r.concat(h)}if(!this.connection||this.state!==Yn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===yt.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===yt.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const i=cc(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u;const _=this.filterTobeUnSubscribedTracks(h,m);return c.concat(_)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var m,_;if(h===yt.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===yt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===yt.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),(E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==Yn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===yt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}addAudioMetadata(e){const r=this.localTrackMap.get(Ke.LocalAudioTrack),i=r&&r.track;i&&i.metadata.push(e)}getAllTracks(e){const r=this.localTrackMap.get(Ke.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Li){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ke.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ke.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Ke.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,r,i,o,c){if(e){const h=this.localTrackMap.get(Ke.LocalAudioTrack),m=o?this.localTrackMap.get(Ke.LocalVideoLowTrack):this.localTrackMap.get(Ke.LocalVideoTrack);At.publish(this.store.sessionId,{eventElapse:js.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof qr),m=o?(u=this.localTrackMap.get(Ke.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof br);At.publish(this.store.sessionId,{eventElapse:js.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,i,o){const c=o===yt.VIDEO?i._videoSSRC:i._audioSSRC;c&&At.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===yt.VIDEO,audio:o===yt.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:js.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Us("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=bP(this.store),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ke.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Li){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Yn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ke.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ke.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof br||r&&r.track instanceof qr?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(Kc(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ke.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=iT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Yn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=bP(this.store),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case Ke.LocalVideoTrack:st(r=o._hints).call(r,hr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ke.LocalAudioTrack:o instanceof Li?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ke.LocalVideoLowTrack:}}),this.emit(xt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Kc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(xt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Kc(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,r){for(const i of this.pendingRemoteDataChannels){const{user:o,id:c}=i;if((e instanceof Gm?e.uid:e)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(e,r){this.hasPendingRemoteDataChannel(e,r)||this.pendingRemoteDataChannels.push({user:e,id:r})}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Gm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}restartICE(e){var r=this;return Cl(function*(){if(!r.connection||r.state!==Yn.Connected)return;const i=yield Nn(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Nn(r.connection.restartICE(e));const u=yield Nn(o.next());if(u.done)return;const h=u.value,m=yield h;switch(t2(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),e){case Fs.UDP_TCP_RELAY:r._pcStatsUploadType=tf.UDP_TCP_RESTART;break;case Fs.TCP_RELAY:r._pcStatsUploadType=tf.TCP_RESTART;break;case Fs.RELAY:r._pcStatsUploadType=tf.RELAY_RESTART;break;default:r._pcStatsUploadType=tf.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),r=this.localTrackMap.get(Ke.LocalVideoTrack),i=this.localTrackMap.get(Ke.LocalAudioTrack),o=e.videoSend.find(N=>N.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=e.audioSend.find(N=>N.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=Hc(this,xt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,E=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*E/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(hr.SCREEN_TRACK)===-1){const N=P._encoderConfig.bitrateMax,G=e.bitrate.actualEncoded;if(N&&G){const F=(1e3*N-G)/(1e3*N);return VG[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(G=>G.ssrc===c),m=e.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const _=Hc(this,xt.NeedSignalRTT),E=e.rtt,S=(E&&_?(E+_)/2:E||_)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let N=.7*P*100/50+.3*S/1500;R&&(N=.6*P*100/50+.2*S/1500+.2*R/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new ut((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}async replaceTrack(e,r){var i;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Yn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==r&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,o[1].id)),this.isPlanB){const u=o[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ke.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new ut((m,_)=>{this.handleReplaceTrack(u.track,m,_,!0)})}}}filterTobePublishedTracks(e,r,i){const o=[],c=this.getAllTracks();e=Nv(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const m=this.localTrackMap.get(Ke.LocalAudioTrack);for(const _ of e){if(_ instanceof br&&(this.localTrackMap.has(Ke.LocalVideoTrack)||h?new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Ke.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(_,i);o.push({track:E,type:Ke.LocalVideoLowTrack})}if(_ instanceof qr)if(m){const E=m.track;if(E instanceof Li)ZL([_]),E.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=e2([E,_]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(E,S)}}else u instanceof Li?(ZL([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&jn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=e2(u?[_,u]:[_]):u=_}return u&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:Ke.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=Nv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof qr){const c=this.localTrackMap.get(Ke.LocalAudioTrack);if(!c)continue;c.track instanceof Li?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ke.LocalAudioTrack,c]),c.track.close())):r.push([Ke.LocalAudioTrack,c])}if(o instanceof br){const c=this.localTrackMap.get(Ke.LocalVideoTrack);if(!c)continue;r.push([Ke.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);u&&r.push([Ke.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(e){return e=(e=Nv(e)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Nv(e)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ke.LocalVideoTrack:i.addListener(bt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(bt.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ke.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Li?e.trackList.forEach(i=>{i.addListener(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(bt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(bt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(e.addListener(bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(bt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ke.LocalVideoTrack:i.off(bt.GET_STATS,this.handleGetLocalVideoStats),i.off(bt.GET_RTC_STATS,this.handleGetRTCStats),i.off(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ke.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Li?e.trackList.forEach(r=>{r.off(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(bt.GET_STATS,this.handleGetLocalAudioStats),r.off(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(bt.GET_STATS,this.handleGetLocalAudioStats),e.off(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(bt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Hv&&r.addListener(bt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof $v&&r.addListener(bt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(bt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(yt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(yt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var c;let u,h,{track:m,type:_}=i;switch(_){case Ke.LocalAudioTrack:u=Xn.Audio,h={dtx:m instanceof qA&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ke.LocalVideoTrack:u=st(c=m._hints).call(c,hr.SCREEN_TRACK)?Xn.Screen:Xn.High,h=wh(wh({},n9(m)),{},{codec:this.store.codec,svc_mode:uP()});break;case Ke.LocalVideoLowTrack:u=Xn.Low,h=wh(wh({},n9(m)),{},{codec:this.store.codec,svc_mode:uP()})}return{stream_type:u,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalAudioTrack:o=Xn.Audio;break;case Ke.LocalVideoLowTrack:o=Xn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(xt.PeerConnectionStateChange,r),r==="connecting"&&e instanceof bh&&!jr()&&oe("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&e.extendCandidate()},oe("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof bh&&tH(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=tf.DISCONNECTED_OR_FAILED,Hc(this,xt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));At.reportApiInvoke(this.store.sessionId,{name:Ri.REPUB_AFTER_PC_CONNECTED,options:i.concat(o),tag:Wr.TRACER}).onSuccess(),this.republish()}if(oe("NEW_ICE_RESTART")&&e instanceof bh&&!jr()&&!this._forceTurn){if(st(YG).call(YG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{t2(e)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Hc(this,xt.QueryClientConnectionState)==="CONNECTED"&&this.emit(xt.RequestRestartICE,c))},o=()=>{t2(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{nH(e,i,o)},800))}}else{if(r==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&oe("ICE_RESTART")&&Hc(this,xt.QueryClientConnectionState)==="CONNECTED"&&this.emit(xt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),At.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Wr.TRACER}).onSuccess(),this.emit(xt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const o=Array.from(Kc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(jv.FIRST_FRAME_DECODED),At.firstRemoteFrame(this.store.sessionId,qi.FIRST_AUDIO_DECODE,kr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const o=Array.from(Kc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);o&&At.firstRemoteFrame(this.store.sessionId,qi.FIRST_AUDIO_RECEIVED,kr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;const o=Array.from(Kc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);o&&At.firstRemoteFrame(this.store.sessionId,qi.FIRST_VIDEO_RECEIVED,kr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{const o=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(xt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Bm(i))," -> ").concat(JSON.stringify(Bm(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Bm(i))," -> ").concat(JSON.stringify(Bm(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return wh(wh({},r),i)},e.onICECandidateError=r=>{this._iceError=r}}resetConnection(e){e instanceof bh&&function(r){sS.delete(r.id),tH(r)}(e),e.close(),this.emit(xt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get(Ke.LocalAudioTrack);if(e instanceof qr&&(i==null?void 0:i.track)instanceof Li)return i.track.isActive||r.push([Ke.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===Ke.LocalVideoTrack)){const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get(Ke.LocalAudioTrack);if(e instanceof qr&&(i==null?void 0:i.track)instanceof Li)return i.track.isActive&&r.push([Ke.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ke.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=Xn.Audio;break;case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:o=Xn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=Xn.Audio;break;case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:o=Xn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){const c=o.get(r);if(!c)return i;i.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(e,r){const i=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case yt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:yt.VIDEO,ssrcId:o._videoSSRC}));case yt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:yt.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(e){const r=new Map;return e.forEach(i=>{let[o,{kind:c}]=i;if(r.has(o)){let u=r.get(o);c===yt.VIDEO?u|=Yi.Video:u|=Yi.Audio,r.set(o,u)}else c===yt.VIDEO?r.set(o,Yi.Video):r.set(o,Yi.Audio)}),{users:Array.from(r.entries()).map(i=>{let[o,c]=i;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(Ke.LocalVideoTrack),i=this.localTrackMap.get(Ke.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new ut((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ut((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,r,i){return e.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=r.find(_=>{let{stream_type:E}=_;return h===E}))===null||u===void 0?void 0:u.attributes;if(m&&oe("DISABLE_SCREEN_SHARE_REMB")){const _=i[c]._hints;(st(_).call(_,hr.SCREEN_TRACK)||st(_).call(_,hr.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof qr){var r;const o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await ur(this,xt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(xt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(xt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await hs(Kx(this.dtlsFailedCount,Ii)),this.emit(xt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),r.length>0&&await Ps(this,xt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(xt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ke.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof br)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof br).length>1)throw new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof qr).length>1&&(e.some(r=>r instanceof qr&&r._bypassWebAudio)||!jn().webAudioMediaStreamDest))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof br&&this.pendingLocalTracks.some(i=>i instanceof br))throw new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof qr&&this.pendingLocalTracks.some(i=>i instanceof qr)&&(!jn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof qr&&i._bypassWebAudio)))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){var i;const o=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding,c=wh(wh({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=o?e._mediaStreamTrack.clone():n2(e,c);const h=dr(8,"track-low-"),m=new br(u,wh(wh({},o&&{scaleResolutionDownBy:VL(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(M_.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,Vv.LOW_STREAM)}),m._hints.push(hr.LOW_STREAM),st(i=e._hints).call(i,hr.SCREEN_TRACK)&&m._hints.push(hr.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),e.addListener(bt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,r,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof bh){var c,u,h,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:E,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:P,remote:N}=await this.connection.getSelectedCandidatePair();At.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:E,dtlsstate:S,connectionstate:R,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=N.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=N.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(N.address,":").concat(N.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,r,i,o){var c;const u=Array.from(Kc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");At.firstRemoteVideoDecode(this.store.sessionId,qi.FIRST_VIDEO_DECODE,kr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:js.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===Ke.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Vv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},Tt(_n.prototype,"startP2PConnection",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"startP2PConnection"),_n.prototype),Tt(_n.prototype,"connect",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"connect"),_n.prototype),Tt(_n.prototype,"updateRemoteRTPCapabilities",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"updateRemoteRTPCapabilities"),_n.prototype),Tt(_n.prototype,"publishDataChannel",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"publishDataChannel"),_n.prototype),Tt(_n.prototype,"unpublish",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"unpublish"),_n.prototype),Tt(_n.prototype,"unpublishDataChannel",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"unpublishDataChannel"),_n.prototype),Tt(_n.prototype,"unpublishLowStream",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"unpublishLowStream"),_n.prototype),Tt(_n.prototype,"subscribeDataChannel",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"subscribeDataChannel"),_n.prototype),Tt(_n.prototype,"subscribe",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"subscribe"),_n.prototype),Tt(_n.prototype,"massSubscribe",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"massSubscribe"),_n.prototype),Tt(_n.prototype,"unsubscribe",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"unsubscribe"),_n.prototype),Tt(_n.prototype,"unsubscribeDataChannel",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"unsubscribeDataChannel"),_n.prototype),Tt(_n.prototype,"massUnsubscribe",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"massUnsubscribe"),_n.prototype),Tt(_n.prototype,"muteRemote",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"muteRemote"),_n.prototype),Tt(_n.prototype,"unmuteRemote",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"unmuteRemote"),_n.prototype),Tt(_n.prototype,"hasRemoteMediaWithLock",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"hasRemoteMediaWithLock"),_n.prototype),Tt(_n.prototype,"disconnectForReconnect",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"disconnectForReconnect"),_n.prototype),Tt(_n.prototype,"updateBitrateLimit",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"updateBitrateLimit"),_n.prototype),Tt(_n.prototype,"remoteMediaSsrcChanged",[mo],Object.getOwnPropertyDescriptor(_n.prototype,"remoteMediaSsrcChanged"),_n.prototype),_n);function mo(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function sH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function oH(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?sH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Zme=Date.now(),ege=20,i2=new Map,AP=new Map;async function aH(e){const r=i2.get(e),i=Array.isArray(r)&&r[r.length-1],o=AP.get(e);if(!i)return void(o.isSyncing=!1);const c={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);const u=i.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=i.mediaDelay+h;m<=0?(r.pop(),cH(i.context,c),m=0):m=Math.min(m,ege),setTimeout(()=>r.length&&aH(e),m)}function cH(e,r){e.safeEmit(bn.STREAM_MESSAGE,r.uid,r.payload),e.onStreamMessage&&e.onStreamMessage(r)}function tge(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return cH(i,{uid:e.uid,payload:e.payload});const o="".concat(i.id,"-").concat(e.uid),c=i2.get(o)||[],u=c.findIndex(E=>e.sendTs>=E.sendTs),h=oH(oH({},e),{},{context:i,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),i2.set(o,c);let m=!1;var _;AP.has(o)?m=!((_=AP.get(o))===null||_===void 0||!_.isSyncing):AP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||aH(o)}const nge=Dn().name;function lH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function uH(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?lH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):lH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const oS="websdk_ng_cache_parameter",rge=oe("MAX_PRELOAD_ASYNC_LENGTH"),ige=1e4,Y_=new Map,X_=[];let s2=null,o2=0,a2=0;const PP=new Map,sge=function(e,r){const i=[];let o=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&o<r?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new ut(async(_,E)=>{i.push(async()=>{try{const S=await e(...h);_(S)}catch(S){E(S)}}),o<r&&(o++,c())})}}(dH,rge),c2=la.CancelToken.source();async function dH(e,r,i,o,c,u){try{if(!oe("ENABLE_PRELOAD"))return;if(!jn().supportWebCrypto)return void Lm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new Me(te.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&ds(i,"token",1,2047),ds(e,"appid",1,2047),sP(r),o&&oP(o);const h=x_();x.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:e,cname:r,token:i||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,E;typeof o=="string"?(m.stringUid=o,[E,_]=await ut.all([Bme(o,{sid:h,appId:e},c2.token),D9(uH(uH({},m),{},{token:i||e,uid:0}),c2.token)]),m.uid=E.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),_=await D9(m,c2.token));const S={sid:h,appId:e,cname:r,token:i||e,uid:m.stringUid||o,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:E,ap:_};await async function(R){let P;try{R.uid&&pH({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const N=_H(R),G=await async function(j,q){try{const ee=await window.crypto.subtle.importKey("raw",rW(q),"AES-GCM",!1,["encrypt"]),he=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},ee,D_(window.btoa(JSON.stringify(j))));return Mm(new Uint8Array(he))}catch{return}}(R,R.token||R.appId);if(!G)return;P=gH(oS);const F=P?JSON.parse(P):[];F.push({[N]:G}),F.length>oe("AP_CACHE_NUM")&&F.shift(),OP(oS,JSON.stringify(F))}catch(N){x.warn("Error caching server parameters:",N.message),OP(oS,"")}}(S),o2++}catch(h){throw a2++,function(m){s2||(s2=window.setTimeout(()=>{let E="";PP.forEach((S,R)=>{E+="".concat(R,": ").concat(S," ;")}),At.reportApiInvoke(null,{name:Ri.PRELOAD,options:{success:o2,failed:a2,err:E}}).onError(m),o2=0,a2=0,PP.clear(),s2=null},ige));const _=PP.get(m.code)||0;PP.set(m.code,_+1)}(h),h}}async function hH(e){try{if(oe("AP_REQUEST_DETAIL")||oe("ENABLE_ROLE_SELECT_EDGE"))return;const r=pH(e);if(!r||e.cloudProxyServer!=="disabled")return;const i=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",rW(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,D_(o));return JSON.parse(window.atob(Mm(new Uint8Array(h))))}catch{return}}(r,e.token||e.appId);if(!i||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<oe("AP_CACHE_LIFETIME"))return i}catch(r){x.warn("Error get preloadInfo",r.message)}}function pH(e){let r;try{if(r=gH(oS),!r)return;const i=JSON.parse(r),o=_H(e),c=function(h,m){for(let _=h.length-1;_>=0;_--)if(m(h[_]))return _;return-1}(i,h=>o in h);if(c===-1)return;const u=i.splice(c,1)[0];return OP(oS,JSON.stringify(i)),u[o]}catch(i){x.warn("Error delete preload info: ".concat(r),i.message),OP(oS,"")}}function l2(e){if(e){let r=Y_.get(e);r&&(window.clearTimeout(r),r=null,Y_.delete(e)),st(X_).call(X_,e)||e.cloudProxyServer!=="disabled"||X_.push(e)}if(Y_.size<oe("AP_CACHE_NUM")&&X_.length>0){const r=X_.shift();Y_.set(r,window.setTimeout(async()=>{const{appId:i,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await sge(i,o,c,h,m,u),Y_.has(r)&&l2(r)}catch(_){x.warn("update preload failed",_.message),fH(r)}},oe("AP_UPDATE_INTERVAL")))}}function fH(e){const r=X_.indexOf(e);r!==-1&&X_.splice(r,1);let i=Y_.get(e);i&&(window.clearTimeout(i),i=null,Y_.delete(e),l2())}function mH(e,r){const i=e.sua,o=e.ap;r&&i&&At.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:e.intUid,errorCode:null,extend:i.req}),At.reportResourceTiming(e.ap.url,e.sid),At.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[yi.CHOOSE_SERVER,yi.CLOUD_PROXY_FALLBACK].toString()}),At.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[yi.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function gH(e){return window.atob(window.localStorage.getItem(e)||"")}function OP(e,r){window.localStorage.setItem(e,window.btoa(r))}function _H(e){let r="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(r+="_s_".concat(e.uid)),typeof e.uid=="number"&&(r+="_".concat(e.uid)),e.token&&(r+="_".concat(e.token)),uW(r)}function oge(e){let r=function(){const i=lge.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let c=i.appId;c!==void 0&&(Si(o,10),$m(o,c));let u=i.cid;u!==void 0&&(Si(o,16),Si(o,u));let h=i.cname;h!==void 0&&(Si(o,26),$m(o,h));let m=i.deviceId;m!==void 0&&(Si(o,34),$m(o,m));let _=i.elapse;_!==void 0&&(Si(o,40),Km(o,_));let E=i.fileSize;E!==void 0&&(Si(o,48),Km(o,aS(E)));let S=i.height;S!==void 0&&(Si(o,56),Km(o,aS(S)));let R=i.jpg;R!==void 0&&(Si(o,66),Si(o,R.length),EH(o,R));let P=i.networkType;P!==void 0&&(Si(o,72),Km(o,aS(P)));let N=i.osType;N!==void 0&&(Si(o,80),Km(o,aS(N)));let G=i.requestId;G!==void 0&&(Si(o,90),$m(o,G));let F=i.sdkVersion;F!==void 0&&(Si(o,98),$m(o,F));let j=i.sequence;j!==void 0&&(Si(o,104),Km(o,aS(j)));let q=i.sid;q!==void 0&&(Si(o,114),$m(o,q));let ee=i.timestamp;ee!==void 0&&(Si(o,120),Km(o,ee));let he=i.uid;he!==void 0&&(Si(o,128),Si(o,he));let Se=i.vid;Se!==void 0&&(Si(o,136),Si(o,Se));let we=i.width;we!==void 0&&(Si(o,144),Km(o,aS(we)));let ye=i.service;ye!==void 0&&(Si(o,152),Si(o,ye));let Ne=i.callbackData;Ne!==void 0&&(Si(o,162),Si(o,Ne.length),EH(o,Ne));let Ye=i.ticket;Ye!==void 0&&(Si(o,170),$m(o,Ye));let dt=i.vendorConfigs;dt!==void 0&&(Si(o,178),$m(o,dt))}(e,r),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(r)}function age(e){return function(i){let o={};e:for(;!uge(i);){let c=BT(i);switch(c>>>3){case 0:break e;case 1:o.code=BT(i);break;case 2:o.msg=vH(i,BT(i));break;case 3:o.requestId=vH(i,BT(i));break;case 4:o.timestamp=dge(i,!1);break;default:cge(i,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function cge(e,r){switch(r){case 0:for(;128&Tu(e););break;case 2:u2(e,BT(e));break;case 5:u2(e,4);break;case 1:u2(e,8);break;default:throw new Error("Unimplemented type: "+r)}}function aS(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let lge=[];function u2(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function uge(e){return e.offset>=e.limit}function kP(e,r){let i=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function yH(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function EH(e,r){let i=kP(e,r.length);e.bytes.set(r,i)}function vH(e,r){let i=yH(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,E,S,R,P=c[m+i];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+i+1],E=c[m+i+2],(49344&(_|E<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&E,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+i+1],E=c[m+i+2],S=c[m+i+3],(12632256&(_|E<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&E)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function $m(e,r){let i=r.length,o=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}Si(e,o);let c=kP(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Tu(e){return e.bytes[yH(e,1)]}function SH(e,r){let i=kP(e,1);e.bytes[i]=r}function BT(e){let r,i=0,o=0;do r=Tu(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function Si(e,r){for(r>>>=0;r>=128;)SH(e,127&r|128),r>>>=7;SH(e,r)}function dge(e,r){let i,o=0,c=0,u=0;return i=Tu(e),o=127&i,128&i&&(i=Tu(e),o|=(127&i)<<7,128&i&&(i=Tu(e),o|=(127&i)<<14,128&i&&(i=Tu(e),o|=(127&i)<<21,128&i&&(i=Tu(e),c=127&i,128&i&&(i=Tu(e),c|=(127&i)<<7,128&i&&(i=Tu(e),c|=(127&i)<<14,128&i&&(i=Tu(e),c|=(127&i)<<21,128&i&&(i=Tu(e),u=127&i,128&i&&(i=Tu(e),u|=(127&i)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:r}}function Km(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=kP(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}const bH={},TH={},NP=4294967296,hge=NP*NP,pge=hge/2;CH(0,!0);const wH=CH(0),fge=WT(0,-2147483648,!1),mge=WT(-1,2147483647,!1);function CH(e,r){let i,o,c;return r?(c=0<=(e>>>=0)&&e<256)&&(o=TH[e],o)?o:(i=WT(e,0,!0),c&&(TH[e]=i),i):(c=-128<=(e|=0)&&e<128)&&(o=bH[e],o)?o:(i=WT(e,e<0?-1:0,!1),c&&(bH[e]=i),i)}function WT(e,r,i){return{low:0|e,high:0|r,unsigned:!!i}}function RH(e,r){if(isNaN(e))return wH;{if(e<=-9223372036854776e3)return fge;if(e+1>=pge)return mge}return e<0?wH:WT(e%NP|0,e/NP|0,r)}function IH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class d2 extends Mr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(vd.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),K(this,"name","AgoraRTCImageModeration"),K(this,"_connectionState",Pl.CONNECTING),K(this,"_sequence",0),K(this,"_moderationStartTime",void 0),K(this,"_workerConnection",void 0),K(this,"_workerMessageLengthLimit",void 0),K(this,"_qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",la.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"_moderationInterval",void 0),K(this,"_moderationTimer",null),K(this,"_moderationMode",1),K(this,"_quality",1),K(this,"_qualityTimer",null),K(this,"_ticket",void 0),K(this,"_moderationIntervalMinimum",void 0),K(this,"_uploadFailedNum",0),K(this,"_uploadNum",0),K(this,"_uploadTimer",null),K(this,"_extraInfo",void 0),K(this,"_vendor",""),K(this,"_encoder",new TextEncoder),K(this,"_moderationId",void 0),K(this,"inspectImage",()=>{if(this.connectionState!==Pl.CONNECTED)throw new Oe(te.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Pl.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=dr(5,"image-moderation-"),this._workerMessageLengthLimit=oe("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=oe("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=oe("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new kT("worker-"+this._moderationId,Ii),this.on(vd.STATE_CHANGE,(o,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Xv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(vd.STATE_CHANGE,Xv.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=i,new ut((c,u)=>{this.on(vd.CONNECTION_STATE_CHANGE,(h,m)=>{h===Pl.CONNECTED&&c()}),this.requestAP(r,o,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Pl.CONNECTED&&this.inspectImage()}async requestAP(r,i,o){const c=oe("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,E,S,R){let{appId:P,areaCode:N,cname:G,sid:F,token:j,uid:q}=E;nS++;const ee="moderation_plugin",he={service_name:ee,json_body:JSON.stringify({appId:P,areaCode:N,cname:G,command:"allocateEdge",requestId:nS,seq:nS,sid:F,appToken:j,ts:Date.now(),uid:q+""})};let Se,we,ye=_[0];return gd(async()=>{Se=Date.now();const Ne=await Sd(ye,{data:he,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(we=Date.now()-Se,Ne.code!==0){const ft=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ne.code,{retry:!0,responseTime:we});throw x.error(ft.toString()),ft}const Ye=JSON.parse(Ne.json_body);if(Ye.code!==200){const ft=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ye.code,", reason: ").concat(Ye.reason),{code:Ye.code,responseTime:we});throw x.error(ft.toString()),ft}if(!Ye.servers||!Array.isArray(Ye.servers)||Ye.servers.length===0){const ft=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ye.code,responseTime:we});throw x.error(ft.toString()),ft}if(!Ye.servers.some(ft=>!!ft.wss)){const ft=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ye.code,responseTime:we});throw x.error(ft.toString()),ft}const dt=oe("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ye.servers.map(ft=>{let{address:Rn,wss:In}=ft;if(Rn&&In)return"wss://".concat(Rn.replace(/\./g,"-"),".").concat(dt,":").concat(In,"/moderation")}).filter(ft=>!!ft),workerToken:Ye.workerToken,vid:Ye.vid,ticket:Ye.appTicket,responseTime:we}},(Ne,Ye)=>(At.apworkerEvent(F,{success:!0,sc:200,serviceName:ee,responseDetail:JSON.stringify(Ne.addressList),firstSuccess:Ye===0,responseTime:we,serverIp:_[Ye%_.length]}),!1),(Ne,Ye)=>(At.apworkerEvent(F,{success:!1,sc:Ne.data&&Ne.data.code||200,serviceName:ee,responseTime:we,serverIp:_[Ye%_.length]}),!!(Ne.code!==te.OPERATION_ABORTED&&Ne.code!==te.UNEXPECTED_RESPONSE||Ne.data&&Ne.data.retry)&&(ye=_[(Ye+1)%_.length],!0)),R)}(c,r,i,o);this.emit(vd.STATE_CHANGE,Xv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(vd.STATE_CHANGE,Xv.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(Qt.CONNECTED,async()=>{this.emit(vd.STATE_CHANGE,Xv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Pl.CONNECTED}),this._workerConnection.on(Qt.CLOSED,()=>{this.connectionState=Pl.CLOSED}),this._workerConnection.on(Qt.FAILED,()=>{this.connectionState=Pl.CLOSED}),this._workerConnection.on(Qt.RECONNECTING,()=>{this.connectionState=this.connectionState===Pl.CONNECTED?Pl.RECONNECTING:Pl.CONNECTING}),this._workerConnection.on(Qt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const i=age(new Uint8Array(r.data));oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{At.reportApiInvoke(this._connectInfo.sid||null,{name:Ri.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:Wr.TRACER}).onError(new Oe(te.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},oe("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Qt.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(Qt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Hc(this,vd.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,i);this._workerConnection.sendMessage(o,!0,!0)}else oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await ZW(S,o,c),P=this._sequence+"-"+u+"-"+_+"-"+E+"-"+dr(12,""),N={appId:o,cid:u,cname:c,deviceId:"",elapse:d2.intToLong(Number(E-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:RH(E),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete N.callbackData;const G=oge(N);if(G.byteLength<this._workerMessageLengthLimit){if(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const F=function(j){for(var q=1;q<arguments.length;q++){var ee=arguments[q]!=null?arguments[q]:{};q%2?IH(Object(ee),!0).forEach(function(he){K(j,he,ee[he])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(ee)):IH(Object(ee)).forEach(function(he){Object.defineProperty(j,he,Object.getOwnPropertyDescriptor(ee,he))})}return j}({},N);delete F.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(F))}return G}{const F=this.quality*this._qualityRatio;return this.quality=F,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=la.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Pl.CLOSED,this.emit(vd.STATE_CHANGE,Xv.CLOSED)}}function AH(e){if(or(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Oe(te.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Oe(te.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const gge={name:"ImageModeration",create:function(e){let{config:r}=e;return AH(r),new d2(r)}};var PH,OH,kH,NH,DH,xH,LH,MH,UH,VH,FH,jH,BH,WH,zH,GH,HH,$H,KH,qH,YH,XH,JH,QH,ZH,e7,t7,n7,r7,i7,s7,o7,a7,c7,l7,u7,d7,h7,p7,f7,m7,pt;function g7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function wu(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?g7(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}Us.setLogger(x);let _ge=(PH=jt(),OH=jt({argsMap:(e,r)=>{if(!Array.isArray(r)){if(!(r instanceof Wv))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),kH=jt({argsMap:(e,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Bv.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),NH=jt({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),DH=jt({argsMap:(e,r,i)=>[r,i]}),xH=jt({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:c}=i;return[o==null?void 0:o.uid,c]})}),LH=jt({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),MH=jt({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:c}=i;return{uid:o==null?void 0:o.uid,mediaType:c}})}),UH=jt(),VH=jt(),FH=jt(),jH=jt(),BH=jt(),WH=jt(),zH=jt(),GH=jt(),HH=jt(),$H=jt(),KH=jt(),qH=jt(),YH=jt(),XH=jt(),JH=jt(),QH=jt({argsMap:(e,r)=>[r]}),ZH=jt(),e7=jt(),t7=jt(),n7=jt(),r7=jt(),i7=jt(),s7=jt(),o7=jt(),a7=jt({argsMap:(e,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),c7=jt(),l7=jt(),u7=jt(),d7=jt(),h7=jt(),p7=jt(),f7=jt({reportResult:!0}),m7=jt(),pt=class extends Mr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,r){let i;if(super(),K(this,"store",void 0),K(this,"_uid",void 0),K(this,"_channelName",void 0),K(this,"_uintUid",void 0),K(this,"_users",[]),K(this,"_config",void 0),K(this,"_clientId",void 0),K(this,"_appId",void 0),K(this,"_sessionId",null),K(this,"_key",void 0),K(this,"_rtmConfig",{}),K(this,"_joinInfo",void 0),K(this,"_gateway",void 0),K(this,"_statsCollector",void 0),K(this,"_configDistribute",void 0),K(this,"_leaveMutex",void 0),K(this,"_publishMutex",void 0),K(this,"_renewTokenMutex",void 0),K(this,"_subscribeMutex",void 0),K(this,"_encryptionMode","none"),K(this,"_encryptionSecret",null),K(this,"_encryptionSalt",null),K(this,"_encryptDataStream",!1),K(this,"_encryptDataStreamKey",null),K(this,"_encryptDataStreamIv",null),K(this,"_proxyServer",void 0),K(this,"_turnServer",{servers:[],mode:"auto"}),K(this,"_cloudProxyServerMode","disabled"),K(this,"_isDualStreamEnabled",!1),K(this,"_defaultStreamFallbackType",void 0),K(this,"_lowStreamParameter",void 0),K(this,"_streamFallbackTypeCacheMap",new Map),K(this,"_remoteStreamTypeCacheMap",new Map),K(this,"_axiosCancelSource",la.CancelToken.source()),K(this,"_audioVolumeIndicationInterval",void 0),K(this,"_networkQualityInterval",void 0),K(this,"_userOfflineTimeout",void 0),K(this,"_streamRemovedTimeout",void 0),K(this,"_liveTranscodeStreamingClient",void 0),K(this,"_liveRawStreamingClient",void 0),K(this,"_channelMediaRelayClient",void 0),K(this,"_networkQualitySensitivity","normal"),K(this,"_p2pChannel",void 0),K(this,"_useLocalAccessPoint",!1),K(this,"_setLocalAPVersion",void 0),K(this,"_joinAndNotLeaveYet",!1),K(this,"_numberOfJoinCount",0),K(this,"_remoteDefaultVideoStreamType",void 0),K(this,"_inspect",void 0),K(this,"_moderation",void 0),K(this,"_license",void 0),K(this,"_pendingPublishedUsers",[]),K(this,"ntpAlignErrorCount",0),K(this,"remoteInboundOffset",0),K(this,"_peerConnectionState",void 0),K(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),K(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),K(this,"_handleUserOnline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&W_(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(bn.USER_JOINED,u));else{const h=new Gm(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(bn.USER_JOINED,h)}}),K(this,"_handleUserOffline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&W_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:xA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(bn.USER_LEAVED,u,c.reason))}),K(this,"_handleAddAudioOrVideoStream",(c,u,h,m,_,E,S)=>{if(oe("BLOCK_LOCAL_CLIENT")&&W_(u,this.channelName))return;const R=this._users.find(N=>N.uid===u);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=_||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),E&&(R._audioOrtc=E)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),E&&(R._videoOrtc=E)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(bn.USER_PUBLISHED,R,c)),c==="video"?At.onGatewayStream(this._sessionId,qi.ON_ADD_VIDEO_STREAM,kr.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:R._videoSSRC}):At.onGatewayStream(this._sessionId,qi.ON_ADD_AUDIO_STREAM,kr.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(N=>{if(N&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof jT))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(G=>{x.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(N=>{x.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),K(this,"_handleRemoveStream",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&W_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(bn.USER_UNPUBLISHED,u,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(bn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(bn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(bn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof jT&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),At.onGatewayStream(this._sessionId,qi.ON_REMOVE_STREAM,kr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),K(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&W_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,u,R)}}const E=c==="audio"?m.hasAudio:m.hasVideo;return _!==E?!_&&E?(x.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(bn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(bn.USER_UNPUBLISHED,m,c)):void 0}),K(this,"_handleMuteStream",(c,u,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&W_(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,c,R)}}const E=u==="audio"?m.hasAudio:m.hasVideo;if(_!==E){if(!_&&E)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(bn.USER_PUBLISHED,m,u)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(bn.USER_UNPUBLISHED,m,u)}}),K(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),K(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(bn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),K(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),K(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(bn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(bn.NETWORK_QUALITY,c)}),K(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const E=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),m!==void 0&&(_._videoMid=m)),(c==="audio"?_.hasAudio:_.hasVideo)&&!E&&(x.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(bn.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{x.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=r||dr(5,"client-"),this.store=new class{constructor(c,u,h,m){Kt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:L_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case Tn.SET_SESSION_ID:return _t(_t({},u),{},{sessionId:h.sessionId});case Tn.SET_P2P_ID:return _t(_t({},u),{},{p2pId:h.p2pId});case Tn.SET_UID:return _t(_t({},u),{},{uid:h.uid});case Tn.SET_INT_UID:return _t(_t({},u),{},{intUid:h.intUid});case Tn.SET_PUB_ID:return _t(_t({},u),{},{pubId:h.pubId});case Tn.KEY_METRIC_CLIENT_CREATED:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{clientCreated:h.metric})});case Tn.KEY_METRIC_JOIN_START:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{joinStart:h.metric})});case Tn.AVOID_JOIN_START:return _t(_t({},u),{},{avoidJoinStart:h.avoidJoinStart});case Tn.KEY_METRIC_JOIN_END:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{joinEnd:h.metric})});case Tn.KEY_METRIC_REQUEST_AP_START:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{requestAPStart:h.metric})});case Tn.KEY_METRIC_REQUEST_AP_END:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{requestAPEnd:h.metric})});case Tn.KEY_METRIC_JOIN_GATEWAY_START:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case Tn.KEY_METRIC_JOIN_GATEWAY_END:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case Tn.KEY_METRIC_PEER_CONNECTION_START:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case Tn.KEY_METRIC_PEER_CONNECTION_END:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case Tn.KEY_METRIC_DESCRIPTION_START:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{descriptionStart:h.metric})});case Tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case Tn.KEY_METRIC_ICE_CONNECTION_END:return _t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case Tn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,_=m.findIndex(E=>E.trackId===h.metric.trackId);return _!==-1?(m[_]=_t(_t({},m[_]),h.metric),_t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{publish:[...m]})})):_t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case Tn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,_=m.findIndex(E=>E.userId===h.metric.userId&&E.type===h.metric.type);return _!==-1?(m[_]=_t(_t({},m[_]),h.metric),_t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{subscribe:[...m]})})):_t(_t({},u),{},{keyMetrics:_t(_t({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case Tn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case Tn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=_t(_t({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case Tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case Tn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case Tn.SET_USE_P2P:return _t(_t({},u),{},{useP2P:h.val});case Tn.SET_TRANSPORT_TYPE:return _t(_t({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:Tn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:Tn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:Tn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:Tn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:Tn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:Tn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:Tn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:Tn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:Tn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Tn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Tn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Tn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Tn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Tn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Tn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Tn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Tn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Tn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Tn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Tn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:Tn.KEY_METRIC_PUBLISH,metric:_t(_t({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,_,E,S){this.dispatch({type:Tn.KEY_METRIC_SUBSCRIBE,metric:_t(_t(_t(_t(_t({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),E&&{streamAdded:E}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(_=>{this.dispatch({type:Tn.KEY_METRIC_SUBSCRIBE,metric:_t(_t(_t({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:Tn.RECORD_JOIN_CHANNEL_SERVICE,record:_t(_t({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Tn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Tn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:Tn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Us("client-leave",this._clientId),this._publishMutex=new Us("client-publish",this._clientId),this._renewTokenMutex=new Us("client-renewtoken",this._clientId),this._subscribeMutex=new Us("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Rl," build: ").concat(rL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{Gx(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new VT(this.store),this._statsCollector.onStatsException=(c,u,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(bn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const _=this._users.find(E=>E.uid===c);_&&At.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new Lme(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Ii,httpRetryConfig:e.httpRetryConfig||Ii,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new Hme(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},nf("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new jT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,r,i,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];rr("JOIN_GATEWAY_USE_443PORT_ONLY",u),rr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof ML&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(_,E,S){PA.get(_)||PA.set(_,[]),OA.get(_)||OA.set(_,E),fh.get(_)||fh.set(_,0);const R=PA.get(_),P=OA.get(_);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(fh.get(_)===P){const q=mT();R.push(q),await q.promise}fh.set(_,fh.get(_)+1);for(var N=arguments.length,G=new Array(N>3?N-3:0),F=3;F<N;F++)G[F-3]=arguments[F];const j=await S(...G);return fh.set(_,fh.get(_)-1),fh.get(_)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),fh.get(_)===0&&(PA.set(_,[]),OA.set(_,0),fh.set(_,0)),j}("client.join",oe("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,r,i,o,c)}async join(e,r,i,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(UA||UA||(UA=(window.location.protocol.split(":")[0]||"").toUpperCase(),UA))==="HTTPS",m=pW()?window.isSecureContext:"Browser Not Support";(!pW()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),x.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),At.setAppId(e);try{if(!i&&i!==null)throw new Oe(te.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&ds(i,"token",1,2047),ds(e,"appid",1,2047),sP(r),o&&oP(o),c&&ds(c,"optionalInfo",1,2047)}catch(F){throw At.reportApiInvoke(x_(),{name:Ri.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}).onError(F),F}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const F=new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw At.reportApiInvoke(x_(),{name:Ri.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}).onError(F),F}this._gateway.state="CONNECTING";const _=await hH({appId:e,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const E=(_==null?void 0:_.sid)||x_();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=E,this.store.sessionId=this._sessionId);const S=At.reportApiInvoke(E,{id:this._clientId,name:Ri.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}),R=wu(wu(wu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:oe("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async F=>{const j=function(Se){const we=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ye=new Uint8Array(new ArrayBuffer(we.length));for(let Ne=0;Ne<we.length;Ne+=1)ye[Ne]=we.charCodeAt(Ne);return ye}(),q=await window.crypto.subtle.importKey("spki",j,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ee=Wx(F),he=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,ee);return function(Se){let we="";for(let ye=0;ye<Se.length;ye+=1)we+=String.fromCharCode(Se[ye]);return window.btoa(we)}(new Uint8Array(he))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const F=new TextEncoder,j=oe("USE_PURE_ENCRYPTION_MASTER_KEY")?F.encode(R.appId+this._encryptionSecret+this._encryptionSecret):F.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(q,ee,he){const Se=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),we=q==="aes-128-gcm2"?128:256,ye=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:TW,hash:"SHA-256",salt:he},Se,we+dfe);return new Uint8Array(ye).subarray(we/8)}(this._encryptionMode,j,D_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(q,ee,he){const Se=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),we=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:TW,hash:"SHA-256",salt:he},Se,{name:"AES-GCM",length:we},!0,["encrypt","decrypt"])}(this._encryptionMode,j,D_(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:e,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&At.joinChannelTimeout(this._sessionId,5)},5e3);try{var N;let F;const j=R.cloudProxyServer;if(st(N=["proxy3","proxy4","proxy5"]).call(N,j)){const we=oe("PROXY_SERVER_TYPE3");Array.isArray(we)?R.proxyServer=we[0]:R.proxyServer=we}if(At.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),_){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(_.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=_.intUid),F={gatewayInfo:_.ap.gatewayInfo},oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const we=(await i9(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(ye=>({turnServerURL:ye.address,tcpport:ye.tcpport||Os.tcpport,udpport:ye.udpport||Os.udpport,username:ye.username||Os.username,password:ye.password||Os.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:we}}mH(_,R.stringUid)}else{if(R.stringUid&&!R.uid){let we;[we,F]=await ut.all([N9(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ii,this.store),k9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ii,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(we)),R.uid=we,F.gatewayInfo.uid=we,F.gatewayInfo.res.uid=we}else F=await k9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ii,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(PT.UPDATE_BITRATE_LIMIT,we=>{this._p2pChannel.updateBitrateLimit(we)}),this._configDistribute.on(PT.UPDATE_CLIENT_ROLE_OPTIONS,we=>{this._setClientRoleOptions(we)})},0),this._key=i||e;const q=F.gatewayInfo,ee=R.uid?R.uid:q.uid;this._joinInfo=wu(wu({},R),{},{cid:q.cid,uid:ee,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=ee,this.store.cid=q.cid;const he=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(he),this._appId=e,this._channelName=R.cname,this._uid=he,this.store.uid=he,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Is()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Se=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(Se)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),G=this,st(B_).call(B_,G)||B_.push(G),this._cloudProxyServerMode==="disabled"&&jn().supportWebCrypto&&oe("ENABLE_PRELOAD")&&l2(this._joinInfo),he}catch(F){const j=Array.isArray(F)?F[0]:F;throw j&&j.code===te.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j):x.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j),j.code!==te.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(j),j}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(te.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!oe("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Is()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const i=B_.indexOf(r);i!==-1&&B_.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",qn.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Wv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Oe(te.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new Oe(te.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof Wv))throw new Oe(te.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(te.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof br&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),x.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){or(e.id,"id",0,65535,!0),Yp(e.ordered,"ordered"),ds(e.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Oe(te.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Oe(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return b9(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(te.CREATE_DATACHANNEL_ERROR);try{await ut.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==te.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw x.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(e)if(Array.isArray(e))r=e;else{if(!(e instanceof Wv))return this._unpublishDataChannel([e]);r=[e]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(oi.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw x.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const r=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(e,r,i){if(!(e instanceof Gm)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");e=o}return r==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,r)}async presubscribe(e,r){if(Bi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(te.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=r===yt.AUDIO,o=r===yt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:_,uint_id:E}=await this._gateway.presubscribe(e,r,!0);if(u==null)throw new Oe(te.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===e);S||(S=new Gm(e,E||e),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=E||e),i&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const R=i?S._audioTrack:S._videoTrack;if(!R)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw x.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,r){var i;if(or(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Oe(te.INVALID_REMOTE_USER,"user is not published");const c=(i=e._dataChannels)===null||i===void 0?void 0:i.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[c]);if(m&&st(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(te.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,r,i){if(Bi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Oe(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!i&&(r==="audio"&&!e.hasAudio||r==="video"&&!e.hasVideo)){const u=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const h=r==="audio"?e._audioSSRC:e._videoSSRC,m=r==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,r,i){if(this.store.useP2P)return this._p2pSubscribe(e,r);if(Bi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(E=>E===e)){const E=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),E}if(!e.hasAudio&&!e.hasVideo){const E=new Oe(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),E}if(!(i||(r!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(r!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const E=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),E}let c=r==="audio"?e._audioSSRC:e._videoSSRC,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?yt.AUDIO:yt.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const S=r==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?yt.AUDIO:yt.VIDEO,ssrcId:c}),js.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,r,Date.now()),await this._p2pChannel.subscribe(e,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,r),R;await this._p2pChannel.unsubscribe(e,r,!0),this._p2pChannel.setPendingRemoteMedia(e,r)}this.store.subscribe(e.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,r),S}x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const E=r==="audio"?e._audioTrack:e._videoTrack;if(!E)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user object");return E}catch(E){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),E),E}finally{_()}}async massSubscribe(e){if(Xp(e,"subscribeList"),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),i=new Map,o=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:_,mediaType:E}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(E)}).join("; ")));const c=(e=[...e]).map(m=>{let{user:_,mediaType:E}=m;return{user:_,mediaType:E}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const E=e[_],{user:S,mediaType:R}=E;if(Bi(R,"mediaType",["audio","video"]),!S){const F=new Oe(te.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),F}if(!this._users.find(F=>F===S)){const F=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=F,e.splice(_,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const F=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[_].error=F,e.splice(_,1);continue}const N=Yi.Video|Yi.LwoVideo,G=i.get(S);if(G){if(R==="video"?G&N:G&Yi.Audio){e.splice(_,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}i.set(S,G|(R==="video"?N:Yi.Audio))}else i.set(S,R==="video"?N:Yi.Audio)}for(let _=e.length-1;_>=0;_--){const E=e[_],{user:S,mediaType:R}=E,P=Yi.Video|Yi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const N=i.get(S);i.set(S,R==="video"?N^P:N^Yi.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),r);let m=cc(h=Array.from(i.entries())).call(h,(_,E)=>{let[S,R]=E;if(R===0)return _;const P={stream_id:S.uid,stream_type:R};return R&Yi.Audio&&(P.audio_ssrc=S._audioSSRC),R&Yi.Video&&(P.video_ssrc=S._videoSSRC),_.push(P),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(E=>{let{user:S,mediaType:R}=E;return{user:S,mediaType:R,ssrcId:R===yt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===yt.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(E=>E.video_ssrc&&!this._p2pChannel.isPreSubScribe(E.video_ssrc)||E.audio_ssrc&&!this._p2pChannel.isPreSubScribe(E.audio_ssrc)||!E.video_ssrc&&!E.audio_ssrc),m.length>0){const E=await this._gateway.subscribeAll(m,!0);((E==null?void 0:E.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:P,audio_error_code:N,error_code:G}=S;(P||N||G)&&_.set(R,{video_error_code:P,audio_error_code:N,error_code:G})})}if(Array.from(_.entries()).length>0){const E=[];Array.from(_.entries()).forEach(S=>{let[R,P]=S;const N=this.remoteUsers.find(G=>G.uid===R);if(N){let G;P.error_code||P.video_error_code&&P.audio_error_code?G=void 0:P.video_error_code?G=yt.VIDEO:P.audio_error_code&&(G=yt.AUDIO),E.push({user:N,mediaType:G})}}),E.length>0&&await this._p2pChannel.massUnsubscribeNoLock(E)}for(const E of c){const S=_.get(E.user.uid);if(S){const R=S.error_code||E.mediaType==="audio"&&S.audio_error_code||E.mediaType==="video"&&S.video_error_code;if(R){const P=OT(R);x.error("user:".concat(E.user.uid," mediaType:").concat(E.mediaType," has massSubscribe error ").concat(P.desc)),E.error=new Oe(te.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}E.error||(E.mediaType==="video"?E.track=E.user.videoTrack:E.track=E.user.audioTrack)}return this.store.massSubscribe(c.filter(E=>!E.error).map(E=>({userId:E.user.uid,type:E.mediaType})),void 0,Date.now()),c.forEach(E=>{var S;At.subscribe(this.store.sessionId,{succ:!!E.error,ec:((S=E.error)===null||S===void 0?void 0:S.code)||null,video:E.mediaType===yt.VIDEO,audio:E.mediaType===yt.AUDIO,peerid:E.user.uid,subscribeRequestid:E.mediaType===yt.VIDEO?E.user._videoSSRC:E.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(E.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(E=>{let{user:S,mediaType:R}=E;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),o()}}async unsubscribe(e,r,i){if(!(e instanceof Gm)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(r&&Bi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,r);else{const u=await this._p2pChannel.unsubscribe(e,r);u&&await this._gateway.unsubscribe(u,e.uid),r&&r!=="audio"||(e._audio_pre_subscribed=!1),r&&r!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&xA(this._users,e),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,r){if(r&&or(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=e._dataChannels.find(u=>u.id===r);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Xp(e,"unsubscribeList"),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const r=new Map;for(let i=e.length-1;i>=0;i--){const{user:o,mediaType:c}=e[i];if(!o){const m=new Oe(te.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Bi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}const h=Yi.Video|Yi.LwoVideo;if(r.has(o)){const m=r.get(o);let _;switch(c){case"video":_=m&h;break;case"audio":_=m&Yi.Audio;break;default:_=m&(Yi.Audio|h)}if(_){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(i,1);continue}c?c==="audio"?r.set(o,m|Yi.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|Yi.Audio|h)}else c?c==="audio"?r.set(o,Yi.Audio):c==="video"&&r.set(o,h):r.set(o,Yi.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===te.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new Me(te.INVALID_PARAMS);Br(i.width)||jx(i.width,"streamParameter.width"),Br(i.height)||jx(i.height,"streamParameter.height"),Br(i.framerate)||jx(i.framerate,"streamParameter.framerate"),Br(i.bitrate)||or(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&e.bitrate&&r.bitrate<e.bitrate&&(e.bitrate=r.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ke.LocalVideoLowTrack)}async enableDualStream(){if(!jn().supportDualStream)throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(te.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(te.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ke.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,r){if(function(o){Bi(o,"role",["audience","host"])}(e),r&&Gx(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(te.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&e==="host")throw new Oe(te.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(te.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&oe("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,r),this._config.role=e,this._gateway.reconnect("recover",As.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,r),this._config.role=e),x.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(r&&r.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{e&&Gx(e),await this._gateway.setClientRole(this._config.role,e),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const r=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!r||!r.timestamp)return 0;const i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,r){if(ds(e,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,At.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(e,r){if(Array.isArray(e)||(e=[e]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy")}if(vT(e))return this._turnServer={servers:e,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>tW(i)),this._turnServer={servers:e,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"you should set license before join channel");if(ds(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Oe(te.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,x.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Oe(te.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new Oe(te.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Stop proxy server after leave channel");At.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Oe(te.INVALID_PARAMS,"accessPoints is required.");Xp(e.accessPoints.serverList,"accessPoints.serverList"),ds(e.accessPoints.domain,"accessPoints.domain");const r=(P,N)=>{or(P,N,0,65535,!0)};let i=443;if(e.accessPoints.port&&(r(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");oe("CLOSE_AFB_FOR_LOCAL_AP")&&(rr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),rr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(P=>o.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,rr("WEBCS_DOMAIN",h),rr("WEBCS_DOMAIN_BACKUP_LIST",h),rr("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Xp(e.report.hostname,"report.hostname"),rr("EVENT_REPORT_DOMAIN",e.report.hostname[0]),rr("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(rr("EVENT_REPORT_DOMAIN",u[0]),rr("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(r(e.report.port,"report.port"),m=e.report.port),rr("STATS_COLLECTOR_PORT",m),e.report?rr("ENABLE_EVENT_REPORT",!0):rr("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Xp(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let E=6444;e.log&&e.log.port&&(r(e.log.port,"log.port"),E=e.log.port),rr("LOG_UPLOAD_SERVER","".concat(_,":").concat(E));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Xp(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let R=443;e.cds&&e.cds.port&&(r(e.cds.port,"cds.port"),R=e.cds.port),rr("CDS_AP",S.map(P=>"".concat(P,":").concat(R))),e.cds?rr("ENABLE_CONFIG_DISTRIBUTE",!0):rr("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(e,r){if(Xp(e,"serverList"),ds(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,rr("WEBCS_DOMAIN",e),rr("WEBCS_DOMAIN_BACKUP_LIST",e),rr("GATEWAY_DOMAINS",[r]),rr("EVENT_REPORT_DOMAIN",e[0]),rr("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),rr("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Bi(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,r){Bi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,r),setTimeout(()=>{const i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}x.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(e,r)}async setStreamFallbackOption(e,r){Bi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,r)}catch(i){throw x.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}x.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(e,r)}setEncryptionConfig(e,r,i,o){(function(u){Bi(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),ds(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(st(c).call(c,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new Oe(te.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new Oe(te.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Yp(o,"encryptDataStream"),!st(c).call(c,e))throw new Oe(te.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=r,i&&(this._encryptionSalt=Mm(i))}async renewToken(e){if(ds(e,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(oe("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Gme(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ii);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(bn.VOLUME_INDICATOR,e)},oe("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return e.Duration=Math.round(r.duration/1e3),e}async startLiveStreaming(e,r){if(!r){if(this.codec!=="h264")throw new Oe(te.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(te.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Oe(te.LIVE_STREAMING_TASK_CONFLICT);const i=r?Zp.TRANSCODE:Zp.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(Zp.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!r.length)throw new Oe(te.INVALID_PARAMS,"can not find live streaming url to stop");await ut.all(r.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){F9(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){F9(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof jT&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var m;const _=cc(m=Array.from(h)).call(m,(F,j)=>F+j,0),E={serverTs:0,seq:hfe++,length:h.length,checkSum:_},S=new Uint8Array(lW(_,2)),R=new ArrayBuffer(Lv),P=new DataView(R);P.setUint32(0,E.serverTs),P.setUint16(4,E.seq),P.setUint16(6,E.length),P.setUint16(8,E.checkSum);const N=16-h.length%16;h=iW(h,new Uint8Array(N));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:bW,additionalData:S},u,h);return iW(new Uint8Array(R),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Oe(te.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Gt.DATA_STREAM,{payload:Mm(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Zme},!i)}sendMetadata(e){if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Oe(te.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Gt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Mm(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Sfe),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send custom report, not joined");await At.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,r){Bi(r.spatialLayer,"spatialLayer",[0,1,2,3]),Bi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,r)}catch(i){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:r=!1,rtmFlag:i}=e;if(Yp(r,"apRTM"),or(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(e){const r=qv.indexOf(e);r!==-1&&qv.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=la.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&fH(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&At.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(r=>r._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Us("client-publish",this._clientId),this._subscribeMutex=new Us("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,r){var i;const o=e||x_();e?x.debug("[".concat(this._clientId,"] new Session ").concat(o)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,At.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};At.sessionInit(this._sessionId,wu({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Oe(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(oi.PUBLISH,o,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await i.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==te.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof br&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===te.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==te.DISCONNECT_P2P)throw i.throw(u),u}i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===te.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(te.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},nf("LiveStreaming").create(o));var o;return i.onLiveStreamError=(c,u)=>{At.reportApiInvoke(this._sessionId,{name:Ri.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Wr.TRACER}).onSuccess(),this.safeEmit(bn.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{At.reportApiInvoke(this._sessionId,{name:Ri.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Wr.TRACER}).onSuccess(),this.safeEmit(bn.LIVE_STREAMING_WARNING,c,u)},i.on(xL.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Oe(te.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,E,S){const R=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(P=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Vme(R,m,_,E,S)})(c,this._joinInfo,this._axiosCancelSource.token,Ii).then(u).catch(h)}),i};return e===Zp.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(te.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},nf("ChannelMediaRelay").create(e));o.on("state",c=>{c===Ba.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(bn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(bn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,r){const{added:i,deleted:o}=e,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{i.every(_=>_.uid!==h._uintid||_.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:m,ordered:_,max_retrans_times:E,metadata:S}=u,R=this._users.find(P=>P._uintid===h);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),st(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!_,maxRetransmits:E,metadata:S},N=function(G){return b9(G,!0)}(P);R._dataChannels.push(N),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(bn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(P=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(bn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=_._dataChannels.find(S=>S.id===u.stream_id);E&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[E]).then(S=>{if(_._dataChannels=_._dataChannels.filter(R=>R!==E),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(bn.USER_UNPUBLISHED,_,"datachannel",E._config))})}_handleRemoveDataChannels(e){const r=this._users.find(i=>i.uid===e.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(bn.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),i()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(os.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:u,expires:h}=r[o];h&&h<=i||u||IL()||!Object.prototype.hasOwnProperty.call(jA,o)||(_d[o]=c,Sr[o]=c,x.debug("Update gateway parameters from config distribute",o,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(os.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(os.CONNECTION_STATE_CHANGE,(e,r,i)=>{var o;if(i===qn.FALLBACK)return;const c=()=>{this.safeEmit(bn.CONNECTION_STATE_CHANGE,e,r,i)};if(At.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:Ri.CONNECTION_STATE_CHANGE,options:[e,r,i],tag:Wr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:r,reason:i})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(_=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(_=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,yt.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,yt.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(os.REQUEST_NEW_GATEWAY_LIST,async(e,r)=>{if(!this._joinInfo)return r(new Oe(te.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const o=await hH(wu(wu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,mH(o),this._joinInfo.preload=!0):(i=await XL(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ii,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const c=[];i.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):c.push({host:m,port:_})}),e(c)}catch(i){r(i)}}),this._gateway.on(os.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(bn.NETWORK_QUALITY,e)}),this._gateway.on(os.STREAM_TYPE_CHANGE,(e,r)=>{this.safeEmit(bn.STREAM_TYPE_CHANGED,e,r),At.reportApiInvoke(this._sessionId,{name:Ri.STREAM_TYPE_CHANGE,options:[e,r],tag:Wr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:r}))}),this._gateway.on(os.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(os.REQUEST_P2P_CONNECTION_PARAMS,async(e,r,i)=>{try{let o=await this._p2pChannel.getEstablishParams();oe("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),r(o)}catch(o){i(o)}}),this._gateway.on(os.JOIN_RESPONSE,(e,r)=>{if(this.store.useP2P)return;let i;e.attributes?i=e.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const o=u9(e.ortc,r,i);this._p2pChannel.connect(o)}),this._gateway.on(os.PRE_CONNECT_PC,async e=>{const{candidates:r,fingerprint:i}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=oe("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(wn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(wn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(wn.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(wn.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(wn.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(wn.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(wn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(wn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(wn.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,yt.AUDIO,!0)),this._gateway.signal.on(wn.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,yt.AUDIO,!1)),this._gateway.signal.on(wn.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,yt.VIDEO,!0)),this._gateway.signal.on(wn.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,yt.VIDEO,!1)),this._gateway.signal.on(wn.RECEIVE_METADATA,e=>{const r=D_(e.metadata);this.safeEmit(bn.RECEIVE_METADATA,e.uid,r)}),this._gateway.signal.on(wn.ON_DATA_STREAM,async e=>{var r;if(!e)return;let i=D_(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(e.payload.length<Lv)throw new Oe(te.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Lv));i=await async function(u,h,m){const _=m.subarray(0,Lv),E=_.slice(8,Lv),S=(E[0]<<8)+E[1],R=(_[6]<<8)+_[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:bW,additionalData:new Uint8Array(lW(S,2))},h,m.subarray(Lv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),tge(wu(wu({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(wn.ON_CRYPT_ERROR,()=>{Lm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(bn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(wn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(wn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,qn.TOKEN_EXPIRE),this.safeEmit(bn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(wn.ON_STREAM_FALLBACK_UPDATE,e=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(bn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(wn.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(wn.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(wn.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Ht.REQUEST_TIMEOUT,(e,r)=>{if(this._joinInfo)switch(e){case Gt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var i,o;const u=c.some(_=>{let{stream_type:E}=_;return E===Xn.Audio}),h=c.some(_=>{let{stream_type:E}=_;return E!==Xn.Audio}),m=c.some(_=>{let{stream_type:E}=_;return E===Xn.Screen||E===Xn.ScreenLow});r.state==="offer"&&At.publish(this._joinInfo.sid,{eventElapse:js.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:te.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(i=c.find(_=>{let{stream_type:E}=_;return E===Xn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:E}=_;return E!==Xn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Gt.SUBSCRIBE:r&&At.subscribe(this._joinInfo.sid,{succ:!1,ec:te.TIMEOUT,audio:r.stream_type===yt.AUDIO,video:r.stream_type===yt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:js.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(wn.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(wn.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;oe("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!W_(o.string_id||o.stream_id,this.channelName)));const r=[],i=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Gm(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(bn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(bn.USER_JOINED,c)));const u=Yi.Audio&o.stream_type,h=(Yi.Video|Yi.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,_=u&&c.hasAudio,E=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(bn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(bn.USER_PUBLISHED,c,"audio")),h&&!E&&this.getListeners(bn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(bn.USER_PUBLISHED,c,"video")),(u&&!_||h&&!E||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(bn.PUBLISHED_USER_LIST).length>0?oe("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(bn.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(wn.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:r}=e;this._p2pChannel instanceof jT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var o;return st(o=Object.keys(BA)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(wn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(oi.PUBLISH,(e,r,i)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const E=this._users.find(S=>S.uid===o);return E&&this.store.useP2P?this._p2pChannel.mockSubscribe(E,u,h[0].ssrcId,m).then(()=>{r()}).catch(i):r(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(oi.CALL,async(e,r,i)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){i(c)}}),this._gateway.signal.on(Ht.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(oi.UNPUBLISH,async(e,r,i)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const _=m===Xn.Audio?yt.AUDIO:yt.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),r()}catch(h){i(h)}}}),this._gateway.signal.on(oi.CONTROL,async(e,r)=>{const{action:i}=e;switch(i){case Fm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,yt.VIDEO,!0);break;case Fm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,yt.AUDIO,!0);break;case Fm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,yt.VIDEO,!1);break;case Fm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,yt.AUDIO,!1)}}),this._gateway.signal.on(oi.RESTART_ICE,async(e,r,i)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==Lo.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){i(o)}}),this._gateway.signal.on(oi.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:r,direction:i}=e;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(xt.RequestP2PRestartICE,async(e,r,i)=>{try{const{direction:o}=e;r(await this._gateway.sendExtensionMessage(oi.RESTART_ICE,e,o===Lo.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(xt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(oi.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(xt.RequestP2PMuteLocal,async(e,r,i)=>{try{await this._gateway.sendExtensionMessage(oi.CONTROL,e,!0),r()}catch(o){i(o)}}),this._p2pChannel.on(xt.RequestP2PUnmuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(xt.RequestP2PMuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(xt.StateChange,(e,r)=>{r===Yn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(xt.PeerConnectionStateChange,e=>{const r=this._peerConnectionState;e!==r&&(this.safeEmit(bn.PEERCONNECTION_STATE_CHANGE,e,r),this._peerConnectionState=e)}),this._p2pChannel.on(xt.RequestMuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(xt.RequestUnmuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(xt.RequestRePublish,(e,r,i)=>{this.publish(e,!1).then(r).catch(i)}),this._p2pChannel.on(xt.RequestRePublishDataChannel,(e,r,i)=>{ut.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==te.DISCONNECT_P2P)throw u}})).then(r).catch(i)}),this._p2pChannel.on(xt.RequestReSubscribe,async(e,r,i)=>{try{for(const{user:o,kind:c}of e)c===yt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){i(o)}}),this._p2pChannel.on(xt.RequestUpload,(e,r)=>{this._gateway.upload(e,r)}),this._p2pChannel.on(xt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(xt.MediaReconnectStart,e=>{this.safeEmit(bn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(xt.MediaReconnectEnd,e=>{this.safeEmit(bn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(xt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(xt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(e),i=await r.next();if(i.done)return;const o=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(xt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(xt.RequestReconnectPC,async()=>{var e;const{iceParameters:r,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:o}),h=u9(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(xt.RequestUnpublishForReconnectPC,async(e,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),r()):i()}),this._p2pChannel.on(xt.P2PLost,()=>{this.safeEmit(bn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(xt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(xt.ConnectionTypeChange,e=>{this.safeEmit(bn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(xt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(xt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(xt.AudioMetadata,e=>{this.safeEmit(bn.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(r={config:e},nf("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:_,vid:E}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:_,vid:E?Number(E):0},Ii)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(e){e.on(as.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(bn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===vu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(bn.CONTENT_INSPECT_ERROR,new Oe(te.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(as.INSPECT_RESULT,(r,i)=>{var o;if((i==null?void 0:i.code)===te.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(bn.CONTENT_INSPECT_RESULT,r,i)}),e.on(as.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,r){if(Yp(e,"enabled"),e){if(!r)throw new Oe(te.INVALID_PARAMS,"config is required");if(AH(r),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(i={config:r},nf("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:_,cid:E,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:_,cid:E,vid:S?Number(S):0},Ii)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(vd.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(bn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===Pl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(te.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(vd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(r){Bi(r,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Oe(te.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Yp(e,"enabled"),rr("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,r){switch(r){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Tt(pt.prototype,"leave",[PH],Object.getOwnPropertyDescriptor(pt.prototype,"leave"),pt.prototype),Tt(pt.prototype,"publish",[OH],Object.getOwnPropertyDescriptor(pt.prototype,"publish"),pt.prototype),Tt(pt.prototype,"unpublish",[kH],Object.getOwnPropertyDescriptor(pt.prototype,"unpublish"),pt.prototype),Tt(pt.prototype,"subscribe",[NH],Object.getOwnPropertyDescriptor(pt.prototype,"subscribe"),pt.prototype),Tt(pt.prototype,"presubscribe",[DH],Object.getOwnPropertyDescriptor(pt.prototype,"presubscribe"),pt.prototype),Tt(pt.prototype,"massSubscribe",[xH],Object.getOwnPropertyDescriptor(pt.prototype,"massSubscribe"),pt.prototype),Tt(pt.prototype,"unsubscribe",[LH],Object.getOwnPropertyDescriptor(pt.prototype,"unsubscribe"),pt.prototype),Tt(pt.prototype,"massUnsubscribe",[MH],Object.getOwnPropertyDescriptor(pt.prototype,"massUnsubscribe"),pt.prototype),Tt(pt.prototype,"setLowStreamParameter",[UH],Object.getOwnPropertyDescriptor(pt.prototype,"setLowStreamParameter"),pt.prototype),Tt(pt.prototype,"enableDualStream",[VH],Object.getOwnPropertyDescriptor(pt.prototype,"enableDualStream"),pt.prototype),Tt(pt.prototype,"disableDualStream",[FH],Object.getOwnPropertyDescriptor(pt.prototype,"disableDualStream"),pt.prototype),Tt(pt.prototype,"setClientRole",[jH],Object.getOwnPropertyDescriptor(pt.prototype,"setClientRole"),pt.prototype),Tt(pt.prototype,"_setClientRoleOptions",[BH],Object.getOwnPropertyDescriptor(pt.prototype,"_setClientRoleOptions"),pt.prototype),Tt(pt.prototype,"setProxyServer",[WH],Object.getOwnPropertyDescriptor(pt.prototype,"setProxyServer"),pt.prototype),Tt(pt.prototype,"setTurnServer",[zH],Object.getOwnPropertyDescriptor(pt.prototype,"setTurnServer"),pt.prototype),Tt(pt.prototype,"setLicense",[GH],Object.getOwnPropertyDescriptor(pt.prototype,"setLicense"),pt.prototype),Tt(pt.prototype,"startProxyServer",[HH],Object.getOwnPropertyDescriptor(pt.prototype,"startProxyServer"),pt.prototype),Tt(pt.prototype,"stopProxyServer",[$H],Object.getOwnPropertyDescriptor(pt.prototype,"stopProxyServer"),pt.prototype),Tt(pt.prototype,"setLocalAccessPointsV2",[KH],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPointsV2"),pt.prototype),Tt(pt.prototype,"setLocalAccessPoints",[qH],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPoints"),pt.prototype),Tt(pt.prototype,"setRemoteDefaultVideoStreamType",[YH],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteDefaultVideoStreamType"),pt.prototype),Tt(pt.prototype,"setRemoteVideoStreamType",[XH],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteVideoStreamType"),pt.prototype),Tt(pt.prototype,"setStreamFallbackOption",[JH],Object.getOwnPropertyDescriptor(pt.prototype,"setStreamFallbackOption"),pt.prototype),Tt(pt.prototype,"setEncryptionConfig",[QH],Object.getOwnPropertyDescriptor(pt.prototype,"setEncryptionConfig"),pt.prototype),Tt(pt.prototype,"renewToken",[ZH],Object.getOwnPropertyDescriptor(pt.prototype,"renewToken"),pt.prototype),Tt(pt.prototype,"enableAudioVolumeIndicator",[e7],Object.getOwnPropertyDescriptor(pt.prototype,"enableAudioVolumeIndicator"),pt.prototype),Tt(pt.prototype,"startLiveStreaming",[t7],Object.getOwnPropertyDescriptor(pt.prototype,"startLiveStreaming"),pt.prototype),Tt(pt.prototype,"setLiveTranscoding",[n7],Object.getOwnPropertyDescriptor(pt.prototype,"setLiveTranscoding"),pt.prototype),Tt(pt.prototype,"stopLiveStreaming",[r7],Object.getOwnPropertyDescriptor(pt.prototype,"stopLiveStreaming"),pt.prototype),Tt(pt.prototype,"startChannelMediaRelay",[i7],Object.getOwnPropertyDescriptor(pt.prototype,"startChannelMediaRelay"),pt.prototype),Tt(pt.prototype,"updateChannelMediaRelay",[s7],Object.getOwnPropertyDescriptor(pt.prototype,"updateChannelMediaRelay"),pt.prototype),Tt(pt.prototype,"stopChannelMediaRelay",[o7],Object.getOwnPropertyDescriptor(pt.prototype,"stopChannelMediaRelay"),pt.prototype),Tt(pt.prototype,"sendCustomReportMessage",[a7],Object.getOwnPropertyDescriptor(pt.prototype,"sendCustomReportMessage"),pt.prototype),Tt(pt.prototype,"pickSVCLayer",[c7],Object.getOwnPropertyDescriptor(pt.prototype,"pickSVCLayer"),pt.prototype),Tt(pt.prototype,"setRTMConfig",[l7],Object.getOwnPropertyDescriptor(pt.prototype,"setRTMConfig"),pt.prototype),Tt(pt.prototype,"enableContentInspect",[u7],Object.getOwnPropertyDescriptor(pt.prototype,"enableContentInspect"),pt.prototype),Tt(pt.prototype,"disableContentInspect",[d7],Object.getOwnPropertyDescriptor(pt.prototype,"disableContentInspect"),pt.prototype),Tt(pt.prototype,"setImageModeration",[h7],Object.getOwnPropertyDescriptor(pt.prototype,"setImageModeration"),pt.prototype),Tt(pt.prototype,"setP2PTransport",[p7],Object.getOwnPropertyDescriptor(pt.prototype,"setP2PTransport"),pt.prototype),Tt(pt.prototype,"getJoinChannelServiceRecords",[f7],Object.getOwnPropertyDescriptor(pt.prototype,"getJoinChannelServiceRecords"),pt.prototype),Tt(pt.prototype,"setPublishAudioFilterEnabled",[m7],Object.getOwnPropertyDescriptor(pt.prototype,"setPublishAudioFilterEnabled"),pt.prototype),pt);class zT{constructor(r,i){K(this,"id",0),K(this,"element",void 0),K(this,"peerPair",void 0),K(this,"context",void 0),K(this,"audioPlayerElement",void 0),K(this,"audioTrack",void 0),zT.count+=1,this.id=zT.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new ut(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},i=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await i(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(o){throw new Oe(te.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(c){throw new Oe(te.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new Oe(te.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var _7,DP;K(zT,"count",0);const yge=window.AudioContext||window.webkitAudioContext,Ege=new(_7=jt({report:At}),Tt((DP=class{constructor(){K(this,"units",[]),K(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new yge);let r=this.units.find(i=>i&&i.getElement()===e);return r||(r=new zT(e,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Dn().name!==Gn.SAFARI}}).prototype,"processExternalMediaAEC",[_7],Object.getOwnPropertyDescriptor(DP.prototype,"processExternalMediaAEC"),DP.prototype),DP);function y7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function E7(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?y7(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const h2=window||document;function v7(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!h2)return;const i=Ai._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);const o=c=>{if(!(c&&c.blockedURI&&(Ai.onSecurityPolicyViolation||Ai.getListeners(vh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;oe("CSP_DETECTED_HOSTNAME_LIST").some(h=>st(u).call(u,h))&&(Ai.onSecurityPolicyViolation&&typeof Ai.onSecurityPolicyViolation=="function"&&Ai.onSecurityPolicyViolation(c),Ai.getListeners(vh.SECURITY_POLICY_VIOLATION).length>0&&Ai.safeEmit(vh.SECURITY_POLICY_VIOLATION,c))};i&&h2.removeEventListener("securitypolicyviolation",i),(r||e&&typeof e=="function"||Ai.getListeners(vh.SECURITY_POLICY_VIOLATION).length>0)&&h2.addEventListener("securitypolicyviolation",o),Ai._cspEventHandlerPointer=o}var vge=k,Sge=r8,S7=RegExp.prototype,bge=function(e){return e===S7||vge(S7,e)?Sge(e):e.flags},go=l(bge);function cS(e){let r=e.length;for(;--r>=0;)e[r]=0}const p2=256,b7=286,GT=30,HT=15,f2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),xP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Tge=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),T7=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),of=new Array(576);cS(of);const $T=new Array(60);cS($T);const KT=new Array(512);cS(KT);const qT=new Array(256);cS(qT);const m2=new Array(29);cS(m2);const LP=new Array(GT);function g2(e,r,i,o,c){this.static_tree=e,this.extra_bits=r,this.extra_base=i,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let w7,C7,R7;function _2(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}cS(LP);const I7=e=>e<256?KT[e]:KT[256+(e>>>7)],YT=(e,r)=>{e.pending_buf[e.pending++]=255&r,e.pending_buf[e.pending++]=r>>>8&255},tl=(e,r,i)=>{e.bi_valid>16-i?(e.bi_buf|=r<<e.bi_valid&65535,YT(e,e.bi_buf),e.bi_buf=r>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=i)},Ch=(e,r,i)=>{tl(e,i[2*r],i[2*r+1])},A7=(e,r)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--r>0);return i>>>1},P7=(e,r,i)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=HT;c++)h=h+i[c-1]<<1,o[c]=h;for(u=0;u<=r;u++){let m=e[2*u+1];m!==0&&(e[2*u]=A7(o[m]++,m))}},O7=e=>{let r;for(r=0;r<b7;r++)e.dyn_ltree[2*r]=0;for(r=0;r<GT;r++)e.dyn_dtree[2*r]=0;for(r=0;r<19;r++)e.bl_tree[2*r]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},k7=e=>{e.bi_valid>8?YT(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},N7=(e,r,i,o)=>{const c=2*r,u=2*i;return e[c]<e[u]||e[c]===e[u]&&o[r]<=o[i]},y2=(e,r,i)=>{const o=e.heap[i];let c=i<<1;for(;c<=e.heap_len&&(c<e.heap_len&&N7(r,e.heap[c+1],e.heap[c],e.depth)&&c++,!N7(r,o,e.heap[c],e.depth));)e.heap[i]=e.heap[c],i=c,c<<=1;e.heap[i]=o},D7=(e,r,i)=>{let o,c,u,h,m=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+m++],o+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],o===0?Ch(e,c,r):(u=qT[c],Ch(e,u+p2+1,r),h=f2[u],h!==0&&(c-=m2[u],tl(e,c,h)),o--,u=I7(o),Ch(e,u,i),h=xP[u],h!==0&&(o-=LP[u],tl(e,o,h)));while(m<e.sym_next);Ch(e,256,r)},E2=(e,r)=>{const i=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,_,E=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(e.heap[++e.heap_len]=E=h,e.depth[h]=0):i[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=E<2?++E:0,i[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=o[2*_+1]);for(r.max_code=E,h=e.heap_len>>1;h>=1;h--)y2(e,i,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],y2(e,i,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,i[2*_]=i[2*h]+i[2*m],e.depth[_]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,i[2*h+1]=i[2*m+1]=_,e.heap[1]=_++,y2(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,R)=>{const P=R.dyn_tree,N=R.max_code,G=R.stat_desc.static_tree,F=R.stat_desc.has_stree,j=R.stat_desc.extra_bits,q=R.stat_desc.extra_base,ee=R.stat_desc.max_length;let he,Se,we,ye,Ne,Ye,dt=0;for(ye=0;ye<=HT;ye++)S.bl_count[ye]=0;for(P[2*S.heap[S.heap_max]+1]=0,he=S.heap_max+1;he<573;he++)Se=S.heap[he],ye=P[2*P[2*Se+1]+1]+1,ye>ee&&(ye=ee,dt++),P[2*Se+1]=ye,Se>N||(S.bl_count[ye]++,Ne=0,Se>=q&&(Ne=j[Se-q]),Ye=P[2*Se],S.opt_len+=Ye*(ye+Ne),F&&(S.static_len+=Ye*(G[2*Se+1]+Ne)));if(dt!==0){do{for(ye=ee-1;S.bl_count[ye]===0;)ye--;S.bl_count[ye]--,S.bl_count[ye+1]+=2,S.bl_count[ee]--,dt-=2}while(dt>0);for(ye=ee;ye!==0;ye--)for(Se=S.bl_count[ye];Se!==0;)we=S.heap[--he],we>N||(P[2*we+1]!==ye&&(S.opt_len+=(ye-P[2*we+1])*P[2*we],P[2*we+1]=ye),Se--)}})(e,r),P7(i,E,e.bl_count)},x7=(e,r,i)=>{let o,c,u=-1,h=r[1],m=0,_=7,E=4;for(h===0&&(_=138,E=3),r[2*(i+1)+1]=65535,o=0;o<=i;o++)c=h,h=r[2*(o+1)+1],++m<_&&c===h||(m<E?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(_=138,E=3):c===h?(_=6,E=3):(_=7,E=4))},L7=(e,r,i)=>{let o,c,u=-1,h=r[1],m=0,_=7,E=4;for(h===0&&(_=138,E=3),o=0;o<=i;o++)if(c=h,h=r[2*(o+1)+1],!(++m<_&&c===h)){if(m<E)do Ch(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Ch(e,c,e.bl_tree),m--),Ch(e,16,e.bl_tree),tl(e,m-3,2)):m<=10?(Ch(e,17,e.bl_tree),tl(e,m-3,3)):(Ch(e,18,e.bl_tree),tl(e,m-11,7));m=0,u=c,h===0?(_=138,E=3):c===h?(_=6,E=3):(_=7,E=4)}};let M7=!1;const U7=(e,r,i,o)=>{tl(e,0+(o?1:0),3),k7(e),YT(e,i),YT(e,~i),i&&e.pending_buf.set(e.window.subarray(r,r+i),e.pending),e.pending+=i};var wge=e=>{M7||((()=>{let r,i,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(m2[c]=o,r=0;r<1<<f2[c];r++)qT[o++]=c;for(qT[o-1]=c,u=0,c=0;c<16;c++)for(LP[c]=u,r=0;r<1<<xP[c];r++)KT[u++]=c;for(u>>=7;c<GT;c++)for(LP[c]=u<<7,r=0;r<1<<xP[c]-7;r++)KT[256+u++]=c;for(i=0;i<=HT;i++)h[i]=0;for(r=0;r<=143;)of[2*r+1]=8,r++,h[8]++;for(;r<=255;)of[2*r+1]=9,r++,h[9]++;for(;r<=279;)of[2*r+1]=7,r++,h[7]++;for(;r<=287;)of[2*r+1]=8,r++,h[8]++;for(P7(of,287,h),r=0;r<GT;r++)$T[2*r+1]=5,$T[2*r]=A7(r,5);w7=new g2(of,f2,257,b7,HT),C7=new g2($T,xP,0,GT,HT),R7=new g2(new Array(0),Tge,0,19,7)})(),M7=!0),e.l_desc=new _2(e.dyn_ltree,w7),e.d_desc=new _2(e.dyn_dtree,C7),e.bl_desc=new _2(e.bl_tree,R7),e.bi_buf=0,e.bi_valid=0,O7(e)},Cge=(e,r,i,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let _,E=4093624447;for(_=0;_<=31;_++,E>>>=1)if(1&E&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<p2;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(e)),E2(e,e.l_desc),E2(e,e.d_desc),h=(m=>{let _;for(x7(m,m.dyn_ltree,m.l_desc.max_code),x7(m,m.dyn_dtree,m.d_desc.max_code),E2(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*T7[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&r!==-1?U7(e,r,i,o):e.strategy===4||u===c?(tl(e,2+(o?1:0),3),D7(e,of,$T)):(tl(e,4+(o?1:0),3),((m,_,E,S)=>{let R;for(tl(m,_-257,5),tl(m,E-1,5),tl(m,S-4,4),R=0;R<S;R++)tl(m,m.bl_tree[2*T7[R]+1],3);L7(m,m.dyn_ltree,_-1),L7(m,m.dyn_dtree,E-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),D7(e,e.dyn_ltree,e.dyn_dtree)),O7(e),o&&k7(e)},Rge=(e,r,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,r===0?e.dyn_ltree[2*i]++:(e.matches++,r--,e.dyn_ltree[2*(qT[i]+p2+1)]++,e.dyn_dtree[2*I7(r)]++),e.sym_next===e.sym_end),Ige=e=>{tl(e,2,3),Ch(e,256,of),(r=>{r.bi_valid===16?(YT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(e)},Age={_tr_init:wge,_tr_stored_block:U7,_tr_flush_block:Cge,_tr_tally:Rge,_tr_align:Ige},XT=(e,r,i,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+r[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const Pge=new Uint32Array((()=>{let e,r=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;r[i]=e}return r})());var Uo=(e,r,i,o)=>{const c=Pge,u=o+i;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^r[h])];return-1^e},J_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},MP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Oge,_tr_stored_block:v2,_tr_flush_block:kge,_tr_tally:qm,_tr_align:Nge}=Age,{Z_NO_FLUSH:Ym,Z_PARTIAL_FLUSH:Dge,Z_FULL_FLUSH:xge,Z_FINISH:Cu,Z_BLOCK:V7,Z_OK:fa,Z_STREAM_END:F7,Z_STREAM_ERROR:Rh,Z_DATA_ERROR:Lge,Z_BUF_ERROR:S2,Z_DEFAULT_COMPRESSION:Mge,Z_FILTERED:Uge,Z_HUFFMAN_ONLY:UP,Z_RLE:Vge,Z_FIXED:Fge,Z_DEFAULT_STRATEGY:jge,Z_UNKNOWN:Bge,Z_DEFLATED:VP}=MP,b2=286,Wge=30,zge=19,Gge=2*b2+1,Hge=15,Q_=258,Ih=262,lS=42,Z_=113,JT=666,ey=(e,r)=>(e.msg=J_[r],r),j7=e=>2*e-(e>4?9:0),Xm=e=>{let r=e.length;for(;--r>=0;)e[r]=0},$ge=e=>{let r,i,o,c=e.w_size;r=e.hash_size,o=r;do i=e.head[--o],e.head[o]=i>=c?i-c:0;while(--r);r=c,o=r;do i=e.prev[--o],e.prev[o]=i>=c?i-c:0;while(--r)};let Jm=(e,r,i)=>(r<<e.hash_shift^i)&e.hash_mask;const kl=e=>{const r=e.state;let i=r.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),e.next_out),e.next_out+=i,r.pending_out+=i,e.total_out+=i,e.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},Nl=(e,r)=>{kge(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,kl(e.strm)},Qr=(e,r)=>{e.pending_buf[e.pending++]=r},QT=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=255&r},T2=(e,r,i,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,r.set(e.input.subarray(e.next_in,e.next_in+c),i),e.state.wrap===1?e.adler=XT(e.adler,r,c,i):e.state.wrap===2&&(e.adler=Uo(e.adler,r,c,i)),e.next_in+=c,e.total_in+=c,c)},B7=(e,r)=>{let i,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const _=e.strstart>e.w_size-Ih?e.strstart-(e.w_size-Ih):0,E=e.window,S=e.w_mask,R=e.prev,P=e.strstart+Q_;let N=E[u+h-1],G=E[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(i=r,E[i+h]===G&&E[i+h-1]===N&&E[i]===E[u]&&E[++i]===E[u+1]){u+=2,i++;do;while(E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&u<P);if(o=Q_-(P-u),u=P-Q_,o>h){if(e.match_start=r,h=o,o>=m)break;N=E[u+h-1],G=E[u+h]}}while((r=R[r&S])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},uS=e=>{const r=e.w_size;let i,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-Ih)&&(e.window.set(e.window.subarray(r,r+r-o),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),$ge(e),o+=r),e.strm.avail_in===0)break;if(i=T2(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Jm(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Jm(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ih&&e.strm.avail_in!==0)},W7=(e,r)=>{let i,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(i=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&r!==Cu||r===Ym||i!==o+e.strm.avail_in)))break;h=r===Cu&&i===o+e.strm.avail_in?1:0,v2(e,0,0,h),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,kl(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(T2(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:r!==Ym&&r!==Cu&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(T2(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||r===Cu)&&r!==Ym&&e.strm.avail_in===0&&o<=c)&&(i=o>c?c:o,h=r===Cu&&e.strm.avail_in===0&&i===o?1:0,v2(e,e.block_start,i,h),e.block_start+=i,kl(e.strm)),h?3:1)},w2=(e,r)=>{let i,o;for(;;){if(e.lookahead<Ih){if(uS(e),e.lookahead<Ih&&r===Ym)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Jm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-Ih&&(e.match_length=B7(e,i)),e.match_length>=3)if(o=qm(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Jm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Jm(e,e.ins_h,e.window[e.strstart+1]);else o=qm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(Nl(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,r===Cu?(Nl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Nl(e,!1),e.strm.avail_out===0)?1:2},dS=(e,r)=>{let i,o,c;for(;;){if(e.lookahead<Ih){if(uS(e),e.lookahead<Ih&&r===Ym)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Jm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Ih&&(e.match_length=B7(e,i),e.match_length<=5&&(e.strategy===Uge||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=qm(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Jm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(Nl(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=qm(e,0,e.window[e.strstart-1]),o&&Nl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=qm(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,r===Cu?(Nl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Nl(e,!1),e.strm.avail_out===0)?1:2};function Ah(e,r,i,o,c){this.good_length=e,this.max_lazy=r,this.nice_length=i,this.max_chain=o,this.func=c}const ZT=[new Ah(0,0,0,0,W7),new Ah(4,4,8,4,w2),new Ah(4,5,16,8,w2),new Ah(4,6,32,32,w2),new Ah(4,4,16,16,dS),new Ah(8,16,32,32,dS),new Ah(8,16,128,128,dS),new Ah(8,32,128,256,dS),new Ah(32,128,258,1024,dS),new Ah(32,258,258,4096,dS)];function Kge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=VP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Gge),this.dyn_dtree=new Uint16Array(2*(2*Wge+1)),this.bl_tree=new Uint16Array(2*(2*zge+1)),Xm(this.dyn_ltree),Xm(this.dyn_dtree),Xm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Hge+1),this.heap=new Uint16Array(2*b2+1),Xm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*b2+1),Xm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ew=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.status!==lS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==Z_&&r.status!==JT?1:0},z7=e=>{if(ew(e))return ey(e,Rh);e.total_in=e.total_out=0,e.data_type=Bge;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?lS:Z_,e.adler=r.wrap===2?0:1,r.last_flush=-2,Oge(r),fa},G7=e=>{const r=z7(e);return r===fa&&(i=>{i.window_size=2*i.w_size,Xm(i.head),i.max_lazy_match=ZT[i.level].max_lazy,i.good_match=ZT[i.level].good_length,i.nice_match=ZT[i.level].nice_length,i.max_chain_length=ZT[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),r},H7=(e,r,i,o,c,u)=>{if(!e)return Rh;let h=1;if(r===Mge&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||i!==VP||o<8||o>15||r<0||r>9||u<0||u>Fge||o===8&&h!==1)return ey(e,Rh);o===8&&(o=9);const m=new Kge;return e.state=m,m.strm=e,m.status=lS,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=i,G7(e)};var qge=(e,r)=>{if(ew(e)||r>V7||r<0)return e?ey(e,Rh):Rh;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===JT&&r!==Cu)return ey(e,e.avail_out===0?S2:Rh);const o=i.last_flush;if(i.last_flush=r,i.pending!==0){if(kl(e),e.avail_out===0)return i.last_flush=-1,fa}else if(e.avail_in===0&&j7(r)<=j7(o)&&r!==Cu)return ey(e,S2);if(i.status===JT&&e.avail_in!==0)return ey(e,S2);if(i.status===lS&&i.wrap===0&&(i.status=Z_),i.status===lS){let c=VP+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=UP||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,QT(i,c),i.strstart!==0&&(QT(i,e.adler>>>16),QT(i,65535&e.adler)),e.adler=1,i.status=Z_,kl(e),i.pending!==0)return i.last_flush=-1,fa}if(i.status===57){if(e.adler=0,Qr(i,31),Qr(i,139),Qr(i,8),i.gzhead)Qr(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Qr(i,255&i.gzhead.time),Qr(i,i.gzhead.time>>8&255),Qr(i,i.gzhead.time>>16&255),Qr(i,i.gzhead.time>>24&255),Qr(i,i.level===9?2:i.strategy>=UP||i.level<2?4:0),Qr(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Qr(i,255&i.gzhead.extra.length),Qr(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Uo(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Qr(i,0),Qr(i,0),Qr(i,0),Qr(i,0),Qr(i,0),Qr(i,i.level===9?2:i.strategy>=UP||i.level<2?4:0),Qr(i,3),i.status=Z_,kl(e),i.pending!==0)return i.last_flush=-1,fa}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let m=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+m),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(e.adler=Uo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=m,kl(e),i.pending!==0)return i.last_flush=-1,fa;c=0,u-=m}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(e.adler=Uo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=Uo(e.adler,i.pending_buf,i.pending-u,u)),kl(e),i.pending!==0)return i.last_flush=-1,fa;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Qr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=Uo(e.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=Uo(e.adler,i.pending_buf,i.pending-u,u)),kl(e),i.pending!==0)return i.last_flush=-1,fa;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Qr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=Uo(e.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(kl(e),i.pending!==0))return i.last_flush=-1,fa;Qr(i,255&e.adler),Qr(i,e.adler>>8&255),e.adler=0}if(i.status=Z_,kl(e),i.pending!==0)return i.last_flush=-1,fa}if(e.avail_in!==0||i.lookahead!==0||r!==Ym&&i.status!==JT){let c=i.level===0?W7(i,r):i.strategy===UP?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(uS(u),u.lookahead===0)){if(h===Ym)return 1;break}if(u.match_length=0,m=qm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(Nl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Cu?(Nl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Nl(u,!1),u.strm.avail_out===0)?1:2})(i,r):i.strategy===Vge?((u,h)=>{let m,_,E,S;const R=u.window;for(;;){if(u.lookahead<=Q_){if(uS(u),u.lookahead<=Q_&&h===Ym)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(E=u.strstart-1,_=R[E],_===R[++E]&&_===R[++E]&&_===R[++E])){S=u.strstart+Q_;do;while(_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&E<S);u.match_length=Q_-(S-E),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=qm(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=qm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(Nl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Cu?(Nl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Nl(u,!1),u.strm.avail_out===0)?1:2})(i,r):ZT[i.level].func(i,r);if(c!==3&&c!==4||(i.status=JT),c===1||c===3)return e.avail_out===0&&(i.last_flush=-1),fa;if(c===2&&(r===Dge?Nge(i):r!==V7&&(v2(i,0,0,!1),r===xge&&(Xm(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),kl(e),e.avail_out===0))return i.last_flush=-1,fa}return r!==Cu?fa:i.wrap<=0?F7:(i.wrap===2?(Qr(i,255&e.adler),Qr(i,e.adler>>8&255),Qr(i,e.adler>>16&255),Qr(i,e.adler>>24&255),Qr(i,255&e.total_in),Qr(i,e.total_in>>8&255),Qr(i,e.total_in>>16&255),Qr(i,e.total_in>>24&255)):(QT(i,e.adler>>>16),QT(i,65535&e.adler)),kl(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?fa:F7)},Yge=(e,r)=>{let i=r.length;if(ew(e))return Rh;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==lS||o.lookahead)return Rh;if(c===1&&(e.adler=XT(e.adler,r,i,0)),o.wrap=0,i>=o.w_size){c===0&&(Xm(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(r.subarray(i-o.w_size,i),0),r=_,i=o.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=i,e.next_in=0,e.input=r,uS(o);o.lookahead>=3;){let _=o.strstart,E=o.lookahead-2;do o.ins_h=Jm(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--E);o.strstart=_,o.lookahead=2,uS(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,o.wrap=c,fa},tw={deflateInit:(e,r)=>H7(e,r,VP,15,8,jge),deflateInit2:H7,deflateReset:G7,deflateResetKeep:z7,deflateSetHeader:(e,r)=>ew(e)||e.state.wrap!==2?Rh:(e.state.gzhead=r,fa),deflate:qge,deflateEnd:e=>{if(ew(e))return Rh;const r=e.state.status;return e.state=null,r===Z_?ey(e,Lge):fa},deflateSetDictionary:Yge,deflateInfo:"pako deflate (from Nodeca project)"};const Xge=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var FP={assign:function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const o in i)Xge(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let r=0;for(let o=0,c=e.length;o<c;o++)r+=e[o].length;const i=new Uint8Array(r);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];i.set(h,c),c+=h.length}return i}};let $7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{$7=!1}const nw=new Uint8Array(256);for(let e=0;e<256;e++)nw[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;nw[254]=nw[254]=1;var rw={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,i,o,c,u,h=e.length,m=0;for(c=0;c<h;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),m+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),i<128?r[u++]=i:i<2048?(r[u++]=192|i>>>6,r[u++]=128|63&i):i<65536?(r[u++]=224|i>>>12,r[u++]=128|i>>>6&63,r[u++]=128|63&i):(r[u++]=240|i>>>18,r[u++]=128|i>>>12&63,r[u++]=128|i>>>6&63,r[u++]=128|63&i);return r},buf2string:(e,r)=>{const i=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let o,c;const u=new Array(2*i);for(c=0,o=0;o<i;){let h=e[o++];if(h<128){u[c++]=h;continue}let m=nw[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<i;)h=h<<6|63&e[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&$7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let _="";for(let E=0;E<m;E++)_+=String.fromCharCode(h[E]);return _})(u,c)},utf8border:(e,r)=>{(r=r||e.length)>e.length&&(r=e.length);let i=r-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?r:i+nw[e[i]]>r?i:r}},K7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const q7=Object.prototype.toString,{Z_NO_FLUSH:Jge,Z_SYNC_FLUSH:Qge,Z_FULL_FLUSH:Zge,Z_FINISH:e_e,Z_OK:jP,Z_STREAM_END:t_e,Z_DEFAULT_COMPRESSION:n_e,Z_DEFAULT_STRATEGY:r_e,Z_DEFLATED:i_e}=MP;function BP(e){this.options=FP.assign({level:n_e,method:i_e,chunkSize:16384,windowBits:15,memLevel:8,strategy:r_e},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new K7,this.strm.avail_out=0;let i=tw.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==jP)throw new Error(J_[i]);if(r.header&&tw.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?rw.string2buf(r.dictionary):q7.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=tw.deflateSetDictionary(this.strm,o),i!==jP)throw new Error(J_[i]);this._dict_set=!0}}function s_e(e,r){const i=new BP(r);if(i.push(e,!0),i.err)throw i.msg||J_[i.err];return i.result}BP.prototype.push=function(e,r){const i=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?e_e:Jge,typeof e=="string"?i.input=rw.string2buf(e):q7.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(u===Qge||u===Zge)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=tw.deflate(i,u),c===t_e)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=tw.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===jP;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},BP.prototype.onData=function(e){this.chunks.push(e)},BP.prototype.onEnd=function(e){e===jP&&(this.result=FP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var o_e={deflate:s_e};const WP=16209;var a_e=function(e,r){let i,o,c,u,h,m,_,E,S,R,P,N,G,F,j,q,ee,he,Se,we,ye,Ne,Ye,dt;const ft=e.state;i=e.next_in,Ye=e.input,o=i+(e.avail_in-5),c=e.next_out,dt=e.output,u=c-(r-e.avail_out),h=c+(e.avail_out-257),m=ft.dmax,_=ft.wsize,E=ft.whave,S=ft.wnext,R=ft.window,P=ft.hold,N=ft.bits,G=ft.lencode,F=ft.distcode,j=(1<<ft.lenbits)-1,q=(1<<ft.distbits)-1;e:do{N<15&&(P+=Ye[i++]<<N,N+=8,P+=Ye[i++]<<N,N+=8),ee=G[P&j];t:for(;;){if(he=ee>>>24,P>>>=he,N-=he,he=ee>>>16&255,he===0)dt[c++]=65535&ee;else{if(!(16&he)){if((64&he)==0){ee=G[(65535&ee)+(P&(1<<he)-1)];continue t}if(32&he){ft.mode=16191;break e}e.msg="invalid literal/length code",ft.mode=WP;break e}Se=65535&ee,he&=15,he&&(N<he&&(P+=Ye[i++]<<N,N+=8),Se+=P&(1<<he)-1,P>>>=he,N-=he),N<15&&(P+=Ye[i++]<<N,N+=8,P+=Ye[i++]<<N,N+=8),ee=F[P&q];n:for(;;){if(he=ee>>>24,P>>>=he,N-=he,he=ee>>>16&255,!(16&he)){if((64&he)==0){ee=F[(65535&ee)+(P&(1<<he)-1)];continue n}e.msg="invalid distance code",ft.mode=WP;break e}if(we=65535&ee,he&=15,N<he&&(P+=Ye[i++]<<N,N+=8,N<he&&(P+=Ye[i++]<<N,N+=8)),we+=P&(1<<he)-1,we>m){e.msg="invalid distance too far back",ft.mode=WP;break e}if(P>>>=he,N-=he,he=c-u,we>he){if(he=we-he,he>E&&ft.sane){e.msg="invalid distance too far back",ft.mode=WP;break e}if(ye=0,Ne=R,S===0){if(ye+=_-he,he<Se){Se-=he;do dt[c++]=R[ye++];while(--he);ye=c-we,Ne=dt}}else if(S<he){if(ye+=_+S-he,he-=S,he<Se){Se-=he;do dt[c++]=R[ye++];while(--he);if(ye=0,S<Se){he=S,Se-=he;do dt[c++]=R[ye++];while(--he);ye=c-we,Ne=dt}}}else if(ye+=S-he,he<Se){Se-=he;do dt[c++]=R[ye++];while(--he);ye=c-we,Ne=dt}for(;Se>2;)dt[c++]=Ne[ye++],dt[c++]=Ne[ye++],dt[c++]=Ne[ye++],Se-=3;Se&&(dt[c++]=Ne[ye++],Se>1&&(dt[c++]=Ne[ye++]))}else{ye=c-we;do dt[c++]=dt[ye++],dt[c++]=dt[ye++],dt[c++]=dt[ye++],Se-=3;while(Se>2);Se&&(dt[c++]=dt[ye++],Se>1&&(dt[c++]=dt[ye++]))}break}}break}}while(i<o&&c<h);Se=N>>3,i-=Se,N-=Se<<3,P&=(1<<N)-1,e.next_in=i,e.next_out=c,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=c<h?h-c+257:257-(c-h),ft.hold=P,ft.bits=N};const zP=15,c_e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),l_e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),u_e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),d_e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var iw=(e,r,i,o,c,u,h,m)=>{const _=m.bits;let E,S,R,P,N,G,F=0,j=0,q=0,ee=0,he=0,Se=0,we=0,ye=0,Ne=0,Ye=0,dt=null;const ft=new Uint16Array(16),Rn=new Uint16Array(16);let In,pr,ai,Yr=null;for(F=0;F<=zP;F++)ft[F]=0;for(j=0;j<o;j++)ft[r[i+j]]++;for(he=_,ee=zP;ee>=1&&ft[ee]===0;ee--);if(he>ee&&(he=ee),ee===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(q=1;q<ee&&ft[q]===0;q++);for(he<q&&(he=q),ye=1,F=1;F<=zP;F++)if(ye<<=1,ye-=ft[F],ye<0)return-1;if(ye>0&&(e===0||ee!==1))return-1;for(Rn[1]=0,F=1;F<zP;F++)Rn[F+1]=Rn[F]+ft[F];for(j=0;j<o;j++)r[i+j]!==0&&(h[Rn[r[i+j]]++]=j);if(e===0?(dt=Yr=h,G=20):e===1?(dt=c_e,Yr=l_e,G=257):(dt=u_e,Yr=d_e,G=0),Ye=0,j=0,F=q,N=u,Se=he,we=0,R=-1,Ne=1<<he,P=Ne-1,e===1&&Ne>852||e===2&&Ne>592)return 1;for(;;){In=F-we,h[j]+1<G?(pr=0,ai=h[j]):h[j]>=G?(pr=Yr[h[j]-G],ai=dt[h[j]-G]):(pr=96,ai=0),E=1<<F-we,S=1<<Se,q=S;do S-=E,c[N+(Ye>>we)+S]=In<<24|pr<<16|ai|0;while(S!==0);for(E=1<<F-1;Ye&E;)E>>=1;if(E!==0?(Ye&=E-1,Ye+=E):Ye=0,j++,--ft[F]==0){if(F===ee)break;F=r[i+h[j]]}if(F>he&&(Ye&P)!==R){for(we===0&&(we=he),N+=q,Se=F-we,ye=1<<Se;Se+we<ee&&(ye-=ft[Se+we],!(ye<=0));)Se++,ye<<=1;if(Ne+=1<<Se,e===1&&Ne>852||e===2&&Ne>592)return 1;R=Ye&P,c[R]=he<<24|Se<<16|N-u|0}}return Ye!==0&&(c[N+Ye]=F-we<<24|64<<16|0),m.bits=he,0};const{Z_FINISH:Y7,Z_BLOCK:h_e,Z_TREES:GP,Z_OK:ty,Z_STREAM_END:p_e,Z_NEED_DICT:f_e,Z_STREAM_ERROR:Ru,Z_DATA_ERROR:X7,Z_MEM_ERROR:J7,Z_BUF_ERROR:m_e,Z_DEFLATED:Q7}=MP,HP=16180,$P=16190,af=16191,C2=16192,R2=16194,KP=16199,qP=16200,I2=16206,cs=16209,Z7=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function g_e(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ny=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.mode<HP||r.mode>16211?1:0},e$=e=>{if(ny(e))return Ru;const r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=1&r.wrap),r.mode=HP,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,ty},t$=e=>{if(ny(e))return Ru;const r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,e$(e)},n$=(e,r)=>{let i;if(ny(e))return Ru;const o=e.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Ru:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=i,o.wbits=r,t$(e))},r$=(e,r)=>{if(!e)return Ru;const i=new g_e;e.state=i,i.strm=e,i.window=null,i.mode=HP;const o=n$(e,r);return o!==ty&&(e.state=null),o};let A2,P2,i$=!0;const __e=e=>{if(i$){A2=new Int32Array(512),P2=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(iw(1,e.lens,0,288,A2,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;iw(2,e.lens,0,32,P2,0,e.work,{bits:5}),i$=!1}e.lencode=A2,e.lenbits=9,e.distcode=P2,e.distbits=5},s$=(e,r,i,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(r.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(r.subarray(i-o,i-o+c),u.wnext),(o-=c)?(u.window.set(r.subarray(i-o,i),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var y_e=(e,r)=>{let i,o,c,u,h,m,_,E,S,R,P,N,G,F,j,q,ee,he,Se,we,ye,Ne,Ye=0;const dt=new Uint8Array(4);let ft,Rn;const In=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ny(e)||!e.output||!e.input&&e.avail_in!==0)return Ru;i=e.state,i.mode===af&&(i.mode=C2),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,E=i.hold,S=i.bits,R=m,P=_,Ne=ty;e:for(;;)switch(i.mode){case HP:if(i.wrap===0){i.mode=C2;break}for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(2&i.wrap&&E===35615){i.wbits===0&&(i.wbits=15),i.check=0,dt[0]=255&E,dt[1]=E>>>8&255,i.check=Uo(i.check,dt,2,0),E=0,S=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&E)<<8)+(E>>8))%31){e.msg="incorrect header check",i.mode=cs;break}if((15&E)!==Q7){e.msg="unknown compression method",i.mode=cs;break}if(E>>>=4,S-=4,ye=8+(15&E),i.wbits===0&&(i.wbits=ye),ye>15||ye>i.wbits){e.msg="invalid window size",i.mode=cs;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&E?16189:af,E=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(i.flags=E,(255&go(i))!==Q7){e.msg="unknown compression method",i.mode=cs;break}if(57344&go(i)){e.msg="unknown header flags set",i.mode=cs;break}i.head&&(i.head.text=E>>8&1),512&go(i)&&4&i.wrap&&(dt[0]=255&E,dt[1]=E>>>8&255,i.check=Uo(i.check,dt,2,0)),E=0,S=0,i.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.head&&(i.head.time=E),512&go(i)&&4&i.wrap&&(dt[0]=255&E,dt[1]=E>>>8&255,dt[2]=E>>>16&255,dt[3]=E>>>24&255,i.check=Uo(i.check,dt,4,0)),E=0,S=0,i.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.head&&(i.head.xflags=255&E,i.head.os=E>>8),512&go(i)&&4&i.wrap&&(dt[0]=255&E,dt[1]=E>>>8&255,i.check=Uo(i.check,dt,2,0)),E=0,S=0,i.mode=16184;case 16184:if(1024&go(i)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.length=E,i.head&&(i.head.extra_len=E),512&go(i)&&4&i.wrap&&(dt[0]=255&E,dt[1]=E>>>8&255,i.check=Uo(i.check,dt,2,0)),E=0,S=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&go(i)&&(N=i.length,N>m&&(N=m),N&&(i.head&&(ye=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(u,u+N),ye)),512&go(i)&&4&i.wrap&&(i.check=Uo(i.check,o,N,u)),m-=N,u+=N,i.length-=N),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&go(i)){if(m===0)break e;N=0;do ye=o[u+N++],i.head&&ye&&i.length<65536&&(i.head.name+=String.fromCharCode(ye));while(ye&&N<m);if(512&go(i)&&4&i.wrap&&(i.check=Uo(i.check,o,N,u)),m-=N,u+=N,ye)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&go(i)){if(m===0)break e;N=0;do ye=o[u+N++],i.head&&ye&&i.length<65536&&(i.head.comment+=String.fromCharCode(ye));while(ye&&N<m);if(512&go(i)&&4&i.wrap&&(i.check=Uo(i.check,o,N,u)),m-=N,u+=N,ye)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&go(i)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&i.wrap&&E!==(65535&i.check)){e.msg="header crc mismatch",i.mode=cs;break}E=0,S=0}i.head&&(i.head.hcrc=go(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=af;break;case 16189:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}e.adler=i.check=Z7(E),E=0,S=0,i.mode=$P;case $P:if(i.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=E,i.bits=S,f_e;e.adler=i.check=1,i.mode=af;case af:if(r===h_e||r===GP)break e;case C2:if(i.last){E>>>=7&S,S-=7&S,i.mode=I2;break}for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}switch(i.last=1&E,E>>>=1,S-=1,3&E){case 0:i.mode=16193;break;case 1:if(__e(i),i.mode=KP,r===GP){E>>>=2,S-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=cs}E>>>=2,S-=2;break;case 16193:for(E>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((65535&E)!=(E>>>16^65535)){e.msg="invalid stored block lengths",i.mode=cs;break}if(i.length=65535&E,E=0,S=0,i.mode=R2,r===GP)break e;case R2:i.mode=16195;case 16195:if(N=i.length,N){if(N>m&&(N=m),N>_&&(N=_),N===0)break e;c.set(o.subarray(u,u+N),h),m-=N,u+=N,_-=N,h+=N,i.length-=N;break}i.mode=af;break;case 16196:for(;S<14;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(i.nlen=257+(31&E),E>>>=5,S-=5,i.ndist=1+(31&E),E>>>=5,S-=5,i.ncode=4+(15&E),E>>>=4,S-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=cs;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.lens[In[i.have++]]=7&E,E>>>=3,S-=3}for(;i.have<19;)i.lens[In[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ft={bits:i.lenbits},Ne=iw(0,i.lens,0,19,i.lencode,0,i.work,ft),i.lenbits=ft.bits,Ne){e.msg="invalid code lengths set",i.mode=cs;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;Ye=i.lencode[E&(1<<i.lenbits)-1],j=Ye>>>24,q=Ye>>>16&255,ee=65535&Ye,!(j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(ee<16)E>>>=j,S-=j,i.lens[i.have++]=ee;else{if(ee===16){for(Rn=j+2;S<Rn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(E>>>=j,S-=j,i.have===0){e.msg="invalid bit length repeat",i.mode=cs;break}ye=i.lens[i.have-1],N=3+(3&E),E>>>=2,S-=2}else if(ee===17){for(Rn=j+3;S<Rn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=j,S-=j,ye=0,N=3+(7&E),E>>>=3,S-=3}else{for(Rn=j+7;S<Rn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=j,S-=j,ye=0,N=11+(127&E),E>>>=7,S-=7}if(i.have+N>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=cs;break}for(;N--;)i.lens[i.have++]=ye}}if(i.mode===cs)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=cs;break}if(i.lenbits=9,ft={bits:i.lenbits},Ne=iw(1,i.lens,0,i.nlen,i.lencode,0,i.work,ft),i.lenbits=ft.bits,Ne){e.msg="invalid literal/lengths set",i.mode=cs;break}if(i.distbits=6,i.distcode=i.distdyn,ft={bits:i.distbits},Ne=iw(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ft),i.distbits=ft.bits,Ne){e.msg="invalid distances set",i.mode=cs;break}if(i.mode=KP,r===GP)break e;case KP:i.mode=qP;case qP:if(m>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=E,i.bits=S,a_e(e,P),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,E=i.hold,S=i.bits,i.mode===af&&(i.back=-1);break}for(i.back=0;Ye=i.lencode[E&(1<<i.lenbits)-1],j=Ye>>>24,q=Ye>>>16&255,ee=65535&Ye,!(j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(q&&(240&q)==0){for(he=j,Se=q,we=ee;Ye=i.lencode[we+((E&(1<<he+Se)-1)>>he)],j=Ye>>>24,q=Ye>>>16&255,ee=65535&Ye,!(he+j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=he,S-=he,i.back+=he}if(E>>>=j,S-=j,i.back+=j,i.length=ee,q===0){i.mode=16205;break}if(32&q){i.back=-1,i.mode=af;break}if(64&q){e.msg="invalid literal/length code",i.mode=cs;break}i.extra=15&q,i.mode=16201;case 16201:if(i.extra){for(Rn=i.extra;S<Rn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.length+=E&(1<<i.extra)-1,E>>>=i.extra,S-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;Ye=i.distcode[E&(1<<i.distbits)-1],j=Ye>>>24,q=Ye>>>16&255,ee=65535&Ye,!(j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((240&q)==0){for(he=j,Se=q,we=ee;Ye=i.distcode[we+((E&(1<<he+Se)-1)>>he)],j=Ye>>>24,q=Ye>>>16&255,ee=65535&Ye,!(he+j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=he,S-=he,i.back+=he}if(E>>>=j,S-=j,i.back+=j,64&q){e.msg="invalid distance code",i.mode=cs;break}i.offset=ee,i.extra=15&q,i.mode=16203;case 16203:if(i.extra){for(Rn=i.extra;S<Rn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}i.offset+=E&(1<<i.extra)-1,E>>>=i.extra,S-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=cs;break}i.mode=16204;case 16204:if(_===0)break e;if(N=P-_,i.offset>N){if(N=i.offset-N,N>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=cs;break}N>i.wnext?(N-=i.wnext,G=i.wsize-N):G=i.wnext-N,N>i.length&&(N=i.length),F=i.window}else F=c,G=h-i.offset,N=i.length;N>_&&(N=_),_-=N,i.length-=N;do c[h++]=F[G++];while(--N);i.length===0&&(i.mode=qP);break;case 16205:if(_===0)break e;c[h++]=i.length,_--,i.mode=qP;break;case I2:if(i.wrap){for(;S<32;){if(m===0)break e;m--,E|=o[u++]<<S,S+=8}if(P-=_,e.total_out+=P,i.total+=P,4&i.wrap&&P&&(e.adler=i.check=go(i)?Uo(i.check,c,P,h-P):XT(i.check,c,P,h-P)),P=_,4&i.wrap&&(go(i)?E:Z7(E))!==i.check){e.msg="incorrect data check",i.mode=cs;break}E=0,S=0}i.mode=16207;case 16207:if(i.wrap&&go(i)){for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&i.wrap&&E!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=cs;break}E=0,S=0}i.mode=16208;case 16208:Ne=p_e;break e;case cs:Ne=X7;break e;case 16210:return J7;default:return Ru}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=E,i.bits=S,(i.wsize||P!==e.avail_out&&i.mode<cs&&(i.mode<I2||r!==Y7))&&s$(e,e.output,e.next_out,P-e.avail_out),R-=e.avail_in,P-=e.avail_out,e.total_in+=R,e.total_out+=P,i.total+=P,4&i.wrap&&P&&(e.adler=i.check=go(i)?Uo(i.check,c,P,e.next_out-P):XT(i.check,c,P,e.next_out-P)),e.data_type=i.bits+(i.last?64:0)+(i.mode===af?128:0)+(i.mode===KP||i.mode===R2?256:0),(R===0&&P===0||r===Y7)&&Ne===ty&&(Ne=m_e),Ne},cf={inflateReset:t$,inflateReset2:n$,inflateResetKeep:e$,inflateInit:e=>r$(e,15),inflateInit2:r$,inflate:y_e,inflateEnd:e=>{if(ny(e))return Ru;let r=e.state;return r.window&&(r.window=null),e.state=null,ty},inflateGetHeader:(e,r)=>{if(ny(e))return Ru;const i=e.state;return(2&i.wrap)==0?Ru:(i.head=r,r.done=!1,ty)},inflateSetDictionary:(e,r)=>{const i=r.length;let o,c,u;return ny(e)?Ru:(o=e.state,o.wrap!==0&&o.mode!==$P?Ru:o.mode===$P&&(c=1,c=XT(c,r,i,0),c!==o.check)?X7:(u=s$(e,r,i,i),u?(o.mode=16210,J7):(o.havedict=1,ty)))},inflateInfo:"pako inflate (from Nodeca project)"},E_e=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const o$=Object.prototype.toString,{Z_NO_FLUSH:v_e,Z_FINISH:S_e,Z_OK:sw,Z_STREAM_END:O2,Z_NEED_DICT:k2,Z_STREAM_ERROR:b_e,Z_DATA_ERROR:a$,Z_MEM_ERROR:T_e}=MP;function YP(e){this.options=FP.assign({chunkSize:65536,windowBits:15,to:""},e||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new K7,this.strm.avail_out=0;let i=cf.inflateInit2(this.strm,r.windowBits);if(i!==sw)throw new Error(J_[i]);if(this.header=new E_e,cf.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=rw.string2buf(r.dictionary):o$.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=cf.inflateSetDictionary(this.strm,r.dictionary),i!==sw)))throw new Error(J_[i])}function w_e(e,r){const i=new YP(r);if(i.push(e),i.err)throw i.msg||J_[i.err];return i.result}YP.prototype.push=function(e,r){const i=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?S_e:v_e,o$.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),u=cf.inflate(i,h),u===k2&&c&&(u=cf.inflateSetDictionary(i,c),u===sw?u=cf.inflate(i,h):u===a$&&(u=k2));i.avail_in>0&&u===O2&&i.state.wrap>0&&e[i.next_in]!==0;)cf.inflateReset(i),u=cf.inflate(i,h);switch(u){case b_e:case a$:case k2:case T_e:return this.onEnd(u),this.ended=!0,!1}if(m=i.avail_out,i.next_out&&(i.avail_out===0||u===O2))if(this.options.to==="string"){let _=rw.utf8border(i.output,i.next_out),E=i.next_out-_,S=rw.buf2string(i.output,_);i.next_out=E,i.avail_out=o-E,E&&i.output.set(i.output.subarray(_,_+E),0),this.onData(S)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==sw||m!==0){if(u===O2)return u=cf.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},YP.prototype.onData=function(e){this.chunks.push(e)},YP.prototype.onEnd=function(e){e===sw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=FP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var C_e={inflate:w_e};const{deflate:R_e}=o_e,{inflate:I_e}=C_e;var A_e=R_e,P_e=I_e,c$=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(c$||{});class O_e{constructor(){K(this,"_sequence",0),K(this,"_startTime",Date.now()),K(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},E={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};i.commonPacketHeader.extension=1,i.extension=E,i.payload=this.compress(r),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;oe("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const o=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const m=this.serializeExtension(i.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const i=new DataView(r);let o=0;const c=i.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)};let h,m;if(o+=4,oe("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let _=!1;if(m.datas.length>0){const E=m.datas.find(S=>S.id===0);E&&(_=(1&new DataView(E.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:i,length:o,datas:c}=r,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let _=0;if(m.setUint8(_++,i),m.setUint8(_++,o),c.forEach(E=>{i?(m.setUint8(_++,E.id),m.setUint8(_++,E.length),h.set(new Uint8Array(E.data),_),_+=E.data.byteLength):(m.setUint8(_++,E.id|E.length<<4),h.set(new Uint8Array(E.data),_),_+=E.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(r){const i=new DataView(r);let o=0;const c=i.getUint8(o);o++;const u=i.getUint8(o);o++;const h=c===c$.TWO_BYTE,m=[],_=new DataView(r,2);let E=0;for(;E<u;){let S=0,R=0,P=new ArrayBuffer(0);h?(S=_.getUint8(E),E++,R=_.getUint8(E),E++):(S=15&_.getUint8(E),R=_.getUint8(E)>>4,E++),R>0&&(P=_.buffer.slice(E+2,E+2+R),E+=P.byteLength),m.push({id:S,length:R,data:P})}if(E!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return P_e(new Uint8Array(r))}compress(r){return A_e(new Uint8Array(r))}}const k_e={name:"DataStream",create:(e,r)=>{const i=r?new Vfe(e):new Ffe(e);return i.useDataStream(new O_e),i}};class N_e extends Mr{constructor(r,i,o){super(),K(this,"ws",void 0),K(this,"requestId",1),K(this,"heartBeatTimer",void 0),K(this,"joinInfo",void 0),K(this,"clientId",void 0),K(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),K(this,"onClose",c=>{this.emit("close"),this.dispose()}),K(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=i,this.ws=new kT("cross-channel-".concat(this.clientId),o),this.ws.on(Qt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Qt.CONNECTED,this.onOpen),this.ws.on(Qt.ON_MESSAGE,this.onMessage),this.ws.on(Qt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new ut((i,o)=>{const c=window.setTimeout(()=>{o(new Oe(te.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Oe(te.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Oe(te.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(te.WS_DISCONNECT);const i=()=>new ut((h,m)=>{this.ws.once(Qt.CLOSED,()=>m(new Oe(te.WS_ABORT))),this.ws.once(Qt.CONNECTED,h)});this.ws.state!=="connected"&&await i();const o=this.sendMessage(r),c=new ut((h,m)=>{const _=()=>{m(new Oe(te.WS_ABORT))};this.ws.once(Qt.RECONNECTING,_),this.ws.once(Qt.CLOSED,_),this.once("req_".concat(o),h),hs(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Qt.RECONNECTING,_),this.ws.off(Qt.CLOSED,_),m(new Oe(te.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Oe(te.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(Qt.REQUEST_NEW_URLS),this.ws.on(Qt.REQUEST_NEW_URLS,i=>{i(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class D_e extends Mr{set state(r){r!==this._state&&(r!==Ba.RELAY_STATE_FAILURE&&(this.errorCode=Yv.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,o,c,u){super(),K(this,"joinInfo",void 0),K(this,"sid",void 0),K(this,"clientId",void 0),K(this,"cancelToken",la.CancelToken.source()),K(this,"workerToken",void 0),K(this,"requestId",0),K(this,"signal",void 0),K(this,"prevChannelMediaConfig",void 0),K(this,"httpRetryConfig",void 0),K(this,"_resolution",void 0),K(this,"_state",Ba.RELAY_STATE_IDLE),K(this,"errorCode",Yv.RELAY_OK),K(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",ef.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",ef.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Yv.SRC_TOKEN_EXPIRED,this.state=Ba.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Yv.DEST_TOKEN_EXPIRED,this.state=Ba.RELAY_STATE_FAILURE))}),K(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ef.NETWORK_DISCONNECTED),this.state=Ba.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Ba.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=Yv.SERVER_CONNECTION_LOST,this.state=Ba.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=i,this.sid=x_(),this.signal=new N_e(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==Ba.RELAY_STATE_IDLE)throw new Oe(te.INVALID_OPERATION);this.state=Ba.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new Oe(te.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new Oe(te.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new Oe(te.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Ba.RELAY_STATE_RUNNING)throw new Oe(te.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Ba.RELAY_STATE_RUNNING)throw new Oe(te.INVALID_OPERATION);const i=this.genMessage(Mo.SetVideoProfile);await this.signal.request(i),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ba.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=la.CancelToken.source(),this.state=Ba.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await zme(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",ef.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const i=this.genMessage(Mo.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(Mo.SetSdkProfile,r);await this.signal.request(o),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Mo.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ef.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(Mo.SetSourceUserId,r);await this.signal.request(u),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Mo.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ef.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(Mo.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",ef.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ba.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const i=this.genMessage(Mo.UpdateDestChannel,r);await this.signal.request(i),this.emit("event",ef.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Mo.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,i){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Rl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,_=null;switch(r){case Mo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Mo.SetSourceChannel:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Oe(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case Mo.SetSourceUserId:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Oe(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case Mo.SetDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Oe(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case Mo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Mo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Mo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Mo.UpdateDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Oe(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case Mo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const x_e={name:"ChannelMediaRelay",create:function(e){return new D_e(e.joinInfo,e.clientId,e.websocketRetryConfig||Ii,e.httpRetryConfig||Ii,e.resolution)}};function l$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ow(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?l$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class L_e extends Mr{constructor(r,i,o,c){super(),K(this,"spec",void 0),K(this,"token",void 0),K(this,"websocket",void 0),K(this,"pingpongTimer",void 0),K(this,"reconnectMode","retry"),K(this,"serviceMode",void 0),K(this,"reqId",0),K(this,"commandReqId",0),K(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),K(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(At.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Zp.TRANSCODE?1:2}),this.emit(Vm.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=r,this.serviceMode=c,this.websocket=new kT("live-streaming",o),this.websocket.on(Qt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Qt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Qt.REQUEST_NEW_URLS,(u,h)=>{Ps(this,Vm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Qt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,i,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(te.UNEXPECTED_ERROR);const m=ow({command:r,sdkVersion:Rl==="4.23.2"?"0.0.1":Rl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new Oe(te.WS_DISCONNECT);const _=()=>new ut((P,N)=>{this.websocket.once(Qt.CLOSED,()=>N(new Oe(te.WS_ABORT))),this.websocket.once(Qt.CONNECTED,P)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const E=new ut((P,N)=>{const G=()=>{N(new Oe(te.WS_ABORT))};this.websocket.once(Qt.RECONNECTING,G),this.websocket.once(Qt.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),F=>{P(F)})});c&&At.workerEvent(this.spec.sid,ow(ow({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await E}catch(P){if(this.websocket.state==="closed")throw P;return await _(),await this.request(r,i,o)}return c&&At.workerEvent(this.spec.sid,ow(ow({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Rl==="4.23.2"?"0.0.1":Rl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Mi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case Mi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Mi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Mi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(te.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Mi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Mi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(te.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Mi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new Oe(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Vm.WARNING,i,r.serverResponse.url)}case Mi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new Oe(te.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Vm.WARNING,i,r.serverResponse.url)}case Mi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Mi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(te.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Mi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new Oe(te.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Vm.WARNING,i,r.serverResponse.url)}case Mi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Mi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Mi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Mi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Mi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Mi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(MA)},6e3)}}function u$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Wa(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?u$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class M_e extends Mr{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ii,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ii;super(),K(this,"onLiveStreamWarning",void 0),K(this,"onLiveStreamError",void 0),K(this,"spec",void 0),K(this,"retryTimeout",1e4),K(this,"connection",void 0),K(this,"httpRetryConfig",void 0),K(this,"wsRetryConfig",void 0),K(this,"streamingTasks",new Map),K(this,"isStartingStreamingTask",!1),K(this,"taskMutex",new Us("live-streaming")),K(this,"cancelToken",la.CancelToken.source()),K(this,"transcodingConfig",void 0),K(this,"uapResponse",void 0),K(this,"lastTaskId",1),K(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(r){const i=Wa(Wa({},bme),r);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>Wa(Wa(Wa({},Sme),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Br(h.width)||or(h.width,"config.width",0,1e4),Br(h.height)||or(h.height,"config.height",0,1e4),Br(h.videoBitrate)||or(h.videoBitrate,"config.videoBitrate",1,1e6),Br(h.videoFrameRate)||or(h.videoFrameRate,"config.videoFrameRate"),Br(h.lowLatency)||Yp(h.lowLatency,"config.lowLatency"),Br(h.audioSampleRate)||Bi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Br(h.audioBitrate)||or(h.audioBitrate,"config.audioBitrate",1,128),Br(h.audioChannels)||Bi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Br(h.videoGop)||or(h.videoGop,"config.videoGop"),Br(h.videoCodecProfile)||Bi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Br(h.userCount)||or(h.userCount,"config.userCount",0,17),Br(h.backgroundColor)||or(h.backgroundColor,"config.backgroundColor",0,16777215),Br(h.userConfigExtraInfo)||ds(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Br(h.transcodingUsers)&&(Xp(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,_)=>{oP(m.uid),Br(m.x)||or(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Br(m.y)||or(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Br(m.width)||or(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Br(m.height)||or(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Br(m.zOrder)||or(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Br(m.alpha)||or(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Br(h.watermark)||DL(h.watermark,"watermark"),Br(h.backgroundImage)||DL(h.backgroundImage,"backgroundImage"),h.images&&!Br(h.images)&&(Xp(h.images,"config.images"),h.images.forEach((m,_)=>{DL(m,"images[".concat(_,"]"))}))}(i);const o=[];i.images&&o.push(...i.images.map(h=>Wa(Wa(Wa({},NL),h),{},{zOrder:255}))),i.backgroundImage&&(o.push(Wa(Wa(Wa({},NL),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push(Wa(Wa(Wa({},NL),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>Wa({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?ut.resolve(h.uid):N9(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ut.all(c)).forEach((h,m)=>{i.userConfigs&&i.userConfigs[m]&&(i.userConfigs[m].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(zc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(r,i,o){if(!this.transcodingConfig&&i===Zp.TRANSCODE)throw new Oe(te.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(r)&&!o)return u(),new Oe(te.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(m){throw u(),m}switch(i){case Zp.TRANSCODE:c.transcodingConfig=Wa({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new ut((E,S)=>{hs(this.retryTimeout).then(()=>{if(o)return S(o);const R=this.statusError.get(r);return R?(this.statusError.delete(r),S(R)):void 0})}),_=await ut.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:i===Zp.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(r,{clientRequest:c,mode:i,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,i,m)):await this.startLiveStreamingTask(r,i,m)}}stopLiveStreamingTask(r){return new ut((i,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(te.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===Zp.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(o)})}resetAllTask(){var r;const i=Array.from(zc(r=this.streamingTasks).call(r));this.terminate();for(const o of i)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=la.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(te.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await Ps(this,xL.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=i,this.connection=new L_e(i.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Vm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Vm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Vm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Oe(te.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ps(this,xL.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(r){const i=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),c=r.reason;switch(r.code){case Mi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case Mi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case Mi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Mi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(zc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{x.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const U_e={name:"LiveStreaming",create:function(e){return new M_e(e.joinInfo,e.websocketRetryConfig||Ii,e.httpRetryConfig||Ii)}};function V_e(e){let r=p$();return function(i,o){let c=i.appId;c!==void 0&&(Zn(o,10),Ph(o,c));let u=i.cid;u!==void 0&&(Zn(o,16),Zn(o,u));let h=i.cname;h!==void 0&&(Zn(o,26),Ph(o,h));let m=i.deviceId;m!==void 0&&(Zn(o,34),Ph(o,m));let _=i.elapse;_!==void 0&&(Zn(o,40),Qm(o,_));let E=i.fileSize;E!==void 0&&(Zn(o,48),Qm(o,hS(E)));let S=i.height;S!==void 0&&(Zn(o,56),Qm(o,hS(S)));let R=i.jpg;R!==void 0&&(Zn(o,66),Zn(o,R.length),function(ma,je){let it=pS(ma,je.length);ma.bytes.set(je,it)}(o,R));let P=i.networkType;P!==void 0&&(Zn(o,72),Qm(o,hS(P)));let N=i.osType;N!==void 0&&(Zn(o,80),Qm(o,hS(N)));let G=i.requestId;G!==void 0&&(Zn(o,90),Ph(o,G));let F=i.sdkVersion;F!==void 0&&(Zn(o,98),Ph(o,F));let j=i.sequence;j!==void 0&&(Zn(o,104),Qm(o,hS(j)));let q=i.sid;q!==void 0&&(Zn(o,114),Ph(o,q));let ee=i.timestamp;ee!==void 0&&(Zn(o,120),Qm(o,ee));let he=i.uid;he!==void 0&&(Zn(o,128),Zn(o,he));let Se=i.vid;Se!==void 0&&(Zn(o,136),Zn(o,Se));let we=i.width;we!==void 0&&(Zn(o,144),Qm(o,hS(we)));let ye=i.service;ye!==void 0&&(Zn(o,152),Zn(o,ye));let Ne=i.callbackData;Ne!==void 0&&(Zn(o,162),Ph(o,Ne));let Ye=i.jpgEncryption;Ye!==void 0&&(Zn(o,168),Zn(o,Ye));let dt=i.requestType;dt!==void 0&&(Zn(o,176),Zn(o,dt));let ft=i.scorePorn;ft!==void 0&&(Zn(o,185),M2(o,ft));let Rn=i.scoreSexy;Rn!==void 0&&(Zn(o,193),M2(o,Rn));let In=i.scoreNeutral;In!==void 0&&(Zn(o,201),M2(o,In));let pr=i.scene;pr!==void 0&&(Zn(o,208),Zn(o,pr));let ai=i.ossFilePrefix;ai!==void 0&&(Zn(o,218),Ph(o,ai));let Yr=i.serviceVendor;if(Yr!==void 0)for(let ma of Yr){Zn(o,226);let je=p$();B_e(ma,je),Zn(o,je.limit),H_e(o,je),G_e(je)}}(e,r),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(r)}function F_e(e){return function(i){let o={};e:for(;!f$(i);){let c=Oh(i);switch(c>>>3){case 0:break e;case 1:o.code=Oh(i);break;case 2:o.msg=m$(i,Oh(i));break;case 3:{let u=W_e(i);o.data=j_e(i),i.limit=u;break}default:d$(i,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function j_e(e){let r={};e:for(;!f$(e);){let i=Oh(e);switch(i>>>3){case 0:break e;case 1:r.requestId=m$(e,Oh(e));break;case 2:r.requestType=Oh(e)>>>0;break;case 3:r.scorePorn=L2(e);break;case 4:r.scoreSexy=L2(e);break;case 5:r.scoreNeutral=L2(e);break;case 6:r.requestScene=Oh(e)>>>0;break;case 7:r.scene=Oh(e)>>>0;break;default:d$(e,7&i)}}return r}function B_e(e,r){let i=e.service;i!==void 0&&(Zn(r,8),Zn(r,i));let o=e.vendor;o!==void 0&&(Zn(r,16),Zn(r,o));let c=e.token;c!==void 0&&(Zn(r,26),Ph(r,c));let u=e.callbackUrl;u!==void 0&&(Zn(r,34),Ph(r,u))}function W_e(e){let r=Oh(e),i=e.limit;return e.limit=e.offset+r,i}function d$(e,r){switch(r){case 0:for(;128&g$(e););break;case 2:D2(e,Oh(e));break;case 5:D2(e,4);break;case 1:D2(e,8);break;default:throw new Error("Unimplemented type: "+r)}}let z_e=new Float32Array(1);new Uint8Array(z_e.buffer);let N2=new Float64Array(1),za=new Uint8Array(N2.buffer);function hS(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let h$=[];function p$(){const e=h$.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function G_e(e){h$.push(e)}function D2(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function f$(e){return e.offset>=e.limit}function pS(e,r){let i=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function x2(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function m$(e,r){let i=x2(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,E,S,R,P=c[m+i];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+i+1],E=c[m+i+2],(49344&(_|E<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&E,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+i+1],E=c[m+i+2],S=c[m+i+3],(12632256&(_|E<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&E)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Ph(e,r){let i=r.length,o=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}Zn(e,o);let c=pS(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function H_e(e,r){let i=pS(e,r.limit),o=e.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)o[u+i]=c[u]}function g$(e){return e.bytes[x2(e,1)]}function _$(e,r){let i=pS(e,1);e.bytes[i]=r}function L2(e){let r=x2(e,8),i=e.bytes;return za[0]=i[r++],za[1]=i[r++],za[2]=i[r++],za[3]=i[r++],za[4]=i[r++],za[5]=i[r++],za[6]=i[r++],za[7]=i[r++],N2[0]}function M2(e,r){let i=pS(e,8),o=e.bytes;N2[0]=r,o[i++]=za[0],o[i++]=za[1],o[i++]=za[2],o[i++]=za[3],o[i++]=za[4],o[i++]=za[5],o[i++]=za[6],o[i++]=za[7]}function Oh(e){let r,i=0,o=0;do r=g$(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function Zn(e,r){for(r>>>=0;r>=128;)_$(e,127&r|128),r>>>=7;_$(e,r)}function Qm(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=pS(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}function y$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const $_e=new Map([["moderation",1],["supervise",2]]);class K_e extends Mr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(as.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=cc(i=r.map(o=>$_e.get(o)||0)).call(i,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),K(this,"name","AgoraRTCVideoContentInspect"),K(this,"_connectionState",vu.CONNECTING),K(this,"_innerConnectionState",void 0),K(this,"sequence",0),K(this,"inspectStartTime",void 0),K(this,"workerManagerConnection",void 0),K(this,"workerConnection",void 0),K(this,"workerMessageLengthLimit",void 0),K(this,"inspectIntervalMinimum",void 0),K(this,"qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",la.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"wmSequence",0),K(this,"inspectInterval",void 0),K(this,"inspectTimer",null),K(this,"ossFilePrefix",void 0),K(this,"extraInfo",void 0),K(this,"_inspectType",void 0),K(this,"_inspectMode",void 0),K(this,"_quality",1),K(this,"qualityTimer",null),K(this,"_inspectId",void 0),K(this,"_needWorkUrlOnly",!1),K(this,"inspectImage",()=>{if(this.connectionState!==vu.CONNECTED)throw new Oe(te.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===vu.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=dr(5,"inspect-"),this.workerMessageLengthLimit=oe("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=oe("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=oe("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new kT("worker-manager-"+this._inspectId,Ii),this.on(as.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Su[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new kT("worker-"+this._inspectId,Ii),this.handleWorkerEvents()}async init(r,i){this.emit(as.STATE_CHANGE,Su.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=i,new ut((c,u)=>{this.on(as.CONNECTION_STATE_CHANGE,(h,m)=>{m===vu.CONNECTED&&c()}),this.requestAP(r,o,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,i,o){const c=oe("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,_,E,S){let{appId:R,areaCode:P,cname:N,sid:G,token:F,uid:j}=_;nS++;const q="image_moderation_api",ee={service_name:q,json_body:JSON.stringify({appId:R,areaCode:P,cname:N,command:"allocateEdge",requestId:nS,seq:nS,sid:G,token:F,ts:Date.now(),uid:j+""})};let he,Se,we=m[0];return gd(async()=>{he=Date.now();const ye=await Sd(we,{data:ee,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Se=Date.now()-he,ye.code!==0){const ft=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ye.code,{retry:!0,responseTime:Se});throw x.error(ft.toString()),ft}const Ne=JSON.parse(ye.json_body);if(Ne.code!==200){const ft=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ne.code,", reason: ").concat(Ne.reason),{code:Ne.code,responseTime:Se});throw x.error(ft.toString()),ft}if(!Ne.servers||!Array.isArray(Ne.servers)||Ne.servers.length===0){const ft=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ne.code,responseTime:Se});throw x.error(ft.toString()),ft}const Ye=oe("VIDEO_INSPECT_WORKER_MANAGER_HOST"),dt=oe("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ne.servers.map(ft=>{let{address:Rn,wss:In}=ft;if(Rn&&In)return"wss://".concat(Rn.replace(/\./g,"-"),".").concat(Ye,":").concat(dt||In)}).filter(ft=>!!ft),workerToken:Ne.workerToken,vid:Ne.vid,responseTime:Se}},(ye,Ne)=>(At.apworkerEvent(G,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(ye.addressList),firstSuccess:Ne===0,responseTime:Se,serverIp:m[Ne%m.length]}),!1),(ye,Ne)=>(At.apworkerEvent(G,{success:!1,sc:ye.data&&ye.data.code||200,serviceName:q,responseTime:Se,serverIp:m[Ne%m.length]}),!!(ye.code!==te.OPERATION_ABORTED&&ye.code!==te.UNEXPECTED_RESPONSE||ye.data&&ye.data.retry)&&(we=m[(Ne+1)%m.length],!0)),S)}(c,r,i,o);this.emit(as.STATE_CHANGE,Su.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(as.STATE_CHANGE,Su.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Qt.CONNECTED,async()=>{this.emit(as.STATE_CHANGE,Su.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Qt.CLOSED,()=>{this._innerConnectionState<Su.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Qt.FAILED,()=>{this._innerConnectionState<Su.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Qt.RECONNECTING,()=>{this._innerConnectionState<Su.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Qt.ON_MESSAGE,async r=>{this.emit(as.STATE_CHANGE,Su.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Oe(te.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Oe(te.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=oe("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(as.STATE_CHANGE,Su.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(as.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Qt.WILL_RECONNECT,(r,i,o)=>{o(r)}),this.workerManagerConnection.on(Qt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Qt.CONNECTED,async()=>{this.emit(as.STATE_CHANGE,Su.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=vu.CONNECTED}),this.workerConnection.on(Qt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=F_e(new Uint8Array(r.data));if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(as.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=cc(i=Object.keys(c)).call(i,(m,_)=>c[m]>c[_]?m:_,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(as.INSPECT_RESULT,h)}else this.emit(as.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(as.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(as.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Qt.CLOSED,()=>{this.connectionState=vu.CLOSED}),this.workerConnection.on(Qt.FAILED,()=>{this.connectionState=vu.CLOSED}),this.workerConnection.on(Qt.RECONNECTING,()=>{this.connectionState=this.connectionState===vu.CONNECTED?vu.RECONNECTING:vu.CONNECTING}),this.workerConnection.on(Qt.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(Qt.REQUEST_NEW_URLS,(r,i)=>{this.workerManagerConnection.close(),this.once(as.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}async requestToInspectImage(){this.sequence++;const r=Hc(this,as.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(as.INSPECT_RESULT,void 0,new Oe(te.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(as.INSPECT_RESULT,void 0,new Oe(te.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await ZW(S,o,c),P=this.sequence+"-"+u+"-"+_+"-"+E+"-"+dr(12,""),N={appId:o,cid:u,cname:c,deviceId:"",elapse:(G=Number(E-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:RH(E),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete N.callbackData,this.ossFilePrefix===void 0&&delete N.ossFilePrefix;const F=V_e(N);if(F.byteLength<this.workerMessageLengthLimit){if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function(q){for(var ee=1;ee<arguments.length;ee++){var he=arguments[ee]!=null?arguments[ee]:{};ee%2?y$(Object(he),!0).forEach(function(Se){K(q,Se,he[Se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(he)):y$(Object(he)).forEach(function(Se){Object.defineProperty(q,Se,Object.getOwnPropertyDescriptor(he,Se))})}return q}({},N);delete j.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return F}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=la.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=vu.CLOSED,this.emit(as.STATE_CHANGE,Su.CLOSED)}}const q_e={name:"ContentInspect",create:function(e){let{config:r}=e;return function(i){if(!i)throw new Oe(te.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new Oe(te.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(i.inspectType)];o.forEach(c=>{var u;if(!st(u=["supervise","moderation"]).call(u,c))throw new Oe(te.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new Oe(te.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new K_e(r)}};var E$=l(mt.Object.getOwnPropertySymbols),Y_e=zn,X_e=ra.indexOf,J_e=bp,U2=se([].indexOf),v$=!!U2&&1/U2([1],1,-0)<0;Y_e({target:"Array",proto:!0,forced:v$||!J_e("indexOf")},{indexOf:function(e){var r=arguments.length>1?arguments[1]:void 0;return v$?U2(this,e,r)||0:X_e(this,e,r)}});var Q_e=ac("Array").indexOf,Z_e=k,eye=Q_e,V2=Array.prototype,tye=function(e){var r=e.indexOf;return e===V2||Z_e(V2,e)&&r===V2.indexOf?eye:r},S$=l(tye);function nye(e,r){if(e==null)return{};var i,o,c=function(h,m){if(h==null)return{};var _,E,S={},R=BG(h);for(E=0;E<R.length;E++)_=R[E],S$(m).call(m,_)>=0||(S[_]=h[_]);return S}(e,r);if(E$){var u=E$(e);for(o=0;o<u.length;o++)i=u[o],S$(r).call(r,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(c[i]=e[i])}return c}let b$=class{get localCapabilities(){return zr(this._localCapabilities)}get rtpCapabilities(){return zr(this._rtpCapabilities)}get candidates(){return zr(this._candidates)}get iceParameters(){return zr(this._iceParameters)}get dtlsParameters(){return zr(this._dtlsParameters)}constructor(e){K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_iceParameters",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname","o/i14u9pJrxRKAsu"),K(this,"firefoxSsrcMidMap",new Map),e=zr(e);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:_,audioCodec:E}=e;let S;this.setup=m,S=h===Lo.RECEIVE_ONLY?ja(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ja(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u;const R=h===Lo.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===Lo.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,N=h===Lo.RECEIVE_ONLY?c.send.videoCodecs:xT(yt.VIDEO,R,P,_),G=h===Lo.RECEIVE_ONLY?c.send.audioCodecs:xT(yt.AUDIO,R,P,E);for(const F of S.mediaDescriptions)F.attributes.iceUfrag=r.iceUfrag,F.attributes.icePwd=r.icePwd,F.attributes.fingerprints=i.fingerprints,F.attributes.candidates=o,F.attributes.setup=this.setup,F.media.mediaType==="application"&&(F.attributes.sctpPort="5000"),F.media.mediaType==="video"&&(F.media.fmts=N.map(j=>j.payloadType.toString(10)),F.attributes.payloads=N,F.attributes.extmaps=R.videoExtensions),F.media.mediaType==="audio"&&(F.media.fmts=G.map(j=>j.payloadType.toString(10)),F.attributes.payloads=G,F.attributes.extmaps=R.audioExtensions,tS(F));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Um(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===e)}send(e,r,i,o,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=z_(r,this.cname,oe("SYNC_GROUP")?i:void 0),m=this.findPreloadMediaDesc(u);if(m){if(jr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,o);let E;return _===-1?(E=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(E=zr(this.sessionDesc.mediaDescriptions[_]),E.attributes.direction="sendonly",E.attributes.ssrcs=u,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(E,c)),jr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,E.attributes.mid),{needExchangeSDP:!0,mid:E.attributes.mid}}}stopSending(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,r,i){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,_=!1;h===-1?(_=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,i),this.updateBundleMids()):(m=zr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:r,protocol:i,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:_}=new RTCIceCandidate(e),E={foundation:r??"",componentId:"1",transport:i??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===E.priority&&S.connectionAddress===E.connectionAddress&&S.port===E.port)||(this._candidates.push(E),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,r,i,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=xT(u,h,this.localCapabilities.send,u===yt.AUDIO?c:o),_=u===yt.VIDEO?h.videoExtensions:h.audioExtensions,E="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};S=this.mungRecvMediaDsec(S,e);const R=this.findFirstClosedMedia(u);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>st(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>st(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,r,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(jr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(e){const r=[];for(let i=0;i<e;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(e){e=zr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,r,i,o,c,u){const h=this.rtpCapabilities.send,m=e===yt.VIDEO?h.videoCodecs:h.audioCodecs,_=e===yt.VIDEO?h.videoExtensions:h.audioExtensions;jr()&&(c="".concat(++this.currentMidIndex));let E={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};E=this.mungSendMediaDesc(E,u);const S=this.findFirstClosedMedia(e);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}mungRecvMediaDsec(e,r,i){const o=zr(e);return FL(o),eS(o,r),jL(o,r),h9(o),pP(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,r){const i=zr(e);return pP(i,r,this.localCapabilities.recv),tS(i),i}updateRecvMedia(e,r){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>jr()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}};const rye=["sdp"];var yr;function T$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Zm(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?T$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):T$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let w$=(yr=class RS extends KG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,o){super(r,i),K(this,"direction",void 0),K(this,"name",void 0),K(this,"store",void 0),K(this,"spec",void 0),K(this,"peerConnection",void 0),K(this,"initialOffer",void 0),K(this,"transport",void 0),K(this,"statsFilter",void 0),K(this,"localCandidateCount",0),K(this,"_isInRestartIce",!1),K(this,"mutex",void 0),K(this,"onLocalCandidate",void 0),K(this,"remoteSDP",void 0),K(this,"pendingCandidates",[]),K(this,"localCapabilities",void 0),K(this,"isReady",!1),K(this,"restartCnt",0),K(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.mutex=new Us("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(RS.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Lo.SEND_ONLY,this.name=this.direction===Lo.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Zx(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,jr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const i=await f9();if(this.localCapabilities=fP(i),r){const{sdp:o}=r,c=nye(r,rye),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=DT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bu(R,S,"videoExtensions",P,N,G),bu(R,S,"videoCodecs",P,N,G),bu(R,S,"audioExtensions",P,N,G),bu(R,S,"audioCodecs",P,N,G),oe("RAISE_H264_BASELINE_PRIORITY")){const F=G.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(F!==-1){const j=G.videoCodecs.findIndex(q=>q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<F){x.debug("raising H264 baseline profile priority");const q=G.videoCodecs[F];G.videoCodecs.splice(F,1),G.videoCodecs.splice(j,0,q)}j!==-1&&oe("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>!(q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&q.fmtp&&q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:N,sendrecv:G}}({},{},o);this.remoteSDP=new b$({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Wm(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await m9({},{},h.sdp);this.localCapabilities=fP(_);const E=this.peerConnection.getTransceivers()[0];return E!=null&&E.receiver&&E.receiver.transport&&this.tryBindTransportEvents(E.receiver.transport),Zm(Zm({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Wm(o.sdp);return this.initialOffer=o,Zm(Zm({},c),{},{sdp:o.sdp})}}catch(i){throw new Me(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:o,dtlsParameters:c}=r,u=await m9({},{},i);this.remoteSDP=new b$({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new Me(te.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,o){var c=this;return Cl(function*(){const u=yield Nn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,i,o);r.forEach((j,q)=>{if(m[q].needCreateTransceiver){const ee=c.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});h.push(ee),j._updateRtpTransceiver(ee)}else{const ee=c.peerConnection.getTransceivers().find(he=>he.mid===m[q].mid);if(!ee)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[q].mid));h.push(ee),j._updateRtpTransceiver(ee)}}),jr()&&oe("SIMULCAST")===!0&&(yield Nn(c.applySimulcastForFirefox(h,r)));const _=m.map(j=>j.mid),E=yield Nn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(E.sdp,r,_),R=ja(S),P=_.map(j=>{const q=R.mediaDescriptions.find(ee=>ee.attributes.mid===j);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return l9(q,oe("USE_PUB_RTX"))}),N=h.map((j,q)=>{const ee=_[q];return{localSSRC:P[q],id:ee}});yield Nn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield N}catch(j){const q=c.remoteSDP.toString();throw yield Nn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Nn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Nn(c.stopSending(_,!0)),j}yield Nn(c.applySimulcastEncodings(h,r)),yield Nn(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),F=c.logSDPExchange(S,"offer","local","send");return F==null||F(G),yield Nn(c.setRemoteDescription({type:"answer",sdp:G})),h.map((j,q)=>{const ee=_[q];return{localSSRC:P[q],id:ee}})}catch(h){throw h instanceof Me?h:new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var E;_.direction="inactive",(E=_.stop)===null||E===void 0||E.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);if(h){const _=this.remoteSDP.toString(),E=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,r);E==null||E(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const E=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(E.sdp,u,r);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===L_.Auto&&(this.store.p2pTransport=L_.SdRtn,jn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(RS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,jn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(RS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Wm(i.sdp);return this.store.descriptionStart(),this.direction===Lo.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Lo.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Wm(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Me(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(i)?jr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:Zm(Zm({},gh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Zm(Zm({},gh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;st(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(vT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...RS.turnServerConfigToIceServers(r.turnServer.servers,i,o)),oe("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...RS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,o)),st(u=[L_.Relay,L_.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),oe("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&jn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(i){case L_.SdRtn:const m=r.filter(E=>{var S;return st(S=E.username).call(S,"glb:")&&E.turnServerURL==E.turnServerURL}),_=m.length>o?m[o]:m[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(jm(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(jm(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case L_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(jm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(jm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=r.iceTransport;i&&(i.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!i)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),st(h=r._hints).call(h,hr.LOW_STREAM)&&(R&&(u.maxFramerate=gc(R)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(oe("DSCP_TYPE")&&qp()){var m;const S=oe("DSCP_TYPE");st(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const _=i.getParameters(),E=(o=_.encodings)===null||o===void 0?void 0:o[0];jr()&&!E&&(c.encodings=[u]),E&&Object.assign(E,u),Object.assign(_,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await i.setParameters(_)}async applySendEncodings(r,i){try{if(!jn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];u instanceof br&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){const c=ja(r);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(E=>E.attributes.mid===m);_&&(eS(_,u),p9(_,u,this.store.codec))}),Um(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const E=r[_],S=i[_];if(S instanceof br&&!st(o=S._hints).call(o,hr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const N=E.sender.getParameters();await E.sender.setParameters(Object.assign(N,R))}}}async applySimulcastEncodings(r,i){if(!jr()&&r.length===i.length)for(let o=0;o<r.length;o++){const c=i[o];if(c instanceof br&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var i,o,c,u,h;return!!(r instanceof br&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!st(i=r._hints).call(i,hr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,o,c){if(oe("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var o,c;if(i=(o=i)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=ja(i).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),st(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,o){const c=ja(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&o===yt.AUDIO&&u.media.mediaType==="audio"&&tS(u),Um(c)}},Tt(yr.prototype,"establish",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"establish"),yr.prototype),Tt(yr.prototype,"connect",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"connect"),yr.prototype),Tt(yr.prototype,"receive",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"receive"),yr.prototype),Tt(yr.prototype,"mockReceive",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"mockReceive"),yr.prototype),Tt(yr.prototype,"stopReceiving",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"stopReceiving"),yr.prototype),Tt(yr.prototype,"restartICE",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"restartICE"),yr.prototype),Tt(yr.prototype,"close",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"close"),yr.prototype),Tt(yr.prototype,"updateEncoderConfig",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"updateEncoderConfig"),yr.prototype),Tt(yr.prototype,"updateSendParameters",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"updateSendParameters"),yr.prototype),Tt(yr.prototype,"replaceTrack",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"replaceTrack"),yr.prototype),Tt(yr.prototype,"muteLocal",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"muteLocal"),yr.prototype),Tt(yr.prototype,"unmuteLocal",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"unmuteLocal"),yr.prototype),yr);function Iu(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}let Td=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var C$,R$,I$,A$,P$,O$,k$,N$,D$,x$,L$,Dr;function M$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function XP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?M$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):M$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let iye=(C$=wd(Td.SEND_ONLY),R$=wd(Td.SEND_ONLY),I$=wd(),A$=wd(Td.RECEIVE_ONLY),P$=wd(Td.RECEIVE_ONLY),O$=wd(Td.RECEIVE_ONLY),k$=wd(Td.RECEIVE_ONLY),N$=wd(Td.RECEIVE_ONLY),D$=wd(Td.RECEIVE_ONLY),x$=wd(),L$=wd(Td.RECEIVE_ONLY),Dr=class extends Mr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(xt.StateChange,r,this._state)}constructor(e,r){super(),K(this,"isPlanB",!1),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"sendConnection",void 0),K(this,"recvConnection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"statsCollector",void 0),K(this,"dtlsFailedCount",0),K(this,"sendMutex",void 0),K(this,"recvMutex",void 0),K(this,"_state",Yn.Disconnected),K(this,"_restartStates",["disconnected","failed"]),K(this,"reconnectInterval",void 0),K(this,"uploadUnplinkStarted",!1),K(this,"uploadDownlinkStarted",!1),K(this,"uplinkStateUploadInterval",void 0),K(this,"downlinkStatsUploadInterval",void 0),K(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Yn.Connected)return void c(new Me(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(i);if(_.length===0)return void o();const E=_.find(N=>N[0]==="videoLowTrack");E&&E[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(N=>{let[,{id:G}]=N;return G}));let S=!1;var h,m;i.trackMediaType==="video"?S=!((h=this.localTrackMap.get(Ke.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get(Ke.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(_);await ur(this,xt.RequestMuteLocal,R);const P=i.trackMediaType==="video"?Fm.MUTE_LOCAL_VIDEO:Fm.MUTE_LOCAL_AUDIO;await ur(this,xt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:S}),o()}catch(_){c(_)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Yn.Connected)return void c(new Me(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const m=this.createUnmuteMessage(h),_=i.trackMediaType==="video"?Fm.UNMUTE_LOCAL_VIDEO:Fm.UNMUTE_LOCAL_AUDIO;await ur(this,xt.RequestP2PMuteLocal,{action:_,message:m}),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==i||this.state!==Yn.Connected)return void o();const{id:E,track:S}=_;E&&(await this.sendConnection.updateSendParameters(E,S),await this.sendConnection.updateEncoderConfig(E,S),this.emit(xt.UpdateVideoEncoder,S)),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==Yn.Connected)return void o();const{id:m,track:_}=h;m&&await this.sendConnection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return i===R});if(!this.sendConnection||!E||E[1].id===void 0||this.state!==Yn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(i,E[1].id)),E[0]===Ke.LocalVideoTrack&&jn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(S){const R=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ut((P,N)=>{this.handleReplaceTrack(S.track,P,N,!0)})}}o()}catch(E){c(E)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),K(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new eH(e),this.bindStatsUploaderEvents(),this.sendMutex=new Us("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Us("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},oe("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,r){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,r){let i;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new w$(e,this.store,Lo.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Yn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new w$(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new Me(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Yn.Connected}async addRemoteCandidate(e,r){if(r===Lo.RECEIVE_ONLY){if(!this.sendConnection)throw new Me(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Me(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,r,i){var o=this;return Cl(function*(){const c=yield Nn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Yn.Connected){o.throwIfTrackTypeNotMatch(e);const E=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(E))}o.store.pubId=o.store.pubId+1,js.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,r,i);if(u.length===0)return void(yield Nn(o.tryToUnmuteAudio(e)));u.forEach(E=>{let{track:S,type:R}=E;const P=Date.now();o.store.publish(S.getTrackId(),R===Ke.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(u);const h=yield Nn(o.sendConnection.send(u.map(E=>{let{track:S}=E;return S}),o.store.codec,o.store.audioCodec)),m=(yield Nn(h.next())).value,_=o.createGatewayPublishMessage(u,m);try{yield _}catch(E){throw h.throw(E),(E==null?void 0:E.code)===te.WS_ABORT&&u.forEach(S=>{let{track:R}=S;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),E}yield Nn(h.next()),u.forEach(E=>{let{type:S}=E;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(E=>{let{track:S,type:R}=E;const P=Date.now();o.store.publish(S.getTrackId(),R===Ke.LocalAudioTrack?"audio":"video",void 0,P)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Yn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!st(e).call(e,c)));const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Yn.Connected)return i&&i[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:Yme(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):i.push(m)}),r.length>0&&r.forEach(o=>{ur(this,xt.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{ur(this,xt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Cl(function*(){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ps(this,xt.RequestRePublish,this.pendingLocalTracks),this.emit(xt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,r,i,o){var c;if(!this.recvConnection)throw new Me(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:i}],String(e.uid),o);r===yt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new $v(u,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Hv(u,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(r,h):this.remoteUserMap.set(e,new Map([[r,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const E=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:P}=S;return R.uid===e.uid&&r===P});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(xt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,r,i,o){if(!this.recvConnection)throw new Me(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,r,i){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===e.uid&&r===m:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||o.forEach(u=>{let{kind:h}=u;var m;if(h===yt.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===yt.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var _,E;if(m===yt.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===yt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(m===yt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;ur(this,xt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[yt.VIDEO,yt.AUDIO].forEach(o=>{i.has(o)?ur(this,xt.RequestP2PUnmuteRemote,o):ur(this,xt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===yt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){const r=this.localTrackMap.get(Ke.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Li){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ke.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ke.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Ke.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,r,i,o,c){if(e){const h=this.localTrackMap.get(Ke.LocalAudioTrack),m=o?this.localTrackMap.get(Ke.LocalVideoLowTrack):this.localTrackMap.get(Ke.LocalVideoTrack);At.publish(this.store.sessionId,{eventElapse:js.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof qr),m=o?(u=this.localTrackMap.get(Ke.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof br);At.publish(this.store.sessionId,{eventElapse:js.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,i,o){const c=o===yt.VIDEO?i._videoSSRC:i._audioSSRC;c&&At.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===yt.VIDEO,audio:o===yt.AUDIO,peerid:i.uid,subscribeRequestid:o===yt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:js.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Us("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Us("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ke.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Li){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Yn.Disconnected}getStats(e){var r,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ke.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ke.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof br||r&&r.track instanceof qr?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(Kc(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ke.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=iT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Yn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case Ke.LocalVideoTrack:st(r=o._hints).call(r,hr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ke.LocalAudioTrack:o instanceof Li?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ke.LocalVideoLowTrack:}}),this.emit(xt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Kc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(xt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Gm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}async restartICE(e,r){let i,o;if(e===Lo.SEND_ONLY){if(!this.sendConnection)throw new Me(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Me(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await Ps(this,xt.RequestP2PRestartICE,{direction:Lo.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),r=this.localTrackMap.get(Ke.LocalVideoTrack),i=this.localTrackMap.get(Ke.LocalAudioTrack),o=e.videoSend.find(N=>{var G;return N.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=e.audioSend.find(N=>{var G;return N.ssrc===(i==null||(G=i.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!o||!c)return 1;const u=Hc(this,xt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,E=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*E/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(hr.SCREEN_TRACK)===-1){const N=P._encoderConfig.bitrateMax,G=e.bitrate.actualEncoded;if(N&&G){const F=(1e3*N-G)/(1e3*N);return VG[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(G=>G.ssrc===c),m=e.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const _=Hc(this,xt.NeedSignalRTT),E=e.rtt,S=(E&&_?(E+_)/2:E||_)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let N=.7*P*100/50+.3*S/1500;R&&(N=.6*P*100/50+.2*S/1500+.2*R/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new ut((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}filterTobePublishedTracks(e,r,i){const o=[],c=jn(),u=this.getAllTracks();e=Nv(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,m=!1;for(const _ of e){if(_ instanceof br&&(this.localTrackMap.has(Ke.LocalVideoTrack)||h?new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Ke.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(_,i);o.push({track:E,type:Ke.LocalVideoLowTrack})}if(_ instanceof qr){const E=this.localTrackMap.get(Ke.LocalAudioTrack);if(E){if(!(E.track instanceof Li))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const S=o.find(R=>{let{type:P}=R;return P===Ke.LocalAudioTrack});if(!(S.track instanceof Li))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof Li||_._bypassWebAudio)o.push({track:_,type:Ke.LocalAudioTrack});else{const S=new Li;S.addAudioTrack(_),o.push({track:S,type:Ke.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=Nv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof qr){const c=this.localTrackMap.get(Ke.LocalAudioTrack);if(!c)continue;c.track instanceof Li?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ke.LocalAudioTrack,c]),c.track.close())):r.push([Ke.LocalAudioTrack,c])}if(o instanceof br){const c=this.localTrackMap.get(Ke.LocalVideoTrack);if(!c)continue;r.push([Ke.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);u&&r.push([Ke.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ke.LocalVideoTrack:i.addListener(bt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ke.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Li?e.trackList.forEach(i=>{i.addListener(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(bt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(bt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||e.addListener(bt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ke.LocalVideoTrack:i.off(bt.GET_STATS,this.handleGetLocalVideoStats),i.off(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(bt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(bt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ke.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Li?e.trackList.forEach(r=>{r.off(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(bt.GET_STATS,this.handleGetLocalAudioStats),r.off(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(bt.GET_STATS,this.handleGetLocalAudioStats),e.off(bt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(bt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(bt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(bt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(bt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Hv&&r.addListener(bt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof $v&&r.addListener(bt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(bt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(yt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(yt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var c;let u,{track:h,type:m}=i;switch(m){case Ke.LocalAudioTrack:u=Xn.Audio;break;case Ke.LocalVideoTrack:u=st(c=h._hints).call(c,hr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:u=Xn.Low}return{kind:m===Ke.LocalAudioTrack?yt.AUDIO:yt.VIDEO,stream_type:u,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalAudioTrack:o=Xn.Audio;break;case Ke.LocalVideoLowTrack:o=Xn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{var i;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),this.emit(xt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(e.isInRestartIce=!1),st(i=this._restartStates).call(i,r)&&!e.isInRestartIce&&(r==="disconnected"&&await hs(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),At.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Wr.TRACER}).onSuccess(),this.emit(xt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const o=Array.from(Kc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(jv.FIRST_FRAME_DECODED),At.firstRemoteFrame(this.store.sessionId,qi.FIRST_AUDIO_DECODE,kr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const o=Array.from(Kc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);o&&At.firstRemoteFrame(this.store.sessionId,qi.FIRST_AUDIO_RECEIVED,kr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;const o=Array.from(Kc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);o&&At.firstRemoteFrame(this.store.sessionId,qi.FIRST_VIDEO_RECEIVED,kr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{const o=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(xt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Bm(i))," -> ").concat(JSON.stringify(Bm(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Bm(i))," -> ").concat(JSON.stringify(Bm(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.onLocalCandidate=r=>{this.emit(xt.LocalCandidate,{candidate:r,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const r=e===Lo.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),e===Lo.SEND_ONLY?this.restartICE(e):Ps(this,xt.RequestP2PRestartICE,{direction:Lo.SEND_ONLY}))}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get(Ke.LocalAudioTrack);if(e instanceof qr&&(i==null?void 0:i.track)instanceof Li)return i.track.isActive||r.push([Ke.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===Ke.LocalVideoTrack)){const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get(Ke.LocalAudioTrack);if(e instanceof qr&&(i==null?void 0:i.track)instanceof Li)return i.track.isActive&&r.push([Ke.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ke.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=Xn.Audio;break;case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:o=Xn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=Xn.Audio;break;case Ke.LocalVideoTrack:o=st(i=u._hints).call(i,hr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:o=Xn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){const c=o.get(r);if(!c)return i;i.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case yt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:yt.VIDEO,ssrcId:o._videoSSRC}));case yt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:yt.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(Ke.LocalVideoTrack),i=this.localTrackMap.get(Ke.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new ut((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ut((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return e!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof qr){const i=this.filterTobeUnmutedTracks(e[r]);if(i.length===0)continue;const o=this.createUnmuteMessage(i);return void await ur(this,xt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:r}]=e;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(xt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(xt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await hs(Kx(this.dtlsFailedCount,Ii)),this.emit(xt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ke.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof br)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof br).length>1)throw new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof qr).length>1&&(e.some(r=>r instanceof qr&&r._bypassWebAudio)||!jn().webAudioMediaStreamDest))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof br&&this.pendingLocalTracks.some(i=>i instanceof br))throw new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof qr&&this.pendingLocalTracks.some(i=>i instanceof qr)&&(!jn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof qr&&i._bypassWebAudio)))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){const i=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding,o=XP(XP({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=i?e._mediaStreamTrack.clone():n2(e,o);const u=dr(8,"track-low-"),h=new br(c,XP(XP({},i&&{scaleResolutionDownBy:VL(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(M_.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Vv.LOW_STREAM)}),h._hints.push(hr.LOW_STREAM),e.addListener(bt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,r,i,o){var c;const u=Array.from(Kc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");At.firstRemoteVideoDecode(this.store.sessionId,qi.FIRST_VIDEO_DECODE,kr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:js.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Me(te.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Me(te.NOT_SUPPORTED)}async subscribeDataChannel(e,r){throw new Me(te.NOT_SUPPORTED)}async unsubscribeDataChannel(e,r){throw new Me(te.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,r){throw new Me(te.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,r){throw new Me(te.NOT_SUPPORTED)}async preConnect(e){throw new Me(te.NOT_SUPPORTED)}getEstablishParams(){throw new Me(te.NOT_SUPPORTED)}async reSubscribe(e){throw new Me(te.NOT_SUPPORTED)}async updateVideoStreamParameter(e,r){throw new Me(te.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===Ke.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Vv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},Tt(Dr.prototype,"p2pConnect",[C$],Object.getOwnPropertyDescriptor(Dr.prototype,"p2pConnect"),Dr.prototype),Tt(Dr.prototype,"unpublish",[R$],Object.getOwnPropertyDescriptor(Dr.prototype,"unpublish"),Dr.prototype),Tt(Dr.prototype,"unpublishLowStream",[I$],Object.getOwnPropertyDescriptor(Dr.prototype,"unpublishLowStream"),Dr.prototype),Tt(Dr.prototype,"subscribe",[A$],Object.getOwnPropertyDescriptor(Dr.prototype,"subscribe"),Dr.prototype),Tt(Dr.prototype,"mockSubscribe",[P$],Object.getOwnPropertyDescriptor(Dr.prototype,"mockSubscribe"),Dr.prototype),Tt(Dr.prototype,"unsubscribe",[O$],Object.getOwnPropertyDescriptor(Dr.prototype,"unsubscribe"),Dr.prototype),Tt(Dr.prototype,"muteRemote",[k$],Object.getOwnPropertyDescriptor(Dr.prototype,"muteRemote"),Dr.prototype),Tt(Dr.prototype,"unmuteRemote",[N$],Object.getOwnPropertyDescriptor(Dr.prototype,"unmuteRemote"),Dr.prototype),Tt(Dr.prototype,"hasRemoteMediaWithLock",[D$],Object.getOwnPropertyDescriptor(Dr.prototype,"hasRemoteMediaWithLock"),Dr.prototype),Tt(Dr.prototype,"disconnectForReconnect",[x$],Object.getOwnPropertyDescriptor(Dr.prototype,"disconnectForReconnect"),Dr.prototype),Tt(Dr.prototype,"remoteMediaSsrcChanged",[L$],Object.getOwnPropertyDescriptor(Dr.prototype,"remoteMediaSsrcChanged"),Dr.prototype),Dr);function wd(e){return function(r,i,o){const c=r[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case Td.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}case Td.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i)),E=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_(),E()}}}},o}}class ry extends Mr{constructor(r,i){super(),K(this,"signal",void 0),K(this,"token",void 0),K(this,"tokenTimeout",void 0),K(this,"tokenInterval",void 0),K(this,"_sequence",0),K(this,"userMap",new Map),K(this,"encoder",new TextEncoder),this.signal=r,this.token=i;const o=()=>{this.signal.connectionState===fr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*oe("P2P_TOKEN_INTERVAL"))};o()}async send(r,i,o,c,u){var h,m,_;if(this.userMap.size===0)return;const E=Array.from(zc(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=(m=c)!==null&&m!==void 0?m:dr(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:r,_seq:u,_message:i,token:"".concat(this.token,"_").concat(E)};oe("SHOW_P2P_LOG")&&x.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(Gt.DATA_STREAM,{payload:Mm(this.encoder.encode(P))})});const R=new ut((P,N)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),F),this.off("res-@".concat(c),q),this.off(Jv.ABORT,j),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?N(new Me(te.INVALID_REMOTE_USER)):N(new Me(te.TIMEOUT))},oe("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),F=()=>{G&&window.clearTimeout(G),this.off(Jv.ABORT,j),o&&P()},j=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),F),this.off("res-@".concat(c),q),N(new Me(te.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(Jv.ABORT,j),this.once("res-@".concat(c,"_ack"),F);const q=(he,Se)=>{ee=!0,G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),F),this.off(Jv.ABORT,j),he==="success"?P(Se):N(new Me(te.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let ee=!1;o||(this.once("res-@".concat(c),q),hs(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{ee||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(P){if(P.code===te.TIMEOUT)return await this.send(r,i,o,c,u);throw P}}onMessage(r){var i;const{_uid:o}=r;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==oi.CHECK)return;const{token:E}=r;c=new Map,u={uid:o,isStart:!0,token:E,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(wn.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:E,total:S}=r,R=(h=c.get(E))!==null&&h!==void 0?h:[];if(R.push(r),c.has(E)||c.set(E,R),R.length!==S)return;{const P=iT(R).call(R,(N,G)=>N.index-G.index).map(N=>N.payload).join("");c.delete(E),(r=JSON.parse(P))._uid=o}}const{_type:m,token:_}=r;if(st(i=[oi.ACK,oi.CHECK]).call(i,m))return m===oi.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(r);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:dr(6,""),token:this.token,_type:oi.CHECK};oe("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(Gt.DATA_STREAM,{payload:Mm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const i={_id:r,_type:oi.ACK,token:this.token};oe("SHOW_P2P_LOG")&&x.debug("send message",i),this.signal.request(Gt.DATA_STREAM,{payload:Mm(this.encoder.encode(JSON.stringify(i)))})}response(r,i,o){this.send(oi.RESPONSE,JSON.stringify({success:!o,message:i}),!0,r)}handleReceivedMessage(r){const i=()=>{this.userMap.forEach(E=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=E;for(;S.has(R);){const P=S.get(R);S.delete(R),this.receiveMessage(P),E.nextExpectedSequenceNumber++}})};if(!r)return void i();const{_uid:o,_seq:c}=r,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===_&&(this.receiveMessage(r),h.delete(_),u.nextExpectedSequenceNumber++,i())}receiveMessage(r){const{_id:i,_type:o,_message:c,_uid:u}=r;if(oe("SHOW_P2P_LOG")&&x.debug("receive message",r),i){let h;switch(r._type!==oi.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case oi.CANDIDATE:case oi.CONTROL:this.signal.emit(o,h,u);break;case oi.PUBLISH:case oi.UNPUBLISH:case oi.RESTART_ICE:case oi.CALL:h.uid=u,Ps(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case oi.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case oi.RESPONSE:{const{success:m,message:_}=h;this.emit("res-@".concat(i),m?"success":"failed",_);break}}}}splitMessage(r){if(r.length<ry.MAX_MESSAGE_SIZE)return[r];const i=[],{remoteToken:o}=JSON.parse(r),c=dr(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const _={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>ry.MAX_MESSAGE_SIZE?h-=50:(i.push(_),r=r.slice(h))}return i.map(_=>JSON.stringify(_))}handleCheckToken(r,i){return r.token!==i?(x.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(i)),this.reset(r.uid)},oe("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Ps(this.signal,oi.CALL,void 0),i=await this.send(oi.CALL,r);this.signal.emit(Ht.P2P_CONNECTION,i,!0)}async reset(r,i){const o=this.userMap.get(r);o&&(this.emit(Jv.ABORT),this.signal.emit(wn.ON_USER_OFFLINE,{uid:o.uid,reason:Tme.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(x.debug("change local token from ".concat(i," to ").concat(i)),this.token=dr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Jv.ABORT)}}K(ry,"MAX_SIZE",1),K(ry,"MAX_MESSAGE_SIZE",1024);class sye extends Mr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===fr.CONNECTED?this.emit(Ht.WS_CONNECTED):r===fr.RECONNECTING?this.emit(Ht.WS_RECONNECTING,this._websocketReconnectReason):r===fr.CLOSED&&this.emit(Ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",fr.CLOSED),K(this,"reconnectToken",void 0),K(this,"p2pToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new hW(5)),K(this,"pingpongTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"_external_signal",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Ht.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case wn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case wn.MUTE_AUDIO:case wn.MUTE_VIDEO:case wn.ON_P2P_LOST:case wn.ON_USER_ONLINE:return;case wn.ON_USER_OFFLINE:const{uid:u}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===wn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===wn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(qn.UID_BANNED);break;case 15:this.close(qn.IP_BANNED);break;case 16:this.close(qn.CHANNEL_BANNED)}if(c._type===wn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Mt.ERR_LICENSE_MISSING:this.close(qn.LICENSE_MISSING);break;case Mt.ERR_LICENSE_EXPIRED:this.close(qn.LICENSE_EXPIRED);break;case Mt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(qn.LICENSE_MINUTES_EXCEEDED);break;case Mt.ERR_LICENSE_PERIOD_INVALID:this.close(qn.LICENSE_PERIOD_INVALID);break;case Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(qn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Mt.ERR_LICENSE_ILLEGAL:this.close(qn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new ML("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===fr.CONNECTED&&this.reconnect("retry",As.OFFLINE)}),this.p2pToken=dr(6,""),this._external_signal=new ry(this,this.p2pToken)}async request(r,i,o,c){const u=dr(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,_=()=>new ut((G,F)=>{if(this.connectionState===fr.CONNECTED)return G();const j=()=>{this.off(Ht.WS_CLOSED,q),G()},q=()=>{this.off(Ht.WS_CONNECTED,j),F(new Me(te.WS_ABORT))};this.once(Ht.WS_CONNECTED,j),this.once(Ht.WS_CLOSED,q)});if(this.connectionState!==fr.CONNECTING&&this.connectionState!==fr.RECONNECTING||r===Gt.JOIN||r===Gt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const E=new ut((G,F)=>{let j=!1;const q=(he,Se)=>{j=!0,G({isSuccess:he==="success",message:Se||{}}),this.off(Ht.WS_CLOSED,ee),this.off(Ht.WS_RECONNECTING,ee),this.emit(Ht.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),q);const ee=()=>{F(new Me(te.WS_ABORT,"type: ".concat(r))),this.off(Ht.WS_CLOSED,ee),this.off(Ht.WS_RECONNECTING,ee),this.off("res-@".concat(u),q)};this.once(Ht.WS_CLOSED,ee),this.once(Ht.WS_RECONNECTING,ee),hs(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Ht.REQUEST_TIMEOUT,r,i))})});let S=null;try{S=await E}catch(G){if(this.connectionState===fr.CLOSED||r===Gt.LEAVE)throw new Me(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===Gt.JOIN||r===Gt.REJOIN?null:(await _(),await this.request(r,i))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=OT(R),N=new Me(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Mt.ERR_TOO_MANY_BROADCASTERS?((r===Gt.JOIN||r===Gt.REJOIN)&&(this.initError=N,this.close()),N.throw()):P.action==="failed"?N.throw():P.action==="quit"?(this.initError=N,this.close(),N.throw()):(R===Mt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",As.MULTI_IP)):this.reconnect(P.action,As.SERVER_ERROR),r===Gt.JOIN||r===Gt.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new ut(o=>{const c=u=>{(!i||i(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(AT.WRTC_STATS,i)}upload(r,i){const o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{const u=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==fr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const o={_type:r,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(r,i,o){return await this._external_signal.send(r,i,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ut((i,o)=>{this.once(Ht.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Ht.WS_CLOSED,()=>o(this.initError||new Me(te.WS_ABORT))),this.connectionState=fr.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||qn.LEAVE,this.connectionState=fr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=dr(6,""),this._external_signal.clear(),this._external_signal=new ry(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Ht.ABORT_P2P_EXECUTION);const r=await Ps(this,Ht.REQUEST_JOIN_INFO),i=await this.request(Gt.JOIN,r);if(!i)return this.emit(Ht.REPORT_JOIN_GATEWAY,te.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleDataStream(r){try{var i;const o=D_(r.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||st(i=Object.values(oi)).call(i,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(wn.ON_DATA_STREAM,r)}catch{this.emit(wn.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const i=OT(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(qn.UID_BANNED),void this.close()):void this.reconnect(i.action,As.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",As.TIMEOUT):this.request(Gt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),oe("REPORT_STATS")&&this.send(Gt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Qt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Ht.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Qt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Qt.CLOSED,()=>{this.connectionState=fr.CLOSED}),this.websocket.on(Qt.FAILED,()=>{this._disconnectedReason=qn.NETWORK_ERROR,this.connectionState=fr.CLOSED}),this.websocket.on(Qt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===fr.CONNECTED?this.connectionState=fr.RECONNECTING:this.connectionState=fr.CONNECTING}),this.websocket.on(Qt.WILL_RECONNECT,(r,i,o)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(Qt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Ht.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Me&&r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Mt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",As.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",As.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Qt.REQUEST_NEW_URLS,(r,i)=>{Ps(this,Ht.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const oye={name:"P2PChannel",create:function(e){let{store:r,statsCollector:i}=e;return new iye(r,i)},createSubmodule:function(e){let{store:r,spec:i}=e;return new sye(i,r)}};function U$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function V$(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?U$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):U$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class aye{constructor(r){K(this,"sessionDesc",void 0),K(this,"localCapabilities",void 0),K(this,"rtpCapabilities",void 0),K(this,"candidates",void 0),K(this,"_originCandidates",void 0),K(this,"iceParameters",void 0),K(this,"dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),r=zr(r);const{iceParameters:i,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:_,cname:E}=r,S=ja(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=zr(c),this.iceParameters=i,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=E;for(let R=0;R<S.mediaDescriptions.length;R++){const P=S.mediaDescriptions[R];if(P.attributes.iceUfrag=i.iceUfrag,P.attributes.icePwd=i.icePwd,P.attributes.fingerprints=o.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(G=>G.payloadType.toString(10));let N=u.videoCodecs.filter(G=>{var F,j;return(F=G.rtpMap)===null||F===void 0?void 0:st(j=F.encodingName.toLowerCase()).call(j,_)});N.length===0&&(N=u.videoCodecs),P.attributes.payloads=N,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(N=>N.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Um(this.sessionDesc)}send(r,i,o){const{ssrcs:c,ssrcGroups:u}=z_(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(E=>r===yt.VIDEO?E.media.mediaType==="video":E.media.mediaType==="audio"),m=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:_}}batchSend(r){return r.map(i=>{let{kind:o,ssrcMsg:c}=i;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const o=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{st(r).call(r,h.attributes.label||"")?u.push(h):o.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var m;st(m=u.map(_=>_.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=c})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,o){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(r){}updateCandidates(r){const i=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(i.forEach(c=>{o.push(V$(V$({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(r){case Fs.TCP_RELAY:this.candidates=o;break;case Fs.UDP_TCP_RELAY:case Fs.RELAY:this.candidates=[...i,...o];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=zr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let o=0;o<r;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(r,i){const o=zr(r);return eS(o,i),jL(o,i),o}updateRecvMedia(r,i){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===yt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===i);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(i,o))}}mungMediaDesc(r){const i=zr(r);return FL(i),function(o){const c=o.attributes.extmaps.find(u=>hP(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const o of i.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var lr;function F$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function JP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?F$(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):F$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let cye=(lr=class $w extends qG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return st(i=Object.keys(BA)).call(i,r)}))]}constructor(r,i){super(r,i),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"statsFilter",void 0),K(this,"useRTX",!1),K(this,"localCapabilities",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"establishPromise",void 0),K(this,"mutex",void 0),this.store=i,this.mutex=new Us("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection($w.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=Zx(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,jr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Wm(r.sdp),o=DT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,JP(JP({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new Me(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new aye(JP(JP({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new Me(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var o=this;return Cl(function*(){const c=yield Nn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>o.peerConnection.addTrack(P._mediaStreamTrack)),h=yield Nn(o.peerConnection.createOffer()),m=ja(h.sdp),_=r.map(P=>{const N=P._mediaStreamTrack,G=m.mediaDescriptions.find(F=>F.attributes.mid===N.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(F,j,q){const ee=F.attributes.ssrcs.filter(Se=>Se.attributes.label===j),he=F.attributes.ssrcGroups;if(ee.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(he&&ee.length>1){const Se=he.find(we=>we.ssrcIds.indexOf(ee[0].ssrcId)!==-1);return Se?[{ssrcId:Se.ssrcIds[0],rtx:q?Se.ssrcIds[1]:void 0}]:[{ssrcId:ee[0].ssrcId}]}return[{ssrcId:ee[0].ssrcId}]}(G,N.id,o.useRTX)});let E;try{E=yield _}catch(P){throw u.forEach(N=>{Is()&&N.replaceTrack(null),o.peerConnection.removeTrack(N)}),P}const S=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,i,E);const R=o.remoteSDP.toString();return yield Nn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Nn(o.applySendEncodings(u,r)),yield Nn(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,N)=>{const G=P._mediaStreamTrack.id;return{localSSRC:_[N],id:G}})}catch(u){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{Is()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,i,c),m=new ut((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),N=G=>{const F=Dn();if((F.name==="Safari"&&Number(F.version)===11||No())&&G.track.id!==u&&G.streams[0].id===h){var j;const q=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(r,u,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S(q)}if(G.track.id===u)return this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S(G.track)};this.peerConnection.addEventListener("track",N)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const E=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(E),{track:await m,id:u}}catch(u){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(Is()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(Is()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Cl(function*(){const o=yield Nn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=jn().supportPCSetConfiguration;if(r===Fs.RELAY&&!c)return;if(c){const E=i.peerConnection.getConfiguration(),S=r===Fs.RELAY?"relay":"all";E.iceTransportPolicy!==S&&(x.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(S,"]")),E.iceTransportPolicy=S,i.peerConnection.setConfiguration(E))}r!==Fs.RELAY&&i.remoteSDP.updateCandidates(r);const u=yield Nn(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Wm(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;i.remoteSDP.restartICE(m);const _=i.remoteSDP.toString();yield Nn(i.peerConnection.setLocalDescription(u)),yield Nn(i.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){x.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Me(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new Me(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Me(te.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(vT(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...$w.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...$w.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(E=>{var S;return((S=E.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!i)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!jn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof br)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(oe("DSCP_TYPE")&&qp()){var h;const E=oe("DSCP_TYPE");st(h=["very-low","low","medium","high"]).call(h,E)&&(u.networkPriority=E)}const m=i.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m)}async applySendEncodings(r,i){try{if(!jn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){const o=ja(r);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);m&&eS(m,c)}),Um(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:_}=u;const{kind:E}=r[h];return new ut((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),N=G=>{const F=Dn();if(F.name==="Safari"&&Number(F.version)===11&&G.track.id!==m&&G.streams[0].id===_){var j;const q=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(E,m,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S({track:q,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S({track:G.track,id:m})};this.peerConnection.addEventListener("track",N)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await ut.all(i)}catch(i){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i==null?void 0:i[0].ssrcId}setConfiguration(r){if(jn().supportPCSetConfiguration){const i=$w.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},Tt(lr.prototype,"connect",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"connect"),lr.prototype),Tt(lr.prototype,"stopSending",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"stopSending"),lr.prototype),Tt(lr.prototype,"receive",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"receive"),lr.prototype),Tt(lr.prototype,"stopReceiving",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"stopReceiving"),lr.prototype),Tt(lr.prototype,"muteRemote",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"muteRemote"),lr.prototype),Tt(lr.prototype,"unmuteRemote",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"unmuteRemote"),lr.prototype),Tt(lr.prototype,"muteLocal",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"muteLocal"),lr.prototype),Tt(lr.prototype,"unmuteLocal",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"unmuteLocal"),lr.prototype),Tt(lr.prototype,"close",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"close"),lr.prototype),Tt(lr.prototype,"updateEncoderConfig",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"updateEncoderConfig"),lr.prototype),Tt(lr.prototype,"updateSendParameters",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"updateSendParameters"),lr.prototype),Tt(lr.prototype,"replaceTrack",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"replaceTrack"),lr.prototype),Tt(lr.prototype,"getRemoteSSRC",[Dl],Object.getOwnPropertyDescriptor(lr.prototype,"getRemoteSSRC"),lr.prototype),lr);function Dl(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}const lye={name:"PlanBConnection",create:function(e){let{store:r,spec:i}=e;return new cye(i,r)}},uye={interceptLocalAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(XA.has(e)||!e.track)return;const i={track:e.track};if(Kp()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(x.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=r.metadata&&r.metadata();_?function(E,S){const{chunk:R,controller:P}=S,N=oe("ENABLE_AUDIO_PTS_METADATA")?Qp.AUDIO_64_BIT_PTS:Qp.METADATA;R.data=function(G,F,j){const q=j.byteLength,ee=q+TL+NG,he=SL+bL+ee,Se=new ArrayBuffer(G.byteLength+he),we=new DataView(Se);we.setUint8(0,kG),we.setUint16(1,ee),we.setUint8(3,F),we.setUint16(4,q);for(let Ne=0;Ne<q;Ne++)we.setUint8(6+Ne,j[Ne]);const ye=new Uint8Array(we.buffer);return ye.set(new Uint8Array(G),he),ye.buffer}(R.data,N,E),P.enqueue(R)}(_,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Is()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=YA(),u=new MessageChannel;await new ut(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new ut(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;if(m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id)x.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o);else if(m.data.getMetadata){const E=r.metadata&&r.metadata();E&&u.port1.postMessage({metadata:E})}},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=XA.get(e);if(c){XA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}XA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(nP.has(e))return;const i={track:e.track,onMetadata:r.onMetadata};if(Kp()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");Lx(Gn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(x.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)),r.enableTopn?function(_,E,S){var R;const P=DG(new DataView(E.data));if(!P)return S.enqueue(E);const N=_.track.id;Gfe.set(N,_.track);const G=(R=P.tlv.find(Se=>Se.tag===Qp.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let F=0;typeof G=="number"&&(F=127-G);const j=Math.round(Math.pow(10,F/60)-1),{selected:q,speaker:ee}=function(Se,we){let ye=Kv.get(Se);if(ye||(ye=function(Ne){const Ye=new LG;return Kv.set(Ne,Ye),yd||(yd=new Wfe(oe("TOPN_SILENCE_THRESHOLD")||500),yd.on("ActiveSpeakerChanged",dt=>{dt!=null&&(ZA=dt)})),yd.addSpeakers([Ye]),Ye}(Se)),Kv.size<=MG)return{selected:!0,speaker:ye};if(!yd)throw new Error("no active speaker detector");return yd.levelChanged(ye.id,we),j_=yd.loudest.map(Ne=>Ne.id),ZA&&!st(j_).call(j_,ZA)&&j_.length>=MG&&j_.pop(),{selected:st(j_).call(j_,ye.id)||ye.id===ZA,speaker:ye}}(_,j),he=function(Se,we,ye){const Ne=Ed.get(Se)||new zfe(Se,we);return Ne.score=ye,Ed.set(Se,Ne),function(Ye){if(eP.set(Ye,!0),!tP)return void(tP=Date.now());const dt=Date.now();dt-tP>1e3&&(eP.get(Ye)?eP.set(Ye,!1):(UG(Ye),eP.delete(Ye)),tP=dt)}(Se),Ne}(N,_.track,ee.energyScore);he.addSample(q),he.active&&(E.data=P.frame.buffer,S.enqueue(E))}(e,h,m):r.enableMetadata?function(_,E,S){const R=DG(new DataView(_.data));if(!R)return E.enqueue(_);const P=R.tlv.find(N=>N.tag===Qp.METADATA||N.tag===Qp.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),_.data=R.frame.buffer,E.enqueue(_)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Is()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=YA(),u=new MessageChannel;await new ut(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new ut(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(x.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.metadata&&i.onMetadata&&i.onMetadata(m.data.metadata)},i.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=nP.get(c);if(u){(function(_){const E=Kv.get(_);E&&(Kv.delete(_),yd&&(yd.removeSpeakers([E]),Kv.size===0&&(yd.destroy(),yd=null)))})(c),UG(c.track.id),nP.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){x.warning(_&&_.message)}}}(e)}nP.set(e,i),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,r){if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(rP.has(e)||!e.track)return;const i={track:e.track};if(Kp()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,_){i.controller||(i.controller=_),e.track&&e.track.id!==i.track.id&&(x.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const E=u.shift();E&&(m.data=function(S,R){const P=function(ee){const he=ee.length;let Se=[],we=0;for(;we<he;)we+2<he&&ee[we]===0&&ee[we+1]===0&&(ee[we+2]===0||ee[we+2]===1||ee[we+2]===2||ee[we+2]===3)?(Se.push(ee[we],ee[we+1],3,ee[we+2]),we+=3):(Se.push(ee[we]),we++);return new Uint8Array(Se)}(R),N=P.length,G=Math.floor(N/255),F=N%255,j=new Uint8Array(6+G+1+N+S.byteLength);j[0]=0,j[1]=0,j[2]=0,j[3]=1,j[4]=6,j[5]=101;let q=0;for(;q<G;)j[6+q]=255,q++;return j[6+q]=F,q++,j.set(P,6+q),j.set(new Uint8Array(S),6+q+N),j.buffer}(m.data,E)),_.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Is())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=YA(),u=new MessageChannel;await new ut(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new ut(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id&&(x.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=rP.get(e);if(c){rP.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}rP.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!e.track)return;if(IT.has(e)){const c=IT.get(e);return void(c&&(c.onSei=r.onSei))}const i={track:e.track,onSei:r.onSei};if(Kp()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(x.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=function(E){const S=new DataView(E.data);let R=0;for(;R+4<E.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let P=R+6,N=0,G=0;for(;(G=S.getUint8(P++))===255;)N+=255;N+=G;const F=Hfe(E.data,P,N);return new Uint8Array(F)}R++}return null}(h);_&&i.onSei&&i.onSei(_),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Is()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=YA(),u=new MessageChannel;await new ut(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new ut(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(x.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.sei&&i.onSei&&i.onSei(m.data.sei)},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=IT.get(c);if(u){IT.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){x.warning(_&&_.message)}}})(e)}IT.set(e,i),e.track.addEventListener("ended",o)}},dye={name:"InterceptFrame",create:()=>uye};eL(),rr("PROCESS_ID","process-".concat(dr(8,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(Sr,o)){const{value:c,expires:u}=r[o];if(u&&u<=i)return;_d[o]=c,Sr[o]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(e),r.message)}}(),Array.isArray(_d.AREAS)&&_d.AREAS.length>0&&HL(_d.AREAS,!0);const j$=(e,r,i)=>{x.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(r))),rr(e,r,i)};zm(x_e,!1),zm(U_e,!1),zm(gge,!1),zm(q_e,!1),zm(k_e,!1),zm(oye,!1),zm(lye,!1),zm(dye,!1);const Ai=function(e){const r=new Mr,i=e,o={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===vh.SECURITY_POLICY_VIOLATION&&v7(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return E7(E7({},i),o)}({__TRACK_LIST__:Uv,VERSION:Rl,BUILD:rL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:j$,getParameter:oe,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let r=new RTCPeerConnection;const i=await async function(o){let c;return jn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!i)return e;r.close(),r=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(r){throw new Oe(te.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return e},checkSystemRequirements:function(){const e=At.reportApiInvoke(null,{name:Ri.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Wr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&Fx()&&B8(75)&&new u().close()}catch(u){return x.error("check system requirement failed: ",u),!1}let i=!1;const o=Dn();o.name===Gn.CHROME&&Number(o.version)>=58&&(md.engine.name!=="WebKit"||function(){const u=Dn();if(NA()){if(u.os===Ki.MAC_OS)return!0;if(u.os===Ki.IOS){const h=md.os.version&&md.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(i=!0),(o.name===Gn.FIREFOX&&Number(o.version)>=56||o.name===Gn.OPERA&&Number(o.version)>=45||o.name===Gn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(No()||gu())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||K8()||Dn().name===Gn.QQ)&&(i=!0),x.debug("checkSystemRequirements, api:",r,"browser",i);const c=r&&i;return e.onSuccess(c),c},getDevices:function(e){return Qc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Qc.getRecordingDevices(e)},getCameras:function(e){return Qc.getCamerasDevices(e)},getElectronScreenSources:BW,getPlaybackDevices:function(e){return Qc.getSpeakers(e)},createClient:function(){var e;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=dr(5,"client-"),o=At.reportApiInvoke(null,{id:i,name:Ri.CREATE_CLIENT,options:[r],tag:Wr.TRACER});try{(function(c){Bi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Bi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Bi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&ds(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&tW(c.turnServer),c.httpRetryConfig!==void 0&&eW(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&eW(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return(z8(16,0)||G8(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),rr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new _ge(wu(wu({forceWaitGatewayResponse:!0},r),{},{role:st(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=oe("CAMERA_CAPTURE_CONFIG"),i=dr(8,"track-cam-"),o=At.reportApiInvoke(null,{id:i,tag:Wr.TRACER,name:Ri.CREATE_CAM_VIDEO_TRACK,options:[Nr({},e),r]});r&&(e.encoderConfig=r);const c=KA(e);let u=null;x.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{u=(await Jc({video:c},i)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new Me(te.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(x)}e.optimizationMode&&vL(i,u,e,_h(e.encoderConfig));const h=new EL(u,e,c,e.scalabiltyMode?zA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return o.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(e){const r=dr(8,"track-cus-"),i=At.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:Ri.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),o=new br(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?zA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[hr.CUSTOM_TRACK]);return i.onSuccess(o.getTrackId()),x.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof r=="object"?function(P){return JW(P)}(r):void 0;i&&(r="auto");const o=dr(8,"track-scr-v-"),c=At.reportApiInvoke(null,{id:o,tag:Wr.TRACER,name:Ri.CREATE_SCREEN_VIDEO_TRACK,options:[Nr({},e),r]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(P){const N={};P.screenSourceType&&(N.mediaSource=P.screenSourceType),P.extensionId&&Kp()&&(N.extensionId=P.extensionId);const{displaySurface:G,selfBrowserSurface:F,surfaceSwitching:j,systemAudio:q,preferCurrentTab:ee}=P;(gT(107)||Mx(107)||Ux(93))&&(G&&(Bi(G,"displaySurface",["browser","window","monitor"]),N.displaySurface=G),F?(Bi(F,"selfBrowserSurface",["exclude","include"]),N.selfBrowserSurface=F):N.selfBrowserSurface="include",j&&(Bi(j,"surfaceSwitching",["exclude","include"]),N.surfaceSwitching=j)),(gT(105)||Mx(105)||Ux(91))&&q&&(Bi(q,"systemAudio",["exclude","include"]),N.systemAudio=q),(gT(94)||Mx(94)||Ux(80))&&ee&&(N.preferCurrentTab=!0),P.electronScreenSourceId&&(N.sourceId=P.electronScreenSourceId);const he=P.encoderConfig?cL(P.encoderConfig):null;return N.mandatory={chromeMediaSource:"desktop",maxWidth:he?he.width:void 0,maxHeight:he?he.height:void 0},he&&(he.frameRate&&(typeof he.frameRate=="number"?(N.mandatory.maxFrameRate=he.frameRate,N.mandatory.minFrameRate=he.frameRate):(N.mandatory.maxFrameRate=he.frameRate.max||he.frameRate.ideal||he.frameRate.exact||void 0,N.mandatory.minFrameRate=he.frameRate.min||he.frameRate.ideal||he.frameRate.exact||void 0),N.frameRate=he.frameRate),he.width&&(N.width=he.width),he.height&&(N.height=he.height)),N}(e);let h=null,m=null;const _=jn();if(!_.supportShareAudio&&r==="enable"){const P=new Me(te.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(x)}x.info("start create screen video track with config",e,"withAudio",r,"trackId",o);const E=_.supportShareAudio&&r!=="disable";try{const P=await Jc({screen:u,screenAudio:E?i||!0:void 0},o);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new Me(te.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(x)}if(!m&&r==="enable"){h&&h.stop();const P=new Me(te.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(x)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(vL(o,h,e,e.encoderConfig&&cL(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new br(h,e.encoderConfig?cL(e.encoderConfig):{},e.scalabiltyMode?zA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[hr.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),x.info("create screen video track success","video:",S.getTrackId()),S;const R=new qr(m,void 0,dr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=oe("CAMERA_CAPTURE_CONFIG"),o=dr(8,"track-mic-"),c=dr(8,"track-cam-"),u=At.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Wr.TRACER,name:Ri.CREATE_MIC_AND_CAM_TRACKS,options:[e,r,i]});i&&(r.encoderConfig=i);const h=KA(r),m=QW(e);let _=null,E=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(r)));try{const P=await Jc({audio:m,video:h},"".concat(o,"-").concat(c));_=P.getAudioTracks()[0],E=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!_||!E){const P=new Me(te.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(x)}r.optimizationMode&&vL(c,E,r,_h(r.encoderConfig));const S=new qA(_,e,m,o),R=new EL(E,r,h,r.scalabiltyMode?zA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=dr(8,"track-mic-"),i=At.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:Ri.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=QW(e);let c=null;x.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{c=(await Jc({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new Me(te.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(x)}const u=new qA(c,e,o,r);return i.onSuccess(u.getTrackId()),x.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(e){const r=dr(8,"track-cus-"),i=At.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:Ri.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new qr(e.mediaStreamTrack,e.encoderConfig?GA(e.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",e,"trackId",o.getTrackId()),i.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var r;const{cacheOnlineFile:i,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:i,encoderConfig:o},h=dr(8,"track-buf-"),m=At.reportApiInvoke(null,{id:h,tag:Wr.TRACER,name:Ri.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(oe("DISABLE_WEBAUDIO"))throw new Me(te.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let N=null;if(typeof R=="string"){const F=Vz.get(R);if(F)return x.debug("use cached audio resource: ",R),F;try{N=(await gd(()=>la.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new Me(te.FETCH_AUDIO_FILE_FAILED,j.toString())}}else N=await new ut((j,q)=>{const ee=new FileReader;ee.onload=he=>{he.target?j(he.target.result):q(new Me(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.onerror=()=>{q(new Me(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.readAsArrayBuffer(R)});const G=await function(F){const j=zv();return new ut((q,ee)=>{j.decodeAudioData(F,he=>{q(he)},he=>{ee(new Me(te.DECODE_AUDIO_FILE_FAILED,he.toString()))})})}(N);return typeof R=="string"&&P&&Vz.set(R,G),G}(c,i)}catch(R){return m.onError(R),R.throw(x)}const E=new Ufe(c),S=new Mfe(_,E,o?GA(o):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(e){if(x.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw x.debug("Invalid appType"),new Oe(te.INVALID_PARAMS,"invalid app type",e);rr("APP_TYPE",Math.floor(e))},setLogLevel:function(e){x.setLogLevel(e)},enableLogUpload:function(){oe("USE_NEW_LOG")?rr("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){oe("USE_NEW_LOG")?rr("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new V9},checkAudioTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=At.reportApiInvoke(null,{tag:Wr.TRACER,name:Ri.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof qr||e instanceof $v)){const _=new Oe(te.INVALID_TRACK,"the parameter is not a audio track");return i.onError(_),_.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof qr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const m=Date.now();return new ut(_=>{const E=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const R=u-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(E);const N=R,G={duration:P,deviceLabel:o,maxVolumeLevel:u,result:N};x.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),i.onSuccess(G),_(N)}},200)})},checkVideoTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=At.reportApiInvoke(null,{tag:Wr.TRACER,name:Ri.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof br||e instanceof Hv)){const R=new Oe(te.INVALID_TRACK,"the parameter is not a video track");return i.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof br?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Is()||NA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,_=0;try{const R=Date.now();m=await function(P,N,G,F){let j,q=0,ee=null;return new ut((he,Se)=>{function we(){q>F&&j&&(j(),he(q));const ye=G.getContext("2d");if(!ye){const dt=new Oe(te.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(dt.toString()),void Se(dt)}ye.drawImage(P,0,0,160,120);const Ne=ye.getImageData(0,0,G.width,G.height),Ye=Math.floor(Ne.data.length/3);if(ee){for(let dt=0;dt<Ye;dt+=3)if(Ne.data[dt]!==ee[dt])return q+=1,void(ee=Ne.data);ee=Ne.data}else ee=Ne.data}setTimeout(()=>{j&&(j(),he(q))},N),j=pL(()=>{we()},30)})}(u,r,h,4),_=Date.now()-R}catch(R){throw i.onError(R),R}nge===Gn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const E=m>4,S={duration:_,changedPicNum:m,deviceLabel:o,result:E};return x.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),i.onSuccess(S),E},setArea:HL,audioElementPlayCenter:ua,resumeAudioContext:function(){ua.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Ege.processExternalMediaAEC(e)},registerExtensions:function(e){const r=oe("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!st(r).call(r,i.name)&&r.push(i.name);const o=i;o.__registered__=!0,o.logger.hookLog=x.extLog,o.reporter.hookApiInvoke=At.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=oe(c)})}),j$("PLUGIN_INFO",r)},ChannelMediaRelayError:Yv,ChannelMediaRelayEvent:ef,ChannelMediaRelayState:Ba,RemoteStreamFallbackType:Pfe,RemoteStreamType:Afe,ConnectionDisconnectedReason:qn,AudienceLatencyLevelType:sfe,AREAS:Hn,preload:async function(e,r,i,o){return dH(e,r,i,o)}});return Object.defineProperties(Ai,{onAudioAutoplayFailed:{get:()=>Zc.onAudioAutoplayFailed,set:e=>{Zc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Zc.onAutoplayFailed,set:e=>{Zc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ai._onSecurityPolicyViolation,set(e){Ai._onSecurityPolicyViolation=e,v7(e)}},__CLIENT_LIST__:{get:()=>oe("SHOW_GLOBAL_CLIENT_LIST")?B_:[]}}),Qc.on(U_.CAMERA_DEVICE_CHANGED,e=>{x.info("camera device changed",JSON.stringify(e)),Ai.onCameraChanged&&Ai.onCameraChanged(e),Ai.safeEmit(vh.CAMERA_CHANGED,e)}),Qc.on(U_.RECORDING_DEVICE_CHANGED,e=>{x.info("microphone device changed",JSON.stringify(e)),Ai.onMicrophoneChanged&&Ai.onMicrophoneChanged(e),Ai.safeEmit(vh.MICROPHONE_CHANGED,e)}),Qc.on(U_.PLAYOUT_DEVICE_CHANGED,e=>{x.debug("playout device changed",JSON.stringify(e)),Ai.onPlaybackDeviceChanged&&Ai.onPlaybackDeviceChanged(e),Ai.safeEmit(vh.PLAYBACK_DEVICE_CHANGED,e)}),ua.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),Zc.onAudioAutoplayFailed&&Zc.onAudioAutoplayFailed()},ir.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),Zc.onAudioAutoplayFailed&&Zc.onAudioAutoplayFailed(),Ai.safeEmit(vh.AUTOPLAY_FAILED)}),ir.on(fs.STATE_CHANGE,(e,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(e)),Ai.onAudioContextStateChanged&&Ai.onAudioContextStateChanged(e,r),Ai.safeEmit(vh.AUDIO_CONTEXT_STATE_CHANGED,e,r)}),_i.on(kv.NETWORK_STATE_CHANGE,(e,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(e))}),window&&(window.__ARTC__=Ai),Ai})}(gk)),gk.exports}var fWe=pWe();const jC=Ng(fWe),mWe="9442a472625f44e7b2c5065b9f9b3988",gWe=jC.createClient({mode:"rtc",codec:"vp8"});let Iw=null;const woe=D.createContext(null),Coe=({children:n,appId:t=mWe,channel:s=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:f=!0,onClientReady:y=()=>{}})=>{const[v,b]=D.useState(!1),[w,I]=D.useState(!1),[k,L]=D.useState([]),[V,B]=D.useState(null),[W,Q]=D.useState(null),[$,ie]=D.useState(null),[ce,ne]=D.useState(!1),[de,Y]=D.useState(!1),[X,Z]=D.useState(!1),[se,me]=D.useState(null),[pe,ue]=D.useState(!1),Le=hl(),We=D.useRef(gWe),$e=D.useRef({appId:t,channel:s,uid:l,enabled:d}),ve=D.useRef(!1),_e=D.useRef(null);D.useRef(null),D.useEffect(()=>{$e.current={appId:t,channel:s,uid:l,enabled:d}},[t,s,l,d]),D.useEffect(()=>{Q(s)},[s]),D.useEffect(()=>{if(!We.current)return;const Ze=lt=>{J.log(`Connection state changed to: ${lt}`),lt==="DISCONNECTED"?(b(!1),J.log("Disconnected from Agora")):lt==="CONNECTED"&&(b(!0),B(null))};return We.current.on("connection-state-change",Ze),()=>{We.current.off("connection-state-change",Ze)}},[]),D.useEffect(()=>{if(!s||!d)return;const Ze=async(Ft,on)=>{J.log(`User published: ${Ft.uid}, mediaType: ${on}`);try{await We.current.subscribe(Ft,on),on==="audio"&&Ft.audioTrack.play(),L(Zt=>Zt.some(Yt=>Yt.uid===Ft.uid)?Zt:[...Zt,Ft])}catch(Zt){J.error("Error subscribing to user:",Zt)}},lt=(Ft,on)=>{J.log(`User unpublished: ${Ft.uid}, mediaType: ${on}`),on==="audio"&&Ft.audioTrack&&Ft.audioTrack.stop()},nt=Ft=>{J.log(`User joined: ${Ft.uid}`),L(on=>on.some(Zt=>Zt.uid===Ft.uid)?on:[...on,Ft])},Rt=Ft=>{J.log(`User left: ${Ft.uid}`),L(on=>on.filter(Zt=>Zt.uid!==Ft.uid))};return We.current.on("user-published",Ze),We.current.on("user-unpublished",lt),We.current.on("user-joined",nt),We.current.on("user-left",Rt),(async()=>{if(ve.current){J.log("Already initializing, skipping duplicate initialization");return}ve.current=!0;try{if(v&&_e.current===s){J.log(`Already joined to channel ${s}`),ne(!0),y(We.current);return}if(We.current.connectionState==="CONNECTING"||We.current.connectionState==="CONNECTED")if(_e.current&&_e.current!==s){J.log("Connected to different channel, leaving first");try{await Te()}catch(Ft){J.error("Error leaving channel:",Ft)}}else{b(!0),ne(!0),_e.current=s,Iw=s,y(We.current);return}J.log(`Joining channel ${s}`),await ke(),J.log("Join channel completed")}catch(Ft){J.error("Error during initialization:",Ft)}finally{ve.current=!1}})(),()=>{J.log("Cleaning up event listeners"),We.current.off("user-published",Ze),We.current.off("user-unpublished",lt),We.current.off("user-joined",nt),We.current.off("user-left",Rt)}},[s,d,l,y,v]);const Ee=async()=>{if(!d||$)return $;J.log("Initializing microphone");try{const Ze=await jC.createMicrophoneAudioTrack();return await Ze.setMuted(f),ie(Ze),J.log("Microphone initialized successfully"),Ze}catch(Ze){return J.error("Error initializing microphone:",Ze),B("Failed to initialize microphone. Please check your permissions."),null}};D.useEffect(()=>{(async()=>{if(s)try{const Rt=await Nf(s);Rt&&Rt.voiceDisabled?(J.log("Voice is disabled for this space"),ue(!0),v&&await Te()):ue(!1)}catch(nt){J.error("Error checking if voice is disabled:",nt)}})();const lt=nt=>{nt.detail&&typeof nt.detail.voiceDisabled=="boolean"&&(J.log("Voice setting changed:",nt.detail.voiceDisabled),ue(nt.detail.voiceDisabled),nt.detail.voiceDisabled&&v?Te():!nt.detail.voiceDisabled&&!v&&d&&s&&ke())};return window.addEventListener("SpaceVoiceSettingChanged",lt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",lt)}},[s,v,d]);const ke=async()=>{if(!d)return J.log("Agora is disabled, not joining channel"),!1;if(pe)return J.log("Voice is disabled for this space, not joining channel"),B("Voice chat is disabled for this space"),!1;if(!s)return J.error("AgoraProvider: No channel specified"),B("No channel specified"),!1;if(J.log(`joinChannel called for channel ${s} with UID ${l}`),J.log("Current state:",{isJoined:v,isJoining:de,connectionState:We.current.connectionState,joinedChannel:_e.current}),v&&_e.current===s)return J.log(`Already joined to channel: ${s}`),!0;if(de)return J.log("AgoraProvider: Already in the process of joining"),!1;if(We.current.connectionState==="CONNECTED")if(_e.current&&_e.current!==s){J.log("Connected to different channel, leaving first");try{await Te()}catch(Ze){J.error("Error leaving channel:",Ze)}}else return J.log("Client already connected, setting joined state to true"),b(!0),ne(!0),_e.current=s,Iw=s,y(We.current),!0;if(We.current.connectionState==="CONNECTING")return J.log("Client already connecting, waiting for connection"),Y(!0),new Promise(Ze=>{const lt=setInterval(()=>{We.current.connectionState==="CONNECTED"&&(clearInterval(lt),b(!0),Y(!1),ne(!0),_e.current=s,Iw=s,y(We.current),Ze(!0))},500);setTimeout(()=>{clearInterval(lt),J.log("AgoraProvider: Connection timeout, considering join failed"),Y(!1),Ze(!1)},1e4)});try{if(J.log(`Joining channel: ${s} with UID: ${l||"random"}`),J.log(`Using appId: ${t}, Type: ${typeof t}, Length: ${t.length}`),!t||t.trim()===""){const lt="AgoraProvider: App ID is empty or invalid";return J.error(lt),B(lt),Y(!1),!1}Y(!0);const Ze=l||Math.floor(Math.random()*1e6);return await We.current.join(t,s,a,Ze),J.log(`Joined channel successfully with UID: ${We.current.uid}`),b(!0),Y(!1),ne(!0),_e.current=s,Iw=s,y(We.current),!0}catch(Ze){return J.error("Error joining channel:",Ze),B(`Error joining channel: ${Ze.toString()}`),Y(!1),!1}},Te=async()=>{if(v)try{$&&await We.current.unpublish($),await We.current.leave(),Iw=null,_e.current=null,J.log("Left channel successfully"),b(!1),L([])}catch(Ze){J.error("Error leaving channel:",Ze),B(Ze.message||"Failed to leave channel")}};D.useEffect(()=>()=>{$&&$.close()},[]),D.useEffect(()=>{d&&s&&(!v||_e.current!==s)&&ke()},[d,s,v]);const be=()=>{if(!$)return!1;try{return $.isActive&&!$.muted}catch(Ze){return J.error("Error checking microphone status:",Ze),!1}};D.useEffect(()=>{const Ze=()=>{const nt=be();nt!==w&&(J.log("Syncing microphone state:",{actualStatus:nt,currentState:w}),I(nt),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:nt}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=nt,window.agoraClient.microphoneTrack=$))};$&&Ze();const lt=setInterval(Ze,1e3);return()=>{clearInterval(lt)}},[$,w]);const Pe=async()=>{var Ze;if(pe)return J.log("Voice is disabled for this space, cannot toggle"),Le({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const lt=w!==void 0?w:$?!$.muted:!1;if(J.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:w,currentState:lt,hasMicTrack:!!$,trackMuted:$==null?void 0:$.muted}),!$&&(J.log("AgoraProvider: No microphone track, initializing..."),!await Ee()))return J.error("AgoraProvider: Failed to initialize microphone"),lt;const nt=!lt;if(J.log("AgoraProvider: New voice state will be:",nt),lt){if($)try{J.log("AgoraProvider: Muting microphone track"),await $.setMuted(!0),$.muted||(J.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await $.setEnabled(!1)),J.log("AgoraProvider: Microphone track muted successfully, muted state:",$.muted)}catch(Rt){return J.error("Error muting track:",Rt),lt}}else if($)try{We.current&&v&&!((Ze=We.current.localTracks)!=null&&Ze.includes($))&&(J.log("AgoraProvider: Publishing microphone track"),await We.current.publish($),J.log("AgoraProvider: Microphone track published successfully")),J.log("AgoraProvider: Unmuting microphone track"),await $.setMuted(!1),$.muted&&(J.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await $.setEnabled(!0)),J.log("AgoraProvider: Microphone track unmuted successfully, muted state:",$.muted)}catch(Rt){return J.error("Error unmuting track:",Rt),lt}return I(nt),nt}catch(lt){return J.error("Error toggling voice:",lt),w}},xe=async Ze=>{try{ie(Ze),J.log("Microphone track updated successfully")}catch(lt){throw J.error("Error updating microphone track:",lt),lt}},ze=async()=>{if(!We.current||!s)return J.error("AgoraProvider: Voice chat not connected"),!1;try{if(X)return J.log("AgoraProvider: Stopping screen share"),se&&(Array.isArray(se)?(await We.current.unpublish(se),se.forEach(Ze=>Ze.close())):(await We.current.unpublish(se),se.close()),me(null)),Z(!1),J.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;J.log("AgoraProvider: Starting screen share");try{const Ze=await jC.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return J.log("AgoraProvider: Screen track created:",Ze),Ze.on("track-ended",()=>{J.log("AgoraProvider: Screen sharing ended by browser UI"),We.current.unpublish(Ze),Ze.close(),me(null),Z(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await We.current.publish(Ze),me(Ze),Z(!0),J.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=Ze,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(Ze){return J.error("AgoraProvider: Error creating screen track:",Ze),Z(!1),me(null),!1}}catch(Ze){return J.error("AgoraProvider: Error toggling screen share:",Ze),Z(!1),me(null),!1}};D.useEffect(()=>{if(J.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:We.current,isScreenSharing:!1,screenTrack:null};const Ze=nt=>{J.log("AgoraProvider: Received ToggleScreenShare event"),ze().then(Rt=>{nt.detail&&nt.detail.callback&&nt.detail.callback(!0,Rt)}).catch(Rt=>{J.error("AgoraProvider: Error handling ToggleScreenShare event:",Rt),nt.detail&&nt.detail.callback&&nt.detail.callback(!1,X)})},lt=nt=>{J.log("AgoraProvider: Received JoinVoiceChat event"),ke().then(Rt=>{nt.detail&&nt.detail.callback&&nt.detail.callback(Rt)}).catch(Rt=>{J.error("AgoraProvider: Error handling JoinVoiceChat event:",Rt),nt.detail&&nt.detail.callback&&nt.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",Ze),window.addEventListener("JoinVoiceChat",lt),()=>{window.removeEventListener("ToggleScreenShare",Ze),window.removeEventListener("JoinVoiceChat",lt),typeof window<"u"&&window.agoraClient&&(J.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(J.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),D.useEffect(()=>{J.log("AgoraProvider: Voice enabled state changed:",w),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=w,window.agoraClient.microphoneTrack=$,window.agoraClient.client=We.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:w}})),J.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:w}))},[w,$]);const Je={client:We.current,isJoined:v,isVoiceEnabled:w,users:k,error:V,channel:W,appId:t,toggleVoice:Pe,leaveChannel:Te,joinChannel:ke,microphoneTrack:$,isReady:ce,createMicrophoneTrack:xe,isScreenSharing:X,screenTrack:se,toggleScreenShare:ze,voiceDisabled:pe};return C.jsx(woe.Provider,{value:Je,children:n})},Roe=()=>{const n=D.useContext(woe);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};Coe.propTypes={children:vn.node.isRequired,appId:vn.string.isRequired,channel:vn.string.isRequired,token:vn.string,uid:vn.oneOfType([vn.string,vn.number])};const _We=()=>{var ve,_e;const{client:n,isVoiceEnabled:t,isJoined:s,users:a,error:l,microphoneTrack:d,isReady:f,channel:y,appId:v,toggleVoice:b,joinChannel:w,leaveChannel:I,createMicrophoneTrack:k,isScreenSharing:L,screenTrack:V,toggleScreenShare:B,voiceDisabled:W}=Roe(),[Q,$]=D.useState(t!==void 0?t:((ve=window.agoraClient)==null?void 0:ve.isVoiceEnabled)||!1),[ie,ce]=D.useState(L!==void 0?L:((_e=window.agoraClient)==null?void 0:_e.isScreenSharing)||!1),[ne,de]=D.useState(W!==void 0?W:!1),[Y,X]=D.useState(!0);D.useEffect(()=>{var Ee;t!==void 0?$(t):((Ee=window.agoraClient)==null?void 0:Ee.isVoiceEnabled)!==void 0?$(window.agoraClient.isVoiceEnabled):d&&$(!d.muted)},[t,d]),D.useEffect(()=>{var Ee;L!==void 0?ce(L):((Ee=window.agoraClient)==null?void 0:Ee.isScreenSharing)!==void 0&&ce(window.agoraClient.isScreenSharing)},[L]),D.useEffect(()=>{W!==void 0&&de(W)},[W]);const Z=D.useRef({isVoiceEnabled:Q,isScreenSharing:ie,isJoined:s,users:a,error:l,isReady:f,channel:y,appId:v,voiceDisabled:ne});D.useEffect(()=>{Z.current={isVoiceEnabled:Q,isScreenSharing:ie,isJoined:s,users:a,error:l,isReady:f,channel:y,appId:v,voiceDisabled:ne}},[Q,ie,s,a,l,f,y,v,ne]),D.useEffect(()=>{const Ee=setTimeout(()=>{X(!1)},5e3);return()=>clearTimeout(Ee)},[]),D.useEffect(()=>{f&&X(!1)},[f]),D.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:Q,contextIsScreenSharing:L,localScreenSharing:ie,isJoined:s,users:a.length,error:l,isReady:f,channel:y,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!V})},[t,Q,L,ie,s,a,l,f,y,v,d,V]);const se=async()=>{try{console.log("useVoiceChat: Toggling voice from:",Q);const Ee=await b();if(console.log("useVoiceChat: Toggle result:",Ee),Ee!==void 0)$(Ee);else{const ke=!Q;$(ke),window.agoraClient&&(window.agoraClient.isVoiceEnabled=ke)}return Ee!==void 0?Ee:!Q}catch(Ee){return console.error("useVoiceChat: Error toggling voice:",Ee),Q}},me=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",ie);const Ee=await B();if(console.log("useVoiceChat: Screen share toggle result:",Ee),Ee!==void 0)ce(Ee);else{const ke=!ie;ce(ke),window.agoraClient&&(window.agoraClient.isScreenSharing=ke)}return Ee!==void 0?Ee:!ie}catch(Ee){return console.error("useVoiceChat: Error toggling screen share:",Ee),ie}},pe=async()=>{Q&&d&&await se()},ue=async()=>{!Q&&d&&await se()},Le=Ee=>a.some(ke=>{var Te;return ke.uid===Ee&&((Te=ke.audioTrack)==null?void 0:Te.isPlaying)}),We=D.useCallback(()=>{if(!d||!Q)return 0;try{return d.getVolumeLevel()}catch(Ee){return console.error("Error getting volume level:",Ee),0}},[d,Q]);return{isVoiceEnabled:Q,isScreenSharing:ie,isJoined:s,users:a,error:l,toggleVoice:se,toggleScreenShare:me,mute:pe,unmute:ue,isUserSpeaking:Le,getVolumeLevel:We,microphoneTrack:d,screenTrack:V,isLoading:Y,channel:y,appId:v,joinChannel:w,leaveChannel:I,client:n,setMicrophoneDevice:async Ee=>{try{if(!Ee){console.error("No device ID provided");return}if(!n||!s){console.error("Client not initialized or not joined to a channel");return}d&&(Q&&await n.unpublish(d),await d.close());const ke=await jC.createMicrophoneAudioTrack({microphoneId:Ee,encoderConfig:"music_standard"});k&&await k(ke),Q&&await n.publish(ke),console.log("Microphone device changed successfully")}catch(ke){throw console.error("Error changing microphone device:",ke),ke}},voiceDisabled:ne}},yWe=({size:n="md",tooltipPlacement:t="top",defaultMuted:s=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:f,isJoined:y,joinChannel:v,channel:b,client:w,voiceDisabled:I}=_We(),[k,L]=D.useState(!1),[V,B]=D.useState(!1);D.useEffect(()=>{const $=()=>{J.log("VoiceButton: Player instantiated, showing button"),B(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(J.log("VoiceButton: Player was already instantiated"),B(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]),D.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:y,channel:b,hasClient:!!w,clientState:w==null?void 0:w.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:V,voiceDisabled:I})},[d,y,b,w,V,I]);const W=async()=>{if(!(k||I)){L(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:y});try{if(!y&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(ie){ie.message&&ie.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",ie)}console.log("VoiceButton: Toggling voice state from:",d);const $=await f();console.log("VoiceButton: Voice toggled, new state:",$)}catch($){console.error("VoiceButton: Error toggling voice:",$)}finally{L(!1)}}},Q=()=>I?"Voice chat is disabled for this space":V?k?"Processing...":y?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!V||I?null:C.jsx(Pf,{label:Q(),placement:t,hasArrow:!0,children:C.jsxs(St,{position:"relative",cursor:"pointer",onClick:W,children:[C.jsx(sp,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?C.jsx(JV,{color:"white"}):C.jsx(XV,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),k&&C.jsx(St,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:C.jsx(cp,{size:"sm",color:"white"})})]})})},EWe=di.createContext({user:null}),vWe=({userNickname:n})=>{const{client:t,channel:s,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=Roe(),[f,y]=D.useState([]),[v,b]=D.useState(!1),[w,I]=D.useState(!0);D.useRef({});const k=D.useRef(null);D.useRef(null);const{user:L}=D.useContext(EWe)||{user:null},[V,B]=D.useState({}),W=D.useRef(a),[Q,$]=D.useState(null),{isOpen:ie,onOpen:ce,onClose:ne}=Df(),[de,Y]=D.useState(!1),X=D.useRef(null),Z=D.useRef(null);D.useEffect(()=>{W.current=a},[a]),D.useEffect(()=>{if(!t||!s){b(!1);return}const Le=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",s);const We=t.connectionState;if(console.log("Current connection state:",We),We==="CONNECTED")b(!0),I(!1);else{b(!1);const $e=ve=>{console.log("Connection state changed:",ve),ve==="CONNECTED"?(b(!0),I(!1)):b(!1)};return t.on("connection-state-change",$e),()=>{t.off("connection-state-change",$e),clearTimeout(Le)}}return()=>{clearTimeout(Le)}},[t,s]),D.useEffect(()=>{const Le=async()=>{const We={...V};let $e=!1;for(const ve of f){if(V[ve.uid])continue;let _e=null,Ee=ve.uid;if(typeof Ee=="string"&&(Ee.includes("-")?(_e=Ee.split("-")[0],Ee=Ee.split("-")[1]):Ee.includes("_")&&(_e=Ee.split("_")[0],Ee=Ee.split("_")[1])),Ee)try{console.log("Trying to fetch nickname for user ID:",Ee);const ke=await Fu(Ee);ke&&ke.Nickname?(console.log("Found nickname in Firebase for user ID:",Ee,"Nickname:",ke.Nickname),We[ve.uid]=ke.Nickname,$e=!0):_e?(console.log("Using extracted name for user ID:",Ee,"Name:",_e),We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}catch(ke){console.error("Error fetching user profile:",ke),_e?(We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}else _e?(We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}$e&&B(We)};f.length>0&&Le()},[f,V]),D.useEffect(()=>{if(!t||!s||!v)return;console.log("Setting up screen share event handlers");const Le=async(ve,_e)=>{if(console.log("User published:",ve.uid,_e,ve),_e==="video"){console.log("Remote video track detected:",ve.uid);try{await t.subscribe(ve,_e),console.log("Subscribed to remote video track:",ve.uid),y(Ee=>Ee.some(ke=>ke.uid===ve.uid)?Ee:[...Ee,ve])}catch(Ee){console.error("Error subscribing to remote video track:",Ee)}}},We=(ve,_e)=>{if(console.log("User unpublished:",ve.uid,_e),_e==="video"){if(console.log("Remote video track unpublished:",ve.uid),ve.videoTrack)try{ve.videoTrack.stop()}catch(Ee){console.error("Error stopping video track:",Ee)}if(y(Ee=>Ee.filter(ke=>ke.uid!==ve.uid)),l&&W.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),W.current.play(k.current)}catch(Ee){console.error("Error replaying local screen track:",Ee)}}},$e=ve=>{console.log("User left:",ve.uid);const _e=f.find(Ee=>Ee.uid===ve.uid);if(_e&&_e.videoTrack)try{_e.videoTrack.stop()}catch(Ee){console.error("Error stopping video track:",Ee)}if(y(Ee=>Ee.filter(ke=>ke.uid!==ve.uid)),l&&W.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user left"),W.current.play(k.current)}catch(Ee){console.error("Error replaying local screen track:",Ee)}};return t.on("user-published",Le),t.on("user-unpublished",We),t.on("user-left",$e),()=>{t.off("user-published",Le),t.off("user-unpublished",We),t.off("user-left",$e)}},[t,s,v,f,l]),D.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(Le=>{if(Le.videoTrack)try{console.log("Playing video track for:",Le.uid),Le.videoTrack.play(`video-container-${Le.uid}`)}catch(We){console.error("Error playing video track:",We)}}),l&&W.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),W.current.play(k.current)}catch(Le){console.error("Error replaying local screen track:",Le)}},[f,l]),D.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&k.current)try{console.log("Playing local screen track"),a.play(k.current)}catch(Le){console.error("Error playing local screen track:",Le)}},[l,a]),D.useEffect(()=>()=>{if(f.forEach(Le=>{if(Le.videoTrack)try{Le.videoTrack.stop()}catch(We){console.error("Error stopping video track on unmount:",We)}}),a)try{a.stop()}catch(Le){console.error("Error stopping local screen track on unmount:",Le)}},[f,a]);const se=()=>{console.log("Stopping local screen share"),d()},me=Le=>(console.log("Getting display name for UID:",Le,"type:",typeof Le),l&&L&&(Le===L.uid||Le===(t==null?void 0:t.uid))?n||"You":V[Le]?V[Le]:typeof Le=="string"?Le.includes("-")?Le.split("-")[0]:Le.includes("_")?Le.split("_")[0]:Le:"User"),pe=Le=>{console.log("Opening modal for remote screen",Le),$(Le),ce()},ue=()=>{console.log("Opening modal for local screen"),$({isLocal:!0}),ce()};return D.useEffect(()=>{ie&&Q?(console.log("Modal opened, activeScreen:",Q),setTimeout(()=>{if(Q.isLocal&&W.current)try{console.log("Playing local screen in modal"),W.current.play("modal-screen-container"),Y(!0)}catch(Le){console.error("Error playing local screen in modal:",Le)}else if(Q.videoTrack)try{console.log("Playing remote screen in modal"),Q.videoTrack.play("modal-screen-container"),Y(!0)}catch(Le){console.error("Error playing remote screen in modal:",Le)}},500)):ie||(Y(!1),$(null),setTimeout(()=>{if(l&&W.current)try{W.current.play("local-screen-container")}catch(Le){console.error("Error playing local screen in small container:",Le)}f.forEach(Le=>{if(Le.videoTrack)try{Le.videoTrack.play(`video-container-${Le.uid}`)}catch(We){console.error(`Error playing remote screen ${Le.uid} in small container:`,We)}})},500))},[ie,Q,l,f]),!v||w&&f.length===0&&!l||f.length===0&&!l?null:C.jsxs(C.Fragment,{children:[!ie&&C.jsxs(St,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:X,children:[l&&a&&C.jsxs(St,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:ue,children:[C.jsx(St,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),C.jsx(St,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(Le=>{const We=V[Le.uid]||me(Le.uid);return C.jsxs(St,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>pe(Le),children:[C.jsx(St,{id:`video-container-${Le.uid}`,width:"100%",height:"100%",position:"relative"}),C.jsx(St,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${We}'s Screen`})]},Le.uid)})]}),ie&&C.jsx(St,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:ne,children:C.jsxs(St,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Le=>Le.stopPropagation(),children:[!de&&C.jsxs(St,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[C.jsx(cp,{size:"xl"}),C.jsx(at,{mt:4,children:"Loading screen share..."})]}),C.jsx(St,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:Z}),C.jsx(St,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:ne,children:""}),C.jsx(St,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:Q!=null&&Q.isLocal?n?`${n}'s Screen`:"Your Screen":`${V[Q==null?void 0:Q.uid]||me(Q==null?void 0:Q.uid)}'s Screen`}),(Q==null?void 0:Q.isLocal)&&C.jsx(St,{position:"absolute",bottom:4,right:4,children:C.jsx(Lr,{colorScheme:"red",size:"sm",onClick:se,children:"Stop Sharing"})})]})})]})},SWe=({onClose:n})=>{const t=hl(),[s,a]=D.useState(!1),[l,d]=D.useState(!1);D.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const b=setInterval(v,1e3),w=()=>{v()};return window.addEventListener("ScreenShareToggled",w),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",w)}},[]);const f=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)y();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:w=>{if(!w){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}y()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),t({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},y=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,w)=>{a(!1),b?(d(w),t(w?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),t({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return C.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:s?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function bWe({open:n,onClose:t}){const[s,a]=D.useState(0);return C.jsxs(Bo,{isOpen:n,onClose:t,size:"md",isCentered:!0,children:[C.jsx(Go,{backdropFilter:"blur(4px)"}),C.jsxs(Wo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[C.jsx(wc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),C.jsx(ba,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(zo,{p:0,display:"flex",children:C.jsxs(E0,{orientation:"vertical",variant:"unstyled",index:s,onChange:a,display:"flex",flexGrow:1,children:[C.jsxs(v0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[C.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(yn,{as:Y8e,mb:1}),C.jsx(at,{fontSize:"xs",children:"Movement"})]}),C.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(yn,{as:X8e,mb:1}),C.jsx(at,{fontSize:"xs",children:"Camera"})]}),C.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(yn,{as:K8e,mb:1}),C.jsx(at,{fontSize:"xs",children:"Actions"})]}),C.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(yn,{as:q8e,mb:1}),C.jsx(at,{fontSize:"xs",children:"Tips"})]})]}),C.jsxs(kC,{flexGrow:1,display:"flex",flexDirection:"column",children:[C.jsxs(Ec,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),C.jsxs(Wi,{wrap:"wrap",gap:3,children:[C.jsx(Ll,{keyLabel:"W",description:"Move Forward"}),C.jsx(Ll,{keyLabel:"A",description:"Move Left"}),C.jsx(Ll,{keyLabel:"S",description:"Move Backward"}),C.jsx(Ll,{keyLabel:"D",description:"Move Right"}),C.jsx(Ll,{keyLabel:"Shift",description:"Run"}),C.jsx(Ll,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),C.jsxs(Ec,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),C.jsxs(Wi,{wrap:"wrap",gap:3,children:[C.jsx(Ll,{keyLabel:"Mouse",description:"Look Around"}),C.jsx(Ll,{keyLabel:"Click + Drag",description:"Rotate Camera"}),C.jsx(Ll,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),C.jsxs(Ec,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),C.jsxs(Wi,{wrap:"wrap",gap:3,children:[C.jsx(Ll,{keyLabel:"E",description:"Interact"}),C.jsx(Ll,{keyLabel:"F",description:"Emote Menu"}),C.jsx(Ll,{keyLabel:"T",description:"Chat"}),C.jsx(Ll,{keyLabel:"M",description:"Mute Mic"})]})]}),C.jsxs(Ec,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),C.jsxs(Ui,{align:"stretch",spacing:2,children:[C.jsx(at,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),C.jsx(at,{fontSize:"xs",children:" Press ESC to access settings"}),C.jsx(at,{fontSize:"xs",children:" Click on players to view their profile"}),C.jsx(at,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Ll=({keyLabel:n,description:t})=>C.jsx(St,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:C.jsxs(ui,{spacing:2,children:[C.jsx(St,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),C.jsx(at,{fontSize:"xs",children:t})]})}),TWe=()=>{const[n,t]=D.useState([]),[s,a]=D.useState(""),[l,d]=D.useState(0),[f,y]=D.useState(100),[v,b]=D.useState(100),[w,I]=D.useState(!0),[k,L]=D.useState(!0),[V,B]=D.useState(!1);D.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const ne=await jC.getMicrophones();t(ne),ne.length>0&&a(ne[0].deviceId)}catch(ne){console.error("Error getting audio devices:",ne)}})()},[]),D.useEffect(()=>{const ce=setInterval(()=>{d(V?Math.random()*50:0)},100);return()=>clearInterval(ce)},[V]);const W=ce=>{const ne=ce.target.value;a(ne),console.log("Microphone changed to:",ne)},Q=ce=>{y(ce),console.log("Microphone volume set to:",ce)},$=ce=>{b(ce),console.log("Speaker volume set to:",ce)},ie=()=>{B(!V)};return C.jsxs(Ui,{spacing:6,align:"stretch",children:[C.jsxs(hi,{children:[C.jsxs(Zs,{children:["Microphone",C.jsx(vf,{ml:2,colorScheme:V?"green":"red",children:V?"Enabled":"Muted"})]}),C.jsxs(jne,{value:s,onChange:W,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(ce=>C.jsx("option",{value:ce.deviceId,children:ce.label||`Microphone ${ce.deviceId.slice(0,5)}...`},ce.deviceId)),n.length===0&&C.jsx("option",{value:"",children:"No microphones found"})]})]}),C.jsxs(St,{children:[C.jsx(at,{mb:2,children:"Microphone Level"}),C.jsx(Py,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),C.jsxs(hi,{children:[C.jsxs(Zs,{children:["Microphone Volume: ",f,"%"]}),C.jsxs(aV,{value:f,onChange:Q,min:0,max:100,step:1,colorScheme:"blue",children:[C.jsx(lV,{bg:"gray.700",children:C.jsx(uV,{})}),C.jsx(cV,{boxSize:6})]})]}),C.jsxs(hi,{children:[C.jsxs(Zs,{children:["Speaker Volume: ",v,"%"]}),C.jsxs(aV,{value:v,onChange:$,min:0,max:100,step:1,colorScheme:"blue",children:[C.jsx(lV,{bg:"gray.700",children:C.jsx(uV,{})}),C.jsx(cV,{boxSize:6})]})]}),C.jsxs(hi,{display:"flex",alignItems:"center",children:[C.jsx(Zs,{mb:"0",children:"Microphone Enabled"}),C.jsx(Zh,{isChecked:V,onChange:ie,colorScheme:"green",size:"lg"})]}),C.jsxs(hi,{display:"flex",alignItems:"center",children:[C.jsx(Zs,{mb:"0",children:"Echo Cancellation"}),C.jsx(Zh,{isChecked:w,onChange:()=>I(!w),colorScheme:"green",size:"lg"})]}),C.jsxs(hi,{display:"flex",alignItems:"center",children:[C.jsx(Zs,{mb:"0",children:"Noise Suppression"}),C.jsx(Zh,{isChecked:k,onChange:()=>L(!k),colorScheme:"green",size:"lg"})]}),C.jsxs(yf,{status:"info",borderRadius:"md",children:[C.jsx(Ef,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function wWe({open:n,onClose:t,containerRef:s}){return C.jsx(Bu,{containerRef:s,children:C.jsxs(Bo,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[C.jsx(Go,{}),C.jsxs(Wo,{bg:"gray.900",color:"white",borderRadius:"lg",children:[C.jsx(wc,{children:"Settings"}),C.jsx(ba,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),C.jsx(zo,{children:C.jsxs(E0,{variant:"enclosed",children:[C.jsxs(v0,{mb:4,children:[C.jsx(ya,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),C.jsx(ya,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),C.jsxs(kC,{children:[C.jsx(Ec,{children:C.jsx(St,{p:4,bg:"gray.800",borderRadius:"md",children:C.jsx(TWe,{})})}),C.jsx(Ec,{children:C.jsx(St,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function CWe(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function RWe(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function cQ(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function yy(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function Ioe(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function IWe(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function AWe(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function PWe(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function o0(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function _k(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function lQ(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function WS(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function OWe(n){return Tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const kWe=async()=>{try{J.log("tagsFirestore: Fetching all tags");const n=kg(vr,"tags"),t=await Wy(n),s=[];return t.forEach(a=>{s.push({id:a.id,...a.data()})}),s}catch(n){throw J.error("tagsFirestore: Error fetching tags:",n),n}},NWe=async n=>{try{J.log(`tagsFirestore: Fetching tag with ID: ${n}`);const t=Hr(vr,"tags",n),s=await jo(t);return s.exists()?{id:s.id,...s.data()}:(J.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(t){throw J.error(`tagsFirestore: Error fetching tag with ID ${n}:`,t),t}},DWe=async({id:n,name:t,color:s,description:a})=>{try{J.log(`tagsFirestore: Creating new tag: ${t}`);const l={name:t,color:s||"#808080",description:a||"",createdAt:new Date,updatedAt:new Date};let d;if(n){const f=Hr(vr,"tags",n);await O0(f,l),d=n}else{const f=kg(vr,"tags");d=(await F5e(f,l)).id}return{id:d,...l}}catch(l){throw J.error("tagsFirestore: Error creating tag:",l),l}},xWe=async(n,t)=>{try{J.log(`tagsFirestore: Adding tag ${t} to space ${n}`);const s=Hr(vr,"tags",t);if(!(await jo(s)).exists())throw new Error(`Tag with ID ${t} does not exist`);const l=Hr(vr,"spaces",n);return await So(l,{tags:B5e(t)}),!0}catch(s){throw J.error(`tagsFirestore: Error adding tag ${t} to space ${n}:`,s),s}},LWe=async(n,t)=>{try{J.log(`tagsFirestore: Removing tag ${t} from space ${n}`);const s=Hr(vr,"spaces",n);return await So(s,{tags:W5e(t)}),!0}catch(s){throw J.error(`tagsFirestore: Error removing tag ${t} from space ${n}:`,s),s}},MWe=async n=>{try{J.log(`tagsFirestore: Getting tags for space ${n}`);const t=Hr(vr,"spaces",n),s=await jo(t);if(!s.exists())throw new Error(`Space with ID ${n} not found`);const l=s.data().tags||[];if(l.length===0)return[];const d=[];for(const f of l){const y=await NWe(f);y&&d.push(y)}return d}catch(t){throw J.error(`tagsFirestore: Error getting tags for space ${n}:`,t),t}},UWe=async()=>{J.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let t=0,s=0;for(const a of n){J.log(`tagsFirestore: Processing tag: ${a.name}`);const l=Hr(vr,"tags",a.id);(await jo(l)).exists()?(J.log(`tagsFirestore: Tag ${a.id} already exists, skipping`),s++):(await DWe(a),t++,J.log(`tagsFirestore: Created tag: ${a.name}`))}return J.log(`tagsFirestore: Tags initialization complete. Created: ${t}, Skipped: ${s}`),{created:t,skipped:s}}catch(t){throw J.error("tagsFirestore: Error initializing default tags:",t),t}},Aoe=({spaceID:n})=>{const[t,s]=D.useState([]),[a,l]=D.useState([]),[d,f]=D.useState(!0),[y,v]=D.useState(!1),[b,w]=D.useState(!1),[I,k]=D.useState(null),{isOpen:L,onOpen:V,onClose:B}=Df(),W=hl(),{user:Q}=D.useContext(Cc),$=(Q==null?void 0:Q.groups)&&(Q.groups.includes("disruptiveAdmin")||Q.groups.includes("admin"));D.useEffect(()=>{ie()},[n]);const ie=async()=>{f(!0);try{let Z=[];try{Z=await kWe(),s(Z)}catch(se){J.error("SpaceTagsManager: Error loading available tags:",se),s([]),W({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const se=await MWe(n);l(se)}catch(se){J.error("SpaceTagsManager: Error loading space tags:",se),l([]),W({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(Z){J.error("SpaceTagsManager: Error in loadTags:",Z),W({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{f(!1)}},ce=async()=>{w(!0),k(null);try{const Z=await UWe();console.log("Tag initialization result:",Z),k(Z),W({title:"Tags initialized",description:`Successfully created ${Z.created} tags. Skipped ${Z.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await ie()}catch(Z){J.error("SpaceTagsManager: Error initializing tags:",Z),k(!1),W({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{w(!1)}},ne=async Z=>{if(!(!n||!Z)){v(!0);try{await xWe(n,Z);const se=t.find(me=>me.id===Z);se&&l(me=>[...me,se]),W({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(se){J.error(`SpaceTagsManager: Error adding tag ${Z} to space:`,se),W({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},de=async Z=>{if(!(!n||!Z)){v(!0);try{await LWe(n,Z),l(se=>se.filter(me=>me.id!==Z)),W({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(se){J.error(`SpaceTagsManager: Error removing tag ${Z} from space:`,se),W({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},Y=()=>{const Z=a.map(se=>se.id);return t.filter(se=>!Z.includes(se.id))},X=Y().length===0;return C.jsxs(St,{children:[C.jsx(Wi,{mb:3,justifyContent:"space-between",alignItems:"center",children:C.jsxs(ui,{spacing:2,ml:"auto",children:[$&&C.jsx(Lr,{size:"xs",leftIcon:C.jsx(N8e,{}),onClick:V,variant:"outline",colorScheme:"purple",children:"Admin"}),C.jsxs(C1,{children:[C.jsx(R1,{as:Lr,size:"xs",leftIcon:C.jsx(k8e,{}),rightIcon:C.jsx(x8e,{}),isDisabled:d||y||X,children:X?"No Available Tags":"Add Tag"}),C.jsx(I1,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:Y().length>0?Y().map(Z=>C.jsx(e0,{onClick:()=>ne(Z.id),icon:C.jsx(St,{width:"12px",height:"12px",borderRadius:"full",bg:Z.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:Z.name},Z.id)):C.jsx(e0,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),d?C.jsx(Wi,{justify:"center",py:4,children:C.jsx(cp,{size:"sm",color:"blue.300"})}):t.length===0?C.jsx(St,{children:C.jsxs(at,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",$?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):a.length===0?C.jsx(at,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):C.jsx(Jne,{spacing:2,children:a.map(Z=>C.jsx(Mj,{children:C.jsxs($ne,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${Z.color||"#888"}`,children:[C.jsx(St,{width:"8px",height:"8px",borderRadius:"full",bg:Z.color||"#888",mr:1}),C.jsx(Kne,{children:Z.name}),C.jsx(Yne,{onClick:()=>de(Z.id),isDisabled:y})]})},Z.id))}),C.jsxs(Bo,{isOpen:L,onClose:B,size:"md",children:[C.jsx(Go,{backdropFilter:"blur(4px)"}),C.jsxs(Wo,{bg:"gray.800",color:"white",children:[C.jsx(wc,{fontSize:"md",children:"Tag System Administration"}),C.jsx(ba,{}),C.jsxs(zo,{children:[C.jsx(at,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),I&&C.jsxs(yf,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[C.jsx(Ef,{}),C.jsxs(at,{fontSize:"sm",children:["Tags initialized. Created: ",C.jsx("b",{children:I.created}),", Skipped: ",C.jsx("b",{children:I.skipped})]})]}),C.jsx(Lr,{colorScheme:"blue",onClick:ce,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),C.jsx(Vf,{children:C.jsx(Lr,{variant:"ghost",size:"sm",onClick:B,children:"Close"})})]})]})]})};Aoe.propTypes={spaceID:vn.string.isRequired};const VWe=({isOpen:n,onClose:t})=>{const{spaceID:s}=wa(),[a,l]=D.useState(0),[d,f]=D.useState(""),[y,v]=D.useState(""),[b,w]=D.useState(!1),[I,k]=D.useState(null),[L,V]=D.useState(null),[B,W]=D.useState(!1),[Q,$]=D.useState(0),[ie,ce]=D.useState(null),ne=D.useRef(null),[de,Y]=D.useState(null),[X,Z]=D.useState(null),[se,me]=D.useState(!1),[pe,ue]=D.useState(0),[Le,We]=D.useState(null),$e=D.useRef(null),[ve,_e]=D.useState(null),[Ee,ke]=D.useState(null),[Te,be]=D.useState(!1),[Pe,xe]=D.useState(0),[ze,Je]=D.useState(null),Ze=D.useRef(null),[lt,nt]=D.useState([]),[Rt,fn]=D.useState([]),[Ft,on]=D.useState(!1),[Zt,Yt]=D.useState(!1),[Vn,$t]=D.useState(!0),[Re,Ve]=D.useState(!1),[Ge,ht]=D.useState(!1),[mt,vt]=D.useState(""),[Bt,mn]=D.useState(""),[En,en]=D.useState(""),[Et,nr]=D.useState(!1),{setHLSStreamUrl:Nt,savedStreamData:Ut}=toe(),gn=hl();D.useEffect(()=>{n&&s&&ki()},[n,s]);const ki=async()=>{try{const gt=await Nf(s);gt.logoUrl&&ce(gt.logoUrl),gt.backgroundUrl&&We(gt.backgroundUrl),gt.videoBackgroundUrl&&Je(gt.videoBackgroundUrl),gt.voiceDisabled!==void 0&&Yt(gt.voiceDisabled),gt.accessibleToAllUsers!==void 0&&$t(gt.accessibleToAllUsers),f(gt.name||""),v(gt.description||"");try{const dn=await Xse(s);if(dn){vt(dn.streamUrl||""),mn(dn.rtmpUrl||""),en(dn.streamKey||"");const gr=dn.enabled===!0;ht(gr),J.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:gr,rawValue:dn.enabled})}else ht(!1),J.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(dn){if(J.error("Error fetching stream data directly:",dn),Ut){vt(Ut.streamUrl||""),mn(Ut.rtmpUrl||""),en(Ut.streamKey||"");const gr=Ut.enabled===!0;ht(gr),J.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:gr,rawValue:Ut.enabled})}else ht(!1),J.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}_s(gt)}catch(gt){J.error("Error fetching space data:",gt),gn({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};D.useEffect(()=>{if(Ut){if(!Et){vt(Ut.streamUrl||""),mn(Ut.rtmpUrl||""),en(Ut.streamKey||"");const gt=Ut.enabled===!0;ht(gt),J.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:gt,rawValue:Ut.enabled})}}else n&&!Et&&J.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[Ut,Et,n]);const _s=async gt=>{if(s&&n){on(!0);try{const dn=MV(),gr=`space_${s}_owners`,fi=VV(kg(dn,"users"),bJ("groups","array-contains",gr)),wo=await Wy(fi),so=[];for(const bi of wo.docs){const oo=bi.data(),Fi=await Fu(bi.id);so.push({uid:bi.id,email:oo.email,displayName:oo.displayName||Fi.Nickname||"Unknown User",photoURL:oo.photoURL||Fi.photoURL,firstName:Fi.firstName,lastName:Fi.lastName})}nt(so);const Hl=`space_${s}_hosts`,pp=VV(kg(dn,"users"),bJ("groups","array-contains",Hl)),fl=await Wy(pp),$l=[];for(const bi of fl.docs){const oo=bi.data(),Fi=await Fu(bi.id);$l.push({uid:bi.id,email:oo.email,displayName:oo.displayName||Fi.Nickname||"Unknown User",photoURL:oo.photoURL||Fi.photoURL,firstName:Fi.firstName,lastName:Fi.lastName})}fn($l)}catch(dn){J.error("Error fetching space users:",dn),gn({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{on(!1)}}};D.useEffect(()=>{s&&n&&a===4&&_s()},[s,n,a]);const ii=gt=>{const dn=gt.target.files[0];if(dn){if(!dn.type.startsWith("image/")){gn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}k(dn);const gr=new FileReader;gr.onloadend=()=>{V(gr.result)},gr.readAsDataURL(dn)}},Ho=gt=>{const dn=gt.target.files[0];if(dn){if(!dn.type.startsWith("image/")){gn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}Y(dn);const gr=new FileReader;gr.onloadend=()=>{Z(gr.result)},gr.readAsDataURL(dn)}},ec=gt=>{const dn=gt.target.files[0];if(dn){if(!dn.type.startsWith("video/")){gn({title:"Invalid file type",description:"Please select a video file",status:"error",duration:5e3,isClosable:!0});return}const gr=5*1024*1024;if(dn.size>gr){gn({title:"File too large",description:"Video file must be smaller than 5MB",status:"error",duration:5e3,isClosable:!0});return}_e(dn);const fi=new FileReader;fi.onloadend=()=>{ke(fi.result)},fi.readAsDataURL(dn)}},Ks=async()=>{if(!I){gn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{W(!0);const gt=setInterval(()=>{$(gr=>{const fi=gr+10;return fi>=90?90:fi})},300),dn=await g6e(s,I);clearInterval(gt),$(100),ce(dn),gn({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{k(null),V(null),$(0),W(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:dn}}))}catch(gt){console.error("Error uploading logo:",gt),gn({title:"Upload failed",description:gt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),W(!1),$(0)}},qs=async()=>{if(!de){gn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{me(!0);const gt=setInterval(()=>{ue(gr=>{const fi=gr+10;return fi>=90?90:fi})},300),dn=await y6e(s,de);clearInterval(gt),ue(100),We(dn),gn({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{Y(null),Z(null),ue(0),me(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:dn}}))}catch(gt){console.error("Error uploading background:",gt),gn({title:"Upload failed",description:gt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),me(!1),ue(0)}},Rc=async()=>{if(ie)try{W(!0),await _6e(s),ce(null),gn({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),W(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(gt){console.error("Error deleting logo:",gt),gn({title:"Deletion failed",description:gt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),W(!1)}},ys=async()=>{if(Le)try{me(!0),await E6e(s),We(null),gn({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),me(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(gt){console.error("Error deleting background:",gt),gn({title:"Deletion failed",description:gt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),me(!1)}},Ca=async()=>{if(!ve){gn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{be(!0);const gt=setInterval(()=>{xe(gr=>{const fi=gr+10;return fi>=90?90:fi})},300),dn=await b6e(s,ve);clearInterval(gt),xe(100),Je(dn),gn({title:"Upload successful",description:"Space video background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{_e(null),ke(null),xe(0),be(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:dn}}))}catch(gt){console.error("Error uploading video background:",gt),gn({title:"Upload failed",description:gt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),be(!1),xe(0)}},To=async()=>{if(ze)try{be(!0),await T6e(s),Je(null),gn({title:"Video background removed",description:"Space video background has been removed",status:"info",duration:5e3,isClosable:!0}),be(!1),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:null}}))}catch(gt){console.error("Error deleting video background:",gt),gn({title:"Deletion failed",description:gt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),be(!1)}},Ra=()=>{ne.current&&ne.current.click()},tc=()=>{$e.current&&$e.current.click()},pl=()=>{Ze.current&&Ze.current.click()},Ia=async()=>{Ve(!0);try{await v6e(s,{voiceDisabled:!Zt}),Yt(!Zt),gn({title:"Settings Updated",description:`Voice chat has been ${Zt?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(gt){J.error("Error updating voice settings:",gt),gn({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{Ve(!1)}},nc=async()=>{Ve(!0);try{await S6e(s,!Vn),$t(!Vn),gn({title:"Settings Updated",description:`Space is now ${Vn?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(gt){J.error("Error updating accessibility settings:",gt),gn({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{Ve(!1)}},io=async()=>{if(s){w(!0);try{const gt=MV(),dn=Hr(gt,"spaces",s);await So(dn,{name:d,description:y}),gn({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:y}}))}catch(gt){J.error("Error updating space details:",gt),gn({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{w(!1)}}},Ni=async()=>{if(s){nr(!0);try{const gt={enabled:Ge,streamUrl:mt,rtmpUrl:Bt,streamKey:En,playerIndex:"0",updatedAt:new Date().toISOString()};J.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Ge,url:mt,hasRtmp:!!Bt,hasKey:!!En});try{await BV(s,gt),J.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(dn){throw J.error("SpaceManageModal: Error updating stream settings directly in Firebase:",dn),dn}await Nt(mt,0,{enabled:Ge,rtmpUrl:Bt,streamKey:En}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Ge,spaceId:s}})),gn({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Ge?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{ki()},500)}catch(gt){J.error("Error updating stream settings:",gt),gn({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{nr(!1)}}};return C.jsxs(Bo,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[C.jsx(Go,{backdropFilter:"blur(4px)"}),C.jsxs(Wo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[C.jsx(wc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),C.jsx(ba,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(zo,{p:0,display:"flex",overflow:"hidden",children:C.jsxs(E0,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",width:"100%",height:"100%",children:[C.jsxs(v0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[C.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(yn,{as:Ioe,mb:1}),C.jsx(at,{fontSize:"xs",children:"Details"})]}),C.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(yn,{as:yy,mb:1}),C.jsx(at,{fontSize:"xs",children:"Logo"})]}),C.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(yn,{as:RWe,mb:1}),C.jsx(at,{fontSize:"xs",children:"Background"})]}),C.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(yn,{as:AWe,mb:1}),C.jsx(at,{fontSize:"xs",children:"Settings"})]}),C.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(yn,{as:lQ,mb:1}),C.jsx(at,{fontSize:"xs",children:"Users"})]}),C.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(yn,{as:WS,mb:1}),C.jsx(at,{fontSize:"xs",children:"Stream"})]})]}),C.jsxs(kC,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[C.jsxs(Ec,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),C.jsxs(Ui,{spacing:4,align:"stretch",children:[C.jsxs(hi,{children:[C.jsx(Zs,{fontSize:"xs",children:"Space Name"}),C.jsx(es,{value:d,onChange:gt=>f(gt.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),C.jsxs(hi,{children:[C.jsx(Zs,{fontSize:"xs",children:"Description"}),C.jsx(Xne,{value:y,onChange:gt=>v(gt.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),C.jsxs(hi,{children:[C.jsx(Zs,{fontSize:"xs",children:"Space Tags"}),C.jsx(St,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:s?C.jsx(Aoe,{spaceID:s}):C.jsxs(yf,{status:"warning",variant:"subtle",borderRadius:"md",children:[C.jsx(Ef,{}),C.jsx(FS,{fontSize:"sm",children:"Space ID missing"}),C.jsx(jS,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),C.jsx(Lr,{colorScheme:"blue",size:"sm",onClick:io,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),C.jsxs(Ec,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),C.jsx(at,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(ie||L)&&C.jsxs(Wi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ie&&C.jsxs(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),C.jsx(Gh,{src:ie,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),C.jsx(Lr,{mt:3,colorScheme:"red",leftIcon:C.jsx(yn,{as:o0}),onClick:Rc,isLoading:B,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),L&&C.jsxs(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),C.jsx(Gh,{src:L,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),C.jsxs(hi,{children:[C.jsx(Zs,{fontSize:"xs",children:"Upload New Logo"}),C.jsx(es,{type:"file",accept:"image/*",onChange:ii,ref:ne,display:"none"}),B&&C.jsxs(St,{mt:3,mb:3,children:[C.jsxs(at,{fontSize:"xs",mb:1,children:["Uploading... ",Q,"%"]}),C.jsx(Py,{value:Q,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),C.jsxs(ui,{mt:3,spacing:3,children:[C.jsx(Lr,{colorScheme:"blue",leftIcon:C.jsx(yn,{as:yy}),onClick:Ra,isDisabled:B,size:"sm",variant:"outline",children:"Browse"}),C.jsx(Lr,{colorScheme:"green",leftIcon:C.jsx(yn,{as:_k}),onClick:Ks,isLoading:B,loadingText:"Uploading...",isDisabled:!I||B,size:"sm",children:"Upload"})]}),C.jsx(JS,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),C.jsxs(Ec,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Background"}),C.jsx(at,{fontSize:"xs",mb:4,children:"Upload a background for your space. This will be displayed during loading."}),C.jsxs(E0,{variant:"enclosed",colorScheme:"blue",size:"md",mb:4,borderColor:"blue.300",children:[C.jsxs(v0,{children:[C.jsxs(ya,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[C.jsx(yn,{as:yy,mr:2}),"Image"]}),C.jsxs(ya,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[C.jsx(yn,{as:cQ,mr:2}),"Video (max 5MB)"]})]}),C.jsxs(kC,{mt:4,children:[C.jsxs(Ec,{p:0,children:[(Le||X)&&C.jsxs(Wi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Le&&C.jsxs(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),C.jsx(Gh,{src:Le,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),C.jsx(Lr,{mt:3,colorScheme:"red",leftIcon:C.jsx(yn,{as:o0}),onClick:ys,isLoading:se,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),X&&C.jsxs(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),C.jsx(Gh,{src:X,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),C.jsxs(hi,{children:[C.jsx(Zs,{fontSize:"xs",children:"Upload New Background Image"}),C.jsx(es,{type:"file",accept:"image/*",onChange:Ho,ref:$e,display:"none"}),se&&C.jsxs(St,{mt:3,mb:3,children:[C.jsxs(at,{fontSize:"xs",mb:1,children:["Uploading... ",pe,"%"]}),C.jsx(Py,{value:pe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),C.jsxs(ui,{mt:3,spacing:3,children:[C.jsx(Lr,{colorScheme:"blue",leftIcon:C.jsx(yn,{as:yy}),onClick:tc,isDisabled:se,size:"sm",variant:"outline",children:"Browse"}),C.jsx(Lr,{colorScheme:"green",leftIcon:C.jsx(yn,{as:_k}),onClick:qs,isLoading:se,loadingText:"Uploading...",isDisabled:!de||se,size:"sm",children:"Upload"})]}),C.jsx(JS,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),C.jsxs(Ec,{p:0,children:[(ze||Ee)&&C.jsxs(Wi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ze&&C.jsxs(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Video Background"}),C.jsx(St,{maxH:"160px",overflow:"hidden",position:"relative",children:C.jsx("video",{src:ze,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})}),C.jsx(Lr,{mt:3,colorScheme:"red",leftIcon:C.jsx(yn,{as:o0}),onClick:To,isLoading:Te,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Video"})]}),Ee&&C.jsxs(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),C.jsx(St,{maxH:"160px",overflow:"hidden",children:C.jsx("video",{src:Ee,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})})]})]}),C.jsxs(hi,{children:[C.jsx(Zs,{fontSize:"xs",children:"Upload New Video Background"}),C.jsx(es,{type:"file",accept:"video/*",onChange:ec,ref:Ze,display:"none"}),Te&&C.jsxs(St,{mt:3,mb:3,children:[C.jsxs(at,{fontSize:"xs",mb:1,children:["Uploading... ",Pe,"%"]}),C.jsx(Py,{value:Pe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),C.jsxs(ui,{mt:3,spacing:3,children:[C.jsx(Lr,{colorScheme:"blue",leftIcon:C.jsx(yn,{as:cQ}),onClick:pl,isDisabled:Te,size:"sm",variant:"outline",children:"Browse"}),C.jsx(Lr,{colorScheme:"green",leftIcon:C.jsx(yn,{as:_k}),onClick:Ca,isLoading:Te,loadingText:"Uploading...",isDisabled:!ve||Te,size:"sm",children:"Upload"})]}),C.jsx(JS,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: MP4 format. Maximum file size: 5MB. Short looping videos work best."})]})]})]})]})]}),C.jsxs(Ec,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),C.jsx(at,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),C.jsxs(Ui,{spacing:4,align:"stretch",children:[C.jsx(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(ui,{justify:"space-between",align:"center",children:[C.jsxs(St,{children:[C.jsxs(ui,{mb:1,spacing:2,children:[C.jsxs(St,{position:"relative",w:"16px",h:"16px",children:[C.jsx(yn,{as:OWe,color:Zt?"red.400":"green.400"}),Zt&&C.jsx(St,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),C.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),C.jsx(at,{fontSize:"xs",color:"whiteAlpha.800",children:Zt?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),C.jsx(Zh,{isChecked:!Zt,onChange:Ia,colorScheme:"green",size:"md",isDisabled:Re})]})}),C.jsx(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(ui,{justify:"space-between",align:"center",children:[C.jsxs(St,{children:[C.jsxs(ui,{mb:1,spacing:2,children:[C.jsx(St,{position:"relative",w:"16px",h:"16px",children:C.jsx(yn,{as:lQ,color:Vn?"green.400":"red.400"})}),C.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),C.jsx(at,{fontSize:"xs",color:"whiteAlpha.800",children:Vn?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),C.jsx(at,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),C.jsx(Zh,{isChecked:Vn,onChange:nc,colorScheme:"green",size:"md",isDisabled:Re})]})}),C.jsxs(yf,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[C.jsx(Ef,{color:"blue.300"}),C.jsxs(St,{children:[C.jsx(FS,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),C.jsx(jS,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),C.jsxs(Ec,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),C.jsx(at,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),Ft?C.jsx(Wi,{justify:"center",align:"center",h:"200px",children:C.jsx(cp,{color:"blue.300"})}):C.jsxs(Ui,{spacing:4,align:"stretch",children:[C.jsxs(St,{children:[C.jsxs(ui,{mb:2,children:[C.jsx(yn,{as:CWe,color:"green.400"}),C.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Owners"}),C.jsx(vf,{colorScheme:"green",ml:2,children:lt.length})]}),C.jsx(St,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:lt.length===0?C.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):C.jsx(Ui,{spacing:1,align:"stretch",children:lt.map(gt=>C.jsxs(ui,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[C.jsx(sp,{size:"xs",src:gt.photoURL,name:gt.displayName}),C.jsxs(St,{children:[C.jsx(at,{fontSize:"xs",children:gt.displayName}),C.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:gt.firstName&&gt.lastName?`${gt.firstName} ${gt.lastName}`:"Full name not available"})]}),C.jsx(Dk,{}),C.jsx(vf,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},gt.uid))})})]}),C.jsxs(St,{children:[C.jsxs(ui,{mb:2,children:[C.jsx(yn,{as:PWe,color:"purple.400"}),C.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),C.jsx(vf,{colorScheme:"purple",ml:2,children:Rt.length})]}),C.jsx(St,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:Rt.length===0?C.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):C.jsx(Ui,{spacing:1,align:"stretch",children:Rt.map(gt=>C.jsxs(ui,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[C.jsx(sp,{size:"xs",src:gt.photoURL,name:gt.displayName}),C.jsxs(St,{children:[C.jsx(at,{fontSize:"xs",children:gt.displayName}),C.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:gt.firstName&&gt.lastName?`${gt.firstName} ${gt.lastName}`:"Full name not available"})]}),C.jsx(Dk,{}),C.jsx(vf,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},gt.uid))})})]}),C.jsx(gg,{borderColor:"whiteAlpha.200"}),C.jsxs(yf,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[C.jsx(Ef,{color:"blue.300",boxSize:4}),C.jsxs(St,{children:[C.jsx(FS,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),C.jsx(jS,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]}),C.jsxs(Ec,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Stream Settings"}),C.jsxs(Ui,{spacing:4,align:"stretch",children:[C.jsx(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(ui,{justify:"space-between",align:"center",children:[C.jsx(St,{children:C.jsxs(ui,{mb:1,spacing:2,children:[C.jsx(St,{position:"relative",w:"16px",h:"16px",children:C.jsx(yn,{as:WS,color:Ge?"green.400":"red.400"})}),C.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),C.jsx(Zh,{isChecked:Ge,onChange:async()=>{const gt=!Ge;ht(gt),nr(!0);try{J.log("SpaceManageModal: Auto-saving streaming enabled state:",gt);const dn={enabled:gt,streamUrl:mt||"",rtmpUrl:Bt||"",streamKey:En||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await BV(s,dn),J.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(gr){throw J.error("SpaceManageModal: Error updating streaming state directly in Firebase:",gr),gr}await Nt(mt,0,{enabled:gt,rtmpUrl:Bt,streamKey:En}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:gt,spaceId:s}})),gn({title:"Streaming "+(gt?"Enabled":"Disabled"),description:`Streaming is now ${gt?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(dn){J.error("Error auto-saving streaming state:",dn),ht(!gt),gn({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{nr(!1),setTimeout(()=>{ki()},500)}},colorScheme:"green",size:"md",isDisabled:Et})]})}),C.jsxs(St,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),C.jsxs(hi,{mb:4,children:[C.jsx(Zs,{fontSize:"xs",children:"Stream URL"}),C.jsx(es,{value:mt,onChange:gt=>vt(gt.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Et})]}),C.jsx(gg,{my:3,borderColor:"whiteAlpha.200"}),C.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),C.jsxs(hi,{mb:3,children:[C.jsx(Zs,{fontSize:"xs",children:"RTMP URL"}),C.jsx(es,{value:Bt,onChange:gt=>mn(gt.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Et})]}),C.jsxs(hi,{mb:3,children:[C.jsx(Zs,{fontSize:"xs",children:"Stream Key"}),C.jsx(es,{value:En,onChange:gt=>en(gt.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Et,type:"password"})]})]}),C.jsx(Lr,{colorScheme:"blue",size:"sm",onClick:Ni,isLoading:Et,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Ge?"inline-flex":"none",children:"Save Stream Settings"}),C.jsxs(yf,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[C.jsx(Ef,{color:"blue.300"}),C.jsxs(St,{children:[C.jsx(FS,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),C.jsx(jS,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},FWe=({onTogglePlayerList:n,spaceID:t})=>{const{fullscreenRef:s}=Vd(),[a,l]=D.useState(!0),[d,f]=D.useState(!1),[y,v]=D.useState(!1),[b,w]=D.useState(!1),[I,k]=D.useState(!1),[L,V]=D.useState(!1),[B,W]=D.useState(null),[Q,$]=D.useState(!1),[ie,ce]=D.useState(!1),[ne,de]=D.useState(!1),[Y,X]=D.useState(!1),Z=hl(),{user:se}=D.useContext(Cc),me=(se==null?void 0:se.Nickname)||"Unknown",[pe,ue]=D.useState(!1),Le=async()=>{if(se!=null&&se.uid&&t)try{const be=await Fu(se.uid);let Pe=!1,xe=!1;if(be.groups){const Je=`space_${t}_owners`,Ze=`space_${t}_hosts`;Pe=be.groups.includes(Je),xe=be.groups.includes(Ze)}const ze=await N4(se.uid,"disruptiveAdmin");if(X(ze),W({rpmURL:be.rpmURL?be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),ce(Pe||ze),de(xe),!Pe&&!ze&&Q){$(!1);const Je=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Je),Z({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(be){console.error("Error fetching profile data:",be),ce(!1),de(!1),X(!1)}else ce(!1),de(!1),X(!1)};D.useEffect(()=>{Le()},[se==null?void 0:se.uid,t,Q]),D.useEffect(()=>{const be=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]),D.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&ue(window.agoraClient.voiceDisabled)}catch(xe){console.error("Error checking if voice is disabled:",xe)}})();const Pe=xe=>{xe.detail&&typeof xe.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",xe.detail.voiceDisabled),ue(xe.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Pe),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Pe)}},[]);const We=()=>v(!y),$e=()=>w(!b),ve=()=>{V(!L),ke()},_e=()=>{k(!1),Le()},Ee=be=>{be.stopPropagation(),typeof n=="function"&&(J.log("CanvasMainMenu: Toggling player list"),n())},ke=()=>{f(!1)},Te=be=>{if(be.stopPropagation(),!ie){Z({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Pe=!Q;$(Pe);const xe=new CustomEvent("editModeChanged",{detail:{enabled:Pe}});window.dispatchEvent(xe),Z({title:Pe?"Edit Mode Enabled":"Edit Mode Disabled",description:Pe?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Pe?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return C.jsxs(C.Fragment,{children:[C.jsxs(C1,{isOpen:d,onClose:()=>f(!1),children:[C.jsx(R1,{as:Fo,icon:C.jsx(U8e,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!d)}),C.jsx(Bu,{containerRef:s,children:C.jsx(I1,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:C.jsxs(Ui,{align:"stretch",spacing:4,children:[C.jsxs(ui,{children:[C.jsx(sp,{size:"md",src:B==null?void 0:B.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),C.jsxs(Ui,{align:"start",spacing:0,children:[C.jsxs(ui,{children:[C.jsx(at,{fontWeight:"bold",children:me}),ie&&!Y&&C.jsx(Pf,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:C.jsx(St,{display:"inline-block",children:C.jsx(yn,{as:YV,color:"green.400",boxSize:3})})}),!ie&&ne&&!Y&&C.jsx(Pf,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:C.jsx(St,{display:"inline-block",children:C.jsx(yn,{as:QV,color:"purple.400",boxSize:3})})}),Y&&C.jsx(Pf,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:C.jsx(St,{display:"inline-block",children:C.jsx(yn,{as:Q8e,color:"blue.400",boxSize:3})})})]}),C.jsx(at,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),C.jsxs(ui,{spacing:4,justify:"center",children:[C.jsx(Fo,{icon:C.jsx(eWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:Ee}),ie&&C.jsx(Fo,{icon:C.jsx(H8e,{}),variant:"ghost",colorScheme:Q?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:Te}),C.jsx(Fo,{icon:C.jsx(St,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),C.jsx(Fo,{icon:C.jsx(St,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),C.jsx(gg,{borderColor:"whiteAlpha.300"}),C.jsxs(Ui,{align:"stretch",spacing:2,children:[ie&&C.jsxs(ui,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:be=>be.stopPropagation(),justify:"space-between",children:[C.jsx(at,{fontSize:"md",children:"Edit Mode"}),C.jsx(Zh,{id:"edit-mode-toggle",isChecked:Q,onChange:Te,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:Q?"green.500":"black"}}})]}),ie&&C.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:ve,children:"Manage Space"}),se&&t&&!pe&&C.jsx(SWe,{onClose:ke}),C.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:We,children:"Settings"}),C.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:$e,children:"Controls"}),C.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Support"}),C.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&C.jsx(bWe,{open:b,onClose:$e}),y&&C.jsx(wWe,{open:y,onClose:We}),I&&C.jsx(Soe,{open:I,onClose:_e}),C.jsx(VWe,{isOpen:L,onClose:ve})]})},jWe=({isOpen:n,onClose:t,mediaScreenId:s,onImageChange:a})=>{const{spaceID:l}=wa(),d=dp(),f=hl(),y=D.useRef(null),v=D.useRef(null),b=D.useRef(),[w,I]=D.useState(null),[k,L]=D.useState(""),[V,B]=D.useState(!1),[W,Q]=D.useState(0),[$,ie]=D.useState(null),[ce,ne]=D.useState(!0),[de,Y]=D.useState(!1),[X,Z]=D.useState(!1),[se,me]=D.useState(0),[pe,ue]=D.useState("image"),[Le,We]=D.useState(""),[$e,ve]=D.useState(!1);D.useEffect(()=>{(async()=>{if(n&&s&&l){ne(!0);try{const Rt=await wf(l,s);if(Rt&&(Rt.imageUrl||Rt.videoUrl)){ie(Rt);const fn=Rt.mediaType==="video";ue(fn?"video":"image"),ve(Rt.displayAsVideo||!1),fn&&Rt.videoUrl&&(We(Rt.videoUrl),me(1))}else ie(null)}catch(Rt){J.error("Error fetching existing image:",Rt),ie(null)}finally{ne(!1)}}})()},[n,s,l]),D.useEffect(()=>{n||(I(null),L(""),Q(0),We(""))},[n]);const _e=D.useCallback(nt=>{nt.preventDefault(),nt.stopPropagation(),Z(!0)},[]),Ee=D.useCallback(nt=>{nt.preventDefault(),nt.stopPropagation(),Z(!1)},[]),ke=D.useCallback(nt=>{nt.preventDefault(),nt.stopPropagation()},[]),Te=D.useCallback(nt=>{if(nt.preventDefault(),nt.stopPropagation(),Z(!1),nt.dataTransfer.files&&nt.dataTransfer.files.length>0){const Rt=nt.dataTransfer.files[0];be(Rt)}},[]);D.useEffect(()=>{const nt=v.current;if(nt)return nt.addEventListener("dragenter",_e),nt.addEventListener("dragleave",Ee),nt.addEventListener("dragover",ke),nt.addEventListener("drop",Te),()=>{nt.removeEventListener("dragenter",_e),nt.removeEventListener("dragleave",Ee),nt.removeEventListener("dragover",ke),nt.removeEventListener("drop",Te)}},[_e,Ee,ke,Te]);const be=nt=>{if(!nt)return;if(!nt.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(nt);const Rt=new FileReader;Rt.onloadend=()=>{L(Rt.result)},Rt.readAsDataURL(nt)},Pe=nt=>{const Rt=nt.target.files[0];be(Rt)},xe=async nt=>{const Rt=nt.target.checked;if(ve(Rt),$)try{await B6e(l,s,Rt),Rt?d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:$.imageUrl||null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!1}),ie({...$,displayAsVideo:Rt}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${Rt?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),J.log(`Updated display mode for media screen ${s} to ${Rt?"video":"image"}`),a&&a({type:"update",mediaScreenId:s,displayAsVideo:Rt})}catch(fn){J.error("Error updating display mode:",fn),f({title:"Update failed",description:fn.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),ve(!Rt)}},ze=async()=>{if(pe==="image"&&!w){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(pe==="video"&&!Le){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const nt=setInterval(()=>{Q(on=>{const Zt=on+10;return Zt>=90?90:Zt})},300);let Rt;pe==="image"?Rt=await zJ(l,s,w,{mediaType:pe,displayAsVideo:$e}):(Rt=Le,await zJ(l,s,null,{mediaType:"video",directUrl:Le,displayAsVideo:$e})),clearInterval(nt),Q(100);let fn=null,Ft=null;pe==="image"?(fn=$e?null:Rt,Ft=($==null?void 0:$.videoUrl)||null):(fn=!$e&&($!=null&&$.imageUrl)?$.imageUrl:null,Ft=Rt),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:fn,videoUrl:Ft,mediaType:pe,displayAsVideo:$e}),J.log(`Uploaded and sent ${pe} for media screen ${s} (display as video: ${$e})`),a&&a({type:"upload",mediaScreenId:s,imageUrl:pe==="image"?Rt:$==null?void 0:$.imageUrl,videoUrl:pe==="video"?Rt:$==null?void 0:$.videoUrl,mediaType:pe,displayAsVideo:$e}),f({title:"Upload successful",description:`The ${pe} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),L(""),B(!1),Q(0),t()},1e3)}catch(nt){J.error(`Error uploading ${pe}:`,nt),f({title:"Upload failed",description:nt.message||`An error occurred while uploading the ${pe}`,status:"error",duration:5e3,isClosable:!0}),B(!1),Q(0)}},Je=async()=>{Y(!1);try{B(!0),await j6e(l,s),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:pe==="image"?null:($==null?void 0:$.imageUrl)||null,videoUrl:pe==="video"?null:($==null?void 0:$.videoUrl)||null,mediaType:null,displayAsVideo:!1}),J.log(`Deleted ${pe} for media screen ${s}`),a&&a({type:"delete",mediaScreenId:s}),f({title:`${pe==="image"?"Image":"Video"} deleted`,description:`The ${pe} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),ie(null),B(!1),We(""),ve(!1),setTimeout(()=>{t()},500)}catch(nt){J.error(`Error deleting ${pe}:`,nt),f({title:"Deletion failed",description:nt.message||`An error occurred while deleting the ${pe}`,status:"error",duration:5e3,isClosable:!0}),B(!1)}},Ze=()=>{V||(I(null),L(""),Q(0),t())},lt=nt=>{me(nt),ue(nt===0?"image":"video")};return C.jsxs(C.Fragment,{children:[C.jsxs(Bo,{isOpen:n,onClose:Ze,size:"xl",children:[C.jsx(Go,{backdropFilter:"blur(10px)"}),C.jsxs(Wo,{bg:"gray.800",color:"white",maxW:"900px",children:[C.jsx(wc,{children:"Media Screen Content"}),C.jsx(ba,{isDisabled:V}),C.jsxs(St,{px:6,pb:2,children:[C.jsxs(Wi,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[C.jsxs(ui,{spacing:4,children:[C.jsx(at,{fontWeight:"medium",children:"Display as:"}),C.jsxs(ui,{spacing:2,children:[C.jsx(yn,{as:yy,color:$e?"gray.400":"green.300"}),C.jsx(Zh,{colorScheme:"purple",size:"md",isChecked:$e,onChange:xe}),C.jsx(yn,{as:WS,color:$e?"purple.300":"gray.400"})]})]}),C.jsx(vf,{colorScheme:$e?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:$e?"Video Output":"Image Output"})]}),C.jsxs(at,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",C.jsx("strong",{children:s})]}),C.jsx(at,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),C.jsx(gg,{mb:4})]}),C.jsx(zo,{children:C.jsxs(Wi,{children:[C.jsx(E0,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:se,onChange:lt,h:"100%",minW:"120px",mr:4,children:C.jsxs(v0,{children:[C.jsxs(ya,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[C.jsx(yn,{as:yy,mr:2})," Image"]}),C.jsxs(ya,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[C.jsx(yn,{as:WS,mr:2})," Video"]})]})}),C.jsx(St,{flex:"1",children:ce?C.jsx(Wi,{justify:"center",align:"center",h:"150px",children:C.jsx(cp,{size:"xl",color:"blue.400"})}):C.jsxs(C.Fragment,{children:[C.jsx(St,{children:se===0?C.jsxs(Ui,{spacing:4,align:"stretch",children:[$&&$.imageUrl&&pe==="image"&&C.jsxs(St,{children:[C.jsx(at,{fontWeight:"semibold",mb:2,children:"Current Image:"}),C.jsxs(Wi,{children:[C.jsx(St,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:C.jsx(Gh,{src:$.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),C.jsxs(Ui,{align:"flex-start",spacing:2,children:[C.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date($.uploadedAt).toLocaleString()]}),C.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),C.jsx(Lr,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:C.jsx(yn,{as:o0}),onClick:()=>Y(!0),isDisabled:V,children:"Delete"})]})]}),C.jsx(gg,{my:4})]}),C.jsx(at,{fontWeight:"semibold",mb:2,children:$&&$.imageUrl&&pe==="image"?"Replace with new image:":"Upload new image:"}),C.jsxs(St,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:X?"blue.400":"gray.500",bg:X?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>y.current.click(),children:[k?C.jsx(St,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:C.jsx(Gh,{src:k,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):C.jsxs(Ui,{spacing:2,children:[C.jsx(yn,{as:_k,boxSize:"24px",color:"gray.400"}),C.jsx(at,{children:"Drag and drop an image here, or click to browse"}),C.jsx(at,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),C.jsx(es,{type:"file",accept:"image/*",onChange:Pe,ref:y,display:"none"})]}),w&&C.jsxs(at,{fontSize:"sm",children:["Selected file: ",w.name," (",Math.round(w.size/1024)," KB)"]})]}):C.jsxs(Ui,{spacing:4,align:"stretch",children:[$&&$.videoUrl&&pe==="video"&&C.jsxs(St,{children:[C.jsx(at,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),C.jsxs(Wi,{children:[C.jsx(St,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:C.jsx(at,{fontSize:"sm",wordBreak:"break-all",children:$.videoUrl})}),C.jsxs(Ui,{align:"flex-start",spacing:2,children:[C.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date($.uploadedAt).toLocaleString()]}),C.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),C.jsx(Lr,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:C.jsx(yn,{as:o0}),onClick:()=>Y(!0),isDisabled:V,children:"Delete"})]})]}),C.jsx(gg,{my:4})]}),C.jsx(at,{fontWeight:"semibold",mb:2,children:$&&$.videoUrl&&pe==="video"?"Replace with new video:":"Add video URL:"}),C.jsx(St,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:C.jsxs(ui,{children:[C.jsx(yn,{as:Ioe,color:"blue.300"}),C.jsx(at,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),C.jsxs(hi,{children:[C.jsx(Zs,{fontSize:"sm",children:"Video URL"}),C.jsx(es,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Le,onChange:nt=>We(nt.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),C.jsx(at,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),C.jsxs(St,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[C.jsxs(ui,{children:[C.jsx(yn,{as:WS,color:"blue.300"}),C.jsx(at,{fontWeight:"medium",children:"Video Support"})]}),C.jsx(at,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),C.jsx(at,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Le&&C.jsxs(St,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[C.jsxs(ui,{mb:2,children:[C.jsx(yn,{as:IWe,color:"blue.300"}),C.jsx(at,{fontWeight:"medium",children:"URL Preview"})]}),C.jsx(at,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Le}),C.jsx(at,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),V&&C.jsxs(St,{mt:4,children:[C.jsxs(at,{mb:2,children:["Uploading: ",W,"%"]}),C.jsx(Py,{value:W,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),C.jsxs(Vf,{children:[C.jsx(Lr,{variant:"ghost",mr:3,onClick:Ze,isDisabled:V,children:"Cancel"}),C.jsx(Lr,{colorScheme:"blue",onClick:ze,isLoading:V,loadingText:"Uploading",isDisabled:pe==="image"&&!w||pe==="video"&&!Le||V||ce,leftIcon:C.jsx(yn,{as:pe==="image"?yy:WS}),size:"lg",px:6,children:pe==="image"?"Upload Image":"Save Video URL"})]})]})]}),C.jsx(I2e,{isOpen:de,leastDestructiveRef:b,onClose:()=>Y(!1),children:C.jsx(Go,{children:C.jsxs(A2e,{bg:"gray.800",color:"white",children:[C.jsxs(wc,{fontSize:"lg",fontWeight:"bold",children:["Delete ",pe==="video"?"Video":"Image"]}),C.jsxs(zo,{children:["Are you sure you want to delete this ",pe,"? This will revert the media screen to its blank state."]}),C.jsxs(Vf,{children:[C.jsx(Lr,{ref:b,onClick:()=>Y(!1),children:"Cancel"}),C.jsx(Lr,{colorScheme:"red",onClick:Je,ml:3,leftIcon:C.jsx(yn,{as:o0}),children:"Delete"})]})]})})})]})},BWe=n=>{const[t,s]=D.useState(null),[a,l]=D.useState(""),[d,f]=D.useState(null),[y,v]=D.useState(!1),b=hp(),{spaceID:w}=wa(),I=D.useCallback(V=>{var B,W;try{if(!V)return null;if(V.includes("youtube.com")||V.includes("youtu.be")){let Q="";return V.includes("youtube.com/watch")?Q=new URLSearchParams(new URL(V).search).get("v"):V.includes("youtu.be/")&&(Q=V.split("youtu.be/")[1].split("?")[0]),Q?`https://www.youtube.com/embed/${Q}?autoplay=1`:V}if(V.includes("vimeo.com")){if(V.includes("player.vimeo.com/video"))return V;const Q=(W=(B=V.split("vimeo.com/")[1])==null?void 0:B.split("?")[0])==null?void 0:W.split("/")[0];return Q?`https://player.vimeo.com/video/${Q}?autoplay=1`:V}return V}catch(Q){return J.error("Error converting to embed URL:",Q),V}},[]),k=D.useCallback(()=>{setTimeout(()=>{v(!1),J.log("Video processing state reset")},100)},[]);D.useEffect(()=>{let V=!0,B=null;const Q=b("PlayMediaScreenVideo",async $=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",$,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",$);const{mediaScreenId:ie,videoUrl:ce}=$||{};if(!ie){J.error("Media screen ID is missing in Unity event data."),k();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${ie}, setting ID but not playing video`),J.log("Edit mode is active, setting media screen ID but not playing video"),f(ie);return}if(v(!0),B=setTimeout(()=>{V&&(J.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),ce){if(console.log(`Using direct video URL from event: ${ce}`),V)try{const ne=I(ce);console.log(`Setting video URL to: ${ne} (original: ${ce})`),s(ne),l(`Media Screen ${ie}`),f(ie),J.log("Media screen video URL set directly from event:",ne)}catch(ne){J.error("Error setting video URL from direct URL:",ne)}finally{k(),clearTimeout(B)}return}console.log(`Fetching media screen data for ID: ${ie}`);try{const ne=await wf(w,ie);if(console.log("Media screen data from Firestore:",ne),!ne||!ne.videoUrl){J.error("No video URL found for media screen:",ie),k(),clearTimeout(B);return}if(!ne.displayAsVideo){J.log("Media screen is not set to display as video:",ie),console.log("displayAsVideo flag is false for this media screen"),k(),clearTimeout(B);return}if(V)try{const de=I(ne.videoUrl);console.log(`Setting video URL to: ${de} (original: ${ne.videoUrl})`),s(de),l(ne.title||`Media Screen ${ie}`),f(ie),J.log("Media screen video URL set to:",de)}catch(de){J.error("Error setting video URL from Firestore:",de)}finally{k(),clearTimeout(B)}}catch(ne){J.error(`Error fetching media screen data for ${ie}:`,ne),k(),clearTimeout(B)}}catch(ie){J.error("Error handling media screen video play:",ie),console.error("Error handling media screen video play:",ie),k(),clearTimeout(B)}});return()=>{V=!1,B&&clearTimeout(B),Q()}},[b,w,n,I,k]);const L=D.useCallback(()=>{s(null),l(""),f(null),v(!1),J.log("Video player state reset")},[]);return[t,a,d,L,y]},WWe=()=>{const{spaceID:n}=wa(),t=dp(),s=hp(),[a,l]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){J.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{J.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const d=D.useCallback(async b=>{try{return b.includes("vimeo.com")?await f(b):b.includes("youtube.com")||b.includes("youtu.be")?await y(b):"https://via.placeholder.com/640x360?text=Video"}catch(w){return J.error(`Error fetching thumbnail for ${b}:`,w),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async b=>{try{const w=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,I=await fetch(w);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const k=await I.json(),L=k.thumbnail_url.replace(/_\d+x\d+/,""),V=["640x360","295x166"];let B=null;for(let W of V){const Q=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${W}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Q,{method:"HEAD"})).ok){B=Q;break}}catch($){J.warn(`Failed to validate thumbnail URL: ${Q}`,$)}}return B||k.thumbnail_url}catch(w){return J.error(`Error fetching Vimeo thumbnail: ${w.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},y=async b=>{let w="";if(b.includes("youtube.com/watch")?w=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(w=b.split("youtu.be/")[1].split("?")[0]),!w)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${w}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(k){J.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${w}`,k)}return`https://img.youtube.com/vi/${w}/hqdefault.jpg`},v=D.useCallback(async b=>{try{if(!n||!b)return;J.log(`Refreshing thumbnail for media screen ${b}`);const w=await wf(n,b);if(!w){J.log(`No media screen found with ID ${b}`);return}if(J.log("Media screen data:",w),!w.displayAsVideo||!w.videoUrl){J.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const I=await d(w.videoUrl);t("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:I}),J.log(`Sent refreshed thumbnail for media screen ${b}: ${I}`)}catch(w){J.error(`Error refreshing thumbnail for media screen ${b}:`,w)}},[n,d,t]);D.useEffect(()=>{if(!a){J.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}J.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const w=s("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:k,thumbnailUrl:L}=I;L==="refresh"&&k&&(console.log(`Received request to refresh thumbnail for media screen ${k}`),await v(k))}catch(k){console.error("Error handling SetMediaScreenThumbnail event:",k)}});return()=>{w()}},[s,v,a]),D.useEffect(()=>{if(!a){J.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}J.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");J.log("Fetching media screens for thumbnails...");const I=await j4(n);J.log("All media screens:",I);const k=I.filter(B=>B.displayAsVideo&&B.videoUrl);if(J.log("Media screens set to display as videos:",k),k.length===0){J.log("No media screens set to display as videos found.");return}J.log(`Found ${k.length} media screens set to display as videos.`);const L=k.map(async B=>{try{const W=await d(B.videoUrl);return J.log(`Fetched thumbnail for ${B.id}: ${W}`),{mediaScreenId:B.id,thumbnailUrl:W}}catch(W){return J.error(`Error processing thumbnail for media screen ${B.id}:`,W),{mediaScreenId:B.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),V=await Promise.all(L);J.log("Fetched Media Screen Thumbnails",V),V.forEach(({mediaScreenId:B,thumbnailUrl:W})=>{t("SetMediaScreenThumbnail",{mediaScreenId:B,thumbnailUrl:W}),J.log(`Sent thumbnail to Unity for media screen ${B}: ${W}`)})}catch(I){J.error("Error fetching media screen thumbnails:",I)}};b();const w=setInterval(b,5*60*1e3);return()=>{clearInterval(w)}},[t,n,d,a])},uQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},zWe=()=>C.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),GWe=({videoUrl:n,videoTitle:t,mediaScreenId:s,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Vd();return pN(a,`video-modal-${s}`),D.useEffect(()=>{if(a){const f=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const y=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(y&&(y.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),y&&(y.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[a]),C.jsxs(C.Fragment,{children:[C.jsx(zWe,{}),C.jsxs(Bo,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${s}`,children:[C.jsx(Go,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),C.jsxs(Wo,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[C.jsx(ba,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),C.jsx(zo,{p:0,width:"100%",children:n?C.jsx(St,{className:"iframe-container",style:uQ.iframeContainer,children:C.jsx("iframe",{className:"video-iframe",src:n,style:uQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:t||"Video Player"})}):C.jsxs(Wi,{direction:"column",align:"center",justify:"center",h:"400px",children:[C.jsx(cp,{size:"xl",mb:4}),C.jsx(at,{children:"Unable to load video"}),C.jsx(at,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Bs=(...n)=>{},HWe=()=>{const{isOpen:n,onOpen:t,onClose:s}=Df(),[a,l]=D.useState(null),[d,f]=D.useState("image"),y=D.useRef(null);pN(n,"image-viewer-modal");const v=D.useCallback(I=>{I.stopPropagation()},[]);return D.useEffect(()=>{if(n&&y.current){const I=y.current;I.addEventListener("mousemove",v),I.addEventListener("mousedown",v),I.addEventListener("mouseup",v),I.addEventListener("wheel",v);const k=document.getElementById("unity-canvas");return k&&(k.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",v),I.removeEventListener("mousedown",v),I.removeEventListener("mouseup",v),I.removeEventListener("wheel",v),k&&(k.style.pointerEvents="auto")}}},[n,v]),{isOpen:n,currentImageUrl:a,currentMediaType:d,openImageViewer:(I,k="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${k}`);const L=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),V=L?"image":k;console.log(`[DEBUG] Detected URL as ${L?"image":"non-image"}, using media type: ${V}`),l(I),f(V),t()},closeImageViewer:()=>{s(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:y,preventPropagation:v}},$We=()=>C.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),dU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),Bs(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},KWe=()=>{const{spaceID:n}=wa(),[t,s]=D.useState(!1),[a,l]=D.useState([]),[d,f]=D.useState(null),{isOpen:y,onOpen:v,onClose:b}=Df(),[w,I]=D.useState({}),[k,L]=D.useState(0);D.useRef(null);const V=dp(),{fullscreenRef:B}=Vd(),W=hp(),[Q,$]=D.useState(!1),{isOpen:ie,currentImageUrl:ce,currentMediaType:ne,openImageViewer:de,closeImageViewer:Y,modalContentRef:X,preventPropagation:Z}=HWe(),[se,me,pe,ue,Le]=BWe(t),{isOpen:We,onOpen:$e,onClose:ve}=Df();WWe(),noe(),D.useEffect(()=>{if(window.isPlayerInstantiated){$(!0);return}const be=()=>{$(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]);const _e=D.useCallback(be=>{if(Array.isArray(a)&&a.length>0){const Pe=a.find(xe=>xe.mediaScreenId===be);if(Pe){const xe=Pe.imageUrl,ze=Pe.videoUrl;return{screen:Pe,imageUrl:xe,videoUrl:ze,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(ce){let Pe=null;return Array.isArray(a)&&(Pe=a.find(xe=>xe.mediaScreenId===be)),{screen:Pe||{mediaScreenId:be},imageUrl:ce,videoUrl:null,mediaType:(Pe==null?void 0:Pe.mediaType)||"image",displayAsVideo:(Pe==null?void 0:Pe.displayAsVideo)||!1}}return n&&be&&wf(n,be).then(Pe=>{Pe&&l(xe=>Array.isArray(xe)&&xe.some(Je=>Je.mediaScreenId===be)?xe.map(Je=>Je.mediaScreenId===be?{...Je,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1,hasImage:!!Pe.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:Je):[...Array.isArray(xe)?xe:[],{mediaScreenId:be,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1,hasImage:!!Pe.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Pe=>{console.error(`Error fetching media screen data for ${be}:`,Pe)}),console.warn("No screen data found for:",be),null},[a,ce,n,l]),Ee=D.useCallback(be=>{if(console.log(`[DEBUG] Processing click on screen: ${be}, isEditMode: ${t}`),f(be),t)console.log(`[DEBUG] Opening upload modal for screen: ${be} in edit mode`),v();else{const Pe=_e(be);if(Pe){if(console.log(`[DEBUG] Screen data for ${be}:`,Pe),Bs("Screen data details:",{mediaScreenId:be,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType,displayAsVideo:Pe.displayAsVideo}),We&&pe===be)return;if(Pe.displayAsVideo&&Pe.videoUrl)Bs(`Opening video player for: ${Pe.videoUrl}`),V("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Pe.videoUrl});else if(Pe.imageUrl){Bs(`Opening viewer modal with ${Pe.mediaType}: ${Pe.imageUrl}`);const ze=dU(Pe.imageUrl);de(ze,Pe.mediaType||"image")}else n&&wf(n,be).then(ze=>{if(ze){if(ze.displayAsVideo&&ze.videoUrl)Bs(`Opening video player for: ${ze.videoUrl}`),V("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:ze.videoUrl});else if(ze.imageUrl){Bs(`Opening viewer modal with image: ${ze.imageUrl}`);const Je=dU(ze.imageUrl);de(Je,ze.mediaType||"image")}l(Je=>Array.isArray(Je)&&Je.some(lt=>lt.mediaScreenId===be)?Je.map(lt=>lt.mediaScreenId===be?{...lt,...ze,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:lt):[...Array.isArray(Je)?Je:[],{...ze,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(ze=>{console.error(`Error fetching media screen data for ${be}:`,ze)})}else n&&wf(n,be).then(xe=>{if(xe){if(xe.displayAsVideo&&xe.videoUrl)Bs(`Opening video player for: ${xe.videoUrl}`),V("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:xe.videoUrl});else if(xe.imageUrl){Bs(`Opening viewer modal with image: ${xe.imageUrl}`);const ze=dU(xe.imageUrl);de(ze,xe.mediaType||"image")}l(ze=>Array.isArray(ze)&&ze.some(Ze=>Ze.mediaScreenId===be)?ze.map(Ze=>Ze.mediaScreenId===be?{...Ze,...xe,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:Ze):[...Array.isArray(ze)?ze:[],{...xe,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(xe=>{console.error(`Error fetching media screen data for ${be}:`,xe)})}},[t,v,_e,We,pe,V,de,n]);D.useEffect(()=>{if(!Q)return;const be=async()=>{if(n)try{const xe=await j4(n),ze={};xe.forEach(Je=>{Je.id&&Je.imageUrl&&(ze[Je.id]=Je.imageUrl)}),l(Je=>Je.map(Ze=>{const lt=!!ze[Ze.mediaScreenId],nt=ze[Ze.mediaScreenId],Rt=Ze.mediaType||"image";return{...Ze,hasImage:lt,imageUrl:nt,mediaType:Rt}}))}catch(xe){console.error("Error fetching media screen images:",xe)}};be();let Pe=null;return t&&(Pe=setInterval(be,5e3)),()=>{Pe&&clearInterval(Pe)}},[n,t,k,Q]);const ke=be=>{l(Pe=>Pe.map(xe=>{if(xe.mediaScreenId===be.mediaScreenId){if(be.type==="upload")return{...xe,hasImage:!0,imageUrl:be.imageUrl,mediaType:be.mediaType||"image"};if(be.type==="delete")return{...xe,hasImage:!1,imageUrl:null,mediaType:null}}return xe})),be.type==="delete"?(setTimeout(()=>{l(Pe=>Pe.filter(xe=>xe.mediaScreenId!==be.mediaScreenId))},100),setTimeout(()=>{l(Pe=>Pe.filter(xe=>xe.mediaScreenId!==be.mediaScreenId))},1500)):setTimeout(()=>{l(Pe=>Pe.some(ze=>ze.mediaScreenId===be.mediaScreenId)?Pe.map(ze=>ze.mediaScreenId===be.mediaScreenId?{...ze,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image"}:ze):[...Pe,{mediaScreenId:be.mediaScreenId,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};D.useEffect(()=>{const be=Pe=>{const xe=Pe.detail.enabled;s(xe),xe?V("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):V("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",be),()=>{window.removeEventListener("editModeChanged",be)}},[V]),D.useEffect(()=>(window.JsSendMediaScreenClick=function(be){console.log("Unity: MediaScreenClick received with data:",be);try{const Pe=JSON.parse(be),xe=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Pe)});window.dispatchEvent(xe)}catch(Pe){console.error("Error processing MediaScreenClick data:",Pe)}},window.handleMediaScreenClick=function(be){console.log("Direct call to handleMediaScreenClick with ID:",be),Ee(be)},window.TestJavaScriptFromUnity=function(be){console.log("Unity called TestJavaScriptFromUnity with:",be),alert("Unity called JavaScript: "+be)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[Ee]),D.useEffect(()=>{const be=ze=>{try{const Je=JSON.parse(ze.detail);J.log(`MediaScreen registered: ${Je.mediaScreenId}`),Bs("MediaScreen registered from Unity:",Je),l(lt=>lt.some(Rt=>Rt.mediaScreenId===Je.mediaScreenId)?lt.map(Rt=>Rt.mediaScreenId===Je.mediaScreenId?{...Rt,...Je,source:"event",lastUpdated:new Date().toISOString()}:Rt):[...lt,{...Je,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&V("SetMediaScreenEditMode",{mediaScreenId:Je.mediaScreenId,enabled:!0,showUploadIcon:!0});const Ze=Je.mediaScreenId;Ze&&wf(n,Ze).then(lt=>{lt&&(Bs(`Media screen data for ${Ze}:`,lt),lt.displayAsVideo&&lt.videoUrl&&(Bs(`Media screen ${Ze} should display as video, sending null imageUrl`),V("SetMediaScreenImage",{mediaScreenId:Ze,imageUrl:null,displayAsVideo:!0})))}).catch(lt=>{console.error(`Error fetching media screen data for ${Ze}:`,lt)})}catch(Je){console.error("Error handling MediaScreen registration:",Je)}},Pe=ze=>{try{Bs("MediaScreenClick event received:",ze);let Je;if(typeof ze=="string")Je=ze,Bs("MediaScreenClick: Direct call with ID:",Je);else{Bs("MediaScreenClick: Event from Unity:",ze),Bs("MediaScreenClick: Event detail:",ze.detail);try{Je=JSON.parse(ze.detail).mediaScreenId,Bs("MediaScreenClick: Parsed mediaScreenId:",Je)}catch(Ze){if(console.error("MediaScreenClick: Error parsing event detail:",Ze),ze.detail&&ze.detail.mediaScreenId)Je=ze.detail.mediaScreenId,Bs("MediaScreenClick: Using direct mediaScreenId from detail:",Je);else throw new Error("Could not extract mediaScreenId from event")}}J.log(`MediaScreen clicked: ${Je}`),Bs("MediaScreen clicked:",Je),Ee(Je)}catch(Je){console.error("Error handling MediaScreen click:",Je)}},xe=ze=>{if(ze.detail&&ze.detail.eventName==="RegisterMediaScreen")be({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="MediaScreenClick")Pe({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="SetMediaScreenImage")try{const Je=JSON.parse(ze.detail.eventData);Je.mediaScreenId&&(Bs("SetMediaScreenImage event received:",Je),l(Ze=>Array.isArray(Ze)&&Ze.some(nt=>nt.mediaScreenId===Je.mediaScreenId)?Ze.map(nt=>nt.mediaScreenId===Je.mediaScreenId?{...nt,imageUrl:Je.imageUrl,hasImage:!!Je.imageUrl,displayAsVideo:Je.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:nt):[...Array.isArray(Ze)?Ze:[],{mediaScreenId:Je.mediaScreenId,imageUrl:Je.imageUrl,hasImage:!!Je.imageUrl,displayAsVideo:Je.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(Je){console.error("Error handling SetMediaScreenImage event:",Je)}};return window.addEventListener("RegisterMediaScreen",be),window.addEventListener("MediaScreenClick",Pe),window.addEventListener("reactUnityEvent",xe),()=>{window.removeEventListener("RegisterMediaScreen",be),window.removeEventListener("MediaScreenClick",Pe),window.removeEventListener("reactUnityEvent",xe)}},[t,v,V,a,ie,We,de,Ee,n]),D.useEffect(()=>{const be=Pe=>{try{Bs("Direct MediaScreenClick event received:",Pe);let xe;if(Pe.detail)try{xe=JSON.parse(Pe.detail).mediaScreenId}catch(ze){console.error("Error parsing MediaScreenClick event detail:",ze);return}if(!xe){console.error("No mediaScreenId found in MediaScreenClick event");return}Bs(`Direct handler: Processing click for media screen ${xe}`),Ee(xe)}catch(xe){console.error("Error in direct MediaScreenClick handler:",xe)}};return window.addEventListener("MediaScreenClick",be),()=>{window.removeEventListener("MediaScreenClick",be)}},[Ee]),D.useEffect(()=>{se&&$e()},[se,$e]);const Te=()=>{ue(),ve()};return D.useEffect(()=>{const Pe=W("RegisterMediaScreen",xe=>{try{if(J.log("Direct RegisterMediaScreen event received with data:",xe),!xe||!xe.mediaScreenId){J.warn("RegisterMediaScreen event received with invalid data");return}const ze=xe.mediaScreenId;J.log(`Media screen registered directly: ${ze}`),l(Je=>Je.some(lt=>lt.mediaScreenId===ze)?Je.map(lt=>lt.mediaScreenId===ze?{...lt,...xe,source:"direct-event",lastUpdated:new Date().toISOString()}:lt):[...Je,{...xe,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&V("SetMediaScreenEditMode",{mediaScreenId:ze,enabled:!0,showUploadIcon:!0})}catch(ze){console.error("Error handling direct RegisterMediaScreen event:",ze)}});return()=>{Pe()}},[W,t,V]),D.useEffect(()=>{const Pe=W("MediaScreenClick",xe=>{try{if(J.log("Direct MediaScreenClick event received with data:",xe),!xe||!xe.mediaScreenId){J.warn("MediaScreenClick event received with invalid data");return}const ze=xe.mediaScreenId;J.log(`Media screen clicked directly: ${ze}`),Ee(ze)}catch(ze){console.error("Error handling direct MediaScreenClick event:",ze)}});return()=>{Pe()}},[W,Ee]),D.useEffect(()=>{t&&pe&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${pe}`),f(pe),v(),ue())},[t,pe,v,ue]),C.jsxs(C.Fragment,{children:[C.jsx(jWe,{isOpen:y,onClose:b,mediaScreenId:d,onImageChange:ke}),C.jsx($We,{}),C.jsx(Bu,{containerRef:B,children:C.jsxs(Bo,{isOpen:ie,onClose:Y,size:"lg",isCentered:!0,portalProps:{containerRef:B},id:"image-viewer-modal",blockScrollOnMount:!0,children:[C.jsx(Go,{bg:"rgba(0, 0, 0, 0.8)",onClick:Z,onMouseMove:Z,onMouseDown:Z,onMouseUp:Z,onWheel:Z}),C.jsxs(Wo,{ref:X,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:Z,onMouseMove:Z,onMouseDown:Z,onMouseUp:Z,onWheel:Z,children:[C.jsx(ba,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),C.jsx(zo,{p:0,width:"100%",onClick:Z,onMouseMove:Z,onMouseDown:Z,onMouseUp:Z,onWheel:Z,children:ce?C.jsx(St,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:Z,onMouseMove:Z,onMouseDown:Z,onMouseUp:Z,onWheel:Z,children:ne==="image"?C.jsx(Gh,{src:ce,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",ce),onError:be=>console.error("Error loading image:",be,ce),onClick:Z}):C.jsxs(St,{width:"100%",textAlign:"center",onClick:Z,onMouseMove:Z,onMouseDown:Z,onMouseUp:Z,onWheel:Z,children:[C.jsx(at,{mb:4,fontSize:"lg",children:"Video URL:"}),C.jsx(at,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:ce}),C.jsx(at,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):C.jsx(Wi,{direction:"column",align:"center",justify:"center",h:"400px",onClick:Z,onMouseMove:Z,onMouseDown:Z,onMouseUp:Z,onWheel:Z,children:C.jsx(at,{children:"No image available"})})})]})]})}),C.jsx(GWe,{videoUrl:se,videoTitle:me,mediaScreenId:pe,isOpen:We,onClose:Te})]})},Poe=({backgroundUrl:n=null,videoBackgroundUrl:t=null,containerRef:s})=>{const[a,l]=D.useState(!1),[d,f]=D.useState(n),[y,v]=D.useState(t),b=D.useRef(null),w=D.useRef(null),I=D.useRef(null),k=D.useRef(!1),L=D.useRef(!1);D.useEffect(()=>{if(!(k.current||L.current)){if(L.current=!0,console.log(` PersistentBackground: Initializing with props - videoUrl: ${t}, imageUrl: ${n}`),t){console.log(` PersistentBackground: Using provided video URL: ${t}`),B(t),k.current=!0;return}if(n){console.log(` PersistentBackground: No video available, using image: ${n}`),W(n),k.current=!0;return}V()}},[n,t]),D.useEffect(()=>{const ie=ce=>{const{videoBackgroundUrl:ne}=ce.detail;console.log(` PersistentBackground: Received video background update event: ${ne}`),ne&&!k.current&&(B(ne),k.current=!0)};return window.addEventListener("SpaceVideoBackgroundUpdated",ie),()=>{window.removeEventListener("SpaceVideoBackgroundUpdated",ie)}},[]);const V=()=>{const ce=window.location.pathname.match(/\/space\/([^\/]+)/);if(!ce||!ce[1]){console.warn(" PersistentBackground: Couldn't extract space ID from URL");return}const ne=ce[1];console.log(` PersistentBackground: Found space ID: ${ne}`),Nf(ne).then(de=>{if(console.log(` PersistentBackground: Retrieved space data for ${ne}:`,de?"success":"null"),de&&de.videoBackgroundUrl)console.log(` PersistentBackground: VIDEO FOUND: ${de.videoBackgroundUrl}`),B(de.videoBackgroundUrl),k.current=!0;else if(de&&(de.backgroundUrl||de.backgroundGsUrl)){const Y=de.backgroundUrl||de.backgroundGsUrl;console.log(` PersistentBackground: No video available, using image backdrop: ${Y}`),W(Y),k.current=!0}}).catch(de=>{console.error(" PersistentBackground: Error fetching space data:",de)})},B=ie=>{if(!s||!s.current)return;console.log(` PersistentBackground: Setting up video background: ${ie}`),$();const ce=document.createElement("video");I.current=ce,ce.autoplay=!0,ce.loop=!0,ce.muted=!0,ce.playsInline=!0,ce.setAttribute("playsinline",""),ce.setAttribute("webkit-playsinline",""),ce.setAttribute("preload","auto"),ce.src=ie,Object.assign(ce.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),s.current.appendChild(ce),Q(),ce.load();try{ce.play().then(()=>console.log(" VIDEO PLAYING SUCCESSFULLY")).catch(ne=>{console.warn(" First video play attempt failed:",ne);const de=()=>{ce.play().then(()=>console.log(" Video started after user interaction")).catch(Y=>console.error(" Video still failed to play:",Y))};window.addEventListener("click",de,{once:!0}),window.addEventListener("touchstart",de,{once:!0}),setTimeout(()=>{ce.play().then(()=>console.log(" Video started after timeout")).catch(Y=>console.error(" Video still failed to play after timeout:",Y))},1e3)})}catch(ne){console.error(" Error attempting to play video:",ne)}},W=ie=>{if(!s||!s.current||!ie)return;console.log(` PersistentBackground: Setting up image background: ${ie}`);const ce=document.createElement("div");b.current=ce,Object.assign(ce.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`url('${ie}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"19",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),s.current.appendChild(ce),Q()},Q=()=>{if(!s||!s.current)return;const ie=document.createElement("div");w.current=ie,Object.assign(ie.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),s.current.appendChild(ie)},$=()=>{!s||!s.current||(b.current&&s.current.contains(b.current)&&(s.current.removeChild(b.current),b.current=null),I.current&&s.current.contains(I.current)&&(I.current.pause(),I.current.src="",I.current.load(),s.current.removeChild(I.current),I.current=null),w.current&&s.current.contains(w.current)&&(s.current.removeChild(w.current),w.current=null))};return D.useEffect(()=>{if(!s||!s.current)return;const ie=()=>{console.log(" PersistentBackground: Player instantiated, removing background"),l(!0),b.current&&(b.current.style.opacity="0"),I.current&&(I.current.style.opacity="0"),w.current&&(w.current.style.opacity="0"),setTimeout(()=>{$()},1500)};if(window.isPlayerInstantiated){console.log(" PersistentBackground: Player was already instantiated"),ie();return}xd.subscribe(Dd.playerInstantiated,ie),window.addEventListener("PlayerInstantiated",ie);const ce=setTimeout(()=>{console.log(" PersistentBackground: Timeout reached, removing background"),ie()},3e4);return()=>{xd.unsubscribe(Dd.playerInstantiated,ie),window.removeEventListener("PlayerInstantiated",ie),clearTimeout(ce),$()}},[s]),null};Poe.propTypes={backgroundUrl:vn.string,videoBackgroundUrl:vn.string,containerRef:vn.shape({current:vn.instanceOf(Element)})};const dQ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",Ooe=({containerRef:n})=>{const{spaceID:t}=wa(),[s,a]=D.useState(!1),[l,d]=D.useState(!1),[f,y]=D.useState(0),[v,b]=D.useState("Initialising World"),[w,I]=D.useState(null),k=D.useRef(null),L=D.useRef(null),V=D.useRef(null),B=D.useRef(null),W=D.useRef(null),Q=D.useRef(null);D.useEffect(()=>(J.log("PersistentLoader: Component mounted with spaceID:",t),J.log("PersistentLoader: Container ref:",n),()=>{J.log("PersistentLoader: Component unmounting")}),[]);const{error:$}=wa(),[ie,ce]=D.useState(!1);return D.useEffect(()=>{$&&(J.error("PersistentLoader: Unity error detected:",$),ce(!0),setTimeout(()=>{if(k.current){const ne=k.current.querySelector("div:first-child");ne&&(ne.textContent="Reconnecting...")}},3e3))},[$]),D.useEffect(()=>{(async()=>{if(t){J.log(`PersistentLoader: Fetching logo for space ${t}`);try{const de=await Nf(t);de&&de.logoUrl?(J.log(`PersistentLoader: Found logo URL: ${de.logoUrl}`),I(de.logoUrl)):J.log(`PersistentLoader: No logo URL found for space ${t}`)}catch(de){J.error("PersistentLoader: Error fetching space logo:",de)}}else J.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[t]),D.useEffect(()=>{const ne=de=>{const{logoUrl:Y}=de.detail;J.log(`PersistentLoader: Logo update event received with URL: ${Y}`),I(Y),L.current?Y?(J.log("PersistentLoader: Updating logo element with new URL"),L.current.src=Y,V.current.style.display="flex"):(J.log("PersistentLoader: Hiding logo element (no URL)"),V.current.style.display="none"):J.warn("PersistentLoader: Logo ref is null during update")};return J.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",ne),()=>{J.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",ne)}},[]),D.useEffect(()=>{if(!n||!n.current){J.error("PersistentLoader: Container ref is null or has no current property");return}J.log("PersistentLoader: Creating loader elements");const ne=document.createElement("div");if(k.current=ne,Object.assign(ne.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"0"}),w){J.log(`PersistentLoader: Creating logo element with URL: ${w}`);const ve=document.createElement("div");V.current=ve,Object.assign(ve.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"0"});const _e=document.createElement("img");L.current=_e,_e.src=w,_e.alt="Space Logo",_e.style.maxHeight="100px",_e.style.maxWidth="100%",_e.style.objectFit="contain",_e.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",ve.appendChild(_e),n.current.appendChild(ve),J.log("PersistentLoader: Logo container added to main container")}else J.log("PersistentLoader: No logo URL available, skipping logo creation");const de=document.createElement("style");de.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(de),J.log("PersistentLoader: Animation styles added to document head");const Y=document.createElement("div");Y.style.fontSize="16px",Y.style.fontWeight="bold",Y.style.textAlign="center",Y.style.marginBottom="16px",Y.style.color="#ffffff",Y.textContent="Initialising World";const X=document.createElement("div");X.style.width="240px",X.style.height="100px",X.style.position="relative",X.style.marginBottom="15px",X.style.padding="0px",X.style.overflow="hidden",X.style.boxSizing="border-box",X.style.transition="opacity 0.8s ease-in-out",X.style.opacity="0";const Z=document.createElement("div");Z.style.width="100%",Z.style.height="100%",Z.style.position="absolute",Z.style.top="0",Z.style.left="0",Z.style.maskImage=`url(${dQ})`,Z.style.maskSize="contain",Z.style.maskPosition="center",Z.style.maskRepeat="no-repeat",Z.style.webkitMaskImage=`url(${dQ})`,Z.style.webkitMaskSize="contain",Z.style.webkitMaskPosition="center",Z.style.webkitMaskRepeat="no-repeat",Z.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",Z.style.backgroundSize="100% 100%",Z.style.transition="background 0.5s ease-out",B.current=Z,W.current=null,X.appendChild(Z);const se=document.createElement("div");se.style.marginTop="8px",se.style.fontSize="14px",se.style.fontWeight="bold",se.style.color="#ffffff",se.textContent="0%",ne.appendChild(Y),ne.appendChild(X),ne.appendChild(se),n.current.appendChild(ne),J.log("PersistentLoader: Loader element added to container"),setTimeout(()=>{V.current&&(V.current.style.opacity="1"),ne.style.opacity="1",X.style.opacity="1"},500);const me=ve=>{y(ve);const _e=Math.round(ve*100),Ee=`linear-gradient(to right, #4facfe 0%, #00f2fe ${_e}%, white ${_e}%, white 100%)`;Z.style.background=Ee,se.textContent=`${_e}%`,J.log(`PersistentLoader: Progress updated to ${_e}%`)},pe=ve=>{b(ve),Y.textContent=ve,J.log(`PersistentLoader: Loading stage updated to "${ve}"`)},ue=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];ie&&(ue[0].stage="Connecting to Space",ue[1].stage="Reconnecting...",ue[2].stage="Please Wait"),pe(ue[0].stage),me(.25);const Le=ve=>{const _e=ve.detail.progress;J.log(`PersistentLoader: Progress event received with value: ${_e}`),me(_e),_e<.33?pe(ue[0].stage):_e<.66?pe(ue[1].stage):pe(ue[2].stage)},We=()=>{J.log("PersistentLoader: First scene loaded event received"),a(!0),pe(ue[1].stage),me(.66)},$e=()=>{if(J.log("PersistentLoader: Player instantiated event received"),Q.current&&(clearInterval(Q.current),J.log("PersistentLoader: Progress interval cleared")),d(!0),pe(ue[2].stage),me(1),ie){J.log("PersistentLoader: Keeping loader visible due to Unity error");return}ne.style.transition="all 0.5s ease-in-out",X.style.transition="opacity 1.2s ease-in-out",Y.style.transition="opacity 0.4s ease-in-out",se.style.transition="opacity 0.4s ease-in-out",V.current&&(V.current.style.transition="opacity 0.5s ease-in-out"),ne.style.backgroundColor="rgba(0, 0, 0, 0)",ne.style.backdropFilter="blur(0px)",ne.style.WebkitBackdropFilter="blur(0px)",ne.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",ne.style.border="1px solid rgba(255, 255, 255, 0)",Y.style.opacity="0",se.style.opacity="0",V.current&&(V.current.style.opacity="0"),setTimeout(()=>{X.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(ne)?(n.current.removeChild(ne),J.log("PersistentLoader: Loader element removed after fade")):J.warn("PersistentLoader: Could not remove loader element (not found in container)"),V.current&&n.current&&n.current.contains(V.current)?(n.current.removeChild(V.current),J.log("PersistentLoader: Logo container removed after fade")):V.current&&J.warn("PersistentLoader: Could not remove logo container (not found in container)")},1300)},400)};if(window.isPlayerInstantiated)J.log("PersistentLoader: Player was already instantiated"),$e();else{J.log("PersistentLoader: Subscribing to playerInstantiated event"),xd.subscribe(Dd.playerInstantiated,$e);const ve=()=>$e();J.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",ve),J.log("PersistentLoader: Adding firstSceneLoaded event listener"),xd.subscribe(Dd.firstSceneLoaded,We),J.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",Le),Q.current=setInterval(()=>{l||y(Ee=>{const ke=Math.min(Ee+.02,.95);return me(ke),ke<.33&&v!==ue[0].stage?pe(ue[0].stage):ke>=.33&&ke<.66&&v!==ue[1].stage?pe(ue[1].stage):ke>=.66&&v!==ue[2].stage&&pe(ue[2].stage),ke})},300);const _e=setTimeout(()=>{J.log("PersistentLoader: Forcing loader removal after timeout"),$e()},6e4);return()=>{J.log("PersistentLoader: Cleaning up event listeners"),xd.unsubscribe(Dd.playerInstantiated,$e),window.removeEventListener("PlayerInstantiated",ve),xd.unsubscribe(Dd.firstSceneLoaded,We),window.removeEventListener("UnityProgress",Le),clearInterval(Q.current),clearTimeout(_e),n.current&&n.current.contains(ne)&&(n.current.removeChild(ne),J.log("PersistentLoader: Loader element removed during cleanup")),V.current&&n.current&&n.current.contains(V.current)&&(n.current.removeChild(V.current),J.log("PersistentLoader: Logo container removed during cleanup"))}}},[w,n]),null};Ooe.propTypes={containerRef:vn.shape({current:vn.instanceOf(Element)})};const k0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,K4=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],t=a=>{if(n.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=a.target.closest("canvas")||a.target.closest("#webgl-root"),y=document.activeElement===d;!l&&(f||y)&&a.preventDefault()}},s=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",t),document.addEventListener("click",s),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",t),document.removeEventListener("click",s)}},koe=()=>{document.body.classList.remove("unity-focused")};function s1(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?K4():koe(),new Promise(t=>{try{const s=k0();if(s){try{n?s.SendMessage("WebGLInput","EnableKeyboardCapture"):s.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),t(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{s.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),t(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(s.Module){!n&&s.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=s.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(s.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(s.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),t(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),ZV(n)),t(!1)}catch(s){console.error("Error setting Unity keyboard capture:",s),t(!1)}})}function ZV(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const t=20;let s=0;const a=()=>{s++;const l=k0();if(l){console.log(`Unity instance found after ${s} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Failed to apply pending keyboard state with fallback method",f)}}}else if(s<t){const d=Math.min(500*Math.pow(1.2,s),5e3);console.log(`Unity instance not found (attempt ${s}/${t}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(a,d)}else console.warn(`Unity instance still not found after ${t} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function qWe(){const n=k0();if(!n)return!1;const t=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(t&&document.activeElement===t||n.Module&&n.Module.WebGLInputHandler)}function IS(n=!0){return console.log("Focusing Unity canvas"),n?K4():koe(),new Promise(t=>{try{const s=document.querySelector("canvas")||document.getElementById("unity-canvas");if(s){try{s.focus({preventScroll:!0})}catch{s.focus()}if(s.style.pointerEvents="auto",n){s1(!0).then(t);return}t(!0)}else console.warn("Unity canvas not found"),t(!1)}catch(s){console.error("Error focusing Unity canvas:",s),t(!1)}})}function zS(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),K4(),new Promise(t=>{try{if(n)s1(!1).then(s=>{var d;s&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=k0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),t(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const s=k0();s!=null&&s.Module&&window._savedWebGLInputHandler&&(s.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),s1(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),t(!0)})}}catch(s){console.error("Error in blockUnityKeyboardInput:",s),t(!1)}})}function YWe(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const t=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${t}`);try{t?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${t} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(s){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",s);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",t),console.log(`Applied pending keyboard state: ${t} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(t){console.error("Error applying pending keyboard state:",t)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function XWe(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=s1,window.focusUnity=IS,window.blockUnityKeyboardInput=zS,window.hasUnityKeyboardFocus=qWe,window.getUnityInstance=k0,window.registerUnityInstance=YWe,document.getElementById("webgl-root")){const n=new MutationObserver(t=>{for(const s of t)if(s.addedNodes.length)for(let a=0;a<s.addedNodes.length;a++){const l=s.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),ZV(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),ZV(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[s,a]=n.useState(!1);return n.useEffect(()=>(s?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),zS(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),zS(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{s&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),zS(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[s]),[s,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(XWe,0);const JWe=({size:n="md",tooltipPlacement:t="top",className:s="livestream-button"})=>{const[a,l]=D.useState(!1),[d,f]=D.useState(!1),{savedStreamData:y,reloadStreamData:v}=toe(),{spaceID:b}=wa(),{user:w}=D.useContext(Cc),I=hl(),[k,L]=D.useState(!1),V=aK((y==null?void 0:y.rtmpUrl)||""),B=aK((y==null?void 0:y.streamKey)||"");D.useEffect(()=>{if(b){J.log("LiveStreamButton: Forcing reload of stream data"),v();const $=()=>{J.log("LiveStreamButton: Stream settings changed, reloading data"),v()};return window.addEventListener("StreamSettingsChanged",$),()=>{window.removeEventListener("StreamSettingsChanged",$)}}},[b,v]),D.useEffect(()=>{(async()=>{if(!(w!=null&&w.uid)||!b){L(!1);return}try{const ie=await X5e(w.uid,"disruptiveAdmin"),ce=await eBe(w,b);L(ie||ce)}catch(ie){J.error("Error checking user permissions:",ie),L(!1)}})()},[w==null?void 0:w.uid,b]),D.useEffect(()=>{J.log("LiveStreamButton: Current streaming data:",{enabled:y==null?void 0:y.enabled,hasRtmpUrl:!!(y!=null&&y.rtmpUrl),hasStreamKey:!!(y!=null&&y.streamKey),hasPermission:k,isPlayerReady:d})},[y,k,d]),D.useEffect(()=>{const $=()=>{J.log("LiveStreamButton: Player instantiated, showing button"),f(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(J.log("LiveStreamButton: Player was already instantiated"),f(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const W=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},Q=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!d||!k||(y==null?void 0:y.enabled)!==!0?(J.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!d,noPermission:!k,streamingDisabled:(y==null?void 0:y.enabled)!==!0,enabledValue:y==null?void 0:y.enabled}),null):C.jsxs(C.Fragment,{children:[C.jsx(Pf,{label:"Live Stream Info",placement:t,hasArrow:!0,children:C.jsx(sp,{size:n,borderRadius:"full",bg:"black",icon:C.jsx(rWe,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:s,"data-testid":"livestream-button",cursor:"pointer",onClick:W})}),C.jsxs(Bo,{isOpen:a,onClose:Q,isCentered:!0,size:"md",children:[C.jsx(Go,{backdropFilter:"blur(4px)"}),C.jsxs(Wo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[C.jsx(wc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),C.jsx(ba,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(zo,{p:4,children:y!=null&&y.rtmpUrl&&(y!=null&&y.streamKey)?C.jsxs(St,{children:[C.jsx(at,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),C.jsxs(St,{mb:4,children:[C.jsx(at,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),C.jsx(Wi,{children:C.jsxs(Iy,{size:"sm",children:[C.jsx(es,{value:y.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),C.jsx(kk,{children:C.jsx(Fo,{"aria-label":"Copy RTMP URL",icon:V.hasCopied?C.jsx(iQ,{}):C.jsx(sQ,{}),size:"xs",colorScheme:V.hasCopied?"green":"blue",onClick:()=>{V.onCopy(),I({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),C.jsxs(St,{mb:4,children:[C.jsx(at,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),C.jsx(Wi,{children:C.jsxs(Iy,{size:"sm",children:[C.jsx(es,{value:y.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),C.jsx(kk,{children:C.jsx(Fo,{"aria-label":"Copy Stream Key",icon:B.hasCopied?C.jsx(iQ,{}):C.jsx(sQ,{}),size:"xs",colorScheme:B.hasCopied?"green":"blue",onClick:()=>{B.onCopy(),I({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),C.jsx(at,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):C.jsxs(St,{textAlign:"center",p:4,children:[C.jsx(at,{color:"white",children:"No stream configuration found for this space."}),C.jsx(at,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})},Noe=({settings:n})=>{const{placePrefab:t,directPlacePrefab:s,isUnityLoaded:a}=ioe(),l=hl(),[d,f]=D.useState({x:0,y:1,z:0}),[y,v]=D.useState({x:0,y:0,z:0}),[b,w]=D.useState({x:1,y:1,z:1}),[I,k]=D.useState("TestPrefab"),[L,V]=D.useState(!1),[B,W]=D.useState(!1),[Q,$]=D.useState(!1),{user:ie}=D.useContext(Cc),ce=n==null?void 0:n.spaceID,{saveObject:ne,isLoading:de}=Z6e(ce);D.useEffect(()=>{(async()=>{if(ie!=null&&ie.uid)try{const me=await N4(ie.uid,"disruptiveAdmin");$(me)}catch(me){console.error("Error checking admin status:",me),$(!1)}})()},[ie==null?void 0:ie.uid]),D.useEffect(()=>{const se=me=>{W(me.detail.enabled)};return window.addEventListener("editModeChanged",se),()=>{window.removeEventListener("editModeChanged",se)}},[]);const Y=(se,me)=>{f(pe=>({...pe,[se]:parseFloat(me)}))},X=async()=>{J.log("Placing prefab with values:",{prefabName:I,position:d,rotation:y,scale:b,useDirect:L,spaceId:ce});let se;if(L?(se=s(I,d,y,b),J.log("Used direct method to place prefab")):(se=t(I,d,y,b),J.log("Used hook method to place prefab")),se)if(ce&&B){const me=await ne(I,d,y,b);l(me?{title:"Success",description:"Prefab placed and saved to space",status:"success",duration:3e3,isClosable:!0}:{title:"Warning",description:"Prefab placed but failed to save to space",status:"warning",duration:3e3,isClosable:!0})}else l({title:"Success",description:"Prefab placed",status:"success",duration:3e3,isClosable:!0});else l({title:"Error",description:"Failed to place prefab",status:"error",duration:3e3,isClosable:!0})},Z=()=>{const se={x:(Math.random()*10-5).toFixed(2),y:(Math.random()*2).toFixed(2),z:(Math.random()*10-5).toFixed(2)};f({x:parseFloat(se.x),y:parseFloat(se.y),z:parseFloat(se.z)}),J.log("Set random position:",se)};return!B||!Q?null:C.jsxs(St,{className:"prefab-placer",bg:"rgba(0, 0, 0, 0.7)",color:"white",p:4,borderRadius:"md",maxW:"300px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",children:[C.jsx(at,{fontWeight:"bold",mb:2,children:"Place Prefab in Unity"}),C.jsxs(St,{mb:3,children:[C.jsx(at,{fontSize:"sm",children:"Prefab Name:"}),C.jsx("input",{type:"text",value:I,onChange:se=>k(se.target.value),style:{width:"100%",padding:"8px",marginTop:"4px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"4px",color:"white"}})]}),C.jsxs(Wi,{direction:"column",gap:2,mb:3,children:[C.jsx(at,{fontSize:"sm",children:"Position:"}),C.jsxs(Wi,{gap:2,children:[C.jsxs(St,{children:[C.jsx(at,{fontSize:"xs",children:"X"}),C.jsxs(JO,{value:d.x,onChange:se=>Y("x",se),step:.5,precision:2,size:"sm",children:[C.jsx(ZO,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),C.jsxs(QO,{children:[C.jsx(tk,{}),C.jsx(ek,{})]})]})]}),C.jsxs(St,{children:[C.jsx(at,{fontSize:"xs",children:"Y"}),C.jsxs(JO,{value:d.y,onChange:se=>Y("y",se),step:.5,precision:2,size:"sm",children:[C.jsx(ZO,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),C.jsxs(QO,{children:[C.jsx(tk,{}),C.jsx(ek,{})]})]})]}),C.jsxs(St,{children:[C.jsx(at,{fontSize:"xs",children:"Z"}),C.jsxs(JO,{value:d.z,onChange:se=>Y("z",se),step:.5,precision:2,size:"sm",children:[C.jsx(ZO,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),C.jsxs(QO,{children:[C.jsx(tk,{}),C.jsx(ek,{})]})]})]})]}),C.jsx(Lr,{onClick:Z,size:"xs",colorScheme:"blue",variant:"outline",mt:1,children:"Random Position"})]}),C.jsxs(hi,{display:"flex",alignItems:"center",mb:3,children:[C.jsx(Zs,{htmlFor:"use-direct",mb:"0",fontSize:"sm",children:"Use Direct Method"}),C.jsx(Zh,{id:"use-direct",colorScheme:"green",isChecked:L,onChange:se=>V(se.target.checked)})]}),C.jsx(Lr,{onClick:X,colorScheme:"green",width:"100%",isDisabled:!a||de,children:de?"Loading...":"Place Prefab"}),!a&&C.jsx(at,{fontSize:"xs",color:"red.300",mt:1,children:"Waiting for Unity to load..."}),!ce&&C.jsx(at,{fontSize:"xs",color:"yellow.300",mt:1,children:"No space ID available - prefabs won't be saved"})]})};Noe.propTypes={settings:vn.shape({spaceID:vn.string})};const QWe="9442a472625f44e7b2c5065b9f9b3988",hU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),q4=D.forwardRef(({settings:n},t)=>{const{unityProvider:s,isLoaded:a,error:l}=wa(),d=U6e();F6e();const f=dp(),y=e8e(d),{user:v}=D.useContext(Cc),[b,w]=D.useState(!1),[I,k]=D.useState(window.devicePixelRatio),[L,V]=V6e();roe().find(ke=>ke.isLocalPlayer);const[W,Q]=D.useState(!0),[$,ie]=D.useState(!0),[ce,ne]=D.useState(!1),[de,Y]=D.useState(!1),[X,Z]=D.useState(!1);D.useEffect(()=>{X?(console.log("WebGLRenderer: Modal opened, disabling Unity keyboard capture"),zS(!0)):(console.log("WebGLRenderer: Modal closed, enabling Unity keyboard capture"),a&&!de&&zS(!1).then(()=>{setTimeout(()=>{IS(!0)},100)}))},[X,a,de]);const se=n.spaceID||"default",me=D.useMemo(()=>{const be=new URLSearchParams(window.location.search).get("sessionId")||se;return console.log("WebGLRenderer: Using session ID:",be),be},[se]),[pe,ue]=D.useState(null);D.useEffect(()=>{v!=null&&v.uid&&Fu(v.uid).then(ke=>{ue(ke),console.log("WebGLRenderer: User profile loaded:",(ke==null?void 0:ke.Nickname)||"Unknown")}).catch(ke=>{console.error("Error fetching user profile:",ke)})},[v==null?void 0:v.uid]),D.useEffect(()=>{if(l||!v){J.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const ke=setTimeout(()=>{Y(!0),Z(!0)},1e3);return()=>clearTimeout(ke)}else Y(!1)},[l,v]),D.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const ke=()=>{console.log("WebGLRenderer: Player instantiated event received"),ie(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),ie(!0)),xd.subscribe(Dd.playerInstantiated,ke);const Te=setTimeout(()=>{$||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),ie(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{xd.unsubscribe(Dd.playerInstantiated,ke),clearTimeout(Te)}},[$]),D.useEffect(()=>{const ke=()=>{console.log("WebGLRenderer: Modal opened"),Z(!0)},Te=()=>{console.log("WebGLRenderer: Modal closed"),Z(!1)};return window.addEventListener("modal-opened",ke),window.addEventListener("modal-closed",Te),()=>{window.removeEventListener("modal-opened",ke),window.removeEventListener("modal-closed",Te)}},[]),D.useEffect(()=>{Z(L!==null)},[L]),D.useEffect(()=>{a||d?setTimeout(()=>{w(!0),J.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):J.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),D.useEffect(()=>{a&&s&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(ke){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",ke)}},1e3)},[a,s]),D.useEffect(()=>{const ke=document.getElementById("webgl-root");return ke?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),ke.style.display="block",ke.getAttribute("data-space-id")!==se&&(ke.setAttribute("data-space-id",se),console.log(`WebGLRenderer: Set data-space-id attribute to ${se}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[se]),D.useEffect(()=>{const ke=()=>{const Pe=hU();Pe?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Pe.tabIndex=1,Pe.style.outline="none",Pe.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),X||IS(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};ke();const Te=setTimeout(ke,1e3),be=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),ke()};return window.addEventListener("unityReady",be),()=>{clearTimeout(Te),window.removeEventListener("unityReady",be)}},[a,X]);const Le=D.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),X||IS(!0)},[X]);D.useEffect(()=>{if(a&&s){const ke=hU();if(ke)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),ke.addEventListener("click",Le),()=>{ke.removeEventListener("click",Le)}}},[a,s,Le]),D.useEffect(()=>{if(a&&s){console.log("WebGLRenderer: Setting up global click handler for focus management");const ke=Te=>{if(X){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(Te.target.tagName==="INPUT"||Te.target.tagName==="TEXTAREA"||Te.target.tagName==="SELECT"||Te.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(Te.target.closest(".chakra-modal__content")||Te.target.closest('[role="dialog"]')||Te.target.closest('[role="menu"]')||Te.target.closest(".chakra-popover__content")||Te.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const be=hU();if(be&&(Te.target===be||be.contains(Te.target)))return;if(Te.target.closest(".webgl-overlay")||Te.target.closest(".game-ui")||Te.target.closest(".player-list")||Te.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{X||IS(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{be&&!X&&((be.tabIndex===void 0||be.tabIndex<0)&&(be.tabIndex=1),be.focus(),IS(!0))},50)};return document.addEventListener("click",ke,!0),()=>{document.removeEventListener("click",ke,!0)}}},[a,s,X]),D.useEffect(()=>{const ke=Te=>{J.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",Te)};return xd.subscribe(Dd.sendUserToUnity,ke),()=>xd.unsubscribe(Dd.sendUserToUnity,ke)},[f]);const{setFullscreenRef:We,fullscreenRef:$e}=Vd();D.useEffect(()=>{We(t.current)},[t,We]);const ve=()=>{Q(!W)},_e=v&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:$,showVoiceChat:_e,sessionId:me}),D.useEffect(()=>{const ke=Te=>{ne(Te.detail.enabled)};return window.addEventListener("editModeChanged",ke),()=>{window.removeEventListener("editModeChanged",ke)}},[]),noe(),z6e();const Ee=D.useRef(null);return C.jsxs(St,{className:"webgl-renderer",children:[n.urlLoadingBackground&&C.jsx(Poe,{backgroundUrl:n.urlLoadingBackground,videoBackgroundUrl:n.videoBackgroundUrl,containerRef:Ee}),!de&&C.jsx(Ooe,{containerRef:Ee}),de&&C.jsx(St,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:C.jsx($4,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),C.jsx(SF,{containerRef:$e.current?$e:document.body,children:C.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[C.jsxs(St,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&C.jsx(j8e,{}),v&&C.jsx(JWe,{size:"md"}),_e&&C.jsxs(Coe,{appId:QWe,channel:me,uid:v==null?void 0:v.uid,enabled:!0,children:[C.jsx(yWe,{size:"md",defaultMuted:!0,joinOnClick:!0}),C.jsx(vWe,{userNickname:pe==null?void 0:pe.Nickname})]}),C.jsx(sWe,{}),C.jsx(St,{position:"relative",zIndex:"9999",children:C.jsx(FWe,{onTogglePlayerList:ve,spaceID:se})})]}),C.jsxs(St,{ref:Ee,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[C.jsx(St,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),C.jsx(St,{...y,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:s?C.jsx(eoe.Unity,{unityProvider:s,style:{width:"100%",height:"100%"},devicePixelRatio:I,tabIndex:1}):C.jsx(St,{width:"100%",height:"100%"})}),C.jsx(St,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:C.jsx(F8e,{})})]}),C.jsx(St,{...y,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&C.jsx(Gh,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),C.jsx(St,{...y,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3,children:v&&C.jsx(Noe,{settings:n})}),C.jsxs(St,{...y,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&C.jsx(B8e,{}),C.jsx(cWe,{})]}),C.jsx(lWe,{}),C.jsx(uWe,{isOpen:L!==null,onClose:()=>{console.log(" Closing nameplate modal"),V()},playerName:(L==null?void 0:L.playerName)||"Unknown Player",playerId:(L==null?void 0:L.playerId)||"Unknown ID"}),C.jsx(dWe,{isVisible:W,onToggleVisibility:Q,spaceID:se}),C.jsx(KWe,{})]})})]})});q4.displayName="WebGLRenderer";q4.propTypes={settings:vn.shape({urlLoadingBackground:vn.string,videoBackgroundUrl:vn.string,showAuthButton:vn.bool,showDisruptiveLogo:vn.bool,urlDisruptiveLogo:vn.string,showHelpButton:vn.bool,enableVoiceChat:vn.bool,spaceID:vn.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:t=>(console.log("HISPlayer: mute called with state:",t),!0),isMuted:!1,seek:t=>(console.log("HISPlayer: seek called with time:",t),!0),setVolume:t=>(console.log("HISPlayer: setVolume called with volume:",t),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:t=>(console.log("HISPlayer: setUnityContext called with:",t),window.hisPlayerContextId=t,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:t=>(console.log("HISPlayer: setProperties called with:",t),!0),setMultiPaths:t=>(console.log("HISPlayer: setMultiPaths called with:",t),window._hisplayer_paths=t,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(J.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),J.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const t=new window.MultipleView;if(t&&t.multiView&&typeof t.multiView.setUnityContext=="function")return t.multiView.setUnityContext(n),window._hisplayer_instance=t,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:a=>(window.hisPlayerContextId=a,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const t=new window.MultipleView;return t.multiView.setUnityContext(n),window._hisplayer_instance=t,!0}}catch(t){console.error("HISPlayer: Error in setUpContext:",t);const s=document.getElementById("hisplayer-error");s&&(s.innerHTML="Error: "+t.message)}return!1}}const Doe=({spaceID:n,overrideSettings:t})=>{const s=D.useRef(null),[a,l]=D.useState(!0),[d,f]=D.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[y,v]=D.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",videoBackgroundUrl:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return D.useEffect(()=>{(async()=>{try{const w=await Nf(n);if(w){console.log("Space data: ",w),f(V=>({...V,spaceID:n,loaderUrl:w.loaderUrl,dataUrl:w.dataUrl,frameworkUrl:w.frameworkUrl,codeUrl:w.codeUrl}));const I=await pk(y.urlDisruptiveLogo);let k="";if(w.backgroundUrl)k=w.backgroundUrl;else if(w.backgroundGsUrl)try{k=await pk(w.backgroundGsUrl)}catch(V){J.warn("WebGLLoader: Error fetching background from GS URL:",V)}else if(w.gsUrlLoadingBackground)try{k=await pk(w.gsUrlLoadingBackground)}catch(V){J.warn("WebGLLoader: Error fetching background from legacy GS URL:",V)}let L="";w.videoBackgroundUrl&&(L=w.videoBackgroundUrl,console.log("WebGLLoader: Found video background URL:",L)),v(V=>({...V,urlLoadingBackground:k,videoBackgroundUrl:L,showAuthButton:w.showAuthButton!==void 0?w.showAuthButton:!0,showDisruptiveLogo:w.showDisruptiveLogo!==void 0?w.showDisruptiveLogo:!0,showHelpButton:w.showHelpButton!==void 0?w.showHelpButton:!0,enableVoiceChat:w.enableVoiceChat!==void 0?w.enableVoiceChat:!0,urlDisruptiveLogo:I,spaceID:n,...t||{}})),L&&(console.log("WebGLLoader: Dispatching video background event with URL:",L),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:L}}))),l(!1)}else J.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(w){J.error("WebGLLoader: Error fetching space data:",w)}finally{l(!1)}})()},[n,y.urlDisruptiveLogo,t]),D.useEffect(()=>{a||(J.log("WebGLLoader: Unity config from Firebase",d),J.log("WebGLLoader: Space settings from Firebase",y))},[a]),C.jsx(C.Fragment,{children:a?C.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):C.jsx(M6e,{...d,children:C.jsx(q4,{ref:s,settings:y})})})};Doe.propTypes={spaceID:vn.string.isRequired,overrideSettings:vn.object};function hQ(){const n=document.getElementById("webgl-root");if(n){const t=n.getAttribute("data-space-id"),s=n.getAttribute("data-theme")||"default",a=()=>{const[l,d]=D.useState(null);return D.useEffect(()=>{xMe(s).then(d)},[]),l?C.jsx(L1e,{theme:l,children:C.jsx(C6e,{children:C.jsx(R6e,{children:C.jsx(Doe,{spaceID:t})})})}):C.jsx("div",{children:"Loading theme..."})};try{Sye.createRoot(n).render(C.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",hQ):hQ());export{Mye as a,cSe as b,zi as c,sSe as d,eze as e,ZWe as f,Jve as g,Du as i,zh as m,oRe as t};
