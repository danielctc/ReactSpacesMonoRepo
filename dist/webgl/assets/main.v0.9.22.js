function $0e(t,e){for(var r=0;r<e.length;r++){const o=e[r];if(typeof o!="string"&&!Array.isArray(o)){for(const a in o)if(a!=="default"&&!(a in t)){const u=Object.getOwnPropertyDescriptor(o,a);u&&Object.defineProperty(t,a,u.get?u:{enumerable:!0,get:()=>o[a]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var j_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function HT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var iV={exports:{}},Cw={},sV={exports:{}},$r={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uX;function Y0e(){if(uX)return $r;uX=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),d=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),E=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),C=Symbol.iterator;function I(ve){return ve===null||typeof ve!="object"?null:(ve=C&&ve[C]||ve["@@iterator"],typeof ve=="function"?ve:null)}var D={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},L=Object.assign,B={};function G(ve,Be,gt){this.props=ve,this.context=Be,this.refs=B,this.updater=gt||D}G.prototype.isReactComponent={},G.prototype.setState=function(ve,Be){if(typeof ve!="object"&&typeof ve!="function"&&ve!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ve,Be,"setState")},G.prototype.forceUpdate=function(ve){this.updater.enqueueForceUpdate(this,ve,"forceUpdate")};function se(){}se.prototype=G.prototype;function ae(ve,Be,gt){this.props=ve,this.context=Be,this.refs=B,this.updater=gt||D}var M=ae.prototype=new se;M.constructor=ae,L(M,G.prototype),M.isPureReactComponent=!0;var F=Array.isArray,z=Object.prototype.hasOwnProperty,te={current:null},j={key:!0,ref:!0,__self:!0,__source:!0};function K(ve,Be,gt){var ze,_t={},Dt=null,jt=null;if(Be!=null)for(ze in Be.ref!==void 0&&(jt=Be.ref),Be.key!==void 0&&(Dt=""+Be.key),Be)z.call(Be,ze)&&!j.hasOwnProperty(ze)&&(_t[ze]=Be[ze]);var Zt=arguments.length-2;if(Zt===1)_t.children=gt;else if(1<Zt){for(var Xt=Array(Zt),In=0;In<Zt;In++)Xt[In]=arguments[In+2];_t.children=Xt}if(ve&&ve.defaultProps)for(ze in Zt=ve.defaultProps,Zt)_t[ze]===void 0&&(_t[ze]=Zt[ze]);return{$$typeof:t,type:ve,key:Dt,ref:jt,props:_t,_owner:te.current}}function Q(ve,Be){return{$$typeof:t,type:ve.type,key:Be,ref:ve.ref,props:ve.props,_owner:ve._owner}}function ce(ve){return typeof ve=="object"&&ve!==null&&ve.$$typeof===t}function Ee(ve){var Be={"=":"=0",":":"=2"};return"$"+ve.replace(/[=:]/g,function(gt){return Be[gt]})}var _e=/\/+/g;function pe(ve,Be){return typeof ve=="object"&&ve!==null&&ve.key!=null?Ee(""+ve.key):Be.toString(36)}function qe(ve,Be,gt,ze,_t){var Dt=typeof ve;(Dt==="undefined"||Dt==="boolean")&&(ve=null);var jt=!1;if(ve===null)jt=!0;else switch(Dt){case"string":case"number":jt=!0;break;case"object":switch(ve.$$typeof){case t:case e:jt=!0}}if(jt)return jt=ve,_t=_t(jt),ve=ze===""?"."+pe(jt,0):ze,F(_t)?(gt="",ve!=null&&(gt=ve.replace(_e,"$&/")+"/"),qe(_t,Be,gt,"",function(In){return In})):_t!=null&&(ce(_t)&&(_t=Q(_t,gt+(!_t.key||jt&&jt.key===_t.key?"":(""+_t.key).replace(_e,"$&/")+"/")+ve)),Be.push(_t)),1;if(jt=0,ze=ze===""?".":ze+":",F(ve))for(var Zt=0;Zt<ve.length;Zt++){Dt=ve[Zt];var Xt=ze+pe(Dt,Zt);jt+=qe(Dt,Be,gt,Xt,_t)}else if(Xt=I(ve),typeof Xt=="function")for(ve=Xt.call(ve),Zt=0;!(Dt=ve.next()).done;)Dt=Dt.value,Xt=ze+pe(Dt,Zt++),jt+=qe(Dt,Be,gt,Xt,_t);else if(Dt==="object")throw Be=String(ve),Error("Objects are not valid as a React child (found: "+(Be==="[object Object]"?"object with keys {"+Object.keys(ve).join(", ")+"}":Be)+"). If you meant to render a collection of children, use an array instead.");return jt}function St(ve,Be,gt){if(ve==null)return ve;var ze=[],_t=0;return qe(ve,ze,"","",function(Dt){return Be.call(gt,Dt,_t++)}),ze}function ke(ve){if(ve._status===-1){var Be=ve._result;Be=Be(),Be.then(function(gt){(ve._status===0||ve._status===-1)&&(ve._status=1,ve._result=gt)},function(gt){(ve._status===0||ve._status===-1)&&(ve._status=2,ve._result=gt)}),ve._status===-1&&(ve._status=0,ve._result=Be)}if(ve._status===1)return ve._result.default;throw ve._result}var Ne={current:null},Re={transition:null},Ve={ReactCurrentDispatcher:Ne,ReactCurrentBatchConfig:Re,ReactCurrentOwner:te};return $r.Children={map:St,forEach:function(ve,Be,gt){St(ve,function(){Be.apply(this,arguments)},gt)},count:function(ve){var Be=0;return St(ve,function(){Be++}),Be},toArray:function(ve){return St(ve,function(Be){return Be})||[]},only:function(ve){if(!ce(ve))throw Error("React.Children.only expected to receive a single React element child.");return ve}},$r.Component=G,$r.Fragment=r,$r.Profiler=a,$r.PureComponent=ae,$r.StrictMode=o,$r.Suspense=g,$r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ve,$r.cloneElement=function(ve,Be,gt){if(ve==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ve+".");var ze=L({},ve.props),_t=ve.key,Dt=ve.ref,jt=ve._owner;if(Be!=null){if(Be.ref!==void 0&&(Dt=Be.ref,jt=te.current),Be.key!==void 0&&(_t=""+Be.key),ve.type&&ve.type.defaultProps)var Zt=ve.type.defaultProps;for(Xt in Be)z.call(Be,Xt)&&!j.hasOwnProperty(Xt)&&(ze[Xt]=Be[Xt]===void 0&&Zt!==void 0?Zt[Xt]:Be[Xt])}var Xt=arguments.length-2;if(Xt===1)ze.children=gt;else if(1<Xt){Zt=Array(Xt);for(var In=0;In<Xt;In++)Zt[In]=arguments[In+2];ze.children=Zt}return{$$typeof:t,type:ve.type,key:_t,ref:Dt,props:ze,_owner:jt}},$r.createContext=function(ve){return ve={$$typeof:d,_currentValue:ve,_currentValue2:ve,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ve.Provider={$$typeof:u,_context:ve},ve.Consumer=ve},$r.createElement=K,$r.createFactory=function(ve){var Be=K.bind(null,ve);return Be.type=ve,Be},$r.createRef=function(){return{current:null}},$r.forwardRef=function(ve){return{$$typeof:f,render:ve}},$r.isValidElement=ce,$r.lazy=function(ve){return{$$typeof:T,_payload:{_status:-1,_result:ve},_init:ke}},$r.memo=function(ve,Be){return{$$typeof:E,type:ve,compare:Be===void 0?null:Be}},$r.startTransition=function(ve){var Be=Re.transition;Re.transition={};try{ve()}finally{Re.transition=Be}},$r.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},$r.useCallback=function(ve,Be){return Ne.current.useCallback(ve,Be)},$r.useContext=function(ve){return Ne.current.useContext(ve)},$r.useDebugValue=function(){},$r.useDeferredValue=function(ve){return Ne.current.useDeferredValue(ve)},$r.useEffect=function(ve,Be){return Ne.current.useEffect(ve,Be)},$r.useId=function(){return Ne.current.useId()},$r.useImperativeHandle=function(ve,Be,gt){return Ne.current.useImperativeHandle(ve,Be,gt)},$r.useInsertionEffect=function(ve,Be){return Ne.current.useInsertionEffect(ve,Be)},$r.useLayoutEffect=function(ve,Be){return Ne.current.useLayoutEffect(ve,Be)},$r.useMemo=function(ve,Be){return Ne.current.useMemo(ve,Be)},$r.useReducer=function(ve,Be,gt){return Ne.current.useReducer(ve,Be,gt)},$r.useRef=function(ve){return Ne.current.useRef(ve)},$r.useState=function(ve){return Ne.current.useState(ve)},$r.useSyncExternalStore=function(ve,Be,gt){return Ne.current.useSyncExternalStore(ve,Be,gt)},$r.useTransition=function(){return Ne.current.useTransition()},$r.version="18.2.0",$r}var lX;function Cd(){return lX||(lX=1,sV.exports=Y0e()),sV.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dX;function X0e(){if(dX)return Cw;dX=1;var t=Cd(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function d(f,g,E){var T,C={},I=null,D=null;E!==void 0&&(I=""+E),g.key!==void 0&&(I=""+g.key),g.ref!==void 0&&(D=g.ref);for(T in g)o.call(g,T)&&!u.hasOwnProperty(T)&&(C[T]=g[T]);if(f&&f.defaultProps)for(T in g=f.defaultProps,g)C[T]===void 0&&(C[T]=g[T]);return{$$typeof:e,type:f,key:I,ref:D,props:C,_owner:a.current}}return Cw.Fragment=r,Cw.jsx=d,Cw.jsxs=d,Cw}var hX;function J0e(){return hX||(hX=1,iV.exports=X0e()),iV.exports}var $=J0e(),X=Cd();const Di=HT(X),fX=$0e({__proto__:null,default:Di},[X]);var nP={},oV={exports:{}},Qu={},aV={exports:{}},cV={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pX;function Q0e(){return pX||(pX=1,function(t){function e(Re,Ve){var ve=Re.length;Re.push(Ve);e:for(;0<ve;){var Be=ve-1>>>1,gt=Re[Be];if(0<a(gt,Ve))Re[Be]=Ve,Re[ve]=gt,ve=Be;else break e}}function r(Re){return Re.length===0?null:Re[0]}function o(Re){if(Re.length===0)return null;var Ve=Re[0],ve=Re.pop();if(ve!==Ve){Re[0]=ve;e:for(var Be=0,gt=Re.length,ze=gt>>>1;Be<ze;){var _t=2*(Be+1)-1,Dt=Re[_t],jt=_t+1,Zt=Re[jt];if(0>a(Dt,ve))jt<gt&&0>a(Zt,Dt)?(Re[Be]=Zt,Re[jt]=ve,Be=jt):(Re[Be]=Dt,Re[_t]=ve,Be=_t);else if(jt<gt&&0>a(Zt,ve))Re[Be]=Zt,Re[jt]=ve,Be=jt;else break e}}return Ve}function a(Re,Ve){var ve=Re.sortIndex-Ve.sortIndex;return ve!==0?ve:Re.id-Ve.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var d=Date,f=d.now();t.unstable_now=function(){return d.now()-f}}var g=[],E=[],T=1,C=null,I=3,D=!1,L=!1,B=!1,G=typeof setTimeout=="function"?setTimeout:null,se=typeof clearTimeout=="function"?clearTimeout:null,ae=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function M(Re){for(var Ve=r(E);Ve!==null;){if(Ve.callback===null)o(E);else if(Ve.startTime<=Re)o(E),Ve.sortIndex=Ve.expirationTime,e(g,Ve);else break;Ve=r(E)}}function F(Re){if(B=!1,M(Re),!L)if(r(g)!==null)L=!0,ke(z);else{var Ve=r(E);Ve!==null&&Ne(F,Ve.startTime-Re)}}function z(Re,Ve){L=!1,B&&(B=!1,se(K),K=-1),D=!0;var ve=I;try{for(M(Ve),C=r(g);C!==null&&(!(C.expirationTime>Ve)||Re&&!Ee());){var Be=C.callback;if(typeof Be=="function"){C.callback=null,I=C.priorityLevel;var gt=Be(C.expirationTime<=Ve);Ve=t.unstable_now(),typeof gt=="function"?C.callback=gt:C===r(g)&&o(g),M(Ve)}else o(g);C=r(g)}if(C!==null)var ze=!0;else{var _t=r(E);_t!==null&&Ne(F,_t.startTime-Ve),ze=!1}return ze}finally{C=null,I=ve,D=!1}}var te=!1,j=null,K=-1,Q=5,ce=-1;function Ee(){return!(t.unstable_now()-ce<Q)}function _e(){if(j!==null){var Re=t.unstable_now();ce=Re;var Ve=!0;try{Ve=j(!0,Re)}finally{Ve?pe():(te=!1,j=null)}}else te=!1}var pe;if(typeof ae=="function")pe=function(){ae(_e)};else if(typeof MessageChannel<"u"){var qe=new MessageChannel,St=qe.port2;qe.port1.onmessage=_e,pe=function(){St.postMessage(null)}}else pe=function(){G(_e,0)};function ke(Re){j=Re,te||(te=!0,pe())}function Ne(Re,Ve){K=G(function(){Re(t.unstable_now())},Ve)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Re){Re.callback=null},t.unstable_continueExecution=function(){L||D||(L=!0,ke(z))},t.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<Re?Math.floor(1e3/Re):5},t.unstable_getCurrentPriorityLevel=function(){return I},t.unstable_getFirstCallbackNode=function(){return r(g)},t.unstable_next=function(Re){switch(I){case 1:case 2:case 3:var Ve=3;break;default:Ve=I}var ve=I;I=Ve;try{return Re()}finally{I=ve}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Re,Ve){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var ve=I;I=Re;try{return Ve()}finally{I=ve}},t.unstable_scheduleCallback=function(Re,Ve,ve){var Be=t.unstable_now();switch(typeof ve=="object"&&ve!==null?(ve=ve.delay,ve=typeof ve=="number"&&0<ve?Be+ve:Be):ve=Be,Re){case 1:var gt=-1;break;case 2:gt=250;break;case 5:gt=1073741823;break;case 4:gt=1e4;break;default:gt=5e3}return gt=ve+gt,Re={id:T++,callback:Ve,priorityLevel:Re,startTime:ve,expirationTime:gt,sortIndex:-1},ve>Be?(Re.sortIndex=ve,e(E,Re),r(g)===null&&Re===r(E)&&(B?(se(K),K=-1):B=!0,Ne(F,ve-Be))):(Re.sortIndex=gt,e(g,Re),L||D||(L=!0,ke(z))),Re},t.unstable_shouldYield=Ee,t.unstable_wrapCallback=function(Re){var Ve=I;return function(){var ve=I;I=Ve;try{return Re.apply(this,arguments)}finally{I=ve}}}}(cV)),cV}var mX;function Z0e(){return mX||(mX=1,aV.exports=Q0e()),aV.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gX;function ebe(){if(gX)return Qu;gX=1;var t=Cd(),e=Z0e();function r(m){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+m,w=1;w<arguments.length;w++)_+="&args[]="+encodeURIComponent(arguments[w]);return"Minified React error #"+m+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function u(m,_){d(m,_),d(m+"Capture",_)}function d(m,_){for(a[m]=_,m=0;m<_.length;m++)o.add(_[m])}var f=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),g=Object.prototype.hasOwnProperty,E=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,T={},C={};function I(m){return g.call(C,m)?!0:g.call(T,m)?!1:E.test(m)?C[m]=!0:(T[m]=!0,!1)}function D(m,_,w,P){if(w!==null&&w.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return P?!1:w!==null?!w.acceptsBooleans:(m=m.toLowerCase().slice(0,5),m!=="data-"&&m!=="aria-");default:return!1}}function L(m,_,w,P){if(_===null||typeof _>"u"||D(m,_,w,P))return!0;if(P)return!1;if(w!==null)switch(w.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function B(m,_,w,P,V,J,fe){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=P,this.attributeNamespace=V,this.mustUseProperty=w,this.propertyName=m,this.type=_,this.sanitizeURL=J,this.removeEmptyString=fe}var G={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(m){G[m]=new B(m,0,!1,m,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(m){var _=m[0];G[_]=new B(_,1,!1,m[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(m){G[m]=new B(m,2,!1,m.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(m){G[m]=new B(m,2,!1,m,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(m){G[m]=new B(m,3,!1,m.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(m){G[m]=new B(m,3,!0,m,null,!1,!1)}),["capture","download"].forEach(function(m){G[m]=new B(m,4,!1,m,null,!1,!1)}),["cols","rows","size","span"].forEach(function(m){G[m]=new B(m,6,!1,m,null,!1,!1)}),["rowSpan","start"].forEach(function(m){G[m]=new B(m,5,!1,m.toLowerCase(),null,!1,!1)});var se=/[\-:]([a-z])/g;function ae(m){return m[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(m){var _=m.replace(se,ae);G[_]=new B(_,1,!1,m,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(m){var _=m.replace(se,ae);G[_]=new B(_,1,!1,m,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(m){var _=m.replace(se,ae);G[_]=new B(_,1,!1,m,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(m){G[m]=new B(m,1,!1,m.toLowerCase(),null,!1,!1)}),G.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(m){G[m]=new B(m,1,!1,m.toLowerCase(),null,!0,!0)});function M(m,_,w,P){var V=G.hasOwnProperty(_)?G[_]:null;(V!==null?V.type!==0:P||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(L(_,w,V,P)&&(w=null),P||V===null?I(_)&&(w===null?m.removeAttribute(_):m.setAttribute(_,""+w)):V.mustUseProperty?m[V.propertyName]=w===null?V.type===3?!1:"":w:(_=V.attributeName,P=V.attributeNamespace,w===null?m.removeAttribute(_):(V=V.type,w=V===3||V===4&&w===!0?"":""+w,P?m.setAttributeNS(P,_,w):m.setAttribute(_,w))))}var F=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,z=Symbol.for("react.element"),te=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),K=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),ce=Symbol.for("react.provider"),Ee=Symbol.for("react.context"),_e=Symbol.for("react.forward_ref"),pe=Symbol.for("react.suspense"),qe=Symbol.for("react.suspense_list"),St=Symbol.for("react.memo"),ke=Symbol.for("react.lazy"),Ne=Symbol.for("react.offscreen"),Re=Symbol.iterator;function Ve(m){return m===null||typeof m!="object"?null:(m=Re&&m[Re]||m["@@iterator"],typeof m=="function"?m:null)}var ve=Object.assign,Be;function gt(m){if(Be===void 0)try{throw Error()}catch(w){var _=w.stack.trim().match(/\n( *(at )?)/);Be=_&&_[1]||""}return`
`+Be+m}var ze=!1;function _t(m,_){if(!m||ze)return"";ze=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(ut){var P=ut}Reflect.construct(m,[],_)}else{try{_.call()}catch(ut){P=ut}m.call(_.prototype)}else{try{throw Error()}catch(ut){P=ut}m()}}catch(ut){if(ut&&P&&typeof ut.stack=="string"){for(var V=ut.stack.split(`
`),J=P.stack.split(`
`),fe=V.length-1,Ie=J.length-1;1<=fe&&0<=Ie&&V[fe]!==J[Ie];)Ie--;for(;1<=fe&&0<=Ie;fe--,Ie--)if(V[fe]!==J[Ie]){if(fe!==1||Ie!==1)do if(fe--,Ie--,0>Ie||V[fe]!==J[Ie]){var je=`
`+V[fe].replace(" at new "," at ");return m.displayName&&je.includes("<anonymous>")&&(je=je.replace("<anonymous>",m.displayName)),je}while(1<=fe&&0<=Ie);break}}}finally{ze=!1,Error.prepareStackTrace=w}return(m=m?m.displayName||m.name:"")?gt(m):""}function Dt(m){switch(m.tag){case 5:return gt(m.type);case 16:return gt("Lazy");case 13:return gt("Suspense");case 19:return gt("SuspenseList");case 0:case 2:case 15:return m=_t(m.type,!1),m;case 11:return m=_t(m.type.render,!1),m;case 1:return m=_t(m.type,!0),m;default:return""}}function jt(m){if(m==null)return null;if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m;switch(m){case j:return"Fragment";case te:return"Portal";case Q:return"Profiler";case K:return"StrictMode";case pe:return"Suspense";case qe:return"SuspenseList"}if(typeof m=="object")switch(m.$$typeof){case Ee:return(m.displayName||"Context")+".Consumer";case ce:return(m._context.displayName||"Context")+".Provider";case _e:var _=m.render;return m=m.displayName,m||(m=_.displayName||_.name||"",m=m!==""?"ForwardRef("+m+")":"ForwardRef"),m;case St:return _=m.displayName||null,_!==null?_:jt(m.type)||"Memo";case ke:_=m._payload,m=m._init;try{return jt(m(_))}catch{}}return null}function Zt(m){var _=m.type;switch(m.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return m=_.render,m=m.displayName||m.name||"",_.displayName||(m!==""?"ForwardRef("+m+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return jt(_);case 8:return _===K?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function Xt(m){switch(typeof m){case"boolean":case"number":case"string":case"undefined":return m;case"object":return m;default:return""}}function In(m){var _=m.type;return(m=m.nodeName)&&m.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function Qt(m){var _=In(m)?"checked":"value",w=Object.getOwnPropertyDescriptor(m.constructor.prototype,_),P=""+m[_];if(!m.hasOwnProperty(_)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var V=w.get,J=w.set;return Object.defineProperty(m,_,{configurable:!0,get:function(){return V.call(this)},set:function(fe){P=""+fe,J.call(this,fe)}}),Object.defineProperty(m,_,{enumerable:w.enumerable}),{getValue:function(){return P},setValue:function(fe){P=""+fe},stopTracking:function(){m._valueTracker=null,delete m[_]}}}}function Er(m){m._valueTracker||(m._valueTracker=Qt(m))}function Tn(m){if(!m)return!1;var _=m._valueTracker;if(!_)return!0;var w=_.getValue(),P="";return m&&(P=In(m)?m.checked?"true":"false":m.value),m=P,m!==w?(_.setValue(m),!0):!1}function Vn(m){if(m=m||(typeof document<"u"?document:void 0),typeof m>"u")return null;try{return m.activeElement||m.body}catch{return m.body}}function wr(m,_){var w=_.checked;return ve({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:w??m._wrapperState.initialChecked})}function Pt(m,_){var w=_.defaultValue==null?"":_.defaultValue,P=_.checked!=null?_.checked:_.defaultChecked;w=Xt(_.value!=null?_.value:w),m._wrapperState={initialChecked:P,initialValue:w,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function wn(m,_){_=_.checked,_!=null&&M(m,"checked",_,!1)}function Dn(m,_){wn(m,_);var w=Xt(_.value),P=_.type;if(w!=null)P==="number"?(w===0&&m.value===""||m.value!=w)&&(m.value=""+w):m.value!==""+w&&(m.value=""+w);else if(P==="submit"||P==="reset"){m.removeAttribute("value");return}_.hasOwnProperty("value")?$e(m,_.type,w):_.hasOwnProperty("defaultValue")&&$e(m,_.type,Xt(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(m.defaultChecked=!!_.defaultChecked)}function Ae(m,_,w){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var P=_.type;if(!(P!=="submit"&&P!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+m._wrapperState.initialValue,w||_===m.value||(m.value=_),m.defaultValue=_}w=m.name,w!==""&&(m.name=""),m.defaultChecked=!!m._wrapperState.initialChecked,w!==""&&(m.name=w)}function $e(m,_,w){(_!=="number"||Vn(m.ownerDocument)!==m)&&(w==null?m.defaultValue=""+m._wrapperState.initialValue:m.defaultValue!==""+w&&(m.defaultValue=""+w))}var rt=Array.isArray;function at(m,_,w,P){if(m=m.options,_){_={};for(var V=0;V<w.length;V++)_["$"+w[V]]=!0;for(w=0;w<m.length;w++)V=_.hasOwnProperty("$"+m[w].value),m[w].selected!==V&&(m[w].selected=V),V&&P&&(m[w].defaultSelected=!0)}else{for(w=""+Xt(w),_=null,V=0;V<m.length;V++){if(m[V].value===w){m[V].selected=!0,P&&(m[V].defaultSelected=!0);return}_!==null||m[V].disabled||(_=m[V])}_!==null&&(_.selected=!0)}}function ct(m,_){if(_.dangerouslySetInnerHTML!=null)throw Error(r(91));return ve({},_,{value:void 0,defaultValue:void 0,children:""+m._wrapperState.initialValue})}function Ke(m,_){var w=_.value;if(w==null){if(w=_.children,_=_.defaultValue,w!=null){if(_!=null)throw Error(r(92));if(rt(w)){if(1<w.length)throw Error(r(93));w=w[0]}_=w}_==null&&(_=""),w=_}m._wrapperState={initialValue:Xt(w)}}function nt(m,_){var w=Xt(_.value),P=Xt(_.defaultValue);w!=null&&(w=""+w,w!==m.value&&(m.value=w),_.defaultValue==null&&m.defaultValue!==w&&(m.defaultValue=w)),P!=null&&(m.defaultValue=""+P)}function At(m){var _=m.textContent;_===m._wrapperState.initialValue&&_!==""&&_!==null&&(m.value=_)}function It(m){switch(m){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Kt(m,_){return m==null||m==="http://www.w3.org/1999/xhtml"?It(_):m==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":m}var Un,Fn=function(m){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,w,P,V){MSApp.execUnsafeLocalFunction(function(){return m(_,w,P,V)})}:m}(function(m,_){if(m.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in m)m.innerHTML=_;else{for(Un=Un||document.createElement("div"),Un.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=Un.firstChild;m.firstChild;)m.removeChild(m.firstChild);for(;_.firstChild;)m.appendChild(_.firstChild)}});function Yr(m,_){if(_){var w=m.firstChild;if(w&&w===m.lastChild&&w.nodeType===3){w.nodeValue=_;return}}m.textContent=_}var Ns={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$t=["Webkit","ms","Moz","O"];Object.keys(Ns).forEach(function(m){$t.forEach(function(_){_=_+m.charAt(0).toUpperCase()+m.substring(1),Ns[_]=Ns[m]})});function Cn(m,_,w){return _==null||typeof _=="boolean"||_===""?"":w||typeof _!="number"||_===0||Ns.hasOwnProperty(m)&&Ns[m]?(""+_).trim():_+"px"}function yo(m,_){m=m.style;for(var w in _)if(_.hasOwnProperty(w)){var P=w.indexOf("--")===0,V=Cn(w,_[w],P);w==="float"&&(w="cssFloat"),P?m.setProperty(w,V):m[w]=V}}var Cr=ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Bi(m,_){if(_){if(Cr[m]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(r(137,m));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(r(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(r(61))}if(_.style!=null&&typeof _.style!="object")throw Error(r(62))}}function za(m,_){if(m.indexOf("-")===-1)return typeof _.is=="string";switch(m){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ba=null;function ys(m){return m=m.target||m.srcElement||window,m.correspondingUseElement&&(m=m.correspondingUseElement),m.nodeType===3?m.parentNode:m}var Ga=null,Wi=null,Ws=null;function Eo(m){if(m=gm(m)){if(typeof Ga!="function")throw Error(r(280));var _=m.stateNode;_&&(_=vm(_),Ga(m.stateNode,m.type,_))}}function Ha(m){Wi?Ws?Ws.push(m):Ws=[m]:Wi=m}function zi(){if(Wi){var m=Wi,_=Ws;if(Ws=Wi=null,Eo(m),_)for(m=0;m<_.length;m++)Eo(_[m])}}function _u(m,_){return m(_)}function Do(){}var wa=!1;function Ds(m,_,w){if(wa)return m(_,w);wa=!0;try{return _u(m,_,w)}finally{wa=!1,(Wi!==null||Ws!==null)&&(Do(),zi())}}function Gi(m,_){var w=m.stateNode;if(w===null)return null;var P=vm(w);if(P===null)return null;w=P[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(P=!P.disabled)||(m=m.type,P=!(m==="button"||m==="input"||m==="select"||m==="textarea")),m=!P;break e;default:m=!1}if(m)return null;if(w&&typeof w!="function")throw Error(r(231,_,typeof w));return w}var us=!1;if(f)try{var Ca={};Object.defineProperty(Ca,"passive",{get:function(){us=!0}}),window.addEventListener("test",Ca,Ca),window.removeEventListener("test",Ca,Ca)}catch{us=!1}function vc(m,_,w,P,V,J,fe,Ie,je){var ut=Array.prototype.slice.call(arguments,3);try{_.apply(w,ut)}catch(Nt){this.onError(Nt)}}var zs=!1,Zo=null,ea=!1,yu=null,kd={onError:function(m){zs=!0,Zo=m}};function Eu(m,_,w,P,V,J,fe,Ie,je){zs=!1,Zo=null,vc.apply(kd,arguments)}function Wl(m,_,w,P,V,J,fe,Ie,je){if(Eu.apply(this,arguments),zs){if(zs){var ut=Zo;zs=!1,Zo=null}else throw Error(r(198));ea||(ea=!0,yu=ut)}}function to(m){var _=m,w=m;if(m.alternate)for(;_.return;)_=_.return;else{m=_;do _=m,(_.flags&4098)!==0&&(w=_.return),m=_.return;while(m)}return _.tag===3?w:null}function _c(m){if(m.tag===13){var _=m.memoizedState;if(_===null&&(m=m.alternate,m!==null&&(_=m.memoizedState)),_!==null)return _.dehydrated}return null}function ta(m){if(to(m)!==m)throw Error(r(188))}function Su(m){var _=m.alternate;if(!_){if(_=to(m),_===null)throw Error(r(188));return _!==m?null:m}for(var w=m,P=_;;){var V=w.return;if(V===null)break;var J=V.alternate;if(J===null){if(P=V.return,P!==null){w=P;continue}break}if(V.child===J.child){for(J=V.child;J;){if(J===w)return ta(V),m;if(J===P)return ta(V),_;J=J.sibling}throw Error(r(188))}if(w.return!==P.return)w=V,P=J;else{for(var fe=!1,Ie=V.child;Ie;){if(Ie===w){fe=!0,w=V,P=J;break}if(Ie===P){fe=!0,P=V,w=J;break}Ie=Ie.sibling}if(!fe){for(Ie=J.child;Ie;){if(Ie===w){fe=!0,w=J,P=V;break}if(Ie===P){fe=!0,P=J,w=V;break}Ie=Ie.sibling}if(!fe)throw Error(r(189))}}if(w.alternate!==P)throw Error(r(190))}if(w.tag!==3)throw Error(r(188));return w.stateNode.current===w?m:_}function yc(m){return m=Su(m),m!==null?Gs(m):null}function Gs(m){if(m.tag===5||m.tag===6)return m;for(m=m.child;m!==null;){var _=Gs(m);if(_!==null)return _;m=m.sibling}return null}var Tu=e.unstable_scheduleCallback,ul=e.unstable_cancelCallback,Lo=e.unstable_shouldYield,ll=e.unstable_requestPaint,Zr=e.unstable_now,Ti=e.unstable_getCurrentPriorityLevel,Ra=e.unstable_ImmediatePriority,Ec=e.unstable_UserBlockingPriority,na=e.unstable_NormalPriority,zl=e.unstable_LowPriority,dl=e.unstable_IdlePriority,xo=null,es=null;function hl(m){if(es&&typeof es.onCommitFiberRoot=="function")try{es.onCommitFiberRoot(xo,m,void 0,(m.current.flags&128)===128)}catch{}}var Ls=Math.clz32?Math.clz32:Xc,Gl=Math.log,Mr=Math.LN2;function Xc(m){return m>>>=0,m===0?32:31-(Gl(m)/Mr|0)|0}var Sc=64,fr=4194304;function bu(m){switch(m&-m){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return m&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return m}}function Jc(m,_){var w=m.pendingLanes;if(w===0)return 0;var P=0,V=m.suspendedLanes,J=m.pingedLanes,fe=w&268435455;if(fe!==0){var Ie=fe&~V;Ie!==0?P=bu(Ie):(J&=fe,J!==0&&(P=bu(J)))}else fe=w&~V,fe!==0?P=bu(fe):J!==0&&(P=bu(J));if(P===0)return 0;if(_!==0&&_!==P&&(_&V)===0&&(V=P&-P,J=_&-_,V>=J||V===16&&(J&4194240)!==0))return _;if((P&4)!==0&&(P|=w&16),_=m.entangledLanes,_!==0)for(m=m.entanglements,_&=P;0<_;)w=31-Ls(_),V=1<<w,P|=m[w],_&=~V;return P}function wu(m,_){switch(m){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ka(m,_){for(var w=m.suspendedLanes,P=m.pingedLanes,V=m.expirationTimes,J=m.pendingLanes;0<J;){var fe=31-Ls(J),Ie=1<<fe,je=V[fe];je===-1?((Ie&w)===0||(Ie&P)!==0)&&(V[fe]=wu(Ie,_)):je<=_&&(m.expiredLanes|=Ie),J&=~Ie}}function ra(m){return m=m.pendingLanes&-1073741825,m!==0?m:m&1073741824?1073741824:0}function fl(){var m=Sc;return Sc<<=1,(Sc&4194240)===0&&(Sc=64),m}function Qc(m){for(var _=[],w=0;31>w;w++)_.push(m);return _}function Ia(m,_,w){m.pendingLanes|=_,_!==536870912&&(m.suspendedLanes=0,m.pingedLanes=0),m=m.eventTimes,_=31-Ls(_),m[_]=w}function kr(m,_){var w=m.pendingLanes&~_;m.pendingLanes=_,m.suspendedLanes=0,m.pingedLanes=0,m.expiredLanes&=_,m.mutableReadLanes&=_,m.entangledLanes&=_,_=m.entanglements;var P=m.eventTimes;for(m=m.expirationTimes;0<w;){var V=31-Ls(w),J=1<<V;_[V]=0,P[V]=-1,m[V]=-1,w&=~J}}function Aa(m,_){var w=m.entangledLanes|=_;for(m=m.entanglements;w;){var P=31-Ls(w),V=1<<P;V&_|m[P]&_&&(m[P]|=_),w&=~V}}var pr=0;function qa(m){return m&=-m,1<m?4<m?(m&268435455)!==0?16:536870912:4:1}var Zc,So,Hl,Od,pl,Cu=!1,Mo=[],Hi=null,Hs=null,Uo=null,Tc=new Map,Or=new Map,ia=[],vh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function $a(m,_){switch(m){case"focusin":case"focusout":Hi=null;break;case"dragenter":case"dragleave":Hs=null;break;case"mouseover":case"mouseout":Uo=null;break;case"pointerover":case"pointerout":Tc.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":Or.delete(_.pointerId)}}function Es(m,_,w,P,V,J){return m===null||m.nativeEvent!==J?(m={blockedOn:_,domEventName:w,eventSystemFlags:P,nativeEvent:J,targetContainers:[V]},_!==null&&(_=gm(_),_!==null&&So(_)),m):(m.eventSystemFlags|=P,_=m.targetContainers,V!==null&&_.indexOf(V)===-1&&_.push(V),m)}function Ru(m,_,w,P,V){switch(_){case"focusin":return Hi=Es(Hi,m,_,w,P,V),!0;case"dragenter":return Hs=Es(Hs,m,_,w,P,V),!0;case"mouseover":return Uo=Es(Uo,m,_,w,P,V),!0;case"pointerover":var J=V.pointerId;return Tc.set(J,Es(Tc.get(J)||null,m,_,w,P,V)),!0;case"gotpointercapture":return J=V.pointerId,Or.set(J,Es(Or.get(J)||null,m,_,w,P,V)),!0}return!1}function Iu(m){var _=zf(m.target);if(_!==null){var w=to(_);if(w!==null){if(_=w.tag,_===13){if(_=_c(w),_!==null){m.blockedOn=_,pl(m.priority,function(){Hl(w)});return}}else if(_===3&&w.stateNode.current.memoizedState.isDehydrated){m.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}m.blockedOn=null}function bc(m){if(m.blockedOn!==null)return!1;for(var _=m.targetContainers;0<_.length;){var w=Ur(m.domEventName,m.eventSystemFlags,_[0],m.nativeEvent);if(w===null){w=m.nativeEvent;var P=new w.constructor(w.type,w);ba=P,w.target.dispatchEvent(P),ba=null}else return _=gm(w),_!==null&&So(_),m.blockedOn=w,!1;_.shift()}return!0}function no(m,_,w){bc(m)&&w.delete(_)}function Pd(){Cu=!1,Hi!==null&&bc(Hi)&&(Hi=null),Hs!==null&&bc(Hs)&&(Hs=null),Uo!==null&&bc(Uo)&&(Uo=null),Tc.forEach(no),Or.forEach(no)}function ro(m,_){m.blockedOn===_&&(m.blockedOn=null,Cu||(Cu=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Pd)))}function sa(m){function _(V){return ro(V,m)}if(0<Mo.length){ro(Mo[0],m);for(var w=1;w<Mo.length;w++){var P=Mo[w];P.blockedOn===m&&(P.blockedOn=null)}}for(Hi!==null&&ro(Hi,m),Hs!==null&&ro(Hs,m),Uo!==null&&ro(Uo,m),Tc.forEach(_),Or.forEach(_),w=0;w<ia.length;w++)P=ia[w],P.blockedOn===m&&(P.blockedOn=null);for(;0<ia.length&&(w=ia[0],w.blockedOn===null);)Iu(w),w.blockedOn===null&&ia.shift()}var Ya=F.ReactCurrentBatchConfig,Ce=!0;function De(m,_,w,P){var V=pr,J=Ya.transition;Ya.transition=null;try{pr=1,nn(m,_,w,P)}finally{pr=V,Ya.transition=J}}function st(m,_,w,P){var V=pr,J=Ya.transition;Ya.transition=null;try{pr=4,nn(m,_,w,P)}finally{pr=V,Ya.transition=J}}function nn(m,_,w,P){if(Ce){var V=Ur(m,_,w,P);if(V===null)xy(m,_,P,Zn,w),$a(m,P);else if(Ru(V,m,_,w,P))P.stopPropagation();else if($a(m,P),_&4&&-1<vh.indexOf(m)){for(;V!==null;){var J=gm(V);if(J!==null&&Zc(J),J=Ur(m,_,w,P),J===null&&xy(m,_,P,Zn,w),J===V)break;V=J}V!==null&&P.stopPropagation()}else xy(m,_,P,null,w)}}var Zn=null;function Ur(m,_,w,P){if(Zn=null,m=ys(P),m=zf(m),m!==null)if(_=to(m),_===null)m=null;else if(w=_.tag,w===13){if(m=_c(_),m!==null)return m;m=null}else if(w===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;m=null}else _!==m&&(m=null);return Zn=m,null}function ei(m){switch(m){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ti()){case Ra:return 1;case Ec:return 4;case na:case zl:return 16;case dl:return 536870912;default:return 16}default:return 16}}var hn=null,Hr=null,Ri=null;function ms(){if(Ri)return Ri;var m,_=Hr,w=_.length,P,V="value"in hn?hn.value:hn.textContent,J=V.length;for(m=0;m<w&&_[m]===V[m];m++);var fe=w-m;for(P=1;P<=fe&&_[w-P]===V[J-P];P++);return Ri=V.slice(m,1<P?1-P:void 0)}function Vo(m){var _=m.keyCode;return"charCode"in m?(m=m.charCode,m===0&&_===13&&(m=13)):m=_,m===10&&(m=13),32<=m||m===13?m:0}function Fo(){return!0}function oa(){return!1}function ls(m){function _(w,P,V,J,fe){this._reactName=w,this._targetInst=V,this.type=P,this.nativeEvent=J,this.target=fe,this.currentTarget=null;for(var Ie in m)m.hasOwnProperty(Ie)&&(w=m[Ie],this[Ie]=w?w(J):J[Ie]);return this.isDefaultPrevented=(J.defaultPrevented!=null?J.defaultPrevented:J.returnValue===!1)?Fo:oa,this.isPropagationStopped=oa,this}return ve(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=Fo)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=Fo)},persist:function(){},isPersistent:Fo}),_}var wc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(m){return m.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ml=ls(wc),Xa=ve({},wc,{view:0,detail:0}),Kl=ls(Xa),io,Au,jo,aa=ve({},Xa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ns,button:0,buttons:0,relatedTarget:function(m){return m.relatedTarget===void 0?m.fromElement===m.srcElement?m.toElement:m.fromElement:m.relatedTarget},movementX:function(m){return"movementX"in m?m.movementX:(m!==jo&&(jo&&m.type==="mousemove"?(io=m.screenX-jo.screenX,Au=m.screenY-jo.screenY):Au=io=0,jo=m),io)},movementY:function(m){return"movementY"in m?m.movementY:Au}}),k=ls(aa),Z=ve({},aa,{dataTransfer:0}),he=ls(Z),Te=ve({},Xa,{relatedTarget:0}),Ye=ls(Te),tt=ve({},wc,{animationName:0,elapsedTime:0,pseudoElement:0}),vt=ls(tt),rn=ve({},wc,{clipboardData:function(m){return"clipboardData"in m?m.clipboardData:window.clipboardData}}),vn=ls(rn),Rr=ve({},wc,{data:0}),cn=ls(Rr),ts={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ci={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Vr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bo(m){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(m):(m=Vr[m])?!!_[m]:!1}function ns(){return Bo}var A=ve({},Xa,{key:function(m){if(m.key){var _=ts[m.key]||m.key;if(_!=="Unidentified")return _}return m.type==="keypress"?(m=Vo(m),m===13?"Enter":String.fromCharCode(m)):m.type==="keydown"||m.type==="keyup"?ci[m.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ns,charCode:function(m){return m.type==="keypress"?Vo(m):0},keyCode:function(m){return m.type==="keydown"||m.type==="keyup"?m.keyCode:0},which:function(m){return m.type==="keypress"?Vo(m):m.type==="keydown"||m.type==="keyup"?m.keyCode:0}}),q=ls(A),oe=ve({},aa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ye=ls(oe),Je=ve({},Xa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ns}),ht=ls(Je),Wt=ve({},wc,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ii=ls(Wt),Ki=ve({},aa,{deltaX:function(m){return"deltaX"in m?m.deltaX:"wheelDeltaX"in m?-m.wheelDeltaX:0},deltaY:function(m){return"deltaY"in m?m.deltaY:"wheelDeltaY"in m?-m.wheelDeltaY:"wheelDelta"in m?-m.wheelDelta:0},deltaZ:0,deltaMode:0}),Xr=ls(Ki),Wo=[9,13,27,32],so=f&&"CompositionEvent"in window,eu=null;f&&"documentMode"in document&&(eu=document.documentMode);var Ja=f&&"TextEvent"in window&&!eu,Mf=f&&(!so||eu&&8<eu&&11>=eu),dm=" ",tu=!1;function dI(m,_){switch(m){case"keyup":return Wo.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hI(m){return m=m.detail,typeof m=="object"&&"data"in m?m.data:null}var hm=!1;function PD(m,_){switch(m){case"compositionend":return hI(_);case"keypress":return _.which!==32?null:(tu=!0,dm);case"textInput":return m=_.data,m===dm&&tu?null:m;default:return null}}function fI(m,_){if(hm)return m==="compositionend"||!so&&dI(m,_)?(m=ms(),Ri=Hr=hn=null,hm=!1,m):null;switch(m){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return Mf&&_.locale!=="ko"?null:_.data;default:return null}}var ND={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pI(m){var _=m&&m.nodeName&&m.nodeName.toLowerCase();return _==="input"?!!ND[m.type]:_==="textarea"}function a0(m,_,w,P){Ha(P),_=My(_,"onChange"),0<_.length&&(w=new ml("onChange","change",null,w,P),m.push({event:w,listeners:_}))}var Uf=null,nv=null;function DD(m){p0(m,0)}function Vf(m){var _=Gf(m);if(Tn(_))return m}function LD(m,_){if(m==="change")return _}var mI=!1;if(f){var c0;if(f){var ku="oninput"in document;if(!ku){var gI=document.createElement("div");gI.setAttribute("oninput","return;"),ku=typeof gI.oninput=="function"}c0=ku}else c0=!1;mI=c0&&(!document.documentMode||9<document.documentMode)}function vI(){Uf&&(Uf.detachEvent("onpropertychange",Cc),nv=Uf=null)}function Cc(m){if(m.propertyName==="value"&&Vf(nv)){var _=[];a0(_,nv,m,ys(m)),Ds(DD,_)}}function xD(m,_,w){m==="focusin"?(vI(),Uf=_,nv=w,Uf.attachEvent("onpropertychange",Cc)):m==="focusout"&&vI()}function MD(m){if(m==="selectionchange"||m==="keyup"||m==="keydown")return Vf(nv)}function UD(m,_){if(m==="click")return Vf(_)}function VD(m,_){if(m==="input"||m==="change")return Vf(_)}function _I(m,_){return m===_&&(m!==0||1/m===1/_)||m!==m&&_!==_}var gl=typeof Object.is=="function"?Object.is:_I;function rv(m,_){if(gl(m,_))return!0;if(typeof m!="object"||m===null||typeof _!="object"||_===null)return!1;var w=Object.keys(m),P=Object.keys(_);if(w.length!==P.length)return!1;for(P=0;P<w.length;P++){var V=w[P];if(!g.call(_,V)||!gl(m[V],_[V]))return!1}return!0}function yI(m){for(;m&&m.firstChild;)m=m.firstChild;return m}function u0(m,_){var w=yI(m);m=0;for(var P;w;){if(w.nodeType===3){if(P=m+w.textContent.length,m<=_&&P>=_)return{node:w,offset:_-m};m=P}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=yI(w)}}function EI(m,_){return m&&_?m===_?!0:m&&m.nodeType===3?!1:_&&_.nodeType===3?EI(m,_.parentNode):"contains"in m?m.contains(_):m.compareDocumentPosition?!!(m.compareDocumentPosition(_)&16):!1:!1}function SI(){for(var m=window,_=Vn();_ instanceof m.HTMLIFrameElement;){try{var w=typeof _.contentWindow.location.href=="string"}catch{w=!1}if(w)m=_.contentWindow;else break;_=Vn(m.document)}return _}function iv(m){var _=m&&m.nodeName&&m.nodeName.toLowerCase();return _&&(_==="input"&&(m.type==="text"||m.type==="search"||m.type==="tel"||m.type==="url"||m.type==="password")||_==="textarea"||m.contentEditable==="true")}function l0(m){var _=SI(),w=m.focusedElem,P=m.selectionRange;if(_!==w&&w&&w.ownerDocument&&EI(w.ownerDocument.documentElement,w)){if(P!==null&&iv(w)){if(_=P.start,m=P.end,m===void 0&&(m=_),"selectionStart"in w)w.selectionStart=_,w.selectionEnd=Math.min(m,w.value.length);else if(m=(_=w.ownerDocument||document)&&_.defaultView||window,m.getSelection){m=m.getSelection();var V=w.textContent.length,J=Math.min(P.start,V);P=P.end===void 0?J:Math.min(P.end,V),!m.extend&&J>P&&(V=P,P=J,J=V),V=u0(w,J);var fe=u0(w,P);V&&fe&&(m.rangeCount!==1||m.anchorNode!==V.node||m.anchorOffset!==V.offset||m.focusNode!==fe.node||m.focusOffset!==fe.offset)&&(_=_.createRange(),_.setStart(V.node,V.offset),m.removeAllRanges(),J>P?(m.addRange(_),m.extend(fe.node,fe.offset)):(_.setEnd(fe.node,fe.offset),m.addRange(_)))}}for(_=[],m=w;m=m.parentNode;)m.nodeType===1&&_.push({element:m,left:m.scrollLeft,top:m.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<_.length;w++)m=_[w],m.element.scrollLeft=m.left,m.element.scrollTop=m.top}}var FD=f&&"documentMode"in document&&11>=document.documentMode,dt=null,d0=null,sv=null,h0=!1;function TI(m,_,w){var P=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;h0||dt==null||dt!==Vn(P)||(P=dt,"selectionStart"in P&&iv(P)?P={start:P.selectionStart,end:P.selectionEnd}:(P=(P.ownerDocument&&P.ownerDocument.defaultView||window).getSelection(),P={anchorNode:P.anchorNode,anchorOffset:P.anchorOffset,focusNode:P.focusNode,focusOffset:P.focusOffset}),sv&&rv(sv,P)||(sv=P,P=My(d0,"onSelect"),0<P.length&&(_=new ml("onSelect","select",null,_,w),m.push({event:_,listeners:P}),_.target=dt)))}function Py(m,_){var w={};return w[m.toLowerCase()]=_.toLowerCase(),w["Webkit"+m]="webkit"+_,w["Moz"+m]="moz"+_,w}var fm={animationend:Py("Animation","AnimationEnd"),animationiteration:Py("Animation","AnimationIteration"),animationstart:Py("Animation","AnimationStart"),transitionend:Py("Transition","TransitionEnd")},f0={},bI={};f&&(bI=document.createElement("div").style,"AnimationEvent"in window||(delete fm.animationend.animation,delete fm.animationiteration.animation,delete fm.animationstart.animation),"TransitionEvent"in window||delete fm.transitionend.transition);function Ff(m){if(f0[m])return f0[m];if(!fm[m])return m;var _=fm[m],w;for(w in _)if(_.hasOwnProperty(w)&&w in bI)return f0[m]=_[w];return m}var jf=Ff("animationend"),wI=Ff("animationiteration"),CI=Ff("animationstart"),RI=Ff("transitionend"),II=new Map,Ny="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _h(m,_){II.set(m,_),u(_,[m])}for(var Dy=0;Dy<Ny.length;Dy++){var nu=Ny[Dy],jD=nu.toLowerCase(),ov=nu[0].toUpperCase()+nu.slice(1);_h(jD,"on"+ov)}_h(jf,"onAnimationEnd"),_h(wI,"onAnimationIteration"),_h(CI,"onAnimationStart"),_h("dblclick","onDoubleClick"),_h("focusin","onFocus"),_h("focusout","onBlur"),_h(RI,"onTransitionEnd"),d("onMouseEnter",["mouseout","mouseover"]),d("onMouseLeave",["mouseout","mouseover"]),d("onPointerEnter",["pointerout","pointerover"]),d("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var av="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),BD=new Set("cancel close invalid load scroll toggle".split(" ").concat(av));function AI(m,_,w){var P=m.type||"unknown-event";m.currentTarget=w,Wl(P,_,void 0,m),m.currentTarget=null}function p0(m,_){_=(_&4)!==0;for(var w=0;w<m.length;w++){var P=m[w],V=P.event;P=P.listeners;e:{var J=void 0;if(_)for(var fe=P.length-1;0<=fe;fe--){var Ie=P[fe],je=Ie.instance,ut=Ie.currentTarget;if(Ie=Ie.listener,je!==J&&V.isPropagationStopped())break e;AI(V,Ie,ut),J=je}else for(fe=0;fe<P.length;fe++){if(Ie=P[fe],je=Ie.instance,ut=Ie.currentTarget,Ie=Ie.listener,je!==J&&V.isPropagationStopped())break e;AI(V,Ie,ut),J=je}}}if(ea)throw m=yu,ea=!1,yu=null,m}function ds(m,_){var w=_[dv];w===void 0&&(w=_[dv]=new Set);var P=m+"__bubble";w.has(P)||(kI(_,m,2,!1),w.add(P))}function m0(m,_,w){var P=0;_&&(P|=4),kI(w,m,P,_)}var Ly="_reactListening"+Math.random().toString(36).slice(2);function Bf(m){if(!m[Ly]){m[Ly]=!0,o.forEach(function(w){w!=="selectionchange"&&(BD.has(w)||m0(w,!1,m),m0(w,!0,m))});var _=m.nodeType===9?m:m.ownerDocument;_===null||_[Ly]||(_[Ly]=!0,m0("selectionchange",!1,_))}}function kI(m,_,w,P){switch(ei(_)){case 1:var V=De;break;case 4:V=st;break;default:V=nn}w=V.bind(null,_,w,m),V=void 0,!us||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(V=!0),P?V!==void 0?m.addEventListener(_,w,{capture:!0,passive:V}):m.addEventListener(_,w,!0):V!==void 0?m.addEventListener(_,w,{passive:V}):m.addEventListener(_,w,!1)}function xy(m,_,w,P,V){var J=P;if((_&1)===0&&(_&2)===0&&P!==null)e:for(;;){if(P===null)return;var fe=P.tag;if(fe===3||fe===4){var Ie=P.stateNode.containerInfo;if(Ie===V||Ie.nodeType===8&&Ie.parentNode===V)break;if(fe===4)for(fe=P.return;fe!==null;){var je=fe.tag;if((je===3||je===4)&&(je=fe.stateNode.containerInfo,je===V||je.nodeType===8&&je.parentNode===V))return;fe=fe.return}for(;Ie!==null;){if(fe=zf(Ie),fe===null)return;if(je=fe.tag,je===5||je===6){P=J=fe;continue e}Ie=Ie.parentNode}}P=P.return}Ds(function(){var ut=J,Nt=ys(w),xt=[];e:{var Ot=II.get(m);if(Ot!==void 0){var on=ml,ln=m;switch(m){case"keypress":if(Vo(w)===0)break e;case"keydown":case"keyup":on=q;break;case"focusin":ln="focus",on=Ye;break;case"focusout":ln="blur",on=Ye;break;case"beforeblur":case"afterblur":on=Ye;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":on=k;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":on=he;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":on=ht;break;case jf:case wI:case CI:on=vt;break;case RI:on=Ii;break;case"scroll":on=Kl;break;case"wheel":on=Xr;break;case"copy":case"cut":case"paste":on=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":on=ye}var mn=(_&4)!==0,Ks=!mn&&m==="scroll",Ze=mn?Ot!==null?Ot+"Capture":null:Ot;mn=[];for(var We=ut,ot;We!==null;){ot=We;var Vt=ot.stateNode;if(ot.tag===5&&Vt!==null&&(ot=Vt,Ze!==null&&(Vt=Gi(We,Ze),Vt!=null&&mn.push(pm(We,Vt,ot)))),Ks)break;We=We.return}0<mn.length&&(Ot=new on(Ot,ln,null,w,Nt),xt.push({event:Ot,listeners:mn}))}}if((_&7)===0){e:{if(Ot=m==="mouseover"||m==="pointerover",on=m==="mouseout"||m==="pointerout",Ot&&w!==ba&&(ln=w.relatedTarget||w.fromElement)&&(zf(ln)||ln[Ou]))break e;if((on||Ot)&&(Ot=Nt.window===Nt?Nt:(Ot=Nt.ownerDocument)?Ot.defaultView||Ot.parentWindow:window,on?(ln=w.relatedTarget||w.toElement,on=ut,ln=ln?zf(ln):null,ln!==null&&(Ks=to(ln),ln!==Ks||ln.tag!==5&&ln.tag!==6)&&(ln=null)):(on=null,ln=ut),on!==ln)){if(mn=k,Vt="onMouseLeave",Ze="onMouseEnter",We="mouse",(m==="pointerout"||m==="pointerover")&&(mn=ye,Vt="onPointerLeave",Ze="onPointerEnter",We="pointer"),Ks=on==null?Ot:Gf(on),ot=ln==null?Ot:Gf(ln),Ot=new mn(Vt,We+"leave",on,w,Nt),Ot.target=Ks,Ot.relatedTarget=ot,Vt=null,zf(Nt)===ut&&(mn=new mn(Ze,We+"enter",ln,w,Nt),mn.target=ot,mn.relatedTarget=Ks,Vt=mn),Ks=Vt,on&&ln)t:{for(mn=on,Ze=ln,We=0,ot=mn;ot;ot=Wf(ot))We++;for(ot=0,Vt=Ze;Vt;Vt=Wf(Vt))ot++;for(;0<We-ot;)mn=Wf(mn),We--;for(;0<ot-We;)Ze=Wf(Ze),ot--;for(;We--;){if(mn===Ze||Ze!==null&&mn===Ze.alternate)break t;mn=Wf(mn),Ze=Wf(Ze)}mn=null}else mn=null;on!==null&&cv(xt,Ot,on,mn,!1),ln!==null&&Ks!==null&&cv(xt,Ks,ln,mn,!0)}}e:{if(Ot=ut?Gf(ut):window,on=Ot.nodeName&&Ot.nodeName.toLowerCase(),on==="select"||on==="input"&&Ot.type==="file")var _n=LD;else if(pI(Ot))if(mI)_n=VD;else{_n=MD;var Ln=xD}else(on=Ot.nodeName)&&on.toLowerCase()==="input"&&(Ot.type==="checkbox"||Ot.type==="radio")&&(_n=UD);if(_n&&(_n=_n(m,ut))){a0(xt,_n,w,Nt);break e}Ln&&Ln(m,Ot,ut),m==="focusout"&&(Ln=Ot._wrapperState)&&Ln.controlled&&Ot.type==="number"&&$e(Ot,"number",Ot.value)}switch(Ln=ut?Gf(ut):window,m){case"focusin":(pI(Ln)||Ln.contentEditable==="true")&&(dt=Ln,d0=ut,sv=null);break;case"focusout":sv=d0=dt=null;break;case"mousedown":h0=!0;break;case"contextmenu":case"mouseup":case"dragend":h0=!1,TI(xt,w,Nt);break;case"selectionchange":if(FD)break;case"keydown":case"keyup":TI(xt,w,Nt)}var An;if(so)e:{switch(m){case"compositionstart":var Yn="onCompositionStart";break e;case"compositionend":Yn="onCompositionEnd";break e;case"compositionupdate":Yn="onCompositionUpdate";break e}Yn=void 0}else hm?dI(m,w)&&(Yn="onCompositionEnd"):m==="keydown"&&w.keyCode===229&&(Yn="onCompositionStart");Yn&&(Mf&&w.locale!=="ko"&&(hm||Yn!=="onCompositionStart"?Yn==="onCompositionEnd"&&hm&&(An=ms()):(hn=Nt,Hr="value"in hn?hn.value:hn.textContent,hm=!0)),Ln=My(ut,Yn),0<Ln.length&&(Yn=new cn(Yn,m,null,w,Nt),xt.push({event:Yn,listeners:Ln}),An?Yn.data=An:(An=hI(w),An!==null&&(Yn.data=An)))),(An=Ja?PD(m,w):fI(m,w))&&(ut=My(ut,"onBeforeInput"),0<ut.length&&(Nt=new cn("onBeforeInput","beforeinput",null,w,Nt),xt.push({event:Nt,listeners:ut}),Nt.data=An))}p0(xt,_)})}function pm(m,_,w){return{instance:m,listener:_,currentTarget:w}}function My(m,_){for(var w=_+"Capture",P=[];m!==null;){var V=m,J=V.stateNode;V.tag===5&&J!==null&&(V=J,J=Gi(m,w),J!=null&&P.unshift(pm(m,J,V)),J=Gi(m,_),J!=null&&P.push(pm(m,J,V))),m=m.return}return P}function Wf(m){if(m===null)return null;do m=m.return;while(m&&m.tag!==5);return m||null}function cv(m,_,w,P,V){for(var J=_._reactName,fe=[];w!==null&&w!==P;){var Ie=w,je=Ie.alternate,ut=Ie.stateNode;if(je!==null&&je===P)break;Ie.tag===5&&ut!==null&&(Ie=ut,V?(je=Gi(w,J),je!=null&&fe.unshift(pm(w,je,Ie))):V||(je=Gi(w,J),je!=null&&fe.push(pm(w,je,Ie)))),w=w.return}fe.length!==0&&m.push({event:_,listeners:fe})}var WD=/\r\n?/g,zD=/\u0000|\uFFFD/g;function OI(m){return(typeof m=="string"?m:""+m).replace(WD,`
`).replace(zD,"")}function Uy(m,_,w){if(_=OI(_),OI(m)!==_&&w)throw Error(r(425))}function Vy(){}var Fy=null,uv=null;function g0(m,_){return m==="textarea"||m==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var lv=typeof setTimeout=="function"?setTimeout:void 0,GD=typeof clearTimeout=="function"?clearTimeout:void 0,PI=typeof Promise=="function"?Promise:void 0,HD=typeof queueMicrotask=="function"?queueMicrotask:typeof PI<"u"?function(m){return PI.resolve(null).then(m).catch(KD)}:lv;function KD(m){setTimeout(function(){throw m})}function v0(m,_){var w=_,P=0;do{var V=w.nextSibling;if(m.removeChild(w),V&&V.nodeType===8)if(w=V.data,w==="/$"){if(P===0){m.removeChild(V),sa(_);return}P--}else w!=="$"&&w!=="$?"&&w!=="$!"||P++;w=V}while(w);sa(_)}function yh(m){for(;m!=null;m=m.nextSibling){var _=m.nodeType;if(_===1||_===3)break;if(_===8){if(_=m.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return m}function NI(m){m=m.previousSibling;for(var _=0;m;){if(m.nodeType===8){var w=m.data;if(w==="$"||w==="$!"||w==="$?"){if(_===0)return m;_--}else w==="/$"&&_++}m=m.previousSibling}return null}var mm=Math.random().toString(36).slice(2),ql="__reactFiber$"+mm,Eh="__reactProps$"+mm,Ou="__reactContainer$"+mm,dv="__reactEvents$"+mm,qD="__reactListeners$"+mm,$D="__reactHandles$"+mm;function zf(m){var _=m[ql];if(_)return _;for(var w=m.parentNode;w;){if(_=w[Ou]||w[ql]){if(w=_.alternate,_.child!==null||w!==null&&w.child!==null)for(m=NI(m);m!==null;){if(w=m[ql])return w;m=NI(m)}return _}m=w,w=m.parentNode}return null}function gm(m){return m=m[ql]||m[Ou],!m||m.tag!==5&&m.tag!==6&&m.tag!==13&&m.tag!==3?null:m}function Gf(m){if(m.tag===5||m.tag===6)return m.stateNode;throw Error(r(33))}function vm(m){return m[Eh]||null}var _0=[],_m=-1;function Pu(m){return{current:m}}function hs(m){0>_m||(m.current=_0[_m],_0[_m]=null,_m--)}function rs(m,_){_m++,_0[_m]=m.current,m.current=_}var Sh={},ka=Pu(Sh),Rc=Pu(!1),Hf=Sh;function Kf(m,_){var w=m.type.contextTypes;if(!w)return Sh;var P=m.stateNode;if(P&&P.__reactInternalMemoizedUnmaskedChildContext===_)return P.__reactInternalMemoizedMaskedChildContext;var V={},J;for(J in w)V[J]=_[J];return P&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=_,m.__reactInternalMemoizedMaskedChildContext=V),V}function Ic(m){return m=m.childContextTypes,m!=null}function jy(){hs(Rc),hs(ka)}function DI(m,_,w){if(ka.current!==Sh)throw Error(r(168));rs(ka,_),rs(Rc,w)}function By(m,_,w){var P=m.stateNode;if(_=_.childContextTypes,typeof P.getChildContext!="function")return w;P=P.getChildContext();for(var V in P)if(!(V in _))throw Error(r(108,Zt(m)||"Unknown",V));return ve({},w,P)}function Wy(m){return m=(m=m.stateNode)&&m.__reactInternalMemoizedMergedChildContext||Sh,Hf=ka.current,rs(ka,m),rs(Rc,Rc.current),!0}function LI(m,_,w){var P=m.stateNode;if(!P)throw Error(r(169));w?(m=By(m,_,Hf),P.__reactInternalMemoizedMergedChildContext=m,hs(Rc),hs(ka),rs(ka,m)):hs(Rc),rs(Rc,w)}var Nu=null,zy=!1,y0=!1;function xI(m){Nu===null?Nu=[m]:Nu.push(m)}function YD(m){zy=!0,xI(m)}function Th(){if(!y0&&Nu!==null){y0=!0;var m=0,_=pr;try{var w=Nu;for(pr=1;m<w.length;m++){var P=w[m];do P=P(!0);while(P!==null)}Nu=null,zy=!1}catch(V){throw Nu!==null&&(Nu=Nu.slice(m+1)),Tu(Ra,Th),V}finally{pr=_,y0=!1}}return null}var ym=[],Nd=0,hv=null,Gy=0,Du=[],ru=0,qf=null,Dd=1,Ld="";function xd(m,_){ym[Nd++]=Gy,ym[Nd++]=hv,hv=m,Gy=_}function Hy(m,_,w){Du[ru++]=Dd,Du[ru++]=Ld,Du[ru++]=qf,qf=m;var P=Dd;m=Ld;var V=32-Ls(P)-1;P&=~(1<<V),w+=1;var J=32-Ls(_)+V;if(30<J){var fe=V-V%5;J=(P&(1<<fe)-1).toString(32),P>>=fe,V-=fe,Dd=1<<32-Ls(_)+V|w<<V|P,Ld=J+m}else Dd=1<<J|w<<V|P,Ld=m}function Ky(m){m.return!==null&&(xd(m,1),Hy(m,1,0))}function fv(m){for(;m===hv;)hv=ym[--Nd],ym[Nd]=null,Gy=ym[--Nd],ym[Nd]=null;for(;m===qf;)qf=Du[--ru],Du[ru]=null,Ld=Du[--ru],Du[ru]=null,Dd=Du[--ru],Du[ru]=null}var Ac=null,kc=null,qi=!1,Qa=null;function MI(m,_){var w=da(5,null,null,0);w.elementType="DELETED",w.stateNode=_,w.return=m,_=m.deletions,_===null?(m.deletions=[w],m.flags|=16):_.push(w)}function UI(m,_){switch(m.tag){case 5:var w=m.type;return _=_.nodeType!==1||w.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(m.stateNode=_,Ac=m,kc=yh(_.firstChild),!0):!1;case 6:return _=m.pendingProps===""||_.nodeType!==3?null:_,_!==null?(m.stateNode=_,Ac=m,kc=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(w=qf!==null?{id:Dd,overflow:Ld}:null,m.memoizedState={dehydrated:_,treeContext:w,retryLane:1073741824},w=da(18,null,null,0),w.stateNode=_,w.return=m,m.child=w,Ac=m,kc=null,!0):!1;default:return!1}}function qy(m){return(m.mode&1)!==0&&(m.flags&128)===0}function E0(m){if(qi){var _=kc;if(_){var w=_;if(!UI(m,_)){if(qy(m))throw Error(r(418));_=yh(w.nextSibling);var P=Ac;_&&UI(m,_)?MI(P,w):(m.flags=m.flags&-4097|2,qi=!1,Ac=m)}}else{if(qy(m))throw Error(r(418));m.flags=m.flags&-4097|2,qi=!1,Ac=m}}}function VI(m){for(m=m.return;m!==null&&m.tag!==5&&m.tag!==3&&m.tag!==13;)m=m.return;Ac=m}function pv(m){if(m!==Ac)return!1;if(!qi)return VI(m),qi=!0,!1;var _;if((_=m.tag!==3)&&!(_=m.tag!==5)&&(_=m.type,_=_!=="head"&&_!=="body"&&!g0(m.type,m.memoizedProps)),_&&(_=kc)){if(qy(m))throw FI(),Error(r(418));for(;_;)MI(m,_),_=yh(_.nextSibling)}if(VI(m),m.tag===13){if(m=m.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(r(317));e:{for(m=m.nextSibling,_=0;m;){if(m.nodeType===8){var w=m.data;if(w==="/$"){if(_===0){kc=yh(m.nextSibling);break e}_--}else w!=="$"&&w!=="$!"&&w!=="$?"||_++}m=m.nextSibling}kc=null}}else kc=Ac?yh(m.stateNode.nextSibling):null;return!0}function FI(){for(var m=kc;m;)m=yh(m.nextSibling)}function Em(){kc=Ac=null,qi=!1}function S0(m){Qa===null?Qa=[m]:Qa.push(m)}var XD=F.ReactCurrentBatchConfig;function vl(m,_){if(m&&m.defaultProps){_=ve({},_),m=m.defaultProps;for(var w in m)_[w]===void 0&&(_[w]=m[w]);return _}return _}var $y=Pu(null),mv=null,Lu=null,T0=null;function b0(){T0=Lu=mv=null}function w0(m){var _=$y.current;hs($y),m._currentValue=_}function Yy(m,_,w){for(;m!==null;){var P=m.alternate;if((m.childLanes&_)!==_?(m.childLanes|=_,P!==null&&(P.childLanes|=_)):P!==null&&(P.childLanes&_)!==_&&(P.childLanes|=_),m===w)break;m=m.return}}function Sm(m,_){mv=m,T0=Lu=null,m=m.dependencies,m!==null&&m.firstContext!==null&&((m.lanes&_)!==0&&(Oc=!0),m.firstContext=null)}function iu(m){var _=m._currentValue;if(T0!==m)if(m={context:m,memoizedValue:_,next:null},Lu===null){if(mv===null)throw Error(r(308));Lu=m,mv.dependencies={lanes:0,firstContext:m}}else Lu=Lu.next=m;return _}var $f=null;function C0(m){$f===null?$f=[m]:$f.push(m)}function jI(m,_,w,P){var V=_.interleaved;return V===null?(w.next=w,C0(_)):(w.next=V.next,V.next=w),_.interleaved=w,xu(m,P)}function xu(m,_){m.lanes|=_;var w=m.alternate;for(w!==null&&(w.lanes|=_),w=m,m=m.return;m!==null;)m.childLanes|=_,w=m.alternate,w!==null&&(w.childLanes|=_),w=m,m=m.return;return w.tag===3?w.stateNode:null}var bh=!1;function R0(m){m.updateQueue={baseState:m.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function BI(m,_){m=m.updateQueue,_.updateQueue===m&&(_.updateQueue={baseState:m.baseState,firstBaseUpdate:m.firstBaseUpdate,lastBaseUpdate:m.lastBaseUpdate,shared:m.shared,effects:m.effects})}function Md(m,_){return{eventTime:m,lane:_,tag:0,payload:null,callback:null,next:null}}function wh(m,_,w){var P=m.updateQueue;if(P===null)return null;if(P=P.shared,(ti&2)!==0){var V=P.pending;return V===null?_.next=_:(_.next=V.next,V.next=_),P.pending=_,xu(m,w)}return V=P.interleaved,V===null?(_.next=_,C0(P)):(_.next=V.next,V.next=_),P.interleaved=_,xu(m,w)}function Xy(m,_,w){if(_=_.updateQueue,_!==null&&(_=_.shared,(w&4194240)!==0)){var P=_.lanes;P&=m.pendingLanes,w|=P,_.lanes=w,Aa(m,w)}}function Jy(m,_){var w=m.updateQueue,P=m.alternate;if(P!==null&&(P=P.updateQueue,w===P)){var V=null,J=null;if(w=w.firstBaseUpdate,w!==null){do{var fe={eventTime:w.eventTime,lane:w.lane,tag:w.tag,payload:w.payload,callback:w.callback,next:null};J===null?V=J=fe:J=J.next=fe,w=w.next}while(w!==null);J===null?V=J=_:J=J.next=_}else V=J=_;w={baseState:P.baseState,firstBaseUpdate:V,lastBaseUpdate:J,shared:P.shared,effects:P.effects},m.updateQueue=w;return}m=w.lastBaseUpdate,m===null?w.firstBaseUpdate=_:m.next=_,w.lastBaseUpdate=_}function Qy(m,_,w,P){var V=m.updateQueue;bh=!1;var J=V.firstBaseUpdate,fe=V.lastBaseUpdate,Ie=V.shared.pending;if(Ie!==null){V.shared.pending=null;var je=Ie,ut=je.next;je.next=null,fe===null?J=ut:fe.next=ut,fe=je;var Nt=m.alternate;Nt!==null&&(Nt=Nt.updateQueue,Ie=Nt.lastBaseUpdate,Ie!==fe&&(Ie===null?Nt.firstBaseUpdate=ut:Ie.next=ut,Nt.lastBaseUpdate=je))}if(J!==null){var xt=V.baseState;fe=0,Nt=ut=je=null,Ie=J;do{var Ot=Ie.lane,on=Ie.eventTime;if((P&Ot)===Ot){Nt!==null&&(Nt=Nt.next={eventTime:on,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var ln=m,mn=Ie;switch(Ot=_,on=w,mn.tag){case 1:if(ln=mn.payload,typeof ln=="function"){xt=ln.call(on,xt,Ot);break e}xt=ln;break e;case 3:ln.flags=ln.flags&-65537|128;case 0:if(ln=mn.payload,Ot=typeof ln=="function"?ln.call(on,xt,Ot):ln,Ot==null)break e;xt=ve({},xt,Ot);break e;case 2:bh=!0}}Ie.callback!==null&&Ie.lane!==0&&(m.flags|=64,Ot=V.effects,Ot===null?V.effects=[Ie]:Ot.push(Ie))}else on={eventTime:on,lane:Ot,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},Nt===null?(ut=Nt=on,je=xt):Nt=Nt.next=on,fe|=Ot;if(Ie=Ie.next,Ie===null){if(Ie=V.shared.pending,Ie===null)break;Ot=Ie,Ie=Ot.next,Ot.next=null,V.lastBaseUpdate=Ot,V.shared.pending=null}}while(!0);if(Nt===null&&(je=xt),V.baseState=je,V.firstBaseUpdate=ut,V.lastBaseUpdate=Nt,_=V.shared.interleaved,_!==null){V=_;do fe|=V.lane,V=V.next;while(V!==_)}else J===null&&(V.shared.lanes=0);tp|=fe,m.lanes=fe,m.memoizedState=xt}}function I0(m,_,w){if(m=_.effects,_.effects=null,m!==null)for(_=0;_<m.length;_++){var P=m[_],V=P.callback;if(V!==null){if(P.callback=null,P=w,typeof V!="function")throw Error(r(191,V));V.call(P)}}}var WI=new t.Component().refs;function Zy(m,_,w,P){_=m.memoizedState,w=w(P,_),w=w==null?_:ve({},_,w),m.memoizedState=w,m.lanes===0&&(m.updateQueue.baseState=w)}var eE={isMounted:function(m){return(m=m._reactInternals)?to(m)===m:!1},enqueueSetState:function(m,_,w){m=m._reactInternals;var P=wo(),V=Bd(m),J=Md(P,V);J.payload=_,w!=null&&(J.callback=w),_=wh(m,J,V),_!==null&&(ou(_,m,V,P),Xy(_,m,V))},enqueueReplaceState:function(m,_,w){m=m._reactInternals;var P=wo(),V=Bd(m),J=Md(P,V);J.tag=1,J.payload=_,w!=null&&(J.callback=w),_=wh(m,J,V),_!==null&&(ou(_,m,V,P),Xy(_,m,V))},enqueueForceUpdate:function(m,_){m=m._reactInternals;var w=wo(),P=Bd(m),V=Md(w,P);V.tag=2,_!=null&&(V.callback=_),_=wh(m,V,P),_!==null&&(ou(_,m,P,w),Xy(_,m,P))}};function zI(m,_,w,P,V,J,fe){return m=m.stateNode,typeof m.shouldComponentUpdate=="function"?m.shouldComponentUpdate(P,J,fe):_.prototype&&_.prototype.isPureReactComponent?!rv(w,P)||!rv(V,J):!0}function GI(m,_,w){var P=!1,V=Sh,J=_.contextType;return typeof J=="object"&&J!==null?J=iu(J):(V=Ic(_)?Hf:ka.current,P=_.contextTypes,J=(P=P!=null)?Kf(m,V):Sh),_=new _(w,J),m.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=eE,m.stateNode=_,_._reactInternals=m,P&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=V,m.__reactInternalMemoizedMaskedChildContext=J),_}function HI(m,_,w,P){m=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(w,P),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(w,P),_.state!==m&&eE.enqueueReplaceState(_,_.state,null)}function A0(m,_,w,P){var V=m.stateNode;V.props=w,V.state=m.memoizedState,V.refs=WI,R0(m);var J=_.contextType;typeof J=="object"&&J!==null?V.context=iu(J):(J=Ic(_)?Hf:ka.current,V.context=Kf(m,J)),V.state=m.memoizedState,J=_.getDerivedStateFromProps,typeof J=="function"&&(Zy(m,_,J,w),V.state=m.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(_=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),_!==V.state&&eE.enqueueReplaceState(V,V.state,null),Qy(m,w,V,P),V.state=m.memoizedState),typeof V.componentDidMount=="function"&&(m.flags|=4194308)}function gv(m,_,w){if(m=w.ref,m!==null&&typeof m!="function"&&typeof m!="object"){if(w._owner){if(w=w._owner,w){if(w.tag!==1)throw Error(r(309));var P=w.stateNode}if(!P)throw Error(r(147,m));var V=P,J=""+m;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===J?_.ref:(_=function(fe){var Ie=V.refs;Ie===WI&&(Ie=V.refs={}),fe===null?delete Ie[J]:Ie[J]=fe},_._stringRef=J,_)}if(typeof m!="string")throw Error(r(284));if(!w._owner)throw Error(r(290,m))}return m}function vv(m,_){throw m=Object.prototype.toString.call(_),Error(r(31,m==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":m))}function KI(m){var _=m._init;return _(m._payload)}function qI(m){function _(Ze,We){if(m){var ot=Ze.deletions;ot===null?(Ze.deletions=[We],Ze.flags|=16):ot.push(We)}}function w(Ze,We){if(!m)return null;for(;We!==null;)_(Ze,We),We=We.sibling;return null}function P(Ze,We){for(Ze=new Map;We!==null;)We.key!==null?Ze.set(We.key,We):Ze.set(We.index,We),We=We.sibling;return Ze}function V(Ze,We){return Ze=Dh(Ze,We),Ze.index=0,Ze.sibling=null,Ze}function J(Ze,We,ot){return Ze.index=ot,m?(ot=Ze.alternate,ot!==null?(ot=ot.index,ot<We?(Ze.flags|=2,We):ot):(Ze.flags|=2,We)):(Ze.flags|=1048576,We)}function fe(Ze){return m&&Ze.alternate===null&&(Ze.flags|=2),Ze}function Ie(Ze,We,ot,Vt){return We===null||We.tag!==6?(We=cb(ot,Ze.mode,Vt),We.return=Ze,We):(We=V(We,ot),We.return=Ze,We)}function je(Ze,We,ot,Vt){var _n=ot.type;return _n===j?Nt(Ze,We,ot.props.children,Vt,ot.key):We!==null&&(We.elementType===_n||typeof _n=="object"&&_n!==null&&_n.$$typeof===ke&&KI(_n)===We.type)?(Vt=V(We,ot.props),Vt.ref=gv(Ze,We,ot),Vt.return=Ze,Vt):(Vt=yE(ot.type,ot.key,ot.props,null,Ze.mode,Vt),Vt.ref=gv(Ze,We,ot),Vt.return=Ze,Vt)}function ut(Ze,We,ot,Vt){return We===null||We.tag!==4||We.stateNode.containerInfo!==ot.containerInfo||We.stateNode.implementation!==ot.implementation?(We=ub(ot,Ze.mode,Vt),We.return=Ze,We):(We=V(We,ot.children||[]),We.return=Ze,We)}function Nt(Ze,We,ot,Vt,_n){return We===null||We.tag!==7?(We=Sl(ot,Ze.mode,Vt,_n),We.return=Ze,We):(We=V(We,ot),We.return=Ze,We)}function xt(Ze,We,ot){if(typeof We=="string"&&We!==""||typeof We=="number")return We=cb(""+We,Ze.mode,ot),We.return=Ze,We;if(typeof We=="object"&&We!==null){switch(We.$$typeof){case z:return ot=yE(We.type,We.key,We.props,null,Ze.mode,ot),ot.ref=gv(Ze,null,We),ot.return=Ze,ot;case te:return We=ub(We,Ze.mode,ot),We.return=Ze,We;case ke:var Vt=We._init;return xt(Ze,Vt(We._payload),ot)}if(rt(We)||Ve(We))return We=Sl(We,Ze.mode,ot,null),We.return=Ze,We;vv(Ze,We)}return null}function Ot(Ze,We,ot,Vt){var _n=We!==null?We.key:null;if(typeof ot=="string"&&ot!==""||typeof ot=="number")return _n!==null?null:Ie(Ze,We,""+ot,Vt);if(typeof ot=="object"&&ot!==null){switch(ot.$$typeof){case z:return ot.key===_n?je(Ze,We,ot,Vt):null;case te:return ot.key===_n?ut(Ze,We,ot,Vt):null;case ke:return _n=ot._init,Ot(Ze,We,_n(ot._payload),Vt)}if(rt(ot)||Ve(ot))return _n!==null?null:Nt(Ze,We,ot,Vt,null);vv(Ze,ot)}return null}function on(Ze,We,ot,Vt,_n){if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number")return Ze=Ze.get(ot)||null,Ie(We,Ze,""+Vt,_n);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case z:return Ze=Ze.get(Vt.key===null?ot:Vt.key)||null,je(We,Ze,Vt,_n);case te:return Ze=Ze.get(Vt.key===null?ot:Vt.key)||null,ut(We,Ze,Vt,_n);case ke:var Ln=Vt._init;return on(Ze,We,ot,Ln(Vt._payload),_n)}if(rt(Vt)||Ve(Vt))return Ze=Ze.get(ot)||null,Nt(We,Ze,Vt,_n,null);vv(We,Vt)}return null}function ln(Ze,We,ot,Vt){for(var _n=null,Ln=null,An=We,Yn=We=0,ao=null;An!==null&&Yn<ot.length;Yn++){An.index>Yn?(ao=An,An=null):ao=An.sibling;var ui=Ot(Ze,An,ot[Yn],Vt);if(ui===null){An===null&&(An=ao);break}m&&An&&ui.alternate===null&&_(Ze,An),We=J(ui,We,Yn),Ln===null?_n=ui:Ln.sibling=ui,Ln=ui,An=ao}if(Yn===ot.length)return w(Ze,An),qi&&xd(Ze,Yn),_n;if(An===null){for(;Yn<ot.length;Yn++)An=xt(Ze,ot[Yn],Vt),An!==null&&(We=J(An,We,Yn),Ln===null?_n=An:Ln.sibling=An,Ln=An);return qi&&xd(Ze,Yn),_n}for(An=P(Ze,An);Yn<ot.length;Yn++)ao=on(An,Ze,Yn,ot[Yn],Vt),ao!==null&&(m&&ao.alternate!==null&&An.delete(ao.key===null?Yn:ao.key),We=J(ao,We,Yn),Ln===null?_n=ao:Ln.sibling=ao,Ln=ao);return m&&An.forEach(function(Lh){return _(Ze,Lh)}),qi&&xd(Ze,Yn),_n}function mn(Ze,We,ot,Vt){var _n=Ve(ot);if(typeof _n!="function")throw Error(r(150));if(ot=_n.call(ot),ot==null)throw Error(r(151));for(var Ln=_n=null,An=We,Yn=We=0,ao=null,ui=ot.next();An!==null&&!ui.done;Yn++,ui=ot.next()){An.index>Yn?(ao=An,An=null):ao=An.sibling;var Lh=Ot(Ze,An,ui.value,Vt);if(Lh===null){An===null&&(An=ao);break}m&&An&&Lh.alternate===null&&_(Ze,An),We=J(Lh,We,Yn),Ln===null?_n=Lh:Ln.sibling=Lh,Ln=Lh,An=ao}if(ui.done)return w(Ze,An),qi&&xd(Ze,Yn),_n;if(An===null){for(;!ui.done;Yn++,ui=ot.next())ui=xt(Ze,ui.value,Vt),ui!==null&&(We=J(ui,We,Yn),Ln===null?_n=ui:Ln.sibling=ui,Ln=ui);return qi&&xd(Ze,Yn),_n}for(An=P(Ze,An);!ui.done;Yn++,ui=ot.next())ui=on(An,Ze,Yn,ui.value,Vt),ui!==null&&(m&&ui.alternate!==null&&An.delete(ui.key===null?Yn:ui.key),We=J(ui,We,Yn),Ln===null?_n=ui:Ln.sibling=ui,Ln=ui);return m&&An.forEach(function(UA){return _(Ze,UA)}),qi&&xd(Ze,Yn),_n}function Ks(Ze,We,ot,Vt){if(typeof ot=="object"&&ot!==null&&ot.type===j&&ot.key===null&&(ot=ot.props.children),typeof ot=="object"&&ot!==null){switch(ot.$$typeof){case z:e:{for(var _n=ot.key,Ln=We;Ln!==null;){if(Ln.key===_n){if(_n=ot.type,_n===j){if(Ln.tag===7){w(Ze,Ln.sibling),We=V(Ln,ot.props.children),We.return=Ze,Ze=We;break e}}else if(Ln.elementType===_n||typeof _n=="object"&&_n!==null&&_n.$$typeof===ke&&KI(_n)===Ln.type){w(Ze,Ln.sibling),We=V(Ln,ot.props),We.ref=gv(Ze,Ln,ot),We.return=Ze,Ze=We;break e}w(Ze,Ln);break}else _(Ze,Ln);Ln=Ln.sibling}ot.type===j?(We=Sl(ot.props.children,Ze.mode,Vt,ot.key),We.return=Ze,Ze=We):(Vt=yE(ot.type,ot.key,ot.props,null,Ze.mode,Vt),Vt.ref=gv(Ze,We,ot),Vt.return=Ze,Ze=Vt)}return fe(Ze);case te:e:{for(Ln=ot.key;We!==null;){if(We.key===Ln)if(We.tag===4&&We.stateNode.containerInfo===ot.containerInfo&&We.stateNode.implementation===ot.implementation){w(Ze,We.sibling),We=V(We,ot.children||[]),We.return=Ze,Ze=We;break e}else{w(Ze,We);break}else _(Ze,We);We=We.sibling}We=ub(ot,Ze.mode,Vt),We.return=Ze,Ze=We}return fe(Ze);case ke:return Ln=ot._init,Ks(Ze,We,Ln(ot._payload),Vt)}if(rt(ot))return ln(Ze,We,ot,Vt);if(Ve(ot))return mn(Ze,We,ot,Vt);vv(Ze,ot)}return typeof ot=="string"&&ot!==""||typeof ot=="number"?(ot=""+ot,We!==null&&We.tag===6?(w(Ze,We.sibling),We=V(We,ot),We.return=Ze,Ze=We):(w(Ze,We),We=cb(ot,Ze.mode,Vt),We.return=Ze,Ze=We),fe(Ze)):w(Ze,We)}return Ks}var Yf=qI(!0),$I=qI(!1),Ch={},_l=Pu(Ch),Ud=Pu(Ch),_v=Pu(Ch);function Xf(m){if(m===Ch)throw Error(r(174));return m}function k0(m,_){switch(rs(_v,_),rs(Ud,m),rs(_l,Ch),m=_.nodeType,m){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:Kt(null,"");break;default:m=m===8?_.parentNode:_,_=m.namespaceURI||null,m=m.tagName,_=Kt(_,m)}hs(_l),rs(_l,_)}function Tm(){hs(_l),hs(Ud),hs(_v)}function yv(m){Xf(_v.current);var _=Xf(_l.current),w=Kt(_,m.type);_!==w&&(rs(Ud,m),rs(_l,w))}function O0(m){Ud.current===m&&(hs(_l),hs(Ud))}var gs=Pu(0);function bm(m){for(var _=m;_!==null;){if(_.tag===13){var w=_.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===m)break;for(;_.sibling===null;){if(_.return===null||_.return===m)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var Ev=[];function P0(){for(var m=0;m<Ev.length;m++)Ev[m]._workInProgressVersionPrimary=null;Ev.length=0}var tE=F.ReactCurrentDispatcher,N0=F.ReactCurrentBatchConfig,Jf=0,Ss=null,xs=null,zo=null,Vd=!1,Qf=!1,Rh=0,Sv=0;function To(){throw Error(r(321))}function D0(m,_){if(_===null)return!1;for(var w=0;w<_.length&&w<m.length;w++)if(!gl(m[w],_[w]))return!1;return!0}function nE(m,_,w,P,V,J){if(Jf=J,Ss=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,tE.current=m===null||m.memoizedState===null?ZD:eL,m=w(P,V),Qf){J=0;do{if(Qf=!1,Rh=0,25<=J)throw Error(r(301));J+=1,zo=xs=null,_.updateQueue=null,tE.current=tL,m=w(P,V)}while(Qf)}if(tE.current=sE,_=xs!==null&&xs.next!==null,Jf=0,zo=xs=Ss=null,Vd=!1,_)throw Error(r(300));return m}function L0(){var m=Rh!==0;return Rh=0,m}function yl(){var m={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zo===null?Ss.memoizedState=zo=m:zo=zo.next=m,zo}function Mu(){if(xs===null){var m=Ss.alternate;m=m!==null?m.memoizedState:null}else m=xs.next;var _=zo===null?Ss.memoizedState:zo.next;if(_!==null)zo=_,xs=m;else{if(m===null)throw Error(r(310));xs=m,m={memoizedState:xs.memoizedState,baseState:xs.baseState,baseQueue:xs.baseQueue,queue:xs.queue,next:null},zo===null?Ss.memoizedState=zo=m:zo=zo.next=m}return zo}function Tv(m,_){return typeof _=="function"?_(m):_}function bv(m){var _=Mu(),w=_.queue;if(w===null)throw Error(r(311));w.lastRenderedReducer=m;var P=xs,V=P.baseQueue,J=w.pending;if(J!==null){if(V!==null){var fe=V.next;V.next=J.next,J.next=fe}P.baseQueue=V=J,w.pending=null}if(V!==null){J=V.next,P=P.baseState;var Ie=fe=null,je=null,ut=J;do{var Nt=ut.lane;if((Jf&Nt)===Nt)je!==null&&(je=je.next={lane:0,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null}),P=ut.hasEagerState?ut.eagerState:m(P,ut.action);else{var xt={lane:Nt,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null};je===null?(Ie=je=xt,fe=P):je=je.next=xt,Ss.lanes|=Nt,tp|=Nt}ut=ut.next}while(ut!==null&&ut!==J);je===null?fe=P:je.next=Ie,gl(P,_.memoizedState)||(Oc=!0),_.memoizedState=P,_.baseState=fe,_.baseQueue=je,w.lastRenderedState=P}if(m=w.interleaved,m!==null){V=m;do J=V.lane,Ss.lanes|=J,tp|=J,V=V.next;while(V!==m)}else V===null&&(w.lanes=0);return[_.memoizedState,w.dispatch]}function wv(m){var _=Mu(),w=_.queue;if(w===null)throw Error(r(311));w.lastRenderedReducer=m;var P=w.dispatch,V=w.pending,J=_.memoizedState;if(V!==null){w.pending=null;var fe=V=V.next;do J=m(J,fe.action),fe=fe.next;while(fe!==V);gl(J,_.memoizedState)||(Oc=!0),_.memoizedState=J,_.baseQueue===null&&(_.baseState=J),w.lastRenderedState=J}return[J,P]}function YI(){}function XI(m,_){var w=Ss,P=Mu(),V=_(),J=!gl(P.memoizedState,V);if(J&&(P.memoizedState=V,Oc=!0),P=P.queue,iE(JI.bind(null,w,P,m),[m]),P.getSnapshot!==_||J||zo!==null&&zo.memoizedState.tag&1){if(w.flags|=2048,wm(9,rE.bind(null,w,P,V,_),void 0,null),oo===null)throw Error(r(349));(Jf&30)!==0||x0(w,_,V)}return V}function x0(m,_,w){m.flags|=16384,m={getSnapshot:_,value:w},_=Ss.updateQueue,_===null?(_={lastEffect:null,stores:null},Ss.updateQueue=_,_.stores=[m]):(w=_.stores,w===null?_.stores=[m]:w.push(m))}function rE(m,_,w,P){_.value=w,_.getSnapshot=P,El(_)&&Zf(m)}function JI(m,_,w){return w(function(){El(_)&&Zf(m)})}function El(m){var _=m.getSnapshot;m=m.value;try{var w=_();return!gl(m,w)}catch{return!0}}function Zf(m){var _=xu(m,1);_!==null&&ou(_,m,1,-1)}function Ih(m){var _=yl();return typeof m=="function"&&(m=m()),_.memoizedState=_.baseState=m,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Tv,lastRenderedState:m},_.queue=m,m=m.dispatch=j0.bind(null,Ss,m),[_.memoizedState,m]}function wm(m,_,w,P){return m={tag:m,create:_,destroy:w,deps:P,next:null},_=Ss.updateQueue,_===null?(_={lastEffect:null,stores:null},Ss.updateQueue=_,_.lastEffect=m.next=m):(w=_.lastEffect,w===null?_.lastEffect=m.next=m:(P=w.next,w.next=m,m.next=P,_.lastEffect=m)),m}function M0(){return Mu().memoizedState}function $l(m,_,w,P){var V=yl();Ss.flags|=m,V.memoizedState=wm(1|_,w,void 0,P===void 0?null:P)}function Cm(m,_,w,P){var V=Mu();P=P===void 0?null:P;var J=void 0;if(xs!==null){var fe=xs.memoizedState;if(J=fe.destroy,P!==null&&D0(P,fe.deps)){V.memoizedState=wm(_,w,J,P);return}}Ss.flags|=m,V.memoizedState=wm(1|_,w,J,P)}function QI(m,_){return $l(8390656,8,m,_)}function iE(m,_){return Cm(2048,8,m,_)}function ZI(m,_){return Cm(4,2,m,_)}function U0(m,_){return Cm(4,4,m,_)}function V0(m,_){if(typeof _=="function")return m=m(),_(m),function(){_(null)};if(_!=null)return m=m(),_.current=m,function(){_.current=null}}function eA(m,_,w){return w=w!=null?w.concat([m]):null,Cm(4,4,V0.bind(null,_,m),w)}function Yl(){}function tA(m,_){var w=Mu();_=_===void 0?null:_;var P=w.memoizedState;return P!==null&&_!==null&&D0(_,P[1])?P[0]:(w.memoizedState=[m,_],m)}function nA(m,_){var w=Mu();_=_===void 0?null:_;var P=w.memoizedState;return P!==null&&_!==null&&D0(_,P[1])?P[0]:(m=m(),w.memoizedState=[m,_],m)}function rA(m,_,w){return(Jf&21)===0?(m.baseState&&(m.baseState=!1,Oc=!0),m.memoizedState=w):(gl(w,_)||(w=fl(),Ss.lanes|=w,tp|=w,m.baseState=!0),_)}function JD(m,_){var w=pr;pr=w!==0&&4>w?w:4,m(!0);var P=N0.transition;N0.transition={};try{m(!1),_()}finally{pr=w,N0.transition=P}}function F0(){return Mu().memoizedState}function QD(m,_,w){var P=Bd(m);if(w={lane:P,action:w,hasEagerState:!1,eagerState:null,next:null},B0(m))iA(_,w);else if(w=jI(m,_,w,P),w!==null){var V=wo();ou(w,m,P,V),W0(w,_,P)}}function j0(m,_,w){var P=Bd(m),V={lane:P,action:w,hasEagerState:!1,eagerState:null,next:null};if(B0(m))iA(_,V);else{var J=m.alternate;if(m.lanes===0&&(J===null||J.lanes===0)&&(J=_.lastRenderedReducer,J!==null))try{var fe=_.lastRenderedState,Ie=J(fe,w);if(V.hasEagerState=!0,V.eagerState=Ie,gl(Ie,fe)){var je=_.interleaved;je===null?(V.next=V,C0(_)):(V.next=je.next,je.next=V),_.interleaved=V;return}}catch{}finally{}w=jI(m,_,V,P),w!==null&&(V=wo(),ou(w,m,P,V),W0(w,_,P))}}function B0(m){var _=m.alternate;return m===Ss||_!==null&&_===Ss}function iA(m,_){Qf=Vd=!0;var w=m.pending;w===null?_.next=_:(_.next=w.next,w.next=_),m.pending=_}function W0(m,_,w){if((w&4194240)!==0){var P=_.lanes;P&=m.pendingLanes,w|=P,_.lanes=w,Aa(m,w)}}var sE={readContext:iu,useCallback:To,useContext:To,useEffect:To,useImperativeHandle:To,useInsertionEffect:To,useLayoutEffect:To,useMemo:To,useReducer:To,useRef:To,useState:To,useDebugValue:To,useDeferredValue:To,useTransition:To,useMutableSource:To,useSyncExternalStore:To,useId:To,unstable_isNewReconciler:!1},ZD={readContext:iu,useCallback:function(m,_){return yl().memoizedState=[m,_===void 0?null:_],m},useContext:iu,useEffect:QI,useImperativeHandle:function(m,_,w){return w=w!=null?w.concat([m]):null,$l(4194308,4,V0.bind(null,_,m),w)},useLayoutEffect:function(m,_){return $l(4194308,4,m,_)},useInsertionEffect:function(m,_){return $l(4,2,m,_)},useMemo:function(m,_){var w=yl();return _=_===void 0?null:_,m=m(),w.memoizedState=[m,_],m},useReducer:function(m,_,w){var P=yl();return _=w!==void 0?w(_):_,P.memoizedState=P.baseState=_,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:_},P.queue=m,m=m.dispatch=QD.bind(null,Ss,m),[P.memoizedState,m]},useRef:function(m){var _=yl();return m={current:m},_.memoizedState=m},useState:Ih,useDebugValue:Yl,useDeferredValue:function(m){return yl().memoizedState=m},useTransition:function(){var m=Ih(!1),_=m[0];return m=JD.bind(null,m[1]),yl().memoizedState=m,[_,m]},useMutableSource:function(){},useSyncExternalStore:function(m,_,w){var P=Ss,V=yl();if(qi){if(w===void 0)throw Error(r(407));w=w()}else{if(w=_(),oo===null)throw Error(r(349));(Jf&30)!==0||x0(P,_,w)}V.memoizedState=w;var J={value:w,getSnapshot:_};return V.queue=J,QI(JI.bind(null,P,J,m),[m]),P.flags|=2048,wm(9,rE.bind(null,P,J,w,_),void 0,null),w},useId:function(){var m=yl(),_=oo.identifierPrefix;if(qi){var w=Ld,P=Dd;w=(P&~(1<<32-Ls(P)-1)).toString(32)+w,_=":"+_+"R"+w,w=Rh++,0<w&&(_+="H"+w.toString(32)),_+=":"}else w=Sv++,_=":"+_+"r"+w.toString(32)+":";return m.memoizedState=_},unstable_isNewReconciler:!1},eL={readContext:iu,useCallback:tA,useContext:iu,useEffect:iE,useImperativeHandle:eA,useInsertionEffect:ZI,useLayoutEffect:U0,useMemo:nA,useReducer:bv,useRef:M0,useState:function(){return bv(Tv)},useDebugValue:Yl,useDeferredValue:function(m){var _=Mu();return rA(_,xs.memoizedState,m)},useTransition:function(){var m=bv(Tv)[0],_=Mu().memoizedState;return[m,_]},useMutableSource:YI,useSyncExternalStore:XI,useId:F0,unstable_isNewReconciler:!1},tL={readContext:iu,useCallback:tA,useContext:iu,useEffect:iE,useImperativeHandle:eA,useInsertionEffect:ZI,useLayoutEffect:U0,useMemo:nA,useReducer:wv,useRef:M0,useState:function(){return wv(Tv)},useDebugValue:Yl,useDeferredValue:function(m){var _=Mu();return xs===null?_.memoizedState=m:rA(_,xs.memoizedState,m)},useTransition:function(){var m=wv(Tv)[0],_=Mu().memoizedState;return[m,_]},useMutableSource:YI,useSyncExternalStore:XI,useId:F0,unstable_isNewReconciler:!1};function Rm(m,_){try{var w="",P=_;do w+=Dt(P),P=P.return;while(P);var V=w}catch(J){V=`
Error generating stack: `+J.message+`
`+J.stack}return{value:m,source:_,stack:V,digest:null}}function z0(m,_,w){return{value:m,source:null,stack:w??null,digest:_??null}}function G0(m,_){try{console.error(_.value)}catch(w){setTimeout(function(){throw w})}}var sA=typeof WeakMap=="function"?WeakMap:Map;function Fd(m,_,w){w=Md(-1,w),w.tag=3,w.payload={element:null};var P=_.value;return w.callback=function(){fE||(fE=!0,rb=P),G0(m,_)},w}function oA(m,_,w){w=Md(-1,w),w.tag=3;var P=m.type.getDerivedStateFromError;if(typeof P=="function"){var V=_.value;w.payload=function(){return P(V)},w.callback=function(){G0(m,_)}}var J=m.stateNode;return J!==null&&typeof J.componentDidCatch=="function"&&(w.callback=function(){G0(m,_),typeof P!="function"&&(Jl===null?Jl=new Set([this]):Jl.add(this));var fe=_.stack;this.componentDidCatch(_.value,{componentStack:fe!==null?fe:""})}),w}function aA(m,_,w){var P=m.pingCache;if(P===null){P=m.pingCache=new sA;var V=new Set;P.set(_,V)}else V=P.get(_),V===void 0&&(V=new Set,P.set(_,V));V.has(w)||(V.add(w),m=PA.bind(null,m,_,w),_.then(m,m))}function cA(m){do{var _;if((_=m.tag===13)&&(_=m.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return m;m=m.return}while(m!==null);return null}function uA(m,_,w,P,V){return(m.mode&1)===0?(m===_?m.flags|=65536:(m.flags|=128,w.flags|=131072,w.flags&=-52805,w.tag===1&&(w.alternate===null?w.tag=17:(_=Md(-1,1),_.tag=2,wh(w,_,1))),w.lanes|=1),m):(m.flags|=65536,m.lanes=V,m)}var nL=F.ReactCurrentOwner,Oc=!1;function ca(m,_,w,P){_.child=m===null?$I(_,null,w,P):Yf(_,m.child,w,P)}function lA(m,_,w,P,V){w=w.render;var J=_.ref;return Sm(_,V),P=nE(m,_,w,P,J,V),w=L0(),m!==null&&!Oc?(_.updateQueue=m.updateQueue,_.flags&=-2053,m.lanes&=~V,Xl(m,_,V)):(qi&&w&&Ky(_),_.flags|=1,ca(m,_,P,V),_.child)}function dA(m,_,w,P,V){if(m===null){var J=w.type;return typeof J=="function"&&!Gd(J)&&J.defaultProps===void 0&&w.compare===null&&w.defaultProps===void 0?(_.tag=15,_.type=J,hA(m,_,J,P,V)):(m=yE(w.type,null,P,_,_.mode,V),m.ref=_.ref,m.return=_,_.child=m)}if(J=m.child,(m.lanes&V)===0){var fe=J.memoizedProps;if(w=w.compare,w=w!==null?w:rv,w(fe,P)&&m.ref===_.ref)return Xl(m,_,V)}return _.flags|=1,m=Dh(J,P),m.ref=_.ref,m.return=_,_.child=m}function hA(m,_,w,P,V){if(m!==null){var J=m.memoizedProps;if(rv(J,P)&&m.ref===_.ref)if(Oc=!1,_.pendingProps=P=J,(m.lanes&V)!==0)(m.flags&131072)!==0&&(Oc=!0);else return _.lanes=m.lanes,Xl(m,_,V)}return H0(m,_,w,P,V)}function fA(m,_,w){var P=_.pendingProps,V=P.children,J=m!==null?m.memoizedState:null;if(P.mode==="hidden")if((_.mode&1)===0)_.memoizedState={baseLanes:0,cachePool:null,transitions:null},rs(ep,Ho),Ho|=w;else{if((w&1073741824)===0)return m=J!==null?J.baseLanes|w:w,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:m,cachePool:null,transitions:null},_.updateQueue=null,rs(ep,Ho),Ho|=m,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},P=J!==null?J.baseLanes:w,rs(ep,Ho),Ho|=P}else J!==null?(P=J.baseLanes|w,_.memoizedState=null):P=w,rs(ep,Ho),Ho|=P;return ca(m,_,V,w),_.child}function pA(m,_){var w=_.ref;(m===null&&w!==null||m!==null&&m.ref!==w)&&(_.flags|=512,_.flags|=2097152)}function H0(m,_,w,P,V){var J=Ic(w)?Hf:ka.current;return J=Kf(_,J),Sm(_,V),w=nE(m,_,w,P,J,V),P=L0(),m!==null&&!Oc?(_.updateQueue=m.updateQueue,_.flags&=-2053,m.lanes&=~V,Xl(m,_,V)):(qi&&P&&Ky(_),_.flags|=1,ca(m,_,w,V),_.child)}function K0(m,_,w,P,V){if(Ic(w)){var J=!0;Wy(_)}else J=!1;if(Sm(_,V),_.stateNode===null)Av(m,_),GI(_,w,P),A0(_,w,P,V),P=!0;else if(m===null){var fe=_.stateNode,Ie=_.memoizedProps;fe.props=Ie;var je=fe.context,ut=w.contextType;typeof ut=="object"&&ut!==null?ut=iu(ut):(ut=Ic(w)?Hf:ka.current,ut=Kf(_,ut));var Nt=w.getDerivedStateFromProps,xt=typeof Nt=="function"||typeof fe.getSnapshotBeforeUpdate=="function";xt||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Ie!==P||je!==ut)&&HI(_,fe,P,ut),bh=!1;var Ot=_.memoizedState;fe.state=Ot,Qy(_,P,fe,V),je=_.memoizedState,Ie!==P||Ot!==je||Rc.current||bh?(typeof Nt=="function"&&(Zy(_,w,Nt,P),je=_.memoizedState),(Ie=bh||zI(_,w,Ie,P,Ot,je,ut))?(xt||typeof fe.UNSAFE_componentWillMount!="function"&&typeof fe.componentWillMount!="function"||(typeof fe.componentWillMount=="function"&&fe.componentWillMount(),typeof fe.UNSAFE_componentWillMount=="function"&&fe.UNSAFE_componentWillMount()),typeof fe.componentDidMount=="function"&&(_.flags|=4194308)):(typeof fe.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=P,_.memoizedState=je),fe.props=P,fe.state=je,fe.context=ut,P=Ie):(typeof fe.componentDidMount=="function"&&(_.flags|=4194308),P=!1)}else{fe=_.stateNode,BI(m,_),Ie=_.memoizedProps,ut=_.type===_.elementType?Ie:vl(_.type,Ie),fe.props=ut,xt=_.pendingProps,Ot=fe.context,je=w.contextType,typeof je=="object"&&je!==null?je=iu(je):(je=Ic(w)?Hf:ka.current,je=Kf(_,je));var on=w.getDerivedStateFromProps;(Nt=typeof on=="function"||typeof fe.getSnapshotBeforeUpdate=="function")||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Ie!==xt||Ot!==je)&&HI(_,fe,P,je),bh=!1,Ot=_.memoizedState,fe.state=Ot,Qy(_,P,fe,V);var ln=_.memoizedState;Ie!==xt||Ot!==ln||Rc.current||bh?(typeof on=="function"&&(Zy(_,w,on,P),ln=_.memoizedState),(ut=bh||zI(_,w,ut,P,Ot,ln,je)||!1)?(Nt||typeof fe.UNSAFE_componentWillUpdate!="function"&&typeof fe.componentWillUpdate!="function"||(typeof fe.componentWillUpdate=="function"&&fe.componentWillUpdate(P,ln,je),typeof fe.UNSAFE_componentWillUpdate=="function"&&fe.UNSAFE_componentWillUpdate(P,ln,je)),typeof fe.componentDidUpdate=="function"&&(_.flags|=4),typeof fe.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof fe.componentDidUpdate!="function"||Ie===m.memoizedProps&&Ot===m.memoizedState||(_.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Ie===m.memoizedProps&&Ot===m.memoizedState||(_.flags|=1024),_.memoizedProps=P,_.memoizedState=ln),fe.props=P,fe.state=ln,fe.context=je,P=ut):(typeof fe.componentDidUpdate!="function"||Ie===m.memoizedProps&&Ot===m.memoizedState||(_.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Ie===m.memoizedProps&&Ot===m.memoizedState||(_.flags|=1024),P=!1)}return oE(m,_,w,P,J,V)}function oE(m,_,w,P,V,J){pA(m,_);var fe=(_.flags&128)!==0;if(!P&&!fe)return V&&LI(_,w,!1),Xl(m,_,J);P=_.stateNode,nL.current=_;var Ie=fe&&typeof w.getDerivedStateFromError!="function"?null:P.render();return _.flags|=1,m!==null&&fe?(_.child=Yf(_,m.child,null,J),_.child=Yf(_,null,Ie,J)):ca(m,_,Ie,J),_.memoizedState=P.state,V&&LI(_,w,!0),_.child}function mA(m){var _=m.stateNode;_.pendingContext?DI(m,_.pendingContext,_.pendingContext!==_.context):_.context&&DI(m,_.context,!1),k0(m,_.containerInfo)}function gA(m,_,w,P,V){return Em(),S0(V),_.flags|=256,ca(m,_,w,P),_.child}var Im={dehydrated:null,treeContext:null,retryLane:0};function Cv(m){return{baseLanes:m,cachePool:null,transitions:null}}function q0(m,_,w){var P=_.pendingProps,V=gs.current,J=!1,fe=(_.flags&128)!==0,Ie;if((Ie=fe)||(Ie=m!==null&&m.memoizedState===null?!1:(V&2)!==0),Ie?(J=!0,_.flags&=-129):(m===null||m.memoizedState!==null)&&(V|=1),rs(gs,V&1),m===null)return E0(_),m=_.memoizedState,m!==null&&(m=m.dehydrated,m!==null)?((_.mode&1)===0?_.lanes=1:m.data==="$!"?_.lanes=8:_.lanes=1073741824,null):(fe=P.children,m=P.fallback,J?(P=_.mode,J=_.child,fe={mode:"hidden",children:fe},(P&1)===0&&J!==null?(J.childLanes=0,J.pendingProps=fe):J=EE(fe,P,0,null),m=Sl(m,P,w,null),J.return=_,m.return=_,J.sibling=m,_.child=J,_.child.memoizedState=Cv(w),_.memoizedState=Im,m):Am(_,fe));if(V=m.memoizedState,V!==null&&(Ie=V.dehydrated,Ie!==null))return rL(m,_,fe,P,Ie,V,w);if(J){J=P.fallback,fe=_.mode,V=m.child,Ie=V.sibling;var je={mode:"hidden",children:P.children};return(fe&1)===0&&_.child!==V?(P=_.child,P.childLanes=0,P.pendingProps=je,_.deletions=null):(P=Dh(V,je),P.subtreeFlags=V.subtreeFlags&14680064),Ie!==null?J=Dh(Ie,J):(J=Sl(J,fe,w,null),J.flags|=2),J.return=_,P.return=_,P.sibling=J,_.child=P,P=J,J=_.child,fe=m.child.memoizedState,fe=fe===null?Cv(w):{baseLanes:fe.baseLanes|w,cachePool:null,transitions:fe.transitions},J.memoizedState=fe,J.childLanes=m.childLanes&~w,_.memoizedState=Im,P}return J=m.child,m=J.sibling,P=Dh(J,{mode:"visible",children:P.children}),(_.mode&1)===0&&(P.lanes=w),P.return=_,P.sibling=null,m!==null&&(w=_.deletions,w===null?(_.deletions=[m],_.flags|=16):w.push(m)),_.child=P,_.memoizedState=null,P}function Am(m,_){return _=EE({mode:"visible",children:_},m.mode,0,null),_.return=m,m.child=_}function Rv(m,_,w,P){return P!==null&&S0(P),Yf(_,m.child,null,w),m=Am(_,_.pendingProps.children),m.flags|=2,_.memoizedState=null,m}function rL(m,_,w,P,V,J,fe){if(w)return _.flags&256?(_.flags&=-257,P=z0(Error(r(422))),Rv(m,_,fe,P)):_.memoizedState!==null?(_.child=m.child,_.flags|=128,null):(J=P.fallback,V=_.mode,P=EE({mode:"visible",children:P.children},V,0,null),J=Sl(J,V,fe,null),J.flags|=2,P.return=_,J.return=_,P.sibling=J,_.child=P,(_.mode&1)!==0&&Yf(_,m.child,null,fe),_.child.memoizedState=Cv(fe),_.memoizedState=Im,J);if((_.mode&1)===0)return Rv(m,_,fe,null);if(V.data==="$!"){if(P=V.nextSibling&&V.nextSibling.dataset,P)var Ie=P.dgst;return P=Ie,J=Error(r(419)),P=z0(J,P,void 0),Rv(m,_,fe,P)}if(Ie=(fe&m.childLanes)!==0,Oc||Ie){if(P=oo,P!==null){switch(fe&-fe){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}V=(V&(P.suspendedLanes|fe))!==0?0:V,V!==0&&V!==J.retryLane&&(J.retryLane=V,xu(m,V),ou(P,m,V,-1))}return zd(),P=z0(Error(r(421))),Rv(m,_,fe,P)}return V.data==="$?"?(_.flags|=128,_.child=m.child,_=NA.bind(null,m),V._reactRetry=_,null):(m=J.treeContext,kc=yh(V.nextSibling),Ac=_,qi=!0,Qa=null,m!==null&&(Du[ru++]=Dd,Du[ru++]=Ld,Du[ru++]=qf,Dd=m.id,Ld=m.overflow,qf=_),_=Am(_,P.children),_.flags|=4096,_)}function $0(m,_,w){m.lanes|=_;var P=m.alternate;P!==null&&(P.lanes|=_),Yy(m.return,_,w)}function Iv(m,_,w,P,V){var J=m.memoizedState;J===null?m.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:P,tail:w,tailMode:V}:(J.isBackwards=_,J.rendering=null,J.renderingStartTime=0,J.last=P,J.tail=w,J.tailMode=V)}function vA(m,_,w){var P=_.pendingProps,V=P.revealOrder,J=P.tail;if(ca(m,_,P.children,w),P=gs.current,(P&2)!==0)P=P&1|2,_.flags|=128;else{if(m!==null&&(m.flags&128)!==0)e:for(m=_.child;m!==null;){if(m.tag===13)m.memoizedState!==null&&$0(m,w,_);else if(m.tag===19)$0(m,w,_);else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===_)break e;for(;m.sibling===null;){if(m.return===null||m.return===_)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}P&=1}if(rs(gs,P),(_.mode&1)===0)_.memoizedState=null;else switch(V){case"forwards":for(w=_.child,V=null;w!==null;)m=w.alternate,m!==null&&bm(m)===null&&(V=w),w=w.sibling;w=V,w===null?(V=_.child,_.child=null):(V=w.sibling,w.sibling=null),Iv(_,!1,V,w,J);break;case"backwards":for(w=null,V=_.child,_.child=null;V!==null;){if(m=V.alternate,m!==null&&bm(m)===null){_.child=V;break}m=V.sibling,V.sibling=w,w=V,V=m}Iv(_,!0,w,null,J);break;case"together":Iv(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function Av(m,_){(_.mode&1)===0&&m!==null&&(m.alternate=null,_.alternate=null,_.flags|=2)}function Xl(m,_,w){if(m!==null&&(_.dependencies=m.dependencies),tp|=_.lanes,(w&_.childLanes)===0)return null;if(m!==null&&_.child!==m.child)throw Error(r(153));if(_.child!==null){for(m=_.child,w=Dh(m,m.pendingProps),_.child=w,w.return=_;m.sibling!==null;)m=m.sibling,w=w.sibling=Dh(m,m.pendingProps),w.return=_;w.sibling=null}return _.child}function iL(m,_,w){switch(_.tag){case 3:mA(_),Em();break;case 5:yv(_);break;case 1:Ic(_.type)&&Wy(_);break;case 4:k0(_,_.stateNode.containerInfo);break;case 10:var P=_.type._context,V=_.memoizedProps.value;rs($y,P._currentValue),P._currentValue=V;break;case 13:if(P=_.memoizedState,P!==null)return P.dehydrated!==null?(rs(gs,gs.current&1),_.flags|=128,null):(w&_.child.childLanes)!==0?q0(m,_,w):(rs(gs,gs.current&1),m=Xl(m,_,w),m!==null?m.sibling:null);rs(gs,gs.current&1);break;case 19:if(P=(w&_.childLanes)!==0,(m.flags&128)!==0){if(P)return vA(m,_,w);_.flags|=128}if(V=_.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),rs(gs,gs.current),P)break;return null;case 22:case 23:return _.lanes=0,fA(m,_,w)}return Xl(m,_,w)}var Y0,aE,_A,yA;Y0=function(m,_){for(var w=_.child;w!==null;){if(w.tag===5||w.tag===6)m.appendChild(w.stateNode);else if(w.tag!==4&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===_)break;for(;w.sibling===null;){if(w.return===null||w.return===_)return;w=w.return}w.sibling.return=w.return,w=w.sibling}},aE=function(){},_A=function(m,_,w,P){var V=m.memoizedProps;if(V!==P){m=_.stateNode,Xf(_l.current);var J=null;switch(w){case"input":V=wr(m,V),P=wr(m,P),J=[];break;case"select":V=ve({},V,{value:void 0}),P=ve({},P,{value:void 0}),J=[];break;case"textarea":V=ct(m,V),P=ct(m,P),J=[];break;default:typeof V.onClick!="function"&&typeof P.onClick=="function"&&(m.onclick=Vy)}Bi(w,P);var fe;w=null;for(ut in V)if(!P.hasOwnProperty(ut)&&V.hasOwnProperty(ut)&&V[ut]!=null)if(ut==="style"){var Ie=V[ut];for(fe in Ie)Ie.hasOwnProperty(fe)&&(w||(w={}),w[fe]="")}else ut!=="dangerouslySetInnerHTML"&&ut!=="children"&&ut!=="suppressContentEditableWarning"&&ut!=="suppressHydrationWarning"&&ut!=="autoFocus"&&(a.hasOwnProperty(ut)?J||(J=[]):(J=J||[]).push(ut,null));for(ut in P){var je=P[ut];if(Ie=V!=null?V[ut]:void 0,P.hasOwnProperty(ut)&&je!==Ie&&(je!=null||Ie!=null))if(ut==="style")if(Ie){for(fe in Ie)!Ie.hasOwnProperty(fe)||je&&je.hasOwnProperty(fe)||(w||(w={}),w[fe]="");for(fe in je)je.hasOwnProperty(fe)&&Ie[fe]!==je[fe]&&(w||(w={}),w[fe]=je[fe])}else w||(J||(J=[]),J.push(ut,w)),w=je;else ut==="dangerouslySetInnerHTML"?(je=je?je.__html:void 0,Ie=Ie?Ie.__html:void 0,je!=null&&Ie!==je&&(J=J||[]).push(ut,je)):ut==="children"?typeof je!="string"&&typeof je!="number"||(J=J||[]).push(ut,""+je):ut!=="suppressContentEditableWarning"&&ut!=="suppressHydrationWarning"&&(a.hasOwnProperty(ut)?(je!=null&&ut==="onScroll"&&ds("scroll",m),J||Ie===je||(J=[])):(J=J||[]).push(ut,je))}w&&(J=J||[]).push("style",w);var ut=J;(_.updateQueue=ut)&&(_.flags|=4)}},yA=function(m,_,w,P){w!==P&&(_.flags|=4)};function kv(m,_){if(!qi)switch(m.tailMode){case"hidden":_=m.tail;for(var w=null;_!==null;)_.alternate!==null&&(w=_),_=_.sibling;w===null?m.tail=null:w.sibling=null;break;case"collapsed":w=m.tail;for(var P=null;w!==null;)w.alternate!==null&&(P=w),w=w.sibling;P===null?_||m.tail===null?m.tail=null:m.tail.sibling=null:P.sibling=null}}function bo(m){var _=m.alternate!==null&&m.alternate.child===m.child,w=0,P=0;if(_)for(var V=m.child;V!==null;)w|=V.lanes|V.childLanes,P|=V.subtreeFlags&14680064,P|=V.flags&14680064,V.return=m,V=V.sibling;else for(V=m.child;V!==null;)w|=V.lanes|V.childLanes,P|=V.subtreeFlags,P|=V.flags,V.return=m,V=V.sibling;return m.subtreeFlags|=P,m.childLanes=w,_}function sL(m,_,w){var P=_.pendingProps;switch(fv(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bo(_),null;case 1:return Ic(_.type)&&jy(),bo(_),null;case 3:return P=_.stateNode,Tm(),hs(Rc),hs(ka),P0(),P.pendingContext&&(P.context=P.pendingContext,P.pendingContext=null),(m===null||m.child===null)&&(pv(_)?_.flags|=4:m===null||m.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,Qa!==null&&(Mm(Qa),Qa=null))),aE(m,_),bo(_),null;case 5:O0(_);var V=Xf(_v.current);if(w=_.type,m!==null&&_.stateNode!=null)_A(m,_,w,P,V),m.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!P){if(_.stateNode===null)throw Error(r(166));return bo(_),null}if(m=Xf(_l.current),pv(_)){P=_.stateNode,w=_.type;var J=_.memoizedProps;switch(P[ql]=_,P[Eh]=J,m=(_.mode&1)!==0,w){case"dialog":ds("cancel",P),ds("close",P);break;case"iframe":case"object":case"embed":ds("load",P);break;case"video":case"audio":for(V=0;V<av.length;V++)ds(av[V],P);break;case"source":ds("error",P);break;case"img":case"image":case"link":ds("error",P),ds("load",P);break;case"details":ds("toggle",P);break;case"input":Pt(P,J),ds("invalid",P);break;case"select":P._wrapperState={wasMultiple:!!J.multiple},ds("invalid",P);break;case"textarea":Ke(P,J),ds("invalid",P)}Bi(w,J),V=null;for(var fe in J)if(J.hasOwnProperty(fe)){var Ie=J[fe];fe==="children"?typeof Ie=="string"?P.textContent!==Ie&&(J.suppressHydrationWarning!==!0&&Uy(P.textContent,Ie,m),V=["children",Ie]):typeof Ie=="number"&&P.textContent!==""+Ie&&(J.suppressHydrationWarning!==!0&&Uy(P.textContent,Ie,m),V=["children",""+Ie]):a.hasOwnProperty(fe)&&Ie!=null&&fe==="onScroll"&&ds("scroll",P)}switch(w){case"input":Er(P),Ae(P,J,!0);break;case"textarea":Er(P),At(P);break;case"select":case"option":break;default:typeof J.onClick=="function"&&(P.onclick=Vy)}P=V,_.updateQueue=P,P!==null&&(_.flags|=4)}else{fe=V.nodeType===9?V:V.ownerDocument,m==="http://www.w3.org/1999/xhtml"&&(m=It(w)),m==="http://www.w3.org/1999/xhtml"?w==="script"?(m=fe.createElement("div"),m.innerHTML="<script><\/script>",m=m.removeChild(m.firstChild)):typeof P.is=="string"?m=fe.createElement(w,{is:P.is}):(m=fe.createElement(w),w==="select"&&(fe=m,P.multiple?fe.multiple=!0:P.size&&(fe.size=P.size))):m=fe.createElementNS(m,w),m[ql]=_,m[Eh]=P,Y0(m,_,!1,!1),_.stateNode=m;e:{switch(fe=za(w,P),w){case"dialog":ds("cancel",m),ds("close",m),V=P;break;case"iframe":case"object":case"embed":ds("load",m),V=P;break;case"video":case"audio":for(V=0;V<av.length;V++)ds(av[V],m);V=P;break;case"source":ds("error",m),V=P;break;case"img":case"image":case"link":ds("error",m),ds("load",m),V=P;break;case"details":ds("toggle",m),V=P;break;case"input":Pt(m,P),V=wr(m,P),ds("invalid",m);break;case"option":V=P;break;case"select":m._wrapperState={wasMultiple:!!P.multiple},V=ve({},P,{value:void 0}),ds("invalid",m);break;case"textarea":Ke(m,P),V=ct(m,P),ds("invalid",m);break;default:V=P}Bi(w,V),Ie=V;for(J in Ie)if(Ie.hasOwnProperty(J)){var je=Ie[J];J==="style"?yo(m,je):J==="dangerouslySetInnerHTML"?(je=je?je.__html:void 0,je!=null&&Fn(m,je)):J==="children"?typeof je=="string"?(w!=="textarea"||je!=="")&&Yr(m,je):typeof je=="number"&&Yr(m,""+je):J!=="suppressContentEditableWarning"&&J!=="suppressHydrationWarning"&&J!=="autoFocus"&&(a.hasOwnProperty(J)?je!=null&&J==="onScroll"&&ds("scroll",m):je!=null&&M(m,J,je,fe))}switch(w){case"input":Er(m),Ae(m,P,!1);break;case"textarea":Er(m),At(m);break;case"option":P.value!=null&&m.setAttribute("value",""+Xt(P.value));break;case"select":m.multiple=!!P.multiple,J=P.value,J!=null?at(m,!!P.multiple,J,!1):P.defaultValue!=null&&at(m,!!P.multiple,P.defaultValue,!0);break;default:typeof V.onClick=="function"&&(m.onclick=Vy)}switch(w){case"button":case"input":case"select":case"textarea":P=!!P.autoFocus;break e;case"img":P=!0;break e;default:P=!1}}P&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return bo(_),null;case 6:if(m&&_.stateNode!=null)yA(m,_,m.memoizedProps,P);else{if(typeof P!="string"&&_.stateNode===null)throw Error(r(166));if(w=Xf(_v.current),Xf(_l.current),pv(_)){if(P=_.stateNode,w=_.memoizedProps,P[ql]=_,(J=P.nodeValue!==w)&&(m=Ac,m!==null))switch(m.tag){case 3:Uy(P.nodeValue,w,(m.mode&1)!==0);break;case 5:m.memoizedProps.suppressHydrationWarning!==!0&&Uy(P.nodeValue,w,(m.mode&1)!==0)}J&&(_.flags|=4)}else P=(w.nodeType===9?w:w.ownerDocument).createTextNode(P),P[ql]=_,_.stateNode=P}return bo(_),null;case 13:if(hs(gs),P=_.memoizedState,m===null||m.memoizedState!==null&&m.memoizedState.dehydrated!==null){if(qi&&kc!==null&&(_.mode&1)!==0&&(_.flags&128)===0)FI(),Em(),_.flags|=98560,J=!1;else if(J=pv(_),P!==null&&P.dehydrated!==null){if(m===null){if(!J)throw Error(r(318));if(J=_.memoizedState,J=J!==null?J.dehydrated:null,!J)throw Error(r(317));J[ql]=_}else Em(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;bo(_),J=!1}else Qa!==null&&(Mm(Qa),Qa=null),J=!0;if(!J)return _.flags&65536?_:null}return(_.flags&128)!==0?(_.lanes=w,_):(P=P!==null,P!==(m!==null&&m.memoizedState!==null)&&P&&(_.child.flags|=8192,(_.mode&1)!==0&&(m===null||(gs.current&1)!==0?mi===0&&(mi=3):zd())),_.updateQueue!==null&&(_.flags|=4),bo(_),null);case 4:return Tm(),aE(m,_),m===null&&Bf(_.stateNode.containerInfo),bo(_),null;case 10:return w0(_.type._context),bo(_),null;case 17:return Ic(_.type)&&jy(),bo(_),null;case 19:if(hs(gs),J=_.memoizedState,J===null)return bo(_),null;if(P=(_.flags&128)!==0,fe=J.rendering,fe===null)if(P)kv(J,!1);else{if(mi!==0||m!==null&&(m.flags&128)!==0)for(m=_.child;m!==null;){if(fe=bm(m),fe!==null){for(_.flags|=128,kv(J,!1),P=fe.updateQueue,P!==null&&(_.updateQueue=P,_.flags|=4),_.subtreeFlags=0,P=w,w=_.child;w!==null;)J=w,m=P,J.flags&=14680066,fe=J.alternate,fe===null?(J.childLanes=0,J.lanes=m,J.child=null,J.subtreeFlags=0,J.memoizedProps=null,J.memoizedState=null,J.updateQueue=null,J.dependencies=null,J.stateNode=null):(J.childLanes=fe.childLanes,J.lanes=fe.lanes,J.child=fe.child,J.subtreeFlags=0,J.deletions=null,J.memoizedProps=fe.memoizedProps,J.memoizedState=fe.memoizedState,J.updateQueue=fe.updateQueue,J.type=fe.type,m=fe.dependencies,J.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),w=w.sibling;return rs(gs,gs.current&1|2),_.child}m=m.sibling}J.tail!==null&&Zr()>np&&(_.flags|=128,P=!0,kv(J,!1),_.lanes=4194304)}else{if(!P)if(m=bm(fe),m!==null){if(_.flags|=128,P=!0,w=m.updateQueue,w!==null&&(_.updateQueue=w,_.flags|=4),kv(J,!0),J.tail===null&&J.tailMode==="hidden"&&!fe.alternate&&!qi)return bo(_),null}else 2*Zr()-J.renderingStartTime>np&&w!==1073741824&&(_.flags|=128,P=!0,kv(J,!1),_.lanes=4194304);J.isBackwards?(fe.sibling=_.child,_.child=fe):(w=J.last,w!==null?w.sibling=fe:_.child=fe,J.last=fe)}return J.tail!==null?(_=J.tail,J.rendering=_,J.tail=_.sibling,J.renderingStartTime=Zr(),_.sibling=null,w=gs.current,rs(gs,P?w&1|2:w&1),_):(bo(_),null);case 22:case 23:return _E(),P=_.memoizedState!==null,m!==null&&m.memoizedState!==null!==P&&(_.flags|=8192),P&&(_.mode&1)!==0?(Ho&1073741824)!==0&&(bo(_),_.subtreeFlags&6&&(_.flags|=8192)):bo(_),null;case 24:return null;case 25:return null}throw Error(r(156,_.tag))}function oL(m,_){switch(fv(_),_.tag){case 1:return Ic(_.type)&&jy(),m=_.flags,m&65536?(_.flags=m&-65537|128,_):null;case 3:return Tm(),hs(Rc),hs(ka),P0(),m=_.flags,(m&65536)!==0&&(m&128)===0?(_.flags=m&-65537|128,_):null;case 5:return O0(_),null;case 13:if(hs(gs),m=_.memoizedState,m!==null&&m.dehydrated!==null){if(_.alternate===null)throw Error(r(340));Em()}return m=_.flags,m&65536?(_.flags=m&-65537|128,_):null;case 19:return hs(gs),null;case 4:return Tm(),null;case 10:return w0(_.type._context),null;case 22:case 23:return _E(),null;case 24:return null;default:return null}}var cE=!1,ua=!1,aL=typeof WeakSet=="function"?WeakSet:Set,dn=null;function Ah(m,_){var w=m.ref;if(w!==null)if(typeof w=="function")try{w(null)}catch(P){bs(m,_,P)}else w.current=null}function X0(m,_,w){try{w()}catch(P){bs(m,_,P)}}var uE=!1;function cL(m,_){if(Fy=Ce,m=SI(),iv(m)){if("selectionStart"in m)var w={start:m.selectionStart,end:m.selectionEnd};else e:{w=(w=m.ownerDocument)&&w.defaultView||window;var P=w.getSelection&&w.getSelection();if(P&&P.rangeCount!==0){w=P.anchorNode;var V=P.anchorOffset,J=P.focusNode;P=P.focusOffset;try{w.nodeType,J.nodeType}catch{w=null;break e}var fe=0,Ie=-1,je=-1,ut=0,Nt=0,xt=m,Ot=null;t:for(;;){for(var on;xt!==w||V!==0&&xt.nodeType!==3||(Ie=fe+V),xt!==J||P!==0&&xt.nodeType!==3||(je=fe+P),xt.nodeType===3&&(fe+=xt.nodeValue.length),(on=xt.firstChild)!==null;)Ot=xt,xt=on;for(;;){if(xt===m)break t;if(Ot===w&&++ut===V&&(Ie=fe),Ot===J&&++Nt===P&&(je=fe),(on=xt.nextSibling)!==null)break;xt=Ot,Ot=xt.parentNode}xt=on}w=Ie===-1||je===-1?null:{start:Ie,end:je}}else w=null}w=w||{start:0,end:0}}else w=null;for(uv={focusedElem:m,selectionRange:w},Ce=!1,dn=_;dn!==null;)if(_=dn,m=_.child,(_.subtreeFlags&1028)!==0&&m!==null)m.return=_,dn=m;else for(;dn!==null;){_=dn;try{var ln=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(ln!==null){var mn=ln.memoizedProps,Ks=ln.memoizedState,Ze=_.stateNode,We=Ze.getSnapshotBeforeUpdate(_.elementType===_.type?mn:vl(_.type,mn),Ks);Ze.__reactInternalSnapshotBeforeUpdate=We}break;case 3:var ot=_.stateNode.containerInfo;ot.nodeType===1?ot.textContent="":ot.nodeType===9&&ot.documentElement&&ot.removeChild(ot.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(Vt){bs(_,_.return,Vt)}if(m=_.sibling,m!==null){m.return=_.return,dn=m;break}dn=_.return}return ln=uE,uE=!1,ln}function km(m,_,w){var P=_.updateQueue;if(P=P!==null?P.lastEffect:null,P!==null){var V=P=P.next;do{if((V.tag&m)===m){var J=V.destroy;V.destroy=void 0,J!==void 0&&X0(_,w,J)}V=V.next}while(V!==P)}}function lE(m,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var w=_=_.next;do{if((w.tag&m)===m){var P=w.create;w.destroy=P()}w=w.next}while(w!==_)}}function J0(m){var _=m.ref;if(_!==null){var w=m.stateNode;switch(m.tag){case 5:m=w;break;default:m=w}typeof _=="function"?_(m):_.current=m}}function Q0(m){var _=m.alternate;_!==null&&(m.alternate=null,Q0(_)),m.child=null,m.deletions=null,m.sibling=null,m.tag===5&&(_=m.stateNode,_!==null&&(delete _[ql],delete _[Eh],delete _[dv],delete _[qD],delete _[$D])),m.stateNode=null,m.return=null,m.dependencies=null,m.memoizedProps=null,m.memoizedState=null,m.pendingProps=null,m.stateNode=null,m.updateQueue=null}function EA(m){return m.tag===5||m.tag===3||m.tag===4}function SA(m){e:for(;;){for(;m.sibling===null;){if(m.return===null||EA(m.return))return null;m=m.return}for(m.sibling.return=m.return,m=m.sibling;m.tag!==5&&m.tag!==6&&m.tag!==18;){if(m.flags&2||m.child===null||m.tag===4)continue e;m.child.return=m,m=m.child}if(!(m.flags&2))return m.stateNode}}function dE(m,_,w){var P=m.tag;if(P===5||P===6)m=m.stateNode,_?w.nodeType===8?w.parentNode.insertBefore(m,_):w.insertBefore(m,_):(w.nodeType===8?(_=w.parentNode,_.insertBefore(m,w)):(_=w,_.appendChild(m)),w=w._reactRootContainer,w!=null||_.onclick!==null||(_.onclick=Vy));else if(P!==4&&(m=m.child,m!==null))for(dE(m,_,w),m=m.sibling;m!==null;)dE(m,_,w),m=m.sibling}function Z0(m,_,w){var P=m.tag;if(P===5||P===6)m=m.stateNode,_?w.insertBefore(m,_):w.appendChild(m);else if(P!==4&&(m=m.child,m!==null))for(Z0(m,_,w),m=m.sibling;m!==null;)Z0(m,_,w),m=m.sibling}var Go=null,su=!1;function kh(m,_,w){for(w=w.child;w!==null;)TA(m,_,w),w=w.sibling}function TA(m,_,w){if(es&&typeof es.onCommitFiberUnmount=="function")try{es.onCommitFiberUnmount(xo,w)}catch{}switch(w.tag){case 5:ua||Ah(w,_);case 6:var P=Go,V=su;Go=null,kh(m,_,w),Go=P,su=V,Go!==null&&(su?(m=Go,w=w.stateNode,m.nodeType===8?m.parentNode.removeChild(w):m.removeChild(w)):Go.removeChild(w.stateNode));break;case 18:Go!==null&&(su?(m=Go,w=w.stateNode,m.nodeType===8?v0(m.parentNode,w):m.nodeType===1&&v0(m,w),sa(m)):v0(Go,w.stateNode));break;case 4:P=Go,V=su,Go=w.stateNode.containerInfo,su=!0,kh(m,_,w),Go=P,su=V;break;case 0:case 11:case 14:case 15:if(!ua&&(P=w.updateQueue,P!==null&&(P=P.lastEffect,P!==null))){V=P=P.next;do{var J=V,fe=J.destroy;J=J.tag,fe!==void 0&&((J&2)!==0||(J&4)!==0)&&X0(w,_,fe),V=V.next}while(V!==P)}kh(m,_,w);break;case 1:if(!ua&&(Ah(w,_),P=w.stateNode,typeof P.componentWillUnmount=="function"))try{P.props=w.memoizedProps,P.state=w.memoizedState,P.componentWillUnmount()}catch(Ie){bs(w,_,Ie)}kh(m,_,w);break;case 21:kh(m,_,w);break;case 22:w.mode&1?(ua=(P=ua)||w.memoizedState!==null,kh(m,_,w),ua=P):kh(m,_,w);break;default:kh(m,_,w)}}function Om(m){var _=m.updateQueue;if(_!==null){m.updateQueue=null;var w=m.stateNode;w===null&&(w=m.stateNode=new aL),_.forEach(function(P){var V=ab.bind(null,m,P);w.has(P)||(w.add(P),P.then(V,V))})}}function Uu(m,_){var w=_.deletions;if(w!==null)for(var P=0;P<w.length;P++){var V=w[P];try{var J=m,fe=_,Ie=fe;e:for(;Ie!==null;){switch(Ie.tag){case 5:Go=Ie.stateNode,su=!1;break e;case 3:Go=Ie.stateNode.containerInfo,su=!0;break e;case 4:Go=Ie.stateNode.containerInfo,su=!0;break e}Ie=Ie.return}if(Go===null)throw Error(r(160));TA(J,fe,V),Go=null,su=!1;var je=V.alternate;je!==null&&(je.return=null),V.return=null}catch(ut){bs(V,_,ut)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)Pm(_,m),_=_.sibling}function Pm(m,_){var w=m.alternate,P=m.flags;switch(m.tag){case 0:case 11:case 14:case 15:if(Uu(_,m),Za(m),P&4){try{km(3,m,m.return),lE(3,m)}catch(mn){bs(m,m.return,mn)}try{km(5,m,m.return)}catch(mn){bs(m,m.return,mn)}}break;case 1:Uu(_,m),Za(m),P&512&&w!==null&&Ah(w,w.return);break;case 5:if(Uu(_,m),Za(m),P&512&&w!==null&&Ah(w,w.return),m.flags&32){var V=m.stateNode;try{Yr(V,"")}catch(mn){bs(m,m.return,mn)}}if(P&4&&(V=m.stateNode,V!=null)){var J=m.memoizedProps,fe=w!==null?w.memoizedProps:J,Ie=m.type,je=m.updateQueue;if(m.updateQueue=null,je!==null)try{Ie==="input"&&J.type==="radio"&&J.name!=null&&wn(V,J),za(Ie,fe);var ut=za(Ie,J);for(fe=0;fe<je.length;fe+=2){var Nt=je[fe],xt=je[fe+1];Nt==="style"?yo(V,xt):Nt==="dangerouslySetInnerHTML"?Fn(V,xt):Nt==="children"?Yr(V,xt):M(V,Nt,xt,ut)}switch(Ie){case"input":Dn(V,J);break;case"textarea":nt(V,J);break;case"select":var Ot=V._wrapperState.wasMultiple;V._wrapperState.wasMultiple=!!J.multiple;var on=J.value;on!=null?at(V,!!J.multiple,on,!1):Ot!==!!J.multiple&&(J.defaultValue!=null?at(V,!!J.multiple,J.defaultValue,!0):at(V,!!J.multiple,J.multiple?[]:"",!1))}V[Eh]=J}catch(mn){bs(m,m.return,mn)}}break;case 6:if(Uu(_,m),Za(m),P&4){if(m.stateNode===null)throw Error(r(162));V=m.stateNode,J=m.memoizedProps;try{V.nodeValue=J}catch(mn){bs(m,m.return,mn)}}break;case 3:if(Uu(_,m),Za(m),P&4&&w!==null&&w.memoizedState.isDehydrated)try{sa(_.containerInfo)}catch(mn){bs(m,m.return,mn)}break;case 4:Uu(_,m),Za(m);break;case 13:Uu(_,m),Za(m),V=m.child,V.flags&8192&&(J=V.memoizedState!==null,V.stateNode.isHidden=J,!J||V.alternate!==null&&V.alternate.memoizedState!==null||(nb=Zr())),P&4&&Om(m);break;case 22:if(Nt=w!==null&&w.memoizedState!==null,m.mode&1?(ua=(ut=ua)||Nt,Uu(_,m),ua=ut):Uu(_,m),Za(m),P&8192){if(ut=m.memoizedState!==null,(m.stateNode.isHidden=ut)&&!Nt&&(m.mode&1)!==0)for(dn=m,Nt=m.child;Nt!==null;){for(xt=dn=Nt;dn!==null;){switch(Ot=dn,on=Ot.child,Ot.tag){case 0:case 11:case 14:case 15:km(4,Ot,Ot.return);break;case 1:Ah(Ot,Ot.return);var ln=Ot.stateNode;if(typeof ln.componentWillUnmount=="function"){P=Ot,w=Ot.return;try{_=P,ln.props=_.memoizedProps,ln.state=_.memoizedState,ln.componentWillUnmount()}catch(mn){bs(P,w,mn)}}break;case 5:Ah(Ot,Ot.return);break;case 22:if(Ot.memoizedState!==null){wA(xt);continue}}on!==null?(on.return=Ot,dn=on):wA(xt)}Nt=Nt.sibling}e:for(Nt=null,xt=m;;){if(xt.tag===5){if(Nt===null){Nt=xt;try{V=xt.stateNode,ut?(J=V.style,typeof J.setProperty=="function"?J.setProperty("display","none","important"):J.display="none"):(Ie=xt.stateNode,je=xt.memoizedProps.style,fe=je!=null&&je.hasOwnProperty("display")?je.display:null,Ie.style.display=Cn("display",fe))}catch(mn){bs(m,m.return,mn)}}}else if(xt.tag===6){if(Nt===null)try{xt.stateNode.nodeValue=ut?"":xt.memoizedProps}catch(mn){bs(m,m.return,mn)}}else if((xt.tag!==22&&xt.tag!==23||xt.memoizedState===null||xt===m)&&xt.child!==null){xt.child.return=xt,xt=xt.child;continue}if(xt===m)break e;for(;xt.sibling===null;){if(xt.return===null||xt.return===m)break e;Nt===xt&&(Nt=null),xt=xt.return}Nt===xt&&(Nt=null),xt.sibling.return=xt.return,xt=xt.sibling}}break;case 19:Uu(_,m),Za(m),P&4&&Om(m);break;case 21:break;default:Uu(_,m),Za(m)}}function Za(m){var _=m.flags;if(_&2){try{e:{for(var w=m.return;w!==null;){if(EA(w)){var P=w;break e}w=w.return}throw Error(r(160))}switch(P.tag){case 5:var V=P.stateNode;P.flags&32&&(Yr(V,""),P.flags&=-33);var J=SA(m);Z0(m,J,V);break;case 3:case 4:var fe=P.stateNode.containerInfo,Ie=SA(m);dE(m,Ie,fe);break;default:throw Error(r(161))}}catch(je){bs(m,m.return,je)}m.flags&=-3}_&4096&&(m.flags&=-4097)}function bA(m,_,w){dn=m,hE(m)}function hE(m,_,w){for(var P=(m.mode&1)!==0;dn!==null;){var V=dn,J=V.child;if(V.tag===22&&P){var fe=V.memoizedState!==null||cE;if(!fe){var Ie=V.alternate,je=Ie!==null&&Ie.memoizedState!==null||ua;Ie=cE;var ut=ua;if(cE=fe,(ua=je)&&!ut)for(dn=V;dn!==null;)fe=dn,je=fe.child,fe.tag===22&&fe.memoizedState!==null?CA(V):je!==null?(je.return=fe,dn=je):CA(V);for(;J!==null;)dn=J,hE(J),J=J.sibling;dn=V,cE=Ie,ua=ut}Ov(m)}else(V.subtreeFlags&8772)!==0&&J!==null?(J.return=V,dn=J):Ov(m)}}function Ov(m){for(;dn!==null;){var _=dn;if((_.flags&8772)!==0){var w=_.alternate;try{if((_.flags&8772)!==0)switch(_.tag){case 0:case 11:case 15:ua||lE(5,_);break;case 1:var P=_.stateNode;if(_.flags&4&&!ua)if(w===null)P.componentDidMount();else{var V=_.elementType===_.type?w.memoizedProps:vl(_.type,w.memoizedProps);P.componentDidUpdate(V,w.memoizedState,P.__reactInternalSnapshotBeforeUpdate)}var J=_.updateQueue;J!==null&&I0(_,J,P);break;case 3:var fe=_.updateQueue;if(fe!==null){if(w=null,_.child!==null)switch(_.child.tag){case 5:w=_.child.stateNode;break;case 1:w=_.child.stateNode}I0(_,fe,w)}break;case 5:var Ie=_.stateNode;if(w===null&&_.flags&4){w=Ie;var je=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":je.autoFocus&&w.focus();break;case"img":je.src&&(w.src=je.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var ut=_.alternate;if(ut!==null){var Nt=ut.memoizedState;if(Nt!==null){var xt=Nt.dehydrated;xt!==null&&sa(xt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}ua||_.flags&512&&J0(_)}catch(Ot){bs(_,_.return,Ot)}}if(_===m){dn=null;break}if(w=_.sibling,w!==null){w.return=_.return,dn=w;break}dn=_.return}}function wA(m){for(;dn!==null;){var _=dn;if(_===m){dn=null;break}var w=_.sibling;if(w!==null){w.return=_.return,dn=w;break}dn=_.return}}function CA(m){for(;dn!==null;){var _=dn;try{switch(_.tag){case 0:case 11:case 15:var w=_.return;try{lE(4,_)}catch(je){bs(_,w,je)}break;case 1:var P=_.stateNode;if(typeof P.componentDidMount=="function"){var V=_.return;try{P.componentDidMount()}catch(je){bs(_,V,je)}}var J=_.return;try{J0(_)}catch(je){bs(_,J,je)}break;case 5:var fe=_.return;try{J0(_)}catch(je){bs(_,fe,je)}}}catch(je){bs(_,_.return,je)}if(_===m){dn=null;break}var Ie=_.sibling;if(Ie!==null){Ie.return=_.return,dn=Ie;break}dn=_.return}}var uL=Math.ceil,Pv=F.ReactCurrentDispatcher,eb=F.ReactCurrentOwner,Vu=F.ReactCurrentBatchConfig,ti=0,oo=null,Ts=null,la=0,Ho=0,ep=Pu(0),mi=0,Nv=null,tp=0,Dv=0,tb=0,Nm=null,ec=null,nb=0,np=1/0,jd=null,fE=!1,rb=null,Jl=null,Dm=!1,Oh=null,Lm=0,Lv=0,pE=null,mE=-1,xm=0;function wo(){return(ti&6)!==0?Zr():mE!==-1?mE:mE=Zr()}function Bd(m){return(m.mode&1)===0?1:(ti&2)!==0&&la!==0?la&-la:XD.transition!==null?(xm===0&&(xm=fl()),xm):(m=pr,m!==0||(m=window.event,m=m===void 0?16:ei(m.type)),m)}function ou(m,_,w,P){if(50<Lv)throw Lv=0,pE=null,Error(r(185));Ia(m,w,P),((ti&2)===0||m!==oo)&&(m===oo&&((ti&2)===0&&(Dv|=w),mi===4&&au(m,la)),Oa(m,P),w===1&&ti===0&&(_.mode&1)===0&&(np=Zr()+500,zy&&Th()))}function Oa(m,_){var w=m.callbackNode;Ka(m,_);var P=Jc(m,m===oo?la:0);if(P===0)w!==null&&ul(w),m.callbackNode=null,m.callbackPriority=0;else if(_=P&-P,m.callbackPriority!==_){if(w!=null&&ul(w),_===1)m.tag===0?YD(vE.bind(null,m)):xI(vE.bind(null,m)),HD(function(){(ti&6)===0&&Th()}),w=null;else{switch(qa(P)){case 1:w=Ra;break;case 4:w=Ec;break;case 16:w=na;break;case 536870912:w=dl;break;default:w=na}w=Fv(w,ib.bind(null,m))}m.callbackPriority=_,m.callbackNode=w}}function ib(m,_){if(mE=-1,xm=0,(ti&6)!==0)throw Error(r(327));var w=m.callbackNode;if(Nh()&&m.callbackNode!==w)return null;var P=Jc(m,m===oo?la:0);if(P===0)return null;if((P&30)!==0||(P&m.expiredLanes)!==0||_)_=Mv(m,P);else{_=P;var V=ti;ti|=2;var J=AA();(oo!==m||la!==_)&&(jd=null,np=Zr()+500,Ph(m,_));do try{sb();break}catch(Ie){IA(m,Ie)}while(!0);b0(),Pv.current=J,ti=V,Ts!==null?_=0:(oo=null,la=0,_=mi)}if(_!==0){if(_===2&&(V=ra(m),V!==0&&(P=V,_=gE(m,V))),_===1)throw w=Nv,Ph(m,0),au(m,P),Oa(m,Zr()),w;if(_===6)au(m,P);else{if(V=m.current.alternate,(P&30)===0&&!RA(V)&&(_=Mv(m,P),_===2&&(J=ra(m),J!==0&&(P=J,_=gE(m,J))),_===1))throw w=Nv,Ph(m,0),au(m,P),Oa(m,Zr()),w;switch(m.finishedWork=V,m.finishedLanes=P,_){case 0:case 1:throw Error(r(345));case 2:rp(m,ec,jd);break;case 3:if(au(m,P),(P&130023424)===P&&(_=nb+500-Zr(),10<_)){if(Jc(m,0)!==0)break;if(V=m.suspendedLanes,(V&P)!==P){wo(),m.pingedLanes|=m.suspendedLanes&V;break}m.timeoutHandle=lv(rp.bind(null,m,ec,jd),_);break}rp(m,ec,jd);break;case 4:if(au(m,P),(P&4194240)===P)break;for(_=m.eventTimes,V=-1;0<P;){var fe=31-Ls(P);J=1<<fe,fe=_[fe],fe>V&&(V=fe),P&=~J}if(P=V,P=Zr()-P,P=(120>P?120:480>P?480:1080>P?1080:1920>P?1920:3e3>P?3e3:4320>P?4320:1960*uL(P/1960))-P,10<P){m.timeoutHandle=lv(rp.bind(null,m,ec,jd),P);break}rp(m,ec,jd);break;case 5:rp(m,ec,jd);break;default:throw Error(r(329))}}}return Oa(m,Zr()),m.callbackNode===w?ib.bind(null,m):null}function gE(m,_){var w=Nm;return m.current.memoizedState.isDehydrated&&(Ph(m,_).flags|=256),m=Mv(m,_),m!==2&&(_=ec,ec=w,_!==null&&Mm(_)),m}function Mm(m){ec===null?ec=m:ec.push.apply(ec,m)}function RA(m){for(var _=m;;){if(_.flags&16384){var w=_.updateQueue;if(w!==null&&(w=w.stores,w!==null))for(var P=0;P<w.length;P++){var V=w[P],J=V.getSnapshot;V=V.value;try{if(!gl(J(),V))return!1}catch{return!1}}}if(w=_.child,_.subtreeFlags&16384&&w!==null)w.return=_,_=w;else{if(_===m)break;for(;_.sibling===null;){if(_.return===null||_.return===m)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function au(m,_){for(_&=~tb,_&=~Dv,m.suspendedLanes|=_,m.pingedLanes&=~_,m=m.expirationTimes;0<_;){var w=31-Ls(_),P=1<<w;m[w]=-1,_&=~P}}function vE(m){if((ti&6)!==0)throw Error(r(327));Nh();var _=Jc(m,0);if((_&1)===0)return Oa(m,Zr()),null;var w=Mv(m,_);if(m.tag!==0&&w===2){var P=ra(m);P!==0&&(_=P,w=gE(m,P))}if(w===1)throw w=Nv,Ph(m,0),au(m,_),Oa(m,Zr()),w;if(w===6)throw Error(r(345));return m.finishedWork=m.current.alternate,m.finishedLanes=_,rp(m,ec,jd),Oa(m,Zr()),null}function xv(m,_){var w=ti;ti|=1;try{return m(_)}finally{ti=w,ti===0&&(np=Zr()+500,zy&&Th())}}function Wd(m){Oh!==null&&Oh.tag===0&&(ti&6)===0&&Nh();var _=ti;ti|=1;var w=Vu.transition,P=pr;try{if(Vu.transition=null,pr=1,m)return m()}finally{pr=P,Vu.transition=w,ti=_,(ti&6)===0&&Th()}}function _E(){Ho=ep.current,hs(ep)}function Ph(m,_){m.finishedWork=null,m.finishedLanes=0;var w=m.timeoutHandle;if(w!==-1&&(m.timeoutHandle=-1,GD(w)),Ts!==null)for(w=Ts.return;w!==null;){var P=w;switch(fv(P),P.tag){case 1:P=P.type.childContextTypes,P!=null&&jy();break;case 3:Tm(),hs(Rc),hs(ka),P0();break;case 5:O0(P);break;case 4:Tm();break;case 13:hs(gs);break;case 19:hs(gs);break;case 10:w0(P.type._context);break;case 22:case 23:_E()}w=w.return}if(oo=m,Ts=m=Dh(m.current,null),la=Ho=_,mi=0,Nv=null,tb=Dv=tp=0,ec=Nm=null,$f!==null){for(_=0;_<$f.length;_++)if(w=$f[_],P=w.interleaved,P!==null){w.interleaved=null;var V=P.next,J=w.pending;if(J!==null){var fe=J.next;J.next=V,P.next=fe}w.pending=P}$f=null}return m}function IA(m,_){do{var w=Ts;try{if(b0(),tE.current=sE,Vd){for(var P=Ss.memoizedState;P!==null;){var V=P.queue;V!==null&&(V.pending=null),P=P.next}Vd=!1}if(Jf=0,zo=xs=Ss=null,Qf=!1,Rh=0,eb.current=null,w===null||w.return===null){mi=1,Nv=_,Ts=null;break}e:{var J=m,fe=w.return,Ie=w,je=_;if(_=la,Ie.flags|=32768,je!==null&&typeof je=="object"&&typeof je.then=="function"){var ut=je,Nt=Ie,xt=Nt.tag;if((Nt.mode&1)===0&&(xt===0||xt===11||xt===15)){var Ot=Nt.alternate;Ot?(Nt.updateQueue=Ot.updateQueue,Nt.memoizedState=Ot.memoizedState,Nt.lanes=Ot.lanes):(Nt.updateQueue=null,Nt.memoizedState=null)}var on=cA(fe);if(on!==null){on.flags&=-257,uA(on,fe,Ie,J,_),on.mode&1&&aA(J,ut,_),_=on,je=ut;var ln=_.updateQueue;if(ln===null){var mn=new Set;mn.add(je),_.updateQueue=mn}else ln.add(je);break e}else{if((_&1)===0){aA(J,ut,_),zd();break e}je=Error(r(426))}}else if(qi&&Ie.mode&1){var Ks=cA(fe);if(Ks!==null){(Ks.flags&65536)===0&&(Ks.flags|=256),uA(Ks,fe,Ie,J,_),S0(Rm(je,Ie));break e}}J=je=Rm(je,Ie),mi!==4&&(mi=2),Nm===null?Nm=[J]:Nm.push(J),J=fe;do{switch(J.tag){case 3:J.flags|=65536,_&=-_,J.lanes|=_;var Ze=Fd(J,je,_);Jy(J,Ze);break e;case 1:Ie=je;var We=J.type,ot=J.stateNode;if((J.flags&128)===0&&(typeof We.getDerivedStateFromError=="function"||ot!==null&&typeof ot.componentDidCatch=="function"&&(Jl===null||!Jl.has(ot)))){J.flags|=65536,_&=-_,J.lanes|=_;var Vt=oA(J,Ie,_);Jy(J,Vt);break e}}J=J.return}while(J!==null)}OA(w)}catch(_n){_=_n,Ts===w&&w!==null&&(Ts=w=w.return);continue}break}while(!0)}function AA(){var m=Pv.current;return Pv.current=sE,m===null?sE:m}function zd(){(mi===0||mi===3||mi===2)&&(mi=4),oo===null||(tp&268435455)===0&&(Dv&268435455)===0||au(oo,la)}function Mv(m,_){var w=ti;ti|=2;var P=AA();(oo!==m||la!==_)&&(jd=null,Ph(m,_));do try{lL();break}catch(V){IA(m,V)}while(!0);if(b0(),ti=w,Pv.current=P,Ts!==null)throw Error(r(261));return oo=null,la=0,mi}function lL(){for(;Ts!==null;)kA(Ts)}function sb(){for(;Ts!==null&&!Lo();)kA(Ts)}function kA(m){var _=Vv(m.alternate,m,Ho);m.memoizedProps=m.pendingProps,_===null?OA(m):Ts=_,eb.current=null}function OA(m){var _=m;do{var w=_.alternate;if(m=_.return,(_.flags&32768)===0){if(w=sL(w,_,Ho),w!==null){Ts=w;return}}else{if(w=oL(w,_),w!==null){w.flags&=32767,Ts=w;return}if(m!==null)m.flags|=32768,m.subtreeFlags=0,m.deletions=null;else{mi=6,Ts=null;return}}if(_=_.sibling,_!==null){Ts=_;return}Ts=_=m}while(_!==null);mi===0&&(mi=5)}function rp(m,_,w){var P=pr,V=Vu.transition;try{Vu.transition=null,pr=1,dL(m,_,w,P)}finally{Vu.transition=V,pr=P}return null}function dL(m,_,w,P){do Nh();while(Oh!==null);if((ti&6)!==0)throw Error(r(327));w=m.finishedWork;var V=m.finishedLanes;if(w===null)return null;if(m.finishedWork=null,m.finishedLanes=0,w===m.current)throw Error(r(177));m.callbackNode=null,m.callbackPriority=0;var J=w.lanes|w.childLanes;if(kr(m,J),m===oo&&(Ts=oo=null,la=0),(w.subtreeFlags&2064)===0&&(w.flags&2064)===0||Dm||(Dm=!0,Fv(na,function(){return Nh(),null})),J=(w.flags&15990)!==0,(w.subtreeFlags&15990)!==0||J){J=Vu.transition,Vu.transition=null;var fe=pr;pr=1;var Ie=ti;ti|=4,eb.current=null,cL(m,w),Pm(w,m),l0(uv),Ce=!!Fy,uv=Fy=null,m.current=w,bA(w),ll(),ti=Ie,pr=fe,Vu.transition=J}else m.current=w;if(Dm&&(Dm=!1,Oh=m,Lm=V),J=m.pendingLanes,J===0&&(Jl=null),hl(w.stateNode),Oa(m,Zr()),_!==null)for(P=m.onRecoverableError,w=0;w<_.length;w++)V=_[w],P(V.value,{componentStack:V.stack,digest:V.digest});if(fE)throw fE=!1,m=rb,rb=null,m;return(Lm&1)!==0&&m.tag!==0&&Nh(),J=m.pendingLanes,(J&1)!==0?m===pE?Lv++:(Lv=0,pE=m):Lv=0,Th(),null}function Nh(){if(Oh!==null){var m=qa(Lm),_=Vu.transition,w=pr;try{if(Vu.transition=null,pr=16>m?16:m,Oh===null)var P=!1;else{if(m=Oh,Oh=null,Lm=0,(ti&6)!==0)throw Error(r(331));var V=ti;for(ti|=4,dn=m.current;dn!==null;){var J=dn,fe=J.child;if((dn.flags&16)!==0){var Ie=J.deletions;if(Ie!==null){for(var je=0;je<Ie.length;je++){var ut=Ie[je];for(dn=ut;dn!==null;){var Nt=dn;switch(Nt.tag){case 0:case 11:case 15:km(8,Nt,J)}var xt=Nt.child;if(xt!==null)xt.return=Nt,dn=xt;else for(;dn!==null;){Nt=dn;var Ot=Nt.sibling,on=Nt.return;if(Q0(Nt),Nt===ut){dn=null;break}if(Ot!==null){Ot.return=on,dn=Ot;break}dn=on}}}var ln=J.alternate;if(ln!==null){var mn=ln.child;if(mn!==null){ln.child=null;do{var Ks=mn.sibling;mn.sibling=null,mn=Ks}while(mn!==null)}}dn=J}}if((J.subtreeFlags&2064)!==0&&fe!==null)fe.return=J,dn=fe;else e:for(;dn!==null;){if(J=dn,(J.flags&2048)!==0)switch(J.tag){case 0:case 11:case 15:km(9,J,J.return)}var Ze=J.sibling;if(Ze!==null){Ze.return=J.return,dn=Ze;break e}dn=J.return}}var We=m.current;for(dn=We;dn!==null;){fe=dn;var ot=fe.child;if((fe.subtreeFlags&2064)!==0&&ot!==null)ot.return=fe,dn=ot;else e:for(fe=We;dn!==null;){if(Ie=dn,(Ie.flags&2048)!==0)try{switch(Ie.tag){case 0:case 11:case 15:lE(9,Ie)}}catch(_n){bs(Ie,Ie.return,_n)}if(Ie===fe){dn=null;break e}var Vt=Ie.sibling;if(Vt!==null){Vt.return=Ie.return,dn=Vt;break e}dn=Ie.return}}if(ti=V,Th(),es&&typeof es.onPostCommitFiberRoot=="function")try{es.onPostCommitFiberRoot(xo,m)}catch{}P=!0}return P}finally{pr=w,Vu.transition=_}}return!1}function ob(m,_,w){_=Rm(w,_),_=Fd(m,_,1),m=wh(m,_,1),_=wo(),m!==null&&(Ia(m,1,_),Oa(m,_))}function bs(m,_,w){if(m.tag===3)ob(m,m,w);else for(;_!==null;){if(_.tag===3){ob(_,m,w);break}else if(_.tag===1){var P=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof P.componentDidCatch=="function"&&(Jl===null||!Jl.has(P))){m=Rm(w,m),m=oA(_,m,1),_=wh(_,m,1),m=wo(),_!==null&&(Ia(_,1,m),Oa(_,m));break}}_=_.return}}function PA(m,_,w){var P=m.pingCache;P!==null&&P.delete(_),_=wo(),m.pingedLanes|=m.suspendedLanes&w,oo===m&&(la&w)===w&&(mi===4||mi===3&&(la&130023424)===la&&500>Zr()-nb?Ph(m,0):tb|=w),Oa(m,_)}function Uv(m,_){_===0&&((m.mode&1)===0?_=1:(_=fr,fr<<=1,(fr&130023424)===0&&(fr=4194304)));var w=wo();m=xu(m,_),m!==null&&(Ia(m,_,w),Oa(m,w))}function NA(m){var _=m.memoizedState,w=0;_!==null&&(w=_.retryLane),Uv(m,w)}function ab(m,_){var w=0;switch(m.tag){case 13:var P=m.stateNode,V=m.memoizedState;V!==null&&(w=V.retryLane);break;case 19:P=m.stateNode;break;default:throw Error(r(314))}P!==null&&P.delete(_),Uv(m,w)}var Vv;Vv=function(m,_,w){if(m!==null)if(m.memoizedProps!==_.pendingProps||Rc.current)Oc=!0;else{if((m.lanes&w)===0&&(_.flags&128)===0)return Oc=!1,iL(m,_,w);Oc=(m.flags&131072)!==0}else Oc=!1,qi&&(_.flags&1048576)!==0&&Hy(_,Gy,_.index);switch(_.lanes=0,_.tag){case 2:var P=_.type;Av(m,_),m=_.pendingProps;var V=Kf(_,ka.current);Sm(_,w),V=nE(null,_,P,m,V,w);var J=L0();return _.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,Ic(P)?(J=!0,Wy(_)):J=!1,_.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,R0(_),V.updater=eE,_.stateNode=V,V._reactInternals=_,A0(_,P,m,w),_=oE(null,_,P,!0,J,w)):(_.tag=0,qi&&J&&Ky(_),ca(null,_,V,w),_=_.child),_;case 16:P=_.elementType;e:{switch(Av(m,_),m=_.pendingProps,V=P._init,P=V(P._payload),_.type=P,V=_.tag=LA(P),m=vl(P,m),V){case 0:_=H0(null,_,P,m,w);break e;case 1:_=K0(null,_,P,m,w);break e;case 11:_=lA(null,_,P,m,w);break e;case 14:_=dA(null,_,P,vl(P.type,m),w);break e}throw Error(r(306,P,""))}return _;case 0:return P=_.type,V=_.pendingProps,V=_.elementType===P?V:vl(P,V),H0(m,_,P,V,w);case 1:return P=_.type,V=_.pendingProps,V=_.elementType===P?V:vl(P,V),K0(m,_,P,V,w);case 3:e:{if(mA(_),m===null)throw Error(r(387));P=_.pendingProps,J=_.memoizedState,V=J.element,BI(m,_),Qy(_,P,null,w);var fe=_.memoizedState;if(P=fe.element,J.isDehydrated)if(J={element:P,isDehydrated:!1,cache:fe.cache,pendingSuspenseBoundaries:fe.pendingSuspenseBoundaries,transitions:fe.transitions},_.updateQueue.baseState=J,_.memoizedState=J,_.flags&256){V=Rm(Error(r(423)),_),_=gA(m,_,P,w,V);break e}else if(P!==V){V=Rm(Error(r(424)),_),_=gA(m,_,P,w,V);break e}else for(kc=yh(_.stateNode.containerInfo.firstChild),Ac=_,qi=!0,Qa=null,w=$I(_,null,P,w),_.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling;else{if(Em(),P===V){_=Xl(m,_,w);break e}ca(m,_,P,w)}_=_.child}return _;case 5:return yv(_),m===null&&E0(_),P=_.type,V=_.pendingProps,J=m!==null?m.memoizedProps:null,fe=V.children,g0(P,V)?fe=null:J!==null&&g0(P,J)&&(_.flags|=32),pA(m,_),ca(m,_,fe,w),_.child;case 6:return m===null&&E0(_),null;case 13:return q0(m,_,w);case 4:return k0(_,_.stateNode.containerInfo),P=_.pendingProps,m===null?_.child=Yf(_,null,P,w):ca(m,_,P,w),_.child;case 11:return P=_.type,V=_.pendingProps,V=_.elementType===P?V:vl(P,V),lA(m,_,P,V,w);case 7:return ca(m,_,_.pendingProps,w),_.child;case 8:return ca(m,_,_.pendingProps.children,w),_.child;case 12:return ca(m,_,_.pendingProps.children,w),_.child;case 10:e:{if(P=_.type._context,V=_.pendingProps,J=_.memoizedProps,fe=V.value,rs($y,P._currentValue),P._currentValue=fe,J!==null)if(gl(J.value,fe)){if(J.children===V.children&&!Rc.current){_=Xl(m,_,w);break e}}else for(J=_.child,J!==null&&(J.return=_);J!==null;){var Ie=J.dependencies;if(Ie!==null){fe=J.child;for(var je=Ie.firstContext;je!==null;){if(je.context===P){if(J.tag===1){je=Md(-1,w&-w),je.tag=2;var ut=J.updateQueue;if(ut!==null){ut=ut.shared;var Nt=ut.pending;Nt===null?je.next=je:(je.next=Nt.next,Nt.next=je),ut.pending=je}}J.lanes|=w,je=J.alternate,je!==null&&(je.lanes|=w),Yy(J.return,w,_),Ie.lanes|=w;break}je=je.next}}else if(J.tag===10)fe=J.type===_.type?null:J.child;else if(J.tag===18){if(fe=J.return,fe===null)throw Error(r(341));fe.lanes|=w,Ie=fe.alternate,Ie!==null&&(Ie.lanes|=w),Yy(fe,w,_),fe=J.sibling}else fe=J.child;if(fe!==null)fe.return=J;else for(fe=J;fe!==null;){if(fe===_){fe=null;break}if(J=fe.sibling,J!==null){J.return=fe.return,fe=J;break}fe=fe.return}J=fe}ca(m,_,V.children,w),_=_.child}return _;case 9:return V=_.type,P=_.pendingProps.children,Sm(_,w),V=iu(V),P=P(V),_.flags|=1,ca(m,_,P,w),_.child;case 14:return P=_.type,V=vl(P,_.pendingProps),V=vl(P.type,V),dA(m,_,P,V,w);case 15:return hA(m,_,_.type,_.pendingProps,w);case 17:return P=_.type,V=_.pendingProps,V=_.elementType===P?V:vl(P,V),Av(m,_),_.tag=1,Ic(P)?(m=!0,Wy(_)):m=!1,Sm(_,w),GI(_,P,V),A0(_,P,V,w),oE(null,_,P,!0,m,w);case 19:return vA(m,_,w);case 22:return fA(m,_,w)}throw Error(r(156,_.tag))};function Fv(m,_){return Tu(m,_)}function DA(m,_,w,P){this.tag=m,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=P,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function da(m,_,w,P){return new DA(m,_,w,P)}function Gd(m){return m=m.prototype,!(!m||!m.isReactComponent)}function LA(m){if(typeof m=="function")return Gd(m)?1:0;if(m!=null){if(m=m.$$typeof,m===_e)return 11;if(m===St)return 14}return 2}function Dh(m,_){var w=m.alternate;return w===null?(w=da(m.tag,_,m.key,m.mode),w.elementType=m.elementType,w.type=m.type,w.stateNode=m.stateNode,w.alternate=m,m.alternate=w):(w.pendingProps=_,w.type=m.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=m.flags&14680064,w.childLanes=m.childLanes,w.lanes=m.lanes,w.child=m.child,w.memoizedProps=m.memoizedProps,w.memoizedState=m.memoizedState,w.updateQueue=m.updateQueue,_=m.dependencies,w.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},w.sibling=m.sibling,w.index=m.index,w.ref=m.ref,w}function yE(m,_,w,P,V,J){var fe=2;if(P=m,typeof m=="function")Gd(m)&&(fe=1);else if(typeof m=="string")fe=5;else e:switch(m){case j:return Sl(w.children,V,J,_);case K:fe=8,V|=8;break;case Q:return m=da(12,w,_,V|2),m.elementType=Q,m.lanes=J,m;case pe:return m=da(13,w,_,V),m.elementType=pe,m.lanes=J,m;case qe:return m=da(19,w,_,V),m.elementType=qe,m.lanes=J,m;case Ne:return EE(w,V,J,_);default:if(typeof m=="object"&&m!==null)switch(m.$$typeof){case ce:fe=10;break e;case Ee:fe=9;break e;case _e:fe=11;break e;case St:fe=14;break e;case ke:fe=16,P=null;break e}throw Error(r(130,m==null?m:typeof m,""))}return _=da(fe,w,_,V),_.elementType=m,_.type=P,_.lanes=J,_}function Sl(m,_,w,P){return m=da(7,m,P,_),m.lanes=w,m}function EE(m,_,w,P){return m=da(22,m,P,_),m.elementType=Ne,m.lanes=w,m.stateNode={isHidden:!1},m}function cb(m,_,w){return m=da(6,m,null,_),m.lanes=w,m}function ub(m,_,w){return _=da(4,m.children!==null?m.children:[],m.key,_),_.lanes=w,_.stateNode={containerInfo:m.containerInfo,pendingChildren:null,implementation:m.implementation},_}function hL(m,_,w,P,V){this.tag=_,this.containerInfo=m,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Qc(0),this.expirationTimes=Qc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qc(0),this.identifierPrefix=P,this.onRecoverableError=V,this.mutableSourceEagerHydrationData=null}function lb(m,_,w,P,V,J,fe,Ie,je){return m=new hL(m,_,w,Ie,je),_===1?(_=1,J===!0&&(_|=8)):_=0,J=da(3,null,null,_),m.current=J,J.stateNode=m,J.memoizedState={element:P,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null},R0(J),m}function fL(m,_,w){var P=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:te,key:P==null?null:""+P,children:m,containerInfo:_,implementation:w}}function SE(m){if(!m)return Sh;m=m._reactInternals;e:{if(to(m)!==m||m.tag!==1)throw Error(r(170));var _=m;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(Ic(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(r(171))}if(m.tag===1){var w=m.type;if(Ic(w))return By(m,w,_)}return _}function db(m,_,w,P,V,J,fe,Ie,je){return m=lb(w,P,!0,m,V,J,fe,Ie,je),m.context=SE(null),w=m.current,P=wo(),V=Bd(w),J=Md(P,V),J.callback=_??null,wh(w,J,V),m.current.lanes=V,Ia(m,V,P),Oa(m,P),m}function TE(m,_,w,P){var V=_.current,J=wo(),fe=Bd(V);return w=SE(w),_.context===null?_.context=w:_.pendingContext=w,_=Md(J,fe),_.payload={element:m},P=P===void 0?null:P,P!==null&&(_.callback=P),m=wh(V,_,fe),m!==null&&(ou(m,V,fe,J),Xy(m,V,fe)),fe}function jv(m){if(m=m.current,!m.child)return null;switch(m.child.tag){case 5:return m.child.stateNode;default:return m.child.stateNode}}function xA(m,_){if(m=m.memoizedState,m!==null&&m.dehydrated!==null){var w=m.retryLane;m.retryLane=w!==0&&w<_?w:_}}function ip(m,_){xA(m,_),(m=m.alternate)&&xA(m,_)}function Ql(){return null}var hb=typeof reportError=="function"?reportError:function(m){console.error(m)};function fb(m){this._internalRoot=m}bE.prototype.render=fb.prototype.render=function(m){var _=this._internalRoot;if(_===null)throw Error(r(409));TE(m,_,null,null)},bE.prototype.unmount=fb.prototype.unmount=function(){var m=this._internalRoot;if(m!==null){this._internalRoot=null;var _=m.containerInfo;Wd(function(){TE(null,m,null,null)}),_[Ou]=null}};function bE(m){this._internalRoot=m}bE.prototype.unstable_scheduleHydration=function(m){if(m){var _=Od();m={blockedOn:null,target:m,priority:_};for(var w=0;w<ia.length&&_!==0&&_<ia[w].priority;w++);ia.splice(w,0,m),w===0&&Iu(m)}};function Bv(m){return!(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)}function Wv(m){return!(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11&&(m.nodeType!==8||m.nodeValue!==" react-mount-point-unstable "))}function MA(){}function wE(m,_,w,P,V){if(V){if(typeof P=="function"){var J=P;P=function(){var ut=jv(fe);J.call(ut)}}var fe=db(_,P,m,0,null,!1,!1,"",MA);return m._reactRootContainer=fe,m[Ou]=fe.current,Bf(m.nodeType===8?m.parentNode:m),Wd(),fe}for(;V=m.lastChild;)m.removeChild(V);if(typeof P=="function"){var Ie=P;P=function(){var ut=jv(je);Ie.call(ut)}}var je=lb(m,0,!1,null,null,!1,!1,"",MA);return m._reactRootContainer=je,m[Ou]=je.current,Bf(m.nodeType===8?m.parentNode:m),Wd(function(){TE(_,je,w,P)}),je}function Tl(m,_,w,P,V){var J=w._reactRootContainer;if(J){var fe=J;if(typeof V=="function"){var Ie=V;V=function(){var je=jv(fe);Ie.call(je)}}TE(_,fe,m,V)}else fe=wE(w,_,m,V,P);return jv(fe)}Zc=function(m){switch(m.tag){case 3:var _=m.stateNode;if(_.current.memoizedState.isDehydrated){var w=bu(_.pendingLanes);w!==0&&(Aa(_,w|1),Oa(_,Zr()),(ti&6)===0&&(np=Zr()+500,Th()))}break;case 13:Wd(function(){var P=xu(m,1);if(P!==null){var V=wo();ou(P,m,1,V)}}),ip(m,1)}},So=function(m){if(m.tag===13){var _=xu(m,134217728);if(_!==null){var w=wo();ou(_,m,134217728,w)}ip(m,134217728)}},Hl=function(m){if(m.tag===13){var _=Bd(m),w=xu(m,_);if(w!==null){var P=wo();ou(w,m,_,P)}ip(m,_)}},Od=function(){return pr},pl=function(m,_){var w=pr;try{return pr=m,_()}finally{pr=w}},Ga=function(m,_,w){switch(_){case"input":if(Dn(m,w),_=w.name,w.type==="radio"&&_!=null){for(w=m;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<w.length;_++){var P=w[_];if(P!==m&&P.form===m.form){var V=vm(P);if(!V)throw Error(r(90));Tn(P),Dn(P,V)}}}break;case"textarea":nt(m,w);break;case"select":_=w.value,_!=null&&at(m,!!w.multiple,_,!1)}},_u=xv,Do=Wd;var zv={usingClientEntryPoint:!1,Events:[gm,Gf,vm,Ha,zi,xv]},Gv={findFiberByHostInstance:zf,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},pL={bundleType:Gv.bundleType,version:Gv.version,rendererPackageName:Gv.rendererPackageName,rendererConfig:Gv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:F.ReactCurrentDispatcher,findHostInstanceByFiber:function(m){return m=yc(m),m===null?null:m.stateNode},findFiberByHostInstance:Gv.findFiberByHostInstance||Ql,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var CE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!CE.isDisabled&&CE.supportsFiber)try{xo=CE.inject(pL),es=CE}catch{}}return Qu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zv,Qu.createPortal=function(m,_){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bv(_))throw Error(r(200));return fL(m,_,null,w)},Qu.createRoot=function(m,_){if(!Bv(m))throw Error(r(299));var w=!1,P="",V=hb;return _!=null&&(_.unstable_strictMode===!0&&(w=!0),_.identifierPrefix!==void 0&&(P=_.identifierPrefix),_.onRecoverableError!==void 0&&(V=_.onRecoverableError)),_=lb(m,1,!1,null,null,w,!1,P,V),m[Ou]=_.current,Bf(m.nodeType===8?m.parentNode:m),new fb(_)},Qu.findDOMNode=function(m){if(m==null)return null;if(m.nodeType===1)return m;var _=m._reactInternals;if(_===void 0)throw typeof m.render=="function"?Error(r(188)):(m=Object.keys(m).join(","),Error(r(268,m)));return m=yc(_),m=m===null?null:m.stateNode,m},Qu.flushSync=function(m){return Wd(m)},Qu.hydrate=function(m,_,w){if(!Wv(_))throw Error(r(200));return Tl(null,m,_,!0,w)},Qu.hydrateRoot=function(m,_,w){if(!Bv(m))throw Error(r(405));var P=w!=null&&w.hydratedSources||null,V=!1,J="",fe=hb;if(w!=null&&(w.unstable_strictMode===!0&&(V=!0),w.identifierPrefix!==void 0&&(J=w.identifierPrefix),w.onRecoverableError!==void 0&&(fe=w.onRecoverableError)),_=db(_,null,m,1,w??null,V,!1,J,fe),m[Ou]=_.current,Bf(m),P)for(m=0;m<P.length;m++)w=P[m],V=w._getVersion,V=V(w._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[w,V]:_.mutableSourceEagerHydrationData.push(w,V);return new bE(_)},Qu.render=function(m,_,w){if(!Wv(_))throw Error(r(200));return Tl(null,m,_,!1,w)},Qu.unmountComponentAtNode=function(m){if(!Wv(m))throw Error(r(40));return m._reactRootContainer?(Wd(function(){Tl(null,null,m,!1,function(){m._reactRootContainer=null,m[Ou]=null})}),!0):!1},Qu.unstable_batchedUpdates=xv,Qu.unstable_renderSubtreeIntoContainer=function(m,_,w,P){if(!Wv(w))throw Error(r(200));if(m==null||m._reactInternals===void 0)throw Error(r(38));return Tl(m,_,w,!1,P)},Qu.version="18.2.0-next-9e3b772b8-20220608",Qu}var vX;function ene(){if(vX)return oV.exports;vX=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),oV.exports=ebe(),oV.exports}var _X;function tbe(){if(_X)return nP;_X=1;var t=ene();return nP.createRoot=t.createRoot,nP.hydrateRoot=t.hydrateRoot,nP}var nbe=tbe();const rbe=HT(nbe);function ibe(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}function sbe(t){var e=document.createElement("style");return e.setAttribute("data-emotion",t.key),t.nonce!==void 0&&e.setAttribute("nonce",t.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var obe=function(){function t(r){var o=this;this._insertTag=function(a){var u;o.tags.length===0?o.insertionPoint?u=o.insertionPoint.nextSibling:o.prepend?u=o.container.firstChild:u=o.before:u=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(a,u),o.tags.push(a)},this.isSpeedy=r.speedy===void 0?!0:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var e=t.prototype;return e.hydrate=function(o){o.forEach(this._insertTag)},e.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(sbe(this));var a=this.tags[this.tags.length-1];if(this.isSpeedy){var u=ibe(a);try{u.insertRule(o,u.cssRules.length)}catch{}}else a.appendChild(document.createTextNode(o));this.ctr++},e.flush=function(){this.tags.forEach(function(o){return o.parentNode&&o.parentNode.removeChild(o)}),this.tags=[],this.ctr=0},t}(),jc="-ms-",bN="-moz-",Oi="-webkit-",tne="comm",vB="rule",_B="decl",abe="@import",nne="@keyframes",cbe="@layer",ube=Math.abs,b1=String.fromCharCode,lbe=Object.assign;function dbe(t,e){return hc(t,0)^45?(((e<<2^hc(t,0))<<2^hc(t,1))<<2^hc(t,2))<<2^hc(t,3):0}function rne(t){return t.trim()}function hbe(t,e){return(t=e.exec(t))?t[0]:t}function Pi(t,e,r){return t.replace(e,r)}function q2(t,e){return t.indexOf(e)}function hc(t,e){return t.charCodeAt(e)|0}function FC(t,e,r){return t.slice(e,r)}function sf(t){return t.length}function yB(t){return t.length}function rP(t,e){return e.push(t),t}function fbe(t,e){return t.map(e).join("")}var w1=1,ST=1,ine=0,ol=0,Yo=0,KT="";function C1(t,e,r,o,a,u,d){return{value:t,root:e,parent:r,type:o,props:a,children:u,line:w1,column:ST,length:d,return:""}}function Rw(t,e){return lbe(C1("",null,null,"",null,null,0),t,{length:-t.length},e)}function pbe(){return Yo}function mbe(){return Yo=ol>0?hc(KT,--ol):0,ST--,Yo===10&&(ST=1,w1--),Yo}function Vl(){return Yo=ol<ine?hc(KT,ol++):0,ST++,Yo===10&&(ST=1,w1++),Yo}function ff(){return hc(KT,ol)}function VP(){return ol}function TR(t,e){return FC(KT,t,e)}function jC(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function sne(t){return w1=ST=1,ine=sf(KT=t),ol=0,[]}function one(t){return KT="",t}function FP(t){return rne(TR(ol-1,$2(t===91?t+2:t===40?t+1:t)))}function gbe(t){for(;(Yo=ff())&&Yo<33;)Vl();return jC(t)>2||jC(Yo)>3?"":" "}function vbe(t,e){for(;--e&&Vl()&&!(Yo<48||Yo>102||Yo>57&&Yo<65||Yo>70&&Yo<97););return TR(t,VP()+(e<6&&ff()==32&&Vl()==32))}function $2(t){for(;Vl();)switch(Yo){case t:return ol;case 34:case 39:t!==34&&t!==39&&$2(Yo);break;case 40:t===41&&$2(t);break;case 92:Vl();break}return ol}function _be(t,e){for(;Vl()&&t+Yo!==57;)if(t+Yo===84&&ff()===47)break;return"/*"+TR(e,ol-1)+"*"+b1(t===47?t:Vl())}function ybe(t){for(;!jC(ff());)Vl();return TR(t,ol)}function Ebe(t){return one(jP("",null,null,null,[""],t=sne(t),0,[0],t))}function jP(t,e,r,o,a,u,d,f,g){for(var E=0,T=0,C=d,I=0,D=0,L=0,B=1,G=1,se=1,ae=0,M="",F=a,z=u,te=o,j=M;G;)switch(L=ae,ae=Vl()){case 40:if(L!=108&&hc(j,C-1)==58){q2(j+=Pi(FP(ae),"&","&\f"),"&\f")!=-1&&(se=-1);break}case 34:case 39:case 91:j+=FP(ae);break;case 9:case 10:case 13:case 32:j+=gbe(L);break;case 92:j+=vbe(VP()-1,7);continue;case 47:switch(ff()){case 42:case 47:rP(Sbe(_be(Vl(),VP()),e,r),g);break;default:j+="/"}break;case 123*B:f[E++]=sf(j)*se;case 125*B:case 59:case 0:switch(ae){case 0:case 125:G=0;case 59+T:se==-1&&(j=Pi(j,/\f/g,"")),D>0&&sf(j)-C&&rP(D>32?EX(j+";",o,r,C-1):EX(Pi(j," ","")+";",o,r,C-2),g);break;case 59:j+=";";default:if(rP(te=yX(j,e,r,E,T,a,f,M,F=[],z=[],C),u),ae===123)if(T===0)jP(j,e,te,te,F,u,C,f,z);else switch(I===99&&hc(j,3)===110?100:I){case 100:case 108:case 109:case 115:jP(t,te,te,o&&rP(yX(t,te,te,0,0,a,f,M,a,F=[],C),z),a,z,C,f,o?F:z);break;default:jP(j,te,te,te,[""],z,0,f,z)}}E=T=D=0,B=se=1,M=j="",C=d;break;case 58:C=1+sf(j),D=L;default:if(B<1){if(ae==123)--B;else if(ae==125&&B++==0&&mbe()==125)continue}switch(j+=b1(ae),ae*B){case 38:se=T>0?1:(j+="\f",-1);break;case 44:f[E++]=(sf(j)-1)*se,se=1;break;case 64:ff()===45&&(j+=FP(Vl())),I=ff(),T=C=sf(M=j+=ybe(VP())),ae++;break;case 45:L===45&&sf(j)==2&&(B=0)}}return u}function yX(t,e,r,o,a,u,d,f,g,E,T){for(var C=a-1,I=a===0?u:[""],D=yB(I),L=0,B=0,G=0;L<o;++L)for(var se=0,ae=FC(t,C+1,C=ube(B=d[L])),M=t;se<D;++se)(M=rne(B>0?I[se]+" "+ae:Pi(ae,/&\f/g,I[se])))&&(g[G++]=M);return C1(t,e,r,a===0?vB:f,g,E,T)}function Sbe(t,e,r){return C1(t,e,r,tne,b1(pbe()),FC(t,2,-2),0)}function EX(t,e,r,o){return C1(t,e,r,_B,FC(t,0,o),FC(t,o+1,-1),o)}function sT(t,e){for(var r="",o=yB(t),a=0;a<o;a++)r+=e(t[a],a,t,e)||"";return r}function Tbe(t,e,r,o){switch(t.type){case cbe:if(t.children.length)break;case abe:case _B:return t.return=t.return||t.value;case tne:return"";case nne:return t.return=t.value+"{"+sT(t.children,o)+"}";case vB:t.value=t.props.join(",")}return sf(r=sT(t.children,o))?t.return=t.value+"{"+r+"}":""}function bbe(t){var e=yB(t);return function(r,o,a,u){for(var d="",f=0;f<e;f++)d+=t[f](r,o,a,u)||"";return d}}function wbe(t){return function(e){e.root||(e=e.return)&&t(e)}}var SX=function(e){var r=new WeakMap;return function(o){if(r.has(o))return r.get(o);var a=e(o);return r.set(o,a),a}};function ane(t){var e=Object.create(null);return function(r){return e[r]===void 0&&(e[r]=t(r)),e[r]}}var Cbe=function(e,r,o){for(var a=0,u=0;a=u,u=ff(),a===38&&u===12&&(r[o]=1),!jC(u);)Vl();return TR(e,ol)},Rbe=function(e,r){var o=-1,a=44;do switch(jC(a)){case 0:a===38&&ff()===12&&(r[o]=1),e[o]+=Cbe(ol-1,r,o);break;case 2:e[o]+=FP(a);break;case 4:if(a===44){e[++o]=ff()===58?"&\f":"",r[o]=e[o].length;break}default:e[o]+=b1(a)}while(a=Vl());return e},Ibe=function(e,r){return one(Rbe(sne(e),r))},TX=new WeakMap,Abe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var r=e.value,o=e.parent,a=e.column===o.column&&e.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(e.props.length===1&&r.charCodeAt(0)!==58&&!TX.get(o))&&!a){TX.set(e,!0);for(var u=[],d=Ibe(r,u),f=o.props,g=0,E=0;g<d.length;g++)for(var T=0;T<f.length;T++,E++)e.props[E]=u[g]?d[g].replace(/&\f/g,f[T]):f[T]+" "+d[g]}}},kbe=function(e){if(e.type==="decl"){var r=e.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(e.return="",e.value="")}};function cne(t,e){switch(dbe(t,e)){case 5103:return Oi+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Oi+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return Oi+t+bN+t+jc+t+t;case 6828:case 4268:return Oi+t+jc+t+t;case 6165:return Oi+t+jc+"flex-"+t+t;case 5187:return Oi+t+Pi(t,/(\w+).+(:[^]+)/,Oi+"box-$1$2"+jc+"flex-$1$2")+t;case 5443:return Oi+t+jc+"flex-item-"+Pi(t,/flex-|-self/,"")+t;case 4675:return Oi+t+jc+"flex-line-pack"+Pi(t,/align-content|flex-|-self/,"")+t;case 5548:return Oi+t+jc+Pi(t,"shrink","negative")+t;case 5292:return Oi+t+jc+Pi(t,"basis","preferred-size")+t;case 6060:return Oi+"box-"+Pi(t,"-grow","")+Oi+t+jc+Pi(t,"grow","positive")+t;case 4554:return Oi+Pi(t,/([^-])(transform)/g,"$1"+Oi+"$2")+t;case 6187:return Pi(Pi(Pi(t,/(zoom-|grab)/,Oi+"$1"),/(image-set)/,Oi+"$1"),t,"")+t;case 5495:case 3959:return Pi(t,/(image-set\([^]*)/,Oi+"$1$`$1");case 4968:return Pi(Pi(t,/(.+:)(flex-)?(.*)/,Oi+"box-pack:$3"+jc+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Oi+t+t;case 4095:case 3583:case 4068:case 2532:return Pi(t,/(.+)-inline(.+)/,Oi+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(sf(t)-1-e>6)switch(hc(t,e+1)){case 109:if(hc(t,e+4)!==45)break;case 102:return Pi(t,/(.+:)(.+)-([^]+)/,"$1"+Oi+"$2-$3$1"+bN+(hc(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~q2(t,"stretch")?cne(Pi(t,"stretch","fill-available"),e)+t:t}break;case 4949:if(hc(t,e+1)!==115)break;case 6444:switch(hc(t,sf(t)-3-(~q2(t,"!important")&&10))){case 107:return Pi(t,":",":"+Oi)+t;case 101:return Pi(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Oi+(hc(t,14)===45?"inline-":"")+"box$3$1"+Oi+"$2$3$1"+jc+"$2box$3")+t}break;case 5936:switch(hc(t,e+11)){case 114:return Oi+t+jc+Pi(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return Oi+t+jc+Pi(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return Oi+t+jc+Pi(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return Oi+t+jc+t+t}return t}var Obe=function(e,r,o,a){if(e.length>-1&&!e.return)switch(e.type){case _B:e.return=cne(e.value,e.length);break;case nne:return sT([Rw(e,{value:Pi(e.value,"@","@"+Oi)})],a);case vB:if(e.length)return fbe(e.props,function(u){switch(hbe(u,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return sT([Rw(e,{props:[Pi(u,/:(read-\w+)/,":"+bN+"$1")]})],a);case"::placeholder":return sT([Rw(e,{props:[Pi(u,/:(plac\w+)/,":"+Oi+"input-$1")]}),Rw(e,{props:[Pi(u,/:(plac\w+)/,":"+bN+"$1")]}),Rw(e,{props:[Pi(u,/:(plac\w+)/,jc+"input-$1")]})],a)}return""})}},Pbe=[Obe],Nbe=function(e){var r=e.key;if(r==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(B){var G=B.getAttribute("data-emotion");G.indexOf(" ")!==-1&&(document.head.appendChild(B),B.setAttribute("data-s",""))})}var a=e.stylisPlugins||Pbe,u={},d,f=[];d=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(B){for(var G=B.getAttribute("data-emotion").split(" "),se=1;se<G.length;se++)u[G[se]]=!0;f.push(B)});var g,E=[Abe,kbe];{var T,C=[Tbe,wbe(function(B){T.insert(B)})],I=bbe(E.concat(a,C)),D=function(G){return sT(Ebe(G),I)};g=function(G,se,ae,M){T=ae,D(G?G+"{"+se.styles+"}":se.styles),M&&(L.inserted[se.name]=!0)}}var L={key:r,sheet:new obe({key:r,container:d,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:u,registered:{},insert:g};return L.sheet.hydrate(f),L};function oy(){return oy=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},oy.apply(this,arguments)}var uV={exports:{}},ji={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bX;function Dbe(){if(bX)return ji;bX=1;var t=typeof Symbol=="function"&&Symbol.for,e=t?Symbol.for("react.element"):60103,r=t?Symbol.for("react.portal"):60106,o=t?Symbol.for("react.fragment"):60107,a=t?Symbol.for("react.strict_mode"):60108,u=t?Symbol.for("react.profiler"):60114,d=t?Symbol.for("react.provider"):60109,f=t?Symbol.for("react.context"):60110,g=t?Symbol.for("react.async_mode"):60111,E=t?Symbol.for("react.concurrent_mode"):60111,T=t?Symbol.for("react.forward_ref"):60112,C=t?Symbol.for("react.suspense"):60113,I=t?Symbol.for("react.suspense_list"):60120,D=t?Symbol.for("react.memo"):60115,L=t?Symbol.for("react.lazy"):60116,B=t?Symbol.for("react.block"):60121,G=t?Symbol.for("react.fundamental"):60117,se=t?Symbol.for("react.responder"):60118,ae=t?Symbol.for("react.scope"):60119;function M(z){if(typeof z=="object"&&z!==null){var te=z.$$typeof;switch(te){case e:switch(z=z.type,z){case g:case E:case o:case u:case a:case C:return z;default:switch(z=z&&z.$$typeof,z){case f:case T:case L:case D:case d:return z;default:return te}}case r:return te}}}function F(z){return M(z)===E}return ji.AsyncMode=g,ji.ConcurrentMode=E,ji.ContextConsumer=f,ji.ContextProvider=d,ji.Element=e,ji.ForwardRef=T,ji.Fragment=o,ji.Lazy=L,ji.Memo=D,ji.Portal=r,ji.Profiler=u,ji.StrictMode=a,ji.Suspense=C,ji.isAsyncMode=function(z){return F(z)||M(z)===g},ji.isConcurrentMode=F,ji.isContextConsumer=function(z){return M(z)===f},ji.isContextProvider=function(z){return M(z)===d},ji.isElement=function(z){return typeof z=="object"&&z!==null&&z.$$typeof===e},ji.isForwardRef=function(z){return M(z)===T},ji.isFragment=function(z){return M(z)===o},ji.isLazy=function(z){return M(z)===L},ji.isMemo=function(z){return M(z)===D},ji.isPortal=function(z){return M(z)===r},ji.isProfiler=function(z){return M(z)===u},ji.isStrictMode=function(z){return M(z)===a},ji.isSuspense=function(z){return M(z)===C},ji.isValidElementType=function(z){return typeof z=="string"||typeof z=="function"||z===o||z===E||z===u||z===a||z===C||z===I||typeof z=="object"&&z!==null&&(z.$$typeof===L||z.$$typeof===D||z.$$typeof===d||z.$$typeof===f||z.$$typeof===T||z.$$typeof===G||z.$$typeof===se||z.$$typeof===ae||z.$$typeof===B)},ji.typeOf=M,ji}var wX;function Lbe(){return wX||(wX=1,uV.exports=Dbe()),uV.exports}var lV,CX;function xbe(){if(CX)return lV;CX=1;var t=Lbe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},r={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},u={};u[t.ForwardRef]=o,u[t.Memo]=a;function d(L){return t.isMemo(L)?a:u[L.$$typeof]||e}var f=Object.defineProperty,g=Object.getOwnPropertyNames,E=Object.getOwnPropertySymbols,T=Object.getOwnPropertyDescriptor,C=Object.getPrototypeOf,I=Object.prototype;function D(L,B,G){if(typeof B!="string"){if(I){var se=C(B);se&&se!==I&&D(L,se,G)}var ae=g(B);E&&(ae=ae.concat(E(B)));for(var M=d(L),F=d(B),z=0;z<ae.length;++z){var te=ae[z];if(!r[te]&&!(G&&G[te])&&!(F&&F[te])&&!(M&&M[te])){var j=T(B,te);try{f(L,te,j)}catch{}}}}return L}return lV=D,lV}xbe();var Mbe=!0;function Ube(t,e,r){var o="";return r.split(" ").forEach(function(a){t[a]!==void 0?e.push(t[a]+";"):o+=a+" "}),o}var une=function(e,r,o){var a=e.key+"-"+r.name;(o===!1||Mbe===!1)&&e.registered[a]===void 0&&(e.registered[a]=r.styles)},lne=function(e,r,o){une(e,r,o);var a=e.key+"-"+r.name;if(e.inserted[r.name]===void 0){var u=r;do e.insert(r===u?"."+a:"",u,e.sheet,!0),u=u.next;while(u!==void 0)}};function Vbe(t){for(var e=0,r,o=0,a=t.length;a>=4;++o,a-=4)r=t.charCodeAt(o)&255|(t.charCodeAt(++o)&255)<<8|(t.charCodeAt(++o)&255)<<16|(t.charCodeAt(++o)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,e=(r&65535)*1540483477+((r>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(a){case 3:e^=(t.charCodeAt(o+2)&255)<<16;case 2:e^=(t.charCodeAt(o+1)&255)<<8;case 1:e^=t.charCodeAt(o)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var Fbe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},jbe=/[A-Z]|^ms/g,Bbe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,dne=function(e){return e.charCodeAt(1)===45},RX=function(e){return e!=null&&typeof e!="boolean"},dV=ane(function(t){return dne(t)?t:t.replace(jbe,"-$&").toLowerCase()}),IX=function(e,r){switch(e){case"animation":case"animationName":if(typeof r=="string")return r.replace(Bbe,function(o,a,u){return of={name:a,styles:u,next:of},a})}return Fbe[e]!==1&&!dne(e)&&typeof r=="number"&&r!==0?r+"px":r};function BC(t,e,r){if(r==null)return"";if(r.__emotion_styles!==void 0)return r;switch(typeof r){case"boolean":return"";case"object":{if(r.anim===1)return of={name:r.name,styles:r.styles,next:of},r.name;if(r.styles!==void 0){var o=r.next;if(o!==void 0)for(;o!==void 0;)of={name:o.name,styles:o.styles,next:of},o=o.next;var a=r.styles+";";return a}return Wbe(t,e,r)}case"function":{if(t!==void 0){var u=of,d=r(t);return of=u,BC(t,e,d)}break}}if(e==null)return r;var f=e[r];return f!==void 0?f:r}function Wbe(t,e,r){var o="";if(Array.isArray(r))for(var a=0;a<r.length;a++)o+=BC(t,e,r[a])+";";else for(var u in r){var d=r[u];if(typeof d!="object")e!=null&&e[d]!==void 0?o+=u+"{"+e[d]+"}":RX(d)&&(o+=dV(u)+":"+IX(u,d)+";");else if(Array.isArray(d)&&typeof d[0]=="string"&&(e==null||e[d[0]]===void 0))for(var f=0;f<d.length;f++)RX(d[f])&&(o+=dV(u)+":"+IX(u,d[f])+";");else{var g=BC(t,e,d);switch(u){case"animation":case"animationName":{o+=dV(u)+":"+g+";";break}default:o+=u+"{"+g+"}"}}}return o}var AX=/label:\s*([^\s;\n{]+)\s*(;|$)/g,of,EB=function(e,r,o){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var a=!0,u="";of=void 0;var d=e[0];d==null||d.raw===void 0?(a=!1,u+=BC(o,r,d)):u+=d[0];for(var f=1;f<e.length;f++)u+=BC(o,r,e[f]),a&&(u+=d[f]);AX.lastIndex=0;for(var g="",E;(E=AX.exec(u))!==null;)g+="-"+E[1];var T=Vbe(u)+g;return{name:T,styles:u,next:of}},zbe=function(e){return e()},hne=fX.useInsertionEffect?fX.useInsertionEffect:!1,Gbe=hne||zbe,kX=hne||X.useLayoutEffect,fne=X.createContext(typeof HTMLElement<"u"?Nbe({key:"css"}):null);fne.Provider;var pne=function(e){return X.forwardRef(function(r,o){var a=X.useContext(fne);return e(r,a,o)})},WC=X.createContext({}),Hbe=function(e,r){if(typeof r=="function"){var o=r(e);return o}return oy({},e,r)},Kbe=SX(function(t){return SX(function(e){return Hbe(t,e)})}),qbe=function(e){var r=X.useContext(WC);return e.theme!==r&&(r=Kbe(r)(e.theme)),X.createElement(WC.Provider,{value:r},e.children)},R1=pne(function(t,e){var r=t.styles,o=EB([r],void 0,X.useContext(WC)),a=X.useRef();return kX(function(){var u=e.key+"-global",d=new e.sheet.constructor({key:u,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),f=!1,g=document.querySelector('style[data-emotion="'+u+" "+o.name+'"]');return e.sheet.tags.length&&(d.before=e.sheet.tags[0]),g!==null&&(f=!0,g.setAttribute("data-emotion",u),d.hydrate([g])),a.current=[d,f],function(){d.flush()}},[e]),kX(function(){var u=a.current,d=u[0],f=u[1];if(f){u[1]=!1;return}if(o.next!==void 0&&lne(e,o.next,!0),d.tags.length){var g=d.tags[d.tags.length-1].nextElementSibling;d.before=g,d.flush()}e.insert("",o,d,!1)},[e,o.name]),null});function $be(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return EB(e)}var bR=function(){var e=$be.apply(void 0,arguments),r="animation-"+e.name;return{name:r,styles:"@keyframes "+r+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},mne=String.raw,gne=mne`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,Ybe=()=>$.jsx(R1,{styles:gne}),Xbe=({scope:t=""})=>$.jsx(R1,{styles:mne`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${t} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${t} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${t} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${t} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${t} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${t} :where(b, strong) {
        font-weight: bold;
      }

      ${t} small {
        font-size: 80%;
      }

      ${t} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${t} sub {
        bottom: -0.25em;
      }

      ${t} sup {
        top: -0.5em;
      }

      ${t} img {
        border-style: none;
      }

      ${t} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${t} :where(button, input) {
        overflow: visible;
      }

      ${t} :where(button, select) {
        text-transform: none;
      }

      ${t} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${t} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${t} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${t} progress {
        vertical-align: baseline;
      }

      ${t} textarea {
        overflow: auto;
      }

      ${t} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${t} input[type="number"]::-webkit-inner-spin-button,
      ${t} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${t} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${t} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${t} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${t} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${t} details {
        display: block;
      }

      ${t} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${t} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${t} button {
        background: transparent;
        padding: 0;
      }

      ${t} fieldset {
        margin: 0;
        padding: 0;
      }

      ${t} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${t} textarea {
        resize: vertical;
      }

      ${t} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${t} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${t} table {
        border-collapse: collapse;
      }

      ${t} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${t} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${t} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${t} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${t} select::-ms-expand {
        display: none;
      }

      ${gne}
    `});function Jbe(t,e){return`${t} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function Bs(t={}){const{name:e,strict:r=!0,hookName:o="useContext",providerName:a="Provider",errorMessage:u,defaultValue:d}=t,f=X.createContext(d);f.displayName=e;function g(){var E;const T=X.useContext(f);if(!T&&r){const C=new Error(u??Jbe(o,a));throw C.name="ContextError",(E=Error.captureStackTrace)==null||E.call(Error,C,g),C}return T}return[f.Provider,g,f]}var[Qbe,Zbe]=Bs({strict:!1,name:"PortalManagerContext"});function SB(t){const{children:e,zIndex:r}=t;return $.jsx(Qbe,{value:{zIndex:r},children:e})}SB.displayName="PortalManager";var Vp=globalThis!=null&&globalThis.document?X.useLayoutEffect:X.useEffect,vne=ene(),[_ne,ewe]=Bs({strict:!1,name:"PortalContext"}),TB="chakra-portal",twe=".chakra-portal",nwe=t=>$.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:t.zIndex,top:0,left:0,right:0},children:t.children}),rwe=t=>{const{appendToParentPortal:e,children:r}=t,[o,a]=X.useState(null),u=X.useRef(null),[,d]=X.useState({});X.useEffect(()=>d({}),[]);const f=ewe(),g=Zbe();Vp(()=>{if(!o)return;const T=o.ownerDocument,C=e?f??T.body:T.body;if(!C)return;u.current=T.createElement("div"),u.current.className=TB,C.appendChild(u.current),d({});const I=u.current;return()=>{C.contains(I)&&C.removeChild(I)}},[o]);const E=g!=null&&g.zIndex?$.jsx(nwe,{zIndex:g==null?void 0:g.zIndex,children:r}):r;return u.current?vne.createPortal($.jsx(_ne,{value:u.current,children:E}),u.current):$.jsx("span",{ref:T=>{T&&a(T)}})},iwe=t=>{const{children:e,containerRef:r,appendToParentPortal:o}=t,a=r.current,u=a??(typeof window<"u"?document.body:void 0),d=X.useMemo(()=>{const g=a==null?void 0:a.ownerDocument.createElement("div");return g&&(g.className=TB),g},[a]),[,f]=X.useState({});return Vp(()=>f({}),[]),Vp(()=>{if(!(!d||!u))return u.appendChild(d),()=>{u.removeChild(d)}},[d,u]),u&&d?vne.createPortal($.jsx(_ne,{value:o?d:null,children:e}),d):null};function mh(t){const e={appendToParentPortal:!0,...t},{containerRef:r,...o}=e;return r?$.jsx(iwe,{containerRef:r,...o}):$.jsx(rwe,{...o})}mh.className=TB;mh.selector=twe;mh.displayName="Portal";function qT(){const t=X.useContext(WC);if(!t)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return t}var bB=X.createContext({});bB.displayName="ColorModeContext";function I1(){const t=X.useContext(bB);if(t===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return t}function swe(t,e){const{colorMode:r}=I1();return r==="dark"?e:t}var iP={light:"chakra-ui-light",dark:"chakra-ui-dark"};function owe(t={}){const{preventTransition:e=!0}=t,r={setDataset:o=>{const a=e?r.preventTransition():void 0;document.documentElement.dataset.theme=o,document.documentElement.style.colorScheme=o,a==null||a()},setClassName(o){document.body.classList.add(o?iP.dark:iP.light),document.body.classList.remove(o?iP.light:iP.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(o){var a;return((a=r.query().matches)!=null?a:o==="dark")?"dark":"light"},addListener(o){const a=r.query(),u=d=>{o(d.matches?"dark":"light")};return typeof a.addListener=="function"?a.addListener(u):a.addEventListener("change",u),()=>{typeof a.removeListener=="function"?a.removeListener(u):a.removeEventListener("change",u)}},preventTransition(){const o=document.createElement("style");return o.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(o),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(o)})})}}};return r}var awe="chakra-ui-color-mode";function cwe(t){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let r;try{r=localStorage.getItem(t)||e}catch{}return r||e},set(e){try{localStorage.setItem(t,e)}catch{}}}}var uwe=cwe(awe),OX=()=>{};function PX(t,e){return t.type==="cookie"&&t.ssr?t.get(e):e}function yne(t){const{value:e,children:r,options:{useSystemColorMode:o,initialColorMode:a,disableTransitionOnChange:u}={},colorModeManager:d=uwe}=t,f=a==="dark"?"dark":"light",[g,E]=X.useState(()=>PX(d,f)),[T,C]=X.useState(()=>PX(d)),{getSystemTheme:I,setClassName:D,setDataset:L,addListener:B}=X.useMemo(()=>owe({preventTransition:u}),[u]),G=a==="system"&&!g?T:g,se=X.useCallback(F=>{const z=F==="system"?I():F;E(z),D(z==="dark"),L(z),d.set(z)},[d,I,D,L]);Vp(()=>{a==="system"&&C(I())},[]),X.useEffect(()=>{const F=d.get();if(F){se(F);return}if(a==="system"){se("system");return}se(f)},[d,f,a,se]);const ae=X.useCallback(()=>{se(G==="dark"?"light":"dark")},[G,se]);X.useEffect(()=>{if(o)return B(se)},[o,B,se]);const M=X.useMemo(()=>({colorMode:e??G,toggleColorMode:e?OX:ae,setColorMode:e?OX:se,forced:e!==void 0}),[G,ae,se,e]);return $.jsx(bB.Provider,{value:M,children:r})}yne.displayName="ColorModeProvider";function Ene(){const t=I1(),e=qT();return{...t,theme:e}}function lwe(t,e,r){var o,a;if(e==null)return e;const u=d=>{var f,g;return(g=(f=t.__cssMap)==null?void 0:f[d])==null?void 0:g.value};return(a=(o=u(e))!=null?o:u(r))!=null?a:r}function dwe(t,e,r){const o=Array.isArray(e)?e:[e],a=Array.isArray(r)?r:[r];return u=>{const d=a.filter(Boolean),f=o.map((g,E)=>{var T;const C=`${t}.${g}`;return lwe(u,C,(T=d[E])!=null?T:g)});return Array.isArray(e)?f:f[0]}}var dr=(...t)=>t.filter(Boolean).join(" ");function hh(t){const e=typeof t;return t!=null&&(e==="object"||e==="function")&&!Array.isArray(t)}function bd(t,...e){return hwe(t)?t(...e):t}var hwe=t=>typeof t=="function",zr=t=>t?"":void 0,hV=t=>t?!0:void 0;function xr(...t){return function(r){t.some(o=>(o==null||o(r),r==null?void 0:r.defaultPrevented))}}function Sne(...t){return function(r){t.forEach(o=>{o==null||o(r)})}}var $w={exports:{}};$w.exports;var NX;function fwe(){return NX||(NX=1,function(t,e){var r=200,o="__lodash_hash_undefined__",a=800,u=16,d=9007199254740991,f="[object Arguments]",g="[object Array]",E="[object AsyncFunction]",T="[object Boolean]",C="[object Date]",I="[object Error]",D="[object Function]",L="[object GeneratorFunction]",B="[object Map]",G="[object Number]",se="[object Null]",ae="[object Object]",M="[object Proxy]",F="[object RegExp]",z="[object Set]",te="[object String]",j="[object Undefined]",K="[object WeakMap]",Q="[object ArrayBuffer]",ce="[object DataView]",Ee="[object Float32Array]",_e="[object Float64Array]",pe="[object Int8Array]",qe="[object Int16Array]",St="[object Int32Array]",ke="[object Uint8Array]",Ne="[object Uint8ClampedArray]",Re="[object Uint16Array]",Ve="[object Uint32Array]",ve=/[\\^$.*+?()[\]{}|]/g,Be=/^\[object .+?Constructor\]$/,gt=/^(?:0|[1-9]\d*)$/,ze={};ze[Ee]=ze[_e]=ze[pe]=ze[qe]=ze[St]=ze[ke]=ze[Ne]=ze[Re]=ze[Ve]=!0,ze[f]=ze[g]=ze[Q]=ze[T]=ze[ce]=ze[C]=ze[I]=ze[D]=ze[B]=ze[G]=ze[ae]=ze[F]=ze[z]=ze[te]=ze[K]=!1;var _t=typeof j_=="object"&&j_&&j_.Object===Object&&j_,Dt=typeof self=="object"&&self&&self.Object===Object&&self,jt=_t||Dt||Function("return this")(),Zt=e&&!e.nodeType&&e,Xt=Zt&&!0&&t&&!t.nodeType&&t,In=Xt&&Xt.exports===Zt,Qt=In&&_t.process,Er=function(){try{var Ce=Xt&&Xt.require&&Xt.require("util").types;return Ce||Qt&&Qt.binding&&Qt.binding("util")}catch{}}(),Tn=Er&&Er.isTypedArray;function Vn(Ce,De,st){switch(st.length){case 0:return Ce.call(De);case 1:return Ce.call(De,st[0]);case 2:return Ce.call(De,st[0],st[1]);case 3:return Ce.call(De,st[0],st[1],st[2])}return Ce.apply(De,st)}function wr(Ce,De){for(var st=-1,nn=Array(Ce);++st<Ce;)nn[st]=De(st);return nn}function Pt(Ce){return function(De){return Ce(De)}}function wn(Ce,De){return Ce==null?void 0:Ce[De]}function Dn(Ce,De){return function(st){return Ce(De(st))}}var Ae=Array.prototype,$e=Function.prototype,rt=Object.prototype,at=jt["__core-js_shared__"],ct=$e.toString,Ke=rt.hasOwnProperty,nt=function(){var Ce=/[^.]+$/.exec(at&&at.keys&&at.keys.IE_PROTO||"");return Ce?"Symbol(src)_1."+Ce:""}(),At=rt.toString,It=ct.call(Object),Kt=RegExp("^"+ct.call(Ke).replace(ve,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Un=In?jt.Buffer:void 0,Fn=jt.Symbol,Yr=jt.Uint8Array;Un&&Un.allocUnsafe;var Ns=Dn(Object.getPrototypeOf,Object),$t=Object.create,Cn=rt.propertyIsEnumerable,yo=Ae.splice,Cr=Fn?Fn.toStringTag:void 0,Bi=function(){try{var Ce=Ka(Object,"defineProperty");return Ce({},"",{}),Ce}catch{}}(),za=Un?Un.isBuffer:void 0,ba=Math.max,ys=Date.now,Ga=Ka(jt,"Map"),Wi=Ka(Object,"create"),Ws=function(){function Ce(){}return function(De){if(!$a(De))return{};if($t)return $t(De);Ce.prototype=De;var st=new Ce;return Ce.prototype=void 0,st}}();function Eo(Ce){var De=-1,st=Ce==null?0:Ce.length;for(this.clear();++De<st;){var nn=Ce[De];this.set(nn[0],nn[1])}}function Ha(){this.__data__=Wi?Wi(null):{},this.size=0}function zi(Ce){var De=this.has(Ce)&&delete this.__data__[Ce];return this.size-=De?1:0,De}function _u(Ce){var De=this.__data__;if(Wi){var st=De[Ce];return st===o?void 0:st}return Ke.call(De,Ce)?De[Ce]:void 0}function Do(Ce){var De=this.__data__;return Wi?De[Ce]!==void 0:Ke.call(De,Ce)}function wa(Ce,De){var st=this.__data__;return this.size+=this.has(Ce)?0:1,st[Ce]=Wi&&De===void 0?o:De,this}Eo.prototype.clear=Ha,Eo.prototype.delete=zi,Eo.prototype.get=_u,Eo.prototype.has=Do,Eo.prototype.set=wa;function Ds(Ce){var De=-1,st=Ce==null?0:Ce.length;for(this.clear();++De<st;){var nn=Ce[De];this.set(nn[0],nn[1])}}function Gi(){this.__data__=[],this.size=0}function us(Ce){var De=this.__data__,st=ll(De,Ce);if(st<0)return!1;var nn=De.length-1;return st==nn?De.pop():yo.call(De,st,1),--this.size,!0}function Ca(Ce){var De=this.__data__,st=ll(De,Ce);return st<0?void 0:De[st][1]}function vc(Ce){return ll(this.__data__,Ce)>-1}function zs(Ce,De){var st=this.__data__,nn=ll(st,Ce);return nn<0?(++this.size,st.push([Ce,De])):st[nn][1]=De,this}Ds.prototype.clear=Gi,Ds.prototype.delete=us,Ds.prototype.get=Ca,Ds.prototype.has=vc,Ds.prototype.set=zs;function Zo(Ce){var De=-1,st=Ce==null?0:Ce.length;for(this.clear();++De<st;){var nn=Ce[De];this.set(nn[0],nn[1])}}function ea(){this.size=0,this.__data__={hash:new Eo,map:new(Ga||Ds),string:new Eo}}function yu(Ce){var De=wu(this,Ce).delete(Ce);return this.size-=De?1:0,De}function kd(Ce){return wu(this,Ce).get(Ce)}function Eu(Ce){return wu(this,Ce).has(Ce)}function Wl(Ce,De){var st=wu(this,Ce),nn=st.size;return st.set(Ce,De),this.size+=st.size==nn?0:1,this}Zo.prototype.clear=ea,Zo.prototype.delete=yu,Zo.prototype.get=kd,Zo.prototype.has=Eu,Zo.prototype.set=Wl;function to(Ce){var De=this.__data__=new Ds(Ce);this.size=De.size}function _c(){this.__data__=new Ds,this.size=0}function ta(Ce){var De=this.__data__,st=De.delete(Ce);return this.size=De.size,st}function Su(Ce){return this.__data__.get(Ce)}function yc(Ce){return this.__data__.has(Ce)}function Gs(Ce,De){var st=this.__data__;if(st instanceof Ds){var nn=st.__data__;if(!Ga||nn.length<r-1)return nn.push([Ce,De]),this.size=++st.size,this;st=this.__data__=new Zo(nn)}return st.set(Ce,De),this.size=st.size,this}to.prototype.clear=_c,to.prototype.delete=ta,to.prototype.get=Su,to.prototype.has=yc,to.prototype.set=Gs;function Tu(Ce,De){var st=Hs(Ce),nn=!st&&Hi(Ce),Zn=!st&&!nn&&Or(Ce),Ur=!st&&!nn&&!Zn&&Iu(Ce),ei=st||nn||Zn||Ur,hn=ei?wr(Ce.length,String):[],Hr=hn.length;for(var Ri in Ce)ei&&(Ri=="length"||Zn&&(Ri=="offset"||Ri=="parent")||Ur&&(Ri=="buffer"||Ri=="byteLength"||Ri=="byteOffset")||Qc(Ri,Hr))||hn.push(Ri);return hn}function ul(Ce,De,st){(st!==void 0&&!Mo(Ce[De],st)||st===void 0&&!(De in Ce))&&Zr(Ce,De,st)}function Lo(Ce,De,st){var nn=Ce[De];(!(Ke.call(Ce,De)&&Mo(nn,st))||st===void 0&&!(De in Ce))&&Zr(Ce,De,st)}function ll(Ce,De){for(var st=Ce.length;st--;)if(Mo(Ce[st][0],De))return st;return-1}function Zr(Ce,De,st){De=="__proto__"&&Bi?Bi(Ce,De,{configurable:!0,enumerable:!0,value:st,writable:!0}):Ce[De]=st}var Ti=Jc();function Ra(Ce){return Ce==null?Ce===void 0?j:se:Cr&&Cr in Object(Ce)?ra(Ce):Zc(Ce)}function Ec(Ce){return Es(Ce)&&Ra(Ce)==f}function na(Ce){if(!$a(Ce)||Aa(Ce))return!1;var De=ia(Ce)?Kt:Be;return De.test(Cu(Ce))}function zl(Ce){return Es(Ce)&&vh(Ce.length)&&!!ze[Ra(Ce)]}function dl(Ce){if(!$a(Ce))return qa(Ce);var De=pr(Ce),st=[];for(var nn in Ce)nn=="constructor"&&(De||!Ke.call(Ce,nn))||st.push(nn);return st}function xo(Ce,De,st,nn,Zn){Ce!==De&&Ti(De,function(Ur,ei){if(Zn||(Zn=new to),$a(Ur))es(Ce,De,ei,st,xo,nn,Zn);else{var hn=nn?nn(Hl(Ce,ei),Ur,ei+"",Ce,De,Zn):void 0;hn===void 0&&(hn=Ur),ul(Ce,ei,hn)}},no)}function es(Ce,De,st,nn,Zn,Ur,ei){var hn=Hl(Ce,st),Hr=Hl(De,st),Ri=ei.get(Hr);if(Ri){ul(Ce,st,Ri);return}var ms=Ur?Ur(hn,Hr,st+"",Ce,De,ei):void 0,Vo=ms===void 0;if(Vo){var Fo=Hs(Hr),oa=!Fo&&Or(Hr),ls=!Fo&&!oa&&Iu(Hr);ms=Hr,Fo||oa||ls?Hs(hn)?ms=hn:Tc(hn)?ms=Sc(hn):oa?(Vo=!1,ms=Gl(Hr)):ls?(Vo=!1,ms=Xc(Hr)):ms=[]:Ru(Hr)||Hi(Hr)?(ms=hn,Hi(hn)?ms=bc(hn):(!$a(hn)||ia(hn))&&(ms=fl(Hr))):Vo=!1}Vo&&(ei.set(Hr,ms),Zn(ms,Hr,nn,Ur,ei),ei.delete(Hr)),ul(Ce,st,ms)}function hl(Ce,De){return Od(So(Ce,De,sa),Ce+"")}var Ls=Bi?function(Ce,De){return Bi(Ce,"toString",{configurable:!0,enumerable:!1,value:ro(De),writable:!0})}:sa;function Gl(Ce,De){return Ce.slice()}function Mr(Ce){var De=new Ce.constructor(Ce.byteLength);return new Yr(De).set(new Yr(Ce)),De}function Xc(Ce,De){var st=Mr(Ce.buffer);return new Ce.constructor(st,Ce.byteOffset,Ce.length)}function Sc(Ce,De){var st=-1,nn=Ce.length;for(De||(De=Array(nn));++st<nn;)De[st]=Ce[st];return De}function fr(Ce,De,st,nn){var Zn=!st;st||(st={});for(var Ur=-1,ei=De.length;++Ur<ei;){var hn=De[Ur],Hr=void 0;Hr===void 0&&(Hr=Ce[hn]),Zn?Zr(st,hn,Hr):Lo(st,hn,Hr)}return st}function bu(Ce){return hl(function(De,st){var nn=-1,Zn=st.length,Ur=Zn>1?st[Zn-1]:void 0,ei=Zn>2?st[2]:void 0;for(Ur=Ce.length>3&&typeof Ur=="function"?(Zn--,Ur):void 0,ei&&Ia(st[0],st[1],ei)&&(Ur=Zn<3?void 0:Ur,Zn=1),De=Object(De);++nn<Zn;){var hn=st[nn];hn&&Ce(De,hn,nn,Ur)}return De})}function Jc(Ce){return function(De,st,nn){for(var Zn=-1,Ur=Object(De),ei=nn(De),hn=ei.length;hn--;){var Hr=ei[++Zn];if(st(Ur[Hr],Hr,Ur)===!1)break}return De}}function wu(Ce,De){var st=Ce.__data__;return kr(De)?st[typeof De=="string"?"string":"hash"]:st.map}function Ka(Ce,De){var st=wn(Ce,De);return na(st)?st:void 0}function ra(Ce){var De=Ke.call(Ce,Cr),st=Ce[Cr];try{Ce[Cr]=void 0;var nn=!0}catch{}var Zn=At.call(Ce);return nn&&(De?Ce[Cr]=st:delete Ce[Cr]),Zn}function fl(Ce){return typeof Ce.constructor=="function"&&!pr(Ce)?Ws(Ns(Ce)):{}}function Qc(Ce,De){var st=typeof Ce;return De=De??d,!!De&&(st=="number"||st!="symbol"&&gt.test(Ce))&&Ce>-1&&Ce%1==0&&Ce<De}function Ia(Ce,De,st){if(!$a(st))return!1;var nn=typeof De;return(nn=="number"?Uo(st)&&Qc(De,st.length):nn=="string"&&De in st)?Mo(st[De],Ce):!1}function kr(Ce){var De=typeof Ce;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Ce!=="__proto__":Ce===null}function Aa(Ce){return!!nt&&nt in Ce}function pr(Ce){var De=Ce&&Ce.constructor,st=typeof De=="function"&&De.prototype||rt;return Ce===st}function qa(Ce){var De=[];if(Ce!=null)for(var st in Object(Ce))De.push(st);return De}function Zc(Ce){return At.call(Ce)}function So(Ce,De,st){return De=ba(De===void 0?Ce.length-1:De,0),function(){for(var nn=arguments,Zn=-1,Ur=ba(nn.length-De,0),ei=Array(Ur);++Zn<Ur;)ei[Zn]=nn[De+Zn];Zn=-1;for(var hn=Array(De+1);++Zn<De;)hn[Zn]=nn[Zn];return hn[De]=st(ei),Vn(Ce,this,hn)}}function Hl(Ce,De){if(!(De==="constructor"&&typeof Ce[De]=="function")&&De!="__proto__")return Ce[De]}var Od=pl(Ls);function pl(Ce){var De=0,st=0;return function(){var nn=ys(),Zn=u-(nn-st);if(st=nn,Zn>0){if(++De>=a)return arguments[0]}else De=0;return Ce.apply(void 0,arguments)}}function Cu(Ce){if(Ce!=null){try{return ct.call(Ce)}catch{}try{return Ce+""}catch{}}return""}function Mo(Ce,De){return Ce===De||Ce!==Ce&&De!==De}var Hi=Ec(function(){return arguments}())?Ec:function(Ce){return Es(Ce)&&Ke.call(Ce,"callee")&&!Cn.call(Ce,"callee")},Hs=Array.isArray;function Uo(Ce){return Ce!=null&&vh(Ce.length)&&!ia(Ce)}function Tc(Ce){return Es(Ce)&&Uo(Ce)}var Or=za||Ya;function ia(Ce){if(!$a(Ce))return!1;var De=Ra(Ce);return De==D||De==L||De==E||De==M}function vh(Ce){return typeof Ce=="number"&&Ce>-1&&Ce%1==0&&Ce<=d}function $a(Ce){var De=typeof Ce;return Ce!=null&&(De=="object"||De=="function")}function Es(Ce){return Ce!=null&&typeof Ce=="object"}function Ru(Ce){if(!Es(Ce)||Ra(Ce)!=ae)return!1;var De=Ns(Ce);if(De===null)return!0;var st=Ke.call(De,"constructor")&&De.constructor;return typeof st=="function"&&st instanceof st&&ct.call(st)==It}var Iu=Tn?Pt(Tn):zl;function bc(Ce){return fr(Ce,no(Ce))}function no(Ce){return Uo(Ce)?Tu(Ce):dl(Ce)}var Pd=bu(function(Ce,De,st,nn){xo(Ce,De,st,nn)});function ro(Ce){return function(){return Ce}}function sa(Ce){return Ce}function Ya(){return!1}t.exports=Pd}($w,$w.exports)),$w.exports}var pwe=fwe();const uf=HT(pwe);var mwe=t=>/!(important)?$/.test(t),DX=t=>typeof t=="string"?t.replace(/!(important)?$/,"").trim():t,gwe=(t,e)=>r=>{const o=String(e),a=mwe(o),u=DX(o),d=t?`${t}.${u}`:u;let f=hh(r.__cssMap)&&d in r.__cssMap?r.__cssMap[d].varRef:e;return f=DX(f),a?`${f} !important`:f};function wB(t){const{scale:e,transform:r,compose:o}=t;return(u,d)=>{var f;const g=gwe(e,u)(d);let E=(f=r==null?void 0:r(g,d))!=null?f:g;return o&&(E=o(E,d)),E}}var sP=(...t)=>e=>t.reduce((r,o)=>o(r),e);function vd(t,e){return r=>{const o={property:r,scale:t};return o.transform=wB({scale:t,transform:e}),o}}var vwe=({rtl:t,ltr:e})=>r=>r.direction==="rtl"?t:e;function _we(t){const{property:e,scale:r,transform:o}=t;return{scale:r,property:vwe(e),transform:r?wB({scale:r,compose:o}):o}}var Tne=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function ywe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...Tne].join(" ")}function Ewe(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...Tne].join(" ")}var Swe={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},Twe={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function bwe(t){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":t,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}var wwe={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},Y2={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},Cwe=new Set(Object.values(Y2)),X2=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),Rwe=t=>t.trim();function Iwe(t,e){if(t==null||X2.has(t))return t;if(!(J2(t)||X2.has(t)))return`url('${t}')`;const a=/(^[a-z-A-Z]+)\((.*)\)/g.exec(t),u=a==null?void 0:a[1],d=a==null?void 0:a[2];if(!u||!d)return t;const f=u.includes("-gradient")?u:`${u}-gradient`,[g,...E]=d.split(",").map(Rwe).filter(Boolean);if((E==null?void 0:E.length)===0)return t;const T=g in Y2?Y2[g]:g;E.unshift(T);const C=E.map(I=>{if(Cwe.has(I))return I;const D=I.indexOf(" "),[L,B]=D!==-1?[I.substr(0,D),I.substr(D+1)]:[I],G=J2(B)?B:B&&B.split(" "),se=`colors.${L}`,ae=se in e.__cssMap?e.__cssMap[se].varRef:L;return G?[ae,...Array.isArray(G)?G:[G]].join(" "):ae});return`${f}(${C.join(", ")})`}var J2=t=>typeof t=="string"&&t.includes("(")&&t.includes(")"),Awe=(t,e)=>Iwe(t,e??{});function kwe(t){return/^var\(--.+\)$/.test(t)}var Owe=t=>{const e=parseFloat(t.toString()),r=t.toString().replace(String(e),"");return{unitless:!r,value:e,unit:r}},nf=t=>e=>`${t}(${e})`,si={filter(t){return t!=="auto"?t:Swe},backdropFilter(t){return t!=="auto"?t:Twe},ring(t){return bwe(si.px(t))},bgClip(t){return t==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:t}},transform(t){return t==="auto"?ywe():t==="auto-gpu"?Ewe():t},vh(t){return t==="$100vh"?"var(--chakra-vh)":t},px(t){if(t==null)return t;const{unitless:e}=Owe(t);return e||typeof t=="number"?`${t}px`:t},fraction(t){return typeof t!="number"||t>1?t:`${t*100}%`},float(t,e){const r={left:"right",right:"left"};return e.direction==="rtl"?r[t]:t},degree(t){if(kwe(t)||t==null)return t;const e=typeof t=="string"&&!t.endsWith("deg");return typeof t=="number"||e?`${t}deg`:t},gradient:Awe,blur:nf("blur"),opacity:nf("opacity"),brightness:nf("brightness"),contrast:nf("contrast"),dropShadow:nf("drop-shadow"),grayscale:nf("grayscale"),hueRotate:t=>nf("hue-rotate")(si.degree(t)),invert:nf("invert"),saturate:nf("saturate"),sepia:nf("sepia"),bgImage(t){return t==null||J2(t)||X2.has(t)?t:`url(${t})`},outline(t){const e=String(t)==="0"||String(t)==="none";return t!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:t}},flexDirection(t){var e;const{space:r,divide:o}=(e=wwe[t])!=null?e:{},a={flexDirection:t};return r&&(a[r]=1),o&&(a[o]=1),a}},He={borderWidths:vd("borderWidths"),borderStyles:vd("borderStyles"),colors:vd("colors"),borders:vd("borders"),gradients:vd("gradients",si.gradient),radii:vd("radii",si.px),space:vd("space",sP(si.vh,si.px)),spaceT:vd("space",sP(si.vh,si.px)),degreeT(t){return{property:t,transform:si.degree}},prop(t,e,r){return{property:t,scale:e,...e&&{transform:wB({scale:e,transform:r})}}},propT(t,e){return{property:t,transform:e}},sizes:vd("sizes",sP(si.vh,si.px)),sizesT:vd("sizes",sP(si.vh,si.fraction)),shadows:vd("shadows"),logical:_we,blur:vd("blur",si.blur)},BP={background:He.colors("background"),backgroundColor:He.colors("backgroundColor"),backgroundImage:He.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:si.bgClip},bgSize:He.prop("backgroundSize"),bgPosition:He.prop("backgroundPosition"),bg:He.colors("background"),bgColor:He.colors("backgroundColor"),bgPos:He.prop("backgroundPosition"),bgRepeat:He.prop("backgroundRepeat"),bgAttachment:He.prop("backgroundAttachment"),bgGradient:He.gradients("backgroundImage"),bgClip:{transform:si.bgClip}};Object.assign(BP,{bgImage:BP.backgroundImage,bgImg:BP.backgroundImage});var ki={border:He.borders("border"),borderWidth:He.borderWidths("borderWidth"),borderStyle:He.borderStyles("borderStyle"),borderColor:He.colors("borderColor"),borderRadius:He.radii("borderRadius"),borderTop:He.borders("borderTop"),borderBlockStart:He.borders("borderBlockStart"),borderTopLeftRadius:He.radii("borderTopLeftRadius"),borderStartStartRadius:He.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:He.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:He.radii("borderTopRightRadius"),borderStartEndRadius:He.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:He.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:He.borders("borderRight"),borderInlineEnd:He.borders("borderInlineEnd"),borderBottom:He.borders("borderBottom"),borderBlockEnd:He.borders("borderBlockEnd"),borderBottomLeftRadius:He.radii("borderBottomLeftRadius"),borderBottomRightRadius:He.radii("borderBottomRightRadius"),borderLeft:He.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:He.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:He.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:He.borders(["borderLeft","borderRight"]),borderInline:He.borders("borderInline"),borderY:He.borders(["borderTop","borderBottom"]),borderBlock:He.borders("borderBlock"),borderTopWidth:He.borderWidths("borderTopWidth"),borderBlockStartWidth:He.borderWidths("borderBlockStartWidth"),borderTopColor:He.colors("borderTopColor"),borderBlockStartColor:He.colors("borderBlockStartColor"),borderTopStyle:He.borderStyles("borderTopStyle"),borderBlockStartStyle:He.borderStyles("borderBlockStartStyle"),borderBottomWidth:He.borderWidths("borderBottomWidth"),borderBlockEndWidth:He.borderWidths("borderBlockEndWidth"),borderBottomColor:He.colors("borderBottomColor"),borderBlockEndColor:He.colors("borderBlockEndColor"),borderBottomStyle:He.borderStyles("borderBottomStyle"),borderBlockEndStyle:He.borderStyles("borderBlockEndStyle"),borderLeftWidth:He.borderWidths("borderLeftWidth"),borderInlineStartWidth:He.borderWidths("borderInlineStartWidth"),borderLeftColor:He.colors("borderLeftColor"),borderInlineStartColor:He.colors("borderInlineStartColor"),borderLeftStyle:He.borderStyles("borderLeftStyle"),borderInlineStartStyle:He.borderStyles("borderInlineStartStyle"),borderRightWidth:He.borderWidths("borderRightWidth"),borderInlineEndWidth:He.borderWidths("borderInlineEndWidth"),borderRightColor:He.colors("borderRightColor"),borderInlineEndColor:He.colors("borderInlineEndColor"),borderRightStyle:He.borderStyles("borderRightStyle"),borderInlineEndStyle:He.borderStyles("borderInlineEndStyle"),borderTopRadius:He.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:He.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:He.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:He.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(ki,{rounded:ki.borderRadius,roundedTop:ki.borderTopRadius,roundedTopLeft:ki.borderTopLeftRadius,roundedTopRight:ki.borderTopRightRadius,roundedTopStart:ki.borderStartStartRadius,roundedTopEnd:ki.borderStartEndRadius,roundedBottom:ki.borderBottomRadius,roundedBottomLeft:ki.borderBottomLeftRadius,roundedBottomRight:ki.borderBottomRightRadius,roundedBottomStart:ki.borderEndStartRadius,roundedBottomEnd:ki.borderEndEndRadius,roundedLeft:ki.borderLeftRadius,roundedRight:ki.borderRightRadius,roundedStart:ki.borderInlineStartRadius,roundedEnd:ki.borderInlineEndRadius,borderStart:ki.borderInlineStart,borderEnd:ki.borderInlineEnd,borderTopStartRadius:ki.borderStartStartRadius,borderTopEndRadius:ki.borderStartEndRadius,borderBottomStartRadius:ki.borderEndStartRadius,borderBottomEndRadius:ki.borderEndEndRadius,borderStartRadius:ki.borderInlineStartRadius,borderEndRadius:ki.borderInlineEndRadius,borderStartWidth:ki.borderInlineStartWidth,borderEndWidth:ki.borderInlineEndWidth,borderStartColor:ki.borderInlineStartColor,borderEndColor:ki.borderInlineEndColor,borderStartStyle:ki.borderInlineStartStyle,borderEndStyle:ki.borderInlineEndStyle});var Pwe={color:He.colors("color"),textColor:He.colors("color"),fill:He.colors("fill"),stroke:He.colors("stroke")},Q2={boxShadow:He.shadows("boxShadow"),mixBlendMode:!0,blendMode:He.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:He.prop("backgroundBlendMode"),opacity:!0};Object.assign(Q2,{shadow:Q2.boxShadow});var Nwe={filter:{transform:si.filter},blur:He.blur("--chakra-blur"),brightness:He.propT("--chakra-brightness",si.brightness),contrast:He.propT("--chakra-contrast",si.contrast),hueRotate:He.propT("--chakra-hue-rotate",si.hueRotate),invert:He.propT("--chakra-invert",si.invert),saturate:He.propT("--chakra-saturate",si.saturate),dropShadow:He.propT("--chakra-drop-shadow",si.dropShadow),backdropFilter:{transform:si.backdropFilter},backdropBlur:He.blur("--chakra-backdrop-blur"),backdropBrightness:He.propT("--chakra-backdrop-brightness",si.brightness),backdropContrast:He.propT("--chakra-backdrop-contrast",si.contrast),backdropHueRotate:He.propT("--chakra-backdrop-hue-rotate",si.hueRotate),backdropInvert:He.propT("--chakra-backdrop-invert",si.invert),backdropSaturate:He.propT("--chakra-backdrop-saturate",si.saturate)},wN={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:si.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:He.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:He.space("gap"),rowGap:He.space("rowGap"),columnGap:He.space("columnGap")};Object.assign(wN,{flexDir:wN.flexDirection});var bne={gridGap:He.space("gridGap"),gridColumnGap:He.space("gridColumnGap"),gridRowGap:He.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0},Dwe={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:si.outline},outlineOffset:!0,outlineColor:He.colors("outlineColor")},Ed={width:He.sizesT("width"),inlineSize:He.sizesT("inlineSize"),height:He.sizes("height"),blockSize:He.sizes("blockSize"),boxSize:He.sizes(["width","height"]),minWidth:He.sizes("minWidth"),minInlineSize:He.sizes("minInlineSize"),minHeight:He.sizes("minHeight"),minBlockSize:He.sizes("minBlockSize"),maxWidth:He.sizes("maxWidth"),maxInlineSize:He.sizes("maxInlineSize"),maxHeight:He.sizes("maxHeight"),maxBlockSize:He.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(t,e)=>{var r,o,a;return{[`@media screen and (min-width: ${(a=(o=(r=e.__breakpoints)==null?void 0:r.get(t))==null?void 0:o.minW)!=null?a:t})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(t,e)=>{var r,o,a;return{[`@media screen and (max-width: ${(a=(o=(r=e.__breakpoints)==null?void 0:r.get(t))==null?void 0:o._minW)!=null?a:t})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:He.propT("float",si.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Ed,{w:Ed.width,h:Ed.height,minW:Ed.minWidth,maxW:Ed.maxWidth,minH:Ed.minHeight,maxH:Ed.maxHeight,overscroll:Ed.overscrollBehavior,overscrollX:Ed.overscrollBehaviorX,overscrollY:Ed.overscrollBehaviorY});var Lwe={listStyleType:!0,listStylePosition:!0,listStylePos:He.prop("listStylePosition"),listStyleImage:!0,listStyleImg:He.prop("listStyleImage")};function xwe(t,e,r,o){const a=typeof e=="string"?e.split("."):[e];for(o=0;o<a.length&&t;o+=1)t=t[a[o]];return t===void 0?r:t}var Mwe=t=>{const e=new WeakMap;return(o,a,u,d)=>{if(typeof o>"u")return t(o,a,u);e.has(o)||e.set(o,new Map);const f=e.get(o);if(f.has(a))return f.get(a);const g=t(o,a,u,d);return f.set(a,g),g}},Uwe=Mwe(xwe),Vwe={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},Fwe={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},fV=(t,e,r)=>{const o={},a=Uwe(t,e,{});for(const u in a)u in r&&r[u]!=null||(o[u]=a[u]);return o},jwe={srOnly:{transform(t){return t===!0?Vwe:t==="focusable"?Fwe:{}}},layerStyle:{processResult:!0,transform:(t,e,r)=>fV(e,`layerStyles.${t}`,r)},textStyle:{processResult:!0,transform:(t,e,r)=>fV(e,`textStyles.${t}`,r)},apply:{processResult:!0,transform:(t,e,r)=>fV(e,t,r)}},gC={position:!0,pos:He.prop("position"),zIndex:He.prop("zIndex","zIndices"),inset:He.spaceT("inset"),insetX:He.spaceT(["left","right"]),insetInline:He.spaceT("insetInline"),insetY:He.spaceT(["top","bottom"]),insetBlock:He.spaceT("insetBlock"),top:He.spaceT("top"),insetBlockStart:He.spaceT("insetBlockStart"),bottom:He.spaceT("bottom"),insetBlockEnd:He.spaceT("insetBlockEnd"),left:He.spaceT("left"),insetInlineStart:He.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:He.spaceT("right"),insetInlineEnd:He.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(gC,{insetStart:gC.insetInlineStart,insetEnd:gC.insetInlineEnd});var Bwe={ring:{transform:si.ring},ringColor:He.colors("--chakra-ring-color"),ringOffset:He.prop("--chakra-ring-offset-width"),ringOffsetColor:He.colors("--chakra-ring-offset-color"),ringInset:He.prop("--chakra-ring-inset")},ks={margin:He.spaceT("margin"),marginTop:He.spaceT("marginTop"),marginBlockStart:He.spaceT("marginBlockStart"),marginRight:He.spaceT("marginRight"),marginInlineEnd:He.spaceT("marginInlineEnd"),marginBottom:He.spaceT("marginBottom"),marginBlockEnd:He.spaceT("marginBlockEnd"),marginLeft:He.spaceT("marginLeft"),marginInlineStart:He.spaceT("marginInlineStart"),marginX:He.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:He.spaceT("marginInline"),marginY:He.spaceT(["marginTop","marginBottom"]),marginBlock:He.spaceT("marginBlock"),padding:He.space("padding"),paddingTop:He.space("paddingTop"),paddingBlockStart:He.space("paddingBlockStart"),paddingRight:He.space("paddingRight"),paddingBottom:He.space("paddingBottom"),paddingBlockEnd:He.space("paddingBlockEnd"),paddingLeft:He.space("paddingLeft"),paddingInlineStart:He.space("paddingInlineStart"),paddingInlineEnd:He.space("paddingInlineEnd"),paddingX:He.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:He.space("paddingInline"),paddingY:He.space(["paddingTop","paddingBottom"]),paddingBlock:He.space("paddingBlock")};Object.assign(ks,{m:ks.margin,mt:ks.marginTop,mr:ks.marginRight,me:ks.marginInlineEnd,marginEnd:ks.marginInlineEnd,mb:ks.marginBottom,ml:ks.marginLeft,ms:ks.marginInlineStart,marginStart:ks.marginInlineStart,mx:ks.marginX,my:ks.marginY,p:ks.padding,pt:ks.paddingTop,py:ks.paddingY,px:ks.paddingX,pb:ks.paddingBottom,pl:ks.paddingLeft,ps:ks.paddingInlineStart,paddingStart:ks.paddingInlineStart,pr:ks.paddingRight,pe:ks.paddingInlineEnd,paddingEnd:ks.paddingInlineEnd});var Wwe={textDecorationColor:He.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:He.shadows("textShadow")},zwe={clipPath:!0,transform:He.propT("transform",si.transform),transformOrigin:!0,translateX:He.spaceT("--chakra-translate-x"),translateY:He.spaceT("--chakra-translate-y"),skewX:He.degreeT("--chakra-skew-x"),skewY:He.degreeT("--chakra-skew-y"),scaleX:He.prop("--chakra-scale-x"),scaleY:He.prop("--chakra-scale-y"),scale:He.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:He.degreeT("--chakra-rotate")},Gwe={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:He.prop("transitionDuration","transition.duration"),transitionProperty:He.prop("transitionProperty","transition.property"),transitionTimingFunction:He.prop("transitionTimingFunction","transition.easing")},Hwe={fontFamily:He.prop("fontFamily","fonts"),fontSize:He.prop("fontSize","fontSizes",si.px),fontWeight:He.prop("fontWeight","fontWeights"),lineHeight:He.prop("lineHeight","lineHeights"),letterSpacing:He.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(t){if(t===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},Kwe={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:He.spaceT("scrollMargin"),scrollMarginTop:He.spaceT("scrollMarginTop"),scrollMarginBottom:He.spaceT("scrollMarginBottom"),scrollMarginLeft:He.spaceT("scrollMarginLeft"),scrollMarginRight:He.spaceT("scrollMarginRight"),scrollMarginX:He.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:He.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:He.spaceT("scrollPadding"),scrollPaddingTop:He.spaceT("scrollPaddingTop"),scrollPaddingBottom:He.spaceT("scrollPaddingBottom"),scrollPaddingLeft:He.spaceT("scrollPaddingLeft"),scrollPaddingRight:He.spaceT("scrollPaddingRight"),scrollPaddingX:He.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:He.spaceT(["scrollPaddingTop","scrollPaddingBottom"])};function wne(t){return hh(t)&&t.reference?t.reference:String(t)}var A1=(t,...e)=>e.map(wne).join(` ${t} `).replace(/calc/g,""),LX=(...t)=>`calc(${A1("+",...t)})`,xX=(...t)=>`calc(${A1("-",...t)})`,Z2=(...t)=>`calc(${A1("*",...t)})`,MX=(...t)=>`calc(${A1("/",...t)})`,UX=t=>{const e=wne(t);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:Z2(e,-1)},U_=Object.assign(t=>({add:(...e)=>U_(LX(t,...e)),subtract:(...e)=>U_(xX(t,...e)),multiply:(...e)=>U_(Z2(t,...e)),divide:(...e)=>U_(MX(t,...e)),negate:()=>U_(UX(t)),toString:()=>t.toString()}),{add:LX,subtract:xX,multiply:Z2,divide:MX,negate:UX});function qwe(t,e="-"){return t.replace(/\s+/g,e)}function $we(t){const e=qwe(t.toString());return Xwe(Ywe(e))}function Ywe(t){return t.includes("\\.")?t:!Number.isInteger(parseFloat(t.toString()))?t.replace(".","\\."):t}function Xwe(t){return t.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function Jwe(t,e=""){return[e,t].filter(Boolean).join("-")}function Qwe(t,e){return`var(${t}${e?`, ${e}`:""})`}function Zwe(t,e=""){return $we(`--${Jwe(t,e)}`)}function $n(t,e,r){const o=Zwe(t,r);return{variable:o,reference:Qwe(o,e)}}function eCe(t,e){const r={};for(const o of e){if(Array.isArray(o)){const[a,u]=o;r[a]=$n(`${t}-${a}`,u);continue}r[o]=$n(`${t}-${o}`)}return r}function tCe(t){const e=t==null?0:t.length;return e?t[e-1]:void 0}function nCe(t){const e=parseFloat(t.toString()),r=t.toString().replace(String(e),"");return{unitless:!r,value:e,unit:r}}function eF(t){if(t==null)return t;const{unitless:e}=nCe(t);return e||typeof t=="number"?`${t}px`:t}var Cne=(t,e)=>parseInt(t[1],10)>parseInt(e[1],10)?1:-1,CB=t=>Object.fromEntries(Object.entries(t).sort(Cne));function VX(t){const e=CB(t);return Object.assign(Object.values(e),e)}function rCe(t){const e=Object.keys(CB(t));return new Set(e)}function FX(t){var e;if(!t)return t;t=(e=eF(t))!=null?e:t;const r=-.02;return typeof t=="number"?`${t+r}`:t.replace(/(\d+\.?\d*)/u,o=>`${parseFloat(o)+r}`)}function Yw(t,e){const r=["@media screen"];return t&&r.push("and",`(min-width: ${eF(t)})`),e&&r.push("and",`(max-width: ${eF(e)})`),r.join(" ")}function iCe(t){var e;if(!t)return null;t.base=(e=t.base)!=null?e:"0px";const r=VX(t),o=Object.entries(t).sort(Cne).map(([d,f],g,E)=>{var T;let[,C]=(T=E[g+1])!=null?T:[];return C=parseFloat(C)>0?FX(C):void 0,{_minW:FX(f),breakpoint:d,minW:f,maxW:C,maxWQuery:Yw(null,C),minWQuery:Yw(f),minMaxQuery:Yw(f,C)}}),a=rCe(t),u=Array.from(a.values());return{keys:a,normalized:r,isResponsive(d){const f=Object.keys(d);return f.length>0&&f.every(g=>a.has(g))},asObject:CB(t),asArray:VX(t),details:o,get(d){return o.find(f=>f.breakpoint===d)},media:[null,...r.map(d=>Yw(d)).slice(1)],toArrayValue(d){if(!hh(d))throw new Error("toArrayValue: value must be an object");const f=u.map(g=>{var E;return(E=d[g])!=null?E:null});for(;tCe(f)===null;)f.pop();return f},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((f,g,E)=>{const T=u[E];return T!=null&&g!=null&&(f[T]=g),f},{})}}}var cc={hover:(t,e)=>`${t}:hover ${e}, ${t}[data-hover] ${e}`,focus:(t,e)=>`${t}:focus ${e}, ${t}[data-focus] ${e}`,focusVisible:(t,e)=>`${t}:focus-visible ${e}`,focusWithin:(t,e)=>`${t}:focus-within ${e}`,active:(t,e)=>`${t}:active ${e}, ${t}[data-active] ${e}`,disabled:(t,e)=>`${t}:disabled ${e}, ${t}[data-disabled] ${e}`,invalid:(t,e)=>`${t}:invalid ${e}, ${t}[data-invalid] ${e}`,checked:(t,e)=>`${t}:checked ${e}, ${t}[data-checked] ${e}`,placeholderShown:(t,e)=>`${t}:placeholder-shown ${e}`},cg=t=>Rne(e=>t(e,"&"),"[role=group]","[data-group]",".group"),wp=t=>Rne(e=>t(e,"~ &"),"[data-peer]",".peer"),Rne=(t,...e)=>e.map(t).join(", "),k1={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty",_expanded:"&[aria-expanded=true], &[data-expanded]",_checked:"&[aria-checked=true], &[data-checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate]",_groupHover:cg(cc.hover),_peerHover:wp(cc.hover),_groupFocus:cg(cc.focus),_peerFocus:wp(cc.focus),_groupFocusVisible:cg(cc.focusVisible),_peerFocusVisible:wp(cc.focusVisible),_groupActive:cg(cc.active),_peerActive:wp(cc.active),_groupDisabled:cg(cc.disabled),_peerDisabled:wp(cc.disabled),_groupInvalid:cg(cc.invalid),_peerInvalid:wp(cc.invalid),_groupChecked:cg(cc.checked),_peerChecked:wp(cc.checked),_groupFocusWithin:cg(cc.focusWithin),_peerFocusWithin:wp(cc.focusWithin),_peerPlaceholderShown:wp(cc.placeholderShown),_placeholder:"&::placeholder",_placeholderShown:"&:placeholder-shown",_fullScreen:"&:fullscreen",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]"},Ine=Object.keys(k1);function jX(t,e){return $n(String(t).replace(/\./g,"-"),void 0,e)}function sCe(t,e){let r={};const o={};for(const[a,u]of Object.entries(t)){const{isSemantic:d,value:f}=u,{variable:g,reference:E}=jX(a,e==null?void 0:e.cssVarPrefix);if(!d){if(a.startsWith("space")){const I=a.split("."),[D,...L]=I,B=`${D}.-${L.join(".")}`,G=U_.negate(f),se=U_.negate(E);o[B]={value:G,var:g,varRef:se}}r[g]=f,o[a]={value:f,var:g,varRef:E};continue}const T=I=>{const L=[String(a).split(".")[0],I].join(".");if(!t[L])return I;const{reference:G}=jX(L,e==null?void 0:e.cssVarPrefix);return G},C=hh(f)?f:{default:f};r=uf(r,Object.entries(C).reduce((I,[D,L])=>{var B,G;if(!L)return I;const se=T(`${L}`);if(D==="default")return I[g]=se,I;const ae=(G=(B=k1)==null?void 0:B[D])!=null?G:D;return I[ae]={[g]:se},I},{})),o[a]={value:E,var:g,varRef:E}}return{cssVars:r,cssMap:o}}function oCe(t,e=[]){const r=Object.assign({},t);for(const o of e)o in r&&delete r[o];return r}function aCe(t,e){const r={};for(const o of e)o in t&&(r[o]=t[o]);return r}function cCe(t){return typeof t=="object"&&t!=null&&!Array.isArray(t)}function BX(t,e,r={}){const{stop:o,getKey:a}=r;function u(d,f=[]){var g;if(cCe(d)||Array.isArray(d)){const E={};for(const[T,C]of Object.entries(d)){const I=(g=a==null?void 0:a(T))!=null?g:T,D=[...f,I];if(o!=null&&o(d,D))return e(d,f);E[I]=u(C,D)}return E}return e(d,f)}return u(t)}var uCe=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function lCe(t){return aCe(t,uCe)}function dCe(t){return t.semanticTokens}function hCe(t){const{__cssMap:e,__cssVars:r,__breakpoints:o,...a}=t;return a}var fCe=t=>Ine.includes(t)||t==="default";function pCe({tokens:t,semanticTokens:e}){const r={};return BX(t,(o,a)=>{o!=null&&(r[a.join(".")]={isSemantic:!1,value:o})}),BX(e,(o,a)=>{o!=null&&(r[a.join(".")]={isSemantic:!0,value:o})},{stop:o=>Object.keys(o).every(fCe)}),r}function mCe(t){var e;const r=hCe(t),o=lCe(r),a=dCe(r),u=pCe({tokens:o,semanticTokens:a}),d=(e=r.config)==null?void 0:e.cssVarPrefix,{cssMap:f,cssVars:g}=sCe(u,{cssVarPrefix:d});return Object.assign(r,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...g},__cssMap:f,__breakpoints:iCe(r.breakpoints)}),r}var RB=uf({},BP,ki,Pwe,wN,Ed,Nwe,Bwe,Dwe,bne,jwe,gC,Q2,ks,Kwe,Hwe,Wwe,zwe,Lwe,Gwe),gCe=Object.assign({},ks,Ed,wN,bne,gC),vCe=Object.keys(gCe),_Ce=[...Object.keys(RB),...Ine],yCe={...RB,...k1},ECe=t=>t in yCe,SCe=t=>e=>{if(!e.__breakpoints)return t;const{isResponsive:r,toArrayValue:o,media:a}=e.__breakpoints,u={};for(const d in t){let f=bd(t[d],e);if(f==null)continue;if(f=hh(f)&&r(f)?o(f):f,!Array.isArray(f)){u[d]=f;continue}const g=f.slice(0,a.length).length;for(let E=0;E<g;E+=1){const T=a==null?void 0:a[E];if(!T){u[d]=f[E];continue}u[T]=u[T]||{},f[E]!=null&&(u[T][d]=f[E])}}return u};function TCe(t){const e=[];let r="",o=!1;for(let a=0;a<t.length;a++){const u=t[a];u==="("?(o=!0,r+=u):u===")"?(o=!1,r+=u):u===","&&!o?(e.push(r),r=""):r+=u}return r=r.trim(),r&&e.push(r),e}function bCe(t){return/^var\(--.+\)$/.test(t)}var wCe=(t,e)=>t.startsWith("--")&&typeof e=="string"&&!bCe(e),CCe=(t,e)=>{var r,o;if(e==null)return e;const a=g=>{var E,T;return(T=(E=t.__cssMap)==null?void 0:E[g])==null?void 0:T.varRef},u=g=>{var E;return(E=a(g))!=null?E:g},[d,f]=TCe(e);return e=(o=(r=a(d))!=null?r:u(f))!=null?o:u(e),e};function RCe(t){const{configs:e={},pseudos:r={},theme:o}=t,a=(u,d=!1)=>{var f,g,E;const T=bd(u,o),C=SCe(T)(o);let I={};for(let D in C){const L=C[D];let B=bd(L,o);D in r&&(D=r[D]),wCe(D,B)&&(B=CCe(o,B));let G=e[D];if(G===!0&&(G={property:D}),hh(B)){I[D]=(f=I[D])!=null?f:{},I[D]=uf({},I[D],a(B,!0));continue}let se=(E=(g=G==null?void 0:G.transform)==null?void 0:g.call(G,B,o,T))!=null?E:B;se=G!=null&&G.processResult?a(se,!0):se;const ae=bd(G==null?void 0:G.property,o);if(!d&&(G!=null&&G.static)){const M=bd(G.static,o);I=uf({},I,M)}if(ae&&Array.isArray(ae)){for(const M of ae)I[M]=se;continue}if(ae){ae==="&"&&hh(se)?I=uf({},I,se):I[ae]=se;continue}if(hh(se)){I=uf({},I,se);continue}I[D]=se}return I};return a}var Ane=t=>e=>RCe({theme:e,pseudos:k1,configs:RB})(t);function sXe(t){return t}function oXe(t){return t}function _s(t){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:t,...e}}}}function ICe(t,e){if(Array.isArray(t))return t;if(hh(t))return e(t);if(t!=null)return[t]}function ACe(t,e){for(let r=e+1;r<t.length;r++)if(t[r]!=null)return r;return-1}function kCe(t){const e=t.__breakpoints;return function(o,a,u,d){var f,g;if(!e)return;const E={},T=ICe(u,e.toArrayValue);if(!T)return E;const C=T.length,I=C===1,D=!!o.parts;for(let L=0;L<C;L++){const B=e.details[L],G=e.details[ACe(T,L)],se=Yw(B.minW,G==null?void 0:G._minW),ae=bd((f=o[a])==null?void 0:f[T[L]],d);if(ae){if(D){(g=o.parts)==null||g.forEach(M=>{uf(E,{[M]:I?ae[M]:{[se]:ae[M]}})});continue}if(!D){I?uf(E,ae):E[se]=ae;continue}E[se]=ae}}return E}}function OCe(t){return e=>{var r;const{variant:o,size:a,theme:u}=e,d=kCe(u);return uf({},bd((r=t.baseStyle)!=null?r:{},e),d(t,"sizes",a,e),d(t,"variants",o,e))}}function PCe(t,e,r){var o,a,u;return(u=(a=(o=t.__cssMap)==null?void 0:o[`${e}.${r}`])==null?void 0:a.varRef)!=null?u:r}function eo(t){return oCe(t,["styleConfig","size","variant","colorScheme"])}var NCe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},DCe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},LCe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},xCe={property:NCe,easing:DCe,duration:LCe},MCe=xCe,UCe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},VCe=UCe,FCe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},jCe=FCe,BCe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},WCe=BCe,zCe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"},linkedin:{50:"#E8F4F9",100:"#CFEDFB",200:"#9BDAF3",300:"#68C7EC",400:"#34B3E4",500:"#00A0DC",600:"#008CC9",700:"#0077B5",800:"#005E93",900:"#004471"},facebook:{50:"#E8F4F9",100:"#D9DEE9",200:"#B7C2DA",300:"#6482C0",400:"#4267B2",500:"#385898",600:"#314E89",700:"#29487D",800:"#223B67",900:"#1E355B"},messenger:{50:"#D0E6FF",100:"#B9DAFF",200:"#A2CDFF",300:"#7AB8FF",400:"#2E90FF",500:"#0078FF",600:"#0063D1",700:"#0052AC",800:"#003C7E",900:"#002C5C"},whatsapp:{50:"#dffeec",100:"#b9f5d0",200:"#90edb3",300:"#65e495",400:"#3cdd78",500:"#22c35e",600:"#179848",700:"#0c6c33",800:"#01421c",900:"#001803"},twitter:{50:"#E5F4FD",100:"#C8E9FB",200:"#A8DCFA",300:"#83CDF7",400:"#57BBF5",500:"#1DA1F2",600:"#1A94DA",700:"#1681BF",800:"#136B9E",900:"#0D4D71"},telegram:{50:"#E3F2F9",100:"#C5E4F3",200:"#A2D4EC",300:"#7AC1E4",400:"#47A9DA",500:"#0088CC",600:"#007AB8",700:"#006BA1",800:"#005885",900:"#003F5E"}},GCe=zCe,HCe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},KCe=HCe,qCe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},$Ce=qCe,YCe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},XCe=YCe,JCe={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},kne=JCe,One={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},QCe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},ZCe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},eRe={...One,...QCe,container:ZCe},Pne=eRe,tRe={breakpoints:WCe,zIndices:VCe,radii:KCe,blur:XCe,colors:GCe,...kne,sizes:Pne,shadows:$Ce,space:One,borders:jCe,transition:MCe},{defineMultiStyleConfig:nRe,definePartsStyle:Xw}=_s(["stepper","step","title","description","indicator","separator","icon","number"]),Op=$n("stepper-indicator-size"),HS=$n("stepper-icon-size"),KS=$n("stepper-title-font-size"),Jw=$n("stepper-description-font-size"),Iw=$n("stepper-accent-color"),rRe=Xw(({colorScheme:t})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[Iw.variable]:`colors.${t}.500`,_dark:{[Iw.variable]:`colors.${t}.200`}},title:{fontSize:KS.reference,fontWeight:"medium"},description:{fontSize:Jw.reference,color:"chakra-subtle-text"},number:{fontSize:KS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:HS.reference,height:HS.reference},indicator:{flexShrink:0,borderRadius:"full",width:Op.reference,height:Op.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:Iw.reference},"&[data-status=complete]":{bg:Iw.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:Iw.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Op.reference} - 8px)`,top:`calc(${Op.reference} + 4px)`,insetStart:`calc(${Op.reference} / 2 - 1px)`}}})),iRe=nRe({baseStyle:rRe,sizes:{xs:Xw({stepper:{[Op.variable]:"sizes.4",[HS.variable]:"sizes.3",[KS.variable]:"fontSizes.xs",[Jw.variable]:"fontSizes.xs"}}),sm:Xw({stepper:{[Op.variable]:"sizes.6",[HS.variable]:"sizes.4",[KS.variable]:"fontSizes.sm",[Jw.variable]:"fontSizes.xs"}}),md:Xw({stepper:{[Op.variable]:"sizes.8",[HS.variable]:"sizes.5",[KS.variable]:"fontSizes.md",[Jw.variable]:"fontSizes.sm"}}),lg:Xw({stepper:{[Op.variable]:"sizes.10",[HS.variable]:"sizes.6",[KS.variable]:"fontSizes.lg",[Jw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}});function xi(t,e={}){let r=!1;function o(){if(!r){r=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function a(...T){o();for(const C of T)e[C]=g(C);return xi(t,e)}function u(...T){for(const C of T)C in e||(e[C]=g(C));return xi(t,e)}function d(){return Object.fromEntries(Object.entries(e).map(([C,I])=>[C,I.selector]))}function f(){return Object.fromEntries(Object.entries(e).map(([C,I])=>[C,I.className]))}function g(T){const D=`chakra-${(["container","root"].includes(T??"")?[t]:[t,T]).filter(Boolean).join("__")}`;return{className:D,selector:`.${D}`,toString:()=>T}}return{parts:a,toPart:g,extend:u,selectors:d,classnames:f,get keys(){return Object.keys(e)},__type:{}}}var sRe=xi("accordion").parts("root","container","button","panel").extend("icon"),oRe=xi("alert").parts("title","description","container").extend("icon","spinner"),aRe=xi("avatar").parts("label","badge","container").extend("excessLabel","group"),cRe=xi("breadcrumb").parts("link","item","container").extend("separator");xi("button").parts();var uRe=xi("checkbox").parts("control","icon","container").extend("label");xi("progress").parts("track","filledTrack").extend("label");var lRe=xi("drawer").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),dRe=xi("editable").parts("preview","input","textarea"),hRe=xi("form").parts("container","requiredIndicator","helperText"),fRe=xi("formError").parts("text","icon"),pRe=xi("input").parts("addon","field","element","group"),mRe=xi("list").parts("container","item","icon"),gRe=xi("menu").parts("button","list","item").extend("groupTitle","icon","command","divider"),vRe=xi("modal").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),_Re=xi("numberinput").parts("root","field","stepperGroup","stepper");xi("pininput").parts("field");var yRe=xi("popover").parts("content","header","body","footer").extend("popper","arrow","closeButton"),ERe=xi("progress").parts("label","filledTrack","track"),SRe=xi("radio").parts("container","control","label"),TRe=xi("select").parts("field","icon"),bRe=xi("slider").parts("container","track","thumb","filledTrack","mark"),wRe=xi("stat").parts("container","label","helpText","number","icon"),CRe=xi("switch").parts("container","track","thumb","label"),RRe=xi("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),IRe=xi("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),ARe=xi("tag").parts("container","label","closeButton"),kRe=xi("card").parts("container","header","body","footer");xi("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");function B_(t,e,r){return Math.min(Math.max(t,r),e)}class ORe extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var Qw=ORe;function IB(t){if(typeof t!="string")throw new Qw(t);if(t.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=t.trim();e=VRe.test(t)?DRe(t):t;const r=LRe.exec(e);if(r){const d=Array.from(r).slice(1);return[...d.slice(0,3).map(f=>parseInt(zC(f,2),16)),parseInt(zC(d[3]||"f",2),16)/255]}const o=xRe.exec(e);if(o){const d=Array.from(o).slice(1);return[...d.slice(0,3).map(f=>parseInt(f,16)),parseInt(d[3]||"ff",16)/255]}const a=MRe.exec(e);if(a){const d=Array.from(a).slice(1);return[...d.slice(0,3).map(f=>parseInt(f,10)),parseFloat(d[3]||"1")]}const u=URe.exec(e);if(u){const[d,f,g,E]=Array.from(u).slice(1).map(parseFloat);if(B_(0,100,f)!==f)throw new Qw(t);if(B_(0,100,g)!==g)throw new Qw(t);return[...FRe(d,f,g),Number.isNaN(E)?1:E]}throw new Qw(t)}function PRe(t){let e=5381,r=t.length;for(;r;)e=e*33^t.charCodeAt(--r);return(e>>>0)%2341}const WX=t=>parseInt(t.replace(/_/g,""),36),NRe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((t,e)=>{const r=WX(e.substring(0,3)),o=WX(e.substring(3)).toString(16);let a="";for(let u=0;u<6-o.length;u++)a+="0";return t[r]=`${a}${o}`,t},{});function DRe(t){const e=t.toLowerCase().trim(),r=NRe[PRe(e)];if(!r)throw new Qw(t);return`#${r}`}const zC=(t,e)=>Array.from(Array(e)).map(()=>t).join(""),LRe=new RegExp(`^#${zC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),xRe=new RegExp(`^#${zC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),MRe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${zC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),URe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,VRe=/^[a-z]+$/i,zX=t=>Math.round(t*255),FRe=(t,e,r)=>{let o=r/100;if(e===0)return[o,o,o].map(zX);const a=(t%360+360)%360/60,u=(1-Math.abs(2*o-1))*(e/100),d=u*(1-Math.abs(a%2-1));let f=0,g=0,E=0;a>=0&&a<1?(f=u,g=d):a>=1&&a<2?(f=d,g=u):a>=2&&a<3?(g=u,E=d):a>=3&&a<4?(g=d,E=u):a>=4&&a<5?(f=d,E=u):a>=5&&a<6&&(f=u,E=d);const T=o-u/2,C=f+T,I=g+T,D=E+T;return[C,I,D].map(zX)};function jRe(t,e,r,o){return`rgba(${B_(0,255,t).toFixed()}, ${B_(0,255,e).toFixed()}, ${B_(0,255,r).toFixed()}, ${parseFloat(B_(0,1,o).toFixed(3))})`}function BRe(t,e){const[r,o,a,u]=IB(t);return jRe(r,o,a,u-e)}function WRe(t){const[e,r,o,a]=IB(t);let u=d=>{const f=B_(0,255,d).toString(16);return f.length===1?`0${f}`:f};return`#${u(e)}${u(r)}${u(o)}${a<1?u(Math.round(a*255)):""}`}function zRe(t,e,r,o,a){for(e=e.split?e.split("."):e,o=0;o<e.length;o++)t=t?t[e[o]]:a;return t===a?r:t}var GRe=t=>Object.keys(t).length===0,mu=(t,e,r)=>{const o=zRe(t,`colors.${e}`,e);try{return WRe(o),o}catch{return r??"#000000"}},HRe=t=>{const[e,r,o]=IB(t);return(e*299+r*587+o*114)/1e3},KRe=t=>e=>{const r=mu(e,t);return HRe(r)<128?"dark":"light"},qRe=t=>e=>KRe(t)(e)==="dark",TT=(t,e)=>r=>{const o=mu(r,t);return BRe(o,1-e)};function GX(t="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${t} ${t}`}}var $Re=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function YRe(t){const e=$Re();return!t||GRe(t)?e:t.string&&t.colors?JRe(t.string,t.colors):t.string&&!t.colors?XRe(t.string):t.colors&&!t.string?QRe(t.colors):e}function XRe(t){let e=0;if(t.length===0)return e.toString();for(let o=0;o<t.length;o+=1)e=t.charCodeAt(o)+((e<<5)-e),e=e&e;let r="#";for(let o=0;o<3;o+=1){const a=e>>o*8&255;r+=`00${a.toString(16)}`.substr(-2)}return r}function JRe(t,e){let r=0;if(t.length===0)return e[0];for(let o=0;o<t.length;o+=1)r=t.charCodeAt(o)+((r<<5)-r),r=r&r;return r=(r%e.length+e.length)%e.length,e[r]}function QRe(t){return t[Math.floor(Math.random()*t.length)]}function Kn(t,e){return r=>r.colorMode==="dark"?e:t}function AB(t){const{orientation:e,vertical:r,horizontal:o}=t;return e?e==="vertical"?r:o:{}}function Nne(t){return hh(t)&&t.reference?t.reference:String(t)}var O1=(t,...e)=>e.map(Nne).join(` ${t} `).replace(/calc/g,""),HX=(...t)=>`calc(${O1("+",...t)})`,KX=(...t)=>`calc(${O1("-",...t)})`,tF=(...t)=>`calc(${O1("*",...t)})`,qX=(...t)=>`calc(${O1("/",...t)})`,$X=t=>{const e=Nne(t);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:tF(e,-1)},Pp=Object.assign(t=>({add:(...e)=>Pp(HX(t,...e)),subtract:(...e)=>Pp(KX(t,...e)),multiply:(...e)=>Pp(tF(t,...e)),divide:(...e)=>Pp(qX(t,...e)),negate:()=>Pp($X(t)),toString:()=>t.toString()}),{add:HX,subtract:KX,multiply:tF,divide:qX,negate:$X});function ZRe(t){return!Number.isInteger(parseFloat(t.toString()))}function eIe(t,e="-"){return t.replace(/\s+/g,e)}function Dne(t){const e=eIe(t.toString());return e.includes("\\.")?t:ZRe(t)?e.replace(".","\\."):t}function tIe(t,e=""){return[e,Dne(t)].filter(Boolean).join("-")}function nIe(t,e){return`var(${Dne(t)}${e?`, ${e}`:""})`}function rIe(t,e=""){return`--${tIe(t,e)}`}function Ta(t,e){const r=rIe(t,void 0);return{variable:r,reference:nIe(r,iIe(void 0))}}function iIe(t){return t==null?void 0:t.reference}var{defineMultiStyleConfig:sIe,definePartsStyle:WP}=_s(CRe.keys),vC=Ta("switch-track-width"),K_=Ta("switch-track-height"),pV=Ta("switch-track-diff"),oIe=Pp.subtract(vC,K_),nF=Ta("switch-thumb-x"),Aw=Ta("switch-bg"),aIe=t=>{const{colorScheme:e}=t;return{borderRadius:"full",p:"0.5",width:[vC.reference],height:[K_.reference],transitionProperty:"common",transitionDuration:"fast",[Aw.variable]:"colors.gray.300",_dark:{[Aw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[Aw.variable]:`colors.${e}.500`,_dark:{[Aw.variable]:`colors.${e}.200`}},bg:Aw.reference}},cIe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[K_.reference],height:[K_.reference],_checked:{transform:`translateX(${nF.reference})`}},uIe=WP(t=>({container:{[pV.variable]:oIe,[nF.variable]:pV.reference,_rtl:{[nF.variable]:Pp(pV).negate().toString()}},track:aIe(t),thumb:cIe})),lIe={sm:WP({container:{[vC.variable]:"1.375rem",[K_.variable]:"sizes.3"}}),md:WP({container:{[vC.variable]:"1.875rem",[K_.variable]:"sizes.4"}}),lg:WP({container:{[vC.variable]:"2.875rem",[K_.variable]:"sizes.6"}})},dIe=sIe({baseStyle:uIe,sizes:lIe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:hIe,definePartsStyle:oT}=_s(RRe.keys),fIe=oT({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),CN={"&[data-is-numeric=true]":{textAlign:"end"}},pIe=oT(t=>{const{colorScheme:e}=t;return{th:{color:Kn("gray.600","gray.400")(t),borderBottom:"1px",borderColor:Kn(`${e}.100`,`${e}.700`)(t),...CN},td:{borderBottom:"1px",borderColor:Kn(`${e}.100`,`${e}.700`)(t),...CN},caption:{color:Kn("gray.600","gray.100")(t)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),mIe=oT(t=>{const{colorScheme:e}=t;return{th:{color:Kn("gray.600","gray.400")(t),borderBottom:"1px",borderColor:Kn(`${e}.100`,`${e}.700`)(t),...CN},td:{borderBottom:"1px",borderColor:Kn(`${e}.100`,`${e}.700`)(t),...CN},caption:{color:Kn("gray.600","gray.100")(t)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Kn(`${e}.100`,`${e}.700`)(t)},td:{background:Kn(`${e}.100`,`${e}.700`)(t)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),gIe={simple:pIe,striped:mIe,unstyled:{}},vIe={sm:oT({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:oT({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:oT({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},_Ie=hIe({baseStyle:fIe,variants:gIe,sizes:vIe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Zu=$n("tabs-color"),lh=$n("tabs-bg"),oP=$n("tabs-border-color"),{defineMultiStyleConfig:yIe,definePartsStyle:pf}=_s(IRe.keys),EIe=t=>{const{orientation:e}=t;return{display:e==="vertical"?"flex":"block"}},SIe=t=>{const{isFitted:e}=t;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},TIe=t=>{const{align:e="start",orientation:r}=t;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:r==="vertical"?"column":"row"}},bIe={p:4},wIe=pf(t=>({root:EIe(t),tab:SIe(t),tablist:TIe(t),tabpanel:bIe})),CIe={sm:pf({tab:{py:1,px:4,fontSize:"sm"}}),md:pf({tab:{fontSize:"md",py:2,px:4}}),lg:pf({tab:{fontSize:"lg",py:3,px:4}})},RIe=pf(t=>{const{colorScheme:e,orientation:r}=t,o=r==="vertical",a=o?"borderStart":"borderBottom",u=o?"marginStart":"marginBottom";return{tablist:{[a]:"2px solid",borderColor:"inherit"},tab:{[a]:"2px solid",borderColor:"transparent",[u]:"-2px",_selected:{[Zu.variable]:`colors.${e}.600`,_dark:{[Zu.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[lh.variable]:"colors.gray.200",_dark:{[lh.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Zu.reference,bg:lh.reference}}}),IIe=pf(t=>{const{colorScheme:e}=t;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[oP.variable]:"transparent",_selected:{[Zu.variable]:`colors.${e}.600`,[oP.variable]:"colors.white",_dark:{[Zu.variable]:`colors.${e}.300`,[oP.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:oP.reference},color:Zu.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),AIe=pf(t=>{const{colorScheme:e}=t;return{tab:{border:"1px solid",borderColor:"inherit",[lh.variable]:"colors.gray.50",_dark:{[lh.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[lh.variable]:"colors.white",[Zu.variable]:`colors.${e}.600`,_dark:{[lh.variable]:"colors.gray.800",[Zu.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Zu.reference,bg:lh.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),kIe=pf(t=>{const{colorScheme:e,theme:r}=t;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:mu(r,`${e}.700`),bg:mu(r,`${e}.100`)}}}}),OIe=pf(t=>{const{colorScheme:e}=t;return{tab:{borderRadius:"full",fontWeight:"semibold",[Zu.variable]:"colors.gray.600",_dark:{[Zu.variable]:"inherit"},_selected:{[Zu.variable]:"colors.white",[lh.variable]:`colors.${e}.600`,_dark:{[Zu.variable]:"colors.gray.800",[lh.variable]:`colors.${e}.300`}},color:Zu.reference,bg:lh.reference}}}),PIe=pf({}),NIe={line:RIe,enclosed:IIe,"enclosed-colored":AIe,"soft-rounded":kIe,"solid-rounded":OIe,unstyled:PIe},DIe=yIe({baseStyle:wIe,sizes:CIe,variants:NIe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),No=eCe("badge",["bg","color","shadow"]),LIe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:No.bg.reference,color:No.color.reference,boxShadow:No.shadow.reference},xIe=t=>{const{colorScheme:e,theme:r}=t,o=TT(`${e}.500`,.6)(r);return{[No.bg.variable]:`colors.${e}.500`,[No.color.variable]:"colors.white",_dark:{[No.bg.variable]:o,[No.color.variable]:"colors.whiteAlpha.800"}}},MIe=t=>{const{colorScheme:e,theme:r}=t,o=TT(`${e}.200`,.16)(r);return{[No.bg.variable]:`colors.${e}.100`,[No.color.variable]:`colors.${e}.800`,_dark:{[No.bg.variable]:o,[No.color.variable]:`colors.${e}.200`}}},UIe=t=>{const{colorScheme:e,theme:r}=t,o=TT(`${e}.200`,.8)(r);return{[No.color.variable]:`colors.${e}.500`,_dark:{[No.color.variable]:o},[No.shadow.variable]:`inset 0 0 0px 1px ${No.color.reference}`}},VIe={solid:xIe,subtle:MIe,outline:UIe},_C={baseStyle:LIe,variants:VIe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:FIe,definePartsStyle:q_}=_s(ARe.keys),YX=$n("tag-bg"),XX=$n("tag-color"),mV=$n("tag-shadow"),zP=$n("tag-min-height"),GP=$n("tag-min-width"),HP=$n("tag-font-size"),KP=$n("tag-padding-inline"),jIe={fontWeight:"medium",lineHeight:1.2,outline:0,[XX.variable]:No.color.reference,[YX.variable]:No.bg.reference,[mV.variable]:No.shadow.reference,color:XX.reference,bg:YX.reference,boxShadow:mV.reference,borderRadius:"md",minH:zP.reference,minW:GP.reference,fontSize:HP.reference,px:KP.reference,_focusVisible:{[mV.variable]:"shadows.outline"}},BIe={lineHeight:1.2,overflow:"visible"},WIe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},zIe=q_({container:jIe,label:BIe,closeButton:WIe}),GIe={sm:q_({container:{[zP.variable]:"sizes.5",[GP.variable]:"sizes.5",[HP.variable]:"fontSizes.xs",[KP.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:q_({container:{[zP.variable]:"sizes.6",[GP.variable]:"sizes.6",[HP.variable]:"fontSizes.sm",[KP.variable]:"space.2"}}),lg:q_({container:{[zP.variable]:"sizes.8",[GP.variable]:"sizes.8",[HP.variable]:"fontSizes.md",[KP.variable]:"space.3"}})},HIe={subtle:q_(t=>{var e;return{container:(e=_C.variants)==null?void 0:e.subtle(t)}}),solid:q_(t=>{var e;return{container:(e=_C.variants)==null?void 0:e.solid(t)}}),outline:q_(t=>{var e;return{container:(e=_C.variants)==null?void 0:e.outline(t)}})},KIe=FIe({variants:HIe,baseStyle:zIe,sizes:GIe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}}),{definePartsStyle:Np,defineMultiStyleConfig:qIe}=_s(pRe.keys),qS=$n("input-height"),$S=$n("input-font-size"),YS=$n("input-padding"),XS=$n("input-border-radius"),$Ie=Np({addon:{height:qS.reference,fontSize:$S.reference,px:YS.reference,borderRadius:XS.reference},field:{width:"100%",height:qS.reference,fontSize:$S.reference,px:YS.reference,borderRadius:XS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),ug={lg:{[$S.variable]:"fontSizes.lg",[YS.variable]:"space.4",[XS.variable]:"radii.md",[qS.variable]:"sizes.12"},md:{[$S.variable]:"fontSizes.md",[YS.variable]:"space.4",[XS.variable]:"radii.md",[qS.variable]:"sizes.10"},sm:{[$S.variable]:"fontSizes.sm",[YS.variable]:"space.3",[XS.variable]:"radii.sm",[qS.variable]:"sizes.8"},xs:{[$S.variable]:"fontSizes.xs",[YS.variable]:"space.2",[XS.variable]:"radii.sm",[qS.variable]:"sizes.6"}},YIe={lg:Np({field:ug.lg,group:ug.lg}),md:Np({field:ug.md,group:ug.md}),sm:Np({field:ug.sm,group:ug.sm}),xs:Np({field:ug.xs,group:ug.xs})};function kB(t){const{focusBorderColor:e,errorBorderColor:r}=t;return{focusBorderColor:e||Kn("blue.500","blue.300")(t),errorBorderColor:r||Kn("red.500","red.300")(t)}}var XIe=Np(t=>{const{theme:e}=t,{focusBorderColor:r,errorBorderColor:o}=kB(t);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Kn("gray.300","whiteAlpha.400")(t)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:mu(e,o),boxShadow:`0 0 0 1px ${mu(e,o)}`},_focusVisible:{zIndex:1,borderColor:mu(e,r),boxShadow:`0 0 0 1px ${mu(e,r)}`}},addon:{border:"1px solid",borderColor:Kn("inherit","whiteAlpha.50")(t),bg:Kn("gray.100","whiteAlpha.300")(t)}}}),JIe=Np(t=>{const{theme:e}=t,{focusBorderColor:r,errorBorderColor:o}=kB(t);return{field:{border:"2px solid",borderColor:"transparent",bg:Kn("gray.100","whiteAlpha.50")(t),_hover:{bg:Kn("gray.200","whiteAlpha.100")(t)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:mu(e,o)},_focusVisible:{bg:"transparent",borderColor:mu(e,r)}},addon:{border:"2px solid",borderColor:"transparent",bg:Kn("gray.100","whiteAlpha.50")(t)}}}),QIe=Np(t=>{const{theme:e}=t,{focusBorderColor:r,errorBorderColor:o}=kB(t);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:mu(e,o),boxShadow:`0px 1px 0px 0px ${mu(e,o)}`},_focusVisible:{borderColor:mu(e,r),boxShadow:`0px 1px 0px 0px ${mu(e,r)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),ZIe=Np({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),eAe={outline:XIe,filled:JIe,flushed:QIe,unstyled:ZIe},Li=qIe({baseStyle:$Ie,sizes:YIe,variants:eAe,defaultProps:{size:"md",variant:"outline"}}),JX,tAe={...(JX=Li.baseStyle)==null?void 0:JX.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"},QX,ZX,nAe={outline:t=>{var e,r;return(r=(e=Li.variants)==null?void 0:e.outline(t).field)!=null?r:{}},flushed:t=>{var e,r;return(r=(e=Li.variants)==null?void 0:e.flushed(t).field)!=null?r:{}},filled:t=>{var e,r;return(r=(e=Li.variants)==null?void 0:e.filled(t).field)!=null?r:{}},unstyled:(ZX=(QX=Li.variants)==null?void 0:QX.unstyled.field)!=null?ZX:{}},eJ,tJ,nJ,rJ,iJ,sJ,oJ,aJ,rAe={xs:(tJ=(eJ=Li.sizes)==null?void 0:eJ.xs.field)!=null?tJ:{},sm:(rJ=(nJ=Li.sizes)==null?void 0:nJ.sm.field)!=null?rJ:{},md:(sJ=(iJ=Li.sizes)==null?void 0:iJ.md.field)!=null?sJ:{},lg:(aJ=(oJ=Li.sizes)==null?void 0:oJ.lg.field)!=null?aJ:{}},iAe={baseStyle:tAe,sizes:rAe,variants:nAe,defaultProps:{size:"md",variant:"outline"}},aP=Ta("tooltip-bg"),gV=Ta("tooltip-fg"),sAe=Ta("popper-arrow-bg"),oAe={bg:aP.reference,color:gV.reference,[aP.variable]:"colors.gray.700",[gV.variable]:"colors.whiteAlpha.900",_dark:{[aP.variable]:"colors.gray.300",[gV.variable]:"colors.gray.900"},[sAe.variable]:aP.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},aAe={baseStyle:oAe},{defineMultiStyleConfig:cAe,definePartsStyle:Zw}=_s(ERe.keys),uAe=t=>{const{colorScheme:e,theme:r,isIndeterminate:o,hasStripe:a}=t,u=Kn(GX(),GX("1rem","rgba(0,0,0,0.1)"))(t),d=Kn(`${e}.500`,`${e}.200`)(t),f=`linear-gradient(
    to right,
    transparent 0%,
    ${mu(r,d)} 50%,
    transparent 100%
  )`;return{...!o&&a&&u,...o?{bgImage:f}:{bgColor:d}}},lAe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},dAe=t=>({bg:Kn("gray.100","whiteAlpha.300")(t)}),hAe=t=>({transitionProperty:"common",transitionDuration:"slow",...uAe(t)}),fAe=Zw(t=>({label:lAe,filledTrack:hAe(t),track:dAe(t)})),pAe={xs:Zw({track:{h:"1"}}),sm:Zw({track:{h:"2"}}),md:Zw({track:{h:"3"}}),lg:Zw({track:{h:"4"}})},mAe=cAe({sizes:pAe,baseStyle:fAe,defaultProps:{size:"md",colorScheme:"blue"}}),gAe=t=>typeof t=="function";function gu(t,...e){return gAe(t)?t(...e):t}var{definePartsStyle:qP,defineMultiStyleConfig:vAe}=_s(uRe.keys),yC=$n("checkbox-size"),_Ae=t=>{const{colorScheme:e}=t;return{w:yC.reference,h:yC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Kn(`${e}.500`,`${e}.200`)(t),borderColor:Kn(`${e}.500`,`${e}.200`)(t),color:Kn("white","gray.900")(t),_hover:{bg:Kn(`${e}.600`,`${e}.300`)(t),borderColor:Kn(`${e}.600`,`${e}.300`)(t)},_disabled:{borderColor:Kn("gray.200","transparent")(t),bg:Kn("gray.200","whiteAlpha.300")(t),color:Kn("gray.500","whiteAlpha.500")(t)}},_indeterminate:{bg:Kn(`${e}.500`,`${e}.200`)(t),borderColor:Kn(`${e}.500`,`${e}.200`)(t),color:Kn("white","gray.900")(t)},_disabled:{bg:Kn("gray.100","whiteAlpha.100")(t),borderColor:Kn("gray.100","transparent")(t)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Kn("red.500","red.300")(t)}}},yAe={_disabled:{cursor:"not-allowed"}},EAe={userSelect:"none",_disabled:{opacity:.4}},SAe={transitionProperty:"transform",transitionDuration:"normal"},TAe=qP(t=>({icon:SAe,container:yAe,control:gu(_Ae,t),label:EAe})),bAe={sm:qP({control:{[yC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:qP({control:{[yC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:qP({control:{[yC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},RN=vAe({baseStyle:TAe,sizes:bAe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:wAe,definePartsStyle:$P}=_s(SRe.keys),CAe=t=>{var e;const r=(e=gu(RN.baseStyle,t))==null?void 0:e.control;return{...r,borderRadius:"full",_checked:{...r==null?void 0:r._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},RAe=$P(t=>{var e,r,o,a;return{label:(r=(e=RN).baseStyle)==null?void 0:r.call(e,t).label,container:(a=(o=RN).baseStyle)==null?void 0:a.call(o,t).container,control:CAe(t)}}),IAe={md:$P({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:$P({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:$P({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},AAe=wAe({baseStyle:RAe,sizes:IAe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:kAe,definePartsStyle:OAe}=_s(TRe.keys),cP=$n("select-bg"),cJ,PAe={...(cJ=Li.baseStyle)==null?void 0:cJ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:cP.reference,[cP.variable]:"colors.white",_dark:{[cP.variable]:"colors.gray.700"},"> option, > optgroup":{bg:cP.reference}},NAe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},DAe=OAe({field:PAe,icon:NAe}),uP={paddingInlineEnd:"8"},uJ,lJ,dJ,hJ,fJ,pJ,mJ,gJ,LAe={lg:{...(uJ=Li.sizes)==null?void 0:uJ.lg,field:{...(lJ=Li.sizes)==null?void 0:lJ.lg.field,...uP}},md:{...(dJ=Li.sizes)==null?void 0:dJ.md,field:{...(hJ=Li.sizes)==null?void 0:hJ.md.field,...uP}},sm:{...(fJ=Li.sizes)==null?void 0:fJ.sm,field:{...(pJ=Li.sizes)==null?void 0:pJ.sm.field,...uP}},xs:{...(mJ=Li.sizes)==null?void 0:mJ.xs,field:{...(gJ=Li.sizes)==null?void 0:gJ.xs.field,...uP},icon:{insetEnd:"1"}}},xAe=kAe({baseStyle:DAe,sizes:LAe,variants:Li.variants,defaultProps:Li.defaultProps}),vV=$n("skeleton-start-color"),_V=$n("skeleton-end-color"),MAe={[vV.variable]:"colors.gray.100",[_V.variable]:"colors.gray.400",_dark:{[vV.variable]:"colors.gray.800",[_V.variable]:"colors.gray.600"},background:vV.reference,borderColor:_V.reference,opacity:.7,borderRadius:"sm"},UAe={baseStyle:MAe},yV=$n("skip-link-bg"),VAe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[yV.variable]:"colors.white",_dark:{[yV.variable]:"colors.gray.700"},bg:yV.reference}},FAe={baseStyle:VAe},{defineMultiStyleConfig:jAe,definePartsStyle:P1}=_s(bRe.keys),GC=$n("slider-thumb-size"),HC=$n("slider-track-size"),vg=$n("slider-bg"),BAe=t=>{const{orientation:e}=t;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...AB({orientation:e,vertical:{h:"100%"},horizontal:{w:"100%"}})}},WAe=t=>({...AB({orientation:t.orientation,horizontal:{h:HC.reference},vertical:{w:HC.reference}}),overflow:"hidden",borderRadius:"sm",[vg.variable]:"colors.gray.200",_dark:{[vg.variable]:"colors.whiteAlpha.200"},_disabled:{[vg.variable]:"colors.gray.300",_dark:{[vg.variable]:"colors.whiteAlpha.300"}},bg:vg.reference}),zAe=t=>{const{orientation:e}=t;return{...AB({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:GC.reference,h:GC.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},GAe=t=>{const{colorScheme:e}=t;return{width:"inherit",height:"inherit",[vg.variable]:`colors.${e}.500`,_dark:{[vg.variable]:`colors.${e}.200`},bg:vg.reference}},HAe=P1(t=>({container:BAe(t),track:WAe(t),thumb:zAe(t),filledTrack:GAe(t)})),KAe=P1({container:{[GC.variable]:"sizes.4",[HC.variable]:"sizes.1"}}),qAe=P1({container:{[GC.variable]:"sizes.3.5",[HC.variable]:"sizes.1"}}),$Ae=P1({container:{[GC.variable]:"sizes.2.5",[HC.variable]:"sizes.0.5"}}),YAe={lg:KAe,md:qAe,sm:$Ae},XAe=jAe({baseStyle:HAe,sizes:YAe,defaultProps:{size:"md",colorScheme:"blue"}}),V_=Ta("spinner-size"),JAe={width:[V_.reference],height:[V_.reference]},QAe={xs:{[V_.variable]:"sizes.3"},sm:{[V_.variable]:"sizes.4"},md:{[V_.variable]:"sizes.6"},lg:{[V_.variable]:"sizes.8"},xl:{[V_.variable]:"sizes.12"}},ZAe={baseStyle:JAe,sizes:QAe,defaultProps:{size:"md"}},{defineMultiStyleConfig:eke,definePartsStyle:Lne}=_s(wRe.keys),tke={fontWeight:"medium"},nke={opacity:.8,marginBottom:"2"},rke={verticalAlign:"baseline",fontWeight:"semibold"},ike={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},ske=Lne({container:{},label:tke,helpText:nke,number:rke,icon:ike}),oke={md:Lne({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},ake=eke({baseStyle:ske,sizes:oke,defaultProps:{size:"md"}}),EV=$n("kbd-bg"),cke={[EV.variable]:"colors.gray.100",_dark:{[EV.variable]:"colors.whiteAlpha.100"},bg:EV.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},uke={baseStyle:cke},lke={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},dke={baseStyle:lke},{defineMultiStyleConfig:hke,definePartsStyle:fke}=_s(mRe.keys),pke={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},mke=fke({icon:pke}),gke=hke({baseStyle:mke}),{defineMultiStyleConfig:vke,definePartsStyle:_ke}=_s(gRe.keys),rf=$n("menu-bg"),SV=$n("menu-shadow"),yke={[rf.variable]:"#fff",[SV.variable]:"shadows.sm",_dark:{[rf.variable]:"colors.gray.700",[SV.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:1,borderRadius:"md",borderWidth:"1px",bg:rf.reference,boxShadow:SV.reference},Eke={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[rf.variable]:"colors.gray.100",_dark:{[rf.variable]:"colors.whiteAlpha.100"}},_active:{[rf.variable]:"colors.gray.200",_dark:{[rf.variable]:"colors.whiteAlpha.200"}},_expanded:{[rf.variable]:"colors.gray.100",_dark:{[rf.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:rf.reference},Ske={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},Tke={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},bke={opacity:.6},wke={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},Cke={transitionProperty:"common",transitionDuration:"normal"},Rke=_ke({button:Cke,list:yke,item:Eke,groupTitle:Ske,icon:Tke,command:bke,divider:wke}),Ike=vke({baseStyle:Rke}),{defineMultiStyleConfig:Ake,definePartsStyle:rF}=_s(vRe.keys),TV=$n("modal-bg"),bV=$n("modal-shadow"),kke={bg:"blackAlpha.600",zIndex:"modal"},Oke=t=>{const{isCentered:e,scrollBehavior:r}=t;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:r==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},Pke=t=>{const{isCentered:e,scrollBehavior:r}=t;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:r==="inside"?"calc(100% - 7.5rem)":void 0,[TV.variable]:"colors.white",[bV.variable]:"shadows.lg",_dark:{[TV.variable]:"colors.gray.700",[bV.variable]:"shadows.dark-lg"},bg:TV.reference,boxShadow:bV.reference}},Nke={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Dke={position:"absolute",top:"2",insetEnd:"3"},Lke=t=>{const{scrollBehavior:e}=t;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},xke={px:"6",py:"4"},Mke=rF(t=>({overlay:kke,dialogContainer:gu(Oke,t),dialog:gu(Pke,t),header:Nke,closeButton:Dke,body:gu(Lke,t),footer:xke}));function ah(t){return rF(t==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:t}})}var Uke={xs:ah("xs"),sm:ah("sm"),md:ah("md"),lg:ah("lg"),xl:ah("xl"),"2xl":ah("2xl"),"3xl":ah("3xl"),"4xl":ah("4xl"),"5xl":ah("5xl"),"6xl":ah("6xl"),full:ah("full")},Vke=Ake({baseStyle:Mke,sizes:Uke,defaultProps:{size:"md"}}),{defineMultiStyleConfig:Fke,definePartsStyle:xne}=_s(_Re.keys),OB=Ta("number-input-stepper-width"),Mne=Ta("number-input-input-padding"),jke=Pp(OB).add("0.5rem").toString(),wV=Ta("number-input-bg"),CV=Ta("number-input-color"),RV=Ta("number-input-border-color"),Bke={[OB.variable]:"sizes.6",[Mne.variable]:jke},Wke=t=>{var e,r;return(r=(e=gu(Li.baseStyle,t))==null?void 0:e.field)!=null?r:{}},zke={width:OB.reference},Gke={borderStart:"1px solid",borderStartColor:RV.reference,color:CV.reference,bg:wV.reference,[CV.variable]:"colors.chakra-body-text",[RV.variable]:"colors.chakra-border-color",_dark:{[CV.variable]:"colors.whiteAlpha.800",[RV.variable]:"colors.whiteAlpha.300"},_active:{[wV.variable]:"colors.gray.200",_dark:{[wV.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},Hke=xne(t=>{var e;return{root:Bke,field:(e=gu(Wke,t))!=null?e:{},stepperGroup:zke,stepper:Gke}});function lP(t){var e,r,o;const a=(e=Li.sizes)==null?void 0:e[t],u={lg:"md",md:"md",sm:"sm",xs:"sm"},d=(o=(r=a.field)==null?void 0:r.fontSize)!=null?o:"md",f=kne.fontSizes[d];return xne({field:{...a.field,paddingInlineEnd:Mne.reference,verticalAlign:"top"},stepper:{fontSize:Pp(f).multiply(.75).toString(),_first:{borderTopEndRadius:u[t]},_last:{borderBottomEndRadius:u[t],mt:"-1px",borderTopWidth:1}}})}var Kke={xs:lP("xs"),sm:lP("sm"),md:lP("md"),lg:lP("lg")},qke=Fke({baseStyle:Hke,sizes:Kke,variants:Li.variants,defaultProps:Li.defaultProps}),vJ,$ke={...(vJ=Li.baseStyle)==null?void 0:vJ.field,textAlign:"center"},Yke={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}},_J,yJ,Xke={outline:t=>{var e,r,o;return(o=(r=gu((e=Li.variants)==null?void 0:e.outline,t))==null?void 0:r.field)!=null?o:{}},flushed:t=>{var e,r,o;return(o=(r=gu((e=Li.variants)==null?void 0:e.flushed,t))==null?void 0:r.field)!=null?o:{}},filled:t=>{var e,r,o;return(o=(r=gu((e=Li.variants)==null?void 0:e.filled,t))==null?void 0:r.field)!=null?o:{}},unstyled:(yJ=(_J=Li.variants)==null?void 0:_J.unstyled.field)!=null?yJ:{}},Jke={baseStyle:$ke,sizes:Yke,variants:Xke,defaultProps:Li.defaultProps},{defineMultiStyleConfig:Qke,definePartsStyle:Zke}=_s(yRe.keys),dP=Ta("popper-bg"),eOe=Ta("popper-arrow-bg"),EJ=Ta("popper-arrow-shadow-color"),tOe={zIndex:10},nOe={[dP.variable]:"colors.white",bg:dP.reference,[eOe.variable]:dP.reference,[EJ.variable]:"colors.gray.200",_dark:{[dP.variable]:"colors.gray.700",[EJ.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},rOe={px:3,py:2,borderBottomWidth:"1px"},iOe={px:3,py:2},sOe={px:3,py:2,borderTopWidth:"1px"},oOe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},aOe=Zke({popper:tOe,content:nOe,header:rOe,body:iOe,footer:sOe,closeButton:oOe}),cOe=Qke({baseStyle:aOe}),{definePartsStyle:iF,defineMultiStyleConfig:uOe}=_s(lRe.keys),IV=$n("drawer-bg"),AV=$n("drawer-box-shadow");function kS(t){return iF(t==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:t}})}var lOe={bg:"blackAlpha.600",zIndex:"modal"},dOe={display:"flex",zIndex:"modal",justifyContent:"center"},hOe=t=>{const{isFullHeight:e}=t;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[IV.variable]:"colors.white",[AV.variable]:"shadows.lg",_dark:{[IV.variable]:"colors.gray.700",[AV.variable]:"shadows.dark-lg"},bg:IV.reference,boxShadow:AV.reference}},fOe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},pOe={position:"absolute",top:"2",insetEnd:"3"},mOe={px:"6",py:"2",flex:"1",overflow:"auto"},gOe={px:"6",py:"4"},vOe=iF(t=>({overlay:lOe,dialogContainer:dOe,dialog:gu(hOe,t),header:fOe,closeButton:pOe,body:mOe,footer:gOe})),_Oe={xs:kS("xs"),sm:kS("md"),md:kS("lg"),lg:kS("2xl"),xl:kS("4xl"),full:kS("full")},yOe=uOe({baseStyle:vOe,sizes:_Oe,defaultProps:{size:"xs"}}),{definePartsStyle:EOe,defineMultiStyleConfig:SOe}=_s(dRe.keys),TOe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},bOe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},wOe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},COe=EOe({preview:TOe,input:bOe,textarea:wOe}),ROe=SOe({baseStyle:COe}),{definePartsStyle:IOe,defineMultiStyleConfig:AOe}=_s(hRe.keys),aT=$n("form-control-color"),kOe={marginStart:"1",[aT.variable]:"colors.red.500",_dark:{[aT.variable]:"colors.red.300"},color:aT.reference},OOe={mt:"2",[aT.variable]:"colors.gray.600",_dark:{[aT.variable]:"colors.whiteAlpha.600"},color:aT.reference,lineHeight:"normal",fontSize:"sm"},POe=IOe({container:{width:"100%",position:"relative"},requiredIndicator:kOe,helperText:OOe}),NOe=AOe({baseStyle:POe}),{definePartsStyle:DOe,defineMultiStyleConfig:LOe}=_s(fRe.keys),cT=$n("form-error-color"),xOe={[cT.variable]:"colors.red.500",_dark:{[cT.variable]:"colors.red.300"},color:cT.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},MOe={marginEnd:"0.5em",[cT.variable]:"colors.red.500",_dark:{[cT.variable]:"colors.red.300"},color:cT.reference},UOe=DOe({text:xOe,icon:MOe}),VOe=LOe({baseStyle:UOe}),FOe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},jOe={baseStyle:FOe},BOe={fontFamily:"heading",fontWeight:"bold"},WOe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},zOe={baseStyle:BOe,sizes:WOe,defaultProps:{size:"xl"}},{defineMultiStyleConfig:GOe,definePartsStyle:HOe}=_s(cRe.keys),kV=$n("breadcrumb-link-decor"),KOe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:kV.reference,[kV.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[kV.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},qOe=HOe({link:KOe}),$Oe=GOe({baseStyle:qOe}),YOe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},Une=t=>{const{colorScheme:e,theme:r}=t;if(e==="gray")return{color:Kn("gray.800","whiteAlpha.900")(t),_hover:{bg:Kn("gray.100","whiteAlpha.200")(t)},_active:{bg:Kn("gray.200","whiteAlpha.300")(t)}};const o=TT(`${e}.200`,.12)(r),a=TT(`${e}.200`,.24)(r);return{color:Kn(`${e}.600`,`${e}.200`)(t),bg:"transparent",_hover:{bg:Kn(`${e}.50`,o)(t)},_active:{bg:Kn(`${e}.100`,a)(t)}}},XOe=t=>{const{colorScheme:e}=t,r=Kn("gray.200","whiteAlpha.300")(t);return{border:"1px solid",borderColor:e==="gray"?r:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...gu(Une,t)}},JOe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},QOe=t=>{var e;const{colorScheme:r}=t;if(r==="gray"){const g=Kn("gray.100","whiteAlpha.200")(t);return{bg:g,color:Kn("gray.800","whiteAlpha.900")(t),_hover:{bg:Kn("gray.200","whiteAlpha.300")(t),_disabled:{bg:g}},_active:{bg:Kn("gray.300","whiteAlpha.400")(t)}}}const{bg:o=`${r}.500`,color:a="white",hoverBg:u=`${r}.600`,activeBg:d=`${r}.700`}=(e=JOe[r])!=null?e:{},f=Kn(o,`${r}.200`)(t);return{bg:f,color:Kn(a,"gray.800")(t),_hover:{bg:Kn(u,`${r}.300`)(t),_disabled:{bg:f}},_active:{bg:Kn(d,`${r}.400`)(t)}}},ZOe=t=>{const{colorScheme:e}=t;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Kn(`${e}.500`,`${e}.200`)(t),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Kn(`${e}.700`,`${e}.500`)(t)}}},ePe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},tPe={ghost:Une,outline:XOe,solid:QOe,link:ZOe,unstyled:ePe},nPe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},rPe={baseStyle:YOe,variants:tPe,sizes:nPe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:$_,defineMultiStyleConfig:iPe}=_s(kRe.keys),IN=$n("card-bg"),Fp=$n("card-padding"),Vne=$n("card-shadow"),YP=$n("card-radius"),Fne=$n("card-border-width","0"),jne=$n("card-border-color"),sPe=$_({container:{[IN.variable]:"colors.chakra-body-bg",backgroundColor:IN.reference,boxShadow:Vne.reference,borderRadius:YP.reference,color:"chakra-body-text",borderWidth:Fne.reference,borderColor:jne.reference},body:{padding:Fp.reference,flex:"1 1 0%"},header:{padding:Fp.reference},footer:{padding:Fp.reference}}),oPe={sm:$_({container:{[YP.variable]:"radii.base",[Fp.variable]:"space.3"}}),md:$_({container:{[YP.variable]:"radii.md",[Fp.variable]:"space.5"}}),lg:$_({container:{[YP.variable]:"radii.xl",[Fp.variable]:"space.7"}})},aPe={elevated:$_({container:{[Vne.variable]:"shadows.base",_dark:{[IN.variable]:"colors.gray.700"}}}),outline:$_({container:{[Fne.variable]:"1px",[jne.variable]:"colors.chakra-border-color"}}),filled:$_({container:{[IN.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Fp.variable]:0},header:{[Fp.variable]:0},footer:{[Fp.variable]:0}}},cPe=iPe({baseStyle:sPe,variants:aPe,sizes:oPe,defaultProps:{variant:"elevated",size:"md"}}),EC=Ta("close-button-size"),kw=Ta("close-button-bg"),uPe={w:[EC.reference],h:[EC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[kw.variable]:"colors.blackAlpha.100",_dark:{[kw.variable]:"colors.whiteAlpha.100"}},_active:{[kw.variable]:"colors.blackAlpha.200",_dark:{[kw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:kw.reference},lPe={lg:{[EC.variable]:"sizes.10",fontSize:"md"},md:{[EC.variable]:"sizes.8",fontSize:"xs"},sm:{[EC.variable]:"sizes.6",fontSize:"2xs"}},dPe={baseStyle:uPe,sizes:lPe,defaultProps:{size:"md"}},{variants:hPe,defaultProps:fPe}=_C,pPe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:No.bg.reference,color:No.color.reference,boxShadow:No.shadow.reference},mPe={baseStyle:pPe,variants:hPe,defaultProps:fPe},gPe={w:"100%",mx:"auto",maxW:"prose",px:"4"},vPe={baseStyle:gPe},_Pe={opacity:.6,borderColor:"inherit"},yPe={borderStyle:"solid"},EPe={borderStyle:"dashed"},SPe={solid:yPe,dashed:EPe},TPe={baseStyle:_Pe,variants:SPe,defaultProps:{variant:"solid"}},{definePartsStyle:bPe,defineMultiStyleConfig:wPe}=_s(sRe.keys),CPe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},RPe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},IPe={pt:"2",px:"4",pb:"5"},APe={fontSize:"1.25em"},kPe=bPe({container:CPe,button:RPe,panel:IPe,icon:APe}),OPe=wPe({baseStyle:kPe}),{definePartsStyle:wR,defineMultiStyleConfig:PPe}=_s(oRe.keys),Fl=$n("alert-fg"),Kp=$n("alert-bg"),NPe=wR({container:{bg:Kp.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Fl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Fl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function PB(t){const{theme:e,colorScheme:r}=t,o=TT(`${r}.200`,.16)(e);return{light:`colors.${r}.100`,dark:o}}var DPe=wR(t=>{const{colorScheme:e}=t,r=PB(t);return{container:{[Fl.variable]:`colors.${e}.600`,[Kp.variable]:r.light,_dark:{[Fl.variable]:`colors.${e}.200`,[Kp.variable]:r.dark}}}}),LPe=wR(t=>{const{colorScheme:e}=t,r=PB(t);return{container:{[Fl.variable]:`colors.${e}.600`,[Kp.variable]:r.light,_dark:{[Fl.variable]:`colors.${e}.200`,[Kp.variable]:r.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Fl.reference}}}),xPe=wR(t=>{const{colorScheme:e}=t,r=PB(t);return{container:{[Fl.variable]:`colors.${e}.600`,[Kp.variable]:r.light,_dark:{[Fl.variable]:`colors.${e}.200`,[Kp.variable]:r.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Fl.reference}}}),MPe=wR(t=>{const{colorScheme:e}=t;return{container:{[Fl.variable]:"colors.white",[Kp.variable]:`colors.${e}.600`,_dark:{[Fl.variable]:"colors.gray.900",[Kp.variable]:`colors.${e}.200`},color:Fl.reference}}}),UPe={subtle:DPe,"left-accent":LPe,"top-accent":xPe,solid:MPe},VPe=PPe({baseStyle:NPe,variants:UPe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),{definePartsStyle:Bne,defineMultiStyleConfig:FPe}=_s(aRe.keys),uT=$n("avatar-border-color"),SC=$n("avatar-bg"),KC=$n("avatar-font-size"),bT=$n("avatar-size"),jPe={borderRadius:"full",border:"0.2em solid",borderColor:uT.reference,[uT.variable]:"white",_dark:{[uT.variable]:"colors.gray.800"}},BPe={bg:SC.reference,fontSize:KC.reference,width:bT.reference,height:bT.reference,lineHeight:"1",[SC.variable]:"colors.gray.200",_dark:{[SC.variable]:"colors.whiteAlpha.400"}},WPe=t=>{const{name:e,theme:r}=t,o=e?YRe({string:e}):"colors.gray.400",a=qRe(o)(r);let u="white";return a||(u="gray.800"),{bg:SC.reference,fontSize:KC.reference,color:u,borderColor:uT.reference,verticalAlign:"top",width:bT.reference,height:bT.reference,"&:not([data-loaded])":{[SC.variable]:o},[uT.variable]:"colors.white",_dark:{[uT.variable]:"colors.gray.800"}}},zPe={fontSize:KC.reference,lineHeight:"1"},GPe=Bne(t=>({badge:gu(jPe,t),excessLabel:gu(BPe,t),container:gu(WPe,t),label:zPe}));function lg(t){const e=t!=="100%"?Pne[t]:void 0;return Bne({container:{[bT.variable]:e??t,[KC.variable]:`calc(${e??t} / 2.5)`},excessLabel:{[bT.variable]:e??t,[KC.variable]:`calc(${e??t} / 2.5)`}})}var HPe={"2xs":lg(4),xs:lg(6),sm:lg(8),md:lg(12),lg:lg(16),xl:lg(24),"2xl":lg(32),full:lg("100%")},KPe=FPe({baseStyle:GPe,sizes:HPe,defaultProps:{size:"md"}}),qPe={Accordion:OPe,Alert:VPe,Avatar:KPe,Badge:_C,Breadcrumb:$Oe,Button:rPe,Checkbox:RN,CloseButton:dPe,Code:mPe,Container:vPe,Divider:TPe,Drawer:yOe,Editable:ROe,Form:NOe,FormError:VOe,FormLabel:jOe,Heading:zOe,Input:Li,Kbd:uke,Link:dke,List:gke,Menu:Ike,Modal:Vke,NumberInput:qke,PinInput:Jke,Popover:cOe,Progress:mAe,Radio:AAe,Select:xAe,Skeleton:UAe,SkipLink:FAe,Slider:XAe,Spinner:ZAe,Stat:ake,Switch:dIe,Table:_Ie,Tabs:DIe,Tag:KIe,Textarea:iAe,Tooltip:aAe,Card:cPe,Stepper:iRe},$Pe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},YPe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},XPe="ltr",JPe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},QPe={semanticTokens:$Pe,direction:XPe,...tRe,components:qPe,styles:YPe,config:JPe};function ZPe(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var eNe=ZPe();function tNe(t,e){const r={};return Object.keys(t).forEach(o=>{e.includes(o)||(r[o]=t[o])}),r}function nNe(t,e,r,o){const a=typeof e=="string"?e.split("."):[e];for(o=0;o<a.length&&t;o+=1)t=t[a[o]];return t===void 0?r:t}var rNe=t=>{const e=new WeakMap;return(o,a,u,d)=>{if(typeof o>"u")return t(o,a,u);e.has(o)||e.set(o,new Map);const f=e.get(o);if(f.has(a))return f.get(a);const g=t(o,a,u,d);return f.set(a,g),g}},Wne=rNe(nNe);function zne(t,e){const r={};return Object.keys(t).forEach(o=>{const a=t[o];e(a,o,t)&&(r[o]=a)}),r}var Gne=t=>zne(t,e=>e!=null);function iNe(t){return typeof t=="function"}function Hne(t,...e){return iNe(t)?t(...e):t}function sNe(...t){return function(r){t.some(o=>(o==null||o(r),r==null?void 0:r.defaultPrevented))}}const Kne=1/60*1e3,oNe=typeof performance<"u"?()=>performance.now():()=>Date.now(),qne=typeof window<"u"?t=>window.requestAnimationFrame(t):t=>setTimeout(()=>t(oNe()),Kne);function aNe(t){let e=[],r=[],o=0,a=!1,u=!1;const d=new WeakSet,f={schedule:(g,E=!1,T=!1)=>{const C=T&&a,I=C?e:r;return E&&d.add(g),I.indexOf(g)===-1&&(I.push(g),C&&a&&(o=e.length)),g},cancel:g=>{const E=r.indexOf(g);E!==-1&&r.splice(E,1),d.delete(g)},process:g=>{if(a){u=!0;return}if(a=!0,[e,r]=[r,e],r.length=0,o=e.length,o)for(let E=0;E<o;E++){const T=e[E];T(g),d.has(T)&&(f.schedule(T),t())}a=!1,u&&(u=!1,f.process(g))}};return f}const cNe=40;let sF=!0,qC=!1,oF=!1;const lT={delta:0,timestamp:0},CR=["read","update","preRender","render","postRender"],N1=CR.reduce((t,e)=>(t[e]=aNe(()=>qC=!0),t),{}),uNe=CR.reduce((t,e)=>{const r=N1[e];return t[e]=(o,a=!1,u=!1)=>(qC||hNe(),r.schedule(o,a,u)),t},{}),lNe=CR.reduce((t,e)=>(t[e]=N1[e].cancel,t),{});CR.reduce((t,e)=>(t[e]=()=>N1[e].process(lT),t),{});const dNe=t=>N1[t].process(lT),$ne=t=>{qC=!1,lT.delta=sF?Kne:Math.max(Math.min(t-lT.timestamp,cNe),1),lT.timestamp=t,oF=!0,CR.forEach(dNe),oF=!1,qC&&(sF=!1,qne($ne))},hNe=()=>{qC=!0,sF=!0,oF||qne($ne)},SJ=()=>lT;var OV,TJ;function fNe(){if(TJ)return OV;TJ=1;var t=typeof Element<"u",e=typeof Map=="function",r=typeof Set=="function",o=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function a(u,d){if(u===d)return!0;if(u&&d&&typeof u=="object"&&typeof d=="object"){if(u.constructor!==d.constructor)return!1;var f,g,E;if(Array.isArray(u)){if(f=u.length,f!=d.length)return!1;for(g=f;g--!==0;)if(!a(u[g],d[g]))return!1;return!0}var T;if(e&&u instanceof Map&&d instanceof Map){if(u.size!==d.size)return!1;for(T=u.entries();!(g=T.next()).done;)if(!d.has(g.value[0]))return!1;for(T=u.entries();!(g=T.next()).done;)if(!a(g.value[1],d.get(g.value[0])))return!1;return!0}if(r&&u instanceof Set&&d instanceof Set){if(u.size!==d.size)return!1;for(T=u.entries();!(g=T.next()).done;)if(!d.has(g.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(u)&&ArrayBuffer.isView(d)){if(f=u.length,f!=d.length)return!1;for(g=f;g--!==0;)if(u[g]!==d[g])return!1;return!0}if(u.constructor===RegExp)return u.source===d.source&&u.flags===d.flags;if(u.valueOf!==Object.prototype.valueOf&&typeof u.valueOf=="function"&&typeof d.valueOf=="function")return u.valueOf()===d.valueOf();if(u.toString!==Object.prototype.toString&&typeof u.toString=="function"&&typeof d.toString=="function")return u.toString()===d.toString();if(E=Object.keys(u),f=E.length,f!==Object.keys(d).length)return!1;for(g=f;g--!==0;)if(!Object.prototype.hasOwnProperty.call(d,E[g]))return!1;if(t&&u instanceof Element)return!1;for(g=f;g--!==0;)if(!((E[g]==="_owner"||E[g]==="__v"||E[g]==="__o")&&u.$$typeof)&&!a(u[E[g]],d[E[g]]))return!1;return!0}return u!==u&&d!==d}return OV=function(d,f){try{return a(d,f)}catch(g){if((g.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw g}},OV}var pNe=fNe();const mNe=HT(pNe);function Yne(t,e={}){var r;const{styleConfig:o,...a}=e,{theme:u,colorMode:d}=Ene(),f=t?Wne(u,`components.${t}`):void 0,g=o||f,E=uf({theme:u,colorMode:d},(r=g==null?void 0:g.defaultProps)!=null?r:{},Gne(tNe(a,["children"]))),T=X.useRef({});if(g){const I=OCe(g)(E);mNe(T.current,I)||(T.current=I)}return T.current}function gh(t,e={}){return Yne(t,e)}function cl(t,e={}){return Yne(t,e)}var gNe=new Set([..._Ce,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),vNe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function _Ne(t){return vNe.has(t)||!gNe.has(t)}function yNe(t,...e){if(t==null)throw new TypeError("Cannot convert undefined or null to object");const r={...t};for(const o of e)if(o!=null)for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&(a in r&&delete r[a],r[a]=o[a]);return r}function Xne(t){const e=Object.assign({},t);for(let r in e)e[r]===void 0&&delete e[r];return e}var ENe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,SNe=ane(function(t){return ENe.test(t)||t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)<91}),TNe=SNe,bNe=function(e){return e!=="theme"},bJ=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?TNe:bNe},wJ=function(e,r,o){var a;if(r){var u=r.shouldForwardProp;a=e.__emotion_forwardProp&&u?function(d){return e.__emotion_forwardProp(d)&&u(d)}:u}return typeof a!="function"&&o&&(a=e.__emotion_forwardProp),a},wNe=function(e){var r=e.cache,o=e.serialized,a=e.isStringTag;return une(r,o,a),Gbe(function(){return lne(r,o,a)}),null},CNe=function t(e,r){var o=e.__emotion_real===e,a=o&&e.__emotion_base||e,u,d;r!==void 0&&(u=r.label,d=r.target);var f=wJ(e,r,o),g=f||bJ(a),E=!g("as");return function(){var T=arguments,C=o&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(u!==void 0&&C.push("label:"+u+";"),T[0]==null||T[0].raw===void 0)C.push.apply(C,T);else{C.push(T[0][0]);for(var I=T.length,D=1;D<I;D++)C.push(T[D],T[0][D])}var L=pne(function(B,G,se){var ae=E&&B.as||a,M="",F=[],z=B;if(B.theme==null){z={};for(var te in B)z[te]=B[te];z.theme=X.useContext(WC)}typeof B.className=="string"?M=Ube(G.registered,F,B.className):B.className!=null&&(M=B.className+" ");var j=EB(C.concat(F),G.registered,z);M+=G.key+"-"+j.name,d!==void 0&&(M+=" "+d);var K=E&&f===void 0?bJ(ae):g,Q={};for(var ce in B)E&&ce==="as"||K(ce)&&(Q[ce]=B[ce]);return Q.className=M,Q.ref=se,X.createElement(X.Fragment,null,X.createElement(wNe,{cache:G,serialized:j,isStringTag:typeof ae=="string"}),X.createElement(ae,Q))});return L.displayName=u!==void 0?u:"Styled("+(typeof a=="string"?a:a.displayName||a.name||"Component")+")",L.defaultProps=e.defaultProps,L.__emotion_real=L,L.__emotion_base=a,L.__emotion_styles=C,L.__emotion_forwardProp=f,Object.defineProperty(L,"toString",{value:function(){return"."+d}}),L.withComponent=function(B,G){return t(B,oy({},r,G,{shouldForwardProp:wJ(L,G,!0)})).apply(void 0,C)},L}},RNe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],AN=CNe.bind();RNe.forEach(function(t){AN[t]=AN(t)});var CJ,INe=(CJ=AN.default)!=null?CJ:AN,ANe=({baseStyle:t})=>e=>{const{theme:r,css:o,__css:a,sx:u,...d}=e,f=zne(d,(C,I)=>ECe(I)),g=Hne(t,e),E=yNe({},a,g,Gne(f),u),T=Ane(E)(e.theme);return o?[T,o]:T};function PV(t,e){const{baseStyle:r,...o}=e??{};o.shouldForwardProp||(o.shouldForwardProp=_Ne);const a=ANe({baseStyle:r}),u=INe(t,o)(a);return Di.forwardRef(function(g,E){const{colorMode:T,forced:C}=I1();return Di.createElement(u,{ref:E,"data-theme":C?T:void 0,...g})})}function kNe(){const t=new Map;return new Proxy(PV,{apply(e,r,o){return PV(...o)},get(e,r){return t.has(r)||t.set(r,PV(r)),t.get(r)}})}var Yt=kNe();function gn(t){return X.forwardRef(t)}function ONe(t={}){const{strict:e=!0,errorMessage:r="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:o}=t,a=X.createContext(void 0);a.displayName=o;function u(){var d;const f=X.useContext(a);if(!f&&e){const g=new Error(r);throw g.name="ContextError",(d=Error.captureStackTrace)==null||d.call(Error,g,u),g}return f}return[a.Provider,u,a]}function PNe(t){const{cssVarsRoot:e,theme:r,children:o}=t,a=X.useMemo(()=>mCe(r),[r]);return $.jsxs(qbe,{theme:a,children:[$.jsx(NNe,{root:e}),o]})}function NNe({root:t=":host, :root"}){const e=[t,"[data-theme]"].join(",");return $.jsx(R1,{styles:r=>({[e]:r.__cssVars})})}ONe({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function DNe(){const{colorMode:t}=I1();return $.jsx(R1,{styles:e=>{const r=Wne(e,"styles.global"),o=Hne(r,{theme:e,colorMode:t});return o?Ane(o)(e):void 0}})}var Jne=X.createContext({getDocument(){return document},getWindow(){return window}});Jne.displayName="EnvironmentContext";function Qne(t){const{children:e,environment:r,disabled:o}=t,a=X.useRef(null),u=X.useMemo(()=>r||{getDocument:()=>{var f,g;return(g=(f=a.current)==null?void 0:f.ownerDocument)!=null?g:document},getWindow:()=>{var f,g;return(g=(f=a.current)==null?void 0:f.ownerDocument.defaultView)!=null?g:window}},[r]),d=!o||!r;return $.jsxs(Jne.Provider,{value:u,children:[e,d&&$.jsx("span",{id:"__chakra_env",hidden:!0,ref:a})]})}Qne.displayName="EnvironmentProvider";var LNe=t=>{const{children:e,colorModeManager:r,portalZIndex:o,resetScope:a,resetCSS:u=!0,theme:d={},environment:f,cssVarsRoot:g,disableEnvironment:E,disableGlobalStyle:T}=t,C=$.jsx(Qne,{environment:f,disabled:E,children:e});return $.jsx(PNe,{theme:d,cssVarsRoot:g,children:$.jsxs(yne,{colorModeManager:r,options:d.config,children:[u?$.jsx(Xbe,{scope:a}):$.jsx(Ybe,{}),!T&&$.jsx(DNe,{}),o?$.jsx(SB,{zIndex:o,children:C}):C]})})},xNe=(t,e)=>t.find(r=>r.id===e);function RJ(t,e){const r=Zne(t,e),o=r?t[r].findIndex(a=>a.id===e):-1;return{position:r,index:o}}function Zne(t,e){for(const[r,o]of Object.entries(t))if(xNe(o,e))return r}function MNe(t){const e=t.includes("right"),r=t.includes("left");let o="center";return e&&(o="flex-end"),r&&(o="flex-start"),{display:"flex",flexDirection:"column",alignItems:o}}function UNe(t){const r=t==="top"||t==="bottom"?"0 auto":void 0,o=t.includes("top")?"env(safe-area-inset-top, 0px)":void 0,a=t.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,u=t.includes("left")?void 0:"env(safe-area-inset-right, 0px)",d=t.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:r,top:o,bottom:a,right:u,left:d}}function tl(t,e=[]){const r=X.useRef(t);return X.useEffect(()=>{r.current=t}),X.useCallback((...o)=>{var a;return(a=r.current)==null?void 0:a.call(r,...o)},e)}function VNe(t,e){const r=tl(t);X.useEffect(()=>{if(e==null)return;let o=null;return o=window.setTimeout(()=>{r()},e),()=>{o&&window.clearTimeout(o)}},[e,r])}function ay(t,e){const r=X.useRef(!1),o=X.useRef(!1);X.useEffect(()=>{if(r.current&&o.current)return t();o.current=!0},e),X.useEffect(()=>(r.current=!0,()=>{r.current=!1}),[])}const NB=X.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),D1=X.createContext({}),RR=X.createContext(null),DB=typeof document<"u",LB=DB?X.useLayoutEffect:X.useEffect,ere=X.createContext({strict:!1}),xB=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),FNe="framerAppearId",tre="data-"+xB(FNe),jNe={useManualTiming:!1};class IJ{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const r=this.order.indexOf(e);r!==-1&&(this.order.splice(r,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function BNe(t){let e=new IJ,r=new IJ,o=0,a=!1,u=!1;const d=new WeakSet,f={schedule:(g,E=!1,T=!1)=>{const C=T&&a,I=C?e:r;return E&&d.add(g),I.add(g)&&C&&a&&(o=e.order.length),g},cancel:g=>{r.remove(g),d.delete(g)},process:g=>{if(a){u=!0;return}if(a=!0,[e,r]=[r,e],r.clear(),o=e.order.length,o)for(let E=0;E<o;E++){const T=e.order[E];d.has(T)&&(f.schedule(T),t()),T(g)}a=!1,u&&(u=!1,f.process(g))}};return f}const hP=["read","resolveKeyframes","update","preRender","render","postRender"],WNe=40;function nre(t,e){let r=!1,o=!0;const a={delta:0,timestamp:0,isProcessing:!1},u=hP.reduce((C,I)=>(C[I]=BNe(()=>r=!0),C),{}),d=C=>{u[C].process(a)},f=()=>{const C=performance.now();r=!1,a.delta=o?1e3/60:Math.max(Math.min(C-a.timestamp,WNe),1),a.timestamp=C,a.isProcessing=!0,hP.forEach(d),a.isProcessing=!1,r&&e&&(o=!1,t(f))},g=()=>{r=!0,o=!0,a.isProcessing||t(f)};return{schedule:hP.reduce((C,I)=>{const D=u[I];return C[I]=(L,B=!1,G=!1)=>(r||g(),D.schedule(L,B,G)),C},{}),cancel:C=>hP.forEach(I=>u[I].cancel(C)),state:a,steps:u}}const{schedule:MB}=nre(queueMicrotask,!1);function zNe(t,e,r,o){const{visualElement:a}=X.useContext(D1),u=X.useContext(ere),d=X.useContext(RR),f=X.useContext(NB).reducedMotion,g=X.useRef();o=o||u.renderer,!g.current&&o&&(g.current=o(t,{visualState:e,parent:a,props:r,presenceContext:d,blockInitialAnimation:d?d.initial===!1:!1,reducedMotionConfig:f}));const E=g.current;X.useInsertionEffect(()=>{E&&E.update(r,d)});const T=X.useRef(!!(r[tre]&&!window.HandoffComplete));return LB(()=>{E&&(MB.render(E.render),T.current&&E.animationState&&E.animationState.animateChanges())}),X.useEffect(()=>{E&&(E.updateFeatures(),!T.current&&E.animationState&&E.animationState.animateChanges(),T.current&&(T.current=!1,window.HandoffComplete=!0))}),E}function JS(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function GNe(t,e,r){return X.useCallback(o=>{o&&t.mount&&t.mount(o),e&&(o?e.mount(o):e.unmount()),r&&(typeof r=="function"?r(o):JS(r)&&(r.current=o))},[e])}function $C(t){return typeof t=="string"||Array.isArray(t)}function L1(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const UB=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],VB=["initial",...UB];function x1(t){return L1(t.animate)||VB.some(e=>$C(t[e]))}function rre(t){return!!(x1(t)||t.variants)}function HNe(t,e){if(x1(t)){const{initial:r,animate:o}=t;return{initial:r===!1||$C(r)?r:void 0,animate:$C(o)?o:void 0}}return t.inherit!==!1?e:{}}function KNe(t){const{initial:e,animate:r}=HNe(t,X.useContext(D1));return X.useMemo(()=>({initial:e,animate:r}),[AJ(e),AJ(r)])}function AJ(t){return Array.isArray(t)?t.join(" "):t}const kJ={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},YC={};for(const t in kJ)YC[t]={isEnabled:e=>kJ[t].some(r=>!!e[r])};function qNe(t){for(const e in t)YC[e]={...YC[e],...t[e]}}const FB=X.createContext({}),ire=X.createContext({}),$Ne=Symbol.for("motionComponentSymbol");function YNe({preloadedFeatures:t,createVisualElement:e,useRender:r,useVisualState:o,Component:a}){t&&qNe(t);function u(f,g){let E;const T={...X.useContext(NB),...f,layoutId:XNe(f)},{isStatic:C}=T,I=KNe(f),D=o(f,C);if(!C&&DB){I.visualElement=zNe(a,D,T,e);const L=X.useContext(ire),B=X.useContext(ere).strict;I.visualElement&&(E=I.visualElement.loadFeatures(T,B,t,L))}return $.jsxs(D1.Provider,{value:I,children:[E&&I.visualElement?$.jsx(E,{visualElement:I.visualElement,...T}):null,r(a,f,GNe(D,I.visualElement,g),D,C,I.visualElement)]})}const d=X.forwardRef(u);return d[$Ne]=a,d}function XNe({layoutId:t}){const e=X.useContext(FB).id;return e&&t!==void 0?e+"-"+t:t}function JNe(t){function e(o,a={}){return YNe(t(o,a))}if(typeof Proxy>"u")return e;const r=new Map;return new Proxy(e,{get:(o,a)=>(r.has(a)||r.set(a,e(a)),r.get(a))})}const QNe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function jB(t){return typeof t!="string"||t.includes("-")?!1:!!(QNe.indexOf(t)>-1||/[A-Z]/u.test(t))}const kN={};function ZNe(t){Object.assign(kN,t)}const IR=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],wy=new Set(IR);function sre(t,{layout:e,layoutId:r}){return wy.has(t)||t.startsWith("origin")||(e||r!==void 0)&&(!!kN[t]||t==="opacity")}const Hc=t=>!!(t&&t.getVelocity),e1e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},t1e=IR.length;function n1e(t,{enableHardwareAcceleration:e=!0,allowTransformNone:r=!0},o,a){let u="";for(let d=0;d<t1e;d++){const f=IR[d];if(t[f]!==void 0){const g=e1e[f]||f;u+=`${g}(${t[f]}) `}}return e&&!t.z&&(u+="translateZ(0)"),u=u.trim(),a?u=a(t,o?"":u):r&&o&&(u="none"),u}const ore=t=>e=>typeof e=="string"&&e.startsWith(t),are=ore("--"),r1e=ore("var(--"),BB=t=>r1e(t)?i1e.test(t.split("/*")[0].trim()):!1,i1e=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,s1e=(t,e)=>e&&typeof t=="number"?e.transform(t):t,Mg=(t,e,r)=>r>e?e:r<t?t:r,$T={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},TC={...$T,transform:t=>Mg(0,1,t)},fP={...$T,default:1},bC=t=>Math.round(t*1e5)/1e5,WB=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,o1e=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,a1e=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function AR(t){return typeof t=="string"}const kR=t=>({test:e=>AR(e)&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),pg=kR("deg"),mf=kR("%"),er=kR("px"),c1e=kR("vh"),u1e=kR("vw"),OJ={...mf,parse:t=>mf.parse(t)/100,transform:t=>mf.transform(t*100)},PJ={...$T,transform:Math.round},cre={borderWidth:er,borderTopWidth:er,borderRightWidth:er,borderBottomWidth:er,borderLeftWidth:er,borderRadius:er,radius:er,borderTopLeftRadius:er,borderTopRightRadius:er,borderBottomRightRadius:er,borderBottomLeftRadius:er,width:er,maxWidth:er,height:er,maxHeight:er,size:er,top:er,right:er,bottom:er,left:er,padding:er,paddingTop:er,paddingRight:er,paddingBottom:er,paddingLeft:er,margin:er,marginTop:er,marginRight:er,marginBottom:er,marginLeft:er,rotate:pg,rotateX:pg,rotateY:pg,rotateZ:pg,scale:fP,scaleX:fP,scaleY:fP,scaleZ:fP,skew:pg,skewX:pg,skewY:pg,distance:er,translateX:er,translateY:er,translateZ:er,x:er,y:er,z:er,perspective:er,transformPerspective:er,opacity:TC,originX:OJ,originY:OJ,originZ:er,zIndex:PJ,backgroundPositionX:er,backgroundPositionY:er,fillOpacity:TC,strokeOpacity:TC,numOctaves:PJ};function zB(t,e,r,o){const{style:a,vars:u,transform:d,transformOrigin:f}=t;let g=!1,E=!1,T=!0;for(const C in e){const I=e[C];if(are(C)){u[C]=I;continue}const D=cre[C],L=s1e(I,D);if(wy.has(C)){if(g=!0,d[C]=L,!T)continue;I!==(D.default||0)&&(T=!1)}else C.startsWith("origin")?(E=!0,f[C]=L):a[C]=L}if(e.transform||(g||o?a.transform=n1e(t.transform,r,T,o):a.transform&&(a.transform="none")),E){const{originX:C="50%",originY:I="50%",originZ:D=0}=f;a.transformOrigin=`${C} ${I} ${D}`}}const GB=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function ure(t,e,r){for(const o in e)!Hc(e[o])&&!sre(o,r)&&(t[o]=e[o])}function l1e({transformTemplate:t},e,r){return X.useMemo(()=>{const o=GB();return zB(o,e,{enableHardwareAcceleration:!r},t),Object.assign({},o.vars,o.style)},[e])}function d1e(t,e,r){const o=t.style||{},a={};return ure(a,o,t),Object.assign(a,l1e(t,e,r)),a}function h1e(t,e,r){const o={},a=d1e(t,e,r);return t.drag&&t.dragListener!==!1&&(o.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(o.tabIndex=0),o.style=a,o}const f1e=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ON(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||f1e.has(t)}let lre=t=>!ON(t);function p1e(t){t&&(lre=e=>e.startsWith("on")?!ON(e):t(e))}try{p1e(require("@emotion/is-prop-valid").default)}catch{}function m1e(t,e,r){const o={};for(const a in t)a==="values"&&typeof t.values=="object"||(lre(a)||r===!0&&ON(a)||!e&&!ON(a)||t.draggable&&a.startsWith("onDrag"))&&(o[a]=t[a]);return o}function NJ(t,e,r){return typeof t=="string"?t:er.transform(e+r*t)}function g1e(t,e,r){const o=NJ(e,t.x,t.width),a=NJ(r,t.y,t.height);return`${o} ${a}`}const v1e={offset:"stroke-dashoffset",array:"stroke-dasharray"},_1e={offset:"strokeDashoffset",array:"strokeDasharray"};function y1e(t,e,r=1,o=0,a=!0){t.pathLength=1;const u=a?v1e:_1e;t[u.offset]=er.transform(-o);const d=er.transform(e),f=er.transform(r);t[u.array]=`${d} ${f}`}function HB(t,{attrX:e,attrY:r,attrScale:o,originX:a,originY:u,pathLength:d,pathSpacing:f=1,pathOffset:g=0,...E},T,C,I){if(zB(t,E,T,I),C){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:D,style:L,dimensions:B}=t;D.transform&&(B&&(L.transform=D.transform),delete D.transform),B&&(a!==void 0||u!==void 0||L.transform)&&(L.transformOrigin=g1e(B,a!==void 0?a:.5,u!==void 0?u:.5)),e!==void 0&&(D.x=e),r!==void 0&&(D.y=r),o!==void 0&&(D.scale=o),d!==void 0&&y1e(D,d,f,g,!1)}const dre=()=>({...GB(),attrs:{}}),KB=t=>typeof t=="string"&&t.toLowerCase()==="svg";function E1e(t,e,r,o){const a=X.useMemo(()=>{const u=dre();return HB(u,e,{enableHardwareAcceleration:!1},KB(o),t.transformTemplate),{...u.attrs,style:{...u.style}}},[e]);if(t.style){const u={};ure(u,t.style,t),a.style={...u,...a.style}}return a}function S1e(t=!1){return(r,o,a,{latestValues:u},d)=>{const g=(jB(r)?E1e:h1e)(o,u,d,r),E=m1e(o,typeof r=="string",t),T=r!==X.Fragment?{...E,...g,ref:a}:{},{children:C}=o,I=X.useMemo(()=>Hc(C)?C.get():C,[C]);return X.createElement(r,{...T,children:I})}}function hre(t,{style:e,vars:r},o,a){Object.assign(t.style,e,a&&a.getProjectionStyles(o));for(const u in r)t.style.setProperty(u,r[u])}const fre=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function pre(t,e,r,o){hre(t,e,void 0,o);for(const a in e.attrs)t.setAttribute(fre.has(a)?a:xB(a),e.attrs[a])}function qB(t,e,r){var o;const{style:a}=t,u={};for(const d in a)(Hc(a[d])||e.style&&Hc(e.style[d])||sre(d,t)||((o=r==null?void 0:r.getValue(d))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(u[d]=a[d]);return u}function mre(t,e,r){const o=qB(t,e,r);for(const a in t)if(Hc(t[a])||Hc(e[a])){const u=IR.indexOf(a)!==-1?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a;o[u]=t[a]}return o}function DJ(t){const e=[{},{}];return t==null||t.values.forEach((r,o)=>{e[0][o]=r.get(),e[1][o]=r.getVelocity()}),e}function $B(t,e,r,o){if(typeof e=="function"){const[a,u]=DJ(o);e=e(r!==void 0?r:t.custom,a,u)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[a,u]=DJ(o);e=e(r!==void 0?r:t.custom,a,u)}return e}function gre(t){const e=X.useRef(null);return e.current===null&&(e.current=t()),e.current}const aF=t=>Array.isArray(t),T1e=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),b1e=t=>aF(t)?t[t.length-1]||0:t;function XP(t){const e=Hc(t)?t.get():t;return T1e(e)?e.toValue():e}function w1e({scrapeMotionValuesFromProps:t,createRenderState:e,onMount:r},o,a,u){const d={latestValues:C1e(o,a,u,t),renderState:e()};return r&&(d.mount=f=>r(o,f,d)),d}const vre=t=>(e,r)=>{const o=X.useContext(D1),a=X.useContext(RR),u=()=>w1e(t,e,o,a);return r?u():gre(u)};function C1e(t,e,r,o){const a={},u=o(t,{});for(const I in u)a[I]=XP(u[I]);let{initial:d,animate:f}=t;const g=x1(t),E=rre(t);e&&E&&!g&&t.inherit!==!1&&(d===void 0&&(d=e.initial),f===void 0&&(f=e.animate));let T=r?r.initial===!1:!1;T=T||d===!1;const C=T?f:d;return C&&typeof C!="boolean"&&!L1(C)&&(Array.isArray(C)?C:[C]).forEach(D=>{const L=$B(t,D);if(!L)return;const{transitionEnd:B,transition:G,...se}=L;for(const ae in se){let M=se[ae];if(Array.isArray(M)){const F=T?M.length-1:0;M=M[F]}M!==null&&(a[ae]=M)}for(const ae in B)a[ae]=B[ae]}),a}const Kc=t=>t,{schedule:cs,cancel:Ug,state:uc,steps:NV}=nre(typeof requestAnimationFrame<"u"?requestAnimationFrame:Kc,!0),R1e={useVisualState:vre({scrapeMotionValuesFromProps:mre,createRenderState:dre,onMount:(t,e,{renderState:r,latestValues:o})=>{cs.read(()=>{try{r.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{r.dimensions={x:0,y:0,width:0,height:0}}}),cs.render(()=>{HB(r,o,{enableHardwareAcceleration:!1},KB(e.tagName),t.transformTemplate),pre(e,r)})}})},I1e={useVisualState:vre({scrapeMotionValuesFromProps:qB,createRenderState:GB})};function A1e(t,{forwardMotionProps:e=!1},r,o){return{...jB(t)?R1e:I1e,preloadedFeatures:r,useRender:S1e(e),createVisualElement:o,Component:t}}function Dp(t,e,r,o={passive:!0}){return t.addEventListener(e,r,o),()=>t.removeEventListener(e,r)}const _re=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1;function M1(t,e="page"){return{point:{x:t[`${e}X`],y:t[`${e}Y`]}}}const k1e=t=>e=>_re(e)&&t(e,M1(e));function jp(t,e,r,o){return Dp(t,e,k1e(r),o)}const O1e=(t,e)=>r=>e(t(r)),Bp=(...t)=>t.reduce(O1e);function yre(t){let e=null;return()=>{const r=()=>{e=null};return e===null?(e=t,r):!1}}const LJ=yre("dragHorizontal"),xJ=yre("dragVertical");function Ere(t){let e=!1;if(t==="y")e=xJ();else if(t==="x")e=LJ();else{const r=LJ(),o=xJ();r&&o?e=()=>{r(),o()}:(r&&r(),o&&o())}return e}function Sre(){const t=Ere(!0);return t?(t(),!1):!0}class $g{constructor(e){this.isMounted=!1,this.node=e}update(){}}function MJ(t,e){const r=e?"pointerenter":"pointerleave",o=e?"onHoverStart":"onHoverEnd",a=(u,d)=>{if(u.pointerType==="touch"||Sre())return;const f=t.getProps();t.animationState&&f.whileHover&&t.animationState.setActive("whileHover",e);const g=f[o];g&&cs.postRender(()=>g(u,d))};return jp(t.current,r,a,{passive:!t.getProps()[o]})}class P1e extends $g{mount(){this.unmount=Bp(MJ(this.node,!0),MJ(this.node,!1))}unmount(){}}class N1e extends $g{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Bp(Dp(this.node.current,"focus",()=>this.onFocus()),Dp(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const Tre=(t,e)=>e?t===e?!0:Tre(t,e.parentElement):!1;function DV(t,e){if(!e)return;const r=new PointerEvent("pointer"+t);e(r,M1(r))}class D1e extends $g{constructor(){super(...arguments),this.removeStartListeners=Kc,this.removeEndListeners=Kc,this.removeAccessibleListeners=Kc,this.startPointerPress=(e,r)=>{if(this.isPressing)return;this.removeEndListeners();const o=this.node.getProps(),u=jp(window,"pointerup",(f,g)=>{if(!this.checkPressEnd())return;const{onTap:E,onTapCancel:T,globalTapTarget:C}=this.node.getProps(),I=!C&&!Tre(this.node.current,f.target)?T:E;I&&cs.update(()=>I(f,g))},{passive:!(o.onTap||o.onPointerUp)}),d=jp(window,"pointercancel",(f,g)=>this.cancelPress(f,g),{passive:!(o.onTapCancel||o.onPointerCancel)});this.removeEndListeners=Bp(u,d),this.startPress(e,r)},this.startAccessiblePress=()=>{const e=u=>{if(u.key!=="Enter"||this.isPressing)return;const d=f=>{f.key!=="Enter"||!this.checkPressEnd()||DV("up",(g,E)=>{const{onTap:T}=this.node.getProps();T&&cs.postRender(()=>T(g,E))})};this.removeEndListeners(),this.removeEndListeners=Dp(this.node.current,"keyup",d),DV("down",(f,g)=>{this.startPress(f,g)})},r=Dp(this.node.current,"keydown",e),o=()=>{this.isPressing&&DV("cancel",(u,d)=>this.cancelPress(u,d))},a=Dp(this.node.current,"blur",o);this.removeAccessibleListeners=Bp(r,a)}}startPress(e,r){this.isPressing=!0;const{onTapStart:o,whileTap:a}=this.node.getProps();a&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),o&&cs.postRender(()=>o(e,r))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!Sre()}cancelPress(e,r){if(!this.checkPressEnd())return;const{onTapCancel:o}=this.node.getProps();o&&cs.postRender(()=>o(e,r))}mount(){const e=this.node.getProps(),r=jp(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),o=Dp(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Bp(r,o)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const cF=new WeakMap,LV=new WeakMap,L1e=t=>{const e=cF.get(t.target);e&&e(t)},x1e=t=>{t.forEach(L1e)};function M1e({root:t,...e}){const r=t||document;LV.has(r)||LV.set(r,{});const o=LV.get(r),a=JSON.stringify(e);return o[a]||(o[a]=new IntersectionObserver(x1e,{root:t,...e})),o[a]}function U1e(t,e,r){const o=M1e(e);return cF.set(t,r),o.observe(t),()=>{cF.delete(t),o.unobserve(t)}}const V1e={some:0,all:1};class F1e extends $g{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:r,margin:o,amount:a="some",once:u}=e,d={root:r?r.current:void 0,rootMargin:o,threshold:typeof a=="number"?a:V1e[a]},f=g=>{const{isIntersecting:E}=g;if(this.isInView===E||(this.isInView=E,u&&!E&&this.hasEnteredView))return;E&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",E);const{onViewportEnter:T,onViewportLeave:C}=this.node.getProps(),I=E?T:C;I&&I(g)};return U1e(this.node.current,d,f)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:r}=this.node;["amount","margin","root"].some(j1e(e,r))&&this.startObserver()}unmount(){}}function j1e({viewport:t={}},{viewport:e={}}={}){return r=>t[r]!==e[r]}const B1e={inView:{Feature:F1e},tap:{Feature:D1e},focus:{Feature:N1e},hover:{Feature:P1e}};function bre(t,e){if(!Array.isArray(e))return!1;const r=e.length;if(r!==t.length)return!1;for(let o=0;o<r;o++)if(e[o]!==t[o])return!1;return!0}function U1(t,e,r){const o=t.getProps();return $B(o,e,r!==void 0?r:o.custom,t)}const Rg=t=>t*1e3,Wp=t=>t/1e3,W1e={type:"spring",stiffness:500,damping:25,restSpeed:10},z1e=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),G1e={type:"keyframes",duration:.8},H1e={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},K1e=(t,{keyframes:e})=>e.length>2?G1e:wy.has(t)?t.startsWith("scale")?z1e(e[1]):W1e:H1e;function q1e({when:t,delay:e,delayChildren:r,staggerChildren:o,staggerDirection:a,repeat:u,repeatType:d,repeatDelay:f,from:g,elapsed:E,...T}){return!!Object.keys(T).length}function YB(t,e){return t[e]||t.default||t}const $1e=t=>t!==null;function V1(t,{repeat:e,repeatType:r="loop"},o){const a=t.filter($1e),u=e&&r!=="loop"&&e%2===1?0:a.length-1;return!u||o===void 0?a[u]:o}let JP;function Y1e(){JP=void 0}const Ig={now:()=>(JP===void 0&&Ig.set(uc.isProcessing||jNe.useManualTiming?uc.timestamp:performance.now()),JP),set:t=>{JP=t,queueMicrotask(Y1e)}},wre=t=>/^0[^.\s]+$/u.test(t);function X1e(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||wre(t):!0}let Cre=Kc;const Rre=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),J1e=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Q1e(t){const e=J1e.exec(t);if(!e)return[,];const[,r,o,a]=e;return[`--${r??o}`,a]}function Ire(t,e,r=1){const[o,a]=Q1e(t);if(!o)return;const u=window.getComputedStyle(e).getPropertyValue(o);if(u){const d=u.trim();return Rre(d)?parseFloat(d):d}return BB(a)?Ire(a,e,r+1):a}const Z1e=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),UJ=t=>t===$T||t===er,VJ=(t,e)=>parseFloat(t.split(", ")[e]),FJ=(t,e)=>(r,{transform:o})=>{if(o==="none"||!o)return 0;const a=o.match(/^matrix3d\((.+)\)$/u);if(a)return VJ(a[1],e);{const u=o.match(/^matrix\((.+)\)$/u);return u?VJ(u[1],t):0}},eDe=new Set(["x","y","z"]),tDe=IR.filter(t=>!eDe.has(t));function nDe(t){const e=[];return tDe.forEach(r=>{const o=t.getValue(r);o!==void 0&&(e.push([r,o.get()]),o.set(r.startsWith("scale")?1:0))}),e}const wT={width:({x:t},{paddingLeft:e="0",paddingRight:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),height:({y:t},{paddingTop:e="0",paddingBottom:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:FJ(4,13),y:FJ(5,14)};wT.translateX=wT.x;wT.translateY=wT.y;const Are=t=>e=>e.test(t),rDe={test:t=>t==="auto",parse:t=>t},kre=[$T,er,mf,pg,u1e,c1e,rDe],jJ=t=>kre.find(Are(t)),Y_=new Set;let uF=!1,lF=!1;function Ore(){if(lF){const t=Array.from(Y_).filter(o=>o.needsMeasurement),e=new Set(t.map(o=>o.element)),r=new Map;e.forEach(o=>{const a=nDe(o);a.length&&(r.set(o,a),o.render())}),t.forEach(o=>o.measureInitialState()),e.forEach(o=>{o.render();const a=r.get(o);a&&a.forEach(([u,d])=>{var f;(f=o.getValue(u))===null||f===void 0||f.set(d)})}),t.forEach(o=>o.measureEndState()),t.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}lF=!1,uF=!1,Y_.forEach(t=>t.complete()),Y_.clear()}function Pre(){Y_.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(lF=!0)})}function iDe(){Pre(),Ore()}class XB{constructor(e,r,o,a,u,d=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=r,this.name=o,this.motionValue=a,this.element=u,this.isAsync=d}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Y_.add(this),uF||(uF=!0,cs.read(Pre),cs.resolveKeyframes(Ore))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:r,element:o,motionValue:a}=this;for(let u=0;u<e.length;u++)if(e[u]===null)if(u===0){const d=a==null?void 0:a.get(),f=e[e.length-1];if(d!==void 0)e[0]=d;else if(o&&r){const g=o.readValue(r,f);g!=null&&(e[0]=g)}e[0]===void 0&&(e[0]=f),a&&d===void 0&&a.set(e[0])}else e[u]=e[u-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Y_.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Y_.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const JB=(t,e)=>r=>!!(AR(r)&&a1e.test(r)&&r.startsWith(t)||e&&Object.prototype.hasOwnProperty.call(r,e)),Nre=(t,e,r)=>o=>{if(!AR(o))return o;const[a,u,d,f]=o.match(WB);return{[t]:parseFloat(a),[e]:parseFloat(u),[r]:parseFloat(d),alpha:f!==void 0?parseFloat(f):1}},sDe=t=>Mg(0,255,t),xV={...$T,transform:t=>Math.round(sDe(t))},W_={test:JB("rgb","red"),parse:Nre("red","green","blue"),transform:({red:t,green:e,blue:r,alpha:o=1})=>"rgba("+xV.transform(t)+", "+xV.transform(e)+", "+xV.transform(r)+", "+bC(TC.transform(o))+")"};function oDe(t){let e="",r="",o="",a="";return t.length>5?(e=t.substring(1,3),r=t.substring(3,5),o=t.substring(5,7),a=t.substring(7,9)):(e=t.substring(1,2),r=t.substring(2,3),o=t.substring(3,4),a=t.substring(4,5),e+=e,r+=r,o+=o,a+=a),{red:parseInt(e,16),green:parseInt(r,16),blue:parseInt(o,16),alpha:a?parseInt(a,16)/255:1}}const dF={test:JB("#"),parse:oDe,transform:W_.transform},QS={test:JB("hsl","hue"),parse:Nre("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:r,alpha:o=1})=>"hsla("+Math.round(t)+", "+mf.transform(bC(e))+", "+mf.transform(bC(r))+", "+bC(TC.transform(o))+")"},Bc={test:t=>W_.test(t)||dF.test(t)||QS.test(t),parse:t=>W_.test(t)?W_.parse(t):QS.test(t)?QS.parse(t):dF.parse(t),transform:t=>AR(t)?t:t.hasOwnProperty("red")?W_.transform(t):QS.transform(t)};function aDe(t){var e,r;return isNaN(t)&&AR(t)&&(((e=t.match(WB))===null||e===void 0?void 0:e.length)||0)+(((r=t.match(o1e))===null||r===void 0?void 0:r.length)||0)>0}const Dre="number",Lre="color",cDe="var",uDe="var(",BJ="${}",lDe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function XC(t){const e=t.toString(),r=[],o={color:[],number:[],var:[]},a=[];let u=0;const f=e.replace(lDe,g=>(Bc.test(g)?(o.color.push(u),a.push(Lre),r.push(Bc.parse(g))):g.startsWith(uDe)?(o.var.push(u),a.push(cDe),r.push(g)):(o.number.push(u),a.push(Dre),r.push(parseFloat(g))),++u,BJ)).split(BJ);return{values:r,split:f,indexes:o,types:a}}function xre(t){return XC(t).values}function Mre(t){const{split:e,types:r}=XC(t),o=e.length;return a=>{let u="";for(let d=0;d<o;d++)if(u+=e[d],a[d]!==void 0){const f=r[d];f===Dre?u+=bC(a[d]):f===Lre?u+=Bc.transform(a[d]):u+=a[d]}return u}}const dDe=t=>typeof t=="number"?0:t;function hDe(t){const e=xre(t);return Mre(t)(e.map(dDe))}const Vg={test:aDe,parse:xre,createTransformer:Mre,getAnimatableNone:hDe},fDe=new Set(["brightness","contrast","saturate","opacity"]);function pDe(t){const[e,r]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[o]=r.match(WB)||[];if(!o)return t;const a=r.replace(o,"");let u=fDe.has(e)?1:0;return o!==r&&(u*=100),e+"("+u+a+")"}const mDe=/\b([a-z-]*)\(.*?\)/gu,hF={...Vg,getAnimatableNone:t=>{const e=t.match(mDe);return e?e.map(pDe).join(" "):t}},gDe={...cre,color:Bc,backgroundColor:Bc,outlineColor:Bc,fill:Bc,stroke:Bc,borderColor:Bc,borderTopColor:Bc,borderRightColor:Bc,borderBottomColor:Bc,borderLeftColor:Bc,filter:hF,WebkitFilter:hF},QB=t=>gDe[t];function Ure(t,e){let r=QB(t);return r!==hF&&(r=Vg),r.getAnimatableNone?r.getAnimatableNone(e):void 0}const vDe=new Set(["auto","none","0"]);function _De(t,e,r){let o=0,a;for(;o<t.length&&!a;){const u=t[o];typeof u=="string"&&!vDe.has(u)&&XC(u).values.length&&(a=t[o]),o++}if(a&&r)for(const u of e)t[u]=Ure(r,a)}class Vre extends XB{constructor(e,r,o,a){super(e,r,o,a,a==null?void 0:a.owner,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:r,name:o}=this;if(!r.current)return;super.readKeyframes();for(let g=0;g<e.length;g++){const E=e[g];if(typeof E=="string"&&BB(E)){const T=Ire(E,r.current);T!==void 0&&(e[g]=T),g===e.length-1&&(this.finalKeyframe=E)}}if(this.resolveNoneKeyframes(),!Z1e.has(o)||e.length!==2)return;const[a,u]=e,d=jJ(a),f=jJ(u);if(d!==f)if(UJ(d)&&UJ(f))for(let g=0;g<e.length;g++){const E=e[g];typeof E=="string"&&(e[g]=parseFloat(E))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:r}=this,o=[];for(let a=0;a<e.length;a++)X1e(e[a])&&o.push(a);o.length&&_De(e,o,r)}measureInitialState(){const{element:e,unresolvedKeyframes:r,name:o}=this;if(!e.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=wT[o](e.measureViewportBox(),window.getComputedStyle(e.current)),r[0]=this.measuredOrigin;const a=r[r.length-1];a!==void 0&&e.getValue(o,a).jump(a,!1)}measureEndState(){var e;const{element:r,name:o,unresolvedKeyframes:a}=this;if(!r.current)return;const u=r.getValue(o);u&&u.jump(this.measuredOrigin,!1);const d=a.length-1,f=a[d];a[d]=wT[o](r.measureViewportBox(),window.getComputedStyle(r.current)),f!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=f),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([g,E])=>{r.getValue(g).set(E)}),this.resolveNoneKeyframes()}}function yDe(t){let e;return()=>(e===void 0&&(e=t()),e)}const WJ=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Vg.test(t)||t==="0")&&!t.startsWith("url("));function EDe(t){const e=t[0];if(t.length===1)return!0;for(let r=0;r<t.length;r++)if(t[r]!==e)return!0}function SDe(t,e,r,o){const a=t[0];if(a===null)return!1;if(e==="display"||e==="visibility")return!0;const u=t[t.length-1],d=WJ(a,e),f=WJ(u,e);return!d||!f?!1:EDe(t)||r==="spring"&&o}class Fre{constructor({autoplay:e=!0,delay:r=0,type:o="keyframes",repeat:a=0,repeatDelay:u=0,repeatType:d="loop",...f}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:e,delay:r,type:o,repeat:a,repeatDelay:u,repeatType:d,...f},this.updateFinishedPromise()}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&iDe(),this._resolved}onKeyframesResolved(e,r){this.hasAttemptedResolve=!0;const{name:o,type:a,velocity:u,delay:d,onComplete:f,onUpdate:g,isGenerator:E}=this.options;if(!E&&!SDe(e,o,a,u))if(d)this.options.duration=0;else{g==null||g(V1(e,this.options,r)),f==null||f(),this.resolveFinishedPromise();return}const T=this.initPlayback(e,r);T!==!1&&(this._resolved={keyframes:e,finalKeyframe:r,...T},this.onPostResolved())}onPostResolved(){}then(e,r){return this.currentFinishedPromise.then(e,r)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}function jre(t,e){return e?t*(1e3/e):0}const TDe=5;function Bre(t,e,r){const o=Math.max(e-TDe,0);return jre(r-t(o),e-o)}const zJ=.001,bDe=.01,wDe=10,CDe=.05,RDe=1;function IDe({duration:t=800,bounce:e=.25,velocity:r=0,mass:o=1}){let a,u,d=1-e;d=Mg(CDe,RDe,d),t=Mg(bDe,wDe,Wp(t)),d<1?(a=E=>{const T=E*d,C=T*t,I=T-r,D=fF(E,d),L=Math.exp(-C);return zJ-I/D*L},u=E=>{const C=E*d*t,I=C*r+r,D=Math.pow(d,2)*Math.pow(E,2)*t,L=Math.exp(-C),B=fF(Math.pow(E,2),d);return(-a(E)+zJ>0?-1:1)*((I-D)*L)/B}):(a=E=>{const T=Math.exp(-E*t),C=(E-r)*t+1;return-.001+T*C},u=E=>{const T=Math.exp(-E*t),C=(r-E)*(t*t);return T*C});const f=5/t,g=kDe(a,u,f);if(t=Rg(t),isNaN(g))return{stiffness:100,damping:10,duration:t};{const E=Math.pow(g,2)*o;return{stiffness:E,damping:d*2*Math.sqrt(o*E),duration:t}}}const ADe=12;function kDe(t,e,r){let o=r;for(let a=1;a<ADe;a++)o=o-t(o)/e(o);return o}function fF(t,e){return t*Math.sqrt(1-e*e)}const ODe=["duration","bounce"],PDe=["stiffness","damping","mass"];function GJ(t,e){return e.some(r=>t[r]!==void 0)}function NDe(t){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...t};if(!GJ(t,PDe)&&GJ(t,ODe)){const r=IDe(t);e={...e,...r,mass:1},e.isResolvedFromDuration=!0}return e}function Wre({keyframes:t,restDelta:e,restSpeed:r,...o}){const a=t[0],u=t[t.length-1],d={done:!1,value:a},{stiffness:f,damping:g,mass:E,duration:T,velocity:C,isResolvedFromDuration:I}=NDe({...o,velocity:-Wp(o.velocity||0)}),D=C||0,L=g/(2*Math.sqrt(f*E)),B=u-a,G=Wp(Math.sqrt(f/E)),se=Math.abs(B)<5;r||(r=se?.01:2),e||(e=se?.005:.5);let ae;if(L<1){const M=fF(G,L);ae=F=>{const z=Math.exp(-L*G*F);return u-z*((D+L*G*B)/M*Math.sin(M*F)+B*Math.cos(M*F))}}else if(L===1)ae=M=>u-Math.exp(-G*M)*(B+(D+G*B)*M);else{const M=G*Math.sqrt(L*L-1);ae=F=>{const z=Math.exp(-L*G*F),te=Math.min(M*F,300);return u-z*((D+L*G*B)*Math.sinh(te)+M*B*Math.cosh(te))/M}}return{calculatedDuration:I&&T||null,next:M=>{const F=ae(M);if(I)d.done=M>=T;else{let z=D;M!==0&&(L<1?z=Bre(ae,M,F):z=0);const te=Math.abs(z)<=r,j=Math.abs(u-F)<=e;d.done=te&&j}return d.value=d.done?u:F,d}}}function HJ({keyframes:t,velocity:e=0,power:r=.8,timeConstant:o=325,bounceDamping:a=10,bounceStiffness:u=500,modifyTarget:d,min:f,max:g,restDelta:E=.5,restSpeed:T}){const C=t[0],I={done:!1,value:C},D=K=>f!==void 0&&K<f||g!==void 0&&K>g,L=K=>f===void 0?g:g===void 0||Math.abs(f-K)<Math.abs(g-K)?f:g;let B=r*e;const G=C+B,se=d===void 0?G:d(G);se!==G&&(B=se-C);const ae=K=>-B*Math.exp(-K/o),M=K=>se+ae(K),F=K=>{const Q=ae(K),ce=M(K);I.done=Math.abs(Q)<=E,I.value=I.done?se:ce};let z,te;const j=K=>{D(I.value)&&(z=K,te=Wre({keyframes:[I.value,L(I.value)],velocity:Bre(M,K,I.value),damping:a,stiffness:u,restDelta:E,restSpeed:T}))};return j(0),{calculatedDuration:null,next:K=>{let Q=!1;return!te&&z===void 0&&(Q=!0,F(K),j(K)),z!==void 0&&K>=z?te.next(K-z):(!Q&&F(K),I)}}}const zre=(t,e,r)=>(((1-3*r+3*e)*t+(3*r-6*e))*t+3*e)*t,DDe=1e-7,LDe=12;function xDe(t,e,r,o,a){let u,d,f=0;do d=e+(r-e)/2,u=zre(d,o,a)-t,u>0?r=d:e=d;while(Math.abs(u)>DDe&&++f<LDe);return d}function OR(t,e,r,o){if(t===e&&r===o)return Kc;const a=u=>xDe(u,0,1,t,r);return u=>u===0||u===1?u:zre(a(u),e,o)}const MDe=OR(.42,0,1,1),UDe=OR(0,0,.58,1),Gre=OR(.42,0,.58,1),VDe=t=>Array.isArray(t)&&typeof t[0]!="number",Hre=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,Kre=t=>e=>1-t(1-e),ZB=t=>1-Math.sin(Math.acos(t)),qre=Kre(ZB),FDe=Hre(ZB),$re=OR(.33,1.53,.69,.99),e4=Kre($re),jDe=Hre(e4),BDe=t=>(t*=2)<1?.5*e4(t):.5*(2-Math.pow(2,-10*(t-1))),WDe={linear:Kc,easeIn:MDe,easeInOut:Gre,easeOut:UDe,circIn:ZB,circInOut:FDe,circOut:qre,backIn:e4,backInOut:jDe,backOut:$re,anticipate:BDe},KJ=t=>{if(Array.isArray(t)){Cre(t.length===4);const[e,r,o,a]=t;return OR(e,r,o,a)}else if(typeof t=="string")return WDe[t];return t},JC=(t,e,r)=>{const o=e-t;return o===0?1:(r-t)/o},Js=(t,e,r)=>t+(e-t)*r;function MV(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function zDe({hue:t,saturation:e,lightness:r,alpha:o}){t/=360,e/=100,r/=100;let a=0,u=0,d=0;if(!e)a=u=d=r;else{const f=r<.5?r*(1+e):r+e-r*e,g=2*r-f;a=MV(g,f,t+1/3),u=MV(g,f,t),d=MV(g,f,t-1/3)}return{red:Math.round(a*255),green:Math.round(u*255),blue:Math.round(d*255),alpha:o}}const UV=(t,e,r)=>{const o=t*t,a=r*(e*e-o)+o;return a<0?0:Math.sqrt(a)},GDe=[dF,W_,QS],HDe=t=>GDe.find(e=>e.test(t));function qJ(t){const e=HDe(t);let r=e.parse(t);return e===QS&&(r=zDe(r)),r}const $J=(t,e)=>{const r=qJ(t),o=qJ(e),a={...r};return u=>(a.red=UV(r.red,o.red,u),a.green=UV(r.green,o.green,u),a.blue=UV(r.blue,o.blue,u),a.alpha=Js(r.alpha,o.alpha,u),W_.transform(a))},pF=new Set(["none","hidden"]);function KDe(t,e){return pF.has(t)?r=>r<=0?t:e:r=>r>=1?e:t}function mF(t,e){return r=>r>0?e:t}function qDe(t,e){return r=>Js(t,e,r)}function t4(t){return typeof t=="number"?qDe:typeof t=="string"?BB(t)?mF:Bc.test(t)?$J:XDe:Array.isArray(t)?Yre:typeof t=="object"?Bc.test(t)?$J:$De:mF}function Yre(t,e){const r=[...t],o=r.length,a=t.map((u,d)=>t4(u)(u,e[d]));return u=>{for(let d=0;d<o;d++)r[d]=a[d](u);return r}}function $De(t,e){const r={...t,...e},o={};for(const a in r)t[a]!==void 0&&e[a]!==void 0&&(o[a]=t4(t[a])(t[a],e[a]));return a=>{for(const u in o)r[u]=o[u](a);return r}}function YDe(t,e){var r;const o=[],a={color:0,var:0,number:0};for(let u=0;u<e.values.length;u++){const d=e.types[u],f=t.indexes[d][a[d]],g=(r=t.values[f])!==null&&r!==void 0?r:0;o[u]=g,a[d]++}return o}const XDe=(t,e)=>{const r=Vg.createTransformer(e),o=XC(t),a=XC(e);return o.indexes.var.length===a.indexes.var.length&&o.indexes.color.length===a.indexes.color.length&&o.indexes.number.length>=a.indexes.number.length?pF.has(t)&&!a.values.length||pF.has(e)&&!o.values.length?KDe(t,e):Bp(Yre(YDe(o,a),a.values),r):mF(t,e)};function Xre(t,e,r){return typeof t=="number"&&typeof e=="number"&&typeof r=="number"?Js(t,e,r):t4(t)(t,e)}function JDe(t,e,r){const o=[],a=r||Xre,u=t.length-1;for(let d=0;d<u;d++){let f=a(t[d],t[d+1]);if(e){const g=Array.isArray(e)?e[d]||Kc:e;f=Bp(g,f)}o.push(f)}return o}function QDe(t,e,{clamp:r=!0,ease:o,mixer:a}={}){const u=t.length;if(Cre(u===e.length),u===1)return()=>e[0];if(u===2&&t[0]===t[1])return()=>e[1];t[0]>t[u-1]&&(t=[...t].reverse(),e=[...e].reverse());const d=JDe(e,o,a),f=d.length,g=E=>{let T=0;if(f>1)for(;T<t.length-2&&!(E<t[T+1]);T++);const C=JC(t[T],t[T+1],E);return d[T](C)};return r?E=>g(Mg(t[0],t[u-1],E)):g}function ZDe(t,e){const r=t[t.length-1];for(let o=1;o<=e;o++){const a=JC(0,e,o);t.push(Js(r,1,a))}}function eLe(t){const e=[0];return ZDe(e,t.length-1),e}function tLe(t,e){return t.map(r=>r*e)}function nLe(t,e){return t.map(()=>e||Gre).splice(0,t.length-1)}function PN({duration:t=300,keyframes:e,times:r,ease:o="easeInOut"}){const a=VDe(o)?o.map(KJ):KJ(o),u={done:!1,value:e[0]},d=tLe(r&&r.length===e.length?r:eLe(e),t),f=QDe(d,e,{ease:Array.isArray(a)?a:nLe(e,a)});return{calculatedDuration:t,next:g=>(u.value=f(g),u.done=g>=t,u)}}const YJ=2e4;function rLe(t){let e=0;const r=50;let o=t.next(e);for(;!o.done&&e<YJ;)e+=r,o=t.next(e);return e>=YJ?1/0:e}const iLe=t=>{const e=({timestamp:r})=>t(r);return{start:()=>cs.update(e,!0),stop:()=>Ug(e),now:()=>uc.isProcessing?uc.timestamp:Ig.now()}},sLe={decay:HJ,inertia:HJ,tween:PN,keyframes:PN,spring:Wre},oLe=t=>t/100;class n4 extends Fre{constructor({KeyframeResolver:e=XB,...r}){super(r),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:f}=this.options;f&&f()};const{name:o,motionValue:a,keyframes:u}=this.options,d=(f,g)=>this.onKeyframesResolved(f,g);o&&a&&a.owner?this.resolver=a.owner.resolveKeyframes(u,d,o,a):this.resolver=new e(u,d,o,a),this.resolver.scheduleResolve()}initPlayback(e){const{type:r="keyframes",repeat:o=0,repeatDelay:a=0,repeatType:u,velocity:d=0}=this.options,f=sLe[r]||PN;let g,E;f!==PN&&typeof e[0]!="number"&&(g=Bp(oLe,Xre(e[0],e[1])),e=[0,100]);const T=f({...this.options,keyframes:e});u==="mirror"&&(E=f({...this.options,keyframes:[...e].reverse(),velocity:-d})),T.calculatedDuration===null&&(T.calculatedDuration=rLe(T));const{calculatedDuration:C}=T,I=C+a,D=I*(o+1)-a;return{generator:T,mirroredGenerator:E,mapPercentToKeyframes:g,calculatedDuration:C,resolvedDuration:I,totalDuration:D}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,r=!1){const{resolved:o}=this;if(!o){const{keyframes:K}=this.options;return{done:!0,value:K[K.length-1]}}const{finalKeyframe:a,generator:u,mirroredGenerator:d,mapPercentToKeyframes:f,keyframes:g,calculatedDuration:E,totalDuration:T,resolvedDuration:C}=o;if(this.startTime===null)return u.next(0);const{delay:I,repeat:D,repeatType:L,repeatDelay:B,onUpdate:G}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-T/this.speed,this.startTime)),r?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const se=this.currentTime-I*(this.speed>=0?1:-1),ae=this.speed>=0?se<0:se>T;this.currentTime=Math.max(se,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=T);let M=this.currentTime,F=u;if(D){const K=Math.min(this.currentTime,T)/C;let Q=Math.floor(K),ce=K%1;!ce&&K>=1&&(ce=1),ce===1&&Q--,Q=Math.min(Q,D+1),!!(Q%2)&&(L==="reverse"?(ce=1-ce,B&&(ce-=B/C)):L==="mirror"&&(F=d)),M=Mg(0,1,ce)*C}const z=ae?{done:!1,value:g[0]}:F.next(M);f&&(z.value=f(z.value));let{done:te}=z;!ae&&E!==null&&(te=this.speed>=0?this.currentTime>=T:this.currentTime<=0);const j=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&te);return j&&a!==void 0&&(z.value=V1(g,this.options,a)),G&&G(z.value),j&&this.finish(),z}get duration(){const{resolved:e}=this;return e?Wp(e.calculatedDuration):0}get time(){return Wp(this.currentTime)}set time(e){e=Rg(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const r=this.playbackSpeed!==e;this.playbackSpeed=e,r&&(this.time=Wp(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=iLe,onPlay:r}=this.options;this.driver||(this.driver=e(a=>this.tick(a))),r&&r();const o=this.driver.now();this.holdTime!==null?this.startTime=o-this.holdTime:(!this.startTime||this.state==="finished")&&(this.startTime=o),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const Jre=t=>Array.isArray(t)&&typeof t[0]=="number";function Qre(t){return!!(!t||typeof t=="string"&&t in r4||Jre(t)||Array.isArray(t)&&t.every(Qre))}const eC=([t,e,r,o])=>`cubic-bezier(${t}, ${e}, ${r}, ${o})`,r4={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:eC([0,.65,.55,1]),circOut:eC([.55,0,1,.45]),backIn:eC([.31,.01,.66,-.59]),backOut:eC([.33,1.53,.69,.99])};function aLe(t){return Zre(t)||r4.easeOut}function Zre(t){if(t)return Jre(t)?eC(t):Array.isArray(t)?t.map(aLe):r4[t]}function cLe(t,e,r,{delay:o=0,duration:a=300,repeat:u=0,repeatType:d="loop",ease:f,times:g}={}){const E={[e]:r};g&&(E.offset=g);const T=Zre(f);return Array.isArray(T)&&(E.easing=T),t.animate(E,{delay:o,duration:a,easing:Array.isArray(T)?"linear":T,fill:"both",iterations:u+1,direction:d==="reverse"?"alternate":"normal"})}const uLe=yDe(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),lLe=new Set(["opacity","clipPath","filter","transform"]),NN=10,dLe=2e4;function hLe(t){return t.type==="spring"||t.name==="backgroundColor"||!Qre(t.ease)}function fLe(t,e){const r=new n4({...e,keyframes:t,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:t[0]};const a=[];let u=0;for(;!o.done&&u<dLe;)o=r.sample(u),a.push(o.value),u+=NN;return{times:void 0,keyframes:a,duration:u-NN,ease:"linear"}}class XJ extends Fre{constructor(e){super(e);const{name:r,motionValue:o,keyframes:a}=this.options;this.resolver=new Vre(a,(u,d)=>this.onKeyframesResolved(u,d),r,o),this.resolver.scheduleResolve()}initPlayback(e,r){var o;let{duration:a=300,times:u,ease:d,type:f,motionValue:g,name:E}=this.options;if(!(!((o=g.owner)===null||o===void 0)&&o.current))return!1;if(hLe(this.options)){const{onComplete:C,onUpdate:I,motionValue:D,...L}=this.options,B=fLe(e,L);e=B.keyframes,e.length===1&&(e[1]=e[0]),a=B.duration,u=B.times,d=B.ease,f="keyframes"}const T=cLe(g.owner.current,E,e,{...this.options,duration:a,times:u,ease:d});return T.startTime=Ig.now(),this.pendingTimeline?(T.timeline=this.pendingTimeline,this.pendingTimeline=void 0):T.onfinish=()=>{const{onComplete:C}=this.options;g.set(V1(e,this.options,r)),C&&C(),this.cancel(),this.resolveFinishedPromise()},{animation:T,duration:a,times:u,type:f,ease:d,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:r}=e;return Wp(r)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:r}=e;return Wp(r.currentTime||0)}set time(e){const{resolved:r}=this;if(!r)return;const{animation:o}=r;o.currentTime=Rg(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:r}=e;return r.playbackRate}set speed(e){const{resolved:r}=this;if(!r)return;const{animation:o}=r;o.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:r}=e;return r.playState}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:r}=this;if(!r)return Kc;const{animation:o}=r;o.timeline=e,o.onfinish=null}return Kc}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:r}=e;r.playState==="finished"&&this.updateFinishedPromise(),r.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:r}=e;r.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;const{resolved:e}=this;if(!e)return;const{animation:r,keyframes:o,duration:a,type:u,ease:d,times:f}=e;if(!(r.playState==="idle"||r.playState==="finished")){if(this.time){const{motionValue:g,onUpdate:E,onComplete:T,...C}=this.options,I=new n4({...C,keyframes:o,duration:a,type:u,ease:d,times:f,isGenerator:!0}),D=Rg(this.time);g.setWithVelocity(I.sample(D-NN).value,I.sample(D).value,NN)}this.cancel()}}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:r,name:o,repeatDelay:a,repeatType:u,damping:d,type:f}=e;return uLe()&&o&&lLe.has(o)&&r&&r.owner&&r.owner.current instanceof HTMLElement&&!r.owner.getProps().onUpdate&&!a&&u!=="mirror"&&d!==0&&f!=="inertia"}}const i4=(t,e,r,o={},a,u)=>d=>{const f=YB(o,t)||{},g=f.delay||o.delay||0;let{elapsed:E=0}=o;E=E-Rg(g);let T={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:e.getVelocity(),...f,delay:-E,onUpdate:I=>{e.set(I),f.onUpdate&&f.onUpdate(I)},onComplete:()=>{d(),f.onComplete&&f.onComplete()},name:t,motionValue:e,element:u?void 0:a};q1e(f)||(T={...T,...K1e(t,T)}),T.duration&&(T.duration=Rg(T.duration)),T.repeatDelay&&(T.repeatDelay=Rg(T.repeatDelay)),T.from!==void 0&&(T.keyframes[0]=T.from);let C=!1;if((T.type===!1||T.duration===0&&!T.repeatDelay)&&(T.duration=0,T.delay===0&&(C=!0)),C&&!u&&e.get()!==void 0){const I=V1(T.keyframes,f);if(I!==void 0){cs.update(()=>{T.onUpdate(I),T.onComplete()});return}}return!u&&XJ.supports(T)?new XJ(T):new n4(T)};function DN(t){return!!(Hc(t)&&t.add)}function s4(t,e){t.indexOf(e)===-1&&t.push(e)}function o4(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}class a4{constructor(){this.subscriptions=[]}add(e){return s4(this.subscriptions,e),()=>o4(this.subscriptions,e)}notify(e,r,o){const a=this.subscriptions.length;if(a)if(a===1)this.subscriptions[0](e,r,o);else for(let u=0;u<a;u++){const d=this.subscriptions[u];d&&d(e,r,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const JJ=30,pLe=t=>!isNaN(parseFloat(t));class mLe{constructor(e,r={}){this.version="11.2.6",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,a=!0)=>{const u=Ig.now();this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),a&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=r.owner}setCurrent(e){this.current=e,this.updatedAt=Ig.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=pLe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,r){this.events[e]||(this.events[e]=new a4);const o=this.events[e].add(r);return e==="change"?()=>{o(),cs.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,r){this.passiveEffect=e,this.stopPassiveEffect=r}set(e,r=!0){!r||!this.passiveEffect?this.updateAndNotify(e,r):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,r,o){this.set(r),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-o}jump(e,r=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Ig.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>JJ)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,JJ);return jre(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(e){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=e(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function QC(t,e){return new mLe(t,e)}function gLe(t,e,r){t.hasValue(e)?t.getValue(e).set(r):t.addValue(e,QC(r))}function vLe(t,e){const r=U1(t,e);let{transitionEnd:o={},transition:a={},...u}=r||{};u={...u,...o};for(const d in u){const f=b1e(u[d]);gLe(t,d,f)}}function _Le({protectedKeys:t,needsAnimating:e},r){const o=t.hasOwnProperty(r)&&e[r]!==!0;return e[r]=!1,o}function eie(t,e,{delay:r=0,transitionOverride:o,type:a}={}){var u;let{transition:d=t.getDefaultTransition(),transitionEnd:f,...g}=e;const E=t.getValue("willChange");o&&(d=o);const T=[],C=a&&t.animationState&&t.animationState.getState()[a];for(const I in g){const D=t.getValue(I,(u=t.latestValues[I])!==null&&u!==void 0?u:null),L=g[I];if(L===void 0||C&&_Le(C,I))continue;const B={delay:r,elapsed:0,...YB(d||{},I)};let G=!1;if(window.HandoffAppearAnimations){const M=t.getProps()[tre];if(M){const F=window.HandoffAppearAnimations(M,I,D,cs);F!==null&&(B.elapsed=F,G=!0)}}D.start(i4(I,D,L,t.shouldReduceMotion&&wy.has(I)?{type:!1}:B,t,G));const se=D.animation;se&&(DN(E)&&(E.add(I),se.then(()=>E.remove(I))),T.push(se))}return f&&Promise.all(T).then(()=>{cs.update(()=>{f&&vLe(t,f)})}),T}function gF(t,e,r={}){var o;const a=U1(t,e,r.type==="exit"?(o=t.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:u=t.getDefaultTransition()||{}}=a||{};r.transitionOverride&&(u=r.transitionOverride);const d=a?()=>Promise.all(eie(t,a,r)):()=>Promise.resolve(),f=t.variantChildren&&t.variantChildren.size?(E=0)=>{const{delayChildren:T=0,staggerChildren:C,staggerDirection:I}=u;return yLe(t,e,T+E,C,I,r)}:()=>Promise.resolve(),{when:g}=u;if(g){const[E,T]=g==="beforeChildren"?[d,f]:[f,d];return E().then(()=>T())}else return Promise.all([d(),f(r.delay)])}function yLe(t,e,r=0,o=0,a=1,u){const d=[],f=(t.variantChildren.size-1)*o,g=a===1?(E=0)=>E*o:(E=0)=>f-E*o;return Array.from(t.variantChildren).sort(ELe).forEach((E,T)=>{E.notify("AnimationStart",e),d.push(gF(E,e,{...u,delay:r+g(T)}).then(()=>E.notify("AnimationComplete",e)))}),Promise.all(d)}function ELe(t,e){return t.sortNodePosition(e)}function SLe(t,e,r={}){t.notify("AnimationStart",e);let o;if(Array.isArray(e)){const a=e.map(u=>gF(t,u,r));o=Promise.all(a)}else if(typeof e=="string")o=gF(t,e,r);else{const a=typeof e=="function"?U1(t,e,r.custom):e;o=Promise.all(eie(t,a,r))}return o.then(()=>{cs.postRender(()=>{t.notify("AnimationComplete",e)})})}const TLe=[...UB].reverse(),bLe=UB.length;function wLe(t){return e=>Promise.all(e.map(({animation:r,options:o})=>SLe(t,r,o)))}function CLe(t){let e=wLe(t);const r=ILe();let o=!0;const a=g=>(E,T)=>{var C;const I=U1(t,T,g==="exit"?(C=t.presenceContext)===null||C===void 0?void 0:C.custom:void 0);if(I){const{transition:D,transitionEnd:L,...B}=I;E={...E,...B,...L}}return E};function u(g){e=g(t)}function d(g){const E=t.getProps(),T=t.getVariantContext(!0)||{},C=[],I=new Set;let D={},L=1/0;for(let G=0;G<bLe;G++){const se=TLe[G],ae=r[se],M=E[se]!==void 0?E[se]:T[se],F=$C(M),z=se===g?ae.isActive:null;z===!1&&(L=G);let te=M===T[se]&&M!==E[se]&&F;if(te&&o&&t.manuallyAnimateOnMount&&(te=!1),ae.protectedKeys={...D},!ae.isActive&&z===null||!M&&!ae.prevProp||L1(M)||typeof M=="boolean")continue;let K=RLe(ae.prevProp,M)||se===g&&ae.isActive&&!te&&F||G>L&&F,Q=!1;const ce=Array.isArray(M)?M:[M];let Ee=ce.reduce(a(se),{});z===!1&&(Ee={});const{prevResolvedValues:_e={}}=ae,pe={..._e,...Ee},qe=St=>{K=!0,I.has(St)&&(Q=!0,I.delete(St)),ae.needsAnimating[St]=!0;const ke=t.getValue(St);ke&&(ke.liveStyle=!1)};for(const St in pe){const ke=Ee[St],Ne=_e[St];if(D.hasOwnProperty(St))continue;let Re=!1;aF(ke)&&aF(Ne)?Re=!bre(ke,Ne):Re=ke!==Ne,Re?ke!=null?qe(St):I.add(St):ke!==void 0&&I.has(St)?qe(St):ae.protectedKeys[St]=!0}ae.prevProp=M,ae.prevResolvedValues=Ee,ae.isActive&&(D={...D,...Ee}),o&&t.blockInitialAnimation&&(K=!1),K&&(!te||Q)&&C.push(...ce.map(St=>({animation:St,options:{type:se}})))}if(I.size){const G={};I.forEach(se=>{const ae=t.getBaseTarget(se),M=t.getValue(se);M&&(M.liveStyle=!0),G[se]=ae??null}),C.push({animation:G})}let B=!!C.length;return o&&(E.initial===!1||E.initial===E.animate)&&!t.manuallyAnimateOnMount&&(B=!1),o=!1,B?e(C):Promise.resolve()}function f(g,E){var T;if(r[g].isActive===E)return Promise.resolve();(T=t.variantChildren)===null||T===void 0||T.forEach(I=>{var D;return(D=I.animationState)===null||D===void 0?void 0:D.setActive(g,E)}),r[g].isActive=E;const C=d(g);for(const I in r)r[I].protectedKeys={};return C}return{animateChanges:d,setActive:f,setAnimateFunction:u,getState:()=>r}}function RLe(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!bre(e,t):!1}function A_(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ILe(){return{animate:A_(!0),whileInView:A_(),whileHover:A_(),whileTap:A_(),whileDrag:A_(),whileFocus:A_(),exit:A_()}}class ALe extends $g{constructor(e){super(e),e.animationState||(e.animationState=CLe(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),L1(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:r}=this.node.prevProps||{};e!==r&&this.updateAnimationControlsSubscription()}unmount(){}}let kLe=0;class OLe extends $g{constructor(){super(...arguments),this.id=kLe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:r}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===o)return;const a=this.node.animationState.setActive("exit",!e);r&&!e&&a.then(()=>r(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const PLe={animation:{Feature:ALe},exit:{Feature:OLe}},QJ=(t,e)=>Math.abs(t-e);function NLe(t,e){const r=QJ(t.x,e.x),o=QJ(t.y,e.y);return Math.sqrt(r**2+o**2)}class tie{constructor(e,r,{transformPagePoint:o,contextWindow:a,dragSnapToOrigin:u=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const C=FV(this.lastMoveEventInfo,this.history),I=this.startEvent!==null,D=NLe(C.offset,{x:0,y:0})>=3;if(!I&&!D)return;const{point:L}=C,{timestamp:B}=uc;this.history.push({...L,timestamp:B});const{onStart:G,onMove:se}=this.handlers;I||(G&&G(this.lastMoveEvent,C),this.startEvent=this.lastMoveEvent),se&&se(this.lastMoveEvent,C)},this.handlePointerMove=(C,I)=>{this.lastMoveEvent=C,this.lastMoveEventInfo=VV(I,this.transformPagePoint),cs.update(this.updatePoint,!0)},this.handlePointerUp=(C,I)=>{this.end();const{onEnd:D,onSessionEnd:L,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const G=FV(C.type==="pointercancel"?this.lastMoveEventInfo:VV(I,this.transformPagePoint),this.history);this.startEvent&&D&&D(C,G),L&&L(C,G)},!_re(e))return;this.dragSnapToOrigin=u,this.handlers=r,this.transformPagePoint=o,this.contextWindow=a||window;const d=M1(e),f=VV(d,this.transformPagePoint),{point:g}=f,{timestamp:E}=uc;this.history=[{...g,timestamp:E}];const{onSessionStart:T}=r;T&&T(e,FV(f,this.history)),this.removeListeners=Bp(jp(this.contextWindow,"pointermove",this.handlePointerMove),jp(this.contextWindow,"pointerup",this.handlePointerUp),jp(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ug(this.updatePoint)}}function VV(t,e){return e?{point:e(t.point)}:t}function ZJ(t,e){return{x:t.x-e.x,y:t.y-e.y}}function FV({point:t},e){return{point:t,delta:ZJ(t,nie(e)),offset:ZJ(t,DLe(e)),velocity:LLe(e,.1)}}function DLe(t){return t[0]}function nie(t){return t[t.length-1]}function LLe(t,e){if(t.length<2)return{x:0,y:0};let r=t.length-1,o=null;const a=nie(t);for(;r>=0&&(o=t[r],!(a.timestamp-o.timestamp>Rg(e)));)r--;if(!o)return{x:0,y:0};const u=Wp(a.timestamp-o.timestamp);if(u===0)return{x:0,y:0};const d={x:(a.x-o.x)/u,y:(a.y-o.y)/u};return d.x===1/0&&(d.x=0),d.y===1/0&&(d.y=0),d}function jl(t){return t.max-t.min}function vF(t,e=0,r=.01){return Math.abs(t-e)<=r}function e8(t,e,r,o=.5){t.origin=o,t.originPoint=Js(e.min,e.max,t.origin),t.scale=jl(r)/jl(e),(vF(t.scale,1,1e-4)||isNaN(t.scale))&&(t.scale=1),t.translate=Js(r.min,r.max,t.origin)-t.originPoint,(vF(t.translate)||isNaN(t.translate))&&(t.translate=0)}function wC(t,e,r,o){e8(t.x,e.x,r.x,o?o.originX:void 0),e8(t.y,e.y,r.y,o?o.originY:void 0)}function t8(t,e,r){t.min=r.min+e.min,t.max=t.min+jl(e)}function xLe(t,e,r){t8(t.x,e.x,r.x),t8(t.y,e.y,r.y)}function n8(t,e,r){t.min=e.min-r.min,t.max=t.min+jl(e)}function CC(t,e,r){n8(t.x,e.x,r.x),n8(t.y,e.y,r.y)}function MLe(t,{min:e,max:r},o){return e!==void 0&&t<e?t=o?Js(e,t,o.min):Math.max(t,e):r!==void 0&&t>r&&(t=o?Js(r,t,o.max):Math.min(t,r)),t}function r8(t,e,r){return{min:e!==void 0?t.min+e:void 0,max:r!==void 0?t.max+r-(t.max-t.min):void 0}}function ULe(t,{top:e,left:r,bottom:o,right:a}){return{x:r8(t.x,r,a),y:r8(t.y,e,o)}}function i8(t,e){let r=e.min-t.min,o=e.max-t.max;return e.max-e.min<t.max-t.min&&([r,o]=[o,r]),{min:r,max:o}}function VLe(t,e){return{x:i8(t.x,e.x),y:i8(t.y,e.y)}}function FLe(t,e){let r=.5;const o=jl(t),a=jl(e);return a>o?r=JC(e.min,e.max-o,t.min):o>a&&(r=JC(t.min,t.max-a,e.min)),Mg(0,1,r)}function jLe(t,e){const r={};return e.min!==void 0&&(r.min=e.min-t.min),e.max!==void 0&&(r.max=e.max-t.min),r}const _F=.35;function BLe(t=_F){return t===!1?t=0:t===!0&&(t=_F),{x:s8(t,"left","right"),y:s8(t,"top","bottom")}}function s8(t,e,r){return{min:o8(t,e),max:o8(t,r)}}function o8(t,e){return typeof t=="number"?t:t[e]||0}const a8=()=>({translate:0,scale:1,origin:0,originPoint:0}),ZS=()=>({x:a8(),y:a8()}),c8=()=>({min:0,max:0}),ko=()=>({x:c8(),y:c8()});function Sd(t){return[t("x"),t("y")]}function rie({top:t,left:e,right:r,bottom:o}){return{x:{min:e,max:r},y:{min:t,max:o}}}function WLe({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function zLe(t,e){if(!e)return t;const r=e({x:t.left,y:t.top}),o=e({x:t.right,y:t.bottom});return{top:r.y,left:r.x,bottom:o.y,right:o.x}}function jV(t){return t===void 0||t===1}function yF({scale:t,scaleX:e,scaleY:r}){return!jV(t)||!jV(e)||!jV(r)}function P_(t){return yF(t)||iie(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function iie(t){return u8(t.x)||u8(t.y)}function u8(t){return t&&t!=="0%"}function LN(t,e,r){const o=t-r,a=e*o;return r+a}function l8(t,e,r,o,a){return a!==void 0&&(t=LN(t,a,o)),LN(t,r,o)+e}function EF(t,e=0,r=1,o,a){t.min=l8(t.min,e,r,o,a),t.max=l8(t.max,e,r,o,a)}function sie(t,{x:e,y:r}){EF(t.x,e.translate,e.scale,e.originPoint),EF(t.y,r.translate,r.scale,r.originPoint)}function GLe(t,e,r,o=!1){const a=r.length;if(!a)return;e.x=e.y=1;let u,d;for(let f=0;f<a;f++){u=r[f],d=u.projectionDelta;const g=u.instance;g&&g.style&&g.style.display==="contents"||(o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&eT(t,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),d&&(e.x*=d.x.scale,e.y*=d.y.scale,sie(t,d)),o&&P_(u.latestValues)&&eT(t,u.latestValues))}e.x=d8(e.x),e.y=d8(e.y)}function d8(t){return Number.isInteger(t)||t>1.0000000000001||t<.999999999999?t:1}function gg(t,e){t.min=t.min+e,t.max=t.max+e}function h8(t,e,[r,o,a]){const u=e[a]!==void 0?e[a]:.5,d=Js(t.min,t.max,u);EF(t,e[r],e[o],d,e.scale)}const HLe=["x","scaleX","originX"],KLe=["y","scaleY","originY"];function eT(t,e){h8(t.x,e,HLe),h8(t.y,e,KLe)}function oie(t,e){return rie(zLe(t.getBoundingClientRect(),e))}function qLe(t,e,r){const o=oie(t,r),{scroll:a}=e;return a&&(gg(o.x,a.offset.x),gg(o.y,a.offset.y)),o}const aie=({current:t})=>t?t.ownerDocument.defaultView:null,$Le=new WeakMap;class YLe{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ko(),this.visualElement=e}start(e,{snapToCursor:r=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const a=T=>{const{dragSnapToOrigin:C}=this.getProps();C?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(M1(T,"page").point)},u=(T,C)=>{const{drag:I,dragPropagation:D,onDragStart:L}=this.getProps();if(I&&!D&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=Ere(I),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Sd(G=>{let se=this.getAxisMotionValue(G).get()||0;if(mf.test(se)){const{projection:ae}=this.visualElement;if(ae&&ae.layout){const M=ae.layout.layoutBox[G];M&&(se=jl(M)*(parseFloat(se)/100))}}this.originPoint[G]=se}),L&&cs.postRender(()=>L(T,C));const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},d=(T,C)=>{const{dragPropagation:I,dragDirectionLock:D,onDirectionLock:L,onDrag:B}=this.getProps();if(!I&&!this.openGlobalLock)return;const{offset:G}=C;if(D&&this.currentDirection===null){this.currentDirection=XLe(G),this.currentDirection!==null&&L&&L(this.currentDirection);return}this.updateAxis("x",C.point,G),this.updateAxis("y",C.point,G),this.visualElement.render(),B&&B(T,C)},f=(T,C)=>this.stop(T,C),g=()=>Sd(T=>{var C;return this.getAnimationState(T)==="paused"&&((C=this.getAxisMotionValue(T).animation)===null||C===void 0?void 0:C.play())}),{dragSnapToOrigin:E}=this.getProps();this.panSession=new tie(e,{onSessionStart:a,onStart:u,onMove:d,onSessionEnd:f,resumeAnimation:g},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:E,contextWindow:aie(this.visualElement)})}stop(e,r){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:a}=r;this.startAnimation(a);const{onDragEnd:u}=this.getProps();u&&cs.postRender(()=>u(e,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:r}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(e,r,o){const{drag:a}=this.getProps();if(!o||!pP(e,a,this.currentDirection))return;const u=this.getAxisMotionValue(e);let d=this.originPoint[e]+o[e];this.constraints&&this.constraints[e]&&(d=MLe(d,this.constraints[e],this.elastic[e])),u.set(d)}resolveConstraints(){var e;const{dragConstraints:r,dragElastic:o}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,u=this.constraints;r&&JS(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&a?this.constraints=ULe(a.layoutBox,r):this.constraints=!1,this.elastic=BLe(o),u!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&Sd(d=>{this.constraints!==!1&&this.getAxisMotionValue(d)&&(this.constraints[d]=jLe(a.layoutBox[d],this.constraints[d]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:r}=this.getProps();if(!e||!JS(e))return!1;const o=e.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const u=qLe(o,a.root,this.visualElement.getTransformPagePoint());let d=VLe(a.layout.layoutBox,u);if(r){const f=r(WLe(d));this.hasMutatedConstraints=!!f,f&&(d=rie(f))}return d}startAnimation(e){const{drag:r,dragMomentum:o,dragElastic:a,dragTransition:u,dragSnapToOrigin:d,onDragTransitionEnd:f}=this.getProps(),g=this.constraints||{},E=Sd(T=>{if(!pP(T,r,this.currentDirection))return;let C=g&&g[T]||{};d&&(C={min:0,max:0});const I=a?200:1e6,D=a?40:1e7,L={type:"inertia",velocity:o?e[T]:0,bounceStiffness:I,bounceDamping:D,timeConstant:750,restDelta:1,restSpeed:10,...u,...C};return this.startAxisValueAnimation(T,L)});return Promise.all(E).then(f)}startAxisValueAnimation(e,r){const o=this.getAxisMotionValue(e);return o.start(i4(e,o,0,r,this.visualElement))}stopAnimation(){Sd(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Sd(e=>{var r;return(r=this.getAxisMotionValue(e).animation)===null||r===void 0?void 0:r.pause()})}getAnimationState(e){var r;return(r=this.getAxisMotionValue(e).animation)===null||r===void 0?void 0:r.state}getAxisMotionValue(e){const r=`_drag${e.toUpperCase()}`,o=this.visualElement.getProps(),a=o[r];return a||this.visualElement.getValue(e,(o.initial?o.initial[e]:void 0)||0)}snapToCursor(e){Sd(r=>{const{drag:o}=this.getProps();if(!pP(r,o,this.currentDirection))return;const{projection:a}=this.visualElement,u=this.getAxisMotionValue(r);if(a&&a.layout){const{min:d,max:f}=a.layout.layoutBox[r];u.set(e[r]-Js(d,f,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:r}=this.getProps(),{projection:o}=this.visualElement;if(!JS(r)||!o||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};Sd(d=>{const f=this.getAxisMotionValue(d);if(f&&this.constraints!==!1){const g=f.get();a[d]=FLe({min:g,max:g},this.constraints[d])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),Sd(d=>{if(!pP(d,e,null))return;const f=this.getAxisMotionValue(d),{min:g,max:E}=this.constraints[d];f.set(Js(g,E,a[d]))})}addListeners(){if(!this.visualElement.current)return;$Le.set(this.visualElement,this);const e=this.visualElement.current,r=jp(e,"pointerdown",g=>{const{drag:E,dragListener:T=!0}=this.getProps();E&&T&&this.start(g)}),o=()=>{const{dragConstraints:g}=this.getProps();JS(g)&&(this.constraints=this.resolveRefConstraints())},{projection:a}=this.visualElement,u=a.addEventListener("measure",o);a&&!a.layout&&(a.root&&a.root.updateScroll(),a.updateLayout()),o();const d=Dp(window,"resize",()=>this.scalePositionWithinConstraints()),f=a.addEventListener("didUpdate",({delta:g,hasLayoutChanged:E})=>{this.isDragging&&E&&(Sd(T=>{const C=this.getAxisMotionValue(T);C&&(this.originPoint[T]+=g[T].translate,C.set(C.get()+g[T].translate))}),this.visualElement.render())});return()=>{d(),r(),u(),f&&f()}}getProps(){const e=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:o=!1,dragPropagation:a=!1,dragConstraints:u=!1,dragElastic:d=_F,dragMomentum:f=!0}=e;return{...e,drag:r,dragDirectionLock:o,dragPropagation:a,dragConstraints:u,dragElastic:d,dragMomentum:f}}}function pP(t,e,r){return(e===!0||e===t)&&(r===null||r===t)}function XLe(t,e=10){let r=null;return Math.abs(t.y)>e?r="y":Math.abs(t.x)>e&&(r="x"),r}class JLe extends $g{constructor(e){super(e),this.removeGroupControls=Kc,this.removeListeners=Kc,this.controls=new YLe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Kc}unmount(){this.removeGroupControls(),this.removeListeners()}}const f8=t=>(e,r)=>{t&&cs.postRender(()=>t(e,r))};class QLe extends $g{constructor(){super(...arguments),this.removePointerDownListener=Kc}onPointerDown(e){this.session=new tie(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:aie(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:r,onPan:o,onPanEnd:a}=this.node.getProps();return{onSessionStart:f8(e),onStart:f8(r),onMove:o,onEnd:(u,d)=>{delete this.session,a&&cs.postRender(()=>a(u,d))}}}mount(){this.removePointerDownListener=jp(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function cie(){const t=X.useContext(RR);if(t===null)return[!0,null];const{isPresent:e,onExitComplete:r,register:o}=t,a=X.useId();return X.useEffect(()=>o(a),[]),!e&&r?[!1,()=>r&&r(a)]:[!0]}function ZLe(){return exe(X.useContext(RR))}function exe(t){return t===null?!0:t.isPresent}const QP={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function p8(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Ow={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(er.test(t))t=parseFloat(t);else return t;const r=p8(t,e.target.x),o=p8(t,e.target.y);return`${r}% ${o}%`}},txe={correct:(t,{treeScale:e,projectionDelta:r})=>{const o=t,a=Vg.parse(t);if(a.length>5)return o;const u=Vg.createTransformer(t),d=typeof a[0]!="number"?1:0,f=r.x.scale*e.x,g=r.y.scale*e.y;a[0+d]/=f,a[1+d]/=g;const E=Js(f,g,.5);return typeof a[2+d]=="number"&&(a[2+d]/=E),typeof a[3+d]=="number"&&(a[3+d]/=E),u(a)}};class nxe extends X.Component{componentDidMount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:o,layoutId:a}=this.props,{projection:u}=e;ZNe(rxe),u&&(r.group&&r.group.add(u),o&&o.register&&a&&o.register(u),u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),QP.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:r,visualElement:o,drag:a,isPresent:u}=this.props,d=o.projection;return d&&(d.isPresent=u,a||e.layoutDependency!==r||r===void 0?d.willUpdate():this.safeToRemove(),e.isPresent!==u&&(u?d.promote():d.relegate()||cs.postRender(()=>{const f=d.getStack();(!f||!f.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),MB.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:o}=this.props,{projection:a}=e;a&&(a.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(a),o&&o.deregister&&o.deregister(a))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function uie(t){const[e,r]=cie(),o=X.useContext(FB);return $.jsx(nxe,{...t,layoutGroup:o,switchLayoutGroup:X.useContext(ire),isPresent:e,safeToRemove:r})}const rxe={borderRadius:{...Ow,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ow,borderTopRightRadius:Ow,borderBottomLeftRadius:Ow,borderBottomRightRadius:Ow,boxShadow:txe},lie=["TopLeft","TopRight","BottomLeft","BottomRight"],ixe=lie.length,m8=t=>typeof t=="string"?parseFloat(t):t,g8=t=>typeof t=="number"||er.test(t);function sxe(t,e,r,o,a,u){a?(t.opacity=Js(0,r.opacity!==void 0?r.opacity:1,oxe(o)),t.opacityExit=Js(e.opacity!==void 0?e.opacity:1,0,axe(o))):u&&(t.opacity=Js(e.opacity!==void 0?e.opacity:1,r.opacity!==void 0?r.opacity:1,o));for(let d=0;d<ixe;d++){const f=`border${lie[d]}Radius`;let g=v8(e,f),E=v8(r,f);if(g===void 0&&E===void 0)continue;g||(g=0),E||(E=0),g===0||E===0||g8(g)===g8(E)?(t[f]=Math.max(Js(m8(g),m8(E),o),0),(mf.test(E)||mf.test(g))&&(t[f]+="%")):t[f]=E}(e.rotate||r.rotate)&&(t.rotate=Js(e.rotate||0,r.rotate||0,o))}function v8(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const oxe=die(0,.5,qre),axe=die(.5,.95,Kc);function die(t,e,r){return o=>o<t?0:o>e?1:r(JC(t,e,o))}function _8(t,e){t.min=e.min,t.max=e.max}function _d(t,e){_8(t.x,e.x),_8(t.y,e.y)}function y8(t,e,r,o,a){return t-=e,t=LN(t,1/r,o),a!==void 0&&(t=LN(t,1/a,o)),t}function cxe(t,e=0,r=1,o=.5,a,u=t,d=t){if(mf.test(e)&&(e=parseFloat(e),e=Js(d.min,d.max,e/100)-d.min),typeof e!="number")return;let f=Js(u.min,u.max,o);t===u&&(f-=e),t.min=y8(t.min,e,r,f,a),t.max=y8(t.max,e,r,f,a)}function E8(t,e,[r,o,a],u,d){cxe(t,e[r],e[o],e[a],e.scale,u,d)}const uxe=["x","scaleX","originX"],lxe=["y","scaleY","originY"];function S8(t,e,r,o){E8(t.x,e,uxe,r?r.x:void 0,o?o.x:void 0),E8(t.y,e,lxe,r?r.y:void 0,o?o.y:void 0)}function T8(t){return t.translate===0&&t.scale===1}function hie(t){return T8(t.x)&&T8(t.y)}function dxe(t,e){return t.x.min===e.x.min&&t.x.max===e.x.max&&t.y.min===e.y.min&&t.y.max===e.y.max}function fie(t,e){return Math.round(t.x.min)===Math.round(e.x.min)&&Math.round(t.x.max)===Math.round(e.x.max)&&Math.round(t.y.min)===Math.round(e.y.min)&&Math.round(t.y.max)===Math.round(e.y.max)}function b8(t){return jl(t.x)/jl(t.y)}class hxe{constructor(){this.members=[]}add(e){s4(this.members,e),e.scheduleRender()}remove(e){if(o4(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(e){const r=this.members.findIndex(a=>e===a);if(r===0)return!1;let o;for(let a=r;a>=0;a--){const u=this.members[a];if(u.isPresent!==!1){o=u;break}}return o?(this.promote(o),!0):!1}promote(e,r){const o=this.lead;if(e!==o&&(this.prevLead=o,this.lead=e,e.show(),o)){o.instance&&o.scheduleRender(),e.scheduleRender(),e.resumeFrom=o,r&&(e.resumeFrom.preserveOpacity=!0),o.snapshot&&(e.snapshot=o.snapshot,e.snapshot.latestValues=o.animationValues||o.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:a}=e.options;a===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:r,resumingFrom:o}=e;r.onExitComplete&&r.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function w8(t,e,r){let o="";const a=t.x.translate/e.x,u=t.y.translate/e.y,d=(r==null?void 0:r.z)||0;if((a||u||d)&&(o=`translate3d(${a}px, ${u}px, ${d}px) `),(e.x!==1||e.y!==1)&&(o+=`scale(${1/e.x}, ${1/e.y}) `),r){const{transformPerspective:E,rotate:T,rotateX:C,rotateY:I,skewX:D,skewY:L}=r;E&&(o=`perspective(${E}px) ${o}`),T&&(o+=`rotate(${T}deg) `),C&&(o+=`rotateX(${C}deg) `),I&&(o+=`rotateY(${I}deg) `),D&&(o+=`skewX(${D}deg) `),L&&(o+=`skewY(${L}deg) `)}const f=t.x.scale*e.x,g=t.y.scale*e.y;return(f!==1||g!==1)&&(o+=`scale(${f}, ${g})`),o||"none"}const fxe=(t,e)=>t.depth-e.depth;class pxe{constructor(){this.children=[],this.isDirty=!1}add(e){s4(this.children,e),this.isDirty=!0}remove(e){o4(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(fxe),this.isDirty=!1,this.children.forEach(e)}}function mxe(t,e){const r=Ig.now(),o=({timestamp:a})=>{const u=a-r;u>=e&&(Ug(o),t(u-e))};return cs.read(o,!0),()=>Ug(o)}function gxe(t){window.MotionDebug&&window.MotionDebug.record(t)}function vxe(t){return t instanceof SVGElement&&t.tagName!=="svg"}function _xe(t,e,r){const o=Hc(t)?t:QC(t);return o.start(i4("",o,e,r)),o.animation}const BV=["","X","Y","Z"],yxe={visibility:"hidden"},C8=1e3;let Exe=0;const N_={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function WV(t,e,r,o){const{latestValues:a}=e;a[t]&&(r[t]=a[t],e.setStaticValue(t,0),o&&(o[t]=0))}function pie({attachResizeListener:t,defaultParent:e,measureScroll:r,checkIsScrollRoot:o,resetTransform:a}){return class{constructor(d={},f=e==null?void 0:e()){this.id=Exe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,N_.totalNodes=N_.resolvedTargetDeltas=N_.recalculatedProjection=0,this.nodes.forEach(bxe),this.nodes.forEach(Axe),this.nodes.forEach(kxe),this.nodes.forEach(wxe),gxe(N_)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=d,this.root=f?f.root||f:this,this.path=f?[...f.path,f]:[],this.parent=f,this.depth=f?f.depth+1:0;for(let g=0;g<this.path.length;g++)this.path[g].shouldResetTransform=!0;this.root===this&&(this.nodes=new pxe)}addEventListener(d,f){return this.eventHandlers.has(d)||this.eventHandlers.set(d,new a4),this.eventHandlers.get(d).add(f)}notifyListeners(d,...f){const g=this.eventHandlers.get(d);g&&g.notify(...f)}hasListeners(d){return this.eventHandlers.has(d)}mount(d,f=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=vxe(d),this.instance=d;const{layoutId:g,layout:E,visualElement:T}=this.options;if(T&&!T.current&&T.mount(d),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),f&&(E||g)&&(this.isLayoutDirty=!0),t){let C;const I=()=>this.root.updateBlockedByResize=!1;t(d,()=>{this.root.updateBlockedByResize=!0,C&&C(),C=mxe(I,250),QP.hasAnimatedSinceResize&&(QP.hasAnimatedSinceResize=!1,this.nodes.forEach(I8))})}g&&this.root.registerSharedNode(g,this),this.options.animate!==!1&&T&&(g||E)&&this.addEventListener("didUpdate",({delta:C,hasLayoutChanged:I,hasRelativeTargetChanged:D,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||T.getDefaultTransition()||Lxe,{onLayoutAnimationStart:G,onLayoutAnimationComplete:se}=T.getProps(),ae=!this.targetLayout||!fie(this.targetLayout,L)||D,M=!I&&D;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||M||I&&(ae||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(C,M);const F={...YB(B,"layout"),onPlay:G,onComplete:se};(T.shouldReduceMotion||this.options.layoutRoot)&&(F.delay=0,F.type=!1),this.startAnimation(F)}else I||I8(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const d=this.getStack();d&&d.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ug(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,window.HandoffCancelAllAnimations&&window.HandoffCancelAllAnimations(),this.nodes&&this.nodes.forEach(Oxe),this.animationId++)}getTransformTemplate(){const{visualElement:d}=this.options;return d&&d.getProps().transformTemplate}willUpdate(d=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let T=0;T<this.path.length;T++){const C=this.path[T];C.shouldResetTransform=!0,C.updateScroll("snapshot"),C.options.layoutRoot&&C.willUpdate(!1)}const{layoutId:f,layout:g}=this.options;if(f===void 0&&!g)return;const E=this.getTransformTemplate();this.prevTransformTemplateValue=E?E(this.latestValues,""):void 0,this.updateSnapshot(),d&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(R8);return}this.isUpdating||this.nodes.forEach(Rxe),this.isUpdating=!1,this.nodes.forEach(Ixe),this.nodes.forEach(Sxe),this.nodes.forEach(Txe),this.clearAllSnapshots();const f=Ig.now();uc.delta=Mg(0,1e3/60,f-uc.timestamp),uc.timestamp=f,uc.isProcessing=!0,NV.update.process(uc),NV.preRender.process(uc),NV.render.process(uc),uc.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,MB.read(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(Cxe),this.sharedNodes.forEach(Pxe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,cs.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){cs.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let g=0;g<this.path.length;g++)this.path[g].updateScroll();const d=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ko(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:f}=this.options;f&&f.notify("LayoutMeasure",this.layout.layoutBox,d?d.layoutBox:void 0)}updateScroll(d="measure"){let f=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===d&&(f=!1),f&&(this.scroll={animationId:this.root.animationId,phase:d,isRoot:o(this.instance),offset:r(this.instance)})}resetTransform(){if(!a)return;const d=this.isLayoutDirty||this.shouldResetTransform,f=this.projectionDelta&&!hie(this.projectionDelta),g=this.getTransformTemplate(),E=g?g(this.latestValues,""):void 0,T=E!==this.prevTransformTemplateValue;d&&(f||P_(this.latestValues)||T)&&(a(this.instance,E),this.shouldResetTransform=!1,this.scheduleRender())}measure(d=!0){const f=this.measurePageBox();let g=this.removeElementScroll(f);return d&&(g=this.removeTransform(g)),xxe(g),{animationId:this.root.animationId,measuredBox:f,layoutBox:g,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:d}=this.options;if(!d)return ko();const f=d.measureViewportBox(),{scroll:g}=this.root;return g&&(gg(f.x,g.offset.x),gg(f.y,g.offset.y)),f}removeElementScroll(d){const f=ko();_d(f,d);for(let g=0;g<this.path.length;g++){const E=this.path[g],{scroll:T,options:C}=E;if(E!==this.root&&T&&C.layoutScroll){if(T.isRoot){_d(f,d);const{scroll:I}=this.root;I&&(gg(f.x,-I.offset.x),gg(f.y,-I.offset.y))}gg(f.x,T.offset.x),gg(f.y,T.offset.y)}}return f}applyTransform(d,f=!1){const g=ko();_d(g,d);for(let E=0;E<this.path.length;E++){const T=this.path[E];!f&&T.options.layoutScroll&&T.scroll&&T!==T.root&&eT(g,{x:-T.scroll.offset.x,y:-T.scroll.offset.y}),P_(T.latestValues)&&eT(g,T.latestValues)}return P_(this.latestValues)&&eT(g,this.latestValues),g}removeTransform(d){const f=ko();_d(f,d);for(let g=0;g<this.path.length;g++){const E=this.path[g];if(!E.instance||!P_(E.latestValues))continue;yF(E.latestValues)&&E.updateSnapshot();const T=ko(),C=E.measurePageBox();_d(T,C),S8(f,E.latestValues,E.snapshot?E.snapshot.layoutBox:void 0,T)}return P_(this.latestValues)&&S8(f,this.latestValues),f}setTargetDelta(d){this.targetDelta=d,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(d){this.options={...this.options,...d,crossfade:d.crossfade!==void 0?d.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==uc.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(d=!1){var f;const g=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=g.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=g.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=g.isSharedProjectionDirty);const E=!!this.resumingFrom||this!==g;if(!(d||E&&this.isSharedProjectionDirty||this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:C,layoutId:I}=this.options;if(!(!this.layout||!(C||I))){if(this.resolvedRelativeTargetAt=uc.timestamp,!this.targetDelta&&!this.relativeTarget){const D=this.getClosestProjectingParent();D&&D.layout&&this.animationProgress!==1?(this.relativeParent=D,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ko(),this.relativeTargetOrigin=ko(),CC(this.relativeTargetOrigin,this.layout.layoutBox,D.layout.layoutBox),_d(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=ko(),this.targetWithTransforms=ko()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),xLe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):_d(this.target,this.layout.layoutBox),sie(this.target,this.targetDelta)):_d(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const D=this.getClosestProjectingParent();D&&!!D.resumingFrom==!!this.resumingFrom&&!D.options.layoutScroll&&D.target&&this.animationProgress!==1?(this.relativeParent=D,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ko(),this.relativeTargetOrigin=ko(),CC(this.relativeTargetOrigin,this.target,D.target),_d(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}N_.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||yF(this.parent.latestValues)||iie(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var d;const f=this.getLead(),g=!!this.resumingFrom||this!==f;let E=!0;if((this.isProjectionDirty||!((d=this.parent)===null||d===void 0)&&d.isProjectionDirty)&&(E=!1),g&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(E=!1),this.resolvedRelativeTargetAt===uc.timestamp&&(E=!1),E)return;const{layout:T,layoutId:C}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(T||C))return;_d(this.layoutCorrected,this.layout.layoutBox);const I=this.treeScale.x,D=this.treeScale.y;GLe(this.layoutCorrected,this.treeScale,this.path,g),f.layout&&!f.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(f.target=f.layout.layoutBox,f.targetWithTransforms=ko());const{target:L}=f;if(!L){this.projectionTransform&&(this.projectionDelta=ZS(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=ZS(),this.projectionDeltaWithTransform=ZS());const B=this.projectionTransform;wC(this.projectionDelta,this.layoutCorrected,L,this.latestValues),this.projectionTransform=w8(this.projectionDelta,this.treeScale),(this.projectionTransform!==B||this.treeScale.x!==I||this.treeScale.y!==D)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L)),N_.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(d=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),d){const f=this.getStack();f&&f.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(d,f=!1){const g=this.snapshot,E=g?g.latestValues:{},T={...this.latestValues},C=ZS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!f;const I=ko(),D=g?g.source:void 0,L=this.layout?this.layout.source:void 0,B=D!==L,G=this.getStack(),se=!G||G.members.length<=1,ae=!!(B&&!se&&this.options.crossfade===!0&&!this.path.some(Dxe));this.animationProgress=0;let M;this.mixTargetDelta=F=>{const z=F/1e3;A8(C.x,d.x,z),A8(C.y,d.y,z),this.setTargetDelta(C),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(CC(I,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Nxe(this.relativeTarget,this.relativeTargetOrigin,I,z),M&&dxe(this.relativeTarget,M)&&(this.isProjectionDirty=!1),M||(M=ko()),_d(M,this.relativeTarget)),B&&(this.animationValues=T,sxe(T,E,this.latestValues,z,ae,se)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=z},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(d){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ug(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=cs.update(()=>{QP.hasAnimatedSinceResize=!0,this.currentAnimation=_xe(0,C8,{...d,onUpdate:f=>{this.mixTargetDelta(f),d.onUpdate&&d.onUpdate(f)},onComplete:()=>{d.onComplete&&d.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const d=this.getStack();d&&d.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(C8),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const d=this.getLead();let{targetWithTransforms:f,target:g,layout:E,latestValues:T}=d;if(!(!f||!g||!E)){if(this!==d&&this.layout&&E&&mie(this.options.animationType,this.layout.layoutBox,E.layoutBox)){g=this.target||ko();const C=jl(this.layout.layoutBox.x);g.x.min=d.target.x.min,g.x.max=g.x.min+C;const I=jl(this.layout.layoutBox.y);g.y.min=d.target.y.min,g.y.max=g.y.min+I}_d(f,g),eT(f,T),wC(this.projectionDeltaWithTransform,this.layoutCorrected,f,T)}}registerSharedNode(d,f){this.sharedNodes.has(d)||this.sharedNodes.set(d,new hxe),this.sharedNodes.get(d).add(f);const E=f.options.initialPromotionConfig;f.promote({transition:E?E.transition:void 0,preserveFollowOpacity:E&&E.shouldPreserveFollowOpacity?E.shouldPreserveFollowOpacity(f):void 0})}isLead(){const d=this.getStack();return d?d.lead===this:!0}getLead(){var d;const{layoutId:f}=this.options;return f?((d=this.getStack())===null||d===void 0?void 0:d.lead)||this:this}getPrevLead(){var d;const{layoutId:f}=this.options;return f?(d=this.getStack())===null||d===void 0?void 0:d.prevLead:void 0}getStack(){const{layoutId:d}=this.options;if(d)return this.root.sharedNodes.get(d)}promote({needsReset:d,transition:f,preserveFollowOpacity:g}={}){const E=this.getStack();E&&E.promote(this,g),d&&(this.projectionDelta=void 0,this.needsReset=!0),f&&this.setOptions({transition:f})}relegate(){const d=this.getStack();return d?d.relegate(this):!1}resetSkewAndRotation(){const{visualElement:d}=this.options;if(!d)return;let f=!1;const{latestValues:g}=d;if((g.z||g.rotate||g.rotateX||g.rotateY||g.rotateZ||g.skewX||g.skewY)&&(f=!0),!f)return;const E={};g.z&&WV("z",d,E,this.animationValues);for(let T=0;T<BV.length;T++)WV(`rotate${BV[T]}`,d,E,this.animationValues),WV(`skew${BV[T]}`,d,E,this.animationValues);d.render();for(const T in E)d.setStaticValue(T,E[T]),this.animationValues&&(this.animationValues[T]=E[T]);d.scheduleRender()}getProjectionStyles(d){var f,g;if(!this.instance||this.isSVG)return;if(!this.isVisible)return yxe;const E={visibility:""},T=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,E.opacity="",E.pointerEvents=XP(d==null?void 0:d.pointerEvents)||"",E.transform=T?T(this.latestValues,""):"none",E;const C=this.getLead();if(!this.projectionDelta||!this.layout||!C.target){const B={};return this.options.layoutId&&(B.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,B.pointerEvents=XP(d==null?void 0:d.pointerEvents)||""),this.hasProjected&&!P_(this.latestValues)&&(B.transform=T?T({},""):"none",this.hasProjected=!1),B}const I=C.animationValues||C.latestValues;this.applyTransformsToTarget(),E.transform=w8(this.projectionDeltaWithTransform,this.treeScale,I),T&&(E.transform=T(I,E.transform));const{x:D,y:L}=this.projectionDelta;E.transformOrigin=`${D.origin*100}% ${L.origin*100}% 0`,C.animationValues?E.opacity=C===this?(g=(f=I.opacity)!==null&&f!==void 0?f:this.latestValues.opacity)!==null&&g!==void 0?g:1:this.preserveOpacity?this.latestValues.opacity:I.opacityExit:E.opacity=C===this?I.opacity!==void 0?I.opacity:"":I.opacityExit!==void 0?I.opacityExit:0;for(const B in kN){if(I[B]===void 0)continue;const{correct:G,applyTo:se}=kN[B],ae=E.transform==="none"?I[B]:G(I[B],C);if(se){const M=se.length;for(let F=0;F<M;F++)E[se[F]]=ae}else E[B]=ae}return this.options.layoutId&&(E.pointerEvents=C===this?XP(d==null?void 0:d.pointerEvents)||"":"none"),E}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(d=>{var f;return(f=d.currentAnimation)===null||f===void 0?void 0:f.stop()}),this.root.nodes.forEach(R8),this.root.sharedNodes.clear()}}}function Sxe(t){t.updateLayout()}function Txe(t){var e;const r=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&r&&t.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:a}=t.layout,{animationType:u}=t.options,d=r.source!==t.layout.source;u==="size"?Sd(C=>{const I=d?r.measuredBox[C]:r.layoutBox[C],D=jl(I);I.min=o[C].min,I.max=I.min+D}):mie(u,r.layoutBox,o)&&Sd(C=>{const I=d?r.measuredBox[C]:r.layoutBox[C],D=jl(o[C]);I.max=I.min+D,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[C].max=t.relativeTarget[C].min+D)});const f=ZS();wC(f,o,r.layoutBox);const g=ZS();d?wC(g,t.applyTransform(a,!0),r.measuredBox):wC(g,o,r.layoutBox);const E=!hie(f);let T=!1;if(!t.resumeFrom){const C=t.getClosestProjectingParent();if(C&&!C.resumeFrom){const{snapshot:I,layout:D}=C;if(I&&D){const L=ko();CC(L,r.layoutBox,I.layoutBox);const B=ko();CC(B,o,D.layoutBox),fie(L,B)||(T=!0),C.options.layoutRoot&&(t.relativeTarget=B,t.relativeTargetOrigin=L,t.relativeParent=C)}}}t.notifyListeners("didUpdate",{layout:o,snapshot:r,delta:g,layoutDelta:f,hasLayoutChanged:E,hasRelativeTargetChanged:T})}else if(t.isLead()){const{onExitComplete:o}=t.options;o&&o()}t.options.transition=void 0}function bxe(t){N_.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function wxe(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function Cxe(t){t.clearSnapshot()}function R8(t){t.clearMeasurements()}function Rxe(t){t.isLayoutDirty=!1}function Ixe(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function I8(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function Axe(t){t.resolveTargetDelta()}function kxe(t){t.calcProjection()}function Oxe(t){t.resetSkewAndRotation()}function Pxe(t){t.removeLeadSnapshot()}function A8(t,e,r){t.translate=Js(e.translate,0,r),t.scale=Js(e.scale,1,r),t.origin=e.origin,t.originPoint=e.originPoint}function k8(t,e,r,o){t.min=Js(e.min,r.min,o),t.max=Js(e.max,r.max,o)}function Nxe(t,e,r,o){k8(t.x,e.x,r.x,o),k8(t.y,e.y,r.y,o)}function Dxe(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const Lxe={duration:.45,ease:[.4,0,.1,1]},O8=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),P8=O8("applewebkit/")&&!O8("chrome/")?Math.round:Kc;function N8(t){t.min=P8(t.min),t.max=P8(t.max)}function xxe(t){N8(t.x),N8(t.y)}function mie(t,e,r){return t==="position"||t==="preserve-aspect"&&!vF(b8(e),b8(r),.2)}const Mxe=pie({attachResizeListener:(t,e)=>Dp(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),zV={current:void 0},gie=pie({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!zV.current){const t=new Mxe({});t.mount(window),t.setOptions({layoutScroll:!0}),zV.current=t}return zV.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),Uxe={pan:{Feature:QLe},drag:{Feature:JLe,ProjectionNode:gie,MeasureLayout:uie}},SF={current:null},vie={current:!1};function Vxe(){if(vie.current=!0,!!DB)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>SF.current=t.matches;t.addListener(e),e()}else SF.current=!1}function Fxe(t,e,r){const{willChange:o}=e;for(const a in e){const u=e[a],d=r[a];if(Hc(u))t.addValue(a,u),DN(o)&&o.add(a);else if(Hc(d))t.addValue(a,QC(u,{owner:t})),DN(o)&&o.remove(a);else if(d!==u)if(t.hasValue(a)){const f=t.getValue(a);f.liveStyle===!0?f.jump(u):f.hasAnimated||f.set(u)}else{const f=t.getStaticValue(a);t.addValue(a,QC(f!==void 0?f:u,{owner:t}))}}for(const a in r)e[a]===void 0&&t.removeValue(a);return e}const D8=new WeakMap,jxe=[...kre,Bc,Vg],Bxe=t=>jxe.find(Are(t)),_ie=Object.keys(YC),Wxe=_ie.length,L8=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],zxe=VB.length;function yie(t){if(t)return t.options.allowProjection!==!1?t.projection:yie(t.parent)}class Gxe{scrapeMotionValuesFromProps(e,r,o){return{}}constructor({parent:e,props:r,presenceContext:o,reducedMotionConfig:a,blockInitialAnimation:u,visualState:d},f={}){this.resolveKeyframes=(I,D,L,B)=>new this.KeyframeResolver(I,D,L,B,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=XB,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>cs.render(this.render,!1,!0);const{latestValues:g,renderState:E}=d;this.latestValues=g,this.baseTarget={...g},this.initialValues=r.initial?{...g}:{},this.renderState=E,this.parent=e,this.props=r,this.presenceContext=o,this.depth=e?e.depth+1:0,this.reducedMotionConfig=a,this.options=f,this.blockInitialAnimation=!!u,this.isControllingVariants=x1(r),this.isVariantNode=rre(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:T,...C}=this.scrapeMotionValuesFromProps(r,{},this);for(const I in C){const D=C[I];g[I]!==void 0&&Hc(D)&&(D.set(g[I],!1),DN(T)&&T.add(I))}}mount(e){this.current=e,D8.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,o)=>this.bindToMotionValue(o,r)),vie.current||Vxe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:SF.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){var e;D8.delete(this.current),this.projection&&this.projection.unmount(),Ug(this.notifyUpdate),Ug(this.render),this.valueSubscriptions.forEach(r=>r()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const r in this.events)this.events[r].clear();for(const r in this.features)(e=this.features[r])===null||e===void 0||e.unmount();this.current=null}bindToMotionValue(e,r){const o=wy.has(e),a=r.on("change",d=>{this.latestValues[e]=d,this.props.onUpdate&&cs.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),u=r.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{a(),u(),r.owner&&r.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...r},o,a,u){let d,f;for(let g=0;g<Wxe;g++){const E=_ie[g],{isEnabled:T,Feature:C,ProjectionNode:I,MeasureLayout:D}=YC[E];I&&(d=I),T(r)&&(!this.features[E]&&C&&(this.features[E]=new C(this)),D&&(f=D))}if((this.type==="html"||this.type==="svg")&&!this.projection&&d){const{layoutId:g,layout:E,drag:T,dragConstraints:C,layoutScroll:I,layoutRoot:D}=r;this.projection=new d(this.latestValues,r["data-framer-portal-id"]?void 0:yie(this.parent)),this.projection.setOptions({layoutId:g,layout:E,alwaysMeasureLayout:!!T||C&&JS(C),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof E=="string"?E:"both",initialPromotionConfig:u,layoutScroll:I,layoutRoot:D})}return f}updateFeatures(){for(const e in this.features){const r=this.features[e];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ko()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,r){this.latestValues[e]=r}update(e,r){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let o=0;o<L8.length;o++){const a=L8[o];this.propEventSubscriptions[a]&&(this.propEventSubscriptions[a](),delete this.propEventSubscriptions[a]);const u="on"+a,d=e[u];d&&(this.propEventSubscriptions[a]=this.on(a,d))}this.prevMotionValues=Fxe(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const o=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(o.initial=this.props.initial),o}const r={};for(let o=0;o<zxe;o++){const a=VB[o],u=this.props[a];($C(u)||u===!1)&&(r[a]=u)}return r}addVariantChild(e){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(e),()=>r.variantChildren.delete(e)}addValue(e,r){const o=this.values.get(e);r!==o&&(o&&this.removeValue(e),this.bindToMotionValue(e,r),this.values.set(e,r),this.latestValues[e]=r.get())}removeValue(e){this.values.delete(e);const r=this.valueSubscriptions.get(e);r&&(r(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,r){if(this.props.values&&this.props.values[e])return this.props.values[e];let o=this.values.get(e);return o===void 0&&r!==void 0&&(o=QC(r===null?void 0:r,{owner:this}),this.addValue(e,o)),o}readValue(e,r){var o;let a=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(o=this.getBaseTargetFromProps(this.props,e))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,e,this.options);return a!=null&&(typeof a=="string"&&(Rre(a)||wre(a))?a=parseFloat(a):!Bxe(a)&&Vg.test(r)&&(a=Ure(e,r)),this.setBaseTarget(e,Hc(a)?a.get():a)),Hc(a)?a.get():a}setBaseTarget(e,r){this.baseTarget[e]=r}getBaseTarget(e){var r;const{initial:o}=this.props;let a;if(typeof o=="string"||typeof o=="object"){const d=$B(this.props,o,(r=this.presenceContext)===null||r===void 0?void 0:r.custom);d&&(a=d[e])}if(o&&a!==void 0)return a;const u=this.getBaseTargetFromProps(this.props,e);return u!==void 0&&!Hc(u)?u:this.initialValues[e]!==void 0&&a===void 0?void 0:this.baseTarget[e]}on(e,r){return this.events[e]||(this.events[e]=new a4),this.events[e].add(r)}notify(e,...r){this.events[e]&&this.events[e].notify(...r)}}class Eie extends Gxe{constructor(){super(...arguments),this.KeyframeResolver=Vre}sortInstanceNodePosition(e,r){return e.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(e,r){return e.style?e.style[r]:void 0}removeValueFromRenderState(e,{vars:r,style:o}){delete r[e],delete o[e]}}function Hxe(t){return window.getComputedStyle(t)}class Kxe extends Eie{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,r){if(wy.has(r)){const o=QB(r);return o&&o.default||0}else{const o=Hxe(e),a=(are(r)?o.getPropertyValue(r):o[r])||0;return typeof a=="string"?a.trim():a}}measureInstanceViewportBox(e,{transformPagePoint:r}){return oie(e,r)}build(e,r,o,a){zB(e,r,o,a.transformTemplate)}scrapeMotionValuesFromProps(e,r,o){return qB(e,r,o)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Hc(e)&&(this.childSubscription=e.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}renderInstance(e,r,o,a){hre(e,r,o,a)}}class qxe extends Eie{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,r){return e[r]}readValueFromInstance(e,r){if(wy.has(r)){const o=QB(r);return o&&o.default||0}return r=fre.has(r)?r:xB(r),e.getAttribute(r)}measureInstanceViewportBox(){return ko()}scrapeMotionValuesFromProps(e,r,o){return mre(e,r,o)}build(e,r,o,a){HB(e,r,o,this.isSVGTag,a.transformTemplate)}renderInstance(e,r,o,a){pre(e,r,o,a)}mount(e){this.isSVGTag=KB(e.tagName),super.mount(e)}}const $xe=(t,e)=>jB(t)?new qxe(e,{enableHardwareAcceleration:!1}):new Kxe(e,{allowProjection:t!==X.Fragment,enableHardwareAcceleration:!0}),Yxe={layout:{ProjectionNode:gie,MeasureLayout:uie}},Xxe={...PLe,...B1e,...Uxe,...Yxe},im=JNe((t,e)=>A1e(t,e,Xxe,$xe));function Sie(){const t=X.useRef(!1);return LB(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function Jxe(){const t=Sie(),[e,r]=X.useState(0),o=X.useCallback(()=>{t.current&&r(e+1)},[e]);return[X.useCallback(()=>cs.postRender(o),[o]),e]}class Qxe extends X.Component{getSnapshotBeforeUpdate(e){const r=this.props.childRef.current;if(r&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=r.offsetHeight||0,o.width=r.offsetWidth||0,o.top=r.offsetTop,o.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Zxe({children:t,isPresent:e}){const r=X.useId(),o=X.useRef(null),a=X.useRef({width:0,height:0,top:0,left:0}),{nonce:u}=X.useContext(NB);return X.useInsertionEffect(()=>{const{width:d,height:f,top:g,left:E}=a.current;if(e||!o.current||!d||!f)return;o.current.dataset.motionPopId=r;const T=document.createElement("style");return u&&(T.nonce=u),document.head.appendChild(T),T.sheet&&T.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${f}px !important;
            top: ${g}px !important;
            left: ${E}px !important;
          }
        `),()=>{document.head.removeChild(T)}},[e]),$.jsx(Qxe,{isPresent:e,childRef:o,sizeRef:a,children:X.cloneElement(t,{ref:o})})}const GV=({children:t,initial:e,isPresent:r,onExitComplete:o,custom:a,presenceAffectsLayout:u,mode:d})=>{const f=gre(eMe),g=X.useId(),E=X.useMemo(()=>({id:g,initial:e,isPresent:r,custom:a,onExitComplete:T=>{f.set(T,!0);for(const C of f.values())if(!C)return;o&&o()},register:T=>(f.set(T,!1),()=>f.delete(T))}),u?[Math.random()]:[r]);return X.useMemo(()=>{f.forEach((T,C)=>f.set(C,!1))},[r]),X.useEffect(()=>{!r&&!f.size&&o&&o()},[r]),d==="popLayout"&&(t=$.jsx(Zxe,{isPresent:r,children:t})),$.jsx(RR.Provider,{value:E,children:t})};function eMe(){return new Map}function tMe(t){return X.useEffect(()=>()=>t(),[])}const D_=t=>t.key||"";function nMe(t,e){t.forEach(r=>{const o=D_(r);e.set(o,r)})}function rMe(t){const e=[];return X.Children.forEach(t,r=>{X.isValidElement(r)&&e.push(r)}),e}const YT=({children:t,custom:e,initial:r=!0,onExitComplete:o,exitBeforeEnter:a,presenceAffectsLayout:u=!0,mode:d="sync"})=>{const f=X.useContext(FB).forceRender||Jxe()[0],g=Sie(),E=rMe(t);let T=E;const C=X.useRef(new Map).current,I=X.useRef(T),D=X.useRef(new Map).current,L=X.useRef(!0);if(LB(()=>{L.current=!1,nMe(E,D),I.current=T}),tMe(()=>{L.current=!0,D.clear(),C.clear()}),L.current)return $.jsx($.Fragment,{children:T.map(ae=>$.jsx(GV,{isPresent:!0,initial:r?void 0:!1,presenceAffectsLayout:u,mode:d,children:ae},D_(ae)))});T=[...T];const B=I.current.map(D_),G=E.map(D_),se=B.length;for(let ae=0;ae<se;ae++){const M=B[ae];G.indexOf(M)===-1&&!C.has(M)&&C.set(M,void 0)}return d==="wait"&&C.size&&(T=[]),C.forEach((ae,M)=>{if(G.indexOf(M)!==-1)return;const F=D.get(M);if(!F)return;const z=B.indexOf(M);let te=ae;if(!te){const j=()=>{C.delete(M);const K=Array.from(D.keys()).filter(Q=>!G.includes(Q));if(K.forEach(Q=>D.delete(Q)),I.current=E.filter(Q=>{const ce=D_(Q);return ce===M||K.includes(ce)}),!C.size){if(g.current===!1)return;f(),o&&o()}};te=$.jsx(GV,{isPresent:!1,onExitComplete:j,custom:e,presenceAffectsLayout:u,mode:d,children:F},D_(F)),C.set(M,te)}T.splice(z,0,te)}),T=T.map(ae=>{const M=ae.key;return C.has(M)?ae:$.jsx(GV,{isPresent:!0,presenceAffectsLayout:u,mode:d,children:ae},D_(ae))}),$.jsx($.Fragment,{children:C.size?T:T.map(ae=>X.cloneElement(ae))})};var iMe={initial:t=>{const{position:e}=t,r=["top","bottom"].includes(e)?"y":"x";let o=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(o=1),{opacity:0,[r]:o*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},Tie=X.memo(t=>{const{id:e,message:r,onCloseComplete:o,onRequestRemove:a,requestClose:u=!1,position:d="bottom",duration:f=5e3,containerStyle:g,motionVariants:E=iMe,toastSpacing:T="0.5rem"}=t,[C,I]=X.useState(f),D=ZLe();ay(()=>{D||o==null||o()},[D]),ay(()=>{I(f)},[f]);const L=()=>I(null),B=()=>I(f),G=()=>{D&&a()};X.useEffect(()=>{D&&u&&a()},[D,u,a]),VNe(G,C);const se=X.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:T,...g}),[g,T]),ae=X.useMemo(()=>MNe(d),[d]);return $.jsx(im.div,{layout:!0,className:"chakra-toast",variants:E,initial:"initial",animate:"animate",exit:"exit",onHoverStart:L,onHoverEnd:B,custom:{position:d},style:ae,children:$.jsx(Yt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:se,children:bd(r,{id:e,onClose:G})})})});Tie.displayName="ToastComponent";function sMe(t,e){var r;const o=t??"bottom",u={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[o];return(r=u==null?void 0:u[e])!=null?r:o}var x8={path:$.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[$.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),$.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),$.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Yg=gn((t,e)=>{const{as:r,viewBox:o,color:a="currentColor",focusable:u=!1,children:d,className:f,__css:g,...E}=t,T=dr("chakra-icon",f),C=gh("Icon",t),I={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:a,...g,...C},D={ref:e,focusable:u,className:T,__css:I},L=o??x8.viewBox;if(r&&typeof r!="string")return $.jsx(Yt.svg,{as:r,...D,...E});const B=d??x8.path;return $.jsx(Yt.svg,{verticalAlign:"middle",viewBox:L,...D,...E,children:B})});Yg.displayName="Icon";function PR(t){const{viewBox:e="0 0 24 24",d:r,displayName:o,defaultProps:a={}}=t,u=X.Children.toArray(t.path),d=gn((f,g)=>$.jsx(Yg,{ref:g,viewBox:e,...a,...f,children:u.length?u:$.jsx("path",{fill:"currentColor",d:r})}));return d.displayName=o,d}function oMe(t){return $.jsx(Yg,{viewBox:"0 0 24 24",...t,children:$.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function aMe(t){return $.jsx(Yg,{viewBox:"0 0 24 24",...t,children:$.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function M8(t){return $.jsx(Yg,{viewBox:"0 0 24 24",...t,children:$.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}var cMe=bR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),NR=gn((t,e)=>{const r=gh("Spinner",t),{label:o="Loading...",thickness:a="2px",speed:u="0.45s",emptyColor:d="transparent",className:f,...g}=eo(t),E=dr("chakra-spinner",f),T={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:a,borderBottomColor:d,borderLeftColor:d,animation:`${cMe} ${u} linear infinite`,...r};return $.jsx(Yt.div,{ref:e,__css:T,className:E,...g,children:o&&$.jsx(Yt.span,{srOnly:!0,children:o})})});NR.displayName="Spinner";var[uMe,c4]=Bs({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[lMe,u4]=Bs({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),bie={info:{icon:aMe,colorScheme:"blue"},warning:{icon:M8,colorScheme:"orange"},success:{icon:oMe,colorScheme:"green"},error:{icon:M8,colorScheme:"red"},loading:{icon:NR,colorScheme:"blue"}};function dMe(t){return bie[t].colorScheme}function hMe(t){return bie[t].icon}var wie=gn(function(e,r){const o=u4(),{status:a}=c4(),u={display:"inline",...o.description};return $.jsx(Yt.div,{ref:r,"data-status":a,...e,className:dr("chakra-alert__desc",e.className),__css:u})});wie.displayName="AlertDescription";function F1(t){const{status:e}=c4(),r=hMe(e),o=u4(),a=e==="loading"?o.spinner:o.icon;return $.jsx(Yt.span,{display:"inherit","data-status":e,...t,className:dr("chakra-alert__icon",t.className),__css:a,children:t.children||$.jsx(r,{h:"100%",w:"100%"})})}F1.displayName="AlertIcon";var Cie=gn(function(e,r){const o=u4(),{status:a}=c4();return $.jsx(Yt.div,{ref:r,"data-status":a,...e,className:dr("chakra-alert__title",e.className),__css:o.title})});Cie.displayName="AlertTitle";var j1=gn(function(e,r){var o;const{status:a="info",addRole:u=!0,...d}=eo(e),f=(o=e.colorScheme)!=null?o:dMe(a),g=cl("Alert",{...e,colorScheme:f}),E={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...g.container};return $.jsx(uMe,{value:{status:a},children:$.jsx(lMe,{value:g,children:$.jsx(Yt.div,{"data-status":a,role:u?"alert":void 0,ref:r,...d,className:dr("chakra-alert",e.className),__css:E})})})});j1.displayName="Alert";function fMe(t){return $.jsx(Yg,{focusable:"false","aria-hidden":!0,...t,children:$.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}var ZC=gn(function(e,r){const o=gh("CloseButton",e),{children:a,isDisabled:u,__css:d,...f}=eo(e),g={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return $.jsx(Yt.button,{type:"button","aria-label":"Close",ref:r,disabled:u,__css:{...g,...o,...d},...f,children:a||$.jsx(fMe,{width:"1em",height:"1em"})})});ZC.displayName="CloseButton";var pMe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},af=mMe(pMe);function mMe(t){let e=t;const r=new Set,o=a=>{e=a(e),r.forEach(u=>u())};return{getState:()=>e,subscribe:a=>(r.add(a),()=>{o(()=>t),r.delete(a)}),removeToast:(a,u)=>{o(d=>({...d,[u]:d[u].filter(f=>f.id!=a)}))},notify:(a,u)=>{const d=gMe(a,u),{position:f,id:g}=d;return o(E=>{var T,C;const D=f.includes("top")?[d,...(T=E[f])!=null?T:[]]:[...(C=E[f])!=null?C:[],d];return{...E,[f]:D}}),g},update:(a,u)=>{a&&o(d=>{const f={...d},{position:g,index:E}=RJ(f,a);return g&&E!==-1&&(f[g][E]={...f[g][E],...u,message:Rie(u)}),f})},closeAll:({positions:a}={})=>{o(u=>(a??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((g,E)=>(g[E]=u[E].map(T=>({...T,requestClose:!0})),g),{...u}))},close:a=>{o(u=>{const d=Zne(u,a);return d?{...u,[d]:u[d].map(f=>f.id==a?{...f,requestClose:!0}:f)}:u})},isActive:a=>!!RJ(af.getState(),a).position}}var U8=0;function gMe(t,e={}){var r,o;U8+=1;const a=(r=e.id)!=null?r:U8,u=(o=e.position)!=null?o:"bottom";return{id:a,message:t,position:u,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>af.removeToast(String(a),u),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var vMe=t=>{const{status:e,variant:r="solid",id:o,title:a,isClosable:u,onClose:d,description:f,colorScheme:g,icon:E}=t,T=o?{root:`toast-${o}`,title:`toast-${o}-title`,description:`toast-${o}-description`}:void 0;return $.jsxs(j1,{addRole:!1,status:e,variant:r,id:T==null?void 0:T.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:g,children:[$.jsx(F1,{children:E}),$.jsxs(Yt.div,{flex:"1",maxWidth:"100%",children:[a&&$.jsx(Cie,{id:T==null?void 0:T.title,children:a}),f&&$.jsx(wie,{id:T==null?void 0:T.description,display:"block",children:f})]}),u&&$.jsx(ZC,{size:"sm",onClick:d,position:"absolute",insetEnd:1,top:1})]})};function Rie(t={}){const{render:e,toastComponent:r=vMe}=t;return a=>typeof e=="function"?e({...a,...t}):$.jsx(r,{...a,...t})}function _Me(t,e){const r=a=>{var u;return{...e,...a,position:sMe((u=a==null?void 0:a.position)!=null?u:e==null?void 0:e.position,t)}},o=a=>{const u=r(a),d=Rie(u);return af.notify(d,u)};return o.update=(a,u)=>{af.update(a,r(u))},o.promise=(a,u)=>{const d=o({...u.loading,status:"loading",duration:null});a.then(f=>o.update(d,{status:"success",duration:5e3,...bd(u.success,f)})).catch(f=>o.update(d,{status:"error",duration:5e3,...bd(u.error,f)}))},o.closeAll=af.closeAll,o.close=af.close,o.isActive=af.isActive,o}var[yMe,EMe]=Bs({name:"ToastOptionsContext",strict:!1}),SMe=t=>{const e=X.useSyncExternalStore(af.subscribe,af.getState,af.getState),{motionVariants:r,component:o=Tie,portalProps:a}=t,d=Object.keys(e).map(f=>{const g=e[f];return $.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${f}`,id:`chakra-toast-manager-${f}`,style:UNe(f),children:$.jsx(YT,{initial:!1,children:g.map(E=>$.jsx(o,{motionVariants:r,...E},E.id))})},f)});return $.jsx(mh,{...a,children:d})};function DR(t){const{theme:e}=Ene(),r=EMe();return X.useMemo(()=>_Me(e.direction,{...r,...t}),[t,e.direction,r])}var TMe=t=>function({children:r,theme:o=t,toastOptions:a,...u}){return $.jsxs(LNe,{theme:o,...u,children:[$.jsx(yMe,{value:a==null?void 0:a.defaultOptions,children:r}),$.jsx(SMe,{...a})]})},bMe=TMe(QPe),wMe=Object.defineProperty,CMe=(t,e,r)=>e in t?wMe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mo=(t,e,r)=>(CMe(t,typeof e!="symbol"?e+"":e,r),r);function V8(t){return t.sort((e,r)=>{const o=e.compareDocumentPosition(r);if(o&Node.DOCUMENT_POSITION_FOLLOWING||o&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING||o&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(o&Node.DOCUMENT_POSITION_DISCONNECTED||o&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}var RMe=t=>typeof t=="object"&&"nodeType"in t&&t.nodeType===Node.ELEMENT_NODE;function F8(t,e,r){let o=t+1;return r&&o>=e&&(o=0),o}function j8(t,e,r){let o=t-1;return r&&o<0&&(o=e),o}var TF=typeof window<"u"?X.useLayoutEffect:X.useEffect,xN=t=>t,IMe=class{constructor(){mo(this,"descendants",new Map),mo(this,"register",t=>{if(t!=null)return RMe(t)?this.registerNode(t):e=>{this.registerNode(e,t)}}),mo(this,"unregister",t=>{this.descendants.delete(t);const e=V8(Array.from(this.descendants.keys()));this.assignIndex(e)}),mo(this,"destroy",()=>{this.descendants.clear()}),mo(this,"assignIndex",t=>{this.descendants.forEach(e=>{const r=t.indexOf(e.node);e.index=r,e.node.dataset.index=e.index.toString()})}),mo(this,"count",()=>this.descendants.size),mo(this,"enabledCount",()=>this.enabledValues().length),mo(this,"values",()=>Array.from(this.descendants.values()).sort((e,r)=>e.index-r.index)),mo(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),mo(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),mo(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),mo(this,"first",()=>this.item(0)),mo(this,"firstEnabled",()=>this.enabledItem(0)),mo(this,"last",()=>this.item(this.descendants.size-1)),mo(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),mo(this,"indexOf",t=>{var e,r;return t&&(r=(e=this.descendants.get(t))==null?void 0:e.index)!=null?r:-1}),mo(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(e=>e.node.isSameNode(t))),mo(this,"next",(t,e=!0)=>{const r=F8(t,this.count(),e);return this.item(r)}),mo(this,"nextEnabled",(t,e=!0)=>{const r=this.item(t);if(!r)return;const o=this.enabledIndexOf(r.node),a=F8(o,this.enabledCount(),e);return this.enabledItem(a)}),mo(this,"prev",(t,e=!0)=>{const r=j8(t,this.count()-1,e);return this.item(r)}),mo(this,"prevEnabled",(t,e=!0)=>{const r=this.item(t);if(!r)return;const o=this.enabledIndexOf(r.node),a=j8(o,this.enabledCount()-1,e);return this.enabledItem(a)}),mo(this,"registerNode",(t,e)=>{if(!t||this.descendants.has(t))return;const r=Array.from(this.descendants.keys()).concat(t),o=V8(r);e!=null&&e.disabled&&(e.disabled=!!e.disabled);const a={node:t,index:-1,...e};this.descendants.set(t,a),this.assignIndex(o)})}};function AMe(t,e){if(t!=null){if(typeof t=="function"){t(e);return}try{t.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${t}'`)}}}function Qs(...t){return e=>{t.forEach(r=>{AMe(r,e)})}}function kMe(...t){return X.useMemo(()=>Qs(...t),t)}function OMe(){const t=X.useRef(new IMe);return TF(()=>()=>t.current.destroy()),t.current}var[PMe,Iie]=Bs({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});function NMe(t){const e=Iie(),[r,o]=X.useState(-1),a=X.useRef(null);TF(()=>()=>{a.current&&e.unregister(a.current)},[]),TF(()=>{if(!a.current)return;const d=Number(a.current.dataset.index);r!=d&&!Number.isNaN(d)&&o(d)});const u=xN(t?e.register(t):e.register);return{descendants:e,index:r,enabledIndex:e.enabledIndexOf(a.current),register:Qs(u,a)}}function Aie(){return[xN(PMe),()=>xN(Iie()),()=>OMe(),a=>NMe(a)]}function kie(t){const{value:e,defaultValue:r,onChange:o,shouldUpdate:a=(I,D)=>I!==D}=t,u=tl(o),d=tl(a),[f,g]=X.useState(r),E=e!==void 0,T=E?e:f,C=tl(I=>{const L=typeof I=="function"?I(T):I;d(T,L)&&(E||g(L),u(L))},[E,u,T,d]);return[T,C]}var B8={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},X_={enter:{duration:.2,ease:B8.easeOut},exit:{duration:.1,ease:B8.easeIn}},J_={enter:(t,e)=>({...t,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(t,e)=>({...t,delay:typeof e=="number"?e:e==null?void 0:e.exit})},DMe={enter:({transition:t,transitionEnd:e,delay:r}={})=>{var o;return{opacity:1,transition:(o=t==null?void 0:t.enter)!=null?o:J_.enter(X_.enter,r),transitionEnd:e==null?void 0:e.enter}},exit:({transition:t,transitionEnd:e,delay:r}={})=>{var o;return{opacity:0,transition:(o=t==null?void 0:t.exit)!=null?o:J_.exit(X_.exit,r),transitionEnd:e==null?void 0:e.exit}}},Oie={initial:"exit",animate:"enter",exit:"exit",variants:DMe},LMe=X.forwardRef(function(e,r){const{unmountOnExit:o,in:a,className:u,transition:d,transitionEnd:f,delay:g,...E}=e,T=a||o?"enter":"exit",C=o?a&&o:!0,I={transition:d,transitionEnd:f,delay:g};return $.jsx(YT,{custom:I,children:C&&$.jsx(im.div,{ref:r,className:dr("chakra-fade",u),custom:I,...Oie,animate:T,...E})})});LMe.displayName="Fade";var xMe={exit:({reverse:t,initialScale:e,transition:r,transitionEnd:o,delay:a})=>{var u;return{opacity:0,...t?{scale:e,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{scale:e,...o==null?void 0:o.exit}},transition:(u=r==null?void 0:r.exit)!=null?u:J_.exit(X_.exit,a)}},enter:({transitionEnd:t,transition:e,delay:r})=>{var o;return{opacity:1,scale:1,transition:(o=e==null?void 0:e.enter)!=null?o:J_.enter(X_.enter,r),transitionEnd:t==null?void 0:t.enter}}},Pie={initial:"exit",animate:"enter",exit:"exit",variants:xMe},MMe=X.forwardRef(function(e,r){const{unmountOnExit:o,in:a,reverse:u=!0,initialScale:d=.95,className:f,transition:g,transitionEnd:E,delay:T,...C}=e,I=o?a&&o:!0,D=a||o?"enter":"exit",L={initialScale:d,reverse:u,transition:g,transitionEnd:E,delay:T};return $.jsx(YT,{custom:L,children:I&&$.jsx(im.div,{ref:r,className:dr("chakra-offset-slide",f),...Pie,animate:D,custom:L,...C})})});MMe.displayName="ScaleFade";var UMe={initial:({offsetX:t,offsetY:e,transition:r,transitionEnd:o,delay:a})=>{var u;return{opacity:0,x:t,y:e,transition:(u=r==null?void 0:r.exit)!=null?u:J_.exit(X_.exit,a),transitionEnd:o==null?void 0:o.exit}},enter:({transition:t,transitionEnd:e,delay:r})=>{var o;return{opacity:1,x:0,y:0,transition:(o=t==null?void 0:t.enter)!=null?o:J_.enter(X_.enter,r),transitionEnd:e==null?void 0:e.enter}},exit:({offsetY:t,offsetX:e,transition:r,transitionEnd:o,reverse:a,delay:u})=>{var d;const f={x:e,y:t};return{opacity:0,transition:(d=r==null?void 0:r.exit)!=null?d:J_.exit(X_.exit,u),...a?{...f,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{...f,...o==null?void 0:o.exit}}}}},tC={initial:"initial",animate:"enter",exit:"exit",variants:UMe},VMe=X.forwardRef(function(e,r){const{unmountOnExit:o,in:a,reverse:u=!0,className:d,offsetX:f=0,offsetY:g=8,transition:E,transitionEnd:T,delay:C,...I}=e,D=o?a&&o:!0,L=a||o?"enter":"exit",B={offsetX:f,offsetY:g,reverse:u,transition:E,transitionEnd:T,delay:C};return $.jsx(YT,{custom:B,children:D&&$.jsx(im.div,{ref:r,className:dr("chakra-offset-slide",d),custom:B,...tC,animate:L,...I})})});VMe.displayName="SlideFade";var[FMe,jMe]=Bs({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function BMe(t){var e;const r=t.split(" "),o=(e=r[0])!=null?e:"",a=r.length>1?r[r.length-1]:"";return o&&a?`${o.charAt(0)}${a.charAt(0)}`:o.charAt(0)}function Nie(t){const{name:e,getInitials:r,...o}=t,a=jMe();return $.jsx(Yt.div,{role:"img","aria-label":e,...o,__css:a.label,children:e?r==null?void 0:r(e):null})}Nie.displayName="AvatarName";var Die=t=>$.jsxs(Yt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...t,children:[$.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),$.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]}),bF=gn(function(e,r){const{htmlWidth:o,htmlHeight:a,alt:u,...d}=e;return $.jsx("img",{width:o,height:a,ref:r,alt:u,...d})});bF.displayName="NativeImage";function Lie(t){const{loading:e,src:r,srcSet:o,onLoad:a,onError:u,crossOrigin:d,sizes:f,ignoreFallback:g}=t,[E,T]=X.useState("pending");X.useEffect(()=>{T(r?"loading":"pending")},[r]);const C=X.useRef(),I=X.useCallback(()=>{if(!r)return;D();const L=new Image;L.src=r,d&&(L.crossOrigin=d),o&&(L.srcset=o),f&&(L.sizes=f),e&&(L.loading=e),L.onload=B=>{D(),T("loaded"),a==null||a(B)},L.onerror=B=>{D(),T("failed"),u==null||u(B)},C.current=L},[r,d,o,f,a,u,e]),D=()=>{C.current&&(C.current.onload=null,C.current.onerror=null,C.current=null)};return Vp(()=>{if(!g)return E==="loading"&&I(),()=>{D()}},[E,I,g]),g?"loaded":E}var WMe=(t,e)=>t!=="loaded"&&e==="beforeLoadOrError"||t==="failed"&&e==="onError";function zMe(t,e=[]){const r=Object.assign({},t);for(const o of e)o in r&&delete r[o];return r}var l4=gn(function(e,r){const{fallbackSrc:o,fallback:a,src:u,srcSet:d,align:f,fit:g,loading:E,ignoreFallback:T,crossOrigin:C,fallbackStrategy:I="beforeLoadOrError",referrerPolicy:D,...L}=e,B=o!==void 0||a!==void 0,G=E!=null||T||!B,se=Lie({...e,crossOrigin:C,ignoreFallback:G}),ae=WMe(se,I),M={ref:r,objectFit:g,objectPosition:f,...G?L:zMe(L,["onError","onLoad"])};return ae?a||$.jsx(Yt.img,{as:bF,className:"chakra-image__placeholder",src:o,...M}):$.jsx(Yt.img,{as:bF,src:u,srcSet:d,crossOrigin:C,loading:E,referrerPolicy:D,className:"chakra-image",...M})});l4.displayName="Image";function xie(t){const{src:e,srcSet:r,onError:o,onLoad:a,getInitials:u,name:d,borderRadius:f,loading:g,iconLabel:E,icon:T=$.jsx(Die,{}),ignoreFallback:C,referrerPolicy:I,crossOrigin:D}=t,B=Lie({src:e,onError:o,crossOrigin:D,ignoreFallback:C})==="loaded";return!e||!B?d?$.jsx(Nie,{className:"chakra-avatar__initials",getInitials:u,name:d}):X.cloneElement(T,{role:"img","aria-label":E}):$.jsx(Yt.img,{src:e,srcSet:r,alt:d,onLoad:a,referrerPolicy:I,crossOrigin:D??void 0,className:"chakra-avatar__img",loading:g,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:f}})}xie.displayName="AvatarImage";var GMe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},cy=gn((t,e)=>{const r=cl("Avatar",t),[o,a]=X.useState(!1),{src:u,srcSet:d,name:f,showBorder:g,borderRadius:E="full",onError:T,onLoad:C,getInitials:I=BMe,icon:D=$.jsx(Die,{}),iconLabel:L=" avatar",loading:B,children:G,borderColor:se,ignoreFallback:ae,crossOrigin:M,referrerPolicy:F,...z}=eo(t),te={borderRadius:E,borderWidth:g?"2px":void 0,...GMe,...r.container};return se&&(te.borderColor=se),$.jsx(Yt.span,{ref:e,...z,className:dr("chakra-avatar",t.className),"data-loaded":zr(o),__css:te,children:$.jsxs(FMe,{value:r,children:[$.jsx(xie,{src:u,srcSet:d,loading:B,onLoad:xr(C,()=>{a(!0)}),onError:T,getInitials:I,name:f,borderRadius:E,icon:D,iconLabel:L,ignoreFallback:ae,crossOrigin:M,referrerPolicy:F}),G]})})});cy.displayName="Avatar";function d4(t){return X.Children.toArray(t).filter(e=>X.isValidElement(e))}var[cXe,HMe]=Bs({strict:!1,name:"ButtonGroupContext"});function KMe(t){const[e,r]=X.useState(!t);return{ref:X.useCallback(u=>{u&&r(u.tagName==="BUTTON")},[]),type:e?"button":void 0}}function wF(t){const{children:e,className:r,...o}=t,a=X.isValidElement(e)?X.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,u=dr("chakra-button__icon",r);return $.jsx(Yt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...o,className:u,children:a})}wF.displayName="ButtonIcon";function CF(t){const{label:e,placement:r,spacing:o="0.5rem",children:a=$.jsx(NR,{color:"currentColor",width:"1em",height:"1em"}),className:u,__css:d,...f}=t,g=dr("chakra-button__spinner",u),E=r==="start"?"marginEnd":"marginStart",T=X.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[E]:e?o:0,fontSize:"1em",lineHeight:"normal",...d}),[d,e,E,o]);return $.jsx(Yt.div,{className:g,...f,__css:T,children:a})}CF.displayName="ButtonSpinner";var Fg=gn((t,e)=>{const r=HMe(),o=gh("Button",{...r,...t}),{isDisabled:a=r==null?void 0:r.isDisabled,isLoading:u,isActive:d,children:f,leftIcon:g,rightIcon:E,loadingText:T,iconSpacing:C="0.5rem",type:I,spinner:D,spinnerPlacement:L="start",className:B,as:G,...se}=eo(t),ae=X.useMemo(()=>{const te={...o==null?void 0:o._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...o,...!!r&&{_focus:te}}},[o,r]),{ref:M,type:F}=KMe(G),z={rightIcon:E,leftIcon:g,iconSpacing:C,children:f};return $.jsxs(Yt.button,{ref:kMe(e,M),as:G,type:I??F,"data-active":zr(d),"data-loading":zr(u),__css:ae,className:dr("chakra-button",B),...se,disabled:a||u,children:[u&&L==="start"&&$.jsx(CF,{className:"chakra-button__spinner--start",label:T,placement:"start",spacing:C,children:D}),u?T||$.jsx(Yt.span,{opacity:0,children:$.jsx(W8,{...z})}):$.jsx(W8,{...z}),u&&L==="end"&&$.jsx(CF,{className:"chakra-button__spinner--end",label:T,placement:"end",spacing:C,children:D})]})});Fg.displayName="Button";function W8(t){const{leftIcon:e,rightIcon:r,children:o,iconSpacing:a}=t;return $.jsxs($.Fragment,{children:[e&&$.jsx(wF,{marginEnd:a,children:e}),o,r&&$.jsx(wF,{marginStart:a,children:r})]})}var xl=gn((t,e)=>{const{icon:r,children:o,isRound:a,"aria-label":u,...d}=t,f=r||o,g=X.isValidElement(f)?X.cloneElement(f,{"aria-hidden":!0,focusable:!1}):null;return $.jsx(Fg,{padding:"0",borderRadius:a?"full":void 0,ref:e,"aria-label":u,...d,children:g})});xl.displayName="IconButton";var[qMe,Mie]=Bs({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[$Me,XT]=Bs({strict:!1,name:"FormControlContext"});function YMe(t){const{id:e,isRequired:r,isInvalid:o,isDisabled:a,isReadOnly:u,...d}=t,f=X.useId(),g=e||`field-${f}`,E=`${g}-label`,T=`${g}-feedback`,C=`${g}-helptext`,[I,D]=X.useState(!1),[L,B]=X.useState(!1),[G,se]=X.useState(!1),ae=X.useCallback((j={},K=null)=>({id:C,...j,ref:Qs(K,Q=>{Q&&B(!0)})}),[C]),M=X.useCallback((j={},K=null)=>({...j,ref:K,"data-focus":zr(G),"data-disabled":zr(a),"data-invalid":zr(o),"data-readonly":zr(u),id:j.id!==void 0?j.id:E,htmlFor:j.htmlFor!==void 0?j.htmlFor:g}),[g,a,G,o,u,E]),F=X.useCallback((j={},K=null)=>({id:T,...j,ref:Qs(K,Q=>{Q&&D(!0)}),"aria-live":"polite"}),[T]),z=X.useCallback((j={},K=null)=>({...j,...d,ref:K,role:"group","data-focus":zr(G),"data-disabled":zr(a),"data-invalid":zr(o),"data-readonly":zr(u)}),[d,a,G,o,u]),te=X.useCallback((j={},K=null)=>({...j,ref:K,role:"presentation","aria-hidden":!0,children:j.children||"*"}),[]);return{isRequired:!!r,isInvalid:!!o,isReadOnly:!!u,isDisabled:!!a,isFocused:!!G,onFocus:()=>se(!0),onBlur:()=>se(!1),hasFeedbackText:I,setHasFeedbackText:D,hasHelpText:L,setHasHelpText:B,id:g,labelId:E,feedbackId:T,helpTextId:C,htmlProps:d,getHelpTextProps:ae,getErrorMessageProps:F,getRootProps:z,getLabelProps:M,getRequiredIndicatorProps:te}}var lc=gn(function(e,r){const o=cl("Form",e),a=eo(e),{getRootProps:u,htmlProps:d,...f}=YMe(a),g=dr("chakra-form-control",e.className);return $.jsx($Me,{value:f,children:$.jsx(qMe,{value:o,children:$.jsx(Yt.div,{...u({},r),className:g,__css:o.container})})})});lc.displayName="FormControl";var XMe=gn(function(e,r){const o=XT(),a=Mie(),u=dr("chakra-form__helper-text",e.className);return $.jsx(Yt.div,{...o==null?void 0:o.getHelpTextProps(e,r),__css:a.helperText,className:u})});XMe.displayName="FormHelperText";var[JMe,QMe]=Bs({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Ap=gn((t,e)=>{const r=cl("FormError",t),o=eo(t),a=XT();return a!=null&&a.isInvalid?$.jsx(JMe,{value:r,children:$.jsx(Yt.div,{...a==null?void 0:a.getErrorMessageProps(o,e),className:dr("chakra-form__error-message",t.className),__css:{display:"flex",alignItems:"center",...r.text}})}):null});Ap.displayName="FormErrorMessage";var ZMe=gn((t,e)=>{const r=QMe(),o=XT();if(!(o!=null&&o.isInvalid))return null;const a=dr("chakra-form__error-icon",t.className);return $.jsx(Yg,{ref:e,"aria-hidden":!0,...t,__css:r.icon,className:a,children:$.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});ZMe.displayName="FormErrorIcon";var L_=gn(function(e,r){var o;const a=gh("FormLabel",e),u=eo(e),{className:d,children:f,requiredIndicator:g=$.jsx(Uie,{}),optionalIndicator:E=null,...T}=u,C=XT(),I=(o=C==null?void 0:C.getLabelProps(T,r))!=null?o:{ref:r,...T};return $.jsxs(Yt.label,{...I,className:dr("chakra-form__label",u.className),__css:{display:"block",textAlign:"start",...a},children:[f,C!=null&&C.isRequired?g:E]})});L_.displayName="FormLabel";var Uie=gn(function(e,r){const o=XT(),a=Mie();if(!(o!=null&&o.isRequired))return null;const u=dr("chakra-form__required-indicator",e.className);return $.jsx(Yt.span,{...o==null?void 0:o.getRequiredIndicatorProps(e,r),__css:a.requiredIndicator,className:u})});Uie.displayName="RequiredIndicator";function Vie(t){const{isDisabled:e,isInvalid:r,isReadOnly:o,isRequired:a,...u}=Fie(t);return{...u,disabled:e,readOnly:o,required:a,"aria-invalid":hV(r),"aria-required":hV(a),"aria-readonly":hV(o)}}function Fie(t){var e,r,o;const a=XT(),{id:u,disabled:d,readOnly:f,required:g,isRequired:E,isInvalid:T,isReadOnly:C,isDisabled:I,onFocus:D,onBlur:L,...B}=t,G=t["aria-describedby"]?[t["aria-describedby"]]:[];return a!=null&&a.hasFeedbackText&&(a!=null&&a.isInvalid)&&G.push(a.feedbackId),a!=null&&a.hasHelpText&&G.push(a.helpTextId),{...B,"aria-describedby":G.join(" ")||void 0,id:u??(a==null?void 0:a.id),isDisabled:(e=d??I)!=null?e:a==null?void 0:a.isDisabled,isReadOnly:(r=f??C)!=null?r:a==null?void 0:a.isReadOnly,isRequired:(o=g??E)!=null?o:a==null?void 0:a.isRequired,isInvalid:T??(a==null?void 0:a.isInvalid),onFocus:xr(a==null?void 0:a.onFocus,D),onBlur:xr(a==null?void 0:a.onBlur,L)}}var eUe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},tUe=()=>typeof document<"u",z8=!1,LR=null,uy=!1,RF=!1,IF=new Set;function h4(t,e){IF.forEach(r=>r(t,e))}var nUe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function rUe(t){return!(t.metaKey||!nUe&&t.altKey||t.ctrlKey||t.key==="Control"||t.key==="Shift"||t.key==="Meta")}function G8(t){uy=!0,rUe(t)&&(LR="keyboard",h4("keyboard",t))}function OS(t){if(LR="pointer",t.type==="mousedown"||t.type==="pointerdown"){uy=!0;const e=t.composedPath?t.composedPath()[0]:t.target;let r=!1;try{r=e.matches(":focus-visible")}catch{}if(r)return;h4("pointer",t)}}function iUe(t){return t.mozInputSource===0&&t.isTrusted?!0:t.detail===0&&!t.pointerType}function sUe(t){iUe(t)&&(uy=!0,LR="virtual")}function oUe(t){t.target===window||t.target===document||(!uy&&!RF&&(LR="virtual",h4("virtual",t)),uy=!1,RF=!1)}function aUe(){uy=!1,RF=!0}function H8(){return LR!=="pointer"}function cUe(){if(!tUe()||z8)return;const{focus:t}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...r){uy=!0,t.apply(this,r)},document.addEventListener("keydown",G8,!0),document.addEventListener("keyup",G8,!0),document.addEventListener("click",sUe,!0),window.addEventListener("focus",oUe,!0),window.addEventListener("blur",aUe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",OS,!0),document.addEventListener("pointermove",OS,!0),document.addEventListener("pointerup",OS,!0)):(document.addEventListener("mousedown",OS,!0),document.addEventListener("mousemove",OS,!0),document.addEventListener("mouseup",OS,!0)),z8=!0}function uUe(t){cUe(),t(H8());const e=()=>t(H8());return IF.add(e),()=>{IF.delete(e)}}function lUe(t,e=[]){const r=Object.assign({},t);for(const o of e)o in r&&delete r[o];return r}function dUe(t={}){const e=Fie(t),{isDisabled:r,isReadOnly:o,isRequired:a,isInvalid:u,id:d,onBlur:f,onFocus:g,"aria-describedby":E}=e,{defaultChecked:T,isChecked:C,isFocusable:I,onChange:D,isIndeterminate:L,name:B,value:G,tabIndex:se=void 0,"aria-label":ae,"aria-labelledby":M,"aria-invalid":F,...z}=t,te=lUe(z,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),j=tl(D),K=tl(f),Q=tl(g),[ce,Ee]=X.useState(!1),[_e,pe]=X.useState(!1),[qe,St]=X.useState(!1),[ke,Ne]=X.useState(!1);X.useEffect(()=>uUe(Ee),[]);const Re=X.useRef(null),[Ve,ve]=X.useState(!0),[Be,gt]=X.useState(!!T),ze=C!==void 0,_t=ze?C:Be,Dt=X.useCallback(Pt=>{if(o||r){Pt.preventDefault();return}ze||gt(_t?Pt.target.checked:L?!0:Pt.target.checked),j==null||j(Pt)},[o,r,_t,ze,L,j]);Vp(()=>{Re.current&&(Re.current.indeterminate=!!L)},[L]),ay(()=>{r&&pe(!1)},[r,pe]),Vp(()=>{const Pt=Re.current;if(!(Pt!=null&&Pt.form))return;const wn=()=>{gt(!!T)};return Pt.form.addEventListener("reset",wn),()=>{var Dn;return(Dn=Pt.form)==null?void 0:Dn.removeEventListener("reset",wn)}},[]);const jt=r&&!I,Zt=X.useCallback(Pt=>{Pt.key===" "&&Ne(!0)},[Ne]),Xt=X.useCallback(Pt=>{Pt.key===" "&&Ne(!1)},[Ne]);Vp(()=>{if(!Re.current)return;Re.current.checked!==_t&&gt(Re.current.checked)},[Re.current]);const In=X.useCallback((Pt={},wn=null)=>{const Dn=Ae=>{_e&&Ae.preventDefault(),Ne(!0)};return{...Pt,ref:wn,"data-active":zr(ke),"data-hover":zr(qe),"data-checked":zr(_t),"data-focus":zr(_e),"data-focus-visible":zr(_e&&ce),"data-indeterminate":zr(L),"data-disabled":zr(r),"data-invalid":zr(u),"data-readonly":zr(o),"aria-hidden":!0,onMouseDown:xr(Pt.onMouseDown,Dn),onMouseUp:xr(Pt.onMouseUp,()=>Ne(!1)),onMouseEnter:xr(Pt.onMouseEnter,()=>St(!0)),onMouseLeave:xr(Pt.onMouseLeave,()=>St(!1))}},[ke,_t,r,_e,ce,qe,L,u,o]),Qt=X.useCallback((Pt={},wn=null)=>({...Pt,ref:wn,"data-active":zr(ke),"data-hover":zr(qe),"data-checked":zr(_t),"data-focus":zr(_e),"data-focus-visible":zr(_e&&ce),"data-indeterminate":zr(L),"data-disabled":zr(r),"data-invalid":zr(u),"data-readonly":zr(o)}),[ke,_t,r,_e,ce,qe,L,u,o]),Er=X.useCallback((Pt={},wn=null)=>({...te,...Pt,ref:Qs(wn,Dn=>{Dn&&ve(Dn.tagName==="LABEL")}),onClick:xr(Pt.onClick,()=>{var Dn;Ve||((Dn=Re.current)==null||Dn.click(),requestAnimationFrame(()=>{var Ae;(Ae=Re.current)==null||Ae.focus({preventScroll:!0})}))}),"data-disabled":zr(r),"data-checked":zr(_t),"data-invalid":zr(u)}),[te,r,_t,u,Ve]),Tn=X.useCallback((Pt={},wn=null)=>({...Pt,ref:Qs(Re,wn),type:"checkbox",name:B,value:G,id:d,tabIndex:se,onChange:xr(Pt.onChange,Dt),onBlur:xr(Pt.onBlur,K,()=>pe(!1)),onFocus:xr(Pt.onFocus,Q,()=>pe(!0)),onKeyDown:xr(Pt.onKeyDown,Zt),onKeyUp:xr(Pt.onKeyUp,Xt),required:a,checked:_t,disabled:jt,readOnly:o,"aria-label":ae,"aria-labelledby":M,"aria-invalid":F?!!F:u,"aria-describedby":E,"aria-disabled":r,style:eUe}),[B,G,d,Dt,K,Q,Zt,Xt,a,_t,jt,o,ae,M,F,u,E,r,se]),Vn=X.useCallback((Pt={},wn=null)=>({...Pt,ref:wn,onMouseDown:xr(Pt.onMouseDown,hUe),"data-disabled":zr(r),"data-checked":zr(_t),"data-invalid":zr(u)}),[_t,r,u]);return{state:{isInvalid:u,isFocused:_e,isChecked:_t,isActive:ke,isHovered:qe,isIndeterminate:L,isDisabled:r,isReadOnly:o,isRequired:a},getRootProps:Er,getCheckboxProps:In,getIndicatorProps:Qt,getInputProps:Tn,getLabelProps:Vn,htmlProps:te}}function hUe(t){t.preventDefault(),t.stopPropagation()}function fUe(t){const e=parseFloat(t);return typeof e!="number"||Number.isNaN(e)?0:e}function pUe(t,e){let r=fUe(t);const o=10**(e??10);return r=Math.round(r*o)/o,e?r.toFixed(e):r.toString()}function mUe(t){if(!Number.isFinite(t))return 0;let e=1,r=0;for(;Math.round(t*e)/e!==t;)e*=10,r+=1;return r}function K8(t,e,r){return(t-e)*100/(r-e)}function gUe(t,e,r){return(r-e)*t+e}function q8(t,e,r){const o=Math.round((t-e)/r)*r+e,a=mUe(r);return pUe(o,a)}function HV(t,e,r){return t==null?t:(r<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(t,e),r))}function dT(t,e,r,o){const a=tl(r);return X.useEffect(()=>{const u=typeof t=="function"?t():t??document;if(!(!r||!u))return u.addEventListener(e,a,o),()=>{u.removeEventListener(e,a,o)}},[e,t,o,a,r]),()=>{const u=typeof t=="function"?t():t??document;u==null||u.removeEventListener(e,a,o)}}function vUe(t){return"current"in t}var jie=()=>typeof window<"u";function _Ue(){var t;const e=navigator.userAgentData;return(t=e==null?void 0:e.platform)!=null?t:navigator.platform}var yUe=t=>jie()&&t.test(navigator.vendor),EUe=t=>jie()&&t.test(_Ue()),SUe=()=>EUe(/mac|iphone|ipad|ipod/i),TUe=()=>SUe()&&yUe(/apple/i);function bUe(t){const{ref:e,elements:r,enabled:o}=t,a=()=>{var u,d;return(d=(u=e.current)==null?void 0:u.ownerDocument)!=null?d:document};dT(a,"pointerdown",u=>{if(!TUe()||!o)return;const d=u.target,g=(r??[e]).some(E=>{const T=vUe(E)?E.current:E;return(T==null?void 0:T.contains(d))||T===d});a().activeElement!==d&&g&&(u.preventDefault(),d.focus())})}function wUe(t,e){if(t==null)return{};var r={},o=Object.keys(t),a,u;for(u=0;u<o.length;u++)a=o[u],!(e.indexOf(a)>=0)&&(r[a]=t[a]);return r}var KV={exports:{}},qV,$8;function CUe(){if($8)return qV;$8=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return qV=t,qV}var $V,Y8;function RUe(){if(Y8)return $V;Y8=1;var t=CUe();function e(){}function r(){}return r.resetWarningCache=e,$V=function(){function o(d,f,g,E,T,C){if(C!==t){var I=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw I.name="Invariant Violation",I}}o.isRequired=o;function a(){return o}var u={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:a,element:o,elementType:o,instanceOf:a,node:o,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:r,resetWarningCache:e};return u.PropTypes=u,u},$V}var X8;function IUe(){return X8||(X8=1,KV.exports=RUe()()),KV.exports}var AUe=IUe();const go=HT(AUe);var AF="data-focus-lock",Bie="data-focus-lock-disabled",kUe="data-no-focus-lock",OUe="data-autofocus-inside",PUe="data-no-autofocus";function YV(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function NUe(t,e){var r=X.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(o){var a=r.value;a!==o&&(r.value=o,r.callback(o,a))}}}})[0];return r.callback=e,r.facade}var DUe=typeof window<"u"?X.useLayoutEffect:X.useEffect,J8=new WeakMap;function Wie(t,e){var r=NUe(null,function(o){return t.forEach(function(a){return YV(a,o)})});return DUe(function(){var o=J8.get(r);if(o){var a=new Set(o),u=new Set(t),d=r.current;a.forEach(function(f){u.has(f)||YV(f,null)}),u.forEach(function(f){a.has(f)||YV(f,d)})}J8.set(r,t)},[t]),r}var XV={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},cf=function(){return cf=Object.assign||function(e){for(var r,o=1,a=arguments.length;o<a;o++){r=arguments[o];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(e[u]=r[u])}return e},cf.apply(this,arguments)};function xR(t,e){var r={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(r[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,o=Object.getOwnPropertySymbols(t);a<o.length;a++)e.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(t,o[a])&&(r[o[a]]=t[o[a]]);return r}function LUe(t,e,r){if(r||arguments.length===2)for(var o=0,a=e.length,u;o<a;o++)(u||!(o in e))&&(u||(u=Array.prototype.slice.call(e,0,o)),u[o]=e[o]);return t.concat(u||Array.prototype.slice.call(e))}function zie(t){return t}function Gie(t,e){e===void 0&&(e=zie);var r=[],o=!1,a={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(u){var d=e(u,o);return r.push(d),function(){r=r.filter(function(f){return f!==d})}},assignSyncMedium:function(u){for(o=!0;r.length;){var d=r;r=[],d.forEach(u)}r={push:function(f){return u(f)},filter:function(){return r}}},assignMedium:function(u){o=!0;var d=[];if(r.length){var f=r;r=[],f.forEach(u),d=r}var g=function(){var T=d;d=[],T.forEach(u)},E=function(){return Promise.resolve().then(g)};E(),r={push:function(T){d.push(T),E()},filter:function(T){return d=d.filter(T),r}}}};return a}function f4(t,e){return e===void 0&&(e=zie),Gie(t,e)}function Hie(t){t===void 0&&(t={});var e=Gie(null);return e.options=cf({async:!0,ssr:!1},t),e}var Kie=function(t){var e=t.sideCar,r=xR(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=e.read();if(!o)throw new Error("Sidecar medium not found");return X.createElement(o,cf({},r))};Kie.isSideCarExport=!0;function xUe(t,e){return t.useMedium(e),Kie}var qie=f4({},function(t){var e=t.target,r=t.currentTarget;return{target:e,currentTarget:r}}),$ie=f4(),MUe=f4(),UUe=Hie({async:!0,ssr:typeof document<"u"}),VUe=X.createContext(void 0),FUe=[],p4=X.forwardRef(function(e,r){var o,a=X.useState(),u=a[0],d=a[1],f=X.useRef(),g=X.useRef(!1),E=X.useRef(null),T=X.useState({}),C=T[1],I=e.children,D=e.disabled,L=D===void 0?!1:D,B=e.noFocusGuards,G=B===void 0?!1:B,se=e.persistentFocus,ae=se===void 0?!1:se,M=e.crossFrame,F=M===void 0?!0:M,z=e.autoFocus,te=z===void 0?!0:z;e.allowTextSelection;var j=e.group,K=e.className,Q=e.whiteList,ce=e.hasPositiveIndices,Ee=e.shards,_e=Ee===void 0?FUe:Ee,pe=e.as,qe=pe===void 0?"div":pe,St=e.lockProps,ke=St===void 0?{}:St,Ne=e.sideCar,Re=e.returnFocus,Ve=Re===void 0?!1:Re,ve=e.focusOptions,Be=e.onActivation,gt=e.onDeactivation,ze=X.useState({}),_t=ze[0],Dt=X.useCallback(function(wn){var Dn=wn.captureFocusRestore;if(!E.current){var Ae,$e=(Ae=document)==null?void 0:Ae.activeElement;E.current=$e,$e!==document.body&&(E.current=Dn($e))}f.current&&Be&&Be(f.current),g.current=!0,C()},[Be]),jt=X.useCallback(function(){g.current=!1,gt&&gt(f.current),C()},[gt]),Zt=X.useCallback(function(wn){var Dn=E.current;if(Dn){var Ae=(typeof Dn=="function"?Dn():Dn)||document.body,$e=typeof Ve=="function"?Ve(Ae):Ve;if($e){var rt=typeof $e=="object"?$e:void 0;E.current=null,wn?Promise.resolve().then(function(){return Ae.focus(rt)}):Ae.focus(rt)}}},[Ve]),Xt=X.useCallback(function(wn){g.current&&qie.useMedium(wn)},[]),In=$ie.useMedium,Qt=X.useCallback(function(wn){f.current!==wn&&(f.current=wn,d(wn))},[]),Er=oy((o={},o[Bie]=L&&"disabled",o[AF]=j,o),ke),Tn=G!==!0,Vn=Tn&&G!=="tail",wr=Wie([r,Qt]),Pt=X.useMemo(function(){return{observed:f,shards:_e,enabled:!L,active:g.current}},[L,g.current,_e,u]);return X.createElement(X.Fragment,null,Tn&&[X.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:L?-1:0,style:XV}),ce?X.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:L?-1:1,style:XV}):null],!L&&X.createElement(Ne,{id:_t,sideCar:UUe,observed:u,disabled:L,persistentFocus:ae,crossFrame:F,autoFocus:te,whiteList:Q,shards:_e,onActivation:Dt,onDeactivation:jt,returnFocus:Zt,focusOptions:ve}),X.createElement(qe,oy({ref:wr},Er,{className:K,onBlur:In,onFocus:Xt}),X.createElement(VUe.Provider,{value:Pt},I)),Vn&&X.createElement("div",{"data-focus-guard":!0,tabIndex:L?-1:0,style:XV}))});p4.propTypes={};function kF(t,e){return kF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,a){return o.__proto__=a,o},kF(t,e)}function jUe(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,kF(t,e)}function eR(t){"@babel/helpers - typeof";return eR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eR(t)}function BUe(t,e){if(eR(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var o=r.call(t,e);if(eR(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function WUe(t){var e=BUe(t,"string");return eR(e)=="symbol"?e:e+""}function zUe(t,e,r){return e=WUe(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function GUe(t,e){function r(o){return o.displayName||o.name||"Component"}return function(a){var u=[],d;function f(){d=t(u.map(function(E){return E.props})),e(d)}var g=function(E){jUe(T,E);function T(){return E.apply(this,arguments)||this}T.peek=function(){return d};var C=T.prototype;return C.componentDidMount=function(){u.push(this),f()},C.componentDidUpdate=function(){f()},C.componentWillUnmount=function(){var D=u.indexOf(this);u.splice(D,1),f()},C.render=function(){return Di.createElement(a,this.props)},T}(X.PureComponent);return zUe(g,"displayName","SideEffect("+r(a)+")"),g}}var Lf=function(t){for(var e=Array(t.length),r=0;r<t.length;++r)e[r]=t[r];return e},ly=function(t){return Array.isArray(t)?t:[t]},Yie=function(t){return Array.isArray(t)?t[0]:t},HUe=function(t){if(t.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(t,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},Xie=function(t){return t.parentNode&&t.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?t.parentNode.host:t.parentNode},Jie=function(t){return t===document||t&&t.nodeType===Node.DOCUMENT_NODE},KUe=function(t){return t.hasAttribute("inert")},qUe=function(t,e){return!t||Jie(t)||!HUe(t)&&!KUe(t)&&e(Xie(t))},Qie=function(t,e){var r=t.get(e);if(r!==void 0)return r;var o=qUe(e,Qie.bind(void 0,t));return t.set(e,o),o},$Ue=function(t,e){return t&&!Jie(t)?JUe(t)?e(Xie(t)):!1:!0},Zie=function(t,e){var r=t.get(e);if(r!==void 0)return r;var o=$Ue(e,Zie.bind(void 0,t));return t.set(e,o),o},ese=function(t){return t.dataset},YUe=function(t){return t.tagName==="BUTTON"},tse=function(t){return t.tagName==="INPUT"},nse=function(t){return tse(t)&&t.type==="radio"},XUe=function(t){return!((tse(t)||YUe(t))&&(t.type==="hidden"||t.disabled))},JUe=function(t){var e=t.getAttribute(PUe);return![!0,"true",""].includes(e)},m4=function(t){var e;return!!(t&&(!((e=ese(t))===null||e===void 0)&&e.focusGuard))},OF=function(t){return!m4(t)},QUe=function(t){return!!t},ZUe=function(t,e){var r=Math.max(0,t.tabIndex),o=Math.max(0,e.tabIndex),a=r-o,u=t.index-e.index;if(a){if(!r)return 1;if(!o)return-1}return a||u},eVe=function(t){return t.tabIndex<0&&!t.hasAttribute("tabindex")?0:t.tabIndex},g4=function(t,e,r){return Lf(t).map(function(o,a){var u=eVe(o);return{node:o,index:a,tabIndex:r&&u===-1?(o.dataset||{}).focusGuard?0:-1:u}}).filter(function(o){return!e||o.tabIndex>=0}).sort(ZUe)},tVe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],v4=tVe.join(","),nVe="".concat(v4,", [data-focus-guard]"),rse=function(t,e){return Lf((t.shadowRoot||t).children).reduce(function(r,o){return r.concat(o.matches(e?nVe:v4)?[o]:[],rse(o))},[])},rVe=function(t,e){var r;return t instanceof HTMLIFrameElement&&(!((r=t.contentDocument)===null||r===void 0)&&r.body)?CT([t.contentDocument.body],e):[t]},CT=function(t,e){return t.reduce(function(r,o){var a,u=rse(o,e),d=(a=[]).concat.apply(a,u.map(function(f){return rVe(f,e)}));return r.concat(d,o.parentNode?Lf(o.parentNode.querySelectorAll(v4)).filter(function(f){return f===o}):[])},[])},iVe=function(t){var e=t.querySelectorAll("[".concat(OUe,"]"));return Lf(e).map(function(r){return CT([r])}).reduce(function(r,o){return r.concat(o)},[])},_4=function(t,e){return Lf(t).filter(function(r){return Qie(e,r)}).filter(function(r){return XUe(r)})},Q8=function(t,e){return e===void 0&&(e=new Map),Lf(t).filter(function(r){return Zie(e,r)})},y4=function(t,e,r){return g4(_4(CT(t,r),e),!0,r)},MN=function(t,e){return g4(_4(CT(t),e),!1)},sVe=function(t,e){return _4(iVe(t),e)},Q_=function(t,e){return t.shadowRoot?Q_(t.shadowRoot,e):Object.getPrototypeOf(t).contains!==void 0&&Object.getPrototypeOf(t).contains.call(t,e)?!0:Lf(t.children).some(function(r){var o;if(r instanceof HTMLIFrameElement){var a=(o=r.contentDocument)===null||o===void 0?void 0:o.body;return a?Q_(a,e):!1}return Q_(r,e)})},oVe=function(t){for(var e=new Set,r=t.length,o=0;o<r;o+=1)for(var a=o+1;a<r;a+=1){var u=t[o].compareDocumentPosition(t[a]);(u&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(a),(u&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(o)}return t.filter(function(d,f){return!e.has(f)})},ise=function(t){return t.parentNode?ise(t.parentNode):t},E4=function(t){var e=ly(t);return e.filter(Boolean).reduce(function(r,o){var a=o.getAttribute(AF);return r.push.apply(r,a?oVe(Lf(ise(o).querySelectorAll("[".concat(AF,'="').concat(a,'"]:not([').concat(Bie,'="disabled"])')))):[o]),r},[])},aVe=function(t){try{return t()}catch{return}},tR=function(t){if(t===void 0&&(t=document),!(!t||!t.activeElement)){var e=t.activeElement;return e.shadowRoot?tR(e.shadowRoot):e instanceof HTMLIFrameElement&&aVe(function(){return e.contentWindow.document})?tR(e.contentWindow.document):e}},cVe=function(t,e){return t===e},uVe=function(t,e){return!!Lf(t.querySelectorAll("iframe")).some(function(r){return cVe(r,e)})},sse=function(t,e){return e===void 0&&(e=tR(Yie(t).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:E4(t).some(function(r){return Q_(r,e)||uVe(r,e)})},lVe=function(t){t===void 0&&(t=document);var e=tR(t);return e?Lf(t.querySelectorAll("[".concat(kUe,"]"))).some(function(r){return Q_(r,e)}):!1},dVe=function(t,e){return e.filter(nse).filter(function(r){return r.name===t.name}).filter(function(r){return r.checked})[0]||t},S4=function(t,e){return nse(t)&&t.name?dVe(t,e):t},hVe=function(t){var e=new Set;return t.forEach(function(r){return e.add(S4(r,t))}),t.filter(function(r){return e.has(r)})},Z8=function(t){return t[0]&&t.length>1?S4(t[0],t):t[0]},eQ=function(t,e){return t.indexOf(S4(e,t))},PF="NEW_FOCUS",fVe=function(t,e,r,o,a){var u=t.length,d=t[0],f=t[u-1],g=m4(o);if(!(o&&t.indexOf(o)>=0)){var E=o!==void 0?r.indexOf(o):-1,T=a?r.indexOf(a):E,C=a?t.indexOf(a):-1;if(E===-1)return C!==-1?C:PF;if(C===-1)return PF;var I=E-T,D=r.indexOf(d),L=r.indexOf(f),B=hVe(r),G=o!==void 0?B.indexOf(o):-1,se=G-(a?B.indexOf(a):E);if(!I&&C>=0||e.length===0)return C;var ae=eQ(t,e[0]),M=eQ(t,e[e.length-1]);if(E<=D&&g&&Math.abs(I)>1)return M;if(E>=L&&g&&Math.abs(I)>1)return ae;if(I&&Math.abs(se)>1)return C;if(E<=D)return M;if(E>L)return ae;if(I)return Math.abs(I)>1?C:(u+C+I)%u}},pVe=function(t){return function(e){var r,o=(r=ese(e))===null||r===void 0?void 0:r.autofocus;return e.autofocus||o!==void 0&&o!=="false"||t.indexOf(e)>=0}},tQ=function(t,e,r){var o=t.map(function(u){var d=u.node;return d}),a=Q8(o.filter(pVe(r)));return a&&a.length?Z8(a):Z8(Q8(e))},NF=function(t,e){return e===void 0&&(e=[]),e.push(t),t.parentNode&&NF(t.parentNode.host||t.parentNode,e),e},JV=function(t,e){for(var r=NF(t),o=NF(e),a=0;a<r.length;a+=1){var u=r[a];if(o.indexOf(u)>=0)return u}return!1},ose=function(t,e,r){var o=ly(t),a=ly(e),u=o[0],d=!1;return a.filter(Boolean).forEach(function(f){d=JV(d||f,f)||d,r.filter(Boolean).forEach(function(g){var E=JV(u,g);E&&(!d||Q_(E,d)?d=E:d=JV(E,d))})}),d},nQ=function(t,e){return t.reduce(function(r,o){return r.concat(sVe(o,e))},[])},mVe=function(t,e){var r=new Map;return e.forEach(function(o){return r.set(o.node,o)}),t.map(function(o){return r.get(o)}).filter(QUe)},gVe=function(t,e){var r=tR(ly(t).length>0?document:Yie(t).ownerDocument),o=E4(t).filter(OF),a=ose(r||t,t,o),u=new Map,d=MN(o,u),f=d.filter(function(L){var B=L.node;return OF(B)});if(f[0]){var g=MN([a],u).map(function(L){var B=L.node;return B}),E=mVe(g,f),T=E.map(function(L){var B=L.node;return B}),C=E.filter(function(L){var B=L.tabIndex;return B>=0}).map(function(L){var B=L.node;return B}),I=fVe(T,C,g,r,e);if(I===PF){var D=tQ(d,C,nQ(o,u))||tQ(d,T,nQ(o,u));if(D)return{node:D};console.warn("focus-lock: cannot find any node to move focus into");return}return I===void 0?I:E[I]}},vVe=function(t){var e=E4(t).filter(OF),r=ose(t,t,e),o=g4(CT([r],!0),!0,!0),a=CT(e,!1);return o.map(function(u){var d=u.node,f=u.index;return{node:d,index:f,lockItem:a.indexOf(d)>=0,guard:m4(d)}})},T4=function(t,e){t&&("focus"in t&&t.focus(e),"contentWindow"in t&&t.contentWindow&&t.contentWindow.focus())},QV=0,ZV=!1,ase=function(t,e,r){r===void 0&&(r={});var o=gVe(t,e);if(!ZV&&o){if(QV>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),ZV=!0,setTimeout(function(){ZV=!1},1);return}QV++,T4(o.node,r.focusOptions),QV--}};function Pw(t){if(!t)return null;if(typeof WeakRef>"u")return function(){return t||null};var e=t?new WeakRef(t):null;return function(){return(e==null?void 0:e.deref())||null}}var _Ve=function(t){if(!t)return null;for(var e=[],r=t;r&&r!==document.body;)e.push({current:Pw(r),parent:Pw(r.parentElement),left:Pw(r.previousElementSibling),right:Pw(r.nextElementSibling)}),r=r.parentElement;return{element:Pw(t),stack:e,ownerDocument:t.ownerDocument}},yVe=function(t){var e,r,o,a,u;if(t)for(var d=t.stack,f=t.ownerDocument,g=new Map,E=0,T=d;E<T.length;E++){var C=T[E],I=(e=C.parent)===null||e===void 0?void 0:e.call(C);if(I&&f.contains(I)){for(var D=(r=C.left)===null||r===void 0?void 0:r.call(C),L=C.current(),B=I.contains(L)?L:void 0,G=(o=C.right)===null||o===void 0?void 0:o.call(C),se=y4([I],g),ae=(u=(a=B??(D==null?void 0:D.nextElementSibling))!==null&&a!==void 0?a:G)!==null&&u!==void 0?u:D;ae;){for(var M=0,F=se;M<F.length;M++){var z=F[M];if(ae!=null&&ae.contains(z.node))return z.node}ae=ae.nextElementSibling}if(se.length)return se[0].node}}},EVe=function(t){var e=_Ve(t);return function(){return yVe(e)}},SVe=function(t,e,r){if(!t||!e)return console.error("no element or scope given"),{};var o=ly(e);if(o.every(function(d){return!Q_(d,t)}))return console.error("Active element is not contained in the scope"),{};var a=r?y4(o,new Map):MN(o,new Map),u=a.findIndex(function(d){var f=d.node;return f===t});if(u!==-1)return{prev:a[u-1],next:a[u+1],first:a[0],last:a[a.length-1]}},TVe=function(t,e){var r=e?y4(ly(t),new Map):MN(ly(t),new Map);return{first:r[0],last:r[r.length-1]}},bVe=function(t){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},t)},cse=function(t,e,r){e===void 0&&(e={});var o=bVe(e),a=SVe(t,o.scope,o.onlyTabbable);if(a){var u=r(a,o.cycle);u&&T4(u.node,o.focusOptions)}},wVe=function(t,e){e===void 0&&(e={}),cse(t,e,function(r,o){var a=r.next,u=r.first;return a||o&&u})},CVe=function(t,e){e===void 0&&(e={}),cse(t,e,function(r,o){var a=r.prev,u=r.last;return a||o&&u})},use=function(t,e,r){var o,a=TVe(t,(o=e.onlyTabbable)!==null&&o!==void 0?o:!0),u=a[r];u&&T4(u.node,e.focusOptions)},RVe=function(t,e){e===void 0&&(e={}),use(t,e,"first")},IVe=function(t,e){e===void 0&&(e={}),use(t,e,"last")};function b4(t){setTimeout(t,1)}var AVe=function(e){return e&&"current"in e?e.current:e},kVe=function(){return document&&document.activeElement===document.body},OVe=function(){return kVe()||lVe()},hT=null,tT=null,fT=null,nR=!1,PVe=function(){return!0},NVe=function(e){return(hT.whiteList||PVe)(e)},DVe=function(e,r){fT={observerNode:e,portaledElement:r}},LVe=function(e){return fT&&fT.portaledElement===e};function rQ(t,e,r,o){var a=null,u=t;do{var d=o[u];if(d.guard)d.node.dataset.focusAutoGuard&&(a=d);else if(d.lockItem){if(u!==t)return;a=null}else break}while((u+=r)!==e);a&&(a.node.tabIndex=0)}var xVe=function(e){return e?!!nR:nR==="meanwhile"},MVe=function t(e,r,o){return r&&(r.host===e&&(!r.activeElement||o.contains(r.activeElement))||r.parentNode&&t(e,r.parentNode,o))},UVe=function(e,r){return r.some(function(o){return MVe(e,o,o)})},UN=function(){var e=!1;if(hT){var r=hT,o=r.observed,a=r.persistentFocus,u=r.autoFocus,d=r.shards,f=r.crossFrame,g=r.focusOptions,E=o||fT&&fT.portaledElement,T=document&&document.activeElement;if(E){var C=[E].concat(d.map(AVe).filter(Boolean));if((!T||NVe(T))&&(a||xVe(f)||!OVe()||!tT&&u)&&(E&&!(sse(C)||T&&UVe(T,C)||LVe(T))&&(document&&!tT&&T&&!u?(T.blur&&T.blur(),document.body.focus()):(e=ase(C,tT,{focusOptions:g}),fT={})),nR=!1,tT=document&&document.activeElement),document&&T!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var I=document&&document.activeElement,D=vVe(C),L=D.map(function(B){var G=B.node;return G}).indexOf(I);L>-1&&(D.filter(function(B){var G=B.guard,se=B.node;return G&&se.dataset.focusAutoGuard}).forEach(function(B){var G=B.node;return G.removeAttribute("tabIndex")}),rQ(L,D.length,1,D),rQ(L,-1,-1,D))}}}return e},lse=function(e){UN()&&e&&(e.stopPropagation(),e.preventDefault())},w4=function(){return b4(UN)},VVe=function(e){var r=e.target,o=e.currentTarget;o.contains(r)||DVe(o,r)},FVe=function(){return null},dse=function(){nR="just",b4(function(){nR="meanwhile"})},jVe=function(){document.addEventListener("focusin",lse),document.addEventListener("focusout",w4),window.addEventListener("blur",dse)},BVe=function(){document.removeEventListener("focusin",lse),document.removeEventListener("focusout",w4),window.removeEventListener("blur",dse)};function WVe(t){return t.filter(function(e){var r=e.disabled;return!r})}var hse={moveFocusInside:ase,focusInside:sse,focusNextElement:wVe,focusPrevElement:CVe,focusFirstElement:RVe,focusLastElement:IVe,captureFocusRestore:EVe};function zVe(t){var e=t.slice(-1)[0];e&&!hT&&jVe();var r=hT,o=r&&e&&e.id===r.id;hT=e,r&&!o&&(r.onDeactivation(),t.filter(function(a){var u=a.id;return u===r.id}).length||r.returnFocus(!e)),e?(tT=null,(!o||r.observed!==e.observed)&&e.onActivation(hse),UN(),b4(UN)):(BVe(),tT=null)}qie.assignSyncMedium(VVe);$ie.assignMedium(w4);MUe.assignMedium(function(t){return t(hse)});const GVe=GUe(WVe,zVe)(FVe);var DF=X.forwardRef(function(e,r){return X.createElement(p4,oy({sideCar:GVe,ref:r},e))}),fse=p4.propTypes||{};fse.sideCar;wUe(fse,["sideCar"]);DF.propTypes={};function pse(t){return t!=null&&typeof t=="object"&&"nodeType"in t&&t.nodeType===Node.ELEMENT_NODE}function C4(t){var e;if(!pse(t))return!1;const r=(e=t.ownerDocument.defaultView)!=null?e:window;return t instanceof r.HTMLElement}function HVe(t){var e,r;return(r=(e=mse(t))==null?void 0:e.defaultView)!=null?r:window}function mse(t){return pse(t)?t.ownerDocument:document}function KVe(t){return mse(t).activeElement}function qVe(t){const e=t.ownerDocument.defaultView||window,{overflow:r,overflowX:o,overflowY:a}=e.getComputedStyle(t);return/auto|scroll|overlay|hidden/.test(r+a+o)}function $Ve(t){return t.localName==="html"?t:t.assignedSlot||t.parentElement||t.ownerDocument.documentElement}function gse(t){return["html","body","#document"].includes(t.localName)?t.ownerDocument.body:C4(t)&&qVe(t)?t:gse($Ve(t))}var vse=t=>t.hasAttribute("tabindex"),YVe=t=>vse(t)&&t.tabIndex===-1;function XVe(t){return!!t.getAttribute("disabled")||!!t.getAttribute("aria-disabled")}function _se(t){return t.parentElement&&_se(t.parentElement)?!0:t.hidden}function JVe(t){const e=t.getAttribute("contenteditable");return e!=="false"&&e!=null}function yse(t){if(!C4(t)||_se(t)||XVe(t))return!1;const{localName:e}=t;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const o={a:()=>t.hasAttribute("href"),audio:()=>t.hasAttribute("controls"),video:()=>t.hasAttribute("controls")};return e in o?o[e]():JVe(t)?!0:vse(t)}function QVe(t){return t?C4(t)&&yse(t)&&!YVe(t):!1}var ZVe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],e2e=ZVe.join(),t2e=t=>t.offsetWidth>0&&t.offsetHeight>0;function Ese(t){const e=Array.from(t.querySelectorAll(e2e));return e.unshift(t),e.filter(r=>yse(r)&&t2e(r))}var iQ,n2e=(iQ=DF.default)!=null?iQ:DF,Sse=t=>{const{initialFocusRef:e,finalFocusRef:r,contentRef:o,restoreFocus:a,children:u,isDisabled:d,autoFocus:f,persistentFocus:g,lockFocusAcrossFrames:E}=t,T=X.useCallback(()=>{e!=null&&e.current?e.current.focus():o!=null&&o.current&&Ese(o.current).length===0&&requestAnimationFrame(()=>{var L;(L=o.current)==null||L.focus()})},[e,o]),C=X.useCallback(()=>{var D;(D=r==null?void 0:r.current)==null||D.focus()},[r]),I=a&&!r;return $.jsx(n2e,{crossFrame:E,persistentFocus:g,autoFocus:f,disabled:d,onActivation:T,onDeactivation:C,returnFocus:I,children:u})};Sse.displayName="FocusLock";var r2e=eNe?X.useLayoutEffect:X.useEffect;function sQ(t,e=[]){const r=X.useRef(t);return r2e(()=>{r.current=t}),X.useCallback((...o)=>{var a;return(a=r.current)==null?void 0:a.call(r,...o)},e)}function i2e(t,e){const r=X.useId();return X.useMemo(()=>t||[e,r].filter(Boolean).join("-"),[t,e,r])}function s2e(t,e){const r=t!==void 0;return[r,r&&typeof t<"u"?t:e]}function o2e(t={}){const{onClose:e,onOpen:r,isOpen:o,id:a}=t,u=sQ(r),d=sQ(e),[f,g]=X.useState(t.defaultIsOpen||!1),[E,T]=s2e(o,f),C=i2e(a,"disclosure"),I=X.useCallback(()=>{E||g(!1),d==null||d()},[E,d]),D=X.useCallback(()=>{E||g(!0),u==null||u()},[E,u]),L=X.useCallback(()=>{(T?I:D)()},[T,D,I]);return{isOpen:!!T,onOpen:D,onClose:I,onToggle:L,isControlled:E,getButtonProps:(B={})=>({...B,"aria-expanded":T,"aria-controls":C,onClick:sNe(B.onClick,L)}),getDisclosureProps:(B={})=>({...B,hidden:!T,id:C})}}var[a2e,c2e]=Bs({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),LF=gn(function(e,r){const o=cl("Input",e),{children:a,className:u,...d}=eo(e),f=dr("chakra-input__group",u),g={},E=d4(a),T=o.field;E.forEach(I=>{var D,L;o&&(T&&I.type.id==="InputLeftElement"&&(g.paddingStart=(D=T.height)!=null?D:T.h),T&&I.type.id==="InputRightElement"&&(g.paddingEnd=(L=T.height)!=null?L:T.h),I.type.id==="InputRightAddon"&&(g.borderEndRadius=0),I.type.id==="InputLeftAddon"&&(g.borderStartRadius=0))});const C=E.map(I=>{var D,L;const B=Xne({size:((D=I.props)==null?void 0:D.size)||e.size,variant:((L=I.props)==null?void 0:L.variant)||e.variant});return I.type.id!=="Input"?X.cloneElement(I,B):X.cloneElement(I,Object.assign(B,g,I.props))});return $.jsx(Yt.div,{className:f,ref:r,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...o.group},"data-group":!0,...d,children:$.jsx(a2e,{value:o,children:C})})});LF.displayName="InputGroup";var u2e=Yt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),B1=gn(function(e,r){var o,a;const{placement:u="left",...d}=e,f=c2e(),g=f.field,T={[u==="left"?"insetStart":"insetEnd"]:"0",width:(o=g==null?void 0:g.height)!=null?o:g==null?void 0:g.h,height:(a=g==null?void 0:g.height)!=null?a:g==null?void 0:g.h,fontSize:g==null?void 0:g.fontSize,...f.element};return $.jsx(u2e,{ref:r,__css:T,...d})});B1.id="InputElement";B1.displayName="InputElement";var VN=gn(function(e,r){const{className:o,...a}=e,u=dr("chakra-input__left-element",o);return $.jsx(B1,{ref:r,placement:"left",className:u,...a})});VN.id="InputLeftElement";VN.displayName="InputLeftElement";var Tse=gn(function(e,r){const{className:o,...a}=e,u=dr("chakra-input__right-element",o);return $.jsx(B1,{ref:r,placement:"right",className:u,...a})});Tse.id="InputRightElement";Tse.displayName="InputRightElement";var Td=gn(function(e,r){const{htmlSize:o,...a}=e,u=cl("Input",a),d=eo(a),f=Vie(d),g=dr("chakra-input",e.className);return $.jsx(Yt.input,{size:o,...f,__css:u.field,ref:r,className:g})});Td.displayName="Input";Td.id="Input";var kf=gn(function(e,r){const o=gh("Link",e),{className:a,isExternal:u,...d}=eo(e);return $.jsx(Yt.a,{target:u?"_blank":void 0,rel:u?"noopener":void 0,ref:r,className:dr("chakra-link",a),...d,__css:o})});kf.displayName="Link";var bse=gn(function(e,r){const{templateAreas:o,gap:a,rowGap:u,columnGap:d,column:f,row:g,autoFlow:E,autoRows:T,templateRows:C,autoColumns:I,templateColumns:D,...L}=e,B={display:"grid",gridTemplateAreas:o,gridGap:a,gridRowGap:u,gridColumnGap:d,gridAutoColumns:I,gridColumn:f,gridRow:g,gridAutoFlow:E,gridAutoRows:T,gridTemplateRows:C,gridTemplateColumns:D};return $.jsx(Yt.div,{ref:r,__css:B,...L})});bse.displayName="Grid";function R4(t,e){return Array.isArray(t)?t.map(r=>r===null?null:e(r)):hh(t)?Object.keys(t).reduce((r,o)=>(r[o]=e(t[o]),r),{}):t!=null?e(t):null}var wse=gn(function(e,r){const{columns:o,spacingX:a,spacingY:u,spacing:d,minChildWidth:f,...g}=e,E=qT(),T=f?d2e(f,E):h2e(o);return $.jsx(bse,{ref:r,gap:d,columnGap:a,rowGap:u,templateColumns:T,...g})});wse.displayName="SimpleGrid";function l2e(t){return typeof t=="number"?`${t}px`:t}function d2e(t,e){return R4(t,r=>{const o=dwe("sizes",r,l2e(r))(e);return r===null?null:`repeat(auto-fit, minmax(${o}, 1fr))`})}function h2e(t){return R4(t,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}var Cse=Yt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});Cse.displayName="Spacer";var Br=gn(function(e,r){const o=gh("Text",e),{className:a,align:u,decoration:d,casing:f,...g}=eo(e),E=Xne({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return $.jsx(Yt.p,{ref:r,className:dr("chakra-text",e.className),...E,...g,__css:o})});Br.displayName="Text";var Rse=t=>$.jsx(Yt.div,{className:"chakra-stack__item",...t,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...t.__css}});Rse.displayName="StackItem";function f2e(t){const{spacing:e,direction:r}=t,o={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":R4(r,a=>o[a])}}var I4=gn((t,e)=>{const{isInline:r,direction:o,align:a,justify:u,spacing:d="0.5rem",wrap:f,children:g,divider:E,className:T,shouldWrapChildren:C,...I}=t,D=r?"row":o??"column",L=X.useMemo(()=>f2e({spacing:d,direction:D}),[d,D]),B=!!E,G=!C&&!B,se=X.useMemo(()=>{const M=d4(g);return G?M:M.map((F,z)=>{const te=typeof F.key<"u"?F.key:z,j=z+1===M.length,Q=C?$.jsx(Rse,{children:F},te):F;if(!B)return Q;const ce=X.cloneElement(E,{__css:L}),Ee=j?null:ce;return $.jsxs(X.Fragment,{children:[Q,Ee]},te)})},[E,L,B,G,C,g]),ae=dr("chakra-stack",T);return $.jsx(Yt.div,{ref:e,display:"flex",alignItems:a,justifyContent:u,flexDirection:D,flexWrap:f,gap:B?void 0:d,className:ae,...I,children:se})});I4.displayName="Stack";var vu=gn((t,e)=>$.jsx(I4,{align:"center",...t,direction:"column",ref:e}));vu.displayName="VStack";var RT=gn((t,e)=>$.jsx(I4,{align:"center",...t,direction:"row",ref:e}));RT.displayName="HStack";var A4=gn(function(e,r){const o=gh("Heading",e),{className:a,...u}=eo(e);return $.jsx(Yt.h2,{ref:r,className:dr("chakra-heading",e.className),...u,__css:o})});A4.displayName="Heading";var sr=Yt("div");sr.displayName="Box";var Ise=gn(function(e,r){const{size:o,centerContent:a=!0,...u}=e,d=a?{display:"flex",alignItems:"center",justifyContent:"center"}:{};return $.jsx(sr,{ref:r,boxSize:o,__css:{...d,flexShrink:0,flexGrow:0},...u})});Ise.displayName="Square";var p2e=gn(function(e,r){const{size:o,...a}=e;return $.jsx(Ise,{size:o,ref:r,borderRadius:"9999px",...a})});p2e.displayName="Circle";var Ase=gn(function(e,r){const o=gh("Badge",e),{className:a,...u}=eo(e);return $.jsx(Yt.span,{ref:r,className:dr("chakra-badge",e.className),...u,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});Ase.displayName="Badge";var kse=Yt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});kse.displayName="Center";var m2e={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};gn(function(e,r){const{axis:o="both",...a}=e;return $.jsx(Yt.div,{ref:r,__css:m2e[o],...a,position:"absolute"})});var k4=gn(function(e,r){const{borderLeftWidth:o,borderBottomWidth:a,borderTopWidth:u,borderRightWidth:d,borderWidth:f,borderStyle:g,borderColor:E,...T}=gh("Divider",e),{className:C,orientation:I="horizontal",__css:D,...L}=eo(e),B={vertical:{borderLeftWidth:o||d||f||"1px",height:"100%"},horizontal:{borderBottomWidth:a||u||f||"1px",width:"100%"}};return $.jsx(Yt.hr,{ref:r,"aria-orientation":I,...L,__css:{...T,border:"0",borderColor:E,borderStyle:g,...B[I],...D},className:dr("chakra-divider",C)})});k4.displayName="Divider";var FN=gn(function(e,r){const{direction:o,align:a,justify:u,wrap:d,basis:f,grow:g,shrink:E,...T}=e,C={display:"flex",flexDirection:o,alignItems:a,justifyContent:u,flexWrap:d,flexBasis:f,flexGrow:g,flexShrink:E};return $.jsx(Yt.div,{ref:r,__css:C,...T})});FN.displayName="Flex";function g2e(t){const{key:e}=t;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function v2e(t={}){const{timeout:e=300,preventDefault:r=()=>!0}=t,[o,a]=X.useState([]),u=X.useRef(),d=()=>{u.current&&(clearTimeout(u.current),u.current=null)},f=()=>{d(),u.current=setTimeout(()=>{a([]),u.current=null},e)};X.useEffect(()=>d,[]);function g(E){return T=>{if(T.key==="Backspace"){const C=[...o];C.pop(),a(C);return}if(g2e(T)){const C=o.concat(T.key);r(T)&&(T.preventDefault(),T.stopPropagation()),a(C),E(C.join("")),f()}}}return g}function _2e(t,e,r,o){if(e==null)return o;if(!o)return t.find(d=>r(d).toLowerCase().startsWith(e.toLowerCase()));const a=t.filter(u=>r(u).toLowerCase().startsWith(e.toLowerCase()));if(a.length>0){let u;return a.includes(o)?(u=a.indexOf(o)+1,u===a.length&&(u=0),a[u]):(u=t.indexOf(a[0]),t[u])}return o}function y2e(){const t=X.useRef(new Map),e=t.current,r=X.useCallback((a,u,d,f)=>{t.current.set(d,{type:u,el:a,options:f}),a.addEventListener(u,d,f)},[]),o=X.useCallback((a,u,d,f)=>{a.removeEventListener(u,d,f),t.current.delete(d)},[]);return X.useEffect(()=>()=>{e.forEach((a,u)=>{o(a.el,a.type,u,a.options)})},[o,e]),{add:r,remove:o}}function e2(t){const e=t.target,{tagName:r,isContentEditable:o}=e;return r!=="INPUT"&&r!=="TEXTAREA"&&o!==!0}function E2e(t={}){const{ref:e,isDisabled:r,isFocusable:o,clickOnEnter:a=!0,clickOnSpace:u=!0,onMouseDown:d,onMouseUp:f,onClick:g,onKeyDown:E,onKeyUp:T,tabIndex:C,onMouseOver:I,onMouseLeave:D,...L}=t,[B,G]=X.useState(!0),[se,ae]=X.useState(!1),M=y2e(),F=Ne=>{Ne&&Ne.tagName!=="BUTTON"&&G(!1)},z=B?C:C||0,te=r&&!o,j=X.useCallback(Ne=>{if(r){Ne.stopPropagation(),Ne.preventDefault();return}Ne.currentTarget.focus(),g==null||g(Ne)},[r,g]),K=X.useCallback(Ne=>{se&&e2(Ne)&&(Ne.preventDefault(),Ne.stopPropagation(),ae(!1),M.remove(document,"keyup",K,!1))},[se,M]),Q=X.useCallback(Ne=>{if(E==null||E(Ne),r||Ne.defaultPrevented||Ne.metaKey||!e2(Ne.nativeEvent)||B)return;const Re=a&&Ne.key==="Enter";u&&Ne.key===" "&&(Ne.preventDefault(),ae(!0)),Re&&(Ne.preventDefault(),Ne.currentTarget.click()),M.add(document,"keyup",K,!1)},[r,B,E,a,u,M,K]),ce=X.useCallback(Ne=>{if(T==null||T(Ne),r||Ne.defaultPrevented||Ne.metaKey||!e2(Ne.nativeEvent)||B)return;u&&Ne.key===" "&&(Ne.preventDefault(),ae(!1),Ne.currentTarget.click())},[u,B,r,T]),Ee=X.useCallback(Ne=>{Ne.button===0&&(ae(!1),M.remove(document,"mouseup",Ee,!1))},[M]),_e=X.useCallback(Ne=>{if(Ne.button!==0)return;if(r){Ne.stopPropagation(),Ne.preventDefault();return}B||ae(!0),Ne.currentTarget.focus({preventScroll:!0}),M.add(document,"mouseup",Ee,!1),d==null||d(Ne)},[r,B,d,M,Ee]),pe=X.useCallback(Ne=>{Ne.button===0&&(B||ae(!1),f==null||f(Ne))},[f,B]),qe=X.useCallback(Ne=>{if(r){Ne.preventDefault();return}I==null||I(Ne)},[r,I]),St=X.useCallback(Ne=>{se&&(Ne.preventDefault(),ae(!1)),D==null||D(Ne)},[se,D]),ke=Qs(e,F);return B?{...L,ref:ke,type:"button","aria-disabled":te?void 0:r,disabled:te,onClick:j,onMouseDown:d,onMouseUp:f,onKeyUp:T,onKeyDown:E,onMouseOver:I,onMouseLeave:D}:{...L,ref:ke,role:"button","data-active":zr(se),"aria-disabled":r?"true":void 0,tabIndex:te?void 0:z,onClick:j,onMouseDown:_e,onMouseUp:pe,onKeyUp:ce,onKeyDown:Q,onMouseOver:qe,onMouseLeave:St}}function S2e(t){const e=t.current;if(!e)return!1;const r=KVe(e);return!r||e.contains(r)?!1:!!QVe(r)}function Ose(t,e){const{shouldFocus:r,visible:o,focusRef:a}=e,u=r&&!o;ay(()=>{if(!u||S2e(t))return;const d=(a==null?void 0:a.current)||t.current;let f;if(d)return f=requestAnimationFrame(()=>{d.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(f)}},[u,t,a])}var T2e={preventScroll:!0,shouldFocus:!1};function b2e(t,e=T2e){const{focusRef:r,preventScroll:o,shouldFocus:a,visible:u}=e,d=w2e(t)?t.current:t,f=a&&u,g=X.useRef(f),E=X.useRef(u);Vp(()=>{!E.current&&u&&(g.current=f),E.current=u},[u,f]);const T=X.useCallback(()=>{if(!(!u||!d||!g.current)&&(g.current=!1,!d.contains(document.activeElement)))if(r!=null&&r.current)requestAnimationFrame(()=>{var C;(C=r.current)==null||C.focus({preventScroll:o})});else{const C=Ese(d);C.length>0&&requestAnimationFrame(()=>{C[0].focus({preventScroll:o})})}},[u,o,d,r]);ay(()=>{T()},[T]),dT(d,"transitionend",T)}function w2e(t){return"current"in t}var PS=(t,e)=>({var:t,varRef:e?`var(${t}, ${e})`:`var(${t})`}),Xo={arrowShadowColor:PS("--popper-arrow-shadow-color"),arrowSize:PS("--popper-arrow-size","8px"),arrowSizeHalf:PS("--popper-arrow-size-half"),arrowBg:PS("--popper-arrow-bg"),transformOrigin:PS("--popper-transform-origin"),arrowOffset:PS("--popper-arrow-offset")};function C2e(t){if(t.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(t.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(t.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(t.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}var R2e={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},I2e=t=>R2e[t],oQ={scroll:!0,resize:!0};function A2e(t){let e;return typeof t=="object"?e={enabled:!0,options:{...oQ,...t}}:e={enabled:t,options:oQ},e}var k2e={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:t})=>{t.styles.popper.width=`${t.rects.reference.width}px`},effect:({state:t})=>()=>{const e=t.elements.reference;t.elements.popper.style.width=`${e.offsetWidth}px`}},O2e={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:t})=>{aQ(t)},effect:({state:t})=>()=>{aQ(t)}},aQ=t=>{t.elements.popper.style.setProperty(Xo.transformOrigin.var,I2e(t.placement))},P2e={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:t})=>{N2e(t)}},N2e=t=>{var e;if(!t.placement)return;const r=D2e(t.placement);if((e=t.elements)!=null&&e.arrow&&r){Object.assign(t.elements.arrow.style,{[r.property]:r.value,width:Xo.arrowSize.varRef,height:Xo.arrowSize.varRef,zIndex:-1});const o={[Xo.arrowSizeHalf.var]:`calc(${Xo.arrowSize.varRef} / 2 - 1px)`,[Xo.arrowOffset.var]:`calc(${Xo.arrowSizeHalf.varRef} * -1)`};for(const a in o)t.elements.arrow.style.setProperty(a,o[a])}},D2e=t=>{if(t.startsWith("top"))return{property:"bottom",value:Xo.arrowOffset.varRef};if(t.startsWith("bottom"))return{property:"top",value:Xo.arrowOffset.varRef};if(t.startsWith("left"))return{property:"right",value:Xo.arrowOffset.varRef};if(t.startsWith("right"))return{property:"left",value:Xo.arrowOffset.varRef}},L2e={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:t})=>{cQ(t)},effect:({state:t})=>()=>{cQ(t)}},cQ=t=>{if(!t.elements.arrow)return;const e=t.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const r=C2e(t.placement);r&&e.style.setProperty("--popper-arrow-default-shadow",r),Object.assign(e.style,{transform:"rotate(45deg)",background:Xo.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},x2e={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},M2e={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function U2e(t,e="ltr"){var r,o;const a=((r=x2e[t])==null?void 0:r[e])||t;return e==="ltr"?a:(o=M2e[t])!=null?o:a}var nl="top",Rd="bottom",Id="right",rl="left",O4="auto",MR=[nl,Rd,Id,rl],IT="start",rR="end",V2e="clippingParents",Pse="viewport",Nw="popper",F2e="reference",uQ=MR.reduce(function(t,e){return t.concat([e+"-"+IT,e+"-"+rR])},[]),Nse=[].concat(MR,[O4]).reduce(function(t,e){return t.concat([e,e+"-"+IT,e+"-"+rR])},[]),j2e="beforeRead",B2e="read",W2e="afterRead",z2e="beforeMain",G2e="main",H2e="afterMain",K2e="beforeWrite",q2e="write",$2e="afterWrite",Y2e=[j2e,B2e,W2e,z2e,G2e,H2e,K2e,q2e,$2e];function Of(t){return t?(t.nodeName||"").toLowerCase():null}function Bl(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function dy(t){var e=Bl(t).Element;return t instanceof e||t instanceof Element}function wd(t){var e=Bl(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function P4(t){if(typeof ShadowRoot>"u")return!1;var e=Bl(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function X2e(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var o=e.styles[r]||{},a=e.attributes[r]||{},u=e.elements[r];!wd(u)||!Of(u)||(Object.assign(u.style,o),Object.keys(a).forEach(function(d){var f=a[d];f===!1?u.removeAttribute(d):u.setAttribute(d,f===!0?"":f)}))})}function J2e(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(o){var a=e.elements[o],u=e.attributes[o]||{},d=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:r[o]),f=d.reduce(function(g,E){return g[E]="",g},{});!wd(a)||!Of(a)||(Object.assign(a.style,f),Object.keys(u).forEach(function(g){a.removeAttribute(g)}))})}}const Q2e={name:"applyStyles",enabled:!0,phase:"write",fn:X2e,effect:J2e,requires:["computeStyles"]};function gf(t){return t.split("-")[0]}var Z_=Math.max,jN=Math.min,AT=Math.round;function xF(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Dse(){return!/^((?!chrome|android).)*safari/i.test(xF())}function kT(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1);var o=t.getBoundingClientRect(),a=1,u=1;e&&wd(t)&&(a=t.offsetWidth>0&&AT(o.width)/t.offsetWidth||1,u=t.offsetHeight>0&&AT(o.height)/t.offsetHeight||1);var d=dy(t)?Bl(t):window,f=d.visualViewport,g=!Dse()&&r,E=(o.left+(g&&f?f.offsetLeft:0))/a,T=(o.top+(g&&f?f.offsetTop:0))/u,C=o.width/a,I=o.height/u;return{width:C,height:I,top:T,right:E+C,bottom:T+I,left:E,x:E,y:T}}function N4(t){var e=kT(t),r=t.offsetWidth,o=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:o}}function Lse(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&P4(r)){var o=e;do{if(o&&t.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function qp(t){return Bl(t).getComputedStyle(t)}function Z2e(t){return["table","td","th"].indexOf(Of(t))>=0}function Xg(t){return((dy(t)?t.ownerDocument:t.document)||window.document).documentElement}function W1(t){return Of(t)==="html"?t:t.assignedSlot||t.parentNode||(P4(t)?t.host:null)||Xg(t)}function lQ(t){return!wd(t)||qp(t).position==="fixed"?null:t.offsetParent}function eFe(t){var e=/firefox/i.test(xF()),r=/Trident/i.test(xF());if(r&&wd(t)){var o=qp(t);if(o.position==="fixed")return null}var a=W1(t);for(P4(a)&&(a=a.host);wd(a)&&["html","body"].indexOf(Of(a))<0;){var u=qp(a);if(u.transform!=="none"||u.perspective!=="none"||u.contain==="paint"||["transform","perspective"].indexOf(u.willChange)!==-1||e&&u.willChange==="filter"||e&&u.filter&&u.filter!=="none")return a;a=a.parentNode}return null}function UR(t){for(var e=Bl(t),r=lQ(t);r&&Z2e(r)&&qp(r).position==="static";)r=lQ(r);return r&&(Of(r)==="html"||Of(r)==="body"&&qp(r).position==="static")?e:r||eFe(t)||e}function D4(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function RC(t,e,r){return Z_(t,jN(e,r))}function tFe(t,e,r){var o=RC(t,e,r);return o>r?r:o}function xse(){return{top:0,right:0,bottom:0,left:0}}function Mse(t){return Object.assign({},xse(),t)}function Use(t,e){return e.reduce(function(r,o){return r[o]=t,r},{})}var nFe=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,Mse(typeof e!="number"?e:Use(e,MR))};function rFe(t){var e,r=t.state,o=t.name,a=t.options,u=r.elements.arrow,d=r.modifiersData.popperOffsets,f=gf(r.placement),g=D4(f),E=[rl,Id].indexOf(f)>=0,T=E?"height":"width";if(!(!u||!d)){var C=nFe(a.padding,r),I=N4(u),D=g==="y"?nl:rl,L=g==="y"?Rd:Id,B=r.rects.reference[T]+r.rects.reference[g]-d[g]-r.rects.popper[T],G=d[g]-r.rects.reference[g],se=UR(u),ae=se?g==="y"?se.clientHeight||0:se.clientWidth||0:0,M=B/2-G/2,F=C[D],z=ae-I[T]-C[L],te=ae/2-I[T]/2+M,j=RC(F,te,z),K=g;r.modifiersData[o]=(e={},e[K]=j,e.centerOffset=j-te,e)}}function iFe(t){var e=t.state,r=t.options,o=r.element,a=o===void 0?"[data-popper-arrow]":o;a!=null&&(typeof a=="string"&&(a=e.elements.popper.querySelector(a),!a)||Lse(e.elements.popper,a)&&(e.elements.arrow=a))}const sFe={name:"arrow",enabled:!0,phase:"main",fn:rFe,effect:iFe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function OT(t){return t.split("-")[1]}var oFe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function aFe(t,e){var r=t.x,o=t.y,a=e.devicePixelRatio||1;return{x:AT(r*a)/a||0,y:AT(o*a)/a||0}}function dQ(t){var e,r=t.popper,o=t.popperRect,a=t.placement,u=t.variation,d=t.offsets,f=t.position,g=t.gpuAcceleration,E=t.adaptive,T=t.roundOffsets,C=t.isFixed,I=d.x,D=I===void 0?0:I,L=d.y,B=L===void 0?0:L,G=typeof T=="function"?T({x:D,y:B}):{x:D,y:B};D=G.x,B=G.y;var se=d.hasOwnProperty("x"),ae=d.hasOwnProperty("y"),M=rl,F=nl,z=window;if(E){var te=UR(r),j="clientHeight",K="clientWidth";if(te===Bl(r)&&(te=Xg(r),qp(te).position!=="static"&&f==="absolute"&&(j="scrollHeight",K="scrollWidth")),te=te,a===nl||(a===rl||a===Id)&&u===rR){F=Rd;var Q=C&&te===z&&z.visualViewport?z.visualViewport.height:te[j];B-=Q-o.height,B*=g?1:-1}if(a===rl||(a===nl||a===Rd)&&u===rR){M=Id;var ce=C&&te===z&&z.visualViewport?z.visualViewport.width:te[K];D-=ce-o.width,D*=g?1:-1}}var Ee=Object.assign({position:f},E&&oFe),_e=T===!0?aFe({x:D,y:B},Bl(r)):{x:D,y:B};if(D=_e.x,B=_e.y,g){var pe;return Object.assign({},Ee,(pe={},pe[F]=ae?"0":"",pe[M]=se?"0":"",pe.transform=(z.devicePixelRatio||1)<=1?"translate("+D+"px, "+B+"px)":"translate3d("+D+"px, "+B+"px, 0)",pe))}return Object.assign({},Ee,(e={},e[F]=ae?B+"px":"",e[M]=se?D+"px":"",e.transform="",e))}function cFe(t){var e=t.state,r=t.options,o=r.gpuAcceleration,a=o===void 0?!0:o,u=r.adaptive,d=u===void 0?!0:u,f=r.roundOffsets,g=f===void 0?!0:f,E={placement:gf(e.placement),variation:OT(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:a,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,dQ(Object.assign({},E,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:d,roundOffsets:g})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,dQ(Object.assign({},E,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:g})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const uFe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:cFe,data:{}};var mP={passive:!0};function lFe(t){var e=t.state,r=t.instance,o=t.options,a=o.scroll,u=a===void 0?!0:a,d=o.resize,f=d===void 0?!0:d,g=Bl(e.elements.popper),E=[].concat(e.scrollParents.reference,e.scrollParents.popper);return u&&E.forEach(function(T){T.addEventListener("scroll",r.update,mP)}),f&&g.addEventListener("resize",r.update,mP),function(){u&&E.forEach(function(T){T.removeEventListener("scroll",r.update,mP)}),f&&g.removeEventListener("resize",r.update,mP)}}const dFe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:lFe,data:{}};var hFe={left:"right",right:"left",bottom:"top",top:"bottom"};function ZP(t){return t.replace(/left|right|bottom|top/g,function(e){return hFe[e]})}var fFe={start:"end",end:"start"};function hQ(t){return t.replace(/start|end/g,function(e){return fFe[e]})}function L4(t){var e=Bl(t),r=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:r,scrollTop:o}}function x4(t){return kT(Xg(t)).left+L4(t).scrollLeft}function pFe(t,e){var r=Bl(t),o=Xg(t),a=r.visualViewport,u=o.clientWidth,d=o.clientHeight,f=0,g=0;if(a){u=a.width,d=a.height;var E=Dse();(E||!E&&e==="fixed")&&(f=a.offsetLeft,g=a.offsetTop)}return{width:u,height:d,x:f+x4(t),y:g}}function mFe(t){var e,r=Xg(t),o=L4(t),a=(e=t.ownerDocument)==null?void 0:e.body,u=Z_(r.scrollWidth,r.clientWidth,a?a.scrollWidth:0,a?a.clientWidth:0),d=Z_(r.scrollHeight,r.clientHeight,a?a.scrollHeight:0,a?a.clientHeight:0),f=-o.scrollLeft+x4(t),g=-o.scrollTop;return qp(a||r).direction==="rtl"&&(f+=Z_(r.clientWidth,a?a.clientWidth:0)-u),{width:u,height:d,x:f,y:g}}function M4(t){var e=qp(t),r=e.overflow,o=e.overflowX,a=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+a+o)}function Vse(t){return["html","body","#document"].indexOf(Of(t))>=0?t.ownerDocument.body:wd(t)&&M4(t)?t:Vse(W1(t))}function IC(t,e){var r;e===void 0&&(e=[]);var o=Vse(t),a=o===((r=t.ownerDocument)==null?void 0:r.body),u=Bl(o),d=a?[u].concat(u.visualViewport||[],M4(o)?o:[]):o,f=e.concat(d);return a?f:f.concat(IC(W1(d)))}function MF(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function gFe(t,e){var r=kT(t,!1,e==="fixed");return r.top=r.top+t.clientTop,r.left=r.left+t.clientLeft,r.bottom=r.top+t.clientHeight,r.right=r.left+t.clientWidth,r.width=t.clientWidth,r.height=t.clientHeight,r.x=r.left,r.y=r.top,r}function fQ(t,e,r){return e===Pse?MF(pFe(t,r)):dy(e)?gFe(e,r):MF(mFe(Xg(t)))}function vFe(t){var e=IC(W1(t)),r=["absolute","fixed"].indexOf(qp(t).position)>=0,o=r&&wd(t)?UR(t):t;return dy(o)?e.filter(function(a){return dy(a)&&Lse(a,o)&&Of(a)!=="body"}):[]}function _Fe(t,e,r,o){var a=e==="clippingParents"?vFe(t):[].concat(e),u=[].concat(a,[r]),d=u[0],f=u.reduce(function(g,E){var T=fQ(t,E,o);return g.top=Z_(T.top,g.top),g.right=jN(T.right,g.right),g.bottom=jN(T.bottom,g.bottom),g.left=Z_(T.left,g.left),g},fQ(t,d,o));return f.width=f.right-f.left,f.height=f.bottom-f.top,f.x=f.left,f.y=f.top,f}function Fse(t){var e=t.reference,r=t.element,o=t.placement,a=o?gf(o):null,u=o?OT(o):null,d=e.x+e.width/2-r.width/2,f=e.y+e.height/2-r.height/2,g;switch(a){case nl:g={x:d,y:e.y-r.height};break;case Rd:g={x:d,y:e.y+e.height};break;case Id:g={x:e.x+e.width,y:f};break;case rl:g={x:e.x-r.width,y:f};break;default:g={x:e.x,y:e.y}}var E=a?D4(a):null;if(E!=null){var T=E==="y"?"height":"width";switch(u){case IT:g[E]=g[E]-(e[T]/2-r[T]/2);break;case rR:g[E]=g[E]+(e[T]/2-r[T]/2);break}}return g}function iR(t,e){e===void 0&&(e={});var r=e,o=r.placement,a=o===void 0?t.placement:o,u=r.strategy,d=u===void 0?t.strategy:u,f=r.boundary,g=f===void 0?V2e:f,E=r.rootBoundary,T=E===void 0?Pse:E,C=r.elementContext,I=C===void 0?Nw:C,D=r.altBoundary,L=D===void 0?!1:D,B=r.padding,G=B===void 0?0:B,se=Mse(typeof G!="number"?G:Use(G,MR)),ae=I===Nw?F2e:Nw,M=t.rects.popper,F=t.elements[L?ae:I],z=_Fe(dy(F)?F:F.contextElement||Xg(t.elements.popper),g,T,d),te=kT(t.elements.reference),j=Fse({reference:te,element:M,placement:a}),K=MF(Object.assign({},M,j)),Q=I===Nw?K:te,ce={top:z.top-Q.top+se.top,bottom:Q.bottom-z.bottom+se.bottom,left:z.left-Q.left+se.left,right:Q.right-z.right+se.right},Ee=t.modifiersData.offset;if(I===Nw&&Ee){var _e=Ee[a];Object.keys(ce).forEach(function(pe){var qe=[Id,Rd].indexOf(pe)>=0?1:-1,St=[nl,Rd].indexOf(pe)>=0?"y":"x";ce[pe]+=_e[St]*qe})}return ce}function yFe(t,e){e===void 0&&(e={});var r=e,o=r.placement,a=r.boundary,u=r.rootBoundary,d=r.padding,f=r.flipVariations,g=r.allowedAutoPlacements,E=g===void 0?Nse:g,T=OT(o),C=T?f?uQ:uQ.filter(function(L){return OT(L)===T}):MR,I=C.filter(function(L){return E.indexOf(L)>=0});I.length===0&&(I=C);var D=I.reduce(function(L,B){return L[B]=iR(t,{placement:B,boundary:a,rootBoundary:u,padding:d})[gf(B)],L},{});return Object.keys(D).sort(function(L,B){return D[L]-D[B]})}function EFe(t){if(gf(t)===O4)return[];var e=ZP(t);return[hQ(t),e,hQ(e)]}function SFe(t){var e=t.state,r=t.options,o=t.name;if(!e.modifiersData[o]._skip){for(var a=r.mainAxis,u=a===void 0?!0:a,d=r.altAxis,f=d===void 0?!0:d,g=r.fallbackPlacements,E=r.padding,T=r.boundary,C=r.rootBoundary,I=r.altBoundary,D=r.flipVariations,L=D===void 0?!0:D,B=r.allowedAutoPlacements,G=e.options.placement,se=gf(G),ae=se===G,M=g||(ae||!L?[ZP(G)]:EFe(G)),F=[G].concat(M).reduce(function(_t,Dt){return _t.concat(gf(Dt)===O4?yFe(e,{placement:Dt,boundary:T,rootBoundary:C,padding:E,flipVariations:L,allowedAutoPlacements:B}):Dt)},[]),z=e.rects.reference,te=e.rects.popper,j=new Map,K=!0,Q=F[0],ce=0;ce<F.length;ce++){var Ee=F[ce],_e=gf(Ee),pe=OT(Ee)===IT,qe=[nl,Rd].indexOf(_e)>=0,St=qe?"width":"height",ke=iR(e,{placement:Ee,boundary:T,rootBoundary:C,altBoundary:I,padding:E}),Ne=qe?pe?Id:rl:pe?Rd:nl;z[St]>te[St]&&(Ne=ZP(Ne));var Re=ZP(Ne),Ve=[];if(u&&Ve.push(ke[_e]<=0),f&&Ve.push(ke[Ne]<=0,ke[Re]<=0),Ve.every(function(_t){return _t})){Q=Ee,K=!1;break}j.set(Ee,Ve)}if(K)for(var ve=L?3:1,Be=function(Dt){var jt=F.find(function(Zt){var Xt=j.get(Zt);if(Xt)return Xt.slice(0,Dt).every(function(In){return In})});if(jt)return Q=jt,"break"},gt=ve;gt>0;gt--){var ze=Be(gt);if(ze==="break")break}e.placement!==Q&&(e.modifiersData[o]._skip=!0,e.placement=Q,e.reset=!0)}}const TFe={name:"flip",enabled:!0,phase:"main",fn:SFe,requiresIfExists:["offset"],data:{_skip:!1}};function pQ(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function mQ(t){return[nl,Id,Rd,rl].some(function(e){return t[e]>=0})}function bFe(t){var e=t.state,r=t.name,o=e.rects.reference,a=e.rects.popper,u=e.modifiersData.preventOverflow,d=iR(e,{elementContext:"reference"}),f=iR(e,{altBoundary:!0}),g=pQ(d,o),E=pQ(f,a,u),T=mQ(g),C=mQ(E);e.modifiersData[r]={referenceClippingOffsets:g,popperEscapeOffsets:E,isReferenceHidden:T,hasPopperEscaped:C},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":T,"data-popper-escaped":C})}const wFe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:bFe};function CFe(t,e,r){var o=gf(t),a=[rl,nl].indexOf(o)>=0?-1:1,u=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,d=u[0],f=u[1];return d=d||0,f=(f||0)*a,[rl,Id].indexOf(o)>=0?{x:f,y:d}:{x:d,y:f}}function RFe(t){var e=t.state,r=t.options,o=t.name,a=r.offset,u=a===void 0?[0,0]:a,d=Nse.reduce(function(T,C){return T[C]=CFe(C,e.rects,u),T},{}),f=d[e.placement],g=f.x,E=f.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=g,e.modifiersData.popperOffsets.y+=E),e.modifiersData[o]=d}const IFe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:RFe};function AFe(t){var e=t.state,r=t.name;e.modifiersData[r]=Fse({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const kFe={name:"popperOffsets",enabled:!0,phase:"read",fn:AFe,data:{}};function OFe(t){return t==="x"?"y":"x"}function PFe(t){var e=t.state,r=t.options,o=t.name,a=r.mainAxis,u=a===void 0?!0:a,d=r.altAxis,f=d===void 0?!1:d,g=r.boundary,E=r.rootBoundary,T=r.altBoundary,C=r.padding,I=r.tether,D=I===void 0?!0:I,L=r.tetherOffset,B=L===void 0?0:L,G=iR(e,{boundary:g,rootBoundary:E,padding:C,altBoundary:T}),se=gf(e.placement),ae=OT(e.placement),M=!ae,F=D4(se),z=OFe(F),te=e.modifiersData.popperOffsets,j=e.rects.reference,K=e.rects.popper,Q=typeof B=="function"?B(Object.assign({},e.rects,{placement:e.placement})):B,ce=typeof Q=="number"?{mainAxis:Q,altAxis:Q}:Object.assign({mainAxis:0,altAxis:0},Q),Ee=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,_e={x:0,y:0};if(te){if(u){var pe,qe=F==="y"?nl:rl,St=F==="y"?Rd:Id,ke=F==="y"?"height":"width",Ne=te[F],Re=Ne+G[qe],Ve=Ne-G[St],ve=D?-K[ke]/2:0,Be=ae===IT?j[ke]:K[ke],gt=ae===IT?-K[ke]:-j[ke],ze=e.elements.arrow,_t=D&&ze?N4(ze):{width:0,height:0},Dt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:xse(),jt=Dt[qe],Zt=Dt[St],Xt=RC(0,j[ke],_t[ke]),In=M?j[ke]/2-ve-Xt-jt-ce.mainAxis:Be-Xt-jt-ce.mainAxis,Qt=M?-j[ke]/2+ve+Xt+Zt+ce.mainAxis:gt+Xt+Zt+ce.mainAxis,Er=e.elements.arrow&&UR(e.elements.arrow),Tn=Er?F==="y"?Er.clientTop||0:Er.clientLeft||0:0,Vn=(pe=Ee==null?void 0:Ee[F])!=null?pe:0,wr=Ne+In-Vn-Tn,Pt=Ne+Qt-Vn,wn=RC(D?jN(Re,wr):Re,Ne,D?Z_(Ve,Pt):Ve);te[F]=wn,_e[F]=wn-Ne}if(f){var Dn,Ae=F==="x"?nl:rl,$e=F==="x"?Rd:Id,rt=te[z],at=z==="y"?"height":"width",ct=rt+G[Ae],Ke=rt-G[$e],nt=[nl,rl].indexOf(se)!==-1,At=(Dn=Ee==null?void 0:Ee[z])!=null?Dn:0,It=nt?ct:rt-j[at]-K[at]-At+ce.altAxis,Kt=nt?rt+j[at]+K[at]-At-ce.altAxis:Ke,Un=D&&nt?tFe(It,rt,Kt):RC(D?It:ct,rt,D?Kt:Ke);te[z]=Un,_e[z]=Un-rt}e.modifiersData[o]=_e}}const NFe={name:"preventOverflow",enabled:!0,phase:"main",fn:PFe,requiresIfExists:["offset"]};function DFe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function LFe(t){return t===Bl(t)||!wd(t)?L4(t):DFe(t)}function xFe(t){var e=t.getBoundingClientRect(),r=AT(e.width)/t.offsetWidth||1,o=AT(e.height)/t.offsetHeight||1;return r!==1||o!==1}function MFe(t,e,r){r===void 0&&(r=!1);var o=wd(e),a=wd(e)&&xFe(e),u=Xg(e),d=kT(t,a,r),f={scrollLeft:0,scrollTop:0},g={x:0,y:0};return(o||!o&&!r)&&((Of(e)!=="body"||M4(u))&&(f=LFe(e)),wd(e)?(g=kT(e,!0),g.x+=e.clientLeft,g.y+=e.clientTop):u&&(g.x=x4(u))),{x:d.left+f.scrollLeft-g.x,y:d.top+f.scrollTop-g.y,width:d.width,height:d.height}}function UFe(t){var e=new Map,r=new Set,o=[];t.forEach(function(u){e.set(u.name,u)});function a(u){r.add(u.name);var d=[].concat(u.requires||[],u.requiresIfExists||[]);d.forEach(function(f){if(!r.has(f)){var g=e.get(f);g&&a(g)}}),o.push(u)}return t.forEach(function(u){r.has(u.name)||a(u)}),o}function VFe(t){var e=UFe(t);return Y2e.reduce(function(r,o){return r.concat(e.filter(function(a){return a.phase===o}))},[])}function FFe(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function jFe(t){var e=t.reduce(function(r,o){var a=r[o.name];return r[o.name]=a?Object.assign({},a,o,{options:Object.assign({},a.options,o.options),data:Object.assign({},a.data,o.data)}):o,r},{});return Object.keys(e).map(function(r){return e[r]})}var gQ={placement:"bottom",modifiers:[],strategy:"absolute"};function vQ(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function BFe(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,o=r===void 0?[]:r,a=e.defaultOptions,u=a===void 0?gQ:a;return function(f,g,E){E===void 0&&(E=u);var T={placement:"bottom",orderedModifiers:[],options:Object.assign({},gQ,u),modifiersData:{},elements:{reference:f,popper:g},attributes:{},styles:{}},C=[],I=!1,D={state:T,setOptions:function(se){var ae=typeof se=="function"?se(T.options):se;B(),T.options=Object.assign({},u,T.options,ae),T.scrollParents={reference:dy(f)?IC(f):f.contextElement?IC(f.contextElement):[],popper:IC(g)};var M=VFe(jFe([].concat(o,T.options.modifiers)));return T.orderedModifiers=M.filter(function(F){return F.enabled}),L(),D.update()},forceUpdate:function(){if(!I){var se=T.elements,ae=se.reference,M=se.popper;if(vQ(ae,M)){T.rects={reference:MFe(ae,UR(M),T.options.strategy==="fixed"),popper:N4(M)},T.reset=!1,T.placement=T.options.placement,T.orderedModifiers.forEach(function(ce){return T.modifiersData[ce.name]=Object.assign({},ce.data)});for(var F=0;F<T.orderedModifiers.length;F++){if(T.reset===!0){T.reset=!1,F=-1;continue}var z=T.orderedModifiers[F],te=z.fn,j=z.options,K=j===void 0?{}:j,Q=z.name;typeof te=="function"&&(T=te({state:T,options:K,name:Q,instance:D})||T)}}}},update:FFe(function(){return new Promise(function(G){D.forceUpdate(),G(T)})}),destroy:function(){B(),I=!0}};if(!vQ(f,g))return D;D.setOptions(E).then(function(G){!I&&E.onFirstUpdate&&E.onFirstUpdate(G)});function L(){T.orderedModifiers.forEach(function(G){var se=G.name,ae=G.options,M=ae===void 0?{}:ae,F=G.effect;if(typeof F=="function"){var z=F({state:T,name:se,instance:D,options:M}),te=function(){};C.push(z||te)}})}function B(){C.forEach(function(G){return G()}),C=[]}return D}}var WFe=[dFe,kFe,uFe,Q2e,IFe,TFe,NFe,sFe,wFe],zFe=BFe({defaultModifiers:WFe});function U4(t={}){const{enabled:e=!0,modifiers:r,placement:o="bottom",strategy:a="absolute",arrowPadding:u=8,eventListeners:d=!0,offset:f,gutter:g=8,flip:E=!0,boundary:T="clippingParents",preventOverflow:C=!0,matchWidth:I,direction:D="ltr"}=t,L=X.useRef(null),B=X.useRef(null),G=X.useRef(null),se=U2e(o,D),ae=X.useRef(()=>{}),M=X.useCallback(()=>{var ce;!e||!L.current||!B.current||((ce=ae.current)==null||ce.call(ae),G.current=zFe(L.current,B.current,{placement:se,modifiers:[L2e,P2e,O2e,{...k2e,enabled:!!I},{name:"eventListeners",...A2e(d)},{name:"arrow",options:{padding:u}},{name:"offset",options:{offset:f??[0,g]}},{name:"flip",enabled:!!E,options:{padding:8}},{name:"preventOverflow",enabled:!!C,options:{boundary:T}},...r??[]],strategy:a}),G.current.forceUpdate(),ae.current=G.current.destroy)},[se,e,r,I,d,u,f,g,E,C,T,a]);X.useEffect(()=>()=>{var ce;!L.current&&!B.current&&((ce=G.current)==null||ce.destroy(),G.current=null)},[]);const F=X.useCallback(ce=>{L.current=ce,M()},[M]),z=X.useCallback((ce={},Ee=null)=>({...ce,ref:Qs(F,Ee)}),[F]),te=X.useCallback(ce=>{B.current=ce,M()},[M]),j=X.useCallback((ce={},Ee=null)=>({...ce,ref:Qs(te,Ee),style:{...ce.style,position:a,minWidth:I?void 0:"max-content",inset:"0 auto auto 0"}}),[a,te,I]),K=X.useCallback((ce={},Ee=null)=>{const{size:_e,shadowColor:pe,bg:qe,style:St,...ke}=ce;return{...ke,ref:Ee,"data-popper-arrow":"",style:GFe(ce)}},[]),Q=X.useCallback((ce={},Ee=null)=>({...ce,ref:Ee,"data-popper-arrow-inner":""}),[]);return{update(){var ce;(ce=G.current)==null||ce.update()},forceUpdate(){var ce;(ce=G.current)==null||ce.forceUpdate()},transformOrigin:Xo.transformOrigin.varRef,referenceRef:F,popperRef:te,getPopperProps:j,getArrowProps:K,getArrowInnerProps:Q,getReferenceProps:z}}function GFe(t){const{size:e,shadowColor:r,bg:o,style:a}=t,u={...a,position:"absolute"};return e&&(u["--popper-arrow-size"]=e),r&&(u["--popper-arrow-shadow-color"]=r),o&&(u["--popper-arrow-bg"]=o),u}function V4(t={}){const{onClose:e,onOpen:r,isOpen:o,id:a}=t,u=tl(r),d=tl(e),[f,g]=X.useState(t.defaultIsOpen||!1),E=o!==void 0?o:f,T=o!==void 0,C=X.useId(),I=a??`disclosure-${C}`,D=X.useCallback(()=>{T||g(!1),d==null||d()},[T,d]),L=X.useCallback(()=>{T||g(!0),u==null||u()},[T,u]),B=X.useCallback(()=>{E?D():L()},[E,L,D]);function G(ae={}){return{...ae,"aria-expanded":E,"aria-controls":I,onClick(M){var F;(F=ae.onClick)==null||F.call(ae,M),B()}}}function se(ae={}){return{...ae,hidden:!E,id:I}}return{isOpen:E,onOpen:L,onClose:D,onToggle:B,isControlled:T,getButtonProps:G,getDisclosureProps:se}}function HFe(t){const{ref:e,handler:r,enabled:o=!0}=t,a=tl(r),d=X.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;X.useEffect(()=>{if(!o)return;const f=C=>{t2(C,e)&&(d.isPointerDown=!0)},g=C=>{if(d.ignoreEmulatedMouseEvents){d.ignoreEmulatedMouseEvents=!1;return}d.isPointerDown&&r&&t2(C,e)&&(d.isPointerDown=!1,a(C))},E=C=>{d.ignoreEmulatedMouseEvents=!0,r&&d.isPointerDown&&t2(C,e)&&(d.isPointerDown=!1,a(C))},T=jse(e.current);return T.addEventListener("mousedown",f,!0),T.addEventListener("mouseup",g,!0),T.addEventListener("touchstart",f,!0),T.addEventListener("touchend",E,!0),()=>{T.removeEventListener("mousedown",f,!0),T.removeEventListener("mouseup",g,!0),T.removeEventListener("touchstart",f,!0),T.removeEventListener("touchend",E,!0)}},[r,e,a,d,o])}function t2(t,e){var r;const o=t.target;return o&&!jse(o).contains(o)?!1:!((r=e.current)!=null&&r.contains(o))}function jse(t){var e;return(e=t==null?void 0:t.ownerDocument)!=null?e:document}function Bse(t){const{isOpen:e,ref:r}=t,[o,a]=X.useState(e),[u,d]=X.useState(!1);return X.useEffect(()=>{u||(a(e),d(!0))},[e,u,o]),dT(()=>r.current,"animationend",()=>{a(e)}),{present:!(e?!1:!o),onComplete(){var g;const E=HVe(r.current),T=new E.CustomEvent("animationend",{bubbles:!0});(g=r.current)==null||g.dispatchEvent(T)}}}function F4(t){const{wasSelected:e,enabled:r,isSelected:o,mode:a="unmount"}=t;return!!(!r||o||a==="keepMounted"&&e)}var[KFe,qFe,$Fe,uXe]=Aie(),[YFe,z1]=Bs({strict:!1,name:"MenuContext"});function XFe(t,...e){const r=X.useId(),o=t||r;return X.useMemo(()=>e.map(a=>`${a}-${o}`),[o,e])}function JFe(t){var e;return(e=t==null?void 0:t.ownerDocument)!=null?e:document}function QFe(t={}){const{id:e,closeOnSelect:r=!0,closeOnBlur:o=!0,initialFocusRef:a,autoSelect:u=!0,isLazy:d,isOpen:f,defaultIsOpen:g,onClose:E,onOpen:T,placement:C="bottom-start",lazyBehavior:I="unmount",direction:D,computePositionOnMount:L=!1,...B}=t,G=X.useRef(null),se=X.useRef(null),ae=$Fe(),M=X.useCallback(()=>{requestAnimationFrame(()=>{var ze;(ze=G.current)==null||ze.focus({preventScroll:!1})})},[]),F=X.useCallback(()=>{const ze=setTimeout(()=>{var _t;if(a)(_t=a.current)==null||_t.focus();else{const Dt=ae.firstEnabled();Dt&&pe(Dt.index)}});Re.current.add(ze)},[ae,a]),z=X.useCallback(()=>{const ze=setTimeout(()=>{const _t=ae.lastEnabled();_t&&pe(_t.index)});Re.current.add(ze)},[ae]),te=X.useCallback(()=>{T==null||T(),u?F():M()},[u,F,M,T]),{isOpen:j,onOpen:K,onClose:Q,onToggle:ce}=V4({isOpen:f,defaultIsOpen:g,onClose:E,onOpen:te});HFe({enabled:j&&o,ref:G,handler:ze=>{var _t;(_t=se.current)!=null&&_t.contains(ze.target)||Q()}});const Ee=U4({...B,enabled:j||L,placement:C,direction:D}),[_e,pe]=X.useState(-1);ay(()=>{j||pe(-1)},[j]),Ose(G,{focusRef:se,visible:j,shouldFocus:!0});const qe=Bse({isOpen:j,ref:G}),[St,ke]=XFe(e,"menu-button","menu-list"),Ne=X.useCallback(()=>{K(),M()},[K,M]),Re=X.useRef(new Set([]));X.useEffect(()=>{const ze=Re.current;return()=>{ze.forEach(_t=>clearTimeout(_t)),ze.clear()}},[]);const Ve=X.useCallback(()=>{K(),F()},[F,K]),ve=X.useCallback(()=>{K(),z()},[K,z]),Be=X.useCallback(()=>{var ze,_t;const Dt=JFe(G.current),jt=(ze=G.current)==null?void 0:ze.contains(Dt.activeElement);if(!(j&&!jt))return;const Xt=(_t=ae.item(_e))==null?void 0:_t.node;Xt==null||Xt.focus({preventScroll:!0})},[j,_e,ae]),gt=X.useRef(null);return{openAndFocusMenu:Ne,openAndFocusFirstItem:Ve,openAndFocusLastItem:ve,onTransitionEnd:Be,unstable__animationState:qe,descendants:ae,popper:Ee,buttonId:St,menuId:ke,forceUpdate:Ee.forceUpdate,orientation:"vertical",isOpen:j,onToggle:ce,onOpen:K,onClose:Q,menuRef:G,buttonRef:se,focusedIndex:_e,closeOnSelect:r,closeOnBlur:o,autoSelect:u,setFocusedIndex:pe,isLazy:d,lazyBehavior:I,initialFocusRef:a,rafId:gt}}function ZFe(t={},e=null){const r=z1(),{onToggle:o,popper:a,openAndFocusFirstItem:u,openAndFocusLastItem:d}=r,f=X.useCallback(g=>{const E=g.key,C={Enter:u,ArrowDown:u,ArrowUp:d}[E];C&&(g.preventDefault(),g.stopPropagation(),C(g))},[u,d]);return{...t,ref:Qs(r.buttonRef,e,a.referenceRef),id:r.buttonId,"data-active":zr(r.isOpen),"aria-expanded":r.isOpen,"aria-haspopup":"menu","aria-controls":r.menuId,onClick:xr(t.onClick,o),onKeyDown:xr(t.onKeyDown,f)}}function _Q(t){var e;return nje(t)&&!!((e=t==null?void 0:t.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function eje(t={},e=null){const r=z1();if(!r)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:o,setFocusedIndex:a,menuRef:u,isOpen:d,onClose:f,menuId:g,isLazy:E,lazyBehavior:T,unstable__animationState:C}=r,I=qFe(),D=v2e({preventDefault:se=>se.key!==" "&&_Q(se.target)}),L=X.useCallback(se=>{if(!se.currentTarget.contains(se.target))return;const ae=se.key,F={Tab:te=>te.preventDefault(),Escape:f,ArrowDown:()=>{const te=I.nextEnabled(o);te&&a(te.index)},ArrowUp:()=>{const te=I.prevEnabled(o);te&&a(te.index)}}[ae];if(F){se.preventDefault(),F(se);return}const z=D(te=>{const j=_2e(I.values(),te,K=>{var Q,ce;return(ce=(Q=K==null?void 0:K.node)==null?void 0:Q.textContent)!=null?ce:""},I.item(o));if(j){const K=I.indexOf(j.node);a(K)}});_Q(se.target)&&z(se)},[I,o,D,f,a]),B=X.useRef(!1);d&&(B.current=!0);const G=F4({wasSelected:B.current,enabled:E,mode:T,isSelected:C.present});return{...t,ref:Qs(u,e),children:G?t.children:null,tabIndex:-1,role:"menu",id:g,style:{...t.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:xr(t.onKeyDown,L)}}function tje(t={}){const{popper:e,isOpen:r}=z1();return e.getPopperProps({...t,style:{visibility:r?"visible":"hidden",...t.style}})}function nje(t){var e;if(!rje(t))return!1;const r=(e=t.ownerDocument.defaultView)!=null?e:window;return t instanceof r.HTMLElement}function rje(t){return t!=null&&typeof t=="object"&&"nodeType"in t&&t.nodeType===Node.ELEMENT_NODE}var[ije,Wse]=Bs({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),zse=t=>{const{children:e}=t,r=cl("Menu",t),o=eo(t),{direction:a}=qT(),{descendants:u,...d}=QFe({...o,direction:a}),f=X.useMemo(()=>d,[d]),{isOpen:g,onClose:E,forceUpdate:T}=f;return $.jsx(KFe,{value:u,children:$.jsx(YFe,{value:f,children:$.jsx(ije,{value:r,children:bd(e,{isOpen:g,onClose:E,forceUpdate:T})})})})};zse.displayName="Menu";var sje={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},oje=Yt(im.div),Gse=gn(function(e,r){var o,a;const{rootProps:u,motionProps:d,...f}=e,{isOpen:g,onTransitionEnd:E,unstable__animationState:T}=z1(),C=eje(f,r),I=tje(u),D=Wse();return $.jsx(Yt.div,{...I,__css:{zIndex:(a=e.zIndex)!=null?a:(o=D.list)==null?void 0:o.zIndex},children:$.jsx(oje,{variants:sje,initial:!1,animate:g?"enter":"exit",__css:{outline:0,...D.list},...d,className:dr("chakra-menu__menu-list",C.className),...C,onUpdate:E,onAnimationComplete:Sne(T.onComplete,C.onAnimationComplete)})})});Gse.displayName="MenuList";var aje=gn((t,e)=>{const r=Wse();return $.jsx(Yt.button,{ref:e,...t,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...r.button}})}),Hse=gn((t,e)=>{const{children:r,as:o,...a}=t,u=ZFe(a,e),d=o||aje;return $.jsx(d,{...u,className:dr("chakra-menu__menu-button",t.className),children:$.jsx(Yt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:t.children})})});Hse.displayName="MenuButton";var cje={slideInBottom:{...tC,custom:{offsetY:16,reverse:!0}},slideInRight:{...tC,custom:{offsetX:16,reverse:!0}},slideInTop:{...tC,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...tC,custom:{offsetX:-16,reverse:!0}},scale:{...Pie,custom:{initialScale:.95,reverse:!0}},none:{}},uje=Yt(im.section),lje=t=>cje[t||"none"],Kse=X.forwardRef((t,e)=>{const{preset:r,motionProps:o=lje(r),...a}=t;return $.jsx(uje,{ref:e,...o,...a})});Kse.displayName="ModalTransition";var dje=Object.defineProperty,hje=(t,e,r)=>e in t?dje(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fje=(t,e,r)=>(hje(t,e+"",r),r),pje=class{constructor(){fje(this,"modals"),this.modals=new Map}add(t){return this.modals.set(t,this.modals.size+1),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){return t?this.modals.get(t)===this.modals.size:!1}},UF=new pje;function qse(t,e){const[r,o]=X.useState(0);return X.useEffect(()=>{const a=t.current;if(a){if(e){const u=UF.add(a);o(u)}return()=>{UF.remove(a),o(0)}}},[e,t]),r}var mje=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},NS=new WeakMap,gP=new WeakMap,vP={},n2=0,$se=function(t){return t&&(t.host||$se(t.parentNode))},gje=function(t,e){return e.map(function(r){if(t.contains(r))return r;var o=$se(r);return o&&t.contains(o)?o:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},vje=function(t,e,r,o){var a=gje(e,Array.isArray(t)?t:[t]);vP[r]||(vP[r]=new WeakMap);var u=vP[r],d=[],f=new Set,g=new Set(a),E=function(C){!C||f.has(C)||(f.add(C),E(C.parentNode))};a.forEach(E);var T=function(C){!C||g.has(C)||Array.prototype.forEach.call(C.children,function(I){if(f.has(I))T(I);else try{var D=I.getAttribute(o),L=D!==null&&D!=="false",B=(NS.get(I)||0)+1,G=(u.get(I)||0)+1;NS.set(I,B),u.set(I,G),d.push(I),B===1&&L&&gP.set(I,!0),G===1&&I.setAttribute(r,"true"),L||I.setAttribute(o,"true")}catch(se){console.error("aria-hidden: cannot operate on ",I,se)}})};return T(e),f.clear(),n2++,function(){d.forEach(function(C){var I=NS.get(C)-1,D=u.get(C)-1;NS.set(C,I),u.set(C,D),I||(gP.has(C)||C.removeAttribute(o),gP.delete(C)),D||C.removeAttribute(r)}),n2--,n2||(NS=new WeakMap,NS=new WeakMap,gP=new WeakMap,vP={})}},_je=function(t,e,r){r===void 0&&(r="data-aria-hidden");var o=Array.from(Array.isArray(t)?t:[t]),a=mje(t);return a?(o.push.apply(o,Array.from(a.querySelectorAll("[aria-live]"))),vje(o,a,r,"aria-hidden")):function(){return null}};function yje(t){const{isOpen:e,onClose:r,id:o,closeOnOverlayClick:a=!0,closeOnEsc:u=!0,useInert:d=!0,onOverlayClick:f,onEsc:g}=t,E=X.useRef(null),T=X.useRef(null),[C,I,D]=Sje(o,"chakra-modal","chakra-modal--header","chakra-modal--body");Eje(E,e&&d);const L=qse(E,e),B=X.useRef(null),G=X.useCallback(Q=>{B.current=Q.target},[]),se=X.useCallback(Q=>{Q.key==="Escape"&&(Q.stopPropagation(),u&&(r==null||r()),g==null||g())},[u,r,g]),[ae,M]=X.useState(!1),[F,z]=X.useState(!1),te=X.useCallback((Q={},ce=null)=>({role:"dialog",...Q,ref:Qs(ce,E),id:C,tabIndex:-1,"aria-modal":!0,"aria-labelledby":ae?I:void 0,"aria-describedby":F?D:void 0,onClick:xr(Q.onClick,Ee=>Ee.stopPropagation())}),[D,F,C,I,ae]),j=X.useCallback(Q=>{Q.stopPropagation(),B.current===Q.target&&UF.isTopModal(E.current)&&(a&&(r==null||r()),f==null||f())},[r,a,f]),K=X.useCallback((Q={},ce=null)=>({...Q,ref:Qs(ce,T),onClick:xr(Q.onClick,j),onKeyDown:xr(Q.onKeyDown,se),onMouseDown:xr(Q.onMouseDown,G)}),[se,G,j]);return{isOpen:e,onClose:r,headerId:I,bodyId:D,setBodyMounted:z,setHeaderMounted:M,dialogRef:E,overlayRef:T,getDialogProps:te,getDialogContainerProps:K,index:L}}function Eje(t,e){const r=t.current;X.useEffect(()=>{if(!(!t.current||!e))return _je(t.current)},[e,t,r])}function Sje(t,...e){const r=X.useId(),o=t||r;return X.useMemo(()=>e.map(a=>`${a}-${o}`),[o,e])}var[Tje,JT]=Bs({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[bje,hy]=Bs({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),sm=t=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,motionPreset:"scale",lockFocusAcrossFrames:!0,...t},{portalProps:r,children:o,autoFocus:a,trapFocus:u,initialFocusRef:d,finalFocusRef:f,returnFocusOnClose:g,blockScrollOnMount:E,allowPinchZoom:T,preserveScrollBarGap:C,motionPreset:I,lockFocusAcrossFrames:D,onCloseComplete:L}=e,B=cl("Modal",e),se={...yje(e),autoFocus:a,trapFocus:u,initialFocusRef:d,finalFocusRef:f,returnFocusOnClose:g,blockScrollOnMount:E,allowPinchZoom:T,preserveScrollBarGap:C,motionPreset:I,lockFocusAcrossFrames:D};return $.jsx(bje,{value:se,children:$.jsx(Tje,{value:B,children:$.jsx(YT,{onExitComplete:L,children:se.isOpen&&$.jsx(mh,{...r,children:o})})})})};sm.displayName="Modal";var eN="right-scroll-bar-position",tN="width-before-scroll-bar",wje="with-scroll-bars-hidden",Cje="--removed-body-scroll-bar-size",Yse=Hie(),r2=function(){},G1=X.forwardRef(function(t,e){var r=X.useRef(null),o=X.useState({onScrollCapture:r2,onWheelCapture:r2,onTouchMoveCapture:r2}),a=o[0],u=o[1],d=t.forwardProps,f=t.children,g=t.className,E=t.removeScrollBar,T=t.enabled,C=t.shards,I=t.sideCar,D=t.noIsolation,L=t.inert,B=t.allowPinchZoom,G=t.as,se=G===void 0?"div":G,ae=t.gapMode,M=xR(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),F=I,z=Wie([r,e]),te=cf(cf({},M),a);return X.createElement(X.Fragment,null,T&&X.createElement(F,{sideCar:Yse,removeScrollBar:E,shards:C,noIsolation:D,inert:L,setCallbacks:u,allowPinchZoom:!!B,lockRef:r,gapMode:ae}),d?X.cloneElement(X.Children.only(f),cf(cf({},te),{ref:z})):X.createElement(se,cf({},te,{className:g,ref:z}),f))});G1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};G1.classNames={fullWidth:tN,zeroRight:eN};var Rje=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Ije(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Rje();return e&&t.setAttribute("nonce",e),t}function Aje(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function kje(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Oje=function(){var t=0,e=null;return{add:function(r){t==0&&(e=Ije())&&(Aje(e,r),kje(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Pje=function(){var t=Oje();return function(e,r){X.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},Xse=function(){var t=Pje(),e=function(r){var o=r.styles,a=r.dynamic;return t(o,a),null};return e},Nje={left:0,top:0,right:0,gap:0},i2=function(t){return parseInt(t||"",10)||0},Dje=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],o=e[t==="padding"?"paddingTop":"marginTop"],a=e[t==="padding"?"paddingRight":"marginRight"];return[i2(r),i2(o),i2(a)]},Lje=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Nje;var e=Dje(t),r=document.documentElement.clientWidth,o=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,o-r+e[2]-e[0])}},xje=Xse(),pT="data-scroll-locked",Mje=function(t,e,r,o){var a=t.left,u=t.top,d=t.right,f=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(wje,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(f,"px ").concat(o,`;
  }
  body[`).concat(pT,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(o,";"),r==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(d,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(f,"px ").concat(o,`;
    `),r==="padding"&&"padding-right: ".concat(f,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(eN,` {
    right: `).concat(f,"px ").concat(o,`;
  }
  
  .`).concat(tN,` {
    margin-right: `).concat(f,"px ").concat(o,`;
  }
  
  .`).concat(eN," .").concat(eN,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat(tN," .").concat(tN,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(pT,`] {
    `).concat(Cje,": ").concat(f,`px;
  }
`)},yQ=function(){var t=parseInt(document.body.getAttribute(pT)||"0",10);return isFinite(t)?t:0},Uje=function(){X.useEffect(function(){return document.body.setAttribute(pT,(yQ()+1).toString()),function(){var t=yQ()-1;t<=0?document.body.removeAttribute(pT):document.body.setAttribute(pT,t.toString())}},[])},Vje=function(t){var e=t.noRelative,r=t.noImportant,o=t.gapMode,a=o===void 0?"margin":o;Uje();var u=X.useMemo(function(){return Lje(a)},[a]);return X.createElement(xje,{styles:Mje(u,!e,a,r?"":"!important")})},VF=!1;if(typeof window<"u")try{var _P=Object.defineProperty({},"passive",{get:function(){return VF=!0,!0}});window.addEventListener("test",_P,_P),window.removeEventListener("test",_P,_P)}catch{VF=!1}var DS=VF?{passive:!1}:!1,Fje=function(t){return t.tagName==="TEXTAREA"},Jse=function(t,e){var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!Fje(t)&&r[e]==="visible")},jje=function(t){return Jse(t,"overflowY")},Bje=function(t){return Jse(t,"overflowX")},EQ=function(t,e){var r=e.ownerDocument,o=e;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var a=Qse(t,o);if(a){var u=Zse(t,o),d=u[1],f=u[2];if(d>f)return!0}o=o.parentNode}while(o&&o!==r.body);return!1},Wje=function(t){var e=t.scrollTop,r=t.scrollHeight,o=t.clientHeight;return[e,r,o]},zje=function(t){var e=t.scrollLeft,r=t.scrollWidth,o=t.clientWidth;return[e,r,o]},Qse=function(t,e){return t==="v"?jje(e):Bje(e)},Zse=function(t,e){return t==="v"?Wje(e):zje(e)},Gje=function(t,e){return t==="h"&&e==="rtl"?-1:1},Hje=function(t,e,r,o,a){var u=Gje(t,window.getComputedStyle(e).direction),d=u*o,f=r.target,g=e.contains(f),E=!1,T=d>0,C=0,I=0;do{var D=Zse(t,f),L=D[0],B=D[1],G=D[2],se=B-G-u*L;(L||se)&&Qse(t,f)&&(C+=se,I+=L),f instanceof ShadowRoot?f=f.host:f=f.parentNode}while(!g&&f!==document.body||g&&(e.contains(f)||e===f));return(T&&Math.abs(C)<1||!T&&Math.abs(I)<1)&&(E=!0),E},yP=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},SQ=function(t){return[t.deltaX,t.deltaY]},TQ=function(t){return t&&"current"in t?t.current:t},Kje=function(t,e){return t[0]===e[0]&&t[1]===e[1]},qje=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},$je=0,LS=[];function Yje(t){var e=X.useRef([]),r=X.useRef([0,0]),o=X.useRef(),a=X.useState($je++)[0],u=X.useState(Xse)[0],d=X.useRef(t);X.useEffect(function(){d.current=t},[t]),X.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(a));var B=LUe([t.lockRef.current],(t.shards||[]).map(TQ),!0).filter(Boolean);return B.forEach(function(G){return G.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),B.forEach(function(G){return G.classList.remove("allow-interactivity-".concat(a))})}}},[t.inert,t.lockRef.current,t.shards]);var f=X.useCallback(function(B,G){if("touches"in B&&B.touches.length===2)return!d.current.allowPinchZoom;var se=yP(B),ae=r.current,M="deltaX"in B?B.deltaX:ae[0]-se[0],F="deltaY"in B?B.deltaY:ae[1]-se[1],z,te=B.target,j=Math.abs(M)>Math.abs(F)?"h":"v";if("touches"in B&&j==="h"&&te.type==="range")return!1;var K=EQ(j,te);if(!K)return!0;if(K?z=j:(z=j==="v"?"h":"v",K=EQ(j,te)),!K)return!1;if(!o.current&&"changedTouches"in B&&(M||F)&&(o.current=z),!z)return!0;var Q=o.current||z;return Hje(Q,G,B,Q==="h"?M:F)},[]),g=X.useCallback(function(B){var G=B;if(!(!LS.length||LS[LS.length-1]!==u)){var se="deltaY"in G?SQ(G):yP(G),ae=e.current.filter(function(z){return z.name===G.type&&(z.target===G.target||G.target===z.shadowParent)&&Kje(z.delta,se)})[0];if(ae&&ae.should){G.cancelable&&G.preventDefault();return}if(!ae){var M=(d.current.shards||[]).map(TQ).filter(Boolean).filter(function(z){return z.contains(G.target)}),F=M.length>0?f(G,M[0]):!d.current.noIsolation;F&&G.cancelable&&G.preventDefault()}}},[]),E=X.useCallback(function(B,G,se,ae){var M={name:B,delta:G,target:se,should:ae,shadowParent:Xje(se)};e.current.push(M),setTimeout(function(){e.current=e.current.filter(function(F){return F!==M})},1)},[]),T=X.useCallback(function(B){r.current=yP(B),o.current=void 0},[]),C=X.useCallback(function(B){E(B.type,SQ(B),B.target,f(B,t.lockRef.current))},[]),I=X.useCallback(function(B){E(B.type,yP(B),B.target,f(B,t.lockRef.current))},[]);X.useEffect(function(){return LS.push(u),t.setCallbacks({onScrollCapture:C,onWheelCapture:C,onTouchMoveCapture:I}),document.addEventListener("wheel",g,DS),document.addEventListener("touchmove",g,DS),document.addEventListener("touchstart",T,DS),function(){LS=LS.filter(function(B){return B!==u}),document.removeEventListener("wheel",g,DS),document.removeEventListener("touchmove",g,DS),document.removeEventListener("touchstart",T,DS)}},[]);var D=t.removeScrollBar,L=t.inert;return X.createElement(X.Fragment,null,L?X.createElement(u,{styles:qje(a)}):null,D?X.createElement(Vje,{gapMode:t.gapMode}):null)}function Xje(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Jje=xUe(Yse,Yje);var eoe=X.forwardRef(function(t,e){return X.createElement(G1,cf({},t,{ref:e,sideCar:Jje}))});eoe.classNames=G1.classNames;function Qje(t){const{autoFocus:e,trapFocus:r,dialogRef:o,initialFocusRef:a,blockScrollOnMount:u,allowPinchZoom:d,finalFocusRef:f,returnFocusOnClose:g,preserveScrollBarGap:E,lockFocusAcrossFrames:T,isOpen:C}=hy(),[I,D]=cie();X.useEffect(()=>{!I&&D&&setTimeout(D)},[I,D]);const L=qse(o,C);return $.jsx(Sse,{autoFocus:e,isDisabled:!r,initialFocusRef:a,finalFocusRef:f,restoreFocus:g,contentRef:o,lockFocusAcrossFrames:T,children:$.jsx(eoe,{removeScrollBar:!E,allowPinchZoom:d,enabled:L===1&&u,forwardProps:!0,children:t.children})})}var om=gn((t,e)=>{const{className:r,children:o,containerProps:a,motionProps:u,...d}=t,{getDialogProps:f,getDialogContainerProps:g}=hy(),E=f(d,e),T=g(a),C=dr("chakra-modal__content",r),I=JT(),D={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...I.dialog},L={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...I.dialogContainer},{motionPreset:B}=hy();return $.jsx(Qje,{children:$.jsx(Yt.div,{...T,className:"chakra-modal__content-container",tabIndex:-1,__css:L,children:$.jsx(Kse,{preset:B,motionProps:u,className:C,...E,__css:D,children:o})})})});om.displayName="ModalContent";var H1=gn((t,e)=>{const{className:r,...o}=t,a=dr("chakra-modal__footer",r),d={display:"flex",alignItems:"center",justifyContent:"flex-end",...JT().footer};return $.jsx(Yt.footer,{ref:e,...o,__css:d,className:a})});H1.displayName="ModalFooter";var Jg=gn((t,e)=>{const{className:r,...o}=t,{headerId:a,setHeaderMounted:u}=hy();X.useEffect(()=>(u(!0),()=>u(!1)),[u]);const d=dr("chakra-modal__header",r),g={flex:0,...JT().header};return $.jsx(Yt.header,{ref:e,className:d,id:a,...o,__css:g})});Jg.displayName="ModalHeader";var Zje=Yt(im.div),am=gn((t,e)=>{const{className:r,transition:o,motionProps:a,...u}=t,d=dr("chakra-modal__overlay",r),g={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...JT().overlay},{motionPreset:E}=hy(),C=a||(E==="none"?{}:Oie);return $.jsx(Zje,{...C,__css:g,ref:e,className:d,...u})});am.displayName="ModalOverlay";var cm=gn((t,e)=>{const{className:r,...o}=t,{bodyId:a,setBodyMounted:u}=hy();X.useEffect(()=>(u(!0),()=>u(!1)),[u]);const d=dr("chakra-modal__body",r),f=JT();return $.jsx(Yt.div,{ref:e,className:d,id:a,...o,__css:f.body})});cm.displayName="ModalBody";var um=gn((t,e)=>{const{onClick:r,className:o,...a}=t,{onClose:u}=hy(),d=dr("chakra-modal__close-btn",o),f=JT();return $.jsx(ZC,{ref:e,__css:f.closeButton,className:d,onClick:xr(r,g=>{g.stopPropagation(),u()}),...a})});um.displayName="ModalCloseButton";var[eBe,K1]=Bs({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[tBe,toe]=Bs({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `});function noe(t){const e=X.Children.only(t.children),{getTriggerProps:r}=K1();return X.cloneElement(e,r(e.props,e.ref))}noe.displayName="PopoverTrigger";var xS={click:"click",hover:"hover"};function nBe(t={}){const{closeOnBlur:e=!0,closeOnEsc:r=!0,initialFocusRef:o,id:a,returnFocusOnClose:u=!0,autoFocus:d=!0,arrowSize:f,arrowShadowColor:g,trigger:E=xS.click,openDelay:T=200,closeDelay:C=200,isLazy:I,lazyBehavior:D="unmount",computePositionOnMount:L,...B}=t,{isOpen:G,onClose:se,onOpen:ae,onToggle:M}=V4(t),F=X.useRef(null),z=X.useRef(null),te=X.useRef(null),j=X.useRef(!1),K=X.useRef(!1);G&&(K.current=!0);const[Q,ce]=X.useState(!1),[Ee,_e]=X.useState(!1),pe=X.useId(),qe=a??pe,[St,ke,Ne,Re]=["popover-trigger","popover-content","popover-header","popover-body"].map(Pt=>`${Pt}-${qe}`),{referenceRef:Ve,getArrowProps:ve,getPopperProps:Be,getArrowInnerProps:gt,forceUpdate:ze}=U4({...B,enabled:G||!!L}),_t=Bse({isOpen:G,ref:te});bUe({enabled:G,ref:z}),Ose(te,{focusRef:z,visible:G,shouldFocus:u&&E===xS.click}),b2e(te,{focusRef:o,visible:G,shouldFocus:d&&E===xS.click});const Dt=F4({wasSelected:K.current,enabled:I,mode:D,isSelected:_t.present}),jt=X.useCallback((Pt={},wn=null)=>{const Dn={...Pt,style:{...Pt.style,transformOrigin:Xo.transformOrigin.varRef,[Xo.arrowSize.var]:f?`${f}px`:void 0,[Xo.arrowShadowColor.var]:g},ref:Qs(te,wn),children:Dt?Pt.children:null,id:ke,tabIndex:-1,role:"dialog",onKeyDown:xr(Pt.onKeyDown,Ae=>{r&&Ae.key==="Escape"&&se()}),onBlur:xr(Pt.onBlur,Ae=>{const $e=bQ(Ae),rt=s2(te.current,$e),at=s2(z.current,$e);G&&e&&(!rt&&!at)&&se()}),"aria-labelledby":Q?Ne:void 0,"aria-describedby":Ee?Re:void 0};return E===xS.hover&&(Dn.role="tooltip",Dn.onMouseEnter=xr(Pt.onMouseEnter,()=>{j.current=!0}),Dn.onMouseLeave=xr(Pt.onMouseLeave,Ae=>{Ae.nativeEvent.relatedTarget!==null&&(j.current=!1,setTimeout(()=>se(),C))})),Dn},[Dt,ke,Q,Ne,Ee,Re,E,r,se,G,e,C,g,f]),Zt=X.useCallback((Pt={},wn=null)=>Be({...Pt,style:{visibility:G?"visible":"hidden",...Pt.style}},wn),[G,Be]),Xt=X.useCallback((Pt,wn=null)=>({...Pt,ref:Qs(wn,F,Ve)}),[F,Ve]),In=X.useRef(),Qt=X.useRef(),Er=X.useCallback(Pt=>{F.current==null&&Ve(Pt)},[Ve]),Tn=X.useCallback((Pt={},wn=null)=>{const Dn={...Pt,ref:Qs(z,wn,Er),id:St,"aria-haspopup":"dialog","aria-expanded":G,"aria-controls":ke};return E===xS.click&&(Dn.onClick=xr(Pt.onClick,M)),E===xS.hover&&(Dn.onFocus=xr(Pt.onFocus,()=>{In.current===void 0&&ae()}),Dn.onBlur=xr(Pt.onBlur,Ae=>{const $e=bQ(Ae),rt=!s2(te.current,$e);G&&e&&rt&&se()}),Dn.onKeyDown=xr(Pt.onKeyDown,Ae=>{Ae.key==="Escape"&&se()}),Dn.onMouseEnter=xr(Pt.onMouseEnter,()=>{j.current=!0,In.current=window.setTimeout(()=>ae(),T)}),Dn.onMouseLeave=xr(Pt.onMouseLeave,()=>{j.current=!1,In.current&&(clearTimeout(In.current),In.current=void 0),Qt.current=window.setTimeout(()=>{j.current===!1&&se()},C)})),Dn},[St,G,ke,E,Er,M,ae,e,se,T,C]);X.useEffect(()=>()=>{In.current&&clearTimeout(In.current),Qt.current&&clearTimeout(Qt.current)},[]);const Vn=X.useCallback((Pt={},wn=null)=>({...Pt,id:Ne,ref:Qs(wn,Dn=>{ce(!!Dn)})}),[Ne]),wr=X.useCallback((Pt={},wn=null)=>({...Pt,id:Re,ref:Qs(wn,Dn=>{_e(!!Dn)})}),[Re]);return{forceUpdate:ze,isOpen:G,onAnimationComplete:_t.onComplete,onClose:se,getAnchorProps:Xt,getArrowProps:ve,getArrowInnerProps:gt,getPopoverPositionerProps:Zt,getPopoverProps:jt,getTriggerProps:Tn,getHeaderProps:Vn,getBodyProps:wr}}function s2(t,e){return t===e||(t==null?void 0:t.contains(e))}function bQ(t){var e;const r=t.currentTarget.ownerDocument.activeElement;return(e=t.relatedTarget)!=null?e:r}function roe(t){const e=cl("Popover",t),{children:r,...o}=eo(t),a=qT(),u=nBe({...o,direction:a.direction});return $.jsx(eBe,{value:u,children:$.jsx(tBe,{value:e,children:bd(r,{isOpen:u.isOpen,onClose:u.onClose,forceUpdate:u.forceUpdate})})})}roe.displayName="Popover";var ioe=gn(function(e,r){const{getBodyProps:o}=K1(),a=toe();return $.jsx(Yt.div,{...o(e,r),className:dr("chakra-popover__body",e.className),__css:a.body})});ioe.displayName="PopoverBody";function rBe(t){if(t)return{enter:{...t.enter,visibility:"visible"},exit:{...t.exit,transitionEnd:{visibility:"hidden"}}}}var iBe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},sBe=Yt(im.section),soe=gn(function(e,r){const{variants:o=iBe,...a}=e,{isOpen:u}=K1();return $.jsx(sBe,{ref:r,variants:rBe(o),initial:!1,animate:u?"enter":"exit",...a})});soe.displayName="PopoverTransition";var ooe=gn(function(e,r){const{rootProps:o,motionProps:a,...u}=e,{getPopoverProps:d,getPopoverPositionerProps:f,onAnimationComplete:g}=K1(),E=toe(),T={position:"relative",display:"flex",flexDirection:"column",...E.content};return $.jsx(Yt.div,{...f(o),__css:E.popper,className:"chakra-popover__popper",children:$.jsx(soe,{...a,...d(u,r),onAnimationComplete:Sne(g,u.onAnimationComplete),className:dr("chakra-popover__content",e.className),__css:T})})});ooe.displayName="PopoverContent";function oBe(t,e,r){return(t-e)*100/(r-e)}bR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});bR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});var aBe=bR({"0%":{left:"-40%"},"100%":{left:"100%"}}),cBe=bR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function uBe(t){const{value:e=0,min:r,max:o,valueText:a,getValueText:u,isIndeterminate:d,role:f="progressbar"}=t,g=oBe(e,r,o);return{bind:{"data-indeterminate":d?"":void 0,"aria-valuemax":o,"aria-valuemin":r,"aria-valuenow":d?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof u=="function"?u(e,g):a})(),role:f},percent:g,value:e}}var[lBe,dBe]=Bs({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),hBe=gn((t,e)=>{const{min:r,max:o,value:a,isIndeterminate:u,role:d,...f}=t,g=uBe({value:a,min:r,max:o,isIndeterminate:u,role:d}),T={height:"100%",...dBe().filledTrack};return $.jsx(Yt.div,{ref:e,style:{width:`${g.percent}%`,...f.style},...g.bind,...f,__css:T})}),j4=gn((t,e)=>{var r;const{value:o,min:a=0,max:u=100,hasStripe:d,isAnimated:f,children:g,borderRadius:E,isIndeterminate:T,"aria-label":C,"aria-labelledby":I,"aria-valuetext":D,title:L,role:B,...G}=eo(t),se=cl("Progress",t),ae=E??((r=se.track)==null?void 0:r.borderRadius),M={animation:`${cBe} 1s linear infinite`},te={...!T&&d&&f&&M,...T&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${aBe} 1s ease infinite normal none running`}},j={overflow:"hidden",position:"relative",...se.track};return $.jsx(Yt.div,{ref:e,borderRadius:ae,__css:j,...G,children:$.jsxs(lBe,{value:se,children:[$.jsx(hBe,{"aria-label":C,"aria-labelledby":I,"aria-valuetext":D,min:a,max:u,value:o,isIndeterminate:T,css:te,borderRadius:ae,title:L,role:B}),g]})})});j4.displayName="Progress";var aoe=gn(function(e,r){const{children:o,placeholder:a,className:u,...d}=e;return $.jsxs(Yt.select,{...d,ref:r,className:dr("chakra-select",u),children:[a&&$.jsx("option",{value:"",children:a}),o]})});aoe.displayName="SelectField";function fBe(t,e){const r={},o={};for(const[a,u]of Object.entries(t))e.includes(a)?r[a]=u:o[a]=u;return[r,o]}var coe=gn((t,e)=>{var r;const o=cl("Select",t),{rootProps:a,placeholder:u,icon:d,color:f,height:g,h:E,minH:T,minHeight:C,iconColor:I,iconSize:D,...L}=eo(t),[B,G]=fBe(L,vCe),se=Vie(G),ae={width:"100%",height:"fit-content",position:"relative",color:f},M={paddingEnd:"2rem",...o.field,_focus:{zIndex:"unset",...(r=o.field)==null?void 0:r._focus}};return $.jsxs(Yt.div,{className:"chakra-select__wrapper",__css:ae,...B,...a,children:[$.jsx(aoe,{ref:e,height:E??g,minH:T??C,placeholder:u,...se,__css:M,children:t.children}),$.jsx(uoe,{"data-disabled":zr(se.disabled),...(I||f)&&{color:I||f},__css:o.icon,...D&&{fontSize:D},children:d})]})});coe.displayName="Select";var pBe=t=>$.jsx("svg",{viewBox:"0 0 24 24",...t,children:$.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),mBe=Yt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),uoe=t=>{const{children:e=$.jsx(pBe,{}),...r}=t,o=X.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return $.jsx(mBe,{...r,className:"chakra-select__icon-wrapper",children:X.isValidElement(e)?o:null})};uoe.displayName="SelectIcon";var MS=t=>t?"":void 0,o2=t=>t?!0:void 0,VR=(...t)=>t.filter(Boolean).join(" ");function a2(...t){return function(r){t.some(o=>(o==null||o(r),r==null?void 0:r.defaultPrevented))}}function EP(t){const{orientation:e,vertical:r,horizontal:o}=t;return e==="vertical"?r:o}var nN={width:0,height:0},SP=t=>t||nN;function gBe(t){const{orientation:e,thumbPercents:r,thumbRects:o,isReversed:a}=t,u=B=>{var G;const se=(G=o[B])!=null?G:nN;return{position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...EP({orientation:e,vertical:{bottom:`calc(${r[B]}% - ${se.height/2}px)`},horizontal:{left:`calc(${r[B]}% - ${se.width/2}px)`}})}},d=e==="vertical"?o.reduce((B,G)=>SP(B).height>SP(G).height?B:G,nN):o.reduce((B,G)=>SP(B).width>SP(G).width?B:G,nN),f={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0,...EP({orientation:e,vertical:d?{paddingLeft:d.width/2,paddingRight:d.width/2}:{},horizontal:d?{paddingTop:d.height/2,paddingBottom:d.height/2}:{}})},g={position:"absolute",...EP({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},E=r.length===1,T=[0,a?100-r[0]:r[0]],C=E?T:r;let I=C[0];!E&&a&&(I=100-I);const D=Math.abs(C[C.length-1]-C[0]),L={...g,...EP({orientation:e,vertical:a?{height:`${D}%`,top:`${I}%`}:{height:`${D}%`,bottom:`${I}%`},horizontal:a?{width:`${D}%`,right:`${I}%`}:{width:`${D}%`,left:`${I}%`}})};return{trackStyle:g,innerTrackStyle:L,rootStyle:f,getThumbStyle:u}}function vBe(t){const{isReversed:e,direction:r,orientation:o}=t;return r==="ltr"||o==="vertical"?e:!e}function _Be(t,e,r,o){return t.addEventListener(e,r,o),()=>{t.removeEventListener(e,r,o)}}function yBe(t){const e=SBe(t);return typeof e.PointerEvent<"u"&&t instanceof e.PointerEvent?t.pointerType==="mouse":t instanceof e.MouseEvent}function loe(t){return!!t.touches}function EBe(t){return loe(t)&&t.touches.length>1}function SBe(t){var e;return(e=t.view)!=null?e:window}function TBe(t,e="page"){const r=t.touches[0]||t.changedTouches[0];return{x:r[`${e}X`],y:r[`${e}Y`]}}function bBe(t,e="page"){return{x:t[`${e}X`],y:t[`${e}Y`]}}function doe(t,e="page"){return loe(t)?TBe(t,e):bBe(t,e)}function wBe(t){return e=>{const r=yBe(e);(!r||r&&e.button===0)&&t(e)}}function CBe(t,e=!1){function r(a){t(a,{point:doe(a)})}return e?wBe(r):r}function rN(t,e,r,o){return _Be(t,e,CBe(r,e==="pointerdown"),o)}var RBe=Object.defineProperty,IBe=(t,e,r)=>e in t?RBe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ch=(t,e,r)=>(IBe(t,typeof e!="symbol"?e+"":e,r),r),ABe=class{constructor(t,e,r){ch(this,"history",[]),ch(this,"startEvent",null),ch(this,"lastEvent",null),ch(this,"lastEventInfo",null),ch(this,"handlers",{}),ch(this,"removeListeners",()=>{}),ch(this,"threshold",3),ch(this,"win"),ch(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const f=c2(this.lastEventInfo,this.history),g=this.startEvent!==null,E=NBe(f.offset,{x:0,y:0})>=this.threshold;if(!g&&!E)return;const{timestamp:T}=SJ();this.history.push({...f.point,timestamp:T});const{onStart:C,onMove:I}=this.handlers;g||(C==null||C(this.lastEvent,f),this.startEvent=this.lastEvent),I==null||I(this.lastEvent,f)}),ch(this,"onPointerMove",(f,g)=>{this.lastEvent=f,this.lastEventInfo=g,uNe.update(this.updatePoint,!0)}),ch(this,"onPointerUp",(f,g)=>{const E=c2(g,this.history),{onEnd:T,onSessionEnd:C}=this.handlers;C==null||C(f,E),this.end(),!(!T||!this.startEvent)&&(T==null||T(f,E))});var o;if(this.win=(o=t.view)!=null?o:window,EBe(t))return;this.handlers=e,r&&(this.threshold=r),t.stopPropagation(),t.preventDefault();const a={point:doe(t)},{timestamp:u}=SJ();this.history=[{...a.point,timestamp:u}];const{onSessionStart:d}=e;d==null||d(t,c2(a,this.history)),this.removeListeners=PBe(rN(this.win,"pointermove",this.onPointerMove),rN(this.win,"pointerup",this.onPointerUp),rN(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),lNe.update(this.updatePoint)}};function wQ(t,e){return{x:t.x-e.x,y:t.y-e.y}}function c2(t,e){return{point:t.point,delta:wQ(t.point,e[e.length-1]),offset:wQ(t.point,e[0]),velocity:OBe(e,.1)}}var kBe=t=>t*1e3;function OBe(t,e){if(t.length<2)return{x:0,y:0};let r=t.length-1,o=null;const a=t[t.length-1];for(;r>=0&&(o=t[r],!(a.timestamp-o.timestamp>kBe(e)));)r--;if(!o)return{x:0,y:0};const u=(a.timestamp-o.timestamp)/1e3;if(u===0)return{x:0,y:0};const d={x:(a.x-o.x)/u,y:(a.y-o.y)/u};return d.x===1/0&&(d.x=0),d.y===1/0&&(d.y=0),d}function PBe(...t){return e=>t.reduce((r,o)=>o(r),e)}function u2(t,e){return Math.abs(t-e)}function CQ(t){return"x"in t&&"y"in t}function NBe(t,e){if(typeof t=="number"&&typeof e=="number")return u2(t,e);if(CQ(t)&&CQ(e)){const r=u2(t.x,e.x),o=u2(t.y,e.y);return Math.sqrt(r**2+o**2)}return 0}function hoe(t){const e=X.useRef(null);return e.current=t,e}function DBe(t,e){const{onPan:r,onPanStart:o,onPanEnd:a,onPanSessionStart:u,onPanSessionEnd:d,threshold:f}=e,g=!!(r||o||a||u||d),E=X.useRef(null),T=hoe({onSessionStart:u,onSessionEnd:d,onStart:o,onMove:r,onEnd(C,I){E.current=null,a==null||a(C,I)}});X.useEffect(()=>{var C;(C=E.current)==null||C.updateHandlers(T.current)}),X.useEffect(()=>{const C=t.current;if(!C||!g)return;function I(D){E.current=new ABe(D,T.current,f)}return rN(C,"pointerdown",I)},[t,g,T,f]),X.useEffect(()=>()=>{var C;(C=E.current)==null||C.end(),E.current=null},[])}function LBe(t,e){if(!t){e(void 0);return}e({width:t.offsetWidth,height:t.offsetHeight});const r=t.ownerDocument.defaultView??window,o=new r.ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const[u]=a;let d,f;if("borderBoxSize"in u){const g=u.borderBoxSize,E=Array.isArray(g)?g[0]:g;d=E.inlineSize,f=E.blockSize}else d=t.offsetWidth,f=t.offsetHeight;e({width:d,height:f})});return o.observe(t,{box:"border-box"}),()=>o.unobserve(t)}var xBe=globalThis!=null&&globalThis.document?X.useLayoutEffect:X.useEffect;function MBe(t,e){var r,o;if(!t||!t.parentElement)return;const a=(o=(r=t.ownerDocument)==null?void 0:r.defaultView)!=null?o:window,u=new a.MutationObserver(()=>{e()});return u.observe(t.parentElement,{childList:!0}),()=>{u.disconnect()}}function UBe({getNodes:t,observeMutation:e=!0}){const[r,o]=X.useState([]),[a,u]=X.useState(0);return xBe(()=>{const d=t(),f=d.map((g,E)=>LBe(g,T=>{o(C=>[...C.slice(0,E),T,...C.slice(E+1)])}));if(e){const g=d[0];f.push(MBe(g,()=>{u(E=>E+1)}))}return()=>{f.forEach(g=>{g==null||g()})}},[a]),r}function VBe(t){return typeof t=="object"&&t!==null&&"current"in t}function FBe(t){const[e]=UBe({observeMutation:!1,getNodes(){return[VBe(t)?t.current:t]}});return e}function jBe(t){var e;const{min:r=0,max:o=100,onChange:a,value:u,defaultValue:d,isReversed:f,direction:g="ltr",orientation:E="horizontal",id:T,isDisabled:C,isReadOnly:I,onChangeStart:D,onChangeEnd:L,step:B=1,getAriaValueText:G,"aria-valuetext":se,"aria-label":ae,"aria-labelledby":M,name:F,focusThumbOnChange:z=!0,...te}=t,j=tl(D),K=tl(L),Q=tl(G),ce=vBe({isReversed:f,direction:g,orientation:E}),[Ee,_e]=kie({value:u,defaultValue:d??WBe(r,o),onChange:a}),[pe,qe]=X.useState(!1),[St,ke]=X.useState(!1),Ne=!(C||I),Re=(o-r)/10,Ve=B||(o-r)/100,ve=HV(Ee,r,o),Be=o-ve+r,ze=K8(ce?Be:ve,r,o),_t=E==="vertical",Dt=hoe({min:r,max:o,step:B,isDisabled:C,value:ve,isInteractive:Ne,isReversed:ce,isVertical:_t,eventSource:null,focusThumbOnChange:z,orientation:E}),jt=X.useRef(null),Zt=X.useRef(null),Xt=X.useRef(null),In=X.useId(),Qt=T??In,[Er,Tn]=[`slider-thumb-${Qt}`,`slider-track-${Qt}`],Vn=X.useCallback($t=>{var Cn,yo;if(!jt.current)return;const Cr=Dt.current;Cr.eventSource="pointer";const Bi=jt.current.getBoundingClientRect(),{clientX:za,clientY:ba}=(yo=(Cn=$t.touches)==null?void 0:Cn[0])!=null?yo:$t,ys=_t?Bi.bottom-ba:za-Bi.left,Ga=_t?Bi.height:Bi.width;let Wi=ys/Ga;ce&&(Wi=1-Wi);let Ws=gUe(Wi,Cr.min,Cr.max);return Cr.step&&(Ws=parseFloat(q8(Ws,Cr.min,Cr.step))),Ws=HV(Ws,Cr.min,Cr.max),Ws},[_t,ce,Dt]),wr=X.useCallback($t=>{const Cn=Dt.current;Cn.isInteractive&&($t=parseFloat(q8($t,Cn.min,Ve)),$t=HV($t,Cn.min,Cn.max),_e($t))},[Ve,_e,Dt]),Pt=X.useMemo(()=>({stepUp($t=Ve){const Cn=ce?ve-$t:ve+$t;wr(Cn)},stepDown($t=Ve){const Cn=ce?ve+$t:ve-$t;wr(Cn)},reset(){wr(d||0)},stepTo($t){wr($t)}}),[wr,ce,ve,Ve,d]),wn=X.useCallback($t=>{const Cn=Dt.current,Cr={ArrowRight:()=>Pt.stepUp(),ArrowUp:()=>Pt.stepUp(),ArrowLeft:()=>Pt.stepDown(),ArrowDown:()=>Pt.stepDown(),PageUp:()=>Pt.stepUp(Re),PageDown:()=>Pt.stepDown(Re),Home:()=>wr(Cn.min),End:()=>wr(Cn.max)}[$t.key];Cr&&($t.preventDefault(),$t.stopPropagation(),Cr($t),Cn.eventSource="keyboard")},[Pt,wr,Re,Dt]),Dn=(e=Q==null?void 0:Q(ve))!=null?e:se,Ae=FBe(Zt),{getThumbStyle:$e,rootStyle:rt,trackStyle:at,innerTrackStyle:ct}=X.useMemo(()=>{const $t=Dt.current,Cn=Ae??{width:0,height:0};return gBe({isReversed:ce,orientation:$t.orientation,thumbRects:[Cn],thumbPercents:[ze]})},[ce,Ae,ze,Dt]),Ke=X.useCallback(()=>{Dt.current.focusThumbOnChange&&setTimeout(()=>{var Cn;return(Cn=Zt.current)==null?void 0:Cn.focus()})},[Dt]);ay(()=>{const $t=Dt.current;Ke(),$t.eventSource==="keyboard"&&(K==null||K($t.value))},[ve,K]);function nt($t){const Cn=Vn($t);Cn!=null&&Cn!==Dt.current.value&&_e(Cn)}DBe(Xt,{onPanSessionStart($t){const Cn=Dt.current;Cn.isInteractive&&(qe(!0),Ke(),nt($t),j==null||j(Cn.value))},onPanSessionEnd(){const $t=Dt.current;$t.isInteractive&&(qe(!1),K==null||K($t.value))},onPan($t){Dt.current.isInteractive&&nt($t)}});const At=X.useCallback(($t={},Cn=null)=>({...$t,...te,ref:Qs(Cn,Xt),tabIndex:-1,"aria-disabled":o2(C),"data-focused":MS(St),style:{...$t.style,...rt}}),[te,C,St,rt]),It=X.useCallback(($t={},Cn=null)=>({...$t,ref:Qs(Cn,jt),id:Tn,"data-disabled":MS(C),style:{...$t.style,...at}}),[C,Tn,at]),Kt=X.useCallback(($t={},Cn=null)=>({...$t,ref:Cn,style:{...$t.style,...ct}}),[ct]),Un=X.useCallback(($t={},Cn=null)=>({...$t,ref:Qs(Cn,Zt),role:"slider",tabIndex:Ne?0:void 0,id:Er,"data-active":MS(pe),"aria-valuetext":Dn,"aria-valuemin":r,"aria-valuemax":o,"aria-valuenow":ve,"aria-orientation":E,"aria-disabled":o2(C),"aria-readonly":o2(I),"aria-label":ae,"aria-labelledby":ae?void 0:M,style:{...$t.style,...$e(0)},onKeyDown:a2($t.onKeyDown,wn),onFocus:a2($t.onFocus,()=>ke(!0)),onBlur:a2($t.onBlur,()=>ke(!1))}),[Ne,Er,pe,Dn,r,o,ve,E,C,I,ae,M,$e,wn]),Fn=X.useCallback(($t,Cn=null)=>{const yo=!($t.value<r||$t.value>o),Cr=ve>=$t.value,Bi=K8($t.value,r,o),za={position:"absolute",pointerEvents:"none",...BBe({orientation:E,vertical:{bottom:ce?`${100-Bi}%`:`${Bi}%`},horizontal:{left:ce?`${100-Bi}%`:`${Bi}%`}})};return{...$t,ref:Cn,role:"presentation","aria-hidden":!0,"data-disabled":MS(C),"data-invalid":MS(!yo),"data-highlighted":MS(Cr),style:{...$t.style,...za}}},[C,ce,o,r,E,ve]),Yr=X.useCallback(($t={},Cn=null)=>({...$t,ref:Cn,type:"hidden",value:ve,name:F}),[F,ve]);return{state:{value:ve,isFocused:St,isDragging:pe},actions:Pt,getRootProps:At,getTrackProps:It,getInnerTrackProps:Kt,getThumbProps:Un,getMarkerProps:Fn,getInputProps:Yr}}function BBe(t){const{orientation:e,vertical:r,horizontal:o}=t;return e==="vertical"?r:o}function WBe(t,e){return e<t?t:t+(e-t)/2}var[zBe,q1]=Bs({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[GBe,$1]=Bs({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),FF=gn((t,e)=>{var r;const o={...t,orientation:(r=t==null?void 0:t.orientation)!=null?r:"horizontal"},a=cl("Slider",o),u=eo(o),{direction:d}=qT();u.direction=d;const{getInputProps:f,getRootProps:g,...E}=jBe(u),T=g(),C=f({},e);return $.jsx(zBe,{value:E,children:$.jsx(GBe,{value:a,children:$.jsxs(Yt.div,{...T,className:VR("chakra-slider",o.className),__css:a.container,children:[o.children,$.jsx("input",{...C})]})})})});FF.displayName="Slider";var jF=gn((t,e)=>{const{getThumbProps:r}=q1(),o=$1(),a=r(t,e);return $.jsx(Yt.div,{...a,className:VR("chakra-slider__thumb",t.className),__css:o.thumb})});jF.displayName="SliderThumb";var BF=gn((t,e)=>{const{getTrackProps:r}=q1(),o=$1(),a=r(t,e);return $.jsx(Yt.div,{...a,className:VR("chakra-slider__track",t.className),__css:o.track})});BF.displayName="SliderTrack";var WF=gn((t,e)=>{const{getInnerTrackProps:r}=q1(),o=$1(),a=r(t,e);return $.jsx(Yt.div,{...a,className:VR("chakra-slider__filled-track",t.className),__css:o.filledTrack})});WF.displayName="SliderFilledTrack";var HBe=gn((t,e)=>{const{getMarkerProps:r}=q1(),o=$1(),a=r(t,e);return $.jsx(Yt.div,{...a,className:VR("chakra-slider__marker",t.className),__css:o.mark})});HBe.displayName="SliderMark";var iN=gn(function(e,r){const o=cl("Switch",e),{spacing:a="0.5rem",children:u,...d}=eo(e),{getIndicatorProps:f,getInputProps:g,getCheckboxProps:E,getRootProps:T,getLabelProps:C}=dUe(d),I=X.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...o.container}),[o.container]),D=X.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...o.track}),[o.track]),L=X.useMemo(()=>({userSelect:"none",marginStart:a,...o.label}),[a,o.label]);return $.jsxs(Yt.label,{...T(),className:dr("chakra-switch",e.className),__css:I,children:[$.jsx("input",{className:"chakra-switch__input",...g({},r)}),$.jsx(Yt.span,{...E(),className:"chakra-switch__track",__css:D,children:$.jsx(Yt.span,{__css:o.thumb,className:"chakra-switch__thumb",...f()})}),u&&$.jsx(Yt.span,{className:"chakra-switch__label",...C(),__css:L,children:u})]})});iN.displayName="Switch";var[KBe,qBe,$Be,YBe]=Aie();function XBe(t){var e;const{defaultIndex:r,onChange:o,index:a,isManual:u,isLazy:d,lazyBehavior:f="unmount",orientation:g="horizontal",direction:E="ltr",...T}=t,[C,I]=X.useState(r??0),[D,L]=kie({defaultValue:r??0,value:a,onChange:o});X.useEffect(()=>{a!=null&&I(a)},[a]);const B=$Be(),G=X.useId();return{id:`tabs-${(e=t.id)!=null?e:G}`,selectedIndex:D,focusedIndex:C,setSelectedIndex:L,setFocusedIndex:I,isManual:u,isLazy:d,lazyBehavior:f,orientation:g,descendants:B,direction:E,htmlProps:T}}var[JBe,Y1]=Bs({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function QBe(t){const{focusedIndex:e,orientation:r,direction:o}=Y1(),a=qBe(),u=X.useCallback(d=>{const f=()=>{var ae;const M=a.nextEnabled(e);M&&((ae=M.node)==null||ae.focus())},g=()=>{var ae;const M=a.prevEnabled(e);M&&((ae=M.node)==null||ae.focus())},E=()=>{var ae;const M=a.firstEnabled();M&&((ae=M.node)==null||ae.focus())},T=()=>{var ae;const M=a.lastEnabled();M&&((ae=M.node)==null||ae.focus())},C=r==="horizontal",I=r==="vertical",D=d.key,L=o==="ltr"?"ArrowLeft":"ArrowRight",B=o==="ltr"?"ArrowRight":"ArrowLeft",se={[L]:()=>C&&g(),[B]:()=>C&&f(),ArrowDown:()=>I&&f(),ArrowUp:()=>I&&g(),Home:E,End:T}[D];se&&(d.preventDefault(),se(d))},[a,e,r,o]);return{...t,role:"tablist","aria-orientation":r,onKeyDown:xr(t.onKeyDown,u)}}function ZBe(t){const{isDisabled:e=!1,isFocusable:r=!1,...o}=t,{setSelectedIndex:a,isManual:u,id:d,setFocusedIndex:f,selectedIndex:g}=Y1(),{index:E,register:T}=YBe({disabled:e&&!r}),C=E===g,I=()=>{a(E)},D=()=>{f(E),!u&&!(e&&r)&&a(E)};return{...E2e({...o,ref:Qs(T,t.ref),isDisabled:e,isFocusable:r,onClick:xr(t.onClick,I)}),id:foe(d,E),role:"tab",tabIndex:C?0:-1,type:"button","aria-selected":C,"aria-controls":poe(d,E),onFocus:e?void 0:xr(t.onFocus,D)}}var[e4e,t4e]=Bs({});function n4e(t){const e=Y1(),{id:r,selectedIndex:o}=e,u=d4(t.children).map((d,f)=>X.createElement(e4e,{key:f,value:{isSelected:f===o,id:poe(r,f),tabId:foe(r,f),selectedIndex:o}},d));return{...t,children:u}}function r4e(t){const{children:e,...r}=t,{isLazy:o,lazyBehavior:a}=Y1(),{isSelected:u,id:d,tabId:f}=t4e(),g=X.useRef(!1);u&&(g.current=!0);const E=F4({wasSelected:g.current,isSelected:u,enabled:o,mode:a});return{tabIndex:0,...r,children:E?e:null,role:"tabpanel","aria-labelledby":f,hidden:!u,id:d}}function foe(t,e){return`${t}--tab-${e}`}function poe(t,e){return`${t}--tabpanel-${e}`}var[i4e,X1]=Bs({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),moe=gn(function(e,r){const o=cl("Tabs",e),{children:a,className:u,...d}=eo(e),{htmlProps:f,descendants:g,...E}=XBe(d),T=X.useMemo(()=>E,[E]),{isFitted:C,...I}=f,D={position:"relative",...o.root};return $.jsx(KBe,{value:g,children:$.jsx(JBe,{value:T,children:$.jsx(i4e,{value:o,children:$.jsx(Yt.div,{className:dr("chakra-tabs",u),ref:r,...I,__css:D,children:a})})})})});moe.displayName="Tabs";var goe=gn(function(e,r){const o=QBe({...e,ref:r}),u={display:"flex",...X1().tablist};return $.jsx(Yt.div,{...o,className:dr("chakra-tabs__tablist",e.className),__css:u})});goe.displayName="TabList";var zF=gn(function(e,r){const o=r4e({...e,ref:r}),a=X1();return $.jsx(Yt.div,{outline:"0",...o,className:dr("chakra-tabs__tab-panel",e.className),__css:a.tabpanel})});zF.displayName="TabPanel";var voe=gn(function(e,r){const o=n4e(e),a=X1();return $.jsx(Yt.div,{...o,width:"100%",ref:r,className:dr("chakra-tabs__tab-panels",e.className),__css:a.tabpanels})});voe.displayName="TabPanels";var GF=gn(function(e,r){const o=X1(),a=ZBe({...e,ref:r}),u={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...o.tab};return $.jsx(Yt.button,{...a,className:dr("chakra-tabs__tab",e.className),__css:u})});GF.displayName="Tab";var s4e={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},HF=t=>{var e;return((e=t.current)==null?void 0:e.ownerDocument)||document},sN=t=>{var e,r;return((r=(e=t.current)==null?void 0:e.ownerDocument)==null?void 0:r.defaultView)||window};function o4e(t={}){const{openDelay:e=0,closeDelay:r=0,closeOnClick:o=!0,closeOnMouseDown:a,closeOnScroll:u,closeOnPointerDown:d=a,closeOnEsc:f=!0,onOpen:g,onClose:E,placement:T,id:C,isOpen:I,defaultIsOpen:D,arrowSize:L=10,arrowShadowColor:B,arrowPadding:G,modifiers:se,isDisabled:ae,gutter:M,offset:F,direction:z,...te}=t,{isOpen:j,onOpen:K,onClose:Q}=V4({isOpen:I,defaultIsOpen:D,onOpen:g,onClose:E}),{referenceRef:ce,getPopperProps:Ee,getArrowInnerProps:_e,getArrowProps:pe}=U4({enabled:j,placement:T,arrowPadding:G,modifiers:se,gutter:M,offset:F,direction:z}),qe=X.useId(),ke=`tooltip-${C??qe}`,Ne=X.useRef(null),Re=X.useRef(),Ve=X.useCallback(()=>{Re.current&&(clearTimeout(Re.current),Re.current=void 0)},[]),ve=X.useRef(),Be=X.useCallback(()=>{ve.current&&(clearTimeout(ve.current),ve.current=void 0)},[]),gt=X.useCallback(()=>{Be(),Q()},[Q,Be]),ze=a4e(Ne,gt),_t=X.useCallback(()=>{if(!ae&&!Re.current){j&&ze();const Tn=sN(Ne);Re.current=Tn.setTimeout(K,e)}},[ze,ae,j,K,e]),Dt=X.useCallback(()=>{Ve();const Tn=sN(Ne);ve.current=Tn.setTimeout(gt,r)},[r,gt,Ve]),jt=X.useCallback(()=>{j&&o&&Dt()},[o,Dt,j]),Zt=X.useCallback(()=>{j&&d&&Dt()},[d,Dt,j]),Xt=X.useCallback(Tn=>{j&&Tn.key==="Escape"&&Dt()},[j,Dt]);dT(()=>HF(Ne),"keydown",f?Xt:void 0),dT(()=>{if(!u)return null;const Tn=Ne.current;if(!Tn)return null;const Vn=gse(Tn);return Vn.localName==="body"?sN(Ne):Vn},"scroll",()=>{j&&u&&gt()},{passive:!0,capture:!0}),X.useEffect(()=>{ae&&(Ve(),j&&Q())},[ae,j,Q,Ve]),X.useEffect(()=>()=>{Ve(),Be()},[Ve,Be]),dT(()=>Ne.current,"pointerleave",Dt);const In=X.useCallback((Tn={},Vn=null)=>({...Tn,ref:Qs(Ne,Vn,ce),onPointerEnter:xr(Tn.onPointerEnter,Pt=>{Pt.pointerType!=="touch"&&_t()}),onClick:xr(Tn.onClick,jt),onPointerDown:xr(Tn.onPointerDown,Zt),onFocus:xr(Tn.onFocus,_t),onBlur:xr(Tn.onBlur,Dt),"aria-describedby":j?ke:void 0}),[_t,Dt,Zt,j,ke,jt,ce]),Qt=X.useCallback((Tn={},Vn=null)=>Ee({...Tn,style:{...Tn.style,[Xo.arrowSize.var]:L?`${L}px`:void 0,[Xo.arrowShadowColor.var]:B}},Vn),[Ee,L,B]),Er=X.useCallback((Tn={},Vn=null)=>{const wr={...Tn.style,position:"relative",transformOrigin:Xo.transformOrigin.varRef};return{ref:Vn,...te,...Tn,id:ke,role:"tooltip",style:wr}},[te,ke]);return{isOpen:j,show:_t,hide:Dt,getTriggerProps:In,getTooltipProps:Er,getTooltipPositionerProps:Qt,getArrowProps:pe,getArrowInnerProps:_e}}var l2="chakra-ui:close-tooltip";function a4e(t,e){return X.useEffect(()=>{const r=HF(t);return r.addEventListener(l2,e),()=>r.removeEventListener(l2,e)},[e,t]),()=>{const r=HF(t),o=sN(t);r.dispatchEvent(new o.CustomEvent(l2))}}function c4e(t,e=[]){const r=Object.assign({},t);for(const o of e)o in r&&delete r[o];return r}function u4e(t,e){const r={};for(const o of e)o in t&&(r[o]=t[o]);return r}var l4e=Yt(im.div),FR=gn((t,e)=>{var r,o;const a=gh("Tooltip",t),u=eo(t),d=qT(),{children:f,label:g,shouldWrapChildren:E,"aria-label":T,hasArrow:C,bg:I,portalProps:D,background:L,backgroundColor:B,bgColor:G,motionProps:se,...ae}=u,M=(o=(r=L??B)!=null?r:I)!=null?o:G;if(M){a.bg=M;const Ee=PCe(d,"colors",M);a[Xo.arrowBg.var]=Ee}const F=o4e({...ae,direction:d.direction}),z=typeof f=="string"||E;let te;if(z)te=$.jsx(Yt.span,{display:"inline-block",tabIndex:0,...F.getTriggerProps(),children:f});else{const Ee=X.Children.only(f);te=X.cloneElement(Ee,F.getTriggerProps(Ee.props,Ee.ref))}const j=!!T,K=F.getTooltipProps({},e),Q=j?c4e(K,["role","id"]):K,ce=u4e(K,["role","id"]);return g?$.jsxs($.Fragment,{children:[te,$.jsx(YT,{children:F.isOpen&&$.jsx(mh,{...D,children:$.jsx(Yt.div,{...F.getTooltipPositionerProps(),__css:{zIndex:a.zIndex,pointerEvents:"none"},children:$.jsxs(l4e,{variants:s4e,initial:"exit",animate:"enter",exit:"exit",...se,...Q,__css:a,children:[g,j&&$.jsx(Yt.span,{srOnly:!0,...ce,children:T}),C&&$.jsx(Yt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:$.jsx(Yt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:a.bg}})})]})})})})]}):$.jsx($.Fragment,{children:f})});FR.displayName="Tooltip";const d4e="modulepreload",h4e=function(t,e){return new URL(t,e).href},RQ={},d2=function(e,r,o){let a=Promise.resolve();if(r&&r.length>0){const d=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),g=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));a=Promise.allSettled(r.map(E=>{if(E=h4e(E,o),E in RQ)return;RQ[E]=!0;const T=E.endsWith(".css"),C=T?'[rel="stylesheet"]':"";if(!!o)for(let L=d.length-1;L>=0;L--){const B=d[L];if(B.href===E&&(!T||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${E}"]${C}`))return;const D=document.createElement("link");if(D.rel=T?"stylesheet":d4e,T||(D.as="script"),D.crossOrigin="",D.href=E,g&&D.setAttribute("nonce",g),document.head.appendChild(D),T)return new Promise((L,B)=>{D.addEventListener("load",L),D.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${E}`)))})}))}function u(d){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=d,window.dispatchEvent(f),!f.defaultPrevented)throw d}return a.then(d=>{for(const f of d||[])f.status==="rejected"&&u(f.reason);return e().catch(u)})},TP=()=>{const t=new Date,e=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0"),o=t.getSeconds().toString().padStart(2,"0"),a=t.getMilliseconds().toString().padStart(3,"0");return`${e}:${r}:${o}.${a}`},Gt={log:(...t)=>{{const e=t.map((r,o)=>o===0&&typeof r=="string"?`
${r}`:r);console.log(`[LOG] [${TP()}] `,...e)}},error:(...t)=>{{const e=t.map((r,o)=>o===0&&typeof r=="string"?`
${r}`:r);console.error(`[ERROR] [${TP()}] `,...e)}},warn:(...t)=>{{const e=t.map((r,o)=>o===0&&typeof r=="string"?`
${r}`:r);console.warn(`[WARN] [${TP()}]`,...e)}},trace:t=>{console.trace(`[TRACE] [${TP()}] ${t}`)}};async function f4e(t){let e;try{switch(t){case"default":e=await d2(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:e=await d2(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return e.default}catch(r){return Gt.error("Failed to load theme:",r),e=await d2(()=>import("./index.v0.9.22.js"),[],import.meta.url),e.default}}var IQ={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _oe=function(t){const e=[];let r=0;for(let o=0;o<t.length;o++){let a=t.charCodeAt(o);a<128?e[r++]=a:a<2048?(e[r++]=a>>6|192,e[r++]=a&63|128):(a&64512)===55296&&o+1<t.length&&(t.charCodeAt(o+1)&64512)===56320?(a=65536+((a&1023)<<10)+(t.charCodeAt(++o)&1023),e[r++]=a>>18|240,e[r++]=a>>12&63|128,e[r++]=a>>6&63|128,e[r++]=a&63|128):(e[r++]=a>>12|224,e[r++]=a>>6&63|128,e[r++]=a&63|128)}return e},p4e=function(t){const e=[];let r=0,o=0;for(;r<t.length;){const a=t[r++];if(a<128)e[o++]=String.fromCharCode(a);else if(a>191&&a<224){const u=t[r++];e[o++]=String.fromCharCode((a&31)<<6|u&63)}else if(a>239&&a<365){const u=t[r++],d=t[r++],f=t[r++],g=((a&7)<<18|(u&63)<<12|(d&63)<<6|f&63)-65536;e[o++]=String.fromCharCode(55296+(g>>10)),e[o++]=String.fromCharCode(56320+(g&1023))}else{const u=t[r++],d=t[r++];e[o++]=String.fromCharCode((a&15)<<12|(u&63)<<6|d&63)}}return e.join("")},yoe={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let a=0;a<t.length;a+=3){const u=t[a],d=a+1<t.length,f=d?t[a+1]:0,g=a+2<t.length,E=g?t[a+2]:0,T=u>>2,C=(u&3)<<4|f>>4;let I=(f&15)<<2|E>>6,D=E&63;g||(D=64,d||(I=64)),o.push(r[T],r[C],r[I],r[D])}return o.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(_oe(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):p4e(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let a=0;a<t.length;){const u=r[t.charAt(a++)],f=a<t.length?r[t.charAt(a)]:0;++a;const E=a<t.length?r[t.charAt(a)]:64;++a;const C=a<t.length?r[t.charAt(a)]:64;if(++a,u==null||f==null||E==null||C==null)throw new m4e;const I=u<<2|f>>4;if(o.push(I),E!==64){const D=f<<4&240|E>>2;if(o.push(D),C!==64){const L=E<<6&192|C;o.push(L)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class m4e extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const g4e=function(t){const e=_oe(t);return yoe.encodeByteArray(e,!0)},BN=function(t){return g4e(t).replace(/\./g,"")},Eoe=function(t){try{return yoe.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v4e(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4e=()=>v4e().__FIREBASE_DEFAULTS__,y4e=()=>{if(typeof process>"u"||typeof IQ>"u")return;const t=IQ.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},E4e=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Eoe(t[1]);return e&&JSON.parse(e)},J1=()=>{try{return _4e()||y4e()||E4e()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Soe=t=>{var e,r;return(r=(e=J1())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[t]},Toe=t=>{const e=Soe(t);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),o]:[e.substring(0,r),o]},boe=()=>{var t;return(t=J1())===null||t===void 0?void 0:t.config},woe=t=>{var e;return(e=J1())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S4e{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,o)=>{r?this.reject(r):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Coe(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},o=e||"demo-project",a=t.iat||0,u=t.sub||t.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const d=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:a,exp:a+3600,auth_time:a,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},t);return[BN(JSON.stringify(r)),BN(JSON.stringify(d)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function T4e(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(qc())}function b4e(){var t;const e=(t=J1())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function w4e(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function C4e(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function R4e(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function I4e(){const t=qc();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function A4e(){return!b4e()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function k4e(){try{return typeof indexedDB=="object"}catch{return!1}}function O4e(){return new Promise((t,e)=>{try{let r=!0;const o="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(o);a.onsuccess=()=>{a.result.close(),r||self.indexedDB.deleteDatabase(o),t(!0)},a.onupgradeneeded=()=>{r=!1},a.onerror=()=>{var u;e(((u=a.error)===null||u===void 0?void 0:u.message)||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P4e="FirebaseError";class xf extends Error{constructor(e,r,o){super(r),this.code=e,this.customData=o,this.name=P4e,Object.setPrototypeOf(this,xf.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,jR.prototype.create)}}class jR{constructor(e,r,o){this.service=e,this.serviceName=r,this.errors=o}create(e,...r){const o=r[0]||{},a=`${this.service}/${e}`,u=this.errors[e],d=u?N4e(u,o):"Error",f=`${this.serviceName}: ${d} (${a}).`;return new xf(a,f,o)}}function N4e(t,e){return t.replace(D4e,(r,o)=>{const a=e[o];return a!=null?String(a):`<${o}?>`})}const D4e=/\{\$([^}]+)}/g;function L4e(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function WN(t,e){if(t===e)return!0;const r=Object.keys(t),o=Object.keys(e);for(const a of r){if(!o.includes(a))return!1;const u=t[a],d=e[a];if(AQ(u)&&AQ(d)){if(!WN(u,d))return!1}else if(u!==d)return!1}for(const a of o)if(!r.includes(a))return!1;return!0}function AQ(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BR(t){const e=[];for(const[r,o]of Object.entries(t))Array.isArray(o)?o.forEach(a=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function nC(t){const e={};return t.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[a,u]=o.split("=");e[decodeURIComponent(a)]=decodeURIComponent(u)}}),e}function rC(t){const e=t.indexOf("?");if(!e)return"";const r=t.indexOf("#",e);return t.substring(e,r>0?r:void 0)}function x4e(t,e){const r=new M4e(t,e);return r.subscribe.bind(r)}class M4e{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,o){let a;if(e===void 0&&r===void 0&&o===void 0)throw new Error("Missing Observer.");U4e(e,["next","error","complete"])?a=e:a={next:e,error:r,complete:o},a.next===void 0&&(a.next=h2),a.error===void 0&&(a.error=h2),a.complete===void 0&&(a.complete=h2);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function U4e(t,e){if(typeof t!="object"||t===null)return!1;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}function h2(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qo(t){return t&&t._delegate?t._delegate:t}class jg{constructor(e,r,o){this.name=e,this.instanceFactory=r,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V4e{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const o=new S4e;if(this.instancesDeferred.set(r,o),this.isInitialized(r)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:r});a&&o.resolve(a)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(u){if(a)return null;throw u}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(j4e(e))try{this.getOrInitializeService({instanceIdentifier:x_})}catch{}for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);try{const u=this.getOrInitializeService({instanceIdentifier:a});o.resolve(u)}catch{}}}}clearInstance(e=x_){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=x_){return this.instances.has(e)}getOptions(e=x_){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:o,options:r});for(const[u,d]of this.instancesDeferred.entries()){const f=this.normalizeInstanceIdentifier(u);o===f&&d.resolve(a)}return a}onInit(e,r){var o;const a=this.normalizeInstanceIdentifier(r),u=(o=this.onInitCallbacks.get(a))!==null&&o!==void 0?o:new Set;u.add(e),this.onInitCallbacks.set(a,u);const d=this.instances.get(a);return d&&e(d,a),()=>{u.delete(e)}}invokeOnInitCallbacks(e,r){const o=this.onInitCallbacks.get(r);if(o)for(const a of o)try{a(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:F4e(e),options:r}),this.instances.set(e,o),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=x_){return this.component?this.component.multipleInstances?e:x_:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function F4e(t){return t===x_?void 0:t}function j4e(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B4e{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new V4e(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oi;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(oi||(oi={}));const W4e={debug:oi.DEBUG,verbose:oi.VERBOSE,info:oi.INFO,warn:oi.WARN,error:oi.ERROR,silent:oi.SILENT},z4e=oi.INFO,G4e={[oi.DEBUG]:"log",[oi.VERBOSE]:"log",[oi.INFO]:"info",[oi.WARN]:"warn",[oi.ERROR]:"error"},H4e=(t,e,...r)=>{if(e<t.logLevel)return;const o=new Date().toISOString(),a=G4e[e];if(a)console[a](`[${o}]  ${t.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class B4{constructor(e){this.name=e,this._logLevel=z4e,this._logHandler=H4e,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in oi))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?W4e[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,oi.DEBUG,...e),this._logHandler(this,oi.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,oi.VERBOSE,...e),this._logHandler(this,oi.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,oi.INFO,...e),this._logHandler(this,oi.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,oi.WARN,...e),this._logHandler(this,oi.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,oi.ERROR,...e),this._logHandler(this,oi.ERROR,...e)}}const K4e=(t,e)=>e.some(r=>t instanceof r);let kQ,OQ;function q4e(){return kQ||(kQ=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function $4e(){return OQ||(OQ=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Roe=new WeakMap,KF=new WeakMap,Ioe=new WeakMap,f2=new WeakMap,W4=new WeakMap;function Y4e(t){const e=new Promise((r,o)=>{const a=()=>{t.removeEventListener("success",u),t.removeEventListener("error",d)},u=()=>{r(Ag(t.result)),a()},d=()=>{o(t.error),a()};t.addEventListener("success",u),t.addEventListener("error",d)});return e.then(r=>{r instanceof IDBCursor&&Roe.set(r,t)}).catch(()=>{}),W4.set(e,t),e}function X4e(t){if(KF.has(t))return;const e=new Promise((r,o)=>{const a=()=>{t.removeEventListener("complete",u),t.removeEventListener("error",d),t.removeEventListener("abort",d)},u=()=>{r(),a()},d=()=>{o(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",u),t.addEventListener("error",d),t.addEventListener("abort",d)});KF.set(t,e)}let qF={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return KF.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Ioe.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Ag(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function J4e(t){qF=t(qF)}function Q4e(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const o=t.call(p2(this),e,...r);return Ioe.set(o,e.sort?e.sort():[e]),Ag(o)}:$4e().includes(t)?function(...e){return t.apply(p2(this),e),Ag(Roe.get(this))}:function(...e){return Ag(t.apply(p2(this),e))}}function Z4e(t){return typeof t=="function"?Q4e(t):(t instanceof IDBTransaction&&X4e(t),K4e(t,q4e())?new Proxy(t,qF):t)}function Ag(t){if(t instanceof IDBRequest)return Y4e(t);if(f2.has(t))return f2.get(t);const e=Z4e(t);return e!==t&&(f2.set(t,e),W4.set(e,t)),e}const p2=t=>W4.get(t);function e5e(t,e,{blocked:r,upgrade:o,blocking:a,terminated:u}={}){const d=indexedDB.open(t,e),f=Ag(d);return o&&d.addEventListener("upgradeneeded",g=>{o(Ag(d.result),g.oldVersion,g.newVersion,Ag(d.transaction),g)}),r&&d.addEventListener("blocked",g=>r(g.oldVersion,g.newVersion,g)),f.then(g=>{u&&g.addEventListener("close",()=>u()),a&&g.addEventListener("versionchange",E=>a(E.oldVersion,E.newVersion,E))}).catch(()=>{}),f}const t5e=["get","getKey","getAll","getAllKeys","count"],n5e=["put","add","delete","clear"],m2=new Map;function PQ(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(m2.get(e))return m2.get(e);const r=e.replace(/FromIndex$/,""),o=e!==r,a=n5e.includes(r);if(!(r in(o?IDBIndex:IDBObjectStore).prototype)||!(a||t5e.includes(r)))return;const u=async function(d,...f){const g=this.transaction(d,a?"readwrite":"readonly");let E=g.store;return o&&(E=E.index(f.shift())),(await Promise.all([E[r](...f),a&&g.done]))[0]};return m2.set(e,u),u}J4e(t=>({...t,get:(e,r,o)=>PQ(e,r)||t.get(e,r,o),has:(e,r)=>!!PQ(e,r)||t.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r5e{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(i5e(r)){const o=r.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(r=>r).join(" ")}}function i5e(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const $F="@firebase/app",NQ="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $p=new B4("@firebase/app"),s5e="@firebase/app-compat",o5e="@firebase/analytics-compat",a5e="@firebase/analytics",c5e="@firebase/app-check-compat",u5e="@firebase/app-check",l5e="@firebase/auth",d5e="@firebase/auth-compat",h5e="@firebase/database",f5e="@firebase/data-connect",p5e="@firebase/database-compat",m5e="@firebase/functions",g5e="@firebase/functions-compat",v5e="@firebase/installations",_5e="@firebase/installations-compat",y5e="@firebase/messaging",E5e="@firebase/messaging-compat",S5e="@firebase/performance",T5e="@firebase/performance-compat",b5e="@firebase/remote-config",w5e="@firebase/remote-config-compat",C5e="@firebase/storage",R5e="@firebase/storage-compat",I5e="@firebase/firestore",A5e="@firebase/vertexai-preview",k5e="@firebase/firestore-compat",O5e="firebase",P5e="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YF="[DEFAULT]",N5e={[$F]:"fire-core",[s5e]:"fire-core-compat",[a5e]:"fire-analytics",[o5e]:"fire-analytics-compat",[u5e]:"fire-app-check",[c5e]:"fire-app-check-compat",[l5e]:"fire-auth",[d5e]:"fire-auth-compat",[h5e]:"fire-rtdb",[f5e]:"fire-data-connect",[p5e]:"fire-rtdb-compat",[m5e]:"fire-fn",[g5e]:"fire-fn-compat",[v5e]:"fire-iid",[_5e]:"fire-iid-compat",[y5e]:"fire-fcm",[E5e]:"fire-fcm-compat",[S5e]:"fire-perf",[T5e]:"fire-perf-compat",[b5e]:"fire-rc",[w5e]:"fire-rc-compat",[C5e]:"fire-gcs",[R5e]:"fire-gcs-compat",[I5e]:"fire-fst",[k5e]:"fire-fst-compat",[A5e]:"fire-vertex","fire-js":"fire-js",[O5e]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zN=new Map,D5e=new Map,XF=new Map;function DQ(t,e){try{t.container.addComponent(e)}catch(r){$p.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,r)}}function fy(t){const e=t.name;if(XF.has(e))return $p.debug(`There were multiple attempts to register component ${e}.`),!1;XF.set(e,t);for(const r of zN.values())DQ(r,t);for(const r of D5e.values())DQ(r,t);return!0}function Q1(t,e){const r=t.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),t.container.getProvider(e)}function lf(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L5e={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},kg=new jR("app","Firebase",L5e);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x5e{constructor(e,r,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new jg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw kg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cy=P5e;function Aoe(t,e={}){let r=t;typeof e!="object"&&(e={name:e});const o=Object.assign({name:YF,automaticDataCollectionEnabled:!1},e),a=o.name;if(typeof a!="string"||!a)throw kg.create("bad-app-name",{appName:String(a)});if(r||(r=boe()),!r)throw kg.create("no-options");const u=zN.get(a);if(u){if(WN(r,u.options)&&WN(o,u.config))return u;throw kg.create("duplicate-app",{appName:a})}const d=new B4e(a);for(const g of XF.values())d.addComponent(g);const f=new x5e(r,o,d);return zN.set(a,f),f}function z4(t=YF){const e=zN.get(t);if(!e&&t===YF&&boe())return Aoe();if(!e)throw kg.create("no-app",{appName:t});return e}function vf(t,e,r){var o;let a=(o=N5e[t])!==null&&o!==void 0?o:t;r&&(a+=`-${r}`);const u=a.match(/\s|\//),d=e.match(/\s|\//);if(u||d){const f=[`Unable to register library "${a}" with version "${e}":`];u&&f.push(`library name "${a}" contains illegal characters (whitespace or "/")`),u&&d&&f.push("and"),d&&f.push(`version name "${e}" contains illegal characters (whitespace or "/")`),$p.warn(f.join(" "));return}fy(new jg(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M5e="firebase-heartbeat-database",U5e=1,sR="firebase-heartbeat-store";let g2=null;function koe(){return g2||(g2=e5e(M5e,U5e,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(sR)}catch(r){console.warn(r)}}}}).catch(t=>{throw kg.create("idb-open",{originalErrorMessage:t.message})})),g2}async function V5e(t){try{const r=(await koe()).transaction(sR),o=await r.objectStore(sR).get(Ooe(t));return await r.done,o}catch(e){if(e instanceof xf)$p.warn(e.message);else{const r=kg.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});$p.warn(r.message)}}}async function LQ(t,e){try{const o=(await koe()).transaction(sR,"readwrite");await o.objectStore(sR).put(e,Ooe(t)),await o.done}catch(r){if(r instanceof xf)$p.warn(r.message);else{const o=kg.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});$p.warn(o.message)}}}function Ooe(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F5e=1024,j5e=30*24*60*60*1e3;class B5e{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new z5e(r),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,r;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=xQ();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(d=>d.date===u)?void 0:(this._heartbeatsCache.heartbeats.push({date:u,agent:a}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(d=>{const f=new Date(d.date).valueOf();return Date.now()-f<=j5e}),this._storage.overwrite(this._heartbeatsCache))}catch(o){$p.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=xQ(),{heartbeatsToSend:o,unsentEntries:a}=W5e(this._heartbeatsCache.heartbeats),u=BN(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=r,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(r){return $p.warn(r),""}}}function xQ(){return new Date().toISOString().substring(0,10)}function W5e(t,e=F5e){const r=[];let o=t.slice();for(const a of t){const u=r.find(d=>d.agent===a.agent);if(u){if(u.dates.push(a.date),MQ(r)>e){u.dates.pop();break}}else if(r.push({agent:a.agent,dates:[a.date]}),MQ(r)>e){r.pop();break}o=o.slice(1)}return{heartbeatsToSend:r,unsentEntries:o}}class z5e{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return k4e()?O4e().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await V5e(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const a=await this.read();return LQ(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const a=await this.read();return LQ(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function MQ(t){return BN(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G5e(t){fy(new jg("platform-logger",e=>new r5e(e),"PRIVATE")),fy(new jg("heartbeat",e=>new B5e(e),"PRIVATE")),vf($F,NQ,t),vf($F,NQ,"esm2017"),vf("fire-js","")}G5e("");function Poe(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const H5e=Poe,Noe=new jR("auth","Firebase",Poe());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GN=new B4("@firebase/auth");function K5e(t,...e){GN.logLevel<=oi.WARN&&GN.warn(`Auth (${Cy}): ${t}`,...e)}function oN(t,...e){GN.logLevel<=oi.ERROR&&GN.error(`Auth (${Cy}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fh(t,...e){throw G4(t,...e)}function _f(t,...e){return G4(t,...e)}function Doe(t,e,r){const o=Object.assign(Object.assign({},H5e()),{[e]:r});return new jR("auth","Firebase",o).create(e,{appName:t.name})}function zp(t){return Doe(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function G4(t,...e){if(typeof t!="string"){const r=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=t.name),t._errorFactory.create(r,...o)}return Noe.create(t,...e)}function or(t,e,...r){if(!t)throw G4(e,...r)}function Lp(t){const e="INTERNAL ASSERTION FAILED: "+t;throw oN(e),new Error(e)}function Yp(t,e){t||Lp(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JF(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function q5e(){return UQ()==="http:"||UQ()==="https:"}function UQ(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $5e(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(q5e()||C4e()||"connection"in navigator)?navigator.onLine:!0}function Y5e(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WR{constructor(e,r){this.shortDelay=e,this.longDelay=r,Yp(r>e,"Short delay should be less than long delay!"),this.isMobile=T4e()||R4e()}get(){return $5e()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H4(t,e){Yp(t.emulator,"Emulator should always be set here");const{url:r}=t.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Loe{static initialize(e,r,o){this.fetchImpl=e,r&&(this.headersImpl=r),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Lp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Lp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Lp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5e={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J5e=new WR(3e4,6e4);function Qg(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Zg(t,e,r,o,a={}){return xoe(t,a,async()=>{let u={},d={};o&&(e==="GET"?d=o:u={body:JSON.stringify(o)});const f=BR(Object.assign({key:t.config.apiKey},d)).slice(1),g=await t._getAdditionalHeaders();g["Content-Type"]="application/json",t.languageCode&&(g["X-Firebase-Locale"]=t.languageCode);const E=Object.assign({method:e,headers:g},u);return w4e()||(E.referrerPolicy="no-referrer"),Loe.fetch()(Moe(t,t.config.apiHost,r,f),E)})}async function xoe(t,e,r){t._canInitEmulator=!1;const o=Object.assign(Object.assign({},X5e),e);try{const a=new Z5e(t),u=await Promise.race([r(),a.promise]);a.clearNetworkTimeout();const d=await u.json();if("needConfirmation"in d)throw bP(t,"account-exists-with-different-credential",d);if(u.ok&&!("errorMessage"in d))return d;{const f=u.ok?d.errorMessage:d.error.message,[g,E]=f.split(" : ");if(g==="FEDERATED_USER_ID_ALREADY_LINKED")throw bP(t,"credential-already-in-use",d);if(g==="EMAIL_EXISTS")throw bP(t,"email-already-in-use",d);if(g==="USER_DISABLED")throw bP(t,"user-disabled",d);const T=o[g]||g.toLowerCase().replace(/[_\s]+/g,"-");if(E)throw Doe(t,T,E);fh(t,T)}}catch(a){if(a instanceof xf)throw a;fh(t,"network-request-failed",{message:String(a)})}}async function zR(t,e,r,o,a={}){const u=await Zg(t,e,r,o,a);return"mfaPendingCredential"in u&&fh(t,"multi-factor-auth-required",{_serverResponse:u}),u}function Moe(t,e,r,o){const a=`${e}${r}?${o}`;return t.config.emulator?H4(t.config,a):`${t.config.apiScheme}://${a}`}function Q5e(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Z5e{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,o)=>{this.timer=setTimeout(()=>o(_f(this.auth,"network-request-failed")),J5e.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function bP(t,e,r){const o={appName:t.name};r.email&&(o.email=r.email),r.phoneNumber&&(o.phoneNumber=r.phoneNumber);const a=_f(t,e,o);return a.customData._tokenResponse=r,a}function VQ(t){return t!==void 0&&t.enterprise!==void 0}class e6e{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const r of this.recaptchaEnforcementState)if(r.provider&&r.provider===e)return Q5e(r.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function t6e(t,e){return Zg(t,"GET","/v2/recaptchaConfig",Qg(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n6e(t,e){return Zg(t,"POST","/v1/accounts:delete",e)}async function Uoe(t,e){return Zg(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AC(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function r6e(t,e=!1){const r=Qo(t),o=await r.getIdToken(e),a=K4(o);or(a&&a.exp&&a.auth_time&&a.iat,r.auth,"internal-error");const u=typeof a.firebase=="object"?a.firebase:void 0,d=u==null?void 0:u.sign_in_provider;return{claims:a,token:o,authTime:AC(v2(a.auth_time)),issuedAtTime:AC(v2(a.iat)),expirationTime:AC(v2(a.exp)),signInProvider:d||null,signInSecondFactor:(u==null?void 0:u.sign_in_second_factor)||null}}function v2(t){return Number(t)*1e3}function K4(t){const[e,r,o]=t.split(".");if(e===void 0||r===void 0||o===void 0)return oN("JWT malformed, contained fewer than 3 sections"),null;try{const a=Eoe(r);return a?JSON.parse(a):(oN("Failed to decode base64 JWT payload"),null)}catch(a){return oN("Caught error parsing JWT payload as JSON",a==null?void 0:a.toString()),null}}function FQ(t){const e=K4(t);return or(e,"internal-error"),or(typeof e.exp<"u","internal-error"),or(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oR(t,e,r=!1){if(r)return e;try{return await e}catch(o){throw o instanceof xf&&i6e(o)&&t.auth.currentUser===t&&await t.auth.signOut(),o}}function i6e({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s6e{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const a=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QF{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=AC(this.lastLoginAt),this.creationTime=AC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HN(t){var e;const r=t.auth,o=await t.getIdToken(),a=await oR(t,Uoe(r,{idToken:o}));or(a==null?void 0:a.users.length,r,"internal-error");const u=a.users[0];t._notifyReloadListener(u);const d=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?Voe(u.providerUserInfo):[],f=a6e(t.providerData,d),g=t.isAnonymous,E=!(t.email&&u.passwordHash)&&!(f!=null&&f.length),T=g?E:!1,C={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:f,metadata:new QF(u.createdAt,u.lastLoginAt),isAnonymous:T};Object.assign(t,C)}async function o6e(t){const e=Qo(t);await HN(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function a6e(t,e){return[...t.filter(o=>!e.some(a=>a.providerId===o.providerId)),...e]}function Voe(t){return t.map(e=>{var{providerId:r}=e,o=xR(e,["providerId"]);return{providerId:r,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c6e(t,e){const r=await xoe(t,{},async()=>{const o=BR({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:u}=t.config,d=Moe(t,a,"/v1/token",`key=${u}`),f=await t._getAdditionalHeaders();return f["Content-Type"]="application/x-www-form-urlencoded",Loe.fetch()(d,{method:"POST",headers:f,body:o})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function u6e(t,e){return Zg(t,"POST","/v2/accounts:revokeToken",Qg(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mT{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){or(e.idToken,"internal-error"),or(typeof e.idToken<"u","internal-error"),or(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):FQ(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}updateFromIdToken(e){or(e.length!==0,"internal-error");const r=FQ(e);this.updateTokensAndExpiration(e,null,r)}async getToken(e,r=!1){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(or(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:o,refreshToken:a,expiresIn:u}=await c6e(e,r);this.updateTokensAndExpiration(o,a,Number(u))}updateTokensAndExpiration(e,r,o){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,r){const{refreshToken:o,accessToken:a,expirationTime:u}=r,d=new mT;return o&&(or(typeof o=="string","internal-error",{appName:e}),d.refreshToken=o),a&&(or(typeof a=="string","internal-error",{appName:e}),d.accessToken=a),u&&(or(typeof u=="number","internal-error",{appName:e}),d.expirationTime=u),d}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new mT,this.toJSON())}_performRefresh(){return Lp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dg(t,e){or(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class xp{constructor(e){var{uid:r,auth:o,stsTokenManager:a}=e,u=xR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new s6e(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=o,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new QF(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const r=await oR(this,this.stsTokenManager.getToken(this.auth,e));return or(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return r6e(this,e)}reload(){return o6e(this)}_assign(e){this!==e&&(or(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new xp(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){or(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),r&&await HN(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(lf(this.auth.app))return Promise.reject(zp(this.auth));const e=await this.getIdToken();return await oR(this,n6e(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var o,a,u,d,f,g,E,T;const C=(o=r.displayName)!==null&&o!==void 0?o:void 0,I=(a=r.email)!==null&&a!==void 0?a:void 0,D=(u=r.phoneNumber)!==null&&u!==void 0?u:void 0,L=(d=r.photoURL)!==null&&d!==void 0?d:void 0,B=(f=r.tenantId)!==null&&f!==void 0?f:void 0,G=(g=r._redirectEventId)!==null&&g!==void 0?g:void 0,se=(E=r.createdAt)!==null&&E!==void 0?E:void 0,ae=(T=r.lastLoginAt)!==null&&T!==void 0?T:void 0,{uid:M,emailVerified:F,isAnonymous:z,providerData:te,stsTokenManager:j}=r;or(M&&j,e,"internal-error");const K=mT.fromJSON(this.name,j);or(typeof M=="string",e,"internal-error"),dg(C,e.name),dg(I,e.name),or(typeof F=="boolean",e,"internal-error"),or(typeof z=="boolean",e,"internal-error"),dg(D,e.name),dg(L,e.name),dg(B,e.name),dg(G,e.name),dg(se,e.name),dg(ae,e.name);const Q=new xp({uid:M,auth:e,email:I,emailVerified:F,displayName:C,isAnonymous:z,photoURL:L,phoneNumber:D,tenantId:B,stsTokenManager:K,createdAt:se,lastLoginAt:ae});return te&&Array.isArray(te)&&(Q.providerData=te.map(ce=>Object.assign({},ce))),G&&(Q._redirectEventId=G),Q}static async _fromIdTokenResponse(e,r,o=!1){const a=new mT;a.updateFromServerResponse(r);const u=new xp({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o});return await HN(u),u}static async _fromGetAccountInfoResponse(e,r,o){const a=r.users[0];or(a.localId!==void 0,"internal-error");const u=a.providerUserInfo!==void 0?Voe(a.providerUserInfo):[],d=!(a.email&&a.passwordHash)&&!(u!=null&&u.length),f=new mT;f.updateFromIdToken(o);const g=new xp({uid:a.localId,auth:e,stsTokenManager:f,isAnonymous:d}),E={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:u,metadata:new QF(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!(u!=null&&u.length)};return Object.assign(g,E),g}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jQ=new Map;function Mp(t){Yp(t instanceof Function,"Expected a class definition");let e=jQ.get(t);return e?(Yp(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,jQ.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Foe{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}Foe.type="NONE";const BQ=Foe;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aN(t,e,r){return`firebase:${t}:${e}:${r}`}class gT{constructor(e,r,o){this.persistence=e,this.auth=r,this.userKey=o;const{config:a,name:u}=this.auth;this.fullUserKey=aN(this.userKey,a.apiKey,u),this.fullPersistenceKey=aN("persistence",a.apiKey,u),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?xp._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,o="authUser"){if(!r.length)return new gT(Mp(BQ),e,o);const a=(await Promise.all(r.map(async E=>{if(await E._isAvailable())return E}))).filter(E=>E);let u=a[0]||Mp(BQ);const d=aN(o,e.config.apiKey,e.name);let f=null;for(const E of r)try{const T=await E._get(d);if(T){const C=xp._fromJSON(e,T);E!==u&&(f=C),u=E;break}}catch{}const g=a.filter(E=>E._shouldAllowMigration);return!u._shouldAllowMigration||!g.length?new gT(u,e,o):(u=g[0],f&&await u._set(d,f.toJSON()),await Promise.all(r.map(async E=>{if(E!==u)try{await E._remove(d)}catch{}})),new gT(u,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WQ(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zoe(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(joe(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Hoe(e))return"Blackberry";if(Koe(e))return"Webos";if(Boe(e))return"Safari";if((e.includes("chrome/")||Woe(e))&&!e.includes("edge/"))return"Chrome";if(Goe(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=t.match(r);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function joe(t=qc()){return/firefox\//i.test(t)}function Boe(t=qc()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Woe(t=qc()){return/crios\//i.test(t)}function zoe(t=qc()){return/iemobile/i.test(t)}function Goe(t=qc()){return/android/i.test(t)}function Hoe(t=qc()){return/blackberry/i.test(t)}function Koe(t=qc()){return/webos/i.test(t)}function q4(t=qc()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function l6e(t=qc()){var e;return q4(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function d6e(){return I4e()&&document.documentMode===10}function qoe(t=qc()){return q4(t)||Goe(t)||Koe(t)||Hoe(t)||/windows phone/i.test(t)||zoe(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $oe(t,e=[]){let r;switch(t){case"Browser":r=WQ(qc());break;case"Worker":r=`${WQ(qc())}-${t}`;break;default:r=t}const o=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${Cy}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h6e{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const o=u=>new Promise((d,f)=>{try{const g=e(u);d(g)}catch(g){f(g)}});o.onAbort=r,this.queue.push(o);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const o of this.queue)await o(e),o.onAbort&&r.push(o.onAbort)}catch(o){r.reverse();for(const a of r)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f6e(t,e={}){return Zg(t,"GET","/v2/passwordPolicy",Qg(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p6e=6;class m6e{constructor(e){var r,o,a,u;const d=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=d.minPasswordLength)!==null&&r!==void 0?r:p6e,d.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=d.maxPasswordLength),d.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=d.containsLowercaseCharacter),d.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=d.containsUppercaseCharacter),d.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=d.containsNumericCharacter),d.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=d.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(a=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&a!==void 0?a:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var r,o,a,u,d,f;const g={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,g),this.validatePasswordCharacterOptions(e,g),g.isValid&&(g.isValid=(r=g.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),g.isValid&&(g.isValid=(o=g.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),g.isValid&&(g.isValid=(a=g.containsLowercaseLetter)!==null&&a!==void 0?a:!0),g.isValid&&(g.isValid=(u=g.containsUppercaseLetter)!==null&&u!==void 0?u:!0),g.isValid&&(g.isValid=(d=g.containsNumericCharacter)!==null&&d!==void 0?d:!0),g.isValid&&(g.isValid=(f=g.containsNonAlphanumericCharacter)!==null&&f!==void 0?f:!0),g}validatePasswordLengthOptions(e,r){const o=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;o&&(r.meetsMinPasswordLength=e.length>=o),a&&(r.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let o;for(let a=0;a<e.length;a++)o=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(r,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,r,o,a,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g6e{constructor(e,r,o,a){this.app=e,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=o,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new zQ(this),this.idTokenSubscription=new zQ(this),this.beforeStateQueue=new h6e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Noe,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=Mp(r)),this._initializationPromise=this.queue(async()=>{var o,a;if(!this._deleted&&(this.persistenceManager=await gT.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const r=await Uoe(this,{idToken:e}),o=await xp._fromGetAccountInfoResponse(this,r,e);await this.directlySetCurrentUser(o)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var r;if(lf(this.app)){const d=this.app.settings.authIdToken;return d?new Promise(f=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(d).then(f,f))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let a=o,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const d=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,f=a==null?void 0:a._redirectEventId,g=await this.tryRedirectSignIn(e);(!d||d===f)&&(g!=null&&g.user)&&(a=g.user,u=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(a)}catch(d){a=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(d))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return or(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await HN(e)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Y5e()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(lf(this.app))return Promise.reject(zp(this));const r=e?Qo(e):null;return r&&or(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&or(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return lf(this.app)?Promise.reject(zp(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return lf(this.app)?Promise.reject(zp(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Mp(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await f6e(this),r=new m6e(e);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new jR("auth","Firebase",e())}onAuthStateChanged(e,r,o){return this.registerStateListener(this.authStateSubscription,e,r,o)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,o){return this.registerStateListener(this.idTokenSubscription,e,r,o)}authStateReady(){return new Promise((e,r)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},r)}})}async revokeAccessToken(e){if(this.currentUser){const r=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};this.tenantId!=null&&(o.tenantId=this.tenantId),await u6e(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const o=await this.getOrInitRedirectPersistenceManager(r);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&Mp(e)||this._popupRedirectResolver;or(r,this,"argument-error"),this.redirectPersistenceManager=await gT.create(this,[Mp(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,o;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,o,a){if(this._deleted)return()=>{};const u=typeof r=="function"?r:r.next.bind(r);let d=!1;const f=this._isInitialized?Promise.resolve():this._initializationPromise;if(or(f,this,"internal-error"),f.then(()=>{d||u(this.currentUser)}),typeof r=="function"){const g=e.addObserver(r,o,a);return()=>{d=!0,g()}}else{const g=e.addObserver(r);return()=>{d=!0,g()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return or(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=$oe(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(r["X-Firebase-Client"]=o);const a=await this._getAppCheckToken();return a&&(r["X-Firebase-AppCheck"]=a),r}async _getAppCheckToken(){var e;const r=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return r!=null&&r.error&&K5e(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function Ry(t){return Qo(t)}class zQ{constructor(e){this.auth=e,this.observer=null,this.addObserver=x4e(r=>this.observer=r)}get next(){return or(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Z1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function v6e(t){Z1=t}function Yoe(t){return Z1.loadJS(t)}function _6e(){return Z1.recaptchaEnterpriseScript}function y6e(){return Z1.gapiScript}function E6e(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const S6e="recaptcha-enterprise",T6e="NO_RECAPTCHA";class b6e{constructor(e){this.type=S6e,this.auth=Ry(e)}async verify(e="verify",r=!1){async function o(u){if(!r){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(d,f)=>{t6e(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(g=>{if(g.recaptchaKey===void 0)f(new Error("recaptcha Enterprise site key undefined"));else{const E=new e6e(g);return u.tenantId==null?u._agentRecaptchaConfig=E:u._tenantRecaptchaConfigs[u.tenantId]=E,d(E.siteKey)}}).catch(g=>{f(g)})})}function a(u,d,f){const g=window.grecaptcha;VQ(g)?g.enterprise.ready(()=>{g.enterprise.execute(u,{action:e}).then(E=>{d(E)}).catch(()=>{d(T6e)})}):f(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((u,d)=>{o(this.auth).then(f=>{if(!r&&VQ(window.grecaptcha))a(f,u,d);else{if(typeof window>"u"){d(new Error("RecaptchaVerifier is only supported in browser"));return}let g=_6e();g.length!==0&&(g+=f),Yoe(g).then(()=>{a(f,u,d)}).catch(E=>{d(E)})}}).catch(f=>{d(f)})})}}async function GQ(t,e,r,o=!1){const a=new b6e(t);let u;try{u=await a.verify(r)}catch{u=await a.verify(r,!0)}const d=Object.assign({},e);return o?Object.assign(d,{captchaResp:u}):Object.assign(d,{captchaResponse:u}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}async function ZF(t,e,r,o){var a;if(!((a=t._getRecaptchaConfig())===null||a===void 0)&&a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const u=await GQ(t,e,r,r==="getOobCode");return o(t,u)}else return o(t,e).catch(async u=>{if(u.code==="auth/missing-recaptcha-token"){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const d=await GQ(t,e,r,r==="getOobCode");return o(t,d)}else return Promise.reject(u)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w6e(t,e){const r=Q1(t,"auth");if(r.isInitialized()){const a=r.getImmediate(),u=r.getOptions();if(WN(u,e??{}))return a;fh(a,"already-initialized")}return r.initialize({options:e})}function C6e(t,e){const r=(e==null?void 0:e.persistence)||[],o=(Array.isArray(r)?r:[r]).map(Mp);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}function R6e(t,e,r){const o=Ry(t);or(o._canInitEmulator,o,"emulator-config-failed"),or(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const a=!1,u=Xoe(e),{host:d,port:f}=I6e(e),g=f===null?"":`:${f}`;o.config.emulator={url:`${u}//${d}${g}/`},o.settings.appVerificationDisabledForTesting=!0,o.emulatorConfig=Object.freeze({host:d,port:f,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:a})}),A6e()}function Xoe(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function I6e(t){const e=Xoe(t),r=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!r)return{host:"",port:null};const o=r[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(o);if(a){const u=a[1];return{host:u,port:HQ(o.substr(u.length+1))}}else{const[u,d]=o.split(":");return{host:u,port:HQ(d)}}}function HQ(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function A6e(){function t(){const e=document.createElement("p"),r=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4{constructor(e,r){this.providerId=e,this.signInMethod=r}toJSON(){return Lp("not implemented")}_getIdTokenResponse(e){return Lp("not implemented")}_linkToIdToken(e,r){return Lp("not implemented")}_getReauthenticationResolver(e){return Lp("not implemented")}}async function k6e(t,e){return Zg(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O6e(t,e){return zR(t,"POST","/v1/accounts:signInWithPassword",Qg(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P6e(t,e){return zR(t,"POST","/v1/accounts:signInWithEmailLink",Qg(t,e))}async function N6e(t,e){return zR(t,"POST","/v1/accounts:signInWithEmailLink",Qg(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR extends $4{constructor(e,r,o,a=null){super("password",o),this._email=e,this._password=r,this._tenantId=a}static _fromEmailAndPassword(e,r){return new aR(e,r,"password")}static _fromEmailAndCode(e,r,o=null){return new aR(e,r,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ZF(e,r,"signInWithPassword",O6e);case"emailLink":return P6e(e,{email:this._email,oobCode:this._password});default:fh(e,"internal-error")}}async _linkToIdToken(e,r){switch(this.signInMethod){case"password":const o={idToken:r,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ZF(e,o,"signUpPassword",k6e);case"emailLink":return N6e(e,{idToken:r,email:this._email,oobCode:this._password});default:fh(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vT(t,e){return zR(t,"POST","/v1/accounts:signInWithIdp",Qg(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D6e="http://localhost";class py extends $4{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const r=new py(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):fh("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:a}=r,u=xR(r,["providerId","signInMethod"]);if(!o||!a)return null;const d=new py(o,a);return d.idToken=u.idToken||void 0,d.accessToken=u.accessToken||void 0,d.secret=u.secret,d.nonce=u.nonce,d.pendingToken=u.pendingToken||null,d}_getIdTokenResponse(e){const r=this.buildRequest();return vT(e,r)}_linkToIdToken(e,r){const o=this.buildRequest();return o.idToken=r,vT(e,o)}_getReauthenticationResolver(e){const r=this.buildRequest();return r.autoCreate=!1,vT(e,r)}buildRequest(){const e={requestUri:D6e,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=BR(r)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L6e(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function x6e(t){const e=nC(rC(t)).link,r=e?nC(rC(e)).deep_link_id:null,o=nC(rC(t)).deep_link_id;return(o?nC(rC(o)).link:null)||o||r||e||t}class Y4{constructor(e){var r,o,a,u,d,f;const g=nC(rC(e)),E=(r=g.apiKey)!==null&&r!==void 0?r:null,T=(o=g.oobCode)!==null&&o!==void 0?o:null,C=L6e((a=g.mode)!==null&&a!==void 0?a:null);or(E&&T&&C,"argument-error"),this.apiKey=E,this.operation=C,this.code=T,this.continueUrl=(u=g.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(d=g.languageCode)!==null&&d!==void 0?d:null,this.tenantId=(f=g.tenantId)!==null&&f!==void 0?f:null}static parseLink(e){const r=x6e(e);try{return new Y4(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QT{constructor(){this.providerId=QT.PROVIDER_ID}static credential(e,r){return aR._fromEmailAndPassword(e,r)}static credentialWithLink(e,r){const o=Y4.parseLink(r);return or(o,"argument-error"),aR._fromEmailAndCode(e,o.code,o.tenantId)}}QT.PROVIDER_ID="password";QT.EMAIL_PASSWORD_SIGN_IN_METHOD="password";QT.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Joe{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GR extends Joe{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g extends GR{constructor(){super("facebook.com")}static credential(e){return py._fromParams({providerId:_g.PROVIDER_ID,signInMethod:_g.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _g.credentialFromTaggedObject(e)}static credentialFromError(e){return _g.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _g.credential(e.oauthAccessToken)}catch{return null}}}_g.FACEBOOK_SIGN_IN_METHOD="facebook.com";_g.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg extends GR{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return py._fromParams({providerId:yg.PROVIDER_ID,signInMethod:yg.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return yg.credentialFromTaggedObject(e)}static credentialFromError(e){return yg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:o}=e;if(!r&&!o)return null;try{return yg.credential(r,o)}catch{return null}}}yg.GOOGLE_SIGN_IN_METHOD="google.com";yg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg extends GR{constructor(){super("github.com")}static credential(e){return py._fromParams({providerId:Eg.PROVIDER_ID,signInMethod:Eg.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Eg.credentialFromTaggedObject(e)}static credentialFromError(e){return Eg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Eg.credential(e.oauthAccessToken)}catch{return null}}}Eg.GITHUB_SIGN_IN_METHOD="github.com";Eg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg extends GR{constructor(){super("twitter.com")}static credential(e,r){return py._fromParams({providerId:Sg.PROVIDER_ID,signInMethod:Sg.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}static credentialFromResult(e){return Sg.credentialFromTaggedObject(e)}static credentialFromError(e){return Sg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:r,oauthTokenSecret:o}=e;if(!r||!o)return null;try{return Sg.credential(r,o)}catch{return null}}}Sg.TWITTER_SIGN_IN_METHOD="twitter.com";Sg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M6e(t,e){return zR(t,"POST","/v1/accounts:signUp",Qg(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,o,a=!1){const u=await xp._fromIdTokenResponse(e,o,a),d=KQ(o);return new my({user:u,providerId:d,_tokenResponse:o,operationType:r})}static async _forOperation(e,r,o){await e._updateTokensIfNecessary(o,!0);const a=KQ(o);return new my({user:e,providerId:a,_tokenResponse:o,operationType:r})}}function KQ(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KN extends xf{constructor(e,r,o,a){var u;super(r.code,r.message),this.operationType=o,this.user=a,Object.setPrototypeOf(this,KN.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:r.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,r,o,a){return new KN(e,r,o,a)}}function Qoe(t,e,r,o){return(e==="reauthenticate"?r._getReauthenticationResolver(t):r._getIdTokenResponse(t)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?KN._fromErrorAndOperation(t,u,e,o):u})}async function U6e(t,e,r=!1){const o=await oR(t,e._linkToIdToken(t.auth,await t.getIdToken()),r);return my._forOperation(t,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V6e(t,e,r=!1){const{auth:o}=t;if(lf(o.app))return Promise.reject(zp(o));const a="reauthenticate";try{const u=await oR(t,Qoe(o,a,e,t),r);or(u.idToken,o,"internal-error");const d=K4(u.idToken);or(d,o,"internal-error");const{sub:f}=d;return or(t.uid===f,o,"user-mismatch"),my._forOperation(t,a,u)}catch(u){throw(u==null?void 0:u.code)==="auth/user-not-found"&&fh(o,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zoe(t,e,r=!1){if(lf(t.app))return Promise.reject(zp(t));const o="signIn",a=await Qoe(t,o,e),u=await my._fromIdTokenResponse(t,o,a);return r||await t._updateCurrentUser(u.user),u}async function F6e(t,e){return Zoe(Ry(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eae(t){const e=Ry(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function j6e(t,e,r){if(lf(t.app))return Promise.reject(zp(t));const o=Ry(t),d=await ZF(o,{returnSecureToken:!0,email:e,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",M6e).catch(g=>{throw g.code==="auth/password-does-not-meet-requirements"&&eae(t),g}),f=await my._fromIdTokenResponse(o,"signIn",d);return await o._updateCurrentUser(f.user),f}function B6e(t,e,r){return lf(t.app)?Promise.reject(zp(t)):F6e(Qo(t),QT.credential(e,r)).catch(async o=>{throw o.code==="auth/password-does-not-meet-requirements"&&eae(t),o})}function W6e(t,e,r,o){return Qo(t).onIdTokenChanged(e,r,o)}function z6e(t,e,r){return Qo(t).beforeAuthStateChanged(e,r)}function G6e(t,e,r,o){return Qo(t).onAuthStateChanged(e,r,o)}function H6e(t){return Qo(t).signOut()}const qN="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tae{constructor(e,r){this.storageRetriever=e,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(qN,"1"),this.storage.removeItem(qN),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,r){return this.storage.setItem(e,JSON.stringify(r)),Promise.resolve()}_get(e){const r=this.storage.getItem(e);return Promise.resolve(r?JSON.parse(r):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K6e=1e3,q6e=10;class nae extends tae{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=qoe(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){const o=this.storage.getItem(r),a=this.localCache[r];o!==a&&e(r,a,o)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((d,f,g)=>{this.notifyListeners(d,g)});return}const o=e.key;r?this.detachListener():this.stopPolling();const a=()=>{const d=this.storage.getItem(o);!r&&this.localCache[o]===d||this.notifyListeners(o,d)},u=this.storage.getItem(o);d6e()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,q6e):a()}notifyListeners(e,r){this.localCache[e]=r;const o=this.listeners[e];if(o)for(const a of Array.from(o))a(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:o}),!0)})},K6e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,r){await super._set(e,r),this.localCache[e]=JSON.stringify(r)}async _get(e){const r=await super._get(e);return this.localCache[e]=JSON.stringify(r),r}async _remove(e){await super._remove(e),delete this.localCache[e]}}nae.type="LOCAL";const $6e=nae;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rae extends tae{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}rae.type="SESSION";const iae=rae;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y6e(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eD{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(a=>a.isListeningto(e));if(r)return r;const o=new eD(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:o,eventType:a,data:u}=r.data,d=this.handlersMap[a];if(!(d!=null&&d.size))return;r.ports[0].postMessage({status:"ack",eventId:o,eventType:a});const f=Array.from(d).map(async E=>E(r.origin,u)),g=await Y6e(f);r.ports[0].postMessage({status:"done",eventId:o,eventType:a,response:g})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}eD.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X4(t="",e=10){let r="";for(let o=0;o<e;o++)r+=Math.floor(Math.random()*10);return t+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X6e{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,o=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let u,d;return new Promise((f,g)=>{const E=X4("",20);a.port1.start();const T=setTimeout(()=>{g(new Error("unsupported_event"))},o);d={messageChannel:a,onMessage(C){const I=C;if(I.data.eventId===E)switch(I.data.status){case"ack":clearTimeout(T),u=setTimeout(()=>{g(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),f(I.data.response);break;default:clearTimeout(T),clearTimeout(u),g(new Error("invalid_response"));break}}},this.handlers.add(d),a.port1.addEventListener("message",d.onMessage),this.target.postMessage({eventType:e,eventId:E,data:r},[a.port2])}).finally(()=>{d&&this.removeMessageHandler(d)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yf(){return window}function J6e(t){yf().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sae(){return typeof yf().WorkerGlobalScope<"u"&&typeof yf().importScripts=="function"}async function Q6e(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Z6e(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function eWe(){return sae()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oae="firebaseLocalStorageDb",tWe=1,$N="firebaseLocalStorage",aae="fbase_key";class HR{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function tD(t,e){return t.transaction([$N],e?"readwrite":"readonly").objectStore($N)}function nWe(){const t=indexedDB.deleteDatabase(oae);return new HR(t).toPromise()}function ej(){const t=indexedDB.open(oae,tWe);return new Promise((e,r)=>{t.addEventListener("error",()=>{r(t.error)}),t.addEventListener("upgradeneeded",()=>{const o=t.result;try{o.createObjectStore($N,{keyPath:aae})}catch(a){r(a)}}),t.addEventListener("success",async()=>{const o=t.result;o.objectStoreNames.contains($N)?e(o):(o.close(),await nWe(),e(await ej()))})})}async function qQ(t,e,r){const o=tD(t,!0).put({[aae]:e,value:r});return new HR(o).toPromise()}async function rWe(t,e){const r=tD(t,!1).get(e),o=await new HR(r).toPromise();return o===void 0?null:o.value}function $Q(t,e){const r=tD(t,!0).delete(e);return new HR(r).toPromise()}const iWe=800,sWe=3;class cae{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ej(),this.db)}async _withRetries(e){let r=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(r++>sWe)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return sae()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=eD._getInstance(eWe()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await Q6e(),!this.activeServiceWorker)return;this.sender=new X6e(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((r=o[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Z6e()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ej();return await qQ(e,qN,"1"),await $Q(e,qN),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(o=>qQ(o,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(o=>rWe(o,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>$Q(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const u=tD(a,!1).getAll();return new HR(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],o=new Set;if(e.length!==0)for(const{fbase_key:a,value:u}of e)o.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(u)&&(this.notifyListeners(a,u),r.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!o.has(a)&&(this.notifyListeners(a,null),r.push(a));return r}notifyListeners(e,r){this.localCache[e]=r;const o=this.listeners[e];if(o)for(const a of Array.from(o))a(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),iWe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}cae.type="LOCAL";const oWe=cae;new WR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aWe(t,e){return e?Mp(e):(or(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4 extends $4{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return vT(e,this._buildIdpRequest())}_linkToIdToken(e,r){return vT(e,this._buildIdpRequest(r))}_getReauthenticationResolver(e){return vT(e,this._buildIdpRequest())}_buildIdpRequest(e){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}function cWe(t){return Zoe(t.auth,new J4(t),t.bypassAuthState)}function uWe(t){const{auth:e,user:r}=t;return or(r,e,"internal-error"),V6e(r,new J4(t),t.bypassAuthState)}async function lWe(t){const{auth:e,user:r}=t;return or(r,e,"internal-error"),U6e(r,new J4(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uae{constructor(e,r,o,a,u=!1){this.auth=e,this.resolver=o,this.user=a,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(e,r)=>{this.pendingPromise={resolve:e,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:r,sessionId:o,postBody:a,tenantId:u,error:d,type:f}=e;if(d){this.reject(d);return}const g={auth:this.auth,requestUri:r,sessionId:o,tenantId:u||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(f)(g))}catch(E){this.reject(E)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cWe;case"linkViaPopup":case"linkViaRedirect":return lWe;case"reauthViaPopup":case"reauthViaRedirect":return uWe;default:fh(this.auth,"internal-error")}}resolve(e){Yp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Yp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dWe=new WR(2e3,1e4);class nT extends uae{constructor(e,r,o,a,u){super(e,r,a,u),this.provider=o,this.authWindow=null,this.pollId=null,nT.currentPopupAction&&nT.currentPopupAction.cancel(),nT.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return or(e,this.auth,"internal-error"),e}async onExecution(){Yp(this.filter.length===1,"Popup operations only handle one event");const e=X4();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(_f(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(_f(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,nT.currentPopupAction=null}pollUserCancellation(){const e=()=>{var r,o;if(!((o=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_f(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,dWe.get())};e()}}nT.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hWe="pendingRedirect",cN=new Map;class fWe extends uae{constructor(e,r,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,o),this.eventId=null}async execute(){let e=cN.get(this.auth._key());if(!e){try{const o=await pWe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(r){e=()=>Promise.reject(r)}cN.set(this.auth._key(),e)}return this.bypassAuthState||cN.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const r=await this.auth._redirectUserForId(e.eventId);if(r)return this.user=r,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function pWe(t,e){const r=vWe(e),o=gWe(t);if(!await o._isAvailable())return!1;const a=await o._get(r)==="true";return await o._remove(r),a}function mWe(t,e){cN.set(t._key(),e)}function gWe(t){return Mp(t._redirectPersistence)}function vWe(t){return aN(hWe,t.config.apiKey,t.name)}async function _We(t,e,r=!1){if(lf(t.app))return Promise.reject(zp(t));const o=Ry(t),a=aWe(o,e),d=await new fWe(o,a,r).execute();return d&&!r&&(delete d.user._redirectEventId,await o._persistUserIfCurrent(d.user),await o._setRedirectUser(null,e)),d}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yWe=10*60*1e3;class EWe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let r=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(r=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!SWe(e)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=e,r=!0)),r}sendToConsumer(e,r){var o;if(e.error&&!lae(e)){const a=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";r.onError(_f(this.auth,a))}else r.onAuthEvent(e)}isEventForConsumer(e,r){const o=r.eventId===null||!!e.eventId&&e.eventId===r.eventId;return r.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=yWe&&this.cachedEventUids.clear(),this.cachedEventUids.has(YQ(e))}saveEventToCache(e){this.cachedEventUids.add(YQ(e)),this.lastProcessedEventTime=Date.now()}}function YQ(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function lae({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function SWe(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lae(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TWe(t,e={}){return Zg(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bWe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,wWe=/^https?/;async function CWe(t){if(t.config.emulator)return;const{authorizedDomains:e}=await TWe(t);for(const r of e)try{if(RWe(r))return}catch{}fh(t,"unauthorized-domain")}function RWe(t){const e=JF(),{protocol:r,hostname:o}=new URL(e);if(t.startsWith("chrome-extension://")){const d=new URL(t);return d.hostname===""&&o===""?r==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):r==="chrome-extension:"&&d.hostname===o}if(!wWe.test(r))return!1;if(bWe.test(t))return o===t;const a=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IWe=new WR(3e4,6e4);function XQ(){const t=yf().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let r=0;r<t.CP.length;r++)t.CP[r]=null}}function AWe(t){return new Promise((e,r)=>{var o,a,u;function d(){XQ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{XQ(),r(_f(t,"network-request-failed"))},timeout:IWe.get()})}if(!((a=(o=yf().gapi)===null||o===void 0?void 0:o.iframes)===null||a===void 0)&&a.Iframe)e(gapi.iframes.getContext());else if(!((u=yf().gapi)===null||u===void 0)&&u.load)d();else{const f=E6e("iframefcb");return yf()[f]=()=>{gapi.load?d():r(_f(t,"network-request-failed"))},Yoe(`${y6e()}?onload=${f}`).catch(g=>r(g))}}).catch(e=>{throw uN=null,e})}let uN=null;function kWe(t){return uN=uN||AWe(t),uN}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OWe=new WR(5e3,15e3),PWe="__/auth/iframe",NWe="emulator/auth/iframe",DWe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},LWe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function xWe(t){const e=t.config;or(e.authDomain,t,"auth-domain-config-required");const r=e.emulator?H4(e,NWe):`https://${t.config.authDomain}/${PWe}`,o={apiKey:e.apiKey,appName:t.name,v:Cy},a=LWe.get(t.config.apiHost);a&&(o.eid=a);const u=t._getFrameworks();return u.length&&(o.fw=u.join(",")),`${r}?${BR(o).slice(1)}`}async function MWe(t){const e=await kWe(t),r=yf().gapi;return or(r,t,"internal-error"),e.open({where:document.body,url:xWe(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:DWe,dontclear:!0},o=>new Promise(async(a,u)=>{await o.restyle({setHideOnLeave:!1});const d=_f(t,"network-request-failed"),f=yf().setTimeout(()=>{u(d)},OWe.get());function g(){yf().clearTimeout(f),a(o)}o.ping(g).then(g,()=>{u(d)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UWe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},VWe=500,FWe=600,jWe="_blank",BWe="http://localhost";class JQ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function WWe(t,e,r,o=VWe,a=FWe){const u=Math.max((window.screen.availHeight-a)/2,0).toString(),d=Math.max((window.screen.availWidth-o)/2,0).toString();let f="";const g=Object.assign(Object.assign({},UWe),{width:o.toString(),height:a.toString(),top:u,left:d}),E=qc().toLowerCase();r&&(f=Woe(E)?jWe:r),joe(E)&&(e=e||BWe,g.scrollbars="yes");const T=Object.entries(g).reduce((I,[D,L])=>`${I}${D}=${L},`,"");if(l6e(E)&&f!=="_self")return zWe(e||"",f),new JQ(null);const C=window.open(e||"",f,T);or(C,t,"popup-blocked");try{C.focus()}catch{}return new JQ(C)}function zWe(t,e){const r=document.createElement("a");r.href=t,r.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GWe="__/auth/handler",HWe="emulator/auth/handler",KWe=encodeURIComponent("fac");async function QQ(t,e,r,o,a,u){or(t.config.authDomain,t,"auth-domain-config-required"),or(t.config.apiKey,t,"invalid-api-key");const d={apiKey:t.config.apiKey,appName:t.name,authType:r,redirectUrl:o,v:Cy,eventId:a};if(e instanceof Joe){e.setDefaultLanguage(t.languageCode),d.providerId=e.providerId||"",L4e(e.getCustomParameters())||(d.customParameters=JSON.stringify(e.getCustomParameters()));for(const[T,C]of Object.entries({}))d[T]=C}if(e instanceof GR){const T=e.getScopes().filter(C=>C!=="");T.length>0&&(d.scopes=T.join(","))}t.tenantId&&(d.tid=t.tenantId);const f=d;for(const T of Object.keys(f))f[T]===void 0&&delete f[T];const g=await t._getAppCheckToken(),E=g?`#${KWe}=${encodeURIComponent(g)}`:"";return`${qWe(t)}?${BR(f).slice(1)}${E}`}function qWe({config:t}){return t.emulator?H4(t,HWe):`https://${t.authDomain}/${GWe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _2="webStorageSupport";class $We{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=iae,this._completeRedirectFn=_We,this._overrideRedirectResult=mWe}async _openPopup(e,r,o,a){var u;Yp((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const d=await QQ(e,r,o,JF(),a);return WWe(e,d,X4())}async _openRedirect(e,r,o,a){await this._originValidation(e);const u=await QQ(e,r,o,JF(),a);return J6e(u),new Promise(()=>{})}_initialize(e){const r=e._key();if(this.eventManagers[r]){const{manager:a,promise:u}=this.eventManagers[r];return a?Promise.resolve(a):(Yp(u,"If manager is not set, promise should be"),u)}const o=this.initAndGetManager(e);return this.eventManagers[r]={promise:o},o.catch(()=>{delete this.eventManagers[r]}),o}async initAndGetManager(e){const r=await MWe(e),o=new EWe(e);return r.register("authEvent",a=>(or(a==null?void 0:a.authEvent,e,"invalid-auth-event"),{status:o.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=r,o}_isIframeWebStorageSupported(e,r){this.iframes[e._key()].send(_2,{type:_2},a=>{var u;const d=(u=a==null?void 0:a[0])===null||u===void 0?void 0:u[_2];d!==void 0&&r(!!d),fh(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const r=e._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=CWe(e)),this.originValidationPromises[r]}get _shouldInitProactively(){return qoe()||Boe()||q4()}}const YWe=$We;var ZQ="@firebase/auth",eZ="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XWe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);r&&(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){or(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JWe(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function QWe(t){fy(new jg("auth",(e,{options:r})=>{const o=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:d,authDomain:f}=o.options;or(d&&!d.includes(":"),"invalid-api-key",{appName:o.name});const g={apiKey:d,authDomain:f,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:$oe(t)},E=new g6e(o,a,u,g);return C6e(E,r),E},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,o)=>{e.getProvider("auth-internal").initialize()})),fy(new jg("auth-internal",e=>{const r=Ry(e.getProvider("auth").getImmediate());return(o=>new XWe(o))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),vf(ZQ,eZ,JWe(t)),vf(ZQ,eZ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZWe=5*60,eze=woe("authIdTokenMaxAge")||ZWe;let tZ=null;const tze=t=>async e=>{const r=e&&await e.getIdTokenResult(),o=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(o&&o>eze)return;const a=r==null?void 0:r.token;tZ!==a&&(tZ=a,await fetch(t,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function dae(t=z4()){const e=Q1(t,"auth");if(e.isInitialized())return e.getImmediate();const r=w6e(t,{popupRedirectResolver:YWe,persistence:[oWe,$6e,iae]}),o=woe("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(o,location.origin);if(location.origin===u.origin){const d=tze(u.toString());z6e(r,d,()=>d(r.currentUser)),W6e(r,f=>d(f))}}const a=Soe("auth");return a&&R6e(r,`http://${a}`),r}function nze(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}v6e({loadJS(t){return new Promise((e,r)=>{const o=document.createElement("script");o.setAttribute("src",t),o.onload=e,o.onerror=a=>{const u=_f("internal-error");u.customData=a,r(u)},o.type="text/javascript",o.charset="UTF-8",nze().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});QWe("Browser");var nZ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ey,hae;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(j,K){function Q(){}Q.prototype=K.prototype,j.D=K.prototype,j.prototype=new Q,j.prototype.constructor=j,j.C=function(ce,Ee,_e){for(var pe=Array(arguments.length-2),qe=2;qe<arguments.length;qe++)pe[qe-2]=arguments[qe];return K.prototype[Ee].apply(ce,pe)}}function r(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,r),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(j,K,Q){Q||(Q=0);var ce=Array(16);if(typeof K=="string")for(var Ee=0;16>Ee;++Ee)ce[Ee]=K.charCodeAt(Q++)|K.charCodeAt(Q++)<<8|K.charCodeAt(Q++)<<16|K.charCodeAt(Q++)<<24;else for(Ee=0;16>Ee;++Ee)ce[Ee]=K[Q++]|K[Q++]<<8|K[Q++]<<16|K[Q++]<<24;K=j.g[0],Q=j.g[1],Ee=j.g[2];var _e=j.g[3],pe=K+(_e^Q&(Ee^_e))+ce[0]+3614090360&4294967295;K=Q+(pe<<7&4294967295|pe>>>25),pe=_e+(Ee^K&(Q^Ee))+ce[1]+3905402710&4294967295,_e=K+(pe<<12&4294967295|pe>>>20),pe=Ee+(Q^_e&(K^Q))+ce[2]+606105819&4294967295,Ee=_e+(pe<<17&4294967295|pe>>>15),pe=Q+(K^Ee&(_e^K))+ce[3]+3250441966&4294967295,Q=Ee+(pe<<22&4294967295|pe>>>10),pe=K+(_e^Q&(Ee^_e))+ce[4]+4118548399&4294967295,K=Q+(pe<<7&4294967295|pe>>>25),pe=_e+(Ee^K&(Q^Ee))+ce[5]+1200080426&4294967295,_e=K+(pe<<12&4294967295|pe>>>20),pe=Ee+(Q^_e&(K^Q))+ce[6]+2821735955&4294967295,Ee=_e+(pe<<17&4294967295|pe>>>15),pe=Q+(K^Ee&(_e^K))+ce[7]+4249261313&4294967295,Q=Ee+(pe<<22&4294967295|pe>>>10),pe=K+(_e^Q&(Ee^_e))+ce[8]+1770035416&4294967295,K=Q+(pe<<7&4294967295|pe>>>25),pe=_e+(Ee^K&(Q^Ee))+ce[9]+2336552879&4294967295,_e=K+(pe<<12&4294967295|pe>>>20),pe=Ee+(Q^_e&(K^Q))+ce[10]+4294925233&4294967295,Ee=_e+(pe<<17&4294967295|pe>>>15),pe=Q+(K^Ee&(_e^K))+ce[11]+2304563134&4294967295,Q=Ee+(pe<<22&4294967295|pe>>>10),pe=K+(_e^Q&(Ee^_e))+ce[12]+1804603682&4294967295,K=Q+(pe<<7&4294967295|pe>>>25),pe=_e+(Ee^K&(Q^Ee))+ce[13]+4254626195&4294967295,_e=K+(pe<<12&4294967295|pe>>>20),pe=Ee+(Q^_e&(K^Q))+ce[14]+2792965006&4294967295,Ee=_e+(pe<<17&4294967295|pe>>>15),pe=Q+(K^Ee&(_e^K))+ce[15]+1236535329&4294967295,Q=Ee+(pe<<22&4294967295|pe>>>10),pe=K+(Ee^_e&(Q^Ee))+ce[1]+4129170786&4294967295,K=Q+(pe<<5&4294967295|pe>>>27),pe=_e+(Q^Ee&(K^Q))+ce[6]+3225465664&4294967295,_e=K+(pe<<9&4294967295|pe>>>23),pe=Ee+(K^Q&(_e^K))+ce[11]+643717713&4294967295,Ee=_e+(pe<<14&4294967295|pe>>>18),pe=Q+(_e^K&(Ee^_e))+ce[0]+3921069994&4294967295,Q=Ee+(pe<<20&4294967295|pe>>>12),pe=K+(Ee^_e&(Q^Ee))+ce[5]+3593408605&4294967295,K=Q+(pe<<5&4294967295|pe>>>27),pe=_e+(Q^Ee&(K^Q))+ce[10]+38016083&4294967295,_e=K+(pe<<9&4294967295|pe>>>23),pe=Ee+(K^Q&(_e^K))+ce[15]+3634488961&4294967295,Ee=_e+(pe<<14&4294967295|pe>>>18),pe=Q+(_e^K&(Ee^_e))+ce[4]+3889429448&4294967295,Q=Ee+(pe<<20&4294967295|pe>>>12),pe=K+(Ee^_e&(Q^Ee))+ce[9]+568446438&4294967295,K=Q+(pe<<5&4294967295|pe>>>27),pe=_e+(Q^Ee&(K^Q))+ce[14]+3275163606&4294967295,_e=K+(pe<<9&4294967295|pe>>>23),pe=Ee+(K^Q&(_e^K))+ce[3]+4107603335&4294967295,Ee=_e+(pe<<14&4294967295|pe>>>18),pe=Q+(_e^K&(Ee^_e))+ce[8]+1163531501&4294967295,Q=Ee+(pe<<20&4294967295|pe>>>12),pe=K+(Ee^_e&(Q^Ee))+ce[13]+2850285829&4294967295,K=Q+(pe<<5&4294967295|pe>>>27),pe=_e+(Q^Ee&(K^Q))+ce[2]+4243563512&4294967295,_e=K+(pe<<9&4294967295|pe>>>23),pe=Ee+(K^Q&(_e^K))+ce[7]+1735328473&4294967295,Ee=_e+(pe<<14&4294967295|pe>>>18),pe=Q+(_e^K&(Ee^_e))+ce[12]+2368359562&4294967295,Q=Ee+(pe<<20&4294967295|pe>>>12),pe=K+(Q^Ee^_e)+ce[5]+4294588738&4294967295,K=Q+(pe<<4&4294967295|pe>>>28),pe=_e+(K^Q^Ee)+ce[8]+2272392833&4294967295,_e=K+(pe<<11&4294967295|pe>>>21),pe=Ee+(_e^K^Q)+ce[11]+1839030562&4294967295,Ee=_e+(pe<<16&4294967295|pe>>>16),pe=Q+(Ee^_e^K)+ce[14]+4259657740&4294967295,Q=Ee+(pe<<23&4294967295|pe>>>9),pe=K+(Q^Ee^_e)+ce[1]+2763975236&4294967295,K=Q+(pe<<4&4294967295|pe>>>28),pe=_e+(K^Q^Ee)+ce[4]+1272893353&4294967295,_e=K+(pe<<11&4294967295|pe>>>21),pe=Ee+(_e^K^Q)+ce[7]+4139469664&4294967295,Ee=_e+(pe<<16&4294967295|pe>>>16),pe=Q+(Ee^_e^K)+ce[10]+3200236656&4294967295,Q=Ee+(pe<<23&4294967295|pe>>>9),pe=K+(Q^Ee^_e)+ce[13]+681279174&4294967295,K=Q+(pe<<4&4294967295|pe>>>28),pe=_e+(K^Q^Ee)+ce[0]+3936430074&4294967295,_e=K+(pe<<11&4294967295|pe>>>21),pe=Ee+(_e^K^Q)+ce[3]+3572445317&4294967295,Ee=_e+(pe<<16&4294967295|pe>>>16),pe=Q+(Ee^_e^K)+ce[6]+76029189&4294967295,Q=Ee+(pe<<23&4294967295|pe>>>9),pe=K+(Q^Ee^_e)+ce[9]+3654602809&4294967295,K=Q+(pe<<4&4294967295|pe>>>28),pe=_e+(K^Q^Ee)+ce[12]+3873151461&4294967295,_e=K+(pe<<11&4294967295|pe>>>21),pe=Ee+(_e^K^Q)+ce[15]+530742520&4294967295,Ee=_e+(pe<<16&4294967295|pe>>>16),pe=Q+(Ee^_e^K)+ce[2]+3299628645&4294967295,Q=Ee+(pe<<23&4294967295|pe>>>9),pe=K+(Ee^(Q|~_e))+ce[0]+4096336452&4294967295,K=Q+(pe<<6&4294967295|pe>>>26),pe=_e+(Q^(K|~Ee))+ce[7]+1126891415&4294967295,_e=K+(pe<<10&4294967295|pe>>>22),pe=Ee+(K^(_e|~Q))+ce[14]+2878612391&4294967295,Ee=_e+(pe<<15&4294967295|pe>>>17),pe=Q+(_e^(Ee|~K))+ce[5]+4237533241&4294967295,Q=Ee+(pe<<21&4294967295|pe>>>11),pe=K+(Ee^(Q|~_e))+ce[12]+1700485571&4294967295,K=Q+(pe<<6&4294967295|pe>>>26),pe=_e+(Q^(K|~Ee))+ce[3]+2399980690&4294967295,_e=K+(pe<<10&4294967295|pe>>>22),pe=Ee+(K^(_e|~Q))+ce[10]+4293915773&4294967295,Ee=_e+(pe<<15&4294967295|pe>>>17),pe=Q+(_e^(Ee|~K))+ce[1]+2240044497&4294967295,Q=Ee+(pe<<21&4294967295|pe>>>11),pe=K+(Ee^(Q|~_e))+ce[8]+1873313359&4294967295,K=Q+(pe<<6&4294967295|pe>>>26),pe=_e+(Q^(K|~Ee))+ce[15]+4264355552&4294967295,_e=K+(pe<<10&4294967295|pe>>>22),pe=Ee+(K^(_e|~Q))+ce[6]+2734768916&4294967295,Ee=_e+(pe<<15&4294967295|pe>>>17),pe=Q+(_e^(Ee|~K))+ce[13]+1309151649&4294967295,Q=Ee+(pe<<21&4294967295|pe>>>11),pe=K+(Ee^(Q|~_e))+ce[4]+4149444226&4294967295,K=Q+(pe<<6&4294967295|pe>>>26),pe=_e+(Q^(K|~Ee))+ce[11]+3174756917&4294967295,_e=K+(pe<<10&4294967295|pe>>>22),pe=Ee+(K^(_e|~Q))+ce[2]+718787259&4294967295,Ee=_e+(pe<<15&4294967295|pe>>>17),pe=Q+(_e^(Ee|~K))+ce[9]+3951481745&4294967295,j.g[0]=j.g[0]+K&4294967295,j.g[1]=j.g[1]+(Ee+(pe<<21&4294967295|pe>>>11))&4294967295,j.g[2]=j.g[2]+Ee&4294967295,j.g[3]=j.g[3]+_e&4294967295}o.prototype.u=function(j,K){K===void 0&&(K=j.length);for(var Q=K-this.blockSize,ce=this.B,Ee=this.h,_e=0;_e<K;){if(Ee==0)for(;_e<=Q;)a(this,j,_e),_e+=this.blockSize;if(typeof j=="string"){for(;_e<K;)if(ce[Ee++]=j.charCodeAt(_e++),Ee==this.blockSize){a(this,ce),Ee=0;break}}else for(;_e<K;)if(ce[Ee++]=j[_e++],Ee==this.blockSize){a(this,ce),Ee=0;break}}this.h=Ee,this.o+=K},o.prototype.v=function(){var j=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);j[0]=128;for(var K=1;K<j.length-8;++K)j[K]=0;var Q=8*this.o;for(K=j.length-8;K<j.length;++K)j[K]=Q&255,Q/=256;for(this.u(j),j=Array(16),K=Q=0;4>K;++K)for(var ce=0;32>ce;ce+=8)j[Q++]=this.g[K]>>>ce&255;return j};function u(j,K){var Q=f;return Object.prototype.hasOwnProperty.call(Q,j)?Q[j]:Q[j]=K(j)}function d(j,K){this.h=K;for(var Q=[],ce=!0,Ee=j.length-1;0<=Ee;Ee--){var _e=j[Ee]|0;ce&&_e==K||(Q[Ee]=_e,ce=!1)}this.g=Q}var f={};function g(j){return-128<=j&&128>j?u(j,function(K){return new d([K|0],0>K?-1:0)}):new d([j|0],0>j?-1:0)}function E(j){if(isNaN(j)||!isFinite(j))return C;if(0>j)return G(E(-j));for(var K=[],Q=1,ce=0;j>=Q;ce++)K[ce]=j/Q|0,Q*=4294967296;return new d(K,0)}function T(j,K){if(j.length==0)throw Error("number format error: empty string");if(K=K||10,2>K||36<K)throw Error("radix out of range: "+K);if(j.charAt(0)=="-")return G(T(j.substring(1),K));if(0<=j.indexOf("-"))throw Error('number format error: interior "-" character');for(var Q=E(Math.pow(K,8)),ce=C,Ee=0;Ee<j.length;Ee+=8){var _e=Math.min(8,j.length-Ee),pe=parseInt(j.substring(Ee,Ee+_e),K);8>_e?(_e=E(Math.pow(K,_e)),ce=ce.j(_e).add(E(pe))):(ce=ce.j(Q),ce=ce.add(E(pe)))}return ce}var C=g(0),I=g(1),D=g(16777216);t=d.prototype,t.m=function(){if(B(this))return-G(this).m();for(var j=0,K=1,Q=0;Q<this.g.length;Q++){var ce=this.i(Q);j+=(0<=ce?ce:4294967296+ce)*K,K*=4294967296}return j},t.toString=function(j){if(j=j||10,2>j||36<j)throw Error("radix out of range: "+j);if(L(this))return"0";if(B(this))return"-"+G(this).toString(j);for(var K=E(Math.pow(j,6)),Q=this,ce="";;){var Ee=F(Q,K).g;Q=se(Q,Ee.j(K));var _e=((0<Q.g.length?Q.g[0]:Q.h)>>>0).toString(j);if(Q=Ee,L(Q))return _e+ce;for(;6>_e.length;)_e="0"+_e;ce=_e+ce}},t.i=function(j){return 0>j?0:j<this.g.length?this.g[j]:this.h};function L(j){if(j.h!=0)return!1;for(var K=0;K<j.g.length;K++)if(j.g[K]!=0)return!1;return!0}function B(j){return j.h==-1}t.l=function(j){return j=se(this,j),B(j)?-1:L(j)?0:1};function G(j){for(var K=j.g.length,Q=[],ce=0;ce<K;ce++)Q[ce]=~j.g[ce];return new d(Q,~j.h).add(I)}t.abs=function(){return B(this)?G(this):this},t.add=function(j){for(var K=Math.max(this.g.length,j.g.length),Q=[],ce=0,Ee=0;Ee<=K;Ee++){var _e=ce+(this.i(Ee)&65535)+(j.i(Ee)&65535),pe=(_e>>>16)+(this.i(Ee)>>>16)+(j.i(Ee)>>>16);ce=pe>>>16,_e&=65535,pe&=65535,Q[Ee]=pe<<16|_e}return new d(Q,Q[Q.length-1]&-2147483648?-1:0)};function se(j,K){return j.add(G(K))}t.j=function(j){if(L(this)||L(j))return C;if(B(this))return B(j)?G(this).j(G(j)):G(G(this).j(j));if(B(j))return G(this.j(G(j)));if(0>this.l(D)&&0>j.l(D))return E(this.m()*j.m());for(var K=this.g.length+j.g.length,Q=[],ce=0;ce<2*K;ce++)Q[ce]=0;for(ce=0;ce<this.g.length;ce++)for(var Ee=0;Ee<j.g.length;Ee++){var _e=this.i(ce)>>>16,pe=this.i(ce)&65535,qe=j.i(Ee)>>>16,St=j.i(Ee)&65535;Q[2*ce+2*Ee]+=pe*St,ae(Q,2*ce+2*Ee),Q[2*ce+2*Ee+1]+=_e*St,ae(Q,2*ce+2*Ee+1),Q[2*ce+2*Ee+1]+=pe*qe,ae(Q,2*ce+2*Ee+1),Q[2*ce+2*Ee+2]+=_e*qe,ae(Q,2*ce+2*Ee+2)}for(ce=0;ce<K;ce++)Q[ce]=Q[2*ce+1]<<16|Q[2*ce];for(ce=K;ce<2*K;ce++)Q[ce]=0;return new d(Q,0)};function ae(j,K){for(;(j[K]&65535)!=j[K];)j[K+1]+=j[K]>>>16,j[K]&=65535,K++}function M(j,K){this.g=j,this.h=K}function F(j,K){if(L(K))throw Error("division by zero");if(L(j))return new M(C,C);if(B(j))return K=F(G(j),K),new M(G(K.g),G(K.h));if(B(K))return K=F(j,G(K)),new M(G(K.g),K.h);if(30<j.g.length){if(B(j)||B(K))throw Error("slowDivide_ only works with positive integers.");for(var Q=I,ce=K;0>=ce.l(j);)Q=z(Q),ce=z(ce);var Ee=te(Q,1),_e=te(ce,1);for(ce=te(ce,2),Q=te(Q,2);!L(ce);){var pe=_e.add(ce);0>=pe.l(j)&&(Ee=Ee.add(Q),_e=pe),ce=te(ce,1),Q=te(Q,1)}return K=se(j,Ee.j(K)),new M(Ee,K)}for(Ee=C;0<=j.l(K);){for(Q=Math.max(1,Math.floor(j.m()/K.m())),ce=Math.ceil(Math.log(Q)/Math.LN2),ce=48>=ce?1:Math.pow(2,ce-48),_e=E(Q),pe=_e.j(K);B(pe)||0<pe.l(j);)Q-=ce,_e=E(Q),pe=_e.j(K);L(_e)&&(_e=I),Ee=Ee.add(_e),j=se(j,pe)}return new M(Ee,j)}t.A=function(j){return F(this,j).h},t.and=function(j){for(var K=Math.max(this.g.length,j.g.length),Q=[],ce=0;ce<K;ce++)Q[ce]=this.i(ce)&j.i(ce);return new d(Q,this.h&j.h)},t.or=function(j){for(var K=Math.max(this.g.length,j.g.length),Q=[],ce=0;ce<K;ce++)Q[ce]=this.i(ce)|j.i(ce);return new d(Q,this.h|j.h)},t.xor=function(j){for(var K=Math.max(this.g.length,j.g.length),Q=[],ce=0;ce<K;ce++)Q[ce]=this.i(ce)^j.i(ce);return new d(Q,this.h^j.h)};function z(j){for(var K=j.g.length+1,Q=[],ce=0;ce<K;ce++)Q[ce]=j.i(ce)<<1|j.i(ce-1)>>>31;return new d(Q,j.h)}function te(j,K){var Q=K>>5;K%=32;for(var ce=j.g.length-Q,Ee=[],_e=0;_e<ce;_e++)Ee[_e]=0<K?j.i(_e+Q)>>>K|j.i(_e+Q+1)<<32-K:j.i(_e+Q);return new d(Ee,j.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,hae=o,d.prototype.add=d.prototype.add,d.prototype.multiply=d.prototype.j,d.prototype.modulo=d.prototype.A,d.prototype.compare=d.prototype.l,d.prototype.toNumber=d.prototype.m,d.prototype.toString=d.prototype.toString,d.prototype.getBits=d.prototype.i,d.fromNumber=E,d.fromString=T,ey=d}).apply(typeof nZ<"u"?nZ:typeof self<"u"?self:typeof window<"u"?window:{});var wP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var fae,iC,pae,lN,tj,mae,gae,vae;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,q,oe){return A==Array.prototype||A==Object.prototype||(A[q]=oe.value),A};function r(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof wP=="object"&&wP];for(var q=0;q<A.length;++q){var oe=A[q];if(oe&&oe.Math==Math)return oe}throw Error("Cannot find global object")}var o=r(this);function a(A,q){if(q)e:{var oe=o;A=A.split(".");for(var ye=0;ye<A.length-1;ye++){var Je=A[ye];if(!(Je in oe))break e;oe=oe[Je]}A=A[A.length-1],ye=oe[A],q=q(ye),q!=ye&&q!=null&&e(oe,A,{configurable:!0,writable:!0,value:q})}}function u(A,q){A instanceof String&&(A+="");var oe=0,ye=!1,Je={next:function(){if(!ye&&oe<A.length){var ht=oe++;return{value:q(ht,A[ht]),done:!1}}return ye=!0,{done:!0,value:void 0}}};return Je[Symbol.iterator]=function(){return Je},Je}a("Array.prototype.values",function(A){return A||function(){return u(this,function(q,oe){return oe})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var d=d||{},f=this||self;function g(A){var q=typeof A;return q=q!="object"?q:A?Array.isArray(A)?"array":q:"null",q=="array"||q=="object"&&typeof A.length=="number"}function E(A){var q=typeof A;return q=="object"&&A!=null||q=="function"}function T(A,q,oe){return A.call.apply(A.bind,arguments)}function C(A,q,oe){if(!A)throw Error();if(2<arguments.length){var ye=Array.prototype.slice.call(arguments,2);return function(){var Je=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Je,ye),A.apply(q,Je)}}return function(){return A.apply(q,arguments)}}function I(A,q,oe){return I=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?T:C,I.apply(null,arguments)}function D(A,q){var oe=Array.prototype.slice.call(arguments,1);return function(){var ye=oe.slice();return ye.push.apply(ye,arguments),A.apply(this,ye)}}function L(A,q){function oe(){}oe.prototype=q.prototype,A.aa=q.prototype,A.prototype=new oe,A.prototype.constructor=A,A.Qb=function(ye,Je,ht){for(var Wt=Array(arguments.length-2),Ii=2;Ii<arguments.length;Ii++)Wt[Ii-2]=arguments[Ii];return q.prototype[Je].apply(ye,Wt)}}function B(A){const q=A.length;if(0<q){const oe=Array(q);for(let ye=0;ye<q;ye++)oe[ye]=A[ye];return oe}return[]}function G(A,q){for(let oe=1;oe<arguments.length;oe++){const ye=arguments[oe];if(g(ye)){const Je=A.length||0,ht=ye.length||0;A.length=Je+ht;for(let Wt=0;Wt<ht;Wt++)A[Je+Wt]=ye[Wt]}else A.push(ye)}}class se{constructor(q,oe){this.i=q,this.j=oe,this.h=0,this.g=null}get(){let q;return 0<this.h?(this.h--,q=this.g,this.g=q.next,q.next=null):q=this.i(),q}}function ae(A){return/^[\s\xa0]*$/.test(A)}function M(){var A=f.navigator;return A&&(A=A.userAgent)?A:""}function F(A){return F[" "](A),A}F[" "]=function(){};var z=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function te(A,q,oe){for(const ye in A)q.call(oe,A[ye],ye,A)}function j(A,q){for(const oe in A)q.call(void 0,A[oe],oe,A)}function K(A){const q={};for(const oe in A)q[oe]=A[oe];return q}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ce(A,q){let oe,ye;for(let Je=1;Je<arguments.length;Je++){ye=arguments[Je];for(oe in ye)A[oe]=ye[oe];for(let ht=0;ht<Q.length;ht++)oe=Q[ht],Object.prototype.hasOwnProperty.call(ye,oe)&&(A[oe]=ye[oe])}}function Ee(A){var q=1;A=A.split(":");const oe=[];for(;0<q&&A.length;)oe.push(A.shift()),q--;return A.length&&oe.push(A.join(":")),oe}function _e(A){f.setTimeout(()=>{throw A},0)}function pe(){var A=Ve;let q=null;return A.g&&(q=A.g,A.g=A.g.next,A.g||(A.h=null),q.next=null),q}class qe{constructor(){this.h=this.g=null}add(q,oe){const ye=St.get();ye.set(q,oe),this.h?this.h.next=ye:this.g=ye,this.h=ye}}var St=new se(()=>new ke,A=>A.reset());class ke{constructor(){this.next=this.g=this.h=null}set(q,oe){this.h=q,this.g=oe,this.next=null}reset(){this.next=this.g=this.h=null}}let Ne,Re=!1,Ve=new qe,ve=()=>{const A=f.Promise.resolve(void 0);Ne=()=>{A.then(Be)}};var Be=()=>{for(var A;A=pe();){try{A.h.call(A.g)}catch(oe){_e(oe)}var q=St;q.j(A),100>q.h&&(q.h++,A.next=q.g,q.g=A)}Re=!1};function gt(){this.s=this.s,this.C=this.C}gt.prototype.s=!1,gt.prototype.ma=function(){this.s||(this.s=!0,this.N())},gt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ze(A,q){this.type=A,this.g=this.target=q,this.defaultPrevented=!1}ze.prototype.h=function(){this.defaultPrevented=!0};var _t=function(){if(!f.addEventListener||!Object.defineProperty)return!1;var A=!1,q=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const oe=()=>{};f.addEventListener("test",oe,q),f.removeEventListener("test",oe,q)}catch{}return A}();function Dt(A,q){if(ze.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var oe=this.type=A.type,ye=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=q,q=A.relatedTarget){if(z){e:{try{F(q.nodeName);var Je=!0;break e}catch{}Je=!1}Je||(q=null)}}else oe=="mouseover"?q=A.fromElement:oe=="mouseout"&&(q=A.toElement);this.relatedTarget=q,ye?(this.clientX=ye.clientX!==void 0?ye.clientX:ye.pageX,this.clientY=ye.clientY!==void 0?ye.clientY:ye.pageY,this.screenX=ye.screenX||0,this.screenY=ye.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:jt[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&Dt.aa.h.call(this)}}L(Dt,ze);var jt={2:"touch",3:"pen",4:"mouse"};Dt.prototype.h=function(){Dt.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var Zt="closure_listenable_"+(1e6*Math.random()|0),Xt=0;function In(A,q,oe,ye,Je){this.listener=A,this.proxy=null,this.src=q,this.type=oe,this.capture=!!ye,this.ha=Je,this.key=++Xt,this.da=this.fa=!1}function Qt(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function Er(A){this.src=A,this.g={},this.h=0}Er.prototype.add=function(A,q,oe,ye,Je){var ht=A.toString();A=this.g[ht],A||(A=this.g[ht]=[],this.h++);var Wt=Vn(A,q,ye,Je);return-1<Wt?(q=A[Wt],oe||(q.fa=!1)):(q=new In(q,this.src,ht,!!ye,Je),q.fa=oe,A.push(q)),q};function Tn(A,q){var oe=q.type;if(oe in A.g){var ye=A.g[oe],Je=Array.prototype.indexOf.call(ye,q,void 0),ht;(ht=0<=Je)&&Array.prototype.splice.call(ye,Je,1),ht&&(Qt(q),A.g[oe].length==0&&(delete A.g[oe],A.h--))}}function Vn(A,q,oe,ye){for(var Je=0;Je<A.length;++Je){var ht=A[Je];if(!ht.da&&ht.listener==q&&ht.capture==!!oe&&ht.ha==ye)return Je}return-1}var wr="closure_lm_"+(1e6*Math.random()|0),Pt={};function wn(A,q,oe,ye,Je){if(Array.isArray(q)){for(var ht=0;ht<q.length;ht++)wn(A,q[ht],oe,ye,Je);return null}return oe=At(oe),A&&A[Zt]?A.K(q,oe,E(ye)?!!ye.capture:!1,Je):Dn(A,q,oe,!1,ye,Je)}function Dn(A,q,oe,ye,Je,ht){if(!q)throw Error("Invalid event type");var Wt=E(Je)?!!Je.capture:!!Je,Ii=Ke(A);if(Ii||(A[wr]=Ii=new Er(A)),oe=Ii.add(q,oe,ye,Wt,ht),oe.proxy)return oe;if(ye=Ae(),oe.proxy=ye,ye.src=A,ye.listener=oe,A.addEventListener)_t||(Je=Wt),Je===void 0&&(Je=!1),A.addEventListener(q.toString(),ye,Je);else if(A.attachEvent)A.attachEvent(at(q.toString()),ye);else if(A.addListener&&A.removeListener)A.addListener(ye);else throw Error("addEventListener and attachEvent are unavailable.");return oe}function Ae(){function A(oe){return q.call(A.src,A.listener,oe)}const q=ct;return A}function $e(A,q,oe,ye,Je){if(Array.isArray(q))for(var ht=0;ht<q.length;ht++)$e(A,q[ht],oe,ye,Je);else ye=E(ye)?!!ye.capture:!!ye,oe=At(oe),A&&A[Zt]?(A=A.i,q=String(q).toString(),q in A.g&&(ht=A.g[q],oe=Vn(ht,oe,ye,Je),-1<oe&&(Qt(ht[oe]),Array.prototype.splice.call(ht,oe,1),ht.length==0&&(delete A.g[q],A.h--)))):A&&(A=Ke(A))&&(q=A.g[q.toString()],A=-1,q&&(A=Vn(q,oe,ye,Je)),(oe=-1<A?q[A]:null)&&rt(oe))}function rt(A){if(typeof A!="number"&&A&&!A.da){var q=A.src;if(q&&q[Zt])Tn(q.i,A);else{var oe=A.type,ye=A.proxy;q.removeEventListener?q.removeEventListener(oe,ye,A.capture):q.detachEvent?q.detachEvent(at(oe),ye):q.addListener&&q.removeListener&&q.removeListener(ye),(oe=Ke(q))?(Tn(oe,A),oe.h==0&&(oe.src=null,q[wr]=null)):Qt(A)}}}function at(A){return A in Pt?Pt[A]:Pt[A]="on"+A}function ct(A,q){if(A.da)A=!0;else{q=new Dt(q,this);var oe=A.listener,ye=A.ha||A.src;A.fa&&rt(A),A=oe.call(ye,q)}return A}function Ke(A){return A=A[wr],A instanceof Er?A:null}var nt="__closure_events_fn_"+(1e9*Math.random()>>>0);function At(A){return typeof A=="function"?A:(A[nt]||(A[nt]=function(q){return A.handleEvent(q)}),A[nt])}function It(){gt.call(this),this.i=new Er(this),this.M=this,this.F=null}L(It,gt),It.prototype[Zt]=!0,It.prototype.removeEventListener=function(A,q,oe,ye){$e(this,A,q,oe,ye)};function Kt(A,q){var oe,ye=A.F;if(ye)for(oe=[];ye;ye=ye.F)oe.push(ye);if(A=A.M,ye=q.type||q,typeof q=="string")q=new ze(q,A);else if(q instanceof ze)q.target=q.target||A;else{var Je=q;q=new ze(ye,A),ce(q,Je)}if(Je=!0,oe)for(var ht=oe.length-1;0<=ht;ht--){var Wt=q.g=oe[ht];Je=Un(Wt,ye,!0,q)&&Je}if(Wt=q.g=A,Je=Un(Wt,ye,!0,q)&&Je,Je=Un(Wt,ye,!1,q)&&Je,oe)for(ht=0;ht<oe.length;ht++)Wt=q.g=oe[ht],Je=Un(Wt,ye,!1,q)&&Je}It.prototype.N=function(){if(It.aa.N.call(this),this.i){var A=this.i,q;for(q in A.g){for(var oe=A.g[q],ye=0;ye<oe.length;ye++)Qt(oe[ye]);delete A.g[q],A.h--}}this.F=null},It.prototype.K=function(A,q,oe,ye){return this.i.add(String(A),q,!1,oe,ye)},It.prototype.L=function(A,q,oe,ye){return this.i.add(String(A),q,!0,oe,ye)};function Un(A,q,oe,ye){if(q=A.i.g[String(q)],!q)return!0;q=q.concat();for(var Je=!0,ht=0;ht<q.length;++ht){var Wt=q[ht];if(Wt&&!Wt.da&&Wt.capture==oe){var Ii=Wt.listener,Ki=Wt.ha||Wt.src;Wt.fa&&Tn(A.i,Wt),Je=Ii.call(Ki,ye)!==!1&&Je}}return Je&&!ye.defaultPrevented}function Fn(A,q,oe){if(typeof A=="function")oe&&(A=I(A,oe));else if(A&&typeof A.handleEvent=="function")A=I(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(q)?-1:f.setTimeout(A,q||0)}function Yr(A){A.g=Fn(()=>{A.g=null,A.i&&(A.i=!1,Yr(A))},A.l);const q=A.h;A.h=null,A.m.apply(null,q)}class Ns extends gt{constructor(q,oe){super(),this.m=q,this.l=oe,this.h=null,this.i=!1,this.g=null}j(q){this.h=arguments,this.g?this.i=!0:Yr(this)}N(){super.N(),this.g&&(f.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $t(A){gt.call(this),this.h=A,this.g={}}L($t,gt);var Cn=[];function yo(A){te(A.g,function(q,oe){this.g.hasOwnProperty(oe)&&rt(q)},A),A.g={}}$t.prototype.N=function(){$t.aa.N.call(this),yo(this)},$t.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Cr=f.JSON.stringify,Bi=f.JSON.parse,za=class{stringify(A){return f.JSON.stringify(A,void 0)}parse(A){return f.JSON.parse(A,void 0)}};function ba(){}ba.prototype.h=null;function ys(A){return A.h||(A.h=A.i())}function Ga(){}var Wi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ws(){ze.call(this,"d")}L(Ws,ze);function Eo(){ze.call(this,"c")}L(Eo,ze);var Ha={},zi=null;function _u(){return zi=zi||new It}Ha.La="serverreachability";function Do(A){ze.call(this,Ha.La,A)}L(Do,ze);function wa(A){const q=_u();Kt(q,new Do(q))}Ha.STAT_EVENT="statevent";function Ds(A,q){ze.call(this,Ha.STAT_EVENT,A),this.stat=q}L(Ds,ze);function Gi(A){const q=_u();Kt(q,new Ds(q,A))}Ha.Ma="timingevent";function us(A,q){ze.call(this,Ha.Ma,A),this.size=q}L(us,ze);function Ca(A,q){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return f.setTimeout(function(){A()},q)}function vc(){this.g=!0}vc.prototype.xa=function(){this.g=!1};function zs(A,q,oe,ye,Je,ht){A.info(function(){if(A.g)if(ht)for(var Wt="",Ii=ht.split("&"),Ki=0;Ki<Ii.length;Ki++){var Xr=Ii[Ki].split("=");if(1<Xr.length){var Wo=Xr[0];Xr=Xr[1];var so=Wo.split("_");Wt=2<=so.length&&so[1]=="type"?Wt+(Wo+"="+Xr+"&"):Wt+(Wo+"=redacted&")}}else Wt=null;else Wt=ht;return"XMLHTTP REQ ("+ye+") [attempt "+Je+"]: "+q+`
`+oe+`
`+Wt})}function Zo(A,q,oe,ye,Je,ht,Wt){A.info(function(){return"XMLHTTP RESP ("+ye+") [ attempt "+Je+"]: "+q+`
`+oe+`
`+ht+" "+Wt})}function ea(A,q,oe,ye){A.info(function(){return"XMLHTTP TEXT ("+q+"): "+kd(A,oe)+(ye?" "+ye:"")})}function yu(A,q){A.info(function(){return"TIMEOUT: "+q})}vc.prototype.info=function(){};function kd(A,q){if(!A.g)return q;if(!q)return null;try{var oe=JSON.parse(q);if(oe){for(A=0;A<oe.length;A++)if(Array.isArray(oe[A])){var ye=oe[A];if(!(2>ye.length)){var Je=ye[1];if(Array.isArray(Je)&&!(1>Je.length)){var ht=Je[0];if(ht!="noop"&&ht!="stop"&&ht!="close")for(var Wt=1;Wt<Je.length;Wt++)Je[Wt]=""}}}}return Cr(oe)}catch{return q}}var Eu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Wl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},to;function _c(){}L(_c,ba),_c.prototype.g=function(){return new XMLHttpRequest},_c.prototype.i=function(){return{}},to=new _c;function ta(A,q,oe,ye){this.j=A,this.i=q,this.l=oe,this.R=ye||1,this.U=new $t(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Su}function Su(){this.i=null,this.g="",this.h=!1}var yc={},Gs={};function Tu(A,q,oe){A.L=1,A.v=Aa(ra(q)),A.m=oe,A.P=!0,ul(A,null)}function ul(A,q){A.F=Date.now(),Zr(A),A.A=ra(A.v);var oe=A.A,ye=A.R;Array.isArray(ye)||(ye=[String(ye)]),Tc(oe.i,"t",ye),A.C=0,oe=A.j.J,A.h=new Su,A.g=Rr(A.j,oe?q:null,!A.m),0<A.O&&(A.M=new Ns(I(A.Y,A,A.g),A.O)),q=A.U,oe=A.g,ye=A.ca;var Je="readystatechange";Array.isArray(Je)||(Je&&(Cn[0]=Je.toString()),Je=Cn);for(var ht=0;ht<Je.length;ht++){var Wt=wn(oe,Je[ht],ye||q.handleEvent,!1,q.h||q);if(!Wt)break;q.g[Wt.key]=Wt}q=A.H?K(A.H):{},A.m?(A.u||(A.u="POST"),q["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,q)):(A.u="GET",A.g.ea(A.A,A.u,null,q)),wa(),zs(A.i,A.u,A.A,A.l,A.R,A.m)}ta.prototype.ca=function(A){A=A.target;const q=this.M;q&&Ri(A)==3?q.j():this.Y(A)},ta.prototype.Y=function(A){try{if(A==this.g)e:{const so=Ri(this.g);var q=this.g.Ba();const eu=this.g.Z();if(!(3>so)&&(so!=3||this.g&&(this.h.h||this.g.oa()||ms(this.g)))){this.J||so!=4||q==7||(q==8||0>=eu?wa(3):wa(2)),Ra(this);var oe=this.g.Z();this.X=oe;t:if(Lo(this)){var ye=ms(this.g);A="";var Je=ye.length,ht=Ri(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){na(this),Ec(this);var Wt="";break t}this.h.i=new f.TextDecoder}for(q=0;q<Je;q++)this.h.h=!0,A+=this.h.i.decode(ye[q],{stream:!(ht&&q==Je-1)});ye.length=0,this.h.g+=A,this.C=0,Wt=this.h.g}else Wt=this.g.oa();if(this.o=oe==200,Zo(this.i,this.u,this.A,this.l,this.R,so,oe),this.o){if(this.T&&!this.K){t:{if(this.g){var Ii,Ki=this.g;if((Ii=Ki.g?Ki.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ae(Ii)){var Xr=Ii;break t}}Xr=null}if(oe=Xr)ea(this.i,this.l,oe,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,zl(this,oe);else{this.o=!1,this.s=3,Gi(12),na(this),Ec(this);break e}}if(this.P){oe=!0;let Ja;for(;!this.J&&this.C<Wt.length;)if(Ja=ll(this,Wt),Ja==Gs){so==4&&(this.s=4,Gi(14),oe=!1),ea(this.i,this.l,null,"[Incomplete Response]");break}else if(Ja==yc){this.s=4,Gi(15),ea(this.i,this.l,Wt,"[Invalid Chunk]"),oe=!1;break}else ea(this.i,this.l,Ja,null),zl(this,Ja);if(Lo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),so!=4||Wt.length!=0||this.h.h||(this.s=1,Gi(16),oe=!1),this.o=this.o&&oe,!oe)ea(this.i,this.l,Wt,"[Invalid Chunked Response]"),na(this),Ec(this);else if(0<Wt.length&&!this.W){this.W=!0;var Wo=this.j;Wo.g==this&&Wo.ba&&!Wo.M&&(Wo.j.info("Great, no buffering proxy detected. Bytes received: "+Wt.length),Z(Wo),Wo.M=!0,Gi(11))}}else ea(this.i,this.l,Wt,null),zl(this,Wt);so==4&&na(this),this.o&&!this.J&&(so==4?Ye(this.j,this):(this.o=!1,Zr(this)))}else Vo(this.g),oe==400&&0<Wt.indexOf("Unknown SID")?(this.s=3,Gi(12)):(this.s=0,Gi(13)),na(this),Ec(this)}}}catch{}finally{}};function Lo(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function ll(A,q){var oe=A.C,ye=q.indexOf(`
`,oe);return ye==-1?Gs:(oe=Number(q.substring(oe,ye)),isNaN(oe)?yc:(ye+=1,ye+oe>q.length?Gs:(q=q.slice(ye,ye+oe),A.C=ye+oe,q)))}ta.prototype.cancel=function(){this.J=!0,na(this)};function Zr(A){A.S=Date.now()+A.I,Ti(A,A.I)}function Ti(A,q){if(A.B!=null)throw Error("WatchDog timer not null");A.B=Ca(I(A.ba,A),q)}function Ra(A){A.B&&(f.clearTimeout(A.B),A.B=null)}ta.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(yu(this.i,this.A),this.L!=2&&(wa(),Gi(17)),na(this),this.s=2,Ec(this)):Ti(this,this.S-A)};function Ec(A){A.j.G==0||A.J||Ye(A.j,A)}function na(A){Ra(A);var q=A.M;q&&typeof q.ma=="function"&&q.ma(),A.M=null,yo(A.U),A.g&&(q=A.g,A.g=null,q.abort(),q.ma())}function zl(A,q){try{var oe=A.j;if(oe.G!=0&&(oe.g==A||Ls(oe.h,A))){if(!A.K&&Ls(oe.h,A)&&oe.G==3){try{var ye=oe.Da.g.parse(q)}catch{ye=null}if(Array.isArray(ye)&&ye.length==3){var Je=ye;if(Je[0]==0){e:if(!oe.u){if(oe.g)if(oe.g.F+3e3<A.F)Te(oe),wc(oe);else break e;k(oe),Gi(18)}}else oe.za=Je[1],0<oe.za-oe.T&&37500>Je[2]&&oe.F&&oe.v==0&&!oe.C&&(oe.C=Ca(I(oe.Za,oe),6e3));if(1>=hl(oe.h)&&oe.ca){try{oe.ca()}catch{}oe.ca=void 0}}else vt(oe,11)}else if((A.K||oe.g==A)&&Te(oe),!ae(q))for(Je=oe.Da.g.parse(q),q=0;q<Je.length;q++){let Xr=Je[q];if(oe.T=Xr[0],Xr=Xr[1],oe.G==2)if(Xr[0]=="c"){oe.K=Xr[1],oe.ia=Xr[2];const Wo=Xr[3];Wo!=null&&(oe.la=Wo,oe.j.info("VER="+oe.la));const so=Xr[4];so!=null&&(oe.Aa=so,oe.j.info("SVER="+oe.Aa));const eu=Xr[5];eu!=null&&typeof eu=="number"&&0<eu&&(ye=1.5*eu,oe.L=ye,oe.j.info("backChannelRequestTimeoutMs_="+ye)),ye=oe;const Ja=A.g;if(Ja){const Mf=Ja.g?Ja.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Mf){var ht=ye.h;ht.g||Mf.indexOf("spdy")==-1&&Mf.indexOf("quic")==-1&&Mf.indexOf("h2")==-1||(ht.j=ht.l,ht.g=new Set,ht.h&&(Gl(ht,ht.h),ht.h=null))}if(ye.D){const dm=Ja.g?Ja.g.getResponseHeader("X-HTTP-Session-Id"):null;dm&&(ye.ya=dm,kr(ye.I,ye.D,dm))}}oe.G=3,oe.l&&oe.l.ua(),oe.ba&&(oe.R=Date.now()-A.F,oe.j.info("Handshake RTT: "+oe.R+"ms")),ye=oe;var Wt=A;if(ye.qa=vn(ye,ye.J?ye.ia:null,ye.W),Wt.K){Mr(ye.h,Wt);var Ii=Wt,Ki=ye.L;Ki&&(Ii.I=Ki),Ii.B&&(Ra(Ii),Zr(Ii)),ye.g=Wt}else aa(ye);0<oe.i.length&&Xa(oe)}else Xr[0]!="stop"&&Xr[0]!="close"||vt(oe,7);else oe.G==3&&(Xr[0]=="stop"||Xr[0]=="close"?Xr[0]=="stop"?vt(oe,7):ls(oe):Xr[0]!="noop"&&oe.l&&oe.l.ta(Xr),oe.v=0)}}wa(4)}catch{}}var dl=class{constructor(A,q){this.g=A,this.map=q}};function xo(A){this.l=A||10,f.PerformanceNavigationTiming?(A=f.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(f.chrome&&f.chrome.loadTimes&&f.chrome.loadTimes()&&f.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function es(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function hl(A){return A.h?1:A.g?A.g.size:0}function Ls(A,q){return A.h?A.h==q:A.g?A.g.has(q):!1}function Gl(A,q){A.g?A.g.add(q):A.h=q}function Mr(A,q){A.h&&A.h==q?A.h=null:A.g&&A.g.has(q)&&A.g.delete(q)}xo.prototype.cancel=function(){if(this.i=Xc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function Xc(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let q=A.i;for(const oe of A.g.values())q=q.concat(oe.D);return q}return B(A.i)}function Sc(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(g(A)){for(var q=[],oe=A.length,ye=0;ye<oe;ye++)q.push(A[ye]);return q}q=[],oe=0;for(ye in A)q[oe++]=A[ye];return q}function fr(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(g(A)||typeof A=="string"){var q=[];A=A.length;for(var oe=0;oe<A;oe++)q.push(oe);return q}q=[],oe=0;for(const ye in A)q[oe++]=ye;return q}}}function bu(A,q){if(A.forEach&&typeof A.forEach=="function")A.forEach(q,void 0);else if(g(A)||typeof A=="string")Array.prototype.forEach.call(A,q,void 0);else for(var oe=fr(A),ye=Sc(A),Je=ye.length,ht=0;ht<Je;ht++)q.call(void 0,ye[ht],oe&&oe[ht],A)}var Jc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function wu(A,q){if(A){A=A.split("&");for(var oe=0;oe<A.length;oe++){var ye=A[oe].indexOf("="),Je=null;if(0<=ye){var ht=A[oe].substring(0,ye);Je=A[oe].substring(ye+1)}else ht=A[oe];q(ht,Je?decodeURIComponent(Je.replace(/\+/g," ")):"")}}}function Ka(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof Ka){this.h=A.h,fl(this,A.j),this.o=A.o,this.g=A.g,Qc(this,A.s),this.l=A.l;var q=A.i,oe=new Mo;oe.i=q.i,q.g&&(oe.g=new Map(q.g),oe.h=q.h),Ia(this,oe),this.m=A.m}else A&&(q=String(A).match(Jc))?(this.h=!1,fl(this,q[1]||"",!0),this.o=pr(q[2]||""),this.g=pr(q[3]||"",!0),Qc(this,q[4]),this.l=pr(q[5]||"",!0),Ia(this,q[6]||"",!0),this.m=pr(q[7]||"")):(this.h=!1,this.i=new Mo(null,this.h))}Ka.prototype.toString=function(){var A=[],q=this.j;q&&A.push(qa(q,So,!0),":");var oe=this.g;return(oe||q=="file")&&(A.push("//"),(q=this.o)&&A.push(qa(q,So,!0),"@"),A.push(encodeURIComponent(String(oe)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),oe=this.s,oe!=null&&A.push(":",String(oe))),(oe=this.l)&&(this.g&&oe.charAt(0)!="/"&&A.push("/"),A.push(qa(oe,oe.charAt(0)=="/"?Od:Hl,!0))),(oe=this.i.toString())&&A.push("?",oe),(oe=this.m)&&A.push("#",qa(oe,Cu)),A.join("")};function ra(A){return new Ka(A)}function fl(A,q,oe){A.j=oe?pr(q,!0):q,A.j&&(A.j=A.j.replace(/:$/,""))}function Qc(A,q){if(q){if(q=Number(q),isNaN(q)||0>q)throw Error("Bad port number "+q);A.s=q}else A.s=null}function Ia(A,q,oe){q instanceof Mo?(A.i=q,ia(A.i,A.h)):(oe||(q=qa(q,pl)),A.i=new Mo(q,A.h))}function kr(A,q,oe){A.i.set(q,oe)}function Aa(A){return kr(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function pr(A,q){return A?q?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function qa(A,q,oe){return typeof A=="string"?(A=encodeURI(A).replace(q,Zc),oe&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function Zc(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var So=/[#\/\?@]/g,Hl=/[#\?:]/g,Od=/[#\?]/g,pl=/[#\?@]/g,Cu=/#/g;function Mo(A,q){this.h=this.g=null,this.i=A||null,this.j=!!q}function Hi(A){A.g||(A.g=new Map,A.h=0,A.i&&wu(A.i,function(q,oe){A.add(decodeURIComponent(q.replace(/\+/g," ")),oe)}))}t=Mo.prototype,t.add=function(A,q){Hi(this),this.i=null,A=Or(this,A);var oe=this.g.get(A);return oe||this.g.set(A,oe=[]),oe.push(q),this.h+=1,this};function Hs(A,q){Hi(A),q=Or(A,q),A.g.has(q)&&(A.i=null,A.h-=A.g.get(q).length,A.g.delete(q))}function Uo(A,q){return Hi(A),q=Or(A,q),A.g.has(q)}t.forEach=function(A,q){Hi(this),this.g.forEach(function(oe,ye){oe.forEach(function(Je){A.call(q,Je,ye,this)},this)},this)},t.na=function(){Hi(this);const A=Array.from(this.g.values()),q=Array.from(this.g.keys()),oe=[];for(let ye=0;ye<q.length;ye++){const Je=A[ye];for(let ht=0;ht<Je.length;ht++)oe.push(q[ye])}return oe},t.V=function(A){Hi(this);let q=[];if(typeof A=="string")Uo(this,A)&&(q=q.concat(this.g.get(Or(this,A))));else{A=Array.from(this.g.values());for(let oe=0;oe<A.length;oe++)q=q.concat(A[oe])}return q},t.set=function(A,q){return Hi(this),this.i=null,A=Or(this,A),Uo(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[q]),this.h+=1,this},t.get=function(A,q){return A?(A=this.V(A),0<A.length?String(A[0]):q):q};function Tc(A,q,oe){Hs(A,q),0<oe.length&&(A.i=null,A.g.set(Or(A,q),B(oe)),A.h+=oe.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],q=Array.from(this.g.keys());for(var oe=0;oe<q.length;oe++){var ye=q[oe];const ht=encodeURIComponent(String(ye)),Wt=this.V(ye);for(ye=0;ye<Wt.length;ye++){var Je=ht;Wt[ye]!==""&&(Je+="="+encodeURIComponent(String(Wt[ye]))),A.push(Je)}}return this.i=A.join("&")};function Or(A,q){return q=String(q),A.j&&(q=q.toLowerCase()),q}function ia(A,q){q&&!A.j&&(Hi(A),A.i=null,A.g.forEach(function(oe,ye){var Je=ye.toLowerCase();ye!=Je&&(Hs(this,ye),Tc(this,Je,oe))},A)),A.j=q}function vh(A,q){const oe=new vc;if(f.Image){const ye=new Image;ye.onload=D(Es,oe,"TestLoadImage: loaded",!0,q,ye),ye.onerror=D(Es,oe,"TestLoadImage: error",!1,q,ye),ye.onabort=D(Es,oe,"TestLoadImage: abort",!1,q,ye),ye.ontimeout=D(Es,oe,"TestLoadImage: timeout",!1,q,ye),f.setTimeout(function(){ye.ontimeout&&ye.ontimeout()},1e4),ye.src=A}else q(!1)}function $a(A,q){const oe=new vc,ye=new AbortController,Je=setTimeout(()=>{ye.abort(),Es(oe,"TestPingServer: timeout",!1,q)},1e4);fetch(A,{signal:ye.signal}).then(ht=>{clearTimeout(Je),ht.ok?Es(oe,"TestPingServer: ok",!0,q):Es(oe,"TestPingServer: server error",!1,q)}).catch(()=>{clearTimeout(Je),Es(oe,"TestPingServer: error",!1,q)})}function Es(A,q,oe,ye,Je){try{Je&&(Je.onload=null,Je.onerror=null,Je.onabort=null,Je.ontimeout=null),ye(oe)}catch{}}function Ru(){this.g=new za}function Iu(A,q,oe){const ye=oe||"";try{bu(A,function(Je,ht){let Wt=Je;E(Je)&&(Wt=Cr(Je)),q.push(ye+ht+"="+encodeURIComponent(Wt))})}catch(Je){throw q.push(ye+"type="+encodeURIComponent("_badmap")),Je}}function bc(A){this.l=A.Ub||null,this.j=A.eb||!1}L(bc,ba),bc.prototype.g=function(){return new no(this.l,this.j)},bc.prototype.i=function(A){return function(){return A}}({});function no(A,q){It.call(this),this.D=A,this.o=q,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}L(no,It),t=no.prototype,t.open=function(A,q){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=q,this.readyState=1,sa(this)},t.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const q={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(q.body=A),(this.D||f).fetch(new Request(this.A,q)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ro(this)),this.readyState=0},t.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,sa(this)),this.g&&(this.readyState=3,sa(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof f.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Pd(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function Pd(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}t.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var q=A.value?A.value:new Uint8Array(0);(q=this.v.decode(q,{stream:!A.done}))&&(this.response=this.responseText+=q)}A.done?ro(this):sa(this),this.readyState==3&&Pd(this)}},t.Ra=function(A){this.g&&(this.response=this.responseText=A,ro(this))},t.Qa=function(A){this.g&&(this.response=A,ro(this))},t.ga=function(){this.g&&ro(this)};function ro(A){A.readyState=4,A.l=null,A.j=null,A.v=null,sa(A)}t.setRequestHeader=function(A,q){this.u.append(A,q)},t.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],q=this.h.entries();for(var oe=q.next();!oe.done;)oe=oe.value,A.push(oe[0]+": "+oe[1]),oe=q.next();return A.join(`\r
`)};function sa(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(no.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function Ya(A){let q="";return te(A,function(oe,ye){q+=ye,q+=":",q+=oe,q+=`\r
`}),q}function Ce(A,q,oe){e:{for(ye in oe){var ye=!1;break e}ye=!0}ye||(oe=Ya(oe),typeof A=="string"?oe!=null&&encodeURIComponent(String(oe)):kr(A,q,oe))}function De(A){It.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}L(De,It);var st=/^https?$/i,nn=["POST","PUT"];t=De.prototype,t.Ha=function(A){this.J=A},t.ea=function(A,q,oe,ye){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);q=q?q.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():to.g(),this.v=this.o?ys(this.o):ys(to),this.g.onreadystatechange=I(this.Ea,this);try{this.B=!0,this.g.open(q,String(A),!0),this.B=!1}catch(ht){Zn(this,ht);return}if(A=oe||"",oe=new Map(this.headers),ye)if(Object.getPrototypeOf(ye)===Object.prototype)for(var Je in ye)oe.set(Je,ye[Je]);else if(typeof ye.keys=="function"&&typeof ye.get=="function")for(const ht of ye.keys())oe.set(ht,ye.get(ht));else throw Error("Unknown input type for opt_headers: "+String(ye));ye=Array.from(oe.keys()).find(ht=>ht.toLowerCase()=="content-type"),Je=f.FormData&&A instanceof f.FormData,!(0<=Array.prototype.indexOf.call(nn,q,void 0))||ye||Je||oe.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ht,Wt]of oe)this.g.setRequestHeader(ht,Wt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Hr(this),this.u=!0,this.g.send(A),this.u=!1}catch(ht){Zn(this,ht)}};function Zn(A,q){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=q,A.m=5,Ur(A),hn(A)}function Ur(A){A.A||(A.A=!0,Kt(A,"complete"),Kt(A,"error"))}t.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,Kt(this,"complete"),Kt(this,"abort"),hn(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),hn(this,!0)),De.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?ei(this):this.bb())},t.bb=function(){ei(this)};function ei(A){if(A.h&&typeof d<"u"&&(!A.v[1]||Ri(A)!=4||A.Z()!=2)){if(A.u&&Ri(A)==4)Fn(A.Ea,0,A);else if(Kt(A,"readystatechange"),Ri(A)==4){A.h=!1;try{const Wt=A.Z();e:switch(Wt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var q=!0;break e;default:q=!1}var oe;if(!(oe=q)){var ye;if(ye=Wt===0){var Je=String(A.D).match(Jc)[1]||null;!Je&&f.self&&f.self.location&&(Je=f.self.location.protocol.slice(0,-1)),ye=!st.test(Je?Je.toLowerCase():"")}oe=ye}if(oe)Kt(A,"complete"),Kt(A,"success");else{A.m=6;try{var ht=2<Ri(A)?A.g.statusText:""}catch{ht=""}A.l=ht+" ["+A.Z()+"]",Ur(A)}}finally{hn(A)}}}}function hn(A,q){if(A.g){Hr(A);const oe=A.g,ye=A.v[0]?()=>{}:null;A.g=null,A.v=null,q||Kt(A,"ready");try{oe.onreadystatechange=ye}catch{}}}function Hr(A){A.I&&(f.clearTimeout(A.I),A.I=null)}t.isActive=function(){return!!this.g};function Ri(A){return A.g?A.g.readyState:0}t.Z=function(){try{return 2<Ri(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(A){if(this.g){var q=this.g.responseText;return A&&q.indexOf(A)==0&&(q=q.substring(A.length)),Bi(q)}};function ms(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function Vo(A){const q={};A=(A.g&&2<=Ri(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let ye=0;ye<A.length;ye++){if(ae(A[ye]))continue;var oe=Ee(A[ye]);const Je=oe[0];if(oe=oe[1],typeof oe!="string")continue;oe=oe.trim();const ht=q[Je]||[];q[Je]=ht,ht.push(oe)}j(q,function(ye){return ye.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Fo(A,q,oe){return oe&&oe.internalChannelParams&&oe.internalChannelParams[A]||q}function oa(A){this.Aa=0,this.i=[],this.j=new vc,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Fo("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Fo("baseRetryDelayMs",5e3,A),this.cb=Fo("retryDelaySeedMs",1e4,A),this.Wa=Fo("forwardChannelMaxRetries",2,A),this.wa=Fo("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new xo(A&&A.concurrentRequestLimit),this.Da=new Ru,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=oa.prototype,t.la=8,t.G=1,t.connect=function(A,q,oe,ye){Gi(0),this.W=A,this.H=q||{},oe&&ye!==void 0&&(this.H.OSID=oe,this.H.OAID=ye),this.F=this.X,this.I=vn(this,null,this.W),Xa(this)};function ls(A){if(ml(A),A.G==3){var q=A.U++,oe=ra(A.I);if(kr(oe,"SID",A.K),kr(oe,"RID",q),kr(oe,"TYPE","terminate"),Au(A,oe),q=new ta(A,A.j,q),q.L=2,q.v=Aa(ra(oe)),oe=!1,f.navigator&&f.navigator.sendBeacon)try{oe=f.navigator.sendBeacon(q.v.toString(),"")}catch{}!oe&&f.Image&&(new Image().src=q.v,oe=!0),oe||(q.g=Rr(q.j,null),q.g.ea(q.v)),q.F=Date.now(),Zr(q)}rn(A)}function wc(A){A.g&&(Z(A),A.g.cancel(),A.g=null)}function ml(A){wc(A),A.u&&(f.clearTimeout(A.u),A.u=null),Te(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&f.clearTimeout(A.s),A.s=null)}function Xa(A){if(!es(A.h)&&!A.s){A.s=!0;var q=A.Ga;Ne||ve(),Re||(Ne(),Re=!0),Ve.add(q,A),A.B=0}}function Kl(A,q){return hl(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=q.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=Ca(I(A.Ga,A,q),tt(A,A.B)),A.B++,!0)}t.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const Je=new ta(this,this.j,A);let ht=this.o;if(this.S&&(ht?(ht=K(ht),ce(ht,this.S)):ht=this.S),this.m!==null||this.O||(Je.H=ht,ht=null),this.P)e:{for(var q=0,oe=0;oe<this.i.length;oe++){t:{var ye=this.i[oe];if("__data__"in ye.map&&(ye=ye.map.__data__,typeof ye=="string")){ye=ye.length;break t}ye=void 0}if(ye===void 0)break;if(q+=ye,4096<q){q=oe;break e}if(q===4096||oe===this.i.length-1){q=oe+1;break e}}q=1e3}else q=1e3;q=jo(this,Je,q),oe=ra(this.I),kr(oe,"RID",A),kr(oe,"CVER",22),this.D&&kr(oe,"X-HTTP-Session-Id",this.D),Au(this,oe),ht&&(this.O?q="headers="+encodeURIComponent(String(Ya(ht)))+"&"+q:this.m&&Ce(oe,this.m,ht)),Gl(this.h,Je),this.Ua&&kr(oe,"TYPE","init"),this.P?(kr(oe,"$req",q),kr(oe,"SID","null"),Je.T=!0,Tu(Je,oe,null)):Tu(Je,oe,q),this.G=2}}else this.G==3&&(A?io(this,A):this.i.length==0||es(this.h)||io(this))};function io(A,q){var oe;q?oe=q.l:oe=A.U++;const ye=ra(A.I);kr(ye,"SID",A.K),kr(ye,"RID",oe),kr(ye,"AID",A.T),Au(A,ye),A.m&&A.o&&Ce(ye,A.m,A.o),oe=new ta(A,A.j,oe,A.B+1),A.m===null&&(oe.H=A.o),q&&(A.i=q.D.concat(A.i)),q=jo(A,oe,1e3),oe.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),Gl(A.h,oe),Tu(oe,ye,q)}function Au(A,q){A.H&&te(A.H,function(oe,ye){kr(q,ye,oe)}),A.l&&bu({},function(oe,ye){kr(q,ye,oe)})}function jo(A,q,oe){oe=Math.min(A.i.length,oe);var ye=A.l?I(A.l.Na,A.l,A):null;e:{var Je=A.i;let ht=-1;for(;;){const Wt=["count="+oe];ht==-1?0<oe?(ht=Je[0].g,Wt.push("ofs="+ht)):ht=0:Wt.push("ofs="+ht);let Ii=!0;for(let Ki=0;Ki<oe;Ki++){let Xr=Je[Ki].g;const Wo=Je[Ki].map;if(Xr-=ht,0>Xr)ht=Math.max(0,Je[Ki].g-100),Ii=!1;else try{Iu(Wo,Wt,"req"+Xr+"_")}catch{ye&&ye(Wo)}}if(Ii){ye=Wt.join("&");break e}}}return A=A.i.splice(0,oe),q.D=A,ye}function aa(A){if(!A.g&&!A.u){A.Y=1;var q=A.Fa;Ne||ve(),Re||(Ne(),Re=!0),Ve.add(q,A),A.v=0}}function k(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=Ca(I(A.Fa,A),tt(A,A.v)),A.v++,!0)}t.Fa=function(){if(this.u=null,he(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=Ca(I(this.ab,this),A)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Gi(10),wc(this),he(this))};function Z(A){A.A!=null&&(f.clearTimeout(A.A),A.A=null)}function he(A){A.g=new ta(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var q=ra(A.qa);kr(q,"RID","rpc"),kr(q,"SID",A.K),kr(q,"AID",A.T),kr(q,"CI",A.F?"0":"1"),!A.F&&A.ja&&kr(q,"TO",A.ja),kr(q,"TYPE","xmlhttp"),Au(A,q),A.m&&A.o&&Ce(q,A.m,A.o),A.L&&(A.g.I=A.L);var oe=A.g;A=A.ia,oe.L=1,oe.v=Aa(ra(q)),oe.m=null,oe.P=!0,ul(oe,A)}t.Za=function(){this.C!=null&&(this.C=null,wc(this),k(this),Gi(19))};function Te(A){A.C!=null&&(f.clearTimeout(A.C),A.C=null)}function Ye(A,q){var oe=null;if(A.g==q){Te(A),Z(A),A.g=null;var ye=2}else if(Ls(A.h,q))oe=q.D,Mr(A.h,q),ye=1;else return;if(A.G!=0){if(q.o)if(ye==1){oe=q.m?q.m.length:0,q=Date.now()-q.F;var Je=A.B;ye=_u(),Kt(ye,new us(ye,oe)),Xa(A)}else aa(A);else if(Je=q.s,Je==3||Je==0&&0<q.X||!(ye==1&&Kl(A,q)||ye==2&&k(A)))switch(oe&&0<oe.length&&(q=A.h,q.i=q.i.concat(oe)),Je){case 1:vt(A,5);break;case 4:vt(A,10);break;case 3:vt(A,6);break;default:vt(A,2)}}}function tt(A,q){let oe=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(oe*=2),oe*q}function vt(A,q){if(A.j.info("Error code "+q),q==2){var oe=I(A.fb,A),ye=A.Xa;const Je=!ye;ye=new Ka(ye||"//www.google.com/images/cleardot.gif"),f.location&&f.location.protocol=="http"||fl(ye,"https"),Aa(ye),Je?vh(ye.toString(),oe):$a(ye.toString(),oe)}else Gi(2);A.G=0,A.l&&A.l.sa(q),rn(A),ml(A)}t.fb=function(A){A?(this.j.info("Successfully pinged google.com"),Gi(2)):(this.j.info("Failed to ping google.com"),Gi(1))};function rn(A){if(A.G=0,A.ka=[],A.l){const q=Xc(A.h);(q.length!=0||A.i.length!=0)&&(G(A.ka,q),G(A.ka,A.i),A.h.i.length=0,B(A.i),A.i.length=0),A.l.ra()}}function vn(A,q,oe){var ye=oe instanceof Ka?ra(oe):new Ka(oe);if(ye.g!="")q&&(ye.g=q+"."+ye.g),Qc(ye,ye.s);else{var Je=f.location;ye=Je.protocol,q=q?q+"."+Je.hostname:Je.hostname,Je=+Je.port;var ht=new Ka(null);ye&&fl(ht,ye),q&&(ht.g=q),Je&&Qc(ht,Je),oe&&(ht.l=oe),ye=ht}return oe=A.D,q=A.ya,oe&&q&&kr(ye,oe,q),kr(ye,"VER",A.la),Au(A,ye),ye}function Rr(A,q,oe){if(q&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return q=A.Ca&&!A.pa?new De(new bc({eb:oe})):new De(A.pa),q.Ha(A.J),q}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function cn(){}t=cn.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function ts(){}ts.prototype.g=function(A,q){return new ci(A,q)};function ci(A,q){It.call(this),this.g=new oa(q),this.l=A,this.h=q&&q.messageUrlParams||null,A=q&&q.messageHeaders||null,q&&q.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=q&&q.initMessageHeaders||null,q&&q.messageContentType&&(A?A["X-WebChannel-Content-Type"]=q.messageContentType:A={"X-WebChannel-Content-Type":q.messageContentType}),q&&q.va&&(A?A["X-WebChannel-Client-Profile"]=q.va:A={"X-WebChannel-Client-Profile":q.va}),this.g.S=A,(A=q&&q.Sb)&&!ae(A)&&(this.g.m=A),this.v=q&&q.supportsCrossDomainXhr||!1,this.u=q&&q.sendRawJson||!1,(q=q&&q.httpSessionIdParam)&&!ae(q)&&(this.g.D=q,A=this.h,A!==null&&q in A&&(A=this.h,q in A&&delete A[q])),this.j=new ns(this)}L(ci,It),ci.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ci.prototype.close=function(){ls(this.g)},ci.prototype.o=function(A){var q=this.g;if(typeof A=="string"){var oe={};oe.__data__=A,A=oe}else this.u&&(oe={},oe.__data__=Cr(A),A=oe);q.i.push(new dl(q.Ya++,A)),q.G==3&&Xa(q)},ci.prototype.N=function(){this.g.l=null,delete this.j,ls(this.g),delete this.g,ci.aa.N.call(this)};function Vr(A){Ws.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var q=A.__sm__;if(q){e:{for(const oe in q){A=oe;break e}A=void 0}(this.i=A)&&(A=this.i,q=q!==null&&A in q?q[A]:void 0),this.data=q}else this.data=A}L(Vr,Ws);function Bo(){Eo.call(this),this.status=1}L(Bo,Eo);function ns(A){this.g=A}L(ns,cn),ns.prototype.ua=function(){Kt(this.g,"a")},ns.prototype.ta=function(A){Kt(this.g,new Vr(A))},ns.prototype.sa=function(A){Kt(this.g,new Bo)},ns.prototype.ra=function(){Kt(this.g,"b")},ts.prototype.createWebChannel=ts.prototype.g,ci.prototype.send=ci.prototype.o,ci.prototype.open=ci.prototype.m,ci.prototype.close=ci.prototype.close,vae=function(){return new ts},gae=function(){return _u()},mae=Ha,tj={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Eu.NO_ERROR=0,Eu.TIMEOUT=8,Eu.HTTP_ERROR=6,lN=Eu,Wl.COMPLETE="complete",pae=Wl,Ga.EventType=Wi,Wi.OPEN="a",Wi.CLOSE="b",Wi.ERROR="c",Wi.MESSAGE="d",It.prototype.listen=It.prototype.K,iC=Ga,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,fae=De}).apply(typeof wP<"u"?wP:typeof self<"u"?self:typeof window<"u"?window:{});const rZ="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Wc.UNAUTHENTICATED=new Wc(null),Wc.GOOGLE_CREDENTIALS=new Wc("google-credentials-uid"),Wc.FIRST_PARTY=new Wc("first-party-uid"),Wc.MOCK_USER=new Wc("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ZT="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gy=new B4("@firebase/firestore");function Dw(){return gy.logLevel}function En(t,...e){if(gy.logLevel<=oi.DEBUG){const r=e.map(Q4);gy.debug(`Firestore (${ZT}): ${t}`,...r)}}function Xp(t,...e){if(gy.logLevel<=oi.ERROR){const r=e.map(Q4);gy.error(`Firestore (${ZT}): ${t}`,...r)}}function PT(t,...e){if(gy.logLevel<=oi.WARN){const r=e.map(Q4);gy.warn(`Firestore (${ZT}): ${t}`,...r)}}function Q4(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lr(t="Unexpected state"){const e=`FIRESTORE (${ZT}) INTERNAL ASSERTION FAILED: `+t;throw Xp(e),new Error(e)}function Zi(t,e){t||lr()}function vr(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Rn extends xf{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ae{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rze{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(Wc.UNAUTHENTICATED))}shutdown(){}}class ize{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class sze{constructor(e){this.t=e,this.currentUser=Wc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){Zi(this.o===void 0);let o=this.i;const a=g=>this.i!==o?(o=this.i,r(g)):Promise.resolve();let u=new Gp;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new Gp,e.enqueueRetryable(()=>a(this.currentUser))};const d=()=>{const g=u;e.enqueueRetryable(async()=>{await g.promise,await a(this.currentUser)})},f=g=>{En("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=g,this.o&&(this.auth.addAuthTokenListener(this.o),d())};this.t.onInit(g=>f(g)),setTimeout(()=>{if(!this.auth){const g=this.t.getImmediate({optional:!0});g?f(g):(En("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new Gp)}},0),d()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(o=>this.i!==e?(En("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(Zi(typeof o.accessToken=="string"),new _ae(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Zi(e===null||typeof e=="string"),new Wc(e)}}class oze{constructor(e,r,o){this.l=e,this.h=r,this.P=o,this.type="FirstParty",this.user=Wc.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class aze{constructor(e,r,o){this.l=e,this.h=r,this.P=o}getToken(){return Promise.resolve(new oze(this.l,this.h,this.P))}start(e,r){e.enqueueRetryable(()=>r(Wc.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class cze{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class uze{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,r){Zi(this.o===void 0);const o=u=>{u.error!=null&&En("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const d=u.token!==this.R;return this.R=u.token,En("FirebaseAppCheckTokenProvider",`Received ${d?"new":"existing"} token.`),d?r(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable(()=>o(u))};const a=u=>{En("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(u=>a(u)),setTimeout(()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?a(u):En("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(r=>r?(Zi(typeof r.token=="string"),this.R=r.token,new cze(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lze(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let o=0;o<t;o++)r[o]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yae{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let o="";for(;o.length<20;){const a=lze(40);for(let u=0;u<a.length;++u)o.length<20&&a[u]<r&&(o+=e.charAt(a[u]%e.length))}return o}}function Ci(t,e){return t<e?-1:t>e?1:0}function NT(t,e,r){return t.length===e.length&&t.every((o,a)=>r(o,e[a]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new Rn(Mt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new Rn(Mt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new Rn(Mt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Rn(Mt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ya.fromMillis(Date.now())}static fromDate(e){return ya.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),o=Math.floor(1e6*(e-1e3*r));return new ya(r,o)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ci(this.nanoseconds,e.nanoseconds):Ci(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new gr(e)}static min(){return new gr(new ya(0,0))}static max(){return new gr(new ya(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR{constructor(e,r,o){r===void 0?r=0:r>e.length&&lr(),o===void 0?o=e.length-r:o>e.length-r&&lr(),this.segments=e,this.offset=r,this.len=o}get length(){return this.len}isEqual(e){return cR.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof cR?e.forEach(o=>{r.push(o)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,o=this.limit();r<o;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const o=Math.min(e.length,r.length);for(let a=0;a<o;a++){const u=e.get(a),d=r.get(a);if(u<d)return-1;if(u>d)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class js extends cR{construct(e,r,o){return new js(e,r,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const r=[];for(const o of e){if(o.indexOf("//")>=0)throw new Rn(Mt.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);r.push(...o.split("/").filter(a=>a.length>0))}return new js(r)}static emptyPath(){return new js([])}}const dze=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class fc extends cR{construct(e,r,o){return new fc(e,r,o)}static isValidIdentifier(e){return dze.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),fc.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new fc(["__name__"])}static fromServerFormat(e){const r=[];let o="",a=0;const u=()=>{if(o.length===0)throw new Rn(Mt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(o),o=""};let d=!1;for(;a<e.length;){const f=e[a];if(f==="\\"){if(a+1===e.length)throw new Rn(Mt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const g=e[a+1];if(g!=="\\"&&g!=="."&&g!=="`")throw new Rn(Mt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=g,a+=2}else f==="`"?(d=!d,a++):f!=="."||d?(o+=f,a++):(u(),a++)}if(u(),d)throw new Rn(Mt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new fc(r)}static emptyPath(){return new fc([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e){this.path=e}static fromPath(e){return new qn(js.fromString(e))}static fromName(e){return new qn(js.fromString(e).popFirst(5))}static empty(){return new qn(js.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&js.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return js.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new qn(new js(e.slice()))}}function hze(t,e){const r=t.toTimestamp().seconds,o=t.toTimestamp().nanoseconds+1,a=gr.fromTimestamp(o===1e9?new ya(r+1,0):new ya(r,o));return new Bg(a,qn.empty(),e)}function fze(t){return new Bg(t.readTime,t.key,-1)}class Bg{constructor(e,r,o){this.readTime=e,this.documentKey=r,this.largestBatchId=o}static min(){return new Bg(gr.min(),qn.empty(),-1)}static max(){return new Bg(gr.max(),qn.empty(),-1)}}function pze(t,e){let r=t.readTime.compareTo(e.readTime);return r!==0?r:(r=qn.comparator(t.documentKey,e.documentKey),r!==0?r:Ci(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mze="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class gze{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KR(t){if(t.code!==Mt.FAILED_PRECONDITION||t.message!==mze)throw t;En("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&lr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new Ut((o,a)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(o,a)},this.catchCallback=u=>{this.wrapFailure(r,u).next(o,a)}})}toPromise(){return new Promise((e,r)=>{this.next(e,r)})}wrapUserFunction(e){try{const r=e();return r instanceof Ut?r:Ut.resolve(r)}catch(r){return Ut.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction(()=>e(r)):Ut.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction(()=>e(r)):Ut.reject(r)}static resolve(e){return new Ut((r,o)=>{r(e)})}static reject(e){return new Ut((r,o)=>{o(e)})}static waitFor(e){return new Ut((r,o)=>{let a=0,u=0,d=!1;e.forEach(f=>{++a,f.next(()=>{++u,d&&u===a&&r()},g=>o(g))}),d=!0,u===a&&r()})}static or(e){let r=Ut.resolve(!1);for(const o of e)r=r.next(a=>a?Ut.resolve(a):o());return r}static forEach(e,r){const o=[];return e.forEach((a,u)=>{o.push(r.call(this,a,u))}),this.waitFor(o)}static mapArray(e,r){return new Ut((o,a)=>{const u=e.length,d=new Array(u);let f=0;for(let g=0;g<u;g++){const E=g;r(e[E]).next(T=>{d[E]=T,++f,f===u&&o(d)},T=>a(T))}})}static doWhile(e,r){return new Ut((o,a)=>{const u=()=>{e()===!0?r().next(()=>{u()},a):o()};u()})}}function vze(t){const e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function qR(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=o=>this.ie(o),this.se=o=>r.writeSequenceNumber(o))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Z4.oe=-1;function nD(t){return t==null}function YN(t){return t===0&&1/t==-1/0}function _ze(t){return typeof t=="number"&&Number.isInteger(t)&&!YN(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iZ(t){let e=0;for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function Iy(t,e){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])}function Eae(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs{constructor(e,r){this.comparator=e,this.root=r||dc.EMPTY}insert(e,r){return new Zs(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,dc.BLACK,null,null))}remove(e){return new Zs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,dc.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const o=this.comparator(e,r.key);if(o===0)return r.value;o<0?r=r.left:o>0&&(r=r.right)}return null}indexOf(e){let r=0,o=this.root;for(;!o.isEmpty();){const a=this.comparator(e,o.key);if(a===0)return r+o.left.size;a<0?o=o.left:(r+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,o)=>(e(r,o),!1))}toString(){const e=[];return this.inorderTraversal((r,o)=>(e.push(`${r}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new CP(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new CP(this.root,e,this.comparator,!1)}getReverseIterator(){return new CP(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new CP(this.root,e,this.comparator,!0)}}class CP{constructor(e,r,o,a){this.isReverse=a,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=r?o(e.key,r):1,r&&a&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class dc{constructor(e,r,o,a,u){this.key=e,this.value=r,this.color=o??dc.RED,this.left=a??dc.EMPTY,this.right=u??dc.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,o,a,u){return new dc(e??this.key,r??this.value,o??this.color,a??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,o){let a=this;const u=o(e,a.key);return a=u<0?a.copy(null,null,null,a.left.insert(e,r,o),null):u===0?a.copy(null,r,null,null,null):a.copy(null,null,null,null,a.right.insert(e,r,o)),a.fixUp()}removeMin(){if(this.left.isEmpty())return dc.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let o,a=this;if(r(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,r),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),r(e,a.key)===0){if(a.right.isEmpty())return dc.EMPTY;o=a.right.min(),a=a.copy(o.key,o.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,r))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,dc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,dc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw lr();const e=this.left.check();if(e!==this.right.check())throw lr();return e+(this.isRed()?0:1)}}dc.EMPTY=null,dc.RED=!0,dc.BLACK=!1;dc.EMPTY=new class{constructor(){this.size=0}get key(){throw lr()}get value(){throw lr()}get color(){throw lr()}get left(){throw lr()}get right(){throw lr()}copy(e,r,o,a,u){return this}insert(e,r,o){return new dc(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(e){this.comparator=e,this.data=new Zs(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,o)=>(e(r),!1))}forEachInRange(e,r){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const a=o.getNext();if(this.comparator(a.key,e[1])>=0)return;r(a.key)}}forEachWhile(e,r){let o;for(o=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new sZ(this.data.getIterator())}getIteratorFrom(e){return new sZ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(o=>{r=r.add(o)}),r}isEqual(e){if(!(e instanceof mc)||this.size!==e.size)return!1;const r=this.data.getIterator(),o=e.data.getIterator();for(;r.hasNext();){const a=r.getNext().key,u=o.getNext().key;if(this.comparator(a,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new mc(this.comparator);return r.data=e,r}}class sZ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ml{constructor(e){this.fields=e,e.sort(fc.comparator)}static empty(){return new Ml([])}unionWith(e){let r=new mc(fc.comparator);for(const o of this.fields)r=r.add(o);for(const o of e)r=r.add(o);return new Ml(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return NT(this.fields,e.fields,(r,o)=>r.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sae extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(a){try{return atob(a)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new Sae("Invalid base64 string: "+u):u}}(e);return new gc(r)}static fromUint8Array(e){const r=function(a){let u="";for(let d=0;d<a.length;++d)u+=String.fromCharCode(a[d]);return u}(e);return new gc(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const o=new Uint8Array(r.length);for(let a=0;a<r.length;a++)o[a]=r.charCodeAt(a);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ci(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}gc.EMPTY_BYTE_STRING=new gc("");const yze=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Wg(t){if(Zi(!!t),typeof t=="string"){let e=0;const r=yze.exec(t);if(Zi(!!r),r[1]){let a=r[1];a=(a+"000000000").substr(0,9),e=Number(a)}const o=new Date(t);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:Po(t.seconds),nanos:Po(t.nanos)}}function Po(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function vy(t){return typeof t=="string"?gc.fromBase64String(t):gc.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e5(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function t5(t){const e=t.mapValue.fields.__previous_value__;return e5(e)?t5(e):e}function uR(t){const e=Wg(t.mapValue.fields.__local_write_time__.timestampValue);return new ya(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eze{constructor(e,r,o,a,u,d,f,g,E){this.databaseId=e,this.appId=r,this.persistenceKey=o,this.host=a,this.ssl=u,this.forceLongPolling=d,this.autoDetectLongPolling=f,this.longPollingOptions=g,this.useFetchStreams=E}}class lR{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new lR("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof lR&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RP={mapValue:{}};function _y(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?e5(t)?4:Tze(t)?9007199254740991:Sze(t)?10:11:lr()}function Pf(t,e){if(t===e)return!0;const r=_y(t);if(r!==_y(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return uR(t).isEqual(uR(e));case 3:return function(a,u){if(typeof a.timestampValue=="string"&&typeof u.timestampValue=="string"&&a.timestampValue.length===u.timestampValue.length)return a.timestampValue===u.timestampValue;const d=Wg(a.timestampValue),f=Wg(u.timestampValue);return d.seconds===f.seconds&&d.nanos===f.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(a,u){return vy(a.bytesValue).isEqual(vy(u.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(a,u){return Po(a.geoPointValue.latitude)===Po(u.geoPointValue.latitude)&&Po(a.geoPointValue.longitude)===Po(u.geoPointValue.longitude)}(t,e);case 2:return function(a,u){if("integerValue"in a&&"integerValue"in u)return Po(a.integerValue)===Po(u.integerValue);if("doubleValue"in a&&"doubleValue"in u){const d=Po(a.doubleValue),f=Po(u.doubleValue);return d===f?YN(d)===YN(f):isNaN(d)&&isNaN(f)}return!1}(t,e);case 9:return NT(t.arrayValue.values||[],e.arrayValue.values||[],Pf);case 10:case 11:return function(a,u){const d=a.mapValue.fields||{},f=u.mapValue.fields||{};if(iZ(d)!==iZ(f))return!1;for(const g in d)if(d.hasOwnProperty(g)&&(f[g]===void 0||!Pf(d[g],f[g])))return!1;return!0}(t,e);default:return lr()}}function dR(t,e){return(t.values||[]).find(r=>Pf(r,e))!==void 0}function DT(t,e){if(t===e)return 0;const r=_y(t),o=_y(e);if(r!==o)return Ci(r,o);switch(r){case 0:case 9007199254740991:return 0;case 1:return Ci(t.booleanValue,e.booleanValue);case 2:return function(u,d){const f=Po(u.integerValue||u.doubleValue),g=Po(d.integerValue||d.doubleValue);return f<g?-1:f>g?1:f===g?0:isNaN(f)?isNaN(g)?0:-1:1}(t,e);case 3:return oZ(t.timestampValue,e.timestampValue);case 4:return oZ(uR(t),uR(e));case 5:return Ci(t.stringValue,e.stringValue);case 6:return function(u,d){const f=vy(u),g=vy(d);return f.compareTo(g)}(t.bytesValue,e.bytesValue);case 7:return function(u,d){const f=u.split("/"),g=d.split("/");for(let E=0;E<f.length&&E<g.length;E++){const T=Ci(f[E],g[E]);if(T!==0)return T}return Ci(f.length,g.length)}(t.referenceValue,e.referenceValue);case 8:return function(u,d){const f=Ci(Po(u.latitude),Po(d.latitude));return f!==0?f:Ci(Po(u.longitude),Po(d.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return aZ(t.arrayValue,e.arrayValue);case 10:return function(u,d){var f,g,E,T;const C=u.fields||{},I=d.fields||{},D=(f=C.value)===null||f===void 0?void 0:f.arrayValue,L=(g=I.value)===null||g===void 0?void 0:g.arrayValue,B=Ci(((E=D==null?void 0:D.values)===null||E===void 0?void 0:E.length)||0,((T=L==null?void 0:L.values)===null||T===void 0?void 0:T.length)||0);return B!==0?B:aZ(D,L)}(t.mapValue,e.mapValue);case 11:return function(u,d){if(u===RP.mapValue&&d===RP.mapValue)return 0;if(u===RP.mapValue)return 1;if(d===RP.mapValue)return-1;const f=u.fields||{},g=Object.keys(f),E=d.fields||{},T=Object.keys(E);g.sort(),T.sort();for(let C=0;C<g.length&&C<T.length;++C){const I=Ci(g[C],T[C]);if(I!==0)return I;const D=DT(f[g[C]],E[T[C]]);if(D!==0)return D}return Ci(g.length,T.length)}(t.mapValue,e.mapValue);default:throw lr()}}function oZ(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ci(t,e);const r=Wg(t),o=Wg(e),a=Ci(r.seconds,o.seconds);return a!==0?a:Ci(r.nanos,o.nanos)}function aZ(t,e){const r=t.values||[],o=e.values||[];for(let a=0;a<r.length&&a<o.length;++a){const u=DT(r[a],o[a]);if(u)return u}return Ci(r.length,o.length)}function LT(t){return nj(t)}function nj(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const o=Wg(r);return`time(${o.seconds},${o.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(r){return vy(r).toBase64()}(t.bytesValue):"referenceValue"in t?function(r){return qn.fromName(r).toString()}(t.referenceValue):"geoPointValue"in t?function(r){return`geo(${r.latitude},${r.longitude})`}(t.geoPointValue):"arrayValue"in t?function(r){let o="[",a=!0;for(const u of r.values||[])a?a=!1:o+=",",o+=nj(u);return o+"]"}(t.arrayValue):"mapValue"in t?function(r){const o=Object.keys(r.fields||{}).sort();let a="{",u=!0;for(const d of o)u?u=!1:a+=",",a+=`${d}:${nj(r.fields[d])}`;return a+"}"}(t.mapValue):lr()}function rj(t){return!!t&&"integerValue"in t}function n5(t){return!!t&&"arrayValue"in t}function cZ(t){return!!t&&"nullValue"in t}function uZ(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function dN(t){return!!t&&"mapValue"in t}function Sze(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function kC(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Iy(t.mapValue.fields,(r,o)=>e.mapValue.fields[r]=kC(o)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=kC(t.arrayValue.values[r]);return e}return Object.assign({},t)}function Tze(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(e){this.value=e}static empty(){return new el({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let o=0;o<e.length-1;++o)if(r=(r.mapValue.fields||{})[e.get(o)],!dN(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=kC(r)}setAll(e){let r=fc.emptyPath(),o={},a=[];e.forEach((d,f)=>{if(!r.isImmediateParentOf(f)){const g=this.getFieldsMap(r);this.applyChanges(g,o,a),o={},a=[],r=f.popLast()}d?o[f.lastSegment()]=kC(d):a.push(f.lastSegment())});const u=this.getFieldsMap(r);this.applyChanges(u,o,a)}delete(e){const r=this.field(e.popLast());dN(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return Pf(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let o=0;o<e.length;++o){let a=r.mapValue.fields[e.get(o)];dN(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},r.mapValue.fields[e.get(o)]=a),r=a}return r.mapValue.fields}applyChanges(e,r,o){Iy(r,(a,u)=>e[a]=u);for(const a of o)delete e[a]}clone(){return new el(kC(this.value))}}function Tae(t){const e=[];return Iy(t.fields,(r,o)=>{const a=new fc([r]);if(dN(o)){const u=Tae(o.mapValue).fields;if(u.length===0)e.push(a);else for(const d of u)e.push(a.child(d))}else e.push(a)}),new Ml(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(e,r,o,a,u,d,f){this.key=e,this.documentType=r,this.version=o,this.readTime=a,this.createTime=u,this.data=d,this.documentState=f}static newInvalidDocument(e){return new Gc(e,0,gr.min(),gr.min(),gr.min(),el.empty(),0)}static newFoundDocument(e,r,o,a){return new Gc(e,1,r,gr.min(),o,a,0)}static newNoDocument(e,r){return new Gc(e,2,r,gr.min(),gr.min(),el.empty(),0)}static newUnknownDocument(e,r){return new Gc(e,3,r,gr.min(),gr.min(),el.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(gr.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=el.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=el.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=gr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Gc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Gc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XN{constructor(e,r){this.position=e,this.inclusive=r}}function lZ(t,e,r){let o=0;for(let a=0;a<t.position.length;a++){const u=e[a],d=t.position[a];if(u.field.isKeyField()?o=qn.comparator(qn.fromName(d.referenceValue),r.key):o=DT(d,r.data.field(u.field)),u.dir==="desc"&&(o*=-1),o!==0)break}return o}function dZ(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let r=0;r<t.position.length;r++)if(!Pf(t.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JN{constructor(e,r="asc"){this.field=e,this.dir=r}}function bze(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bae{}class _a extends bae{constructor(e,r,o){super(),this.field=e,this.op=r,this.value=o}static create(e,r,o){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,o):new Cze(e,r,o):r==="array-contains"?new Aze(e,o):r==="in"?new kze(e,o):r==="not-in"?new Oze(e,o):r==="array-contains-any"?new Pze(e,o):new _a(e,r,o)}static createKeyFieldInFilter(e,r,o){return r==="in"?new Rze(e,o):new Ize(e,o)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(DT(r,this.value)):r!==null&&_y(this.value)===_y(r)&&this.matchesComparison(DT(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return lr()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Nf extends bae{constructor(e,r){super(),this.filters=e,this.op=r,this.ae=null}static create(e,r){return new Nf(e,r)}matches(e){return wae(this)?this.filters.find(r=>!r.matches(e))===void 0:this.filters.find(r=>r.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,r)=>e.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function wae(t){return t.op==="and"}function Cae(t){return wze(t)&&wae(t)}function wze(t){for(const e of t.filters)if(e instanceof Nf)return!1;return!0}function ij(t){if(t instanceof _a)return t.field.canonicalString()+t.op.toString()+LT(t.value);if(Cae(t))return t.filters.map(e=>ij(e)).join(",");{const e=t.filters.map(r=>ij(r)).join(",");return`${t.op}(${e})`}}function Rae(t,e){return t instanceof _a?function(o,a){return a instanceof _a&&o.op===a.op&&o.field.isEqual(a.field)&&Pf(o.value,a.value)}(t,e):t instanceof Nf?function(o,a){return a instanceof Nf&&o.op===a.op&&o.filters.length===a.filters.length?o.filters.reduce((u,d,f)=>u&&Rae(d,a.filters[f]),!0):!1}(t,e):void lr()}function Iae(t){return t instanceof _a?function(r){return`${r.field.canonicalString()} ${r.op} ${LT(r.value)}`}(t):t instanceof Nf?function(r){return r.op.toString()+" {"+r.getFilters().map(Iae).join(" ,")+"}"}(t):"Filter"}class Cze extends _a{constructor(e,r,o){super(e,r,o),this.key=qn.fromName(o.referenceValue)}matches(e){const r=qn.comparator(e.key,this.key);return this.matchesComparison(r)}}class Rze extends _a{constructor(e,r){super(e,"in",r),this.keys=Aae("in",r)}matches(e){return this.keys.some(r=>r.isEqual(e.key))}}class Ize extends _a{constructor(e,r){super(e,"not-in",r),this.keys=Aae("not-in",r)}matches(e){return!this.keys.some(r=>r.isEqual(e.key))}}function Aae(t,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(o=>qn.fromName(o.referenceValue))}class Aze extends _a{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return n5(r)&&dR(r.arrayValue,this.value)}}class kze extends _a{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&dR(this.value.arrayValue,r)}}class Oze extends _a{constructor(e,r){super(e,"not-in",r)}matches(e){if(dR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&!dR(this.value.arrayValue,r)}}class Pze extends _a{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!n5(r)||!r.arrayValue.values)&&r.arrayValue.values.some(o=>dR(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nze{constructor(e,r=null,o=[],a=[],u=null,d=null,f=null){this.path=e,this.collectionGroup=r,this.orderBy=o,this.filters=a,this.limit=u,this.startAt=d,this.endAt=f,this.ue=null}}function hZ(t,e=null,r=[],o=[],a=null,u=null,d=null){return new Nze(t,e,r,o,a,u,d)}function r5(t){const e=vr(t);if(e.ue===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(o=>ij(o)).join(","),r+="|ob:",r+=e.orderBy.map(o=>function(u){return u.field.canonicalString()+u.dir}(o)).join(","),nD(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(o=>LT(o)).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(o=>LT(o)).join(",")),e.ue=r}return e.ue}function i5(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<t.orderBy.length;r++)if(!bze(t.orderBy[r],e.orderBy[r]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(!Rae(t.filters[r],e.filters[r]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!dZ(t.startAt,e.startAt)&&dZ(t.endAt,e.endAt)}function sj(t){return qn.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rD{constructor(e,r=null,o=[],a=[],u=null,d="F",f=null,g=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=o,this.filters=a,this.limit=u,this.limitType=d,this.startAt=f,this.endAt=g,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Dze(t,e,r,o,a,u,d,f){return new rD(t,e,r,o,a,u,d,f)}function s5(t){return new rD(t)}function fZ(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Lze(t){return t.collectionGroup!==null}function OC(t){const e=vr(t);if(e.ce===null){e.ce=[];const r=new Set;for(const u of e.explicitOrderBy)e.ce.push(u),r.add(u.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(d){let f=new mc(fc.comparator);return d.filters.forEach(g=>{g.getFlattenedFilters().forEach(E=>{E.isInequality()&&(f=f.add(E.field))})}),f})(e).forEach(u=>{r.has(u.canonicalString())||u.isKeyField()||e.ce.push(new JN(u,o))}),r.has(fc.keyField().canonicalString())||e.ce.push(new JN(fc.keyField(),o))}return e.ce}function Ef(t){const e=vr(t);return e.le||(e.le=xze(e,OC(t))),e.le}function xze(t,e){if(t.limitType==="F")return hZ(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(a=>{const u=a.dir==="desc"?"asc":"desc";return new JN(a.field,u)});const r=t.endAt?new XN(t.endAt.position,t.endAt.inclusive):null,o=t.startAt?new XN(t.startAt.position,t.startAt.inclusive):null;return hZ(t.path,t.collectionGroup,e,t.filters,t.limit,r,o)}}function oj(t,e,r){return new rD(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,r,t.startAt,t.endAt)}function iD(t,e){return i5(Ef(t),Ef(e))&&t.limitType===e.limitType}function kae(t){return`${r5(Ef(t))}|lt:${t.limitType}`}function VS(t){return`Query(target=${function(r){let o=r.path.canonicalString();return r.collectionGroup!==null&&(o+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(o+=`, filters: [${r.filters.map(a=>Iae(a)).join(", ")}]`),nD(r.limit)||(o+=", limit: "+r.limit),r.orderBy.length>0&&(o+=`, orderBy: [${r.orderBy.map(a=>function(d){return`${d.field.canonicalString()} (${d.dir})`}(a)).join(", ")}]`),r.startAt&&(o+=", startAt: ",o+=r.startAt.inclusive?"b:":"a:",o+=r.startAt.position.map(a=>LT(a)).join(",")),r.endAt&&(o+=", endAt: ",o+=r.endAt.inclusive?"a:":"b:",o+=r.endAt.position.map(a=>LT(a)).join(",")),`Target(${o})`}(Ef(t))}; limitType=${t.limitType})`}function sD(t,e){return e.isFoundDocument()&&function(o,a){const u=a.key.path;return o.collectionGroup!==null?a.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(u):qn.isDocumentKey(o.path)?o.path.isEqual(u):o.path.isImmediateParentOf(u)}(t,e)&&function(o,a){for(const u of OC(o))if(!u.field.isKeyField()&&a.data.field(u.field)===null)return!1;return!0}(t,e)&&function(o,a){for(const u of o.filters)if(!u.matches(a))return!1;return!0}(t,e)&&function(o,a){return!(o.startAt&&!function(d,f,g){const E=lZ(d,f,g);return d.inclusive?E<=0:E<0}(o.startAt,OC(o),a)||o.endAt&&!function(d,f,g){const E=lZ(d,f,g);return d.inclusive?E>=0:E>0}(o.endAt,OC(o),a))}(t,e)}function Mze(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Oae(t){return(e,r)=>{let o=!1;for(const a of OC(t)){const u=Uze(a,e,r);if(u!==0)return u;o=o||a.field.isKeyField()}return 0}}function Uze(t,e,r){const o=t.field.isKeyField()?qn.comparator(e.key,r.key):function(u,d,f){const g=d.data.field(u),E=f.data.field(u);return g!==null&&E!==null?DT(g,E):lr()}(t.field,e,r);switch(t.dir){case"asc":return o;case"desc":return-1*o;default:return lr()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e0{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),o=this.inner[r];if(o!==void 0){for(const[a,u]of o)if(this.equalsFn(a,e))return u}}has(e){return this.get(e)!==void 0}set(e,r){const o=this.mapKeyFn(e),a=this.inner[o];if(a===void 0)return this.inner[o]=[[e,r]],void this.innerSize++;for(let u=0;u<a.length;u++)if(this.equalsFn(a[u][0],e))return void(a[u]=[e,r]);a.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),o=this.inner[r];if(o===void 0)return!1;for(let a=0;a<o.length;a++)if(this.equalsFn(o[a][0],e))return o.length===1?delete this.inner[r]:o.splice(a,1),this.innerSize--,!0;return!1}forEach(e){Iy(this.inner,(r,o)=>{for(const[a,u]of o)e(a,u)})}isEmpty(){return Eae(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vze=new Zs(qn.comparator);function Jp(){return Vze}const Pae=new Zs(qn.comparator);function sC(...t){let e=Pae;for(const r of t)e=e.insert(r.key,r);return e}function Nae(t){let e=Pae;return t.forEach((r,o)=>e=e.insert(r,o.overlayedDocument)),e}function z_(){return PC()}function Dae(){return PC()}function PC(){return new e0(t=>t.toString(),(t,e)=>t.isEqual(e))}const Fze=new Zs(qn.comparator),jze=new mc(qn.comparator);function Qr(...t){let e=jze;for(const r of t)e=e.add(r);return e}const Bze=new mc(Ci);function Wze(){return Bze}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o5(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:YN(e)?"-0":e}}function Lae(t){return{integerValue:""+t}}function zze(t,e){return _ze(e)?Lae(e):o5(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oD{constructor(){this._=void 0}}function Gze(t,e,r){return t instanceof QN?function(a,u){const d={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return u&&e5(u)&&(u=t5(u)),u&&(d.fields.__previous_value__=u),{mapValue:d}}(r,e):t instanceof hR?Mae(t,e):t instanceof fR?Uae(t,e):function(a,u){const d=xae(a,u),f=pZ(d)+pZ(a.Pe);return rj(d)&&rj(a.Pe)?Lae(f):o5(a.serializer,f)}(t,e)}function Hze(t,e,r){return t instanceof hR?Mae(t,e):t instanceof fR?Uae(t,e):r}function xae(t,e){return t instanceof ZN?function(o){return rj(o)||function(u){return!!u&&"doubleValue"in u}(o)}(e)?e:{integerValue:0}:null}class QN extends oD{}class hR extends oD{constructor(e){super(),this.elements=e}}function Mae(t,e){const r=Vae(e);for(const o of t.elements)r.some(a=>Pf(a,o))||r.push(o);return{arrayValue:{values:r}}}class fR extends oD{constructor(e){super(),this.elements=e}}function Uae(t,e){let r=Vae(e);for(const o of t.elements)r=r.filter(a=>!Pf(a,o));return{arrayValue:{values:r}}}class ZN extends oD{constructor(e,r){super(),this.serializer=e,this.Pe=r}}function pZ(t){return Po(t.integerValue||t.doubleValue)}function Vae(t){return n5(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Kze(t,e){return t.field.isEqual(e.field)&&function(o,a){return o instanceof hR&&a instanceof hR||o instanceof fR&&a instanceof fR?NT(o.elements,a.elements,Pf):o instanceof ZN&&a instanceof ZN?Pf(o.Pe,a.Pe):o instanceof QN&&a instanceof QN}(t.transform,e.transform)}class qze{constructor(e,r){this.version=e,this.transformResults=r}}class Sf{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new Sf}static exists(e){return new Sf(void 0,e)}static updateTime(e){return new Sf(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function hN(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class aD{}function Fae(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Bae(t.key,Sf.none()):new $R(t.key,t.data,Sf.none());{const r=t.data,o=el.empty();let a=new mc(fc.comparator);for(let u of e.fields)if(!a.has(u)){let d=r.field(u);d===null&&u.length>1&&(u=u.popLast(),d=r.field(u)),d===null?o.delete(u):o.set(u,d),a=a.add(u)}return new ev(t.key,o,new Ml(a.toArray()),Sf.none())}}function $ze(t,e,r){t instanceof $R?function(a,u,d){const f=a.value.clone(),g=gZ(a.fieldTransforms,u,d.transformResults);f.setAll(g),u.convertToFoundDocument(d.version,f).setHasCommittedMutations()}(t,e,r):t instanceof ev?function(a,u,d){if(!hN(a.precondition,u))return void u.convertToUnknownDocument(d.version);const f=gZ(a.fieldTransforms,u,d.transformResults),g=u.data;g.setAll(jae(a)),g.setAll(f),u.convertToFoundDocument(d.version,g).setHasCommittedMutations()}(t,e,r):function(a,u,d){u.convertToNoDocument(d.version).setHasCommittedMutations()}(0,e,r)}function NC(t,e,r,o){return t instanceof $R?function(u,d,f,g){if(!hN(u.precondition,d))return f;const E=u.value.clone(),T=vZ(u.fieldTransforms,g,d);return E.setAll(T),d.convertToFoundDocument(d.version,E).setHasLocalMutations(),null}(t,e,r,o):t instanceof ev?function(u,d,f,g){if(!hN(u.precondition,d))return f;const E=vZ(u.fieldTransforms,g,d),T=d.data;return T.setAll(jae(u)),T.setAll(E),d.convertToFoundDocument(d.version,T).setHasLocalMutations(),f===null?null:f.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map(C=>C.field))}(t,e,r,o):function(u,d,f){return hN(u.precondition,d)?(d.convertToNoDocument(d.version).setHasLocalMutations(),null):f}(t,e,r)}function Yze(t,e){let r=null;for(const o of t.fieldTransforms){const a=e.data.field(o.field),u=xae(o.transform,a||null);u!=null&&(r===null&&(r=el.empty()),r.set(o.field,u))}return r||null}function mZ(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(o,a){return o===void 0&&a===void 0||!(!o||!a)&&NT(o,a,(u,d)=>Kze(u,d))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class $R extends aD{constructor(e,r,o,a=[]){super(),this.key=e,this.value=r,this.precondition=o,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class ev extends aD{constructor(e,r,o,a,u=[]){super(),this.key=e,this.data=r,this.fieldMask=o,this.precondition=a,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function jae(t){const e=new Map;return t.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const o=t.data.field(r);e.set(r,o)}}),e}function gZ(t,e,r){const o=new Map;Zi(t.length===r.length);for(let a=0;a<r.length;a++){const u=t[a],d=u.transform,f=e.data.field(u.field);o.set(u.field,Hze(d,f,r[a]))}return o}function vZ(t,e,r){const o=new Map;for(const a of t){const u=a.transform,d=r.data.field(a.field);o.set(a.field,Gze(u,d,e))}return o}class Bae extends aD{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Xze extends aD{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jze{constructor(e,r,o,a){this.batchId=e,this.localWriteTime=r,this.baseMutations=o,this.mutations=a}applyToRemoteDocument(e,r){const o=r.mutationResults;for(let a=0;a<this.mutations.length;a++){const u=this.mutations[a];u.key.isEqual(e.key)&&$ze(u,e,o[a])}}applyToLocalView(e,r){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(r=NC(o,e,r,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(r=NC(o,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const o=Dae();return this.mutations.forEach(a=>{const u=e.get(a.key),d=u.overlayedDocument;let f=this.applyToLocalView(d,u.mutatedFields);f=r.has(a.key)?null:f;const g=Fae(d,f);g!==null&&o.set(a.key,g),d.isValidDocument()||d.convertToNoDocument(gr.min())}),o}keys(){return this.mutations.reduce((e,r)=>e.add(r.key),Qr())}isEqual(e){return this.batchId===e.batchId&&NT(this.mutations,e.mutations,(r,o)=>mZ(r,o))&&NT(this.baseMutations,e.baseMutations,(r,o)=>mZ(r,o))}}class a5{constructor(e,r,o,a){this.batch=e,this.commitVersion=r,this.mutationResults=o,this.docVersions=a}static from(e,r,o){Zi(e.mutations.length===o.length);let a=function(){return Fze}();const u=e.mutations;for(let d=0;d<u.length;d++)a=a.insert(u[d].key,o[d].version);return new a5(e,r,o,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qze{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zze{constructor(e,r){this.count=e,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qo,hi;function eGe(t){switch(t){default:return lr();case Mt.CANCELLED:case Mt.UNKNOWN:case Mt.DEADLINE_EXCEEDED:case Mt.RESOURCE_EXHAUSTED:case Mt.INTERNAL:case Mt.UNAVAILABLE:case Mt.UNAUTHENTICATED:return!1;case Mt.INVALID_ARGUMENT:case Mt.NOT_FOUND:case Mt.ALREADY_EXISTS:case Mt.PERMISSION_DENIED:case Mt.FAILED_PRECONDITION:case Mt.ABORTED:case Mt.OUT_OF_RANGE:case Mt.UNIMPLEMENTED:case Mt.DATA_LOSS:return!0}}function Wae(t){if(t===void 0)return Xp("GRPC error has no .code"),Mt.UNKNOWN;switch(t){case qo.OK:return Mt.OK;case qo.CANCELLED:return Mt.CANCELLED;case qo.UNKNOWN:return Mt.UNKNOWN;case qo.DEADLINE_EXCEEDED:return Mt.DEADLINE_EXCEEDED;case qo.RESOURCE_EXHAUSTED:return Mt.RESOURCE_EXHAUSTED;case qo.INTERNAL:return Mt.INTERNAL;case qo.UNAVAILABLE:return Mt.UNAVAILABLE;case qo.UNAUTHENTICATED:return Mt.UNAUTHENTICATED;case qo.INVALID_ARGUMENT:return Mt.INVALID_ARGUMENT;case qo.NOT_FOUND:return Mt.NOT_FOUND;case qo.ALREADY_EXISTS:return Mt.ALREADY_EXISTS;case qo.PERMISSION_DENIED:return Mt.PERMISSION_DENIED;case qo.FAILED_PRECONDITION:return Mt.FAILED_PRECONDITION;case qo.ABORTED:return Mt.ABORTED;case qo.OUT_OF_RANGE:return Mt.OUT_OF_RANGE;case qo.UNIMPLEMENTED:return Mt.UNIMPLEMENTED;case qo.DATA_LOSS:return Mt.DATA_LOSS;default:return lr()}}(hi=qo||(qo={}))[hi.OK=0]="OK",hi[hi.CANCELLED=1]="CANCELLED",hi[hi.UNKNOWN=2]="UNKNOWN",hi[hi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",hi[hi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",hi[hi.NOT_FOUND=5]="NOT_FOUND",hi[hi.ALREADY_EXISTS=6]="ALREADY_EXISTS",hi[hi.PERMISSION_DENIED=7]="PERMISSION_DENIED",hi[hi.UNAUTHENTICATED=16]="UNAUTHENTICATED",hi[hi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",hi[hi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",hi[hi.ABORTED=10]="ABORTED",hi[hi.OUT_OF_RANGE=11]="OUT_OF_RANGE",hi[hi.UNIMPLEMENTED=12]="UNIMPLEMENTED",hi[hi.INTERNAL=13]="INTERNAL",hi[hi.UNAVAILABLE=14]="UNAVAILABLE",hi[hi.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tGe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nGe=new ey([4294967295,4294967295],0);function _Z(t){const e=tGe().encode(t),r=new hae;return r.update(e),new Uint8Array(r.digest())}function yZ(t){const e=new DataView(t.buffer),r=e.getUint32(0,!0),o=e.getUint32(4,!0),a=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new ey([r,o],0),new ey([a,u],0)]}class c5{constructor(e,r,o){if(this.bitmap=e,this.padding=r,this.hashCount=o,r<0||r>=8)throw new oC(`Invalid padding: ${r}`);if(o<0)throw new oC(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new oC(`Invalid hash count: ${o}`);if(e.length===0&&r!==0)throw new oC(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*e.length-r,this.Te=ey.fromNumber(this.Ie)}Ee(e,r,o){let a=e.add(r.multiply(ey.fromNumber(o)));return a.compare(nGe)===1&&(a=new ey([a.getBits(0),a.getBits(1)],0)),a.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const r=_Z(e),[o,a]=yZ(r);for(let u=0;u<this.hashCount;u++){const d=this.Ee(o,a,u);if(!this.de(d))return!1}return!0}static create(e,r,o){const a=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),d=new c5(u,a,r);return o.forEach(f=>d.insert(f)),d}insert(e){if(this.Ie===0)return;const r=_Z(e),[o,a]=yZ(r);for(let u=0;u<this.hashCount;u++){const d=this.Ee(o,a,u);this.Ae(d)}}Ae(e){const r=Math.floor(e/8),o=e%8;this.bitmap[r]|=1<<o}}class oC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cD{constructor(e,r,o,a,u){this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=o,this.documentUpdates=a,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,r,o){const a=new Map;return a.set(e,YR.createSynthesizedTargetChangeForCurrentChange(e,r,o)),new cD(gr.min(),a,new Zs(Ci),Jp(),Qr())}}class YR{constructor(e,r,o,a,u){this.resumeToken=e,this.current=r,this.addedDocuments=o,this.modifiedDocuments=a,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,r,o){return new YR(o,r,Qr(),Qr(),Qr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fN{constructor(e,r,o,a){this.Re=e,this.removedTargetIds=r,this.key=o,this.Ve=a}}class zae{constructor(e,r){this.targetId=e,this.me=r}}class Gae{constructor(e,r,o=gc.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=r,this.resumeToken=o,this.cause=a}}class EZ{constructor(){this.fe=0,this.ge=TZ(),this.pe=gc.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Qr(),r=Qr(),o=Qr();return this.ge.forEach((a,u)=>{switch(u){case 0:e=e.add(a);break;case 2:r=r.add(a);break;case 1:o=o.add(a);break;default:lr()}}),new YR(this.pe,this.ye,e,r,o)}Ce(){this.we=!1,this.ge=TZ()}Fe(e,r){this.we=!0,this.ge=this.ge.insert(e,r)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Zi(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class rGe{constructor(e){this.Le=e,this.Be=new Map,this.ke=Jp(),this.qe=SZ(),this.Qe=new Zs(Ci)}Ke(e){for(const r of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve);for(const r of e.removedTargetIds)this.Ue(r,e.key,e.Ve)}We(e){this.forEachTarget(e,r=>{const o=this.Ge(r);switch(e.state){case 0:this.ze(r)&&o.De(e.resumeToken);break;case 1:o.Oe(),o.Se||o.Ce(),o.De(e.resumeToken);break;case 2:o.Oe(),o.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(o.Ne(),o.De(e.resumeToken));break;case 4:this.ze(r)&&(this.je(r),o.De(e.resumeToken));break;default:lr()}})}forEachTarget(e,r){e.targetIds.length>0?e.targetIds.forEach(r):this.Be.forEach((o,a)=>{this.ze(a)&&r(a)})}He(e){const r=e.targetId,o=e.me.count,a=this.Je(r);if(a){const u=a.target;if(sj(u))if(o===0){const d=new qn(u.path);this.Ue(r,d,Gc.newNoDocument(d,gr.min()))}else Zi(o===1);else{const d=this.Ye(r);if(d!==o){const f=this.Ze(e),g=f?this.Xe(f,e,d):1;if(g!==0){this.je(r);const E=g===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,E)}}}}}Ze(e){const r=e.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:o="",padding:a=0},hashCount:u=0}=r;let d,f;try{d=vy(o).toUint8Array()}catch(g){if(g instanceof Sae)return PT("Decoding the base64 bloom filter in existence filter failed ("+g.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw g}try{f=new c5(d,a,u)}catch(g){return PT(g instanceof oC?"BloomFilter error: ":"Applying bloom filter failed: ",g),null}return f.Ie===0?null:f}Xe(e,r,o){return r.me.count===o-this.nt(e,r.targetId)?0:2}nt(e,r){const o=this.Le.getRemoteKeysForTarget(r);let a=0;return o.forEach(u=>{const d=this.Le.tt(),f=`projects/${d.projectId}/databases/${d.database}/documents/${u.path.canonicalString()}`;e.mightContain(f)||(this.Ue(r,u,null),a++)}),a}rt(e){const r=new Map;this.Be.forEach((u,d)=>{const f=this.Je(d);if(f){if(u.current&&sj(f.target)){const g=new qn(f.target.path);this.ke.get(g)!==null||this.it(d,g)||this.Ue(d,g,Gc.newNoDocument(g,e))}u.be&&(r.set(d,u.ve()),u.Ce())}});let o=Qr();this.qe.forEach((u,d)=>{let f=!0;d.forEachWhile(g=>{const E=this.Je(g);return!E||E.purpose==="TargetPurposeLimboResolution"||(f=!1,!1)}),f&&(o=o.add(u))}),this.ke.forEach((u,d)=>d.setReadTime(e));const a=new cD(e,r,this.Qe,this.ke,o);return this.ke=Jp(),this.qe=SZ(),this.Qe=new Zs(Ci),a}$e(e,r){if(!this.ze(e))return;const o=this.it(e,r.key)?2:0;this.Ge(e).Fe(r.key,o),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(e))}Ue(e,r,o){if(!this.ze(e))return;const a=this.Ge(e);this.it(e,r)?a.Fe(r,1):a.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(e)),o&&(this.ke=this.ke.insert(r,o))}removeTarget(e){this.Be.delete(e)}Ye(e){const r=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let r=this.Be.get(e);return r||(r=new EZ,this.Be.set(e,r)),r}st(e){let r=this.qe.get(e);return r||(r=new mc(Ci),this.qe=this.qe.insert(e,r)),r}ze(e){const r=this.Je(e)!==null;return r||En("WatchChangeAggregator","Detected inactive target",e),r}Je(e){const r=this.Be.get(e);return r&&r.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new EZ),this.Le.getRemoteKeysForTarget(e).forEach(r=>{this.Ue(e,r,null)})}it(e,r){return this.Le.getRemoteKeysForTarget(e).has(r)}}function SZ(){return new Zs(qn.comparator)}function TZ(){return new Zs(qn.comparator)}const iGe={asc:"ASCENDING",desc:"DESCENDING"},sGe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oGe={and:"AND",or:"OR"};class aGe{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function aj(t,e){return t.useProto3Json||nD(e)?e:{value:e}}function e1(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Hae(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function cGe(t,e){return e1(t,e.toTimestamp())}function Tf(t){return Zi(!!t),gr.fromTimestamp(function(r){const o=Wg(r);return new ya(o.seconds,o.nanos)}(t))}function u5(t,e){return cj(t,e).canonicalString()}function cj(t,e){const r=function(a){return new js(["projects",a.projectId,"databases",a.database])}(t).child("documents");return e===void 0?r:r.child(e)}function Kae(t){const e=js.fromString(t);return Zi(Jae(e)),e}function uj(t,e){return u5(t.databaseId,e.path)}function y2(t,e){const r=Kae(e);if(r.get(1)!==t.databaseId.projectId)throw new Rn(Mt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+t.databaseId.projectId);if(r.get(3)!==t.databaseId.database)throw new Rn(Mt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+t.databaseId.database);return new qn($ae(r))}function qae(t,e){return u5(t.databaseId,e)}function uGe(t){const e=Kae(t);return e.length===4?js.emptyPath():$ae(e)}function lj(t){return new js(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function $ae(t){return Zi(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function bZ(t,e,r){return{name:uj(t,e),fields:r.value.mapValue.fields}}function lGe(t,e){let r;if("targetChange"in e){e.targetChange;const o=function(E){return E==="NO_CHANGE"?0:E==="ADD"?1:E==="REMOVE"?2:E==="CURRENT"?3:E==="RESET"?4:lr()}(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],u=function(E,T){return E.useProto3Json?(Zi(T===void 0||typeof T=="string"),gc.fromBase64String(T||"")):(Zi(T===void 0||T instanceof Buffer||T instanceof Uint8Array),gc.fromUint8Array(T||new Uint8Array))}(t,e.targetChange.resumeToken),d=e.targetChange.cause,f=d&&function(E){const T=E.code===void 0?Mt.UNKNOWN:Wae(E.code);return new Rn(T,E.message||"")}(d);r=new Gae(o,a,u,f||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const a=y2(t,o.document.name),u=Tf(o.document.updateTime),d=o.document.createTime?Tf(o.document.createTime):gr.min(),f=new el({mapValue:{fields:o.document.fields}}),g=Gc.newFoundDocument(a,u,d,f),E=o.targetIds||[],T=o.removedTargetIds||[];r=new fN(E,T,g.key,g)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const a=y2(t,o.document),u=o.readTime?Tf(o.readTime):gr.min(),d=Gc.newNoDocument(a,u),f=o.removedTargetIds||[];r=new fN([],f,d.key,d)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const a=y2(t,o.document),u=o.removedTargetIds||[];r=new fN([],u,a,null)}else{if(!("filter"in e))return lr();{e.filter;const o=e.filter;o.targetId;const{count:a=0,unchangedNames:u}=o,d=new Zze(a,u),f=o.targetId;r=new zae(f,d)}}return r}function dGe(t,e){let r;if(e instanceof $R)r={update:bZ(t,e.key,e.value)};else if(e instanceof Bae)r={delete:uj(t,e.key)};else if(e instanceof ev)r={update:bZ(t,e.key,e.data),updateMask:EGe(e.fieldMask)};else{if(!(e instanceof Xze))return lr();r={verify:uj(t,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(o=>function(u,d){const f=d.transform;if(f instanceof QN)return{fieldPath:d.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(f instanceof hR)return{fieldPath:d.field.canonicalString(),appendMissingElements:{values:f.elements}};if(f instanceof fR)return{fieldPath:d.field.canonicalString(),removeAllFromArray:{values:f.elements}};if(f instanceof ZN)return{fieldPath:d.field.canonicalString(),increment:f.Pe};throw lr()}(0,o))),e.precondition.isNone||(r.currentDocument=function(a,u){return u.updateTime!==void 0?{updateTime:cGe(a,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:lr()}(t,e.precondition)),r}function hGe(t,e){return t&&t.length>0?(Zi(e!==void 0),t.map(r=>function(a,u){let d=a.updateTime?Tf(a.updateTime):Tf(u);return d.isEqual(gr.min())&&(d=Tf(u)),new qze(d,a.transformResults||[])}(r,e))):[]}function fGe(t,e){return{documents:[qae(t,e.path)]}}function pGe(t,e){const r={structuredQuery:{}},o=e.path;let a;e.collectionGroup!==null?(a=o,r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=o.popLast(),r.structuredQuery.from=[{collectionId:o.lastSegment()}]),r.parent=qae(t,a);const u=function(E){if(E.length!==0)return Xae(Nf.create(E,"and"))}(e.filters);u&&(r.structuredQuery.where=u);const d=function(E){if(E.length!==0)return E.map(T=>function(I){return{field:FS(I.field),direction:vGe(I.dir)}}(T))}(e.orderBy);d&&(r.structuredQuery.orderBy=d);const f=aj(t,e.limit);return f!==null&&(r.structuredQuery.limit=f),e.startAt&&(r.structuredQuery.startAt=function(E){return{before:E.inclusive,values:E.position}}(e.startAt)),e.endAt&&(r.structuredQuery.endAt=function(E){return{before:!E.inclusive,values:E.position}}(e.endAt)),{_t:r,parent:a}}function mGe(t){let e=uGe(t.parent);const r=t.structuredQuery,o=r.from?r.from.length:0;let a=null;if(o>0){Zi(o===1);const T=r.from[0];T.allDescendants?a=T.collectionId:e=e.child(T.collectionId)}let u=[];r.where&&(u=function(C){const I=Yae(C);return I instanceof Nf&&Cae(I)?I.getFilters():[I]}(r.where));let d=[];r.orderBy&&(d=function(C){return C.map(I=>function(L){return new JN(jS(L.field),function(G){switch(G){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction))}(I))}(r.orderBy));let f=null;r.limit&&(f=function(C){let I;return I=typeof C=="object"?C.value:C,nD(I)?null:I}(r.limit));let g=null;r.startAt&&(g=function(C){const I=!!C.before,D=C.values||[];return new XN(D,I)}(r.startAt));let E=null;return r.endAt&&(E=function(C){const I=!C.before,D=C.values||[];return new XN(D,I)}(r.endAt)),Dze(e,a,d,u,f,"F",g,E)}function gGe(t,e){const r=function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return lr()}}(e.purpose);return r==null?null:{"goog-listen-tags":r}}function Yae(t){return t.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const o=jS(r.unaryFilter.field);return _a.create(o,"==",{doubleValue:NaN});case"IS_NULL":const a=jS(r.unaryFilter.field);return _a.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=jS(r.unaryFilter.field);return _a.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const d=jS(r.unaryFilter.field);return _a.create(d,"!=",{nullValue:"NULL_VALUE"});default:return lr()}}(t):t.fieldFilter!==void 0?function(r){return _a.create(jS(r.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return lr()}}(r.fieldFilter.op),r.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(r){return Nf.create(r.compositeFilter.filters.map(o=>Yae(o)),function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return lr()}}(r.compositeFilter.op))}(t):lr()}function vGe(t){return iGe[t]}function _Ge(t){return sGe[t]}function yGe(t){return oGe[t]}function FS(t){return{fieldPath:t.canonicalString()}}function jS(t){return fc.fromServerFormat(t.fieldPath)}function Xae(t){return t instanceof _a?function(r){if(r.op==="=="){if(uZ(r.value))return{unaryFilter:{field:FS(r.field),op:"IS_NAN"}};if(cZ(r.value))return{unaryFilter:{field:FS(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(uZ(r.value))return{unaryFilter:{field:FS(r.field),op:"IS_NOT_NAN"}};if(cZ(r.value))return{unaryFilter:{field:FS(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:FS(r.field),op:_Ge(r.op),value:r.value}}}(t):t instanceof Nf?function(r){const o=r.getFilters().map(a=>Xae(a));return o.length===1?o[0]:{compositeFilter:{op:yGe(r.op),filters:o}}}(t):lr()}function EGe(t){const e=[];return t.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function Jae(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg{constructor(e,r,o,a,u=gr.min(),d=gr.min(),f=gc.EMPTY_BYTE_STRING,g=null){this.target=e,this.targetId=r,this.purpose=o,this.sequenceNumber=a,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=d,this.resumeToken=f,this.expectedCount=g}withSequenceNumber(e){return new bg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,r){return new bg(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new bg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new bg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SGe{constructor(e){this.ct=e}}function TGe(t){const e=mGe({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?oj(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bGe{constructor(){this.un=new wGe}addToCollectionParentIndex(e,r){return this.un.add(r),Ut.resolve()}getCollectionParents(e,r){return Ut.resolve(this.un.getEntries(r))}addFieldIndex(e,r){return Ut.resolve()}deleteFieldIndex(e,r){return Ut.resolve()}deleteAllFieldIndexes(e){return Ut.resolve()}createTargetIndexes(e,r){return Ut.resolve()}getDocumentsMatchingTarget(e,r){return Ut.resolve(null)}getIndexType(e,r){return Ut.resolve(0)}getFieldIndexes(e,r){return Ut.resolve([])}getNextCollectionGroupToUpdate(e){return Ut.resolve(null)}getMinOffset(e,r){return Ut.resolve(Bg.min())}getMinOffsetFromCollectionGroup(e,r){return Ut.resolve(Bg.min())}updateCollectionGroup(e,r,o){return Ut.resolve()}updateIndexEntries(e,r){return Ut.resolve()}}class wGe{constructor(){this.index={}}add(e){const r=e.lastSegment(),o=e.popLast(),a=this.index[r]||new mc(js.comparator),u=!a.has(o);return this.index[r]=a.add(o),u}has(e){const r=e.lastSegment(),o=e.popLast(),a=this.index[r];return a&&a.has(o)}getEntries(e){return(this.index[e]||new mc(js.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xT{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new xT(0)}static kn(){return new xT(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CGe{constructor(){this.changes=new e0(e=>e.toString(),(e,r)=>e.isEqual(r)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,Gc.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const o=this.changes.get(r);return o!==void 0?Ut.resolve(o):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RGe{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IGe{constructor(e,r,o,a){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=o,this.indexManager=a}getDocument(e,r){let o=null;return this.documentOverlayCache.getOverlay(e,r).next(a=>(o=a,this.remoteDocumentCache.getEntry(e,r))).next(a=>(o!==null&&NC(o.mutation,a,Ml.empty(),ya.now()),a))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next(o=>this.getLocalViewOfDocuments(e,o,Qr()).next(()=>o))}getLocalViewOfDocuments(e,r,o=Qr()){const a=z_();return this.populateOverlays(e,a,r).next(()=>this.computeViews(e,r,a,o).next(u=>{let d=sC();return u.forEach((f,g)=>{d=d.insert(f,g.overlayedDocument)}),d}))}getOverlayedDocuments(e,r){const o=z_();return this.populateOverlays(e,o,r).next(()=>this.computeViews(e,r,o,Qr()))}populateOverlays(e,r,o){const a=[];return o.forEach(u=>{r.has(u)||a.push(u)}),this.documentOverlayCache.getOverlays(e,a).next(u=>{u.forEach((d,f)=>{r.set(d,f)})})}computeViews(e,r,o,a){let u=Jp();const d=PC(),f=function(){return PC()}();return r.forEach((g,E)=>{const T=o.get(E.key);a.has(E.key)&&(T===void 0||T.mutation instanceof ev)?u=u.insert(E.key,E):T!==void 0?(d.set(E.key,T.mutation.getFieldMask()),NC(T.mutation,E,T.mutation.getFieldMask(),ya.now())):d.set(E.key,Ml.empty())}),this.recalculateAndSaveOverlays(e,u).next(g=>(g.forEach((E,T)=>d.set(E,T)),r.forEach((E,T)=>{var C;return f.set(E,new RGe(T,(C=d.get(E))!==null&&C!==void 0?C:null))}),f))}recalculateAndSaveOverlays(e,r){const o=PC();let a=new Zs((d,f)=>d-f),u=Qr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next(d=>{for(const f of d)f.keys().forEach(g=>{const E=r.get(g);if(E===null)return;let T=o.get(g)||Ml.empty();T=f.applyToLocalView(E,T),o.set(g,T);const C=(a.get(f.batchId)||Qr()).add(g);a=a.insert(f.batchId,C)})}).next(()=>{const d=[],f=a.getReverseIterator();for(;f.hasNext();){const g=f.getNext(),E=g.key,T=g.value,C=Dae();T.forEach(I=>{if(!u.has(I)){const D=Fae(r.get(I),o.get(I));D!==null&&C.set(I,D),u=u.add(I)}}),d.push(this.documentOverlayCache.saveOverlays(e,E,C))}return Ut.waitFor(d)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,r,o,a){return function(d){return qn.isDocumentKey(d.path)&&d.collectionGroup===null&&d.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):Lze(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,o,a):this.getDocumentsMatchingCollectionQuery(e,r,o,a)}getNextDocuments(e,r,o,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,o,a).next(u=>{const d=a-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,o.largestBatchId,a-u.size):Ut.resolve(z_());let f=-1,g=u;return d.next(E=>Ut.forEach(E,(T,C)=>(f<C.largestBatchId&&(f=C.largestBatchId),u.get(T)?Ut.resolve():this.remoteDocumentCache.getEntry(e,T).next(I=>{g=g.insert(T,I)}))).next(()=>this.populateOverlays(e,E,u)).next(()=>this.computeViews(e,g,E,Qr())).next(T=>({batchId:f,changes:Nae(T)})))})}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new qn(r)).next(o=>{let a=sC();return o.isFoundDocument()&&(a=a.insert(o.key,o)),a})}getDocumentsMatchingCollectionGroupQuery(e,r,o,a){const u=r.collectionGroup;let d=sC();return this.indexManager.getCollectionParents(e,u).next(f=>Ut.forEach(f,g=>{const E=function(C,I){return new rD(I,null,C.explicitOrderBy.slice(),C.filters.slice(),C.limit,C.limitType,C.startAt,C.endAt)}(r,g.child(u));return this.getDocumentsMatchingCollectionQuery(e,E,o,a).next(T=>{T.forEach((C,I)=>{d=d.insert(C,I)})})}).next(()=>d))}getDocumentsMatchingCollectionQuery(e,r,o,a){let u;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,o.largestBatchId).next(d=>(u=d,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,o,u,a))).next(d=>{u.forEach((g,E)=>{const T=E.getKey();d.get(T)===null&&(d=d.insert(T,Gc.newInvalidDocument(T)))});let f=sC();return d.forEach((g,E)=>{const T=u.get(g);T!==void 0&&NC(T.mutation,E,Ml.empty(),ya.now()),sD(r,E)&&(f=f.insert(g,E))}),f})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AGe{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,r){return Ut.resolve(this.hr.get(r))}saveBundleMetadata(e,r){return this.hr.set(r.id,function(a){return{id:a.id,version:a.version,createTime:Tf(a.createTime)}}(r)),Ut.resolve()}getNamedQuery(e,r){return Ut.resolve(this.Pr.get(r))}saveNamedQuery(e,r){return this.Pr.set(r.name,function(a){return{name:a.name,query:TGe(a.bundledQuery),readTime:Tf(a.readTime)}}(r)),Ut.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kGe{constructor(){this.overlays=new Zs(qn.comparator),this.Ir=new Map}getOverlay(e,r){return Ut.resolve(this.overlays.get(r))}getOverlays(e,r){const o=z_();return Ut.forEach(r,a=>this.getOverlay(e,a).next(u=>{u!==null&&o.set(a,u)})).next(()=>o)}saveOverlays(e,r,o){return o.forEach((a,u)=>{this.ht(e,r,u)}),Ut.resolve()}removeOverlaysForBatchId(e,r,o){const a=this.Ir.get(o);return a!==void 0&&(a.forEach(u=>this.overlays=this.overlays.remove(u)),this.Ir.delete(o)),Ut.resolve()}getOverlaysForCollection(e,r,o){const a=z_(),u=r.length+1,d=new qn(r.child("")),f=this.overlays.getIteratorFrom(d);for(;f.hasNext();){const g=f.getNext().value,E=g.getKey();if(!r.isPrefixOf(E.path))break;E.path.length===u&&g.largestBatchId>o&&a.set(g.getKey(),g)}return Ut.resolve(a)}getOverlaysForCollectionGroup(e,r,o,a){let u=new Zs((E,T)=>E-T);const d=this.overlays.getIterator();for(;d.hasNext();){const E=d.getNext().value;if(E.getKey().getCollectionGroup()===r&&E.largestBatchId>o){let T=u.get(E.largestBatchId);T===null&&(T=z_(),u=u.insert(E.largestBatchId,T)),T.set(E.getKey(),E)}}const f=z_(),g=u.getIterator();for(;g.hasNext()&&(g.getNext().value.forEach((E,T)=>f.set(E,T)),!(f.size()>=a)););return Ut.resolve(f)}ht(e,r,o){const a=this.overlays.get(o.key);if(a!==null){const d=this.Ir.get(a.largestBatchId).delete(o.key);this.Ir.set(a.largestBatchId,d)}this.overlays=this.overlays.insert(o.key,new Qze(r,o));let u=this.Ir.get(r);u===void 0&&(u=Qr(),this.Ir.set(r,u)),this.Ir.set(r,u.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OGe{constructor(){this.sessionToken=gc.EMPTY_BYTE_STRING}getSessionToken(e){return Ut.resolve(this.sessionToken)}setSessionToken(e,r){return this.sessionToken=r,Ut.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5{constructor(){this.Tr=new mc(Va.Er),this.dr=new mc(Va.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,r){const o=new Va(e,r);this.Tr=this.Tr.add(o),this.dr=this.dr.add(o)}Rr(e,r){e.forEach(o=>this.addReference(o,r))}removeReference(e,r){this.Vr(new Va(e,r))}mr(e,r){e.forEach(o=>this.removeReference(o,r))}gr(e){const r=new qn(new js([])),o=new Va(r,e),a=new Va(r,e+1),u=[];return this.dr.forEachInRange([o,a],d=>{this.Vr(d),u.push(d.key)}),u}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const r=new qn(new js([])),o=new Va(r,e),a=new Va(r,e+1);let u=Qr();return this.dr.forEachInRange([o,a],d=>{u=u.add(d.key)}),u}containsKey(e){const r=new Va(e,0),o=this.Tr.firstAfterOrEqual(r);return o!==null&&e.isEqual(o.key)}}class Va{constructor(e,r){this.key=e,this.wr=r}static Er(e,r){return qn.comparator(e.key,r.key)||Ci(e.wr,r.wr)}static Ar(e,r){return Ci(e.wr,r.wr)||qn.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PGe{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new mc(Va.Er)}checkEmpty(e){return Ut.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,o,a){const u=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const d=new Jze(u,r,o,a);this.mutationQueue.push(d);for(const f of a)this.br=this.br.add(new Va(f.key,u)),this.indexManager.addToCollectionParentIndex(e,f.key.path.popLast());return Ut.resolve(d)}lookupMutationBatch(e,r){return Ut.resolve(this.Dr(r))}getNextMutationBatchAfterBatchId(e,r){const o=r+1,a=this.vr(o),u=a<0?0:a;return Ut.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return Ut.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return Ut.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const o=new Va(r,0),a=new Va(r,Number.POSITIVE_INFINITY),u=[];return this.br.forEachInRange([o,a],d=>{const f=this.Dr(d.wr);u.push(f)}),Ut.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,r){let o=new mc(Ci);return r.forEach(a=>{const u=new Va(a,0),d=new Va(a,Number.POSITIVE_INFINITY);this.br.forEachInRange([u,d],f=>{o=o.add(f.wr)})}),Ut.resolve(this.Cr(o))}getAllMutationBatchesAffectingQuery(e,r){const o=r.path,a=o.length+1;let u=o;qn.isDocumentKey(u)||(u=u.child(""));const d=new Va(new qn(u),0);let f=new mc(Ci);return this.br.forEachWhile(g=>{const E=g.key.path;return!!o.isPrefixOf(E)&&(E.length===a&&(f=f.add(g.wr)),!0)},d),Ut.resolve(this.Cr(f))}Cr(e){const r=[];return e.forEach(o=>{const a=this.Dr(o);a!==null&&r.push(a)}),r}removeMutationBatch(e,r){Zi(this.Fr(r.batchId,"removed")===0),this.mutationQueue.shift();let o=this.br;return Ut.forEach(r.mutations,a=>{const u=new Va(a.key,r.batchId);return o=o.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)}).next(()=>{this.br=o})}On(e){}containsKey(e,r){const o=new Va(r,0),a=this.br.firstAfterOrEqual(o);return Ut.resolve(r.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ut.resolve()}Fr(e,r){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const r=this.vr(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NGe{constructor(e){this.Mr=e,this.docs=function(){return new Zs(qn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const o=r.key,a=this.docs.get(o),u=a?a.size:0,d=this.Mr(r);return this.docs=this.docs.insert(o,{document:r.mutableCopy(),size:d}),this.size+=d-u,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const o=this.docs.get(r);return Ut.resolve(o?o.document.mutableCopy():Gc.newInvalidDocument(r))}getEntries(e,r){let o=Jp();return r.forEach(a=>{const u=this.docs.get(a);o=o.insert(a,u?u.document.mutableCopy():Gc.newInvalidDocument(a))}),Ut.resolve(o)}getDocumentsMatchingQuery(e,r,o,a){let u=Jp();const d=r.path,f=new qn(d.child("")),g=this.docs.getIteratorFrom(f);for(;g.hasNext();){const{key:E,value:{document:T}}=g.getNext();if(!d.isPrefixOf(E.path))break;E.path.length>d.length+1||pze(fze(T),o)<=0||(a.has(T.key)||sD(r,T))&&(u=u.insert(T.key,T.mutableCopy()))}return Ut.resolve(u)}getAllFromCollectionGroup(e,r,o,a){lr()}Or(e,r){return Ut.forEach(this.docs,o=>r(o))}newChangeBuffer(e){return new DGe(this)}getSize(e){return Ut.resolve(this.size)}}class DGe extends CGe{constructor(e){super(),this.cr=e}applyChanges(e){const r=[];return this.changes.forEach((o,a)=>{a.isValidDocument()?r.push(this.cr.addEntry(e,a)):this.cr.removeEntry(o)}),Ut.waitFor(r)}getFromCache(e,r){return this.cr.getEntry(e,r)}getAllFromCache(e,r){return this.cr.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LGe{constructor(e){this.persistence=e,this.Nr=new e0(r=>r5(r),i5),this.lastRemoteSnapshotVersion=gr.min(),this.highestTargetId=0,this.Lr=0,this.Br=new l5,this.targetCount=0,this.kr=xT.Bn()}forEachTarget(e,r){return this.Nr.forEach((o,a)=>r(a)),Ut.resolve()}getLastRemoteSnapshotVersion(e){return Ut.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ut.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),Ut.resolve(this.highestTargetId)}setTargetsMetadata(e,r,o){return o&&(this.lastRemoteSnapshotVersion=o),r>this.Lr&&(this.Lr=r),Ut.resolve()}Kn(e){this.Nr.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.kr=new xT(r),this.highestTargetId=r),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,r){return this.Kn(r),this.targetCount+=1,Ut.resolve()}updateTargetData(e,r){return this.Kn(r),Ut.resolve()}removeTargetData(e,r){return this.Nr.delete(r.target),this.Br.gr(r.targetId),this.targetCount-=1,Ut.resolve()}removeTargets(e,r,o){let a=0;const u=[];return this.Nr.forEach((d,f)=>{f.sequenceNumber<=r&&o.get(f.targetId)===null&&(this.Nr.delete(d),u.push(this.removeMatchingKeysForTargetId(e,f.targetId)),a++)}),Ut.waitFor(u).next(()=>a)}getTargetCount(e){return Ut.resolve(this.targetCount)}getTargetData(e,r){const o=this.Nr.get(r)||null;return Ut.resolve(o)}addMatchingKeys(e,r,o){return this.Br.Rr(r,o),Ut.resolve()}removeMatchingKeys(e,r,o){this.Br.mr(r,o);const a=this.persistence.referenceDelegate,u=[];return a&&r.forEach(d=>{u.push(a.markPotentiallyOrphaned(e,d))}),Ut.waitFor(u)}removeMatchingKeysForTargetId(e,r){return this.Br.gr(r),Ut.resolve()}getMatchingKeysForTargetId(e,r){const o=this.Br.yr(r);return Ut.resolve(o)}containsKey(e,r){return Ut.resolve(this.Br.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xGe{constructor(e,r){this.qr={},this.overlays={},this.Qr=new Z4(0),this.Kr=!1,this.Kr=!0,this.$r=new OGe,this.referenceDelegate=e(this),this.Ur=new LGe(this),this.indexManager=new bGe,this.remoteDocumentCache=function(a){return new NGe(a)}(o=>this.referenceDelegate.Wr(o)),this.serializer=new SGe(r),this.Gr=new AGe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new kGe,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let o=this.qr[e.toKey()];return o||(o=new PGe(r,this.referenceDelegate),this.qr[e.toKey()]=o),o}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,r,o){En("MemoryPersistence","Starting transaction:",e);const a=new MGe(this.Qr.next());return this.referenceDelegate.zr(),o(a).next(u=>this.referenceDelegate.jr(a).next(()=>u)).toPromise().then(u=>(a.raiseOnCommittedEvent(),u))}Hr(e,r){return Ut.or(Object.values(this.qr).map(o=>()=>o.containsKey(e,r)))}}class MGe extends gze{constructor(e){super(),this.currentSequenceNumber=e}}class d5{constructor(e){this.persistence=e,this.Jr=new l5,this.Yr=null}static Zr(e){return new d5(e)}get Xr(){if(this.Yr)return this.Yr;throw lr()}addReference(e,r,o){return this.Jr.addReference(o,r),this.Xr.delete(o.toString()),Ut.resolve()}removeReference(e,r,o){return this.Jr.removeReference(o,r),this.Xr.add(o.toString()),Ut.resolve()}markPotentiallyOrphaned(e,r){return this.Xr.add(r.toString()),Ut.resolve()}removeTarget(e,r){this.Jr.gr(r.targetId).forEach(a=>this.Xr.add(a.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,r.targetId).next(a=>{a.forEach(u=>this.Xr.add(u.toString()))}).next(()=>o.removeTargetData(e,r))}zr(){this.Yr=new Set}jr(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ut.forEach(this.Xr,o=>{const a=qn.fromPath(o);return this.ei(e,a).next(u=>{u||r.removeEntry(a,gr.min())})}).next(()=>(this.Yr=null,r.apply(e)))}updateLimboDocument(e,r){return this.ei(e,r).next(o=>{o?this.Xr.delete(r.toString()):this.Xr.add(r.toString())})}Wr(e){return 0}ei(e,r){return Ut.or([()=>Ut.resolve(this.Jr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Hr(e,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{constructor(e,r,o,a){this.targetId=e,this.fromCache=r,this.$i=o,this.Ui=a}static Wi(e,r){let o=Qr(),a=Qr();for(const u of r.docChanges)switch(u.type){case 0:o=o.add(u.doc.key);break;case 1:a=a.add(u.doc.key)}return new h5(e,r.fromCache,o,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UGe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VGe{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return A4e()?8:vze(qc())>0?6:4}()}initialize(e,r){this.Ji=e,this.indexManager=r,this.Gi=!0}getDocumentsMatchingQuery(e,r,o,a){const u={result:null};return this.Yi(e,r).next(d=>{u.result=d}).next(()=>{if(!u.result)return this.Zi(e,r,a,o).next(d=>{u.result=d})}).next(()=>{if(u.result)return;const d=new UGe;return this.Xi(e,r,d).next(f=>{if(u.result=f,this.zi)return this.es(e,r,d,f.size)})}).next(()=>u.result)}es(e,r,o,a){return o.documentReadCount<this.ji?(Dw()<=oi.DEBUG&&En("QueryEngine","SDK will not create cache indexes for query:",VS(r),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Ut.resolve()):(Dw()<=oi.DEBUG&&En("QueryEngine","Query:",VS(r),"scans",o.documentReadCount,"local documents and returns",a,"documents as results."),o.documentReadCount>this.Hi*a?(Dw()<=oi.DEBUG&&En("QueryEngine","The SDK decides to create cache indexes for query:",VS(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ef(r))):Ut.resolve())}Yi(e,r){if(fZ(r))return Ut.resolve(null);let o=Ef(r);return this.indexManager.getIndexType(e,o).next(a=>a===0?null:(r.limit!==null&&a===1&&(r=oj(r,null,"F"),o=Ef(r)),this.indexManager.getDocumentsMatchingTarget(e,o).next(u=>{const d=Qr(...u);return this.Ji.getDocuments(e,d).next(f=>this.indexManager.getMinOffset(e,o).next(g=>{const E=this.ts(r,f);return this.ns(r,E,d,g.readTime)?this.Yi(e,oj(r,null,"F")):this.rs(e,E,r,g)}))})))}Zi(e,r,o,a){return fZ(r)||a.isEqual(gr.min())?Ut.resolve(null):this.Ji.getDocuments(e,o).next(u=>{const d=this.ts(r,u);return this.ns(r,d,o,a)?Ut.resolve(null):(Dw()<=oi.DEBUG&&En("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),VS(r)),this.rs(e,d,r,hze(a,-1)).next(f=>f))})}ts(e,r){let o=new mc(Oae(e));return r.forEach((a,u)=>{sD(e,u)&&(o=o.add(u))}),o}ns(e,r,o,a){if(e.limit===null)return!1;if(o.size!==r.size)return!0;const u=e.limitType==="F"?r.last():r.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(a)>0)}Xi(e,r,o){return Dw()<=oi.DEBUG&&En("QueryEngine","Using full collection scan to execute query:",VS(r)),this.Ji.getDocumentsMatchingQuery(e,r,Bg.min(),o)}rs(e,r,o,a){return this.Ji.getDocumentsMatchingQuery(e,o,a).next(u=>(r.forEach(d=>{u=u.insert(d.key,d)}),u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FGe{constructor(e,r,o,a){this.persistence=e,this.ss=r,this.serializer=a,this.os=new Zs(Ci),this._s=new e0(u=>r5(u),i5),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(o)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new IGe(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>e.collect(r,this.os))}}function jGe(t,e,r,o){return new FGe(t,e,r,o)}async function Qae(t,e){const r=vr(t);return await r.persistence.runTransaction("Handle user change","readonly",o=>{let a;return r.mutationQueue.getAllMutationBatches(o).next(u=>(a=u,r.ls(e),r.mutationQueue.getAllMutationBatches(o))).next(u=>{const d=[],f=[];let g=Qr();for(const E of a){d.push(E.batchId);for(const T of E.mutations)g=g.add(T.key)}for(const E of u){f.push(E.batchId);for(const T of E.mutations)g=g.add(T.key)}return r.localDocuments.getDocuments(o,g).next(E=>({hs:E,removedBatchIds:d,addedBatchIds:f}))})})}function BGe(t,e){const r=vr(t);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const a=e.batch.keys(),u=r.cs.newChangeBuffer({trackRemovals:!0});return function(f,g,E,T){const C=E.batch,I=C.keys();let D=Ut.resolve();return I.forEach(L=>{D=D.next(()=>T.getEntry(g,L)).next(B=>{const G=E.docVersions.get(L);Zi(G!==null),B.version.compareTo(G)<0&&(C.applyToRemoteDocument(B,E),B.isValidDocument()&&(B.setReadTime(E.commitVersion),T.addEntry(B)))})}),D.next(()=>f.mutationQueue.removeMutationBatch(g,C))}(r,o,e,u).next(()=>u.apply(o)).next(()=>r.mutationQueue.performConsistencyCheck(o)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(o,a,e.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(f){let g=Qr();for(let E=0;E<f.mutationResults.length;++E)f.mutationResults[E].transformResults.length>0&&(g=g.add(f.batch.mutations[E].key));return g}(e))).next(()=>r.localDocuments.getDocuments(o,a))})}function Zae(t){const e=vr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",r=>e.Ur.getLastRemoteSnapshotVersion(r))}function WGe(t,e){const r=vr(t),o=e.snapshotVersion;let a=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",u=>{const d=r.cs.newChangeBuffer({trackRemovals:!0});a=r.os;const f=[];e.targetChanges.forEach((T,C)=>{const I=a.get(C);if(!I)return;f.push(r.Ur.removeMatchingKeys(u,T.removedDocuments,C).next(()=>r.Ur.addMatchingKeys(u,T.addedDocuments,C)));let D=I.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(C)!==null?D=D.withResumeToken(gc.EMPTY_BYTE_STRING,gr.min()).withLastLimboFreeSnapshotVersion(gr.min()):T.resumeToken.approximateByteSize()>0&&(D=D.withResumeToken(T.resumeToken,o)),a=a.insert(C,D),function(B,G,se){return B.resumeToken.approximateByteSize()===0||G.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=3e8?!0:se.addedDocuments.size+se.modifiedDocuments.size+se.removedDocuments.size>0}(I,D,T)&&f.push(r.Ur.updateTargetData(u,D))});let g=Jp(),E=Qr();if(e.documentUpdates.forEach(T=>{e.resolvedLimboDocuments.has(T)&&f.push(r.persistence.referenceDelegate.updateLimboDocument(u,T))}),f.push(zGe(u,d,e.documentUpdates).next(T=>{g=T.Ps,E=T.Is})),!o.isEqual(gr.min())){const T=r.Ur.getLastRemoteSnapshotVersion(u).next(C=>r.Ur.setTargetsMetadata(u,u.currentSequenceNumber,o));f.push(T)}return Ut.waitFor(f).next(()=>d.apply(u)).next(()=>r.localDocuments.getLocalViewOfDocuments(u,g,E)).next(()=>g)}).then(u=>(r.os=a,u))}function zGe(t,e,r){let o=Qr(),a=Qr();return r.forEach(u=>o=o.add(u)),e.getEntries(t,o).next(u=>{let d=Jp();return r.forEach((f,g)=>{const E=u.get(f);g.isFoundDocument()!==E.isFoundDocument()&&(a=a.add(f)),g.isNoDocument()&&g.version.isEqual(gr.min())?(e.removeEntry(f,g.readTime),d=d.insert(f,g)):!E.isValidDocument()||g.version.compareTo(E.version)>0||g.version.compareTo(E.version)===0&&E.hasPendingWrites?(e.addEntry(g),d=d.insert(f,g)):En("LocalStore","Ignoring outdated watch update for ",f,". Current version:",E.version," Watch version:",g.version)}),{Ps:d,Is:a}})}function GGe(t,e){const r=vr(t);return r.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function HGe(t,e){const r=vr(t);return r.persistence.runTransaction("Allocate target","readwrite",o=>{let a;return r.Ur.getTargetData(o,e).next(u=>u?(a=u,Ut.resolve(a)):r.Ur.allocateTargetId(o).next(d=>(a=new bg(e,d,"TargetPurposeListen",o.currentSequenceNumber),r.Ur.addTargetData(o,a).next(()=>a))))}).then(o=>{const a=r.os.get(o.targetId);return(a===null||o.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(r.os=r.os.insert(o.targetId,o),r._s.set(e,o.targetId)),o})}async function dj(t,e,r){const o=vr(t),a=o.os.get(e),u=r?"readwrite":"readwrite-primary";try{r||await o.persistence.runTransaction("Release target",u,d=>o.persistence.referenceDelegate.removeTarget(d,a))}catch(d){if(!qR(d))throw d;En("LocalStore",`Failed to update sequence numbers for target ${e}: ${d}`)}o.os=o.os.remove(e),o._s.delete(a.target)}function wZ(t,e,r){const o=vr(t);let a=gr.min(),u=Qr();return o.persistence.runTransaction("Execute query","readwrite",d=>function(g,E,T){const C=vr(g),I=C._s.get(T);return I!==void 0?Ut.resolve(C.os.get(I)):C.Ur.getTargetData(E,T)}(o,d,Ef(e)).next(f=>{if(f)return a=f.lastLimboFreeSnapshotVersion,o.Ur.getMatchingKeysForTargetId(d,f.targetId).next(g=>{u=g})}).next(()=>o.ss.getDocumentsMatchingQuery(d,e,r?a:gr.min(),r?u:Qr())).next(f=>(KGe(o,Mze(e),f),{documents:f,Ts:u})))}function KGe(t,e,r){let o=t.us.get(e)||gr.min();r.forEach((a,u)=>{u.readTime.compareTo(o)>0&&(o=u.readTime)}),t.us.set(e,o)}class CZ{constructor(){this.activeTargetIds=Wze()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class qGe{constructor(){this.so=new CZ,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,o){}addLocalQueryTarget(e,r=!0){return r&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,r,o){this.oo[e]=r}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new CZ,Promise.resolve()}handleUserChange(e,r,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Ge{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RZ{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){En("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){En("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IP=null;function E2(){return IP===null?IP=function(){return 268435456+Math.round(2147483648*Math.random())}():IP++,"0x"+IP.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YGe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XGe{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vc="WebChannelConnection";class JGe extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const o=r.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),u=encodeURIComponent(this.databaseId.database);this.Do=o+"://"+r.host,this.vo=`projects/${a}/databases/${u}`,this.Co=this.databaseId.database==="(default)"?`project_id=${a}`:`project_id=${a}&database_id=${u}`}get Fo(){return!1}Mo(r,o,a,u,d){const f=E2(),g=this.xo(r,o.toUriEncodedString());En("RestConnection",`Sending RPC '${r}' ${f}:`,g,a);const E={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(E,u,d),this.No(r,g,E,a).then(T=>(En("RestConnection",`Received RPC '${r}' ${f}: `,T),T),T=>{throw PT("RestConnection",`RPC '${r}' ${f} failed with error: `,T,"url: ",g,"request:",a),T})}Lo(r,o,a,u,d,f){return this.Mo(r,o,a,u,d)}Oo(r,o,a){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ZT}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),o&&o.headers.forEach((u,d)=>r[d]=u),a&&a.headers.forEach((u,d)=>r[d]=u)}xo(r,o){const a=YGe[r];return`${this.Do}/v1/${o}:${a}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,r,o,a){const u=E2();return new Promise((d,f)=>{const g=new fae;g.setWithCredentials(!0),g.listenOnce(pae.COMPLETE,()=>{try{switch(g.getLastErrorCode()){case lN.NO_ERROR:const T=g.getResponseJson();En(Vc,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(T)),d(T);break;case lN.TIMEOUT:En(Vc,`RPC '${e}' ${u} timed out`),f(new Rn(Mt.DEADLINE_EXCEEDED,"Request time out"));break;case lN.HTTP_ERROR:const C=g.getStatus();if(En(Vc,`RPC '${e}' ${u} failed with status:`,C,"response text:",g.getResponseText()),C>0){let I=g.getResponseJson();Array.isArray(I)&&(I=I[0]);const D=I==null?void 0:I.error;if(D&&D.status&&D.message){const L=function(G){const se=G.toLowerCase().replace(/_/g,"-");return Object.values(Mt).indexOf(se)>=0?se:Mt.UNKNOWN}(D.status);f(new Rn(L,D.message))}else f(new Rn(Mt.UNKNOWN,"Server responded with status "+g.getStatus()))}else f(new Rn(Mt.UNAVAILABLE,"Connection failed."));break;default:lr()}}finally{En(Vc,`RPC '${e}' ${u} completed.`)}});const E=JSON.stringify(a);En(Vc,`RPC '${e}' ${u} sending request:`,a),g.send(r,"POST",E,o,15)})}Bo(e,r,o){const a=E2(),u=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],d=vae(),f=gae(),g={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},E=this.longPollingOptions.timeoutSeconds;E!==void 0&&(g.longPollingTimeout=Math.round(1e3*E)),this.useFetchStreams&&(g.useFetchStreams=!0),this.Oo(g.initMessageHeaders,r,o),g.encodeInitMessageHeaders=!0;const T=u.join("");En(Vc,`Creating RPC '${e}' stream ${a}: ${T}`,g);const C=d.createWebChannel(T,g);let I=!1,D=!1;const L=new XGe({Io:G=>{D?En(Vc,`Not sending because RPC '${e}' stream ${a} is closed:`,G):(I||(En(Vc,`Opening RPC '${e}' stream ${a} transport.`),C.open(),I=!0),En(Vc,`RPC '${e}' stream ${a} sending:`,G),C.send(G))},To:()=>C.close()}),B=(G,se,ae)=>{G.listen(se,M=>{try{ae(M)}catch(F){setTimeout(()=>{throw F},0)}})};return B(C,iC.EventType.OPEN,()=>{D||(En(Vc,`RPC '${e}' stream ${a} transport opened.`),L.yo())}),B(C,iC.EventType.CLOSE,()=>{D||(D=!0,En(Vc,`RPC '${e}' stream ${a} transport closed`),L.So())}),B(C,iC.EventType.ERROR,G=>{D||(D=!0,PT(Vc,`RPC '${e}' stream ${a} transport errored:`,G),L.So(new Rn(Mt.UNAVAILABLE,"The operation could not be completed")))}),B(C,iC.EventType.MESSAGE,G=>{var se;if(!D){const ae=G.data[0];Zi(!!ae);const M=ae,F=M.error||((se=M[0])===null||se===void 0?void 0:se.error);if(F){En(Vc,`RPC '${e}' stream ${a} received error:`,F);const z=F.status;let te=function(Q){const ce=qo[Q];if(ce!==void 0)return Wae(ce)}(z),j=F.message;te===void 0&&(te=Mt.INTERNAL,j="Unknown error status: "+z+" with message "+F.message),D=!0,L.So(new Rn(te,j)),C.close()}else En(Vc,`RPC '${e}' stream ${a} received:`,ae),L.bo(ae)}}),B(f,mae.STAT_EVENT,G=>{G.stat===tj.PROXY?En(Vc,`RPC '${e}' stream ${a} detected buffering proxy`):G.stat===tj.NOPROXY&&En(Vc,`RPC '${e}' stream ${a} detected no buffering proxy`)}),setTimeout(()=>{L.wo()},0),L}}function S2(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uD(t){return new aGe(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ece{constructor(e,r,o=1e3,a=1.5,u=6e4){this.ui=e,this.timerId=r,this.ko=o,this.qo=a,this.Qo=u,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const r=Math.floor(this.Ko+this.zo()),o=Math.max(0,Date.now()-this.Uo),a=Math.max(0,r-o);a>0&&En("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Ko} ms, delay with jitter: ${r} ms, last attempt: ${o} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,a,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tce{constructor(e,r,o,a,u,d,f,g){this.ui=e,this.Ho=o,this.Jo=a,this.connection=u,this.authCredentialsProvider=d,this.appCheckCredentialsProvider=f,this.listener=g,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new ece(e,r)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,r){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():r&&r.code===Mt.RESOURCE_EXHAUSTED?(Xp(r.toString()),Xp("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):r&&r.code===Mt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(r)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),r=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,a])=>{this.Yo===r&&this.P_(o,a)},o=>{e(()=>{const a=new Rn(Mt.UNKNOWN,"Fetching auth token failed: "+o.message);return this.I_(a)})})}P_(e,r){const o=this.h_(this.Yo);this.stream=this.T_(e,r),this.stream.Eo(()=>{o(()=>this.listener.Eo())}),this.stream.Ro(()=>{o(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(a=>{o(()=>this.I_(a))}),this.stream.onMessage(a=>{o(()=>++this.e_==1?this.E_(a):this.onNext(a))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return En("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return r=>{this.ui.enqueueAndForget(()=>this.Yo===e?r():(En("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class QGe extends tce{constructor(e,r,o,a,u,d){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,o,a,d),this.serializer=u}T_(e,r){return this.connection.Bo("Listen",e,r)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const r=lGe(this.serializer,e),o=function(u){if(!("targetChange"in u))return gr.min();const d=u.targetChange;return d.targetIds&&d.targetIds.length?gr.min():d.readTime?Tf(d.readTime):gr.min()}(e);return this.listener.d_(r,o)}A_(e){const r={};r.database=lj(this.serializer),r.addTarget=function(u,d){let f;const g=d.target;if(f=sj(g)?{documents:fGe(u,g)}:{query:pGe(u,g)._t},f.targetId=d.targetId,d.resumeToken.approximateByteSize()>0){f.resumeToken=Hae(u,d.resumeToken);const E=aj(u,d.expectedCount);E!==null&&(f.expectedCount=E)}else if(d.snapshotVersion.compareTo(gr.min())>0){f.readTime=e1(u,d.snapshotVersion.toTimestamp());const E=aj(u,d.expectedCount);E!==null&&(f.expectedCount=E)}return f}(this.serializer,e);const o=gGe(this.serializer,e);o&&(r.labels=o),this.a_(r)}R_(e){const r={};r.database=lj(this.serializer),r.removeTarget=e,this.a_(r)}}class ZGe extends tce{constructor(e,r,o,a,u,d){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,o,a,d),this.serializer=u}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,r){return this.connection.Bo("Write",e,r)}E_(e){return Zi(!!e.streamToken),this.lastStreamToken=e.streamToken,Zi(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Zi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const r=hGe(e.writeResults,e.commitTime),o=Tf(e.commitTime);return this.listener.g_(o,r)}p_(){const e={};e.database=lj(this.serializer),this.a_(e)}m_(e){const r={streamToken:this.lastStreamToken,writes:e.map(o=>dGe(this.serializer,o))};this.a_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eHe extends class{}{constructor(e,r,o,a){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=o,this.serializer=a,this.y_=!1}w_(){if(this.y_)throw new Rn(Mt.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,r,o,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,d])=>this.connection.Mo(e,cj(r,o),a,u,d)).catch(u=>{throw u.name==="FirebaseError"?(u.code===Mt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Rn(Mt.UNKNOWN,u.toString())})}Lo(e,r,o,a,u){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,f])=>this.connection.Lo(e,cj(r,o),a,d,f,u)).catch(d=>{throw d.name==="FirebaseError"?(d.code===Mt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new Rn(Mt.UNKNOWN,d.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class tHe{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Xp(r),this.D_=!1):En("OnlineStateTracker",r)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nHe{constructor(e,r,o,a,u){this.localStore=e,this.datastore=r,this.asyncQueue=o,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=u,this.k_._o(d=>{o.enqueueAndForget(async()=>{Ay(this)&&(En("RemoteStore","Restarting streams for network reachability change."),await async function(g){const E=vr(g);E.L_.add(4),await XR(E),E.q_.set("Unknown"),E.L_.delete(4),await lD(E)}(this))})}),this.q_=new tHe(o,a)}}async function lD(t){if(Ay(t))for(const e of t.B_)await e(!0)}async function XR(t){for(const e of t.B_)await e(!1)}function nce(t,e){const r=vr(t);r.N_.has(e.targetId)||(r.N_.set(e.targetId,e),g5(r)?m5(r):t0(r).r_()&&p5(r,e))}function f5(t,e){const r=vr(t),o=t0(r);r.N_.delete(e),o.r_()&&rce(r,e),r.N_.size===0&&(o.r_()?o.o_():Ay(r)&&r.q_.set("Unknown"))}function p5(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(gr.min())>0){const r=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}t0(t).A_(e)}function rce(t,e){t.Q_.xe(e),t0(t).R_(e)}function m5(t){t.Q_=new rGe({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),t0(t).start(),t.q_.v_()}function g5(t){return Ay(t)&&!t0(t).n_()&&t.N_.size>0}function Ay(t){return vr(t).L_.size===0}function ice(t){t.Q_=void 0}async function rHe(t){t.q_.set("Online")}async function iHe(t){t.N_.forEach((e,r)=>{p5(t,e)})}async function sHe(t,e){ice(t),g5(t)?(t.q_.M_(e),m5(t)):t.q_.set("Unknown")}async function oHe(t,e,r){if(t.q_.set("Online"),e instanceof Gae&&e.state===2&&e.cause)try{await async function(a,u){const d=u.cause;for(const f of u.targetIds)a.N_.has(f)&&(await a.remoteSyncer.rejectListen(f,d),a.N_.delete(f),a.Q_.removeTarget(f))}(t,e)}catch(o){En("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),await t1(t,o)}else if(e instanceof fN?t.Q_.Ke(e):e instanceof zae?t.Q_.He(e):t.Q_.We(e),!r.isEqual(gr.min()))try{const o=await Zae(t.localStore);r.compareTo(o)>=0&&await function(u,d){const f=u.Q_.rt(d);return f.targetChanges.forEach((g,E)=>{if(g.resumeToken.approximateByteSize()>0){const T=u.N_.get(E);T&&u.N_.set(E,T.withResumeToken(g.resumeToken,d))}}),f.targetMismatches.forEach((g,E)=>{const T=u.N_.get(g);if(!T)return;u.N_.set(g,T.withResumeToken(gc.EMPTY_BYTE_STRING,T.snapshotVersion)),rce(u,g);const C=new bg(T.target,g,E,T.sequenceNumber);p5(u,C)}),u.remoteSyncer.applyRemoteEvent(f)}(t,r)}catch(o){En("RemoteStore","Failed to raise snapshot:",o),await t1(t,o)}}async function t1(t,e,r){if(!qR(e))throw e;t.L_.add(1),await XR(t),t.q_.set("Offline"),r||(r=()=>Zae(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{En("RemoteStore","Retrying IndexedDB access"),await r(),t.L_.delete(1),await lD(t)})}function sce(t,e){return e().catch(r=>t1(t,r,e))}async function dD(t){const e=vr(t),r=zg(e);let o=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;aHe(e);)try{const a=await GGe(e.localStore,o);if(a===null){e.O_.length===0&&r.o_();break}o=a.batchId,cHe(e,a)}catch(a){await t1(e,a)}oce(e)&&ace(e)}function aHe(t){return Ay(t)&&t.O_.length<10}function cHe(t,e){t.O_.push(e);const r=zg(t);r.r_()&&r.V_&&r.m_(e.mutations)}function oce(t){return Ay(t)&&!zg(t).n_()&&t.O_.length>0}function ace(t){zg(t).start()}async function uHe(t){zg(t).p_()}async function lHe(t){const e=zg(t);for(const r of t.O_)e.m_(r.mutations)}async function dHe(t,e,r){const o=t.O_.shift(),a=a5.from(o,e,r);await sce(t,()=>t.remoteSyncer.applySuccessfulWrite(a)),await dD(t)}async function hHe(t,e){e&&zg(t).V_&&await async function(o,a){if(function(d){return eGe(d)&&d!==Mt.ABORTED}(a.code)){const u=o.O_.shift();zg(o).s_(),await sce(o,()=>o.remoteSyncer.rejectFailedWrite(u.batchId,a)),await dD(o)}}(t,e),oce(t)&&ace(t)}async function IZ(t,e){const r=vr(t);r.asyncQueue.verifyOperationInProgress(),En("RemoteStore","RemoteStore received new credentials");const o=Ay(r);r.L_.add(3),await XR(r),o&&r.q_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.L_.delete(3),await lD(r)}async function fHe(t,e){const r=vr(t);e?(r.L_.delete(2),await lD(r)):e||(r.L_.add(2),await XR(r),r.q_.set("Unknown"))}function t0(t){return t.K_||(t.K_=function(r,o,a){const u=vr(r);return u.w_(),new QGe(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,a)}(t.datastore,t.asyncQueue,{Eo:rHe.bind(null,t),Ro:iHe.bind(null,t),mo:sHe.bind(null,t),d_:oHe.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),g5(t)?m5(t):t.q_.set("Unknown")):(await t.K_.stop(),ice(t))})),t.K_}function zg(t){return t.U_||(t.U_=function(r,o,a){const u=vr(r);return u.w_(),new ZGe(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,a)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:uHe.bind(null,t),mo:hHe.bind(null,t),f_:lHe.bind(null,t),g_:dHe.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await dD(t)):(await t.U_.stop(),t.O_.length>0&&(En("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5{constructor(e,r,o,a,u){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=o,this.op=a,this.removalCallback=u,this.deferred=new Gp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(d=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,r,o,a,u){const d=Date.now()+o,f=new v5(e,r,d,a,u);return f.start(o),f}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Rn(Mt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function _5(t,e){if(Xp("AsyncQueue",`${e}: ${t}`),qR(t))return new Rn(Mt.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _T{constructor(e){this.comparator=e?(r,o)=>e(r,o)||qn.comparator(r.key,o.key):(r,o)=>qn.comparator(r.key,o.key),this.keyedMap=sC(),this.sortedSet=new Zs(this.comparator)}static emptySet(e){return new _T(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((r,o)=>(e(r),!1))}add(e){const r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}delete(e){const r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}isEqual(e){if(!(e instanceof _T)||this.size!==e.size)return!1;const r=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;r.hasNext();){const a=r.getNext().key,u=o.getNext().key;if(!a.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach(r=>{e.push(r.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,r){const o=new _T;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=r,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AZ{constructor(){this.W_=new Zs(qn.comparator)}track(e){const r=e.doc.key,o=this.W_.get(r);o?e.type!==0&&o.type===3?this.W_=this.W_.insert(r,e):e.type===3&&o.type!==1?this.W_=this.W_.insert(r,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.W_=this.W_.insert(r,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.W_=this.W_.remove(r):e.type===1&&o.type===2?this.W_=this.W_.insert(r,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):lr():this.W_=this.W_.insert(r,e)}G_(){const e=[];return this.W_.inorderTraversal((r,o)=>{e.push(o)}),e}}class MT{constructor(e,r,o,a,u,d,f,g,E){this.query=e,this.docs=r,this.oldDocs=o,this.docChanges=a,this.mutatedKeys=u,this.fromCache=d,this.syncStateChanged=f,this.excludesMetadataChanges=g,this.hasCachedResults=E}static fromInitialDocuments(e,r,o,a,u){const d=[];return r.forEach(f=>{d.push({type:0,doc:f})}),new MT(e,r,_T.emptySet(r),d,o,a,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&iD(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const r=this.docChanges,o=e.docChanges;if(r.length!==o.length)return!1;for(let a=0;a<r.length;a++)if(r[a].type!==o[a].type||!r[a].doc.isEqual(o[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pHe{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class mHe{constructor(){this.queries=kZ(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(r,o){const a=vr(r),u=a.queries;a.queries=kZ(),u.forEach((d,f)=>{for(const g of f.j_)g.onError(o)})})(this,new Rn(Mt.ABORTED,"Firestore shutting down"))}}function kZ(){return new e0(t=>kae(t),iD)}async function cce(t,e){const r=vr(t);let o=3;const a=e.query;let u=r.queries.get(a);u?!u.H_()&&e.J_()&&(o=2):(u=new pHe,o=e.J_()?0:1);try{switch(o){case 0:u.z_=await r.onListen(a,!0);break;case 1:u.z_=await r.onListen(a,!1);break;case 2:await r.onFirstRemoteStoreListen(a)}}catch(d){const f=_5(d,`Initialization of query '${VS(e.query)}' failed`);return void e.onError(f)}r.queries.set(a,u),u.j_.push(e),e.Z_(r.onlineState),u.z_&&e.X_(u.z_)&&y5(r)}async function uce(t,e){const r=vr(t),o=e.query;let a=3;const u=r.queries.get(o);if(u){const d=u.j_.indexOf(e);d>=0&&(u.j_.splice(d,1),u.j_.length===0?a=e.J_()?0:1:!u.H_()&&e.J_()&&(a=2))}switch(a){case 0:return r.queries.delete(o),r.onUnlisten(o,!0);case 1:return r.queries.delete(o),r.onUnlisten(o,!1);case 2:return r.onLastRemoteStoreUnlisten(o);default:return}}function gHe(t,e){const r=vr(t);let o=!1;for(const a of e){const u=a.query,d=r.queries.get(u);if(d){for(const f of d.j_)f.X_(a)&&(o=!0);d.z_=a}}o&&y5(r)}function vHe(t,e,r){const o=vr(t),a=o.queries.get(e);if(a)for(const u of a.j_)u.onError(r);o.queries.delete(e)}function y5(t){t.Y_.forEach(e=>{e.next()})}var hj,OZ;(OZ=hj||(hj={})).ea="default",OZ.Cache="cache";class lce{constructor(e,r,o){this.query=e,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=o||{}}X_(e){if(!this.options.includeMetadataChanges){const o=[];for(const a of e.docChanges)a.type!==3&&o.push(a);e=new MT(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let r=!1;return this.na?this.ia(e)&&(this.ta.next(e),r=!0):this.sa(e,this.onlineState)&&(this.oa(e),r=!0),this.ra=e,r}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let r=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),r=!0),r}sa(e,r){if(!e.fromCache||!this.J_())return!0;const o=r!=="Offline";return(!this.options._a||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||r==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const r=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}oa(e){e=MT.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==hj.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dce{constructor(e){this.key=e}}class hce{constructor(e){this.key=e}}class _He{constructor(e,r){this.query=e,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Qr(),this.mutatedKeys=Qr(),this.Aa=Oae(e),this.Ra=new _T(this.Aa)}get Va(){return this.Ta}ma(e,r){const o=r?r.fa:new AZ,a=r?r.Ra:this.Ra;let u=r?r.mutatedKeys:this.mutatedKeys,d=a,f=!1;const g=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,E=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((T,C)=>{const I=a.get(T),D=sD(this.query,C)?C:null,L=!!I&&this.mutatedKeys.has(I.key),B=!!D&&(D.hasLocalMutations||this.mutatedKeys.has(D.key)&&D.hasCommittedMutations);let G=!1;I&&D?I.data.isEqual(D.data)?L!==B&&(o.track({type:3,doc:D}),G=!0):this.ga(I,D)||(o.track({type:2,doc:D}),G=!0,(g&&this.Aa(D,g)>0||E&&this.Aa(D,E)<0)&&(f=!0)):!I&&D?(o.track({type:0,doc:D}),G=!0):I&&!D&&(o.track({type:1,doc:I}),G=!0,(g||E)&&(f=!0)),G&&(D?(d=d.add(D),u=B?u.add(T):u.delete(T)):(d=d.delete(T),u=u.delete(T)))}),this.query.limit!==null)for(;d.size>this.query.limit;){const T=this.query.limitType==="F"?d.last():d.first();d=d.delete(T.key),u=u.delete(T.key),o.track({type:1,doc:T})}return{Ra:d,fa:o,ns:f,mutatedKeys:u}}ga(e,r){return e.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(e,r,o,a){const u=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const d=e.fa.G_();d.sort((T,C)=>function(D,L){const B=G=>{switch(G){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return lr()}};return B(D)-B(L)}(T.type,C.type)||this.Aa(T.doc,C.doc)),this.pa(o),a=a!=null&&a;const f=r&&!a?this.ya():[],g=this.da.size===0&&this.current&&!a?1:0,E=g!==this.Ea;return this.Ea=g,d.length!==0||E?{snapshot:new MT(this.query,e.Ra,u,d,e.mutatedKeys,g===0,E,!1,!!o&&o.resumeToken.approximateByteSize()>0),wa:f}:{wa:f}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new AZ,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(r=>this.Ta=this.Ta.add(r)),e.modifiedDocuments.forEach(r=>{}),e.removedDocuments.forEach(r=>this.Ta=this.Ta.delete(r)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Qr(),this.Ra.forEach(o=>{this.Sa(o.key)&&(this.da=this.da.add(o.key))});const r=[];return e.forEach(o=>{this.da.has(o)||r.push(new hce(o))}),this.da.forEach(o=>{e.has(o)||r.push(new dce(o))}),r}ba(e){this.Ta=e.Ts,this.da=Qr();const r=this.ma(e.documents);return this.applyChanges(r,!0)}Da(){return MT.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class yHe{constructor(e,r,o){this.query=e,this.targetId=r,this.view=o}}class EHe{constructor(e){this.key=e,this.va=!1}}class SHe{constructor(e,r,o,a,u,d){this.localStore=e,this.remoteStore=r,this.eventManager=o,this.sharedClientState=a,this.currentUser=u,this.maxConcurrentLimboResolutions=d,this.Ca={},this.Fa=new e0(f=>kae(f),iD),this.Ma=new Map,this.xa=new Set,this.Oa=new Zs(qn.comparator),this.Na=new Map,this.La=new l5,this.Ba={},this.ka=new Map,this.qa=xT.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function THe(t,e,r=!0){const o=_ce(t);let a;const u=o.Fa.get(e);return u?(o.sharedClientState.addLocalQueryTarget(u.targetId),a=u.view.Da()):a=await fce(o,e,r,!0),a}async function bHe(t,e){const r=_ce(t);await fce(r,e,!0,!1)}async function fce(t,e,r,o){const a=await HGe(t.localStore,Ef(e)),u=a.targetId,d=t.sharedClientState.addLocalQueryTarget(u,r);let f;return o&&(f=await wHe(t,e,u,d==="current",a.resumeToken)),t.isPrimaryClient&&r&&nce(t.remoteStore,a),f}async function wHe(t,e,r,o,a){t.Ka=(C,I,D)=>async function(B,G,se,ae){let M=G.view.ma(se);M.ns&&(M=await wZ(B.localStore,G.query,!1).then(({documents:j})=>G.view.ma(j,M)));const F=ae&&ae.targetChanges.get(G.targetId),z=ae&&ae.targetMismatches.get(G.targetId)!=null,te=G.view.applyChanges(M,B.isPrimaryClient,F,z);return NZ(B,G.targetId,te.wa),te.snapshot}(t,C,I,D);const u=await wZ(t.localStore,e,!0),d=new _He(e,u.Ts),f=d.ma(u.documents),g=YR.createSynthesizedTargetChangeForCurrentChange(r,o&&t.onlineState!=="Offline",a),E=d.applyChanges(f,t.isPrimaryClient,g);NZ(t,r,E.wa);const T=new yHe(e,r,d);return t.Fa.set(e,T),t.Ma.has(r)?t.Ma.get(r).push(e):t.Ma.set(r,[e]),E.snapshot}async function CHe(t,e,r){const o=vr(t),a=o.Fa.get(e),u=o.Ma.get(a.targetId);if(u.length>1)return o.Ma.set(a.targetId,u.filter(d=>!iD(d,e))),void o.Fa.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(a.targetId),o.sharedClientState.isActiveQueryTarget(a.targetId)||await dj(o.localStore,a.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(a.targetId),r&&f5(o.remoteStore,a.targetId),fj(o,a.targetId)}).catch(KR)):(fj(o,a.targetId),await dj(o.localStore,a.targetId,!0))}async function RHe(t,e){const r=vr(t),o=r.Fa.get(e),a=r.Ma.get(o.targetId);r.isPrimaryClient&&a.length===1&&(r.sharedClientState.removeLocalQueryTarget(o.targetId),f5(r.remoteStore,o.targetId))}async function IHe(t,e,r){const o=LHe(t);try{const a=await function(d,f){const g=vr(d),E=ya.now(),T=f.reduce((D,L)=>D.add(L.key),Qr());let C,I;return g.persistence.runTransaction("Locally write mutations","readwrite",D=>{let L=Jp(),B=Qr();return g.cs.getEntries(D,T).next(G=>{L=G,L.forEach((se,ae)=>{ae.isValidDocument()||(B=B.add(se))})}).next(()=>g.localDocuments.getOverlayedDocuments(D,L)).next(G=>{C=G;const se=[];for(const ae of f){const M=Yze(ae,C.get(ae.key).overlayedDocument);M!=null&&se.push(new ev(ae.key,M,Tae(M.value.mapValue),Sf.exists(!0)))}return g.mutationQueue.addMutationBatch(D,E,se,f)}).next(G=>{I=G;const se=G.applyToLocalDocumentSet(C,B);return g.documentOverlayCache.saveOverlays(D,G.batchId,se)})}).then(()=>({batchId:I.batchId,changes:Nae(C)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(a.batchId),function(d,f,g){let E=d.Ba[d.currentUser.toKey()];E||(E=new Zs(Ci)),E=E.insert(f,g),d.Ba[d.currentUser.toKey()]=E}(o,a.batchId,r),await JR(o,a.changes),await dD(o.remoteStore)}catch(a){const u=_5(a,"Failed to persist write");r.reject(u)}}async function pce(t,e){const r=vr(t);try{const o=await WGe(r.localStore,e);e.targetChanges.forEach((a,u)=>{const d=r.Na.get(u);d&&(Zi(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?d.va=!0:a.modifiedDocuments.size>0?Zi(d.va):a.removedDocuments.size>0&&(Zi(d.va),d.va=!1))}),await JR(r,o,e)}catch(o){await KR(o)}}function PZ(t,e,r){const o=vr(t);if(o.isPrimaryClient&&r===0||!o.isPrimaryClient&&r===1){const a=[];o.Fa.forEach((u,d)=>{const f=d.view.Z_(e);f.snapshot&&a.push(f.snapshot)}),function(d,f){const g=vr(d);g.onlineState=f;let E=!1;g.queries.forEach((T,C)=>{for(const I of C.j_)I.Z_(f)&&(E=!0)}),E&&y5(g)}(o.eventManager,e),a.length&&o.Ca.d_(a),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function AHe(t,e,r){const o=vr(t);o.sharedClientState.updateQueryState(e,"rejected",r);const a=o.Na.get(e),u=a&&a.key;if(u){let d=new Zs(qn.comparator);d=d.insert(u,Gc.newNoDocument(u,gr.min()));const f=Qr().add(u),g=new cD(gr.min(),new Map,new Zs(Ci),d,f);await pce(o,g),o.Oa=o.Oa.remove(u),o.Na.delete(e),E5(o)}else await dj(o.localStore,e,!1).then(()=>fj(o,e,r)).catch(KR)}async function kHe(t,e){const r=vr(t),o=e.batch.batchId;try{const a=await BGe(r.localStore,e);gce(r,o,null),mce(r,o),r.sharedClientState.updateMutationState(o,"acknowledged"),await JR(r,a)}catch(a){await KR(a)}}async function OHe(t,e,r){const o=vr(t);try{const a=await function(d,f){const g=vr(d);return g.persistence.runTransaction("Reject batch","readwrite-primary",E=>{let T;return g.mutationQueue.lookupMutationBatch(E,f).next(C=>(Zi(C!==null),T=C.keys(),g.mutationQueue.removeMutationBatch(E,C))).next(()=>g.mutationQueue.performConsistencyCheck(E)).next(()=>g.documentOverlayCache.removeOverlaysForBatchId(E,T,f)).next(()=>g.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(E,T)).next(()=>g.localDocuments.getDocuments(E,T))})}(o.localStore,e);gce(o,e,r),mce(o,e),o.sharedClientState.updateMutationState(e,"rejected",r),await JR(o,a)}catch(a){await KR(a)}}function mce(t,e){(t.ka.get(e)||[]).forEach(r=>{r.resolve()}),t.ka.delete(e)}function gce(t,e,r){const o=vr(t);let a=o.Ba[o.currentUser.toKey()];if(a){const u=a.get(e);u&&(r?u.reject(r):u.resolve(),a=a.remove(e)),o.Ba[o.currentUser.toKey()]=a}}function fj(t,e,r=null){t.sharedClientState.removeLocalQueryTarget(e);for(const o of t.Ma.get(e))t.Fa.delete(o),r&&t.Ca.$a(o,r);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(o=>{t.La.containsKey(o)||vce(t,o)})}function vce(t,e){t.xa.delete(e.path.canonicalString());const r=t.Oa.get(e);r!==null&&(f5(t.remoteStore,r),t.Oa=t.Oa.remove(e),t.Na.delete(r),E5(t))}function NZ(t,e,r){for(const o of r)o instanceof dce?(t.La.addReference(o.key,e),PHe(t,o)):o instanceof hce?(En("SyncEngine","Document no longer in limbo: "+o.key),t.La.removeReference(o.key,e),t.La.containsKey(o.key)||vce(t,o.key)):lr()}function PHe(t,e){const r=e.key,o=r.path.canonicalString();t.Oa.get(r)||t.xa.has(o)||(En("SyncEngine","New document in limbo: "+r),t.xa.add(o),E5(t))}function E5(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const r=new qn(js.fromString(e)),o=t.qa.next();t.Na.set(o,new EHe(r)),t.Oa=t.Oa.insert(r,o),nce(t.remoteStore,new bg(Ef(s5(r.path)),o,"TargetPurposeLimboResolution",Z4.oe))}}async function JR(t,e,r){const o=vr(t),a=[],u=[],d=[];o.Fa.isEmpty()||(o.Fa.forEach((f,g)=>{d.push(o.Ka(g,e,r).then(E=>{var T;if((E||r)&&o.isPrimaryClient){const C=E?!E.fromCache:(T=r==null?void 0:r.targetChanges.get(g.targetId))===null||T===void 0?void 0:T.current;o.sharedClientState.updateQueryState(g.targetId,C?"current":"not-current")}if(E){a.push(E);const C=h5.Wi(g.targetId,E);u.push(C)}}))}),await Promise.all(d),o.Ca.d_(a),await async function(g,E){const T=vr(g);try{await T.persistence.runTransaction("notifyLocalViewChanges","readwrite",C=>Ut.forEach(E,I=>Ut.forEach(I.$i,D=>T.persistence.referenceDelegate.addReference(C,I.targetId,D)).next(()=>Ut.forEach(I.Ui,D=>T.persistence.referenceDelegate.removeReference(C,I.targetId,D)))))}catch(C){if(!qR(C))throw C;En("LocalStore","Failed to update sequence numbers: "+C)}for(const C of E){const I=C.targetId;if(!C.fromCache){const D=T.os.get(I),L=D.snapshotVersion,B=D.withLastLimboFreeSnapshotVersion(L);T.os=T.os.insert(I,B)}}}(o.localStore,u))}async function NHe(t,e){const r=vr(t);if(!r.currentUser.isEqual(e)){En("SyncEngine","User change. New user:",e.toKey());const o=await Qae(r.localStore,e);r.currentUser=e,function(u,d){u.ka.forEach(f=>{f.forEach(g=>{g.reject(new Rn(Mt.CANCELLED,d))})}),u.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await JR(r,o.hs)}}function DHe(t,e){const r=vr(t),o=r.Na.get(e);if(o&&o.va)return Qr().add(o.key);{let a=Qr();const u=r.Ma.get(e);if(!u)return a;for(const d of u){const f=r.Fa.get(d);a=a.unionWith(f.view.Va)}return a}}function _ce(t){const e=vr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=pce.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=DHe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=AHe.bind(null,e),e.Ca.d_=gHe.bind(null,e.eventManager),e.Ca.$a=vHe.bind(null,e.eventManager),e}function LHe(t){const e=vr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=kHe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=OHe.bind(null,e),e}class n1{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=uD(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,r){return null}Ha(e,r){return null}za(e){return jGe(this.persistence,new VGe,e.initialUser,this.serializer)}Ga(e){return new xGe(d5.Zr,this.serializer)}Wa(e){return new qGe}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}n1.provider={build:()=>new n1};class pj{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>PZ(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=NHe.bind(null,this.syncEngine),await fHe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new mHe}()}createDatastore(e){const r=uD(e.databaseInfo.databaseId),o=function(u){return new JGe(u)}(e.databaseInfo);return function(u,d,f,g){return new eHe(u,d,f,g)}(e.authCredentials,e.appCheckCredentials,o,r)}createRemoteStore(e){return function(o,a,u,d,f){return new nHe(o,a,u,d,f)}(this.localStore,this.datastore,e.asyncQueue,r=>PZ(this.syncEngine,r,0),function(){return RZ.D()?new RZ:new $Ge}())}createSyncEngine(e,r){return function(a,u,d,f,g,E,T){const C=new SHe(a,u,d,f,g,E);return T&&(C.Qa=!0),C}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await async function(a){const u=vr(a);En("RemoteStore","RemoteStore shutting down."),u.L_.add(5),await XR(u),u.k_.shutdown(),u.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}pj.provider={build:()=>new pj};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yce{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Xp("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,r){setTimeout(()=>{this.muted||e(r)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xHe{constructor(e,r,o,a,u){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=o,this.databaseInfo=a,this.user=Wc.UNAUTHENTICATED,this.clientId=yae.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(o,async d=>{En("FirestoreClient","Received user=",d.uid),await this.authCredentialListener(d),this.user=d}),this.appCheckCredentials.start(o,d=>(En("FirestoreClient","Received new app check token=",d),this.appCheckCredentialListener(d,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Gp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const o=_5(r,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function T2(t,e){t.asyncQueue.verifyOperationInProgress(),En("FirestoreClient","Initializing OfflineComponentProvider");const r=t.configuration;await e.initialize(r);let o=r.initialUser;t.setCredentialChangeListener(async a=>{o.isEqual(a)||(await Qae(e.localStore,a),o=a)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function DZ(t,e){t.asyncQueue.verifyOperationInProgress();const r=await MHe(t);En("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(r,t.configuration),t.setCredentialChangeListener(o=>IZ(e.remoteStore,o)),t.setAppCheckTokenChangeListener((o,a)=>IZ(e.remoteStore,a)),t._onlineComponents=e}async function MHe(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){En("FirestoreClient","Using user provided OfflineComponentProvider");try{await T2(t,t._uninitializedComponentsProvider._offline)}catch(e){const r=e;if(!function(a){return a.name==="FirebaseError"?a.code===Mt.FAILED_PRECONDITION||a.code===Mt.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(r))throw r;PT("Error using user provided cache. Falling back to memory cache: "+r),await T2(t,new n1)}}else En("FirestoreClient","Using default OfflineComponentProvider"),await T2(t,new n1);return t._offlineComponents}async function Ece(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(En("FirestoreClient","Using user provided OnlineComponentProvider"),await DZ(t,t._uninitializedComponentsProvider._online)):(En("FirestoreClient","Using default OnlineComponentProvider"),await DZ(t,new pj))),t._onlineComponents}function UHe(t){return Ece(t).then(e=>e.syncEngine)}async function Sce(t){const e=await Ece(t),r=e.eventManager;return r.onListen=THe.bind(null,e.syncEngine),r.onUnlisten=CHe.bind(null,e.syncEngine),r.onFirstRemoteStoreListen=bHe.bind(null,e.syncEngine),r.onLastRemoteStoreUnlisten=RHe.bind(null,e.syncEngine),r}function VHe(t,e,r={}){const o=new Gp;return t.asyncQueue.enqueueAndForget(async()=>function(u,d,f,g,E){const T=new yce({next:I=>{T.Za(),d.enqueueAndForget(()=>uce(u,C));const D=I.docs.has(f);!D&&I.fromCache?E.reject(new Rn(Mt.UNAVAILABLE,"Failed to get document because the client is offline.")):D&&I.fromCache&&g&&g.source==="server"?E.reject(new Rn(Mt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):E.resolve(I)},error:I=>E.reject(I)}),C=new lce(s5(f.path),T,{includeMetadataChanges:!0,_a:!0});return cce(u,C)}(await Sce(t),t.asyncQueue,e,r,o)),o.promise}function FHe(t,e,r={}){const o=new Gp;return t.asyncQueue.enqueueAndForget(async()=>function(u,d,f,g,E){const T=new yce({next:I=>{T.Za(),d.enqueueAndForget(()=>uce(u,C)),I.fromCache&&g.source==="server"?E.reject(new Rn(Mt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):E.resolve(I)},error:I=>E.reject(I)}),C=new lce(f,T,{includeMetadataChanges:!0,_a:!0});return cce(u,C)}(await Sce(t),t.asyncQueue,e,r,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tce(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LZ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bce(t,e,r){if(!r)throw new Rn(Mt.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function jHe(t,e,r,o){if(e===!0&&o===!0)throw new Rn(Mt.INVALID_ARGUMENT,`${t} and ${r} cannot be used together.`)}function xZ(t){if(!qn.isDocumentKey(t))throw new Rn(Mt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function MZ(t){if(qn.isDocumentKey(t))throw new Rn(Mt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function S5(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":lr()}function Qp(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Rn(Mt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=S5(t);throw new Rn(Mt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UZ{constructor(e){var r,o;if(e.host===void 0){if(e.ssl!==void 0)throw new Rn(Mt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Rn(Mt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}jHe("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Tce((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new Rn(Mt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new Rn(Mt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new Rn(Mt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,a){return o.timeoutSeconds===a.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hD{constructor(e,r,o,a){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=o,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new UZ({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Rn(Mt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Rn(Mt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new UZ(e),e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new rze;switch(o.type){case"firstParty":return new aze(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new Rn(Mt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const o=LZ.get(r);o&&(En("ComponentProvider","Removing Datastore"),LZ.delete(r),o.terminate())}(this),Promise.resolve()}}function BHe(t,e,r,o={}){var a;const u=(t=Qp(t,hD))._getSettings(),d=`${e}:${r}`;if(u.host!=="firestore.googleapis.com"&&u.host!==d&&PT("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},u),{host:d,ssl:!1})),o.mockUserToken){let f,g;if(typeof o.mockUserToken=="string")f=o.mockUserToken,g=Wc.MOCK_USER;else{f=Coe(o.mockUserToken,(a=t._app)===null||a===void 0?void 0:a.options.projectId);const E=o.mockUserToken.sub||o.mockUserToken.user_id;if(!E)throw new Rn(Mt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new Wc(E)}t._authCredentials=new ize(new _ae(f,g))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fD{constructor(e,r,o){this.converter=r,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new fD(this.firestore,e,this._query)}}class il{constructor(e,r,o){this.converter=r,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Og(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new il(this.firestore,e,this._key)}}class Og extends fD{constructor(e,r,o){super(e,r,s5(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new il(this.firestore,null,new qn(e))}withConverter(e){return new Og(this.firestore,e,this._path)}}function WHe(t,e,...r){if(t=Qo(t),bce("collection","path",e),t instanceof hD){const o=js.fromString(e,...r);return MZ(o),new Og(t,null,o)}{if(!(t instanceof il||t instanceof Og))throw new Rn(Mt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=t._path.child(js.fromString(e,...r));return MZ(o),new Og(t.firestore,null,o)}}function pR(t,e,...r){if(t=Qo(t),arguments.length===1&&(e=yae.newId()),bce("doc","path",e),t instanceof hD){const o=js.fromString(e,...r);return xZ(o),new il(t,null,new qn(o))}{if(!(t instanceof il||t instanceof Og))throw new Rn(Mt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=t._path.child(js.fromString(e,...r));return xZ(o),new il(t.firestore,t instanceof Og?t.converter:null,new qn(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VZ{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new ece(this,"async_queue_retry"),this.Vu=()=>{const o=S2();o&&En("AsyncQueue","Visibility state changed to "+o.visibilityState),this.t_.jo()},this.mu=e;const r=S2();r&&typeof r.addEventListener=="function"&&r.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const r=S2();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const r=new Gp;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!qR(e))throw e;En("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const r=this.mu.then(()=>(this.du=!0,e().catch(o=>{this.Eu=o,this.du=!1;const a=function(d){let f=d.message||"";return d.stack&&(f=d.stack.includes(d.message)?d.stack:d.message+`
`+d.stack),f}(o);throw Xp("INTERNAL UNHANDLED ERROR: ",a),o}).then(o=>(this.du=!1,o))));return this.mu=r,r}enqueueAfterDelay(e,r,o){this.fu(),this.Ru.indexOf(e)>-1&&(r=0);const a=v5.createAndSchedule(this,e,r,o,u=>this.yu(u));return this.Tu.push(a),a}fu(){this.Eu&&lr()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const r of this.Tu)if(r.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((r,o)=>r.targetTimeMs-o.targetTimeMs);for(const r of this.Tu)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const r=this.Tu.indexOf(e);this.Tu.splice(r,1)}}class QR extends hD{constructor(e,r,o,a){super(e,r,o,a),this.type="firestore",this._queue=new VZ,this._persistenceKey=(a==null?void 0:a.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new VZ(e),this._firestoreClient=void 0,await e}}}function zHe(t,e){const r=typeof t=="object"?t:z4(),o=typeof t=="string"?t:"(default)",a=Q1(r,"firestore").getImmediate({identifier:o});if(!a._initialized){const u=Toe("firestore");u&&BHe(a,...u)}return a}function T5(t){if(t._terminated)throw new Rn(Mt.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||GHe(t),t._firestoreClient}function GHe(t){var e,r,o;const a=t._freezeSettings(),u=function(f,g,E,T){return new Eze(f,g,E,T.host,T.ssl,T.experimentalForceLongPolling,T.experimentalAutoDetectLongPolling,Tce(T.experimentalLongPollingOptions),T.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,a);t._componentsProvider||!((r=a.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((o=a.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(t._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),t._firestoreClient=new xHe(t._authCredentials,t._appCheckCredentials,t._queue,u,t._componentsProvider&&function(f){const g=f==null?void 0:f._online.build();return{_offline:f==null?void 0:f._offline.build(g),_online:g}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UT{constructor(e){this._byteString=e}static fromBase64String(e){try{return new UT(gc.fromBase64String(e))}catch(r){throw new Rn(Mt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new UT(gc.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pD{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new Rn(Mt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fc(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b5{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w5{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new Rn(Mt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new Rn(Mt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ci(this._lat,e._lat)||Ci(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C5{constructor(e){this._values=(e||[]).map(r=>r)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,a){if(o.length!==a.length)return!1;for(let u=0;u<o.length;++u)if(o[u]!==a[u])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HHe=/^__.*__$/;class KHe{constructor(e,r,o){this.data=e,this.fieldMask=r,this.fieldTransforms=o}toMutation(e,r){return this.fieldMask!==null?new ev(e,this.data,this.fieldMask,r,this.fieldTransforms):new $R(e,this.data,r,this.fieldTransforms)}}class wce{constructor(e,r,o){this.data=e,this.fieldMask=r,this.fieldTransforms=o}toMutation(e,r){return new ev(e,this.data,this.fieldMask,r,this.fieldTransforms)}}function Cce(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw lr()}}class R5{constructor(e,r,o,a,u,d){this.settings=e,this.databaseId=r,this.serializer=o,this.ignoreUndefinedProperties=a,u===void 0&&this.vu(),this.fieldTransforms=u||[],this.fieldMask=d||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new R5(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var r;const o=(r=this.path)===null||r===void 0?void 0:r.child(e),a=this.Fu({path:o,xu:!1});return a.Ou(e),a}Nu(e){var r;const o=(r=this.path)===null||r===void 0?void 0:r.child(e),a=this.Fu({path:o,xu:!1});return a.vu(),a}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return r1(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Cce(this.Cu)&&HHe.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class qHe{constructor(e,r,o){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=o||uD(e)}Qu(e,r,o,a=!1){return new R5({Cu:e,methodName:r,qu:o,path:fc.emptyPath(),xu:!1,ku:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Rce(t){const e=t._freezeSettings(),r=uD(t._databaseId);return new qHe(t._databaseId,!!e.ignoreUndefinedProperties,r)}function $He(t,e,r,o,a,u={}){const d=t.Qu(u.merge||u.mergeFields?2:0,e,r,a);I5("Data must be an object, but it was:",d,o);const f=Ice(o,d);let g,E;if(u.merge)g=new Ml(d.fieldMask),E=d.fieldTransforms;else if(u.mergeFields){const T=[];for(const C of u.mergeFields){const I=mj(e,C,r);if(!d.contains(I))throw new Rn(Mt.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);kce(T,I)||T.push(I)}g=new Ml(T),E=d.fieldTransforms.filter(C=>g.covers(C.field))}else g=null,E=d.fieldTransforms;return new KHe(new el(f),g,E)}class mD extends b5{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof mD}}function YHe(t,e,r,o){const a=t.Qu(1,e,r);I5("Data must be an object, but it was:",a,o);const u=[],d=el.empty();Iy(o,(g,E)=>{const T=A5(e,g,r);E=Qo(E);const C=a.Nu(T);if(E instanceof mD)u.push(T);else{const I=gD(E,C);I!=null&&(u.push(T),d.set(T,I))}});const f=new Ml(u);return new wce(d,f,a.fieldTransforms)}function XHe(t,e,r,o,a,u){const d=t.Qu(1,e,r),f=[mj(e,o,r)],g=[a];if(u.length%2!=0)throw new Rn(Mt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let I=0;I<u.length;I+=2)f.push(mj(e,u[I])),g.push(u[I+1]);const E=[],T=el.empty();for(let I=f.length-1;I>=0;--I)if(!kce(E,f[I])){const D=f[I];let L=g[I];L=Qo(L);const B=d.Nu(D);if(L instanceof mD)E.push(D);else{const G=gD(L,B);G!=null&&(E.push(D),T.set(D,G))}}const C=new Ml(E);return new wce(T,C,d.fieldTransforms)}function gD(t,e){if(Ace(t=Qo(t)))return I5("Unsupported field value:",e,t),Ice(t,e);if(t instanceof b5)return function(o,a){if(!Cce(a.Cu))throw a.Bu(`${o._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Bu(`${o._methodName}() is not currently supported inside arrays`);const u=o._toFieldTransform(a);u&&a.fieldTransforms.push(u)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(o,a){const u=[];let d=0;for(const f of o){let g=gD(f,a.Lu(d));g==null&&(g={nullValue:"NULL_VALUE"}),u.push(g),d++}return{arrayValue:{values:u}}}(t,e)}return function(o,a){if((o=Qo(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return zze(a.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const u=ya.fromDate(o);return{timestampValue:e1(a.serializer,u)}}if(o instanceof ya){const u=new ya(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:e1(a.serializer,u)}}if(o instanceof w5)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof UT)return{bytesValue:Hae(a.serializer,o._byteString)};if(o instanceof il){const u=a.databaseId,d=o.firestore._databaseId;if(!d.isEqual(u))throw a.Bu(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:u5(o.firestore._databaseId||a.databaseId,o._key.path)}}if(o instanceof C5)return function(d,f){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:d.toArray().map(g=>{if(typeof g!="number")throw f.Bu("VectorValues must only contain numeric values.");return o5(f.serializer,g)})}}}}}}(o,a);throw a.Bu(`Unsupported field value: ${S5(o)}`)}(t,e)}function Ice(t,e){const r={};return Eae(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Iy(t,(o,a)=>{const u=gD(a,e.Mu(o));u!=null&&(r[o]=u)}),{mapValue:{fields:r}}}function Ace(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ya||t instanceof w5||t instanceof UT||t instanceof il||t instanceof b5||t instanceof C5)}function I5(t,e,r){if(!Ace(r)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(r)){const o=S5(r);throw o==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+o)}}function mj(t,e,r){if((e=Qo(e))instanceof pD)return e._internalPath;if(typeof e=="string")return A5(t,e);throw r1("Field path arguments must be of type string or ",t,!1,void 0,r)}const JHe=new RegExp("[~\\*/\\[\\]]");function A5(t,e,r){if(e.search(JHe)>=0)throw r1(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new pD(...e.split("."))._internalPath}catch{throw r1(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function r1(t,e,r,o,a){const u=o&&!o.isEmpty(),d=a!==void 0;let f=`Function ${e}() called with invalid data`;r&&(f+=" (via `toFirestore()`)"),f+=". ";let g="";return(u||d)&&(g+=" (found",u&&(g+=` in field ${o}`),d&&(g+=` in document ${a}`),g+=")"),new Rn(Mt.INVALID_ARGUMENT,f+t+g)}function kce(t,e){return t.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oce{constructor(e,r,o,a,u){this._firestore=e,this._userDataWriter=r,this._key=o,this._document=a,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new il(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new QHe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(Pce("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class QHe extends Oce{data(){return super.data()}}function Pce(t,e){return typeof e=="string"?A5(t,e):e instanceof pD?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZHe(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Rn(Mt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class e9e{convertValue(e,r="none"){switch(_y(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Po(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,r);case 5:return e.stringValue;case 6:return this.convertBytes(vy(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,r);case 11:return this.convertObject(e.mapValue,r);case 10:return this.convertVectorValue(e.mapValue);default:throw lr()}}convertObject(e,r){return this.convertObjectMap(e.fields,r)}convertObjectMap(e,r="none"){const o={};return Iy(e,(a,u)=>{o[a]=this.convertValue(u,r)}),o}convertVectorValue(e){var r,o,a;const u=(a=(o=(r=e.fields)===null||r===void 0?void 0:r.value.arrayValue)===null||o===void 0?void 0:o.values)===null||a===void 0?void 0:a.map(d=>Po(d.doubleValue));return new C5(u)}convertGeoPoint(e){return new w5(Po(e.latitude),Po(e.longitude))}convertArray(e,r){return(e.values||[]).map(o=>this.convertValue(o,r))}convertServerTimestamp(e,r){switch(r){case"previous":const o=t5(e);return o==null?null:this.convertValue(o,r);case"estimate":return this.convertTimestamp(uR(e));default:return null}}convertTimestamp(e){const r=Wg(e);return new ya(r.seconds,r.nanos)}convertDocumentKey(e,r){const o=js.fromString(e);Zi(Jae(o));const a=new lR(o.get(1),o.get(3)),u=new qn(o.popFirst(5));return a.isEqual(r)||Xp(`Document ${u} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t9e(t,e,r){let o;return o=t?t.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{constructor(e,r){this.hasPendingWrites=e,this.fromCache=r}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Nce extends Oce{constructor(e,r,o,a,u,d){super(e,r,o,a,d),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const r=new pN(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,r={}){if(this._document){const o=this._document.data.field(Pce("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,r.serverTimestamps)}}}class pN extends Nce{data(e={}){return super.data(e)}}class n9e{constructor(e,r,o,a){this._firestore=e,this._userDataWriter=r,this._snapshot=a,this.metadata=new aC(a.hasPendingWrites,a.fromCache),this.query=o}get docs(){const e=[];return this.forEach(r=>e.push(r)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,r){this._snapshot.docs.forEach(o=>{e.call(r,new pN(this._firestore,this._userDataWriter,o.key,o,new aC(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const r=!!e.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new Rn(Mt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(a,u){if(a._snapshot.oldDocs.isEmpty()){let d=0;return a._snapshot.docChanges.map(f=>{const g=new pN(a._firestore,a._userDataWriter,f.doc.key,f.doc,new aC(a._snapshot.mutatedKeys.has(f.doc.key),a._snapshot.fromCache),a.query.converter);return f.doc,{type:"added",doc:g,oldIndex:-1,newIndex:d++}})}{let d=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(f=>u||f.type!==3).map(f=>{const g=new pN(a._firestore,a._userDataWriter,f.doc.key,f.doc,new aC(a._snapshot.mutatedKeys.has(f.doc.key),a._snapshot.fromCache),a.query.converter);let E=-1,T=-1;return f.type!==0&&(E=d.indexOf(f.doc.key),d=d.delete(f.doc.key)),f.type!==1&&(d=d.add(f.doc),T=d.indexOf(f.doc.key)),{type:r9e(f.type),doc:g,oldIndex:E,newIndex:T}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function r9e(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return lr()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gj(t){t=Qp(t,il);const e=Qp(t.firestore,QR);return VHe(T5(e),t._key).then(r=>a9e(e,t,r))}class Dce extends e9e{constructor(e){super(),this.firestore=e}convertBytes(e){return new UT(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new il(this.firestore,null,r)}}function i9e(t){t=Qp(t,fD);const e=Qp(t.firestore,QR),r=T5(e),o=new Dce(e);return ZHe(t._query),FHe(r,t._query).then(a=>new n9e(e,o,t,a))}function s9e(t,e,r){t=Qp(t,il);const o=Qp(t.firestore,QR),a=t9e(t.converter,e);return Lce(o,[$He(Rce(o),"setDoc",t._key,a,t.converter!==null,r).toMutation(t._key,Sf.none())])}function o9e(t,e,r,...o){t=Qp(t,il);const a=Qp(t.firestore,QR),u=Rce(a);let d;return d=typeof(e=Qo(e))=="string"||e instanceof pD?XHe(u,"updateDoc",t._key,e,r,o):YHe(u,"updateDoc",t._key,e),Lce(a,[d.toMutation(t._key,Sf.exists(!0))])}function Lce(t,e){return function(o,a){const u=new Gp;return o.asyncQueue.enqueueAndForget(async()=>IHe(await UHe(o),a,u)),u.promise}(T5(t),e)}function a9e(t,e,r){const o=r.docs.get(e._key),a=new Dce(t);return new Nce(t,a,e._key,o,new aC(r.hasPendingWrites,r.fromCache),e.converter)}(function(e,r=!0){(function(a){ZT=a})(Cy),fy(new jg("firestore",(o,{instanceIdentifier:a,options:u})=>{const d=o.getProvider("app").getImmediate(),f=new QR(new sze(o.getProvider("auth-internal")),new uze(o.getProvider("app-check-internal")),function(E,T){if(!Object.prototype.hasOwnProperty.apply(E.options,["projectId"]))throw new Rn(Mt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new lR(E.options.projectId,T)}(d,a),d);return u=Object.assign({useFetchStreams:r},u),f._setSettings(u),f},"PUBLIC").setMultipleInstances(!0)),vf(rZ,"4.7.3",e),vf(rZ,"4.7.3","esm2017")})();var c9e="firebase",u9e="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */vf(c9e,u9e,"app");const l9e={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},xce=Aoe(l9e),d9e=dae(xce),VT=zHe(xce),yy=async t=>{try{Gt.log("userFirestore: Get user Profile data for user ID: "+t);const e=pR(VT,"users",t),r=await gj(e);return r.exists()?(Gt.log("userFirestore: Found Profile for : "+r.data().Nickname),r.data()):(Gt.error("userFirestore: user profile document not found"),null)}catch(e){throw Gt.error("userFirestore: Error fetching user profile data:",e),e}},h9e=async(t,e,r)=>{try{const a=(await j6e(d9e,t,e)).user,u=pR(VT,"users",a.uid);return await s9e(u,{email:a.email,createdAt:new Date,...r}),Gt.log("userFirestore: User created successfully."),a}catch(o){throw Gt.error("userFirestore: Error creating user:",o),o}},Mce=async(t,e)=>{try{Gt.log(`userFirestore: Updating rpmURL for user ID: ${t}`);const r=pR(VT,"users",t);await o9e(r,{rpmURL:e,lastUpdated:new Date().toISOString()}),Gt.log("userFirestore: rpmURL updated successfully.")}catch(r){throw Gt.error("userFirestore: Error updating rpmURL:",r),r}},f9e=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile"],cC={sendUserToUnity:"sendUserToUnity"};class p9e{constructor(){this.events={}}subscribe(e,r){this.events[e]||(this.events[e]=[]),this.events[e].push(r)}publish(e,r){const o=this.events[e];o?(o.forEach(a=>{a(r)}),Gt.log(`EventBus: Published event '${e}'`)):Gt.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,r){var a;const o=(a=this.events[e])==null?void 0:a.indexOf(r);o>-1&&this.events[e].splice(o,1)}}const uC=new p9e,Ad=X.createContext(null),m9e=({children:t})=>{const[e,r]=X.useState(null),o=X.useRef(null),[a,u]=X.useState(!0),d=dae(),f=G=>G?G.Nickname?G.Nickname:`${G.firstName} ${G.lastName}`:"Anon";X.useEffect(()=>{const G=G6e(d,async se=>{if(Gt.log("UserProvider: Firebase onAuthStateChanged() fired"),se)try{const ae=await yy(se.uid),M=f(ae),F={uid:se.uid,email:se.email,...ae,displayName:M};console.log(F),r(F),o.current=F,C(F)}catch(ae){Gt.error("UserProvider: Error fetching user profile data:",ae)}else r(null),o.current=null;u(!1)});return()=>{G&&G()}},[]);const g=async(G,se,ae)=>{try{const{firstName:M,lastName:F}=ae,z=`${M}${F.charAt(0).toUpperCase()}`,te={...ae,Nickname:z,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"},j=await h9e(G,se,te);r(j),o.current=j}catch(M){throw Gt.error("UserProvider: Error creating user:",M),M}},E=async(G,se)=>{try{const ae=await B6e(d,G,se),M=await yy(ae.user.uid),F=f(M),z={uid:ae.user.uid,email:ae.user.email,...M,displayName:F};r(z),C(z)}catch(ae){throw Gt.error("UserProvider: Error signing in:",ae),ae}},T=async()=>{try{await H6e(d),r(null),Gt.log("UserProvider: User signed out.")}catch(G){throw Gt.error("UserProvider: Error signing out:",G),G}},C=()=>{const G=o.current;if(G){const se=I(G);Gt.log("UserProvider: sendUserToUnity() using the eventBus",se),uC.publish(cC.sendUserToUnity,se)}else Gt.log("UserProvider: No current user to send to Unity.")},I=G=>{const se={};return[...f9e,"uid"].forEach(M=>{G.hasOwnProperty(M)&&(se[M]=G[M])}),se},D=async G=>{if(!e||!e.uid)return!1;try{const se=await getSpaceItem(G);return se.usersAllowed.includes(e.uid)||se.userAdmin.includes(e.uid)||se.usersModerators.includes(e.uid)}catch(se){return Gt.error("UserProvider: Error verifying user access to space:",se),!1}},L=async G=>{if(!e||!e.uid)return!1;try{return(await getSpaceItem(G)).userAdmin.includes(e.uid)}catch(se){return Gt.error("UserProvider: Error verifying user admin status for space:",se),!1}},B=async G=>{if(!e||!e.uid)return!1;try{return(await getSpaceItem(G)).usersModerators.includes(e.uid)}catch(se){return Gt.error("UserProvider: Error verifying user moderator status for space:",se),!1}};return $.jsx(Ad.Provider,{value:{user:e,loading:a,register:g,signIn:E,signOut:T,sendUserToUnity:C,userHasAccessToSpace:D,userIsAdminOfSpace:L,userIsModeratorOfSpace:B},children:t})},Uce=X.createContext(),lm=()=>X.useContext(Uce),g9e=({children:t})=>{const[e,r]=X.useState(!1),o=X.useRef(null),[a,u]=X.useState(!1);X.useEffect(()=>{const g=()=>{const E=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);u(E)};return g(),window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]);const d=X.useCallback(g=>{o.current=g},[]),f=X.useCallback(()=>{const g=o.current;if(!g)return;const E=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(a){console.log("Attempting mobile fullscreen...");const T=g.querySelector("video")||g;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(T.webkitEnterFullscreen)try{T.webkitEnterFullscreen(),r(!0);return}catch(C){console.error("iOS fullscreen error:",C)}try{if(T.webkitRequestFullscreen){T.webkitRequestFullscreen(),r(!0);return}}catch(C){console.error("iOS fallback fullscreen error:",C)}}if(/Android/i.test(navigator.userAgent))try{E?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),r(!1)):(g.requestFullscreen?g.requestFullscreen():g.webkitRequestFullscreen?g.webkitRequestFullscreen():g.mozRequestFullScreen?g.mozRequestFullScreen():g.msRequestFullscreen&&g.msRequestFullscreen(),r(!0));return}catch(C){console.error("Android fullscreen error:",C)}}try{E?document.exitFullscreen?document.exitFullscreen().then(()=>{r(!1)}).catch(T=>console.error("Error exiting fullscreen:",T)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),r(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),r(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),r(!1)):g.requestFullscreen?g.requestFullscreen().then(()=>{r(!0)}).catch(T=>console.error("Error entering fullscreen:",T)):g.webkitRequestFullscreen?(g.webkitRequestFullscreen(),r(!0)):g.mozRequestFullScreen?(g.mozRequestFullScreen(),r(!0)):g.msRequestFullscreen&&(g.msRequestFullscreen(),r(!0))}catch(T){console.error("Fullscreen error:",T)}},[a]);return X.useEffect(()=>{const g=()=>{const E=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;r(!!E)};return document.addEventListener("fullscreenchange",g),document.addEventListener("webkitfullscreenchange",g),document.addEventListener("mozfullscreenchange",g),document.addEventListener("MSFullscreenChange",g),()=>{document.removeEventListener("fullscreenchange",g),document.removeEventListener("webkitfullscreenchange",g),document.removeEventListener("mozfullscreenchange",g),document.removeEventListener("MSFullscreenChange",g)}},[]),$.jsx(Uce.Provider,{value:{isFullscreen:e,toggleFullscreen:f,fullscreenRef:o,setFullscreenRef:d,isMobile:a},children:$.jsx("div",{ref:d,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:t})})};var b2={},Lw={},xw={},FZ;function v9e(){if(FZ)return xw;FZ=1,Object.defineProperty(xw,"__esModule",{value:!0}),xw.useUnityCanvasId=void 0;var t=Cd(),e=0,r="react-unity-webgl-canvas",o=function(a){if(a.id!==void 0)return a.id;var u=(0,t.useMemo)(function(){return[r,++e].join("-")},[]);return u};return xw.useUnityCanvasId=o,xw}var Cp={},Mw={},jZ;function Vce(){if(jZ)return Mw;jZ=1,Object.defineProperty(Mw,"__esModule",{value:!0}),Mw.UnityLoaderStatus=void 0;var t;return function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(t||(Mw.UnityLoaderStatus=t={})),Mw}var Uw={},BZ;function k5(){return BZ||(BZ=1,Object.defineProperty(Uw,"__esModule",{value:!0}),Uw.isBrowserEnvironment=void 0,Uw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),Uw}var WZ;function _9e(){if(WZ)return Cp;WZ=1;var t=Cp&&Cp.__awaiter||function(d,f,g,E){function T(C){return C instanceof g?C:new g(function(I){I(C)})}return new(g||(g=Promise))(function(C,I){function D(G){try{B(E.next(G))}catch(se){I(se)}}function L(G){try{B(E.throw(G))}catch(se){I(se)}}function B(G){G.done?C(G.value):T(G.value).then(D,L)}B((E=E.apply(d,f||[])).next())})},e=Cp&&Cp.__generator||function(d,f){var g={label:0,sent:function(){if(C[0]&1)throw C[1];return C[1]},trys:[],ops:[]},E,T,C,I=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return I.next=D(0),I.throw=D(1),I.return=D(2),typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function D(B){return function(G){return L([B,G])}}function L(B){if(E)throw new TypeError("Generator is already executing.");for(;I&&(I=0,B[0]&&(g=0)),g;)try{if(E=1,T&&(C=B[0]&2?T.return:B[0]?T.throw||((C=T.return)&&C.call(T),0):T.next)&&!(C=C.call(T,B[1])).done)return C;switch(T=0,C&&(B=[B[0]&2,C.value]),B[0]){case 0:case 1:C=B;break;case 4:return g.label++,{value:B[1],done:!1};case 5:g.label++,T=B[1],B=[0];continue;case 7:B=g.ops.pop(),g.trys.pop();continue;default:if(C=g.trys,!(C=C.length>0&&C[C.length-1])&&(B[0]===6||B[0]===2)){g=0;continue}if(B[0]===3&&(!C||B[1]>C[0]&&B[1]<C[3])){g.label=B[1];break}if(B[0]===6&&g.label<C[1]){g.label=C[1],C=B;break}if(C&&g.label<C[2]){g.label=C[2],g.ops.push(B);break}C[2]&&g.ops.pop(),g.trys.pop();continue}B=f.call(d,g)}catch(G){B=[6,G],T=0}finally{E=C=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(Cp,"__esModule",{value:!0}),Cp.useUnityInstance=void 0;var r=Cd(),o=Vce(),a=k5(),u=function(d,f,g,E){(0,r.useEffect)(function(){(function(){return t(void 0,void 0,void 0,function(){var T,C;return e(this,function(I){switch(I.label){case 0:if(a.isBrowserEnvironment===!1)return[2];if(d!==o.UnityLoaderStatus.Loaded||f===null)return E.setUnityInstance(null),E.setInitialisationError(null),[2];I.label=1;case 1:return I.trys.push([1,3,,4]),[4,window.createUnityInstance(f,g,E.setLoadingProgression)];case 2:return T=I.sent(),E.setUnityInstance(T),E.setInitialisationError(null),[3,4];case 3:return C=I.sent(),E.setUnityInstance(null),E.setInitialisationError(C),[3,4];case 4:return[2]}})})})()},[d,f,g,E])};return Cp.useUnityInstance=u,Cp}var Vw={},zZ;function y9e(){if(zZ)return Vw;zZ=1,Object.defineProperty(Vw,"__esModule",{value:!0}),Vw.useUnityArguments=void 0;var t=Cd(),e=function(r){return(0,t.useMemo)(function(){return{dataUrl:r.unityProvider.unityConfig.dataUrl,frameworkUrl:r.unityProvider.unityConfig.frameworkUrl,codeUrl:r.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:r.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:r.unityProvider.unityConfig.memoryUrl,symbolsUrl:r.unityProvider.unityConfig.symbolsUrl,companyName:r.unityProvider.unityConfig.companyName,productName:r.unityProvider.unityConfig.productName,productVersion:r.unityProvider.unityConfig.productVersion,webglContextAttributes:r.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:r.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:r.devicePixelRatio||1,autoSyncPersistentDataPath:r.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof r.matchWebGLToCanvasSize=="boolean"?r.matchWebGLToCanvasSize:!0,disabledCanvasEvents:r.disabledCanvasEvents||["contextmenu","dragstart"],print:function(o){},printErr:function(o){}}},[])};return Vw.useUnityArguments=e,Vw}var Fw={},GZ;function E9e(){if(GZ)return Fw;GZ=1,Object.defineProperty(Fw,"__esModule",{value:!0}),Fw.useUnityLoader=void 0;var t=Cd(),e=k5(),r=Vce(),o=function(a){var u=(0,t.useState)(r.UnityLoaderStatus.Loading),d=u[0],f=u[1];return(0,t.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(a.loaderUrl===null){f(r.UnityLoaderStatus.Idle);return}var g=window.document.querySelector('script[src="'.concat(a.loaderUrl,'"]'));g===null?(g=window.document.createElement("script"),g.type="text/javascript",g.src=a.loaderUrl,g.async=!0,g.setAttribute("data-status","loading"),window.document.body.appendChild(g),g.addEventListener("load",function(){return g==null?void 0:g.setAttribute("data-status","loaded")}),g.addEventListener("error",function(){return g==null?void 0:g.setAttribute("data-status","error")})):f(g.getAttribute("data-status")==="loaded"?r.UnityLoaderStatus.Loaded:r.UnityLoaderStatus.Error);var E=function(T){return f(T.type==="load"?r.UnityLoaderStatus.Loaded:r.UnityLoaderStatus.Error)};return g.addEventListener("load",E),g.addEventListener("error",E),function(){g!==null&&(g.removeEventListener("load",E),g.removeEventListener("error",E),window.document.body.removeChild(g))}}},[a.loaderUrl]),d};return Fw.useUnityLoader=o,Fw}var HZ;function S9e(){if(HZ)return Lw;HZ=1,Object.defineProperty(Lw,"__esModule",{value:!0}),Lw.Unity=void 0;var t=Cd(),e=Cd(),r=v9e(),o=_9e(),a=y9e(),u=E9e(),d=(0,e.forwardRef)(function(f,g){var E=(0,e.useRef)(null),T=(0,r.useUnityCanvasId)(f),C=(0,a.useUnityArguments)(f),I=(0,u.useUnityLoader)(f.unityProvider.unityConfig);return(0,o.useUnityInstance)(I,E.current,C,f.unityProvider),(0,t.useImperativeHandle)(g,function(){return E.current}),(0,t.createElement)("canvas",{ref:E,id:T,style:f.style,className:f.className,tabIndex:f.tabIndex})});return Lw.Unity=d,Lw}var Rp={},jw={},KZ;function Fce(){if(KZ)return jw;KZ=1,Object.defineProperty(jw,"__esModule",{value:!0}),jw.errorMessages=void 0;var t={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return jw.errorMessages=t,jw}var k_={},qZ;function T9e(){if(qZ)return k_;qZ=1;var t=k_&&k_.__spreadArray||function(f,g,E){if(E||arguments.length===2)for(var T=0,C=g.length,I;T<C;T++)(I||!(T in g))&&(I||(I=Array.prototype.slice.call(g,0,T)),I[T]=g[T]);return f.concat(I||Array.prototype.slice.call(g))};Object.defineProperty(k_,"__esModule",{value:!0}),k_.useEventSystem=void 0;var e=Cd(),r=Fce(),o=k5(),a=[],u=function(f){for(var g=[],E=1;E<arguments.length;E++)g[E-1]=arguments[E];var T=void 0;return a.forEach(function(C){T=C.apply(void 0,t([f],g,!1))}),T};o.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=u);var d=function(){var f=(0,e.useRef)([]),g=(0,e.useCallback)(function(C,I){f.current=t(t([],f.current,!0),[{eventName:C,callback:I}],!1)},[f]),E=(0,e.useCallback)(function(C,I){f.current=f.current.filter(function(D){return D.eventName!==C&&D.callback!==I})},[f]),T=(0,e.useCallback)(function(C){for(var I=[],D=1;D<arguments.length;D++)I[D-1]=arguments[D];var L=f.current.find(function(B){return B.eventName===C});if(typeof L>"u"){console.warn(r.errorMessages.noEventListener,{eventName:C});return}return L.callback.apply(L,I)},[f]);return(0,e.useEffect)(function(){return a.push(T),function(){a.splice(a.indexOf(T),1)}},[T]),{addEventListener:g,removeEventListener:E}};return k_.useEventSystem=d,k_}var Bw={},$Z;function b9e(){if($Z)return Bw;$Z=1,Object.defineProperty(Bw,"__esModule",{value:!0}),Bw.useNullableState=void 0;var t=Cd(),e=function(r){return(0,t.useState)(r||null)};return Bw.useNullableState=e,Bw}var YZ;function w9e(){if(YZ)return Rp;YZ=1;var t=Rp&&Rp.__awaiter||function(f,g,E,T){function C(I){return I instanceof E?I:new E(function(D){D(I)})}return new(E||(E=Promise))(function(I,D){function L(se){try{G(T.next(se))}catch(ae){D(ae)}}function B(se){try{G(T.throw(se))}catch(ae){D(ae)}}function G(se){se.done?I(se.value):C(se.value).then(L,B)}G((T=T.apply(f,g||[])).next())})},e=Rp&&Rp.__generator||function(f,g){var E={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},T,C,I,D=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return D.next=L(0),D.throw=L(1),D.return=L(2),typeof Symbol=="function"&&(D[Symbol.iterator]=function(){return this}),D;function L(G){return function(se){return B([G,se])}}function B(G){if(T)throw new TypeError("Generator is already executing.");for(;D&&(D=0,G[0]&&(E=0)),E;)try{if(T=1,C&&(I=G[0]&2?C.return:G[0]?C.throw||((I=C.return)&&I.call(C),0):C.next)&&!(I=I.call(C,G[1])).done)return I;switch(C=0,I&&(G=[G[0]&2,I.value]),G[0]){case 0:case 1:I=G;break;case 4:return E.label++,{value:G[1],done:!1};case 5:E.label++,C=G[1],G=[0];continue;case 7:G=E.ops.pop(),E.trys.pop();continue;default:if(I=E.trys,!(I=I.length>0&&I[I.length-1])&&(G[0]===6||G[0]===2)){E=0;continue}if(G[0]===3&&(!I||G[1]>I[0]&&G[1]<I[3])){E.label=G[1];break}if(G[0]===6&&E.label<I[1]){E.label=I[1],I=G;break}if(I&&E.label<I[2]){E.label=I[2],E.ops.push(G);break}I[2]&&E.ops.pop(),E.trys.pop();continue}G=g.call(f,E)}catch(se){G=[6,se],C=0}finally{T=I=0}if(G[0]&5)throw G[1];return{value:G[0]?G[1]:void 0,done:!0}}};Object.defineProperty(Rp,"__esModule",{value:!0}),Rp.useUnityContext=void 0;var r=Cd(),o=Fce(),a=T9e(),u=b9e(),d=function(f){var g=(0,u.useNullableState)(),E=g[0],T=g[1],C=(0,r.useState)(0),I=C[0],D=C[1],L=(0,r.useState)(!1),B=L[0],G=L[1],se=(0,u.useNullableState)(),ae=se[0],M=se[1],F=(0,a.useEventSystem)(),z=(0,r.useRef)({setLoadingProgression:D,setInitialisationError:M,setUnityInstance:T,setIsLoaded:G,unityConfig:f}),te=(0,r.useCallback)(function(_e){if(E===null){console.warn(o.errorMessages.requestFullscreenNoUnityInstance);return}E.SetFullscreen(_e===!0?1:0)},[E]),j=(0,r.useCallback)(function(){if(E===null||typeof E.Module.canvas>"u"){console.warn(o.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return E.Module.canvas.requestPointerLock()},[E]),K=(0,r.useCallback)(function(_e,pe,qe){if(E===null){console.warn(o.errorMessages.sendMessageNoUnityInstance);return}E.SendMessage(_e,pe,qe)},[E]),Q=(0,r.useCallback)(function(_e,pe){if(E===null||typeof E.Module.canvas>"u"){console.warn(o.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return E.Module.canvas.toDataURL(_e,pe)},[E]),ce=(0,r.useCallback)(function(){return E===null?(console.warn(o.errorMessages.quitNoUnityInstance),Promise.reject()):E.Quit()},[E]),Ee=(0,r.useCallback)(function(){return t(void 0,void 0,void 0,function(){var _e;return e(this,function(pe){switch(pe.label){case 0:return E===null||typeof E.Module.canvas>"u"?(console.warn(o.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(_e=E.Module.canvas,document.body.appendChild(_e),_e.style.display="none",[4,ce()]);case 1:return pe.sent(),_e.remove(),[2]}})})},[E]);return(0,r.useEffect)(function(){G(I===1)},[I]),{unityProvider:z.current,loadingProgression:I,initialisationError:ae,isLoaded:B,UNSAFE__unityInstance:E,requestFullscreen:te,requestPointerLock:j,sendMessage:K,takeScreenshot:Q,unload:ce,UNSAFE__detachAndUnloadImmediate:Ee,addEventListener:F.addEventListener,removeEventListener:F.removeEventListener}};return Rp.useUnityContext=d,Rp}var XZ;function C9e(){return XZ||(XZ=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.useUnityContext=t.Unity=void 0;var e=S9e();Object.defineProperty(t,"Unity",{enumerable:!0,get:function(){return e.Unity}});var r=w9e();Object.defineProperty(t,"useUnityContext",{enumerable:!0,get:function(){return r.useUnityContext}})}(b2)),b2}var jce=C9e();const uh="[UnityProvider]",Bce=X.createContext(),R9e=({spaceID:t,children:e,loaderUrl:r,dataUrl:o,frameworkUrl:a,codeUrl:u,loadingBackground:d,showLoginButton:f,showDisruptiveLogo:g})=>{Gt.log(`${uh} Initializing with spaceID:`,t),Gt.log(`${uh} Unity URLs:`,{loaderUrl:r,dataUrl:o,frameworkUrl:a,codeUrl:u});const{unityProvider:E,loadingProgression:T,isLoaded:C,sendMessage:I,addEventListener:D,removeEventListener:L,error:B}=jce.useUnityContext({loaderUrl:r,dataUrl:o,frameworkUrl:a,codeUrl:u}),G=X.useRef(null),se=X.useRef(Date.now());X.useEffect(()=>{const z=()=>{document.hidden?(Gt.log(`${uh} Page hidden, starting keep-alive`),ae()):(Gt.log(`${uh} Page visible, stopping keep-alive`),M())};return document.addEventListener("visibilitychange",z),()=>{document.removeEventListener("visibilitychange",z),M()}},[]),X.useEffect(()=>{const z=()=>{se.current=Date.now(),document.hidden&&I("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",z),window.addEventListener("keydown",z),window.addEventListener("touchstart",z),()=>{window.removeEventListener("mousemove",z),window.removeEventListener("keydown",z),window.removeEventListener("touchstart",z)}},[I]);const ae=()=>{G.current||(G.current=setInterval(()=>{C&&document.hidden&&(I("WebGLInputManager","KeepAlive"),Gt.debug(`${uh} Sent keep-alive message`))},1e4))},M=()=>{G.current&&(clearInterval(G.current),G.current=null)};X.useEffect(()=>(Gt.log(`${uh} Component mounted`),()=>{Gt.log(`${uh} Component unmounting`),M()}),[]),X.useEffect(()=>{Gt.log(`${uh} Loading progress:`,T)},[T]),X.useEffect(()=>{C&&(Gt.log(`${uh} Unity instance loaded for:`,t),document.hidden&&ae())},[C,t]),X.useEffect(()=>{B&&Gt.error(`${uh} Unity error:`,B)},[B]);const F={spaceID:t,unityProvider:E,loadingProgression:T,isLoaded:C,sendMessage:I,addEventListener:D,removeEventListener:L};return Gt.log(`${uh} Rendering provider with instance:`,F),$.jsx(Bce.Provider,{value:F,children:e})},n0=()=>X.useContext(Bce);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wce="firebasestorage.googleapis.com",zce="storageBucket",I9e=2*60*1e3,A9e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa extends xf{constructor(e,r,o=0){super(w2(e),`Firebase Storage: ${r} (${w2(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Wa.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return w2(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ja;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ja||(ja={}));function w2(t){return"storage/"+t}function Gce(){const t="An unknown error occurred, please check the error payload for server response.";return new Wa(ja.UNKNOWN,t)}function k9e(t){return new Wa(ja.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function O9e(t){return new Wa(ja.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function P9e(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Wa(ja.UNAUTHENTICATED,t)}function N9e(){return new Wa(ja.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function D9e(t){return new Wa(ja.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function L9e(){return new Wa(ja.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function x9e(){return new Wa(ja.CANCELED,"User canceled the upload/download.")}function M9e(t){return new Wa(ja.INVALID_URL,"Invalid URL '"+t+"'.")}function U9e(t){return new Wa(ja.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function V9e(){return new Wa(ja.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+zce+"' property when initializing the app?")}function F9e(){return new Wa(ja.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function vj(t){return new Wa(ja.INVALID_ARGUMENT,t)}function Hce(){return new Wa(ja.APP_DELETED,"The Firebase app was deleted.")}function j9e(t){return new Wa(ja.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ww(t){throw new Wa(ja.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(e,r){this.bucket=e,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,r){let o;try{o=Ul.makeFromUrl(e,r)}catch{return new Ul(e,"")}if(o.path==="")return o;throw U9e(e)}static makeFromUrl(e,r){let o=null;const a="([A-Za-z0-9.\\-_]+)";function u(F){F.path.charAt(F.path.length-1)==="/"&&(F.path_=F.path_.slice(0,-1))}const d="(/(.*))?$",f=new RegExp("^gs://"+a+d,"i"),g={bucket:1,path:3};function E(F){F.path_=decodeURIComponent(F.path)}const T="v[A-Za-z0-9_]+",C=r.replace(/[.]/g,"\\."),I="(/([^?#]*).*)?$",D=new RegExp(`^https?://${C}/${T}/b/${a}/o${I}`,"i"),L={bucket:1,path:3},B=r===Wce?"(?:storage.googleapis.com|storage.cloud.google.com)":r,G="([^?#]*)",se=new RegExp(`^https?://${B}/${a}/${G}`,"i"),M=[{regex:f,indices:g,postModify:u},{regex:D,indices:L,postModify:E},{regex:se,indices:{bucket:1,path:2},postModify:E}];for(let F=0;F<M.length;F++){const z=M[F],te=z.regex.exec(e);if(te){const j=te[z.indices.bucket];let K=te[z.indices.path];K||(K=""),o=new Ul(j,K),z.postModify(o);break}}if(o==null)throw M9e(e);return o}}class B9e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W9e(t,e,r){let o=1,a=null,u=null,d=!1,f=0;function g(){return f===2}let E=!1;function T(...G){E||(E=!0,e.apply(null,G))}function C(G){a=setTimeout(()=>{a=null,t(D,g())},G)}function I(){u&&clearTimeout(u)}function D(G,...se){if(E){I();return}if(G){I(),T.call(null,G,...se);return}if(g()||d){I(),T.call(null,G,...se);return}o<64&&(o*=2);let M;f===1?(f=2,M=0):M=(o+Math.random())*1e3,C(M)}let L=!1;function B(G){L||(L=!0,I(),!E&&(a!==null?(G||(f=2),clearTimeout(a),C(0)):G||(f=1)))}return C(0),u=setTimeout(()=>{d=!0,B(!0)},r),B}function z9e(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G9e(t){return t!==void 0}function H9e(t){return typeof t=="object"&&!Array.isArray(t)}function Kce(t){return typeof t=="string"||t instanceof String}function JZ(t,e,r,o){if(o<e)throw vj(`Invalid value for '${t}'. Expected ${e} or greater.`);if(o>r)throw vj(`Invalid value for '${t}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qce(t,e,r){let o=e;return r==null&&(o=`https://${e}`),`${r}://${o}/v0${t}`}function $ce(t){const e=encodeURIComponent;let r="?";for(const o in t)if(t.hasOwnProperty(o)){const a=e(o)+"="+e(t[o]);r=r+a+"&"}return r=r.slice(0,-1),r}var ty;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(ty||(ty={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K9e(t,e){const r=t>=500&&t<600,a=[408,429].indexOf(t)!==-1,u=e.indexOf(t)!==-1;return r||a||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q9e{constructor(e,r,o,a,u,d,f,g,E,T,C,I=!0){this.url_=e,this.method_=r,this.headers_=o,this.body_=a,this.successCodes_=u,this.additionalRetryCodes_=d,this.callback_=f,this.errorCallback_=g,this.timeout_=E,this.progressCallback_=T,this.connectionFactory_=C,this.retry=I,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((D,L)=>{this.resolve_=D,this.reject_=L,this.start_()})}start_(){const e=(o,a)=>{if(a){o(!1,new AP(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const d=f=>{const g=f.loaded,E=f.lengthComputable?f.total:-1;this.progressCallback_!==null&&this.progressCallback_(g,E)};this.progressCallback_!==null&&u.addUploadProgressListener(d),u.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(d),this.pendingConnection_=null;const f=u.getErrorCode()===ty.NO_ERROR,g=u.getStatus();if(!f||K9e(g,this.additionalRetryCodes_)&&this.retry){const T=u.getErrorCode()===ty.ABORT;o(!1,new AP(!1,null,T));return}const E=this.successCodes_.indexOf(g)!==-1;o(!0,new AP(E,u))})},r=(o,a)=>{const u=this.resolve_,d=this.reject_,f=a.connection;if(a.wasSuccessCode)try{const g=this.callback_(f,f.getResponse());G9e(g)?u(g):u()}catch(g){d(g)}else if(f!==null){const g=Gce();g.serverResponse=f.getErrorText(),this.errorCallback_?d(this.errorCallback_(f,g)):d(g)}else if(a.canceled){const g=this.appDelete_?Hce():x9e();d(g)}else{const g=L9e();d(g)}};this.canceled_?r(!1,new AP(!1,null,!0)):this.backoffId_=W9e(e,r,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&z9e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class AP{constructor(e,r,o){this.wasSuccessCode=e,this.connection=r,this.canceled=!!o}}function $9e(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function Y9e(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function X9e(t,e){e&&(t["X-Firebase-GMPID"]=e)}function J9e(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function Q9e(t,e,r,o,a,u,d=!0){const f=$ce(t.urlParams),g=t.url+f,E=Object.assign({},t.headers);return X9e(E,e),$9e(E,r),Y9e(E,u),J9e(E,o),new q9e(g,t.method,E,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,a,d)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yce(t){let e;try{e=JSON.parse(t)}catch{return null}return H9e(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z9e(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function eKe(t,e){const r=e.split("/").filter(o=>o.length>0).join("/");return t.length===0?r:t+"/"+r}function Xce(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tKe(t,e){return e}class fu{constructor(e,r,o,a){this.server=e,this.local=r||e,this.writable=!!o,this.xform=a||tKe}}let kP=null;function nKe(t){return!Kce(t)||t.length<2?t:Xce(t)}function rKe(){if(kP)return kP;const t=[];t.push(new fu("bucket")),t.push(new fu("generation")),t.push(new fu("metageneration")),t.push(new fu("name","fullPath",!0));function e(u,d){return nKe(d)}const r=new fu("name");r.xform=e,t.push(r);function o(u,d){return d!==void 0?Number(d):d}const a=new fu("size");return a.xform=o,t.push(a),t.push(new fu("timeCreated")),t.push(new fu("updated")),t.push(new fu("md5Hash",null,!0)),t.push(new fu("cacheControl",null,!0)),t.push(new fu("contentDisposition",null,!0)),t.push(new fu("contentEncoding",null,!0)),t.push(new fu("contentLanguage",null,!0)),t.push(new fu("contentType",null,!0)),t.push(new fu("metadata","customMetadata",!0)),kP=t,kP}function iKe(t,e){function r(){const o=t.bucket,a=t.fullPath,u=new Ul(o,a);return e._makeStorageReference(u)}Object.defineProperty(t,"ref",{get:r})}function sKe(t,e,r){const o={};o.type="file";const a=r.length;for(let u=0;u<a;u++){const d=r[u];o[d.local]=d.xform(o,e[d.server])}return iKe(o,t),o}function oKe(t,e,r){const o=Yce(e);return o===null?null:sKe(t,o,r)}function aKe(t,e,r,o){const a=Yce(e);if(a===null||!Kce(a.downloadTokens))return null;const u=a.downloadTokens;if(u.length===0)return null;const d=encodeURIComponent;return u.split(",").map(E=>{const T=t.bucket,C=t.fullPath,I="/b/"+d(T)+"/o/"+d(C),D=qce(I,r,o),L=$ce({alt:"media",token:E});return D+L})[0]}class cKe{constructor(e,r,o,a){this.url=e,this.method=r,this.handler=o,this.timeout=a,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uKe(t){if(!t)throw Gce()}function lKe(t,e){function r(o,a){const u=oKe(t,a,e);return uKe(u!==null),aKe(u,a,t.host,t._protocol)}return r}function dKe(t){function e(r,o){let a;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?a=N9e():a=P9e():r.getStatus()===402?a=O9e(t.bucket):r.getStatus()===403?a=D9e(t.path):a=o,a.status=r.getStatus(),a.serverResponse=o.serverResponse,a}return e}function hKe(t){const e=dKe(t);function r(o,a){let u=e(o,a);return o.getStatus()===404&&(u=k9e(t.path)),u.serverResponse=a.serverResponse,u}return r}function fKe(t,e,r){const o=e.fullServerUrl(),a=qce(o,t.host,t._protocol),u="GET",d=t.maxOperationRetryTime,f=new cKe(a,u,lKe(t,r),d);return f.errorHandler=hKe(e),f}class pKe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ty.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ty.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ty.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,r,o,a){if(this.sent_)throw Ww("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(r,e,!0),a!==void 0)for(const u in a)a.hasOwnProperty(u)&&this.xhr_.setRequestHeader(u,a[u].toString());return o!==void 0?this.xhr_.send(o):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ww("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ww("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ww("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ww("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class mKe extends pKe{initXhr(){this.xhr_.responseType="text"}}function gKe(){return new mKe}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ey{constructor(e,r){this._service=e,r instanceof Ul?this._location=r:this._location=Ul.makeFromUrl(r,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,r){return new Ey(e,r)}get root(){const e=new Ul(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Xce(this._location.path)}get storage(){return this._service}get parent(){const e=Z9e(this._location.path);if(e===null)return null;const r=new Ul(this._location.bucket,e);return new Ey(this._service,r)}_throwIfRoot(e){if(this._location.path==="")throw j9e(e)}}function vKe(t){t._throwIfRoot("getDownloadURL");const e=fKe(t.storage,t._location,rKe());return t.storage.makeRequestWithTokens(e,gKe).then(r=>{if(r===null)throw F9e();return r})}function _Ke(t,e){const r=eKe(t._location.path,e),o=new Ul(t._location.bucket,r);return new Ey(t.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yKe(t){return/^[A-Za-z]+:\/\//.test(t)}function EKe(t,e){return new Ey(t,e)}function Jce(t,e){if(t instanceof O5){const r=t;if(r._bucket==null)throw V9e();const o=new Ey(r,r._bucket);return e!=null?Jce(o,e):o}else return e!==void 0?_Ke(t,e):t}function SKe(t,e){if(e&&yKe(e)){if(t instanceof O5)return EKe(t,e);throw vj("To use ref(service, url), the first argument must be a Storage instance.")}else return Jce(t,e)}function QZ(t,e){const r=e==null?void 0:e[zce];return r==null?null:Ul.makeFromBucketSpec(r,t)}function TKe(t,e,r,o={}){t.host=`${e}:${r}`,t._protocol="http";const{mockUserToken:a}=o;a&&(t._overrideAuthToken=typeof a=="string"?a:Coe(a,t.app.options.projectId))}class O5{constructor(e,r,o,a,u){this.app=e,this._authProvider=r,this._appCheckProvider=o,this._url=a,this._firebaseVersion=u,this._bucket=null,this._host=Wce,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=I9e,this._maxUploadRetryTime=A9e,this._requests=new Set,a!=null?this._bucket=Ul.makeFromBucketSpec(a,this._host):this._bucket=QZ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ul.makeFromBucketSpec(this._url,e):this._bucket=QZ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){JZ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){JZ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const r=await e.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ey(this,e)}_makeRequest(e,r,o,a,u=!0){if(this._deleted)return new B9e(Hce());{const d=Q9e(e,this._appId,o,a,r,this._firebaseVersion,u);return this._requests.add(d),d.getPromise().then(()=>this._requests.delete(d),()=>this._requests.delete(d)),d}}async makeRequestWithTokens(e,r){const[o,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,r,o,a).getPromise()}}const ZZ="@firebase/storage",eee="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qce="storage";function bKe(t){return t=Qo(t),vKe(t)}function wKe(t,e){return t=Qo(t),SKe(t,e)}function CKe(t=z4(),e){t=Qo(t);const o=Q1(t,Qce).getImmediate({identifier:e}),a=Toe("storage");return a&&RKe(o,...a),o}function RKe(t,e,r,o={}){TKe(t,e,r,o)}function IKe(t,{instanceIdentifier:e}){const r=t.getProvider("app").getImmediate(),o=t.getProvider("auth-internal"),a=t.getProvider("app-check-internal");return new O5(r,o,a,e,Cy)}function AKe(){fy(new jg(Qce,IKe,"PUBLIC").setMultipleInstances(!0)),vf(ZZ,eee,""),vf(ZZ,eee,"esm2017")}AKe();const Zce=async t=>{const e=CKe(),r=wKe(e,t);try{return await bKe(r)}catch(o){throw Gt.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",o),o}};let kKe={};const OKe=async t=>{try{const e=pR(VT,"spaces",t),r=await gj(e);if(r.exists()){let o=r.data();if(o.webglBuildId){const a=pR(VT,"webglBuilds",o.webglBuildId),u=await gj(a);if(u.exists()){const d=u.data();o={...o,...d}}else Gt.warn(`spacesFirestore: No document found for webglBuildId: ${o.webglBuildId}`)}return o=await PKe(o),o=NKe(o),console.log("Space data:",o),Gt.log(`spacesFirestore: Caching space data for: ${t}`),kKe[t]=o,o}else return Gt.warn(`spacesFirestore: No document found for item ID: ${t}`),null}catch(e){throw Gt.error("spacesFirestore: Error fetching item data:",e),e}},PKe=async t=>{const r=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async o=>{const a=t[o];a&&a.startsWith("gs://")&&(t[o]=await Zce(a))});return await Promise.all(r),t},NKe=t=>{const{gsUrlCode:e,gsUrlData:r,gsUrlFramework:o,gsUrlLoader:a,...u}=t;return{...u,codeUrl:e,dataUrl:r,frameworkUrl:o,loaderUrl:a}};let C2={};const eue=async t=>{Gt.log("spacesFirestore: Get Videos from Firestore for space: ",t);try{if(C2[t])return Gt.log("spacesFirestore: Returning cached videos for space:",t),C2[t];const e=WHe(VT,`spaces/${t}/videos`),r=await i9e(e),o=[];return r.forEach(a=>{o.push({id:a.id,...a.data()})}),C2[t]=o,o}catch(e){throw Gt.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},vD=()=>{const{sendMessage:t,isLoaded:e}=n0(),r=X.useRef([]),o=X.useCallback(()=>{if(e)for(;r.current.length>0;){const{eventName:u,data:d}=r.current.shift();Gt.log("useSendUnityEvent: Processing queued event to Unity:",u,d);try{t("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:u,data:JSON.stringify(d)}))}catch(f){Gt.error("useSendUnityEvent: Error sending event to Unity:",f),r.current.unshift({eventName:u,data:d});break}}},[t,e]);return X.useEffect(()=>{const u=setInterval(()=>{o()},1e3);return()=>clearInterval(u)},[o]),X.useCallback((u,d)=>{Gt.log("useSendUnityEvent: Queuing event for Unity:",u),r.current.push({eventName:u,data:d}),o()},[o])},ZR=()=>{const{addEventListener:t,removeEventListener:e}=n0();return X.useCallback((r,o)=>{const a=u=>{Gt.log(r+" unity message received.");let d=null;if(u)try{d=JSON.parse(u)}catch(f){Gt.warn("Failed to parse JSON data from Unity message:",f)}o(d)};return t(r,a),()=>{e(r,a)}},[t,e])},DKe=()=>{const[t,e]=X.useState(!1),r=ZR();return X.useEffect(()=>{const a=r("FirstSceneLoaded",()=>{Gt.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{a()}},[r]),t},LKe=t=>{const[e,r]=X.useState(null),o=ZR(),{spaceID:a}=n0();return X.useEffect(()=>{let d=!0;const g=o("PlayVideo",async E=>{try{const{gameObjectName:T}=E;if(!T){Gt.error("Game object name is missing in Unity event data.");return}const C=await eue(a);Gt.log("SPACES VIDEOS",C);const I=C.find(D=>D.id===T);I&&d?(r(I.url),Gt.log("Video URL set to:",I.url)):console.error("Video not found for game object:",T)}catch(T){console.error("Error fetching space videos:",T)}});return()=>{d=!1,g()}},[o,a,t]),[e,()=>{r(null)}]},xKe=()=>{const t=ZR(),{sendUserToUnity:e}=X.useContext(Ad);return X.useEffect(()=>{const o=t("RequestUserForUnity",()=>{Gt.log("React: Request from Unity to send user data"),e()});return()=>{o()}},[t,e]),!0},MKe=()=>{const{spaceID:t}=n0(),e=vD();X.useEffect(()=>{(async()=>{try{if(!t)throw new Error("spaceID is not defined.");const o=await eue(t),a=async f=>{const g=`https://vimeo.com/api/oembed.json?url=${f}`,E=await fetch(g);if(!E.ok)throw new Error(`Failed to fetch thumbnail: ${E.statusText}`);const T=await E.json(),C=T.thumbnail_url.replace(/_\d+x\d+/,""),I=["640x360","295x166"];let D=null;for(let L of I){const B=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${C}_${L}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(B,{method:"HEAD"})).ok){D=B;break}}catch(G){console.warn(`Failed to validate thumbnail URL: ${B}`,G)}}return D||T.thumbnail_url},u=o.map(async f=>{const g=await a(f.url);return{gameObjectName:f.id,thumbnailUrl:g}}),d=await Promise.all(u);Gt.log("Fetched Thumbnails",d),d.forEach(({gameObjectName:f,thumbnailUrl:g})=>{e("SetThumbnail",{gameObjectName:f,thumbnailUrl:g})})}catch(o){Gt.error("Error fetching thumbnails:",o)}})()},[e,t])},UKe=()=>{const[t,e]=X.useState(null),r=ZR();return console.log(" Nameplate click hook initialized"),X.useEffect(()=>{console.log(" Setting up nameplate click listener...");const u=r("OpenNameplateModal",d=>{if(console.log(" Nameplate click detected!",d),!d){console.warn(" Received empty data in nameplate click handler");return}try{const f=typeof d=="string"?JSON.parse(d):d;e({playerName:f.playerName,playerId:f.playerId,uid:f.uid,isLocalPlayer:f.isLocalPlayer}),console.log(" Processed nameplate data:",f)}catch(f){console.error(" Error processing nameplate data:",f)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof u=="function"&&u()}},[r]),[t,()=>{console.log(" Resetting nameplate data"),e(null)}]},tue=()=>{const[t,e]=X.useState([]),r=ZR();return X.useEffect(()=>{let o=!0,a=null;const u=()=>{window.unityInstance&&(Gt.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},d=D=>{if(o){Gt.log("UpdatePlayerList unity message received.");try{let L=[];if(typeof D=="object"&&D!==null?L=D.players||[]:L=JSON.parse(D).players||[],Array.isArray(L)){const B=Array.from(new Map(L.map(G=>[G.playerId,G])).values());e(B),a&&(clearTimeout(a),a=null)}}catch(L){Gt.error("Error handling player list data:",L),a||(a=setTimeout(u,1e3))}}},f=()=>{Gt.log("Player disconnected, requesting fresh player list"),u()},g=()=>{Gt.log("Player left, requesting fresh player list"),u()};u();const E=r("UpdatePlayerList",d),T=r("PlayerDisconnected",f),C=r("PlayerLeft",g),I=setInterval(u,5e3);return()=>{o=!1,a&&clearTimeout(a),typeof E=="function"&&E(),typeof T=="function"&&T(),typeof C=="function"&&C(),clearInterval(I)}},[r]),t},VKe=t=>({opacity:1});go.string.isRequired,go.func.isRequired;var eI=t=>t.type==="checkbox",rT=t=>t instanceof Date,pu=t=>t==null;const nue=t=>typeof t=="object";var Ea=t=>!pu(t)&&!Array.isArray(t)&&nue(t)&&!rT(t),FKe=t=>Ea(t)&&t.target?eI(t.target)?t.target.checked:t.target.value:t,jKe=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,BKe=(t,e)=>t.has(jKe(e)),WKe=t=>{const e=t.constructor&&t.constructor.prototype;return Ea(e)&&e.hasOwnProperty("isPrototypeOf")},P5=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function yd(t){let e;const r=Array.isArray(t);if(t instanceof Date)e=new Date(t);else if(t instanceof Set)e=new Set(t);else if(!(P5&&(t instanceof Blob||t instanceof FileList))&&(r||Ea(t)))if(e=r?[]:{},!r&&!WKe(t))e=t;else for(const o in t)t.hasOwnProperty(o)&&(e[o]=yd(t[o]));else return t;return e}var tI=t=>Array.isArray(t)?t.filter(Boolean):[],Oo=t=>t===void 0,yn=(t,e,r)=>{if(!e||!Ea(t))return r;const o=tI(e.split(/[,[\].]+?/)).reduce((a,u)=>pu(a)?a:a[u],t);return Oo(o)||o===t?Oo(t[e])?r:t[e]:o},kp=t=>typeof t=="boolean";const tee={BLUR:"blur",FOCUS_OUT:"focusout"},dh={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Ip={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};Di.createContext(null);var zKe=(t,e,r,o=!0)=>{const a={defaultValues:e._defaultValues};for(const u in t)Object.defineProperty(a,u,{get:()=>{const d=u;return e._proxyFormState[d]!==dh.all&&(e._proxyFormState[d]=!o||dh.all),t[d]}});return a},Ll=t=>Ea(t)&&!Object.keys(t).length,GKe=(t,e,r,o)=>{r(t);const{name:a,...u}=t;return Ll(u)||Object.keys(u).length>=Object.keys(e).length||Object.keys(u).find(d=>e[d]===dh.all)},R2=t=>Array.isArray(t)?t:[t];function HKe(t){const e=Di.useRef(t);e.current=t,Di.useEffect(()=>{const r=!t.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{r&&r.unsubscribe()}},[t.disabled])}var df=t=>typeof t=="string",KKe=(t,e,r,o,a)=>df(t)?(o&&e.watch.add(t),yn(r,t,a)):Array.isArray(t)?t.map(u=>(o&&e.watch.add(u),yn(r,u))):(o&&(e.watchAll=!0),r),N5=t=>/^\w*$/.test(t),rue=t=>tI(t.replace(/["|']|\]/g,"").split(/\.|\[/)),Os=(t,e,r)=>{let o=-1;const a=N5(e)?[e]:rue(e),u=a.length,d=u-1;for(;++o<u;){const f=a[o];let g=r;if(o!==d){const E=t[f];g=Ea(E)||Array.isArray(E)?E:isNaN(+a[o+1])?{}:[]}t[f]=g,t=t[f]}return t},qKe=(t,e,r,o,a)=>e?{...r[t],types:{...r[t]&&r[t].types?r[t].types:{},[o]:a||!0}}:{},nee=t=>({isOnSubmit:!t||t===dh.onSubmit,isOnBlur:t===dh.onBlur,isOnChange:t===dh.onChange,isOnAll:t===dh.all,isOnTouch:t===dh.onTouched}),ree=(t,e,r)=>!r&&(e.watchAll||e.watch.has(t)||[...e.watch].some(o=>t.startsWith(o)&&/^\.\w+/.test(t.slice(o.length))));const DC=(t,e,r,o)=>{for(const a of r||Object.keys(t)){const u=yn(t,a);if(u){const{_f:d,...f}=u;if(d){if(d.refs&&d.refs[0]&&e(d.refs[0],a)&&!o)break;if(d.ref&&e(d.ref,d.name)&&!o)break;DC(f,e)}else Ea(f)&&DC(f,e)}}};var $Ke=(t,e,r)=>{const o=tI(yn(t,r));return Os(o,"root",e[r]),Os(t,r,o),t},D5=t=>t.type==="file",wg=t=>typeof t=="function",i1=t=>{if(!P5)return!1;const e=t?t.ownerDocument:0;return t instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},mN=t=>df(t),L5=t=>t.type==="radio",s1=t=>t instanceof RegExp;const iee={value:!1,isValid:!1},see={value:!0,isValid:!0};var iue=t=>{if(Array.isArray(t)){if(t.length>1){const e=t.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:e,isValid:!!e.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!Oo(t[0].attributes.value)?Oo(t[0].value)||t[0].value===""?see:{value:t[0].value,isValid:!0}:see:iee}return iee};const oee={isValid:!1,value:null};var sue=t=>Array.isArray(t)?t.reduce((e,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:e,oee):oee;function aee(t,e,r="validate"){if(mN(t)||Array.isArray(t)&&t.every(mN)||kp(t)&&!t)return{type:r,message:mN(t)?t:"",ref:e}}var US=t=>Ea(t)&&!s1(t)?t:{value:t,message:""},cee=async(t,e,r,o,a)=>{const{ref:u,refs:d,required:f,maxLength:g,minLength:E,min:T,max:C,pattern:I,validate:D,name:L,valueAsNumber:B,mount:G,disabled:se}=t._f,ae=yn(e,L);if(!G||se)return{};const M=d?d[0]:u,F=_e=>{o&&M.reportValidity&&(M.setCustomValidity(kp(_e)?"":_e||""),M.reportValidity())},z={},te=L5(u),j=eI(u),K=te||j,Q=(B||D5(u))&&Oo(u.value)&&Oo(ae)||i1(u)&&u.value===""||ae===""||Array.isArray(ae)&&!ae.length,ce=qKe.bind(null,L,r,z),Ee=(_e,pe,qe,St=Ip.maxLength,ke=Ip.minLength)=>{const Ne=_e?pe:qe;z[L]={type:_e?St:ke,message:Ne,ref:u,...ce(_e?St:ke,Ne)}};if(a?!Array.isArray(ae)||!ae.length:f&&(!K&&(Q||pu(ae))||kp(ae)&&!ae||j&&!iue(d).isValid||te&&!sue(d).isValid)){const{value:_e,message:pe}=mN(f)?{value:!!f,message:f}:US(f);if(_e&&(z[L]={type:Ip.required,message:pe,ref:M,...ce(Ip.required,pe)},!r))return F(pe),z}if(!Q&&(!pu(T)||!pu(C))){let _e,pe;const qe=US(C),St=US(T);if(!pu(ae)&&!isNaN(ae)){const ke=u.valueAsNumber||ae&&+ae;pu(qe.value)||(_e=ke>qe.value),pu(St.value)||(pe=ke<St.value)}else{const ke=u.valueAsDate||new Date(ae),Ne=ve=>new Date(new Date().toDateString()+" "+ve),Re=u.type=="time",Ve=u.type=="week";df(qe.value)&&ae&&(_e=Re?Ne(ae)>Ne(qe.value):Ve?ae>qe.value:ke>new Date(qe.value)),df(St.value)&&ae&&(pe=Re?Ne(ae)<Ne(St.value):Ve?ae<St.value:ke<new Date(St.value))}if((_e||pe)&&(Ee(!!_e,qe.message,St.message,Ip.max,Ip.min),!r))return F(z[L].message),z}if((g||E)&&!Q&&(df(ae)||a&&Array.isArray(ae))){const _e=US(g),pe=US(E),qe=!pu(_e.value)&&ae.length>+_e.value,St=!pu(pe.value)&&ae.length<+pe.value;if((qe||St)&&(Ee(qe,_e.message,pe.message),!r))return F(z[L].message),z}if(I&&!Q&&df(ae)){const{value:_e,message:pe}=US(I);if(s1(_e)&&!ae.match(_e)&&(z[L]={type:Ip.pattern,message:pe,ref:u,...ce(Ip.pattern,pe)},!r))return F(pe),z}if(D){if(wg(D)){const _e=await D(ae,e),pe=aee(_e,M);if(pe&&(z[L]={...pe,...ce(Ip.validate,pe.message)},!r))return F(pe.message),z}else if(Ea(D)){let _e={};for(const pe in D){if(!Ll(_e)&&!r)break;const qe=aee(await D[pe](ae,e),M,pe);qe&&(_e={...qe,...ce(pe,qe.message)},F(qe.message),r&&(z[L]=_e))}if(!Ll(_e)&&(z[L]={ref:M,..._e},!r))return z}}return F(!0),z};function YKe(t,e){const r=e.slice(0,-1).length;let o=0;for(;o<r;)t=Oo(t)?o++:t[e[o++]];return t}function XKe(t){for(const e in t)if(t.hasOwnProperty(e)&&!Oo(t[e]))return!1;return!0}function va(t,e){const r=Array.isArray(e)?e:N5(e)?[e]:rue(e),o=r.length===1?t:YKe(t,r),a=r.length-1,u=r[a];return o&&delete o[u],a!==0&&(Ea(o)&&Ll(o)||Array.isArray(o)&&XKe(o))&&va(t,r.slice(0,-1)),t}var I2=()=>{let t=[];return{get observers(){return t},next:a=>{for(const u of t)u.next&&u.next(a)},subscribe:a=>(t.push(a),{unsubscribe:()=>{t=t.filter(u=>u!==a)}}),unsubscribe:()=>{t=[]}}},o1=t=>pu(t)||!nue(t);function G_(t,e){if(o1(t)||o1(e))return t===e;if(rT(t)&&rT(e))return t.getTime()===e.getTime();const r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(const a of r){const u=t[a];if(!o.includes(a))return!1;if(a!=="ref"){const d=e[a];if(rT(u)&&rT(d)||Ea(u)&&Ea(d)||Array.isArray(u)&&Array.isArray(d)?!G_(u,d):u!==d)return!1}}return!0}var oue=t=>t.type==="select-multiple",JKe=t=>L5(t)||eI(t),A2=t=>i1(t)&&t.isConnected,aue=t=>{for(const e in t)if(wg(t[e]))return!0;return!1};function a1(t,e={}){const r=Array.isArray(t);if(Ea(t)||r)for(const o in t)Array.isArray(t[o])||Ea(t[o])&&!aue(t[o])?(e[o]=Array.isArray(t[o])?[]:{},a1(t[o],e[o])):pu(t[o])||(e[o]=!0);return e}function cue(t,e,r){const o=Array.isArray(t);if(Ea(t)||o)for(const a in t)Array.isArray(t[a])||Ea(t[a])&&!aue(t[a])?Oo(e)||o1(r[a])?r[a]=Array.isArray(t[a])?a1(t[a],[]):{...a1(t[a])}:cue(t[a],pu(e)?{}:e[a],r[a]):r[a]=!G_(t[a],e[a]);return r}var OP=(t,e)=>cue(t,e,a1(e)),uue=(t,{valueAsNumber:e,valueAsDate:r,setValueAs:o})=>Oo(t)?t:e?t===""?NaN:t&&+t:r&&df(t)?new Date(t):o?o(t):t;function k2(t){const e=t.ref;if(!(t.refs?t.refs.every(r=>r.disabled):e.disabled))return D5(e)?e.files:L5(e)?sue(t.refs).value:oue(e)?[...e.selectedOptions].map(({value:r})=>r):eI(e)?iue(t.refs).value:uue(Oo(e.value)?t.ref.value:e.value,t)}var QKe=(t,e,r,o)=>{const a={};for(const u of t){const d=yn(e,u);d&&Os(a,u,d._f)}return{criteriaMode:r,names:[...t],fields:a,shouldUseNativeValidation:o}},zw=t=>Oo(t)?t:s1(t)?t.source:Ea(t)?s1(t.value)?t.value.source:t.value:t,ZKe=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate);function uee(t,e,r){const o=yn(t,r);if(o||N5(r))return{error:o,name:r};const a=r.split(".");for(;a.length;){const u=a.join("."),d=yn(e,u),f=yn(t,u);if(d&&!Array.isArray(d)&&r!==u)return{name:r};if(f&&f.type)return{name:u,error:f};a.pop()}return{name:r}}var eqe=(t,e,r,o,a)=>a.isOnAll?!1:!r&&a.isOnTouch?!(e||t):(r?o.isOnBlur:a.isOnBlur)?!t:(r?o.isOnChange:a.isOnChange)?t:!0,tqe=(t,e)=>!tI(yn(t,e)).length&&va(t,e);const nqe={mode:dh.onSubmit,reValidateMode:dh.onChange,shouldFocusError:!0};function rqe(t={}){let e={...nqe,...t},r={submitCount:0,isDirty:!1,isLoading:wg(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},o={},a=Ea(e.defaultValues)||Ea(e.values)?yd(e.defaultValues||e.values)||{}:{},u=e.shouldUnregister?{}:yd(a),d={action:!1,mount:!1,watch:!1},f={mount:new Set,unMount:new Set,array:new Set,watch:new Set},g,E=0;const T={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},C={values:I2(),array:I2(),state:I2()},I=nee(e.mode),D=nee(e.reValidateMode),L=e.criteriaMode===dh.all,B=Ae=>$e=>{clearTimeout(E),E=setTimeout(Ae,$e)},G=async Ae=>{if(T.isValid||Ae){const $e=e.resolver?Ll((await K()).errors):await ce(o,!0);$e!==r.isValid&&C.state.next({isValid:$e})}},se=(Ae,$e)=>{(T.isValidating||T.validatingFields)&&((Ae||Array.from(f.mount)).forEach(rt=>{rt&&($e?Os(r.validatingFields,rt,$e):va(r.validatingFields,rt))}),C.state.next({validatingFields:r.validatingFields,isValidating:!Ll(r.validatingFields)}))},ae=(Ae,$e=[],rt,at,ct=!0,Ke=!0)=>{if(at&&rt){if(d.action=!0,Ke&&Array.isArray(yn(o,Ae))){const nt=rt(yn(o,Ae),at.argA,at.argB);ct&&Os(o,Ae,nt)}if(Ke&&Array.isArray(yn(r.errors,Ae))){const nt=rt(yn(r.errors,Ae),at.argA,at.argB);ct&&Os(r.errors,Ae,nt),tqe(r.errors,Ae)}if(T.touchedFields&&Ke&&Array.isArray(yn(r.touchedFields,Ae))){const nt=rt(yn(r.touchedFields,Ae),at.argA,at.argB);ct&&Os(r.touchedFields,Ae,nt)}T.dirtyFields&&(r.dirtyFields=OP(a,u)),C.state.next({name:Ae,isDirty:_e(Ae,$e),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else Os(u,Ae,$e)},M=(Ae,$e)=>{Os(r.errors,Ae,$e),C.state.next({errors:r.errors})},F=Ae=>{r.errors=Ae,C.state.next({errors:r.errors,isValid:!1})},z=(Ae,$e,rt,at)=>{const ct=yn(o,Ae);if(ct){const Ke=yn(u,Ae,Oo(rt)?yn(a,Ae):rt);Oo(Ke)||at&&at.defaultChecked||$e?Os(u,Ae,$e?Ke:k2(ct._f)):St(Ae,Ke),d.mount&&G()}},te=(Ae,$e,rt,at,ct)=>{let Ke=!1,nt=!1;const At={name:Ae},It=!!(yn(o,Ae)&&yn(o,Ae)._f.disabled);if(!rt||at){T.isDirty&&(nt=r.isDirty,r.isDirty=At.isDirty=_e(),Ke=nt!==At.isDirty);const Kt=It||G_(yn(a,Ae),$e);nt=!!(!It&&yn(r.dirtyFields,Ae)),Kt||It?va(r.dirtyFields,Ae):Os(r.dirtyFields,Ae,!0),At.dirtyFields=r.dirtyFields,Ke=Ke||T.dirtyFields&&nt!==!Kt}if(rt){const Kt=yn(r.touchedFields,Ae);Kt||(Os(r.touchedFields,Ae,rt),At.touchedFields=r.touchedFields,Ke=Ke||T.touchedFields&&Kt!==rt)}return Ke&&ct&&C.state.next(At),Ke?At:{}},j=(Ae,$e,rt,at)=>{const ct=yn(r.errors,Ae),Ke=T.isValid&&kp($e)&&r.isValid!==$e;if(t.delayError&&rt?(g=B(()=>M(Ae,rt)),g(t.delayError)):(clearTimeout(E),g=null,rt?Os(r.errors,Ae,rt):va(r.errors,Ae)),(rt?!G_(ct,rt):ct)||!Ll(at)||Ke){const nt={...at,...Ke&&kp($e)?{isValid:$e}:{},errors:r.errors,name:Ae};r={...r,...nt},C.state.next(nt)}},K=async Ae=>{se(Ae,!0);const $e=await e.resolver(u,e.context,QKe(Ae||f.mount,o,e.criteriaMode,e.shouldUseNativeValidation));return se(Ae),$e},Q=async Ae=>{const{errors:$e}=await K(Ae);if(Ae)for(const rt of Ae){const at=yn($e,rt);at?Os(r.errors,rt,at):va(r.errors,rt)}else r.errors=$e;return $e},ce=async(Ae,$e,rt={valid:!0})=>{for(const at in Ae){const ct=Ae[at];if(ct){const{_f:Ke,...nt}=ct;if(Ke){const At=f.array.has(Ke.name);se([at],!0);const It=await cee(ct,u,L,e.shouldUseNativeValidation&&!$e,At);if(se([at]),It[Ke.name]&&(rt.valid=!1,$e))break;!$e&&(yn(It,Ke.name)?At?$Ke(r.errors,It,Ke.name):Os(r.errors,Ke.name,It[Ke.name]):va(r.errors,Ke.name))}nt&&await ce(nt,$e,rt)}}return rt.valid},Ee=()=>{for(const Ae of f.unMount){const $e=yn(o,Ae);$e&&($e._f.refs?$e._f.refs.every(rt=>!A2(rt)):!A2($e._f.ref))&&jt(Ae)}f.unMount=new Set},_e=(Ae,$e)=>(Ae&&$e&&Os(u,Ae,$e),!G_(Be(),a)),pe=(Ae,$e,rt)=>KKe(Ae,f,{...d.mount?u:Oo($e)?a:df(Ae)?{[Ae]:$e}:$e},rt,$e),qe=Ae=>tI(yn(d.mount?u:a,Ae,t.shouldUnregister?yn(a,Ae,[]):[])),St=(Ae,$e,rt={})=>{const at=yn(o,Ae);let ct=$e;if(at){const Ke=at._f;Ke&&(!Ke.disabled&&Os(u,Ae,uue($e,Ke)),ct=i1(Ke.ref)&&pu($e)?"":$e,oue(Ke.ref)?[...Ke.ref.options].forEach(nt=>nt.selected=ct.includes(nt.value)):Ke.refs?eI(Ke.ref)?Ke.refs.length>1?Ke.refs.forEach(nt=>(!nt.defaultChecked||!nt.disabled)&&(nt.checked=Array.isArray(ct)?!!ct.find(At=>At===nt.value):ct===nt.value)):Ke.refs[0]&&(Ke.refs[0].checked=!!ct):Ke.refs.forEach(nt=>nt.checked=nt.value===ct):D5(Ke.ref)?Ke.ref.value="":(Ke.ref.value=ct,Ke.ref.type||C.values.next({name:Ae,values:{...u}})))}(rt.shouldDirty||rt.shouldTouch)&&te(Ae,ct,rt.shouldTouch,rt.shouldDirty,!0),rt.shouldValidate&&ve(Ae)},ke=(Ae,$e,rt)=>{for(const at in $e){const ct=$e[at],Ke=`${Ae}.${at}`,nt=yn(o,Ke);(f.array.has(Ae)||!o1(ct)||nt&&!nt._f)&&!rT(ct)?ke(Ke,ct,rt):St(Ke,ct,rt)}},Ne=(Ae,$e,rt={})=>{const at=yn(o,Ae),ct=f.array.has(Ae),Ke=yd($e);Os(u,Ae,Ke),ct?(C.array.next({name:Ae,values:{...u}}),(T.isDirty||T.dirtyFields)&&rt.shouldDirty&&C.state.next({name:Ae,dirtyFields:OP(a,u),isDirty:_e(Ae,Ke)})):at&&!at._f&&!pu(Ke)?ke(Ae,Ke,rt):St(Ae,Ke,rt),ree(Ae,f)&&C.state.next({...r}),C.values.next({name:d.mount?Ae:void 0,values:{...u}})},Re=async Ae=>{d.mount=!0;const $e=Ae.target;let rt=$e.name,at=!0;const ct=yn(o,rt),Ke=()=>$e.type?k2(ct._f):FKe(Ae),nt=At=>{at=Number.isNaN(At)||At===yn(u,rt,At)};if(ct){let At,It;const Kt=Ke(),Un=Ae.type===tee.BLUR||Ae.type===tee.FOCUS_OUT,Fn=!ZKe(ct._f)&&!e.resolver&&!yn(r.errors,rt)&&!ct._f.deps||eqe(Un,yn(r.touchedFields,rt),r.isSubmitted,D,I),Yr=ree(rt,f,Un);Os(u,rt,Kt),Un?(ct._f.onBlur&&ct._f.onBlur(Ae),g&&g(0)):ct._f.onChange&&ct._f.onChange(Ae);const Ns=te(rt,Kt,Un,!1),$t=!Ll(Ns)||Yr;if(!Un&&C.values.next({name:rt,type:Ae.type,values:{...u}}),Fn)return T.isValid&&G(),$t&&C.state.next({name:rt,...Yr?{}:Ns});if(!Un&&Yr&&C.state.next({...r}),e.resolver){const{errors:Cn}=await K([rt]);if(nt(Kt),at){const yo=uee(r.errors,o,rt),Cr=uee(Cn,o,yo.name||rt);At=Cr.error,rt=Cr.name,It=Ll(Cn)}}else se([rt],!0),At=(await cee(ct,u,L,e.shouldUseNativeValidation))[rt],se([rt]),nt(Kt),at&&(At?It=!1:T.isValid&&(It=await ce(o,!0)));at&&(ct._f.deps&&ve(ct._f.deps),j(rt,It,At,Ns))}},Ve=(Ae,$e)=>{if(yn(r.errors,$e)&&Ae.focus)return Ae.focus(),1},ve=async(Ae,$e={})=>{let rt,at;const ct=R2(Ae);if(e.resolver){const Ke=await Q(Oo(Ae)?Ae:ct);rt=Ll(Ke),at=Ae?!ct.some(nt=>yn(Ke,nt)):rt}else Ae?(at=(await Promise.all(ct.map(async Ke=>{const nt=yn(o,Ke);return await ce(nt&&nt._f?{[Ke]:nt}:nt)}))).every(Boolean),!(!at&&!r.isValid)&&G()):at=rt=await ce(o);return C.state.next({...!df(Ae)||T.isValid&&rt!==r.isValid?{}:{name:Ae},...e.resolver||!Ae?{isValid:rt}:{},errors:r.errors}),$e.shouldFocus&&!at&&DC(o,Ve,Ae?ct:f.mount),at},Be=Ae=>{const $e={...a,...d.mount?u:{}};return Oo(Ae)?$e:df(Ae)?yn($e,Ae):Ae.map(rt=>yn($e,rt))},gt=(Ae,$e)=>({invalid:!!yn(($e||r).errors,Ae),isDirty:!!yn(($e||r).dirtyFields,Ae),isTouched:!!yn(($e||r).touchedFields,Ae),isValidating:!!yn(($e||r).validatingFields,Ae),error:yn(($e||r).errors,Ae)}),ze=Ae=>{Ae&&R2(Ae).forEach($e=>va(r.errors,$e)),C.state.next({errors:Ae?r.errors:{}})},_t=(Ae,$e,rt)=>{const at=(yn(o,Ae,{_f:{}})._f||{}).ref;Os(r.errors,Ae,{...$e,ref:at}),C.state.next({name:Ae,errors:r.errors,isValid:!1}),rt&&rt.shouldFocus&&at&&at.focus&&at.focus()},Dt=(Ae,$e)=>wg(Ae)?C.values.subscribe({next:rt=>Ae(pe(void 0,$e),rt)}):pe(Ae,$e,!0),jt=(Ae,$e={})=>{for(const rt of Ae?R2(Ae):f.mount)f.mount.delete(rt),f.array.delete(rt),$e.keepValue||(va(o,rt),va(u,rt)),!$e.keepError&&va(r.errors,rt),!$e.keepDirty&&va(r.dirtyFields,rt),!$e.keepTouched&&va(r.touchedFields,rt),!$e.keepIsValidating&&va(r.validatingFields,rt),!e.shouldUnregister&&!$e.keepDefaultValue&&va(a,rt);C.values.next({values:{...u}}),C.state.next({...r,...$e.keepDirty?{isDirty:_e()}:{}}),!$e.keepIsValid&&G()},Zt=({disabled:Ae,name:$e,field:rt,fields:at,value:ct})=>{if(kp(Ae)){const Ke=Ae?void 0:Oo(ct)?k2(rt?rt._f:yn(at,$e)._f):ct;Os(u,$e,Ke),te($e,Ke,!1,!1,!0)}},Xt=(Ae,$e={})=>{let rt=yn(o,Ae);const at=kp($e.disabled);return Os(o,Ae,{...rt||{},_f:{...rt&&rt._f?rt._f:{ref:{name:Ae}},name:Ae,mount:!0,...$e}}),f.mount.add(Ae),rt?Zt({field:rt,disabled:$e.disabled,name:Ae,value:$e.value}):z(Ae,!0,$e.value),{...at?{disabled:$e.disabled}:{},...e.progressive?{required:!!$e.required,min:zw($e.min),max:zw($e.max),minLength:zw($e.minLength),maxLength:zw($e.maxLength),pattern:zw($e.pattern)}:{},name:Ae,onChange:Re,onBlur:Re,ref:ct=>{if(ct){Xt(Ae,$e),rt=yn(o,Ae);const Ke=Oo(ct.value)&&ct.querySelectorAll&&ct.querySelectorAll("input,select,textarea")[0]||ct,nt=JKe(Ke),At=rt._f.refs||[];if(nt?At.find(It=>It===Ke):Ke===rt._f.ref)return;Os(o,Ae,{_f:{...rt._f,...nt?{refs:[...At.filter(A2),Ke,...Array.isArray(yn(a,Ae))?[{}]:[]],ref:{type:Ke.type,name:Ae}}:{ref:Ke}}}),z(Ae,!1,void 0,Ke)}else rt=yn(o,Ae,{}),rt._f&&(rt._f.mount=!1),(e.shouldUnregister||$e.shouldUnregister)&&!(BKe(f.array,Ae)&&d.action)&&f.unMount.add(Ae)}}},In=()=>e.shouldFocusError&&DC(o,Ve,f.mount),Qt=Ae=>{kp(Ae)&&(C.state.next({disabled:Ae}),DC(o,($e,rt)=>{let at=Ae;const ct=yn(o,rt);ct&&kp(ct._f.disabled)&&(at||(at=ct._f.disabled)),$e.disabled=at},0,!1))},Er=(Ae,$e)=>async rt=>{let at;rt&&(rt.preventDefault&&rt.preventDefault(),rt.persist&&rt.persist());let ct=yd(u);if(C.state.next({isSubmitting:!0}),e.resolver){const{errors:Ke,values:nt}=await K();r.errors=Ke,ct=nt}else await ce(o);if(va(r.errors,"root"),Ll(r.errors)){C.state.next({errors:{}});try{await Ae(ct,rt)}catch(Ke){at=Ke}}else $e&&await $e({...r.errors},rt),In(),setTimeout(In);if(C.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Ll(r.errors)&&!at,submitCount:r.submitCount+1,errors:r.errors}),at)throw at},Tn=(Ae,$e={})=>{yn(o,Ae)&&(Oo($e.defaultValue)?Ne(Ae,yd(yn(a,Ae))):(Ne(Ae,$e.defaultValue),Os(a,Ae,yd($e.defaultValue))),$e.keepTouched||va(r.touchedFields,Ae),$e.keepDirty||(va(r.dirtyFields,Ae),r.isDirty=$e.defaultValue?_e(Ae,yd(yn(a,Ae))):_e()),$e.keepError||(va(r.errors,Ae),T.isValid&&G()),C.state.next({...r}))},Vn=(Ae,$e={})=>{const rt=Ae?yd(Ae):a,at=yd(rt),ct=Ll(Ae),Ke=ct?a:at;if($e.keepDefaultValues||(a=rt),!$e.keepValues){if($e.keepDirtyValues)for(const nt of f.mount)yn(r.dirtyFields,nt)?Os(Ke,nt,yn(u,nt)):Ne(nt,yn(Ke,nt));else{if(P5&&Oo(Ae))for(const nt of f.mount){const At=yn(o,nt);if(At&&At._f){const It=Array.isArray(At._f.refs)?At._f.refs[0]:At._f.ref;if(i1(It)){const Kt=It.closest("form");if(Kt){Kt.reset();break}}}}o={}}u=t.shouldUnregister?$e.keepDefaultValues?yd(a):{}:yd(Ke),C.array.next({values:{...Ke}}),C.values.next({values:{...Ke}})}f={mount:$e.keepDirtyValues?f.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},d.mount=!T.isValid||!!$e.keepIsValid||!!$e.keepDirtyValues,d.watch=!!t.shouldUnregister,C.state.next({submitCount:$e.keepSubmitCount?r.submitCount:0,isDirty:ct?!1:$e.keepDirty?r.isDirty:!!($e.keepDefaultValues&&!G_(Ae,a)),isSubmitted:$e.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:ct?[]:$e.keepDirtyValues?$e.keepDefaultValues&&u?OP(a,u):r.dirtyFields:$e.keepDefaultValues&&Ae?OP(a,Ae):{},touchedFields:$e.keepTouched?r.touchedFields:{},errors:$e.keepErrors?r.errors:{},isSubmitSuccessful:$e.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},wr=(Ae,$e)=>Vn(wg(Ae)?Ae(u):Ae,$e);return{control:{register:Xt,unregister:jt,getFieldState:gt,handleSubmit:Er,setError:_t,_executeSchema:K,_getWatch:pe,_getDirty:_e,_updateValid:G,_removeUnmounted:Ee,_updateFieldArray:ae,_updateDisabledField:Zt,_getFieldArray:qe,_reset:Vn,_resetDefaultValues:()=>wg(e.defaultValues)&&e.defaultValues().then(Ae=>{wr(Ae,e.resetOptions),C.state.next({isLoading:!1})}),_updateFormState:Ae=>{r={...r,...Ae}},_disableForm:Qt,_subjects:C,_proxyFormState:T,_setErrors:F,get _fields(){return o},get _formValues(){return u},get _state(){return d},set _state(Ae){d=Ae},get _defaultValues(){return a},get _names(){return f},set _names(Ae){f=Ae},get _formState(){return r},set _formState(Ae){r=Ae},get _options(){return e},set _options(Ae){e={...e,...Ae}}},trigger:ve,register:Xt,handleSubmit:Er,watch:Dt,setValue:Ne,getValues:Be,reset:wr,resetField:Tn,clearErrors:ze,unregister:jt,setError:_t,setFocus:(Ae,$e={})=>{const rt=yn(o,Ae),at=rt&&rt._f;if(at){const ct=at.refs?at.refs[0]:at.ref;ct.focus&&(ct.focus(),$e.shouldSelect&&ct.select())}},getFieldState:gt}}function lue(t={}){const e=Di.useRef(),r=Di.useRef(),[o,a]=Di.useState({isDirty:!1,isValidating:!1,isLoading:wg(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,defaultValues:wg(t.defaultValues)?void 0:t.defaultValues});e.current||(e.current={...rqe(t),formState:o});const u=e.current.control;return u._options=t,HKe({subject:u._subjects.state,next:d=>{GKe(d,u._proxyFormState,u._updateFormState)&&a({...u._formState})}}),Di.useEffect(()=>u._disableForm(t.disabled),[u,t.disabled]),Di.useEffect(()=>{if(u._proxyFormState.isDirty){const d=u._getDirty();d!==o.isDirty&&u._subjects.state.next({isDirty:d})}},[u,o.isDirty]),Di.useEffect(()=>{t.values&&!G_(t.values,r.current)?(u._reset(t.values,u._options.resetOptions),r.current=t.values,a(d=>({...d}))):u._resetDefaultValues()},[t.values,u]),Di.useEffect(()=>{t.errors&&u._setErrors(t.errors)},[t.errors,u]),Di.useEffect(()=>{u._state.mount||(u._updateValid(),u._state.mount=!0),u._state.watch&&(u._state.watch=!1,u._subjects.state.next({...u._formState})),u._removeUnmounted()}),Di.useEffect(()=>{t.shouldUnregister&&u._subjects.values.next({values:u._getWatch()})},[t.shouldUnregister,u]),e.current.formState=zKe(o,u),e.current}const due=t=>{X.useEffect(()=>{if(!window.unityInstance)return;const e=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),Gt.log("Unity input disabled")}catch(o){Gt.error("Failed to disable Unity input:",o)}},r=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),Gt.log("Unity input enabled")}catch(o){Gt.error("Failed to enable Unity input:",o)}};return t?e():r(),()=>{t&&r()}},[t])};function x5({mode:t,label:e,buttonProps:r={},isOpen:o,onClose:a}){const{register:u,handleSubmit:d,formState:{errors:f}}=lue(),{register:g}=X.useContext(Ad),E=DR(),{fullscreenRef:T}=lm(),[C,I]=X.useState(!1),[D,L]=X.useState(!1),B=o!==void 0?o:C,G=a||(()=>I(!1));due(B);const se=async F=>{const{email:z,password:te,confirmPassword:j,...K}=F;if(te!==j){E({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}L(!0);try{await g(z,te,K),Gt.log("User: Registration process complete."),G(),E({title:"Registration Successful",description:"Your account has been created.",status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(Q){Gt.error("User: Registration Error:",Q),E({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{L(!1)}},ae=()=>{a?a():I(!C)},M=t==="link"?$.jsx(kf,{variant:"header",onClick:ae,children:e}):$.jsx(Fg,{onClick:ae,...r,children:e});return $.jsxs($.Fragment,{children:[!o&&M,$.jsxs(sm,{isOpen:B,onClose:G,size:"md",portalProps:{containerRef:T},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[$.jsx(am,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),$.jsxs(om,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:F=>{F.stopPropagation()},children:[$.jsxs(Jg,{p:8,textAlign:"center",children:[$.jsx(A4,{size:"lg",mb:2,children:"Create Account"}),$.jsx(Br,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),$.jsx(um,{color:"gray.400"}),$.jsx(cm,{px:8,children:$.jsx("form",{onSubmit:d(se),children:$.jsxs(vu,{spacing:4,children:[$.jsxs(lc,{isInvalid:f.companyName,isRequired:!0,children:[$.jsx(Td,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("companyName",{required:"Company name is required"})}),$.jsx(Ap,{children:f.companyName&&f.companyName.message})]}),$.jsxs(FN,{gap:4,w:"100%",children:[$.jsxs(lc,{isInvalid:f.firstName,isRequired:!0,children:[$.jsx(Td,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("firstName",{required:"First name is required"})}),$.jsx(Ap,{children:f.firstName&&f.firstName.message})]}),$.jsxs(lc,{isInvalid:f.lastName,isRequired:!0,children:[$.jsx(Td,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("lastName",{required:"Last name is required"})}),$.jsx(Ap,{children:f.lastName&&f.lastName.message})]})]}),$.jsxs(lc,{isInvalid:f.email,isRequired:!0,children:[$.jsx(Td,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),$.jsx(Ap,{children:f.email&&f.email.message})]}),$.jsxs(FN,{gap:4,w:"100%",children:[$.jsxs(lc,{isInvalid:f.password,isRequired:!0,children:[$.jsx(Td,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),$.jsx(Ap,{children:f.password&&f.password.message})]}),$.jsxs(lc,{isInvalid:f.confirmPassword,isRequired:!0,children:[$.jsx(Td,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("confirmPassword",{required:"Confirm password is required"})}),$.jsx(Ap,{children:f.confirmPassword&&f.confirmPassword.message})]})]}),$.jsx(lc,{children:$.jsx(Td,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("accessCode")})}),$.jsx(lc,{children:$.jsx(Td,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("linkedInProfile")})})]})})}),$.jsxs(H1,{px:8,pb:8,flexDirection:"column",gap:4,children:[$.jsx(Fg,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:d(se),isLoading:D,loadingText:"Creating Account",children:"Create Account"}),$.jsxs(Br,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",$.jsx(kf,{color:"blue.400",onClick:G,children:"Sign In"})]})]})]})]})]})}x5.propTypes={mode:go.oneOf(["button","link"]),label:go.string,buttonProps:go.object,isOpen:go.bool,onClose:go.func};var iqe=PR({displayName:"QuestionOutlineIcon",path:$.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[$.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),$.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),$.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),sqe=PR({displayName:"EmailIcon",path:$.jsxs("g",{fill:"currentColor",children:[$.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),$.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),oqe=PR({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"}),aqe=PR({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),cqe=PR({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"});function M5({mode:t,label:e,buttonProps:r={}}){const{signIn:o}=X.useContext(Ad),{fullscreenRef:a}=lm(),u=DR(),{register:d,handleSubmit:f,formState:{errors:g,isSubmitting:E}}=lue({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[T,C]=X.useState(!1),[I,D]=X.useState(!1);due(T);const L=async ae=>{try{await o(ae.email,ae.password),Gt.log("User: Sign-in process complete."),C(!1),window.location.reload()}catch(M){Gt.error("User: SignIn Error:",M),u({title:"Error",description:"An error occurred while logging in. Please check your credentials.",status:"error",duration:1e4,isClosable:!0,position:"top",container:a.current})}},B=()=>C(ae=>!ae),G=()=>{C(!1),D(!0)},se=t==="link"?$.jsx(kf,{variant:"header",onClick:B,children:e}):$.jsx(Fg,{onClick:B,...r,children:e});return $.jsxs($.Fragment,{children:[se,$.jsxs(sm,{isOpen:T,onClose:B,size:"md",portalProps:{containerRef:a},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[$.jsx(am,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),$.jsx("form",{onSubmit:f(L),children:$.jsxs(om,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:ae=>{ae.stopPropagation()},children:[$.jsxs(Jg,{p:8,textAlign:"center",children:[$.jsx(A4,{size:"lg",mb:2,children:"Welcome Back"}),$.jsx(Br,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),$.jsx(um,{color:"gray.400"}),$.jsx(cm,{px:8,pb:8,children:$.jsxs(vu,{spacing:4,children:[$.jsxs(lc,{isInvalid:g.email,children:[$.jsxs(LF,{children:[$.jsx(VN,{pointerEvents:"none",children:$.jsx(sqe,{color:"gray.500"})}),$.jsx(Td,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required."})})]}),$.jsx(Ap,{children:g.email&&g.email.message})]}),$.jsxs(lc,{isInvalid:g.password,children:[$.jsxs(LF,{children:[$.jsx(VN,{pointerEvents:"none",children:$.jsx(aqe,{color:"gray.500"})}),$.jsx(Td,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required."})})]}),$.jsx(Ap,{children:g.password&&g.password.message})]})]})}),$.jsxs(H1,{px:8,pb:8,flexDirection:"column",gap:4,children:[$.jsx(Fg,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:E,loadingText:"Signing In",children:"Sign In"}),$.jsxs(Br,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",$.jsx(kf,{color:"blue.400",onClick:G,children:"Sign Up"})]})]})]})})]}),$.jsx(x5,{mode:"link",isOpen:I,onClose:()=>D(!1)})]})}M5.propTypes={mode:go.oneOf(["button","link"]),label:go.string,buttonProps:go.object};M5.defaultProps={mode:"button",label:"Sign In"};function uqe(){const{loadingProgression:t,isLoaded:e,error:r}=n0(),{user:o}=X.useContext(Ad),[a,u]=X.useState(!1),[d,f]=X.useState(!1);return X.useEffect(()=>{u(!o&&t===0)},[o,t]),$.jsx($.Fragment,{children:a?$.jsx(sr,{position:"absolute",zIndex:"1",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",children:$.jsxs(vu,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[$.jsx(Br,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),$.jsx(Br,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),$.jsx(Fg,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>f(!0),children:"Sign In"})]})}):$.jsx(sr,{position:"absolute",zIndex:"1",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 3s ease-in-out",opacity:e?0:1,children:$.jsxs(FN,{flexDirection:"column",alignItems:"center",padding:4,marginY:4,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",zIndex:"1",children:[$.jsx(Br,{fontWeight:"bold",children:"Entering The Disruptive Spaces"}),$.jsxs(Br,{fontSize:"sm",children:[e?"World Initialising":"World loading","."]}),$.jsx(j4,{value:t*100,size:"lg",width:"100%",marginY:2})]})})})}function U5({mode:t,label:e}){const r=DR(),{signOut:o}=X.useContext(Ad),{fullscreenRef:a}=lm(),u=async()=>{try{await o(),r({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:a.current}),window.location.href="/"}catch(f){console.error("SignOut Error:",f),r({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:a.current})}},d=t==="link"?$.jsx(kf,{variant:"header",onClick:u,style:{cursor:"pointer"},children:e}):null;return $.jsx($.Fragment,{children:d})}U5.propTypes={mode:go.oneOf(["button","link"]),label:go.string};U5.defaultProps={mode:"button",label:"Sign Out"};function lqe(){const{user:t}=X.useContext(Ad);return $.jsx("div",{children:t!==null?$.jsx("div",{children:$.jsx(U5,{})}):$.jsxs("div",{children:[$.jsx(x5,{}),$.jsx(M5,{})]})})}function dqe(){const{fullscreenRef:t}=lm(),[e,r]=X.useState(!1),o=()=>{r(!e)};return $.jsxs($.Fragment,{children:[$.jsx(FR,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:t},children:$.jsx(xl,{"aria-label":"Controller Help",icon:$.jsx(iqe,{}),onClick:o,variant:"iconButton"})}),$.jsxs(sm,{isOpen:e,onClose:o,size:"md",portalProps:{containerRef:t},children:[$.jsx(am,{}),$.jsxs(om,{children:[$.jsx(Jg,{children:"Notes"}),$.jsx(um,{}),$.jsx(cm,{children:$.jsx(Br,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),$.jsx(H1,{children:$.jsx(Fg,{variant:"primary",onClick:o,children:"Close"})})]})]})]})}var hue={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},lee=Di.createContext&&Di.createContext(hue),Pg=function(){return Pg=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},Pg.apply(this,arguments)},hqe=function(t,e){var r={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(r[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,o=Object.getOwnPropertySymbols(t);a<o.length;a++)e.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(t,o[a])&&(r[o[a]]=t[o[a]]);return r};function fue(t){return t&&t.map(function(e,r){return Di.createElement(e.tag,Pg({key:r},e.attr),fue(e.child))})}function tv(t){return function(e){return Di.createElement(fqe,Pg({attr:Pg({},t.attr)},e),fue(t.child))}}function fqe(t){var e=function(r){var o=t.attr,a=t.size,u=t.title,d=hqe(t,["attr","size","title"]),f=a||r.size||"1em",g;return r.className&&(g=r.className),t.className&&(g=(g?g+" ":"")+t.className),Di.createElement("svg",Pg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,o,d,{className:g,style:Pg(Pg({color:t.color||r.color},r.style),t.style),height:f,width:f,xmlns:"http://www.w3.org/2000/svg"}),u&&Di.createElement("title",null,u),t.children)};return lee!==void 0?Di.createElement(lee.Consumer,null,function(r){return e(r)}):e(hue)}function pue(t){return tv({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(t)}function mue(t){return tv({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(t)}function dee(t){return tv({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(t)}function hee(t){return tv({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(t)}function pqe(t){return tv({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(t)}function mqe(t){return tv({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(t)}function gue({open:t,onClose:e}){const r=X.useRef(null),o=vD(),{user:a}=X.useContext(Ad),u=g=>{r.current&&!r.current.contains(g.target)&&e()},d=async g=>{const E=f(g);if((E==null?void 0:E.source)==="readyplayerme"&&(E.eventName==="v1.frame.ready"&&r.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),E.eventName==="v1.avatar.exported")){const T=E.data.url;if(console.log(`Avatar URL: ${T}`),o("AvatarUrlFromReact",{url:T}),a&&a.uid)try{await Mce(a.uid,T),e()}catch(C){console.error("Error updating RPM URL:",C)}else console.error("No authenticated user found to update rpmURL.")}},f=g=>{try{return JSON.parse(g.data)}catch{return null}};return X.useEffect(()=>(t&&(document.addEventListener("mousedown",u),window.addEventListener("message",d)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("message",d)}),[t]),t&&$.jsx(mh,{children:$.jsx(sr,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:g=>g.stopPropagation(),children:$.jsx(sr,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:$.jsx("iframe",{ref:r,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function gqe({isOpen:t,onClose:e}){const[r,o]=X.useState(!1),[a,u]=X.useState(null),{user:d}=X.useContext(Ad),f=vD(),g=L=>{L.stopPropagation(),o(!0)},E=()=>{o(!1),e()},T=async L=>{if(u(L),d&&d.uid)try{await Mce(d.uid,L.url),f("AvatarUrlFromReact",{url:L.url}),e()}catch(B){console.error("Error updating RPM URL:",B)}else console.error("No authenticated user found to update rpmURL.")},C=swe("gray.200","whiteAlpha.300"),I="rgba(0, 0, 0, 0.3)",D=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return $.jsxs($.Fragment,{children:[$.jsx(mh,{children:$.jsxs(sm,{isOpen:t,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[$.jsx(am,{bg:"rgba(0, 0, 0, 0.7)"}),$.jsxs(om,{bg:"gray.800",color:"white",maxW:"900px",children:[$.jsx(Jg,{fontSize:"lg",children:"Customise Your Avatar"}),$.jsx(um,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),$.jsx(cm,{pb:4,children:$.jsxs(vu,{spacing:4,align:"stretch",children:[$.jsx(Br,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),$.jsxs(wse,{columns:5,spacing:2,children:[$.jsx(sr,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:C,borderRadius:"lg",overflow:"hidden",onClick:g,_hover:{bg:I},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:$.jsxs(vu,{spacing:1,children:[$.jsx(Yg,{as:pqe,boxSize:4}),$.jsx(Br,{fontSize:"xs",children:"Create Custom Avatar"})]})}),D.map(L=>$.jsxs(sr,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(a==null?void 0:a.id)===L.id?"blue.400":C,borderRadius:"lg",overflow:"hidden",onClick:()=>T(L),_hover:{bg:I},transition:"all 0.2s",aspectRatio:"1",children:[$.jsx(l4,{src:L.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:L.name,width:"100%",height:"100%",objectFit:"cover"}),$.jsx(sr,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:$.jsx(Br,{fontSize:"xs",children:L.name})})]},L.id))]})]})})]})]})}),r&&$.jsx(gue,{open:r,onClose:E})]})}function vqe(){const{fullscreenRef:t}=lm(),[e,r]=X.useState(!1),[o,a]=X.useState(!1),[u,d]=X.useState(!1),[f,g]=X.useState(!1),{user:E}=X.useContext(Ad),[T,C]=X.useState(null),[I,D]=X.useState(!0),L=(ae,M)=>!ae||!M?"?":`${ae.charAt(0)}${M.charAt(0)}`.toUpperCase(),B=async()=>{if(E!=null&&E.uid){D(!0);try{const ae=await yy(E.uid);C({rpmURL:ae.rpmURL?ae.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:ae.firstName,lastName:ae.lastName})}catch(ae){console.error("Error fetching profile data:",ae)}finally{D(!1)}}};X.useEffect(()=>{B()},[E==null?void 0:E.uid]),X.useEffect(()=>{const ae=()=>{r(!0)};return window.addEventListener("PlayerInstantiated",ae),()=>{window.removeEventListener("PlayerInstantiated",ae)}},[]);const G=()=>a(!o),se=()=>{a(!1),B()};return e?$.jsxs($.Fragment,{children:[$.jsx(FR,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:f,portalProps:{containerRef:t},children:$.jsxs(sr,{position:"relative",onMouseEnter:()=>{d(!0),g(!0)},onMouseLeave:()=>{d(!1),g(!1)},cursor:"pointer",onClick:G,children:[$.jsx(cy,{src:I||T==null?void 0:T.rpmURL,size:"md",borderRadius:"full",bg:"white",name:I?L(T==null?void 0:T.firstName,T==null?void 0:T.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),u&&$.jsx(sr,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:$.jsx(Br,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),$.jsx(gqe,{isOpen:o,onClose:se})]}):null}function _qe(t){return tv({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(t)}function yqe(t){return tv({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(t)}function Eqe(){const{isFullscreen:t,toggleFullscreen:e,fullscreenRef:r,isMobile:o}=lm(),a=DR();X.useEffect(()=>{const d=f=>{console.error("Fullscreen error:",f),a({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",d),document.addEventListener("webkitfullscreenerror",d),document.addEventListener("mozfullscreenerror",d),document.addEventListener("MSFullscreenError",d),()=>{document.removeEventListener("fullscreenerror",d),document.removeEventListener("webkitfullscreenerror",d),document.removeEventListener("mozfullscreenerror",d),document.removeEventListener("MSFullscreenError",d)}},[a]);const u=()=>{r.current?(o&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!t&&a({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),a({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return $.jsx(FR,{label:t?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:r},children:$.jsx(xl,{"aria-label":t?"Exit Fullscreen":"Enter Fullscreen",icon:t?$.jsx(_qe,{}):$.jsx(yqe,{}),onClick:u,variant:"iconButton",size:o?"lg":"md"})})}const Sqe=()=>(MKe(),null),fee={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function Tqe(){const{isOpen:t,onOpen:e,onClose:r}=o2e(),{fullscreenRef:o}=lm(),[a,u]=LKe(!1);X.useEffect(()=>{Gt.log("VideoPlayer: Current video URL:",a),a&&(Gt.log("VideoPlayer: Opening modal for video URL:",a),e())},[a,e]);const d=()=>{Gt.log("VideoPlayer: Closing modal"),u(),r()};return $.jsx(mh,{containerRef:o,children:$.jsxs(sm,{isOpen:t,onClose:d,size:"lg",isCentered:!0,portalProps:{containerRef:o},children:[$.jsx(am,{bg:"rgba(0, 0, 0, 0.8)"}),$.jsxs(om,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[$.jsx(um,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),$.jsx(cm,{p:0,width:"100%",children:a&&$.jsx(sr,{style:fee.iframeContainer,children:$.jsx("iframe",{src:a,style:fee.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function bqe({isOpen:t,onClose:e,playerName:r,playerId:o,uid:a}){const[u,d]=X.useState(null),[f,g]=X.useState(!0),[E,T]=X.useState(null);return X.useEffect(()=>{t&&(async()=>{if(g(!0),T(null),!a){Gt.warn("NameplateModal: No UID provided for player:",r),T("No user ID available for this player"),g(!1);return}try{Gt.log("NameplateModal: Fetching profile for UID:",a);const I=await yy(a);I?d({firstName:I.firstName,lastName:I.lastName,linkedinUrl:I.linkedinUrl,websiteUrl:I.websiteUrl,rpmURL:I.rpmURL?I.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):T("Could not find profile data for this player")}catch(I){Gt.error("Error fetching profile data:",I),T("Error loading profile data")}finally{g(!1)}})()},[a,t,r]),$.jsxs(sm,{isOpen:t,onClose:e,isCentered:!0,size:"md",children:[$.jsx(am,{backdropFilter:"blur(10px)"}),$.jsxs(om,{bg:"gray.900",color:"white",borderRadius:"xl",children:[$.jsx(Jg,{children:"Player Info"}),$.jsx(um,{}),$.jsx(cm,{pb:6,children:f?$.jsx(kse,{py:8,children:$.jsx(NR,{size:"xl",color:"blue.400"})}):E?$.jsxs(j1,{status:"warning",variant:"solid",borderRadius:"md",children:[$.jsx(F1,{}),E]}):$.jsxs(vu,{spacing:4,align:"center",children:[$.jsx(cy,{size:"2xl",src:u==null?void 0:u.rpmURL,bg:"whiteAlpha.300",name:r,borderWidth:"2px",borderColor:"whiteAlpha.300"}),$.jsxs(vu,{spacing:1,children:[$.jsx(Br,{fontSize:"2xl",fontWeight:"bold",children:r}),(u==null?void 0:u.firstName)&&$.jsxs(Br,{fontSize:"md",color:"gray.400",children:[u.firstName," ",u.lastName]}),$.jsxs(Br,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",o]})]}),((u==null?void 0:u.linkedinUrl)||(u==null?void 0:u.websiteUrl))&&$.jsxs($.Fragment,{children:[$.jsx(k4,{borderColor:"whiteAlpha.300"}),$.jsxs(RT,{spacing:4,pt:2,children:[(u==null?void 0:u.linkedinUrl)&&$.jsx(kf,{href:u.linkedinUrl,isExternal:!0,children:$.jsx(xl,{icon:$.jsx(pue,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(u==null?void 0:u.websiteUrl)&&$.jsx(kf,{href:u.websiteUrl,isExternal:!0,children:$.jsx(xl,{icon:$.jsx(mue,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const wqe=({isVisible:t,onToggleVisibility:e})=>{const r=tue(),[o,a]=X.useState(!1),[u,d]=X.useState([]),[f,g]=X.useState(!1),[E,T]=X.useState({}),[C,I]=X.useState({}),D=window.currentUser||{};X.useEffect(()=>{const M={};r.forEach(F=>{if(F.uid){if(F.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)M[F.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const z=window.agoraClient.client.remoteUsers,te=z.find(j=>String(j.uid)===String(F.uid));if(te)M[F.uid]=te.uid;else{const j=z.find(K=>typeof K.uid=="string"&&K.uid.includes(F.uid));if(j)M[F.uid]=j.uid;else{const K=z.find(Q=>typeof F.uid=="string"&&F.uid.includes(String(Q.uid)));if(K)M[F.uid]=K.uid;else{const Q=z.filter(ce=>!(typeof ce.uid=="string"&&ce.uid.startsWith("screen-")));Q.length===1&&!F.isLocalPlayer&&(console.log(`Special case: Mapping player ${F.playerName} (${F.uid}) to the only remote user: ${Q[0].uid}`),M[F.uid]=Q[0].uid)}}}}}}),I(M)},[r]);const L=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const M=window.agoraClient.isVoiceEnabled;M!==f&&(console.log("UnityPlayerList: Updating mic state from window.agoraClient:",M),g(M))}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const M=window.agoraClient.client.remoteUsers,F={};M.forEach(z=>{typeof z.uid=="string"&&z.uid.startsWith("screen-")||(F[z.uid]=!!z.audioTrack&&!z.audioTrack.muted)}),JSON.stringify(F)!==JSON.stringify(E)&&(console.log("UnityPlayerList: Updating active mics:",F),T(F))}};X.useEffect(()=>{const M=setInterval(L,500),F=z=>{console.log("UnityPlayerList: Voice toggle event received:",z.detail),z.detail&&typeof z.detail.enabled=="boolean"&&g(z.detail.enabled)};return window.addEventListener("VoiceToggled",F),L(),()=>{clearInterval(M),window.removeEventListener("VoiceToggled",F)}},[]),X.useEffect(()=>{const M=()=>{Gt.log("UnityPlayerList: Player instantiated, showing list"),a(!0)};return window.addEventListener("PlayerInstantiated",M),window.isPlayerInstantiated&&(Gt.log("UnityPlayerList: Player was already instantiated"),a(!0)),()=>{window.removeEventListener("PlayerInstantiated",M)}},[]),X.useEffect(()=>{(async()=>{const F=await Promise.all(r.map(async z=>{if(z.uid)try{const te=await yy(z.uid);return{...z,firstName:te.firstName,lastName:te.lastName,linkedInProfile:te.linkedInProfile,websiteUrl:te.websiteUrl,rpmURL:te.rpmURL?te.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}}catch(te){return Gt.error(`Error fetching data for player ${z.playerName}:`,te),z}return z}));d(F)})()},[r]);const B=[...u].sort((M,F)=>M.isLocalPlayer?-1:F.isLocalPlayer?1:0),G=()=>{Gt.log("UnityPlayerList: Toggling visibility"),e&&e()},se=M=>!!(M.isLocalPlayer||D&&D.uid&&M.uid===D.uid),ae=M=>{try{if(se(M))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:f;if(M.uid){if(E[M.uid])return!0;const F=C[M.uid];if(F&&E[F])return!0;const z=parseInt(M.uid);if(!isNaN(z)&&E[z])return!0}return!1}catch(F){return console.error("Error in hasActiveMic:",F),!1}};return $.jsxs(sr,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:o&&t?"visible":"hidden",role:"group",children:[$.jsx(sr,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:$.jsx(xl,{icon:$.jsx(cqe,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:G,_hover:{opacity:.8}})}),$.jsxs(Br,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",r.length]}),$.jsx(sr,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:$.jsx(vu,{align:"stretch",spacing:1,width:"100%",children:B.map((M,F)=>{const z=se(M),te=ae(M);return $.jsx(sr,{children:$.jsxs(roe,{placement:"left",trigger:"hover",children:[$.jsx(noe,{children:$.jsxs(RT,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[$.jsx(cy,{size:"xs",src:M.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),$.jsx(Br,{fontSize:"xs",children:M.playerName}),$.jsx(Cse,{}),te?$.jsx(sr,{color:"green.400",children:$.jsx(hee,{})}):$.jsx(sr,{color:"red.400",children:$.jsx(dee,{})}),z&&$.jsx(Br,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),$.jsx(ooe,{bg:"rgba(0,0,0,0.4)",border:"none",boxShadow:"lg",color:"white",p:3,width:"auto",minWidth:"200px",ml:"-20px",position:"absolute",left:"-220px",top:"-100px",transform:"none !important",children:$.jsx(ioe,{children:$.jsxs(vu,{align:"center",spacing:2,children:[$.jsx(cy,{size:"lg",src:M.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),$.jsx(Br,{fontSize:"lg",fontWeight:"bold",children:M.playerName}),M.firstName&&$.jsxs(Br,{fontSize:"sm",color:"gray.300",children:[M.firstName," ",M.lastName]}),$.jsxs(RT,{spacing:4,pt:2,children:[M.linkedInProfile&&$.jsx(kf,{href:M.linkedInProfile,isExternal:!0,children:$.jsx(xl,{icon:$.jsx(pue,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),M.websiteUrl&&$.jsx(kf,{href:M.websiteUrl,isExternal:!0,children:$.jsx(xl,{icon:$.jsx(mue,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),$.jsx(xl,{icon:te?$.jsx(hee,{}):$.jsx(dee,{}),variant:"ghost",colorScheme:te?"green":"red",size:"sm","aria-label":"Microphone status",isDisabled:!0})]})]})})})]})},F)})})})]})};var gN={exports:{}},Cqe=gN.exports,pee;function Rqe(){return pee||(pee=1,function(t,e){(function(r,o){t.exports=o()})(Cqe,function(){function r(n,i){return i.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(c){if(c!=="default"&&!(c in n)){var l=Object.getOwnPropertyDescriptor(s,c);Object.defineProperty(n,c,l.get?l:{enumerable:!0,get:function(){return s[c]}})}})}),Object.freeze(n)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof j_<"u"?j_:typeof self<"u"?self:{};function a(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var u=function(n){try{return!!n()}catch{return!0}},d=!u(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),f=d,g=Function.prototype,E=g.call,T=f&&g.bind.bind(E,E),C=f?T:function(n){return function(){return E.apply(n,arguments)}},I=C({}.isPrototypeOf),D=function(n){return n&&n.Math==Math&&n},L=D(typeof globalThis=="object"&&globalThis)||D(typeof window=="object"&&window)||D(typeof self=="object"&&self)||D(typeof o=="object"&&o)||function(){return this}()||o||Function("return this")(),B=d,G=Function.prototype,se=G.apply,ae=G.call,M=typeof Reflect=="object"&&Reflect.apply||(B?ae.bind(se):function(){return ae.apply(se,arguments)}),F=C,z=F({}.toString),te=F("".slice),j=function(n){return te(z(n),8,-1)},K=j,Q=C,ce=function(n){if(K(n)==="Function")return Q(n)},Ee=typeof document=="object"&&document.all,_e={all:Ee,IS_HTMLDDA:Ee===void 0&&Ee!==void 0},pe=_e.all,qe=_e.IS_HTMLDDA?function(n){return typeof n=="function"||n===pe}:function(n){return typeof n=="function"},St={},ke=!u(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ne=d,Re=Function.prototype.call,Ve=Ne?Re.bind(Re):function(){return Re.apply(Re,arguments)},ve={},Be={}.propertyIsEnumerable,gt=Object.getOwnPropertyDescriptor,ze=gt&&!Be.call({1:2},1);ve.f=ze?function(n){var i=gt(this,n);return!!i&&i.enumerable}:Be;var _t,Dt,jt=function(n,i){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:i}},Zt=u,Xt=j,In=Object,Qt=C("".split),Er=Zt(function(){return!In("z").propertyIsEnumerable(0)})?function(n){return Xt(n)=="String"?Qt(n,""):In(n)}:In,Tn=function(n){return n==null},Vn=Tn,wr=TypeError,Pt=function(n){if(Vn(n))throw wr("Can't call method on "+n);return n},wn=Er,Dn=Pt,Ae=function(n){return wn(Dn(n))},$e=qe,rt=_e.all,at=_e.IS_HTMLDDA?function(n){return typeof n=="object"?n!==null:$e(n)||n===rt}:function(n){return typeof n=="object"?n!==null:$e(n)},ct={},Ke=ct,nt=L,At=qe,It=function(n){return At(n)?n:void 0},Kt=function(n,i){return arguments.length<2?It(Ke[n])||It(nt[n]):Ke[n]&&Ke[n][i]||nt[n]&&nt[n][i]},Un=typeof navigator<"u"&&String(navigator.userAgent)||"",Fn=L,Yr=Un,Ns=Fn.process,$t=Fn.Deno,Cn=Ns&&Ns.versions||$t&&$t.version,yo=Cn&&Cn.v8;yo&&(Dt=(_t=yo.split("."))[0]>0&&_t[0]<4?1:+(_t[0]+_t[1])),!Dt&&Yr&&(!(_t=Yr.match(/Edge\/(\d+)/))||_t[1]>=74)&&(_t=Yr.match(/Chrome\/(\d+)/))&&(Dt=+_t[1]);var Cr=Dt,Bi=Cr,za=u,ba=L.String,ys=!!Object.getOwnPropertySymbols&&!za(function(){var n=Symbol();return!ba(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&Bi&&Bi<41}),Ga=ys&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Wi=Kt,Ws=qe,Eo=I,Ha=Object,zi=Ga?function(n){return typeof n=="symbol"}:function(n){var i=Wi("Symbol");return Ws(i)&&Eo(i.prototype,Ha(n))},_u=String,Do=function(n){try{return _u(n)}catch{return"Object"}},wa=qe,Ds=Do,Gi=TypeError,us=function(n){if(wa(n))return n;throw Gi(Ds(n)+" is not a function")},Ca=us,vc=Tn,zs=function(n,i){var s=n[i];return vc(s)?void 0:Ca(s)},Zo=Ve,ea=qe,yu=at,kd=TypeError,Eu={exports:{}},Wl=L,to=Object.defineProperty,_c=function(n,i){try{to(Wl,n,{value:i,configurable:!0,writable:!0})}catch{Wl[n]=i}return i},ta="__core-js_shared__",Su=L[ta]||_c(ta,{}),yc=Su;(Eu.exports=function(n,i){return yc[n]||(yc[n]=i!==void 0?i:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Gs=Eu.exports,Tu=Pt,ul=Object,Lo=function(n){return ul(Tu(n))},ll=Lo,Zr=C({}.hasOwnProperty),Ti=Object.hasOwn||function(n,i){return Zr(ll(n),i)},Ra=C,Ec=0,na=Math.random(),zl=Ra(1 .toString),dl=function(n){return"Symbol("+(n===void 0?"":n)+")_"+zl(++Ec+na,36)},xo=Gs,es=Ti,hl=dl,Ls=ys,Gl=Ga,Mr=L.Symbol,Xc=xo("wks"),Sc=Gl?Mr.for||Mr:Mr&&Mr.withoutSetter||hl,fr=function(n){return es(Xc,n)||(Xc[n]=Ls&&es(Mr,n)?Mr[n]:Sc("Symbol."+n)),Xc[n]},bu=Ve,Jc=at,wu=zi,Ka=zs,ra=function(n,i){var s,c;if(ea(s=n.toString)&&!yu(c=Zo(s,n))||ea(s=n.valueOf)&&!yu(c=Zo(s,n)))return c;throw kd("Can't convert object to primitive value")},fl=TypeError,Qc=fr("toPrimitive"),Ia=function(n,i){if(!Jc(n)||wu(n))return n;var s,c=Ka(n,Qc);if(c){if(s=bu(c,n,i),!Jc(s)||wu(s))return s;throw fl("Can't convert object to primitive value")}return ra(n)},kr=zi,Aa=function(n){var i=Ia(n,"string");return kr(i)?i:i+""},pr=at,qa=L.document,Zc=pr(qa)&&pr(qa.createElement),So=function(n){return Zc?qa.createElement(n):{}},Hl=So,Od=!ke&&!u(function(){return Object.defineProperty(Hl("div"),"a",{get:function(){return 7}}).a!=7}),pl=ke,Cu=Ve,Mo=ve,Hi=jt,Hs=Ae,Uo=Aa,Tc=Ti,Or=Od,ia=Object.getOwnPropertyDescriptor;St.f=pl?ia:function(n,i){if(n=Hs(n),i=Uo(i),Or)try{return ia(n,i)}catch{}if(Tc(n,i))return Hi(!Cu(Mo.f,n,i),n[i])};var vh=u,$a=qe,Es=/#|\.prototype\./,Ru=function(n,i){var s=bc[Iu(n)];return s==Pd||s!=no&&($a(i)?vh(i):!!i)},Iu=Ru.normalize=function(n){return String(n).replace(Es,".").toLowerCase()},bc=Ru.data={},no=Ru.NATIVE="N",Pd=Ru.POLYFILL="P",ro=Ru,sa=us,Ya=d,Ce=ce(ce.bind),De=function(n,i){return sa(n),i===void 0?n:Ya?Ce(n,i):function(){return n.apply(i,arguments)}},st={},nn=ke&&u(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Zn=at,Ur=String,ei=TypeError,hn=function(n){if(Zn(n))return n;throw ei(Ur(n)+" is not an object")},Hr=ke,Ri=Od,ms=nn,Vo=hn,Fo=Aa,oa=TypeError,ls=Object.defineProperty,wc=Object.getOwnPropertyDescriptor,ml="enumerable",Xa="configurable",Kl="writable";st.f=Hr?ms?function(n,i,s){if(Vo(n),i=Fo(i),Vo(s),typeof n=="function"&&i==="prototype"&&"value"in s&&Kl in s&&!s[Kl]){var c=wc(n,i);c&&c[Kl]&&(n[i]=s.value,s={configurable:Xa in s?s[Xa]:c[Xa],enumerable:ml in s?s[ml]:c[ml],writable:!1})}return ls(n,i,s)}:ls:function(n,i,s){if(Vo(n),i=Fo(i),Vo(s),Ri)try{return ls(n,i,s)}catch{}if("get"in s||"set"in s)throw oa("Accessors not supported");return"value"in s&&(n[i]=s.value),n};var io=st,Au=jt,jo=ke?function(n,i,s){return io.f(n,i,Au(1,s))}:function(n,i,s){return n[i]=s,n},aa=L,k=M,Z=ce,he=qe,Te=St.f,Ye=ro,tt=ct,vt=De,rn=jo,vn=Ti,Rr=function(n){var i=function(s,c,l){if(this instanceof i){switch(arguments.length){case 0:return new n;case 1:return new n(s);case 2:return new n(s,c)}return new n(s,c,l)}return k(n,this,arguments)};return i.prototype=n.prototype,i},cn=function(n,i){var s,c,l,h,p,v,y,S,b,R=n.target,O=n.global,N=n.stat,Y=n.proto,W=O?aa:N?aa[R]:(aa[R]||{}).prototype,H=O?tt:tt[R]||rn(tt,R,{})[R],ne=H.prototype;for(h in i)c=!(s=Ye(O?h:R+(N?".":"#")+h,n.forced))&&W&&vn(W,h),v=H[h],c&&(y=n.dontCallGetSet?(b=Te(W,h))&&b.value:W[h]),p=c&&y?y:i[h],c&&typeof v==typeof p||(S=n.bind&&c?vt(p,aa):n.wrap&&c?Rr(p):Y&&he(p)?Z(p):p,(n.sham||p&&p.sham||v&&v.sham)&&rn(S,"sham",!0),rn(H,h,S),Y&&(vn(tt,l=R+"Prototype")||rn(tt,l,{}),rn(tt[l],h,p),n.real&&ne&&(s||!ne[h])&&rn(ne,h,p)))},ts=Math.ceil,ci=Math.floor,Vr=Math.trunc||function(n){var i=+n;return(i>0?ci:ts)(i)},Bo=Vr,ns=function(n){var i=+n;return i!=i||i===0?0:Bo(i)},A=ns,q=Math.max,oe=Math.min,ye=function(n,i){var s=A(n);return s<0?q(s+i,0):oe(s,i)},Je=ns,ht=Math.min,Wt=function(n){return n>0?ht(Je(n),9007199254740991):0},Ii=Wt,Ki=function(n){return Ii(n.length)},Xr=Ae,Wo=ye,so=Ki,eu=function(n){return function(i,s,c){var l,h=Xr(i),p=so(h),v=Wo(c,p);if(n&&s!=s){for(;p>v;)if((l=h[v++])!=l)return!0}else for(;p>v;v++)if((n||v in h)&&h[v]===s)return n||v||0;return!n&&-1}},Ja={includes:eu(!0),indexOf:eu(!1)},Mf=Ja.includes;cn({target:"Array",proto:!0,forced:u(function(){return!Array(1).includes()})},{includes:function(n){return Mf(this,n,arguments.length>1?arguments[1]:void 0)}});var dm=ct,tu=function(n){return dm[n+"Prototype"]},dI=tu("Array").includes,hI=at,hm=j,PD=fr("match"),fI=function(n){var i;return hI(n)&&((i=n[PD])!==void 0?!!i:hm(n)=="RegExp")},ND=fI,pI=TypeError,a0={};a0[fr("toStringTag")]="z";var Uf=String(a0)==="[object z]",nv=Uf,DD=qe,Vf=j,LD=fr("toStringTag"),mI=Object,c0=Vf(function(){return arguments}())=="Arguments",ku=nv?Vf:function(n){var i,s,c;return n===void 0?"Undefined":n===null?"Null":typeof(s=function(l,h){try{return l[h]}catch{}}(i=mI(n),LD))=="string"?s:c0?Vf(i):(c=Vf(i))=="Object"&&DD(i.callee)?"Arguments":c},gI=ku,vI=String,Cc=function(n){if(gI(n)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return vI(n)},xD=fr("match"),MD=cn,UD=function(n){if(ND(n))throw pI("The method doesn't accept regular expressions");return n},VD=Pt,_I=Cc,gl=function(n){var i=/./;try{"/./"[n](i)}catch{try{return i[xD]=!1,"/./"[n](i)}catch{}}return!1},rv=C("".indexOf);MD({target:"String",proto:!0,forced:!gl("includes")},{includes:function(n){return!!~rv(_I(VD(this)),_I(UD(n)),arguments.length>1?arguments[1]:void 0)}});var yI=tu("String").includes,u0=I,EI=dI,SI=yI,iv=Array.prototype,l0=String.prototype,FD=function(n){var i=n.includes;return n===iv||u0(iv,n)&&i===iv.includes?EI:typeof n=="string"||n===l0||u0(l0,n)&&i===l0.includes?SI:i},dt=a(FD),d0=us,sv=Lo,h0=Er,TI=Ki,Py=TypeError,fm=function(n){return function(i,s,c,l){d0(s);var h=sv(i),p=h0(h),v=TI(h),y=n?v-1:0,S=n?-1:1;if(c<2)for(;;){if(y in p){l=p[y],y+=S;break}if(y+=S,n?y<0:v<=y)throw Py("Reduce of empty array with no initial value")}for(;n?y>=0:v>y;y+=S)y in p&&(l=s(l,p[y],y,h));return l}},f0={left:fm(!1)},bI=u,Ff=function(n,i){var s=[][n];return!!s&&bI(function(){s.call(null,i||function(){return 1},1)})},jf=typeof process<"u"&&j(process)=="process",wI=f0.left;cn({target:"Array",proto:!0,forced:!jf&&Cr>79&&Cr<83||!Ff("reduce")},{reduce:function(n){var i=arguments.length;return wI(this,n,i,i>1?arguments[1]:void 0)}});var CI=tu("Array").reduce,RI=I,II=CI,Ny=Array.prototype,_h=function(n){var i=n.reduce;return n===Ny||RI(Ny,n)&&i===Ny.reduce?II:i},Dy=_h,nu=a(Dy),jD=j,ov=Array.isArray||function(n){return jD(n)=="Array"},av=cn,BD=ov,AI=C([].reverse),p0=[1,2];av({target:"Array",proto:!0,forced:String(p0)===String(p0.reverse())},{reverse:function(){return BD(this)&&(this.length=this.length),AI(this)}});var ds=tu("Array").reverse,m0=I,Ly=ds,Bf=Array.prototype,kI=function(n){var i=n.reverse;return n===Bf||m0(Bf,n)&&i===Bf.reverse?Ly:i},xy=kI,pm=a(xy),My=dl,Wf=Gs("keys"),cv=function(n){return Wf[n]||(Wf[n]=My(n))},WD=!u(function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}),zD=Ti,OI=qe,Uy=Lo,Vy=WD,Fy=cv("IE_PROTO"),uv=Object,g0=uv.prototype,lv=Vy?uv.getPrototypeOf:function(n){var i=Uy(n);if(zD(i,Fy))return i[Fy];var s=i.constructor;return OI(s)&&i instanceof s?s.prototype:i instanceof uv?g0:null},GD=C,PI=us,HD=qe,KD=String,v0=TypeError,yh=function(n,i,s){try{return GD(PI(Object.getOwnPropertyDescriptor(n,i)[s]))}catch{}},NI=hn,mm=function(n){if(typeof n=="object"||HD(n))return n;throw v0("Can't set "+KD(n)+" as a prototype")},ql=Object.setPrototypeOf||("__proto__"in{}?function(){var n,i=!1,s={};try{(n=yh(Object.prototype,"__proto__","set"))(s,[]),i=s instanceof Array}catch{}return function(c,l){return NI(c),mm(l),i?n(c,l):c.__proto__=l,c}}():void 0),Eh={},Ou={},dv=Ti,qD=Ae,$D=Ja.indexOf,zf=Ou,gm=C([].push),Gf=function(n,i){var s,c=qD(n),l=0,h=[];for(s in c)!dv(zf,s)&&dv(c,s)&&gm(h,s);for(;i.length>l;)dv(c,s=i[l++])&&(~$D(h,s)||gm(h,s));return h},vm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_0=Gf,_m=vm.concat("length","prototype");Eh.f=Object.getOwnPropertyNames||function(n){return _0(n,_m)};var Pu={};Pu.f=Object.getOwnPropertySymbols;var hs=Kt,rs=Eh,Sh=Pu,ka=hn,Rc=C([].concat),Hf=hs("Reflect","ownKeys")||function(n){var i=rs.f(ka(n)),s=Sh.f;return s?Rc(i,s(n)):i},Kf=Ti,Ic=Hf,jy=St,DI=st,By={},Wy=Gf,LI=vm,Nu=Object.keys||function(n){return Wy(n,LI)},zy=ke,y0=nn,xI=st,YD=hn,Th=Ae,ym=Nu;By.f=zy&&!y0?Object.defineProperties:function(n,i){YD(n);for(var s,c=Th(i),l=ym(i),h=l.length,p=0;h>p;)xI.f(n,s=l[p++],c[s]);return n};var Nd,hv=Kt("document","documentElement"),Gy=hn,Du=By,ru=vm,qf=Ou,Dd=hv,Ld=So,xd="prototype",Hy="script",Ky=cv("IE_PROTO"),fv=function(){},Ac=function(n){return"<"+Hy+">"+n+"</"+Hy+">"},kc=function(n){n.write(Ac("")),n.close();var i=n.parentWindow.Object;return n=null,i},qi=function(){try{Nd=new ActiveXObject("htmlfile")}catch{}var n,i,s;qi=typeof document<"u"?document.domain&&Nd?kc(Nd):(i=Ld("iframe"),s="java"+Hy+":",i.style.display="none",Dd.appendChild(i),i.src=String(s),(n=i.contentWindow.document).open(),n.write(Ac("document.F=Object")),n.close(),n.F):kc(Nd);for(var c=ru.length;c--;)delete qi[xd][ru[c]];return qi()};qf[Ky]=!0;var Qa=Object.create||function(n,i){var s;return n!==null?(fv[xd]=Gy(n),s=new fv,fv[xd]=null,s[Ky]=n):s=qi(),i===void 0?s:Du.f(s,i)},MI=at,UI=jo,qy=Error,E0=C("".replace),VI=String(qy("zxcasd").stack),pv=/\n\s*at [^:]*:[^\n]*/,FI=pv.test(VI),Em=jt,S0=!u(function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",Em(1,7)),n.stack!==7)}),XD=jo,vl=function(n,i){if(FI&&typeof n=="string"&&!qy.prepareStackTrace)for(;i--;)n=E0(n,pv,"");return n},$y=S0,mv=Error.captureStackTrace,Lu={},T0=Lu,b0=fr("iterator"),w0=Array.prototype,Yy=function(n){return n!==void 0&&(T0.Array===n||w0[b0]===n)},Sm=ku,iu=zs,$f=Tn,C0=Lu,jI=fr("iterator"),xu=function(n){if(!$f(n))return iu(n,jI)||iu(n,"@@iterator")||C0[Sm(n)]},bh=Ve,R0=us,BI=hn,Md=Do,wh=xu,Xy=TypeError,Jy=function(n,i){var s=arguments.length<2?wh(n):i;if(R0(s))return BI(bh(s,n));throw Xy(Md(n)+" is not iterable")},Qy=Ve,I0=hn,WI=zs,Zy=function(n,i,s){var c,l;I0(n);try{if(!(c=WI(n,"return"))){if(i==="throw")throw s;return s}c=Qy(c,n)}catch(h){l=!0,c=h}if(i==="throw")throw s;if(l)throw c;return I0(c),s},eE=De,zI=Ve,GI=hn,HI=Do,A0=Yy,gv=Ki,vv=I,KI=Jy,qI=xu,Yf=Zy,$I=TypeError,Ch=function(n,i){this.stopped=n,this.result=i},_l=Ch.prototype,Ud=function(n,i,s){var c,l,h,p,v,y,S,b=s&&s.that,R=!(!s||!s.AS_ENTRIES),O=!(!s||!s.IS_RECORD),N=!(!s||!s.IS_ITERATOR),Y=!(!s||!s.INTERRUPTED),W=eE(i,b),H=function(re){return c&&Yf(c,"normal",re),new Ch(!0,re)},ne=function(re){return R?(GI(re),Y?W(re[0],re[1],H):W(re[0],re[1])):Y?W(re,H):W(re)};if(O)c=n.iterator;else if(N)c=n;else{if(!(l=qI(n)))throw $I(HI(n)+" is not iterable");if(A0(l)){for(h=0,p=gv(n);p>h;h++)if((v=ne(n[h]))&&vv(_l,v))return v;return new Ch(!1)}c=KI(n,l)}for(y=O?n.next:c.next;!(S=zI(y,c)).done;){try{v=ne(S.value)}catch(re){Yf(c,"throw",re)}if(typeof v=="object"&&v&&vv(_l,v))return v}return new Ch(!1)},_v=Cc,Xf=cn,k0=I,Tm=lv,yv=ql,O0=function(n,i,s){for(var c=Ic(i),l=DI.f,h=jy.f,p=0;p<c.length;p++){var v=c[p];Kf(n,v)||s&&Kf(s,v)||l(n,v,h(i,v))}},gs=Qa,bm=jo,Ev=jt,P0=function(n,i){MI(i)&&"cause"in i&&UI(n,"cause",i.cause)},tE=function(n,i,s,c){$y&&(mv?mv(n,i):XD(n,"stack",vl(s,c)))},N0=Ud,Jf=function(n,i){return n===void 0?arguments.length<2?"":i:_v(n)},Ss=fr("toStringTag"),xs=Error,zo=[].push,Vd=function(n,i){var s,c=k0(Qf,this);yv?s=yv(xs(),c?Tm(this):Qf):(s=c?this:gs(Qf),bm(s,Ss,"Error")),i!==void 0&&bm(s,"message",Jf(i)),tE(s,Vd,s.stack,1),arguments.length>2&&P0(s,arguments[2]);var l=[];return N0(n,zo,{that:l}),bm(s,"errors",l),s};yv?yv(Vd,xs):O0(Vd,xs,{name:!0});var Qf=Vd.prototype=gs(xs.prototype,{constructor:Ev(1,Vd),message:Ev(1,""),name:Ev(1,"AggregateError")});Xf({global:!0},{AggregateError:Vd});var Rh,Sv,To,D0=qe,nE=L.WeakMap,L0=D0(nE)&&/native code/.test(String(nE)),yl=L,Mu=at,Tv=jo,bv=Ti,wv=Su,YI=cv,XI=Ou,x0="Object already initialized",rE=yl.TypeError,JI=yl.WeakMap;if(L0||wv.state){var El=wv.state||(wv.state=new JI);El.get=El.get,El.has=El.has,El.set=El.set,Rh=function(n,i){if(El.has(n))throw rE(x0);return i.facade=n,El.set(n,i),i},Sv=function(n){return El.get(n)||{}},To=function(n){return El.has(n)}}else{var Zf=YI("state");XI[Zf]=!0,Rh=function(n,i){if(bv(n,Zf))throw rE(x0);return i.facade=n,Tv(n,Zf,i),i},Sv=function(n){return bv(n,Zf)?n[Zf]:{}},To=function(n){return bv(n,Zf)}}var Ih,wm,M0,$l={set:Rh,get:Sv,has:To,enforce:function(n){return To(n)?Sv(n):Rh(n,{})},getterFor:function(n){return function(i){var s;if(!Mu(i)||(s=Sv(i)).type!==n)throw rE("Incompatible receiver, "+n+" required");return s}}},Cm=ke,QI=Ti,iE=Function.prototype,ZI=Cm&&Object.getOwnPropertyDescriptor,U0=QI(iE,"name"),V0={PROPER:U0&&(function(){}).name==="something",CONFIGURABLE:U0&&(!Cm||Cm&&ZI(iE,"name").configurable)},eA=jo,Yl=function(n,i,s,c){return c&&c.enumerable?n[i]=s:eA(n,i,s),n},tA=u,nA=qe,rA=at,JD=Qa,F0=lv,QD=Yl,j0=fr("iterator"),B0=!1;[].keys&&("next"in(M0=[].keys())?(wm=F0(F0(M0)))!==Object.prototype&&(Ih=wm):B0=!0);var iA=!rA(Ih)||tA(function(){var n={};return Ih[j0].call(n)!==n});nA((Ih=iA?{}:JD(Ih))[j0])||QD(Ih,j0,function(){return this});var W0={IteratorPrototype:Ih,BUGGY_SAFARI_ITERATORS:B0},sE=ku,ZD=Uf?{}.toString:function(){return"[object "+sE(this)+"]"},eL=Uf,tL=st.f,Rm=jo,z0=Ti,G0=ZD,sA=fr("toStringTag"),Fd=function(n,i,s,c){if(n){var l=s?n:n.prototype;z0(l,sA)||tL(l,sA,{configurable:!0,value:i}),c&&!eL&&Rm(l,"toString",G0)}},oA=W0.IteratorPrototype,aA=Qa,cA=jt,uA=Fd,nL=Lu,Oc=function(){return this},ca=function(n,i,s,c){var l=i+" Iterator";return n.prototype=aA(oA,{next:cA(+!c,s)}),uA(n,l,!1,!0),nL[l]=Oc,n},lA=cn,dA=Ve,hA=V0,fA=ca,pA=lv,H0=Fd,K0=Yl,oE=Lu,mA=W0,gA=hA.PROPER,Im=mA.BUGGY_SAFARI_ITERATORS,Cv=fr("iterator"),q0="keys",Am="values",Rv="entries",rL=function(){return this},$0=function(n,i,s,c,l,h,p){fA(s,i,c);var v,y,S,b=function(ne){if(ne===l&&W)return W;if(!Im&&ne in N)return N[ne];switch(ne){case q0:case Am:case Rv:return function(){return new s(this,ne)}}return function(){return new s(this)}},R=i+" Iterator",O=!1,N=n.prototype,Y=N[Cv]||N["@@iterator"]||l&&N[l],W=!Im&&Y||b(l),H=i=="Array"&&N.entries||Y;if(H&&(v=pA(H.call(new n)))!==Object.prototype&&v.next&&(H0(v,R,!0,!0),oE[R]=rL),gA&&l==Am&&Y&&Y.name!==Am&&(O=!0,W=function(){return dA(Y,this)}),l)if(y={values:b(Am),keys:h?W:b(q0),entries:b(Rv)},p)for(S in y)(Im||O||!(S in N))&&K0(N,S,y[S]);else lA({target:i,proto:!0,forced:Im||O},y);return p&&N[Cv]!==W&&K0(N,Cv,W,{}),oE[i]=W,y},Iv=function(n,i){return{value:n,done:i}},vA=Ae,Av=Lu,Xl=$l;st.f;var iL=$0,Y0=Iv,aE="Array Iterator",_A=Xl.set,yA=Xl.getterFor(aE);iL(Array,"Array",function(n,i){_A(this,{type:aE,target:vA(n),index:0,kind:i})},function(){var n=yA(this),i=n.target,s=n.kind,c=n.index++;return!i||c>=i.length?(n.target=void 0,Y0(void 0,!0)):Y0(s=="keys"?c:s=="values"?i[c]:[c,i[c]],!1)},"values"),Av.Arguments=Av.Array;var kv=st,bo=function(n,i,s){return kv.f(n,i,s)},sL=Kt,oL=bo,cE=ke,ua=fr("species"),aL=I,dn=TypeError,Ah=function(n,i){if(aL(i,n))return n;throw dn("Incorrect invocation")},X0=qe,uE=Su,cL=C(Function.toString);X0(uE.inspectSource)||(uE.inspectSource=function(n){return cL(n)});var km=uE.inspectSource,lE=C,J0=u,Q0=qe,EA=ku,SA=km,dE=function(){},Z0=[],Go=Kt("Reflect","construct"),su=/^\s*(?:class|function)\b/,kh=lE(su.exec),TA=!su.exec(dE),Om=function(n){if(!Q0(n))return!1;try{return Go(dE,Z0,n),!0}catch{return!1}},Uu=function(n){if(!Q0(n))return!1;switch(EA(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return TA||!!kh(su,SA(n))}catch{return!0}};Uu.sham=!0;var Pm,Za,bA,hE,Ov=!Go||J0(function(){var n;return Om(Om.call)||!Om(Object)||!Om(function(){n=!0})||n})?Uu:Om,wA=Ov,CA=Do,uL=TypeError,Pv=hn,eb=function(n){if(wA(n))return n;throw uL(CA(n)+" is not a constructor")},Vu=Tn,ti=fr("species"),oo=function(n,i){var s,c=Pv(n).constructor;return c===void 0||Vu(s=Pv(c)[ti])?i:eb(s)},Ts=C([].slice),la=TypeError,Ho=function(n,i){if(n<i)throw la("Not enough arguments");return n},ep=/(?:ipad|iphone|ipod).*applewebkit/i.test(Un),mi=L,Nv=M,tp=De,Dv=qe,tb=Ti,Nm=u,ec=hv,nb=Ts,np=So,jd=Ho,fE=ep,rb=jf,Jl=mi.setImmediate,Dm=mi.clearImmediate,Oh=mi.process,Lm=mi.Dispatch,Lv=mi.Function,pE=mi.MessageChannel,mE=mi.String,xm=0,wo={},Bd="onreadystatechange";Nm(function(){Pm=mi.location});var ou=function(n){if(tb(wo,n)){var i=wo[n];delete wo[n],i()}},Oa=function(n){return function(){ou(n)}},ib=function(n){ou(n.data)},gE=function(n){mi.postMessage(mE(n),Pm.protocol+"//"+Pm.host)};Jl&&Dm||(Jl=function(n){jd(arguments.length,1);var i=Dv(n)?n:Lv(n),s=nb(arguments,1);return wo[++xm]=function(){Nv(i,void 0,s)},Za(xm),xm},Dm=function(n){delete wo[n]},rb?Za=function(n){Oh.nextTick(Oa(n))}:Lm&&Lm.now?Za=function(n){Lm.now(Oa(n))}:pE&&!fE?(hE=(bA=new pE).port2,bA.port1.onmessage=ib,Za=tp(hE.postMessage,hE)):mi.addEventListener&&Dv(mi.postMessage)&&!mi.importScripts&&Pm&&Pm.protocol!=="file:"&&!Nm(gE)?(Za=gE,mi.addEventListener("message",ib,!1)):Za=Bd in np("script")?function(n){ec.appendChild(np("script"))[Bd]=function(){ec.removeChild(this),ou(n)}}:function(n){setTimeout(Oa(n),0)});var Mm={set:Jl,clear:Dm},RA=function(){this.head=null,this.tail=null};RA.prototype={add:function(n){var i={item:n,next:null},s=this.tail;s?s.next=i:this.head=i,this.tail=i},get:function(){var n=this.head;if(n)return(this.head=n.next)===null&&(this.tail=null),n.item}};var au,vE,xv,Wd,_E,Ph=RA,IA=/ipad|iphone|ipod/i.test(Un)&&typeof Pebble<"u",AA=/web0s(?!.*chrome)/i.test(Un),zd=L,Mv=De,lL=St.f,sb=Mm.set,kA=Ph,OA=ep,rp=IA,dL=AA,Nh=jf,ob=zd.MutationObserver||zd.WebKitMutationObserver,bs=zd.document,PA=zd.process,Uv=zd.Promise,NA=lL(zd,"queueMicrotask"),ab=NA&&NA.value;if(!ab){var Vv=new kA,Fv=function(){var n,i;for(Nh&&(n=PA.domain)&&n.exit();i=Vv.get();)try{i()}catch(s){throw Vv.head&&au(),s}n&&n.enter()};OA||Nh||dL||!ob||!bs?!rp&&Uv&&Uv.resolve?((Wd=Uv.resolve(void 0)).constructor=Uv,_E=Mv(Wd.then,Wd),au=function(){_E(Fv)}):Nh?au=function(){PA.nextTick(Fv)}:(sb=Mv(sb,zd),au=function(){sb(Fv)}):(vE=!0,xv=bs.createTextNode(""),new ob(Fv).observe(xv,{characterData:!0}),au=function(){xv.data=vE=!vE}),ab=function(n){Vv.head||au(),Vv.add(n)}}var DA=ab,da=function(n){try{return{error:!1,value:n()}}catch(i){return{error:!0,value:i}}},Gd=L.Promise,LA=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Dh=!LA&&!jf&&typeof window=="object"&&typeof document=="object",yE=L,Sl=Gd,EE=qe,cb=ro,ub=km,hL=fr,lb=Dh,fL=LA,SE=Cr,db=Sl&&Sl.prototype,TE=hL("species"),jv=EE(yE.PromiseRejectionEvent),xA=cb("Promise",function(){var n=ub(Sl),i=n!==String(Sl);if(!i&&SE===66||!db.catch||!db.finally)return!0;if(!SE||SE<51||!/native code/.test(n)){var s=new Sl(function(l){l(1)}),c=function(l){l(function(){},function(){})};if((s.constructor={})[TE]=c,!(s.then(function(){})instanceof c))return!0}return!i&&(lb||fL)&&!jv}),ip={CONSTRUCTOR:xA,REJECTION_EVENT:jv},Ql={},hb=us,fb=TypeError,bE=function(n){var i,s;this.promise=new n(function(c,l){if(i!==void 0||s!==void 0)throw fb("Bad Promise constructor");i=c,s=l}),this.resolve=hb(i),this.reject=hb(s)};Ql.f=function(n){return new bE(n)};var Bv,Wv,MA=cn,wE=jf,Tl=L,zv=Ve,Gv=Yl,pL=Fd,CE=function(n){var i=sL(n);cE&&i&&!i[ua]&&oL(i,ua,{configurable:!0,get:function(){return this}})},m=us,_=qe,w=at,P=Ah,V=oo,J=Mm.set,fe=DA,Ie=function(n,i){try{arguments.length==1?console.error(n):console.error(n,i)}catch{}},je=da,ut=Ph,Nt=$l,xt=Gd,Ot=ip,on=Ql,ln="Promise",mn=Ot.CONSTRUCTOR,Ks=Ot.REJECTION_EVENT,Ze=Nt.getterFor(ln),We=Nt.set,ot=xt&&xt.prototype,Vt=xt,_n=ot,Ln=Tl.TypeError,An=Tl.document,Yn=Tl.process,ao=on.f,ui=ao,Lh=!!(An&&An.createEvent&&Tl.dispatchEvent),UA="unhandledrejection",v6=function(n){var i;return!(!w(n)||!_(i=n.then))&&i},_6=function(n,i){var s,c,l,h=i.value,p=i.state==1,v=p?n.ok:n.fail,y=n.resolve,S=n.reject,b=n.domain;try{v?(p||(i.rejection===2&&vhe(i),i.rejection=1),v===!0?s=h:(b&&b.enter(),s=v(h),b&&(b.exit(),l=!0)),s===n.promise?S(Ln("Promise-chain cycle")):(c=v6(s))?zv(c,s,y,S):y(s)):S(h)}catch(R){b&&!l&&b.exit(),S(R)}},y6=function(n,i){n.notified||(n.notified=!0,fe(function(){for(var s,c=n.reactions;s=c.get();)_6(s,n);n.notified=!1,i&&!n.rejection&&ghe(n)}))},E6=function(n,i,s){var c,l;Lh?((c=An.createEvent("Event")).promise=i,c.reason=s,c.initEvent(n,!1,!0),Tl.dispatchEvent(c)):c={promise:i,reason:s},!Ks&&(l=Tl["on"+n])?l(c):n===UA&&Ie("Unhandled promise rejection",s)},ghe=function(n){zv(J,Tl,function(){var i,s=n.facade,c=n.value;if(S6(n)&&(i=je(function(){wE?Yn.emit("unhandledRejection",c,s):E6(UA,s,c)}),n.rejection=wE||S6(n)?2:1,i.error))throw i.value})},S6=function(n){return n.rejection!==1&&!n.parent},vhe=function(n){zv(J,Tl,function(){var i=n.facade;wE?Yn.emit("rejectionHandled",i):E6("rejectionhandled",i,n.value)})},RE=function(n,i,s){return function(c){n(i,c,s)}},IE=function(n,i,s){n.done||(n.done=!0,s&&(n=s),n.value=i,n.state=2,y6(n,!0))},mL=function(n,i,s){if(!n.done){n.done=!0,s&&(n=s);try{if(n.facade===i)throw Ln("Promise can't be resolved itself");var c=v6(i);c?fe(function(){var l={done:!1};try{zv(c,i,RE(mL,l,n),RE(IE,l,n))}catch(h){IE(l,h,n)}}):(n.value=i,n.state=1,y6(n,!1))}catch(l){IE({done:!1},l,n)}}};mn&&(_n=(Vt=function(n){P(this,_n),m(n),zv(Bv,this);var i=Ze(this);try{n(RE(mL,i),RE(IE,i))}catch(s){IE(i,s)}}).prototype,(Bv=function(n){We(this,{type:ln,done:!1,notified:!1,parent:!1,reactions:new ut,rejection:!1,state:0,value:void 0})}).prototype=Gv(_n,"then",function(n,i){var s=Ze(this),c=ao(V(this,Vt));return s.parent=!0,c.ok=!_(n)||n,c.fail=_(i)&&i,c.domain=wE?Yn.domain:void 0,s.state==0?s.reactions.add(c):fe(function(){_6(c,s)}),c.promise}),Wv=function(){var n=new Bv,i=Ze(n);this.promise=n,this.resolve=RE(mL,i),this.reject=RE(IE,i)},on.f=ao=function(n){return n===Vt||n===void 0?new Wv(n):ui(n)}),MA({global:!0,wrap:!0,forced:mn},{Promise:Vt}),pL(Vt,ln,!1,!0),CE(ln);var T6=fr("iterator"),b6=!1;try{var _he=0,w6={next:function(){return{done:!!_he++}},return:function(){b6=!0}};w6[T6]=function(){return this},Array.from(w6,function(){throw 2})}catch{}var yhe=Gd,Ehe=function(n,i){if(!b6)return!1;var s=!1;try{var c={};c[T6]=function(){return{next:function(){return{done:s=!0}}}},n(c)}catch{}return s},VA=ip.CONSTRUCTOR||!Ehe(function(n){yhe.all(n).then(void 0,function(){})}),She=Ve,The=us,bhe=Ql,whe=da,Che=Ud;cn({target:"Promise",stat:!0,forced:VA},{all:function(n){var i=this,s=bhe.f(i),c=s.resolve,l=s.reject,h=whe(function(){var p=The(i.resolve),v=[],y=0,S=1;Che(n,function(b){var R=y++,O=!1;S++,She(p,i,b).then(function(N){O||(O=!0,v[R]=N,--S||c(v))},l)}),--S||c(v)});return h.error&&l(h.value),s.promise}});var Rhe=cn,Ihe=ip.CONSTRUCTOR;Gd&&Gd.prototype,Rhe({target:"Promise",proto:!0,forced:Ihe,real:!0},{catch:function(n){return this.then(void 0,n)}});var Ahe=Ve,khe=us,Ohe=Ql,Phe=da,Nhe=Ud;cn({target:"Promise",stat:!0,forced:VA},{race:function(n){var i=this,s=Ohe.f(i),c=s.reject,l=Phe(function(){var h=khe(i.resolve);Nhe(n,function(p){Ahe(h,i,p).then(s.resolve,c)})});return l.error&&c(l.value),s.promise}});var Dhe=Ve,Lhe=Ql;cn({target:"Promise",stat:!0,forced:ip.CONSTRUCTOR},{reject:function(n){var i=Lhe.f(this);return Dhe(i.reject,void 0,n),i.promise}});var xhe=hn,Mhe=at,Uhe=Ql,C6=function(n,i){if(xhe(n),Mhe(i)&&i.constructor===n)return i;var s=Uhe.f(n);return(0,s.resolve)(i),s.promise},Vhe=cn,Fhe=Gd,jhe=ip.CONSTRUCTOR,Bhe=C6,Whe=Kt("Promise"),zhe=!jhe;Vhe({target:"Promise",stat:!0,forced:!0},{resolve:function(n){return Bhe(zhe&&this===Whe?Fhe:this,n)}});var Ghe=Ve,Hhe=us,Khe=Ql,qhe=da,$he=Ud;cn({target:"Promise",stat:!0,forced:VA},{allSettled:function(n){var i=this,s=Khe.f(i),c=s.resolve,l=s.reject,h=qhe(function(){var p=Hhe(i.resolve),v=[],y=0,S=1;$he(n,function(b){var R=y++,O=!1;S++,Ghe(p,i,b).then(function(N){O||(O=!0,v[R]={status:"fulfilled",value:N},--S||c(v))},function(N){O||(O=!0,v[R]={status:"rejected",reason:N},--S||c(v))})}),--S||c(v)});return h.error&&l(h.value),s.promise}});var Yhe=Ve,Xhe=us,Jhe=Kt,Qhe=Ql,Zhe=da,efe=Ud,R6="No one promise resolved";cn({target:"Promise",stat:!0,forced:VA},{any:function(n){var i=this,s=Jhe("AggregateError"),c=Qhe.f(i),l=c.resolve,h=c.reject,p=Zhe(function(){var v=Xhe(i.resolve),y=[],S=0,b=1,R=!1;efe(n,function(O){var N=S++,Y=!1;b++,Yhe(v,i,O).then(function(W){Y||R||(R=!0,l(W))},function(W){Y||R||(Y=!0,y[N]=W,--b||h(new s(y,R6)))})}),--b||h(new s(y,R6))});return p.error&&h(p.value),c.promise}});var tfe=cn,gL=Gd,nfe=u,rfe=Kt,ife=qe,sfe=oo,I6=C6,ofe=gL&&gL.prototype;tfe({target:"Promise",proto:!0,real:!0,forced:!!gL&&nfe(function(){ofe.finally.call({then:function(){}},function(){})})},{finally:function(n){var i=sfe(this,rfe("Promise")),s=ife(n);return this.then(s?function(c){return I6(i,n()).then(function(){return c})}:n,s?function(c){return I6(i,n()).then(function(){throw c})}:n)}});var vL=C,afe=ns,cfe=Cc,ufe=Pt,lfe=vL("".charAt),A6=vL("".charCodeAt),dfe=vL("".slice),k6=function(n){return function(i,s){var c,l,h=cfe(ufe(i)),p=afe(s),v=h.length;return p<0||p>=v?n?"":void 0:(c=A6(h,p))<55296||c>56319||p+1===v||(l=A6(h,p+1))<56320||l>57343?n?lfe(h,p):c:n?dfe(h,p,p+2):l-56320+(c-55296<<10)+65536}},_L={codeAt:k6(!1),charAt:k6(!0)},hfe=_L.charAt,ffe=Cc,O6=$l,pfe=$0,P6=Iv,N6="String Iterator",mfe=O6.set,gfe=O6.getterFor(N6);pfe(String,"String",function(n){mfe(this,{type:N6,string:ffe(n),index:0})},function(){var n,i=gfe(this),s=i.string,c=i.index;return c>=s.length?P6(void 0,!0):(n=hfe(s,c),i.index+=n.length,P6(n,!1))});var vfe=ct.Promise,_fe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},yfe=L,Efe=ku,Sfe=jo,D6=Lu,L6=fr("toStringTag");for(var yL in _fe){var x6=yfe[yL],EL=x6&&x6.prototype;EL&&Efe(EL)!==L6&&Sfe(EL,L6,yL),D6[yL]=D6.Array}var M6=vfe,pt=a(M6),Tfe=tu("Array").values,bfe=ku,wfe=Ti,Cfe=I,Rfe=Tfe,SL=Array.prototype,Ife={DOMTokenList:!0,NodeList:!0},Afe=function(n){var i=n.values;return n===SL||Cfe(SL,n)&&i===SL.values||wfe(Ife,bfe(n))?Rfe:i},Fu=a(Afe),kfe=u,Ofe=fr("iterator"),TL=!kfe(function(){var n=new URL("b?a=1&b=2&c=3","http://a"),i=n.searchParams,s=new URLSearchParams("a=1&a=2"),c="";return n.pathname="c%20d",i.forEach(function(l,h){i.delete("b"),c+=h+l}),s.delete("a",2),!n.toJSON||!s.has("a",1)||s.has("a",2)||!i.size&&!0||!i.sort||n.href!=="http://a/c%20d?a=1&c=3"||i.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!i[Ofe]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||c!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Pfe=Yl,Nfe=Aa,Dfe=st,Lfe=jt,FA=function(n,i,s){var c=Nfe(i);c in n?Dfe.f(n,c,Lfe(0,s)):n[c]=s},U6=ye,xfe=Ki,Mfe=FA,Ufe=Array,Vfe=Math.max,bL=function(n,i,s){for(var c=xfe(n),l=U6(i,c),h=U6(s===void 0?c:s,c),p=Ufe(Vfe(h-l,0)),v=0;l<h;l++,v++)Mfe(p,v,n[l]);return p.length=v,p},V6=bL,Ffe=Math.floor,wL=function(n,i){var s=n.length,c=Ffe(s/2);return s<8?jfe(n,i):Bfe(n,wL(V6(n,0,c),i),wL(V6(n,c),i),i)},jfe=function(n,i){for(var s,c,l=n.length,h=1;h<l;){for(c=h,s=n[h];c&&i(n[c-1],s)>0;)n[c]=n[--c];c!==h++&&(n[c]=s)}return n},Bfe=function(n,i,s,c){for(var l=i.length,h=s.length,p=0,v=0;p<l||v<h;)n[p+v]=p<l&&v<h?c(i[p],s[v])<=0?i[p++]:s[v++]:p<l?i[p++]:s[v++];return n},F6=wL,CL=cn,AE=L,jA=Ve,xh=C,kE=ke,j6=TL,B6=Yl,Wfe=bo,zfe=function(n,i,s){for(var c in i)s&&s.unsafe&&n[c]?n[c]=i[c]:Pfe(n,c,i[c],s);return n},Gfe=Fd,Hfe=ca,RL=$l,W6=Ah,IL=qe,Kfe=Ti,qfe=De,$fe=ku,Yfe=hn,z6=at,cu=Cc,Xfe=Qa,G6=jt,AL=Jy,Jfe=xu,OE=Ho,Qfe=F6,Zfe=fr("iterator"),pb="URLSearchParams",H6=pb+"Iterator",K6=RL.set,Zl=RL.getterFor(pb),epe=RL.getterFor(H6),tpe=Object.getOwnPropertyDescriptor,kL=function(n){if(!kE)return AE[n];var i=tpe(AE,n);return i&&i.value},q6=kL("fetch"),BA=kL("Request"),mb=kL("Headers"),OL=BA&&BA.prototype,$6=mb&&mb.prototype,npe=AE.RegExp,rpe=AE.TypeError,Y6=AE.decodeURIComponent,ipe=AE.encodeURIComponent,spe=xh("".charAt),X6=xh([].join),Hv=xh([].push),PL=xh("".replace),ope=xh([].shift),J6=xh([].splice),Q6=xh("".split),ape=xh("".slice),cpe=/\+/g,Z6=Array(4),upe=function(n){return Z6[n-1]||(Z6[n-1]=npe("((?:%[\\da-f]{2}){"+n+"})","gi"))},lpe=function(n){try{return Y6(n)}catch{return n}},eW=function(n){var i=PL(n,cpe," "),s=4;try{return Y6(i)}catch{for(;s;)i=PL(i,upe(s--),lpe);return i}},dpe=/[!'()~]|%20/g,hpe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},fpe=function(n){return hpe[n]},tW=function(n){return PL(ipe(n),dpe,fpe)},NL=Hfe(function(n,i){K6(this,{type:H6,iterator:AL(Zl(n).entries),kind:i})},"Iterator",function(){var n=epe(this),i=n.kind,s=n.iterator.next(),c=s.value;return s.done||(s.value=i==="keys"?c.key:i==="values"?c.value:[c.key,c.value]),s},!0),nW=function(n){this.entries=[],this.url=null,n!==void 0&&(z6(n)?this.parseObject(n):this.parseQuery(typeof n=="string"?spe(n,0)==="?"?ape(n,1):n:cu(n)))};nW.prototype={type:pb,bindURL:function(n){this.url=n,this.update()},parseObject:function(n){var i,s,c,l,h,p,v,y=Jfe(n);if(y)for(s=(i=AL(n,y)).next;!(c=jA(s,i)).done;){if(h=(l=AL(Yfe(c.value))).next,(p=jA(h,l)).done||(v=jA(h,l)).done||!jA(h,l).done)throw rpe("Expected sequence with length 2");Hv(this.entries,{key:cu(p.value),value:cu(v.value)})}else for(var S in n)Kfe(n,S)&&Hv(this.entries,{key:S,value:cu(n[S])})},parseQuery:function(n){if(n)for(var i,s,c=Q6(n,"&"),l=0;l<c.length;)(i=c[l++]).length&&(s=Q6(i,"="),Hv(this.entries,{key:eW(ope(s)),value:eW(X6(s,"="))}))},serialize:function(){for(var n,i=this.entries,s=[],c=0;c<i.length;)n=i[c++],Hv(s,tW(n.key)+"="+tW(n.value));return X6(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var WA=function(){W6(this,PE);var n=K6(this,new nW(arguments.length>0?arguments[0]:void 0));kE||(this.size=n.entries.length)},PE=WA.prototype;if(zfe(PE,{append:function(n,i){var s=Zl(this);OE(arguments.length,2),Hv(s.entries,{key:cu(n),value:cu(i)}),kE||this.length++,s.updateURL()},delete:function(n){for(var i=Zl(this),s=OE(arguments.length,1),c=i.entries,l=cu(n),h=s<2?void 0:arguments[1],p=h===void 0?h:cu(h),v=0;v<c.length;){var y=c[v];if(y.key!==l||p!==void 0&&y.value!==p)v++;else if(J6(c,v,1),p!==void 0)break}kE||(this.size=c.length),i.updateURL()},get:function(n){var i=Zl(this).entries;OE(arguments.length,1);for(var s=cu(n),c=0;c<i.length;c++)if(i[c].key===s)return i[c].value;return null},getAll:function(n){var i=Zl(this).entries;OE(arguments.length,1);for(var s=cu(n),c=[],l=0;l<i.length;l++)i[l].key===s&&Hv(c,i[l].value);return c},has:function(n){for(var i=Zl(this).entries,s=OE(arguments.length,1),c=cu(n),l=s<2?void 0:arguments[1],h=l===void 0?l:cu(l),p=0;p<i.length;){var v=i[p++];if(v.key===c&&(h===void 0||v.value===h))return!0}return!1},set:function(n,i){var s=Zl(this);OE(arguments.length,1);for(var c,l=s.entries,h=!1,p=cu(n),v=cu(i),y=0;y<l.length;y++)(c=l[y]).key===p&&(h?J6(l,y--,1):(h=!0,c.value=v));h||Hv(l,{key:p,value:v}),kE||(this.size=l.length),s.updateURL()},sort:function(){var n=Zl(this);Qfe(n.entries,function(i,s){return i.key>s.key?1:-1}),n.updateURL()},forEach:function(n){for(var i,s=Zl(this).entries,c=qfe(n,arguments.length>1?arguments[1]:void 0),l=0;l<s.length;)c((i=s[l++]).value,i.key,this)},keys:function(){return new NL(this,"keys")},values:function(){return new NL(this,"values")},entries:function(){return new NL(this,"entries")}},{enumerable:!0}),B6(PE,Zfe,PE.entries,{}),B6(PE,"toString",function(){return Zl(this).serialize()},{enumerable:!0}),kE&&Wfe(PE,"size",{get:function(){return Zl(this).entries.length},configurable:!0,enumerable:!0}),Gfe(WA,pb),CL({global:!0,forced:!j6},{URLSearchParams:WA}),!j6&&IL(mb)){var ppe=xh($6.has),mpe=xh($6.set),rW=function(n){if(z6(n)){var i,s=n.body;if($fe(s)===pb)return i=n.headers?new mb(n.headers):new mb,ppe(i,"content-type")||mpe(i,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Xfe(n,{body:G6(0,cu(s)),headers:G6(0,i)})}return n};if(IL(q6)&&CL({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(n){return q6(n,arguments.length>1?rW(arguments[1]):{})}}),IL(BA)){var DL=function(n){return W6(this,OL),new BA(n,arguments.length>1?rW(arguments[1]):{})};OL.constructor=DL,DL.prototype=OL,CL({global:!0,dontCallGetSet:!0,forced:!0},{Request:DL})}}var ed,gpe={URLSearchParams:WA,getState:Zl},vpe=ct.URLSearchParams,iW=ke,_pe=C,ype=Ve,Epe=u,LL=Nu,Spe=Pu,Tpe=ve,bpe=Lo,wpe=Er,NE=Object.assign,sW=Object.defineProperty,Cpe=_pe([].concat),Rpe=!NE||Epe(function(){if(iW&&NE({b:1},NE(sW({},"a",{enumerable:!0,get:function(){sW(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var n={},i={},s=Symbol(),c="abcdefghijklmnopqrst";return n[s]=7,c.split("").forEach(function(l){i[l]=l}),NE({},n)[s]!=7||LL(NE({},i)).join("")!=c})?function(n,i){for(var s=bpe(n),c=arguments.length,l=1,h=Spe.f,p=Tpe.f;c>l;)for(var v,y=wpe(arguments[l++]),S=h?Cpe(LL(y),h(y)):LL(y),b=S.length,R=0;b>R;)v=S[R++],iW&&!ype(p,y,v)||(s[v]=y[v]);return s}:NE,Ipe=hn,Ape=Zy,kpe=De,Ope=Ve,Ppe=Lo,Npe=function(n,i,s,c){try{return c?i(Ipe(s)[0],s[1]):i(s)}catch(l){Ape(n,"throw",l)}},Dpe=Yy,Lpe=Ov,xpe=Ki,oW=FA,Mpe=Jy,Upe=xu,aW=Array,Kv=C,xL=2147483647,Vpe=/[^\0-\u007E]/,cW=/[.\u3002\uFF0E\uFF61]/g,uW="Overflow: input needs wider integers to process",lW=RangeError,Fpe=Kv(cW.exec),DE=Math.floor,ML=String.fromCharCode,dW=Kv("".charCodeAt),hW=Kv([].join),Um=Kv([].push),jpe=Kv("".replace),Bpe=Kv("".split),Wpe=Kv("".toLowerCase),fW=function(n){return n+22+75*(n<26)},zpe=function(n,i,s){var c=0;for(n=s?DE(n/700):n>>1,n+=DE(n/i);n>455;)n=DE(n/35),c+=36;return DE(c+36*n/(n+38))},Gpe=function(n){var i=[];n=function(ne){for(var re=[],me=0,be=ne.length;me<be;){var we=dW(ne,me++);if(we>=55296&&we<=56319&&me<be){var Se=dW(ne,me++);(64512&Se)==56320?Um(re,((1023&we)<<10)+(1023&Se)+65536):(Um(re,we),me--)}else Um(re,we)}return re}(n);var s,c,l=n.length,h=128,p=0,v=72;for(s=0;s<n.length;s++)(c=n[s])<128&&Um(i,ML(c));var y=i.length,S=y;for(y&&Um(i,"-");S<l;){var b=xL;for(s=0;s<n.length;s++)(c=n[s])>=h&&c<b&&(b=c);var R=S+1;if(b-h>DE((xL-p)/R))throw lW(uW);for(p+=(b-h)*R,h=b,s=0;s<n.length;s++){if((c=n[s])<h&&++p>xL)throw lW(uW);if(c==h){for(var O=p,N=36;;){var Y=N<=v?1:N>=v+26?26:N-v;if(O<Y)break;var W=O-Y,H=36-Y;Um(i,ML(fW(Y+W%H))),O=DE(W/H),N+=36}Um(i,ML(fW(O))),v=zpe(p,R,S==y),p=0,S++}}p++,h++}return hW(i,"")},Hpe=cn,UL=ke,Kpe=TL,VL=L,pW=De,td=C,zA=Yl,nd=bo,qpe=Ah,FL=Ti,jL=Rpe,LE=function(n){var i=Ppe(n),s=Lpe(this),c=arguments.length,l=c>1?arguments[1]:void 0,h=l!==void 0;h&&(l=kpe(l,c>2?arguments[2]:void 0));var p,v,y,S,b,R,O=Upe(i),N=0;if(!O||this===aW&&Dpe(O))for(p=xpe(i),v=s?new this(p):aW(p);p>N;N++)R=h?l(i[N],N):i[N],oW(v,N,R);else for(b=(S=Mpe(i,O)).next,v=s?new this:[];!(y=Ope(b,S)).done;N++)R=h?Npe(S,l,[y.value,N],!0):y.value,oW(v,N,R);return v.length=N,v},Hd=bL,$pe=_L.codeAt,Ype=function(n){var i,s,c=[],l=Bpe(jpe(Wpe(n),cW,"."),".");for(i=0;i<l.length;i++)s=l[i],Um(c,Fpe(Vpe,s)?"xn--"+Gpe(s):s);return hW(c,".")},sp=Cc,Xpe=Fd,Jpe=Ho,mW=gpe,gW=$l,Qpe=gW.set,GA=gW.getterFor("URL"),Zpe=mW.URLSearchParams,eme=mW.getState,gb=VL.URL,BL=VL.TypeError,HA=VL.parseInt,tme=Math.floor,vW=Math.pow,rd=td("".charAt),Kd=td(/./.exec),vb=td([].join),nme=td(1 .toString),rme=td([].pop),xE=td([].push),WL=td("".replace),ime=td([].shift),sme=td("".split),_b=td("".slice),KA=td("".toLowerCase),ome=td([].unshift),zL="Invalid scheme",qv="Invalid host",_W="Invalid port",yW=/[a-z]/i,ame=/[\d+-.a-z]/i,GL=/\d/,cme=/^0x/i,ume=/^[0-7]+$/,lme=/^\d+$/,EW=/^[\da-f]+$/i,dme=/[\0\t\n\r #%/:<>?@[\\\]^|]/,hme=/[\0\t\n\r #/:<>?@[\\\]^|]/,fme=/^[\u0000-\u0020]+/,pme=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,mme=/[\t\n\r]/g,yb=function(n){var i,s,c,l;if(typeof n=="number"){for(i=[],s=0;s<4;s++)ome(i,n%256),n=tme(n/256);return vb(i,".")}if(typeof n=="object"){for(i="",c=function(h){for(var p=null,v=1,y=null,S=0,b=0;b<8;b++)h[b]!==0?(S>v&&(p=y,v=S),y=null,S=0):(y===null&&(y=b),++S);return S>v&&(p=y,v=S),p}(n),s=0;s<8;s++)l&&n[s]===0||(l&&(l=!1),c===s?(i+=s?":":"::",l=!0):(i+=nme(n[s],16),s<7&&(i+=":")));return"["+i+"]"}return n},qA={},SW=jL({},qA,{" ":1,'"':1,"<":1,">":1,"`":1}),TW=jL({},SW,{"#":1,"?":1,"{":1,"}":1}),HL=jL({},TW,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Vm=function(n,i){var s=$pe(n,0);return s>32&&s<127&&!FL(i,n)?n:encodeURIComponent(n)},$A={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Eb=function(n,i){var s;return n.length==2&&Kd(yW,rd(n,0))&&((s=rd(n,1))==":"||!i&&s=="|")},bW=function(n){var i;return n.length>1&&Eb(_b(n,0,2))&&(n.length==2||(i=rd(n,2))==="/"||i==="\\"||i==="?"||i==="#")},gme=function(n){return n==="."||KA(n)==="%2e"},KL={},wW={},qL={},CW={},RW={},$L={},IW={},AW={},YA={},XA={},YL={},XL={},JL={},QL={},kW={},ZL={},ME={},Mh={},OW={},$v={},op={},ex=function(n,i,s){var c,l,h,p=sp(n);if(i){if(l=this.parse(p))throw BL(l);this.searchParams=null}else{if(s!==void 0&&(c=new ex(s,!0)),l=this.parse(p,null,c))throw BL(l);(h=eme(new Zpe)).bindURL(this),this.searchParams=h}};ex.prototype={type:"URL",parse:function(n,i,s){var c,l,h,p,v,y=this,S=i||KL,b=0,R="",O=!1,N=!1,Y=!1;for(n=sp(n),i||(y.scheme="",y.username="",y.password="",y.host=null,y.port=null,y.path=[],y.query=null,y.fragment=null,y.cannotBeABaseURL=!1,n=WL(n,fme,""),n=WL(n,pme,"$1")),n=WL(n,mme,""),c=LE(n);b<=c.length;){switch(l=c[b],S){case KL:if(!l||!Kd(yW,l)){if(i)return zL;S=qL;continue}R+=KA(l),S=wW;break;case wW:if(l&&(Kd(ame,l)||l=="+"||l=="-"||l=="."))R+=KA(l);else{if(l!=":"){if(i)return zL;R="",S=qL,b=0;continue}if(i&&(y.isSpecial()!=FL($A,R)||R=="file"&&(y.includesCredentials()||y.port!==null)||y.scheme=="file"&&!y.host))return;if(y.scheme=R,i)return void(y.isSpecial()&&$A[y.scheme]==y.port&&(y.port=null));R="",y.scheme=="file"?S=QL:y.isSpecial()&&s&&s.scheme==y.scheme?S=CW:y.isSpecial()?S=AW:c[b+1]=="/"?(S=RW,b++):(y.cannotBeABaseURL=!0,xE(y.path,""),S=OW)}break;case qL:if(!s||s.cannotBeABaseURL&&l!="#")return zL;if(s.cannotBeABaseURL&&l=="#"){y.scheme=s.scheme,y.path=Hd(s.path),y.query=s.query,y.fragment="",y.cannotBeABaseURL=!0,S=op;break}S=s.scheme=="file"?QL:$L;continue;case CW:if(l!="/"||c[b+1]!="/"){S=$L;continue}S=YA,b++;break;case RW:if(l=="/"){S=XA;break}S=Mh;continue;case $L:if(y.scheme=s.scheme,l==ed)y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Hd(s.path),y.query=s.query;else if(l=="/"||l=="\\"&&y.isSpecial())S=IW;else if(l=="?")y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Hd(s.path),y.query="",S=$v;else{if(l!="#"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Hd(s.path),y.path.length--,S=Mh;continue}y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Hd(s.path),y.query=s.query,y.fragment="",S=op}break;case IW:if(!y.isSpecial()||l!="/"&&l!="\\"){if(l!="/"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,S=Mh;continue}S=XA}else S=YA;break;case AW:if(S=YA,l!="/"||rd(R,b+1)!="/")continue;b++;break;case YA:if(l!="/"&&l!="\\"){S=XA;continue}break;case XA:if(l=="@"){O&&(R="%40"+R),O=!0,h=LE(R);for(var W=0;W<h.length;W++){var H=h[W];if(H!=":"||Y){var ne=Vm(H,HL);Y?y.password+=ne:y.username+=ne}else Y=!0}R=""}else if(l==ed||l=="/"||l=="?"||l=="#"||l=="\\"&&y.isSpecial()){if(O&&R=="")return"Invalid authority";b-=LE(R).length+1,R="",S=YL}else R+=l;break;case YL:case XL:if(i&&y.scheme=="file"){S=ZL;continue}if(l!=":"||N){if(l==ed||l=="/"||l=="?"||l=="#"||l=="\\"&&y.isSpecial()){if(y.isSpecial()&&R=="")return qv;if(i&&R==""&&(y.includesCredentials()||y.port!==null))return;if(p=y.parseHost(R))return p;if(R="",S=ME,i)return;continue}l=="["?N=!0:l=="]"&&(N=!1),R+=l}else{if(R=="")return qv;if(p=y.parseHost(R))return p;if(R="",S=JL,i==XL)return}break;case JL:if(!Kd(GL,l)){if(l==ed||l=="/"||l=="?"||l=="#"||l=="\\"&&y.isSpecial()||i){if(R!=""){var re=HA(R,10);if(re>65535)return _W;y.port=y.isSpecial()&&re===$A[y.scheme]?null:re,R=""}if(i)return;S=ME;continue}return _W}R+=l;break;case QL:if(y.scheme="file",l=="/"||l=="\\")S=kW;else{if(!s||s.scheme!="file"){S=Mh;continue}if(l==ed)y.host=s.host,y.path=Hd(s.path),y.query=s.query;else if(l=="?")y.host=s.host,y.path=Hd(s.path),y.query="",S=$v;else{if(l!="#"){bW(vb(Hd(c,b),""))||(y.host=s.host,y.path=Hd(s.path),y.shortenPath()),S=Mh;continue}y.host=s.host,y.path=Hd(s.path),y.query=s.query,y.fragment="",S=op}}break;case kW:if(l=="/"||l=="\\"){S=ZL;break}s&&s.scheme=="file"&&!bW(vb(Hd(c,b),""))&&(Eb(s.path[0],!0)?xE(y.path,s.path[0]):y.host=s.host),S=Mh;continue;case ZL:if(l==ed||l=="/"||l=="\\"||l=="?"||l=="#"){if(!i&&Eb(R))S=Mh;else if(R==""){if(y.host="",i)return;S=ME}else{if(p=y.parseHost(R))return p;if(y.host=="localhost"&&(y.host=""),i)return;R="",S=ME}continue}R+=l;break;case ME:if(y.isSpecial()){if(S=Mh,l!="/"&&l!="\\")continue}else if(i||l!="?")if(i||l!="#"){if(l!=ed&&(S=Mh,l!="/"))continue}else y.fragment="",S=op;else y.query="",S=$v;break;case Mh:if(l==ed||l=="/"||l=="\\"&&y.isSpecial()||!i&&(l=="?"||l=="#")){if((v=KA(v=R))===".."||v==="%2e."||v===".%2e"||v==="%2e%2e"?(y.shortenPath(),l=="/"||l=="\\"&&y.isSpecial()||xE(y.path,"")):gme(R)?l=="/"||l=="\\"&&y.isSpecial()||xE(y.path,""):(y.scheme=="file"&&!y.path.length&&Eb(R)&&(y.host&&(y.host=""),R=rd(R,0)+":"),xE(y.path,R)),R="",y.scheme=="file"&&(l==ed||l=="?"||l=="#"))for(;y.path.length>1&&y.path[0]==="";)ime(y.path);l=="?"?(y.query="",S=$v):l=="#"&&(y.fragment="",S=op)}else R+=Vm(l,TW);break;case OW:l=="?"?(y.query="",S=$v):l=="#"?(y.fragment="",S=op):l!=ed&&(y.path[0]+=Vm(l,qA));break;case $v:i||l!="#"?l!=ed&&(l=="'"&&y.isSpecial()?y.query+="%27":y.query+=l=="#"?"%23":Vm(l,qA)):(y.fragment="",S=op);break;case op:l!=ed&&(y.fragment+=Vm(l,SW))}b++}},parseHost:function(n){var i,s,c;if(rd(n,0)=="["){if(rd(n,n.length-1)!="]"||(i=function(l){var h,p,v,y,S,b,R,O=[0,0,0,0,0,0,0,0],N=0,Y=null,W=0,H=function(){return rd(l,W)};if(H()==":"){if(rd(l,1)!=":")return;W+=2,Y=++N}for(;H();){if(N==8)return;if(H()!=":"){for(h=p=0;p<4&&Kd(EW,H());)h=16*h+HA(H(),16),W++,p++;if(H()=="."){if(p==0||(W-=p,N>6))return;for(v=0;H();){if(y=null,v>0){if(!(H()=="."&&v<4))return;W++}if(!Kd(GL,H()))return;for(;Kd(GL,H());){if(S=HA(H(),10),y===null)y=S;else{if(y==0)return;y=10*y+S}if(y>255)return;W++}O[N]=256*O[N]+y,++v!=2&&v!=4||N++}if(v!=4)return;break}if(H()==":"){if(W++,!H())return}else if(H())return;O[N++]=h}else{if(Y!==null)return;W++,Y=++N}}if(Y!==null)for(b=N-Y,N=7;N!=0&&b>0;)R=O[N],O[N--]=O[Y+b-1],O[Y+--b]=R;else if(N!=8)return;return O}(_b(n,1,-1)),!i))return qv;this.host=i}else if(this.isSpecial()){if(n=Ype(n),Kd(dme,n)||(i=function(l){var h,p,v,y,S,b,R,O=sme(l,".");if(O.length&&O[O.length-1]==""&&O.length--,(h=O.length)>4)return l;for(p=[],v=0;v<h;v++){if((y=O[v])=="")return l;if(S=10,y.length>1&&rd(y,0)=="0"&&(S=Kd(cme,y)?16:8,y=_b(y,S==8?1:2)),y==="")b=0;else{if(!Kd(S==10?lme:S==8?ume:EW,y))return l;b=HA(y,S)}xE(p,b)}for(v=0;v<h;v++)if(b=p[v],v==h-1){if(b>=vW(256,5-h))return null}else if(b>255)return null;for(R=rme(p),v=0;v<p.length;v++)R+=p[v]*vW(256,3-v);return R}(n),i===null))return qv;this.host=i}else{if(Kd(hme,n))return qv;for(i="",s=LE(n),c=0;c<s.length;c++)i+=Vm(s[c],qA);this.host=i}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return FL($A,this.scheme)},shortenPath:function(){var n=this.path,i=n.length;!i||this.scheme=="file"&&i==1&&Eb(n[0],!0)||n.length--},serialize:function(){var n=this,i=n.scheme,s=n.username,c=n.password,l=n.host,h=n.port,p=n.path,v=n.query,y=n.fragment,S=i+":";return l!==null?(S+="//",n.includesCredentials()&&(S+=s+(c?":"+c:"")+"@"),S+=yb(l),h!==null&&(S+=":"+h)):i=="file"&&(S+="//"),S+=n.cannotBeABaseURL?p[0]:p.length?"/"+vb(p,"/"):"",v!==null&&(S+="?"+v),y!==null&&(S+="#"+y),S},setHref:function(n){var i=this.parse(n);if(i)throw BL(i);this.searchParams.update()},getOrigin:function(){var n=this.scheme,i=this.port;if(n=="blob")try{return new UE(n.path[0]).origin}catch{return"null"}return n!="file"&&this.isSpecial()?n+"://"+yb(this.host)+(i!==null?":"+i:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(n){this.parse(sp(n)+":",KL)},getUsername:function(){return this.username},setUsername:function(n){var i=LE(sp(n));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<i.length;s++)this.username+=Vm(i[s],HL)}},getPassword:function(){return this.password},setPassword:function(n){var i=LE(sp(n));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<i.length;s++)this.password+=Vm(i[s],HL)}},getHost:function(){var n=this.host,i=this.port;return n===null?"":i===null?yb(n):yb(n)+":"+i},setHost:function(n){this.cannotBeABaseURL||this.parse(n,YL)},getHostname:function(){var n=this.host;return n===null?"":yb(n)},setHostname:function(n){this.cannotBeABaseURL||this.parse(n,XL)},getPort:function(){var n=this.port;return n===null?"":sp(n)},setPort:function(n){this.cannotHaveUsernamePasswordPort()||((n=sp(n))==""?this.port=null:this.parse(n,JL))},getPathname:function(){var n=this.path;return this.cannotBeABaseURL?n[0]:n.length?"/"+vb(n,"/"):""},setPathname:function(n){this.cannotBeABaseURL||(this.path=[],this.parse(n,ME))},getSearch:function(){var n=this.query;return n?"?"+n:""},setSearch:function(n){(n=sp(n))==""?this.query=null:(rd(n,0)=="?"&&(n=_b(n,1)),this.query="",this.parse(n,$v)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var n=this.fragment;return n?"#"+n:""},setHash:function(n){(n=sp(n))!=""?(rd(n,0)=="#"&&(n=_b(n,1)),this.fragment="",this.parse(n,op)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var UE=function(n){var i=qpe(this,uu),s=Jpe(arguments.length,1)>1?arguments[1]:void 0,c=Qpe(i,new ex(n,!1,s));UL||(i.href=c.serialize(),i.origin=c.getOrigin(),i.protocol=c.getProtocol(),i.username=c.getUsername(),i.password=c.getPassword(),i.host=c.getHost(),i.hostname=c.getHostname(),i.port=c.getPort(),i.pathname=c.getPathname(),i.search=c.getSearch(),i.searchParams=c.getSearchParams(),i.hash=c.getHash())},uu=UE.prototype,id=function(n,i){return{get:function(){return GA(this)[n]()},set:i&&function(s){return GA(this)[i](s)},configurable:!0,enumerable:!0}};if(UL&&(nd(uu,"href",id("serialize","setHref")),nd(uu,"origin",id("getOrigin")),nd(uu,"protocol",id("getProtocol","setProtocol")),nd(uu,"username",id("getUsername","setUsername")),nd(uu,"password",id("getPassword","setPassword")),nd(uu,"host",id("getHost","setHost")),nd(uu,"hostname",id("getHostname","setHostname")),nd(uu,"port",id("getPort","setPort")),nd(uu,"pathname",id("getPathname","setPathname")),nd(uu,"search",id("getSearch","setSearch")),nd(uu,"searchParams",id("getSearchParams")),nd(uu,"hash",id("getHash","setHash"))),zA(uu,"toJSON",function(){return GA(this).serialize()},{enumerable:!0}),zA(uu,"toString",function(){return GA(this).serialize()},{enumerable:!0}),gb){var PW=gb.createObjectURL,NW=gb.revokeObjectURL;PW&&zA(UE,"createObjectURL",pW(PW,gb)),NW&&zA(UE,"revokeObjectURL",pW(NW,gb))}Xpe(UE,"URL"),Hpe({global:!0,forced:!Kpe,sham:!UL},{URL:UE});var vme=cn,_me=u,yme=Ho,DW=Cc,Eme=TL,LW=Kt("URL");vme({target:"URL",stat:!0,forced:!(Eme&&_me(function(){LW.canParse()}))},{canParse:function(n){var i=yme(arguments.length,1),s=DW(n),c=i<2||arguments[1]===void 0?void 0:DW(arguments[1]);try{return!!new LW(s,c)}catch{return!1}}});var JA=a(ct.URL);let xW=!0,MW=!0;function QA(n,i,s){const c=n.match(i);return c&&c.length>=s&&parseInt(c[s],10)}function Yv(n,i,s){if(!n.RTCPeerConnection)return;const c=n.RTCPeerConnection.prototype,l=c.addEventListener;c.addEventListener=function(p,v){if(p!==i)return l.apply(this,arguments);const y=S=>{const b=s(S);b&&(v.handleEvent?v.handleEvent(b):v(b))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(v,y),l.apply(this,[p,y])};const h=c.removeEventListener;c.removeEventListener=function(p,v){if(p!==i||!this._eventMap||!this._eventMap[i])return h.apply(this,arguments);if(!this._eventMap[i].has(v))return h.apply(this,arguments);const y=this._eventMap[i].get(v);return this._eventMap[i].delete(v),this._eventMap[i].size===0&&delete this._eventMap[i],Object.keys(this._eventMap).length===0&&delete this._eventMap,h.apply(this,[p,y])},Object.defineProperty(c,"on"+i,{get(){return this["_on"+i]},set(p){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),p&&this.addEventListener(i,this["_on"+i]=p)},enumerable:!0,configurable:!0})}function Sme(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(xW=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function Tme(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(MW=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function UW(){if(typeof window=="object"){if(xW)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function tx(n,i){MW&&console.warn(n+" is deprecated, please use "+i+" instead.")}function VW(n){return Object.prototype.toString.call(n)==="[object Object]"}function FW(n){var i;return VW(n)?nu(i=Object.keys(n)).call(i,function(s,c){const l=VW(n[c]),h=l?FW(n[c]):n[c],p=l&&!Object.keys(h).length;return h===void 0||p?s:Object.assign(s,{[c]:h})},{}):n}function nx(n,i,s){i&&!s.has(i.id)&&(s.set(i.id,i),Object.keys(i).forEach(c=>{c.endsWith("Id")?nx(n,n.get(i[c]),s):c.endsWith("Ids")&&i[c].forEach(l=>{nx(n,n.get(l),s)})}))}function jW(n,i,s){const c=s?"outbound-rtp":"inbound-rtp",l=new Map;if(i===null)return l;const h=[];return n.forEach(p=>{p.type==="track"&&p.trackIdentifier===i.id&&h.push(p)}),h.forEach(p=>{n.forEach(v=>{v.type===c&&v.trackId===p.id&&nx(n,v,l)})}),l}const BW=UW;function WW(n,i){const s=n&&n.navigator;if(!s.mediaDevices)return;const c=function(p){if(typeof p!="object"||p.mandatory||p.optional)return p;const v={};return Object.keys(p).forEach(y=>{if(y==="require"||y==="advanced"||y==="mediaSource")return;const S=typeof p[y]=="object"?p[y]:{ideal:p[y]};S.exact!==void 0&&typeof S.exact=="number"&&(S.min=S.max=S.exact);const b=function(R,O){return R?R+O.charAt(0).toUpperCase()+O.slice(1):O==="deviceId"?"sourceId":O};if(S.ideal!==void 0){v.optional=v.optional||[];let R={};typeof S.ideal=="number"?(R[b("min",y)]=S.ideal,v.optional.push(R),R={},R[b("max",y)]=S.ideal,v.optional.push(R)):(R[b("",y)]=S.ideal,v.optional.push(R))}S.exact!==void 0&&typeof S.exact!="number"?(v.mandatory=v.mandatory||{},v.mandatory[b("",y)]=S.exact):["min","max"].forEach(R=>{S[R]!==void 0&&(v.mandatory=v.mandatory||{},v.mandatory[b(R,y)]=S[R])})}),p.advanced&&(v.optional=(v.optional||[]).concat(p.advanced)),v},l=function(p,v){if(i.version>=61)return v(p);if((p=JSON.parse(JSON.stringify(p)))&&typeof p.audio=="object"){const y=function(S,b,R){b in S&&!(R in S)&&(S[R]=S[b],delete S[b])};y((p=JSON.parse(JSON.stringify(p))).audio,"autoGainControl","googAutoGainControl"),y(p.audio,"noiseSuppression","googNoiseSuppression"),p.audio=c(p.audio)}if(p&&typeof p.video=="object"){let y=p.video.facingMode;y=y&&(typeof y=="object"?y:{ideal:y});const S=i.version<66;if(y&&(y.exact==="user"||y.exact==="environment"||y.ideal==="user"||y.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||S)){let b;if(delete p.video.facingMode,y.exact==="environment"||y.ideal==="environment"?b=["back","rear"]:y.exact!=="user"&&y.ideal!=="user"||(b=["front"]),b)return s.mediaDevices.enumerateDevices().then(R=>{let O=(R=R.filter(N=>N.kind==="videoinput")).find(N=>b.some(Y=>{var W;return dt(W=N.label.toLowerCase()).call(W,Y)}));return!O&&R.length&&dt(b).call(b,"back")&&(O=R[R.length-1]),O&&(p.video.deviceId=y.exact?{exact:O.deviceId}:{ideal:O.deviceId}),p.video=c(p.video),BW("chrome: "+JSON.stringify(p)),v(p)})}p.video=c(p.video)}return BW("chrome: "+JSON.stringify(p)),v(p)},h=function(p){return i.version>=64?p:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[p.name]||p.name,message:p.message,constraint:p.constraint||p.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(p,v,y){l(p,S=>{s.webkitGetUserMedia(S,v,b=>{y&&y(h(b))})})}).bind(s),s.mediaDevices.getUserMedia){const p=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(v){return l(v,y=>p(y).then(S=>{if(y.audio&&!S.getAudioTracks().length||y.video&&!S.getVideoTracks().length)throw S.getTracks().forEach(b=>{b.stop()}),new DOMException("","NotFoundError");return S},S=>pt.reject(h(S))))}}}function zW(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function GW(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const i=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",c=>{let l;l=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(p=>p.track&&p.track.id===c.track.id):{track:c.track};const h=new Event("track");h.track=c.track,h.receiver=l,h.transceiver={receiver:l},h.streams=[s.stream],this.dispatchEvent(h)}),s.stream.getTracks().forEach(c=>{let l;l=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(p=>p.track&&p.track.id===c.id):{track:c};const h=new Event("track");h.track=c,h.receiver=l,h.transceiver={receiver:l},h.streams=[s.stream],this.dispatchEvent(h)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else Yv(n,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function HW(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const i=function(l,h){return{track:h,get dtmf(){return this._dtmf===void 0&&(h.kind==="audio"?this._dtmf=l.createDTMFSender(h):this._dtmf=null),this._dtmf},_pc:l}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const l=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(p,v){let y=l.apply(this,arguments);return y||(y=i(this,p),this._senders.push(y)),y};const h=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(p){h.apply(this,arguments);const v=this._senders.indexOf(p);v!==-1&&this._senders.splice(v,1)}}const s=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],s.apply(this,[l]),l.getTracks().forEach(h=>{this._senders.push(i(this,h))})};const c=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],c.apply(this,[l]),l.getTracks().forEach(h=>{const p=this._senders.find(v=>v.track===h);p&&this._senders.splice(this._senders.indexOf(p),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const i=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const s=i.apply(this,[]);return s.forEach(c=>c._pc=this),s},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function KW(n){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,c,l]=arguments;if(arguments.length>0&&typeof s=="function")return i.apply(this,arguments);if(i.length===0&&(arguments.length===0||typeof s!="function"))return i.apply(this,[]);const h=function(v){const y={};return v.result().forEach(S=>{const b={id:S.id,timestamp:S.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[S.type]||S.type};S.names().forEach(R=>{b[R]=S.stat(R)}),y[b.id]=b}),y},p=function(v){return new Map(Object.keys(v).map(y=>[y,v[y]]))};if(arguments.length>=2){const v=function(y){c(p(h(y)))};return i.apply(this,[v,s])}return new pt((v,y)=>{i.apply(this,[function(S){v(p(h(S)))},y])}).then(c,l)}}function qW(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const s=n.RTCPeerConnection.prototype.getSenders;s&&(n.RTCPeerConnection.prototype.getSenders=function(){const l=s.apply(this,[]);return l.forEach(h=>h._pc=this),l});const c=n.RTCPeerConnection.prototype.addTrack;c&&(n.RTCPeerConnection.prototype.addTrack=function(){const l=c.apply(this,arguments);return l._pc=this,l}),n.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(h=>jW(h,l.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const s=n.RTCPeerConnection.prototype.getReceivers;s&&(n.RTCPeerConnection.prototype.getReceivers=function(){const c=s.apply(this,[]);return c.forEach(l=>l._pc=this),c}),Yv(n,"track",c=>(c.receiver._pc=c.srcElement,c)),n.RTCRtpReceiver.prototype.getStats=function(){const c=this;return this._pc.getStats().then(l=>jW(l,c.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype)||!("getStats"in n.RTCRtpReceiver.prototype))return;const i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const s=arguments[0];let c,l,h;return this.getSenders().forEach(p=>{p.track===s&&(c?h=!0:c=p)}),this.getReceivers().forEach(p=>(p.track===s&&(l?h=!0:l=p),p.track===s)),h||c&&l?pt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):c?c.getStats():l?l.getStats():pt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function $W(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(h=>this._shimmedLocalStreams[h][0])};const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(h,p){if(!p)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const v=i.apply(this,arguments);return this._shimmedLocalStreams[p.id]?this._shimmedLocalStreams[p.id].indexOf(v)===-1&&this._shimmedLocalStreams[p.id].push(v):this._shimmedLocalStreams[p.id]=[p,v],v};const s=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(h){this._shimmedLocalStreams=this._shimmedLocalStreams||{},h.getTracks().forEach(y=>{if(this.getSenders().find(b=>b.track===y))throw new DOMException("Track already exists.","InvalidAccessError")});const p=this.getSenders();s.apply(this,arguments);const v=this.getSenders().filter(y=>p.indexOf(y)===-1);this._shimmedLocalStreams[h.id]=[h].concat(v)};const c=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[h.id],c.apply(this,arguments)};const l=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},h&&Object.keys(this._shimmedLocalStreams).forEach(p=>{const v=this._shimmedLocalStreams[p].indexOf(h);v!==-1&&this._shimmedLocalStreams[p].splice(v,1),this._shimmedLocalStreams[p].length===1&&delete this._shimmedLocalStreams[p]}),l.apply(this,arguments)}}function YW(n,i){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&i.version>=65)return $W(n);const s=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const y=s.apply(this);return this._reverseStreams=this._reverseStreams||{},y.map(S=>this._reverseStreams[S.id])};const c=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(y){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(S=>{if(this.getSenders().find(R=>R.track===S))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){const S=new n.MediaStream(y.getTracks());this._streams[y.id]=S,this._reverseStreams[S.id]=y,y=S}c.apply(this,[y])};const l=n.RTCPeerConnection.prototype.removeStream;function h(y,S){let b=S.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const O=y._reverseStreams[R],N=y._streams[O.id];b=b.replace(new RegExp(N.id,"g"),O.id)}),new RTCSessionDescription({type:S.type,sdp:b})}n.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},n.RTCPeerConnection.prototype.addTrack=function(y,S){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(N=>N===y))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(N=>N.track===y))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const O=this._streams[S.id];if(O)O.addTrack(y),pt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const N=new n.MediaStream([y]);this._streams[S.id]=N,this._reverseStreams[N.id]=S,this.addStream(N)}return this.getSenders().find(N=>N.track===y)},["createOffer","createAnswer"].forEach(function(y){const S=n.RTCPeerConnection.prototype[y],b={[y](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?S.apply(this,[O=>{const N=h(this,O);R[0].apply(null,[N])},O=>{R[1]&&R[1].apply(null,O)},arguments[2]]):S.apply(this,arguments).then(O=>h(this,O))}};n.RTCPeerConnection.prototype[y]=b[y]});const p=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(y,S){let b=S.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const O=y._reverseStreams[R],N=y._streams[O.id];b=b.replace(new RegExp(O.id,"g"),N.id)}),new RTCSessionDescription({type:S.type,sdp:b})}(this,arguments[0]),p.apply(this,arguments)):p.apply(this,arguments)};const v=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const y=v.get.apply(this);return y.type===""?y:h(this,y)}}),n.RTCPeerConnection.prototype.removeTrack=function(y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let S;this._streams=this._streams||{},Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(R=>y.track===R)&&(S=this._streams[b])}),S&&(S.getTracks().length===1?this.removeStream(this._reverseStreams[S.id]):S.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function rx(n,i){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const c=n.RTCPeerConnection.prototype[s],l={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=l[s]})}function XW(n,i){Yv(n,"negotiationneeded",s=>{const c=s.target;if(!(i.version<72||c.getConfiguration&&c.getConfiguration().sdpSemantics==="plan-b")||c.signalingState==="stable")return s})}var JW=Object.freeze({__proto__:null,fixNegotiationNeeded:XW,shimAddTrackRemoveTrack:YW,shimAddTrackRemoveTrackWithNative:$W,shimGetDisplayMedia:function(n,i){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(typeof i=="function"?n.navigator.mediaDevices.getDisplayMedia=function(s){return i(s).then(c=>{const l=s.video&&s.video.width,h=s.video&&s.video.height,p=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:c,maxFrameRate:p||3}},l&&(s.video.mandatory.maxWidth=l),h&&(s.video.mandatory.maxHeight=h),n.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:HW,shimGetStats:KW,shimGetUserMedia:WW,shimMediaStream:zW,shimOnTrack:GW,shimPeerConnection:rx,shimSenderReceiverGetStats:qW});function QW(n,i){const s=n&&n.navigator,c=n&&n.MediaStreamTrack;if(s.getUserMedia=function(l,h,p){tx("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(l).then(h,p)},!(i.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const l=function(p,v,y){v in p&&!(y in p)&&(p[y]=p[v],delete p[v])},h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(p){return typeof p=="object"&&typeof p.audio=="object"&&(p=JSON.parse(JSON.stringify(p)),l(p.audio,"autoGainControl","mozAutoGainControl"),l(p.audio,"noiseSuppression","mozNoiseSuppression")),h(p)},c&&c.prototype.getSettings){const p=c.prototype.getSettings;c.prototype.getSettings=function(){const v=p.apply(this,arguments);return l(v,"mozAutoGainControl","autoGainControl"),l(v,"mozNoiseSuppression","noiseSuppression"),v}}if(c&&c.prototype.applyConstraints){const p=c.prototype.applyConstraints;c.prototype.applyConstraints=function(v){return this.kind==="audio"&&typeof v=="object"&&(v=JSON.parse(JSON.stringify(v)),l(v,"autoGainControl","mozAutoGainControl"),l(v,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[v])}}}}function ZW(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ix(n,i){if(typeof n!="object"||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(l){const h=n.RTCPeerConnection.prototype[l],p={[l](){return arguments[0]=new(l==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),h.apply(this,arguments)}};n.RTCPeerConnection.prototype[l]=p[l]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},c=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[l,h,p]=arguments;return c.apply(this,[l||null]).then(v=>{if(i.version<53&&!h)try{v.forEach(y=>{y.type=s[y.type]||y.type})}catch(y){if(y.name!=="TypeError")throw y;v.forEach((S,b)=>{v.set(b,Object.assign({},S,{type:s[S.type]||S.type}))})}return v}).then(h,p)}}function ez(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const i=n.RTCPeerConnection.prototype.getSenders;i&&(n.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(l=>l._pc=this),c});const s=n.RTCPeerConnection.prototype.addTrack;s&&(n.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):pt.resolve(new Map)}}function tz(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const i=n.RTCPeerConnection.prototype.getReceivers;i&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(c=>c._pc=this),s}),Yv(n,"track",s=>(s.receiver._pc=s.srcElement,s)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function nz(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(i){tx("removeStream","removeTrack"),this.getSenders().forEach(s=>{var c;s.track&&dt(c=i.getTracks()).call(c,s.track)&&this.removeTrack(s)})})}function rz(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function iz(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.addTransceiver;i&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const c=s.length>0;c&&s.forEach(h=>{if("rid"in h&&!/^[a-z0-9]{0,16}$/i.test(h.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in h&&!(parseFloat(h.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in h&&!(parseFloat(h.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=i.apply(this,arguments);if(c){const{sender:h}=l,p=h.getParameters();(!("encodings"in p)||p.encodings.length===1&&Object.keys(p.encodings[0]).length===0)&&(p.encodings=s,h.sendEncodings=s,this.setParametersPromises.push(h.setParameters(p).then(()=>{delete h.sendEncodings}).catch(()=>{delete h.sendEncodings})))}return l})}function sz(n){if(typeof n!="object"||!n.RTCRtpSender)return;const i=n.RTCRtpSender.prototype.getParameters;i&&(n.RTCRtpSender.prototype.getParameters=function(){const s=i.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function oz(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?pt.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function az(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?pt.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}var cz=Object.freeze({__proto__:null,shimAddTransceiver:iz,shimCreateAnswer:az,shimCreateOffer:oz,shimGetDisplayMedia:function(n,i){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const c=new DOMException("getDisplayMedia without video constraints is undefined");return c.name="NotFoundError",c.code=8,pt.reject(c)}return s.video===!0?s.video={mediaSource:i}:s.video.mediaSource=i,n.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:sz,shimGetUserMedia:QW,shimOnTrack:ZW,shimPeerConnection:ix,shimRTCDataChannel:rz,shimReceiverGetStats:tz,shimRemoveStream:nz,shimSenderGetStats:ez});function uz(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(s){var c;this._localStreams||(this._localStreams=[]),dt(c=this._localStreams).call(c,s)||this._localStreams.push(s),s.getAudioTracks().forEach(l=>i.call(this,l,s)),s.getVideoTracks().forEach(l=>i.call(this,l,s))},n.RTCPeerConnection.prototype.addTrack=function(s){for(var c=arguments.length,l=new Array(c>1?c-1:0),h=1;h<c;h++)l[h-1]=arguments[h];return l&&l.forEach(p=>{var v;this._localStreams?dt(v=this._localStreams).call(v,p)||this._localStreams.push(p):this._localStreams=[p]}),i.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(i);if(s===-1)return;this._localStreams.splice(s,1);const c=i.getTracks();this.getSenders().forEach(l=>{dt(c).call(c,l.track)&&this.removeTrack(l)})})}}function lz(n){if(typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=c=>{c.streams.forEach(l=>{var h;if(this._remoteStreams||(this._remoteStreams=[]),dt(h=this._remoteStreams).call(h,l))return;this._remoteStreams.push(l);const p=new Event("addstream");p.stream=l,this.dispatchEvent(p)})})}});const i=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(c){c.streams.forEach(l=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(l)>=0)return;s._remoteStreams.push(l);const h=new Event("addstream");h.stream=l,s.dispatchEvent(h)})}),i.apply(s,arguments)}}}function dz(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,s=i.createOffer,c=i.createAnswer,l=i.setLocalDescription,h=i.setRemoteDescription,p=i.addIceCandidate;i.createOffer=function(y,S){const b=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[b]);return S?(R.then(y,S),pt.resolve()):R},i.createAnswer=function(y,S){const b=arguments.length>=2?arguments[2]:arguments[0],R=c.apply(this,[b]);return S?(R.then(y,S),pt.resolve()):R};let v=function(y,S,b){const R=l.apply(this,[y]);return b?(R.then(S,b),pt.resolve()):R};i.setLocalDescription=v,v=function(y,S,b){const R=h.apply(this,[y]);return b?(R.then(S,b),pt.resolve()):R},i.setRemoteDescription=v,v=function(y,S,b){const R=p.apply(this,[y]);return b?(R.then(S,b),pt.resolve()):R},i.addIceCandidate=v}function hz(n){const i=n&&n.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const s=i.mediaDevices,c=s.getUserMedia.bind(s);i.mediaDevices.getUserMedia=l=>c(fz(l))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=(function(s,c,l){i.mediaDevices.getUserMedia(s).then(c,l)}).bind(i))}function fz(n){return n&&n.video!==void 0?Object.assign({},n,{video:FW(n.video)}):n}function pz(n){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection;n.RTCPeerConnection=function(s,c){if(s&&s.iceServers){const l=[];for(let h=0;h<s.iceServers.length;h++){let p=s.iceServers[h];!p.hasOwnProperty("urls")&&p.hasOwnProperty("url")?(tx("RTCIceServer.url","RTCIceServer.urls"),p=JSON.parse(JSON.stringify(p)),p.urls=p.url,delete p.url,l.push(p)):l.push(s.iceServers[h])}s.iceServers=l}return new i(s,c)},n.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function mz(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gz(n){const i=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const c=this.getTransceivers().find(h=>h.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveAudio!==!0||c||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const l=this.getTransceivers().find(h=>h.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):s.offerToReceiveVideo!==!0||l||this.addTransceiver("video",{direction:"recvonly"})}return i.apply(this,arguments)}}function vz(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var _z=Object.freeze({__proto__:null,shimAudioContext:vz,shimCallbacksAPI:dz,shimConstraints:fz,shimCreateOfferLegacy:gz,shimGetUserMedia:hz,shimLocalStreamsAPI:uz,shimRTCIceServerUrls:pz,shimRemoteStreamsAPI:lz,shimTrackEventTransceiver:mz}),yz=`	
\v\f\r \u2028\u2029\uFEFF`,bme=Pt,wme=Cc,sx=yz,Ez=C("".replace),Cme=RegExp("^["+sx+"]+"),Rme=RegExp("(^|[^"+sx+"])["+sx+"]+$"),Ime=function(n){return function(i){var s=wme(bme(i));return 1&n&&(s=Ez(s,Cme,"")),2&n&&(s=Ez(s,Rme,"$1")),s}},Ame={trim:Ime(3)},kme=V0.PROPER,Ome=u,Sz=yz,Pme=Ame.trim;cn({target:"String",proto:!0,forced:function(n){return Ome(function(){return!!Sz[n]()||""[n]()!==""||kme&&Sz[n].name!==n})}("trim")},{trim:function(){return Pme(this)}});var Nme=tu("String").trim,Dme=I,Lme=Nme,ox=String.prototype,xme=function(n){var i=n.trim;return typeof n=="string"||n===ox||Dme(ox,n)&&i===ox.trim?Lme:i},ha=a(xme),Tz={exports:{}};(function(n){const i={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};i.localCName=i.generateIdentifier(),i.splitLines=function(s){return s.trim().split(`
`).map(c=>c.trim())},i.splitSections=function(s){return s.split(`
m=`).map((c,l)=>(l>0?"m="+c:c).trim()+`\r
`)},i.getDescription=function(s){const c=i.splitSections(s);return c&&c[0]},i.getMediaSections=function(s){const c=i.splitSections(s);return c.shift(),c},i.matchPrefix=function(s,c){return i.splitLines(s).filter(l=>l.indexOf(c)===0)},i.parseCandidate=function(s){let c;c=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const l={foundation:c[0],component:{1:"rtp",2:"rtcp"}[c[1]]||c[1],protocol:c[2].toLowerCase(),priority:parseInt(c[3],10),ip:c[4],address:c[4],port:parseInt(c[5],10),type:c[7]};for(let h=8;h<c.length;h+=2)switch(c[h]){case"raddr":l.relatedAddress=c[h+1];break;case"rport":l.relatedPort=parseInt(c[h+1],10);break;case"tcptype":l.tcpType=c[h+1];break;case"ufrag":l.ufrag=c[h+1],l.usernameFragment=c[h+1];break;default:l[c[h]]===void 0&&(l[c[h]]=c[h+1])}return l},i.writeCandidate=function(s){const c=[];c.push(s.foundation);const l=s.component;l==="rtp"?c.push(1):l==="rtcp"?c.push(2):c.push(l),c.push(s.protocol.toUpperCase()),c.push(s.priority),c.push(s.address||s.ip),c.push(s.port);const h=s.type;return c.push("typ"),c.push(h),h!=="host"&&s.relatedAddress&&s.relatedPort&&(c.push("raddr"),c.push(s.relatedAddress),c.push("rport"),c.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(c.push("tcptype"),c.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(c.push("ufrag"),c.push(s.usernameFragment||s.ufrag)),"candidate:"+c.join(" ")},i.parseIceOptions=function(s){return s.substring(14).split(" ")},i.parseRtpMap=function(s){let c=s.substring(9).split(" ");const l={payloadType:parseInt(c.shift(),10)};return c=c[0].split("/"),l.name=c[0],l.clockRate=parseInt(c[1],10),l.channels=c.length===3?parseInt(c[2],10):1,l.numChannels=l.channels,l},i.writeRtpMap=function(s){let c=s.payloadType;s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType);const l=s.channels||s.numChannels||1;return"a=rtpmap:"+c+" "+s.name+"/"+s.clockRate+(l!==1?"/"+l:"")+`\r
`},i.parseExtmap=function(s){const c=s.substring(9).split(" ");return{id:parseInt(c[0],10),direction:c[0].indexOf("/")>0?c[0].split("/")[1]:"sendrecv",uri:c[1],attributes:c.slice(2).join(" ")}},i.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},i.parseFmtp=function(s){const c={};let l;const h=s.substring(s.indexOf(" ")+1).split(";");for(let p=0;p<h.length;p++)l=h[p].trim().split("="),c[l[0].trim()]=l[1];return c},i.writeFmtp=function(s){let c="",l=s.payloadType;if(s.preferredPayloadType!==void 0&&(l=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const h=[];Object.keys(s.parameters).forEach(p=>{s.parameters[p]!==void 0?h.push(p+"="+s.parameters[p]):h.push(p)}),c+="a=fmtp:"+l+" "+h.join(";")+`\r
`}return c},i.parseRtcpFb=function(s){const c=s.substring(s.indexOf(" ")+1).split(" ");return{type:c.shift(),parameter:c.join(" ")}},i.writeRtcpFb=function(s){let c="",l=s.payloadType;return s.preferredPayloadType!==void 0&&(l=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(h=>{c+="a=rtcp-fb:"+l+" "+h.type+(h.parameter&&h.parameter.length?" "+h.parameter:"")+`\r
`}),c},i.parseSsrcMedia=function(s){const c=s.indexOf(" "),l={ssrc:parseInt(s.substring(7,c),10)},h=s.indexOf(":",c);return h>-1?(l.attribute=s.substring(c+1,h),l.value=s.substring(h+1)):l.attribute=s.substring(c+1),l},i.parseSsrcGroup=function(s){const c=s.substring(13).split(" ");return{semantics:c.shift(),ssrcs:c.map(l=>parseInt(l,10))}},i.getMid=function(s){const c=i.matchPrefix(s,"a=mid:")[0];if(c)return c.substring(6)},i.parseFingerprint=function(s){const c=s.substring(14).split(" ");return{algorithm:c[0].toLowerCase(),value:c[1].toUpperCase()}},i.getDtlsParameters=function(s,c){return{role:"auto",fingerprints:i.matchPrefix(s+c,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(s,c){let l="a=setup:"+c+`\r
`;return s.fingerprints.forEach(h=>{l+="a=fingerprint:"+h.algorithm+" "+h.value+`\r
`}),l},i.parseCryptoLine=function(s){const c=s.substring(9).split(" ");return{tag:parseInt(c[0],10),cryptoSuite:c[1],keyParams:c[2],sessionParams:c.slice(3)}},i.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?i.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},i.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const c=s.substring(7).split("|");return{keyMethod:"inline",keySalt:c[0],lifeTime:c[1],mkiValue:c[2]?c[2].split(":")[0]:void 0,mkiLength:c[2]?c[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},i.getCryptoParameters=function(s,c){return i.matchPrefix(s+c,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(s,c){const l=i.matchPrefix(s+c,"a=ice-ufrag:")[0],h=i.matchPrefix(s+c,"a=ice-pwd:")[0];return l&&h?{usernameFragment:l.substring(12),password:h.substring(10)}:null},i.writeIceParameters=function(s){let c="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(c+=`a=ice-lite\r
`),c},i.parseRtpParameters=function(s){const c={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=i.splitLines(s)[0].split(" ");c.profile=l[2];for(let p=3;p<l.length;p++){const v=l[p],y=i.matchPrefix(s,"a=rtpmap:"+v+" ")[0];if(y){const S=i.parseRtpMap(y),b=i.matchPrefix(s,"a=fmtp:"+v+" ");switch(S.parameters=b.length?i.parseFmtp(b[0]):{},S.rtcpFeedback=i.matchPrefix(s,"a=rtcp-fb:"+v+" ").map(i.parseRtcpFb),c.codecs.push(S),S.name.toUpperCase()){case"RED":case"ULPFEC":c.fecMechanisms.push(S.name.toUpperCase())}}}i.matchPrefix(s,"a=extmap:").forEach(p=>{c.headerExtensions.push(i.parseExtmap(p))});const h=i.matchPrefix(s,"a=rtcp-fb:* ").map(i.parseRtcpFb);return c.codecs.forEach(p=>{h.forEach(v=>{p.rtcpFeedback.find(y=>y.type===v.type&&y.parameter===v.parameter)||p.rtcpFeedback.push(v)})}),c},i.writeRtpDescription=function(s,c){let l="";l+="m="+s+" ",l+=c.codecs.length>0?"9":"0",l+=" "+(c.profile||"UDP/TLS/RTP/SAVPF")+" ",l+=c.codecs.map(p=>p.preferredPayloadType!==void 0?p.preferredPayloadType:p.payloadType).join(" ")+`\r
`,l+=`c=IN IP4 0.0.0.0\r
`,l+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,c.codecs.forEach(p=>{l+=i.writeRtpMap(p),l+=i.writeFmtp(p),l+=i.writeRtcpFb(p)});let h=0;return c.codecs.forEach(p=>{p.maxptime>h&&(h=p.maxptime)}),h>0&&(l+="a=maxptime:"+h+`\r
`),c.headerExtensions&&c.headerExtensions.forEach(p=>{l+=i.writeExtmap(p)}),l},i.parseRtpEncodingParameters=function(s){const c=[],l=i.parseRtpParameters(s),h=l.fecMechanisms.indexOf("RED")!==-1,p=l.fecMechanisms.indexOf("ULPFEC")!==-1,v=i.matchPrefix(s,"a=ssrc:").map(O=>i.parseSsrcMedia(O)).filter(O=>O.attribute==="cname"),y=v.length>0&&v[0].ssrc;let S;const b=i.matchPrefix(s,"a=ssrc-group:FID").map(O=>O.substring(17).split(" ").map(N=>parseInt(N,10)));b.length>0&&b[0].length>1&&b[0][0]===y&&(S=b[0][1]),l.codecs.forEach(O=>{if(O.name.toUpperCase()==="RTX"&&O.parameters.apt){let N={ssrc:y,codecPayloadType:parseInt(O.parameters.apt,10)};y&&S&&(N.rtx={ssrc:S}),c.push(N),h&&(N=JSON.parse(JSON.stringify(N)),N.fec={ssrc:y,mechanism:p?"red+ulpfec":"red"},c.push(N))}}),c.length===0&&y&&c.push({ssrc:y});let R=i.matchPrefix(s,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,c.forEach(O=>{O.maxBitrate=R})),c},i.parseRtcpParameters=function(s){const c={},l=i.matchPrefix(s,"a=ssrc:").map(v=>i.parseSsrcMedia(v)).filter(v=>v.attribute==="cname")[0];l&&(c.cname=l.value,c.ssrc=l.ssrc);const h=i.matchPrefix(s,"a=rtcp-rsize");c.reducedSize=h.length>0,c.compound=h.length===0;const p=i.matchPrefix(s,"a=rtcp-mux");return c.mux=p.length>0,c},i.writeRtcpParameters=function(s){let c="";return s.reducedSize&&(c+=`a=rtcp-rsize\r
`),s.mux&&(c+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(c+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),c},i.parseMsid=function(s){let c;const l=i.matchPrefix(s,"a=msid:");if(l.length===1)return c=l[0].substring(7).split(" "),{stream:c[0],track:c[1]};const h=i.matchPrefix(s,"a=ssrc:").map(p=>i.parseSsrcMedia(p)).filter(p=>p.attribute==="msid");return h.length>0?(c=h[0].value.split(" "),{stream:c[0],track:c[1]}):void 0},i.parseSctpDescription=function(s){const c=i.parseMLine(s),l=i.matchPrefix(s,"a=max-message-size:");let h;l.length>0&&(h=parseInt(l[0].substring(19),10)),isNaN(h)&&(h=65536);const p=i.matchPrefix(s,"a=sctp-port:");if(p.length>0)return{port:parseInt(p[0].substring(12),10),protocol:c.fmt,maxMessageSize:h};const v=i.matchPrefix(s,"a=sctpmap:");if(v.length>0){const y=v[0].substring(10).split(" ");return{port:parseInt(y[0],10),protocol:y[1],maxMessageSize:h}}},i.writeSctpDescription=function(s,c){let l=[];return l=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+c.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+c.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+c.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+c.port+" "+c.protocol+` 65535\r
`],c.maxMessageSize!==void 0&&l.push("a=max-message-size:"+c.maxMessageSize+`\r
`),l.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,22)},i.writeSessionBoilerplate=function(s,c,l){let h;const p=c!==void 0?c:2;return h=s||i.generateSessionId(),`v=0\r
o=`+(l||"thisisadapterortc")+" "+h+" "+p+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},i.getDirection=function(s,c){const l=i.splitLines(s);for(let h=0;h<l.length;h++)switch(l[h]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return l[h].substring(2)}return c?i.getDirection(c):"sendrecv"},i.getKind=function(s){return i.splitLines(s)[0].split(" ")[0].substring(2)},i.isRejected=function(s){return s.split(" ",2)[1]==="0"},i.parseMLine=function(s){const c=i.splitLines(s)[0].substring(2).split(" ");return{kind:c[0],port:parseInt(c[1],10),protocol:c[2],fmt:c.slice(3).join(" ")}},i.parseOLine=function(s){const c=i.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:c[0],sessionId:c[1],sessionVersion:parseInt(c[2],10),netType:c[3],addressType:c[4],address:c[5]}},i.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const c=i.splitLines(s);for(let l=0;l<c.length;l++)if(c[l].length<2||c[l].charAt(1)!=="=")return!1;return!0},n.exports=i})(Tz);var bz=Tz.exports,VE=a(bz),Mme=r({__proto__:null,default:VE},[bz]);function ZA(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const i=n.RTCIceCandidate;n.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const c=new i(s),l=VE.parseCandidate(s.candidate),h=Object.assign(c,l);return h.toJSON=function(){return{candidate:h.candidate,sdpMid:h.sdpMid,sdpMLineIndex:h.sdpMLineIndex,usernameFragment:h.usernameFragment}},h}return new i(s)},n.RTCIceCandidate.prototype=i.prototype,Yv(n,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new n.RTCIceCandidate(s.candidate),writable:"false"}),s))}function ax(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Yv(n,"icecandidate",i=>{if(i.candidate){const s=VE.parseCandidate(i.candidate.candidate);s.type==="relay"&&(i.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return i})}function ek(n,i){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(v){if(!v||!v.sdp)return!1;const y=VE.splitSections(v.sdp);return y.shift(),y.some(S=>{const b=VE.parseMLine(S);return b&&b.kind==="application"&&b.protocol.indexOf("SCTP")!==-1})},c=function(v){const y=v.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(y===null||y.length<2)return-1;const S=parseInt(y[1],10);return S!=S?-1:S},l=function(v){let y=65536;return i.browser==="firefox"&&(y=i.version<57?v===-1?16384:2147483637:i.version<60?i.version===57?65535:65536:2147483637),y},h=function(v,y){let S=65536;i.browser==="firefox"&&i.version===57&&(S=65535);const b=VE.matchPrefix(v.sdp,"a=max-message-size:");return b.length>0?S=parseInt(b[0].substr(19),10):i.browser==="firefox"&&y!==-1&&(S=2147483637),S},p=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,i.browser==="chrome"&&i.version>=76){const{sdpSemantics:v}=this.getConfiguration();v==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const v=c(arguments[0]),y=l(v),S=h(arguments[0],v);let b;b=y===0&&S===0?Number.POSITIVE_INFINITY:y===0||S===0?Math.max(y,S):Math.min(y,S);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>b}),this._sctp=R}return p.apply(this,arguments)}}function tk(n){if(!n.RTCPeerConnection||!("createDataChannel"in n.RTCPeerConnection.prototype))return;function i(c,l){const h=c.send;c.send=function(){const p=arguments[0],v=p.length||p.size||p.byteLength;if(c.readyState==="open"&&l.sctp&&v>l.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+l.sctp.maxMessageSize+" bytes)");return h.apply(c,arguments)}}const s=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const c=s.apply(this,arguments);return i(c,this),c},Yv(n,"datachannel",c=>(i(c.channel,c.target),c))}function cx(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const i=n.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const c=i[s];i[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=l=>{const h=l.target;if(h._lastConnectionState!==h.connectionState){h._lastConnectionState=h.connectionState;const p=new Event("connectionstatechange",l);h.dispatchEvent(p)}return l},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),c.apply(this,arguments)}})}function ux(n,i){if(!n.RTCPeerConnection||i.browser==="chrome"&&i.version>=71||i.browser==="safari"&&i.version>=605)return;const s=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(c){if(c&&c.sdp&&c.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const l=c.sdp.split(`
`).filter(h=>ha(h).call(h)!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&c instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:c.type,sdp:l}):c.sdp=l}return s.apply(this,arguments)}}function nk(n,i){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const s=n.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(i.browser==="chrome"&&i.version<78||i.browser==="firefox"&&i.version<68||i.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?pt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),pt.resolve())})}function rk(n,i){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const s=n.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(n.RTCPeerConnection.prototype.setLocalDescription=function(){let c=arguments[0]||{};if(typeof c!="object"||c.type&&c.sdp)return s.apply(this,arguments);if(c={type:c.type,sdp:c.sdp},!c.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":c.type="offer";break;default:c.type="answer"}return c.sdp||c.type!=="offer"&&c.type!=="answer"?s.apply(this,[c]):(c.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(l=>s.apply(this,[l]))})}var Ume=Object.freeze({__proto__:null,removeExtmapAllowMixed:ux,shimAddIceCandidateNullOrEmpty:nk,shimConnectionState:cx,shimMaxMessageSize:ek,shimParameterlessSetLocalDescription:rk,shimRTCIceCandidate:ZA,shimRTCIceCandidateRelayProtocol:ax,shimSendThrowTypeError:tk});(function(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=UW,c=function(h){const p={browser:null,version:null};if(h===void 0||!h.navigator)return p.browser="Not a browser.",p;const{navigator:v}=h;if(v.mozGetUserMedia)p.browser="firefox",p.version=QA(v.userAgent,/Firefox\/(\d+)\./,1);else if(v.webkitGetUserMedia||h.isSecureContext===!1&&h.webkitRTCPeerConnection)p.browser="chrome",p.version=QA(v.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!h.RTCPeerConnection||!v.userAgent.match(/AppleWebKit\/(\d+)\./))return p.browser="Not a supported browser.",p;p.browser="safari",p.version=QA(v.userAgent,/AppleWebKit\/(\d+)\./,1),p.supportsUnifiedPlan=h.RTCRtpTransceiver&&"currentDirection"in h.RTCRtpTransceiver.prototype}return p}(n),l={browserDetails:c,commonShim:Ume,extractVersion:QA,disableLog:Sme,disableWarnings:Tme,sdp:Mme};switch(c.browser){case"chrome":if(!JW||!rx||!i.shimChrome)return s("Chrome shim is not included in this adapter release."),l;if(c.version===null)return s("Chrome shim can not determine version, not shimming."),l;s("adapter.js shimming chrome."),l.browserShim=JW,nk(n,c),rk(n),WW(n,c),zW(n),rx(n,c),GW(n),YW(n,c),HW(n),KW(n),qW(n),XW(n,c),ZA(n),ax(n),cx(n),ek(n,c),tk(n),ux(n,c);break;case"firefox":if(!cz||!ix||!i.shimFirefox)return s("Firefox shim is not included in this adapter release."),l;s("adapter.js shimming firefox."),l.browserShim=cz,nk(n,c),rk(n),QW(n,c),ix(n,c),ZW(n),nz(n),ez(n),tz(n),rz(n),iz(n),sz(n),oz(n),az(n),ZA(n),cx(n),ek(n,c),tk(n);break;case"safari":if(!_z||!i.shimSafari)return s("Safari shim is not included in this adapter release."),l;s("adapter.js shimming safari."),l.browserShim=_z,nk(n,c),rk(n),pz(n),gz(n),dz(n),uz(n),lz(n),mz(n),hz(n),vz(n),ZA(n),ax(n),ek(n,c),tk(n),ux(n,c);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var wz=Do,Vme=TypeError,Cz=Un.match(/firefox\/(\d+)/i),Fme=!!Cz&&+Cz[1],jme=/MSIE|Trident/.test(Un),Rz=Un.match(/AppleWebKit\/(\d+)\./),Bme=!!Rz&&+Rz[1],Wme=cn,Iz=C,zme=us,Gme=Lo,Az=Ki,Hme=function(n,i){if(!delete n[i])throw Vme("Cannot delete property "+wz(i)+" of "+wz(n))},kz=Cc,lx=u,Kme=F6,qme=Ff,Oz=Fme,$me=jme,Pz=Cr,Nz=Bme,Fm=[],Dz=Iz(Fm.sort),Yme=Iz(Fm.push),Xme=lx(function(){Fm.sort(void 0)}),Jme=lx(function(){Fm.sort(null)}),Qme=qme("sort"),Lz=!lx(function(){if(Pz)return Pz<70;if(!(Oz&&Oz>3)){if($me)return!0;if(Nz)return Nz<603;var n,i,s,c,l="";for(n=65;n<76;n++){switch(i=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(c=0;c<47;c++)Fm.push({k:i+c,v:s})}for(Fm.sort(function(h,p){return p.v-h.v}),c=0;c<Fm.length;c++)i=Fm[c].k.charAt(0),l.charAt(l.length-1)!==i&&(l+=i);return l!=="DGBEFHACIJK"}});Wme({target:"Array",proto:!0,forced:Xme||!Jme||!Qme||!Lz},{sort:function(n){n!==void 0&&zme(n);var i=Gme(this);if(Lz)return n===void 0?Dz(i):Dz(i,n);var s,c,l=[],h=Az(i);for(c=0;c<h;c++)c in i&&Yme(l,i[c]);for(Kme(l,function(p){return function(v,y){return y===void 0?-1:v===void 0?1:p!==void 0?+p(v,y)||0:kz(v)>kz(y)?1:-1}}(n)),s=Az(l),c=0;c<s;)i[c]=l[c++];for(;c<h;)Hme(i,c++);return i}});var Zme=tu("Array").sort,ege=I,tge=Zme,dx=Array.prototype,nge=function(n){var i=n.sort;return n===dx||ege(dx,n)&&i===dx.sort?tge:i},Sb=a(nge),hx=L;cn({global:!0,forced:hx.globalThis!==hx},{globalThis:hx});var xz=a(L),fx={exports:{}};(function(n,i){(function(s,c){var l="function",h="undefined",p="object",v="string",y="major",S="model",b="name",R="type",O="vendor",N="version",Y="architecture",W="console",H="mobile",ne="tablet",re="smarttv",me="wearable",be="embedded",we="Amazon",Se="Apple",Le="ASUS",et="BlackBerry",mt="Browser",Et="Chrome",xn="Firefox",Mn="Google",Lr="Huawei",Vi="LG",wi="Microsoft",ac="Motorola",Ge="Opera",lt="Samsung",Rt="Sharp",Xe="Sony",U="Xiaomi",de="Zebra",ge="Facebook",it="Chromium OS",an="Mac OS",br=function(as){for(var As={},Jr=0;Jr<as.length;Jr++)As[as[Jr].toUpperCase()]=as[Jr];return As},Is=function(as,As){return typeof as===v&&Mc(As).indexOf(Mc(as))!==-1},Mc=function(as){return as.toLowerCase()},bp=function(as,As){if(typeof as===v)return as=as.replace(/^\s\s*/,""),typeof As===h?as:as.substring(0,350)},R_=function(as,As){for(var Jr,hu,tf,Fi,ir,Uc,ag=0;ag<As.length&&!ir;){var oh=As[ag],cX=As[ag+1];for(Jr=hu=0;Jr<oh.length&&!ir&&oh[Jr];)if(ir=oh[Jr++].exec(as))for(tf=0;tf<cX.length;tf++)Uc=ir[++hu],typeof(Fi=cX[tf])===p&&Fi.length>0?Fi.length===2?typeof Fi[1]==l?this[Fi[0]]=Fi[1].call(this,Uc):this[Fi[0]]=Fi[1]:Fi.length===3?typeof Fi[1]!==l||Fi[1].exec&&Fi[1].test?this[Fi[0]]=Uc?Uc.replace(Fi[1],Fi[2]):c:this[Fi[0]]=Uc?Fi[1].call(this,Uc,Fi[2]):c:Fi.length===4&&(this[Fi[0]]=Uc?Fi[3].call(this,Uc.replace(Fi[1],Fi[2])):c):this[Fi]=Uc||c;ag+=2}},ww=function(as,As){for(var Jr in As)if(typeof As[Jr]===p&&As[Jr].length>0){for(var hu=0;hu<As[Jr].length;hu++)if(Is(As[Jr][hu],as))return Jr==="?"?c:Jr}else if(Is(As[Jr],as))return Jr==="?"?c:Jr;return as},eP={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},tP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[N,[b,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[N,[b,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[b,N],[/opios[\/ ]+([\w\.]+)/i],[N,[b,Ge+" Mini"]],[/\bopr\/([\w\.]+)/i],[N,[b,Ge]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[b,N],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[N,[b,"UC"+mt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[N,[b,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[N,[b,"WeChat"]],[/konqueror\/([\w\.]+)/i],[N,[b,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[N,[b,"IE"]],[/yabrowser\/([\w\.]+)/i],[N,[b,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[b,/(.+)/,"$1 Secure "+mt],N],[/\bfocus\/([\w\.]+)/i],[N,[b,xn+" Focus"]],[/\bopt\/([\w\.]+)/i],[N,[b,Ge+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[N,[b,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[N,[b,"Dolphin"]],[/coast\/([\w\.]+)/i],[N,[b,Ge+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[N,[b,"MIUI "+mt]],[/fxios\/([-\w\.]+)/i],[N,[b,xn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[b,"360 "+mt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[b,/(.+)/,"$1 "+mt],N],[/(comodo_dragon)\/([\w\.]+)/i],[[b,/_/g," "],N],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[b,N],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[b],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[b,ge],N],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[b,N],[/\bgsa\/([\w\.]+) .*safari\//i],[N,[b,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[N,[b,Et+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[b,Et+" WebView"],N],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[N,[b,"Android "+mt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[b,N],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[N,[b,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[N,b],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[b,[N,ww,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[b,N],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[b,"Netscape"],N],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[N,[b,xn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[b,N],[/(cobalt)\/([\w\.]+)/i],[b,[N,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[Y,"amd64"]],[/(ia32(?=;))/i],[[Y,Mc]],[/((?:i[346]|x)86)[;\)]/i],[[Y,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[Y,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[Y,"armhf"]],[/windows (ce|mobile); ppc;/i],[[Y,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[Y,/ower/,"",Mc]],[/(sun4\w)[;\)]/i],[[Y,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[Y,Mc]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[S,[O,lt],[R,ne]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[S,[O,lt],[R,H]],[/\((ip(?:hone|od)[\w ]*);/i],[S,[O,Se],[R,H]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[S,[O,Se],[R,ne]],[/(macintosh);/i],[S,[O,Se]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[S,[O,Rt],[R,H]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[S,[O,Lr],[R,ne]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[S,[O,Lr],[R,H]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[S,/_/g," "],[O,U],[R,H]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[S,/_/g," "],[O,U],[R,ne]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[S,[O,"OPPO"],[R,H]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[S,[O,"Vivo"],[R,H]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[S,[O,"Realme"],[R,H]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[S,[O,ac],[R,H]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[S,[O,ac],[R,ne]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[S,[O,Vi],[R,ne]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[S,[O,Vi],[R,H]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[S,[O,"Lenovo"],[R,ne]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[S,/_/g," "],[O,"Nokia"],[R,H]],[/(pixel c)\b/i],[S,[O,Mn],[R,ne]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[S,[O,Mn],[R,H]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[S,[O,Xe],[R,H]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[S,"Xperia Tablet"],[O,Xe],[R,ne]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[S,[O,"OnePlus"],[R,H]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[S,[O,we],[R,ne]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[S,/(.+)/g,"Fire Phone $1"],[O,we],[R,H]],[/(playbook);[-\w\),; ]+(rim)/i],[S,O,[R,ne]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[S,[O,et],[R,H]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[S,[O,Le],[R,ne]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[S,[O,Le],[R,H]],[/(nexus 9)/i],[S,[O,"HTC"],[R,ne]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[O,[S,/_/g," "],[R,H]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[S,[O,"Acer"],[R,ne]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[S,[O,"Meizu"],[R,H]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[O,S,[R,H]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[O,S,[R,ne]],[/(surface duo)/i],[S,[O,wi],[R,ne]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[S,[O,"Fairphone"],[R,H]],[/(u304aa)/i],[S,[O,"AT&T"],[R,H]],[/\bsie-(\w*)/i],[S,[O,"Siemens"],[R,H]],[/\b(rct\w+) b/i],[S,[O,"RCA"],[R,ne]],[/\b(venue[\d ]{2,7}) b/i],[S,[O,"Dell"],[R,ne]],[/\b(q(?:mv|ta)\w+) b/i],[S,[O,"Verizon"],[R,ne]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[S,[O,"Barnes & Noble"],[R,ne]],[/\b(tm\d{3}\w+) b/i],[S,[O,"NuVision"],[R,ne]],[/\b(k88) b/i],[S,[O,"ZTE"],[R,ne]],[/\b(nx\d{3}j) b/i],[S,[O,"ZTE"],[R,H]],[/\b(gen\d{3}) b.+49h/i],[S,[O,"Swiss"],[R,H]],[/\b(zur\d{3}) b/i],[S,[O,"Swiss"],[R,ne]],[/\b((zeki)?tb.*\b) b/i],[S,[O,"Zeki"],[R,ne]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[O,"Dragon Touch"],S,[R,ne]],[/\b(ns-?\w{0,9}) b/i],[S,[O,"Insignia"],[R,ne]],[/\b((nxa|next)-?\w{0,9}) b/i],[S,[O,"NextBook"],[R,ne]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[O,"Voice"],S,[R,H]],[/\b(lvtel\-)?(v1[12]) b/i],[[O,"LvTel"],S,[R,H]],[/\b(ph-1) /i],[S,[O,"Essential"],[R,H]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[S,[O,"Envizen"],[R,ne]],[/\b(trio[-\w\. ]+) b/i],[S,[O,"MachSpeed"],[R,ne]],[/\btu_(1491) b/i],[S,[O,"Rotor"],[R,ne]],[/(shield[\w ]+) b/i],[S,[O,"Nvidia"],[R,ne]],[/(sprint) (\w+)/i],[O,S,[R,H]],[/(kin\.[onetw]{3})/i],[[S,/\./g," "],[O,wi],[R,H]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[S,[O,de],[R,ne]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[S,[O,de],[R,H]],[/smart-tv.+(samsung)/i],[O,[R,re]],[/hbbtv.+maple;(\d+)/i],[[S,/^/,"SmartTV"],[O,lt],[R,re]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[O,Vi],[R,re]],[/(apple) ?tv/i],[O,[S,Se+" TV"],[R,re]],[/crkey/i],[[S,Et+"cast"],[O,Mn],[R,re]],[/droid.+aft(\w)( bui|\))/i],[S,[O,we],[R,re]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[S,[O,Rt],[R,re]],[/(bravia[\w ]+)( bui|\))/i],[S,[O,Xe],[R,re]],[/(mitv-\w{5}) bui/i],[S,[O,U],[R,re]],[/Hbbtv.*(technisat) (.*);/i],[O,S,[R,re]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[O,bp],[S,bp],[R,re]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,re]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[O,S,[R,W]],[/droid.+; (shield) bui/i],[S,[O,"Nvidia"],[R,W]],[/(playstation [345portablevi]+)/i],[S,[O,Xe],[R,W]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[S,[O,wi],[R,W]],[/((pebble))app/i],[O,S,[R,me]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[S,[O,Se],[R,me]],[/droid.+; (glass) \d/i],[S,[O,Mn],[R,me]],[/droid.+; (wt63?0{2,3})\)/i],[S,[O,de],[R,me]],[/(quest( 2| pro)?)/i],[S,[O,ge],[R,me]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[O,[R,be]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[S,[R,H]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[S,[R,ne]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,ne]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,H]],[/(android[-\w\. ]{0,9});.+buil/i],[S,[O,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[N,[b,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[N,[b,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[b,N],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[N,b]],os:[[/microsoft (windows) (vista|xp)/i],[b,N],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[b,[N,ww,eP]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[b,"Windows"],[N,ww,eP]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[N,/_/g,"."],[b,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[b,an],[N,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[N,b],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[b,N],[/\(bb(10);/i],[N,[b,et]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[N,[b,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[N,[b,xn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[N,[b,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[N,[b,"watchOS"]],[/crkey\/([\d\.]+)/i],[N,[b,Et+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[b,it],N],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[b,N],[/(sunos) ?([\w\.\d]*)/i],[[b,"Solaris"],N],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[b,N]]},Dl=function(as,As){if(typeof as===p&&(As=as,as=c),!(this instanceof Dl))return new Dl(as,As).getResult();var Jr=typeof s!==h&&s.navigator?s.navigator:c,hu=as||(Jr&&Jr.userAgent?Jr.userAgent:""),tf=Jr&&Jr.userAgentData?Jr.userAgentData:c,Fi=As?function(ir,Uc){var ag={};for(var oh in ir)Uc[oh]&&Uc[oh].length%2==0?ag[oh]=Uc[oh].concat(ir[oh]):ag[oh]=ir[oh];return ag}(tP,As):tP;return this.getBrowser=function(){var ir={};return ir[b]=c,ir[N]=c,R_.call(ir,hu,Fi.browser),ir[y]=function(Uc){return typeof Uc===v?Uc.replace(/[^\d\.]/g,"").split(".")[0]:c}(ir[N]),Jr&&Jr.brave&&typeof Jr.brave.isBrave==l&&(ir[b]="Brave"),ir},this.getCPU=function(){var ir={};return ir[Y]=c,R_.call(ir,hu,Fi.cpu),ir},this.getDevice=function(){var ir={};return ir[O]=c,ir[S]=c,ir[R]=c,R_.call(ir,hu,Fi.device),!ir[R]&&tf&&tf.mobile&&(ir[R]=H),ir[S]=="Macintosh"&&Jr&&typeof Jr.standalone!==h&&Jr.maxTouchPoints&&Jr.maxTouchPoints>2&&(ir[S]="iPad",ir[R]=ne),ir},this.getEngine=function(){var ir={};return ir[b]=c,ir[N]=c,R_.call(ir,hu,Fi.engine),ir},this.getOS=function(){var ir={};return ir[b]=c,ir[N]=c,R_.call(ir,hu,Fi.os),!ir[b]&&tf&&tf.platform!="Unknown"&&(ir[b]=tf.platform.replace(/chrome os/i,it).replace(/macos/i,an)),ir},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return hu},this.setUA=function(ir){return hu=typeof ir===v&&ir.length>350?bp(ir,350):ir,this},this.setUA(hu),this};Dl.VERSION="0.7.34",Dl.BROWSER=br([b,N,y]),Dl.CPU=br([Y]),Dl.DEVICE=br([S,O,R,W,H,re,ne,me,be]),Dl.ENGINE=Dl.OS=br([b,N]),n.exports&&(i=n.exports=Dl),i.UAParser=Dl;var og=typeof s!==h&&(s.jQuery||s.Zepto);if(og&&!og.ua){var I_=new Dl;og.ua=I_.getResult(),og.ua.get=function(){return I_.getUA()},og.ua.set=function(as){I_.setUA(as);var As=I_.getResult();for(var Jr in As)og.ua[Jr]=As[Jr]}}})(typeof window=="object"?window:o)})(fx,fx.exports);var rge=a(fx.exports),ige=ku,sge=Ti,oge=Tn,age=Lu,cge=fr("iterator"),uge=Object,lge=function(n){if(oge(n))return!1;var i=uge(n);return i[cge]!==void 0||"@@iterator"in i||sge(age,ige(i))},dge=a(lge),Mz=Mm.clear;cn({global:!0,bind:!0,forced:L.clearImmediate!==Mz},{clearImmediate:Mz});var hge=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",Uz=L,fge=M,pge=qe,mge=hge,gge=Un,vge=Ts,_ge=Ho,yge=Uz.Function,Ege=/MSIE .\./.test(gge)||mge&&function(){var n=Uz.Bun.version.split(".");return n.length<3||n[0]==0&&(n[1]<3||n[1]==3&&n[2]==0)}(),Sge=cn,Vz=L,Fz=Mm.set,Tge=function(n,i){var s=1;return Ege?function(c,l){var h=_ge(arguments.length,1)>s,p=pge(c)?c:yge(c),v=h?vge(arguments,s):[],y=h?function(){fge(p,this,v)}:p;return n(y)}:n},jz=Vz.setImmediate?Tge(Fz):Fz;Sge({global:!0,bind:!0,forced:Vz.setImmediate!==jz},{setImmediate:jz});var Bz=a(ct.setImmediate),bge=cn,wge=DA,Cge=us,Rge=Ho,Ige=jf,Age=L.process;bge({global:!0,dontCallGetSet:!0},{queueMicrotask:function(n){Rge(arguments.length,1),Cge(n);var i=Ige&&Age.domain;wge(i?i.bind(n):n)}});var Wz=a(ct.queueMicrotask);function zz(n,i){return function(){return n.apply(i,arguments)}}const{toString:kge}=Object.prototype,{getPrototypeOf:px}=Object,ik=(mx=Object.create(null),n=>{const i=kge.call(n);return mx[i]||(mx[i]=i.slice(8,-1).toLowerCase())});var mx;const qd=n=>(n=n.toLowerCase(),i=>ik(i)===n),sk=n=>i=>typeof i===n,{isArray:FE}=Array,Tb=sk("undefined"),Gz=qd("ArrayBuffer"),Oge=sk("string"),bl=sk("function"),Hz=sk("number"),ok=n=>n!==null&&typeof n=="object",ak=n=>{if(ik(n)!=="object")return!1;const i=px(n);return!(i!==null&&i!==Object.prototype&&Object.getPrototypeOf(i)!==null||Symbol.toStringTag in n||dge(n))},Pge=qd("Date"),Nge=qd("File"),Dge=qd("Blob"),Lge=qd("FileList"),xge=qd("URLSearchParams"),[Mge,Uge,Vge,Fge]=["ReadableStream","Request","Response","Headers"].map(qd);function bb(n,i){let s,c,{allOwnKeys:l=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n!=null)if(typeof n!="object"&&(n=[n]),FE(n))for(s=0,c=n.length;s<c;s++)i.call(null,n[s],s,n);else{const h=l?Object.getOwnPropertyNames(n):Object.keys(n),p=h.length;let v;for(s=0;s<p;s++)v=h[s],i.call(null,n[v],v,n)}}function Kz(n,i){i=i.toLowerCase();const s=Object.keys(n);let c,l=s.length;for(;l-- >0;)if(c=s[l],i===c.toLowerCase())return c;return null}const Xv=xz!==void 0?xz:typeof self<"u"?self:typeof window<"u"?window:j_,qz=n=>!Tb(n)&&n!==Xv,jge=(gx=typeof Uint8Array<"u"&&px(Uint8Array),n=>gx&&n instanceof gx);var gx;const Bge=qd("HTMLFormElement"),$z=(n=>{let{hasOwnProperty:i}=n;return(s,c)=>i.call(s,c)})(Object.prototype),Wge=qd("RegExp"),Yz=(n,i)=>{const s=Object.getOwnPropertyDescriptors(n),c={};bb(s,(l,h)=>{let p;(p=i(l,h,n))!==!1&&(c[h]=p||l)}),Object.defineProperties(n,c)},vx="abcdefghijklmnopqrstuvwxyz",Xz="0123456789",Jz={DIGIT:Xz,ALPHA:vx,ALPHA_DIGIT:vx+vx.toUpperCase()+Xz},zge=qd("AsyncFunction"),Qz=(Zz=typeof Bz=="function",eG=bl(Xv.postMessage),Zz?Bz:eG?(_x="axios@".concat(Math.random()),ck=[],Xv.addEventListener("message",n=>{let{source:i,data:s}=n;i===Xv&&s===_x&&ck.length&&ck.shift()()},!1),n=>{ck.push(n),Xv.postMessage(_x,"*")}):n=>setTimeout(n));var Zz,eG,_x,ck;const Gge=Wz!==void 0?Wz.bind(Xv):typeof process<"u"&&process.nextTick||Qz;var ft={isArray:FE,isArrayBuffer:Gz,isBuffer:function(n){return n!==null&&!Tb(n)&&n.constructor!==null&&!Tb(n.constructor)&&bl(n.constructor.isBuffer)&&n.constructor.isBuffer(n)},isFormData:n=>{let i;return n&&(typeof FormData=="function"&&n instanceof FormData||bl(n.append)&&((i=ik(n))==="formdata"||i==="object"&&bl(n.toString)&&n.toString()==="[object FormData]"))},isArrayBufferView:function(n){let i;return i=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer&&Gz(n.buffer),i},isString:Oge,isNumber:Hz,isBoolean:n=>n===!0||n===!1,isObject:ok,isPlainObject:ak,isReadableStream:Mge,isRequest:Uge,isResponse:Vge,isHeaders:Fge,isUndefined:Tb,isDate:Pge,isFile:Nge,isBlob:Dge,isRegExp:Wge,isFunction:bl,isStream:n=>ok(n)&&bl(n.pipe),isURLSearchParams:xge,isTypedArray:jge,isFileList:Lge,forEach:bb,merge:function n(){const{caseless:i}=qz(this)&&this||{},s={},c=(l,h)=>{const p=i&&Kz(s,h)||h;ak(s[p])&&ak(l)?s[p]=n(s[p],l):ak(l)?s[p]=n({},l):FE(l)?s[p]=l.slice():s[p]=l};for(let l=0,h=arguments.length;l<h;l++)arguments[l]&&bb(arguments[l],c);return s},extend:function(n,i,s){let{allOwnKeys:c}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return bb(i,(l,h)=>{s&&bl(l)?n[h]=zz(l,s):n[h]=l},{allOwnKeys:c}),n},trim:n=>ha(n)?ha(n).call(n):n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),inherits:(n,i,s,c)=>{n.prototype=Object.create(i.prototype,c),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:i.prototype}),s&&Object.assign(n.prototype,s)},toFlatObject:(n,i,s,c)=>{let l,h,p;const v={};if(i=i||{},n==null)return i;do{for(l=Object.getOwnPropertyNames(n),h=l.length;h-- >0;)p=l[h],c&&!c(p,n,i)||v[p]||(i[p]=n[p],v[p]=!0);n=s!==!1&&px(n)}while(n&&(!s||s(n,i))&&n!==Object.prototype);return i},kindOf:ik,kindOfTest:qd,endsWith:(n,i,s)=>{n=String(n),(s===void 0||s>n.length)&&(s=n.length),s-=i.length;const c=n.indexOf(i,s);return c!==-1&&c===s},toArray:n=>{if(!n)return null;if(FE(n))return n;let i=n.length;if(!Hz(i))return null;const s=new Array(i);for(;i-- >0;)s[i]=n[i];return s},forEachEntry:(n,i)=>{const s=(n&&n[Symbol.iterator]).call(n);let c;for(;(c=s.next())&&!c.done;){const l=c.value;i.call(n,l[0],l[1])}},matchAll:(n,i)=>{let s;const c=[];for(;(s=n.exec(i))!==null;)c.push(s);return c},isHTMLForm:Bge,hasOwnProperty:$z,hasOwnProp:$z,reduceDescriptors:Yz,freezeMethods:n=>{Yz(n,(i,s)=>{if(bl(n)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const c=n[s];bl(c)&&(i.enumerable=!1,"writable"in i?i.writable=!1:i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(n,i)=>{const s={},c=l=>{l.forEach(h=>{s[h]=!0})};return FE(n)?c(n):c(String(n).split(i)),s},toCamelCase:n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,s,c){return s.toUpperCase()+c}),noop:()=>{},toFiniteNumber:(n,i)=>n!=null&&Number.isFinite(n=+n)?n:i,findKey:Kz,global:Xv,isContextDefined:qz,ALPHABET:Jz,generateString:function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jz.ALPHA_DIGIT,s="";const{length:c}=i;for(;n--;)s+=i[Math.random()*c|0];return s},isSpecCompliantForm:function(n){return!!(n&&bl(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])},toJSONObject:n=>{const i=new Array(10),s=(c,l)=>{if(ok(c)){if(i.indexOf(c)>=0)return;if(!("toJSON"in c)){i[l]=c;const h=FE(c)?[]:{};return bb(c,(p,v)=>{const y=s(p,l+1);!Tb(y)&&(h[v]=y)}),i[l]=void 0,h}}return c};return s(n,0)},isAsyncFn:zge,isThenable:n=>n&&(ok(n)||bl(n))&&bl(n.then)&&bl(n.catch),setImmediate:Qz,asap:Gge};function Sr(n,i,s,c,l){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",i&&(this.code=i),s&&(this.config=s),c&&(this.request=c),l&&(this.response=l,this.status=l.status?l.status:null)}ft.inherits(Sr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ft.toJSONObject(this.config),code:this.code,status:this.status}}});const tG=Sr.prototype,nG={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{nG[n]={value:n}}),Object.defineProperties(Sr,nG),Object.defineProperty(tG,"isAxiosError",{value:!0}),Sr.from=(n,i,s,c,l,h)=>{const p=Object.create(tG);return ft.toFlatObject(n,p,function(v){return v!==Error.prototype},v=>v!=="isAxiosError"),Sr.call(p,n.message,i,s,c,l),p.cause=n,p.name=n.name,h&&Object.assign(p,h),p};function yx(n){return ft.isPlainObject(n)||ft.isArray(n)}function rG(n){return ft.endsWith(n,"[]")?n.slice(0,-2):n}function iG(n,i,s){return n?n.concat(i).map(function(c,l){return c=rG(c),!s&&l?"["+c+"]":c}).join(s?".":""):i}const Hge=ft.toFlatObject(ft,{},null,function(n){return/^is[A-Z]/.test(n)});function uk(n,i,s){if(!ft.isObject(n))throw new TypeError("target must be an object");i=i||new FormData;const c=(s=ft.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(O,N){return!ft.isUndefined(N[O])})).metaTokens,l=s.visitor||S,h=s.dots,p=s.indexes,v=(s.Blob||typeof Blob<"u"&&Blob)&&ft.isSpecCompliantForm(i);if(!ft.isFunction(l))throw new TypeError("visitor must be a function");function y(O){if(O===null)return"";if(ft.isDate(O))return O.toISOString();if(!v&&ft.isBlob(O))throw new Sr("Blob is not supported. Use a Buffer instead.");return ft.isArrayBuffer(O)||ft.isTypedArray(O)?v&&typeof Blob=="function"?new Blob([O]):Buffer.from(O):O}function S(O,N,Y){let W=O;if(O&&!Y&&typeof O=="object"){if(ft.endsWith(N,"{}"))N=c?N:N.slice(0,-2),O=JSON.stringify(O);else if(ft.isArray(O)&&function(H){return ft.isArray(H)&&!H.some(yx)}(O)||(ft.isFileList(O)||ft.endsWith(N,"[]"))&&(W=ft.toArray(O)))return N=rG(N),W.forEach(function(H,ne){!ft.isUndefined(H)&&H!==null&&i.append(p===!0?iG([N],ne,h):p===null?N:N+"[]",y(H))}),!1}return!!yx(O)||(i.append(iG(Y,N,h),y(O)),!1)}const b=[],R=Object.assign(Hge,{defaultVisitor:S,convertValue:y,isVisitable:yx});if(!ft.isObject(n))throw new TypeError("data must be an object");return function O(N,Y){if(!ft.isUndefined(N)){if(b.indexOf(N)!==-1)throw Error("Circular reference detected in "+Y.join("."));b.push(N),ft.forEach(N,function(W,H){(!(ft.isUndefined(W)||W===null)&&l.call(i,W,ft.isString(H)?ha(H).call(H):H,Y,R))===!0&&O(W,Y?Y.concat(H):[H])}),b.pop()}}(n),i}function sG(n){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return i[s]})}function Ex(n,i){this._pairs=[],n&&uk(n,this,i)}const oG=Ex.prototype;function Kge(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function aG(n,i,s){if(!i)return n;const c=s&&s.encode||Kge;ft.isFunction(s)&&(s={serialize:s});const l=s&&s.serialize;let h;if(h=l?l(i,s):ft.isURLSearchParams(i)?i.toString():new Ex(i,s).toString(c),h){const p=n.indexOf("#");p!==-1&&(n=n.slice(0,p)),n+=(n.indexOf("?")===-1?"?":"&")+h}return n}oG.append=function(n,i){this._pairs.push([n,i])},oG.toString=function(n){const i=n?function(s){return n.call(this,s,sG)}:sG;return this._pairs.map(function(s){return i(s[0])+"="+i(s[1])},"").join("&")};var cG=class{constructor(){this.handlers=[]}use(n,i,s){return this.handlers.push({fulfilled:n,rejected:i,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){ft.forEach(this.handlers,function(i){i!==null&&n(i)})}},uG={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},lG={exports:{}},qge=cn,$ge=ke,dG=st.f;qge({target:"Object",stat:!0,forced:Object.defineProperty!==dG,sham:!$ge},{defineProperty:dG});var hG=ct.Object,Yge=lG.exports=function(n,i,s){return hG.defineProperty(n,i,s)};hG.defineProperty.sham&&(Yge.sham=!0);var fG=a(lG.exports),Xge=TypeError,pG=ov,Jge=Ov,Qge=at,Zge=fr("species"),mG=Array,eve=function(n){var i;return pG(n)&&(i=n.constructor,(Jge(i)&&(i===mG||pG(i.prototype))||Qge(i)&&(i=i[Zge])===null)&&(i=void 0)),i===void 0?mG:i},gG=function(n,i){return new(eve(n))(i===0?0:i)},tve=u,nve=Cr,rve=fr("species"),vG=function(n){return nve>=51||!tve(function(){var i=[];return(i.constructor={})[rve]=function(){return{foo:1}},i[n](Boolean).foo!==1})},ive=cn,sve=u,ove=ov,ave=at,cve=Lo,uve=Ki,_G=function(n){if(n>9007199254740991)throw Xge("Maximum allowed index exceeded");return n},yG=FA,lve=gG,dve=vG,hve=Cr,EG=fr("isConcatSpreadable"),fve=hve>=51||!sve(function(){var n=[];return n[EG]=!1,n.concat()[0]!==n}),pve=function(n){if(!ave(n))return!1;var i=n[EG];return i!==void 0?!!i:ove(n)};ive({target:"Array",proto:!0,forced:!fve||!dve("concat")},{concat:function(n){var i,s,c,l,h,p=cve(this),v=lve(p,0),y=0;for(i=-1,c=arguments.length;i<c;i++)if(pve(h=i===-1?p:arguments[i]))for(l=uve(h),_G(y+l),s=0;s<l;s++,y++)s in h&&yG(v,y,h[s]);else _G(y+1),yG(v,y++,h);return v.length=y,v}});var SG={},mve=j,gve=Ae,TG=Eh.f,vve=bL,bG=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];SG.f=function(n){return bG&&mve(n)=="Window"?function(i){try{return TG(i)}catch{return vve(bG)}}(n):TG(gve(n))};var jE={},_ve=fr;jE.f=_ve;var wG=ct,yve=Ti,Eve=jE,Sve=st.f,co=function(n){var i=wG.Symbol||(wG.Symbol={});yve(i,n)||Sve(i,n,{value:Eve.f(n)})},Tve=Ve,bve=Kt,wve=fr,Cve=Yl,CG=function(){var n=bve("Symbol"),i=n&&n.prototype,s=i&&i.valueOf,c=wve("toPrimitive");i&&!i[c]&&Cve(i,c,function(l){return Tve(s,this)},{})},Rve=De,Ive=Er,Ave=Lo,kve=Ki,Ove=gG,RG=C([].push),Pve=function(n){var i=n==1,s=n==2,c=n==3,l=n==4,h=n==6,p=n==7,v=n==5||h;return function(y,S,b,R){for(var O,N,Y=Ave(y),W=Ive(Y),H=Rve(S,b),ne=kve(W),re=0,me=R||Ove,be=i?me(y,ne):s||p?me(y,0):void 0;ne>re;re++)if((v||re in W)&&(N=H(O=W[re],re,Y),n))if(i)be[re]=N;else if(N)switch(n){case 3:return!0;case 5:return O;case 6:return re;case 2:RG(be,O)}else switch(n){case 4:return!1;case 7:RG(be,O)}return h?-1:c||l?l:be}},IG={forEach:Pve(0)},lk=cn,Sx=L,Tx=Ve,Nve=C,BE=ke,WE=ys,Dve=u,Pa=Ti,Lve=I,bx=hn,dk=Ae,wx=Aa,xve=Cc,Cx=jt,wb=Qa,AG=Nu,Mve=Eh,kG=SG,Uve=Pu,OG=St,PG=st,Vve=By,NG=ve,DG=Yl,Fve=bo,Rx=Gs,LG=Ou,xG=dl,jve=fr,Bve=jE,Wve=co,zve=CG,Gve=Fd,MG=$l,hk=IG.forEach,ju=cv("hidden"),fk="Symbol",Cb="prototype",Hve=MG.set,UG=MG.getterFor(fk),$d=Object[Cb],Jv=Sx.Symbol,pk=Jv&&Jv[Cb],Kve=Sx.TypeError,Ix=Sx.QObject,VG=OG.f,Qv=PG.f,FG=kG.f,qve=NG.f,jG=Nve([].push),ap=Rx("symbols"),Rb=Rx("op-symbols"),$ve=Rx("wks"),Ax=!Ix||!Ix[Cb]||!Ix[Cb].findChild,kx=BE&&Dve(function(){return wb(Qv({},"a",{get:function(){return Qv(this,"a",{value:7}).a}})).a!=7})?function(n,i,s){var c=VG($d,i);c&&delete $d[i],Qv(n,i,s),c&&n!==$d&&Qv($d,i,c)}:Qv,Ox=function(n,i){var s=ap[n]=wb(pk);return Hve(s,{type:fk,tag:n,description:i}),BE||(s.description=i),s},mk=function(n,i,s){n===$d&&mk(Rb,i,s),bx(n);var c=wx(i);return bx(s),Pa(ap,c)?(s.enumerable?(Pa(n,ju)&&n[ju][c]&&(n[ju][c]=!1),s=wb(s,{enumerable:Cx(0,!1)})):(Pa(n,ju)||Qv(n,ju,Cx(1,{})),n[ju][c]=!0),kx(n,c,s)):Qv(n,c,s)},Px=function(n,i){bx(n);var s=dk(i),c=AG(s).concat(GG(s));return hk(c,function(l){BE&&!Tx(BG,s,l)||mk(n,l,s[l])}),n},BG=function(n){var i=wx(n),s=Tx(qve,this,i);return!(this===$d&&Pa(ap,i)&&!Pa(Rb,i))&&(!(s||!Pa(this,i)||!Pa(ap,i)||Pa(this,ju)&&this[ju][i])||s)},WG=function(n,i){var s=dk(n),c=wx(i);if(s!==$d||!Pa(ap,c)||Pa(Rb,c)){var l=VG(s,c);return!l||!Pa(ap,c)||Pa(s,ju)&&s[ju][c]||(l.enumerable=!0),l}},zG=function(n){var i=FG(dk(n)),s=[];return hk(i,function(c){Pa(ap,c)||Pa(LG,c)||jG(s,c)}),s},GG=function(n){var i=n===$d,s=FG(i?Rb:dk(n)),c=[];return hk(s,function(l){!Pa(ap,l)||i&&!Pa($d,l)||jG(c,ap[l])}),c};WE||(Jv=function(){if(Lve(pk,this))throw Kve("Symbol is not a constructor");var n=arguments.length&&arguments[0]!==void 0?xve(arguments[0]):void 0,i=xG(n),s=function(c){this===$d&&Tx(s,Rb,c),Pa(this,ju)&&Pa(this[ju],i)&&(this[ju][i]=!1),kx(this,i,Cx(1,c))};return BE&&Ax&&kx($d,i,{configurable:!0,set:s}),Ox(i,n)},DG(pk=Jv[Cb],"toString",function(){return UG(this).tag}),DG(Jv,"withoutSetter",function(n){return Ox(xG(n),n)}),NG.f=BG,PG.f=mk,Vve.f=Px,OG.f=WG,Mve.f=kG.f=zG,Uve.f=GG,Bve.f=function(n){return Ox(jve(n),n)},BE&&Fve(pk,"description",{configurable:!0,get:function(){return UG(this).description}})),lk({global:!0,wrap:!0,forced:!WE,sham:!WE},{Symbol:Jv}),hk(AG($ve),function(n){Wve(n)}),lk({target:fk,stat:!0,forced:!WE},{useSetter:function(){Ax=!0},useSimple:function(){Ax=!1}}),lk({target:"Object",stat:!0,forced:!WE,sham:!BE},{create:function(n,i){return i===void 0?wb(n):Px(wb(n),i)},defineProperty:mk,defineProperties:Px,getOwnPropertyDescriptor:WG}),lk({target:"Object",stat:!0,forced:!WE},{getOwnPropertyNames:zG}),zve(),Gve(Jv,fk),LG[ju]=!0;var HG=ys&&!!Symbol.for&&!!Symbol.keyFor,Yve=cn,Xve=Kt,Jve=Ti,Qve=Cc,KG=Gs,Zve=HG,Nx=KG("string-to-symbol-registry"),e_e=KG("symbol-to-string-registry");Yve({target:"Symbol",stat:!0,forced:!Zve},{for:function(n){var i=Qve(n);if(Jve(Nx,i))return Nx[i];var s=Xve("Symbol")(i);return Nx[i]=s,e_e[s]=i,s}});var t_e=cn,n_e=Ti,r_e=zi,i_e=Do,s_e=HG,qG=Gs("symbol-to-string-registry");t_e({target:"Symbol",stat:!0,forced:!s_e},{keyFor:function(n){if(!r_e(n))throw TypeError(i_e(n)+" is not a symbol");if(n_e(qG,n))return qG[n]}});var $G=ov,o_e=qe,YG=j,a_e=Cc,XG=C([].push),c_e=cn,JG=Kt,QG=M,u_e=Ve,Ib=C,ZG=u,eH=qe,tH=zi,nH=Ts,l_e=function(n){if(o_e(n))return n;if($G(n)){for(var i=n.length,s=[],c=0;c<i;c++){var l=n[c];typeof l=="string"?XG(s,l):typeof l!="number"&&YG(l)!="Number"&&YG(l)!="String"||XG(s,a_e(l))}var h=s.length,p=!0;return function(v,y){if(p)return p=!1,y;if($G(this))return y;for(var S=0;S<h;S++)if(s[S]===v)return y}}},d_e=ys,h_e=String,jm=JG("JSON","stringify"),gk=Ib(/./.exec),rH=Ib("".charAt),f_e=Ib("".charCodeAt),p_e=Ib("".replace),m_e=Ib(1 .toString),g_e=/[\uD800-\uDFFF]/g,iH=/^[\uD800-\uDBFF]$/,sH=/^[\uDC00-\uDFFF]$/,oH=!d_e||ZG(function(){var n=JG("Symbol")();return jm([n])!="[null]"||jm({a:n})!="{}"||jm(Object(n))!="{}"}),aH=ZG(function(){return jm("\uDF06\uD834")!=='"\\udf06\\ud834"'||jm("\uDEAD")!=='"\\udead"'}),v_e=function(n,i){var s=nH(arguments),c=l_e(i);if(eH(c)||n!==void 0&&!tH(n))return s[1]=function(l,h){if(eH(c)&&(h=u_e(c,this,h_e(l),h)),!tH(h))return h},QG(jm,null,s)},__e=function(n,i,s){var c=rH(s,i-1),l=rH(s,i+1);return gk(iH,n)&&!gk(sH,l)||gk(sH,n)&&!gk(iH,c)?"\\u"+m_e(f_e(n,0),16):n};jm&&c_e({target:"JSON",stat:!0,forced:oH||aH},{stringify:function(n,i,s){var c=nH(arguments),l=QG(oH?v_e:jm,null,c);return aH&&typeof l=="string"?p_e(l,g_e,__e):l}});var cH=Pu,y_e=Lo;cn({target:"Object",stat:!0,forced:!ys||u(function(){cH.f(1)})},{getOwnPropertySymbols:function(n){var i=cH.f;return i?i(y_e(n)):[]}}),co("asyncIterator"),co("hasInstance"),co("isConcatSpreadable"),co("iterator"),co("match"),co("matchAll"),co("replace"),co("search"),co("species"),co("split");var E_e=CG;co("toPrimitive"),E_e();var S_e=Kt,T_e=Fd;co("toStringTag"),T_e(S_e("Symbol"),"Symbol"),co("unscopables"),Fd(L.JSON,"JSON",!0);var b_e=ct.Symbol,w_e=fr,C_e=st.f,uH=w_e("metadata"),lH=Function.prototype;lH[uH]===void 0&&C_e(lH,uH,{value:null}),co("dispose"),co("metadata");var R_e=b_e;co("asyncDispose");var I_e=C,Dx=Kt("Symbol"),A_e=Dx.keyFor,k_e=I_e(Dx.prototype.valueOf),dH=Dx.isRegisteredSymbol||function(n){try{return A_e(k_e(n))!==void 0}catch{return!1}};cn({target:"Symbol",stat:!0},{isRegisteredSymbol:dH});for(var O_e=Gs,hH=Kt,P_e=C,N_e=zi,D_e=fr,vk=hH("Symbol"),fH=vk.isWellKnownSymbol,pH=hH("Object","getOwnPropertyNames"),L_e=P_e(vk.prototype.valueOf),mH=O_e("wks"),Lx=0,gH=pH(vk),x_e=gH.length;Lx<x_e;Lx++)try{var vH=gH[Lx];N_e(vk[vH])&&D_e(vH)}catch{}var _H=function(n){if(fH&&fH(n))return!0;try{for(var i=L_e(n),s=0,c=pH(mH),l=c.length;s<l;s++)if(mH[c[s]]==i)return!0}catch{}return!1};cn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:_H}),co("matcher"),co("observable"),cn({target:"Symbol",stat:!0},{isRegistered:dH}),cn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:_H}),co("metadataKey"),co("patternMatch"),co("replaceAll");var zE=a(R_e),yH=a(jE.f("iterator"));function Ab(n){return Ab=typeof zE=="function"&&typeof yH=="symbol"?function(i){return typeof i}:function(i){return i&&typeof zE=="function"&&i.constructor===zE&&i!==zE.prototype?"symbol":typeof i},Ab(n)}var M_e=a(jE.f("toPrimitive"));function U_e(n){var i=function(s,c){if(Ab(s)!=="object"||s===null)return s;var l=s[M_e];if(l!==void 0){var h=l.call(s,c);if(Ab(h)!=="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(c==="string"?String:Number)(s)}(n,"string");return Ab(i)==="symbol"?i:String(i)}function ee(n,i,s){return(i=U_e(i))in n?fG(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}var EH=a(vpe),V_e={isBrowser:!0,classes:{URLSearchParams:EH!==void 0?EH:Ex,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const xx=typeof window<"u"&&typeof document<"u",Mx=typeof navigator=="object"&&navigator||void 0,F_e=xx&&(!Mx||["ReactNative","NativeScript","NS"].indexOf(Mx.product)<0),j_e=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",B_e=xx&&window.location.href||"http://localhost";function SH(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function TH(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?SH(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):SH(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}var Pc=TH(TH({},Object.freeze({__proto__:null,hasBrowserEnv:xx,hasStandardBrowserEnv:F_e,hasStandardBrowserWebWorkerEnv:j_e,navigator:Mx,origin:B_e})),V_e),W_e=hn,z_e=Ve,G_e=Ti,H_e=I,K_e=function(){var n=W_e(this),i="";return n.hasIndices&&(i+="d"),n.global&&(i+="g"),n.ignoreCase&&(i+="i"),n.multiline&&(i+="m"),n.dotAll&&(i+="s"),n.unicode&&(i+="u"),n.unicodeSets&&(i+="v"),n.sticky&&(i+="y"),i},bH=RegExp.prototype,wH=function(n){var i=n.flags;return i!==void 0||"flags"in bH||G_e(n,"flags")||!H_e(bH,n)?i:z_e(K_e,n)},q_e=_L.charAt,CH=Ve,$_e=hn,Y_e=qe,X_e=j,J_e=/./.exec,Q_e=TypeError,Z_e=cn,RH=Ve,IH=ce,eye=ca,_k=Iv,AH=Pt,kH=Wt,kb=Cc,tye=hn,nye=Tn,rye=j,iye=fI,OH=wH,sye=zs,oye=u,aye=oo,cye=function(n,i,s){return i+(s?q_e(n,i).length:1)},uye=function(n,i){var s=n.exec;if(Y_e(s)){var c=CH(s,n,i);return c!==null&&$_e(c),c}if(X_e(n)==="RegExp")return CH(J_e,n,i);throw Q_e("RegExp#exec called on incompatible receiver")},PH=$l,lye=fr("matchAll"),NH="RegExp String",DH=NH+" Iterator",dye=PH.set,hye=PH.getterFor(DH),fye=TypeError,Ux=IH("".indexOf),yk=IH("".matchAll),Vx=!!yk&&!oye(function(){yk("a",/./)}),pye=eye(function(n,i,s,c){dye(this,{type:DH,regexp:n,string:i,global:s,unicode:c,done:!1})},NH,function(){var n=hye(this);if(n.done)return _k(void 0,!0);var i=n.regexp,s=n.string,c=uye(i,s);return c===null?(n.done=!0,_k(void 0,!0)):n.global?(kb(c[0])===""&&(i.lastIndex=cye(s,kH(i.lastIndex),n.unicode)),_k(c,!1)):(n.done=!0,_k(c,!1))}),LH=function(n){var i,s,c,l=tye(this),h=kb(n),p=aye(l,RegExp),v=kb(OH(l));return i=new p(p===RegExp?l.source:l,v),s=!!~Ux(v,"g"),c=!!~Ux(v,"u"),i.lastIndex=kH(l.lastIndex),new pye(i,h,s,c)};Z_e({target:"String",proto:!0,forced:Vx},{matchAll:function(n){var i,s,c,l,h=AH(this);if(nye(n)){if(Vx)return yk(h,n)}else{if(iye(n)&&(i=kb(AH(OH(n))),!~Ux(i,"g")))throw fye("`.matchAll` does not allow non-global regexes");if(Vx)return yk(h,n);if((c=sye(n,lye))===void 0&&rye(n)=="RegExp"&&(c=LH),c)return RH(c,n,h)}return s=kb(h),l=new RegExp(n,"g"),RH(LH,l,s)}});var mye=tu("String").matchAll,gye=I,vye=mye,Fx=String.prototype,_ye=function(n){var i=n.matchAll;return typeof n=="string"||n===Fx||gye(Fx,n)&&i===Fx.matchAll?vye:i},yye=a(_ye);function xH(n){function i(s,c,l,h){let p=s[h++];if(p==="__proto__")return!0;const v=Number.isFinite(+p),y=h>=s.length;return p=!p&&ft.isArray(l)?l.length:p,y?(ft.hasOwnProp(l,p)?l[p]=[l[p],c]:l[p]=c,!v):(l[p]&&ft.isObject(l[p])||(l[p]=[]),i(s,c,l[p],h)&&ft.isArray(l[p])&&(l[p]=function(S){const b={},R=Object.keys(S);let O;const N=R.length;let Y;for(O=0;O<N;O++)Y=R[O],b[Y]=S[Y];return b}(l[p])),!v)}if(ft.isFormData(n)&&ft.isFunction(n.entries)){const s={};return ft.forEachEntry(n,(c,l)=>{i(function(h){return yye(ft).call(ft,/\w+|\[(\w*)]/g,h).map(p=>p[0]==="[]"?"":p[1]||p[0])}(c),l,s,0)}),s}return null}const jx={transitional:uG,adapter:["xhr","http","fetch"],transformRequest:[function(n,i){const s=i.getContentType()||"",c=s.indexOf("application/json")>-1,l=ft.isObject(n);if(l&&ft.isHTMLForm(n)&&(n=new FormData(n)),ft.isFormData(n))return c?JSON.stringify(xH(n)):n;if(ft.isArrayBuffer(n)||ft.isBuffer(n)||ft.isStream(n)||ft.isFile(n)||ft.isBlob(n)||ft.isReadableStream(n))return n;if(ft.isArrayBufferView(n))return n.buffer;if(ft.isURLSearchParams(n))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let h;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(p,v){return uk(p,new Pc.classes.URLSearchParams,Object.assign({visitor:function(y,S,b,R){return Pc.isNode&&ft.isBuffer(y)?(this.append(S,y.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},v))}(n,this.formSerializer).toString();if((h=ft.isFileList(n))||s.indexOf("multipart/form-data")>-1){const p=this.env&&this.env.FormData;return uk(h?{"files[]":n}:n,p&&new p,this.formSerializer)}}return l||c?(i.setContentType("application/json",!1),function(p,v,y){if(ft.isString(p))try{return(v||JSON.parse)(p),ha(ft).call(ft,p)}catch(S){if(S.name!=="SyntaxError")throw S}return(y||JSON.stringify)(p)}(n)):n}],transformResponse:[function(n){const i=this.transitional||jx.transitional,s=i&&i.forcedJSONParsing,c=this.responseType==="json";if(ft.isResponse(n)||ft.isReadableStream(n))return n;if(n&&ft.isString(n)&&(s&&!this.responseType||c)){const l=!(i&&i.silentJSONParsing)&&c;try{return JSON.parse(n)}catch(h){if(l)throw h.name==="SyntaxError"?Sr.from(h,Sr.ERR_BAD_RESPONSE,this,null,this.response):h}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Pc.classes.FormData,Blob:Pc.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ft.forEach(["delete","get","head","post","put","patch"],n=>{jx.headers[n]={}});var Bx=jx;const Eye=ft.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),MH=Symbol("internals");function Ob(n){var i;return n&&ha(i=String(n)).call(i).toLowerCase()}function Ek(n){return n===!1||n==null?n:ft.isArray(n)?n.map(Ek):String(n)}function Wx(n,i,s,c,l){return ft.isFunction(c)?c.call(this,i,s):(l&&(i=s),ft.isString(i)?ft.isString(c)?i.indexOf(c)!==-1:ft.isRegExp(c)?c.test(i):void 0:void 0)}class Sk{constructor(i){i&&this.set(i)}set(i,s,c){const l=this;function h(y,S,b){const R=Ob(S);if(!R)throw new Error("header name must be a non-empty string");const O=ft.findKey(l,R);(!O||l[O]===void 0||b===!0||b===void 0&&l[O]!==!1)&&(l[O||S]=Ek(y))}const p=(y,S)=>ft.forEach(y,(b,R)=>h(b,R,S));if(ft.isPlainObject(i)||i instanceof this.constructor)p(i,s);else if(ft.isString(i)&&(i=ha(i).call(i))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ha(v=i).call(v)))p((y=>{const S={};let b,R,O;return y&&y.split(`
`).forEach(function(N){var Y,W;O=N.indexOf(":"),b=ha(Y=N.substring(0,O)).call(Y).toLowerCase(),R=ha(W=N.substring(O+1)).call(W),!b||S[b]&&Eye[b]||(b==="set-cookie"?S[b]?S[b].push(R):S[b]=[R]:S[b]=S[b]?S[b]+", "+R:R)}),S})(i),s);else if(ft.isHeaders(i))for(const[y,S]of i.entries())h(S,y,c);else i!=null&&h(s,i,c);var v;return this}get(i,s){if(i=Ob(i)){const c=ft.findKey(this,i);if(c){const l=this[c];if(!s)return l;if(s===!0)return function(h){const p=Object.create(null),v=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=v.exec(h);)p[y[1]]=y[2];return p}(l);if(ft.isFunction(s))return s.call(this,l,c);if(ft.isRegExp(s))return s.exec(l);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,s){if(i=Ob(i)){const c=ft.findKey(this,i);return!(!c||this[c]===void 0||s&&!Wx(0,this[c],c,s))}return!1}delete(i,s){const c=this;let l=!1;function h(p){if(p=Ob(p)){const v=ft.findKey(c,p);!v||s&&!Wx(0,c[v],v,s)||(delete c[v],l=!0)}}return ft.isArray(i)?i.forEach(h):h(i),l}clear(i){const s=Object.keys(this);let c=s.length,l=!1;for(;c--;){const h=s[c];i&&!Wx(0,this[h],h,i,!0)||(delete this[h],l=!0)}return l}normalize(i){const s=this,c={};return ft.forEach(this,(l,h)=>{var p;const v=ft.findKey(c,h);if(v)return s[v]=Ek(l),void delete s[h];const y=i?function(S){return ha(S).call(S).toLowerCase().replace(/([a-z\d])(\w*)/g,(b,R,O)=>R.toUpperCase()+O)}(h):ha(p=String(h)).call(p);y!==h&&delete s[h],s[y]=Ek(l),c[y]=!0}),this}concat(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return this.constructor.concat(this,...s)}toJSON(i){const s=Object.create(null);return ft.forEach(this,(c,l)=>{c!=null&&c!==!1&&(s[l]=i&&ft.isArray(c)?c.join(", "):c)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(i=>{let[s,c]=i;return s+": "+c}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i){const s=new this(i);for(var c=arguments.length,l=new Array(c>1?c-1:0),h=1;h<c;h++)l[h-1]=arguments[h];return l.forEach(p=>s.set(p)),s}static accessor(i){const s=(this[MH]=this[MH]={accessors:{}}).accessors,c=this.prototype;function l(h){const p=Ob(h);s[p]||(function(v,y){const S=ft.toCamelCase(" "+y);["get","set","has"].forEach(b=>{Object.defineProperty(v,b+S,{value:function(R,O,N){return this[b].call(this,y,R,O,N)},configurable:!0})})}(c,h),s[p]=!0)}return ft.isArray(i)?i.forEach(l):l(i),this}}Sk.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ft.reduceDescriptors(Sk.prototype,(n,i)=>{let{value:s}=n,c=i[0].toUpperCase()+i.slice(1);return{get:()=>s,set(l){this[c]=l}}}),ft.freezeMethods(Sk);var Yd=Sk;function zx(n,i){const s=this||Bx,c=i||s,l=Yd.from(c.headers);let h=c.data;return ft.forEach(n,function(p){h=p.call(s,h,l.normalize(),i?i.status:void 0)}),l.normalize(),h}function UH(n){return!(!n||!n.__CANCEL__)}function GE(n,i,s){Sr.call(this,n??"canceled",Sr.ERR_CANCELED,i,s),this.name="CanceledError"}function VH(n,i,s){const c=s.config.validateStatus;s.status&&c&&!c(s.status)?i(new Sr("Request failed with status code "+s.status,[Sr.ERR_BAD_REQUEST,Sr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):n(s)}ft.inherits(GE,Sr,{__CANCEL__:!0});const Tk=function(n,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,c=0;const l=function(h,p){h=h||10;const v=new Array(h),y=new Array(h);let S,b=0,R=0;return p=p!==void 0?p:1e3,function(O){const N=Date.now(),Y=y[R];S||(S=N),v[b]=O,y[b]=N;let W=R,H=0;for(;W!==b;)H+=v[W++],W%=h;if(b=(b+1)%h,b===R&&(R=(R+1)%h),N-S<p)return;const ne=Y&&N-Y;return ne?Math.round(1e3*H/ne):void 0}}(50,250);return function(h,p){let v,y,S=0,b=1e3/p;const R=function(O){S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),v=null,y&&(clearTimeout(y),y=null),h.apply(null,O)};return[function(){const O=Date.now(),N=O-S;for(var Y=arguments.length,W=new Array(Y),H=0;H<Y;H++)W[H]=arguments[H];N>=b?R(W,O):(v=W,y||(y=setTimeout(()=>{y=null,R(v)},b-N)))},()=>v&&R(v)]}(h=>{const p=h.loaded,v=h.lengthComputable?h.total:void 0,y=p-c,S=l(y);c=p,n({loaded:p,total:v,progress:v?p/v:void 0,bytes:y,rate:S||void 0,estimated:S&&v&&p<=v?(v-p)/S:void 0,event:h,lengthComputable:v!=null,[i?"download":"upload"]:!0})},s)},FH=(n,i)=>{const s=n!=null;return[c=>i[0]({lengthComputable:s,total:n,loaded:c}),i[1]]},jH=n=>function(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return ft.asap(()=>n(...s))};var Sye=Pc.hasStandardBrowserEnv?((n,i)=>s=>(s=new JA(s,Pc.origin),n.protocol===s.protocol&&n.host===s.host&&(i||n.port===s.port)))(new JA(Pc.origin),Pc.navigator&&/(msie|trident)/i.test(Pc.navigator.userAgent)):()=>!0,Tye=Pc.hasStandardBrowserEnv?{write(n,i,s,c,l,h){const p=[n+"="+encodeURIComponent(i)];ft.isNumber(s)&&p.push("expires="+new Date(s).toGMTString()),ft.isString(c)&&p.push("path="+c),ft.isString(l)&&p.push("domain="+l),h===!0&&p.push("secure"),document.cookie=p.join("; ")},read(n){const i=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function BH(n,i){return n&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(i)?function(s,c){return c?s.replace(/\/?\/$/,"")+"/"+c.replace(/^\/+/,""):s}(n,i):i}function WH(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}const zH=n=>n instanceof Yd?function(i){for(var s=1;s<arguments.length;s++){var c=arguments[s]!=null?arguments[s]:{};s%2?WH(Object(c),!0).forEach(function(l){ee(i,l,c[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(c)):WH(Object(c)).forEach(function(l){Object.defineProperty(i,l,Object.getOwnPropertyDescriptor(c,l))})}return i}({},n):n;function Zv(n,i){i=i||{};const s={};function c(S,b,R,O){return ft.isPlainObject(S)&&ft.isPlainObject(b)?ft.merge.call({caseless:O},S,b):ft.isPlainObject(b)?ft.merge({},b):ft.isArray(b)?b.slice():b}function l(S,b,R,O){return ft.isUndefined(b)?ft.isUndefined(S)?void 0:c(void 0,S,0,O):c(S,b,0,O)}function h(S,b){if(!ft.isUndefined(b))return c(void 0,b)}function p(S,b){return ft.isUndefined(b)?ft.isUndefined(S)?void 0:c(void 0,S):c(void 0,b)}function v(S,b,R){return R in i?c(S,b):R in n?c(void 0,S):void 0}const y={url:h,method:h,data:h,baseURL:p,transformRequest:p,transformResponse:p,paramsSerializer:p,timeout:p,timeoutMessage:p,withCredentials:p,withXSRFToken:p,adapter:p,responseType:p,xsrfCookieName:p,xsrfHeaderName:p,onUploadProgress:p,onDownloadProgress:p,decompress:p,maxContentLength:p,maxBodyLength:p,beforeRedirect:p,transport:p,httpAgent:p,httpsAgent:p,cancelToken:p,socketPath:p,responseEncoding:p,validateStatus:v,headers:(S,b,R)=>l(zH(S),zH(b),0,!0)};return ft.forEach(Object.keys(Object.assign({},n,i)),function(S){const b=y[S]||l,R=b(n[S],i[S],S);ft.isUndefined(R)&&b!==v||(s[S]=R)}),s}var GH=n=>{const i=Zv({},n);let s,{data:c,withXSRFToken:l,xsrfHeaderName:h,xsrfCookieName:p,headers:v,auth:y}=i;if(i.headers=v=Yd.from(v),i.url=aG(BH(i.baseURL,i.url),n.params,n.paramsSerializer),y&&v.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),ft.isFormData(c)){if(Pc.hasStandardBrowserEnv||Pc.hasStandardBrowserWebWorkerEnv)v.setContentType(void 0);else if((s=v.getContentType())!==!1){const[S,...b]=s?s.split(";").map(R=>ha(R).call(R)).filter(Boolean):[];v.setContentType([S||"multipart/form-data",...b].join("; "))}}if(Pc.hasStandardBrowserEnv&&(l&&ft.isFunction(l)&&(l=l(i)),l||l!==!1&&Sye(i.url))){const S=h&&p&&Tye.read(p);S&&v.set(h,S)}return i},bye=typeof XMLHttpRequest<"u"&&function(n){return new pt(function(i,s){const c=GH(n);let l=c.data;const h=Yd.from(c.headers).normalize();let p,v,y,S,b,{responseType:R,onUploadProgress:O,onDownloadProgress:N}=c;function Y(){S&&S(),b&&b(),c.cancelToken&&c.cancelToken.unsubscribe(p),c.signal&&c.signal.removeEventListener("abort",p)}let W=new XMLHttpRequest;function H(){if(!W)return;const re=Yd.from("getAllResponseHeaders"in W&&W.getAllResponseHeaders());VH(function(me){i(me),Y()},function(me){s(me),Y()},{data:R&&R!=="text"&&R!=="json"?W.response:W.responseText,status:W.status,statusText:W.statusText,headers:re,config:n,request:W}),W=null}W.open(c.method.toUpperCase(),c.url,!0),W.timeout=c.timeout,"onloadend"in W?W.onloadend=H:W.onreadystatechange=function(){W&&W.readyState===4&&(W.status!==0||W.responseURL&&W.responseURL.indexOf("file:")===0)&&setTimeout(H)},W.onabort=function(){W&&(s(new Sr("Request aborted",Sr.ECONNABORTED,n,W)),W=null)},W.onerror=function(){s(new Sr("Network Error",Sr.ERR_NETWORK,n,W)),W=null},W.ontimeout=function(){let re=c.timeout?"timeout of "+c.timeout+"ms exceeded":"timeout exceeded";const me=c.transitional||uG;c.timeoutErrorMessage&&(re=c.timeoutErrorMessage),s(new Sr(re,me.clarifyTimeoutError?Sr.ETIMEDOUT:Sr.ECONNABORTED,n,W)),W=null},l===void 0&&h.setContentType(null),"setRequestHeader"in W&&ft.forEach(h.toJSON(),function(re,me){W.setRequestHeader(me,re)}),ft.isUndefined(c.withCredentials)||(W.withCredentials=!!c.withCredentials),R&&R!=="json"&&(W.responseType=c.responseType),N&&([y,b]=Tk(N,!0),W.addEventListener("progress",y)),O&&W.upload&&([v,S]=Tk(O),W.upload.addEventListener("progress",v),W.upload.addEventListener("loadend",S)),(c.cancelToken||c.signal)&&(p=re=>{W&&(s(!re||re.type?new GE(null,n,W):re),W.abort(),W=null)},c.cancelToken&&c.cancelToken.subscribe(p),c.signal&&(c.signal.aborted?p():c.signal.addEventListener("abort",p)));const ne=function(re){const me=/^([-+\w]{1,25})(:?\/\/|:)/.exec(re);return me&&me[1]||""}(c.url);ne&&Pc.protocols.indexOf(ne)===-1?s(new Sr("Unsupported protocol "+ne+":",Sr.ERR_BAD_REQUEST,n)):W.send(l||null)})},wye=(n,i)=>{const{length:s}=n=n?n.filter(Boolean):[];if(i||s){let c,l=new AbortController;const h=function(S){if(!c){c=!0,v();const b=S instanceof Error?S:this.reason;l.abort(b instanceof Sr?b:new GE(b instanceof Error?b.message:b))}};let p=i&&setTimeout(()=>{p=null,h(new Sr("timeout ".concat(i," of ms exceeded"),Sr.ETIMEDOUT))},i);const v=()=>{n&&(p&&clearTimeout(p),p=null,n.forEach(S=>{S.unsubscribe?S.unsubscribe(h):S.removeEventListener("abort",h)}),n=null)};n.forEach(S=>S.addEventListener("abort",h));const{signal:y}=l;return y.unsubscribe=()=>ft.asap(v),y}},Cye=M6,Rye=Ql;cn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var n=Rye.f(this);return{promise:n.promise,resolve:n.resolve,reject:n.reject}}});var Iye=Ql,Aye=da;cn({target:"Promise",stat:!0,forced:!0},{try:function(n){var i=Iye.f(this),s=Aye(n);return(s.error?i.reject:i.resolve)(s.value),i.promise}});var Gx=a(Cye),HH=jE.f("asyncIterator"),kye=a(HH);function Hx(n,i){this.v=n,this.k=i}function Pb(n){var i,s;function c(h,p){try{var v=n[h](p),y=v.value,S=y instanceof Hx;Gx.resolve(S?y.v:y).then(function(b){if(S){var R=h==="return"?"return":"next";if(!y.k||b.done)return c(R,b);b=n[R](b).value}l(v.done?"return":"normal",b)},function(b){c("throw",b)})}catch(b){l("throw",b)}}function l(h,p){switch(h){case"return":i.resolve({value:p,done:!0});break;case"throw":i.reject(p);break;default:i.resolve({value:p,done:!1})}(i=i.next)?c(i.key,i.arg):s=null}this._invoke=function(h,p){return new Gx(function(v,y){var S={key:h,arg:p,resolve:v,reject:y,next:null};s?s=s.next=S:(i=s=S,c(h,p))})},typeof n.return!="function"&&(this.return=void 0)}function wl(n){return function(){return new Pb(n.apply(this,arguments))}}function Wn(n){return new Hx(n,0)}function bk(n){var i={},s=!1;function c(l,h){return s=!0,{done:!1,value:new Hx(h=new Gx(function(p){p(n[l](h))}),1)}}return i[zE!==void 0&&yH||"@@iterator"]=function(){return this},i.next=function(l){return s?(s=!1,l):c("next",l)},typeof n.throw=="function"&&(i.throw=function(l){if(s)throw s=!1,l;return c("throw",l)}),typeof n.return=="function"&&(i.return=function(l){return s?(s=!1,l):c("return",l)}),i}Pb.prototype[typeof zE=="function"&&kye||"@@asyncIterator"]=function(){return this},Pb.prototype.next=function(n){return this._invoke("next",n)},Pb.prototype.throw=function(n){return this._invoke("throw",n)},Pb.prototype.return=function(n){return this._invoke("return",n)};var Kx=a(HH);function qx(n){var i,s,c,l=2;for(typeof Symbol<"u"&&(s=Kx,c=Symbol.iterator);l--;){if(s&&(i=n[s])!=null)return i.call(n);if(c&&(i=n[c])!=null)return new wk(i.call(n));s="@@asyncIterator",c="@@iterator"}throw new TypeError("Object is not async iterable")}function wk(n){function i(s){if(Object(s)!==s)return pt.reject(new TypeError(s+" is not an object."));var c=s.done;return pt.resolve(s.value).then(function(l){return{value:l,done:c}})}return wk=function(s){this.s=s,this.n=s.next},wk.prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(s){var c=this.s.return;return c===void 0?pt.resolve({value:s,done:!0}):i(c.apply(this.s,arguments))},throw:function(s){var c=this.s.return;return c===void 0?pt.reject(s):i(c.apply(this.s,arguments))}},new wk(n)}const Oye=function*(n,i){let s=n.byteLength;if(!i||s<i)return void(yield n);let c,l=0;for(;l<s;)c=l+i,yield n.slice(l,c),l=c},Pye=function(){var n=wl(function*(i,s){var c,l=!1,h=!1;try{for(var p,v=qx(Nye(i));l=!(p=yield Wn(v.next())).done;l=!1){const y=p.value;yield*bk(qx(Oye(y,s)))}}catch(y){h=!0,c=y}finally{try{l&&v.return!=null&&(yield Wn(v.return()))}finally{if(h)throw c}}});return function(i,s){return n.apply(this,arguments)}}(),Nye=function(){var n=wl(function*(i){if(i[Kx])return void(yield*bk(qx(i)));const s=i.getReader();try{for(;;){const{done:c,value:l}=yield Wn(s.read());if(c)break;yield l}}finally{yield Wn(s.cancel())}});return function(i){return n.apply(this,arguments)}}(),KH=(n,i,s,c)=>{const l=Pye(n,i);let h,p=0,v=y=>{h||(h=!0,c&&c(y))};return new ReadableStream({async pull(y){try{const{done:S,value:b}=await l.next();if(S)return v(),void y.close();let R=b.byteLength;if(s){let O=p+=R;s(O)}y.enqueue(new Uint8Array(b))}catch(S){throw v(S),S}},cancel:y=>(v(y),l.return())},{highWaterMark:2})};function qH(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function $H(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?qH(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):qH(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}const Ck=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",YH=Ck&&typeof ReadableStream=="function",Dye=Ck&&(typeof TextEncoder=="function"?(XH=new TextEncoder,n=>XH.encode(n)):async n=>new Uint8Array(await new Response(n).arrayBuffer()));var XH;const JH=function(n){try{for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];return!!n(...s)}catch{return!1}},Lye=YH&&JH(()=>{let n=!1;const i=new Request(Pc.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!i}),$x=YH&&JH(()=>ft.isReadableStream(new Response("").body)),Rk={stream:$x&&(n=>n.body)};var QH;Ck&&(QH=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(n=>{!Rk[n]&&(Rk[n]=ft.isFunction(QH[n])?i=>i[n]():(i,s)=>{throw new Sr("Response type '".concat(n,"' is not supported"),Sr.ERR_NOT_SUPPORT,s)})}));const xye=async(n,i)=>{const s=ft.toFiniteNumber(n.getContentLength());return s??(async c=>c==null?0:ft.isBlob(c)?c.size:ft.isSpecCompliantForm(c)?(await new Request(Pc.origin,{method:"POST",body:c}).arrayBuffer()).byteLength:ft.isArrayBufferView(c)||ft.isArrayBuffer(c)?c.byteLength:(ft.isURLSearchParams(c)&&(c+=""),ft.isString(c)?(await Dye(c)).byteLength:void 0))(i)};var Mye=Ck&&(async n=>{let{url:i,method:s,data:c,signal:l,cancelToken:h,timeout:p,onDownloadProgress:v,onUploadProgress:y,responseType:S,headers:b,withCredentials:R="same-origin",fetchOptions:O}=GH(n);S=S?(S+"").toLowerCase():"text";let N,Y=wye([l,h&&h.toAbortSignal()],p);const W=Y&&Y.unsubscribe&&(()=>{Y.unsubscribe()});let H;try{if(y&&Lye&&s!=="get"&&s!=="head"&&(H=await xye(b,c))!==0){let we,Se=new Request(i,{method:"POST",body:c,duplex:"half"});if(ft.isFormData(c)&&(we=Se.headers.get("content-type"))&&b.setContentType(we),Se.body){const[Le,et]=FH(H,Tk(jH(y)));c=KH(Se.body,65536,Le,et)}}ft.isString(R)||(R=R?"include":"omit");const ne="credentials"in Request.prototype;N=new Request(i,$H($H({},O),{},{signal:Y,method:s.toUpperCase(),headers:b.normalize().toJSON(),body:c,duplex:"half",credentials:ne?R:void 0}));let re=await fetch(N);const me=$x&&(S==="stream"||S==="response");if($x&&(v||me&&W)){const we={};["status","statusText","headers"].forEach(mt=>{we[mt]=re[mt]});const Se=ft.toFiniteNumber(re.headers.get("content-length")),[Le,et]=v&&FH(Se,Tk(jH(v),!0))||[];re=new Response(KH(re.body,65536,Le,()=>{et&&et(),W&&W()}),we)}S=S||"text";let be=await Rk[ft.findKey(Rk,S)||"text"](re,n);return!me&&W&&W(),await new pt((we,Se)=>{VH(we,Se,{data:be,headers:Yd.from(re.headers),status:re.status,statusText:re.statusText,config:n,request:N})})}catch(ne){throw W&&W(),ne&&ne.name==="TypeError"&&/fetch/i.test(ne.message)?Object.assign(new Sr("Network Error",Sr.ERR_NETWORK,n,N),{cause:ne.cause||ne}):Sr.from(ne,ne&&ne.code,n,N)}});const Yx={http:null,xhr:bye,fetch:Mye};ft.forEach(Yx,(n,i)=>{if(n){try{Object.defineProperty(n,"name",{value:i})}catch{}Object.defineProperty(n,"adapterName",{value:i})}});const ZH=n=>"- ".concat(n),Uye=n=>ft.isFunction(n)||n===null||n===!1;var e9={getAdapter:n=>{n=ft.isArray(n)?n:[n];const{length:i}=n;let s,c;const l={};for(let h=0;h<i;h++){let p;if(s=n[h],c=s,!Uye(s)&&(c=Yx[(p=String(s)).toLowerCase()],c===void 0))throw new Sr("Unknown adapter '".concat(p,"'"));if(c)break;l[p||"#"+h]=c}if(!c){const h=Object.entries(l).map(p=>{let[v,y]=p;return"adapter ".concat(v," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new Sr("There is no suitable adapter to dispatch the request "+(i?h.length>1?`since :
`+h.map(ZH).join(`
`):" "+ZH(h[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return c},adapters:Yx};function Xx(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new GE(null,n)}function t9(n){return Xx(n),n.headers=Yd.from(n.headers),n.data=zx.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),e9.getAdapter(n.adapter||Bx.adapter)(n).then(function(i){return Xx(n),i.data=zx.call(n,n.transformResponse,i),i.headers=Yd.from(i.headers),i},function(i){return UH(i)||(Xx(n),i&&i.response&&(i.response.data=zx.call(n,n.transformResponse,i.response),i.response.headers=Yd.from(i.response.headers))),pt.reject(i)})}const n9="1.7.9",Ik={};["object","boolean","number","function","string","symbol"].forEach((n,i)=>{Ik[n]=function(s){return typeof s===n||"a"+(i<1?"n ":" ")+n}});const r9={};Ik.transitional=function(n,i,s){function c(l,h){return"[Axios v"+n9+"] Transitional option '"+l+"'"+h+(s?". "+s:"")}return(l,h,p)=>{if(n===!1)throw new Sr(c(h," has been removed"+(i?" in "+i:"")),Sr.ERR_DEPRECATED);return i&&!r9[h]&&(r9[h]=!0,console.warn(c(h," has been deprecated since v"+i+" and will be removed in the near future"))),!n||n(l,h,p)}},Ik.spelling=function(n){return(i,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(n)),!0)};var Ak={assertOptions:function(n,i,s){if(typeof n!="object")throw new Sr("options must be an object",Sr.ERR_BAD_OPTION_VALUE);const c=Object.keys(n);let l=c.length;for(;l-- >0;){const h=c[l],p=i[h];if(p){const v=n[h],y=v===void 0||p(v,h,n);if(y!==!0)throw new Sr("option "+h+" must be "+y,Sr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new Sr("Unknown option "+h,Sr.ERR_BAD_OPTION)}},validators:Ik};const Uh=Ak.validators;let kk=class{constructor(n){this.defaults=n,this.interceptors={request:new cG,response:new cG}}async request(n,i){try{return await this._request(n,i)}catch(s){if(s instanceof Error){let c={};Error.captureStackTrace?Error.captureStackTrace(c):c=new Error;const l=c.stack?c.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(n,i){typeof n=="string"?(i=i||{}).url=n:i=n||{},i=Zv(this.defaults,i);const{transitional:s,paramsSerializer:c,headers:l}=i;s!==void 0&&Ak.assertOptions(s,{silentJSONParsing:Uh.transitional(Uh.boolean),forcedJSONParsing:Uh.transitional(Uh.boolean),clarifyTimeoutError:Uh.transitional(Uh.boolean)},!1),c!=null&&(ft.isFunction(c)?i.paramsSerializer={serialize:c}:Ak.assertOptions(c,{encode:Uh.function,serialize:Uh.function},!0)),Ak.assertOptions(i,{baseUrl:Uh.spelling("baseURL"),withXsrfToken:Uh.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let h=l&&ft.merge(l.common,l[i.method]);l&&ft.forEach(["delete","get","head","post","put","patch","common"],N=>{delete l[N]}),i.headers=Yd.concat(h,l);const p=[];let v=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(i)===!1||(v=v&&N.synchronous,p.unshift(N.fulfilled,N.rejected))});const y=[];let S;this.interceptors.response.forEach(function(N){y.push(N.fulfilled,N.rejected)});let b,R=0;if(!v){const N=[t9.bind(this),void 0];for(N.unshift.apply(N,p),N.push.apply(N,y),b=N.length,S=pt.resolve(i);R<b;)S=S.then(N[R++],N[R++]);return S}b=p.length;let O=i;for(R=0;R<b;){const N=p[R++],Y=p[R++];try{O=N(O)}catch(W){Y.call(this,W);break}}try{S=t9.call(this,O)}catch(N){return pt.reject(N)}for(R=0,b=y.length;R<b;)S=S.then(y[R++],y[R++]);return S}getUri(n){return aG(BH((n=Zv(this.defaults,n)).baseURL,n.url),n.params,n.paramsSerializer)}};ft.forEach(["delete","get","head","options"],function(n){kk.prototype[n]=function(i,s){return this.request(Zv(s||{},{method:n,url:i,data:(s||{}).data}))}}),ft.forEach(["post","put","patch"],function(n){function i(s){return function(c,l,h){return this.request(Zv(h||{},{method:n,headers:s?{"Content-Type":"multipart/form-data"}:{},url:c,data:l}))}}kk.prototype[n]=i(),kk.prototype[n+"Form"]=i(!0)});var Ok=kk;class Jx{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let s;this.promise=new pt(function(l){s=l});const c=this;this.promise.then(l=>{if(!c._listeners)return;let h=c._listeners.length;for(;h-- >0;)c._listeners[h](l);c._listeners=null}),this.promise.then=l=>{let h;const p=new pt(v=>{c.subscribe(v),h=v}).then(l);return p.cancel=function(){c.unsubscribe(h)},p},i(function(l,h,p){c.reason||(c.reason=new GE(l,h,p),s(c.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){this.reason?i(this.reason):this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const s=this._listeners.indexOf(i);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const i=new AbortController,s=c=>{i.abort(c)};return this.subscribe(s),i.signal.unsubscribe=()=>this.unsubscribe(s),i.signal}static source(){let i;return{token:new Jx(function(c){i=c}),cancel:i}}}var Vye=Jx;const Qx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Qx).forEach(n=>{let[i,s]=n;Qx[s]=i});var Fye=Qx;const Ko=function n(i){const s=new Ok(i),c=zz(Ok.prototype.request,s);return ft.extend(c,Ok.prototype,s,{allOwnKeys:!0}),ft.extend(c,s,null,{allOwnKeys:!0}),c.create=function(l){return n(Zv(i,l))},c}(Bx);Ko.Axios=Ok,Ko.CanceledError=GE,Ko.CancelToken=Vye,Ko.isCancel=UH,Ko.VERSION=n9,Ko.toFormData=uk,Ko.AxiosError=Sr,Ko.Cancel=Ko.CanceledError,Ko.all=function(n){return pt.all(n)},Ko.spread=function(n){return function(i){return n.apply(null,i)}},Ko.isAxiosError=function(n){return ft.isObject(n)&&n.isAxiosError===!0},Ko.mergeConfig=Zv,Ko.AxiosHeaders=Yd,Ko.formToJSON=n=>xH(ft.isHTMLForm(n)?new FormData(n):n),Ko.getAdapter=e9.getAdapter,Ko.HttpStatusCode=Fye,Ko.default=Ko;var tc=Ko;const jye=()=>{};function Nb(){const n={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:jye};return n.promise=new pt((i,s)=>{n.resolve=c=>{n.isFinished||(n.isResolved=!0,n.isFinished=!0,i(c),n.value=c)},n.reject=c=>{n.isFinished||(n.isRejected=!0,n.isFinished=!0,s(c))}}),n}const Pk=new Map,Nk=new Map,Vh=new Map;let ws=function(n){return n.WIN_10="Windows 10",n.WIN_81="Windows 8.1",n.WIN_8="Windows 8",n.WIN_7="Windows 7",n.WIN_VISTA="Windows Vista",n.WIN_SERVER_2003="Windows Server 2003",n.WIN_XP="Windows XP",n.WIN_2000="Windows 2000",n.ANDROID="Android",n.HARMONY_OS="HarmonyOS",n.OPEN_BSD="Open BSD",n.SUN_OS="Sun OS",n.LINUX="Linux",n.IOS="iOS",n.MAC_OS="Mac OS",n.CHROMIUM_OS="Chromium OS",n.QNX="QNX",n.UNIX="UNIX",n.BEOS="BeOS",n.OS_2="OS/2",n.SEARCH_BOT="Search Bot",n}({}),nr=function(n){return n.CHROME="Chrome",n.SAFARI="Safari",n.EDGE="Edge",n.FIREFOX="Firefox",n.OPERA="OPR",n.QQ="QQBrowser",n.WECHAT="MicroMessenger",n}({});const i9=new rge;let Xd=i9.getResult(),Zx=null;function zn(n){if(!Zx){Xd=i9.getResult();const i=function(v){if(v.engine.name==="Blink"&&v.browser.name!=="WeChat")return nr.CHROME;switch(v.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return nr.CHROME;case"Safari":case"Mobile Safari":return nr.SAFARI;case"Edge":return nr.EDGE;case"Firefox":return nr.FIREFOX;case"QQ":case"QQBrowser":return nr.QQ;case"Opera":return nr.OPERA;case"WeChat":return nr.WECHAT;default:return v.browser.name||""}}(Xd),s=s9(Xd),c=function(v){return v.os.name==="Windows"?v.os.version?v.os.name+" "+v.os.version:v.os.name:v.os.name||""}(Xd),l=Xd.os.version,h=s9(Xd,!1),p=Xd.device.type;if(!(i&&s&&c&&l))return{name:i,version:s,os:c,osVersion:l,browserVersion:h,deviceType:p};Zx={name:i,version:s,os:c,osVersion:l,browserVersion:h,deviceType:p}}return Zx}function s9(n){let i,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return i=n.engine.name==="Blink"?n.engine.version||"":n.browser.version||"",s?i.split(".")[0]:i}function Dk(){return zn().os}function o9(){const n=zn();return"".concat(n.os," ").concat(n.osVersion)}function Lk(){const n=zn();return!!(Xd.engine.name==="WebKit"&&n.os===ws.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&n.name!==nr.SAFARI||Na()&&n.name!==nr.SAFARI)}function cp(){return zn().name===nr.CHROME}function uo(){return zn().name===nr.SAFARI}function a9(){return zn().name===nr.EDGE}function gi(){return zn().name===nr.FIREFOX}function Na(){return zn().os===ws.IOS}function Db(n){const i=zn();return!(i.name!==nr.CHROME||!i.osVersion)&&Number(i.version)>=n}function c9(n){const i=zn();return!(i.name!==nr.CHROME||!i.osVersion)&&Number(i.version)<n}function eM(n,i,s){const c=zn();return!(c.name!==n||!c.osVersion)&&(s?Number(c.version)>=i&&Number(c.version)<=s:Number(c.version)===i)}function tM(n){const i=zn();return!(i.name!==nr.EDGE||!i.osVersion)&&Number(i.version)>=n}function u9(n){const i=zn();return!(i.name!==nr.SAFARI||!i.osVersion)&&Number(i.version)>=n}function l9(n,i,s){const c=zn();if(c.os!==ws.IOS||!c.osVersion)return!1;const l=c.osVersion.split(".");return i&&Number(l[0])===n&&Number(l[1])<i||Number(l[0])<n}function d9(n,i,s){const c=zn();if(c.name!==nr.SAFARI||!c.osVersion||!c.browserVersion)return!1;const l=c.browserVersion.split(".");return s?i&&Number(l[0])===n&&Number(l[1])<i||Number(l[0])<n:i?Number(l[0])===n&&Number(l[1])<=i||Number(l[0])<n:Number(l[0])<=n}function nM(n){const i=zn();return!(i.name!==nr.OPERA||!i.osVersion)&&Number(i.version)>=n}function h9(){const n=zn();if(n.os!==ws.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return Number(i[0])<14||Number(i[0])===14&&Number(i[1])<=6}function HE(){const n=zn();if(n.os!==ws.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return Number(i[0])===15}function rM(){const n=zn();if(n.os!==ws.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return Number(i[0])===16}function f9(){const n=zn();if(n.os!==ws.IOS||!n.osVersion)return!1;const i=n.osVersion.split(".");return Number(i[0])===15&&Number(i[1])>=1}function sd(){return uo()&&navigator.maxTouchPoints>0}function p9(){return zn().name===nr.WECHAT}function m9(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function iM(){const n=Dk();return function(){const{deviceType:i}=zn();return i==="mobile"||i==="tablet"}()||n===ws.ANDROID||n===ws.IOS||n===ws.HARMONY_OS}function up(){const n=zn();return n.name!==nr.EDGE&&n.name!==nr.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function xk(){return Dk()===ws.ANDROID}function Lb(){const n=zn();return xk()&&(n.name===nr.CHROME||n.name===nr.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function g9(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function Tt(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?g9(Object(s),!0).forEach(function(c){sn(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):g9(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function sn(n,i,s){return(i=function(c){var l=function(h,p){if(typeof h!="object"||h===null)return h;var v=h[Symbol.toPrimitive];if(v!==void 0){var y=v.call(h,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(h)}(c);return typeof l=="symbol"?l:String(l)}(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}let ie=function(n){return n.UNEXPECTED_ERROR="UNEXPECTED_ERROR",n.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",n.TIMEOUT="TIMEOUT",n.INVALID_PARAMS="INVALID_PARAMS",n.NOT_READABLE="NOT_READABLE",n.NOT_SUPPORTED="NOT_SUPPORTED",n.INVALID_OPERATION="INVALID_OPERATION",n.OPERATION_ABORTED="OPERATION_ABORTED",n.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",n.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",n.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",n.DATACHANNEL_FAILED="DATACHANNEL_FAILED",n.NETWORK_ERROR="NETWORK_ERROR",n.NETWORK_TIMEOUT="NETWORK_TIMEOUT",n.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",n.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",n.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",n.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",n.ELECTRON_IS_NULL="ELECTRON_IS_NULL",n.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",n.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",n.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",n.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",n.PERMISSION_DENIED="PERMISSION_DENIED",n.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",n.TRACK_IS_DISABLED="TRACK_IS_DISABLED",n.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",n.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",n.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",n.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",n.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",n.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",n.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",n.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",n.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",n.UID_CONFLICT="UID_CONFLICT",n.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",n.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",n.TOKEN_EXPIRE="TOKEN_EXPIRE",n.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",n.INVALID_TRACK="INVALID_TRACK",n.SENDER_NOT_FOUND="SENDER_NOT_FOUND",n.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",n.SET_ANSWER_FAILED="SET_ANSWER_FAILED",n.ICE_FAILED="ICE_FAILED",n.PC_CLOSED="PC_CLOSED",n.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",n.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",n.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",n.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",n.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",n.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",n.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",n.INVALID_REMOTE_USER="INVALID_REMOTE_USER",n.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",n.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",n.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",n.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",n.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",n.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",n.WS_ABORT="WS_ABORT",n.WS_DISCONNECT="WS_DISCONNECT",n.WS_ERR="WS_ERR",n.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",n.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",n.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",n.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",n.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",n.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",n.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",n.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",n.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",n.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",n.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",n.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",n.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",n.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",n.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",n.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",n.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",n.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",n.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",n.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",n.INVALID_PLUGIN="INVALID_PLUGIN",n.DISCONNECT_P2P="DISCONNECT_P2P",n.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",n.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",n.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",n.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",n.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",n.PROHIBITED_OPERATION="PROHIBITED_OPERATION",n.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",n.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",n}({}),Fe=class extends Error{constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(i),sn(this,"code",void 0),sn(this,"message",void 0),sn(this,"data",void 0),sn(this,"name","AgoraRTCException"),this.code=n,this.message="AgoraRTCError ".concat(this.code,": ").concat(i),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",i=arguments.length>1?arguments[1]:void 0;return n==="error"&&(i||console).error(this.toString()),n==="warning"&&(i||console).warn(this.toString()),this}throw(n){throw this.print("error",n),this}};function lp(n,i){if(typeof n!="boolean")throw new Fe(ie.INVALID_PARAMS,"Invalid ".concat(i,": The value is of the boolean type."))}function vs(n,i,s){if(!dt(s).call(s,n))throw new Fe(ie.INVALID_PARAMS,"".concat(i," can only be set as ").concat(JSON.stringify(s)))}function Tr(n,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(n<s||n>c||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(l){return typeof l=="number"&&l%1==0}(n))throw new Fe(ie.INVALID_PARAMS,"invalid ".concat(i,": the value range is [").concat(s,", ").concat(c,"]. integer only"))}function sM(n,i){if(typeof n!="number"){if(!(n.min||n.max||n.ideal||n.exact))throw new Fe(ie.INVALID_PARAMS,"".concat(i," is not a valid ConstrainLong"));n.min!==void 0&&Tr(n.min,"".concat(i,".min"),0,1/0),n.max!==void 0&&Tr(n.max,"".concat(i,".max"),1,1/0),n.exact!==void 0&&Tr(n.exact,"".concat(i,".exact"),1,1/0),n.ideal!==void 0&&Tr(n.ideal,"".concat(i,".ideal"),1,1/0)}else Tr(n,i,1,1/0)}function qs(n,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,l=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(n==null)throw new Fe(ie.INVALID_PARAMS,"".concat(i||"param"," cannot be empty"));if(!v9(n,s,c,l))throw new Fe(ie.INVALID_PARAMS,"Invalid ".concat(i||"string param",": Length of the string: [").concat(s,",").concat(c,"].").concat(l?" ASCII characters only.":""))}function dp(n,i){if(!Array.isArray(n))throw new Fe(ie.INVALID_PARAMS,"".concat(i," should be an array"))}function vi(n){return n==null}function v9(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,c=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof n=="string"&&n.length<=s&&n.length>=i&&(!c||function(l){if(typeof l!="string")return!1;for(let h=0;h<l.length;h+=1){const p=l.charCodeAt(h);if(p<0||p>255)return!1}return!0}(n))}var xb=function(n){return n.COVERED="COVERED",n.POSITION="POSITION",n.SIZE="SIZE",n.STYLE="STYLE",n}(xb||{}),oM=function(n){return n.UNMOUNTED="UNMOUNTED",n.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",n}(oM||{});const _9=new class{constructor(){sn(this,"_clientSize",null),sn(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),sn(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),sn(this,"getStyle",n=>window.getComputedStyle(n,null)),sn(this,"checkCssVisibleProperty",n=>{var i;let s=!0;const c=this.getStyle(n),{display:l,visibility:h,opacity:p,filter:v}=c;return(l==="none"||dt(i=["hidden","collapse"]).call(i,h)||Number(p)<.1)&&(s=!1),!!s&&(v&&v.split(" ").filter(y=>{var S;const b=y.split("(")[0];return dt(S=["brightness","blur","opacity"]).call(S,b)}).map(y=>{const[S,b]=y.split(/\(|\)/);return[S,Number(b.match(/^[0-9\.]+/))]}).forEach(y=>{const[S,b]=y;switch(S){case"brightness":(b<.1||b>3)&&(s=!1);break;case"blur":b>3&&(s=!1);break;case"opacity":b<.1&&(s=!1)}}),s)}),sn(this,"checkPropertyUpToAllParentNodes",(n,i)=>{let s=!0,c=!0;const l=p=>i(p);let h=n;for(;h&&c;)l(h)||(s=!1,c=!1),h=h.parentElement,h||(c=!1);return s}),sn(this,"checkActualCssVisibleIncludeInherit",n=>this.checkPropertyUpToAllParentNodes(n,this.checkCssVisibleProperty)),sn(this,"getSizeAboutClient",n=>{const{width:i,height:s,left:c,right:l,top:h,bottom:p}=n.getBoundingClientRect(),v=this.getClientWidth(),y=this.getClientHeight();return{width:i,height:s,left:c,right:l,top:h,bottom:p,clientWidth:v,clientHeight:y,clientMin:Math.min(v,y)}}),sn(this,"checkActualSize",()=>{const{width:n,height:i,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(n,i,s)}),sn(this,"elementFromPoint",(n,i)=>document.elementFromPoint?document.elementFromPoint(n,i):null),sn(this,"checkCoverForAPoint",(n,i,s)=>{const c=this.elementFromPoint(n,i);return c!==null&&c!==s}),sn(this,"getPointPositionList",()=>{const{width:n,height:i,left:s,top:c}=this._clientSize,l=n/6,h=i/6,p=[],v=10**6;for(let y=0;y<5;y++)for(let S=0;S<5;S++){const b=(s*v+(y===0?.1:y===4?(l*y*v-1e5)/v:l*y)*v)/v,R=(c*v+(S===0?.1:S===4?(h*S*v-1e5)/v:h*S)*v)/v;p.push({x:b,y:R})}return[...p]}),sn(this,"checkElementCover",n=>this.getPointPositionList().map(i=>this.checkCoverForAPoint(i.x,i.y,n)).filter(i=>!!i).length>6),sn(this,"checkSizeIsVisible",(n,i,s)=>(n>50||s/n<=10)&&(i>50||s/i<=10)),sn(this,"checkSizeOfPartInClient",()=>{const{left:n,right:i,top:s,bottom:c,clientHeight:l,clientWidth:h,clientMin:p}=this._clientSize;let v,y,S,b;if(n<0)v=0;else{if(!(n<h))return!1;v=n}if(i<0)return!1;if(y=i<h?i:h,s<0)S=0;else{if(!(s<l))return!1;S=s}if(c<0)return!1;b=c<l?c:l;const R=y-v,O=b-S;return this.checkSizeIsVisible(R,O,p)}),sn(this,"returnHiddenResult",n=>(this._clientSize=null,{visible:!1,reason:n})),sn(this,"checkOneElementVisible",n=>{if(n instanceof HTMLElement){if(this.checkElementIsMountedOnDom(n)){if(this.checkActualCssVisibleIncludeInherit(n)){if(this._clientSize=this.getSizeAboutClient(n),this.checkElementCover(n))return this.returnHiddenResult(xb.COVERED);{const i=this.checkActualSize(),s=this.checkSizeOfPartInClient();return i&&!s?this.returnHiddenResult(xb.POSITION):i?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(xb.SIZE)}}return this.returnHiddenResult(xb.STYLE)}return this.returnHiddenResult(oM.UNMOUNTED)}return this.returnHiddenResult(oM.INVALID_HTML_ELEMENT)}),sn(this,"checkElementIsMountedOnDom",n=>this.checkPropertyUpToAllParentNodes(n,i=>i.nodeName.toUpperCase()!=="HTML"?i.parentElement!==null:!!document.documentElement))}};function aM(n){return new TextEncoder().encode(n)}const y9=function(n,i){const s=new Uint8Array(n.byteLength+i.byteLength);return s.set(new Uint8Array(n),0),s.set(new Uint8Array(i),n.byteLength),s},cM=async n=>function(i,s){let c="";return new Uint8Array(i).forEach(l=>{c+=l.toString(s).padStart(2,"0")}),c}(await crypto.subtle.digest("SHA-256",aM(n)),16);let li=class{constructor(){sn(this,"_events",{}),sn(this,"addListener",this.on)}getListeners(n){return this._events[n]?this._events[n].map(i=>i.listener):[]}on(n,i){this._events[n]||(this._events[n]=[]);const s=this._events[n];this._indexOfListener(s,i)===-1&&s.push({listener:i,once:!1})}once(n,i){this._events[n]||(this._events[n]=[]);const s=this._events[n];this._indexOfListener(s,i)===-1&&s.push({listener:i,once:!0})}off(n,i){if(!this._events[n])return;const s=this._events[n],c=this._indexOfListener(s,i);c!==-1&&s.splice(c,1),this._events[n].length===0&&delete this._events[n]}removeAllListeners(n){n?delete this._events[n]:this._events={}}emit(n){this._events[n]||(this._events[n]=[]);const i=this._events[n].map(h=>h);for(var s=arguments.length,c=new Array(s>1?s-1:0),l=1;l<s;l++)c[l-1]=arguments[l];for(let h=0;h<i.length;h+=1){const p=i[h];p.once&&this.off(n,p.listener),p.listener.apply(this,c||[])}}safeEmit(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];[...this._events[n]||[]].forEach(l=>{l.once&&this.off(n,l.listener);try{l.listener.apply(this,s)}catch(h){console.error("safeEmit event:".concat(n," error ").concat(h==null?void 0:h.toString()))}})}_indexOfListener(n,i){let s=n.length;for(;s--;)if(n[s].listener===i)return s;return-1}},Mb=null;function E9(){if(Mb)return Mb;if(window.electron)return Mb=window.electron;if(!window.require)return null;try{return Mb=window.require("electron"),Mb}catch{return null}}let is=function(n){return n.CREATE_CLIENT="createClient",n.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",n.SET_AREA="setArea",n.PRELOAD="PRELOAD",n.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",n.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",n.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",n.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",n.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",n.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",n.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",n.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",n.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",n.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",n.START_PROXY_SERVER="Client.startProxyServer",n.STOP_PROXY_SERVER="Client.stopProxyServer",n.SET_PROXY_SERVER="Client.setProxyServer",n.SET_TURN_SERVER="Client.setTurnServer",n.SET_CLIENT_ROLE="Client.setClientRole",n.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",n.ENABLE_DUAL_STREAM="Client.enableDualStream",n.DISABLE_DUAL_STREAM="Client.disableDualStream",n.JOIN="Client.join",n.LEAVE="Client.leave",n.PUBLISH="Client.publish",n.UNPUBLISH="Client.unpublish",n.SUBSCRIBE="Client.subscribe",n.MASS_SUBSCRIBE="Client.massSubscribe",n.MASS_UNSUBSCRIBE="Client.massUnsubscribe",n.UNSUBSCRIBE="Client.unsubscribe",n.RENEW_TOKEN="Client.renewToken",n.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",n.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",n.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",n.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",n.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",n.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",n.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",n.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",n.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",n.START_LIVE_STREAMING="Client.startLiveStreaming",n.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",n.STOP_LIVE_STREAMING="Client.stopLiveStreaming",n.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",n.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",n.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",n.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",n.SET_CONFIG_DISTRIBUTE="_configDistribute",n.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",n.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",n.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",n.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",n.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",n.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",n.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",n.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",n.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",n.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",n.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",n.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",n.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",n.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",n.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",n.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",n.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",n.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",n.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",n.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",n.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",n.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",n.STREAM_TYPE_CHANGE="streamTypeChange",n.CONNECTION_STATE_CHANGE="connectionStateChange",n.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",n.IMAGE_MODERATION_UPLOAD="imageModerationUpload",n.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",n}({}),_i=function(n){return n.TRACER="tracer",n}({});function S9(n){return Tr(n.timeout,"config.timeout",0,1e5),Tr(n.timeoutFactor,"config.timeoutFactor",0,100,!1),Tr(n.maxRetryCount,"config.maxRetryConfig",0,1/0),Tr(n.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Bye=function(n){return n[n.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",n[n.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",n[n.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",n}({}),cr=function(n){return n.LEAVE="LEAVE",n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.UID_BANNED="UID_BANNED",n.FALLBACK="FALLBACK",n.IP_BANNED="IP_BANNED",n.CHANNEL_BANNED="CHANNEL_BANNED",n.LICENSE_MISSING="LICENSE_MISSING",n.LICENSE_EXPIRED="LICENSE_EXPIRED",n.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",n.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",n.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",n.LICENSE_ILLEGAL="LICENSE_ILLEGAL",n.TOKEN_EXPIRE="TOKEN_EXPIRE",n}({});function Ub(n){if(!Array.isArray(n)||n.length<1)return!1;try{n.forEach(i=>{if(!i.urls)throw Error()})}catch{return!1}return!0}function T9(n){return qs(n.turnServerURL,"turnServerURL"),qs(n.username,"username"),qs(n.password,"password"),n.udpport&&Tr(n.udpport,"udpport",1,99999,!0),n.forceturn&&lp(n.forceturn,"forceturn"),n.security&&lp(n.security,"security"),n.tcpport&&Tr(n.tcpport,"tcpport",1,99999,!0),!0}function uM(n){return n.level!==void 0&&vs(n.level,"level",[1,2,3]),n.delay!==void 0&&Tr(n.delay,"delay",0,3e3,!0),!0}let kn=function(n){return n.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",n.AUDIO_METADATA="audio-metadata",n.CONNECTION_STATE_CHANGE="connection-state-change",n.MEDIA_RECONNECT_START="media-reconnect-start",n.MEDIA_RECONNECT_END="media-reconnect-end",n.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",n.USER_JOINED="user-joined",n.USER_LEAVED="user-left",n.USER_PUBLISHED="user-published",n.USER_UNPUBLISHED="user-unpublished",n.USER_INFO_UPDATED="user-info-updated",n.CLIENT_BANNED="client-banned",n.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",n.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",n.VOLUME_INDICATOR="volume-indicator",n.CRYPT_ERROR="crypt-error",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGED="stream-type-changed",n.STREAM_FALLBACK="stream-fallback",n.RECEIVE_METADATA="receive-metadata",n.STREAM_MESSAGE="stream-message",n.LIVE_STREAMING_ERROR="live-streaming-error",n.LIVE_STREAMING_WARNING="live-streaming-warning",n.EXCEPTION="exception",n.ERROR="error",n.P2P_LOST="p2p_lost",n.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",n.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",n.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",n.PUBLISHED_USER_LIST="published-user-list",n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",n.CONTENT_INSPECT_ERROR="content-inspect-error",n.CONTENT_INSPECT_RESULT="content-inspect-result",n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",n}({}),lo=function(n){return n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK",n.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",n}({}),lu=function(n){return n.ONLINE="ONLINE",n.OFFLINE="OFFLINE",n}({}),KE=function(n){return n.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",n.ONLINE="ONLINE",n.OFFLINE="OFFLINE",n}({});function ho(n,i){for(var s=arguments.length,c=new Array(s>2?s-2:0),l=2;l<s;l++)c[l-2]=arguments[l];return n.getListeners(i).length===0?pt.reject(new Fe(ie.UNEXPECTED_ERROR,"can not emit promise")):new pt((h,p)=>{n.emit(i,...c,h,p)})}function Pr(n,i){if(n.getListeners(i).length===0)return pt.resolve();for(var s=arguments.length,c=new Array(s>2?s-2:0),l=2;l<s;l++)c[l-2]=arguments[l];return ho(n,i,...c)}function Bu(n,i){if(n.getListeners(i).length===0)return null;for(var s=arguments.length,c=new Array(s>2?s-2:0),l=2;l<s;l++)c[l-2]=arguments[l];return Vb(n,i,...c)}function Vb(n,i){let s=null,c=null;for(var l=arguments.length,h=new Array(l>2?l-2:0),p=2;p<l;p++)h[p-2]=arguments[p];if(n.emit(i,...h,v=>{s=v},v=>{c=v}),c!==null)throw c;if(s===null)throw new Fe(ie.UNEXPECTED_ERROR,"handler is not sync");return s}const $i=new class extends li{set networkState(n){this.emit(KE.NETWORK_STATE_CHANGE,n,this._networkState),n===lu.ONLINE?this.emit(KE.ONLINE):n===lu.OFFLINE&&(this.onlineWaiter=new pt(i=>{this.once(KE.ONLINE,()=>{this.onlineWaiter=void 0,i(lu.ONLINE)})}),this.emit(KE.OFFLINE)),this._networkState=n}get networkState(){return this._networkState}get isOnline(){return this._networkState===lu.ONLINE}constructor(){super(),sn(this,"_moduleName","network-indicator"),sn(this,"_networkState",lu.ONLINE),sn(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=lu.ONLINE}),window.addEventListener("offline",()=>{this.networkState=lu.OFFLINE})}};function Mk(n,i){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}function qE(n){const i=[];return n.forEach(s=>{i.indexOf(s)===-1&&i.push(s)}),i}function Uk(n){pt!==void 0?pt.resolve().then(n):setTimeout(n,0)}function yi(n){return JSON.parse(JSON.stringify(n))}function e_(n){try{return yi(n)}catch{return n}}const b9={};function Bm(n,i){b9[i]||(b9[i]=!0,n())}function t_(n){const i=window.atob(n),s=new Uint8Array(new ArrayBuffer(i.length));for(let c=0;c<i.length;c+=1)s[c]=i.charCodeAt(c);return s}function Wm(n){let i="";for(let s=0;s<n.length;s+=1)i+=String.fromCharCode(n[s]);return window.btoa(i)}function w9(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(n);if(s.length>i)s=s.slice(0,i);else if(s.length<i){const c=new Uint8Array(i);c.set(s),s=c}return s}function C9(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const c=nu(i).call(i,(p,v)=>p+v.length,0),l=new Uint8Array(new ArrayBuffer(c));let h=0;return i.forEach(p=>{l.set(p,h),h+=p.length}),l}function Fh(n){return window.TextEncoder?new TextEncoder().encode(n).length:n.length}function R9(n){let i=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&n.realFormData&&(n=n.realFormData),n.forEach(s=>{i+=typeof s=="string"?Fh(s):s.size}),i+138}function Wye(n){const i=new Fe(ie.TIMEOUT,"timeout");return new pt((s,c)=>{window.setTimeout(()=>c(i),n)})}function $s(n){return new pt(i=>{window.setTimeout(i,n)})}function Nr(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,i=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,n).toLowerCase();return s.length===n?"".concat(i).concat(s):"".concat(i).concat(s)+Nr(n-s.length,"")}function n_(){return Nr(32,"").toUpperCase()}const Vk=()=>{},I9=new class{constructor(){sn(this,"fnMap",new Map)}throttleByKey(n,i,s,c){for(var l=arguments.length,h=new Array(l>4?l-4:0),p=4;p<l;p++)h[p-4]=arguments[p];if(this.fnMap.has(i)){const v=this.fnMap.get(i);if(v.threshold!==s){v.fn(...v.args),clearTimeout(v.timer);const y=window.setTimeout(()=>{const S=this.fnMap.get(i);S&&S.fn(...S.args),this.fnMap.delete(i)},s);this.fnMap.set(i,{fn:n,threshold:s,timer:y,args:h,skipFn:c})}else v.skipFn&&v.skipFn(...v.args),this.fnMap.set(i,Tt(Tt({},v),{},{fn:n,args:h,skipFn:c}))}else{const v=window.setTimeout(()=>{const y=this.fnMap.get(i);y&&y.fn(...y.args),this.fnMap.delete(i)},s);this.fnMap.set(i,{fn:n,threshold:s,timer:v,args:h,skipFn:c})}}},A9=I9.throttleByKey.bind(I9);function k9(n){return typeof n=="object"&&n!==null&&!(n instanceof RegExp)}function lM(n,i){if(!k9(n)||!k9(i)||Array.isArray(n)&&!Array.isArray(i)||!Array.isArray(n)&&Array.isArray(i))return i;if(Array.isArray(i)&&Array.isArray(n)){const s=[...n];for(let c=0;c<i.length;c++)s[c]=lM(n[c],i[c]);return s}{const s=Tt({},n);for(const c in i)Object.prototype.hasOwnProperty.call(i,c)&&(Object.prototype.hasOwnProperty.call(n,c)?s[c]=lM(n[c],i[c]):s[c]=i[c]);return s}}function O9(n,i){let s=[0];if(s=new Array(i).fill(0),n===0)return s;let c=0;for(;n>0&&(s[c]=255&n,n>>=8,c++,c!==i););return s}function dM(n){return typeof n=="number"?n:n.exact||n.ideal||n.max||n.min||0}function P9(n){const i="0123456789abcdef";function s(me){let be,we="";for(be=0;be<=3;be++)we+=i.charAt(me>>8*be+4&15)+i.charAt(me>>8*be&15);return we}function c(me,be){const we=(65535&me)+(65535&be);return(me>>16)+(be>>16)+(we>>16)<<16|65535&we}function l(me,be,we,Se,Le,et){return c(function(mt,Et){return mt<<Et|mt>>>32-Et}(c(c(be,me),c(Se,et)),Le),we)}function h(me,be,we,Se,Le,et,mt){return l(be&we|~be&Se,me,be,Le,et,mt)}function p(me,be,we,Se,Le,et,mt){return l(be&Se|we&~Se,me,be,Le,et,mt)}function v(me,be,we,Se,Le,et,mt){return l(be^we^Se,me,be,Le,et,mt)}function y(me,be,we,Se,Le,et,mt){return l(we^(be|~Se),me,be,Le,et,mt)}const S=function(me){let be;const we=1+(me.length+8>>6),Se=new Array(16*we);for(be=0;be<16*we;be++)Se[be]=0;for(be=0;be<me.length;be++)Se[be>>2]|=me.charCodeAt(be)<<be%4*8;return Se[be>>2]|=128<<be%4*8,Se[16*we-2]=8*me.length,Se}(n);let b,R,O,N,Y,W=1732584193,H=-271733879,ne=-1732584194,re=271733878;for(b=0;b<S.length;b+=16)R=W,O=H,N=ne,Y=re,W=h(W,H,ne,re,S[b+0],7,-680876936),re=h(re,W,H,ne,S[b+1],12,-389564586),ne=h(ne,re,W,H,S[b+2],17,606105819),H=h(H,ne,re,W,S[b+3],22,-1044525330),W=h(W,H,ne,re,S[b+4],7,-176418897),re=h(re,W,H,ne,S[b+5],12,1200080426),ne=h(ne,re,W,H,S[b+6],17,-1473231341),H=h(H,ne,re,W,S[b+7],22,-45705983),W=h(W,H,ne,re,S[b+8],7,1770035416),re=h(re,W,H,ne,S[b+9],12,-1958414417),ne=h(ne,re,W,H,S[b+10],17,-42063),H=h(H,ne,re,W,S[b+11],22,-1990404162),W=h(W,H,ne,re,S[b+12],7,1804603682),re=h(re,W,H,ne,S[b+13],12,-40341101),ne=h(ne,re,W,H,S[b+14],17,-1502002290),H=h(H,ne,re,W,S[b+15],22,1236535329),W=p(W,H,ne,re,S[b+1],5,-165796510),re=p(re,W,H,ne,S[b+6],9,-1069501632),ne=p(ne,re,W,H,S[b+11],14,643717713),H=p(H,ne,re,W,S[b+0],20,-373897302),W=p(W,H,ne,re,S[b+5],5,-701558691),re=p(re,W,H,ne,S[b+10],9,38016083),ne=p(ne,re,W,H,S[b+15],14,-660478335),H=p(H,ne,re,W,S[b+4],20,-405537848),W=p(W,H,ne,re,S[b+9],5,568446438),re=p(re,W,H,ne,S[b+14],9,-1019803690),ne=p(ne,re,W,H,S[b+3],14,-187363961),H=p(H,ne,re,W,S[b+8],20,1163531501),W=p(W,H,ne,re,S[b+13],5,-1444681467),re=p(re,W,H,ne,S[b+2],9,-51403784),ne=p(ne,re,W,H,S[b+7],14,1735328473),H=p(H,ne,re,W,S[b+12],20,-1926607734),W=v(W,H,ne,re,S[b+5],4,-378558),re=v(re,W,H,ne,S[b+8],11,-2022574463),ne=v(ne,re,W,H,S[b+11],16,1839030562),H=v(H,ne,re,W,S[b+14],23,-35309556),W=v(W,H,ne,re,S[b+1],4,-1530992060),re=v(re,W,H,ne,S[b+4],11,1272893353),ne=v(ne,re,W,H,S[b+7],16,-155497632),H=v(H,ne,re,W,S[b+10],23,-1094730640),W=v(W,H,ne,re,S[b+13],4,681279174),re=v(re,W,H,ne,S[b+0],11,-358537222),ne=v(ne,re,W,H,S[b+3],16,-722521979),H=v(H,ne,re,W,S[b+6],23,76029189),W=v(W,H,ne,re,S[b+9],4,-640364487),re=v(re,W,H,ne,S[b+12],11,-421815835),ne=v(ne,re,W,H,S[b+15],16,530742520),H=v(H,ne,re,W,S[b+2],23,-995338651),W=y(W,H,ne,re,S[b+0],6,-198630844),re=y(re,W,H,ne,S[b+7],10,1126891415),ne=y(ne,re,W,H,S[b+14],15,-1416354905),H=y(H,ne,re,W,S[b+5],21,-57434055),W=y(W,H,ne,re,S[b+12],6,1700485571),re=y(re,W,H,ne,S[b+3],10,-1894986606),ne=y(ne,re,W,H,S[b+10],15,-1051523),H=y(H,ne,re,W,S[b+1],21,-2054922799),W=y(W,H,ne,re,S[b+8],6,1873313359),re=y(re,W,H,ne,S[b+15],10,-30611744),ne=y(ne,re,W,H,S[b+6],15,-1560198380),H=y(H,ne,re,W,S[b+13],21,1309151649),W=y(W,H,ne,re,S[b+4],6,-145523070),re=y(re,W,H,ne,S[b+11],10,-1120210379),ne=y(ne,re,W,H,S[b+2],15,718787259),H=y(H,ne,re,W,S[b+9],21,-343485551),W=c(W,R),H=c(H,O),ne=c(ne,N),re=c(re,Y);return s(W)+s(H)+s(ne)+s(re)}let zye=1,N9=console,Co=class{static setLogger(n){N9=n}constructor(n,i){sn(this,"id",void 0),sn(this,"lockingPromise",pt.resolve()),sn(this,"locks",0),sn(this,"name",""),sn(this,"lockId",void 0),this.lockId=zye++,n&&(this.name=n),i&&(this.id=i),this.logger("created")}logger(n,i){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),c=n==="created"?"is ".concat(n,"."):"is ".concat(n,", current queue ").concat(this.locks,". ").concat(i??"");N9.debug("".concat(s," ").concat(c))}setId(n){this.id=n}get isLocked(){return this.locks>0}lock(n){let i;this.locks+=1,this.logger("locked",n);const s=new pt(l=>{i=()=>{this.locks-=1,this.logger("unlocked",n),l()}}),c=this.lockingPromise.then(()=>i);return this.lockingPromise=this.lockingPromise.then(()=>s),c}};function $E(n,i){return function(s,c,l){const h=l.value;if(typeof h!="function")throw new Error("Cannot use mutex on object property.");return l.value=async function(){const p=this[i];if(!p)throw new Error("mutex property key ".concat(i," doesn't exist on ").concat(n));const v=await p.lock("From ".concat(n,".").concat(c));try{for(var y=arguments.length,S=new Array(y),b=0;b<y;b++)S[b]=arguments[b];return await h.apply(this,S)}finally{v()}},l}}const ss={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function hM(n,i){const s=Math.floor(i.timeout*Math.pow(i.timeoutFactor,n));return Math.min(i.maxRetryTimeout,s)}function Jd(n,i,s,c){const l=Object.assign({},ss,c);let h=l.timeout;const p=async()=>{await function(S){return new pt(b=>{window.setTimeout(b,S)})}(h),h*=l.timeoutFactor,h=Math.min(l.maxRetryTimeout,h)};let v=!1;const y=new pt(async(S,b)=>{i=i||(()=>!1),s=s||(()=>!0);for(let R=0;R<l.maxRetryCount;R+=1){if(v)return b(new Fe(ie.OPERATION_ABORTED));try{const O=await n();if(!i(O,R)||R+1===l.maxRetryCount)return S(O);await p()}catch(O){if(!s(O,R)||R+1===l.maxRetryCount)return b(O);await p()}}});return y.cancel=()=>v=!0,y}let Fk,D9=class{constructor(n){sn(this,"input",[]),sn(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}mean(){var n;return this.input.length===0?0:nu(n=this.input).call(n,(i,s)=>i+s)/this.input.length}},jk=0,fM=0;function pM(n,i,s,c){return new pt((l,h)=>{i.responseType=i.responseType||"json",i.data&&!s?(i.data=JSON.stringify(i.data),jk+=Fh(i.data)):s&&(i.data.size?jk+=i.data.size:i.data instanceof FormData?jk+=R9(i.data):jk+=Fh(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=n,tc.request(i).then(p=>{typeof p.data=="string"?fM+=Fh(p.data):p.data instanceof ArrayBuffer||p.data instanceof Uint8Array?fM+=p.data.byteLength:fM+=Fh(JSON.stringify(p.data)),l(p.data)}).catch(p=>{tc.isCancel(p)?h(new Fe(ie.OPERATION_ABORTED,"cancel token canceled")):p.code==="ECONNABORTED"?h(new Fe(ie.NETWORK_TIMEOUT,p.message)):p.response?h(new Fe(ie.NETWORK_RESPONSE_ERROR,p.response.status)):h(new Fe(ie.NETWORK_ERROR,p.message))})})}async function Gye(n,i){const s=new Blob([i.data],{type:"buffer"});return await pM(n,Tt(Tt({},i),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const L9=()=>window.isSecureContext!==void 0;function od(n){if(Array.isArray(n))return n.map(s=>s);if(!x9(n))return n;const i={};for(const s in n){const c=n[s];x9(c)||Array.isArray(c)?i[s]=od(c):i[s]=c}return i}function x9(n){return!(typeof n!="object"||Array.isArray(n)||!n)}let mM=class{constructor(n){sn(this,"input",[]),sn(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const jh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Fb={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:jh,remoteCandidate:jh},updateInterval:0},M9={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},U9={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},V9={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},F9={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let gM=class{constructor(n,i){sn(this,"onFirstVideoReceived",void 0),sn(this,"onFirstVideoDecoded",void 0),sn(this,"onFirstAudioReceived",void 0),sn(this,"onFirstVideoDecodedTimeout",void 0),sn(this,"onFirstAudioDecoded",void 0),sn(this,"onSelectedLocalCandidateChanged",void 0),sn(this,"onSelectedRemoteCandidateChanged",void 0),sn(this,"videoIsReady",!1),sn(this,"videoIsReady2",{}),sn(this,"pc",void 0),sn(this,"options",void 0),sn(this,"intervalTimer",void 0),sn(this,"stats",od(Fb)),sn(this,"isFirstVideoReceived",{}),sn(this,"isFirstVideoDecoded",{}),sn(this,"isFirstAudioReceived",{}),sn(this,"isFirstAudioDecoded",{}),sn(this,"isFirstVideoDecodedTimeout",{}),sn(this,"lossRateWindowStats",[]),this.pc=n,this.options=i,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new pt(n=>{n({local:Tt({},jh),remote:Tt({},jh)})})}setVideoIsReady(n){this.videoIsReady=n}setVideoIsReady2(n,i){this.videoIsReady2[n]=i}getVideoIsReady(n){return this.videoIsReady2[n]||!1}setIsFirstAudioDecoded(n){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(n){this.lossRateWindowStats.push(n),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const i=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let c=0,l=0,h=0,p=0;for(const v of s)n[v].forEach((y,S)=>{if(!this.lossRateWindowStats[i-1][v][S]||!this.lossRateWindowStats[0][v][S])return;const b=this.lossRateWindowStats[i-1][v][S].packets-this.lossRateWindowStats[0][v][S].packets,R=this.lossRateWindowStats[i-1][v][S].packetsLost-this.lossRateWindowStats[0][v][S].packetsLost;v==="videoSend"||v==="audioSend"?(c+=b,h+=R):(l+=b,p+=R),Number.isNaN(b)||Number.isNaN(b)?y.packetLostRate=0:y.packetLostRate=b<=0||R<=0?0:R/(b+R)});n.sendPacketLossRate=c<=0||h<=0?0:h/(c+h),n.recvPacketLossRate=l<=0||p<=0?0:p/(l+p)}},Hye=class extends gM{constructor(){super(...arguments),sn(this,"_stats",Fb),sn(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const n=await this._getStats(),i=this.statsResponsesToObjects(n);this._stats=od(Fb);const s=i.filter(l=>l.type==="ssrc");this.processSSRCStats(s);const c=i.find(l=>l.type==="VideoBwe");c&&this.processBandwidthStats(c),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(n){this._stats.bitrate={actualEncoded:Number(n.googActualEncBitrate),targetEncoded:Number(n.googTargetEncBitrate),retransmit:Number(n.googRetransmitBitrate),transmit:Number(n.googTransmitBitrate)},this._stats.sendBandwidth=Number(n.googAvailableSendBandwidth)}processSSRCStats(n){n.forEach(i=>{var s;const c=dt(s=i.id).call(s,"send");switch("".concat(i.mediaType,"_").concat(c?"send":"recv")){case"video_send":{const l=od(U9);l.codec=i.googCodecName,l.adaptionChangeReason="none",i.googCpuLimitedResolution&&(l.adaptionChangeReason="cpu"),i.googBandwidthLimitedResolution&&(l.adaptionChangeReason="bandwidth"),l.avgEncodeMs=Number(i.googAvgEncodeMs),l.inputFrame={width:Number(i.googFrameWidthInput)||Number(i.googFrameWidthSent),height:Number(i.googFrameHeightInput)||Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},l.sentFrame={width:Number(i.googFrameWidthSent),height:Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},l.firsCount=Number(i.googFirReceived),l.nacksCount=Number(i.googNacksReceived),l.plisCount=Number(i.googPlisReceived),l.frameCount=Number(i.framesEncoded),l.bytes=Number(i.bytesSent),l.packets=Number(i.packetsSent),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.rttMs=Number(i.googRtt||0),this._stats.videoSend.push(l),this._stats.rtt=l.rttMs;break}case"video_recv":{const l=od(M9),h=this.lastDecodeVideoReceiverStats.get(Number(i.ssrc));if(l.codec=i.googCodecName,l.targetDelayMs=Number(i.googTargetDelayMs),l.renderDelayMs=Number(i.googRenderDelayMs),l.currentDelayMs=Number(i.googCurrentDelayMs),l.minPlayoutDelayMs=Number(i.googMinPlayoutDelayMs),l.decodeMs=Number(i.googDecodeMs),l.maxDecodeMs=Number(i.googMaxDecodeMs),l.receivedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateReceived)},l.decodedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateDecoded)},l.decodeFrameRate=Number(i.googFrameRateDecoded),l.outputFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateOutput)},l.jitterBufferMs=Number(i.googJitterBufferMs),l.firsCount=Number(i.googFirsSent),l.nacksCount=Number(i.googNacksSent),l.plisCount=Number(i.googPlisSent),l.framesDecodeCount=Number(i.framesDecoded),l.bytes=Number(i.bytesReceived),l.packets=Number(i.packetsReceived),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.packets>0&&!this.isFirstVideoReceived[l.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(l.ssrc),this.isFirstVideoReceived[l.ssrc]=!0),l.framesDecodeCount>0&&!this.isFirstVideoDecoded[l.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(l.ssrc,l.decodedFrame.width,l.decodedFrame.height),this.isFirstVideoDecoded[l.ssrc]=!0),h){const p=h.stats,v=Date.now()-h.lts;l.framesDecodeFreezeTime=p.framesDecodeFreezeTime,l.framesDecodeInterval=p.framesDecodeInterval,l.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[l.ssrc]?(h.lts=Date.now(),l.framesDecodeInterval=v,l.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc,10))?l.framesDecodeFreezeTime+=l.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):l.framesDecodeCount<h.stats.framesDecodeCount&&(l.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(l.ssrc,{stats:Tt({},l),lts:Date.now()}),this._stats.videoRecv.push(l);break}case"audio_recv":{const l=od(F9);l.codec=i.googCodecName,l.outputLevel=Math.abs(Number(i.audioOutputLevel))/32767,l.decodingCNG=Number(i.googDecodingCNG),l.decodingCTN=Number(i.googDecodingCTN),l.decodingCTSG=Number(i.googDecodingCTSG),l.decodingNormal=Number(i.googDecodingNormal),l.decodingPLC=Number(i.googDecodingPLC),l.decodingPLCCNG=Number(i.googDecodingPLCCNG),l.expandRate=Number(i.googExpandRate),l.accelerateRate=Number(i.googAccelerateRate),l.preemptiveExpandRate=Number(i.googPreemptiveExpandRate),l.secondaryDecodedRate=Number(i.googSecondaryDecodedRate),l.speechExpandRate=Number(i.googSpeechExpandRate),l.preferredJitterBufferMs=Number(i.googPreferredJitterBufferMs),l.jitterBufferMs=Number(i.googJitterBufferMs),l.jitterMs=Number(i.googJitterReceived),l.bytes=Number(i.bytesReceived),l.packets=Number(i.packetsReceived),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.receivedFrames=Number(i.googDecodingCTN)||Number(i.packetsReceived),l.droppedFrames=Number(i.googDecodingPLC)+Number(i.googDecodingPLCCNG)||Number(i.packetsLost),l.receivedFrames>0&&!this.isFirstAudioReceived[l.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(l.ssrc),this.isFirstAudioReceived[l.ssrc]=!0),l.decodingNormal>0&&!this.isFirstAudioDecoded[l.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(l.ssrc),this.isFirstAudioDecoded[l.ssrc]=!0),this._stats.audioRecv.push(l);break}case"audio_send":{const l=od(V9);l.codec=i.googCodecName,l.inputLevel=Math.abs(Number(i.audioInputLevel))/32767,l.aecReturnLoss=Number(i.googEchoCancellationReturnLoss||0),l.aecReturnLossEnhancement=Number(i.googEchoCancellationReturnLossEnhancement||0),l.residualEchoLikelihood=Number(i.googResidualEchoLikelihood||0),l.residualEchoLikelihoodRecentMax=Number(i.googResidualEchoLikelihoodRecentMax||0),l.bytes=Number(i.bytesSent),l.packets=Number(i.packetsSent),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.rttMs=Number(i.googRtt||0),this._stats.rtt=l.rttMs,this._stats.audioSend.push(l);break}}})}_getStats(){return new pt((n,i)=>{this.pc.getStats(n,i)})}statsResponsesToObjects(n){const i=[];return n.result().forEach(s=>{const c={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(l=>{c[l]=s.stat(l)}),i.push(c)}),i}},jb=function(n){return n.BANDWIDTH="bandwidth",n.CPU="cpu",n.NONE="none",n.OTHER="other",n}({}),Bk=function(n){return n.L1T1="L1T1",n.L1T2="L1T2",n.L1T3="L1T3",n.L1T3_KEY="L1T3_KEY",n.L2T1_KEY="L2T1_KEY",n.L2T2_KEY="L2T2_KEY",n.L2T3_KEY="L2T3_KEY",n.L3T1_KEY="L3T1_KEY",n.L3T2_KEY="L3T2_KEY",n.L3T3_KEY="L3T3_KEY",n}({}),vM=function(n){return n[n.new=0]="new",n[n.connecting=1]="connecting",n[n.connected=2]="connected",n[n.disconnected=3]="disconnected",n[n.failed=4]="failed",n[n.closed=5]="closed",n}({}),Wu=function(n){return n.CERTIFICATE="certificate",n.CODEC="codec",n.CANDIDATE_PAIR="candidate-pair",n.LOCAL_CANDIDATE="local-candidate",n.REMOTE_CANDIDATE="remote-candidate",n.INBOUND="inbound-rtp",n.TRACK="track",n.OUTBOUND="outbound-rtp",n.PC="peer-connection",n.REMOTE_INBOUND="remote-inbound-rtp",n.REMOTE_OUTBOUND="remote-outbound-rtp",n.TRANSPORT="transport",n.CSRC="csrc",n.DATA_CHANNEL="data-channel",n.STREAM="stream",n.SENDER="sender",n.RECEIVER="receiver",n}({});var YE=function(n){return n[n.kNone=1]="kNone",n[n.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",n[n.kBytesToBits=8]="kBytesToBits",n}(YE||{});function Bb(n,i,s,c){let l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:YE.kNone;if(!i)return;const h=Number(i[s]);if(typeof h!="number")return;const p=Number(i[c]);if(typeof p!="number")return;if(!n)return p?h/p*l:void 0;const v=Number(n[s]);if(typeof v!="number")return;const y=Number(n[c]);if(typeof y!="number")return;const S=p-y;return S?(h-v)/S*l:void 0}let j9=class extends gM{constructor(){super(...arguments),sn(this,"_stats",Fb),sn(this,"report",void 0),sn(this,"lastDecodeVideoReceiverStats",new Map),sn(this,"lastVideoFramesRecv",new Map),sn(this,"lastVideoFramesSent",new Map),sn(this,"lastVideoFramesDecode",new Map),sn(this,"lastVideoFramesOutput",new Map),sn(this,"lastVideoJBDelay",new Map),sn(this,"lastAudioJBDelay",new Map),sn(this,"mediaBytesSent",new Map),sn(this,"mediaBytesRetransmit",new Map),sn(this,"mediaBytesTargetEncode",new Map),sn(this,"lastDecodeAudioReceiverStats",new Map),sn(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=od(Fb),this.report.forEach(n=>{switch(n.type){case Wu.OUTBOUND:case Wu.INBOUND:{const i=n.mediaType||n.kind,s=!i&&"frameWidth"in n,c=!i&&!("frameWidth"in n);n.type===Wu.OUTBOUND?i==="audio"||c?this.processAudioOutboundStats(n):(i==="video"||s)&&this.processVideoOutboundStats(n):n.type===Wu.INBOUND&&(i==="audio"||c?this.processAudioInboundStats(n):(i==="video"||s)&&this.processVideoInboundStats(n));break}case Wu.TRANSPORT:{const i=this.report.get(n.selectedCandidatePairId);i&&this.processCandidatePairStats(i);break}case Wu.CANDIDATE_PAIR:n.selected&&this.processCandidatePairStats(n)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const n=await this.pc.getStats(),i={local:Tt({},jh),remote:Tt({},jh)};return n.forEach(s=>{let c;if(s.type===Wu.TRANSPORT&&(c=n.get(s.selectedCandidatePairId)),s.type===Wu.CANDIDATE_PAIR&&s.selected&&(c=s),c){const l=(h,p)=>{h.type=p.type,h.id=p.id,p.address&&(h.address=p.address),p.candidateType&&(h.candidateType=p.candidateType),p.port&&(h.port=p.port),p.priority&&(h.priority=p.priority),p.protocol&&(h.protocol=p.protocol),p.relayProtocol&&(h.relayProtocol=p.relayProtocol)};if(c.localCandidateId){const h=n.get(c.localCandidateId);h&&l(i.local,h)}if(c.remoteCandidateId){const h=n.get(c.remoteCandidateId);h&&l(i.remote,h)}}}),i}processCandidatePairStats(n){if(this._stats.sendBandwidth=n.availableOutgoingBitrate||0,n.currentRoundTripTime&&(this._stats.rtt=1e3*n.currentRoundTripTime),this._stats.videoSend.forEach(i=>{n.currentRoundTripTime&&(i.rttMs=1e3*n.currentRoundTripTime)}),this._stats.audioSend.forEach(i=>{n.currentRoundTripTime&&(i.rttMs=1e3*n.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=n.id,n.localCandidateId){const i=this.report.get(n.localCandidateId);i&&this.processCandidateStats(i)}if(n.remoteCandidateId){const i=this.report.get(n.remoteCandidateId);i&&this.processCandidateStats(i)}}processCandidateStats(n){let i;n.type===Wu.LOCAL_CANDIDATE&&(i=this._stats.selectedCandidatePair.localCandidate),n.type===Wu.REMOTE_CANDIDATE&&(i=this._stats.selectedCandidatePair.remoteCandidate),i&&(i.type=n.type,i.id=n.id,n.address&&(i.address=n.address),n.candidateType&&(i.candidateType=n.candidateType),n.port&&(i.port=n.port),n.priority&&(i.priority=n.priority),n.protocol&&(i.protocol=n.protocol),n.relayProtocol&&(i.relayProtocol=n.relayProtocol),n.type===Wu.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==i.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Tt({},i),Tt({},this.stats.selectedCandidatePair.localCandidate)),n.type===Wu.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==i.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Tt({},i),Tt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(n){let i=this._stats.audioRecv.find(c=>c.ssrc===n.ssrc);i||(i=od(F9),this._stats.audioRecv.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsReceived,i.packetsLost=n.packetsLost,i.packetsDiscarded=n.packetsDiscarded,i.bytes=n.bytesReceived,i.jitterMs=1e3*n.jitter,i.retransmittedBytesReceived=n.retransmittedBytesReceived,i.retransmittedPacketsReceived=n.retransmittedPacketsReceived,i.totalProcessingDelay=n.totalProcessingDelay,i.jitterBufferEmittedCount=n.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(i.ssrc);i.avgProcessingDelayMs=Bb(s,i,"totalProcessingDelay","jitterBufferEmittedCount",YE.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(n,n.trackId,i),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),i.receivedFrames||(i.receivedFrames=n.packetsReceived),i.droppedFrames||(i.droppedFrames=n.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.outputLevel&&i.outputLevel>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),typeof n.concealedSamples=="number"&&(i.concealedSamples=n.concealedSamples),this.lastDecodeAudioReceiverStats.set(i.ssrc,Tt({},i))}processVideoInboundStats(n){let i=this._stats.videoRecv.find(p=>p.ssrc===n.ssrc);i||(i=od(M9),this._stats.videoRecv.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsReceived,i.packetsLost=n.packetsLost,i.bytes=n.bytesReceived,i.firsCount=n.firCount,i.nacksCount=n.nackCount,i.plisCount=n.pliCount,i.framesDecodeCount=n.framesDecoded,i.framesDroppedCount=n.framesDropped,i.totalInterFrameDelay=n.totalInterFrameDelay,i.totalSquaredInterFrameDelay=n.totalSquaredInterFrameDelay,i.totalFreezesDuration=n.totalFreezesDuration,i.totalProcessingDelay=n.totalProcessingDelay,i.packetsDiscarded=n.packetsDiscarded,i.framesAssembledFromMultiplePackets=n.framesAssembledFromMultiplePackets,i.totalAssemblyTime=n.totalAssemblyTime,i.keyFramesDecoded=n.keyFramesDecoded,i.retransmittedBytesReceived=n.retransmittedBytesReceived,i.retransmittedPacketsReceived=n.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(i.ssrc),c=this.lastVideoFramesDecode.get(i.ssrc),l=this.lastVideoFramesOutput.get(i.ssrc),h=Date.now();if(i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]){const p=i.decodedFrame?i.decodedFrame.width:0,v=i.decodedFrame?i.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,p,v),this.isFirstVideoDecoded[i.ssrc]=!0}if(s){const p=s.stats,v=h-s.lts;i.framesDecodeFreezeTime=p.framesDecodeFreezeTime,i.framesDecodeInterval=p.framesDecodeInterval,!this.isFirstVideoDecoded[i.ssrc]&&v>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[i.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(i.ssrc),this.isFirstVideoDecodedTimeout[i.ssrc]=!0),i.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=v,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):i.framesDecodeCount<p.framesDecodeCount&&(i.framesDecodeInterval=0),n.framesDecoded&&n.qpSum&&(s.stats.framesDecodeCount>n.framesDecoded?i.qpSumPerFrame=n.qpSum/n.framesDecoded:i.qpSumPerFrame=(n.qpSum-s.qpSum)/(n.framesDecoded-s.stats.framesDecodeCount))}n.totalDecodeTime&&(i.decodeMs=1e3*n.totalDecodeTime,i.avgDecodeMs=Bb(s==null?void 0:s.stats,i,"decodeMs","framesDecodeCount")),i.avgProcessingDelayMs=Bb(s==null?void 0:s.stats,i,"totalProcessingDelay","framesDecodeCount",YE.kMillisecondsFromSeconds),i.avgFramesAssembledFromMultiplePacketsMs=Bb(s==null?void 0:s.stats,i,"totalAssemblyTime","framesAssembledFromMultiplePackets",YE.kMillisecondsFromSeconds),i.avgInterFrameDelayMs=Bb(s==null?void 0:s.stats,i,"totalInterFrameDelay","framesDecodeCount",YE.kMillisecondsFromSeconds),c&&h-c.lts>=800?(i.decodeFrameRate=Math.round((i.framesDecodeCount-c.count)/((h-c.lts)/1e3)),this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:h,rate:i.decodeFrameRate})):c?i.decodeFrameRate=c.rate:this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:h,rate:0}),i.framesDroppedCount&&n.framesReceived&&(l&&h-l.lts>=800?(i.outputFrameRate=Math.round((n.framesReceived-i.framesDroppedCount-l.count)/((h-l.lts)/1e3)),this.lastVideoFramesOutput.set(i.ssrc,{count:n.framesReceived-i.framesDroppedCount,lts:h,rate:Math.max(i.outputFrameRate,0)})):l?i.outputFrameRate=l.rate:this.lastVideoFramesOutput.set(i.ssrc,{count:n.framesReceived-i.framesDroppedCount,lts:h,rate:0})),this.processVideoTrackReceiverStats(n,n.trackId,i),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),n.framerateMean&&(i.framesRateFirefox=n.framerateMean),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:Tt({},i),lts:s?s.lts:Date.now(),qpSum:n.qpSum})}processVideoOutboundStats(n){let i=this._stats.videoSend.find(c=>c.ssrc===n.ssrc);i||(i=od(U9),this._stats.videoSend.push(i));const s=this.mediaBytesSent.get(n.ssrc);if(s)s.add(n.bytesSent);else{const c=new mM(10);c.add(n.bytesSent),this.mediaBytesSent.set(n.ssrc,c)}if(n.retransmittedBytesSent!==void 0){const c=this.mediaBytesRetransmit.get(n.ssrc);if(c)c.add(n.retransmittedBytesSent);else{const l=new mM(10);l.add(n.retransmittedBytesSent),this.mediaBytesRetransmit.set(n.ssrc,l)}}if(n.totalEncodedBytesTarget){const c=this.mediaBytesTargetEncode.get(n.ssrc);if(c)c.add(n.totalEncodedBytesTarget);else{const l=new mM(10);l.add(n.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(n.ssrc,l)}}if(i.ssrc=n.ssrc,i.bytes=n.bytesSent,i.packets=n.packetsSent,i.firsCount=n.firCount,i.nacksCount=n.nackCount,i.plisCount=n.pliCount,i.frameCount=n.framesEncoded,i.adaptionChangeReason=n.qualityLimitationReason,i.scalabilityMode=n.scalabilityMode,i.retransmittedBytesSent=n.retransmittedBytesSent,i.retransmittedPacketsSent=n.retransmittedPacketsSent,i.hugeFramesSent=n.hugeFramesSent,i.keyFramesEncoded=n.keyFramesEncoded,n.totalEncodeTime&&n.framesEncoded){const c=this.lastEncoderMs.get(n.ssrc);if(!c||c.lastFrameCount>n.framesEncoded)i.avgEncodeMs=1e3*n.totalEncodeTime/n.framesEncoded;else{const l=n.framesEncoded-c.lastFrameCount,h=n.totalEncodeTime-c.lastEncoderTime;i.avgEncodeMs=1e3*h/l}}if(n.framesEncoded&&n.qpSum){const c=this.lastEncoderMs.get(n.ssrc);!c||c.lastFrameCount>n.framesEncoded?i.qpSumPerFrame=n.qpSum/n.framesEncoded:i.qpSumPerFrame=(n.qpSum-c.lastQpSum)/(n.framesEncoded-c.lastFrameCount)}if(this.lastEncoderMs.set(n.ssrc,{lastFrameCount:n.framesEncoded,lastEncoderTime:n.totalEncodeTime,lastQpSum:n.qpSum,lts:Date.now()}),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),n.mediaSourceId&&this.processVideoMediaSource(n.mediaSourceId,i),this.processVideoTrackSenderStats(n,n.trackId,i),n.remoteId)this.processRemoteInboundStats(n.remoteId,i);else{const c=this.findRemoteStatsId(n.ssrc,Wu.REMOTE_INBOUND);c&&this.processRemoteInboundStats(c,i)}}processAudioOutboundStats(n){let i=this._stats.audioSend.find(s=>s.ssrc===n.ssrc);if(i||(i=od(V9),this._stats.audioSend.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsSent,i.bytes=n.bytesSent,i.retransmittedBytesSent=n.retransmittedBytesSent,i.retransmittedPacketsSent=n.retransmittedPacketsSent,n.mediaSourceId&&this.processAudioMediaSource(n.mediaSourceId,i),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),this.processAudioTrackSenderStats(n,n.trackId,i),n.remoteId)this.processRemoteInboundStats(n.remoteId,i);else{const s=this.findRemoteStatsId(n.ssrc,Wu.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,i)}}findRemoteStatsId(n,i){var s;const c=Array.from(Fu(s=this.report).call(s)).find(l=>l.type===i&&l.ssrc===n);return c?c.id:null}processVideoMediaSource(n,i){const s=this.report.get(n);s&&s.width&&s.height&&s.framesPerSecond&&(i.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(n,i){const s=this.report.get(n);s&&(i.inputLevel=s.audioLevel)}processVideoTrackSenderStats(n,i,s){var c,l,h,p;const v=i?this.report.get(i):void 0,y=(c=v==null?void 0:v.framesSent)!==null&&c!==void 0?c:n.framesSent;if(typeof y!="number")return;let S=(l=v==null?void 0:v.frameWidth)!==null&&l!==void 0?l:n.frameWidth,b=(h=v==null?void 0:v.frameHeight)!==null&&h!==void 0?h:n.frameHeight,R=(p=v==null?void 0:v.framesPerSecond)!==null&&p!==void 0?p:n.framesPerSecond;if(typeof S=="number"&&typeof b=="number"||(S=0,b=0),R==null){const O=Date.now(),N=this.lastVideoFramesSent.get(s.ssrc);N&&O-N.lts>=800?(R=Math.round((y-N.count)/((O-N.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:O,rate:R})):N?R=N.rate:this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:O,rate:0})}s.sentFrame={width:S,height:b,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(n,i,s){var c,l,h,p,v;const y=i?this.report.get(i):void 0,S=(c=y==null?void 0:y.framesReceived)!==null&&c!==void 0?c:n.framesReceived,b=(l=y==null?void 0:y.frameWidth)!==null&&l!==void 0?l:n.frameWidth,R=(h=y==null?void 0:y.frameHeight)!==null&&h!==void 0?h:n.frameHeight,O=(p=y==null?void 0:y.jitterBufferDelay)!==null&&p!==void 0?p:n.jitterBufferDelay,N=(v=y==null?void 0:y.jitterBufferEmittedCount)!==null&&v!==void 0?v:n.jitterBufferEmittedCount;if(typeof S=="number"){const Y=this.lastVideoFramesRecv.get(s.ssrc),W=Date.now();s.framesReceivedCount=S;let H=0;Y&&W-Y.lts>=800?(H=Math.round((S-Y.count)/((W-Y.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:S,lts:W,rate:H})):Y?H=Y.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:S,lts:W,rate:0}),s.receivedFrame={width:b||0,height:R||0,frameRate:H||0},s.decodedFrame={width:b||0,height:R||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:b||0,height:R||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(O&&N){const Y=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let W=Y.jitterBufferMs;const H=N-Y.jitterBufferEmittedCount;H>0&&(W=1e3*(O-Y.jitterBufferDelay)/H),s.jitterBufferMs=W,s.currentDelayMs=Math.round(W),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:N,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(n,i,s){var c,l,h,p;const v=i?this.report.get(i):void 0,y=(c=(l=v==null?void 0:v.echoReturnLoss)!==null&&l!==void 0?l:n.echoReturnLoss)!==null&&c!==void 0?c:0,S=(h=(p=v==null?void 0:v.echoReturnLossEnhancement)!==null&&p!==void 0?p:n.echoReturnLossEnhancement)!==null&&h!==void 0?h:0;s.aecReturnLoss=y,s.aecReturnLossEnhancement=S}processAudioTrackReceiverStats(n,i,s){var c,l,h,p,v,y,S;const b=i?this.report.get(i):void 0,R=(c=b==null?void 0:b.removedSamplesForAcceleration)!==null&&c!==void 0?c:n.removedSamplesForAcceleration,O=(l=b==null?void 0:b.totalSamplesReceived)!==null&&l!==void 0?l:n.totalSamplesReceived,N=(h=b==null?void 0:b.jitterBufferDelay)!==null&&h!==void 0?h:n.jitterBufferDelay,Y=(p=b==null?void 0:b.jitterBufferEmittedCount)!==null&&p!==void 0?p:n.jitterBufferEmittedCount,W=(v=b==null?void 0:b.audioLevel)!==null&&v!==void 0?v:n==null?void 0:n.audioLevel,H=(y=b==null?void 0:b.totalSamplesDuration)!==null&&y!==void 0?y:n==null?void 0:n.totalSamplesDuration,ne=(S=b==null?void 0:b.concealedSamples)!==null&&S!==void 0?S:n.concealedSamples;if(typeof O=="number"&&(s.totalSamplesReceived=O),R&&O&&(s.accelerateRate=R/O),N&&Y){const me=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let be=me.jitterBufferMs;const we=Y-me.jitterBufferEmittedCount;we>0&&(be=1e3*(N-me.jitterBufferDelay)/we),s.jitterBufferMs=Math.round(be),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:N,jitterBufferEmittedCount:Y,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=W;let re=1920;H&&O&&(re=O/H/50,s.receivedFrames=Math.round(O/re)),ne&&(s.droppedFrames=Math.round(ne/re))}processRemoteInboundStats(n,i){const s=this.report.get(n);s&&(i.packetsLost=s.packetsLost,s.roundTripTime&&(i.rttMs=1e3*s.roundTripTime),s.jitter&&(i.jitterMs=1e3*s.jitter),s.timestamp&&(i.timestamp=s.timestamp))}getCodecFromCodecStats(n){const i=this.report.get(n);if(!i)return"";const s=i.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let n=0,i=null,s=null;this.mediaBytesSent.forEach(l=>{n+=l.diffMean()}),this.mediaBytesRetransmit.forEach(l=>{i=i===null?l.diffMean():i+l.diffMean()}),this.mediaBytesTargetEncode.forEach(l=>{s=s===null?l.diffMean():s+l.diffMean()});const c=i!==null?n-i:n;this._stats.bitrate={actualEncoded:8*c/(this.options.updateInterval/1e3),transmit:8*n/(this.options.updateInterval/1e3)},i!==null&&(this._stats.bitrate.retransmit=8*i/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},Kye=class extends gM{updateStats(){return pt.resolve()}};function _M(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const h=function(){const p=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return p&&p[0]?Number(p[0].split("/")[1]):null}();return h?h<76?new Hye(n,{updateInterval:i,lossRateInterval:s,freezeRateLimit:c,firstVideoDecodedTimeout:l}):new j9(n,{updateInterval:i,lossRateInterval:s,freezeRateLimit:c,firstVideoDecodedTimeout:l}):function(p){if(!window.RTCStatsReport)return!1;const v=p.getStats();return!!(v instanceof pt||function(y){return!!y&&(typeof y=="object"||typeof y=="function")&&typeof y.then=="function"}(v))}(n)?new j9(n,{updateInterval:i,lossRateInterval:s,freezeRateLimit:c,firstVideoDecodedTimeout:l}):new Kye(n,{updateInterval:i,lossRateInterval:s,freezeRateLimit:c,firstVideoDecodedTimeout:l})}const B9="websdk_ng_install_id";function yM(){try{if(le("INSTALL_ID"))return le("INSTALL_ID");let n=window.localStorage.getItem(B9);return n||(n=n_(),window.localStorage.setItem(B9,n)),_r("INSTALL_ID",n),n}catch{return}}const Cl=function(n){if(n.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return n;const i=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(i&&i[1]&&i[2]){const s=i[1],c=i[2];return"".concat(s,".").concat(c)}return"4.0.0.999"}("4.23.2"),EM=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let r_=function(n){return n.Default="default",n.Auto="auto",n.Relay="relay",n.SdRtn="sd-rtn",n}({});const fo=function(){const n="us".concat("erna","me"),i="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const c=s.join(""),l=[];for(let v=0;v<6;v++)l.push("1");const h=l.join(""),p={};return p[n]=c,p[i]=h,Object.assign(p,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=fo;const Wk={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},SM={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},TM="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",bM={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},Kr=Tt(Tt(Tt({},bM),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:SM,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Wk),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function _r(n,i,s){var c,l,h;dt(c=Object.keys(Kr)).call(c,n)&&(!s&&dt(l=Object.keys(Qd)).call(l,n)||(Kr[n]=i,n!=="ENABLE_VIDEO_SEI"&&n!=="ENABLE_AUDIO_TOPN"&&n!=="ENABLE_AUDIO_METADATA"&&n!=="ENABLE_AUDIO_PTS_METADATA"||i!==!0||(Kr.ENABLE_ENCODED_TRANSFORM=!0,n==="ENABLE_AUDIO_PTS_METADATA"&&(Kr.ENABLE_AUDIO_METADATA=!0)),n==="USE_NEW_NETWORK_CONFIG"&&i&&(h=!!i,Kr.USE_NEW_NETWORK_CONFIG=h,h&&(Kr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Kr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Kr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Kr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Kr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Kr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Kr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),n==="ENABLE_PRE_SUB"&&i&&(Kr.ENABLE_INSTANT_VIDEO=!0,Kr.ENABLE_PREALLOC_PC=!0),n==="ENABLE_SVC"&&i&&(Kr.ENABLE_AUT_CC=!0),n==="NEW_FORCE_TURN"&&i&&(Kr.NEW_TURN_MODE||(Kr.NEW_TURN_MODE=4))))}function le(n){return Kr[n]}EM||(Kr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Kr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Kr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Kr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Kr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Kr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Kr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Kr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Kr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Kr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Kr.AREAS=["NORTH_AMERICA","OVERSEA"]);let W9=function(n){return n[n.REALTIME=1]="REALTIME",n}({});const Qd={};var On=function(n){return n.SET_SESSION_ID="SET_SESSION_ID",n.SET_P2P_ID="SET_P2P_id",n.SET_DC_ID="SET_DC_id",n.SET_UID="SET_UID",n.SET_INT_UID="SET_INT_UID",n.SET_PUB_ID="SET_PUB_ID",n.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",n.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",n.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",n.AVOID_JOIN_START="AVOID_JOIN_START",n.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",n.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",n.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",n.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",n.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",n.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",n.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",n.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",n.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",n.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",n.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",n.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",n.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",n.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",n.RESET_KEY_METRICS="RESET_KEY_METRICS",n.SET_USE_P2P="SET_USE_P2P",n.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",n}(On||{});let zk=function(n){return n.h264="h264",n.h265="h265",n.vp8="vp8",n.vp9="vp9",n.av1="av1",n}({});(function(n){n.opus="opus",n.pcma="pcma",n.pcmu="pcmu",n.g722="g722"})({});const z9=128,qye=96,G9=1e3,XE=10;let $ye=0;var H9=(()=>{var n={8:(c,l,h)=>{h.r(l),h.d(l,{Parser:()=>mt,Printer:()=>Vi,parse:()=>lt,print:()=>Rt});const p=`
`,v="".concat("\r").concat(p),y=" ";let S;function b(Xe){return Xe>="0"&&Xe<="9"}function R(Xe){return Xe>="!"&&Xe<="~"}function O(Xe){return R(Xe)||Xe>=""&&Xe<=""}function N(Xe){return Xe==="!"||Xe>="#"&&Xe<="'"||Xe>="*"&&Xe<="+"||Xe>="-"&&Xe<="."||Xe>="0"&&Xe<="9"||Xe>="A"&&Xe<="Z"||Xe>="^"&&Xe<="~"}function Y(Xe){return Xe>="1"&&Xe<="9"}function W(Xe){return Xe>="A"&&Xe<="Z"||Xe>="a"&&Xe<="z"}function H(Xe){return Xe==="d"||Xe==="h"||Xe==="m"||Xe==="s"}function ne(Xe){return Xe>""&&Xe<"	"||Xe>"\v"&&Xe<"\f"||Xe>""&&Xe<""}function re(Xe){return W(Xe)||b(Xe)||Xe==="+"||Xe==="/"}function me(Xe){return b(Xe)||W(Xe)||Xe==="+"||Xe==="/"||Xe==="-"||Xe==="_"}function be(Xe){return W(Xe)||b(Xe)||Xe==="+"||Xe==="/"}function we(Xe,U){var de=Object.keys(Xe);if(Object.getOwnPropertySymbols){var ge=Object.getOwnPropertySymbols(Xe);U&&(ge=ge.filter(function(it){return Object.getOwnPropertyDescriptor(Xe,it).enumerable})),de.push.apply(de,ge)}return de}function Se(Xe){for(var U=1;U<arguments.length;U++){var de=arguments[U]!=null?arguments[U]:{};U%2?we(Object(de),!0).forEach(function(ge){Le(Xe,ge,de[ge])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Xe,Object.getOwnPropertyDescriptors(de)):we(Object(de)).forEach(function(ge){Object.defineProperty(Xe,ge,Object.getOwnPropertyDescriptor(de,ge))})}return Xe}function Le(Xe,U,de){return U in Xe?Object.defineProperty(Xe,U,{value:de,enumerable:!0,configurable:!0,writable:!0}):Xe[U]=de,Xe}(function(Xe){Xe.VERSION="v",Xe.ORIGIN="o",Xe.SESSION_NAME="s",Xe.INFORMATION="i",Xe.URI="u",Xe.EMAIL="e",Xe.PHONE="p",Xe.CONNECTION="c",Xe.BANDWIDTH="b",Xe.TIME="t",Xe.REPEAT="r",Xe.ZONE_ADJUSTMENTS="z",Xe.KEY="k",Xe.ATTRIBUTE="a",Xe.MEDIA="m"})(S||(S={}));class et{consumeText(U,de){let ge=de;for(;ge<U.length;){const it=U[ge];if(it==="\0"||it==="\r"||it===p)break;ge+=1}if(ge-de==0)throw new Error("Invalid text, at ".concat(U));return ge}consumeUnicastAddress(U,de,ge){return this.consumeTill(U,de,y)}consumeOneOrMore(U,de,ge){let it=de;for(;ge(U[it]);)it++;if(it-de==0)throw new Error("Invalid rule at ".concat(de,"."));return it}consumeSpace(U,de){if(U[de]===y)return de+1;throw new Error("Invalid space at ".concat(de,"."))}consumeIP4Address(U,de){let ge=de;for(let it=0;it<4;it++)if(ge=this.consumeDecimalUChar(U,ge),it!==3){if(U[ge]!==".")throw new Error("Invalid IP4 address.");ge++}return ge}consumeDecimalUChar(U,de){let ge=de;for(let an=0;an<3&&b(U[ge]);an++,ge++);if(ge-de==0)throw new Error("Invalid decimal uchar.");const it=parseInt(U.slice(de,ge));if(it>=0&&it<=255)return ge;throw new Error("Invalid decimal uchar")}consumeIP6Address(U,de){let ge=this.consumeHexpart(U,de);return U[ge]===":"&&(ge+=1,ge=this.consumeIP4Address(U,ge)),ge}consumeHexpart(U,de){let ge=de;if(U[ge]===":"&&U[ge+1]===":"){ge+=2;try{ge=this.consumeHexseq(U,ge)}catch{}return ge}if(ge=this.consumeHexseq(U,ge),U[ge]===":"&&U[ge+1]===":"){ge+=2;try{ge=this.consumeHexseq(U,ge)}catch{}return ge}return ge}consumeHexseq(U,de){let ge=de;for(;ge=this.consumeHex4(U,ge),U[ge]===":"&&U[ge+1]!==":";)ge+=1;return ge}consumeHex4(U,de){let ge=0;for(;ge<4;ge++)if(!((it=U[de+ge])>="0"&&it<="9"||it>="a"&&it<="f"||it>="A"&&it<="F")){if(ge===0)throw new Error("Invalid hex 4");break}var it;return de+ge}consumeFQDN(U,de){let ge=de;for(;b(U[ge])||W(U[ge])||U[ge]==="-"||U[ge]===".";)ge+=1;if(ge-de<4)throw new Error("Invalid FQDN");return ge}consumeExtnAddr(U,de){return this.consumeOneOrMore(U,de,O)}consumeMulticastAddress(U,de,ge){switch(ge){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(U,de);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(U,de);default:try{return this.consumeFQDN(U,de)}catch{return this.consumeExtnAddr(U,de)}}}consumeIP6MulticastAddress(U,de){const ge=this.consumeHexpart(U,de);return U[ge]==="/"?this.consumeInteger(U,ge+1):ge}consumeIP4MulticastAddress(U,de){let ge=de+3;const it=U.slice(de,ge),an=parseInt(it);if(an<224||an>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let br=0;br<3;br++){if(U[ge]!==".")throw new Error("Invalid IP4 multicast address.");ge+=1,ge=this.consumeDecimalUChar(U,ge)}return U[ge]==="/"&&(ge+=1),ge=this.consumeTTL(U,ge),U[ge]==="/"&&(ge=this.consumeInteger(U,ge)),ge}consumeInteger(U,de){if(!Y(U[de]))throw new Error("Invalid integer.");for(de+=1;b(U[de]);)de+=1;return de}consumeTTL(U,de){if(U[de]==="0")return de+1;if(!Y(U[de]))throw new Error("Invalid TTL.");de+=1;for(let ge=0;ge<2&&b(U[de]);ge++)de+=1;return de}consumeToken(U,de){return this.consumeOneOrMore(U,de,N)}consumeTime(U,de){let ge=de;if(U[ge]==="0")return ge+1;for(Y(U[ge])&&(ge+=1);b(U[ge]);)ge++;if(ge-de<10)throw new Error("Invalid time");return ge}consumeAddress(U,de){return this.consumeTill(U,de,y)}consumeTypedTime(U,de){let ge=de;return ge=this.consumeOneOrMore(U,ge,b),H(U[ge])?ge+1:ge}consumeRepeatInterval(U,de){if(!Y(U[de]))throw new Error("Invalid repeat interval");for(de+=1;b(U[de]);)de+=1;return H(U[de])&&(de+=1),de}consumePort(U,de){return this.consumeOneOrMore(U,de,b)}consume(U,de,ge){for(let it=0;it<ge.length;it++){if(de+it>=U.length)throw new Error("consume exceeding value length");if(U[de+it]!==ge[it])throw new Error("consume ".concat(ge," failed at ").concat(it))}return de+ge.length}consumeTill(U,de,ge){let it=de;for(;it<U.length&&(typeof ge!="string"||U[it]!==ge)&&(typeof ge!="function"||!ge(U[it]));)it++;return it}}class mt extends et{constructor(){super(),Le(this,"records",[]),Le(this,"currentLine",0)}parse(U){const de=this.probeEOL(U);this.records=U.split(de).filter(I_=>!!ha(I_).call(I_)).map(this.parseLine),this.currentLine=0;const ge=this.parseVersion(),it=this.parseOrigin(),an=this.parseSessionName(),br=this.parseInformation(),Is=this.parseUri(),Mc=this.parseEmail(),bp=this.parsePhone(),R_=this.parseConnection(),ww=this.parseBandWidth(),eP=this.parseTimeFields(),tP=this.parseKey(),Dl=this.parseSessionAttribute(),og=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ge,origin:it,sessionName:an,information:br,uri:Is,emails:Mc,phones:bp,connection:R_,bandwidths:ww,timeFields:eP,key:tP,attributes:Dl,mediaDescriptions:og}}getCurrentRecord(){const U=this.records[this.currentLine];if(!U)throw new Error("Record doesn't exit.");return U}probeEOL(U){for(let de=0;de<U.length;de++)if(U[de]===p)return U[de-1]==="\r"?v:p;throw new Error("Invalid newline character.")}parseLine(U,de){if(U.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ge=U[0];if(U[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ge,value:U.slice(2),line:de,cur:0}}parseSessionAttribute(){const U=new xn;for(;this.currentLine<this.records.length;){const de=this.getCurrentRecord();if(de.type!==S.ATTRIBUTE)break;const ge={attField:this.extractOneOrMore(de,it=>N(it)&&it!==":"),_cur:0};de.value[de.cur]===":"&&(de.cur+=1,ge.attValue=this.extractOneOrMore(de,ne)),U.parse(ge),this.currentLine++}return U.digest()}parseMediaAttributes(U){const de=new Mn(U);for(;this.currentLine<this.records.length;){const ge=this.getCurrentRecord();if(ge.type!==S.ATTRIBUTE)break;const it={attField:this.extractOneOrMore(ge,an=>N(an)&&an!==":"),_cur:0};ge.value[ge.cur]===":"&&(ge.cur+=1,it.attValue=this.extractOneOrMore(ge,ne)),de.parse(it),this.currentLine++}return de.digest()}parseKey(){const U=this.getCurrentRecord();if(U.type===S.KEY){if(U.value==="prompt"||U.value==="clear:"||U.value==="base64:"||U.value==="uri:")return U.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const U=this.getCurrentRecord();if(U.type===S.ZONE_ADJUSTMENTS){const de=[];for(;;)try{const ge=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);let it=!1;U.value[U.cur]==="-"&&(it=!0,U.cur+=1);const an=this.extract(U,this.consumeTypedTime);de.push({time:ge,typedTime:an,back:it})}catch{break}if(de.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,de}return[]}parseRepeat(){const U=[];for(;;){const de=this.getCurrentRecord();if(de.type!==S.REPEAT)break;{const ge=this.extract(de,this.consumeRepeatInterval),it=this.parseTypedTime(de);U.push({repeatInterval:ge,typedTimes:it}),this.currentLine++}}return U}parseTypedTime(U){const de=[];for(;;)try{this.consumeSpaceForRecord(U),de.push(this.extract(U,this.consumeTypedTime))}catch{break}if(de.length===0)throw new Error("Invalid typed time.");return de}parseTime(){const U=this.getCurrentRecord(),de=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);const ge=this.extract(U,this.consumeTime);return this.currentLine++,{startTime:de,stopTime:ge}}parseBandWidth(){const U=[];for(;this.currentLine<this.records.length;){const de=this.getCurrentRecord();if(de.type!==S.BANDWIDTH)break;{const ge=this.extractOneOrMore(de,N);if(de.value[de.cur]!==":")throw new Error("Invalid bandwidth field.");de.cur++;const it=this.extractOneOrMore(de,b);U.push({bwtype:ge,bandwidth:it}),this.currentLine++}}return U}parseVersion(){const U=this.getCurrentRecord();if(U.type!==S.VERSION)throw new Error("first sdp record must be version");const de=U.value.slice(0,this.consumeOneOrMore(U.value,0,b));if(de.length!==U.value.length)throw new Error('invalid proto version, "v='.concat(U.value,'"'));return this.currentLine++,de}parseOrigin(){const U=this.getCurrentRecord();if(U.type!==S.ORIGIN)throw new Error("second line of sdp must be origin");const de=this.extractOneOrMore(U,O);this.consumeSpaceForRecord(U);const ge=this.extractOneOrMore(U,b);this.consumeSpaceForRecord(U);const it=this.extractOneOrMore(U,b);this.consumeSpaceForRecord(U);const an=this.extractOneOrMore(U,N);this.consumeSpaceForRecord(U);const br=this.extractOneOrMore(U,N);this.consumeSpaceForRecord(U);const Is=this.extract(U,this.consumeUnicastAddress);return this.currentLine++,{username:de,sessId:ge,sessVersion:it,nettype:an,addrtype:br,unicastAddress:Is}}parseSessionName(){const U=this.getCurrentRecord();if(U.type===S.SESSION_NAME){const de=this.extract(U,this.consumeText);return this.currentLine++,de}}parseInformation(){const U=this.getCurrentRecord();if(U.type!==S.INFORMATION)return;const de=this.extract(U,this.consumeText);return this.currentLine++,de}parseUri(){const U=this.getCurrentRecord();if(U.type===S.URI)return this.currentLine++,U.value}parseEmail(){const U=[];for(;;){const de=this.getCurrentRecord();if(de.type!==S.EMAIL)break;U.push(de.value),this.currentLine++}return U}parsePhone(){const U=[];for(;;){const de=this.getCurrentRecord();if(de.type!==S.PHONE)break;U.push(de.value),this.currentLine++}return U}parseConnection(){const U=this.getCurrentRecord();if(U.type===S.CONNECTION){const de=this.extractOneOrMore(U,N);this.consumeSpaceForRecord(U);const ge=this.extractOneOrMore(U,N);this.consumeSpaceForRecord(U);const it=this.extract(U,this.consumeAddress);return this.currentLine++,{nettype:de,addrtype:ge,address:it}}}parseMedia(){const U=this.getCurrentRecord(),de=this.extract(U,this.consumeToken);this.consumeSpaceForRecord(U);let ge=this.extract(U,this.consumePort);U.value[U.cur]==="/"&&(U.cur+=1,ge+=this.extract(U,this.consumeInteger)),this.consumeSpaceForRecord(U);const it=[];for(it.push(this.extract(U,this.consumeToken));U.value[U.cur]==="/";)U.cur+=1,it.push(this.extract(U,this.consumeToken));if(it.length===0)throw new Error("Invalid proto");const an=this.parseFmt(U);return this.currentLine++,{mediaType:de,port:ge,protos:it,fmts:an}}parseTimeFields(){const U=[];for(;this.getCurrentRecord().type===S.TIME;){const de=this.parseTime(),ge=this.parseRepeat(),it=this.parseZone();U.push({time:de,repeats:ge,zones:it})}return U}parseMediaDescription(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===S.MEDIA;){const de=this.parseMedia(),ge=this.parseInformation(),it=this.parseConnections(),an=this.parseBandWidth(),br=this.parseKey(),Is=this.parseMediaAttributes(de);U.push({media:de,information:ge,connections:it,bandwidths:an,key:br,attributes:Is})}return U}parseConnections(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===S.CONNECTION;)U.push(this.parseConnection());return U}parseFmt(U){const de=[];for(;;)try{this.consumeSpaceForRecord(U),de.push(this.extract(U,this.consumeToken))}catch{break}if(de.length===0)throw new Error("Invalid fmts");return de}extract(U,de){for(var ge=arguments.length,it=new Array(ge>2?ge-2:0),an=2;an<ge;an++)it[an-2]=arguments[an];const br=de.call(this,U.value,U.cur,...it),Is=U.value.slice(U.cur,br);return U.cur=br,Is}extractOneOrMore(U,de){const ge=this.consumeOneOrMore(U.value,U.cur,de),it=U.value.slice(U.cur,ge);return U.cur=ge,it}consumeSpaceForRecord(U){if(U.value[U.cur]!==y)throw new Error("Invalid space at ".concat(U.cur,"."));U.cur+=1}}class Et extends et{constructor(){super(...arguments),Le(this,"attributes",void 0),Le(this,"digested",!1)}extractOneOrMore(U,de,ge){const it=this.consumeOneOrMore(U.attValue,U._cur,de),an=U.attValue.slice(U._cur,it),[br,Is]=ge||[];if(typeof br=="number"&&an.length<br)throw new Error("error in length, should be more or equal than ".concat(br," characters."));if(typeof Is=="number"&&an.length>Is)throw new Error("error in length, should be less or equal than ".concat(Is," characters."));return U._cur=it,an}consumeAttributeSpace(U){if(U.attValue[U._cur]!==y)throw new Error("Invalid space at ".concat(U._cur,"."));U._cur+=1}extract(U,de){if(!U.attValue)throw new Error("Nothing to extract from attValue.");for(var ge=arguments.length,it=new Array(ge>2?ge-2:0),an=2;an<ge;an++)it[an-2]=arguments[an];const br=de.call(this,U.attValue,U._cur,...it),Is=U.attValue.slice(U._cur,br);return U._cur=br,Is}atEnd(U){if(!U.attValue)throw new Error;return U._cur>=U.attValue.length}peekChar(U){if(!U.attValue)throw new Error;return U.attValue[U._cur]}peek(U,de){if(!U.attValue)throw new Error;for(let ge=0;ge<de.length;ge++)if(de[ge]!==U.attValue[U._cur+ge])return!1;return!0}parseIceUfrag(U){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(U,re,[4,256])}parseIcePwd(U){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(U,re,[22,256])}parseIceOptions(U){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const de=[];for(;!this.atEnd(U);){de.push(this.extractOneOrMore(U,re));try{this.consumeAttributeSpace(U)}catch(ge){if(this.atEnd(U))break;throw ge}}this.attributes.iceOptions=de}parseFingerprint(U){const de=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const ge=this.extract(U,this.consumeTill);this.attributes.fingerprints.push({hashFunction:de,fingerprint:ge})}parseExtmap(U){const de=this.extractOneOrMore(U,b);let ge;this.peekChar(U)==="/"&&(this.extract(U,this.consume,"/"),ge=this.extract(U,this.consumeToken)),this.consumeAttributeSpace(U);const it=this.extract(U,this.consumeTill,y),an=Se(Se({entry:parseInt(de,10)},ge&&{direction:ge}),{},{extensionName:it});this.peekChar(U)===y&&(this.consumeAttributeSpace(U),an.extensionAttributes=this.extract(U,this.consumeTill)),this.attributes.extmaps.push(an)}parseSetup(U){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const de=this.extract(U,this.consumeTill);if(de!=="active"&&de!=="passive"&&de!=="actpass"&&de!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=de}}class xn extends Et{constructor(){super(...arguments),Le(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"group":this.parseGroup(U);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"fingerprint":this.parseFingerprint(U);break;case"setup":this.parseSetup(U);break;case"tls-id":this.parseTlsId(U);break;case"identity":this.parseIdentity(U);break;case"extmap":this.parseExtmap(U);break;case"msid-semantic":this.parseMsidSemantic(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(de){throw console.error("parsing session attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),de}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(U){const de=this.extract(U,this.consumeToken),ge=[];for(;!this.atEnd(U)&&this.peekChar(U)===y;)this.consumeAttributeSpace(U),ge.push(this.extract(U,this.consumeToken));this.attributes.groups.push({semantic:de,identificationTag:ge})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(U){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(U,me)}parseIdentity(U){const de=this.extractOneOrMore(U,be),ge=[];for(;!this.atEnd(U)&&this.peekChar(U)===y;){this.consumeAttributeSpace(U);const it=this.extract(U,this.consumeToken);this.extract(U,this.consume,"=");const an=this.extractOneOrMore(U,br=>br!==y&&ne(br));ge.push({name:it,value:an})}this.attributes.identities.push({assertionValue:de,extensions:ge})}parseMsidSemantic(U){this.peekChar(U)===y&&this.consumeAttributeSpace(U);const de={semantic:this.extract(U,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(U)}catch{break}if(this.peekChar(U)==="*"){this.extract(U,this.consume,"*"),de.applyForAll=!0;break}{const ge=this.extract(U,this.consumeTill,y);de.identifierList.push(ge)}}this.attributes.msidSemantic=de}}class Mn extends Et{constructor(U){super(),Le(this,"attributes",void 0),U.protos.indexOf("RTP")!==-1||U.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"extmap":this.parseExtmap(U);break;case"setup":this.parseSetup(U);break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"candidate":this.parseCandidate(U);break;case"remote-candidate":this.parseRemoteCandidate(U);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(U);break;case"rtpmap":this.parseRtpmap(U);break;case"ptime":this.parsePtime(U);break;case"maxptime":this.parseMaxPtime(U);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(U);break;case"ssrc":this.parseSSRC(U);break;case"fmtp":this.parseFmtp(U);break;case"rtcp-fb":this.parseRtcpFb(U);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(U);break;case"mid":this.parseMid(U);break;case"msid":this.parseMsid(U);break;case"imageattr":this.parseImageAttr(U);break;case"rid":this.parseRid(U);break;case"simulcast":this.parseSimulcast(U);break;case"sctp-port":this.parseSctpPort(U);break;case"max-message-size":this.parseMaxMessageSize(U);break;case"ssrc-group":this.parseSSRCGroup(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(de){throw console.error("parsing media attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),de}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}parseCandidate(U){const de=this.extractOneOrMore(U,re,[1,32]);this.consumeAttributeSpace(U);const ge=this.extractOneOrMore(U,b,[1,5]);this.consumeAttributeSpace(U);const it=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const an=this.extractOneOrMore(U,b,[1,10]);this.consumeAttributeSpace(U);const br=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const Is=this.extract(U,this.consumePort);this.consumeAttributeSpace(U),this.extract(U,this.consume,"typ"),this.consumeAttributeSpace(U);const Mc={foundation:de,componentId:ge,transport:it,priority:an,connectionAddress:br,port:Is,type:this.extract(U,this.consumeToken),extension:{}};for(this.peek(U," raddr")&&(this.extract(U,this.consume," raddr"),this.consumeAttributeSpace(U),Mc.relAddr=this.extract(U,this.consumeAddress)),this.peek(U," rport")&&(this.extract(U,this.consume," rport"),this.consumeAttributeSpace(U),Mc.relPort=this.extract(U,this.consumePort));this.peekChar(U)===y;){this.consumeAttributeSpace(U);const bp=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U),Mc.extension[bp]=this.extractOneOrMore(U,R)}this.attributes.candidates.push(Mc)}parseRemoteCandidate(U){const de=[];for(;;){const ge=this.extractOneOrMore(U,b,[1,5]);this.consumeAttributeSpace(U);const it=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const an=this.extract(U,this.consumePort);de.push({componentId:ge,connectionAddress:it,port:an});try{this.consumeAttributeSpace(U)}catch{break}}this.attributes.remoteCandidatesList.push(de)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(U){const de=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const ge=this.extract(U,this.consumeTill,"/");this.extract(U,this.consume,"/");const it={encodingName:ge,clockRate:this.extractOneOrMore(U,b)};this.atEnd(U)||this.peekChar(U)!=="/"||(this.extract(U,this.consume,"/"),it.encodingParameters=parseInt(this.extract(U,this.consumeTill),10));const an=this.attributes.payloads.find(br=>br.payloadType===parseInt(de,10));an?an.rtpMap=it:this.attributes.payloads.push({payloadType:parseInt(de,10),rtpMap:it,rtcpFeedbacks:[]})}parsePtime(U){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(U,this.consumeTill)}parseMaxPtime(U){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(U,this.consumeTill)}parseDirection(U){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=U.attField}parseSSRC(U){const de=this.extractOneOrMore(U,b);this.consumeAttributeSpace(U);const ge=this.extract(U,this.consumeTill,":");let it;this.peekChar(U)===":"&&(this.extract(U,this.consume,":"),it=this.extract(U,this.consumeTill));const an=this.attributes.ssrcs.find(br=>br.ssrcId===parseInt(de,10));an?an.attributes[ge]=it:this.attributes.ssrcs.push({ssrcId:parseInt(de,10),attributes:{[ge]:it}})}parseFmtp(U){const de=this.extract(U,this.consumeTill,y);this.consumeAttributeSpace(U);const ge=this.extract(U,this.consumeTill),it={};ge.split(";").forEach(br=>{let[Is,Mc]=br.split("=");Is=ha(Is).call(Is);const bp=typeof Mc=="string"?ha(Mc).call(Mc):null;typeof Is=="string"&&Is.length>0&&(it[Is]=bp)});const an=this.attributes.payloads.find(br=>br.payloadType===parseInt(de,10));an?an.fmtp={parameters:it}:this.attributes.payloads.push({payloadType:parseInt(de,10),rtcpFeedbacks:[],fmtp:{parameters:it}})}parseFmtParameters(U){const de={},ge=this.extract(U,this.consumeTill,"=");U._cur++;const it=this.extract(U,this.consumeTill,";");for(de[ge]=it;U.attValue[U._cur]===";";){const an=this.extract(U,this.consumeTill,"=");U._cur++;const br=this.extract(U,this.consumeTill,";");de[an]=br}return de}parseRtcpFb(U){let de="";de=this.peekChar(U)==="*"?this.extract(U,this.consume,"*"):this.extract(U,this.consumeTill,y),this.consumeAttributeSpace(U);const ge=this.extract(U,this.consumeTill,y);let it;if(ge==="trr-int")it={type:ge,interval:this.extract(U,this.consumeTill)};else{const an={type:ge};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),an.parameter=this.extract(U,this.consumeToken),this.peekChar(U)===y&&(an.additional=this.extract(U,this.consumeTill))),it=an}if(de==="*")this.attributes.rtcpFeedbackWildcards.push(it);else{const an=this.attributes.payloads.find(br=>br.payloadType===parseInt(de,10));an?an.rtcpFeedbacks.push(it):this.attributes.payloads.push({payloadType:parseInt(de,10),rtcpFeedbacks:[it]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(U){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const de={port:this.extract(U,this.consumePort)};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),de.netType=this.extractOneOrMore(U,N),this.consumeAttributeSpace(U),de.addressType=this.extractOneOrMore(U,N),this.consumeAttributeSpace(U),de.address=this.extract(U,this.consumeAddress)),this.attributes.rtcp=de}parseMsid(U){const de={id:this.extractOneOrMore(U,N,[1,64])};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),de.appdata=this.extractOneOrMore(U,N,[1,64])),this.attributes.msids.push(de)}parseImageAttr(U){this.attributes.imageattr.push(U.attValue)}parseRid(U){const de=this.extractOneOrMore(U,it=>W(it)||b(it)||it==="_"||it==="-");this.consumeAttributeSpace(U);const ge={id:de,direction:this.extract(U,this.consumeToken),params:[]};if(this.peekChar(U)===y){if(this.consumeAttributeSpace(U),this.peek(U,"pt=")){this.extract(U,this.consume,"pt=");const it=[];for(;;){const an=this.extract(U,this.consumeToken);it.push(an);try{this.extract(U,this.consume,",")}catch{break}}ge.payloads=it,this.peekChar(U)===y&&this.extract(U,this.consume,y)}for(;;){const it=this.extract(U,this.consumeToken);switch(it){case"depend":{const an={type:it,rids:this.extract(U,this.consume,"=").split(",")};ge.params.push(an);break}default:{const an={type:it};this.peekChar(U)==="="&&(this.extract(U,this.consume,"="),an.val=this.extract(U,this.consumeTill,";")),ge.params.push(an)}}try{this.extract(U,this.consume,";")}catch{break}}}this.attributes.rids.push(ge)}parseSimulcast(U){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=U.attValue,this.extract(U,this.consumeTill)}parseSctpPort(U){this.attributes.sctpPort=this.extractOneOrMore(U,b,[1,5])}parseMaxMessageSize(U){this.attributes.maxMessageSize=this.extractOneOrMore(U,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(U){this.attributes.mid=this.extract(U,this.consumeToken)}parseSSRCGroup(U){const de=this.extract(U,this.consumeToken),ge=[];for(;;)try{this.consumeAttributeSpace(U);const it=this.extract(U,this.consumeInteger);ge.push(parseInt(it,10))}catch{break}this.attributes.ssrcGroups.push({semantic:de,ssrcIds:ge})}}function Lr(Xe,U,de){return U in Xe?Object.defineProperty(Xe,U,{value:de,enumerable:!0,configurable:!0,writable:!0}):Xe[U]=de,Xe}class Vi{constructor(){Lr(this,"eol",v)}print(U,de){let ge="";return de&&(this.eol=de),ge+=this.printVersion(U.version),ge+=this.printOrigin(U.origin),ge+=this.printSessionName(U.sessionName),ge+=this.printInformation(U.information),ge+=this.printUri(U.uri),ge+=this.printEmail(U.emails),ge+=this.printPhone(U.phones),ge+=this.printConnection(U.connection),ge+=this.printBandwidth(U.bandwidths),ge+=this.printTimeFields(U.timeFields),ge+=this.printKey(U.key),ge+=this.printSessionAttributes(U.attributes),ge+=this.printMediaDescription(U.mediaDescriptions),ge}printVersion(U){return"v=".concat(U).concat(this.eol)}printOrigin(U){return"o=".concat(U.username," ").concat(U.sessId," ").concat(U.sessVersion," ").concat(U.nettype," ").concat(U.addrtype," ").concat(U.unicastAddress).concat(this.eol)}printSessionName(U){return U?"s=".concat(U).concat(this.eol):""}printInformation(U){return U?"i=".concat(U).concat(this.eol):""}printUri(U){return U?"u=".concat(U).concat(this.eol):""}printEmail(U){let de="";for(const ge of U)de+="e=".concat(ge).concat(this.eol);return de}printPhone(U){let de="";for(const ge of U)de+="e=".concat(ge).concat(this.eol);return de}printConnection(U){return U?"c=".concat(U.nettype," ").concat(U.addrtype," ").concat(U.address).concat(this.eol):""}printBandwidth(U){let de="";for(const ge of U)de+="b=".concat(ge.bwtype,":").concat(ge.bandwidth).concat(this.eol);return de}printTimeFields(U){let de="";for(const ge of U){de+="t=".concat(ge.time.startTime," ").concat(ge.time.startTime).concat(this.eol);for(const it of ge.repeats)de+="r=".concat(it.repeatInterval," ").concat(it.typedTimes.join(" ")).concat(this.eol);ge.zoneAdjustments&&(de+="z=",de+="z=".concat(ge.zoneAdjustments.map(it=>"".concat(it.time," ").concat(it.back?"-":""," ").concat(it.typedTime)).join(" ")).concat(this.eol),de+=this.eol)}return de}printKey(U){return U?"k=".concat(U).concat(this.eol):""}printAttributes(U){let de="";for(const ge of U)de+="a=".concat(ge.attField).concat(ge.attValue?":".concat(ge.attValue):"").concat(this.eol);return de}printMediaDescription(U){let de="";for(const ge of U)de+=this.printMedia(ge.media),de+=this.printInformation(ge.information),de+=this.printConnections(ge.connections),de+=this.printBandwidth(ge.bandwidths),de+=this.printKey(ge.key),de+=this.printMediaAttributes(ge);return de}printConnections(U){let de="";for(const ge of U)de+=this.printConnection(ge);return de}printMedia(U){return"m=".concat(U.mediaType," ").concat(U.port," ").concat(U.protos.join("/")," ").concat(U.fmts.join(" ")).concat(this.eol)}printSessionAttributes(U){return new ac(this.eol).print(U)}printMediaAttributes(U){return new Ge(this.eol).print(U)}}class wi{constructor(U){Lr(this,"eol",void 0),this.eol=U}printIceUfrag(U){return U===void 0?"":"a=ice-ufrag:".concat(U).concat(this.eol)}printIcePwd(U){return U===void 0?"":"a=ice-pwd:".concat(U).concat(this.eol)}printIceOptions(U){return U===void 0?"":"a=ice-options:".concat(U.join(y)).concat(this.eol)}printFingerprints(U){return U.length>0?U.map(de=>"a=fingerprint:".concat(de.hashFunction).concat(y).concat(de.fingerprint)).join(this.eol)+this.eol:""}printExtmap(U){return U.map(de=>"a=extmap:".concat(de.entry).concat(de.direction?"/".concat(de.direction):"").concat(y).concat(de.extensionName).concat(de.extensionAttributes?"".concat(y).concat(de.extensionAttributes):"").concat(this.eol)).join("")}printSetup(U){return U===void 0?"":"a=setup:".concat(U).concat(this.eol)}printUnrecognized(U){return U.map(de=>"a=".concat(de.attField).concat(de.attValue?":".concat(de.attValue):"").concat(this.eol)).join("")}}class ac extends wi{print(U){let de="";return de+=this.printGroups(U.groups),de+=this.printMsidSemantic(U.msidSemantic),de+=this.printIceLite(U.iceLite),de+=this.printIceUfrag(U.iceUfrag),de+=this.printIcePwd(U.icePwd),de+=this.printIceOptions(U.iceOptions),de+=this.printFingerprints(U.fingerprints),de+=this.printSetup(U.setup),de+=this.printTlsId(U.tlsId),de+=this.printIdentity(U.identities),de+=this.printExtmap(U.extmaps),de+=this.printUnrecognized(U.unrecognized),de}printGroups(U){let de="";return U.length>0&&(de+=U.map(ge=>"a=group:".concat(ge.semantic).concat(ge.identificationTag.map(it=>"".concat(y).concat(it)).join("")).concat(this.eol)).join("")),de}printIceLite(U){return U===void 0?"":"a=ice-lite"+this.eol}printTlsId(U){return U?"a=tls-id:".concat(U).concat(this.eol):""}printIdentity(U){return U.length===0?"":U.map(de=>"a=identity:".concat(de.assertionValue).concat(de.extensions.map(ge=>"".concat(y).concat(ge.name).concat(ge.value?"=".concat(ge.value):"")))).join(this.eol)+this.eol}printMsidSemantic(U){if(!U)return"";let de="a=msid-semantic:".concat(U.semantic);return U.applyForAll?de+="".concat(y,"*"):U.identifierList.length>0&&(de+=U.identifierList.map(ge=>"".concat(y).concat(ge))),de+this.eol}}class Ge extends wi{print(U){const de=U.attributes;let ge="";return ge+=this.printRTCP(de.rtcp),ge+=this.printIceUfrag(de.iceUfrag),ge+=this.printIcePwd(de.icePwd),ge+=this.printIceOptions(de.iceOptions),ge+=this.printCandidates(de.candidates),ge+=this.printRemoteCandidatesList(de.remoteCandidatesList),ge+=this.printEndOfCandidates(de.endOfCandidates),ge+=this.printFingerprints(de.fingerprints),ge+=this.printSetup(de.setup),ge+=this.printMid(de.mid),ge+=this.printExtmap(de.extmaps),ge+=this.printRTPRelated(de),ge+=this.printPtime(de.ptime),ge+=this.printMaxPtime(de.maxPtime),ge+=this.printDirection(de.direction),ge+=this.printSSRCGroups(de.ssrcGroups),ge+=this.printSSRC(de.ssrcs),ge+=this.printRTCPMux(de.rtcpMux),ge+=this.printRTCPMuxOnly(de.rtcpMuxOnly),ge+=this.printRTCPRsize(de.rtcpRsize),ge+=this.printMSId(de.msids),ge+=this.printImageattr(de.imageattr),ge+=this.printRid(de.rids),ge+=this.printSimulcast(de.simulcast),ge+=this.printSCTPPort(de.sctpPort),ge+=this.printMaxMessageSize(de.maxMessageSize),ge+=this.printUnrecognized(de.unrecognized),ge}printCandidates(U){return U.map(de=>"a=candidate:".concat(de.foundation).concat(y).concat(de.componentId).concat(y).concat(de.transport).concat(y).concat(de.priority).concat(y).concat(de.connectionAddress).concat(y).concat(de.port).concat(y,"typ").concat(y).concat(de.type).concat(de.relAddr?"".concat(y,"raddr").concat(y).concat(de.relAddr):"").concat(de.relPort?"".concat(y,"rport").concat(y).concat(de.relPort):"").concat(Object.keys(de.extension).map(ge=>"".concat(y).concat(ge).concat(y).concat(de.extension[ge])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(U){return U.map(de=>"a=remote-candidates:".concat(de.join(y)).concat(this.eol)).join("")}printEndOfCandidates(U){return U===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(U){if(!U.payloads)return"";const de=U.payloads;let ge="";ge+=U.rtcpFeedbackWildcards.map(it=>this.printRTCPFeedback("*",it)).join("");for(const it of de)ge+=this.printRtpMap(it.payloadType,it.rtpMap),ge+=this.printFmtp(it.payloadType,it.fmtp),ge+=it.rtcpFeedbacks.map(an=>this.printRTCPFeedback(it.payloadType,an)).join("");return ge}printFmtp(U,de){if(!de)return"";const ge=Object.keys(de.parameters);return ge.length===1&&de.parameters[ge[0]]===null?"a=fmtp:".concat(U).concat(y).concat(ge[0]).concat(this.eol):"a=fmtp:".concat(U).concat(y).concat(Object.keys(de.parameters).map(it=>"".concat(it,"=").concat(de.parameters[it])).join(";")).concat(this.eol)}printRtpMap(U,de){return de?"a=rtpmap:".concat(U).concat(y).concat(de.encodingName,"/").concat(de.clockRate).concat(de.encodingParameters?"/".concat(de.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(U,de){let ge="a=rtcp-fb:".concat(U).concat(y),it=de;return it.type==="trr-int"?ge+="ttr-int".concat(y).concat(it.interval):(ge+="".concat(it.type),it.parameter&&(ge+="".concat(y).concat(it.parameter),it.additional&&(ge+="".concat(y).concat(it.additional)))),ge+this.eol}printPtime(U){return U===void 0?"":"a=ptime:".concat(U).concat(this.eol)}printMaxPtime(U){return U===void 0?"":"a=maxptime:".concat(U).concat(this.eol)}printDirection(U){return U===void 0?"":"a=".concat(U).concat(this.eol)}printSSRC(U){return U.map(de=>Object.keys(de.attributes).map(ge=>"a=ssrc:".concat(de.ssrcId.toString(10)).concat(y).concat(ge).concat(de.attributes[ge]?":".concat(de.attributes[ge]):"").concat(this.eol)).join("")).join("")}printRTCPMux(U){return U===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(U){return U===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(U){return U===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(U){if(U===void 0)return"";let de="a=rtcp:".concat(U.port);return U.netType&&(de+="".concat(y).concat(U.netType)),U.addressType&&(de+="".concat(y).concat(U.addressType)),U.address&&(de+="".concat(y).concat(U.address)),de+this.eol}printMSId(U){return U.map(de=>"a=msid:".concat(de.id).concat(de.appdata?"".concat(y).concat(de.appdata):"").concat(this.eol)).join("")}printImageattr(U){return U.map(de=>"a=imageattr:".concat(de).concat(this.eol)).join("")}printRid(U){return U.map(de=>{let ge="a=rid:".concat(de.id).concat(y).concat(de.direction);return de.payloads&&(ge+="".concat(y,"pt=").concat(de.payloads.join(","))),de.params.length>0&&(ge+="".concat(y).concat(de.params.map(it=>it.type==="depend"?"depend=".concat(it.rids.join(",")):"".concat(it.type,"=").concat(it.val)).join(";"))),ge+this.eol}).join("")}printSimulcast(U){return U===void 0?"":"a=simulcast:".concat(U).concat(this.eol)}printSCTPPort(U){return U===void 0?"":"a=sctp-port:".concat(U).concat(this.eol)}printMaxMessageSize(U){return U===void 0?"":"a=max-message-size:".concat(U).concat(this.eol)}printMid(U){return U===void 0?"":"a=mid:".concat(U).concat(this.eol)}printSSRCGroups(U){return U.map(de=>"a=ssrc-group:".concat(de.semantic).concat(de.ssrcIds.map(ge=>"".concat(y).concat(ge.toString(10))).join("")).concat(this.eol)).join("")}}function lt(Xe){return new mt().parse(Xe)}function Rt(Xe,U){return new Vi().print(Xe,U)}}},i={};function s(c){if(i[c])return i[c].exports;var l=i[c]={exports:{}};return n[c](l,l.exports,s),l.exports}return s.d=(c,l)=>{for(var h in l)s.o(l,h)&&!s.o(c,h)&&Object.defineProperty(c,h,{enumerable:!0,get:l[h]})},s.o=(c,l)=>Object.prototype.hasOwnProperty.call(c,l),s.r=c=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},s(8)})();function Nc(n){return H9.parse(n)}function zm(n,i){return H9.print(n,i)}var Yye=tu("Array").keys,Xye=ku,Jye=Ti,Qye=I,Zye=Yye,wM=Array.prototype,eEe={DOMTokenList:!0,NodeList:!0},tEe=function(n){var i=n.keys;return n===wM||Qye(wM,n)&&i===wM.keys||Jye(eEe,Xye(n))?Zye:i},zu=a(tEe);function K9(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function fn(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?K9(Object(s),!0).forEach(function(c){Ei(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):K9(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function Ei(n,i,s){return(i=function(c){var l=function(h,p){if(typeof h!="object"||h===null)return h;var v=h[Symbol.toPrimitive];if(v!==void 0){var y=v.call(h,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(h)}(c);return typeof l=="symbol"?l:String(l)}(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}const q9=new class extends li{constructor(){super(...arguments),Ei(this,"currentUploadLogID",0)}reportLogUploadError(n){const{errorRange:i}=n;i[i.length-1]&&i[i.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=i[i.length-1],this.emit("REPORT_LOG_UPLOAD",n))}};class nEe{constructor(i){Ei(this,"logger",void 0),Ei(this,"prefixLists",[]),this.logger=i}debug(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];this.logger.debug(...this.prefixLists,...s)}info(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];this.logger.info(...this.prefixLists,...s)}warning(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];this.logger.warning(...this.prefixLists,...s)}error(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];this.logger.error(...this.prefixLists,...s)}prefix(i){return this.prefixLists.push(i),this}popPrefix(){return this.prefixLists.pop(),this}}function CM(){const n=new Date;return n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}function $9(){const n=new Date,i=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return i?(i==null?void 0:i[0])+":"+n.getUTCMilliseconds():n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}const Rl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Gk=Date.now(),Wb=n=>{for(const i in Rl)if(Object.prototype.hasOwnProperty.call(Rl,i)&&Rl[i]===n)return i;return"DEFAULT"},x=new class{constructor(){Ei(this,"proxyServerURL",void 0),Ei(this,"logLevel",Rl.DEBUG),Ei(this,"uploadState","collecting"),Ei(this,"uploadLogWaitingList",[]),Ei(this,"uploadLogUploadingList",[]),Ei(this,"uploadErrorCount",0),Ei(this,"currentLogID",0),Ei(this,"url",void 0),Ei(this,"extLog",(n,i)=>{this.appendLogToWaitingList(n,...i)})}debug(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const c=[Rl.DEBUG].concat(i);this.log.apply(this,c)}info(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const c=[Rl.INFO].concat(i);this.log.apply(this,c)}warning(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const c=[Rl.WARNING].concat(i);this.log.apply(this,c)}warn(){this.warning(...arguments)}error(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const c=[Rl.ERROR].concat(i);this.log.apply(this,c)}upload(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const c=[Rl.DEBUG].concat(i);this.uploadLog.apply(this,c)}setLogLevel(n){n=Math.min(Math.max(0,n),4),this.logLevel=n}enableLogUpload(){_r("UPLOAD_LOG",!0)}disableLogUpload(){_r("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(n){this.proxyServerURL=n}prefix(n){return new nEe(this).prefix(n)}log(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];if(Date.now()-Gk<100)return void setTimeout(()=>{this.log(...i)},Date.now()-Gk);const c=Math.max(0,Math.min(4,i[0]));if(i[0]=CM()+" Agora-SDK [".concat(Wb(c),"]:"),this.appendLogToWaitingList(c,...i),c<this.logLevel)return;const l=CM()+" %cAgora-SDK [".concat(Wb(c),"]:");let h=[];if(!le("USE_NEW_LOG"))switch(c){case Rl.DEBUG:h=[l,"color: #64B5F6;"].concat(i.slice(1)),console.log.apply(console,h);break;case Rl.INFO:h=[l,"color: #1E88E5; font-weight: bold;"].concat(i.slice(1)),console.log.apply(console,h);break;case Rl.WARNING:h=[l,"color: #FB8C00; font-weight: bold;"].concat(i.slice(1)),console.warn.apply(console,h);break;case Rl.ERROR:h=[l,"color: #B00020; font-weight: bold;"].concat(i.slice(1)),console.error.apply(console,h)}}uploadLog(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];if(Date.now()-Gk<100)return void setTimeout(()=>{this.uploadLog(...i)},Date.now()-Gk);const c=Math.max(0,Math.min(4,i[0]));i[0]=CM()+" Agora-SDK [".concat(Wb(c),"]:"),this.appendLogToWaitingList(c,...i)}appendLogToWaitingList(n){if(!le("UPLOAD_LOG"))return;for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];Array.isArray(s[0])?s[0][0]=$9()+" Agora-SDK [".concat(Wb(n),"]:"):s[0]=$9()+" Agora-SDK [".concat(Wb(n),"]:");let l="";s.forEach(h=>{typeof h=="object"&&(h=JSON.stringify(h)),l+="".concat(h," ")}),this.uploadLogWaitingList.push({payload_str:l,log_level:n,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const n=this.uploadLogUploadingList,i={sdk_version:Cl,process_id:le("PROCESS_ID"),payload:JSON.stringify(n)};return Jd(async()=>{const s=await tc.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(le("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(le("LOG_UPLOAD_SERVER"),"/upload/v1")),i,{responseType:"text"});if(s.data!=="OK"){const c=new Error("unexpected upload log response");throw c.response=s,c}},()=>(this.uploadLogUploadingList=[],!1),s=>{const c={status:-1,message:s.message,errorRange:n.map(l=>l.log_item_id)};return s.response?(c.status=s.response.status,c.data=s.response.data,c.headers=s.response.headers):s.request&&(c.status=s.request.status),q9.reportLogUploadError(c),!0},{timeout:le("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:le("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,le("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),le("UPLOAD_LOG_INTERVAL"))}).catch(n=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),le("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),le("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var Y9;function rEe(n){return qs(n.reportId,"params.reportId",0,100,!1),qs(n.category,"params.category",0,100,!1),qs(n.event,"params.event",0,100,!1),qs(n.label,"params.label",0,100,!1),Tr(n.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(Y9={}).FREE="free",Y9.UPLOADING="uploading",function(n){n[n.MISC=0]="MISC",n[n.INTERNAL_EVENT=1]="INTERNAL_EVENT",n[n.PUBLIC_EVENT=2]="PUBLIC_EVENT",n[n.WEB_EVENT=3]="WEB_EVENT",n[n.INTERNAL_API=4]="INTERNAL_API",n[n.WEB_API=5]="WEB_API",n[n.PUBLIC_API=6]="PUBLIC_API"}({});const iEe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Cs=function(n){return n.PUBLISH="publish",n.SUBSCRIBE="subscribe",n.WS_COMPRESSOR_INIT="ws_compressor_init",n.SESSION_INIT="session_init",n.JOIN_CHOOSE_SERVER="join_choose_server",n.REQ_USER_ACCOUNT="req_user_account",n.JOIN_GATEWAY="join_gateway",n.REJOIN_GATEWAY="rejoin_gateway",n.STREAM_SWITCH="stream_switch",n.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",n.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",n.FIRST_VIDEO_RECEIVED="first_video_received",n.FIRST_AUDIO_RECEIVED="first_audio_received",n.FIRST_VIDEO_DECODE="first_video_decode",n.FIRST_AUDIO_DECODE="first_audio_decode",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_UPDATE_STREAM="on_update_stream",n.ON_REMOVE_STREAM="on_remove_stream",n.USER_ANALYTICS="req_user_analytics",n.PC_STATS="pc_stats",n.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",n.AB_TEST="ab_test",n}({}),ni=function(n){return n.SESSION="io.agora.pb.Wrtc.Session",n.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",n.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",n.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",n.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",n.PUBLISH="io.agora.pb.Wrtc.Publish",n.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",n.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",n.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",n.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",n.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",n.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",n.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",n.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",n.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",n.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",n.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",n.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",n.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",n.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",n.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",n.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",n.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",n.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",n.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",n.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",n.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",n.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",n.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",n.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",n.PC_STATS="io.agora.pb.Wrtc.PCStats",n.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",n.AB_TEST="io.agora.pb.Wrtc.ABTest",n}({});(function(n){n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let sEe=function(n){return n[n.SESSION=26]="SESSION",n[n.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",n[n.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",n[n.JOIN_GATEWAY=28]="JOIN_GATEWAY",n[n.PUBLISH=30]="PUBLISH",n[n.SUBSCRIBE=29]="SUBSCRIBE",n[n.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",n[n.STREAM_SWITCH=32]="STREAM_SWITCH",n[n.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",n[n.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",n[n.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",n[n.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",n[n.API_INVOKE=41]="API_INVOKE",n[n.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",n[n.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",n[n.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",n[n.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",n[n.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",n[n.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",n[n.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",n[n.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",n[n.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",n[n.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",n[n.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",n[n.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",n[n.USER_ANALYTICS=1e4]="USER_ANALYTICS",n[n.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",n}({});function zt(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(i,s,c){const l=c.value;if(typeof l=="function"){const h=n.className||i.__className__||(i.constructor.name==="AgoraRTCClient"?"Client":i.constructor.name);c.value=function(){for(var p,v=arguments.length,y=new Array(v),S=0;S<v;S++)y[S]=arguments[S];let b=y;if(n.argsMap)try{b=n.argsMap(this,...y)}catch(O){x.warning(O),b=[]}try{JSON.stringify(b)}catch{x.warning("arguments for method ".concat(h,".").concat(String(s)," not serializable for apiInvoke.")),b=[]}const R=(n.report||kt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((p=this.store)===null||p===void 0?void 0:p.clientId)||this._ID,name:"".concat(h,".").concat(String(s)),options:b,tag:_i.TRACER,reportResult:n.reportResult},n.throttleTime);try{const O=l.apply(this,y);return O instanceof pt?O.then(N=>(R.onSuccess(n.reportResult&&N),N)).catch(N=>{throw R.onError(N),N}):(R.onSuccess(n.reportResult&&O),O)}catch(O){throw R.onError(O),O}}}return c}}const kt=new class{constructor(){Ei(this,"baseInfoMap",new Map),Ei(this,"proxyServer",void 0),Ei(this,"eventUploadTimer",void 0),Ei(this,"setSessionIdTimer",void 0),Ei(this,"url",void 0),Ei(this,"sids",new Set),Ei(this,"backupUrl",void 0),Ei(this,"_appId",void 0),Ei(this,"_aid",0),Ei(this,"keyEventUploadPendingItems",[]),Ei(this,"normalEventUploadPendingItems",[]),Ei(this,"apiInvokeUploadPendingItems",[]),Ei(this,"apiInvokeCount",0),Ei(this,"apiInvokeLoggedCount",0),Ei(this,"ltsList",[]),Ei(this,"lastSendNormalEventTime",Date.now()),Ei(this,"customReportCounterTimer",void 0),Ei(this,"customReportCount",0),Ei(this,"extApiInvoke",async n=>{for(const i of n){const s=fn(fn({},i),{},{sid:null,invokeId:++this.apiInvokeCount,tag:_i.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),le("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),le("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(n){return this.baseInfoMap.get(n)}setAppId(n){this._appId=n,this._aid=parseInt(n.replace(/[a-fA-F0-9]{8}/g,i=>{let[s,c]=i;return s+c}),16)||0}reportApiInvoke(n,i,s){i.timeout=i.timeout||6e4,i.reportResult=i.reportResult===void 0||i.reportResult;const c=Date.now();this.apiInvokeCount+=1;const l=this.apiInvokeCount,h=!!le("SHOW_REPORT_INVOKER_LOG"),p=!!le("SHOW_REPORT_USER_INVOKER_LOG"),v=h||p&&i.id;v&&(this.apiInvokeLoggedCount+=1);const y=this.apiInvokeLoggedCount;function S(N,Y){if(v){let W="[apiInvoke-".concat(y,"]");i.id&&(W+="[".concat(i.id,"]")),i.name&&(W+="[".concat(i.name,"]")),x.info("".concat(W," ").concat(N),N==="start"?i.options:Y||"")}}const b=()=>({tag:i.tag,invokeId:l,sid:n,name:i.name,apiInvokeTime:c,options:i.options,states:i.states||null});S("start");let R=!1;$s(i.timeout).then(()=>{R||(this.sendApiInvoke(fn(fn({},b()),{},{error:ie.API_INVOKE_TIMEOUT,success:!1})),S("timeout"))});const O=new Fe(ie.UNEXPECTED_ERROR,"".concat(i.name,": this api invoke is end"));return{onSuccess:N=>{const Y=()=>{if(R)throw O;return R=!0,this.sendApiInvoke(fn(fn({},b()),{},{success:!0},i.reportResult&&{result:N})),S("onSuccess"),N};return s?A9(Y,i.name+"Success",s,()=>R=!0):Y()},onError:N=>{const Y=()=>{if(R)throw N;R=!0,this.sendApiInvoke(fn(fn({},b()),{},{success:!1,error:N})),S("onFailure",N.toString())};return s?A9(Y,i.name+"Error",s,()=>R=!0):Y()}}}sessionInit(n,i){if(this.baseInfoMap.has(n))return;const s=Date.now(),c=this.createBaseInfo(n,s);c.cname=i.cname;const l=Object.assign({},{willUploadConsoleLog:le("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:EM?"global":"oversea",areas:le("AREAS")&&le("AREAS").join(",")},i.extend),{stringUid:h,channelProfile:p,channelMode:v,isABTestSuccess:y,lsid:S,clientRole:b}=i,R=Date.now(),O=fn(fn({},c),{},{eventType:Cs.SESSION_INIT,appid:i.appid,browser:navigator.userAgent,buildFormat:i.buildFormat,build:TM,lts:R,elapse:R-s,extend:JSON.stringify(l),mode:i.mode,process:le("PROCESS_ID"),appType:le("APP_TYPE"),success:!0,version:Cl,stringUid:h,channelProfile:p,channelMode:v,isABTestSuccess:y,lsid:S,clientType:dt(N=window.navigator.userAgent).call(N,"AgoraWebView")?42:20,clientRole:b,serviceId:le("PROCESS_ID"),extensionID:le("PLUGIN_INFO").join(",")||""});var N;this.send({type:ni.SESSION,data:O},!0)}joinChooseServer(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn({},c),{},{role:i.role,eventType:Cs.JOIN_CHOOSE_SERVER,lts:l,eventElapse:i.elapse||l-i.lts,chooseServerAddr:i.csAddr,errorCode:i.ec,elapse:l-s.startTime,success:i.succ,chooseServerAddrList:JSON.stringify(i.serverList),uid:i.uid?parseInt(i.uid):null,cid:i.cid?parseInt(i.cid):null,chooseServerIp:i.csIp||"",opid:i.opid,unilbsServerIds:i.unilbsServerIds,extend:i.extend||void 0,isHttp3:i.isHttp3,corssRegionTagReq:i.corssRegionTagReq||void 0,corssRegionTagRes:i.corssRegionTagRes||void 0});this.send({type:ni.JOIN_CHOOSE_SERVER,data:h},!0)}reqUserAccount(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn({},c),{},{eventType:Cs.REQ_USER_ACCOUNT,lts:l,success:i.success,serverAddress:i.serverAddr,stringUid:i.stringUid,uid:i.uid,errorCode:i.errorCode,elapse:i.elapse||l-s.startTime,eventElapse:l-i.lts,extend:JSON.stringify(i.extend)});this.send({type:ni.REQ_USER_ACCOUNT,data:h},!0)}joinGateway(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info;i.vid&&(c.vid=i.vid),c.uid=i.uid,c.cid=i.cid;const l=Date.now(),{firstSuccess:h,avoidJoinStartTime:p,addr:v,isProxy:y}=i,S=l-(h&&p?p:s.startTime),b=fn(fn({},c),{},{eventType:Cs.JOIN_GATEWAY,lts:l,gatewayAddr:i.addr,success:i.succ,errorCode:i.ec,errorMsg:i.errorMsg||"",elapse:S,eventElapse:l-i.lts,firstSuccess:h,signalChannel:i.signalChannel,preload:i.preload?1:0,installId:yM(),isABTestSuccess:i.isABTestSuccess?1:0}),R=b.success?1:0;if(i.succ&&(s.lastJoinSuccessTime=l),h)this.send({type:ni.JOIN_GATEWAY,data:b},!0);else{let O;if(v)if(y){const Y=v.match(/h=(\d{1,3}-){3}\d{1,3}/g),W=v.match(/p=[0-9]{1,6}/g);O={isSuccess:R,gatewayIp:Y&&Y.length?Y[0].split("=")[1].replace(/-/g,"."):"",port:W&&W.length?W[0].split("=")[1]:"",isProxy:y?1:0}}else{const Y=v.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),W=v.match(/(:|p=)[0-9]{1,6}/g);O={isSuccess:R,gatewayIp:Y&&Y.length?Y[0].split("//")[1].replace(/-/g,"."):"",port:W&&W.length?W[0].split(/:|p=/g)[1]:"",isProxy:y?1:0}}else O={isSuccess:R,gatewayIp:"",port:"",isProxy:y?1:0};delete b.success,delete b.eventType,delete b.firstSuccess,b.vid=Number(b.vid);const N=Object.assign({},b,O,{eventType:Cs.REJOIN_GATEWAY});this.send({type:ni.RE_JOIN_GATEWAY,data:N},!0)}}joinChannelTimeout(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=Date.now(),l=fn(fn({},s.info),{},{lts:c,timeout:i,elapse:c-s.startTime});this.send({type:ni.JOIN_CHANNEL_TIMEOUT,data:l},!0)}publish(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn({},c),{},{eventType:Cs.PUBLISH,lts:l,eventElapse:i.eventElapse,elapse:l-s.startTime,success:i.succ,errorCode:i.ec,videoName:i.videoName,audioName:i.audioName,screenName:i.screenName,screenshare:i.screenshare,audio:i.audio,video:i.video,p2pid:i.p2pid,publishRequestid:i.publishRequestid});this.send({type:ni.PUBLISH,data:h},!0)}subscribe(n,i,s){const c=this.baseInfoMap.get(n);if(!c)return;const l=c.info,h=Date.now(),p=fn(fn({},l),{},{eventType:Cs.SUBSCRIBE,lts:h,eventElapse:i.eventElapse,elapse:h-c.startTime,success:i.succ,errorCode:i.ec,video:i.video,audio:i.audio,subscribeRequestid:i.subscribeRequestid,p2pid:i.p2pid,preSsrc:i.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof i.peerid=="string"?p.peerSuid=i.peerid:p.peer=i.peerid,this.send({type:ni.SUBSCRIBE,data:p},!0)}wsCompressorInit(n){var i;const s=[...zu(i=this.baseInfoMap).call(i)],c=s.length?s[0]:"UnableToGetSid",l=this.baseInfoMap.get(c);if(!l)return;const h=l.info,p=Date.now(),v=fn(fn({},h),{},{eventType:Cs.WS_COMPRESSOR_INIT,lts:p,eventElapse:n.eventElapse,elapse:p-l.startTime,status:n.status?1:2});this.send({type:ni.WS_COMPRESSOR_INIT,data:v},!0)}firstRemoteVideoDecode(n,i,s,c){const l=this.baseInfoMap.get(n);if(!l)return;const h=l.info,p=Date.now(),v=fn(fn(fn({},h),c),{},{elapse:p-l.startTime,eventType:i,lts:p,firstDecodeFrame:Math.max((c.firstFrame||p)-l.startTime,0),apEnd:Math.max(c.apEnd-l.startTime,0),apStart:Math.max(c.apStart-l.startTime,0),joinGwEnd:Math.max(c.joinGwEnd-l.startTime,0),joinGwStart:Math.max(c.joinGwStart-l.startTime,0),pcEnd:Math.max(c.pcEnd-l.startTime,0),pcStart:Math.max(c.pcStart-l.startTime,0),subscriberEnd:Math.max(c.subscriberEnd-l.startTime,0),subscriberStart:Math.max(c.subscriberStart-l.startTime,0),videoAddNotify:Math.max(c.videoAddNotify-l.startTime,0)});this.send({type:s,data:v},!0)}firstRemoteFrame(n,i,s,c){const l=this.baseInfoMap.get(n);if(!l)return;const h=l.info,p=Date.now(),v=fn(fn(fn({},h),c),{},{elapse:p-l.startTime,eventType:i,lts:p});this.send({type:s,data:v},!0)}abTest(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn(fn({},c),i),{},{vid:c.vid===void 0?0:Number(c.vid),elapse:l-s.startTime,eventType:Cs.AB_TEST,lts:l});this.send({type:ni.AB_TEST,data:h},!0)}pcStats(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn(fn({},c),i),{},{vid:c.vid===void 0?0:Number(c.vid),elapse:l-s.startTime,eventType:Cs.PC_STATS,lts:l,preallocation:i.preallocation?1:0});this.send({type:ni.PC_STATS,data:h},!0)}updateRemoteRTPCapabilities(n,i){if(n){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn(fn({},c),i),{},{vid:c.vid===void 0?0:Number(c.vid),eventType:Cs.UPDATE_REMOTE_RTPCAPABILITIES,lts:l});this.send({type:ni.UPDATE_REMOTE_RTPCAPABILITIES,data:h},!0)}}onGatewayStream(n,i,s,c){const l=this.baseInfoMap.get(n);if(!l)return;const h=l.info,p=Date.now(),v=fn(fn(fn({},h),c),{},{eventType:i,lts:p});this.send({type:s,data:v},!0)}streamSwitch(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn({},c),{},{eventType:Cs.STREAM_SWITCH,lts:l,isDual:i.isdual,elapse:l-s.startTime,success:i.succ});this.send({type:ni.STREAM_SWITCH,data:h},!0)}requestProxyAppCenter(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn({},c),{},{eventType:Cs.REQUEST_PROXY_APPCENTER,lts:l,eventElapse:l-i.lts,elapse:l-s.startTime,APAddr:i.APAddr,workerManagerList:i.workerManagerList,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:ni.REQUEST_PROXY_APPCENTER,data:h},!0)}requestProxyWorkerManager(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn({},c),{},{eventType:Cs.REQUEST_PROXY_WORKER_MANAGER,lts:l,eventElapse:l-i.lts,elapse:l-s.startTime,workerManagerAddr:i.workerManagerAddr,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:ni.REQUEST_PROXY_WORKER_MANAGER,data:h},!0)}setProxyServer(n){this.proxyServer=n,n?x.debug("reportProxyServerurl: ".concat(n)):x.debug("disable reportProxyServerurl: ".concat(n))}peerPublishStatus(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn({},c),{},{subscribeElapse:i.subscribeElapse,peer:i.peer,peerPublishDuration:Math.max(i.audioPublishDuration,i.videoPublishDuration),audiotag:i.audioPublishDuration>0?1:-1,videotag:i.videoPublishDuration>0?1:-1,lts:l,elapse:l-s.startTime,joinChannelSuccessElapse:l-(s.lastJoinSuccessTime||l),peerPublishDurationVideo:i.videoPublishDuration,peerPublishDurationAudio:i.audioPublishDuration});this.send({type:ni.PEER_PUBLISH_STATUS,data:h},!0)}workerEvent(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now();(function(h,p,v){const y=h[p];if(!y||typeof y!="string")return[h];h[p]="";const S=Fh(JSON.stringify(h));let b=0;const R=[];let O=0;for(let N=0;N<y.length;N++)O+=y.charCodeAt(N)<=127?1:3,O<=v-S||(R[R.length]=Tt(Tt({},h),{},{[p]:y.substring(b,N)}),b=N,O=y.charCodeAt(N)<=127?1:3);return b!==y.length-1&&(R[R.length]=Tt(Tt({},h),{},{[p]:y.substring(b)})),R})(fn(fn(fn({},c),i),{},{elapse:l-s.startTime,lts:l,productType:"WebRTC"}),"payload",1300).forEach(h=>this.send({type:ni.WORKER_EVENT,data:h},!0))}apworkerEvent(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn(fn({},c),i),{},{elapse:l-s.startTime,lts:l});this.send({type:ni.AP_WORKER_EVENT,data:h},!0)}joinWebProxyAP(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn(fn({},c),i),{},{elapse:l-s.startTime,lts:l,extend:i.extend||void 0});this.send({type:ni.JOIN_WEB_PROXY_AP,data:h},!0)}WebSocketQuit(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,l=Date.now(),h=fn(fn(fn({},c),i),{},{elapse:l-s.startTime,lts:l});this.send({type:ni.WEBSOCKET_QUIT,data:h},!0)}async sendCustomReportMessage(n,i){if(this.customReportCount+=i.length,this.customReportCount>le("CUSTOM_REPORT_LIMIT"))throw new Fe(ie.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),c=i.map(l=>({type:ni.USER_ANALYTICS,data:fn(fn({sid:n},l),{},{lts:s})}));try{le("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(c):await this.postDataToStatsCollector(c)}catch(l){throw x.error("send custom report message failed",l.toString()),new Fe(ie.CUSTOM_REPORT_SEND_FAILED,l.message)}}sendApiInvoke(n){const i=le("NOT_REPORT_EVENT");if(n.tag&&dt(i)&&dt(i).call(i,n.tag))return!1;if(n.sid===null)return this.apiInvokeUploadPendingItems.push(n),!1;const s=this.baseInfoMap.get(n.sid);if(!s)return this.apiInvokeUploadPendingItems.push(n),!1;const{cname:c,uid:l,cid:h}=s.info;let p;if(n.lts=n.lts||Date.now(),n.error)if(n.error instanceof Fe){const{code:y,message:S}=n.error;p=y||S||n.error.toString()}else p=n.error.toString();const v={invokeId:n.invokeId,sid:n.sid,cname:c,cid:h,uid:l,lts:n.lts,success:n.success,elapse:n.lts-s.startTime,execElapse:n.lts-n.apiInvokeTime,apiName:n.name,options:n.options?JSON.stringify(n.options):void 0,execStates:n.states?JSON.stringify(n.states):void 0,execResult:n.result?JSON.stringify(n.result):void 0,errorCode:n.error?p:void 0,errorMsg:n.error?JSON.stringify(n.error):void 0};return this.send({type:ni.API_INVOKE,data:v},!1),!0}addSid(n){this.sids.add(n)}removeSid(n){this.sids.delete(n)}appendSessionId(){const n=this.apiInvokeUploadPendingItems;if(n.length===0)return;const i=Array.from(this.sids).find(s=>s!==null);i&&n.forEach(s=>{s&&(s.sid=i,this.sendApiInvoke(Object.assign({},s)))}),n.length=0}send(n,i){if(i)return this.keyEventUploadPendingItems.push(n),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(n),this.normalEventUploadPendingItems.length>le("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(n,i){const s=[],c=[];for(;n.length;){const h=n.shift();s.length<20?s.push(h):c.push(h)}n.push(...c);for(const h of[...s]){var l;this.ltsList.indexOf(h.data.lts)!==-1?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),Sb(l=this.ltsList).call(l,(p,v)=>p-v))}return i||(this.lastSendNormalEventTime=Date.now()),le("ENABLE_EVENT_REPORT")&&s.length&&(le("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((h=>p=>{le("EVENT_REPORT_RETRY")&&(i?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(h):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(h),this.normalEventUploadPendingItems.length>le("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-le("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),n}async postDataToStatsCollector2(n){$i.networkState===lu.OFFLINE&&await pt.race([$i.onlineWaiter,$s(2*ss.maxRetryTimeout)]);const i=l=>{let h=new Uint8Array;return l.forEach(p=>{const v=aM(JSON.stringify(p.data)),y=new ArrayBuffer(5),S=(R=>{let O=0;return Object.entries(ni).forEach(N=>{let[Y,W]=N;W===R.type&&(O=sEe[Y])}),O})(p),b=new DataView(y);b.setUint16(0,v.byteLength,!0),b.setUint8(2,255&S),b.setUint8(3,S>>>8&255),b.setUint8(4,S>>>16&255),h=y9(h,new Uint8Array(y)),h=y9(h,v)}),h},s="event";let c=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(le("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(le("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let l=0;l<2;l+=1){l===1&&(c=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(le("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(le("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await pM(c,{timeout:1e4,data:i(n),headers:fn(fn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(h){if(l===1)throw h;continue}return}}async postDataToStatsCollector(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(v=>{const y=v&&v.data.sid&&this.baseInfoMap.get(v.data.sid);return y&&y.info.vid&&+y.info.vid||0})(n[0]),c=s?void 0:this._aid,l={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:n.map(v=>JSON.stringify(v)),vid:s,aid:c};$i.networkState===lu.OFFLINE&&await pt.race([$i.onlineWaiter,$s(2*ss.maxRetryTimeout)]);const h=i?"/events/proto-raws":"/events/messages";let p=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(le("EVENT_REPORT_DOMAIN"),"&p=").concat(le("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(le("EVENT_REPORT_DOMAIN"),":").concat(le("STATS_COLLECTOR_PORT")).concat(h));for(let v=0;v<2;v+=1){v===1&&(p=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(le("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(le("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(le("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(le("STATS_COLLECTOR_PORT")).concat(h)));try{i?await Gye(p,{timeout:1e4,data:l}):await pM(p,{timeout:1e4,data:l})}catch(y){if(v===1)throw y;continue}return}}createBaseInfo(n,i){const s=Object.assign({},iEe);return s.sid=n,this.baseInfoMap.set(n,{info:s,startTime:i}),s}reportResourceTiming(n,i){const s=performance.getEntriesByName(n),c=s[s.length-1];c&&this.reportApiInvoke(i,{name:"Client.resourceTiming",options:c,tag:_i.TRACER}).onSuccess()}};q9.on("REPORT_LOG_UPLOAD",n=>{n.networkState=$i.networkState,kt.reportApiInvoke(null,{name:"logUploadError",options:n,tag:_i.TRACER}).onSuccess("logUploadError")});class Pe extends Fe{constructor(i){super(i,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Ei(this,"name","AgoraRTCException")}print(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(i,x)}throw(){super.throw(x)}}const Ys={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Xn(){return Ys}function X9(){return"setSinkId"in HTMLAudioElement.prototype&&(!le("RESTRICTION_SET_PLAYBACK_DEVICE")||(cp()||a9())&&!iM())}function J9(){return!Ys.supportUnifiedPlan||le("CHROME_FORCE_PLAN_B")&&up()}let Xs=function(n){return n.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",n.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",n.IOS_INTERRUPTION_START="ios-interruption-start",n.IOS_INTERRUPTION_END="ios-interruption-end",n.STATE_CHANGE="state-change",n}({});function JE(n,i,s){return{sampleRate:n,stereo:i,bitrate:s}}function Gn(n,i,s,c,l){return{width:n,height:i,frameRate:s,bitrateMin:c,bitrateMax:l}}function ad(n,i,s,c,l){return{width:{max:n},height:{max:i},frameRate:s,bitrateMin:c,bitrateMax:l}}function RM(n,i){return{numSpatialLayers:n,numTemporalLayers:i}}const oEe={"90p":Gn(160,90),"90p_1":Gn(160,90),"120p":Gn(160,120,15,30,65),"120p_1":Gn(160,120,15,30,65),"120p_3":Gn(120,120,15,30,50),"120p_4":Gn(212,120),"180p":Gn(320,180,15,30,140),"180p_1":Gn(320,180,15,30,140),"180p_3":Gn(180,180,15,30,100),"180p_4":Gn(240,180,15,30,120),"240p":Gn(320,240,15,40,200),"240p_1":Gn(320,240,15,40,200),"240p_3":Gn(240,240,15,40,140),"240p_4":Gn(424,240,15,40,220),"360p":Gn(640,360,15,80,400),"360p_1":Gn(640,360,15,80,400),"360p_3":Gn(360,360,15,80,260),"360p_4":Gn(640,360,30,80,600),"360p_6":Gn(360,360,30,80,400),"360p_7":Gn(480,360,15,80,320),"360p_8":Gn(480,360,30,80,490),"360p_9":Gn(640,360,15,80,800),"360p_10":Gn(640,360,24,80,800),"360p_11":Gn(640,360,24,80,1e3),"480p":Gn(640,480,15,100,500),"480p_1":Gn(640,480,15,100,500),"480p_2":Gn(640,480,30,100,1e3),"480p_3":Gn(480,480,15,100,400),"480p_4":Gn(640,480,30,100,750),"480p_6":Gn(480,480,30,100,600),"480p_8":Gn(848,480,15,100,610),"480p_9":Gn(848,480,30,100,930),"480p_10":Gn(640,480,10,100,400),"720p":Gn(1280,720,15,120,1130),"720p_auto":Gn(1280,720,30,900,3e3),"720p_1":Gn(1280,720,15,120,1130),"720p_2":Gn(1280,720,30,120,2e3),"720p_3":Gn(1280,720,30,120,1710),"720p_5":Gn(960,720,15,120,910),"720p_6":Gn(960,720,30,120,1380),"1080p":Gn(1920,1080,15,120,2080),"1080p_1":Gn(1920,1080,15,120,2080),"1080p_2":Gn(1920,1080,30,120,3e3),"1080p_3":Gn(1920,1080,30,120,3150),"1080p_5":Gn(1920,1080,60,120,4780),"1440p":Gn(2560,1440,30,120,4850),"1440p_1":Gn(2560,1440,30,120,4850),"1440p_2":Gn(2560,1440,60,120,7350),"4k":Gn(3840,2160,30,120,8910),"4k_1":Gn(3840,2160,30,120,8910),"4k_3":Gn(3840,2160,60,120,13500)},aEe={"480p":ad(640,480,5),"480p_1":ad(640,480,5),"480p_2":ad(640,480,30),"480p_3":ad(640,480,15),"720p":ad(1280,720,5),"720p_auto":Gn(1280,720,30,900,3e3),"720p_1":ad(1280,720,5),"720p_2":ad(1280,720,30),"720p_3":ad(1280,720,15),"1080p":ad(1920,1080,5),"1080p_1":ad(1920,1080,5),"1080p_2":ad(1920,1080,30),"1080p_3":ad(1920,1080,15)},cEe={"1SL1TL":RM(1,1),"3SL3TL":RM(3,3),"2SL3TL":RM(2,3)};function Bh(n){return n||(n="480p_1"),typeof n=="string"?Object.assign({},oEe[n]):n}function IM(n){return typeof n=="string"?Object.assign({},aEe[n]):n}function Hk(n){return typeof n=="string"?Object.assign({},cEe[n]):n}const uEe={speech_low_quality:JE(16e3,!1),speech_standard:JE(32e3,!1,18),music_standard:JE(48e3,!1),standard_stereo:JE(48e3,!0,56),high_quality:JE(48e3,!1,128),high_quality_stereo:JE(48e3,!0,192)};function Kk(n){return typeof n=="string"?Object.assign({},uEe[n]):n}const QE=[];function Q9(n){return vs(n,"mediaSource",["screen","window","application"]),!0}let wt=function(n){return n.NEED_RENEGOTIATE="@need_renegotiate",n.NEED_REPLACE_TRACK="@need_replace_track",n.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",n.NEED_CLOSE="@need_close",n.NEED_ENABLE_TRACK="@need_enable_track",n.NEED_DISABLE_TRACK="@need_disable_track",n.NEED_SESSION_ID="@need_sid",n.SET_OPTIMIZATION_MODE="@set_optimization_mode",n.GET_STATS="@get_stats",n.GET_RTC_STATS="@get_rtc_stats",n.GET_LOW_VIDEO_TRACK="@get_low_video_track",n.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",n.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",n.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",n.NEED_MUTE_TRACK="@need_mute_track",n.NEED_UNMUTE_TRACK="@need_unmute_track",n}({}),Dr=function(n){return n.SCREEN_TRACK="screen_track",n.CUSTOM_TRACK="custome_track",n.LOW_STREAM="low_stream",n.SCREEN_LOW_TRACK="screen_low_track",n}({}),ZE=function(n){return n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM",n}({}),lEe=function(n){return n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",n[n.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",n[n.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",n[n.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",n[n.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",n[n.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",n}({}),dEe=function(n){return n[n.DISABLE=0]="DISABLE",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.AUDIO_ONLY=2]="AUDIO_ONLY",n[n.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",n[n.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",n[n.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",n[n.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",n[n.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",n[n.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",n}({}),i_=function(n){return n.TRANSCEIVER_UPDATED="transceiver-updated",n.SEI_TO_SEND="sei-to-send",n.SEI_RECEIVED="sei-received",n.TRACK_UPDATED="track-updated",n}({}),eS=function(n){return n.SOURCE_STATE_CHANGE="source-state-change",n.TRACK_ENDED="track-ended",n.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.CLOSED="closed",n}({}),tS=function(n){return n.FIRST_FRAME_DECODED="first-frame-decoded",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.VIDEO_STATE_CHANGED="video-state-changed",n}({}),nS=function(n){return n.AUDIO="audio",n.VIDEO="video",n.DATA="data",n}({}),Gu=function(n){return n.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",n.RECEIVE_TRACK_BUFFER="receive_track_buffer",n.ON_AUDIO_BUFFER="on_audio_buffer",n.UPDATE_SOURCE="update_source",n}({});(function(n){n.UPDATE_TRACK_SOURCE="update-track-source"})({});const AM={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},kM={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Z9={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},hEe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},eK={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Da=function(n){return n.ON_TRACK="on_track",n.ON_NODE="on_node",n}({}),Hu=function(n){return n.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",n.REQUEST_CONSTRAINTS="request_constraints",n}({}),zb=function(n){return n.IDLE="IDLE",n.INITING="INITING",n.INITEND="INITEND",n}({}),s_=function(n){return n.STATE_CHANGE="state_change",n.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",n.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",n.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",n}({}),fa=function(n){return n.NONE="none",n.INIT="init",n.CANPLAY="canplay",n.PLAYING="playing",n.PAUSED="paused",n.SUSPEND="suspend",n.STALLED="stalled",n.WAITING="waiting",n.ERROR="error",n.DESTROYED="destroyed",n.ABORT="abort",n.ENDED="ended",n.EMPTIED="emptied",n.LOADEDDATA="loadeddata",n}({}),Wh=function(n){return n[n.VideoStateStopped=0]="VideoStateStopped",n[n.VideoStateStarting=1]="VideoStateStarting",n[n.VideoStateDecoding=2]="VideoStateDecoding",n[n.VideoStateFrozen=3]="VideoStateFrozen",n}({});const OM={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let qk=function(n){return n.OPEN="open",n.MESSAGE="message",n.CLOSE="close",n.CLOSING="closing",n.ERROR="error",n}({});function tK(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function ri(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?tK(Object(s),!0).forEach(function(c){Oe(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):tK(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function Oe(n,i,s){return(i=function(c){var l=function(h,p){if(typeof h!="object"||h===null)return h;var v=h[Symbol.toPrimitive];if(v!==void 0){var y=v.call(h,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(h)}(c);return typeof l=="symbol"?l:String(l)}(i))in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s,n}function Hn(n,i,s,c,l){var h,p,v={};return Object.keys(c).forEach(function(y){v[y]=c[y]}),v.enumerable=!!v.enumerable,v.configurable=!!v.configurable,("value"in v||v.initializer)&&(v.writable=!0),v=nu(h=pm(p=s.slice()).call(p)).call(h,function(y,S){return S(n,i,y)||y},v),l&&v.initializer!==void 0&&(v.value=v.initializer?v.initializer.call(l):void 0,v.initializer=void 0),v.initializer===void 0&&(Object.defineProperty(n,i,v),v=null),v}class nK extends li{set _mediaStreamTrack(i){i!==this.mediaStreamTrack&&(this.safeEmit(i_.TRACK_UPDATED,i),this.mediaStreamTrack=i)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(i,s){super(),Oe(this,"trackMediaType",void 0),Oe(this,"_ID",void 0),Oe(this,"_rtpTransceiver",void 0),Oe(this,"_lowRtpTransceiver",void 0),Oe(this,"_hints",[]),Oe(this,"_isClosed",!1),Oe(this,"_originMediaStreamTrack",void 0),Oe(this,"mediaStreamTrack",void 0),Oe(this,"_external",{}),this._ID=s||Nr(8,"track-"),this._originMediaStreamTrack=i,this.mediaStreamTrack=i,function(c){dt(QE).call(QE,c)||QE.push(c)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(i){return i||Bm(()=>{var s;kt.reportApiInvoke(null,{name:is.GET_MEDIA_STREAM_TRACK,options:[],tag:_i.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(i){return i===ZE.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(i){const s=QE.indexOf(i);s!==-1&&QE.splice(s,1)}(this),this.emit(eS.CLOSED),this.removeAllListeners(i_.SEI_RECEIVED)}_updateRtpTransceiver(i,s){if(s===ZE.LOW_STREAM){if(this._lowRtpTransceiver===i)return;this._lowRtpTransceiver=i}else{if(this._rtpTransceiver===i)return;this._rtpTransceiver=i}this.emit(i_.TRANSCEIVER_UPDATED,i,s)}}class rS extends nK{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(i,s){super(i,s),Oe(this,"_enabled",!0),Oe(this,"_muted",!1),Oe(this,"_isExternalTrack",!1),Oe(this,"_isClosed",!1),Oe(this,"_enabledMutex",void 0),Oe(this,"processor",void 0),Oe(this,"_processorContext",void 0),Oe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Co("".concat(this.getTrackId())),i.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var i,s;return(i=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&i!==void 0?i:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(wt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(i,s){let c=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=c,i!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),i.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=i,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Pr(this,wt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(eS.TRACK_ENDED)}stateCheck(i,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(i,": ").concat(s,"]")),lp(s,i),this._enabled&&this._muted&&i==="enabled"&&s===!1)throw new Fe(ie.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&i==="muted"&&s===!0)throw new Fe(ie.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():pt.resolve([])}}const rK=window.AudioContext||window.webkitAudioContext;let Ku=null;const yr=new class extends li{constructor(){super(...arguments),Oe(this,"prevState",void 0),Oe(this,"curState",void 0),Oe(this,"currentTime",void 0),Oe(this,"currentTimeStuckAt",void 0),Oe(this,"interruptDetectorTrack",void 0),Oe(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(Xs.IOS_15_16_INTERRUPTION_START)}),Oe(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(Ku&&await Ku.suspend(),this.emit(Xs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(n){x.debug("webaudio bindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=n,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(n){x.debug("webaudio unbindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===n&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function iS(){if(!Ku){if(function(){if(!rK)return void x.error("your browser is not support web audio");x.info("create audio context");const n=ri({},le("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(n)),Ku=new rK(n),yr.curState=Ku.state,Ku.onstatechange=()=>{yr.prevState=yr.curState,yr.curState=Ku?Ku.state:void 0;const{prevState:i,curState:s}=yr,c=s==="running",l=s==="interrupted",h=i==="running",p=i==="suspended",v=i==="interrupted",y=zn().osVersion;(Na()||sd())&&h&&l&&(x.info("ios".concat(y,"-interruption-start")),yr.emit(Xs.IOS_INTERRUPTION_START)),(Na()||sd())&&(p||v)&&c&&(x.info("ios".concat(y,"-interruption-end")),yr.emit(Xs.IOS_INTERRUPTION_END)),i!==s&&yr.emit(Xs.STATE_CHANGE,s,i)},setInterval(()=>{var i;const s=(i=Ku)===null||i===void 0?void 0:i.currentTime;yr.currentTime!==s?(yr.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),yr.currentTimeStuckAt=void 0),yr.currentTime=s):(s!==yr.currentTimeStuckAt&&(kt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:_i.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),yr.currentTimeStuckAt=s)},5e3),async function(i){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let c,l=!1,h=!1,p=!1;function v(W){i.state==="running"?y(!1):Na()||sd()?i.state==="suspended"&&(y(!0),W&&i.resume().then(S,S)):i.state!=="closed"&&(y(!0),W&&i.resume().then(S,S))}function y(W){if(l!==W){l=W;for(let H=0,ne=s;H<ne.length;H+=1){const re=ne[H];W?window.addEventListener(re,b,{capture:!0,passive:!0}):window.removeEventListener(re,b,{capture:!0,passive:!0})}}}function S(){v(!1)}function b(){v(!0)}function R(W){if(!p)if(c.paused)if(W){let H;O(!1),p=!0;try{H=c.play(),H?H.then(N,N):(c.addEventListener("playing",N),c.addEventListener("abort",N),c.addEventListener("error",N))}catch{N()}}else O(!0);else O(!1)}function O(W){if(h!==W){h=W;for(let H=0,ne=s;H<ne.length;H++){const re=ne[H];W?window.addEventListener(re,Y,{capture:!0,passive:!0}):window.removeEventListener(re,Y,{capture:!0,passive:!0})}}}function N(){c.removeEventListener("playing",N),c.removeEventListener("abort",N),c.removeEventListener("error",N),p=!1,R(!1)}function Y(){R(!0)}if(Na()){const W=i.createMediaStreamDestination(),H=document.createElement("div");H.innerHTML="<audio x-webkit-airplay='deny'></audio>",c=H.children.item(0),c.controls=!1,c.disableRemotePlayback=!0,c.preload="auto",c.srcObject=W.stream,R(!0)}yr.on(Xs.STATE_CHANGE,function(){v(!0)}),v(!1)}(Ku)}(),!Ku)throw new Fe(ie.NOT_SUPPORTED,"can not create audio context");return Ku}return Ku}function o_(n){if(function(){if(PM!==null)return PM;const c=iS(),l=c.createBufferSource(),h=c.createGain(),p=c.createGain();l.connect(h),l.connect(p),l.disconnect(h);let v=!1;try{l.disconnect(h)}catch{v=!0}return l.disconnect(),PM=v,v}())return;const i=n.connect,s=n.disconnect;n.connect=(c,l,h)=>{var p;return n._inputNodes||(n._inputNodes=[]),dt(p=n._inputNodes).call(p,c)||(c instanceof AudioNode?(n._inputNodes.push(c),i.call(n,c,l,h)):i.call(n,c,l)),n},n.disconnect=(c,l,h)=>{s.call(n),c?Mk(n._inputNodes,c):n._inputNodes=[];for(const p of n._inputNodes)i.call(n,p)}}let PM=null;function NM(n,i){let s=!1;const c=1/i;if(le("DISABLE_WEBAUDIO")){const l=window.setInterval(()=>{s?window.clearInterval(l):n(performance.now()/1e3)},1e3*c)}else{const l=iS();let h=l.createGain();h.gain.value=0,h.connect(l.destination);const p=()=>{if(s)return void(h=null);const v=l.createOscillator();v.onended=p,v.connect(h),v.start(0),v.stop(l.currentTime+c),n(l.currentTime)};p()}return()=>{s=!0}}class iK{constructor(){Oe(this,"context",void 0),Oe(this,"analyserNode",void 0),Oe(this,"sourceNode",void 0),this.context=iS(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(i){if(i!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=i,i==null||i.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Na()||sd()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const i=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(i);else{const c=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(c);for(let l=0;l<i.length;++l)i[l]=c[l]/128-1}const s=nu(i).call(i,(c,l)=>c+l*l,0)/i.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var i,s;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class sK extends li{get processSourceNode(){return this.sourceNode}set processedNode(i){var s;if(!this.isDestroyed&&this._processedNode!==i){try{var c;(c=this.sourceNode)===null||c===void 0||c.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=i,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Oe(this,"outputNode",void 0),Oe(this,"outputTrack",void 0),Oe(this,"isPlayed",!1),Oe(this,"sourceNode",void 0),Oe(this,"context",void 0),Oe(this,"audioBufferNode",void 0),Oe(this,"destNode",void 0),Oe(this,"audioOutputLevel",0),Oe(this,"volumeLevelAnalyser",void 0),Oe(this,"_processedNode",void 0),Oe(this,"playNode",void 0),Oe(this,"isDestroyed",!1),Oe(this,"onNoAudioInput",void 0),Oe(this,"isNoAudioInput",!1),Oe(this,"_noAudioInputCount",0),this.context=iS(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),o_(this.outputNode),this.volumeLevelAnalyser=new iK}startGetAudioBuffer(i){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(i),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Gu.ON_AUDIO_BUFFER,function(c){for(let l=0;l<c.outputBuffer.numberOfChannels;l+=1){const h=c.outputBuffer.getChannelData(l);for(let p=0;p<h.length;p+=1)h[p]=0}return c.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Xn().webAudioMediaStreamDest)throw new Fe(ie.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(i){this.context.state!=="running"&&Uk(()=>{yr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=i||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(i>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Na()||sd()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let c;s.getFloatTimeDomainData?(c=new Float32Array(s.fftSize),s.getFloatTimeDomainData(c)):(c=new Uint8Array(s.fftSize),s.getByteTimeDomainData(c));let l=!1;for(let h=0;h<c.length;h++)c[h]!==0&&(l=!0);return l?(this.isNoAudioInput=!1,!0):(await $s(200),await this.checkHasAudioInput(i?i+1:1)&&l)}getAudioVolume(){return this.outputNode.gain.value}setVolume(i){this.outputNode.gain.setValueAtTime(i,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var i,s;(i=this.processedNode)===null||i===void 0||i.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var i;this.processedNode?(i=this.processedNode)===null||i===void 0||i.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class oK extends sK{get isFreeze(){return!1}constructor(i,s,c){var l;if(super(),Oe(this,"sourceNode",void 0),Oe(this,"track",void 0),Oe(this,"clonedTrack",void 0),Oe(this,"audioElement",void 0),Oe(this,"isCurrentTrackCloned",!1),Oe(this,"isRemoteTrack",!1),Oe(this,"originVolumeLevelAnalyser",void 0),Oe(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const v=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?v.stop():this.isCurrentTrackCloned=!0;const y=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(y),o_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const S=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(S,this.context.currentTime),o_(this.outputNode),this.emit(Gu.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=y,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),i.kind!=="audio")throw new Fe(ie.UNEXPECTED_ERROR);this.track=i;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(h),o_(this.sourceNode),c){const v=c.clone();v.enabled=!0,this.clonedTrack=v,x.debug("create an unmuted track ".concat(v.id," from the original track ").concat(c.id," to get the volume"));const y=this.context.createMediaStreamSource(new MediaStream([v]));o_(y),this.originVolumeLevelAnalyser=new iK,this.originVolumeLevelAnalyser.updateSource(y)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const p=zn();s&&p.os===ws.IOS&&Number((l=p.osVersion)===null||l===void 0?void 0:l.split(".")[0])<15&&(yr.on(Xs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(v=>{v||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(i){this.sourceNode.disconnect(),this.track=i,this.isCurrentTrackCloned=!1;const s=new MediaStream([i]);this.sourceNode=this.context.createMediaStreamSource(s),o_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Gu.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var i;this.audioElement.srcObject=null,this.audioElement.remove(),yr.off("state-change",this.rebuildWebAudio),(i=this.originVolumeLevelAnalyser)===null||i===void 0||i.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(i){return this.context.createMediaStreamSource(new MediaStream([i]))}updateOriginTrack(i){const s=i.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(i.id," to get the volume"));const c=this.context.createMediaStreamSource(new MediaStream([s]));o_(c),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(c)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function aK(n,i,s){const c=(h,p)=>h?typeof h!="number"?h.max||h.exact||h.ideal||h.min||p:h:p,l={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxHeight:c(i.height,1080),maxWidth:c(i.width,1920)}}};return i.frameRate&&typeof i.frameRate!="number"?(l.video.mandatory.maxFrameRate=i.frameRate.max,l.video.mandatory.minFrameRate=i.frameRate.min):typeof i.frameRate=="number"&&(l.video.mandatory.maxFrameRate=i.frameRate),await navigator.mediaDevices.getUserMedia(l)}async function fEe(n,i){const s=await cK(n.mediaSource),{sourceId:c,audio:l}=await function(h){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new pt((v,y)=>{const S=document.createElement("div");S.innerText="share screen",S.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const O=document.createElement("div");O.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const N=document.createElement("div");N.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const Y=document.createElement("button");Y.innerHTML="cancel",Y.setAttribute("style","width: 85px;"),Y.onclick=()=>{document.body.removeChild(ne);const re=new Error("NotAllowedError");re.name="NotAllowedError",y(re)};let W=p;const H=document.createElement("div");if(p){const re=document.createElement("input");re.setAttribute("type","checkbox");const me=document.createElement("span");re.setAttribute("style","margin-right: 6px;"),me.innerText="Share audio",re.checked=W,re.onchange=()=>{W=re.checked},H.appendChild(re),H.appendChild(me)}N.appendChild(H),N.appendChild(Y),b.appendChild(R),b.appendChild(O),b.appendChild(N);const ne=document.createElement("div");ne.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),ne.appendChild(S),ne.appendChild(b),document.body.appendChild(ne),h.map(re=>{if(re.id){const me=document.createElement("div");me.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let be=re.thumbnail;try{const{width:we}=be.getSize();we>1920&&(be=be.resize({width:1920}))}catch(we){throw we&&we.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),we}me.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+be.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+re.name.replace(/[\u00A0-\u9999<>\&]/g,function(we){return"&#"+we.charCodeAt(0)+";"})+"</span>",me.onclick=()=>{document.body.removeChild(ne),v({sourceId:re.id,audio:W})},O.appendChild(me)}})})}(s,i);return await aK(c,n,l)}async function cK(n){let i=["window","screen"];n!=="application"&&n!=="window"||(i=["window"]),n==="screen"&&(i=["screen"]);const s=E9();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Fe(ie.ELECTRON_IS_NULL);let c=null;try{var l;c=((l=s.desktopCapturer)===null||l===void 0?void 0:l.getSources({types:i}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:i})}catch{c=null}c&&c.then||(c=new pt((h,p)=>{s.desktopCapturer.getSources({types:i},(v,y)=>{v?p(v):h(y)})}));try{return await c}catch(h){throw new Fe(ie.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,h.toString())}}const DM=new Co("safari");let uK=!1,lK=!1;async function qu(n,i){let s=0,c=null;for(;s<2;)try{c=await pEe(n,i,s>0);break}catch(l){if(l instanceof Fe)throw x.error("[".concat(i,"] ").concat(l.toString())),l;const h=$k(l.name||l.code||l,l.message);if(h.code===ie.MEDIA_OPTION_INVALID){x.debug("[".concat(i,"] detect media option invalid, retry")),s+=1,await $s(500);continue}throw x.error("[".concat(i,"] ").concat(h.toString())),h}if(!c)throw new Fe(ie.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return c}async function pEe(n,i,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Fe(ie.NOT_SUPPORTED,"can not find getUserMedia");s&&(n.video&&(delete n.video.width,delete n.video.height),n.screen&&(delete n.screen.width,delete n.screen.height));const c=Xn(),l=new MediaStream;if(n.audioSource&&l.addTrack(n.audioSource),n.videoSource&&l.addTrack(n.videoSource),!n.audio&&!n.video&&!n.screen)return x.debug("Using Video Source/ Audio Source"),l;if(n.screen)if(E9())n.screen.sourceId?sS(l,await aK(n.screen.sourceId,n.screen,!!n.screenAudio)):sS(l,await fEe(n.screen,!!n.screenAudio));else if(cp()&&n.screen.extensionId&&n.screen.mandatory){if(!c.getStreamFromExtension)throw new Fe(ie.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(i,'] Screen access on chrome stable, looking for extension"'));const O=await(p=n.screen.extensionId,v=i,new pt((N,Y)=>{try{chrome.runtime.sendMessage(p,{getStream:!0},W=>{if(!W||!W.streamId)return x.error("[".concat(v,"] No response from Chrome Plugin. Plugin not installed properly"),W),void Y(new Fe(ie.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));N(W.streamId)})}catch(W){x.error("[".concat(v,"] AgoraRTC screensharing plugin is not accessible(").concat(p,")"),W.toString()),Y(new Fe(ie.CHROME_PLUGIN_NOT_INSTALL))}}));n.screen.mandatory.chromeMediaSourceId=O,sS(l,await navigator.mediaDevices.getUserMedia({video:{mandatory:n.screen.mandatory}}))}else if(c.getDisplayMedia){var h;n.screen.mediaSource&&Q9(n.screen.mediaSource);const O={width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate,displaySurface:(h=n.screen.displaySurface)!==null&&h!==void 0?h:n.screen.mediaSource==="screen"?"monitor":n.screen.mediaSource},{selfBrowserSurface:N,surfaceSwitching:Y,systemAudio:W,preferCurrentTab:H}=n.screen,ne={selfBrowserSurface:N,surfaceSwitching:Y,systemAudio:W,preferCurrentTab:H};!N&&delete ne.selfBrowserSurface,!Y&&delete ne.surfaceSwitching,!W&&delete ne.systemAudio,!H&&delete ne.preferCurrentTab,x.debug("[".concat(i,"] getDisplayMedia:"),JSON.stringify({video:O,audio:n.screenAudio,controls:ne})),sS(l,await navigator.mediaDevices.getDisplayMedia(ri({video:O,audio:n.screenAudio},ne)))}else{if(!gi())throw x.error("[".concat(i,"] This browser does not support screenSharing")),new Fe(ie.NOT_SUPPORTED,"This browser does not support screen sharing");{n.screen.mediaSource&&Q9(n.screen.mediaSource);const O={video:{mediaSource:n.screen.mediaSource,width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate}};x.debug("[".concat(i,"] getUserMedia: ").concat(JSON.stringify(O))),sS(l,await navigator.mediaDevices.getUserMedia(O))}}var p,v;if(!n.video&&!n.audio)return l;let y={video:n.video,audio:n.audio},S=le("MEDIA_DEVICE_CONSTRAINTS");if(S)try{typeof S=="string"&&(S=JSON.parse(S)),y=lM(y,S)}catch{}x.debug("[".concat(i,"] GetUserMedia"),JSON.stringify(y)),zn();let b,R=null;(uo()||Na()||Lk())&&(R=await DM.lock());try{b=await navigator.mediaDevices.getUserMedia(y)}catch(O){throw R&&R(),O}return y.audio&&(uK=!0),y.video&&(lK=!0),sS(l,b),R&&R(),l}function $k(n,i){switch(n){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Fe(ie.MEDIA_OPTION_INVALID,"".concat(n,": ").concat(i));case"NotFoundError":case"DevicesNotFoundError":return new Fe(ie.DEVICE_NOT_FOUND,"".concat(n,": ").concat(i));case"NotSupportedError":return new Fe(ie.NOT_SUPPORTED,"".concat(n,": ").concat(i));case"NotReadableError":return new Fe(ie.NOT_READABLE,"".concat(n,": ").concat(i));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Fe(ie.PERMISSION_DENIED,"".concat(n,": ").concat(i));case"ConstraintNotSatisfiedError":return new Fe(ie.CONSTRAINT_NOT_SATISFIED,"".concat(n,": ").concat(i));default:return x.error("getUserMedia unexpected error",n),new Fe(ie.UNEXPECTED_ERROR,"".concat(n,": ").concat(i))}}function sS(n,i){const s=n.getVideoTracks()[0],c=n.getAudioTracks()[0],l=i.getVideoTracks()[0],h=i.getAudioTracks()[0];h&&(c&&n.removeTrack(c),n.addTrack(h)),l&&(s&&n.removeTrack(s),n.addTrack(l))}const $u=new class extends li{get state(){return this._state}set state(n){n!==this._state&&(this.emit(s_.STATE_CHANGE,n),this._state=n)}constructor(){super(),Oe(this,"_state",zb.IDLE),Oe(this,"isAccessMicrophonePermission",!1),Oe(this,"isAccessCameraPermission",!1),Oe(this,"lastAccessMicrophonePermission",!1),Oe(this,"lastAccessCameraPermission",!1),Oe(this,"checkdeviceMatched",!1),Oe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(le("ENUMERATE_DEVICES_INTERVAL")||(xk()||Dk()===ws.HARMONY_OS)&&up())&&this.updateDevicesInfo()},le("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(n=>x.error(n.toString()))}async enumerateDevices(n,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Fe(ie.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const c=await navigator.mediaDevices.enumerateDevices(),l=this.checkMediaDeviceInfoIsOk(c);let h=!this.isAccessMicrophonePermission&&n,p=!this.isAccessCameraPermission&&i;l.audio&&(h=!1),l.video&&(p=!1);let v=null,y=null,S=null;if(!s&&(h||p)){if(DM.isLocked&&(x.debug("[device manager] wait GUM lock"),(await DM.lock())(),x.debug("[device manager] GUM unlock")),uK&&(h=!1,this.isAccessMicrophonePermission=!0),lK&&(p=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",n,i,h,p),h&&p){try{S=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const R=$k(b.name||b.code||b,b.message);if(R.code===ie.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(h){try{v=await navigator.mediaDevices.getUserMedia({audio:n})}catch(b){const R=$k(b.name||b.code||b,b.message);if(R.code===ie.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(p){try{y=await navigator.mediaDevices.getUserMedia({video:i})}catch(b){const R=$k(b.name||b.code||b,b.message);if(R.code===ie.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",n,"cam permission",i)}try{const b=await navigator.mediaDevices.enumerateDevices();return v&&v.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),S&&S.getTracks().forEach(R=>R.stop()),v=null,y=null,S=null,b}catch(b){return v&&v.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),S&&S.getTracks().forEach(R=>R.stop()),v=null,y=null,S=null,new Fe(ie.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}}async getRecordingDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(i=>i.kind==="audioinput")}async getCamerasDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,n)).filter(i=>i.kind==="videoinput")}async getSpeakers(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(i=>i.kind==="audiooutput")}searchDeviceIdByName(n){let i=null;return this.deviceInfoMap.forEach(s=>{s.device.label===n&&(i=s.device.deviceId)}),i}async getDeviceById(n){const i=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===n);if(!i)throw new Fe(ie.DEVICE_NOT_FOUND,"deviceId: ".concat(n));return i}async init(){this.state=zb.INITING;try{await this.updateDevicesInfo(),this.state=zb.INITEND}catch(n){throw x.warning("Device Detection functionality cannot start properly.",n.toString()),this.state=zb.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Fe(ie.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}}async updateDevicesInfo(){const n=await this.enumerateDevices(!0,!0,!0),i=Date.now(),s=[];if(n[0]&&n[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const l=n.find(p=>p.kind==="audioinput"&&p.deviceId==="default"),h=n.find(p=>p.kind==="audiooutput"&&p.deviceId==="default");l&&h?h.groupId===l.groupId?x.debug("[device-check] default input ".concat(l.label," and output ").concat(h.label," is the same group")):x.debug("[device-check] default input ".concat(l.label," and output ").concat(h.label," is not the same group")):x.debug("[device-check] default input or output not found")}const c=this.checkMediaDeviceInfoIsOk(n);if(n.forEach(l=>{if(!l.deviceId)return;const h=this.deviceInfoMap.get("".concat(l.kind,"_").concat(l.deviceId));if((h?h.state:"INACTIVE")!=="ACTIVE"){const p={initAt:i,updateAt:i,device:l,state:"ACTIVE"};this.deviceInfoMap.set("".concat(l.kind,"_").concat(l.deviceId),p),s.push(p)}h&&(h.updateAt=i)}),this.deviceInfoMap.forEach((l,h)=>{l.state==="ACTIVE"&&l.updateAt!==i&&(l.state="INACTIVE",s.push(l))}),this.state!==zb.INITEND)return c.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(c.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(l=>{switch(l.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(s_.RECORDING_DEVICE_CHANGED,l);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(s_.CAMERA_DEVICE_CHANGED,l);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(s_.PLAYOUT_DEVICE_CHANGED,l)}}),c.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),c.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(n){const i=n.filter(l=>l.kind==="audioinput"),s=n.filter(l=>l.kind==="videoinput"),c={audio:!1,video:!1};for(const l of i)if(l.label&&l.deviceId){c.audio=!0;break}for(const l of s)if(l.label&&l.deviceId){c.video=!0;break}return c}};let LM=!1;const Yu=new class extends li{constructor(){super(...arguments),Oe(this,"onAutoplayFailed",void 0),Oe(this,"onAudioAutoplayFailed",void 0)}};function dK(){if(zn(),!LM){const n=i=>{i.preventDefault(),LM=!1,Lb()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};LM=!0,Lb()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Yu.onAutoplayFailed?Yu.onAutoplayFailed():Yu.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Yu.emit("autoplay-failed")}}function hK(n,i,s,c){if(!n)return;const l=kt.getBaseInfoBySessionId(n);if(!l)return;const h=l.info,p=Date.now(),v=ri(ri({},h),{},{vid:h.vid===void 0?0:Number(h.vid),lts:p,elapse:p-l.startTime,cbRegistered:Yu.onAutoplayFailed||Yu.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:i,trackId:c,extend:void 0});kt.send({type:ni.AUTOPLAY_FAILED,data:v},!0)}const mEe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],nc=new class{constructor(){Oe(this,"onAutoplayFailed",void 0),Oe(this,"elementMap",new Map),Oe(this,"elementStateMap",new Map),Oe(this,"elementsNeedToResume",[]),Oe(this,"sinkIdMap",new Map),Oe(this,"autoResumeAfterInterruption",n=>{Array.from(this.elementMap.entries()).forEach(i=>{let[s,c]=i;const l=this.elementStateMap.get(s),h=c.srcObject.getAudioTracks()[0],p=h&&h.readyState;if(x.debug("resume after interrupted, ele: ".concat(l," audio: ").concat(p," ").concat(n)),p==="live"){if(n)return c.pause(),void c.play();if(yr.curState==="running")return HE()?(c.pause(),void c.play()):void(l&&l==="paused"&&c.play())}})}),Oe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[i,s]=n;const c=s.srcObject.getAudioTracks()[0];c&&c.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),yr.on(Xs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),yr.on(Xs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),yr.on(Xs.STATE_CHANGE,()=>{Na()&&yr.prevState==="suspended"&&yr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(n,i){const s=this.elementMap.get(n);if(this.sinkIdMap.set(n,i),s)try{await s.setSinkId(i)}catch(c){throw new Fe(ie.PERMISSION_DENIED,"can not set sink id: "+c.toString())}}play(n,i,s,c){if(this.elementMap.has(i))return;const l=document.createElement("audio");l.autoplay=!0,l.srcObject=new MediaStream([n]),this.bindAudioElementEvents(i,l),this.elementMap.set(i,l),this.elementStateMap.set(i,fa.INIT),this.setVolume(i,s);const h=this.sinkIdMap.get(i);if(h)try{l.setSinkId(h).catch(v=>{x.warning("[".concat(i,"] set sink id failed"),v.toString())})}catch(v){x.warning("[".concat(i,"] set sink id failed"),v.toString())}const p=l.play();p&&p.then&&p.catch(v=>{c&&hK(c,"audio",v.message,i),x.warning("audio element play warning",v.toString()),this.elementMap.has(i)&&v.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(l),Uk(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),dK()}))})}updateTrack(n,i){const s=this.elementMap.get(n);s&&(s.srcObject=new MediaStream([i]))}isPlaying(n){return this.elementMap.has(n)&&this.elementStateMap.get(n)==="playing"}setVolume(n,i){const s=this.elementMap.get(n);s&&(i=Math.max(0,Math.min(100,i)),s.volume=i/100)}stop(n){const i=this.elementMap.get(n);if(this.sinkIdMap.delete(n),!i)return;const s=this.elementsNeedToResume.indexOf(i);this.elementsNeedToResume.splice(s,1),i.srcObject=null,i.remove(),this.elementMap.delete(n),this.elementStateMap.delete(n)}bindAudioElementEvents(n,i){mEe.forEach(s=>{i.addEventListener(s,c=>{const l=this.elementStateMap.get(n),h=c.type==="pause"?"paused":c.type;if(x.debug("[".concat(n,"] audio-element-status change ").concat(l," => ").concat(h)),c.type==="error"){const p=i==null?void 0:i.error;p&&x.error("[".concat(n,"] media error, code: ").concat(p.code,", message: ").concat(p.message))}this.elementStateMap.set(n,h)})})}getPlayerState(n){return this.elementStateMap.get(n)||"uninit"}autoResumeAudioElement(){const n=()=>{this.elementsNeedToResume.forEach(i=>{i.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new pt(i=>{document.body?i():window.addEventListener("load",()=>i())}).then(()=>{Lb()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0))})}};function Mi(){return function(n,i,s){const c=s.value;return typeof c=="function"&&(s.value=function(){this._isClosed&&new Fe(ie.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var l=arguments.length,h=new Array(l),p=0;p<l;p++)h[p]=arguments[p];const v=c.apply(this,h);return v instanceof pt?new pt((y,S)=>{v.then(y).catch(S)}):v}),s}}class fK extends li{constructor(i){super(),Oe(this,"name","VideoProcessorDestination"),Oe(this,"ID","0"),Oe(this,"_source",void 0),Oe(this,"videoContext",void 0),Oe(this,"inputTrack",void 0),this.videoContext=i}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Fe(ie.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Fe(ie.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(i){if(i.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);i.track&&i.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=i.track,this.emit(Da.ON_TRACK,i.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Da.ON_TRACK,void 0)}}class pK extends li{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,s){super(),Oe(this,"constraintsMap",new Map),Oe(this,"statsRegistry",[]),Oe(this,"usageRegistry",[]),Oe(this,"trackId",void 0),Oe(this,"direction",void 0),Oe(this,"_chained",!1),this.trackId=i,this.direction=s}async getConstraints(){return await ho(this,Hu.REQUEST_CONSTRAINTS)}async requestApplyConstraints(i,s){var c;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),i&&this.constraintsMap.set(s,i),Pr(this,Hu.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fu(c=this.constraintsMap).call(c)))}async requestRevertConstraints(i){var s;if(this.constraintsMap.has(i))return x.info("processor ".concat(i.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(i),Pr(this,Hu.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fu(s=this.constraintsMap).call(s)))}registerStats(i,s,c){this.statsRegistry.find(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===s)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:s,cb:c})}unregisterStats(i,s){const c=this.statsRegistry.findIndex(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===s);c!==-1&&this.statsRegistry.splice(c,1)}gatherStats(){const i=[];for(const{processorID:s,processorName:c,type:l,cb:h}of this.statsRegistry)try{const p=h();i.push({processorID:s,processorName:c,type:l,stats:p})}catch(p){x.error(new Fe(ie.UNEXPECTED_ERROR,p.message))}return i}registerUsage(i,s){this.usageRegistry.find(c=>c.processorID===i.ID&&c.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:s})}unregisterUsage(i){const s=this.usageRegistry.findIndex(c=>c.processorID===i.ID&&c.processorName===i.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const i=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let c=s();c instanceof pt&&(c=await c),i.push(ri(ri({},c),{},{direction:this.direction}))}catch(c){x.error("gather extension usage error",c)}return i}getDirection(){return this.direction}}class mK extends li{constructor(i){super(),Oe(this,"name","AudioProcessorDestination"),Oe(this,"ID","0"),Oe(this,"inputTrack",void 0),Oe(this,"inputNode",void 0),Oe(this,"audioProcessorContext",void 0),Oe(this,"_source",void 0),this.audioProcessorContext=i}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Fe(ie.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Fe(ie.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Da.ON_TRACK,void 0),this.emit(Da.ON_NODE,void 0)}updateInput(i){if(i.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);i.track&&this.inputTrack!==i.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=i.track,this.emit(Da.ON_TRACK,this.inputTrack)),i.node&&this.inputNode!==i.node&&(this.audioProcessorContext.chained=!0,this.inputNode=i.node,this.emit(Da.ON_NODE,this.inputNode))}}class gK extends li{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,s,c){super(),Oe(this,"constraintsMap",new Map),Oe(this,"statsRegistry",[]),Oe(this,"audioContext",void 0),Oe(this,"trackId",void 0),Oe(this,"direction",void 0),Oe(this,"usageRegistry",[]),Oe(this,"_chained",!1),this.audioContext=i,this.trackId=s,this.direction=c}async getConstraints(){return ho(this,Hu.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(i,s){var c;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),i&&this.constraintsMap.set(s,i),Pr(this,Hu.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fu(c=this.constraintsMap).call(c)))}async requestRevertConstraints(i){var s;if(this.constraintsMap.has(i))return this.constraintsMap.delete(i),Pr(this,Hu.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fu(s=this.constraintsMap).call(s)))}registerStats(i,s,c){this.statsRegistry.find(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===s)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:s,cb:c})}unregisterStats(i,s){const c=this.statsRegistry.findIndex(l=>l.processorID===i.ID&&l.processorName===i.name&&l.type===s);c!==-1&&this.statsRegistry.splice(c,1)}gatherStats(){const i=[];for(const{processorID:s,processorName:c,type:l,cb:h}of this.statsRegistry)try{const p=h();i.push({processorID:s,processorName:c,type:l,stats:p})}catch(p){x.error(new Fe(ie.UNEXPECTED_ERROR,p.message))}return i}registerUsage(i,s){this.usageRegistry.find(c=>c.processorID===i.ID&&c.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:s})}unregisterUsage(i){const s=this.usageRegistry.findIndex(c=>c.processorID===i.ID&&c.processorName===i.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const i=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let c=s();c instanceof pt&&(c=await c),i.push(ri(ri({},c),{},{direction:this.direction}))}catch(c){x.error("gather extension usage error",c)}return i}getDirection(){return this.direction}}class xM extends li{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Oe(this,"context",void 0),Oe(this,"processSourceNode",void 0),Oe(this,"outputTrack",void 0),Oe(this,"processedNode",void 0),Oe(this,"clonedTrack",void 0),Oe(this,"outputNode",void 0),this.outputNode=new gEe}setVolume(){}createOutputTrack(){throw new Fe(ie.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class gEe{disconnect(){}connect(){}}function vK(n){return new pt((i,s)=>{let c=!1;const l=document.createElement("video");l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.muted=!0,l.autoplay=!0,l.setAttribute("playsinline",""),l.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(l);const h=Na()?"canplay":"playing";l.addEventListener(h,()=>{const p=l.videoWidth,v=l.videoHeight;!p&&gi()||(c=!0,l.srcObject=null,l.remove(),i([p,v]))}),l.srcObject=new MediaStream([n]),l.play().catch(Vk),setTimeout(()=>{c||(l.srcObject=null,l.remove(),i([l.videoWidth,l.videoHeight]))},4e3)})}function Yk(n){const i={};n.facingMode&&(i.facingMode=n.facingMode),n.cameraId&&(i.deviceId={exact:n.cameraId});const s=Bh(n.encoderConfig);return s.width!=null&&(i.width=s.width),s.height!=null&&(i.height=s.height),!m9()&&s.frameRate&&(i.frameRate=s.frameRate),a9()&&typeof i.frameRate=="object"&&(i.frameRate.max=60),gi()&&(i.frameRate={ideal:30,max:30}),i}function _K(n){const i={};return m9()||(n.AGC!==void 0&&(i.autoGainControl=n.AGC),n.AEC!==void 0&&(i.echoCancellation=n.AEC),n.ANS!==void 0&&(i.noiseSuppression=n.ANS,cp()&&n.ANS&&(i.googHighpassFilter=n.ANS))),i}function yK(n){const i=_K(n);if(n.encoderConfig){const s=Kk(n.encoderConfig);i.channelCount=s.stereo?2:1,i.sampleRate=s.sampleRate,i.sampleSize=s.sampleSize}return n.microphoneId&&(i.deviceId={exact:n.microphoneId}),xk()&&(i.sampleRate=void 0),i}const vEe=n=>{const i=n._encoderConfig;if(!i)return;const{frameRate:s,width:c,height:l}=n.getMediaStreamTrackSettings();let{frameRate:h=s,width:p=c,height:v=l}=i;if(!h||!p||!v)return;p=dM(p),v=dM(v),h=dM(h);const{max:y,min:S}=function(N,Y,W){const H=200*Math.pow(W/15,.6)*Math.pow(N*Y/640/360,.75);return{min:Math.floor(H),max:Math.floor(4*H)}}(p,v,h),{bitrateMax:b,bitrateMin:R}=i||{};b||x.debug("calculate bitrate: [w: ".concat(p,", h: ").concat(v,", fps: ").concat(h,"] => [brMax: ").concat(b,", brMin: ").concat(R,"]"));const{maxFramerate:O}=le("ENCODER_CONFIG_LIMIT");return O&&typeof O=="number"&&(h=Math.min(h,O)),{frameRate:h,bitrateMax:b||y,bitrateMin:R||S,scaleResolutionDownBy:1,scale:0}},EK=async(n,i,s)=>await(async(c,l,h)=>{const p=function(S){const b=[];for(let R=0;R<S.length;R+=2)b.push(parseInt(S.slice(R,R+2),16));return Uint8Array.from(b)}(P9(""+l+h)).slice(0,16),v=p.slice(0,12),y=await window.crypto.subtle.importKey("raw",p,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:v},y,c))})(n.buffer,i,s),MM=n=>{const i=document.createElement("canvas");return i.width=2,i.height=2,new pt((s,c)=>{i.toBlob(async l=>{if(i.remove(),l){const h=await SK(l);s({buffer:h,width:i.width,height:i.height})}else c(new Fe(ie.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,1)})},SK=async n=>{const i=await n.arrayBuffer();return new Uint8Array(i)};var TK,bK,wK,CK,RK,IK,AK,kK,OK,PK,NK,DK,LK,xK,MK,UK,VK,FK,di,jK,BK,WK,zK,GK,HK,zh,KK,qK,$K,YK,XK,JK,QK,ZK,eq,tq,nq,rq,iq,po;let bi=(TK=zt({argsMap:(n,i)=>[n.getTrackId(),i],throttleTime:300}),bK=zt({argsMap:(n,i)=>[n.getTrackId(),i]}),wK=Mi(),CK=$E("LocalAudioTrack","_enabledMutex"),RK=zt({argsMap:(n,i)=>[n.getTrackId(),i]}),IK=Mi(),AK=$E("LocalAudioTrack","_enabledMutex"),kK=zt({argsMap:(n,i)=>[n.getTrackId(),i]}),OK=Mi(),PK=Mi(),NK=Mi(),DK=zt({argsMap:n=>[n.getTrackId()]}),LK=Mi(),xK=zt({argsMap:n=>[n.getTrackId()]}),MK=Mi(),UK=zt({argsMap:n=>[n.getTrackId()]}),VK=zt({argsMap:(n,i)=>[n.getTrackId(),i.name]}),FK=zt({argsMap:n=>[n.getTrackId()]}),Hn((di=class extends rS{get _source(){return this.initWebAudio()}set _source(n){this._trackSource=n}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?nc.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(n,i,s,c){super(n,s),Oe(this,"trackMediaType",nS.AUDIO),Oe(this,"_encoderConfig",void 0),Oe(this,"_trackSource",void 0),Oe(this,"metadata",[]),Oe(this,"_enabled",!0),Oe(this,"_volume",100),Oe(this,"_useAudioElement",!0),Oe(this,"_bypassWebAudio",!1),Oe(this,"processor",void 0),Oe(this,"_processorContext",void 0),Oe(this,"_processorDestination",void 0),Oe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=i,this._getOriginVolumeLevel=!!c,this._trackSource=new xM,le("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),le("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),uo()&&!Ku?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(n){Tr(n,"volume",0,1e3),this._volume=n,this._source.setVolume(n/100),this._useAudioElement&&nc.setVolume(this.getTrackId(),n);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const i=this._source.createOutputTrack();this._mediaStreamTrack!==i&&(this._mediaStreamTrack=i,Pr(this,wt.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(n){if(!this._useAudioElement||!X9())throw new Fe(ie.NOT_SUPPORTED,"your browser does not support setting the audio output device");await nc.setSinkID(this.getTrackId(),n)}async setEnabled(n,i,s){return this._setEnabled(n,i,s)}async _setEnabled(n,i,s){if(!s){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),n),n){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await Pr(this,wt.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(n," success"))}catch(c){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),c.toString()),c}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await Pr(this,wt.NEED_DISABLE_TRACK,this)}catch(c){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),c.toString()),c}}}async setMuted(n){n!==this._muted&&(this.stateCheck("muted",n),this._muted=n,this._originMediaStreamTrack.enabled=!n,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(n)),n?await Pr(this,wt.NEED_MUTE_TRACK,this):await Pr(this,wt.NEED_UNMUTE_TRACK,this))}getStats(){return Bm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Bu(this,wt.GET_STATS)||ri({},AM)}setAudioFrameCallback(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!n)return this._source.removeAllListeners(Gu.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(Gu.ON_AUDIO_BUFFER),this._source.on(Gu.ON_AUDIO_BUFFER,s=>n(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),nc.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?nc.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let n=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&nc.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(n,i){this._originMediaStreamTrack!==n&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),n.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=n,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:n,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Pr(this,wt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(n))}renewMediaStreamTrack(n){return pt.resolve(void 0)}pipe(n){if(this._bypassWebAudio)throw new Fe(ie.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===n)return n;if(n._source)throw new Fe(ie.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(!this.processor)return;const i=this.processor;(n=this._source.processSourceNode)===null||n===void 0||n.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(n){n.on(Da.ON_TRACK,async i=>{i?i!==this._mediaStreamTrack&&(this._mediaStreamTrack=i,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(i),await Pr(this,wt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Pr(this,wt.NEED_REPLACE_TRACK,this))}),n.on(Da.ON_NODE,i=>{this._source.processedNode=i})}unbindProcessorDestinationEvents(n){n.removeAllListeners(Da.ON_TRACK),n.removeAllListeners(Da.ON_NODE)}bindProcessorContextEvents(n){n.on(Hu.REQUEST_CONSTRAINTS,async i=>{i(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(n){n.removeAllListeners(Hu.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof xM&&(this._trackSource=new oK(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const n=new gK(this._source.context,this.getTrackId(),"local"),i=new mK(n);return this._processorContext=n,this._processorDestination=i,this.bindProcessorContextEvents(n),this.bindProcessorDestinationEvents(i),this._source.on(Gu.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:n})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(nc.stop(this.getTrackId()),this._source.play()),Pr(this,wt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:n,processorDestination:i}}}).prototype,"setVolume",[TK],Object.getOwnPropertyDescriptor(di.prototype,"setVolume"),di.prototype),Hn(di.prototype,"setPlaybackDevice",[bK,wK],Object.getOwnPropertyDescriptor(di.prototype,"setPlaybackDevice"),di.prototype),Hn(di.prototype,"setEnabled",[CK,RK,IK],Object.getOwnPropertyDescriptor(di.prototype,"setEnabled"),di.prototype),Hn(di.prototype,"setMuted",[AK,kK,OK],Object.getOwnPropertyDescriptor(di.prototype,"setMuted"),di.prototype),Hn(di.prototype,"getStats",[PK],Object.getOwnPropertyDescriptor(di.prototype,"getStats"),di.prototype),Hn(di.prototype,"setAudioFrameCallback",[NK],Object.getOwnPropertyDescriptor(di.prototype,"setAudioFrameCallback"),di.prototype),Hn(di.prototype,"play",[DK,LK],Object.getOwnPropertyDescriptor(di.prototype,"play"),di.prototype),Hn(di.prototype,"stop",[xK,MK],Object.getOwnPropertyDescriptor(di.prototype,"stop"),di.prototype),Hn(di.prototype,"close",[UK],Object.getOwnPropertyDescriptor(di.prototype,"close"),di.prototype),Hn(di.prototype,"pipe",[VK],Object.getOwnPropertyDescriptor(di.prototype,"pipe"),di.prototype),Hn(di.prototype,"unpipe",[FK],Object.getOwnPropertyDescriptor(di.prototype,"unpipe"),di.prototype),di),Xk=(jK=zt({argsMap:(n,i)=>[n.getTrackId(),i]}),BK=Mi(),WK=$E("MicrophoneAudioTrack","_enabledMutex"),zK=zt({argsMap:(n,i,s)=>[n.getTrackId(),i,s]}),GK=Mi(),HK=zt({argsMap:n=>[n.getTrackId()]}),Hn((zh=class extends bi{get __className__(){return"MicrophoneAudioTrack"}constructor(n,i,s,c){super(n,i.encoderConfig?Kk(i.encoderConfig):{},c,le("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Oe(this,"_config",void 0),Oe(this,"_deviceName","default"),Oe(this,"_constraints",void 0),Oe(this,"_originalConstraints",void 0),Oe(this,"_enabled",!0),this._config=i,this._constraints=s,this._originalConstraints=s,this._deviceName=n.label,typeof i.bypassWebAudio=="boolean"&&(this._bypassWebAudio=i.bypassWebAudio),(HE()||rM())&&yr.bindInterruptDetectorTrack(this)}async setDevice(n){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(n)),this._enabled)try{const i=await $u.getDeviceById(n),s={};s.audio=ri({},this._constraints),s.audio.deviceId={exact:n},this._originMediaStreamTrack.stop();let c=null;try{c=await qu(s,this.getTrackId())}catch(l){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),c=await qu({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),this._deviceName=i.label,this._config.microphoneId=n,this._constraints.deviceId={exact:n}}catch(i){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await $u.getDeviceById(n);this._deviceName=i.label,this._config.microphoneId=n,this._constraints.deviceId={exact:n}}catch(i){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}x.info("[".concat(this.getTrackId(),"] set device to ").concat(n," success"))}async setEnabled(n,i,s){if(i)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(n);if(!s){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),n),le("AUTO_RESET_AUDIO_ROUTE")&&(Na()||sd())){const p=navigator.audioSession;p&&(n||(p.type="playback"),p.type="auto")}if(!n){var c;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(c=this._source.clonedTrack)===null||c===void 0||c.stop(),s||(this._enabled=!1);try{await Pr(this,wt.NEED_DISABLE_TRACK,this)}catch(p){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),p.toString()),p}return}const l=ri({},this._constraints),h=$u.searchDeviceIdByName(this._deviceName);h&&!l.deviceId&&(l.deviceId=h);try{s||(this._enabled=!0);const p=await qu({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!1),await Pr(this,wt.NEED_ENABLE_TRACK,this)}catch(p){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),p.toString()),p}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(HE()||rM())&&yr.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Na()||sd())&&this._enabled&&!this._isClosed&&yr.duringInterruption){const n=async()=>{yr.off(Xs.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};yr.on(Xs.IOS_INTERRUPTION_END,n)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(eS.TRACK_ENDED)}async renewMediaStreamTrack(n){const i=n||this._constraints,s=$u.searchDeviceIdByName(this._deviceName);if(s&&!i.deviceId&&(i.deviceId=s),this._constraints=i,this._enabled){this._originMediaStreamTrack.stop();const c=await qu({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!0)}}bindProcessorContextEvents(n){super.bindProcessorContextEvents(n),n.on(Hu.REQUEST_UPDATE_CONSTRAINTS,async(i,s,c)=>{try{const l=Object.assign({},this._originalConstraints,...i);await this.renewMediaStreamTrack(l),s()}catch(l){c(l)}})}unbindProcessorContextEvents(n){super.unbindProcessorContextEvents(n),n.removeAllListeners(Hu.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[jK,BK],Object.getOwnPropertyDescriptor(zh.prototype,"setDevice"),zh.prototype),Hn(zh.prototype,"setEnabled",[WK,zK,GK],Object.getOwnPropertyDescriptor(zh.prototype,"setEnabled"),zh.prototype),Hn(zh.prototype,"close",[HK],Object.getOwnPropertyDescriptor(zh.prototype,"close"),zh.prototype),zh),_Ee=(KK=zt({argsMap:(n,i)=>[n.getTrackId(),i,n.duration]}),qK=Mi(),$K=zt({argsMap:n=>[n.getTrackId()]}),YK=Mi(),XK=zt({argsMap:n=>[n.getTrackId()]}),JK=Mi(),QK=zt({argsMap:n=>[n.getTrackId()]}),ZK=Mi(),eq=zt({argsMap:n=>[n.getTrackId()]}),tq=Mi(),nq=zt({argsMap:n=>[n.getTrackId()]}),rq=zt({argsMap:n=>[n.getTrackId()]}),iq=Mi(),Hn((po=class extends bi{get __className__(){return"BufferSourceAudioTrack"}constructor(n,i,s,c){super(i.createOutputTrack(),s,c),Oe(this,"source",void 0),Oe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=n,this._bufferSource=i,this._bufferSource.on(Gu.AUDIO_SOURCE_STATE_CHANGE,l=>{this.safeEmit(eS.SOURCE_STATE_CHANGE,l)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(n){n&&this._bufferSource.updateOptions(n),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(n){this._bufferSource.seekAudioBuffer(n)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(n){Tr(n,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(n)}}).prototype,"startProcessAudioBuffer",[KK,qK],Object.getOwnPropertyDescriptor(po.prototype,"startProcessAudioBuffer"),po.prototype),Hn(po.prototype,"pauseProcessAudioBuffer",[$K,YK],Object.getOwnPropertyDescriptor(po.prototype,"pauseProcessAudioBuffer"),po.prototype),Hn(po.prototype,"seekAudioBuffer",[XK,JK],Object.getOwnPropertyDescriptor(po.prototype,"seekAudioBuffer"),po.prototype),Hn(po.prototype,"resumeProcessAudioBuffer",[QK,ZK],Object.getOwnPropertyDescriptor(po.prototype,"resumeProcessAudioBuffer"),po.prototype),Hn(po.prototype,"stopProcessAudioBuffer",[eq,tq],Object.getOwnPropertyDescriptor(po.prototype,"stopProcessAudioBuffer"),po.prototype),Hn(po.prototype,"close",[nq],Object.getOwnPropertyDescriptor(po.prototype,"close"),po.prototype),Hn(po.prototype,"setAudioBufferPlaybackSpeed",[rq,iq],Object.getOwnPropertyDescriptor(po.prototype,"setAudioBufferPlaybackSpeed"),po.prototype),po);class fs extends bi{get __className__(){return"MixingAudioTrack"}get isActive(){for(const i of this.trackList)if(i._enabled&&!i._isClosed&&!i.muted)return!0;return!1}constructor(){const i=iS().createMediaStreamDestination();super(i.stream.getAudioTracks()[0],void 0,Nr(8,"track-mix-")),Oe(this,"trackList",void 0),Oe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=i,this.trackList=[]}hasAudioTrack(i){return this.trackList.indexOf(i)!==-1}addAudioTrack(i){this.trackList.indexOf(i)===-1?(x.debug("add ".concat(i.getTrackId()," to mixing track")),i._source.outputNode.connect(this.destNode),this.trackList.push(i),this.updateEncoderConfig()):x.debug("track ".concat(i.getTrackId()," is already added"))}removeAudioTrack(i){if(this.trackList.indexOf(i)!==-1){x.debug("remove ".concat(i.getTrackId()," from mixing track"));try{i._source.outputNode.disconnect(this.destNode)}catch{}Mk(this.trackList,i),this.updateEncoderConfig()}}updateEncoderConfig(){const i={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(i.bitrate||0)&&(i.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(i.sampleRate||0)&&(i.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(i.sampleSize||0)&&(i.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(i.stereo=!0))}),this._encoderConfig=i}_updateRtpTransceiver(i){this._rtpTransceiver!==i&&(this._rtpTransceiver=i,this.trackList.forEach(s=>{s instanceof fs?s.emit(i_.TRANSCEIVER_UPDATED,i):s._updateRtpTransceiver(i)}))}}class yEe extends sK{set currentState(i){i!==this._currentState&&(this._currentState=i,this.safeEmit(Gu.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Oe(this,"audioBuffer",void 0),Oe(this,"sourceNode",void 0),Oe(this,"startPlayTime",0),Oe(this,"startPlayOffset",0),Oe(this,"pausePlayTime",0),Oe(this,"options",void 0),Oe(this,"currentLoopCount",0),Oe(this,"currentPlaybackSpeed",100),Oe(this,"_currentState","stopped"),this.audioBuffer=i,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(i){this.currentState==="stopped"?(this.options=i,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(i){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=i,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=i))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(i){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=i/100),this.currentPlaybackSpeed=i}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const i=this.context.createBufferSource();return i.buffer=this.audioBuffer,i.loop=!!this.options.loop,i.connect(this.outputNode),i.playbackRate.value=this.currentPlaybackSpeed/100,i}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const sq=new Map;class UM{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const i=this.renderStats.curTs-this.renderStats.lastTs,s=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/i;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,s}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(i){i!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(i)),this._videoElementStatus=i)}get videoState(){return this._videoState}set videoState(i){var s;i!==this._videoState&&(this._videoState=i,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(i){Oe(this,"trackId",void 0),Oe(this,"config",void 0),Oe(this,"onFirstVideoFrameDecoded",void 0),Oe(this,"onVideoStateChanged",void 0),Oe(this,"freezeTimeCounterList",[]),Oe(this,"renderFreezeAccTime",0),Oe(this,"isKeepLastFrame",!1),Oe(this,"timeUpdatedCount",0),Oe(this,"freezeTime",0),Oe(this,"playbackTime",0),Oe(this,"lastTimeUpdatedTime",0),Oe(this,"autoplayFailed",!1),Oe(this,"videoTrack",void 0),Oe(this,"videoElement",void 0),Oe(this,"cacheVideoElement",void 0),Oe(this,"renderStats",void 0),Oe(this,"_videoState",Wh.VideoStateStopped),Oe(this,"videoElementCheckInterval",void 0),Oe(this,"videoElementFreezeTimeout",void 0),Oe(this,"_videoElementStatus",fa.NONE),Oe(this,"isGettingVideoDimensions",!1),Oe(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Oe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&yr.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(o9())),f9()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Oe(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=fa.PLAYING;break;case"loadeddata":if(this.videoState=Wh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=fa.CANPLAY;break;case"stalled":this.videoElementStatus=fa.STALLED;break;case"suspend":this.videoElementStatus=fa.SUSPEND;break;case"pause":this.videoElementStatus=fa.PAUSED,Na()||sd()||uo()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=fa.WAITING;break;case"abort":this.videoElementStatus=fa.ABORT;break;case"ended":this.videoElementStatus=fa.ENDED;break;case"emptied":this.videoElementStatus=fa.EMPTIED;break;case"error":{const c=this.videoElement.error;c&&(this.videoElementStatus=fa.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(c.message," (").concat(c.code,")")));break}case"timeupdate":{const c=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=c);const l=c-this.lastTimeUpdatedTime,h=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=c,hp.lastVisibleTime<hp.lastHiddenTime||h<hp.lastHiddenTime||h<hp.lastVisibleTime)return;for(l>le("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=l),this.playbackTime+=l;this.playbackTime>=6e3;){this.playbackTime-=6e3;const p=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(p),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Oe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(o9())),f9()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=i.trackId,this.config=i,i.element instanceof HTMLVideoElement?this.videoElement=i.element:this.videoElement=document.createElement("video"),yr.on(Xs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),yr.on(Xs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var i;return(i=this.videoElement.parentElement)!==null&&i!==void 0?i:void 0}updateConfig(i){this.config=i,this.trackId=i.trackId,i.element!==this.videoElement&&(this.destroy(),this.videoElement=i.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.initVideoElement())}play(i){const s=this.videoElement.play();s&&s.catch&&s.catch(l=>{i&&hK(i,"video",l.message,this.trackId),l.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",l),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),l)});const c=zn();if((c.name==="Safari"&&Number(c.version)===15||HE())&&s&&s.then){const l=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(l).catch(l)}}getCurrentFrame(){const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const s=i.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,i.width,i.height);const c=s.getImageData(0,0,i.width,i.height);return i.remove(),c}async getCurrentFrameToUint8Array(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const c=document.createElement("canvas");c.width=this.videoElement.videoWidth,c.height=this.videoElement.videoHeight;const l=c.getContext("2d");return l?(l.drawImage(this.videoElement,0,0,c.width,c.height),new pt((h,p)=>{c.toBlob(async v=>{if(c.remove(),v){const y=await SK(v);h({buffer:y,width:c.width,height:c.height})}else p(new Fe(ie.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},i,s<0?.1:s>1?1:s)})):await MM(i)}destroy(){this.renderStats=void 0,yr.off(Xs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),yr.off(Xs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Wh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=fa.INIT,!this.videoElementCheckInterval&&(oq.forEach(h=>{this.videoElement.addEventListener(h,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(h){return h!==document.body&&document.body.contains(h)})(this.videoElement)||(this.videoElementStatus=fa.DESTROYED)},1e3),le("ENABLE_VIDEO_FRAME_CALLBACK"))){var i,s;let h;const p=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",p),this.videoElementFreezeTimeout=window.setTimeout(v,le("VIDEO_FREEZE_DURATION")))},v=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Wh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Wh.VideoStateFrozen:document.addEventListener("visibilitychange",p))},y=(S,b)=>{if(this.videoElementStatus===fa.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=b.mediaTime):this.renderStats={lastTs:b.mediaTime,curTs:b.mediaTime,lastRenderNum:0,renderNum:0},h){const N=b.presentationTime-h.presentationTime;this.videoState===Wh.VideoStateStarting&&(this.videoState=Wh.VideoStateDecoding),this.videoState===Wh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(v,le("VIDEO_FREEZE_DURATION"))),N<le("VIDEO_FREEZE_DURATION")&&this.videoState===Wh.VideoStateFrozen&&(this.videoState=Wh.VideoStateDecoding),N>le("VIDEO_FREEZE_DURATION")&&hp.lastVisibleTime>=hp.lastHiddenTime&&h.timestamp>hp.lastVisibleTime&&h.timestamp>hp.lastHiddenTime&&(this.renderFreezeAccTime+=N)}h=ri(ri({},b),{},{timestamp:S})}var R,O;le("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(O=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(O,y))};(i=(s=this.videoElement).requestVideoFrameCallback)===null||i===void 0||i.call(s,y)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),xk()&&!le("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const c=zn();c.name==="Safari"&&Number(c.version)===15||HE()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,gi()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,gi()&&this.videoElement.load());const l=this.videoElement.play();l!==void 0&&l.catch(h=>{x.debug("[".concat(this.trackId,"] playback interrupted"),h.toString())})}resetVideoElement(){oq.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=fa.NONE}handleAutoPlayFailed(){const i=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(c=>{x.error(c)}),this.autoplayFailed=!1,Lb()?document.body.removeEventListener("click",i,!0):(document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0))};Lb()?document.body.addEventListener("click",i,!0):(document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)),dK()}}const oq=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class aq extends UM{constructor(i){super(i),Oe(this,"container",void 0),Oe(this,"slot",void 0),this.slot=i.element,this.updateConfig(i)}updateConfig(i){this.config=i,this.trackId=i.trackId;const s=i.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.createElements())}play(i){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(i)}getCurrentFrame(){var i;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(i){var s;let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(i,c):await MM(i)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",le("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var i;!this.container||(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var i;if((i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var cq,uq,lq,dq,hq,fq,pq,mq,gq,vq,_q,yq,Eq,Sq,Tq,bq,wq,Cq,Rq,Iq,Aq,kq,Oq,Pq,jn,Nq,Dq,Lq,xq,Mq,Uq,Vq,Fq,Xu;let qr=(cq=zt({argsMap:(n,i,s)=>[n.getTrackId(),typeof i=="string"?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),uq=Mi(),lq=zt({argsMap:n=>[n.getTrackId()]}),dq=$E("LocalVideoTrack","_enabledMutex"),hq=zt({argsMap:(n,i)=>[n.getTrackId(),i]}),fq=Mi(),pq=$E("LocalVideoTrack","_enabledMutex"),mq=zt({argsMap:(n,i)=>[n.getTrackId(),i]}),gq=Mi(),vq=zt({argsMap:(n,i)=>[n.getTrackId(),i]}),_q=Mi(),yq=Mi(),Eq=zt({argsMap:(n,i,s)=>[n.getTrackId(),i,s]}),Sq=Mi(),Tq=Mi(),bq=Mi(),wq=Mi(),Cq=Mi(),Rq=Mi(),Iq=Mi(),Aq=zt({argsMap:(n,i)=>[n.getTrackId(),i.name]}),kq=zt({argsMap:n=>[n.getTrackId()]}),Oq=zt({argsMap:n=>[n.getTrackId()]}),Pq=zt({argsMap:(n,i,s)=>[n.getTrackId(),i.label,s]}),jn=class vue extends rS{get videoHeight(){if(uo()){const{height:i}=this._mediaStreamTrack.getSettings();return this._videoHeight=i,this._videoHeight}return this._videoHeight}get videoWidth(){if(uo()){const{width:i}=this._mediaStreamTrack.getSettings();return this._videoWidth=i,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==fa.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get __className__(){return"LocalVideoTrack"}constructor(i,s,c,l,h,p){if(super(i,h),Oe(this,"trackMediaType",nS.VIDEO),Oe(this,"_player",void 0),Oe(this,"isUseScaleResolutionDownBy",!1),Oe(this,"_videoVisibleTimer",null),Oe(this,"_previousVideoVisibleStatus",void 0),Oe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Oe(this,"_encoderConfig",void 0),Oe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Oe(this,"_optimizationMode",void 0),Oe(this,"_videoHeight",void 0),Oe(this,"_videoWidth",void 0),Oe(this,"_forceBitrateLimit",void 0),Oe(this,"_enabled",!0),Oe(this,"_processorDestination",void 0),Oe(this,"_processorContext",void 0),uo()){const{width:v,height:y}=i.getSettings();this._videoWidth=v,this._videoHeight=y}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=s,this._scalabilityMode=c,this._optimizationMode=l,this._hints=p||[],this._hints.indexOf(Dr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(eM(nr.CHROME,115)&&Dk().indexOf("Windows")!==-1){const v=function(y,S){if("VideoFrame"in window&&"TransformStream"in window&&Xn().supportWebRTCInsertableStream){const b=new MediaStreamTrackProcessor(y),R=new MediaStreamTrackGenerator({kind:"video"});let O,N,Y=Date.now();const W=()=>{H&&(clearInterval(H),H=void 0),O&&(O.close(),O=void 0),y.stop(),N=void 0,R.removeEventListener("ended",W)};let H=window.setInterval(()=>{if(N&&O&&Date.now()-Y>1e3)try{R.readyState==="live"?N.enqueue(O.clone()):W()}catch{W()}},1e3);const ne=new TransformStream({transform:(re,me)=>{R.readyState==="live"?(N=me,Y=Date.now(),O===void 0?(O=re,me.enqueue(re.clone())):(me.enqueue(O),O=re)):re.close()}});return R.addEventListener("ended",W),b.readable.pipeThrough(ne).pipeTo(R.writable),R}}(i);v&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=v)}s&&this._hints.indexOf(Dr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new pK(this.getTrackId(),"local"),this._processorDestination=new fK(this.processorContext),this.bindProcessorDestinationEvents()}play(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof i=="string"){const l=document.getElementById(i);l?i=l:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const c=ri(ri(ri({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(c):(i instanceof HTMLVideoElement?this._player=new UM(c):this._player=new aq(c),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const l=this.getVideoElementVisibleStatus();this.safeEmit(eS.VIDEO_ELEMENT_VISIBLE_STATUS,l)}catch{}},le("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(i,s){if(!s){if(i===this._enabled)return;this.stateCheck("enabled",i)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),i),!i){this._originMediaStreamTrack.enabled=!1;try{await Pr(this,wt.NEED_DISABLE_TRACK,this)}catch(c){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),c.toString()),c}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Pr(this,wt.NEED_ENABLE_TRACK,this)}catch(c){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),c.toString()),c}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(i){i!==this._muted&&(this.stateCheck("muted",i),this._muted=i,this._originMediaStreamTrack.enabled=!i,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(i)),i?await Pr(this,wt.NEED_MUTE_TRACK,this):await Pr(this,wt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(i,s){if(!this._enabled)throw new Fe(ie.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(i=Bh(i),this._forceBitrateLimit&&(i.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:i.bitrateMin),i.width||i.height||i.frameRate){const c=Yk({encoderConfig:i});(uo()||Na()||sd())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(l){const h=new Fe(ie.UNEXPECTED_ERROR,l.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}}this._encoderConfig=i,this._hints.indexOf(Dr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Pr(this,wt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(c){return c.throw(x)}}getStats(){return Bm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Bu(this,wt.GET_STATS)||ri({},kM)}async setBeautyEffect(i){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(i,s):await MM(i)}async setBitrateLimit(i){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(i))),i&&(this._forceBitrateLimit=i,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<i.max_bitrate?this._encoderConfig.bitrateMax:i.max_bitrate:this._encoderConfig.bitrateMax=i.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=i.min_bitrate))}async setOptimizationMode(i){if(i!=="motion"&&i!=="detail"&&i!=="balanced")return void x.error(ie.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=i,await Pr(this,wt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(c){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),c.toString()),c}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(i,")"))}setScalabiltyMode(i){if(i.numSpatialLayers===1&&i.numTemporalLayers!==1)return x.error(ie.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=i,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(i,")"))}updateMediaStreamTrackResolution(){vK(this._originMediaStreamTrack).then(i=>{let[s,c]=i;this._videoHeight=c,this._videoWidth=s}).catch(Vk)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(i){if(!this._enabled)throw new Fe(ie.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(i)),i=Bh(i),this._forceBitrateLimit&&(i.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:i.bitrateMin),this._encoderConfig=i,this._hints.indexOf(Dr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Pr(this,wt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:i,height:s,frameRate:c}=this.getMediaStreamTrackSettings();if(!i||!s||!c)return;const{bitrateMax:l,bitrateMin:h}=this._encoderConfig;if(h==null||l==null){const{max:p,min:v}=function(y,S,b,R,O){const N=le("BITRATE_ADAPTER_TYPE");if(N==="DEFAULT_BITRATE")return{min:R,max:O};if(O===void 0){var Y;const H=Math.floor(200*Math.pow(b/15,.6)*Math.pow(y*S/640/360,.75));O=N==="STANDARD_BITRATE"?4*H:2*H,R=(Y=R)!==null&&Y!==void 0?Y:H}else{var W;R=(W=R)!==null&&W!==void 0?W:Math.floor(O/10)}return{min:R,max:O}}(i,s,c,h,l);this._encoderConfig.bitrateMin=v,this._encoderConfig.bitrateMax=p,x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(i,", h: ").concat(s,", fps: ").concat(c,"] => [brMax: ").concat(p,", brMin: ").concat(v,"]"))}}getVideoElementVisibleStatus(){try{var i,s;const c=this==null||(i=this._player)===null||i===void 0?void 0:i.getContainerElement(),l={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:c==null?void 0:c.parentElement},{element:h,slot:p}=l;if(this.isPlaying&&h instanceof HTMLVideoElement&&p instanceof HTMLElement){const v=_9.checkOneElementVisible(h),y=Object.assign({},v);if(y.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=y.visible;const S=kt.reportApiInvoke(null,{tag:_i.TRACER,name:is.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});y.visible?S.onSuccess("Video is visible"):S.onSuccess("Invisible because of ".concat(y.reason))}return y}return}catch(c){throw new Fe(ie.GET_VIDEO_ELEMENT_VISIBLE_ERROR,c.message)}}async renewMediaStreamTrack(i){}pipe(i){if(this.processor===i)return i;if(i._source)throw new Fe(ie.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(i){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],c=this._encoderConfig;i&&(c=ri(ri({},c),Bh(i))),c=e_(c);const l=Nr(8,"track-video-cloned-"),h=new vue(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,c,e_(this._scalabilityMode),this._optimizationMode,l,e_(this._hints));return i&&c&&h.setEncoderConfiguration(c),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(s)),h}async replaceTrack(i,s){if(!(i instanceof MediaStreamTrack))throw new Fe(ie.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(i.kind!=="video")throw new Fe(ie.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(i,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(i){if(Bm(()=>{kt.reportApiInvoke(null,{name:is.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:_i.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!le("ENABLE_VIDEO_SEI")||!le("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(i instanceof Uint8Array==0)return new Fe(ie.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const c=s.sender.getParameters();if(c.codecs.length===0)return;const l=c.codecs[0].mimeType.toLocaleLowerCase();l==="video/h264"?this.safeEmit("sei-to-send",i):x.warning("SEI is not supported by ".concat(l))}bindProcessorDestinationEvents(){this.processorDestination.on(Da.ON_TRACK,async i=>{i?i!==this._mediaStreamTrack&&(this._mediaStreamTrack=i,this._updatePlayerSource(),await Pr(this,wt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Pr(this,wt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Da.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Hu.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Hu.REQUEST_CONSTRAINTS)}},Hn(jn.prototype,"play",[cq,uq],Object.getOwnPropertyDescriptor(jn.prototype,"play"),jn.prototype),Hn(jn.prototype,"stop",[lq],Object.getOwnPropertyDescriptor(jn.prototype,"stop"),jn.prototype),Hn(jn.prototype,"setEnabled",[dq,hq,fq],Object.getOwnPropertyDescriptor(jn.prototype,"setEnabled"),jn.prototype),Hn(jn.prototype,"setMuted",[pq,mq,gq],Object.getOwnPropertyDescriptor(jn.prototype,"setMuted"),jn.prototype),Hn(jn.prototype,"setEncoderConfiguration",[vq,_q],Object.getOwnPropertyDescriptor(jn.prototype,"setEncoderConfiguration"),jn.prototype),Hn(jn.prototype,"getStats",[yq],Object.getOwnPropertyDescriptor(jn.prototype,"getStats"),jn.prototype),Hn(jn.prototype,"setBeautyEffect",[Eq,Sq],Object.getOwnPropertyDescriptor(jn.prototype,"setBeautyEffect"),jn.prototype),Hn(jn.prototype,"getCurrentFrameData",[Tq],Object.getOwnPropertyDescriptor(jn.prototype,"getCurrentFrameData"),jn.prototype),Hn(jn.prototype,"getCurrentFrameImage",[bq],Object.getOwnPropertyDescriptor(jn.prototype,"getCurrentFrameImage"),jn.prototype),Hn(jn.prototype,"setBitrateLimit",[wq],Object.getOwnPropertyDescriptor(jn.prototype,"setBitrateLimit"),jn.prototype),Hn(jn.prototype,"setOptimizationMode",[Cq],Object.getOwnPropertyDescriptor(jn.prototype,"setOptimizationMode"),jn.prototype),Hn(jn.prototype,"setScalabiltyMode",[Rq],Object.getOwnPropertyDescriptor(jn.prototype,"setScalabiltyMode"),jn.prototype),Hn(jn.prototype,"updateMediaStreamTrackResolution",[Iq],Object.getOwnPropertyDescriptor(jn.prototype,"updateMediaStreamTrackResolution"),jn.prototype),Hn(jn.prototype,"pipe",[Aq],Object.getOwnPropertyDescriptor(jn.prototype,"pipe"),jn.prototype),Hn(jn.prototype,"unpipe",[kq],Object.getOwnPropertyDescriptor(jn.prototype,"unpipe"),jn.prototype),Hn(jn.prototype,"close",[Oq],Object.getOwnPropertyDescriptor(jn.prototype,"close"),jn.prototype),Hn(jn.prototype,"replaceTrack",[Pq],Object.getOwnPropertyDescriptor(jn.prototype,"replaceTrack"),jn.prototype),jn),VM=(Nq=zt({argsMap:(n,i)=>[n.getTrackId(),i]}),Dq=Mi(),Lq=$E("CameraVideoTrack","_enabledMutex"),xq=zt({argsMap:(n,i)=>[n.getTrackId(),i]}),Mq=Mi(),Uq=zt({argsMap:(n,i)=>[n.getTrackId(),i]}),Vq=Mi(),Fq=zt({argsMap:n=>[n.getTrackId()]}),Xu=class _ue extends qr{get __className__(){return"CameraVideoTrack"}constructor(i,s,c,l,h,p){super(i,Bh(s.encoderConfig),l,h,p),Oe(this,"_config",void 0),Oe(this,"_originalConstraints",void 0),Oe(this,"_constraints",void 0),Oe(this,"_enabled",!0),Oe(this,"_deviceName","default"),Oe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(HE()||rM())&&!function(){const v=zn();if(v.os!==ws.IOS||!v.osVersion)return!1;const y=v.osVersion.split(".");return Number(y[0])===15&&Number(y[1])>=2}()&&p9()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=c,this._constraints=c,this._deviceName=i.label,this._encoderConfig=Bh(this._config.encoderConfig),yr.on(Xs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),yr.on(Xs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(i){return typeof i=="string"?this._setDeviceById(i):i.deviceId?this._setDeviceById(i.deviceId):i.facingMode?this._setDeviceByFacingModel(i.facingMode):void 0}async _setDeviceById(i){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(i)),this._enabled)try{const s=await $u.getDeviceById(i),c={};c.video=ri({},this._constraints),c.video.deviceId={exact:i},c.video.facingMode=void 0,this._originMediaStreamTrack.stop();let l=null;try{l=await qu(c,this.getTrackId())}catch(h){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),h.toString()),l=await qu({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),h}await this._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=i,this._constraints.deviceId={exact:i}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await $u.getDeviceById(i);this._deviceName=s.label,this._config.cameraId=i,this._constraints.deviceId={exact:i}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(i){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(i));const s={video:ri(ri({},this._constraints),{},{deviceId:void 0,facingMode:{exact:i}})};if(this._enabled){this._originMediaStreamTrack.stop();let c=null;try{c=await qu(s,this.getTrackId())}catch(l){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),l.toString()),c=await qu({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=i,this._config.cameraId=void 0,this._constraints=ri({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(i,s){if(!s){if(i===this._enabled)return;this.stateCheck("enabled",i)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),i),i){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const c=await qu({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1)}await Pr(this,wt.NEED_ENABLE_TRACK,this)}catch(c){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),c.toString()),c}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await Pr(this,wt.NEED_DISABLE_TRACK,this)}catch(c){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),c.toString()),c}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(i,s){if(!this._enabled)throw new Fe(ie.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");i=Bh(i),this._forceBitrateLimit&&(i.bitrateMax=this._forceBitrateLimit.max_bitrate||i.bitrateMax,i.bitrateMin=this._forceBitrateLimit.min_bitrate||i.bitrateMin);const c=yi(this._config);c.encoderConfig=i;const l=Yk(c);(uo()||Na()||sd())&&(l.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(l));try{await this._originMediaStreamTrack.applyConstraints(l),this.updateMediaStreamTrackResolution()}catch(h){const p=new Fe(ie.UNEXPECTED_ERROR,h.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),p.toString()),p}this._config=c,this._constraints=l,this._originalConstraints=l,this._encoderConfig=i,this._hints.indexOf(Dr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Pr(this,wt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(h){return h.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Na()||sd())&&this._enabled&&!this._isClosed&&yr.duringInterruption){const i=async()=>{yr.off(Xs.IOS_INTERRUPTION_END,i),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};yr.on(Xs.IOS_INTERRUPTION_END,i)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(eS.TRACK_ENDED)}async renewMediaStreamTrack(i){const s=i||this._constraints,c=$u.searchDeviceIdByName(this._deviceName);if(c&&!s.deviceId&&(s.deviceId={exact:c}),this._enabled){const l=await qu({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),yr.off(Xs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),yr.off(Xs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(i){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],c=this._encoderConfig;i&&(c=ri(ri({},c),Bh(i))),c=e_(c);const l=Nr(8,"track-cam-cloned-"),h=new _ue(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,e_(ri(ri({},this._config),{},{encoderConfig:c})),e_(this._constraints),e_(this._scalabilityMode),this._optimizationMode,l);return i&&c&&h.setEncoderConfiguration(c),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(s)),h}bindProcessorContextEvents(){this.processorContext.on(Hu.REQUEST_UPDATE_CONSTRAINTS,async(i,s,c)=>{try{const l=Object.assign({},this._originalConstraints,...i);await this.renewMediaStreamTrack(l),s()}catch(l){c(l)}}),this.processorContext.on(Hu.REQUEST_CONSTRAINTS,async i=>{i(this._originMediaStreamTrack.getSettings())})}},Hn(Xu.prototype,"setDevice",[Nq,Dq],Object.getOwnPropertyDescriptor(Xu.prototype,"setDevice"),Xu.prototype),Hn(Xu.prototype,"setEnabled",[Lq,xq,Mq],Object.getOwnPropertyDescriptor(Xu.prototype,"setEnabled"),Xu.prototype),Hn(Xu.prototype,"setEncoderConfiguration",[Uq,Vq],Object.getOwnPropertyDescriptor(Xu.prototype,"setEncoderConfiguration"),Xu.prototype),Hn(Xu.prototype,"close",[Fq],Object.getOwnPropertyDescriptor(Xu.prototype,"close"),Xu.prototype),Xu);function FM(n,i,s,c){s.optimizationMode&&(c&&c.width&&c.height?(s.encoderConfig=ri(ri({},c),{},{bitrateMin:c.bitrateMin,bitrateMax:c.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(i.contentHint=s.optimizationMode,i.contentHint===s.optimizationMode?x.debug("[".concat(n,"] set content hint to"),s.optimizationMode):x.debug("[".concat(n,"] set content hint failed")))):x.warning("[".concat(n,"] can not apply optimization mode bitrate config, no encoderConfig")))}var jq,Bq,Wq,zq,Il,Gq,Hq,Kq,qq,$q,Yq,pa;class Xq extends nK{getUserId(){return this._userId}constructor(i,s,c,l){super(i,"track-".concat(i.kind,"-").concat(s,"-").concat(l.clientId,"_").concat(Nr(5,""))),Oe(this,"_userId",void 0),Oe(this,"_uintId",void 0),Oe(this,"_isDestroyed",!1),Oe(this,"store",void 0),Oe(this,"processor",void 0),Oe(this,"processorContext",void 0),this._userId=s,this._uintId=c,this.store=l}_updateOriginMediaStreamTrack(i){this._originMediaStreamTrack=i,this._mediaStreamTrack=i,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let oS=(jq=zt({argsMap:(n,i,s)=>[n.getTrackId(),typeof i=="string"?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),Bq=zt({argsMap:n=>[n.getTrackId()]}),Wq=zt({argsMap:(n,i)=>[n.getTrackId(),i.name]}),zq=zt({argsMap:n=>[n.getTrackId()]}),Hn((Il=class extends Xq{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==fa.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(n,i,s,c){super(n,i,s,c),Oe(this,"_videoVisibleTimer",null),Oe(this,"_previousVideoVisibleStatus",void 0),Oe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Oe(this,"trackMediaType",nS.VIDEO),Oe(this,"_videoWidth",void 0),Oe(this,"_videoHeight",void 0),Oe(this,"_player",void 0),Oe(this,"processorDestination",void 0),Oe(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new pK(this.getTrackId(),"remote"),this.processorDestination=new fK(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Bm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Bu(this,wt.GET_STATS)||ri({},eK)}play(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof n=="string"){const c=document.getElementById(n);c?n=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=ri(ri({fit:"cover"},i),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(s):(n instanceof HTMLVideoElement?this._player=new UM(s):this._player=new aq(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(tS.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=c=>{this.safeEmit(tS.VIDEO_STATE_CHANGED,c)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(tS.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},le("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){vK(this._originMediaStreamTrack).then(n=>{let[i,s]=n;this._videoHeight=s,this._videoWidth=i}).catch(Vk)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var n,i;const s=this==null||(n=this._player)===null||n===void 0?void 0:n.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:l,slot:h}=c;if(this.isPlaying&&l instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=_9.checkOneElementVisible(l),v=Object.assign({},p);if(v.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=v.visible;const y=kt.reportApiInvoke(null,{tag:_i.TRACER,name:is.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});v.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(v.reason))}return v}return}catch(s){throw new Fe(ie.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(n){if(this.processor===n)return n;if(n._source)throw new Fe(ie.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Da.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Da.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(n){this.emit(i_.SEI_RECEIVED,n)}}).prototype,"play",[jq],Object.getOwnPropertyDescriptor(Il.prototype,"play"),Il.prototype),Hn(Il.prototype,"stop",[Bq],Object.getOwnPropertyDescriptor(Il.prototype,"stop"),Il.prototype),Hn(Il.prototype,"pipe",[Wq],Object.getOwnPropertyDescriptor(Il.prototype,"pipe"),Il.prototype),Hn(Il.prototype,"unpipe",[zq],Object.getOwnPropertyDescriptor(Il.prototype,"unpipe"),Il.prototype),Il),aS=(Gq=zt({argsMap:(n,i)=>[n.getTrackId(),i],throttleTime:300}),Hq=zt({argsMap:(n,i)=>[n.getTrackId(),i]}),Kq=zt({argsMap:n=>[n.getTrackId()]}),qq=zt({argsMap:n=>[n.getTrackId()]}),$q=zt({argsMap:(n,i)=>[n.getTrackId(),i.name]}),Yq=zt({argsMap:n=>[n.getTrackId()]}),Hn((pa=class extends Xq{get isPlaying(){return this._useAudioElement?nc.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(n,i,s,c){super(n,i,s,c),Oe(this,"trackMediaType",nS.AUDIO),Oe(this,"_source",void 0),Oe(this,"_useAudioElement",!0),Oe(this,"_volume",100),Oe(this,"processorContext",void 0),Oe(this,"processorDestination",void 0),Oe(this,"_played",!1),Oe(this,"_bypassWebAudio",!1),le("DISABLE_WEBAUDIO")?(this._source=new xM,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new oK(n,!0),le("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Gu.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(tS.FIRST_FRAME_DECODED)}),this.processorContext=new gK(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new mK(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Gu.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!n)return this._source.removeAllListeners(Gu.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(Gu.ON_AUDIO_BUFFER),this._source.on(Gu.ON_AUDIO_BUFFER,s=>n(s))}setVolume(n){this._volume=n,this._useAudioElement?nc.setVolume(this.getTrackId(),n):this._source.setVolume(n/100)}async setPlaybackDevice(n){if(!this._useAudioElement||!X9())throw new Fe(ie.NOT_SUPPORTED,"your browser does not support setting the audio output device");await nc.setSinkID(this.getTrackId(),n)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Bm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Bu(this,wt.GET_STATS)||ri({},Z9)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),nc.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?nc.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let n=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&nc.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(n){if(this._bypassWebAudio)throw new Fe(ie.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===n)return n;if(n._source)throw new Fe(ie.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(this._bypassWebAudio)throw new Fe(ie.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const i=this.processor;(n=this._source.processSourceNode)===null||n===void 0||n.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Da.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(n)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Da.ON_NODE,n=>{this._source.processedNode=n;const i=!n;this._useAudioElement!==i&&(this._played?(this.stop(),this._useAudioElement=i,this.play()):this._useAudioElement=i)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Da.ON_TRACK),this.processorDestination.removeAllListeners(Da.ON_NODE)}}).prototype,"setVolume",[Gq],Object.getOwnPropertyDescriptor(pa.prototype,"setVolume"),pa.prototype),Hn(pa.prototype,"setPlaybackDevice",[Hq],Object.getOwnPropertyDescriptor(pa.prototype,"setPlaybackDevice"),pa.prototype),Hn(pa.prototype,"play",[Kq],Object.getOwnPropertyDescriptor(pa.prototype,"play"),pa.prototype),Hn(pa.prototype,"stop",[qq],Object.getOwnPropertyDescriptor(pa.prototype,"stop"),pa.prototype),Hn(pa.prototype,"pipe",[$q],Object.getOwnPropertyDescriptor(pa.prototype,"pipe"),pa.prototype),Hn(pa.prototype,"unpipe",[Yq],Object.getOwnPropertyDescriptor(pa.prototype,"unpipe"),pa.prototype),pa);const hp=new class extends li{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Oe(this,"_lastHiddenTime",0),Oe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Jq extends li{constructor(i,s){super(),Oe(this,"trackMediaType",nS.DATA),Oe(this,"_version",1),Oe(this,"_type",3),Oe(this,"_config",void 0),Oe(this,"_originDataChannel",void 0),Oe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Oe(this,"_dataStreamPacketHandler",{serialize:c=>c,deserialize:c=>c}),Oe(this,"_datachannelEventMap",new Map),this._config=i,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(i){this._dataStreamPacketHandler=i}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return le("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var i,s;return(i=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&i!==void 0?i:"connecting"}get _originDataChannelId(){var i,s;return(i=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&i!==void 0?i:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new pt((i,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&i();const c=setTimeout(()=>{var l;s(new Fe(ie.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((l=this._originDataChannel)===null||l===void 0?void 0:l.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(c),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),i()},this._originDataChannel.onerror=()=>{throw clearTimeout(c),new Fe(ie.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Fe(ie.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(i){this._originDataChannel=i,this._bandDataChannelEvents(i)}_initPacketHeader(){const i=new DataView(this._dataStreamPacketHeader);i.setUint16(0,this._version),i.setUint8(2,this._type),i.setUint8(3,this._config.id)}_bandDataChannelEvents(i){this._unbindDataChannelEvents(i),[qk.OPEN,qk.CLOSE,qk.ERROR].forEach(s=>{const c=()=>{this.emit(s)};this._datachannelEventMap.set(s,c),i.addEventListener(s,c)})}_unbindDataChannelEvents(i){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[c,l]=s;i.removeEventListener(c,l)}),this._datachannelEventMap.clear()}}class EEe extends Jq{constructor(i){super(i),Oe(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const c=s.data.slice(0,this._dataStreamPacketHeader.byteLength),l=new DataView(c).getUint8(3);if(l!==this.id)return void(le("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(l," !== ").concat(this.id)));let h=s.data.slice(this._dataStreamPacketHeader.byteLength);h=this._dataStreamPacketHandler.deserialize(h),this.emit(qk.MESSAGE,h)}}_updateOriginDataChannel(i){super._updateOriginDataChannel(i),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class SEe extends Jq{send(i){if(this._originDataChannel){let s=i;s=this._dataStreamPacketHandler.serialize(i);const c=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);c.set(new Uint8Array(this._dataStreamPacketHeader),0),c.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(c.buffer)}}}function Jk(){const n=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>JA.revokeObjectURL(n),0),new Worker(JA.createObjectURL(n))}const Qq=71,jM=1,BM=2,WM=1,Zq=2;var fp=function(n){return n[n.AUDIO_LEVEL=1]="AUDIO_LEVEL",n[n.METADATA=2]="METADATA",n[n.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",n}(fp||{});function e3(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=n.getUint8(0);if(s!==Qq)return;const c=n.getUint16(1),l=jM+BM+c,h=new Uint8Array(n.byteLength-l);h.set(new Uint8Array(n.buffer,l,n.byteLength-l));const p={m:s,tlvLen:c,tlv:[],frame:h};let v=jM+BM;for(;v<l;){const y=n.getUint8(v),S=n.getUint16(v+WM),b=WM+Zq;if(y===fp.AUDIO_LEVEL){let R=n.getUint8(v+b);for(let O=1;O<S;O++)R=R<<8|n.getUint8(v+b+O);p.tlv.push({tag:y,length:S,value:i?127^R>>1:127&R})}else if(y===fp.METADATA||y===fp.AUDIO_64_BIT_PTS){const R=new Uint8Array(S);for(let O=0;O<S;O++)R[O]=n.getUint8(v+b+O);p.tlv.push({tag:y,length:S,value:R})}v+=b+S}return p}const Qk=new Map,Zk=127,a_=1e-10,zM=139/13,eO=new Map;function GM(n,i,s){const c="".concat(n,"-").concat(i,"-").concat(s);let l=0;return eO.has(c)?l=eO.get(c):(l=Math.log(function(p,v){const y=p-v;v<y&&(v=y);let S=1;for(let b=p,R=1;b>v;b--,R++)S=S*b/R;return S}(i,n))+n*Math.log(.5)+(i-n)*Math.log(1-.5)-Math.log(s)+s*n,eO.set(c,l)),l<a_&&(l=a_),l}function t3(n,i,s){const c=i.length,l=n.length/c;let h=!1;for(let p=0,v=0;p<c;p++){let y=0;for(let S=v+l;v<S;v++)n[v]>s&&y++;i[p]!==y&&(i[p]=y,h=!0)}return h}window.cache=eO;let TEe=0;class n3{constructor(i){Oe(this,"id",void 0),Oe(this,"immediates",[]),Oe(this,"lastNonSilence",-1),Oe(this,"immediateSpeechActivityScore",a_),Oe(this,"lastLevelChangedTime",Date.now()),Oe(this,"levels",[]),Oe(this,"longs",[]),Oe(this,"longSpeechActivityScore",a_),Oe(this,"mediums",[]),Oe(this,"mediumSpeechActivityScore",a_),Oe(this,"minLevel",0),Oe(this,"nextMinLevel",0),Oe(this,"nextMinLevelWindowLength",0),Oe(this,"energyScore",0),this.id=i||"".concat(TEe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const i=this.immediates,s=this.levels,c=this.minLevel+zM;let l=!1;for(let h=0;h<i.length;++h){let p=s[h];p<c&&(p=0);const v=Math.floor(p/zM);i[h]!==v&&(i[h]=v,l=!0)}return l}computeLongs(){return t3(this.mediums,this.longs,4)}computeMediums(){return t3(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=GM(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(i){this.longSpeechActivityScore=GM(this.longs[0],10,47),this.longSpeechActivityScore>a_&&(this.lastNonSilence=i)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=GM(this.mediums[0],5,24)}evaluateSpeechActivityScores(i){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(i)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var i;return"[".concat(pm(i=[...this.levels]).call(i).join(),"]")}getSpeechActivityScore(i){switch(i){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+i)}}levelChanged(i,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let c=i;return i<0&&(c=0),i>Zk&&(c=Zk),this.levels.unshift(c),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(c),c>=this.minLevel+zM?c:c/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(i){if(i!==0){if(this.minLevel===0||this.minLevel>i)return this.minLevel=i,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=i,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>i&&(this.nextMinLevel=i),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>Zk&&(s=Zk),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class bEe{constructor(i){Oe(this,"algorithm",void 0),this.algorithm=i}execute(){let i=!this.algorithm;if(!i)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?i=!0:setTimeout(this.execute.bind(this),s)}catch{i=!0}i&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class HM{constructor(i,s,c){Oe(this,"isDominant",void 0),Oe(this,"energyRanking",void 0),Oe(this,"energyScore",void 0),this.isDominant=i,this.energyRanking=s,this.energyScore=c}}class wEe extends li{constructor(i){super(),Oe(this,"dominantId",null),Oe(this,"lastDecisionTime",0),Oe(this,"lastLevelChangedTime",0),Oe(this,"lastLevelIdleTime",0),Oe(this,"relativeSpeechActivities",[]),Oe(this,"speakers",new Map),Oe(this,"enableSilence",!1),Oe(this,"timeoutToSilenceInterval",0),Oe(this,"decisionMaker",null),Oe(this,"loudest",[]),Oe(this,"numLoudestToTrack",3),Oe(this,"energyExpireTimeMs",250),Oe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=i,this.enableSilence=i>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=i,s!=null&&(this.energyExpireTimeMs=s),c!=null&&(this.energyAlphaPct=c),this.loudest.length>i&&this.loudest.splice(i)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(i){return this.loudest.some(s=>s.id===i)}levelChanged(i,s){const c=Date.now(),l=this.getOrCreateSpeaker(i);this.lastLevelChangedTime<c&&(this.lastLevelChangedTime=c,this.maybeStartDecisionMaker());const h=l.levelChanged(s,c);return this.updateLoudestList(l,h,c)}runInDecisionMaker(i){return this.decisionMaker!==i||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(i){this.decisionMaker===i&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(i){i.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(i){i.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(i){let s=this.speakers.get(i);return s||(s=new n3(i),this.speakers.set(i,s),this.maybeStartDecisionMaker()),s}updateLoudestList(i,s,c){const l=i.id===this.dominantId;if(s<0){let y=0;for(;y<this.loudest.length&&this.loudest[y]!==i;)++y;return new HM(l,y,i.energyScore)}if(i.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*i.energyScore+50)/100),this.numLoudestToTrack===0)return new HM(l,0,i.energyScore);const h=c-this.energyExpireTimeMs;let p=0;for(;p<this.loudest.length;){const y=this.loudest[p];if(y.getLastLevelChangedTime()<h&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(p,1);else if(y.id!==i.id)++p;else if(this.loudest.splice(p,1),this.loudest.length<this.numLoudestToTrack)break}let v=0;for(;v<this.loudest.length&&!(this.loudest[v].energyScore<i.energyScore);)++v;return v<this.numLoudestToTrack&&(this.loudest.splice(v,0,i),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new HM(l,v,i.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new bEe(this),this.decisionMaker.execute())}makeDecision(i){let s=null,c=null;const l=this.speakers.size;let h=null;if(l===0)h=null;else if(l===1){var p;const v=Fu(p=this.speakers).call(p).next().value;this.enableSilence&&v&&(h=v.id,v.evaluateSpeechActivityScores(i),i-v.lastNonSilence>this.timeoutToSilenceInterval&&(h=null))}else{let v=this.dominantId==null?null:this.speakers.get(this.dominantId);if(v==null){const b=this.speakers.entries().next();b.value&&(h=b.value[0],v=b.value[1])}else h=v.id;v!=null&&v.evaluateSpeechActivityScores(i);const y=this.relativeSpeechActivities;let S=2;for(const b of this.speakers.entries()){const[R,O]=b;if(O===v)continue;O.evaluateSpeechActivityScores(i);for(let H=0;H<y.length;++H){const ne=v==null?a_:v.getSpeechActivityScore(H);y[H]=Math.log(O.getSpeechActivityScore(H)/ne)}const N=y[0],Y=y[1],W=y[2];N>3&&Y>2&&W>0&&Y>S&&(S=Y,h=R)}this.enableSilence&&v!=null&&h===v.id&&i-v.lastNonSilence>this.timeoutToSilenceInterval&&(h=null)}h==null&&!this.enableSilence||h===this.dominantId||(s=this.dominantId,this.dominantId=h,c=this.dominantId),c==null&&!this.enableSilence||c===s||this.emit("ActiveSpeakerChanged",c)}_runInDecisionMaker(){const i=Date.now(),s=300-(i-this.lastLevelIdleTime);let c=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(i),this.lastLevelIdleTime=i):c=s;let l=300-(i-this.lastDecisionTime);return l<=0&&(this.lastDecisionTime=i,this.makeDecision(i),l=300-(Date.now()-i)),l>0&&c>l&&(c=l),c}timeoutIdleLevels(i){const s=[];for(const l of Fu(c=this.speakers).call(c)){var c;const h=i-l.getLastLevelChangedTime();36e5<h&&(this.dominantId==null||l.id!==this.dominantId)?s.push(l.id):300<h&&l.levelTimedOut()}s.forEach(l=>this.speakers.delete(l))}}const cS=new Map;let Zd=null,tO=null;const r3=3;let c_=[];const eh=new Map,nO=new Map;class CEe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(i,s){Oe(this,"id",void 0),Oe(this,"track",void 0),Oe(this,"score",0),Oe(this,"active",!0),Oe(this,"muted",!1),Oe(this,"timer",0),Oe(this,"actives",0),Oe(this,"inactives",0),this.id=i,this.track=s,this.setActive(eh.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const i=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:c}=function(){const l=[],h=[];return Array.from(Fu(eh).call(eh)).forEach(p=>{p.active?l.push(p):h.push(p)}),{actives:l,inactives:h}}();if(s.length>3){let l;s.forEach(h=>{(!l||l.score>h.score)&&(l=h)}),l&&l.setActive(!1)}if(s.length<3&&c.length>0){let l;c.forEach(h=>{(!l||l.score<h.score)&&h.id!==this.id&&(l=h)}),l&&i&&!this.active&&(l.samples>40&&l.activeRate-this.activeRate>.4?l.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(i){this.active=i,this.resetTimer(),this.setMuted(!i)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const i=function(s){let c;return Array.from(Fu(eh).call(eh)).forEach(l=>{!l.active||l.id===s||l.samples<40||(!c||l.score<c.score)&&(c=l)}),c}(this.id);i&&this.activeRate-i.activeRate>.4&&(i.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const i=function(s){let c;return Array.from(Fu(eh).call(eh)).forEach(l=>{l.active||l.id===s||l.samples<40||(!c||l.score>c.score)&&(c=l)}),c}(this.id);i&&i.activeRate-this.activeRate>.4&&(i.setActive(!0),this.setActive(!1))}addSample(i){i?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(i){this.track&&(this.track.enabled=!i,this.muted=i)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let rO;function i3(n){const i=eh.get(n);i&&(eh.delete(n),i.clearTimer())}const iO=new Map,REe=new Map;function IEe(n,i,s){let c=new Uint8Array(n,i,s),l=[],h=0;for(;l.length<s;)h+3<s&&c[h]===0&&c[h+1]===0&&c[h+2]===3&&(c[h+3]===0||c[h+3]===1||c[h+3]===2||c[h+3]===3)?(l.push(c[h],c[h+1],c[h+3]),h+=4):(l.push(c[h]),h++);return new Uint8Array(l)}const sO=new Map,Gb=new Map;(function(){const n=zn();Ys.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ys.getStreamFromExtension=n.name===nr.CHROME&&Number(n.version)>34,Ys.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const i=new RTCPeerConnection;let s=!1;try{i.addTransceiver("audio"),s=!0}catch{}return i.close(),s}(),Ys.supportMinBitrate=n.name===nr.CHROME||n.name===nr.EDGE,Ys.supportSetRtpSenderParameters=function(){const i=zn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!up()||!(!uo()&&!Lk())||i.name===nr.FIREFOX&&Number(i.version)>=64)}(),n.name===nr.SAFARI&&(Number(n.version)>=14?Ys.supportDualStream=!0:Ys.supportDualStream=!1),Ys.webAudioMediaStreamDest=function(){const i=zn();return!(i.name===nr.SAFARI&&Number(i.version)<12)}(),Ys.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ys.supportWebGL=typeof WebGLRenderingContext<"u",Ys.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,up()||(Ys.webAudioWithAEC=!0),Ys.supportShareAudio=function(){const i=zn();return(i.os===ws.WIN_10||i.os===ws.WIN_81||i.os===ws.WIN_7||i.os===ws.LINUX||i.os===ws.MAC_OS||i.os===ws.CHROMIUM_OS)&&i.name===nr.CHROME&&Number(i.version)>=74}(),Ys.supportDataChannel=!!(Db(76)||function(i){const s=zn();return!(s.name!==nr.FIREFOX||!s.osVersion)&&Number(s.version)>=i}(68)||u9(14)),Ys.supportPCSetConfiguration=function(){const i=window.RTCPeerConnection;return!gi()&&!!i&&i.prototype.setConfiguration instanceof Function}(),Ys.supportWebRTCEncodedTransform=function(){const i=zn();return i.name==="Chrome"&&Number(i.version)>=87||i.name==="Safari"&&Number(i.version)>=15}(),Ys.supportWebRTCInsertableStream=function(){const i=zn();return(i.name===nr.CHROME||i.name===nr.EDGE)&&Number(i.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ys.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ys.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Uk(()=>{Ys.supportDualStreamEncoding=function(){const i=zn();return!!le("DISABLE_WEBAUDIO")||i.name==="Safari"&&Number(i.version)>=14||!!(i.name==="Chrome"&&/Windows/i.test(i.os||"")&&Number(i.version)>=100&&le("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",n),x.info("browser compatibility: ",Ys)})})();const AEe=["CHINA","GLOBAL"],s3=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],u_=[],uS=[];function l_(n,i){return!!i&&u_.some(s=>s.uid===n&&s.channelName===i)}function KM(){return uS.length>0}var kEe=IG.forEach,o3=Ff("forEach")?[].forEach:function(n){return kEe(this,n,arguments.length>1?arguments[1]:void 0)};cn({target:"Array",proto:!0,forced:[].forEach!=o3},{forEach:o3});var OEe=tu("Array").forEach,PEe=ku,NEe=Ti,DEe=I,LEe=OEe,qM=Array.prototype,xEe={DOMTokenList:!0,NodeList:!0},MEe=function(n){var i=n.forEach;return n===qM||DEe(qM,n)&&i===qM.forEach||NEe(xEe,PEe(n))?LEe:i},UEe=a(MEe),VEe=Lo,a3=Nu;cn({target:"Object",stat:!0,forced:u(function(){a3(1)})},{keys:function(n){return a3(VEe(n))}});var c3=a(ct.Object.keys),FEe=a(Dy),jEe=a(xy),BEe=cn,u3=ov,WEe=Ov,zEe=at,l3=ye,GEe=Ki,HEe=Ae,KEe=FA,qEe=fr,$Ee=Ts,YEe=vG("slice"),XEe=qEe("species"),$M=Array,JEe=Math.max;BEe({target:"Array",proto:!0,forced:!YEe},{slice:function(n,i){var s,c,l,h=HEe(this),p=GEe(h),v=l3(n,p),y=l3(i===void 0?p:i,p);if(u3(h)&&(s=h.constructor,(WEe(s)&&(s===$M||u3(s.prototype))||zEe(s)&&(s=s[XEe])===null)&&(s=void 0),s===$M||s===void 0))return $Ee(h,v,y);for(c=new(s===void 0?$M:s)(JEe(y-v,0)),l=0;v<y;v++,l++)v in h&&KEe(c,l,h[v]);return c.length=l,c}});var QEe=tu("Array").slice,ZEe=I,eSe=QEe,YM=Array.prototype,tSe=function(n){var i=n.slice;return n===YM||ZEe(YM,n)&&i===YM.slice?eSe:i},nSe=a(tSe);function Ct(n,i,s,c,l){var h,p,v,y={};return UEe(h=c3(c)).call(h,function(S){y[S]=c[S]}),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=FEe(p=jEe(v=nSe(s).call(s)).call(v)).call(p,function(S,b){return b(n,i,S)||S},y),l&&y.initializer!==void 0&&(y.value=y.initializer?y.initializer.call(l):void 0,y.initializer=void 0),y.initializer===void 0&&(fG(n,i,y),y=null),y}let oO=function(n){return n[n.ACCESS_POINT=101]="ACCESS_POINT",n[n.UNILBS=201]="UNILBS",n[n.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",n}({}),XM=function(n){return n[n.IIIEGAL_APPID=1]="IIIEGAL_APPID",n[n.IIIEGAL_UID=2]="IIIEGAL_UID",n[n.INTERNAL_ERROR=3]="INTERNAL_ERROR",n}({}),cd=function(n){return n[n.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",n[n.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",n[n.INTERNAL_ERROR=8]="INTERNAL_ERROR",n[n.NO_AUTHORIZED=9]="NO_AUTHORIZED",n[n.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",n[n.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",n[n.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",n[n.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",n[n.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",n[n.USER_OVERLOAD=16]="USER_OVERLOAD",n[n.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",n[n.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",n}({}),La=function(n){return n[n.NO_FLAG_SET=100]="NO_FLAG_SET",n[n.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",n[n.INVALID_FALG_SET=102]="INVALID_FALG_SET",n[n.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",n[n.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",n[n.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",n[n.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",n[n.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",n[n.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",n[n.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",n[n.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",n[n.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",n[n.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",n[n.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",n[n.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",n[n.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",n[n.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",n[n.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",n[n.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",n}({}),Bt=function(n){return n[n.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",n[n.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",n[n.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",n[n.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",n[n.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",n[n.K_TICKET_INVALID=7]="K_TICKET_INVALID",n[n.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",n[n.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",n[n.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",n[n.K_UID_BANNED=14]="K_UID_BANNED",n[n.K_IP_BANNED=15]="K_IP_BANNED",n[n.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",n[n.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",n[n.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",n[n.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",n[n.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",n[n.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",n[n.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",n[n.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",n[n.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",n[n.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",n[n.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",n[n.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",n[n.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",n[n.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",n[n.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",n[n.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",n[n.ERR_INVALID_UID=117]="ERR_INVALID_UID",n[n.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",n[n.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",n[n.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",n[n.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",n[n.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",n[n.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",n[n.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",n[n.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",n[n.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",n[n.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",n[n.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",n[n.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",n[n.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",n[n.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",n[n.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",n[n.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",n[n.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",n[n.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",n[n.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",n[n.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",n[n.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",n[n.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",n[n.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",n[n.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",n[n.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",n[n.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",n[n.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",n[n.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",n[n.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",n[n.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",n[n.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",n[n.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",n[n.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",n[n.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",n[n.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",n[n.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",n[n.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",n}({}),Fr=function(n){return n.CONNECTING="connecting",n.CONNECTED="connected",n.RECONNECTING="reconnecting",n.CLOSED="closed",n}({}),en=function(n){return n.WS_CONNECTED="ws_connected",n.WS_RECONNECTING="ws_reconnecting",n.WS_CLOSED="ws_closed",n.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",n.ON_BINARY_DATA="on_binary_data",n.REQUEST_RECOVER="request_recover",n.REQUEST_JOIN_INFO="request_join_info",n.REQUEST_REJOIN_INFO="req_rejoin_info",n.IS_P2P_DISCONNECTED="is_p2p_dis",n.DISCONNECT_P2P="dis_p2p",n.ABORT_P2P_EXECUTION="abort_p2p_execution",n.NEED_RENEW_SESSION="need-sid",n.REPORT_JOIN_GATEWAY="report_join_gateway",n.REQUEST_TIMEOUT="request_timeout",n.REQUEST_SUCCESS="request_success",n.JOIN_RESPONSE="join_response",n.PRE_CONNECT_PC="pre_connect_pc",n.P2P_CONNECTION="p2p_connection",n.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",n.P2P_SUBSCRIBE="p2p_subscribe",n.P2P_UNSUBSCRIBE="p2p_unsubscribe",n.P2P_EXCHANGE_SDP="p2p_exchange_sdp",n.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",n.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",n.RECOVER_NOTIFICATION="recover_notification",n}({}),Jt=function(n){return n.PING="ping",n.PING_BACK="ping_back",n.JOIN="join_v3",n.REJOIN="rejoin_v3",n.LEAVE="leave",n.SET_CLIENT_ROLE="set_client_role",n.PUBLISH="publish",n.PUBLISH_DATASTREAM="publish_datastream",n.UNPUBLISH="unpublish",n.UNPUBLISH_DATASTREAM="unpublish_datastream",n.SUBSCRIBE="subscribe",n.PRE_SUBSCRIBE="pre_subscribe",n.SUBSCRIBE_DATASTREAM="subscribe_datastream",n.SUBSCRIBE_STREAMS="subscribe_streams",n.UNSUBSCRIBE="unsubscribe",n.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",n.UNSUBSCRIBE_STREAMS="unsubscribe_streams",n.SUBSCRIBE_CHANGE="subscribe_change",n.TRAFFIC_STATS="traffic_stats",n.RENEW_TOKEN="renew_token",n.SWITCH_VIDEO_STREAM="switch_video_stream",n.DEFAULT_VIDEO_STREAM="default_video_stream",n.SET_FALLBACK_OPTION="set_fallback_option",n.GATEWAY_INFO="gateway_info",n.CONTROL="control",n.SEND_METADATA="send_metadata",n.DATA_STREAM="data_stream",n.PICK_SVC_LAYER="pick_svc_layer",n.RESTART_ICE="restart_ice",n.CONNECT_PC="connect_pc",n.SET_VIDEO_PROFILE="set_video_profile",n.SET_PARAMETER="set_parameter",n.SET_RTM2_FLAG="set_rtm2_flag",n}({}),Hb=function(n){return n.WRTC_STATS="wrtc_stats",n.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",n.DENOISER_STATS="denoiser_stats",n.EXTENSION_USAGE_STATS="extension_usage_stats",n}({}),Pn=function(n){return n.ON_USER_ONLINE="on_user_online",n.ON_USER_OFFLINE="on_user_offline",n.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",n.ON_PUBLISH_STREAM="on_publish_stream",n.ON_UPLINK_STATS="on_uplink_stats",n.ON_P2P_LOST="on_p2p_lost",n.ON_REMOVE_STREAM="on_remove_stream",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",n.ON_USER_BANNED="on_user_banned",n.ON_USER_LICENSE_BANNED="on_user_license_banned",n.ON_NOTIFICATION="on_notification",n.ON_CRYPT_ERROR="on_crypt_error",n.MUTE_AUDIO="mute_audio",n.MUTE_VIDEO="mute_video",n.UNMUTE_AUDIO="unmute_audio",n.UNMUTE_VIDEO="unmute_video",n.ON_P2P_OK="on_p2p_ok",n.RECEIVE_METADATA="receive_metadata",n.ON_DATA_STREAM="on_data_stream",n.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",n.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",n.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",n.ENABLE_LOCAL_VIDEO="enable_local_video",n.DISABLE_LOCAL_VIDEO="disable_local_video",n.ENABLE_LOCAL_AUDIO="enable_local_audio",n.DISABLE_LOCAL_AUDIO="disable_local_audio",n.ON_PUBLISHED_USER_LIST="on_published_user_list",n}({}),xa=function(n){return n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY",n}({}),un=function(n){return n.CONNECTED="websocket:connected",n.RECONNECTING="websocket:reconnecting",n.WILL_RECONNECT="websocket:will_reconnect",n.CLOSED="websocket:closed",n.FAILED="websocket:failed",n.ON_MESSAGE="websocket:on_message",n.REQUEST_NEW_URLS="websocket:request_new_urls",n.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",n}({});function aO(n){if(typeof n!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(n))throw x.error("Invalid Channel Name ".concat(n)),new Pe(ie.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function cO(n){if(i=n,!(typeof i=="number"&&Math.floor(i)===i&&0<=i&&i<=4294967295||v9(n,1,255)))throw new Pe(ie.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var i;typeof n=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let pp=function(n){return n.TRANSCODE="mix_streaming",n.RAW="raw_streaming",n}({});const rSe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},JM={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function QM(n,i){qs(n.url,"".concat(i,".url"),1,1e3,!1),vi(n.x)||Tr(n.x,"".concat(i,".x"),0,1e4),vi(n.y)||Tr(n.y,"".concat(i,".y"),0,1e4),vi(n.width)||Tr(n.width,"".concat(i,".width"),0,1e4),vi(n.height)||Tr(n.height,"".concat(i,".height"),0,1e4),vi(n.zOrder)||Tr(n.zOrder,"".concat(i,".zOrder"),0,255),vi(n.alpha)||Tr(n.alpha,"".concat(i,".alpha"),0,1,!1)}const iSe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Gm=function(n){return n.WARNING="@live_uap-warning",n.ERROR="@line_uap-error",n.PUBLISH_STREAM_STATUS="@live_uap-publish-status",n.WORKER_STATUS="@live_uap-worker-status",n.REQUEST_NEW_ADDRESS="@live_uap-request-address",n}({}),ZM=function(n){return n.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",n}({}),ps=function(n){return n[n.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",n[n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",n[n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",n[n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",n[n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",n[n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",n[n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",n[n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",n[n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",n[n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",n[n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",n[n.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",n[n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",n[n.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",n[n.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",n[n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",n}({});function d3(n){if(!n.channelName)throw new Pe(ie.INVALID_PARAMS,"invalid channelName in info");if(typeof n.uid!="number")throw new Pe(ie.INVALID_PARAMS,"invalid uid in info, uid must be a number");return n.token&&qs(n.token,"info.token",1,2047),cO(n.uid),aO(n.channelName),!0}let Ma=function(n){return n[n.SetSdkProfile=0]="SetSdkProfile",n[n.SetSourceChannel=1]="SetSourceChannel",n[n.SetSourceUserId=2]="SetSourceUserId",n[n.SetDestChannel=3]="SetDestChannel",n[n.StartPacketTransfer=4]="StartPacketTransfer",n[n.StopPacketTransfer=5]="StopPacketTransfer",n[n.UpdateDestChannel=6]="UpdateDestChannel",n[n.Reconnect=7]="Reconnect",n[n.SetVideoProfile=8]="SetVideoProfile",n}({}),mp=function(n){return n.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",n.NETWORK_CONNECTED="NETWORK_CONNECTED",n.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",n.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",n.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",n.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",n.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",n.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",n.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",n.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",n}({}),Dc=function(n){return n.RELAY_STATE_IDLE="RELAY_STATE_IDLE",n.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",n.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",n.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",n}({}),lS=function(n){return n.RELAY_OK="RELAY_OK",n.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",n.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",n.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",n}({}),hr=function(n){return n.High="high",n.Low="low",n.Audio="audio",n.Screen="screen",n.ScreenLow="screen_low",n}({}),Ms=function(n){return n.DISCONNECT="disconnect",n.CONNECTION_STATE_CHANGE="connection-state-change",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGE="stream-type-change",n.IS_P2P_DISCONNECTED="is-p2p-dis",n.DISCONNECT_P2P="dis-p2p",n.REQUEST_NEW_GATEWAY_LIST="req-gate-url",n.NEED_RENEW_SESSION="need-sid",n.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",n.JOIN_RESPONSE="join-response",n.RESET_CONNECTION_EVENTS="reset-connection-events",n.PRE_CONNECT_PC="pre-connect_pc",n.UPDATE_GATEWAY_CONFIG="update-gateway-config",n}({}),uO=function(n){return n.P2P_DISCONNECTED="P2P_DISCONNECTED",n.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",n.TIMEOUT="TIMEOUT",n.UNKNOWN_REASON="UNKNOWN_REASON",n}({}),Rs=function(n){return n[n.Nothing=0]="Nothing",n[n.Audio=1]="Audio",n[n.LwoVideo=2]="LwoVideo",n[n.Video=4]="Video",n[n.Data=8]="Data",n[n.DataStream0=256]="DataStream0",n[n.DataStream1=512]="DataStream1",n[n.DataStream2=1024]="DataStream2",n[n.DataStream3=2048]="DataStream3",n[n.DataStream4=4096]="DataStream4",n[n.DataStream5=8192]="DataStream5",n[n.DataStream6=16384]="DataStream6",n[n.DataStream7=32768]="DataStream7",n}({}),rr=function(n){return n.CHINA="CHINA",n.ASIA="ASIA",n.NORTH_AMERICA="NORTH_AMERICA",n.EUROPE="EUROPE",n.JAPAN="JAPAN",n.INDIA="INDIA",n.KOREA="KOREA",n.HKMC="HKMC",n.US="US",n.OCEANIA="OCEANIA",n.SOUTH_AMERICA="SOUTH_AMERICA",n.AFRICA="AFRICA",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="EXTENSIONS",n}({});const h3=[rr.AFRICA,rr.ASIA,rr.CHINA,rr.EUROPE,rr.GLOBAL,rr.INDIA,rr.JAPAN,rr.NORTH_AMERICA,rr.OCEANIA,rr.OVERSEA,rr.SOUTH_AMERICA];let Ro=function(n){return n.CHINA="CN",n.ASIA="AS",n.NORTH_AMERICA="NA",n.EUROPE="EU",n.JAPAN="JP",n.INDIA="IN",n.KOREA="KR",n.HKMC="HK",n.US="US",n.OCEANIA="OC",n.SOUTH_AMERICA="SA",n.AFRICA="AF",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="GLOBAL",n}({});const lO={CHINA:{},ASIA:{CODE:Ro.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Ro.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Ro.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Ro.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Ro.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Ro.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Ro.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Ro.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Ro.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Ro.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Ro.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Ro.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Ro.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};EM&&(lO.CHINA={CODE:Ro.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Kb=function(n){return n.UPDATE_BITRATE_LIMIT="update_bitrate_limit",n.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",n}({});function f3(n){return!!n&&!(!n.uplink||!n.id)&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0}class p3 extends li{constructor(i,s){super(),ee(this,"onICEConnectionStateChange",void 0),ee(this,"onConnectionStateChange",void 0),ee(this,"onDTLSTransportStateChange",void 0),ee(this,"onDTLSTransportError",void 0),ee(this,"onICETransportStateChange",void 0),ee(this,"onFirstAudioReceived",void 0),ee(this,"onFirstVideoReceived",void 0),ee(this,"onFirstAudioDecoded",void 0),ee(this,"onFirstVideoDecoded",void 0),ee(this,"onFirstVideoDecodedTimeout",void 0),ee(this,"onSelectedLocalCandidateChanged",void 0),ee(this,"onSelectedRemoteCandidateChanged",void 0),ee(this,"onICECandidateError",void 0),ee(this,"getLocalVideoStats",void 0)}}class m3 extends p3{constructor(i,s){super(i,s),ee(this,"establishPromise",void 0)}}let bt=function(n){return n.VIDEO="video",n.AUDIO="audio",n}({}),Io=function(n){return n.UDP_RELAY="udp_relay",n.UDP_TCP_RELAY="udp_tcp_relay",n.TCP_RELAY="tcp_relay",n.RELAY="relay",n}({}),gp=function(n){return n[n.FIRST_CONNECTION=0]="FIRST_CONNECTION",n[n.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",n[n.RELAY_RESTART=2]="RELAY_RESTART",n[n.TCP_RESTART=3]="TCP_RESTART",n[n.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",n[n.OLD_RESTART=11]="OLD_RESTART",n[n.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",n}({});const g3=["disconnected","failed"];let Qe=function(n){return n.LocalVideoTrack="videoTrack",n.LocalAudioTrack="audioTrack",n.LocalVideoLowTrack="videoLowTrack",n}({}),ur=function(n){return n.New="new",n.Connected="connected",n.Reconnecting="reconnecting",n.Disconnected="disconnected",n}({}),Ft=function(n){return n.AudioMetadata="audioMetadata",n.StateChange="stateChange",n.IceConnectionStateChange="iceConnectionStateChange",n.RequestMuteLocal="requestMuteLocal",n.RequestUnmuteLocal="requestUnmuteLocal",n.RequestRePublish="requestRePublish",n.RequestRePublishDataChannel="requestRePublishDataChannel",n.RequestReSubscribe="requestReSubscribe",n.RequestUploadStats="requestUploadStats",n.RequestUpload="requestUpload",n.MediaReconnectStart="MediaReconnectStart",n.MediaReconnectEnd="MediaReconnectEnd",n.NeedSignalRTT="NeedSignalRTT",n.RequestRestartICE="RequestRestartIce",n.PeerConnectionStateChange="PeerConnectionStateChange",n.RequestReconnect="RequestReconnect",n.RequestReconnectPC="RequestReconnectPC",n.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",n.P2PLost="P2PLost",n.UpdateVideoEncoder="UpdateVideoEncoder",n.ConnectionTypeChange="ConnectionTypeChange",n.RequestLowStreamParameter="RequestLowStreamParameter",n.QueryClientConnectionState="QueryClientConnectionState",n.LocalCandidate="LocalCandidate",n.RequestP2PMuteLocal="requestP2PMuteLocal",n.RequestP2PUnPublish="RequestP2PUnPublish",n.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",n.RequestP2PMuteRemote="RequestP2PMuteRemote",n.RequestP2PRestartICE="RequestP2PRestartICE",n}({}),ud=function(n){return n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED",n}({}),ld=function(n){return n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED",n}({}),Us=function(n){return n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url",n}({}),v3=function(n){return n.CONNECTED="transmitter:connected",n.RECONNECTING="transmitter:reconnecting",n.WILL_RECONNECT="transmitter:will_reconnect",n.CLOSED="transmitter:closed",n.FAILED="transmitter:failed",n.ON_MESSAGE="transmitter:on_message",n.REQUEST_NEW_URLS="transmitter:request_new_urls",n.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",n.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",n.FAILBACK="transmitter:failback",n.PRE_CONNECT_PC="transmitter:pre_connect_pc",n}({}),Gh=function(n){return n.CAMERA_CHANGED="camera-changed",n.MICROPHONE_CHANGED="microphone-changed",n.PLAYBACK_DEVICE_CHANGED="playback-device-changed",n.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",n.AUTOPLAY_FAILED="autoplay-failed",n.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",n.SECURITY_POLICY_VIOLATION="security-policy-violation",n}({}),Al=function(n){return n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED",n}({}),th=function(n){return n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url",n}({}),dS=function(n){return n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED",n}({}),Ui=function(n){return n.CALL="call",n.CANDIDATE="candidate",n.PUBLISH="publish",n.UNPUBLISH="unpublish",n.CONTROL="control",n.RESTART_ICE="restart_ice",n.ACK="ack",n.RESPONSE="response",n.JOIN="join",n.CHECK="check",n}({}),hS=function(n){return n.ABORT="abort",n}({}),Hm=function(n){return n.MUTE_LOCAL_AUDIO="mute_local_audio",n.MUTE_LOCAL_VIDEO="mute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video",n}({}),sSe=function(n){return n.P2P_TOKEN_TIMEOUT="p2p_token_timeout",n.P2P_TOKEN_CHANGED="p2p_token_changed",n}({});const oSe={[oO.ACCESS_POINT]:{[La.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[La.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[La.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[La.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[La.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[La.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[La.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[La.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[La.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[La.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[La.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[La.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[La.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[La.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[La.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[La.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[La.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[La.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[oO.UNILBS]:{[cd.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[cd.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[cd.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[cd.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[cd.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[cd.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[cd.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[cd.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[cd.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[cd.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[cd.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[cd.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[oO.STRING_UID_ALLOCATOR]:{[XM.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[XM.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[XM.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function fS(n){const i=oSe[Math.floor(n/1e4)];if(!i)return{desc:"unknown error",retry:!1};const s=i[n%1e4];if(!s){if(Math.floor(n/1e4)===oO.ACCESS_POINT){const c=n%1e4;if(c.toString()[0]==="1")return{desc:n.toString(),retry:!1};if(c.toString()[0]==="2")return{desc:n.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const aSe={[Bt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Bt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Bt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Bt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Bt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Bt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Bt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Bt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Bt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Bt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Bt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Bt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Bt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Bt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Bt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Bt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Bt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Bt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Bt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Bt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Bt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Bt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Bt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Bt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Bt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Bt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Bt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Bt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Bt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Bt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Bt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Bt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Bt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Bt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Bt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Bt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Bt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Bt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Bt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Bt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Bt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Bt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Bt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Bt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Bt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Bt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Bt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Bt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Bt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Bt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Bt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Bt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Bt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Bt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Bt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Bt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Bt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Bt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Bt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Bt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function qb(n){return aSe[n]||{desc:"UNKNOWN_ERROR_".concat(n),action:"failed"}}function _3(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function eU(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?_3(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):_3(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function y3(n,i){if(typeof n=="string")return n;const{proxy:s,host:c,port:l}=n;if(i){const h=le("JOIN_GATEWAY_FALLBACK_PORT")||443;return h===443?"wss://".concat(c,"/ws/?p=").concat(Number(l)+150):"wss://".concat(c,":").concat(h,"/ws/?p=").concat(Number(l)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(c,"&p=").concat(l):"wss://".concat(c,":").concat(l)}const cSe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,uSe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,lSe=/wss:\/\/(.+):([0-9]+)\/?/,dSe=/wss:\/\/(.[^\/]+)\/?/;let hSe=0;class fSe{constructor(i,s){ee(this,"id",0),ee(this,"store",void 0),ee(this,"recordIndex",void 0),ee(this,"websockets",[]),ee(this,"try443PortDuration",2e3),ee(this,"forceCloseWSDuration",5e3),ee(this,"try443PortTimeout",null),ee(this,"forceCloseTimeout",null),ee(this,"isTry443PortFailed",!1),ee(this,"isNormalPortFailed",!1),ee(this,"useDoubleDomain",!1),ee(this,"useProxy",!1),ee(this,"startTime",Date.now()),this.id=++hSe,this.try443PortDuration=le("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=i||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(i=>{i.onopen=null,i.onclose=null,i.onmessage=null,i.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var i;const s=Date.now()-this.startTime;for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];x.debug("[choose-best-ws ".concat((i=this.store)===null||i===void 0?void 0:i.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...l)}createWebSocket(i,s,c){this.logger("createWebSocket:",i,{isTry443Port:s,hasTimeoutDetection:c});const l=le("GATEWAY_DOMAINS"),h=Date.now(),p=[],v=l.find(O=>{var N;return dt(N=i.host).call(N,O)});v||(this.useDoubleDomain=!1);const y=[];if(this.useDoubleDomain)l.forEach(O=>{y.push(y3(eU(eU({},i),{},{host:i.host.replace(v,O)}),s))});else{const O=eU({},i);if(s&&v){const N=l.find(Y=>Y!==v);N&&(O.host=O.host.replace(v,N))}y.push(y3(O,s))}try{y.forEach(O=>{const N=new WebSocket(O);N.binaryType="arraybuffer",p.push(N),this.logger("ws is connecting:",N.url)})}catch(O){if(this.logger("ws create failed"),p.forEach(N=>N.close()),p.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(i,s,c);if(!s&&Number(i.port)!==443)return this.createWebSocket(i,!0,c);throw new Pe(ie.WS_ERR,"init websocket failed! Error: ".concat(O.toString()))}const S=Nb();this.store&&this.store.recordJoinChannelService({urls:p.map(O=>O.url),service:"gateway"},this.recordIndex),p.forEach(O=>{O.onopen=()=>{this.logger("onopen: ws ".concat(O.url," open cost ").concat(Date.now()-h,"ms")),this.websockets.forEach(N=>{N!==O&&(N.onopen=null,N.onclose=null,N.onmessage=null,N.close(),this.logger("close backup websocket: ".concat(N.url)))}),this.websockets.length=0,S.resolve(O)},O.onclose=N=>{this.logger("onclose: ws ".concat(O.url," closed cost ").concat(Date.now()-h,"ms state: ").concat(O.readyState));const Y=p.every(W=>W.readyState===WebSocket.CLOSED||W.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(Y)),Y&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(N.reason)),S.reject({code:N.code,reason:uO.A_ROUND_WS_FAILED})):!s&&Y&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),s?this.isTry443PortFailed=Y:this.isNormalPortFailed=Y},O.onmessage=N=>this.logger("".concat(O.url," onmessage: ").concat(N.data))}),this.websockets.push(...p);const b=()=>{this.websockets.forEach(O=>O.readyState!==WebSocket.OPEN&&O.close())},R=()=>{if(S.isResolved)return b();zn().os===ws.MAC_OS&&gi()&&b(),this.createWebSocket(i,!0,!0).then(O=>{S.resolve(O)}).catch(O=>{this.isNormalPortFailed&&S.reject(O),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",S.isResolved),this.forceCloseTimeout=null,b()},this.forceCloseWSDuration)};return c||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,b()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",S.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),S.promise}chooseBestWebsocket(i,s,c,l){return this.useDoubleDomain=!!s,typeof i=="string"&&(i=function(h){let p,v,y;return[,p,v,y]=h.match(cSe)||[],p||([,v,y]=h.match(uSe)||[]),v&&y||([,v,y]=h.match(lSe)||[]),v&&y||([,v]=h.match(dSe)||[]),v||x.warning("un-destructible url: ",h),{proxy:p,host:v,port:y||"443"}}(i)),this.recordIndex=l,this.useProxy=!!i.proxy,c&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),c=!1),this.createWebSocket(i,!!c,!1).finally(()=>this.clearTimeout())}}function E3(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}class S3 extends li{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var s;dt(s=["tryNext","recover"]).call(s,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,this._state==="reconnecting"?this.emit(un.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(un.CONNECTED):this._state==="closed"?this.emit(un.CLOSED):this._state==="failed"&&this.emit(un.FAILED))}resetReconnectCount(i){x.debug("websocket reset reconnect count, reason: "+i),this.reconnectCount=0}constructor(i,s){let c=arguments.length>2&&arguments[2]!==void 0&&arguments[2],l=arguments.length>3&&arguments[3]!==void 0&&arguments[3],h=arguments.length>4&&arguments[4]!==void 0&&arguments[4],p=arguments.length>5?arguments[5]:void 0;super(),ee(this,"connectionID",0),ee(this,"currentURLIndex",0),ee(this,"urls",[]),ee(this,"_reconnectMode","tryNext"),ee(this,"reconnectReason",void 0),ee(this,"_initMutex",void 0),ee(this,"name",void 0),ee(this,"_state","closed"),ee(this,"reconnectInterrupter",void 0),ee(this,"websocket",void 0),ee(this,"retryConfig",void 0),ee(this,"reconnectCount",0),ee(this,"forceCloseTimeout",5e3),ee(this,"onlineReconnectListener",void 0),ee(this,"useCompress",void 0),ee(this,"tryDoubleDomain",!1),ee(this,"use443PortOnly",!1),ee(this,"wsInflateLength",0),ee(this,"wsDeflateLength",0),ee(this,"closeEstablishingWs",()=>{}),ee(this,"store",void 0),ee(this,"joinGatewayRecordIndex",void 0),this.store=p,this.name=i,this.retryConfig=function(R){for(var O=1;O<arguments.length;O++){var N=arguments[O]!=null?arguments[O]:{};O%2?E3(Object(N),!0).forEach(function(Y){ee(R,Y,N[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(N)):E3(Object(N)).forEach(function(Y){Object.defineProperty(R,Y,Object.getOwnPropertyDescriptor(N,Y))})}return R}({},s),this.useCompress=c,this.tryDoubleDomain=l,this.use443PortOnly=h,this._initMutex=new Co("websocket",p?p.clientId:void 0);const{timeout:v,timeoutFactor:y}=s,S=Math.max(300,Math.floor(3*v/5)),b=Math.max(1.2,Math.floor(8*y)/10);lu.ONLINE&&(this.retryConfig.timeout=S,this.retryConfig.timeoutFactor=b),$i.on(KE.NETWORK_STATE_CHANGE,(R,O)=>{R!==O&&(this.resetReconnectCount("network state change: ".concat(O," -> ").concat(R)),R===lu.ONLINE?(this.retryConfig.timeout=S,this.retryConfig.timeoutFactor=b):(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=y))})}getConnection(){return this.websocket||void 0}async init(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const c=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=i,this.state="connecting";try{const l=Nb(),h=this.urls[this.currentURLIndex];le("ENABLE_PREALLOC_PC")&&this.emit(v3.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(l.resolve).catch(l.reject),this.once(un.CLOSED,()=>{l.reject(new Fe(ie.WS_DISCONNECT))}),this.once(un.CONNECTED,l.resolve),await l.promise}catch{}finally{c()}}close(i,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const c=this.websocket;s?setTimeout(()=>c.close(),500):c.close(),this.websocket=void 0}this.state=i?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(i,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));i!==void 0&&(this.reconnectMode=i),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const c=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),c&&c.bind(this.websocket)({code:9999,reason:s})}sendMessage(i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Fe(ie.WS_ABORT,"websocket is not ready");try{s||(i=JSON.stringify(i)),this.websocket.send(i)}catch(c){throw new Fe(ie.WS_ERR,"send websocket message error"+c.toString())}}setWsInflateData(i){this.wsDeflateLength=this.wsDeflateLength+i.originLength,this.wsInflateLength=this.wsInflateLength+i.compressedLength}getWsInflateData(){const i=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:i,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(i){var s;const c=Nb();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const l=b=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),b),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),c.resolve()},h=async b=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)c.reject(new Fe(ie.WS_DISCONNECT,"websocket close: ".concat(b.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=b.reason,this.state="reconnecting");const O=Bu(this,un.WILL_RECONNECT,this.reconnectMode,b.reason)||this.reconnectMode,N=await this.reconnectWithAction(O);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!N)return c.reject(new Fe(ie.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),this.close(!0);c.resolve()}},p=b=>{this.emit(un.ON_MESSAGE,b)},v=b=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(b))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),le("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(i=le("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),i);const y=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var S;const b=await this.chooseBestWebsocketConnection(i);this.websocket=b,l&&l(this.websocket.url),this.websocket.onclose=h,this.websocket.onmessage=p,this.websocket.onerror=v,(S=this.store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:"success"},y),this.joinGatewayRecordIndex=y}catch(b){const R=this.state==="closed",O=b instanceof Fe,N=O&&b.code===ie.WS_ABORT,Y=O&&b.code===ie.WS_ERR,W=O?b.message:b&&(b.reason||b.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(W)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:N?"aborted":"error",errors:[b]},y),R||Y?(c.reject(R?new Fe(ie.WS_DISCONNECT,"websocket is closed: ".concat(W)):new Fe(ie.WS_ERR,"init websocket failed: ".concat(W))),Y&&x.error("[".concat(this.name,"] init websocket failed: ").concat(W))):h&&h(b)}return c.promise}async reconnectWithAction(i){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",i),this.onlineReconnectListener||$i.isOnline||!$i.onlineWaiter||(this.onlineReconnectListener=$i.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let c=!0;if(this.reconnectInterrupter=()=>c=!1,s){const p=hM(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(p,"ms to reconnect websocket, mode: ").concat(i)),await pt.race([$s(p),this.onlineReconnectListener||new pt(()=>{})])}if(this._state==="closed"||!c)return!1;this.reconnectCount+=1;const l=async(p,v)=>{this.emit(un.RECONNECT_CREATE_CONNECTION,v),await this.createWebSocketConnection(p)};try{if(i==="retry")await l(this.urls[this.currentURLIndex],i);else if(i==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await l(this.urls[this.currentURLIndex],i)}else i==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ho(this,un.REQUEST_NEW_URLS),this.currentURLIndex=0,await l(this.urls[this.currentURLIndex],i))}catch(p){var h;x.error("[".concat(this.name,"] reconnect failed ").concat(p&&p.toString()));const v=p==null||(h=p.data)===null||h===void 0?void 0:h.desc;return Array.isArray(v)&&dt(v).call(v,"dynamic key expired")?(this.emit(un.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(i,s)}return!0}}class tU extends S3{constructor(i,s){super(i,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(i,s){const c=Nb(),l=function(p,v){return new fSe(p,v)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),l.closeAllWebsockets(),c.reject(new Fe(ie.WS_ABORT,"choose best websocket aborted"))};const h=le("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",i,", domains: ",h,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),l.chooseBestWebsocket(i,this.tryDoubleDomain,this.use443PortOnly,s).then(c.resolve).catch(c.reject),c.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class $b extends S3{constructor(i,s){super(i,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(i,s){return new pt((c,l)=>{let h=!1;const p=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),p.forEach(Y=>{Y.onclose=null,Y.onopen=null,Y.onmessage=null,Y.close()}),l(new Fe(ie.WS_ABORT,"choose best websocket aborted"))};const v=le("GATEWAY_DOMAINS");let y;const S=i.indexOf("?h="),b=v.find(Y=>S!==-1?dt(i).call(i,Y,S):dt(i).call(i,Y));x.debug("[choose-best-ws] currentDomain: ",b,", domains: ",v);let R=!this.tryDoubleDomain||!b;if(!R&&b){var O;const Y=Date.now();try{v.forEach(W=>{const H=S===-1?i.replace(b,W):i.substr(0,S)+i.substr(S).replace(b,W),ne=new WebSocket(H);ne.binaryType="arraybuffer",p.push(ne),x.debug("[choose-best-ws] ws is connecting:",ne.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),p.forEach(H=>H.close());p.length;)p.pop();R=!0}(O=this.store)===null||O===void 0||O.recordJoinChannelService({urls:p.map(W=>W.url),service:"gateway"},s),p.forEach(W=>{W.onopen=()=>{if(h)return;const H=Date.now()-Y;x.debug("[choose-best-ws] ws open cost ".concat(H,"ms")),p.filter(ne=>ne!==W).forEach(ne=>{x.debug("[choose-best-ws]close backup websocket: ".concat(ne.url)),ne.close()}),h=!0,c(W)},W.onclose=H=>{y=H,!h&&(p.find(ne=>!(ne.readyState===WebSocket.CLOSED||ne.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),h=!0,l(y)))},W.onmessage=H=>{x.debug("[choose-best-ws]".concat(W.url," onmessage: ").concat(H.data))}}),$s(this.forceCloseTimeout).then(()=>{p.forEach(W=>{W.readyState!==WebSocket.OPEN&&W.close()})})}if(R){var N;let Y;x.debug("[choose-best-ws] use single url: ",i),(N=this.store)===null||N===void 0||N.recordJoinChannelService({urls:[i],service:"gateway"},s);try{Y=new WebSocket(i),p.push(Y),Y.binaryType="arraybuffer"}catch(W){const H=new Fe(ie.WS_ERR,"init websocket failed! Error: ".concat(W.toString()));return x.error("[".concat(this.name,"]").concat(H)),void l(H)}Y.onopen=()=>{c(Y)},Y.onclose=W=>{l(W)},Y.onmessage=W=>{x.debug("[choose-best-ws]".concat(Y.url," onmessage: ").concat(W.data))},$s(this.forceCloseTimeout).then(()=>{Y&&Y.readyState!==WebSocket.OPEN&&Y.close()})}}).then(c=>(this.closeEstablishingWs=void 0,c)).catch(c=>{throw this.closeEstablishingWs=void 0,c})}}class pSe extends li{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Fr.CONNECTED?this.emit(en.WS_CONNECTED):i===Fr.RECONNECTING?this.emit(en.WS_RECONNECTING,this._websocketReconnectReason):i===Fr.CLOSED&&this.emit(en.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,s){super(),ee(this,"_disconnectedReason",void 0),ee(this,"_websocketReconnectReason",void 0),ee(this,"_connectionState",Fr.CLOSED),ee(this,"reconnectToken",void 0),ee(this,"websocket",void 0),ee(this,"openConnectionTime",void 0),ee(this,"clientId",void 0),ee(this,"lastMsgTime",Date.now()),ee(this,"uploadCache",[]),ee(this,"uploadCacheInterval",void 0),ee(this,"rttRolling",new D9(5)),ee(this,"pingpongTimer",void 0),ee(this,"wsInflateDataTimer",void 0),ee(this,"pingpongTimeoutCount",0),ee(this,"joinResponse",void 0),ee(this,"multiIpOption",void 0),ee(this,"initError",void 0),ee(this,"spec",void 0),ee(this,"store",void 0),ee(this,"onWebsocketMessage",c=>{if(c.data instanceof ArrayBuffer)return void this.emit(en.ON_BINARY_DATA,c.data);const l=JSON.parse(c.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const h="res-@".concat(l._id);this.emit(h,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){if(this.emit(l._type,l._message),l._type===Pn.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===Pn.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close(cr.UID_BANNED);break;case 15:this.close(cr.IP_BANNED);break;case 16:this.close(cr.CHANNEL_BANNED)}if(l._type===Pn.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case Bt.ERR_LICENSE_MISSING:this.close(cr.LICENSE_MISSING);break;case Bt.ERR_LICENSE_EXPIRED:this.close(cr.LICENSE_EXPIRED);break;case Bt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(cr.LICENSE_MINUTES_EXCEEDED);break;case Bt.ERR_LICENSE_PERIOD_INVALID:this.close(cr.LICENSE_PERIOD_INVALID);break;case Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(cr.LICENSE_MULTIPLE_SDK_SERVICE);break;case Bt.ERR_LICENSE_ILLEGAL:this.close(cr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=s,this.websocket=new tU("gateway-".concat(this.clientId),this.spec.retryConfig,!0,le("JOIN_GATEWAY_USE_DUAL_DOMAIN"),le("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Fr.CONNECTED&&this.reconnect("retry",lo.OFFLINE)})}async request(i,s,c,l){const h=Nr(6,""),p={_id:h,_type:i,_message:s},v=this.websocket.connectionID,y=()=>new pt((Y,W)=>{if(this.connectionState===Fr.CONNECTED)return Y();const H=()=>{this.off(en.WS_CLOSED,ne),Y()},ne=()=>{this.off(en.WS_CONNECTED,H),W(new Pe(ie.WS_ABORT))};this.once(en.WS_CONNECTED,H),this.once(en.WS_CLOSED,ne),i!==Jt.PUBLISH&&i!==Jt.PUBLISH_DATASTREAM&&i!==Jt.SUBSCRIBE&&i!==Jt.SUBSCRIBE_DATASTREAM&&i!==Jt.UNSUBSCRIBE&&i!==Jt.UNSUBSCRIBE_DATASTREAM&&i!==Jt.UNPUBLISH&&i!==Jt.UNPUBLISH_DATASTREAM&&i!==Jt.CONTROL&&i!==Jt.RESTART_ICE||this.once(en.DISCONNECT_P2P,()=>{W(new Pe(ie.DISCONNECT_P2P))}),i!==Jt.PUBLISH&&i!==Jt.RESTART_ICE||this.once(en.ABORT_P2P_EXECUTION,()=>{W(new Pe(ie.DISCONNECT_P2P))})});if(this.connectionState!==Fr.CONNECTING&&this.connectionState!==Fr.RECONNECTING||i===Jt.JOIN||i===Jt.REJOIN||await y(),this.websocket.sendMessage(p,!0),l)return;const S=new pt((Y,W)=>{let H=!1;const ne=(me,be)=>{H=!0,Y({isSuccess:me==="success",message:be||{}}),this.off(en.WS_CLOSED,re),this.off(en.WS_RECONNECTING,re),this.emit(en.REQUEST_SUCCESS,i,s)};this.once("res-@".concat(h),ne);const re=()=>{W(new Pe(ie.WS_ABORT,"type: ".concat(i))),this.off(en.WS_CLOSED,re),this.off(en.WS_RECONNECTING,re),this.off("res-@".concat(h),ne)};this.once(en.WS_CLOSED,re),this.once(en.WS_RECONNECTING,re),$s(le("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==v||H||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(i)),this.emit(en.REQUEST_TIMEOUT,i,s))})});let b=null;try{b=await S}catch(Y){if(this.connectionState===Fr.CLOSED||i===Jt.LEAVE)throw new Pe(ie.WS_ABORT);return!this.spec.forceWaitGatewayResponse||c?Y.throw():i===Jt.JOIN||i===Jt.REJOIN?null:(await y(),await this.request(i,s))}if(b.isSuccess)return b.message;const R=Number(b.message.error_code||b.message.code),O=qb(R),N=new Pe(ie.UNEXPECTED_RESPONSE,"".concat(O.desc,": ").concat(b.message.error_str),{code:R,data:b.message,desc:O.desc});return O.action==="success"?b.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(R,", message: ").concat(O.desc,", action: ").concat(O.action)),R===Bt.ERR_TOO_MANY_BROADCASTERS?((i===Jt.JOIN||i===Jt.REJOIN)&&(this.initError=N,this.close()),N.throw()):O.action==="failed"?N.throw():O.action==="quit"?(this.initError=N,this.close(),N.throw()):(R===Bt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",lo.MULTI_IP)):this.reconnect(O.action,lo.SERVER_ERROR),i===Jt.JOIN||i===Jt.REJOIN?null:await this.request(i,s)))}waitMessage(i,s){return new pt(c=>{const l=h=>{(!s||s(h))&&(this.off(i,l),c(h))};this.on(i,l)})}uploadWRTCStats(i){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(Hb.WRTC_STATS,s)}upload(i,s){const c={_type:i,_message:s};try{this.websocket.sendMessage(c)}catch{const h=le("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(c),this.uploadCache.length>h&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Fr.CONNECTED)return;const p=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(p._type,p._message)},le("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,s){const c={_type:i,_message:s};this.websocket.sendMessage(c)}init(i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pt((s,c)=>{this.once(en.WS_CONNECTED,()=>s(this.joinResponse)),this.once(en.WS_CLOSED,l=>c(this.initError||new Pe(ie.WS_ABORT,l))),this.connectionState=Fr.CONNECTING,this.websocket.init(i).catch(c),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||cr.LEAVE,this.connectionState=Fr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(en.ABORT_P2P_EXECUTION);const i=await ho(this,en.REQUEST_JOIN_INFO),s=await this.request(Jt.JOIN,i);if(!s)return this.emit(en.REPORT_JOIN_GATEWAY,uO.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(en.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Pe(ie.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=Vb(this,en.REQUEST_REJOIN_INFO);i.token=this.reconnectToken;const s=await this.request(Jt.REJOIN,i);return!!s&&(this.connectionState=Fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(c=>{this.emit(Pn.ON_USER_ONLINE,{uid:c.uid}),c.audio&&this.emit(Pn.ON_ADD_AUDIO_STREAM,{uid:c.uid,uint_id:c.uint_id,audio:!0,ssrcId:c.audio_ssrc}),c.video&&this.emit(Pn.ON_ADD_VIDEO_STREAM,{uid:c.uid,uint_id:c.uint_id,video:!0,ssrcId:c.video_ssrc}),c.audio_mute?this.emit(Pn.MUTE_AUDIO,{uid:c.uid}):this.emit(Pn.UNMUTE_AUDIO,{uid:c.uid}),c.video_mute?this.emit(Pn.MUTE_VIDEO,{uid:c.uid}):this.emit(Pn.UNMUTE_VIDEO,{uid:c.uid}),c.audio_enable_local?this.emit(Pn.ENABLE_LOCAL_AUDIO,{uid:c.uid}):this.emit(Pn.DISABLE_LOCAL_AUDIO,{uid:c.uid}),c.video_enable_local?this.emit(Pn.ENABLE_LOCAL_VIDEO,{uid:c.uid}):this.emit(Pn.DISABLE_LOCAL_VIDEO,{uid:c.uid}),c.audio||c.video||this.emit(Pn.ON_REMOVE_STREAM,{uid:c.uid,uint_id:c.uint_id})}),!0)}reconnect(i,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,s)}handleNotification(i){x.debug("[".concat(this.clientId,"] receive notification: "),i);const s=qb(i.code);if(i.code===28&&"detail"in i&&(x.info("[".concat(this.clientId,"] receive recover notification: "),i.detail),this.emit(en.RECOVER_NOTIFICATION,i.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(cr.UID_BANNED),void this.close()):void this.reconnect(s.action,lo.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=le("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=i&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>le("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",lo.TIMEOUT):this.request(Jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const c=Date.now()-s;this.rttRolling.add(c),le("REPORT_STATS")&&this.send(Jt.PING_BACK,{pingpongElapse:c})}).catch(c=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:s}=this.websocket.getWsInflateData();i!==0&&s!==0&&this.upload(Hb.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(un.RECONNECT_CREATE_CONNECTION,i=>{this.emit(en.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(un.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(un.CLOSED,()=>{this.connectionState=Fr.CLOSED}),this.websocket.on(un.FAILED,()=>{this._disconnectedReason=cr.NETWORK_ERROR,this.connectionState=Fr.CLOSED}),this.websocket.on(un.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===Fr.CONNECTED?this.connectionState=Fr.RECONNECTING:this.connectionState=Fr.CONNECTING}),this.websocket.on(un.WILL_RECONNECT,(i,s,c)=>{const l=Vb(this,en.IS_P2P_DISCONNECTED),h=l||i!=="retry";l&&i==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),i="tryNext",s=uO.P2P_DISCONNECTED),h&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(i)),this.emit(en.REPORT_JOIN_GATEWAY,s||uO.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(en.DISCONNECT_P2P)),c(i)}),this.websocket.on(un.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",lo.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(en.REPORT_JOIN_GATEWAY,i,this.url||""),i instanceof Pe){if(i.code===ie.UNEXPECTED_RESPONSE&&i.data.code===Bt.ERR_NO_AUTHORIZED)return this.initError=new Pe(ie.TOKEN_EXPIRE,"dynamic key expired"),void this.close(cr.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",lo.SERVER_ERROR):(this.initError=i,this.close())}})}),this.websocket.on(un.REQUEST_NEW_URLS,(i,s)=>{ho(this,en.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(un.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(v3.PRE_CONNECT_PC,()=>{this.emit(en.PRE_CONNECT_PC)})}}let mSe=function(n){return n.NATIVE_RTC="native_rtc",n.NATIVE_RTM="native_rtm",n.WEB_RTC="web_rtc",n.WEB_RTM="web_rtm",n}({}),Yi=function(n){return n[n.CHOOSE_SERVER=11]="CHOOSE_SERVER",n[n.CLOUD_PROXY=18]="CLOUD_PROXY",n[n.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",n[n.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",n}({});function T3(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function dO(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?T3(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):T3(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function Km(n){return n.match(/^[\.\:\d]+$/)?"".concat(n.replace(/[^\d]/g,"-"),".").concat(le("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(n,", use as host")),n)}function nU(n,i){n.addresses||(n.addresses=[]);const s=function(v,y){if(le("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return v.map(R=>{let{ip:O,port:N}=R;return{address:"".concat(O,":").concat(N)}});const S=le("GATEWAY_DOMAINS");let b=S[1]&&dt(y).call(y,S[1])?1:0;return v.map(R=>{let{domain_prefix:O,port:N,ip:Y}=R;if(O)return{address:"".concat(O,".").concat(S[b++%S.length],":").concat(N)};const W=/^[\.\:\d]+$/.test(Y),H=W?"".concat(Y.replace(/[^\d]/g,"-"),".").concat(S[b++%S.length],":").concat(N):"".concat(Y,":").concat(N);return W||x.debug("Cannot recognized as ip address: ".concat(Y,", use as host")),{ip:Y,port:N,address:H}})}(n.addresses,i),c=Array.isArray(n.detail)&&n.detail[18];if(c&&typeof c=="string"){const v=c.split(";");for(let y=0;y<v.length;y++){var l;const S=ha(l=v[y]).call(l);s[y]&&S&&(s[y].ip6=S)}}const h=n.detail&&n.detail.candidate;let p;if(h){const[v,y]=h.split(":");v&&y&&(p={port:Number(y),ip:v,address:"".concat(v,":").concat(y)})}return{gatewayAddrs:s,apGatewayAddress:p,uid:n.uid,cid:n.cid,cert:n.cert,vid:n.detail&&n.detail[8],uni_lbs_ip:n.detail&&n.detail[1],res:n,csIp:n.detail&&n.detail[502]}}function du(n){return typeof n=="number"?n:n.exact||n.ideal||n.max||n.min||0}function b3(n){const i=n._encoderConfig;if(!i)return{};const s={resolution:i.width&&i.height?"".concat(du(i.width),"x").concat(du(i.height)):void 0,maxVideoBW:i.bitrateMax,minVideoBW:i.bitrateMin};return typeof i.frameRate=="number"?(s.maxFrameRate=i.frameRate,s.minFrameRate=i.frameRate):i.frameRate&&(s.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||i.frameRate.min,s.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||i.frameRate.max),s}function w3(n){return n>=0&&n<.17?1:n>=.17&&n<.36?2:n>=.36&&n<.59?3:n>=.59&&n<=1?4:n>1?5:0}function Yb(n,i){let s,c,l;switch(i){case Yi.CHOOSE_SERVER:c=4096,l="choose server";break;case Yi.CLOUD_PROXY:c=1048576,l="proxy";break;case Yi.CLOUD_PROXY_5:c=4194304,l="proxy5";break;case Yi.CLOUD_PROXY_FALLBACK:c=4194310,l="proxy fallback";break;default:throw new Pe(ie.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:n.detail&&n.detail[502],retry:!1})}if(n.response_body.forEach(h=>{h.buffer&&h.buffer.flag===c&&(s={code:h.buffer.code,addresses:(h.buffer.edges_services||[]).map(p=>dO(dO({},p),{},{ticket:h.buffer.cert})),server_ts:n.enter_ts,uid:h.buffer.uid,cid:h.buffer.cid,cname:h.buffer.cname,detail:dO(dO({},h.buffer.detail),n.detail),flag:h.buffer.flag,opid:n.opid,cert:h.buffer.cert})}),!s)throw new Pe(ie.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(l," from multi unilbs response"),{csIp:n.detail&&n.detail[502]});return s}async function C3(n,i){return await pt.all(n.addresses.map(async s=>({address:le("USE_TURN_IP")?s.ip:Km(s.ip),tcpport:s.port,udpport:s.port,username:i&&le("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?i.toString():fo.username,password:i&&le("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await cM(i.toString()):fo.password})))}function rU(n,i){const s=i.getMediaStreamTrack(!0).getSettings(),c=i.videoHeight||s.height,l=i.videoWidth||s.width;return c&&l?Math.max(Math.min(c,l)/Math.min(du(n.height),du(n.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function qm(n){let{candidateType:i,relayProtocol:s,type:c,address:l,port:h,protocol:p}=n;const v={candidateType:i,relayProtocol:s,protocol:p};if(c!=="local-candidate"){const y=l.split(".");y.length>=4&&(y[1]="*",y[2]="*"),v.address=y.join("."),v.port=h}return v}function hO(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:le("SVC_MODE");if(le("ENABLE_SVC"))return function(i){return i in Bk}(n)?n:Bk.L1T3}const R3={[bt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[bt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function fO(n,i,s){i.forEach(c=>{var l;const h=R3[n].find(v=>{var y;let{key:S}=v;return dt(y=c.extensionName).call(y,S)});if(!h)return;const p=s.find(v=>{let{extensionName:y}=v;return dt(y).call(y,h.key)});p&&dt(l=p.extensionName).call(l,"gdpr_forbidden")&&(c.extensionName=p.extensionName)})}function pS(n,i){i.forEach(s=>{var c;const l=R3[n].find(h=>{var p;let{key:v}=h;return dt(p=s.extensionName).call(p,v)});dt(c=s.extensionName).call(c,"gdpr_forbidden")&&l&&(s.extensionName=l.extensionName)})}function I3(n){return n==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||dt(n).call(n,"abs-send-time")}function pO(n){return n==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||dt(n).call(n,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function A3(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function k3(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?A3(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):A3(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function Xb(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},c=arguments.length>3?arguments[3]:void 0;const{filterRTX:l,filterVideoFec:h,filterAudioFec:p,filterAudioCodec:v,filterVideoCodec:y}=i,{useXR:S}=s;let b=[],R=[],O=[],N=[],Y=!1,W=!1;if(Nc(n).mediaDescriptions.forEach(ne=>{c&&c!==ne.attributes.direction||(ne.media.mediaType!=="video"||Y||(R=ne.attributes.payloads,N=ne.attributes.extmaps,Y=!0),ne.media.mediaType!=="audio"||W||(b=ne.attributes.payloads,O=ne.attributes.extmaps,W=!0))}),!N||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!O||b.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(ne=>{var re;(re=ne.rtpMap)!==null&&re!==void 0&&re.clockRate&&(ne.rtpMap.clockRate=parseInt(ne.rtpMap.clockRate)),S&&ne.rtcpFeedbacks.push({type:"rrtr"})}),b.forEach(ne=>{var re;(re=ne.rtpMap)!==null&&re!==void 0&&re.clockRate&&(ne.rtpMap.clockRate=parseInt(ne.rtpMap.clockRate)),S&&ne.rtcpFeedbacks.push({type:"rrtr"})}),l&&(b=b.filter(ne=>{var re;return((re=ne.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())!=="rtx"}),R=R.filter(ne=>{var re;return((re=ne.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())!=="rtx"})),h&&(R=R.filter(ne=>{var re;return!/(red)|(ulpfec)|(flexfec)/i.test(((re=ne.rtpMap)===null||re===void 0?void 0:re.encodingName)||"")})),p&&(b=b.filter(ne=>{var re;return!/(red)|(ulpfec)|(flexfec)/i.test(((re=ne.rtpMap)===null||re===void 0?void 0:re.encodingName)||"")})),v&&(v==null?void 0:v.length)>0&&(b=b.filter(ne=>{var re;return dt(v).call(v,((re=ne.rtpMap)===null||re===void 0?void 0:re.encodingName.toLowerCase())||"")})),y&&(y==null?void 0:y.length)>0){const ne=R.filter(re=>{var me;return dt(y).call(y,((me=re.rtpMap)===null||me===void 0?void 0:me.encodingName.toLowerCase())||"")});R=ne.concat(l?[]:oU(ne,R))}const H=le("UNSUPPORTED_VIDEO_CODEC");return H&&H.length>0&&(R=R.filter(ne=>!(ne.rtpMap&&dt(H).call(H,ne.rtpMap.encodingName.toLowerCase())))),{audioCodecs:b,videoCodecs:R,audioExtensions:O,videoExtensions:N}}function $m(n){const i=Nc(n);let s,c;for(const l of i.mediaDescriptions){if(!s){const h=l.attributes.iceUfrag,p=l.attributes.icePwd;if(!h||!p)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:h,icePwd:p}}if(!c){const h=l.attributes.fingerprints;h.length>0&&(c={fingerprints:h})}}if(!c&&i.attributes.fingerprints.length>0&&(c={fingerprints:i.attributes.fingerprints}),!c||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:c}}function O3(n,i){const s=[],c=n.attributes.ssrcGroups.filter(p=>p.semantic==="FID"),l=n.attributes.ssrcGroups.find(p=>p.semantic==="SIM"),h=n.attributes.ssrcs;if(l)l.ssrcIds.forEach(p=>{var v;const y=(v=c.find(S=>S.ssrcIds[0]===p))===null||v===void 0?void 0:v.ssrcIds[1];s.push({ssrcId:p,rtx:i?y:void 0})});else if(c.length>0){const p=c[0].ssrcIds[0],v=c[0].ssrcIds[1];s.push({ssrcId:p,rtx:i?v:void 0})}else{if(h.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:h[0].ssrcId})}return s}function P3(n,i,s){const{cname:c}=n;let l=[];i&&(l=N3(i)),l.length===0&&(l=n.iceParameters.candidates.map(b=>({foundation:b.foundation,componentId:"1",transport:b.protocol,priority:b.priority.toString(),connectionAddress:b.ip,port:b.port.toString(),type:b.type,extension:{}})),x.debug("Using candidates from gateway."));const h={fingerprints:n.dtlsParameters.fingerprints.map(b=>({hashFunction:b.algorithm,fingerprint:b.fingerprint}))},p={iceUfrag:n.iceParameters.iceUfrag,icePwd:n.iceParameters.icePwd};let v;switch(n.dtlsParameters.role){case"server":v="passive";break;case"client":v="active";break;case"auto":v="actpass"}const y=gO(n.rtpCapabilities),S=[];return Array.isArray(s)&&s.length>0&&s.forEach(b=>{S.push({kind:bt.VIDEO,ssrcId:b.v,rtx:b.v_rtx,mslabel:"".concat(b.v,"_").concat(b.a)},{kind:bt.AUDIO,ssrcId:b.a,mslabel:"".concat(b.v,"_").concat(b.a)})}),{dtlsParameters:h,iceParameters:p,candidates:l,rtpCapabilities:y,setup:v,cname:c,preSSRCs:S}}function N3(n){let i=[];return n.ip&&typeof n.port=="number"&&(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip,port:n.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(n.ip,":").concat(n.port)),n.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip6,port:n.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(n.ip6,":").concat(n.port)))),i}function d_(n,i,s){const c=[],l=[];return n.forEach(h=>{let{ssrcId:p,rtx:v}=h;const y=Nr(8,"track-"),S={ssrcId:p,attributes:k3({label:y,mslabel:s=s||Nr(10,""),msid:"".concat(s," ").concat(y)},i&&{cname:i})};if(c.push(S),v!==void 0){const b={ssrcId:v,attributes:k3({label:y,mslabel:s,msid:"".concat(s," ").concat(y)},i&&{cname:i})};c.push(b),l.push({semantic:"FID",ssrcIds:[p,v]})}}),n.length>1&&l.push({semantic:"SIM",ssrcIds:n.map(h=>{let{ssrcId:p}=h;return p})}),{ssrcs:c,ssrcGroups:l}}function mS(n,i){i instanceof bi&&n.attributes.payloads.forEach(s=>{var c;const l=(c=s.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase();if(!l||["opus","pcmu","pcma","g722"].indexOf(l)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const h=i._encoderConfig;h&&l!=="pcmu"&&l!=="pcma"&&l!=="g722"&&(h.bitrate&&!gi()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*h.bitrate))),h.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(h.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(h.sampleRate)),h.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function iU(n){const i=n.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");i!==-1&&n.attributes.unrecognized.splice(i,1)}function sU(n,i){var s;if(!(i instanceof qr&&i._encoderConfig&&i._hints.indexOf(Dr.SCREEN_TRACK)===-1))return;const c=i._encoderConfig;Xn().supportMinBitrate&&c.bitrateMin&&n.attributes.payloads.forEach(l=>{var h,p;dt(h=["h264","h265","vp8","vp9","av1"]).call(h,((p=l.rtpMap)===null||p===void 0?void 0:p.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-min-bitrate"]="".concat(c.bitrateMin))}),Xn().supportMinBitrate&&!dt(s=i._hints).call(s,Dr.LOW_STREAM)&&c.bitrateMax&&n.attributes.payloads.forEach(l=>{var h,p;dt(h=["h264","h265","vp8","vp9","av1"]).call(h,((p=l.rtpMap)===null||p===void 0?void 0:p.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-start-bitrate"]="".concat(le("X_GOOGLE_START_BITRATE")||Math.floor(c.bitrateMax)))})}function D3(n){if(n.media.mediaType!=="video")return;const i=zn();if(i.name!==nr.SAFARI&&i.os!==ws.IOS)return;const s=n.attributes.extmaps.findIndex(c=>/video-orientation/g.test(c.extensionName));s!==-1&&n.attributes.extmaps.splice(s,1)}function mO(n,i,s){if(!i)return;let c,l;if(n.media.mediaType==="video"?(c=s.videoExtensions,l=s.videoCodecs):(c=s.audioExtensions,l=s.audioCodecs),i.twcc===!0){const h=c.find(p=>pO(p.extensionName));if(h){const p=h.extensionName;n.attributes.extmaps.find(y=>pO(y.extensionName))||n.attributes.extmaps.push({entry:h.entry,extensionName:p}),function(y,S){return S.filter(b=>!!y.find(R=>R.payloadType===b.payloadType&&!!R.rtcpFeedbacks.find(O=>O.type==="transport-cc")))}(l,n.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(S=>S.type==="transport-cc")||y.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(i.twcc===!1){const h=n.attributes.extmaps.findIndex(p=>pO(p.extensionName));h!==-1&&n.attributes.extmaps.splice(h,1),n.attributes.payloads.forEach(p=>{const v=p.rtcpFeedbacks.findIndex(y=>y.type==="transport-cc");v!==-1&&p.rtcpFeedbacks.splice(v,1)})}if(i.remb===!0){const h=c.find(p=>I3(p.extensionName));if(h){const p=h.extensionName;n.attributes.extmaps.find(y=>y.extensionName===p)||n.attributes.extmaps.push({entry:h.entry,extensionName:p}),function(y,S){return S.filter(b=>!!y.find(R=>R.payloadType===b.payloadType&&!!R.rtcpFeedbacks.find(O=>O.type==="goog-remb")))}(l,n.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(S=>S.type==="goog-remb")||y.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(i.remb===!1){const h=n.attributes.extmaps.findIndex(p=>I3(p.extensionName));h!==-1&&n.attributes.extmaps.splice(h,1),n.attributes.payloads.forEach(p=>{const v=p.rtcpFeedbacks.findIndex(y=>y.type==="goog-remb");v!==-1&&p.rtcpFeedbacks.splice(v,1)})}}function L3(n,i,s){if(gi()||n.media.mediaType!=="video"||!(i instanceof qr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!le("SIMULCAST")||s==="vp9"&&le("ENABLE_SVC")||i._scalabilityMode===void 0||i._scalabilityMode.numSpatialLayers<=1)return;const c=s==="vp8"?2:i._scalabilityMode.numSpatialLayers,l=n.attributes.ssrcs[0],h=n.attributes.ssrcGroups.find(v=>v.semantic==="FID"&&v.ssrcIds[0]===l.ssrcId),p={semantic:"SIM",ssrcIds:[l.ssrcId]};for(let v=1;v<c;v++)n.attributes.ssrcs.push({ssrcId:l.ssrcId+v,attributes:yi(l.attributes)}),p.ssrcIds.push(l.ssrcId+v),h&&(n.attributes.ssrcs.push({ssrcId:h.ssrcIds[1]+v,attributes:yi(l.attributes)}),n.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[l.ssrcId+v,h.ssrcIds[1]+v]}));n.attributes.ssrcGroups.unshift(p)}async function x3(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const c=(await s.createOffer()).sdp,{send:l,recv:h,sendrecv:p}=function(){let v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;const b=Xb(S,v,y,"sendonly"),R=Xb(S,v,y,"recvonly"),O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},Y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(dd(b,R,"videoExtensions",O,N,Y),dd(b,R,"videoCodecs",O,N,Y),dd(b,R,"audioExtensions",O,N,Y),dd(b,R,"audioCodecs",O,N,Y),le("RAISE_H264_BASELINE_PRIORITY")){const W=[],H=[];Y.videoCodecs.forEach((ne,re)=>{var me;if(((me=ne.rtpMap)===null||me===void 0?void 0:me.encodingName.toLocaleLowerCase())==="h264"){var be,we;const Se=Y.videoCodecs[re+1],Le=Se&&j3(ne,Se),et=(be=ne.fmtp)===null||be===void 0?void 0:be.parameters["profile-level-id"],mt=(we=ne.fmtp)===null||we===void 0?void 0:we.parameters["packetization-mode"];!et||et!==le("FIRST_H264_PROFILE_LEVEL_ID")||le("FIRST_PACKETIZATION_MODE")&&mt!==le("FIRST_PACKETIZATION_MODE")?Le?H.push([ne,Se]):H.push([ne]):Le?W.push([ne,Se]):W.push([ne])}}),W.length>0&&H.length>0&&(x.debug("raising H264 baseline profile priority"),Y.videoCodecs.forEach((ne,re)=>{var me;if(((me=ne.rtpMap)===null||me===void 0?void 0:me.encodingName.toLocaleLowerCase())==="h264"){const be=j3(ne,Y.videoCodecs[re+1]),we=W.shift()||H.shift()||[];we.length>0&&(be?Y.videoCodecs.splice(re,2,...we):Y.videoCodecs.splice(re,1,...we))}}),N.videoCodecs=N.videoCodecs.filter(ne=>{var re,me;return!(((re=ne.rtpMap)===null||re===void 0?void 0:re.encodingName.toLocaleLowerCase())==="h264"&&((me=ne.fmtp)===null||me===void 0?void 0:me.parameters["profile-level-id"])!==le("FIRST_H264_PROFILE_LEVEL_ID"))}),le("FILTER_SEND_H264_BASELINE")&&(O.videoCodecs=O.videoCodecs.filter(ne=>{var re,me;return!(((re=ne.rtpMap)===null||re===void 0?void 0:re.encodingName.toLocaleLowerCase())==="h264"&&((me=ne.fmtp)===null||me===void 0?void 0:me.parameters["profile-level-id"])!==le("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:O,recv:N,sendrecv:Y}}(n,i,c);try{s.close()}catch{}return{send:l,recv:h,sendrecv:p}}function M3(){const n={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},i=Xb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(dd(n,i,"videoExtensions",s,c,l),dd(n,i,"videoCodecs",s,c,l),dd(n,i,"audioExtensions",s,c,l),dd(n,i,"audioCodecs",s,c,l),le("RAISE_H264_BASELINE_PRIORITY")){const h=l.videoCodecs.findIndex(p=>p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&p.fmtp&&p.fmtp.parameters["profile-level-id"]==="42001f");if(h!==-1){const p=l.videoCodecs.findIndex(v=>v.rtpMap&&v.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(p<h){x.debug("raising H264 baseline profile priority");const v=l.videoCodecs[h];l.videoCodecs.splice(h,1),l.videoCodecs.splice(p,0,v)}p!==-1&&(c.videoCodecs=c.videoCodecs.filter(v=>!(v.rtpMap&&v.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&v.fmtp&&v.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:c,sendrecv:l}}function dd(n,i,s,c,l,h){if(s==="videoExtensions"||s==="audioExtensions"){const p=[];return n[s].forEach(v=>{i[s].some((y,S)=>{if(v.entry===y.entry&&v.extensionName===y.extensionName)return p.push(S),!0})?h[s].push(v):c[s].push(v)}),void i[s].forEach((v,y)=>{p.indexOf(y)===-1&&l[s].push(v)})}if(s==="videoCodecs"||s==="audioCodecs"){const p=[];return n[s].forEach(v=>{i[s].some((y,S)=>{if(v.payloadType===y.payloadType&&JSON.stringify(v)===JSON.stringify(y))return p.push(S),!0})?h[s].push(v):c[s].push(v)}),void i[s].forEach((v,y)=>{p.indexOf(y)===-1&&l[s].push(v)})}}function gO(n){const{send:i,recv:s,sendrecv:c}=n;if(!c){if(!i||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:s}}let l,h;return i?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...i.audioCodecs,...c.audioCodecs],l.videoCodecs=[...i.videoCodecs,...c.videoCodecs],l.audioExtensions=[...i.audioExtensions,...c.audioExtensions],l.videoExtensions=[...i.videoExtensions,...c.videoExtensions]):l=c,s?(h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},h.audioCodecs=[...s.audioCodecs,...c.audioCodecs],h.videoCodecs=[...s.videoCodecs,...c.videoCodecs],h.audioExtensions=[...s.audioExtensions,...c.audioExtensions],h.videoExtensions=[...s.videoExtensions,...c.videoExtensions]):h=c,{send:l,recv:h}}function gS(n){n.media.mediaType==="audio"&&n.attributes.payloads.filter(i=>{var s;return((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(i=>{i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"})}function Jb(n,i,s,c){let l=[];if(n===bt.VIDEO){if(le("H264_PROFILE_LEVEL_ID")&&c==="h264"&&(l=i.videoCodecs.filter(h=>{var p;return dt(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,c)&&h&&h.fmtp&&h.fmtp.parameters["profile-level-id"]===le("H264_PROFILE_LEVEL_ID")})),!Array.isArray(l)||l.length===0){let h=[];const p=[],v=[],y=[];if(s.videoCodecs.forEach(S=>{const b=S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"";dt(b).call(b,c)?h.push(S):dt(b).call(b,"vp9")?p.push(S):dt(b).call(b,"vp8")?v.push(S):dt(b).call(b,"h264")&&y.push(S)}),h.length===0){let S="";p.length!==0?(h=p,S="vp9"):v.length!==0?(h=v,S="vp8"):y.length!==0&&(h=y,S="h264"),x.warning("codec ".concat(c," not included in rtpCapabilities, fallback to default payloads: ").concat(S))}h.length!==0&&(l=i.videoCodecs.filter(S=>h.some(b=>b.payloadType===S.payloadType)))}if(l.length===0&&(x.warning("codec ".concat(c," not included in rtpCapabilities, fallback to default payloads: ").concat(i.videoCodecs[0].rtpMap&&i.videoCodecs[0].rtpMap.encodingName)),l=i.videoCodecs),le("USE_PUB_RTX")||le("USE_SUB_RTX")){const h=oU(l,i.videoCodecs);l=[...l,...h]}}else l=i.audioCodecs.filter(h=>{var p;return dt(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,c)}),l.length===0&&(x.warning("codec ".concat(c," not included in rtpCapabilities, fallback to opus")),l=i.audioCodecs.filter(h=>{var p;return dt(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,"opus")}));return l}function oU(n,i){const s=n.map(c=>c.payloadType.toString());return i.filter(c=>c.rtpMap&&c.rtpMap.encodingName==="rtx"&&c.fmtp&&c.fmtp.parameters.apt&&dt(s).call(s,c.fmtp&&c.fmtp.parameters.apt))}async function Qb(n,i,s){const c=i.toString(),l=V3(c,"offer","remote","exchangeSDP");await n.setRemoteDescription({type:"offer",sdp:c});const h=await n.createAnswer();if(!h.sdp)throw new Error("cannot get answer sdp");let p=h.sdp;p=U3(p,s||{}),l==null||l(p||""),await n.setLocalDescription({type:"answer",sdp:p})}function U3(n,i,s){const c=Nc(n),{useXR:l}=i;return c.mediaDescriptions.forEach(h=>{var p;h.attributes.mid&&(Array.isArray(s)&&!dt(s).call(s,h.attributes.mid)||(h.media.mediaType==="audio"&&gS(h),l&&dt(p=["audio","video"]).call(p,h.media.mediaType)&&h.attributes.payloads.forEach(v=>{v.rtcpFeedbacks.findIndex(y=>y.type==="rrtr")===-1&&v.rtcpFeedbacks.push({type:"rrtr"})})))}),zm(c)}function V3(n,i,s,c){if(le("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?l=>{V3(l,"answer",s==="local"?"remote":"local",c)}:void 0}function F3(n){const i=le("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(i)&&i.length>0)&&i.some(s=>dt(n).call(n,s))}function j3(n,i){try{var s;return((s=n.fmtp)===null||s===void 0?void 0:s.parameters.apt)===i.payloadType.toString()}catch{return!1}}function B3(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function kl(n,i){return typeof le(n)===i?le(n):void 0}function gSe(){try{const n=le("EXPERIMENTS")||{};return typeof n=="string"||Array.isArray(n)?{}:function(i){for(var s=1;s<arguments.length;s++){var c=arguments[s]!=null?arguments[s]:{};s%2?B3(Object(c),!0).forEach(function(l){ee(i,l,c[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(c)):B3(Object(c)).forEach(function(l){Object.defineProperty(i,l,Object.getOwnPropertyDescriptor(c,l))})}return i}({},n)}catch(n){return x.debug("handle gateway attributes failed: ",n),{}}}const W3={};function Ym(n){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(n.name)),W3[n.name]=n}function vp(n){const i=W3[n];if(!i)throw new Fe(ie.INVALID_OPERATION,"".concat(n," not found, please use AgoraRTC.use(").concat(n,"Service) to load it first"));return i}function z3(n,i){return vp("DataStream").create(n,i)}function vO(){return vp("InterceptFrame").create()}function G3(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function _p(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?G3(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):G3(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}const aU=new Map;class vSe extends li{get state(){return this._state}set state(i){if(i===this._state)return;const s=this._state;this._state=i,i==="DISCONNECTED"&&this._disconnectedReason?this.emit(Ms.CONNECTION_STATE_CHANGE,i,s,this._disconnectedReason):this.emit(Ms.CONNECTION_STATE_CHANGE,i,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(i){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(i)),this._joinGatewayStartTime=i}constructor(i,s){var c,l,h;super(),ee(this,"store",void 0),ee(this,"joinInfo",void 0),ee(this,"key",void 0),ee(this,"ntpOffset",0),ee(this,"signal",void 0),ee(this,"role",void 0),ee(this,"inChannelInfo",{joinAt:null,duration:0}),ee(this,"spec",void 0),ee(this,"_state","DISCONNECTED"),ee(this,"_statsCollector",void 0),ee(this,"_disconnectedReason",void 0),ee(this,"isSignalRecover",!1),ee(this,"hasChangeBGPAddress",!1),ee(this,"trafficStatsInterval",void 0),ee(this,"networkQualityInterval",void 0),ee(this,"_joinGatewayStartTime",0),ee(this,"_signalTimeout",!1),ee(this,"_clientRoleOptions",void 0),ee(this,"_isProactiveJoin",!1),this.store=i,this.spec=s,this.signal=this.store.useP2P?(c={spec:_p(_p({},s),{},{retryConfig:s.websocketRetryConfig}),store:i},(l=(h=vp("P2PChannel")).createSubmodule)===null||l===void 0?void 0:l.call(h,c)):new pSe(_p(_p({},s),{},{retryConfig:s.websocketRetryConfig}),i),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(i,s,c){this.store.joinGatewayStart(),i.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const l=Date.now();let h=aU.get(i.cname);if(h||(h=new Map,aU.set(i.cname,h)),this._isProactiveJoin=!0,h.has(i.uid)){const S=new Pe(ie.UID_CONFLICT);throw kt.joinGateway(i.sid,{lts:l,succ:!1,ec:S.code,addr:null,uid:i.uid,cid:i.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!i.proxyServer,signalChannel:"0",preload:i.preload}),S}h.set(i.uid,!0),this.joinInfo=i,this.key=s;let p=0;this.joinGatewayStartTime=l;const v=i.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(p));const S=i.gatewayAddrs.map(b=>{let{address:R}=b;const[O,N]=R.split(":"),Y={host:O,port:N};return i.proxyServer&&(Y.proxy=i.proxyServer),Y});p=(await this.signal.init(S)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(p," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(S){var y;throw x.error("[".concat(this.store.clientId,"] User join failed"),S.toString()),kt.joinGateway(i.sid,{lts:l,succ:!1,ec:((y=S.data)===null||y===void 0?void 0:y.desc)||S.code,errorMsg:S.message,addr:this.signal.url,uid:i.uid,cid:i.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!v,signalChannel:"0",preload:i.preload}),h.delete(i.uid),this.signal.close(),S}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(S=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),S.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Ms.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Ms.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Ms.NETWORK_QUALITY,{uplinkNetworkQuality:w3(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:w3(this._statsCollector.trafficStats.B_dnq)}):this.emit(Ms.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),p}async leave(){let i=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==cr.FALLBACK&&(this.state="DISCONNECTING");try{i||this.signal.connectionState!==Fr.CONNECTED||await function(c,l){return l===1/0?c:pt.race([c,Wye(l)])}(this.signal.request(Jt.LEAVE,void 0,!0),3e3)}catch(c){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),c)}this.signal.close(s),s!==cr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(i,s,c){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const l={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:le("PUB_EXTEND"),twcc:!!le("PUBLISH_TWCC"),rtx:!!le("USE_PUB_RTX")};try{return(await this.signal.request(Jt.PUBLISH,l,!0))._message}catch(h){if(c&&h.data&&h.data.code===Bt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),h.toString()),await this.tryUnpubBeforeRepub(i,s),this.publish(i,s,!1);throw h}}async publishDataChannel(i,s,c){var l;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const h={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(l=s.maxRetransmits)!==null&&l!==void 0?l:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Jt.PUBLISH_DATASTREAM,h,!0)}catch(p){if(c&&p.data&&p.data.code===Bt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),p.toString()),await this.tryUnpubDataChannelBeforeRepub(i,s),this.publishDataChannel(i,s,!1);throw p}}async unpublish(i,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Jt.UNPUBLISH,{stream_id:s,ortc:i},!0)}catch(c){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),c)}}async unpublishDataChannel(i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pt.all(i.map(s=>this.signal.request(Jt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(i,s,c){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const l={stream_id:i,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!le("SUBSCRIBE_TWCC"),rtx:!!le("USE_SUB_RTX")||void 0,extend:le("SUB_EXTEND"),svc:Array.isArray(le("SVC"))&&le("SVC").length!==0?le("SVC"):void 0};try{return await this.signal.request(Jt.PRE_SUBSCRIBE,l,!0)}catch(h){if(c&&h.data&&h.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),h.toString()),this.presubscribe(i,s,!1);throw h}}async subscribe(i,s,c){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const l={stream_id:i,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!le("SUBSCRIBE_TWCC"),rtx:!!le("USE_SUB_RTX"),extend:le("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(le("SVC"))&&le("SVC").length!==0?le("SVC"):void 0};try{return(await this.signal.request(Jt.SUBSCRIBE,l,!0))._message}catch(h){if(c&&h.data&&h.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),h.toString()),await this.tryUnsubBeforeResub(i,s),await this.subscribe(i,s,!1);throw h}}async subscribeDataChannel(i,s,c){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const l={uid:i,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Jt.SUBSCRIBE_DATASTREAM,l,!0)}catch(h){if(c&&h.data&&h.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),await this.tryUnsubDataChannelBeforeResub(i,s),await this.subscribeDataChannel(i,s,!1);throw h}}async subscribeAll(i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const c={p2p_id:this.store.p2pId,users:i,dtx:!1,rtx:!!le("USE_SUB_RTX"),twcc:!!le("SUBSCRIBE_TWCC"),svc:Array.isArray(le("SVC"))&&le("SVC").length!==0?le("SVC"):void 0};try{return await this.signal.request(Jt.SUBSCRIBE_STREAMS,c,!0)}catch(l){if(s&&l.data&&l.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),l.toString()),await this.tryMassUnsubBeforeResub(i),await this.subscribeAll(i,!1);throw l}}async setVideoProfile(i){const s=function(c){if(!(c.bitrateMax&&c.bitrateMin&&c.frameRate&&c.height&&c.width))return;let l=c.frameRate,h=c.width,p=c.height,v=!0;return typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(v=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,h||(v=!1)),typeof p!="number"&&(p=p.exact||p.ideal||p.max||p.min||0,l||(v=!1)),v?{stream_type:0,width:h,height:p,fps:l,start_bps:1e3*c.bitrateMax,min_bps:1e3*c.bitrateMin,target_bps:1e3*c.bitrateMax}:void 0}(i);if(s)return this.signal.request(Jt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(i,s){try{await this.signal.request(Jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:i,stream_id:s},!0)}catch(c){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),c)}}async unsubscribeDataChannel(i,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pt.all(i.map(c=>this.signal.request(Jt.UNSUBSCRIBE_DATASTREAM,{stream_id:c,uid:s},!0)))}catch(c){x.warning("unsubscribeDataChannel warning: ",c)}}async massUnsubscribe(i){try{await this.signal.request(Jt.UNSUBSCRIBE_STREAMS,i,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(i){const{iceParameters:s,dtlsParameters:c,rtpCapabilities:l}=i;return{gatewayEstablishParams:await this.signal.request(Jt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:c,rtpCapabilities:l}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Jt.GATEWAY_INFO)}async renewToken(i){await this.signal.request(Jt.RENEW_TOKEN,i),this.key=i.token}updateClientRole(i,s){s&&(this._clientRoleOptions=Object.assign({},s)),le("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(le("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},le("CLIENT_ROLE_OPTIONS"))),this.role=i}async setClientRole(i,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),le("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},le("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(le("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=i);let c,l=0;i==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(c=this._clientRoleOptions.delay,l=1):l=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:l=0,await this.signal.request(Jt.SET_CLIENT_ROLE,{role:i,level:l,delay:c,client_ts:Date.now()}),this.role=i}async setRemoteVideoStreamType(i,s){await this.signal.request(Jt.SWITCH_VIDEO_STREAM,{stream_id:i,stream_type:s})}async setDefaultRemoteVideoStreamType(i){await this.signal.request(Jt.DEFAULT_VIDEO_STREAM,{stream_type:i})}async setStreamFallbackOption(i,s){await this.signal.request(Jt.SET_FALLBACK_OPTION,{stream_id:i,fallback_type:s})}async pickSVCLayer(i,s){await this.signal.request(Jt.PICK_SVC_LAYER,{stream_id:i,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(i){await this.signal.request(Jt.SET_RTM2_FLAG,{rtm2_flag:i})}async sendExtensionMessage(i,s,c){if(this.store.useP2P)return this.signal.sendExtensionMessage(i,s,c)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),_p({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Jt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const i=aU.get(this.joinInfo.cname);i&&i.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const i=function(s){let c;return c=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),c?{username:fo.username,password:fo.password,turnServerURL:c[2],tcpport:parseInt(c[3])+30,udpport:parseInt(c[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],i&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(_p(_p({},fo),{},{turnServerURL:i.turnServerURL,tcpport:i.tcpport,udpport:i.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const i=await this.signal.request(Jt.TRAFFIC_STATS,void 0,!0);i.timestamp=Date.now(),i.ntp_offset!=null&&(this.ntpOffset=i.ntp_offset),i.peer_delay.forEach(s=>{const c=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(l=>l.peer_uid===s.peer_uid);c&&c.B_st!==s.B_st&&Uk(()=>{this.emit(Ms.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(i)}getJoinMessage(i){if(!this.joinInfo||!this.key)throw new Pe(ie.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let c=le("REPORT_APP_SCENARIO");if(typeof c!="string")try{c=JSON.stringify(c)}catch{c=void 0}var l;c&&c.length>128&&(c=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Ms.UPDATE_GATEWAY_CONFIG),l=this.store.clientId,dt(uS).call(uS,l)||uS.push(l);const h=!(gi()||c9(87)||J9())&&typeof le("ENABLE_PRE_SUB")=="boolean"&&le("ENABLE_PRE_SUB"),p=!J9()&&kl("ENABLE_PREALLOC_PC","boolean"),v=gSe(),y=Db(87)||function(){const b=zn();if(b.name!==nr.SAFARI||!b.browserVersion)return!1;const R=b.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),S=_p({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Cl,browser:navigator.userAgent,process_id:le("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:le("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:c,attributes:{userAttributes:_p({enableEncodedTransform:!!le("ENABLE_AUDIO_METADATA")&&y||!!le("ENABLE_AUDIO_TOPN")&&eM(nr.CHROME,87,116)||void 0,enableAudioMetadata:!!le("ENABLE_AUDIO_METADATA")&&y,enableAudioPts:!!le("ENABLE_AUDIO_PTS_METADATA")&&y,topnSmoothLevel:le("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:le("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:le("TOPN_SWITCH_HOLD_MS"),topnAudioGain:le("TOPN_AUDIO_GAIN"),enablePublishedUserList:le("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:le("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:kl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:kl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:kl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:le("USE_PUB_RTX")===!0||le("USE_SUB_RTX")===!0||void 0,disableFEC:le("DISABLE_FEC"),enableNTPReport:!!le("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!le("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!le("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:kl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!le("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!le("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:kl("USE_XR","boolean"),enableLossbasedBwe:kl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!le("ENABLE_AUT_CC")||void 0,enableCCFallback:kl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:p,preSubNum:h?kl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:kl("PUBLISH_TWCC","boolean"),enableSubTWCC:kl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:kl("USE_PUB_RTX","boolean"),enableSubRTX:kl("USE_SUB_RTX","boolean"),enableSubSVC:le("ENABLE_SVC")?le("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(le("SVC"))&&le("SVC").length!==0?le("SVC"):void 0,enableSvcExtended:le("ENABLE_SVC")&&Array.isArray(le("SVC_EXTENDED"))&&le("SVC_EXTENDED").length!==0?le("SVC_EXTENDED"):void 0},v)},join_ts:this.joinGatewayStartTime},i);return this.joinInfo.stringUid&&(S.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(S.aes_mode=this.joinInfo.aesmode,le("ENCRYPT_AES")?(S.aes_secret=this.joinInfo.aespassword,S.aes_encrypt=!0):S.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(S.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(S.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(S.default_video_stream=this.joinInfo.defaultVideoStream),S}getRejoinMessage(){if(!this.joinInfo)throw new Pe(ie.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(en.WS_RECONNECT_CREATE_CONNECTION,i=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(en.WS_RECONNECTING,i=>{this.joinInfo&&kt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i||lo.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",kt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(en.WS_CLOSED,i=>{let s;switch(i){case cr.LEAVE:s=lo.LEAVE;break;case cr.UID_BANNED:case cr.IP_BANNED:case cr.CHANNEL_BANNED:case cr.SERVER_ERROR:s=lo.SERVER_ERROR;break;case cr.FALLBACK:s=lo.FALLBACK;break;case cr.LICENSE_MISSING:case cr.LICENSE_EXPIRED:case cr.LICENSE_MINUTES_EXCEEDED:case cr.LICENSE_PERIOD_INVALID:case cr.LICENSE_MULTIPLE_SDK_SERVICE:case cr.LICENSE_ILLEGAL:case cr.TOKEN_EXPIRE:s=i;break;default:s=lo.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+lo.NETWORK_ERROR)),this.joinInfo&&kt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:i===cr.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=i,i!==cr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(en.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const i=le("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;i&&(i.level||i.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(i.level,", delay: ").concat(i.delay)),this.setClientRole(this.role,i))}if(kt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const i=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!i)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(i));_r("EVENT_REPORT_DOMAIN",i[1]),_r("EVENT_REPORT_BACKUP_DOMAIN",i[1]),_r("LOG_UPLOAD_SERVER","".concat(i[1],":6444"))}}}),this.signal.on(Pn.ON_UPLINK_STATS,i=>{this._statsCollector.updateUplinkStats(i)}),this.signal.on(en.REQUEST_RECOVER,(i,s,c)=>{if(!this.joinInfo)return c(new Pe(ie.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));i&&(this.joinInfo.multiIP=i,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ho(this,Ms.REQUEST_NEW_GATEWAY_LIST).then(s).catch(c)}),this.signal.on(en.REQUEST_JOIN_INFO,async(i,s,c)=>{var l;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void i(this.getJoinMessage({ortc:{}}));const h=yi((l=this.joinInfo)===null||l===void 0?void 0:l.turnServer);if(le("NEW_TURN_MODE")&&h){let S=h.servers,b=h.serversFromGateway;const R=this.signal.currentURLIndex;S.length>0&&(S=[S[R%S.length]],h.servers=S),Array.isArray(b)&&b.length>0&&(b=[b[0]],h.serversFromGateway=b),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:p,dtlsParameters:v,rtpCapabilities:y}=await ho(this,Ms.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:h});try{i(this.getJoinMessage({ortc:{iceParameters:p,dtlsParameters:v,rtpCapabilities:y,version:"2"}}))}catch(S){s(S)}}),this.signal.on(en.REQUEST_REJOIN_INFO,i=>{i(this.getRejoinMessage())}),this.signal.on(en.REPORT_JOIN_GATEWAY,(i,s)=>{if(!this.joinInfo)return;let c,l="";var h;i instanceof Pe?(c=((h=i.data)===null||h===void 0?void 0:h.desc)||i.code,l=i.message):c=i,kt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:c,errorMsg:l,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(en.IS_P2P_DISCONNECTED,i=>{i(Vb(this,Ms.IS_P2P_DISCONNECTED))}),this.signal.on(en.DISCONNECT_P2P,()=>{this.emit(Ms.DISCONNECT_P2P)}),this.signal.on(en.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(en.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(en.JOIN_RESPONSE,i=>{const s=this.getCurrentGatewayAddress();this.emit(Ms.JOIN_RESPONSE,i,s)}),this.signal.on(en.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress(),s=le("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(i&&s){const c=N3(i);this.emit(Ms.PRE_CONNECT_PC,{candidates:c,fingerprint:s})}}}),this.signal.on(en.RECOVER_NOTIFICATION,i=>{this.joinInfo&&typeof le("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(le("AP_REQUEST_DETAIL"),";").concat(i))})}async tryUnsubBeforeResub(i,s){try{await this.signal.request(Jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:i,ortc:[s]},!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),c),c}}async tryUnsubDataChannelBeforeResub(i,s){try{await this.signal.request(Jt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(c){throw x.warning("unsubscribe datachannel warning",c),c}}async tryUnpubBeforeRepub(i,s){try{await this.signal.request(Jt.UNPUBLISH,{stream_id:i,ortc:s},!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),c),c}}async tryUnpubDataChannelBeforeRepub(i,s){try{await this.signal.request(Jt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(c){throw x.warning("unpublish datastream warning: ",c),c}}async tryMassUnsubBeforeResub(i){const s={users:i.map(c=>({stream_id:c.stream_id,stream_type:c.stream_type}))};try{await this.signal.request(Jt.UNSUBSCRIBE_STREAMS,s,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),c),c}}async muteLocal(i,s){const c={action:i.find(l=>l.stream_type===hr.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:i,stream_id:s};try{await this.signal.request(Jt.CONTROL,c,!0,!0)}catch(l){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),l),l}}async unmuteLocal(i,s){const c={action:i.find(l=>l.stream_type===hr.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:i,stream_id:s};try{await this.signal.request(Jt.CONTROL,c,!0,!0)}catch(l){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),l),l}}async muteRemote(i,s){const c={action:i===bt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Jt.CONTROL,c,!0,!0)}catch(l){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),l),l}}async unmuteRemote(i,s){const c={action:i===bt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Jt.CONTROL,c,!0,!0)}catch(l){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),l),l}}uploadWRTCStats(i){this.signal.uploadWRTCStats(i)}upload(i,s){this.signal.upload(i,s)}getSignalRTT(){return this.signal.rtt}async restartICE(i){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:i};try{return await this.signal.request(Jt.RESTART_ICE,s,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),c),c}}reconnect(i,s){this.state==="CONNECTED"&&this.signal.reconnect(i||void 0,s||lo.P2P_FAILED)}getCurrentGatewayAddress(){var i,s;if(!le("GATEWAY_WSS_ADDRESS"))return le("USE_CANDIDATE_FROM_AP_DETAIL")&&(i=this.joinInfo)!==null&&i!==void 0&&i.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(i){await this.signal.request(Jt.SET_PARAMETER,{enablePublishAudioFilter:i})}}let _O=0,cU=0;function nh(n,i,s,c){return new pt((l,h)=>{i.timeout=i.timeout||le("HTTP_CONNECT_TIMEOUT"),i.responseType=i.responseType||"json",i.data&&!s?(i.data=JSON.stringify(i.data),_O+=Fh(i.data)):s&&(i.data.size?_O+=i.data.size:i.data instanceof FormData?_O+=R9(i.data):_O+=Fh(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=n,tc.request(i).then(p=>{typeof p.data=="string"?cU+=Fh(p.data):p.data instanceof ArrayBuffer||p.data instanceof Uint8Array?cU+=p.data.byteLength:cU+=Fh(JSON.stringify(p.data)),c&&l({data:p.data,headers:p.headers}),l(p.data)}).catch(p=>{tc.isCancel(p)?h(new Pe(ie.OPERATION_ABORTED,"cancel token canceled")):p.code==="ECONNABORTED"?h(new Pe(ie.NETWORK_TIMEOUT,p.message)):p.response?h(new Pe(ie.NETWORK_RESPONSE_ERROR,p.response.status)):h(new Pe(ie.NETWORK_ERROR,p.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var n;function i(Ge){var lt=0;return function(){return lt<Ge.length?{done:!1,value:Ge[lt++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(Ge,lt,Rt){return Ge==Array.prototype||Ge==Object.prototype||(Ge[lt]=Rt.value),Ge},c,l=function(Ge){Ge=[typeof globalThis=="object"&&globalThis,Ge,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var lt=0;lt<Ge.length;++lt){var Rt=Ge[lt];if(Rt&&Rt.Math==Math)return Rt}throw Error("Cannot find global object")}(this);function h(Ge,lt){if(lt)e:{var Rt=l;Ge=Ge.split(".");for(var Xe=0;Xe<Ge.length-1;Xe++){var U=Ge[Xe];if(!(U in Rt))break e;Rt=Rt[U]}(lt=lt(Xe=Rt[Ge=Ge[Ge.length-1]]))!=Xe&&lt!=null&&s(Rt,Ge,{configurable:!0,writable:!0,value:lt})}}function p(Ge){return(Ge={next:Ge})[Symbol.iterator]=function(){return this},Ge}function v(Ge){var lt=typeof Symbol<"u"&&Symbol.iterator&&Ge[Symbol.iterator];return lt?lt.call(Ge):{next:i(Ge)}}if(h("Symbol",function(Ge){function lt(U,de){this.A=U,s(this,"description",{configurable:!0,writable:!0,value:de})}if(Ge)return Ge;lt.prototype.toString=function(){return this.A};var Rt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Xe=0;return function U(de){if(this instanceof U)throw new TypeError("Symbol is not a constructor");return new lt(Rt+(de||"")+"_"+Xe++,de)}}),h("Symbol.iterator",function(Ge){if(Ge)return Ge;Ge=Symbol("Symbol.iterator");for(var lt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Rt=0;Rt<lt.length;Rt++){var Xe=l[lt[Rt]];typeof Xe=="function"&&typeof Xe.prototype[Ge]!="function"&&s(Xe.prototype,Ge,{configurable:!0,writable:!0,value:function(){return p(i(this))}})}return Ge}),typeof Object.setPrototypeOf=="function")c=Object.setPrototypeOf;else{var y;e:{var S={};try{S.__proto__={a:!0},y=S.a;break e}catch{}y=!1}c=y?function(Ge,lt){if(Ge.__proto__=lt,Ge.__proto__!==lt)throw new TypeError(Ge+" is not extensible");return Ge}:null}var b=c;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function O(Ge){if(Ge.m)throw new TypeError("Generator is already running");Ge.m=!0}function N(Ge,lt){return Ge.h=3,{value:lt}}function Y(Ge){this.g=new R,this.G=Ge}function W(Ge,lt,Rt,Xe){try{var U=lt.call(Ge.g.j,Rt);if(!(U instanceof Object))throw new TypeError("Iterator result "+U+" is not an object");if(!U.done)return Ge.g.m=!1,U;var de=U.value}catch(ge){return Ge.g.j=null,Ge.g.s(ge),H(Ge)}return Ge.g.j=null,Xe.call(Ge.g,de),H(Ge)}function H(Ge){for(;Ge.g.h;)try{var lt=Ge.G(Ge.g);if(lt)return Ge.g.m=!1,{value:lt.value,done:!1}}catch(Rt){Ge.g.v=void 0,Ge.g.s(Rt)}if(Ge.g.m=!1,Ge.g.l){if(lt=Ge.g.l,Ge.g.l=null,lt.F)throw lt.D;return{value:lt.return,done:!0}}return{value:void 0,done:!0}}function ne(Ge){this.next=function(lt){return Ge.o(lt)},this.throw=function(lt){return Ge.s(lt)},this.return=function(lt){return function(Rt,Xe){O(Rt.g);var U=Rt.g.j;return U?W(Rt,"return"in U?U.return:function(de){return{value:de,done:!0}},Xe,Rt.g.return):(Rt.g.return(Xe),H(Rt))}(Ge,lt)},this[Symbol.iterator]=function(){return this}}function re(Ge,lt){return lt=new ne(new Y(lt)),b&&Ge.prototype&&b(lt,Ge.prototype),lt}if(R.prototype.o=function(Ge){this.v=Ge},R.prototype.s=function(Ge){this.l={D:Ge,F:!0},this.h=this.C||this.u},R.prototype.return=function(Ge){this.l={return:Ge},this.h=this.u},Y.prototype.o=function(Ge){return O(this.g),this.g.j?W(this,this.g.j.next,Ge,this.g.o):(this.g.o(Ge),H(this))},Y.prototype.s=function(Ge){return O(this.g),this.g.j?W(this,this.g.j.throw,Ge,this.g.o):(this.g.s(Ge),H(this))},h("Array.prototype.entries",function(Ge){return Ge||function(){return function(lt,Rt){lt instanceof String&&(lt+="");var Xe=0,U=!1,de={next:function(){if(!U&&Xe<lt.length){var ge=Xe++;return{value:Rt(ge,lt[ge]),done:!1}}return U=!0,{done:!0,value:void 0}}};return de[Symbol.iterator]=function(){return de},de}(this,function(lt,Rt){return[lt,Rt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var me=function(Ge,lt){for(var Rt=0;Rt<Ge.length;Rt++)lt(Ge[Rt])},be=function(Ge){return Ge.replace(/\r?\n|\r/g,`\r
`)},we=function(Ge,lt,Rt){return lt instanceof Blob?(Rt=Rt!==void 0?Rt+"":typeof lt.name=="string"?lt.name:"blob",lt.name===Rt&&Object.prototype.toString.call(lt)!=="[object Blob]"||(lt=new File([lt],Rt)),[String(Ge),lt]):[String(Ge),String(lt)]},Se=function(Ge,lt){if(Ge.length<lt)throw new TypeError(lt+" argument required, but only "+Ge.length+" present.")},Le=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,et=Le.FormData,mt=Le.XMLHttpRequest&&Le.XMLHttpRequest.prototype.send,Et=Le.Request&&Le.fetch,xn=Le.navigator&&Le.navigator.sendBeacon,Mn=Le.Element&&Le.Element.prototype,Lr=Le.Symbol&&Symbol.toStringTag;Lr&&(Blob.prototype[Lr]||(Blob.prototype[Lr]="Blob"),"File"in Le&&!File.prototype[Lr]&&(File.prototype[Lr]="File"));try{new File([],"")}catch{Le.File=function(lt,Rt,Xe){return lt=new Blob(lt,Xe||{}),Object.defineProperties(lt,{name:{value:Rt},lastModified:{value:+(Xe&&Xe.lastModified!==void 0?new Date(Xe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Lr&&Object.defineProperty(lt,Lr,{value:"File"}),lt}}var Vi=function(Ge){return Ge.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},wi=function(Ge){this.i=[];var lt=this;Ge&&me(Ge.elements,function(Rt){if(Rt.name&&!Rt.disabled&&Rt.type!=="submit"&&Rt.type!=="button"&&!Rt.matches("form fieldset[disabled] *"))if(Rt.type==="file"){var Xe=Rt.files&&Rt.files.length?Rt.files:[new File([],"",{type:"application/octet-stream"})];me(Xe,function(U){lt.append(Rt.name,U)})}else Rt.type==="select-multiple"||Rt.type==="select-one"?me(Rt.options,function(U){!U.disabled&&U.selected&&lt.append(Rt.name,U.value)}):Rt.type==="checkbox"||Rt.type==="radio"?Rt.checked&&lt.append(Rt.name,Rt.value):(Xe=Rt.type==="textarea"?be(Rt.value):Rt.value,lt.append(Rt.name,Xe))})};if((n=wi.prototype).append=function(Ge,lt,Rt){Se(arguments,2),this.i.push(we(Ge,lt,Rt))},n.delete=function(Ge){Se(arguments,1);var lt=[];Ge=String(Ge),me(this.i,function(Rt){Rt[0]!==Ge&&lt.push(Rt)}),this.i=lt},n.entries=function Ge(){var lt,Rt=this;return re(Ge,function(Xe){if(Xe.h==1&&(lt=0),Xe.h!=3)return lt<Rt.i.length?Xe=N(Xe,Rt.i[lt]):(Xe.h=0,Xe=void 0),Xe;lt++,Xe.h=2})},n.forEach=function(Ge,lt){Se(arguments,1);for(var Rt=v(this),Xe=Rt.next();!Xe.done;Xe=Rt.next()){var U=v(Xe.value);Xe=U.next().value,U=U.next().value,Ge.call(lt,U,Xe,this)}},n.get=function(Ge){Se(arguments,1);var lt=this.i;Ge=String(Ge);for(var Rt=0;Rt<lt.length;Rt++)if(lt[Rt][0]===Ge)return lt[Rt][1];return null},n.getAll=function(Ge){Se(arguments,1);var lt=[];return Ge=String(Ge),me(this.i,function(Rt){Rt[0]===Ge&&lt.push(Rt[1])}),lt},n.has=function(Ge){Se(arguments,1),Ge=String(Ge);for(var lt=0;lt<this.i.length;lt++)if(this.i[lt][0]===Ge)return!0;return!1},n.keys=function Ge(){var lt,Rt,Xe,U,de=this;return re(Ge,function(ge){if(ge.h==1&&(lt=v(de),Rt=lt.next()),ge.h!=3)return Rt.done?void(ge.h=0):(Xe=Rt.value,U=v(Xe),N(ge,U.next().value));Rt=lt.next(),ge.h=2})},n.set=function(Ge,lt,Rt){Se(arguments,2),Ge=String(Ge);var Xe=[],U=we(Ge,lt,Rt),de=!0;me(this.i,function(ge){ge[0]===Ge?de&&(de=!Xe.push(U)):Xe.push(ge)}),de&&Xe.push(U),this.i=Xe},n.values=function Ge(){var lt,Rt,Xe,U,de=this;return re(Ge,function(ge){if(ge.h==1&&(lt=v(de),Rt=lt.next()),ge.h!=3)return Rt.done?void(ge.h=0):(Xe=Rt.value,(U=v(Xe)).next(),N(ge,U.next().value));Rt=lt.next(),ge.h=2})},wi.prototype._asNative=function(){for(var Ge=new et,lt=v(this),Rt=lt.next();!Rt.done;Rt=lt.next()){var Xe=v(Rt.value);Rt=Xe.next().value,Xe=Xe.next().value,Ge.append(Rt,Xe)}return Ge},wi.prototype._blob=function(){var Ge="----formdata-polyfill-"+Math.random(),lt=[],Rt="--"+Ge+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Xe,U){return typeof Xe=="string"?lt.push(Rt+Vi(be(U))+`"\r
\r
`+be(Xe)+`\r
`):lt.push(Rt+Vi(be(U))+'"; filename="'+Vi(Xe.name)+`"\r
Content-Type: `+(Xe.type||"application/octet-stream")+`\r
\r
`,Xe,`\r
`)}),lt.push("--"+Ge+"--"),new Blob(lt,{type:"multipart/form-data; boundary="+Ge})},wi.prototype[Symbol.iterator]=function(){return this.entries()},wi.prototype.toString=function(){return"[object FormData]"},Mn&&!Mn.matches&&(Mn.matches=Mn.matchesSelector||Mn.mozMatchesSelector||Mn.msMatchesSelector||Mn.oMatchesSelector||Mn.webkitMatchesSelector||function(Ge){for(var lt=(Ge=(this.document||this.ownerDocument).querySelectorAll(Ge)).length;0<=--lt&&Ge.item(lt)!==this;);return-1<lt}),Lr&&(wi.prototype[Lr]="FormData"),mt){var ac=Le.XMLHttpRequest.prototype.setRequestHeader;Le.XMLHttpRequest.prototype.setRequestHeader=function(Ge,lt){ac.call(this,Ge,lt),Ge.toLowerCase()==="content-type"&&(this.B=!0)},Le.XMLHttpRequest.prototype.send=function(Ge){Ge instanceof wi?(Ge=Ge._blob(),this.B||this.setRequestHeader("Content-Type",Ge.type),mt.call(this,Ge)):mt.call(this,Ge)}}Et&&(Le.fetch=function(Ge,lt){return lt&&lt.body&&lt.body instanceof wi&&(lt.body=lt.body._blob()),Et.call(this,Ge,lt)}),xn&&(Le.navigator.sendBeacon=function(Ge,lt){return lt instanceof wi&&(lt=lt._asNative()),xn.call(this,Ge,lt)}),Le.FormData=wi}})();const Zb=()=>{const n=le("AREAS");return n.length===0&&n.push(rr.GLOBAL),nu(n).call(n,(i,s,c)=>{const l=H3(s);return l?c===0?l:"".concat(i,",").concat(l):i},"")},H3=n=>n===rr.OVERSEA?"".concat(Ro.ASIA,",").concat(Ro.EUROPE,",").concat(Ro.AFRICA,",").concat(Ro.NORTH_AMERICA,",").concat(Ro.SOUTH_AMERICA,",").concat(Ro.OCEANIA):Ro[n],_Se=n=>{const i={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return n.map(s=>{const c=lO[s],l=Object.keys(c);l&&l.map(h=>{h!=="CODE"&&(i[h]=i[h].concat(c[h]))})}),i},yO={GLOBAL:{ASIA:[rr.CHINA,rr.JAPAN,rr.INDIA,rr.KOREA,rr.HKMC],EUROPE:[],NORTH_AMERICA:[rr.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},EO=Object.keys(yO[rr.GLOBAL]),uU=[rr.CHINA,rr.NORTH_AMERICA,rr.EUROPE,rr.ASIA,rr.JAPAN,rr.INDIA,rr.OCEANIA,rr.SOUTH_AMERICA,rr.AFRICA,rr.KOREA,rr.HKMC,rr.US],ySe=function(n,i){let s=[];if(dt(n).call(n,rr.GLOBAL)){const h=[rr.GLOBAL,rr.OVERSEA],p=Object.keys(lO);if(i===rr.GLOBAL)throw new Pe(ie.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(i===rr.CHINA)s=[rr.OVERSEA];else if(l=i,dt(EO).call(EO,l)){const v=(c=i,yO[rr.GLOBAL][c]||[]),y=[...h,i,...v];s=p.filter(S=>!dt(y).call(y,S))}else if(function(v){let y=!1;return EO.forEach(S=>{var b;dt(b=yO[rr.GLOBAL][S]).call(b,v)&&(y=!0)}),y}(i)){const v=function(S){let b;return EO.forEach(R=>{var O;dt(O=yO[rr.GLOBAL][R]).call(O,S)&&(b=R)}),b}(i),y=[...h,v,i];s=p.filter(S=>!dt(y).call(y,S))}else s=n;s=function(v){const y=[];return uU.forEach(S=>{dt(v).call(v,S)&&y.push(S)}),y.concat(v.filter(S=>!dt(uU).call(uU,S)))}(s)}else s=n;var c,l;return s};function K3(n){var i,s;if(!n&&dt(i=le("AREAS")).call(i,rr.EXTENSIONS))return x.debug("update area from ap : reset"),void lU(AEe,!0);if(!dt(s=le("AREAS")).call(s,rr.GLOBAL)||!n)return;let c=lO.EXTENSIONS;c&&(c={CODE:H3(rr.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(n,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(n,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(n,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(n,".agora.io"),"cds-ap-web-2-".concat(n,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(n,".agora.io"),"sua-ap-web-2-".concat(n,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(n,".agora.io"),"uap-ap-web-2-".concat(n,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(n,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(n,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(n,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(n,".agora.io")]},x.debug("update area from ap success: ".concat(n,",config is "),c),_r("AREAS",[rr.EXTENSIONS],!0),Object.keys(c).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?_r(l,c[l][0]):_r(l,c[l])}))}function lU(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=kt.reportApiInvoke(null,{name:is.SET_AREA,options:n,tag:_i.TRACER});try{let c=[];if(typeof n=="string"&&(c=[n]),Array.isArray(n)&&(n.forEach(h=>{if(!dt(h3).call(h3,h))throw new Pe(ie.INVALID_PARAMS,"invalid area code")}),c=n),Object.prototype.toString.call(n)==="[object Object]"){const{areaCode:h,excludedArea:p}=n;if(!h)throw new Pe(ie.INVALID_PARAMS,"area code is needed");let v=h;typeof h=="string"&&(v=[h]),c=p?ySe(v,p):v}if(!i){if(Qd.AREAS){const h=new Pe(ie.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(h),void x.warning("setArea is prohibited because of config-distribute")}if(dt(c).call(c,rr.GLOBAL)&&le("AREAS")===rr.EXTENSIONS){const h=new Pe(ie.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(h),void x.warning("setArea is prohibited because of ap extensions")}}_r("AREAS",c,i);const l=_Se(c);Object.keys(l).map(h=>{h==="LOG_UPLOAD_SERVER"||h==="EVENT_REPORT_DOMAIN"||h==="EVENT_REPORT_BACKUP_DOMAIN"||h==="PROXY_SERVER_TYPE3"?_r(h,l[h][0]):_r(h,l[h])}),x.debug("set area success:",c.join(","))}catch(c){throw s.onError(c),c}s.onSuccess()}function q3(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function Hh(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?q3(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):q3(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}let dU=1;function ESe(n,i,s,c,l){dU+=1;const h={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:dU,requestId:dU,version:Cl,cname:s.cname},p={service_name:i,json_body:JSON.stringify(h)};let v,y,S=n[0];return Jd(async()=>{v=Date.now();const b=await nh(S,{data:p,cancelToken:c,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(y=Date.now()-v,b.code!==0){const N=new Pe(ie.UNEXPECTED_RESPONSE,"live streaming ap error, code"+b.code,{retry:!0,responseTime:y});throw x.error(N.toString()),N}const R=JSON.parse(b.json_body);if(R.code!==200){const N=new Pe(ie.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:y});throw x.error(N.toString()),N}if(!R.servers||R.servers.length===0){const N=new Pe(ie.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:y});throw x.error(N.toString()),N}const O=function(N,Y){return{addressList:N.servers.map(W=>"wss://".concat(W.address.replace(/\./g,"-"),".").concat(le("WORKER_DOMAIN"),":").concat(W.wss,"?serviceName=").concat(encodeURIComponent(Y))),workerToken:N.workerToken,vid:N.vid}}(R,i);return le("LIVE_STREAMING_ADDRESS")&&(O.addressList=le("LIVE_STREAMING_ADDRESS")instanceof Array?le("LIVE_STREAMING_ADDRESS"):[le("LIVE_STREAMING_ADDRESS")]),Hh(Hh({},O),{},{responseTime:y})},(b,R)=>(kt.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:i,responseDetail:JSON.stringify(b.addressList),firstSuccess:R===0,responseTime:y,serverIp:n[R%n.length]}),!1),(b,R)=>(kt.apworkerEvent(s.sid,{success:!1,sc:b.data&&b.data.code||200,serviceName:i,responseTime:y,serverIp:n[R%n.length]}),!!(b.code!==ie.OPERATION_ABORTED&&b.code!==ie.UNEXPECTED_RESPONSE||b.data&&b.data.retry)&&(S=n[(R+1)%n.length],!0)),l)}let hU=1;function $3(n,i,s,c){let{url:l,areaCode:h}=n;const{clientId:p,sid:v}=i,y=Date.now();let S;const b=i.role,[R,O]=pU(i,h,[Yi.CHOOSE_SERVER]);let N=$i.networkState;return Jd(async()=>{N&&$i.networkState===lu.OFFLINE&&$i.onlineWaiter&&await pt.race([$i.onlineWaiter,$s(c&&c.maxRetryTimeout||ss.maxRetryTimeout)]),N=$i.networkState;const{data:Y,headers:W}=await nh(l,{data:R,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);S=W.http3==="1"?1:-1,kt.reportResourceTiming(l,v),X3(Y,l,i,y,[Yi.CHOOSE_SERVER],S);const H=Yb(Y,Yi.CHOOSE_SERVER);return fU(H),nU(H,l)},Y=>(Y&&kt.joinChooseServer(v,{role:b,lts:y,succ:!0,csAddr:l,opid:O,serverList:Y.gatewayAddrs.map(W=>W.address),ec:null,cid:Y.cid.toString(),uid:Y.uid.toString(),csIp:Y.csIp,unilbsServerIds:[Yi.CHOOSE_SERVER].toString(),isHttp3:S,corssRegionTagReq:i.apRequestDetail,corssRegionTagRes:Y.res.detail&&Y.res.detail[38]}),!1),Y=>Y.code!==ie.OPERATION_ABORTED&&(Y.code===ie.CAN_NOT_GET_GATEWAY_SERVER?Y.data.retry:(kt.joinChooseServer(v,{role:b,lts:y,succ:!1,csAddr:l,serverList:null,opid:O,ec:Y.code,csIp:Y.data&&Y.data.csIp,unilbsServerIds:[Yi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:N}),isHttp3:S,corssRegionTagReq:i.apRequestDetail}),x.warning("[".concat(p||"sid-".concat(v.slice(0,6)),"] Choose server network error, retry"),Y),!0)),c)}function Y3(n,i,s,c){let l,{url:h,areaCode:p,serviceIds:v}=n;const y=Date.now(),S=i.role,[b,R]=pU(i,p,v);let O;return Jd(async()=>{O&&$i.networkState===lu.OFFLINE&&$i.onlineWaiter&&await pt.race([$i.onlineWaiter,$s(c&&c.maxRetryTimeout||ss.maxRetryTimeout)]),O=$i.networkState;const{data:N,headers:Y}=await nh(h,{data:b,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=Y.http3==="1"?1:-1,kt.reportResourceTiming(h,i.sid),X3(N,h,i,y,v,l);const W=Yb(N,Yi.CHOOSE_SERVER),H=Yb(N,i.cloudProxyServer==="proxy5"?Yi.CLOUD_PROXY_5:i.cloudProxyServer==="proxy3"||i.cloudProxyServer==="proxy4"?Yi.CLOUD_PROXY:Yi.CLOUD_PROXY_FALLBACK);return fU(W),{gatewayInfo:nU(W,h),proxyInfo:H,url:h}},N=>(N.gatewayInfo&&kt.joinChooseServer(i.sid,{role:S,lts:y,succ:!0,csAddr:h,serverList:N.gatewayInfo.gatewayAddrs.map(Y=>Y.address),ec:null,opid:R,cid:N.gatewayInfo.cid.toString(),uid:N.gatewayInfo.uid.toString(),csIp:N.gatewayInfo.csIp,unilbsServerIds:v.toString(),isHttp3:l,corssRegionTagReq:i.apRequestDetail,corssRegionTagRes:N.gatewayInfo.res.detail&&N.gatewayInfo.res.detail[38]}),N.proxyInfo&&kt.joinWebProxyAP(i.sid,{lts:y,sucess:1,apServerAddr:h,turnServerAddrList:N.proxyInfo.addresses.map(Y=>Y.ip).join(","),errorCode:null,eventType:i.cloudProxyServer,unilbsServerIds:v.toString()}),!1),N=>N.code!==ie.OPERATION_ABORTED&&(N.code===ie.CAN_NOT_GET_GATEWAY_SERVER?N.data.retry:(kt.joinWebProxyAP(i.sid,{lts:y,sucess:0,apServerAddr:h,turnServerAddrList:null,errorCode:N.code,eventType:i.cloudProxyServer,unilbsServerIds:v.toString(),extend:JSON.stringify({networkState:O})}),x.warning("[".concat(i.clientId,"] multi unilbs network error, retry"),N),!0)),c)}const X3=(n,i,s,c,l,h)=>{const{sid:p,clientId:v,cloudProxyServer:y}=s,S=[],b=R=>{R.flag===4096?kt.joinChooseServer(p,{role:s.role,lts:c,succ:!1,csAddr:i,opid:n.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:l.toString(),isHttp3:h,corssRegionTagReq:s.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||kt.joinWebProxyAP(p,{lts:c,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:R.error.code,eventType:y,unilbsServerIds:l.toString()})};if(n.response_body.forEach(R=>{const O=R.buffer.code;if(R.uri===23&&O===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const N={error:new Pe(ie.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:n.detail[502]}),flag:R.buffer.flag};S.push(N),b(N)}if(O!==0){const N=fS(O),Y={error:new Pe(ie.CAN_NOT_GET_GATEWAY_SERVER,N.desc,{desc:N.desc,retry:N.retry,csIp:n.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(Y.error.toString()):S.push(Y),b(Y)}}),S.length)throw x.warning("[".concat(v||"sid-".concat(p.slice(0,6)),"] multi unilbs ").concat(i," failed, ").concat(S.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Pe(ie.CAN_NOT_GET_GATEWAY_SERVER,S.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!S.find(R=>R.error.data.retry),csIp:n.detail[502],desc:[...new Set(S.map(R=>{var O;return R==null||(O=R.error)===null||O===void 0||(O=O.data)===null||O===void 0?void 0:O.desc}).filter(R=>!!R))]})},fU=n=>{var i,s,c,l;if(n.addresses&&n.addresses.length===0&&n.code===0)throw new Pe(ie.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:n.detail&&n.detail[502]});if(le("AP_AREA")&&((c=n.detail)!==null&&c!==void 0&&c[23]&&typeof((l=n.detail)===null||l===void 0?void 0:l[23])=="string"?K3(n.detail[23].toLowerCase()):K3()),(i=n.detail)!==null&&i!==void 0&&i[19]&&typeof((s=n.detail)===null||s===void 0?void 0:s[19])=="string"){const p=n.detail[19],v=p==null?void 0:p.split(";");for(let y=0;y<v.length;y++){var h;const S=ha(h=v[y]).call(h);n.addresses[y]&&v&&(n.addresses[y].fingerprint=S)}}if(le("GATEWAY_ADDRESS")&&le("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",le("GATEWAY_ADDRESS"));const p=le("GATEWAY_ADDRESS").map(v=>{var y,S;const b=(y=(S=n.addresses.find(R=>R.ip===v.ip&&R.port===v.port))===null||S===void 0?void 0:S.fingerprint)!==null&&y!==void 0?y:"";return{ip:v.ip,port:v.port,ticket:n.addresses[0]&&n.addresses[0].ticket,fingerprint:b}});n.addresses=p}},SSe=(n,i)=>{if(n.response_body&&n.response_body.length){const s=n.response_body[0];if(s.buffer.code!==0){const c=fS(s.buffer.code);throw new Pe(ie.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(c.desc),{retry:c.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",i),new Pe(ie.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},pU=(n,i,s)=>{const c=Math.floor(Math.random()*1e12),l=n.role==="host"?"1":n.role==="audience"?"2":void 0,h={appid:n.appId,client_ts:Date.now(),opid:c,sid:n.sid,request_bodies:[{uri:22,buffer:{cname:n.cname,detail:Hh(Hh(Hh({6:n.stringUid,11:i,12:le("USE_NEW_TOKEN")?"1":void 0},l?{17:l}:{}),{},{22:i},n.apRequestDetail?{33:n.apRequestDetail}:{}),n.apRTM?{26:"RTM2"}:{}),key:n.token,service_ids:s,uid:n.uid||0}}]};h.request_bodies.forEach(v=>{n.multiIP&&n.multiIP.gateway_ip&&(v.buffer.detail[5]=JSON.stringify({vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]}))});const p=new FormData;return p.append("request",JSON.stringify(h)),[p,c]},TSe=(n,i)=>{const s=Math.floor(Math.random()*1e12),c={appid:n.appId,client_ts:Date.now(),opid:s,sid:n.sid,request_bodies:[{uri:28,buffer:{cname:n.cname,detail:{1:"",6:n.stringUid,12:"1"},token:n.token,service_ids:i,uid:n.uid||0,edges_services:n.apResponse.addresses.map(h=>({ip:h.ip,port:h.port}))}}]},l=new FormData;return l.append("request",JSON.stringify(c)),[l,s]};let vS=0;function _S(n){return pt.all(n.map(i=>i.then(s=>{throw s},s=>s))).then(i=>{throw i},i=>i)}const ew=async n=>{let{fragementLength:i,referenceList:s,asyncMapHandler:c,allFailedhandler:l,promisesCollector:h}=n,p=0;const v=i;let y,S=0;const b=async()=>{const R=(()=>{const O=p*v,N=O+v;return s.slice(O,N).map(c)})();h&&h.push(...R);try{y=await _S(R)}catch(O){if(S+=v,p++,!(S>=s.length))return void await b();l(O)}R.forEach(O=>O.cancel())};return await b(),y},J3=async n=>{let{referenceList:i,asyncMapHandler:s,closeFn:c}=n;const l=i.length;let h=0;const p=async()=>{const v=s(i.shift());try{return await v}catch(y){if(h++,h>=l||c!=null&&c(y))throw y;return p()}};return p()};async function mU(n,i,s,c){return{gatewayInfo:await async function(h,p,v,y){let S=null;const b=[],R=async()=>{const N=le("WEBCS_DOMAIN").slice(0,le("AJAX_REQUEST_CONCURRENT")).map(H=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(H+"/api/v2/transpond/webrtc?v=2"):"https://".concat(H,"/api/v2/transpond/webrtc?v=2"),areaCode:Zb()})),Y=y.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(H=>H.url)}),W=await ew({fragementLength:le("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:H=>(x.debug("[".concat(h.clientId,"] Connect to choose_server:"),H.url),$3(H,h,p,v)),allFailedhandler:H=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:H},Y),H[0]},promisesCollector:b});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},Y),W},O=async()=>{if(await $s(1e3),S!==null)return S;const N=le("WEBCS_DOMAIN_BACKUP_LIST").map(H=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(H+"/api/v2/transpond/webrtc?v=2"):"https://".concat(H,"/api/v2/transpond/webrtc?v=2"),areaCode:Zb()})),Y=y.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(H=>H.url)}),W=await ew({fragementLength:le("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:H=>(x.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),H.url),$3(H,h,p,v)),allFailedhandler:H=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:H},Y),H[0]},promisesCollector:b});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},Y),W};try{return S=await _S([R(),O()]),b.length&&b.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),S}catch(N){throw N[0]}}(n,i,s,c)}}async function Q3(n,i,s,c,l){const h=n.cloudProxyServer;if(h==="disabled"){if(n.useLocalAccessPoint)return await mU(n,i,s,l);if(le("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:O,proxyInfo:N}=await t7(n,i,s,l);if(n.turnServer&&n.turnServer.mode!=="auto")return{gatewayInfo:O};const Y=N.map(W=>({turnServerURL:W.address,tcpport:W.tcpport||fo.tcpport,udpport:W.udpport||fo.udpport,username:W.username||fo.username,password:W.password||fo.password,forceturn:!1,security:!0}));if(l.useP2P){var p;const W=(p=n.uid)!==null&&p!==void 0?p:O.uid,H="glb:".concat(W.toString()),ne=await cM(H),re=N.map(me=>({turnServerURL:me.address,tcpport:me.tcpport||fo.tcpport,udpport:me.udpport||fo.udpport,username:H,password:ne,forceturn:!1,security:!0}));Y.push(...re)}return n.turnServer={mode:"manual",servers:Y},{gatewayInfo:O}}return await mU(n,i,s,l)}const{proxyInfo:v,gatewayInfo:y}=await t7(n,i,s,l),S={gatewayInfo:y},b=v.map(O=>({turnServerURL:O.address,tcpport:h==="proxy3"?void 0:O.tcpport?O.tcpport:fo.tcpport,udpport:h==="proxy4"?void 0:O.udpport?O.udpport:fo.udpport,username:O.username||fo.username,password:O.password||fo.password,forceturn:h!=="proxy4",security:h==="proxy5"}));if(l.useP2P){var R;const O=(R=n.uid)!==null&&R!==void 0?R:y.uid,N="glb:".concat(O.toString()),Y=await cM(N),W=v.map(H=>({turnServerURL:H.address,tcpport:h==="proxy3"?void 0:H.tcpport||fo.tcpport,udpport:h==="proxy4"?void 0:H.udpport||fo.udpport,username:N,password:Y,forceturn:h!=="proxy4",security:h==="proxy5"}));b.push(...W)}return n.turnServer={mode:"manual",servers:b},x.debug("[".concat(n.clientId,"] set proxy server: ").concat(n.proxyServer,", mode: ").concat(h)),S}async function Z3(n,i,s,c,l){const h=le("ACCOUNT_REGISTER").slice(0,le("AJAX_REQUEST_CONCURRENT"));let p=[];p=i.proxyServer?h.map(y=>"https://".concat(i.proxyServer,"/ap/?url=").concat(y+"/api/v1")):h.map(y=>"https://".concat(y,"/api/v1"));const v=l==null?void 0:l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:p});try{const y=await async function(S,b,R,O,N){const Y=Date.now(),W={sid:R.sid,opid:10,appid:R.appId,string_uid:b};let H=S[0];const ne=await Jd(()=>nh(H+"".concat(H.indexOf("?")===-1?"?":"&","action=stringuid"),{data:W,cancelToken:O,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(re,me)=>{if(re.code===0){if(re.uid<=0||re.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(b," => ").concat(re.uid),re),kt.reqUserAccount(W.sid,{lts:Y,success:!1,serverAddr:H,stringUid:W.string_uid,uid:re.uid,errorCode:ie.INVALID_UINT_UID_FROM_STRING_UID,extend:W}),new Pe(ie.INVALID_UINT_UID_FROM_STRING_UID);return kt.reqUserAccount(W.sid,{lts:Y,success:!0,serverAddr:H,stringUid:W.string_uid,uid:re.uid,errorCode:null,extend:W}),!1}const be=fS(re.code);return be.retry&&(H=S[(me+1)%S.length]),kt.reqUserAccount(W.sid,{lts:Y,success:!1,serverAddr:H,stringUid:W.string_uid,uid:re.uid,errorCode:be.desc,extend:W}),be.retry},(re,me)=>re.code!==ie.OPERATION_ABORTED&&(kt.reqUserAccount(W.sid,{lts:Y,success:!1,serverAddr:H,stringUid:W.string_uid,uid:null,errorCode:re.code,extend:W}),H=S[(me+1)%S.length],!0),N);if(ne.code!==0){const re=fS(ne.code);throw new Pe(ie.UNEXPECTED_RESPONSE,re.desc)}return ne}(p,n,i,s,c);return l==null||l.recordJoinChannelService({status:"success",endTs:Date.now()},v),y.uid}catch(y){throw l==null||l.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[y]},v),y}}async function bSe(n,i,s){const c=le("ACCOUNT_REGISTER");let l=[];l=i.proxyServer?c.map(h=>"https://".concat(i.proxyServer,"/ap/?url=").concat(h+"/api/v1")):c.map(h=>"https://".concat(h,"/api/v1"));try{return await J3({referenceList:l,asyncMapHandler:p=>async function(v,y,S,b){const R=Date.now(),O={sid:S.sid,opid:10,appid:S.appId,string_uid:y};try{const N=await nh(v+"".concat(v.indexOf("?")===-1?"?":"&","action=stringuid"),{data:O,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(N.code!==0){const Y=fS(N.code);throw new Pe(ie.UNEXPECTED_RESPONSE,"preload sua error:".concat(Y.desc),Y)}if(N.uid<=0||N.uid>=Math.pow(2,32))throw new Pe(ie.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:v,req:O,uid:N.uid,elapse:Date.now()-R}}catch(N){throw N}}(p,n,i,s),closeFn:p=>p.code===ie.OPERATION_ABORTED||p.code===ie.UNEXPECTED_RESPONSE&&!p.data.retry})}catch(h){throw h}}async function wSe(n,i,s){const c=le("CDS_AP").slice(0,le("AJAX_REQUEST_CONCURRENT")).map(y=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(y+"/api/v1"):"https://".concat(y,"/api/v1?action=config")),l=c.map(y=>function(S,b,R,O){const N=zn(),Y={flag:64,cipher_method:0,features:Hh(Hh(Hh(Hh(Hh({install_id:yM(),device:N.name,system:N.os,system_general:navigator.userAgent,vendor:b.appId,version:Cl,cname:b.cname,session_id:b.sid,proxyServer:b.proxyServer,sdk_type:mSe.WEB_RTC,browser_name:N.name,browser_version:N.version,user_agent:navigator.userAgent,channel_name:b.cname},b.stringUid&&{string_uid:b.stringUid}),b.uid&&{uid:b.uid+""}),N.os&&{os_name:N.os}),N.osVersion&&{os_version:N.osVersion}),{},{detail:""})};return Jd(()=>nh(S,{data:Y,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,W=>W.code!==ie.OPERATION_ABORTED,O)}(y,n,i,s));let h=null,p=null,v={};try{h=await _S(l)}catch(y){if(y.code===ie.OPERATION_ABORTED)throw y;p=y}if(l.forEach(y=>y.cancel()),kt.reportApiInvoke(n.sid,{name:is.REQUEST_CONFIG_DISTRIBUTE,options:{error:p,res:h}}).onSuccess(),h&&h.test_tags)try{v=function(y){if(!y.test_tags)return{};const S=y.test_tags,b=Object.keys(S),R={};return b.forEach(O=>{var N;const Y=ha(N=O.slice(4)).call(N),W=JSON.parse(S[O]),H=W[1];R[Y]={tag:W[0]||"",value:H}}),R}(h)}catch{}return v}async function e7(n,i){const s=le("WEBCS_DOMAIN").concat(le("WEBCS_DOMAIN_BACKUP_LIST")).map(c=>({url:"https://".concat(c,"/api/v2/transpond/webrtc?v=2"),areaCode:Zb(),serviceIds:[Yi.CHOOSE_SERVER,Yi.CLOUD_PROXY_FALLBACK]}));try{return await J3({referenceList:s,asyncMapHandler:l=>async function(h,p,v){let y,{url:S,areaCode:b,serviceIds:R}=h;const O=Date.now(),[N,Y]=pU(p,b,R);let W=$i.networkState;try{W&&$i.networkState===lu.OFFLINE&&$i.onlineWaiter&&await pt.race([$i.onlineWaiter,$s(ss.maxRetryTimeout)]),W=$i.networkState;const{data:H,headers:ne}=await nh(S,{data:N,cancelToken:v,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=ne.http3==="1"?1:-1,(we=>{const Se=[];if(we.response_body.forEach(Le=>{const et=Le.buffer.code;if(Le.uri===23&&et===0&&!Le.buffer.edges_services)if(Le.buffer.flag===4194310)Le.buffer.edges_services=[];else{const mt={error:new Pe(ie.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:we.detail[502]}),flag:Le.buffer.flag};Se.push(mt)}if(et!==0){const mt=fS(et),Et={error:new Pe(ie.CAN_NOT_GET_GATEWAY_SERVER,mt.desc,{desc:mt.desc,retry:mt.retry,csIp:we.detail[502]}),flag:Le.buffer.flag};Le.buffer.flag===4194310?x.warning(Et.error.toString()):Se.push(Et)}}),Se.length)throw new Pe(ie.CAN_NOT_GET_GATEWAY_SERVER,Se.map(Le=>"flag: ".concat(Le.flag,", message: ").concat(Le.error.message)).join(" | "),{retry:!!Se.find(Le=>Le.error.data.retry),csIp:we.detail[502],desc:[...new Set(Se.map(Le=>{var et;return Le==null||(et=Le.error)===null||et===void 0||(et=et.data)===null||et===void 0?void 0:et.desc}).filter(Le=>!!Le))]})})(H);const me=Yb(H,Yi.CHOOSE_SERVER),be=Yb(H,Yi.CLOUD_PROXY_FALLBACK);return fU(me),{gatewayInfo:nU(me,S),proxyInfo:be,opid:Y,requestTime:O,url:S,isHttp3:y,elapse:Date.now()-O}}catch(H){throw H}}(l,n,i),closeFn:l=>l.code===ie.OPERATION_ABORTED||l.code===ie.CAN_NOT_GET_GATEWAY_SERVER&&!l.data.retry})}catch(c){throw c}}async function t7(n,i,s,c){const l=le("PROXY_SERVER_TYPE3"),h=(N,Y,W)=>{let H=W||l;return Array.isArray(H)&&(H=Y%2==0?l[1]:l[0]),"https://".concat(H,"/ap/?url=").concat(N)};let p=null;const v=[],y=async()=>{const N=le("WEBCS_DOMAIN").slice(0,le("AJAX_REQUEST_CONCURRENT")).map((H,ne)=>{let re;return re=n.cloudProxyServer==="disabled"&&n.proxyServer?h("".concat(H,"/api/v2/transpond/webrtc?v=2"),ne,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(H,"/api/v2/transpond/webrtc?v=2"):h("".concat(H,"/api/v2/transpond/webrtc?v=2"),ne),{url:re,areaCode:Zb(),serviceIds:[Yi.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?Yi.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?Yi.CLOUD_PROXY:Yi.CLOUD_PROXY_FALLBACK]}}),Y=c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(H=>H.url)}),W=await ew({fragementLength:le("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:H=>(x.debug("[".concat(n.clientId,"] Connect to choose_server:"),H.url),Y3(H,n,i,s)),allFailedhandler:H=>{throw c.recordJoinChannelService({endTs:Date.now(),status:"error",errors:H},Y),H[0]},promisesCollector:v});return c.recordJoinChannelService({endTs:Date.now(),status:"success"},Y),W},S=async()=>{if(await $s(1e3),p!==null)return p;const N=le("WEBCS_DOMAIN_BACKUP_LIST").map((H,ne)=>{let re;return re=n.cloudProxyServer==="disabled"&&n.proxyServer?h("".concat(H,"/api/v2/transpond/webrtc?v=2"),ne,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(H,"/api/v2/transpond/webrtc?v=2"):h("".concat(H,"/api/v2/transpond/webrtc?v=2"),ne),{url:re,areaCode:Zb(),serviceIds:[Yi.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?Yi.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?Yi.CLOUD_PROXY:Yi.CLOUD_PROXY_FALLBACK]}}),Y=c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(H=>H.url)}),W=await ew({fragementLength:le("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:H=>(x.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),H.url),Y3(H,n,i,s)),allFailedhandler:H=>{throw c.recordJoinChannelService({endTs:Date.now(),status:"error",errors:H},Y),H[0]},promisesCollector:v});return c.recordJoinChannelService({endTs:Date.now(),status:"success"},Y),W};let b,R,O;try{({gatewayInfo:b,proxyInfo:R,url:O}=await _S([y(),S()]))}catch(N){throw N[0]}if(v.length&&v.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),!b||!R)throw new Pe(ie.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(n.apUrl=O,n.cloudProxyServer!=="disabled"&&Array.isArray(l)&&O){const N=/^https?:\/\/(.+?)(\/.*)?$/.exec(O)[1];dt(l).call(l,N)&&(n.proxyServer=N,x.setProxyServer(N),kt.setProxyServer(N))}return p={gatewayInfo:b,proxyInfo:await C3(R,b.uid)},p}async function CSe(n,i,s){const c=le("UAP_AP").slice(0,le("AJAX_REQUEST_CONCURRENT")).map(h=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(h+"/api/v1?action=uap"):"https://".concat(h,"/api/v1?action=uap")),l=c.map(h=>function(p,v,y,S){const b={command:"convergeAllocateEdge",sid:v.sid,appId:v.appId,token:v.token,ts:Date.now(),version:Cl,cname:v.cname,uid:v.uid.toString(),requestId:hU,seq:hU};hU+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(b)};return Jd(async()=>{const O=await nh(p,{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(O.code!==0){const Y=new Pe(ie.UNEXPECTED_RESPONSE,"cross channel ap error, code"+O.code,{retry:!0});throw x.error(Y.toString()),Y}const N=JSON.parse(O.json_body);if(N.code!==200){const Y=new Pe(ie.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(N.code,", reason: ").concat(N.reason));throw x.error(Y.toString()),Y}if(!N.servers||N.servers.length===0){const Y=new Pe(ie.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(Y.toString()),Y}return{vid:N.vid,workerToken:N.workerToken,addressList:(le("CHANNEL_MEDIA_RELAY_SERVERS")||N.servers).map(Y=>"wss://".concat(Y.address.replace(/\./g,"-"),".").concat(le("WORKER_DOMAIN"),":").concat(Y.wss))}},void 0,O=>!!(O.code!==ie.OPERATION_ABORTED&&O.code!==ie.UNEXPECTED_RESPONSE||O.data&&O.data.retry),S)}(h,n,i,s));try{const h=await _S(l);return l.forEach(p=>p.cancel()),h}catch(h){throw h[0]}}async function RSe(n,i,s){let c=null;const l=[],h=async p=>{const v=le(p?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(y=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"));return p&&(await $s(1e3),c!==null)?c:await ew({fragementLength:le("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:y=>(x.debug("[".concat(n.clientId,"] update ticket, Connect to ").concat(p?"backup":""," choose_server:"),y),function(S,b,R,O){const[N]=TSe(b,[Yi.CHOOSE_SERVER]);let Y=$i.networkState;return Jd(async()=>{Y&&$i.networkState===lu.OFFLINE&&$i.onlineWaiter&&await pt.race([$i.onlineWaiter,$s(O&&O.maxRetryTimeout||ss.maxRetryTimeout)]),Y=$i.networkState;const W=await nh(S,{data:N,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return SSe(W,S)},()=>!1,W=>W.code!==ie.OPERATION_ABORTED&&(W.code===ie.UPDATE_TICKET_FAILED?W.data.retry:(x.warning("[".concat(b.clientId,"] update ticket network error, retry"),W),!0)),O)}(y,n,i,s)),allFailedhandler:y=>{throw y[0]},promisesCollector:l})};try{return c=await _S([h(!1),h(!0)]),l.length&&l.forEach(p=>p.cancel&&typeof p.cancel=="function"&&p.cancel()),c}catch(p){throw p[0]}}function n7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function gU(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?n7(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):n7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}class ISe extends li{get isSuccess(){return!!this.configs}constructor(i,s){super(),ee(this,"configs",void 0),ee(this,"store",void 0),ee(this,"joinInfo",void 0),ee(this,"cancelToken",void 0),ee(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),ee(this,"interval",void 0),ee(this,"mutex",void 0),ee(this,"mutableParamsRead",!1),ee(this,"configCache",{}),ee(this,"limit_bitrate",void 0),this.mutex=new Co("config-distribute",i),this.store=s}startGetConfigDistribute(i,s){this.joinInfo=i,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),le("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},le("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,kt.reportApiInvoke(null,{options:void 0,name:is.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:_i.TRACER}).onSuccess(JSON.stringify(Qd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let i;const s=await this.mutex.lock();try{i=await wSe(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(i));const c=function(l){var h;const p=Sb(h=Object.keys(l).filter(S=>/^webrtc_ng_global_parameter/.test(S))).call(h);for(let S=0;S<p.length;S++)for(let b=p.length-1;b>S;b--){const R=p[b],O=l[R].value;if(typeof O.__priority=="number"){const N=O.__priority,Y=p[b-1],W=l[Y].value;if(typeof W.__priority=="number"){if(!(N>W.__priority))continue;{const H=R;p[b]=p[b-1],p[b-1]=H}}else{const H=R;p[b]=p[b-1],p[b-1]=H}}}const v=Date.now();let y={};return p.forEach(S=>{const b=l[S].value.__expires;b&&b<=v||(y[S]=l[S])}),y}(i);this.cacheGlobalParameterConfig(c),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=c}catch(c){const l=new Pe(ie.NETWORK_RESPONSE_ERROR,c);x.warning("[config-distribute] ".concat(l.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(i){f3(i)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==i.id&&this.emit(Kb.UPDATE_BITRATE_LIMIT,i):this.emit(Kb.UPDATE_BITRATE_LIMIT,i))}getLowStreamConfigDistribute(){return this.limit_bitrate&&gU({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(i){try{const s={},c=Object.keys(i),l=[];c.forEach(h=>{const p=i[h].value;s[h]=p;const v=p.__id;if(v&&this.configCache[h]&&this.configCache[h].__id===v)return;const y=p.__type,S=i[h].value,b=i[h].tag;let R=0;y?y===W9.REALTIME&&(R=1):Object.keys(S).some(O=>Object.prototype.hasOwnProperty.call(bM,O)||!KM()&&Object.prototype.hasOwnProperty.call(Wk,O)?(R=1,!0):void 0),l.push({tag:b,isApplied:R,feature:h,params:JSON.stringify(p)})}),l.forEach(h=>{let{tag:p,feature:v,params:y,isApplied:S}=h;this.store.sessionId&&kt.abTest(this.store.sessionId,{intSucc:1,isApplied:S,tag:p,feature:v,params:y,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(i){const s=function(l){const h={};return Object.keys(l).forEach(p=>{const v=l[p].value,y=v.__expires,S=v.__type;Object.keys(v).forEach(b=>{b==="__id"||b==="__type"||b==="__priority"||b==="__expires"||Object.prototype.hasOwnProperty.call(h,b)||(h[b]=gU(gU({value:v[b]},y&&{expires:y}),S&&{type:S}))})}),h}(i);try{var c;const l=(c=s.LIMIT_BITRATE)===null||c===void 0?void 0:c.value;delete s.LIMIT_BITRATE,l&&f3(l)&&this.handleBitrateLimit(l),this.limit_bitrate=l,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(i),function(v){try{const y=Date.now();Object.keys(v).forEach(S=>{const{value:b,type:R,expires:O}=v[S];O&&O<=y||((R===W9.REALTIME||Object.prototype.hasOwnProperty.call(bM,S))&&(Qd[S]=b,Kr[S]=b,x.debug("Update realtime parameters from config distribute",S,b)),R||KM()||!Object.prototype.hasOwnProperty.call(Wk,S)||(Qd[S]=b,Kr[S]=b,x.debug("Update gateway parameters from config distribute",S,b)))})}catch(y){x.error("Error update config immediately: ".concat(v),y.message)}}(s);const h=JSON.stringify(s),p=window.btoa(h);window.localStorage.setItem("websdk_ng_global_parameter",p),x.debug("Caching global parameters ".concat(h))}catch(l){x.error("Error caching global parameters:",l.message)}}handleGlobalParameterConfig(i){try{const s=Date.now();Object.keys(i).forEach(c=>{if(c==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Kr,c)){const{value:l,expires:h}=i[c];if(h&&h<=s)return;(function(p,v){try{return typeof p=="object"&&typeof v=="object"&&JSON.stringify(p)===JSON.stringify(v)}catch{return!1}})(Kr[c],l)||(Qd[c]=l,Kr[c]=l,this.emit(Kb.UPDATE_CLIENT_ROLE_OPTIONS,l),x.debug("Updating client role options: ".concat(JSON.stringify(l))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class ASe extends li{constructor(){super(...arguments),ee(this,"resultStorage",new Map)}setLocalAudioStats(i,s,c){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",i,this.checkAudioInputLevel(c,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",i,this.checkSendAudioBitrate(c,s))}setLocalVideoStats(i,s,c){this.record("SEND_VIDEO_BITRATE_TOO_LOW",i,this.checkSendVideoBitrate(c,s)),this.record("FRAMERATE_INPUT_TOO_LOW",i,this.checkFramerateInput(c,s)),this.record("FRAMERATE_SENT_TOO_LOW",i,this.checkFramerateSent(c))}setRemoteAudioStats(i,s){const c=i.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",c,this.checkAudioOutputLevel(s))}setRemoteVideoStats(i,s){const c=i.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",c,this.checkVideoDecode(s))}record(i,s,c){if(le("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(i)||this.resultStorage.set(i,{result:[],isPrevNormal:!0});const l=this.resultStorage.get(i);if(l&&(l.result.push(c),l.result.length>=5)){var h;const p=dt(h=l.result).call(h,!0);l.isPrevNormal&&!p&&this.emit("exception",r7[i],i,s),!l.isPrevNormal&&p&&this.emit("exception",r7[i]+2e3,i+"_RECOVER",s),l.isPrevNormal=p,l.result=[]}}checkAudioOutputLevel(i){return!(i.receiveBitrate>0&&i.receiveLevel===0)}checkAudioInputLevel(i,s){return s instanceof fs&&!s.isActive||!!s.muted||i.sendVolumeLevel!==0}checkFramerateInput(i,s){let c=null;s._encoderConfig&&s._encoderConfig.frameRate&&(c=du(s._encoderConfig.frameRate));const l=i.captureFrameRate;return!c||!l||!(c>10&&l<5||c<10&&c>=5&&l<=1)}checkFramerateSent(i){return!(i.captureFrameRate&&i.sendFrameRate&&i.captureFrameRate>5&&i.sendFrameRate<=1)}checkSendVideoBitrate(i,s){return!!s.muted||i.sendBitrate!==0}checkSendAudioBitrate(i,s){return s instanceof fs&&!s.isActive||!!s.muted||i.sendBitrate!==0}checkVideoDecode(i){return i.receiveBitrate===0||i.decodeFrameRate!==0}}const r7={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ao=new class{markSubscribeStart(n,i){performance.mark("agora-web-sdk/".concat(n,"/subscribe-").concat(i))}markPublishStart(n,i){performance.mark("agora-web-sdk/".concat(n,"/publish-").concat(i))}measureFromSubscribeStart(n,i){const s=performance.getEntriesByName("agora-web-sdk/".concat(n,"/subscribe-").concat(i));if(s.length>0){const c=s[s.length-1];return Math.round(performance.now()-c.startTime)}return 0}measureFromPublishStart(n,i){const s=performance.getEntriesByName("agora-web-sdk/".concat(n,"/publish-").concat(i));if(s.length>0){const c=s[s.length-1];return Math.round(performance.now()-c.startTime)}return 0}};function i7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function h_(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?i7(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):i7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}class tw{constructor(i){ee(this,"store",void 0),ee(this,"onStatsException",void 0),ee(this,"onUploadPublishDuration",void 0),ee(this,"onStatsChanged",void 0),ee(this,"localStats",new Map),ee(this,"remoteStats",new Map),ee(this,"updateStatsInterval",void 0),ee(this,"trafficStats",void 0),ee(this,"trafficStatsPeerList",[]),ee(this,"uplinkStats",void 0),ee(this,"exceptionMonitor",void 0),ee(this,"p2pChannel",void 0),ee(this,"scalabilityMode",Bk.L1T1),ee(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=i,this.exceptionMonitor=new ASe,this.exceptionMonitor.on("exception",(s,c,l)=>{this.onStatsException&&this.onStatsException(s,c,l)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Qe.LocalAudioTrack)||h_({},AM)}getLocalVideoTrackStats(){return this.localStats.get(Qe.LocalVideoTrack)||h_({},kM)}getRemoteAudioTrackStats(i){const s=(h,p)=>{if(!this.trafficStats)return p;const v=this.trafficStats.peer_delay.find(y=>y.peer_uid===h);return v&&(p.publishDuration=v.B_ppad+(Date.now()-this.trafficStats.timestamp)),p},c={};if(i){var l;const h=(l=this.remoteStats.get(i))===null||l===void 0?void 0:l.audioStats;h&&(c[i]=s(i,h))}else Array.from(this.remoteStats.entries()).forEach(h=>{let[p,{audioStats:v}]=h;v&&(c[p]=s(p,v))});return c}getRemoteNetworkQualityStats(i){const s={};if(i){var c;const l=(c=this.remoteStats.get(i))===null||c===void 0?void 0:c.networkStats;l&&(s[i]=l)}else Array.from(this.remoteStats.entries()).forEach(l=>{let[h,{networkStats:p}]=l;p&&(s[h]=p)});return s}getRemoteVideoTrackStats(i){const s=(h,p)=>{if(!this.trafficStats)return p;const v=this.trafficStats.peer_delay.find(y=>y.peer_uid===h);return v&&(p.publishDuration=v.B_ppvd+(Date.now()-this.trafficStats.timestamp)),p},c={};if(i){var l;const h=(l=this.remoteStats.get(i))===null||l===void 0?void 0:l.videoStats;h&&(c[i]=s(i,h))}else Array.from(this.remoteStats.entries()).forEach(h=>{let[p,{videoStats:v}]=h;v&&(c[p]=s(p,v))});return c}getRTCStats(){let i=0,s=0,c=0,l=0;const h=this.localStats.get(Qe.LocalAudioTrack);h&&(i+=h.sendBytes,s+=h.sendBitrate);const p=this.localStats.get(Qe.LocalVideoTrack);p&&(i+=p.sendBytes,s+=p.sendBitrate);const v=this.localStats.get(Qe.LocalVideoLowTrack);v&&(i+=v.sendBytes,s+=v.sendBitrate),this.remoteStats.forEach(S=>{let{audioStats:b,videoStats:R}=S;b&&(c+=b.receiveBytes,l+=b.receiveBitrate),R&&(c+=R.receiveBytes,l+=R.receiveBitrate)});let y=1;return this.trafficStats&&(y+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:y,SendBitrate:s,SendBytes:i,RecvBytes:c,RecvBitrate:l,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(i){this.localStats.set(i,void 0)}removeLocalStats(i){i?this.localStats.delete(i):this.localStats.clear()}addRemoteStats(i){this.remoteStats.set(i,{})}removeRemoteStats(i){i?this.remoteStats.delete(i):this.remoteStats.clear()}addP2PChannel(i){this.p2pChannel=i}updateTrafficStats(i){i.peer_delay=i.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),i.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var c;const l=(c=this.p2pChannel)===null||c===void 0?void 0:c.getRemoteMedia(s.peer_uid),h=l!=null&&l.videoSSRC?Ao.measureFromSubscribeStart(this.store.clientId,l.videoSSRC):0,p=l!=null&&l.audioSSRC?Ao.measureFromSubscribeStart(this.store.clientId,l.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,h>p?h:p),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=i}updateUplinkStats(i){this.uplinkStats&&this.uplinkStats.B_fir!==i.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(i.B_fir)),this.uplinkStats=i}static isRemoteVideoFreeze(i,s,c){if(!i)return!1;const l=!!c&&s.framesDecodeFreezeTime>c.framesDecodeFreezeTime,h=!c||s.framesDecodeCount>c.framesDecodeCount;return l||!h}static isRemoteAudioFreeze(i){return!!i&&i._isFreeze()}isLocalVideoFreeze(i){return!(!i.inputFrame||!i.sentFrame)&&i.inputFrame.frameRate>5&&i.sentFrame.frameRate<3}updateLocalStats(i){Array.from(this.localStats.entries()).forEach(s=>{let[c,l]=s;switch(c){case Qe.LocalVideoTrack:case Qe.LocalVideoLowTrack:{const p=l,v=h_({},kM),y=i.getStats(),S=i.getLocalMedia(c);if(y){const b=y.videoSend.find(R=>R.ssrc===(S==null?void 0:S.ssrcs[0].ssrcId));if(b){const R=i.getLocalVideoSize(),O=i.getEncoderConfig(Qe.LocalVideoTrack);b.codec!=="H264"&&b.codec!=="H265"&&b.codec!=="VP8"&&b.codec!=="VP9"&&b.codec!=="AV1X"&&b.codec!=="AV1"||(v.codecType=b.codec),v.sendBytes=b.bytes,v.sendBitrate=p?8*Math.max(0,v.sendBytes-p.sendBytes):0,b.inputFrame?(v.captureFrameRate=b.inputFrame.frameRate,v.captureResolutionHeight=b.inputFrame.height,v.captureResolutionWidth=b.inputFrame.width):R&&(v.captureResolutionWidth=R.width,v.captureResolutionHeight=R.height),b.sentFrame?(v.sendFrameRate=b.sentFrame.frameRate,v.sendResolutionHeight=b.sentFrame.height,v.sendResolutionWidth=b.sentFrame.width):R&&(v.sendResolutionWidth=R.width,v.sendResolutionHeight=R.height),b.avgEncodeMs&&(v.encodeDelay=b.avgEncodeMs),O&&O.bitrateMax&&(v.targetSendBitrate=1e3*O.bitrateMax),v.sendPackets=b.packets,v.sendPacketsLost=b.packetsLost,v.sendJitterMs=b.jitterMs,v.sendRttMs=b.rttMs,v.totalDuration=p?p.totalDuration+1:1,v.totalFreezeTime=p?p.totalFreezeTime:0,this.isLocalVideoFreeze(b)&&(v.totalFreezeTime+=1),b.scalabilityMode&&this.scalabilityMode!==b.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(b.scalabilityMode)),this.scalabilityMode=b.scalabilityMode)}this.trafficStats&&(v.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(c,v),((p==null?void 0:p.sendResolutionWidth)!==v.sendResolutionWidth||(p==null?void 0:p.sendResolutionHeight)!==v.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:v.sendResolutionWidth,height:v.sendResolutionHeight})),v&&S&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,S.track,v);break}case Qe.LocalAudioTrack:{const p=l,v=h_({},AM),y=i.getStats(),S=i.getLocalMedia(c);if(y){const b=y.audioSend.find(R=>R.ssrc===(S==null?void 0:S.ssrcs[0].ssrcId));if(b){if(b.codec!=="opus"&&b.codec!=="aac"&&b.codec!=="PCMU"&&b.codec!=="PCMA"&&b.codec!=="G722"||(v.codecType=b.codec),b.inputLevel)v.sendVolumeLevel=Math.round(32767*b.inputLevel);else{const R=i.getLocalAudioVolume();R&&(v.sendVolumeLevel=Math.round(32767*R))}v.sendBytes=b.bytes,v.sendPackets=b.packets,v.sendPacketsLost=b.packetsLost,v.sendJitterMs=b.jitterMs,v.sendRttMs=b.rttMs,v.sendBitrate=p?8*Math.max(0,v.sendBytes-p.sendBytes):0}}this.trafficStats&&(v.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Qe.LocalAudioTrack,v),v&&S&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,S.track,v);break}}})}updateRemoteStats(i){Array.from(this.remoteStats.entries()).forEach(s=>{var c,l;let[h,{videoStats:p,audioStats:v,videoPcStats:y}]=s;const S=v,b=p,R=y,O=h_({},Z9),N=h_({},eK),Y=h_({},hEe),{audioTrack:W,videoTrack:H,audioSSRC:ne,videoSSRC:re}=i.getRemoteMedia(h);let me;me=this.store.useP2P?i.getStats(!0):i.getStats();const be=(c=me)===null||c===void 0?void 0:c.audioRecv.find(et=>et.ssrc===ne),we=(l=me)===null||l===void 0?void 0:l.videoRecv.find(et=>et.ssrc===re),Se=this.trafficStats&&this.trafficStats.peer_delay.find(et=>et.peer_uid===h);if(be&&(be.codec!=="opus"&&be.codec!=="aac"&&be.codec!=="PCMU"&&be.codec!=="PCMA"&&be.codec!=="G722"||(O.codecType=be.codec),be.outputLevel?O.receiveLevel=Math.round(32767*be.outputLevel):W&&(O.receiveLevel=Math.round(32767*W.getVolumeLevel())),O.receiveBytes=be.bytes,O.receivePackets=be.packets,O.receivePacketsLost=be.packetsLost,O.receivePacketsDiscarded=be.packetsDiscarded,O.packetLossRate=O.receivePacketsLost/(O.receivePackets+O.receivePacketsLost),O.receiveBitrate=S?8*Math.max(0,O.receiveBytes-S.receiveBytes):0,O.totalDuration=S?S.totalDuration+1:1,O.totalFreezeTime=S?S.totalFreezeTime:0,O.freezeRate=O.totalFreezeTime/O.totalDuration,O.receiveDelay=be.jitterBufferMs,O.totalDuration>10&&tw.isRemoteAudioFreeze(W)&&(O.totalFreezeTime+=1)),we){var Le;we.codec!=="H264"&&we.codec!=="H265"&&we.codec!=="VP8"&&we.codec!=="VP9"&&we.codec!=="AV1X"&&we.codec!=="AV1"||(N.codecType=we.codec),N.receiveBytes=we.bytes,N.receiveBitrate=b?8*Math.max(0,N.receiveBytes-b.receiveBytes):0,N.decodeFrameRate=we.decodeFrameRate<0?0:we.decodeFrameRate,N.renderFrameRate=we.decodeFrameRate<0?0:we.decodeFrameRate,we.outputFrame&&(N.renderFrameRate=we.outputFrame.frameRate),we.receivedFrame?(N.receiveFrameRate=we.receivedFrame.frameRate,N.receiveResolutionHeight=we.receivedFrame.height,N.receiveResolutionWidth=we.receivedFrame.width):H&&(N.receiveResolutionHeight=H._videoHeight||0,N.receiveResolutionWidth=H._videoWidth||0),we.framesRateFirefox!==void 0&&(N.receiveFrameRate=Math.round(we.framesRateFirefox)),N.receivePackets=we.packets,N.receivePacketsLost=we.packetsLost,N.packetLossRate=N.receivePacketsLost/(N.receivePackets+N.receivePacketsLost);const et=b?b.totalFreezeTime:0,mt=b?b.totalDuration:0;N.totalDuration=b?b.totalDuration+1:1,N.totalFreezeTime=(Le=we.totalFreezesDuration)!==null&&Le!==void 0?Le:et||0,N.receiveDelay=we.jitterBufferMs||0;const Et=!!re&&i.getRemoteVideoIsReady(re);we.totalFreezesDuration===void 0&&H&&Et&&tw.isRemoteVideoFreeze(H,we,R)&&(N.totalFreezeTime+=1),N.freezeRate=Math.max(0,Math.min((N.totalFreezeTime-et)/(N.totalDuration-mt),1))}Se&&(O.end2EndDelay=Se.B_ad,N.end2EndDelay=Se.B_vd,O.transportDelay=Se.B_ed,N.transportDelay=Se.B_ed,O.currentPacketLossRate=Se.B_ealr4/100,N.currentPacketLossRate=Se.B_evlr4/100,Y.uplinkNetworkQuality=Se.B_punq?Se.B_punq:0,Y.downlinkNetworkQuality=Se.B_pdnq?Se.B_pdnq:0),this.remoteStats.set(h,{audioStats:O,videoStats:N,videoPcStats:we,networkStats:Y}),W&&this.exceptionMonitor.setRemoteAudioStats(W,O),H&&this.exceptionMonitor.setRemoteVideoStats(H,N)})}}class s7{constructor(){ee(this,"destChannelMediaInfos",new Map),ee(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(i){d3(i),this.srcChannelMediaInfo=i}addDestChannelInfo(i){d3(i),this.destChannelMediaInfos.set(i.channelName,i)}removeDestChannelInfo(i){aO(i),this.destChannelMediaInfos.delete(i)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function o7(n){if(!(n instanceof s7))return new Pe(ie.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const i=n.getSrcChannelMediaInfo(),s=n.getDestChannelMediaInfo();if(!i)return new Pe(ie.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Pe(ie.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Xm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(i,s){ee(this,"uid",void 0),ee(this,"_uintid",void 0),ee(this,"_trust_in_room_",!0),ee(this,"_trust_audio_enabled_state_",!0),ee(this,"_trust_video_enabled_state_",!0),ee(this,"_trust_audio_mute_state_",!0),ee(this,"_trust_video_mute_state_",!0),ee(this,"_audio_muted_",!1),ee(this,"_video_muted_",!1),ee(this,"_audio_enabled_",!0),ee(this,"_video_enabled_",!0),ee(this,"_audio_added_",!1),ee(this,"_video_added_",!1),ee(this,"_is_pre_created",!1),ee(this,"_video_pre_subscribed",!1),ee(this,"_audio_pre_subscribed",!1),ee(this,"_trust_video_stream_added_state_",!0),ee(this,"_trust_audio_stream_added_state_",!0),ee(this,"_audioTrack",void 0),ee(this,"_videoTrack",void 0),ee(this,"_dataChannels",[]),ee(this,"_audioSSRC",void 0),ee(this,"_videoSSRC",void 0),ee(this,"_audioOrtc",void 0),ee(this,"_videoOrtc",void 0),ee(this,"_cname",void 0),ee(this,"_rtxSsrcId",void 0),ee(this,"_videoMid",void 0),ee(this,"_audioMid",void 0),this.uid=i,this._uintid=s}}function a7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function c7(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?a7(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):a7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}const nw="9",u7=4e4;function l7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function yp(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?l7(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):l7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}var yS=function(n){return n[n.DOWN=0]="DOWN",n[n.UP=1]="UP",n}(yS||{});const SO=new Map;function d7(n,i,s,c){let{scale:l}=n;if(l===0&&c===yS.UP||l>=i.length-1&&c===yS.DOWN)return n;let h=yp(yp({},n),{},{scale:c===yS.DOWN?++l:--l});switch(s){case"maintain-framerate":h=yp(yp({},h),i[l].motion);break;case"maintain-resolution":h=yp(yp({},h),i[l].detail);break;case"balanced":h=yp(yp({},h),i[l].balanced)}return h}function h7(n,i){if(i){const s={overUse:0,underUse:0,adaptationList:f7(i)};SO.set(n,s)}else SO.delete(n)}function f7(n){const i=yp({},n),{bitrateMax:s,frameRate:c,scaleResolutionDownBy:l,bitrateMin:h}=i,{MIN_FRAME_RATE:p,MAX_THRESHOLD_FRAMERATE:v,MAX_SCALE:y,BITRATE_MIN_THRESHOLD:S,BITRATE_MAX_THRESHOLD:b,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:O,PERF_SCALE_DOWN_THRESHOLD:N,PERF_SCALE_UP_THRESHOLD:Y,BALANCE_BITRATE_FACTOR:W,BALANCE_FRAMERATE_FACTOR:H,BALANCE_RESOLUTION_FACTOR:ne,MOTION_RESOLUTION_FACTOR:re,MOTION_BITRATE_FACTOR:me,DETAIL_FRAMERATE_FACTOR:be,DETAIL_BITRATE_FACTOR:we}=SM,Se=Math.min(i.frameRate,v),Le=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(O,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(N,1)*Se),fps_up:c},balanced:{scaleResolutionDownBy:1,frameRate:c,bitrateMax:s,bitrateMin:h},motion:{scaleResolutionDownBy:1,frameRate:c,bitrateMax:s,bitrateMin:h},detail:{scaleResolutionDownBy:1,frameRate:c,bitrateMax:s,bitrateMin:h}}];for(let et=1;et<=y;et++){const mt={bwe_up:Math.round(Math.pow(R,et)*s),bwe_down:Math.round(Math.pow(O,et+1)*s),fps_up:Math.round(Math.pow(Y,et)*Se),fps_down:Math.round(Math.pow(N,et+1)*Se)},Et={scaleResolutionDownBy:l/Math.pow(ne,et),frameRate:Math.max(Math.round(Math.pow(H,et)*c),p),bitrateMax:Math.max(Math.round(Math.pow(W,et)*s),b),bitrateMin:Math.max(Math.round(Math.pow(W,et)*h),S)},xn={scaleResolutionDownBy:l/Math.pow(re,et),frameRate:c,bitrateMax:Math.max(Math.round(Math.pow(me,et)*s),b),bitrateMin:Math.max(Math.round(Math.pow(me,et)*h),S)},Mn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(be,et)*c),p),bitrateMax:Math.max(Math.round(Math.pow(we,et)*s),b),bitrateMin:Math.max(Math.round(Math.pow(we,et)*h),S)};Le.push({scale:et,threshold:mt,balanced:Et,motion:xn,detail:Mn})}return Le}function kSe(n,i,s,c,l,h){const p=SO.get(n)||{overUse:0,underUse:0,adaptationList:f7(l)},{adaptationList:v}=p;SO.set(n,p);const{OVERUSE_TIMES_THRESHOLD:y,UNDERUSE_TIMES_THRESHOLD:S}=SM,{scale:b}=c;let R,O;return typeof i=="number"&&i>0&&function(N,Y,W,H){if(Y>=W.length)return!1;let{threshold:{fps_down:ne}}=W[Y];return le("FORCE_AG_HIGH_FRAMERATE")&&H==="maintain-framerate"&&(ne=W[0].threshold.fps_down),N<ne}(i,b,v,h)&&(p.overUse++,O=jb.CPU,p.overUse>y)||typeof s=="number"&&s>0&&function(N,Y,W){if(Y>=W.length)return!1;const{threshold:{bwe_down:H}}=W[Y];return N<H}(s,b,v)&&(p.overUse++,O=jb.BANDWIDTH,p.overUse>y)?(p.overUse=0,p.underUse=0,R=d7(c,v,h,yS.DOWN),[R,O]):(typeof i=="number"&&i>0&&typeof s=="number"&&s>0&&function(N,Y,W,H){if(Y===0)return;let{threshold:{fps_up:ne}}=W[Y];return le("FORCE_AG_HIGH_FRAMERATE")&&H==="maintain-framerate"&&(ne=W[1].threshold.fps_up),N>ne}(i,b,v,h)&&function(N,Y,W){if(Y===0)return;const{threshold:{bwe_up:H}}=W[Y];return N>H}(s,b,v)&&(p.underUse++,p.underUse>S&&(p.overUse=0,p.underUse=0,R=d7(c,v,h,yS.UP),R.scale===0&&(O=jb.NONE))),[R,O])}function p7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function vU(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?p7(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):p7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function OSe(n){var i;return!!le("ENABLE_AG_ADAPTATION")&&!!(n instanceof VM||dt(i=n._hints).call(i,Dr.CUSTOM_TRACK))&&(!!le("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(s){const c=zn();if(c.os!==ws.IOS||!c.osVersion)return!1;const l=c.osVersion.split(".");return Number(l[0])>=s}(14)&&l9(17,4)||u9(14)&&d9(17,4,!0)))}const TO=new Map;function bO(n,i){const s=TO.get(n);if(s){const{timer:c}=s;window.clearTimeout(c),TO.delete(n)}i.qualityLimitationReason=jb.NONE,h7(n)}function PSe(n,i){var s;let c;switch(i){case Qe.LocalAudioTrack:c=hr.Audio;break;case Qe.LocalVideoTrack:c=dt(s=n._hints).call(s,Dr.SCREEN_TRACK)?hr.Screen:hr.High;break;case Qe.LocalVideoLowTrack:c=hr.Low}return c}function _U(n){const i=Xn();if(n.some(s=>s._bypassWebAudio))throw new Fe(ie.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!i.webAudioMediaStreamDest)throw new Fe(ie.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function yU(n,i){_U(n);const s=new fs;return n.forEach(c=>s.addAudioTrack(c)),s}const NSe=!Xn().supportUnifiedPlan||le("CHROME_FORCE_PLAN_B")&&up();function wO(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return NSe?(s={spec:i,store:n},vp("PlanBConnection").create(s)):new Kh(i,n)}function EU(n){return n&&(n.iceConnectionState==="disconnected"||n.iceConnectionState==="checking"||n.iceConnectionState==="failed")}function m7(n){try{if(n.iceServers)return!1;if(n.turnServer&&n.turnServer.mode!=="off"){if(Ub(n.turnServer.servers))return!1;if(le("FORCE_TURN_TCP")||n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).some(i=>i.forceturn))return!0}return!1}catch{return!1}}var Bn;function g7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function rh(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?g7(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):g7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}let Kh=(Bn=class M_ extends m3{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,s;return(i=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&i!==void 0?i:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var s;return dt(s=Object.keys(zk)).call(s,i)}))]}constructor(i,s){super(i,s),ee(this,"id",Nr(5,"connection-")),ee(this,"store",void 0),ee(this,"peerConnection",void 0),ee(this,"forceTurn",!1),ee(this,"remoteSDP",void 0),ee(this,"initialOffer",void 0),ee(this,"transportEventReceiver",void 0),ee(this,"statsFilter",void 0),ee(this,"extension",{useXR:le("USE_XR")}),ee(this,"localCapabilities",void 0),ee(this,"remoteCodecs",void 0),ee(this,"localCandidateCount",0),ee(this,"allCandidatesReceived",!1),ee(this,"isPreallocation",!1),ee(this,"preSSRCMap",new Map),ee(this,"dataStreamChannelMap",new Map),ee(this,"establishPromise",void 0),ee(this,"recoveredDataChannelIds",[]),ee(this,"currentDataChannelId",1),ee(this,"supportAV1RtpSpec",!1),ee(this,"mutex",void 0),ee(this,"qualityLimitationReason",jb.NONE),ee(this,"isFirstConnected",!1),this.store=s,this.forceTurn=m7(i),this.mutex=new Co("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(M_.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=_M(this.peerConnection,le("STATS_UPDATE_INTERVAL"),void 0,gi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(i){const s=this.preSSRCMap.get(i);if(s!==void 0){const c=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(c)return{transceiver:c,track:c.receiver.track,id:s}}}async updateRemoteRTPCapabilities(i,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(i,s,this.store.codec)){const c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(c);const h=this.remoteSDP.toString();l==null||l(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const c=await this.peerConnection.createOffer();if(!c.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=$m(c.sdp),h=await x3({filterRTX:!le("USE_PUB_RTX")&&!le("USE_SUB_RTX"),filterVideoFec:le("FILTER_VIDEO_FEC"),filterAudioFec:le("FILTER_AUDIO_FEC"),filterVideoCodec:le("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=gO(h),this.initialOffer=c,le("ENABLE_SVC")&&this.store.codec=="av1"){const v=await async function(){try{const y=new RTCPeerConnection;y.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Bk.L1T3}]});const S=await y.createOffer();if(!S.sdp)return void y.close();const b=Nc(S.sdp).mediaDescriptions[0];if(!b)return;const R=b.attributes.extmaps.find(O=>O.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return y.close(),R}catch{return}}();var i;v&&(this.supportAV1RtpSpec=!0,(i=h.send)===null||i===void 0||i.videoExtensions.push(v))}let p;return c.sdp&&F3(c.sdp)&&(p=yi(h),(s=p).send&&(pS(bt.VIDEO,s.send.videoExtensions),pS(bt.AUDIO,s.send.audioExtensions)),s.recv&&(pS(bt.VIDEO,s.recv.videoExtensions),pS(bt.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(pS(bt.VIDEO,s.sendrecv.videoExtensions),pS(bt.AUDIO,s.sendrecv.audioExtensions))),rh(rh({},l),{},{rtpCapabilities:p||h,offerSDP:c.sdp})}catch(c){throw new Fe(ie.GET_LOCAL_CONNECTION_PARAMS_FAILED,c.toString())}var s}async connect(i){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&F3(this.initialOffer.sdp)&&(s=i.rtpCapabilities,c=this.localCapabilities,s.send&&(fO(bt.VIDEO,s.send.videoExtensions,c.send.videoExtensions),fO(bt.AUDIO,s.send.audioExtensions,c.send.audioExtensions)),s.recv&&(fO(bt.VIDEO,s.recv.videoExtensions,c.recv.videoExtensions),fO(bt.AUDIO,s.recv.audioExtensions,c.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return yi(this._localCapabilities)}get rtpCapabilities(){return yi(this._rtpCapabilities)}get candidates(){return yi(this._candidates)}get iceParameters(){return yi(this._iceParameters)}get dtlsParameters(){return yi(this._dtlsParameters)}constructor(S){let b=arguments.length>1&&arguments[1]!==void 0&&arguments[1];ee(this,"sessionDesc",void 0),ee(this,"_localCapabilities",void 0),ee(this,"_rtpCapabilities",void 0),ee(this,"_candidates",void 0),ee(this,"_originCandidates",void 0),ee(this,"_iceParameters",void 0),ee(this,"_isUseExtmapAllowMixed",void 0),ee(this,"_dtlsParameters",void 0),ee(this,"setup",void 0),ee(this,"currentMidIndex",void 0),ee(this,"cname",void 0),ee(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=b,S=yi(S);const{iceParameters:R,dtlsParameters:O,candidates:N,rtpCapabilities:Y,setup:W,localCapabilities:H,cname:ne}=S;this._rtpCapabilities=Y,this._candidates=N,this._originCandidates=yi(N),this._iceParameters=R,this._dtlsParameters=O,this._localCapabilities=H,this.setup=W,this.cname=ne,this.sessionDesc=this.updateRemoteRTPCapabilities(Y),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(S){const b=this.candidates,R=this.dtlsParameters,O=this.iceParameters,N=this.rtpCapabilities.send;let Y=this.sessionDesc.mediaDescriptions.length-1;for(let W=1;W<S;W++){const H=2*W+2e4,ne=2*W+u7,{ssrcs:re,ssrcGroups:me}=d_([{ssrcId:H}],this.cname),{ssrcs:be,ssrcGroups:we}=d_([{ssrcId:ne,rtx:le("USE_SUB_RTX")?ne+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:nw,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.videoCodecs.map(Se=>Se.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:O.iceUfrag,icePwd:O.icePwd,unrecognized:[],candidates:b,extmaps:N.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:be,ssrcGroups:we,rtcpFeedbackWildcards:[],payloads:N.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++Y)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:nw,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.audioCodecs.map(Se=>Se.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:O.iceUfrag,icePwd:O.icePwd,unrecognized:[],candidates:b,extmaps:N.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:re,ssrcGroups:me,rtcpFeedbackWildcards:[],payloads:N.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++Y)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return zm(this.sessionDesc)}send(S,b,R,O){const{ssrcs:N,ssrcGroups:Y}=d_(b,this.cname,le("SYNC_GROUP")?R:void 0),W=this.findPreloadMediaDesc(N);if(W){if(gi()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,W.attributes.mid),O&&(O.twcc||O.remb)){const H=this.sessionDesc.mediaDescriptions.indexOf(W);return this.sessionDesc.mediaDescriptions[H]=this.mungSendMediaDesc(W,O),{mid:W.attributes.mid,needExchangeSDP:!0}}return{mid:W.attributes.mid,needExchangeSDP:!1}}{const H=this.findAvailableMediaIndex(S,N);let ne;return H===-1||H===1&&(uo()||function(){const re=zn();return!(re.name!==nr.CHROME||!re.osVersion)&&Number(re.version)<=90}()||le("ENABLE_ENCODED_TRANSFORM")&&cp())||H===0&&le("USE_SUB_RTX")||h9()?(ne=this.createOrRecycleSendMedia(S,N,Y,"sendonly",O),this.updateBundleMids()):(ne=yi(this.sessionDesc.mediaDescriptions[H]),ne.attributes.direction="sendonly",ne.attributes.ssrcs=N,ne.attributes.ssrcGroups=Y,this.sessionDesc.mediaDescriptions[H]=this.mungSendMediaDesc(ne,O)),gi()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,ne.attributes.mid),{mid:ne.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:S,needExchangeSDP:b}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:S.attributes.mid,needExchangeSDP:b}}batchSend(S){const b=S.map(N=>{let{kind:Y,ssrcMsg:W,mslabel:H}=N;return this.send(Y,W,H)}),R=[];let O=!1;return b.forEach(N=>{let{mid:Y,needExchangeSDP:W}=N;W&&(O=!0),R.push(Y)}),{mids:R,needExchangeSDP:O}}stopSending(S){const b=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&S.indexOf(R.attributes.mid)!==-1);if(b.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");b.forEach(R=>{R.attributes.mid==="0"||gi()||h9()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(S){const b=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===S);if(!b)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.mute."));b.attributes.direction="inactive"}unmute(S){const b=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===S);if(!b)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.unmute."));b.attributes.direction="sendonly"}muteRemote(S){const b=this.sessionDesc.mediaDescriptions.filter(R=>dt(S).call(S,R.attributes.mid||""));if(b.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");b.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(S){const b=this.sessionDesc.mediaDescriptions.filter(R=>dt(S).call(S,R.attributes.mid||""));if(b.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");b.forEach(R=>{R.attributes.direction="recvonly"})}receive(S,b,R,O){S.forEach((N,Y)=>{this.createOrRecycleRecvMedia(N,[],"recvonly",b,R,O[Y])}),this.updateBundleMids()}stopReceiving(S){const b=this.sessionDesc.mediaDescriptions.filter(R=>S.indexOf(R.attributes.mid)!==-1);if(b.length!==S.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");b.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(S){const b=this.sessionDesc||Nc((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=S;const O=this.rtpCapabilities.send,N=this.localCapabilities.send;for(const Y of b.mediaDescriptions){if(Y.attributes.iceUfrag=this._iceParameters.iceUfrag,Y.attributes.icePwd=this._iceParameters.icePwd,Y.attributes.fingerprints=this._dtlsParameters.fingerprints,Y.attributes.candidates=this._candidates,Y.attributes.setup=this.setup,Y.media.mediaType==="application"&&(Y.attributes.sctpPort="5000"),Y.media.mediaType==="video"){if(O.videoCodecs.length===0){const W=N.videoCodecs.filter(H=>{var ne,re;return(ne=H.rtpMap)===null||ne===void 0?void 0:dt(re=ne.encodingName.toLowerCase()).call(re,"vp8")})||[N.videoCodecs[0]];Y.media.fmts=W.map(H=>H.payloadType.toString(10)),Y.attributes.payloads=W,Y.attributes.extmaps=[]}else if(Y.media.fmts=O.videoCodecs.map(W=>W.payloadType.toString(10)),Y.attributes.payloads=O.videoCodecs,Y.attributes.extmaps=O.videoExtensions,le("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:W,ssrcGroups:H}=d_([{ssrcId:u7,rtx:le("USE_SUB_RTX")?40001:void 0}],this.cname);Y.attributes.ssrcs=W,Y.attributes.ssrcGroups=H}}if(Y.media.mediaType==="audio"){if(O.audioCodecs.length===0){const W=N.audioCodecs.filter(H=>{var ne,re;return(ne=H.rtpMap)===null||ne===void 0?void 0:dt(re=ne.encodingName.toLowerCase()).call(re,"opus")})||[N.audioCodecs[0]];Y.media.fmts=W.map(H=>H.payloadType.toString(10)),Y.attributes.payloads=W,Y.attributes.extmaps=[]}else if(Y.media.fmts=O.audioCodecs.map(W=>W.payloadType.toString(10)),Y.attributes.payloads=O.audioCodecs,Y.attributes.extmaps=O.audioExtensions,gS(Y),le("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:W,ssrcGroups:H}=d_([{ssrcId:2e4}],this.cname);Y.attributes.ssrcs=W,Y.attributes.ssrcGroups=H}}}return this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(S){const b=this._originCandidates.filter(O=>O.transport==="udp"),R=[];if(b.forEach(O=>{R.push(c7(c7({},O),{},{foundation:"tcpcandidate",priority:Number(O.priority)-1+"",transport:"tcp",port:Number(O.port)+90+""}))}),b.length!==0){switch(S){case Io.TCP_RELAY:this._candidates=R;break;case Io.UDP_TCP_RELAY:case Io.RELAY:this._candidates=[...b,...R];break;default:this._candidates=b}for(const O of this.sessionDesc.mediaDescriptions)O.attributes.candidates=this.candidates}}restartICE(S){S=yi(S),this._iceParameters=S,this.sessionDesc.mediaDescriptions.forEach(b=>{b.attributes.iceUfrag=S.iceUfrag,b.attributes.icePwd=S.icePwd})}predictReceivingMids(S){const b=[];for(let R=0;R<S;R++)b.push((this.currentMidIndex+R+1).toString(10));return b}findAvailableMediaIndex(S,b){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const O=R.media.mediaType===S&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(gi()){if(O){const N=this.firefoxSsrcMidMap.get(b[0].ssrcId);return!(N||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!N||N!==R.attributes.mid)}return!1}return O})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const S="".concat(this.currentMidIndex),b={media:{mediaType:"application",port:nw,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(S),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(b),{mediaDesc:b,needExchangeSDP:!0}}createOrRecycleRecvMedia(S,b,R,O,N,Y){const W=S._mediaStreamTrack.kind,H=this.rtpCapabilities.recv,ne=Jb(W,H,this.localCapabilities.send,W===bt.VIDEO?O:N),re=W===bt.VIDEO?H.videoExtensions:H.audioExtensions;this.currentMidIndex+=1;const me="".concat(this.currentMidIndex);let be={media:{mediaType:W,port:nw,protos:["UDP","TLS","RTP","SAVPF"],fmts:ne.map(Se=>Se.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:re,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:ne,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(me)}};be=this.mungRecvMediaDsec(be,S,Y);const we=this.findFirstClosedMedia(W);if(we){const Se=this.sessionDesc.mediaDescriptions.indexOf(we);this.sessionDesc.mediaDescriptions[Se]=be}else this.sessionDesc.mediaDescriptions.push(be);return be}updateRemoteCodec(S,b,R){const O=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(be=>be.rtpMap&&be.rtpMap.encodingName.toLowerCase()||"").filter(be=>{var we;return dt(we=Object.keys(zk)).call(we,be)}))],N=new Set(b);if(O.every(be=>N.has(be)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(b)),!1;const Y=this._rtpCapabilities.recv.videoCodecs.filter(be=>b.some(we=>{var Se;return dt(Se=be.rtpMap&&be.rtpMap.encodingName.toLowerCase()||"").call(Se,we)}));if(Y.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(O," codecs: ").concat(b)),!1;const W=[...new Set(Y.map(be=>be.rtpMap&&be.rtpMap.encodingName.toLowerCase()||""))];let H;if(x.debug("updateRemoteCodec, from ".concat(O," to ").concat(W)),S.length===0)H=this.sessionDesc.mediaDescriptions.filter(be=>be.media.mediaType==="video"&&be.attributes.direction==="recvonly");else if(H=this.sessionDesc.mediaDescriptions.filter(be=>be.attributes.mid&&dt(S).call(S,be.attributes.mid)&&be.attributes.direction==="recvonly"),H.length!==S.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(S,", codecs: ").concat(b)),!1;if(le("USE_PUB_RTX")||le("USE_SUB_RTX")){const be=oU(Y,this.rtpCapabilities.recv.videoCodecs);Y.push(...be)}this._rtpCapabilities.recv.videoCodecs=Y;const ne=this.localCapabilities.send,re=this.rtpCapabilities.recv,me=Jb(bt.VIDEO,re,ne,R);return H.forEach(be=>{const we=me.map(Se=>Se.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(be.attributes.mid,", from"),be.attributes.payloads,"to",me),be.attributes.payloads=me,be.media.fmts=we}),!0}createOrRecycleSendMedia(S,b,R,O,N){const Y=this.rtpCapabilities.send,W=S===bt.VIDEO?Y.videoCodecs:Y.audioCodecs,H=S===bt.VIDEO?Y.videoExtensions:Y.audioExtensions;this.currentMidIndex+=1;const ne="".concat(this.currentMidIndex);let re={media:{mediaType:S,port:nw,protos:["UDP","TLS","RTP","SAVPF"],fmts:W.map(be=>be.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:H,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:W,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:O,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ne)}};re=this.mungSendMediaDesc(re,N);const me=this.findFirstClosedMedia(S);if(me){const be=this.sessionDesc.mediaDescriptions.indexOf(me);this.sessionDesc.mediaDescriptions[be]=re}else this.sessionDesc.mediaDescriptions.push(re);return re}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(S=>S.media.port!=="0").map(S=>S.attributes.mid)}mungRecvMediaDsec(S,b,R){const O=yi(S);return iU(O),mS(O,b),sU(O,b),D3(O),mO(O,R,this.localCapabilities.send),O}mungSendMediaDesc(S,b){const R=yi(S);return mO(R,b,this.localCapabilities.recv),gS(R),R}updateRecvMedia(S,b){const R=this.sessionDesc.mediaDescriptions.findIndex(O=>O.attributes.mid===S);if(R!==-1){const O=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],b);this.sessionDesc.mediaDescriptions[R]=O}}bumpMid(S){this.currentMidIndex+=S}findFirstClosedMedia(S){return this.sessionDesc.mediaDescriptions.find(b=>gi()?b.media.port==="0"&&b.media.mediaType===S:b.media.port==="0")}findPreloadMediaDesc(S){return this.sessionDesc.mediaDescriptions.find(b=>{var R;return((R=b.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===S[0].ssrcId})}getSSRC(S){var b;return(b=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===S))===null||b===void 0?void 0:b.attributes.ssrcs}}(rh(rh({},i),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),i.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString(),h=U3(this.initialOffer.sdp,this.extension),p=this.logSDPExchange(h||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),p==null||p(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l});const v=this.peerConnection.getTransceivers()[0];if(v!=null&&v.receiver&&this.tryBindTransportEvents(v.receiver),le("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(le("PRELOAD_MEDIA_COUNT"));const S=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:S});const b=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(b)}const{preSSRCs:y}=i;if(Array.isArray(y)&&y.length>0){const{mids:S}=this.remoteSDP.batchSend(y.map(b=>({kind:b.kind,ssrcMsg:[{ssrcId:b.ssrcId,rtx:b.rtx}],mslabel:b.mslabel})));S.forEach((b,R)=>{this.preSSRCMap.set(y[R].ssrcId,b)}),await Qb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(l){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}var s,c}async updateRemoteConnect(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:s}=i;this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:c}=i;if(Array.isArray(c)&&c.length>0){const{mids:l}=this.remoteSDP.batchSend(c.map(h=>Object.assign({},{kind:h.kind,ssrcMsg:[{ssrcId:h.ssrcId,rtx:h.rtx}],mslabel:h.mslabel})));l.forEach((h,p)=>{this.preSSRCMap.set(c[p].ssrcId,h)})}await Qb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(i,s,c){var l=this;return wl(function*(){const h=yield Wn(l.mutex.lock("From P2PConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const p=[],v=hO();i.forEach(H=>{const ne=l.peerConnection.addTransceiver(H._mediaStreamTrack,rh({direction:"sendonly"},H.trackMediaType==="video"&&l.supportAV1RtpSpec&&v?{sendEncodings:[{scalabilityMode:v}]}:{}));p.push(ne),H._updateRtpTransceiver(ne)}),gi()&&le("SIMULCAST")===!0&&(yield Wn(l.applySimulcastForFirefox(p,i)));const y=yield Wn(l.peerConnection.createOffer()),S=l.remoteSDP.predictReceivingMids(i.length),b=l.mungSendOfferSDP(y.sdp,i,S),R=Nc(b),O=S.map(H=>{const ne=R.mediaDescriptions.find(re=>re.attributes.mid===H);if(!ne)throw new Error("Cannot extract ssrc from mediaDescription.");return O3(ne,le("USE_PUB_RTX"))});let N;try{N=yield O}catch(H){N=[],l.remoteSDP.receive(i,s,c,N);const ne=l.remoteSDP.toString();throw yield Wn(l.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Wn(l.peerConnection.setRemoteDescription({type:"answer",sdp:ne})),yield Wn(l.stopSending(S,!0)),H}l.remoteSDP.receive(i,s,c,N);const Y=l.remoteSDP.toString(),W=l.logSDPExchange(b,"offer","local","send");return yield Wn(l.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Wn(l.applySimulcastEncodings(p,i)),yield Wn(l.applySendEncodings(p,i)),W==null||W(Y),yield Wn(l.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),p.map((H,ne)=>{const re=S[ne];return{localSSRC:O[ne],id:re,transceiver:H}})}catch(p){throw p instanceof Fe?p:new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(p.toString()))}finally{h()}})()}async createDataChannels(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let c=this.dataStreamChannelMap.get(i);if(c&&c.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const h=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof h!="number")throw new Error("create DataChannel error, because cannot get dc id");c=this.peerConnection.createDataChannel("datastream-channel",{id:h,negotiated:!0,ordered:!1,maxRetransmits:le("DATASTREAM_MAX_RETRANSMITS")}),c.binaryType="arraybuffer",this.dataStreamChannelMap.set(i,c)}s.forEach(h=>{h._updateOriginDataChannel(c)});const{needExchangeSDP:l}=this.remoteSDP.sendDataChannel();if(l){const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(c){throw c instanceof Fe?c:new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(c.toString()))}}async stopDataChannels(i){try{const s=this.dataStreamChannelMap.get(i);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(i)}catch(s){throw s instanceof Fe?s:new Fe(ie.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(i,s){const c=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const l=this.peerConnection.getTransceivers().filter(y=>i.indexOf(y.mid)!==-1);if(l.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");l.map(y=>{var S;bO(this.id+y.mid,this),y.direction="inactive",(S=y.stop)===null||S===void 0||S.call(y)});const h=await this.peerConnection.createOffer(),p=this.logSDPExchange(h.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(h),this.remoteSDP.stopReceiving(i);const v=this.remoteSDP.toString();p==null||p(v),await this.peerConnection.setRemoteDescription({type:"answer",sdp:v})}catch(l){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(l.toString()))}finally{c&&c()}}async receive(i,s,c,l){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=this.remoteSDP.send(i,s,c,l);p&&(await Qb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP.")));const v=this.peerConnection.getTransceivers().find(y=>y.mid===h);if(!v)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:v.receiver.track,id:h,transceiver:v}}catch(h){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:c}=this.remoteSDP.batchSend(i);return c&&(await Qb(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(l=>{const h=this.peerConnection.getTransceivers().find(p=>p.mid===l);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:l,transceiver:h}})}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");i.forEach(h=>{Array.from(this.preSSRCMap.entries()).some(p=>{let[v,y]=p;if(y===h)return this.preSSRCMap.delete(v),!0})}),this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const l=await this.peerConnection.createAnswer();c==null||c(l.sdp||""),await this.peerConnection.setLocalDescription(l)}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.mute(i);const s=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const l=await this.peerConnection.createAnswer();c==null||c(l.sdp||""),await this.peerConnection.setLocalDescription(l)}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.unmute(i);const s=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const l=await this.peerConnection.createAnswer();c==null||c(l.sdp||""),await this.peerConnection.setLocalDescription(l)}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(p=>p.mid&&i.indexOf(p.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(p=>{p.direction="inactive"});const c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(c),this.remoteSDP.muteRemote(i);const h=this.remoteSDP.toString();l==null||l(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(p=>p.mid&&i.indexOf(p.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(p,v)=>{p.direction="sendonly"});const c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(c),this.remoteSDP.unmuteRemote(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(i,this.remoteCodecs,this.store.codec);const h=this.remoteSDP.toString();l==null||l(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(i){var s=this;return wl(function*(){const c=yield Wn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const l=Xn().supportPCSetConfiguration,h=le("FORCE_TURN_TCP")||s.forceTurn;if(i===Io.RELAY&&!l)return;if(l&&!h){const R=i===Io.RELAY?"relay":"all",O=s.peerConnection.getConfiguration();O.iceTransportPolicy!==R&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(O.iceTransportPolicy,"] to [").concat(R,"]")),O.iceTransportPolicy=R,s.peerConnection.setConfiguration(O))}s.remoteSDP.updateCandidates(i);const p=yield Wn(s.peerConnection.createOffer({iceRestart:!0}));if(!p.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const v=$m(p.sdp),{remoteIceParameters:y}=yield v.iceParameters;s.remoteSDP.restartICE(y);const S=s.remoteSDP.toString(),b=s.logSDPExchange(p.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield Wn(s.peerConnection.setLocalDescription(p)),b==null||b(S),yield Wn(s.peerConnection.setRemoteDescription({type:"answer",sdp:S}))}catch(l){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),l)}finally{c()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const i=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Io.TCP_RELAY),await Qb(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{i()}}close(){var i;this.peerConnection.getTransceivers().forEach(s=>{bO(this.id+s.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return rh(rh({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const c=await this.peerConnection.createOffer(),l=this.mungSendOfferSDP(c.sdp,[s],[i]);this.remoteSDP.updateRecvMedia(i,s);const h=this.remoteSDP.toString(),p=this.logSDPExchange(l,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),p==null||p(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new Fe(ie.EXCHANGE_SDP_FAILED,c.toString())}}async updateSendParameters(i,s){const c=this.peerConnection.getTransceivers().filter(l=>l.mid===i);c.length===1&&(this.isVP8Simulcast(s)?gi()||await this.applySimulcastEncodings(c,[s]):await this.applySendEncodings(c,[s]))}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const c=this.peerConnection.getTransceivers().find(l=>l.mid===s);c&&await c.sender.replaceTrack(i._mediaStreamTrack)}async getSelectedCandidatePair(){const i=this.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const s=i[0].transport.iceTransport,{local:c,remote:l}=s.getSelectedCandidatePair();return{local:rh(rh({},jh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port}),remote:rh(rh({},jh),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=i=>{if(i&&(i.errorCode||i.errorText)){var s;const c="code: ".concat(i.errorCode,", message: ").concat(i.errorText),l=i.port?"local: ".concat(i.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(c,"), url: ").concat(i.url||"",", host_candidate:").concat(l)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,c)}},this.peerConnection.onicegatheringstatechange=i=>{i&&i.target&&"iceGatheringState"in i.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(i.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},le("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const s={iceServers:[]};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&(Ub(i.turnServer.servers)?s.iceServers=i.turnServer.servers:le("NEW_TURN_MODE")&&s.iceServers?(le("USE_TURN_SERVER_OF_GATEWAY")?i.turnServer.serversFromGateway&&s.iceServers.push(...M_.newTurnServerConfigToIceServers(i.turnServer.serversFromGateway)):s.iceServers.push(...M_.newTurnServerConfigToIceServers(i.turnServer.servers)),le("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):i.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...M_.turnServerConfigToIceServers(i.turnServer.servers)),le("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...M_.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),le("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(s.iceTransportPolicy="relay")}))),le("ENABLE_ENCODED_TRANSFORM")&&Xn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(c=>{c.security?c.tcpport&&s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Km(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}):(c.udpport&&!le("FORCE_TURN_TCP")&&s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.udpport,"?transport=udp")}),c.tcpport&&s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(i){const s=[];return i.forEach(c=>{const l=le("NEW_TURN_MODE");l===1?s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":3478?transport=udp")}):l===2?s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":3478?transport=tcp")}):l===3?s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Km(c.turnServerURL),":443?transport=tcp")}):l===4&&(s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":3478?transport=udp")}),s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":3478?transport=tcp")}),s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Km(c.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(i){const s=i.transport;if(s){this.transportEventReceiver=i,s.onstatechange=()=>{var l;s!=null&&s.state&&((l=this.onDTLSTransportStateChange)===null||l===void 0||l.call(this,s.state))},s.onerror=l=>{var h;(h=this.onDTLSTransportError)===null||h===void 0||h.call(this,"error"in l?l.error:l)};const c=s.iceTransport;c&&(c.onstatechange=()=>{const l=s==null?void 0:s.iceTransport.state;var h;l&&((h=this.onICETransportStateChange)===null||h===void 0||h.call(this,l))},c.getSelectedCandidatePair&&(c.onselectedcandidatepairchange=()=>{if(c.getSelectedCandidatePair()){const{local:l,remote:h}=c.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol}),", remote ").concat(JSON.stringify({candidateType:h.type,protocol:h.protocol,address:h.address,port:h.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(i,s){var c,l;if(s||(s=this.peerConnection.getSenders().find(H=>H.track===i._mediaStreamTrack)),!s)return x.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(i))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Xn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const h={},p={};switch(i._optimizationMode){case"motion":h.degradationPreference="maintain-framerate";break;case"detail":h.degradationPreference="maintain-resolution";break;case"balanced":h.degradationPreference="balanced"}const v=function(W,H){return W.getTransceivers().find(ne=>ne.sender.track===H||ne.receiver.track===H)}(this.peerConnection,i._mediaStreamTrack),y=vEe(i);if(OSe(i)&&v&&s&&y&&this.getLocalVideoStats&&dt(c=["vp8","vp9"]).call(c,this.store.codec)){var S;const W=h.degradationPreference||(dt(S=i._hints).call(S,Dr.CUSTOM_TRACK)?le("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(H,ne,re,me,be,we){if(bO(H,re),be(ne),me!=="balanced"&&me!=="maintain-framerate"&&me!=="maintain-resolution")return;let Se=-1;h7(H,ne);const Le=window.setInterval(()=>{const mt=TO.get(H);if(!le("ENABLE_AG_ADAPTATION")||!mt)return bO(H,re),void be(ne);const Et=we();if(Et.sendPackets>0&&Et.OutgoingAvailableBandwidth>0){if(Se===-1)return void(Se=Date.now());if(Date.now()-Se<1e3)return;const xn=Et.sendFrameRate,Mn=Et.OutgoingAvailableBandwidth,[Lr,Vi]=kSe(H,xn,Mn,mt.adaptationConfig,ne,me);Vi&&(re.qualityLimitationReason=Vi),Lr&&mt.adaptationConfig.scale!==Lr.scale&&(x.debug("[".concat(H,"] applyAdaptation: ").concat(re.qualityLimitationReason,`
           sendFps `).concat(xn,", bwe ").concat(Mn,", switch from ").concat(mt.adaptationConfig.scale," to ").concat(Lr.scale," ")),mt.adaptationConfig=vU(vU({},mt.adaptationConfig),Lr),be(Lr))}},le("CHECK_LOCAL_STATS_INTERVAL")),et=vU({},ne);TO.set(H,{timer:Le,adaptationConfig:et,originConfig:ne,adaptationFunc:be}),x.debug("[".concat(H,"] start adaptation, originConfig: ").concat(JSON.stringify(ne),", degradationPreference: ").concat(me))})(this.id+v.mid,y,this,W,H=>{s&&this.updateAdaptation(s,H)},this.getLocalVideoStats.bind(this))}if(i._encoderConfig){var b;const{bitrateMax:W,frameRate:H,scaleResolutionDownBy:ne}=i._encoderConfig;W&&(p.maxBitrate=1e3*W),(dt(b=i._hints).call(b,Dr.LOW_STREAM)||i.isUseScaleResolutionDownBy)&&(H&&(p.maxFramerate=du(H)),ne&&ne>=1&&(p.scaleResolutionDownBy=ne))}const{maxFramerate:R}=le("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(p.maxFramerate=p.maxFramerate?Math.min(p.maxFramerate,R):R),le("DSCP_TYPE")&&up()){var O;const W=le("DSCP_TYPE");dt(O=["very-low","low","medium","high"]).call(O,W)&&(p.networkPriority=W)}const N=s.getParameters(),Y=(l=N.encodings)===null||l===void 0?void 0:l[0];gi()&&!Y&&(h.encodings=[p]),Y&&Object.assign(Y,p),Object.assign(N,h),x.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(N.encodings))),await s.setParameters(N),await async function(W,H,ne){try{var re;if(!Xn().supportSetRtpSenderParameters||!function(Le){return Le==="vp9"||Le==="av1"}(W)||!le("ENABLE_SVC"))return;const me={},be={},we=H.getParameters(),Se=(re=we.encodings)===null||re===void 0?void 0:re[0];be.scalabilityMode=hO(ne),Se&&Object.assign(Se,be),Object.assign(we,me),await H.setParameters(we),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(we.encodings)))}catch(me){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",me)}}(this.store.codec,s,le("SVC_MODE"))}async updateAdaptation(i,s){var c,l;if(!i)return x.debug("[updateAdaptation] no rtpSender found");if(!Xn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const h={},{bitrateMax:p,frameRate:v,scaleResolutionDownBy:y}=s;p&&(h.maxBitrate=1e3*p),v&&(h.maxFramerate=du(v)),y&&y>=1&&dt(c=["vp8","vp9"]).call(c,this.store.codec)&&(h.scaleResolutionDownBy=y);const S=i.getParameters(),b=(l=S.encodings)===null||l===void 0?void 0:l[0];b&&Object.assign(b,h),Object.assign(S,{});try{await i.setParameters(S),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(S.encodings)))}catch(R){!("transport"in i)||i.transport&&i.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(i,s){try{if(!Xn().supportSetRtpSenderParameters||i.length!==s.length)return;for(let c=0;c<i.length;c++){const l=i[c],h=s[c];h instanceof qr&&!this.isVP8Simulcast(h)&&await this.updateRtpSenderEncodings(h,l.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,s,c){const l=Nc(i);return s.forEach((h,p)=>{const v=c[p],y=l.mediaDescriptions.find(S=>S.attributes.mid===v);y&&(mS(y,h),L3(y,h,this.store.codec))}),zm(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,c)=>{var l;(l=this.onFirstVideoDecoded)===null||l===void 0||l.call(this,i,s,c)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var c;(c=this.onSelectedLocalCandidateChanged)===null||c===void 0||c.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var c;(c=this.onSelectedRemoteCandidateChanged)===null||c===void 0||c.call(this,i,s)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,s){if(i.length===s.length)for(let y=0;y<i.length;y++){var c,l,h,p,v;const S=i[y],b=s[y];if(b instanceof qr&&!dt(c=b._hints).call(c,Dr.LOW_STREAM)&&(l=b._encoderConfig)!==null&&l!==void 0&&l.bitrateMax&&((h=b._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)>200&&(p=b._scalabilityMode)!==null&&p!==void 0&&p.numSpatialLayers&&((v=b._scalabilityMode)===null||v===void 0?void 0:v.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},O={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:O.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:O.high}];const N=S.sender.getParameters();await S.sender.setParameters(Object.assign(N,R))}}}async applySimulcastEncodings(i,s){if(!gi()&&i.length===s.length)for(let c=0;c<i.length;c++){const l=s[c];if(l instanceof qr&&this.isVP8Simulcast(l)){const h=i[c],p={},v={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:v.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:v.medium,scaleResolutionDownBy:4}];const y=h.sender.getParameters();await h.sender.setParameters(Object.assign(y,p))}}}isVP8Simulcast(i){var s,c,l,h,p;return!!(i instanceof qr&&le("SIMULCAST")&&this.store.codec==="vp8"&&!dt(s=i._hints).call(s,Dr.LOW_STREAM)&&(c=i._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((l=i._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(h=i._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=i._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1)}logSDPExchange(i,s,c,l){if(le("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(c," ").concat(s," SDP during P2PConnection.").concat(l,`
`),i),s==="offer"?h=>{this.logSDPExchange(h,"answer",c==="local"?"remote":"local",l)}:void 0}async getRemoteSSRC(i){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(i);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(i){if(Xn().supportPCSetConfiguration){const s=M_.resolvePCConfiguration(i);this.peerConnection.setConfiguration(s)}}},Ct(Bn.prototype,"updateRemoteRTPCapabilities",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"updateRemoteRTPCapabilities"),Bn.prototype),Ct(Bn.prototype,"connect",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"connect"),Bn.prototype),Ct(Bn.prototype,"updateRemoteConnect",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"updateRemoteConnect"),Bn.prototype),Ct(Bn.prototype,"createDataChannels",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"createDataChannels"),Bn.prototype),Ct(Bn.prototype,"receive",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"receive"),Bn.prototype),Ct(Bn.prototype,"batchReceive",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"batchReceive"),Bn.prototype),Ct(Bn.prototype,"stopReceiving",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"stopReceiving"),Bn.prototype),Ct(Bn.prototype,"muteRemote",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"muteRemote"),Bn.prototype),Ct(Bn.prototype,"unmuteRemote",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"unmuteRemote"),Bn.prototype),Ct(Bn.prototype,"muteLocal",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"muteLocal"),Bn.prototype),Ct(Bn.prototype,"unmuteLocal",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"unmuteLocal"),Bn.prototype),Ct(Bn.prototype,"close",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"close"),Bn.prototype),Ct(Bn.prototype,"updateEncoderConfig",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"updateEncoderConfig"),Bn.prototype),Ct(Bn.prototype,"updateSendParameters",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"updateSendParameters"),Bn.prototype),Ct(Bn.prototype,"replaceTrack",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"replaceTrack"),Bn.prototype),Ct(Bn.prototype,"updateAdaptation",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"updateAdaptation"),Bn.prototype),Ct(Bn.prototype,"getRemoteSSRC",[rc],Object.getOwnPropertyDescriptor(Bn.prototype,"getRemoteSSRC"),Bn.prototype),Bn);function rc(n,i,s){const c=n[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const l=this.mutex,h=await l.lock("From P2PConnection.".concat(i));try{for(var p=arguments.length,v=new Array(p),y=0;y<p;y++)v[y]=arguments[y];return await c.apply(this,v)}finally{h()}},s}function SU(n,i){let s=document.createElement("video"),c=document.createElement("canvas");s.setAttribute("style","display:none"),c.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),c.width=du(i.width),c.height=du(i.height);const l=du(i.framerate||15);document.body.append(s),document.body.append(c);let h=n._mediaStreamTrack;s.srcObject=new MediaStream([h]),s.play();const p=c.getContext("2d");if(!p)throw new Pe(ie.UNEXPECTED_ERROR,"can not get canvas context");const v=Xn(),y=c.captureStream(v.supportRequestFrame?0:l).getVideoTracks()[0];y.canvas||(y.canvas=c),c.startCapture=()=>{if(!s)return c.stopCapture&&c.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const b=s.videoWidth,R=s.videoHeight/b,O=c.width*R;Math.abs(O-c.height)>=2&&(x.debug("adjust low stream resolution","".concat(c.width,"x").concat(c.height," -> ").concat(c.width,"x").concat(O)),c.height=O)}p.drawImage(s,0,0,c.width,c.height),y.requestFrame&&y.requestFrame(),h!==n._mediaStreamTrack&&(h=n._mediaStreamTrack,s.srcObject=new MediaStream([h]))},c.stopCapture=NM(()=>c.startCapture&&c.startCapture(),l);const S=y.stop;return y.stop=()=>{S.call(y),s&&(s.remove(),s.srcObject=null,s=null),c&&(c.width=0,c.remove(),c.stopCapture&&c.stopCapture(),c.startCapture=void 0,c.stopCapture=void 0,c=null),x.debug("clean low stream renderer")},y}var CO=function(n){return n[n.HEIGHT=2033]="HEIGHT",n[n.FRAME_RATE=2034]="FRAME_RATE",n[n.WIDTH=2035]="WIDTH",n}(CO||{}),Xi=function(n){return n[n.FRAME_RATE=2002]="FRAME_RATE",n[n.WIDTH=2003]="WIDTH",n[n.HEIGHT=2004]="HEIGHT",n[n.PACKAGE_LOST=2005]="PACKAGE_LOST",n[n.AVG_ENCODE=2007]="AVG_ENCODE",n[n.NACKS=2009]="NACKS",n[n.PLIS=2010]="PLIS",n[n.FIRS=2011]="FIRS",n[n.BITRATE=2012]="BITRATE",n[n.PACKAGE_RATE=2031]="PACKAGE_RATE",n[n.ADAPTATION=2032]="ADAPTATION",n[n.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",n[n.BANDWIDTH=2061]="BANDWIDTH",n[n.RETRANSMIT=2062]="RETRANSMIT",n[n.TARGET_ENCODED=2064]="TARGET_ENCODED",n[n.TRANSMIT=2066]="TRANSMIT",n[n.FREEZE=2082]="FREEZE",n[n.DISABLED=2095]="DISABLED",n[n.PLAYER_STATUS=2128]="PLAYER_STATUS",n[n.QP_SUM=2143]="QP_SUM",n[n.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",n[n.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",n[n.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",n[n.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",n}(Xi||{}),f_=function(n){return n[n.BITRATE=2069]="BITRATE",n[n.PACKAGE_LOST=2070]="PACKAGE_LOST",n[n.PACKAGE_RATE=2071]="PACKAGE_RATE",n[n.HEIGHT=2073]="HEIGHT",n[n.FRAME_RATE=2075]="FRAME_RATE",n[n.WIDTH=2077]="WIDTH",n}(f_||{}),Ji=function(n){return n[n.JITTER=-1]="JITTER",n[n.PACKAGE_LOST=2014]="PACKAGE_LOST",n[n.WIDTH=2018]="WIDTH",n[n.HEIGHT=2019]="HEIGHT",n[n.FRAME_RATE=2020]="FRAME_RATE",n[n.JITTER_BUFFER=2023]="JITTER_BUFFER",n[n.CURRENT_DELAY=2024]="CURRENT_DELAY",n[n.NACKS=2026]="NACKS",n[n.PLIS=2027]="PLIS",n[n.FIRS=2028]="FIRS",n[n.BITRATE=2029]="BITRATE",n[n.PACKAGE_RATE=2078]="PACKAGE_RATE",n[n.FREEZE=2084]="FREEZE",n[n.DISABLED=2101]="DISABLED",n[n.PLAYER_STATUS=2129]="PLAYER_STATUS",n[n.QP_SUM=2144]="QP_SUM",n[n.I_FRAME_DELAY=2149]="I_FRAME_DELAY",n[n.FRAMES_DROPPED=2181]="FRAMES_DROPPED",n[n.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",n[n.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",n[n.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",n[n.AVG_DECODE=2200]="AVG_DECODE",n[n.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",n[n.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",n[n.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",n[n.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",n}(Ji||{}),p_=function(n){return n[n.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",n[n.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",n[n.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",n[n.FREEZE_TIME=2109]="FREEZE_TIME",n[n.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",n[n.FREEZE_DURATION=2156]="FREEZE_DURATION",n}(p_||{}),v7=function(n){return n[n.PCM_LEVEL=2104]="PCM_LEVEL",n}(v7||{}),qh=function(n){return n[n.PACKAGE_LOST=-1]="PACKAGE_LOST",n[n.LEVEL=2038]="LEVEL",n[n.BITRATE=2039]="BITRATE",n[n.PACKAGE_RATE=2040]="PACKAGE_RATE",n[n.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",n[n.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",n[n.FREEZE=2081]="FREEZE",n[n.DISABLED=2096]="DISABLED",n[n.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",n[n.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",n}(qh||{}),ic=function(n){return n[n.BITRATE=2044]="BITRATE",n[n.PACKAGE_LOST=2045]="PACKAGE_LOST",n[n.PACKAGE_RATE=2046]="PACKAGE_RATE",n[n.CURRENT_DELAY=2047]="CURRENT_DELAY",n[n.JITTER_BUFFER=2054]="JITTER_BUFFER",n[n.JITTER=2055]="JITTER",n[n.FREEZE=2083]="FREEZE",n[n.DISABLED=2102]="DISABLED",n[n.PCM_LEVEL=2105]="PCM_LEVEL",n[n.PLAYER_STATUS=2130]="PLAYER_STATUS",n[n.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",n[n.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",n[n.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",n[n.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",n[n.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",n[n.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",n}(ic||{}),_7=function(n){return n[n.FREEZE_TIME=-1]="FREEZE_TIME",n[n.LEVEL=2043]="LEVEL",n}(_7||{}),sc=function(n){return n[n.RTT=2006]="RTT",n[n.CONN_TYPE=801]="CONN_TYPE",n[n.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",n}(sc||{}),RO=function(n){return n[n.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",n}(RO||{});const m_=1e3,g_=6,IO=3,DSe=Math.max(g_,IO);function qt(n,i,s){s!=null&&Number.isFinite(s)&&(n[i]=Math.round(Math.max(0,s)))}function y7(n){const i={[sc.CONN_TYPE]:0,[sc.RTT]:n.rtt,[sc.STATS_UPDATE_INTERVAL]:n.updateInterval?Math.round(Math.max(0,n.updateInterval)):void 0};switch(n.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=n.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(i[sc.CONN_TYPE]=1),s==="tcp"&&(i[sc.CONN_TYPE]=3),s==="tls"&&(i[sc.CONN_TYPE]=4);break}case"srflx":i[sc.CONN_TYPE]=2;break;case"unknown":i[sc.CONN_TYPE]=5;break;default:i[sc.CONN_TYPE]=0}return i}function E7(n){let i=0;switch(n){case"none":i=0;break;case"cpu":i=1;break;case"bandwidth":i=2;break;case"other":i=3}return i}class S7 extends li{constructor(i){super(),ee(this,"store",void 0),ee(this,"uploadWRTCStatsTimer",void 0),ee(this,"uploadOutboundDenoiserStatsTimer",void 0),ee(this,"uploadExtStatsTimer",void 0),ee(this,"uploadExtUsageStatsTimer",void 0),ee(this,"uploadInboundExtStatsTimer",void 0),ee(this,"requestStats",void 0),ee(this,"requestTransportStats",void 0),ee(this,"requestLocalMedia",void 0),ee(this,"requestRemoteMedia",void 0),ee(this,"requestAllTracks",void 0),ee(this,"requestVideoIsReady",void 0),ee(this,"requestUploadStats",void 0),ee(this,"requestUpload",void 0),ee(this,"uploadOutboundStarted",!1),ee(this,"uploadInboundStarted",!1),ee(this,"uploadTransportStarted",!1),ee(this,"uploadBaseStatsStarted",!1),ee(this,"uploadExtensionUsageStarted",!1),ee(this,"lastRecvStats",void 0),ee(this,"lastSendStats",void 0),ee(this,"lastRefRecvStats",void 0),ee(this,"lastRefSendStats",void 0),ee(this,"lastFullRecvStats",void 0),ee(this,"lastFullSendStats",void 0),ee(this,"needUploadRenderFreezeTime",!0),this.store=i}uploadWRTCStats(i){if(!this.requestStats||!this.requestUploadStats)return;const s=i%IO==0,c=i%g_==0;let l,h;if(this.uploadTransportStarted&&(l=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!l&&this.uploadOutboundStarted&&(l=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),l||h){var p;const v={};if(this.uploadTransportStarted&&l){const S=this.getTransportStats(l,h,s);S&&(v.misc=[S])}if(this.uploadOutboundStarted&&l){const S=this.getOutboundStats(l,c?this.lastFullSendStats:s?this.lastRefSendStats:this.lastSendStats,s,c);S&&(v.outbound=[S])}if(this.uploadInboundStarted&&h){const S=this.getInboundStats(h,c?this.lastFullRecvStats:s?this.lastRefRecvStats:this.lastRecvStats,s,c);S&&(v.inbound=S)}const y=(p=this.requestTransportStats)===null||p===void 0?void 0:p.call(this).connectState;y&&(Array.isArray(v.misc)?v.misc[0]&&v.misc[0].addition&&(v.misc[0].addition[RO.RTC_PEER_CONNECTION_STATE]=vM[y]):v.misc=[{addition:{[RO.RTC_PEER_CONNECTION_STATE]:vM[y]}}]),this.requestUploadStats(v)}this.lastRecvStats=h,this.lastSendStats=l,c&&(this.lastFullRecvStats=h,this.lastFullSendStats=l),s&&(this.lastRefRecvStats=h,this.lastRefSendStats=l)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let i=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,c;const l=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(l&&((c=this.requestUploadStats)===null||c===void 0||c.call(this,{misc:[{addition:{[RO.RTC_PEER_CONNECTION_STATE]:vM[l.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(i),++i===DSe+1&&(i=1)},m_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(i,s,c){if(!this.requestStats)return;if(!c)return i.rtt==null?void 0:{addition:{[sc.RTT]:i.rtt,[sc.CONN_TYPE]:void 0,[sc.STATS_UPDATE_INTERVAL]:i.updateInterval||void 0}};const l=y7(i);if(this.store.useP2P){if(s){const h=y7(s);l[sc.CONN_TYPE]+=h[sc.CONN_TYPE]<<3}l[sc.CONN_TYPE]+=110}else l[sc.CONN_TYPE]+=100;return{addition:l}}getOutboundStats(i,s,c,l){if(!this.requestUploadStats||!this.requestLocalMedia)return;const h=this.requestLocalMedia();if(!h||h.length===0)return;let p,v,y;return h.forEach(S=>{let[b,{track:R,ssrcs:O}]=S;switch(b){case Qe.LocalVideoLowTrack:case Qe.LocalVideoTrack:if(b===Qe.LocalVideoTrack){const N=function(H,ne,re,me,be,we){const Se=ne.videoSend.find(Et=>Et.ssrc===H);if(!Se)return;const Le={},{sentFrame:et,inputFrame:mt}=Se;if(we&&(qt(Le,Xi.QP_SUM,Se.qpSumPerFrame),mt&&et)){const Et=mt.frameRate,xn=et.frameRate;Le[Xi.FREEZE]=function(Mn,Lr){let Vi=!0;return Vi=!(Mn<=5)&&(Mn<=10?Lr<3:Mn<=20?Lr<4:Lr<5),Vi}(Et,xn)?1:0}if(be){switch(et&&(qt(Le,Xi.HEIGHT,et.height),qt(Le,Xi.WIDTH,et.width),qt(Le,Xi.FRAME_RATE,et.frameRate)),Le[Xi.DISABLED]=me._originMediaStreamTrack&&!me._originMediaStreamTrack.enabled||me._mediaStreamTrack&&!me._mediaStreamTrack.enabled?1:0,Se.adaptionChangeReason){case"none":Le[Xi.ADAPTATION]=0;break;case"cpu":Le[Xi.ADAPTATION]=1;break;case"bandwidth":Le[Xi.ADAPTATION]=2;break;case"other":Le[Xi.ADAPTATION]=3}let Et=0;Se.adaptionChangeReason&&(Et+=E7(Se.adaptionChangeReason)),ne.qualityLimitationReason&&(Et+=E7(ne.qualityLimitationReason)<<3),Le[Xi.ADAPTATION]=Et,Le[Xi.PLAYER_STATUS]=OM[me._player?me._player.videoElementStatus:"uninit"],qt(Le,Xi.NACKS,Se.nacksCount),qt(Le,Xi.PLIS,Se.plisCount),qt(Le,Xi.FIRS,Se.firsCount),qt(Le,Xi.AVG_ENCODE,Se.avgEncodeMs),qt(Le,Xi.HUGE_FRAME_SENT,Se.hugeFramesSent),qt(Le,Xi.BYTES_RETRANSMIT,Se.retransmittedBytesSent),qt(Le,Xi.PACKAGES_RETRANSMIT,Se.retransmittedPacketsSent),qt(Le,Xi.KEY_FRAMES_ENCODED,Se.keyFramesEncoded);const xn=re&&re.videoSend.find(Mn=>Mn.ssrc===H);if(xn){let Mn=be?m_:m_*g_;xn.timestamp&&Se.timestamp&&(Mn=Se.timestamp-xn.timestamp),xn.packets!=null&&Se.packets!=null&&qt(Le,Xi.PACKAGE_RATE,1e3*(Se.packets-xn.packets)/Mn),Se.packetsLost!=null&&xn.packetsLost!=null&&qt(Le,Xi.PACKAGE_LOST,Se.packetsLost-xn.packetsLost),xn.bytes!=null&&Se.bytes!=null&&qt(Le,Xi.BITRATE,8*(Se.bytes-xn.bytes)/Mn)}}return Le}(O[0].ssrcId,i,s,R,c,l),Y=R&&function(H,ne,re,me){const be=ne.videoSend.find(Se=>Se.ssrc===H);if(!be)return null;const we={};if(me){const Se=be.inputFrame,Le=Se&&Se.height||re.videoHeight||0,et=Se&&Se.width||re.videoWidth||0,mt=Se&&Se.frameRate||0;qt(we,CO.HEIGHT,Le),qt(we,CO.WIDTH,et),qt(we,CO.FRAME_RATE,mt)}return we}(O[0].ssrcId,i,R,c),W=function(H,ne){const re={};return ne&&(qt(re,Xi.RETRANSMIT,H.bitrate.retransmit),qt(re,Xi.TARGET_ENCODED,H.bitrate.targetEncoded),qt(re,Xi.ACTUAL_ENCODED,H.bitrate.actualEncoded),qt(re,Xi.TRANSMIT,H.bitrate.transmit),qt(re,Xi.BANDWIDTH,H.sendBandwidth)),re}(i,c);v=Object.assign({},N,Y,W)}else y=function(N,Y,W,H){const ne=Y.videoSend.find(me=>me.ssrc===N);if(!ne)return;const re={};if(H){const me=ne.sentFrame;if(me&&(qt(re,f_.HEIGHT,me.height),qt(re,f_.WIDTH,me.width),qt(re,f_.FRAME_RATE,me.frameRate)),W){const be=W.videoSend.find(we=>we.ssrc===N);if(be){let we=m_*g_;be.timestamp&&ne.timestamp&&(we=ne.timestamp-be.timestamp),be.packets!=null&&ne.packets!=null&&qt(re,f_.PACKAGE_RATE,1e3*(ne.packets-be.packets)/we),ne.packetsLost!=null&&be.packetsLost!=null&&qt(re,f_.PACKAGE_LOST,ne.packetsLost-be.packetsLost),be.bytes!=null&&ne.bytes!=null&&qt(re,f_.BITRATE,8*(ne.bytes-be.bytes)/we)}}}return re}(O[0].ssrcId,i,s,c);break;case Qe.LocalAudioTrack:p=R&&function(N,Y,W,H,ne){const re=Y.audioSend.find(be=>be.ssrc===N);if(!re)return;const me={};if(ne){me[qh.DISABLED]=H._originMediaStreamTrack&&!H._originMediaStreamTrack.enabled||H._mediaStreamTrack&&!H._mediaStreamTrack.enabled?1:0;const be=100*H._source.getAccurateVolumeLevel(),we=re.inputLevel;if(we!=null){const Le=Math.ceil(50*Math.log10(100*we+1));qt(me,qh.LEVEL,Le)}qt(me,v7.PCM_LEVEL,be),qt(me,qh.AEC_RETURN_LOSS,re.aecReturnLoss),qt(me,qh.AEC_RETURN_LOSS_ENH,re.aecReturnLossEnhancement),qt(me,qh.BYTES_RETRANSMIT,re.retransmittedBytesSent),qt(me,qh.PACKAGES_RETRANSMIT,re.retransmittedPacketsSent),me[qh.FREEZE]=0;const Se=W&&W.audioSend.find(Le=>Le.ssrc===N);if(Se){let Le=m_*g_;Se.timestamp&&re.timestamp&&(Le=re.timestamp-Se.timestamp),Se.bytes!=null&&re.bytes!=null&&qt(me,qh.BITRATE,8*(re.bytes-Se.bytes)/Le),Se.packets!=null&&re.packets!=null&&qt(me,qh.PACKAGE_RATE,1e3*(re.packets-Se.packets)/Le)}}return me}(O[0].ssrcId,i,s,R,c)}}),{high:v,low:y,audio:p}}getInboundStats(i,s,c,l){if(!this.requestRemoteMedia)return;const h=this.requestRemoteMedia()||[],p=[];return h.forEach(v=>{let[y,S]=v;const b={peer:y.uid};if(S.has(bt.VIDEO)&&y.videoTrack){const R=y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)||!1,O=y.videoTrack?function(N,Y,W,H,ne,re,me,be){const we=Y.videoRecv.find(Mn=>Mn.ssrc===N);if(!we)return;const Se={},{receivedFrame:Le,outputFrame:et,decodeFrameRate:mt}=we,Et=W&&W.videoRecv.find(Mn=>Mn.ssrc===N);if(qt(Se,p_.FRAME_RATE_DECODE,mt),we.framesRateFirefox&&qt(Se,Ji.FRAME_RATE,we.framesRateFirefox),Le&&qt(Se,Ji.FRAME_RATE,Le.frameRate),qt(Se,Ji.FRAMES_DROPPED,we.framesDroppedCount),qt(Se,Ji.BYTES_RETRANSMIT,we.retransmittedBytesReceived),qt(Se,Ji.PACKAGES_RETRANSMIT,we.retransmittedPacketsReceived),qt(Se,Ji.PACKAGES_DISCARDED,we.packetsDiscarded),qt(Se,Ji.AVG_DECODE,we.avgDecodeMs),qt(Se,Ji.AVG_PROCESSING_DELAY,we.avgProcessingDelayMs),qt(Se,Ji.AVG_ASSEMBLY_TIME,we.avgFramesAssembledFromMultiplePacketsMs),qt(Se,Ji.AVG_INTER_FRAME_DELAY,we.avgInterFrameDelayMs),qt(Se,Ji.KEY_FRAMES_DECODED,we.keyFramesDecoded),Et){const Mn=Y.timestamp-W.timestamp||m_*(be?g_:me?IO:1);we.packetsLost!=null&&Et.packetsLost!=null&&qt(Se,Ji.PACKAGE_LOST,we.packetsLost-Et.packetsLost),Et.bytes!=null&&we.bytes!=null&&qt(Se,Ji.BITRATE,8*(we.bytes-Et.bytes)/Mn),Et.packets!=null&&we.packets!=null&&qt(Se,Ji.PACKAGE_RATE,1e3*(we.packets-Et.packets)/Mn)}if(be&&(qt(Se,Ji.QP_SUM,we.qpSumPerFrame),Se[Ji.FREEZE]=ne&&tw.isRemoteVideoFreeze(H,we,Et)?1:0),me){var xn;Le?(qt(Se,Ji.HEIGHT,Le.height),qt(Se,Ji.WIDTH,Le.width)):H&&(qt(Se,Ji.HEIGHT,H._videoHeight||0),qt(Se,Ji.WIDTH,H._videoWidth||0)),et&&qt(Se,p_.FRAME_RATE_OUTPUT,et.frameRate);const Mn=(xn=H._player)===null||xn===void 0?void 0:xn.rendFrameRate.toFixed(0);if(Mn&&qt(Se,p_.FRAME_RATE_RENDER,+Mn),qt(Se,Ji.JITTER_BUFFER,we.jitterBufferMs),qt(Se,Ji.CURRENT_DELAY,we.currentDelayMs),qt(Se,Ji.FIRS,we.firsCount),qt(Se,Ji.NACKS,we.nacksCount),qt(Se,Ji.PLIS,we.plisCount),H){Se[Ji.DISABLED]=H._originMediaStreamTrack.enabled&&H._mediaStreamTrack.enabled?0:1;const Lr=H._player;if(Lr){const{freezeTimeCounterList:Vi,renderFreezeAccTime:wi,videoElementStatus:ac}=Lr;if(Vi&&Vi.length>0&&qt(Se,p_.FREEZE_TIME,Vi.splice(0,1)[0]),re&&hp.visibility==="visible"&&ac===fa.PLAYING&&Xn().supportRequestVideoFrameCallback){const Ge=Math.min(6e3,wi);Lr.renderFreezeAccTime=Math.max(0,wi-Ge),qt(Se,p_.FREEZE_TIME_RENDER,Ge)}if(typeof we.totalFreezesDuration=="number"){const Ge=Et&&Et.totalFreezesDuration?we.totalFreezesDuration-Et.totalFreezesDuration:we.totalFreezesDuration;qt(Se,p_.FREEZE_DURATION,1e3*Ge)}}}if(Se[Ji.PLAYER_STATUS]=OM[H._player?H._player.videoElementStatus:"uninit"],Et&&we.totalInterFrameDelay!==void 0&&we.totalSquaredInterFrameDelay!==void 0&&Et.totalInterFrameDelay!==void 0&&Et.totalSquaredInterFrameDelay!==void 0){const Lr=we.totalInterFrameDelay-Et.totalInterFrameDelay,Vi=we.totalSquaredInterFrameDelay-Et.totalSquaredInterFrameDelay,wi=we.framesDecodeCount-Et.framesDecodeCount,ac=Lr/wi*1e3,Ge=Math.round(1e3*Math.sqrt((Vi-Math.pow(Lr,2)/wi)/wi));!isNaN(Ge)&&ac+Ge>Math.max(3*ac,ac+150)&&(Se[Ji.I_FRAME_DELAY]=Ge)}}return Se}(y._videoSSRC,i,s,y.videoTrack,R===!0,this.needUploadRenderFreezeTime,c,l):void 0;O&&(b.video=O)}if(S.has(bt.AUDIO)&&y.audioTrack){const R=y.audioTrack?function(O,N,Y,W,H,ne){const re=N.audioRecv.find(Se=>Se.ssrc===O);if(!re)return;const me={},be=Y&&Y.audioRecv.find(Se=>Se.ssrc===O);if(qt(me,ic.JITTER,re.jitterMs),qt(me,ic.BYTES_RETRANSMIT,re.retransmittedBytesReceived),qt(me,ic.PACKAGES_RETRANSMIT,re.retransmittedPacketsReceived),qt(me,ic.PACKAGES_DISCARDED,re.packetsDiscarded),qt(me,ic.AVG_PROCESSING_DELAY,re.avgProcessingDelayMs),be){const Se=N.timestamp-Y.timestamp||m_*(ne?g_:H?IO:1);re.packets!=null&&be.packets!=null&&qt(me,ic.PACKAGE_RATE,1e3*(re.packets-be.packets)/Se),H&&be.bytes!=null&&re.bytes!=null&&qt(me,ic.BITRATE,8*(re.bytes-be.bytes)/Se),re.packetsLost!=null&&be.packetsLost!=null&&qt(me,ic.PACKAGE_LOST,re.packetsLost-be.packetsLost)}if(ne){const{receivedFrames:Se,droppedFrames:Le}=re;Se!=null&&Le!=null&&(me[ic.FREEZE]=(we=Se)===0||100*Le/we>20?1:0)}var we;if(H){const Se=100*W._source.getAccurateVolumeLevel(),Le=re.outputLevel;if(Le!=null){const et=Math.ceil(50*Math.log10(100*Le+1));qt(me,_7.LEVEL,et)}if(qt(me,ic.PCM_LEVEL,Se),W&&(me[ic.DISABLED]=W._originMediaStreamTrack.enabled&&W._mediaStreamTrack.enabled?0:1),qt(me,ic.JITTER_BUFFER,re.jitterBufferMs),qt(me,ic.CURRENT_DELAY,re.jitterBufferMs),me[ic.PLAYER_STATUS]=OM[nc.getPlayerState(W.getTrackId())],be){const et=re.concealedSamples-be.concealedSamples;et>0&&qt(me,ic.CONCEALED_SAMPLES,et);const mt=re.totalSamplesReceived-be.totalSamplesReceived;mt>0&&qt(me,ic.TOTAL_SAMPLES_RECEIVED,mt)}}return me}(y._audioSSRC,i,s,y.audioTrack,c,l):void 0;R&&(b.audio=R)}(b.video||b.audio)&&p.push(b)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,p}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const i=(this.requestAllTracks()||[]).find(s=>s instanceof Xk);if(i&&i._external.getDenoiserStats){const s=i._external.getDenoiserStats();s&&this.requestUpload(Hb.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(i=>{i.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(i=>{let[s,c]=i;c.has(bt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(l=>{this.requestUpload&&this.requestUpload(l.type,l.stats)}),c.has(bt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(l=>{this.requestUpload&&this.requestUpload(l.type,l.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const i=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),c={connectionInterval:le("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let l=[];const h=this.requestAllTracks&&this.requestAllTracks()||[];for(const S of h)!S.muted&&S.enabled&&(l=l.concat(await S.getProcessorUsage()));const p=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[S,b]of p)b.has(bt.VIDEO)&&S.videoTrack&&(l=l.concat(await S.videoTrack.getProcessorUsage())),b.has(bt.AUDIO)&&S.audioTrack&&(l=l.concat(await S.audioTrack.getProcessorUsage()));if(l.length===0)return;c.details=function(S,b){const R={};for(const{id:W,value:H,level:ne,direction:re}of S){var O;const me=(O=b.get(W))!==null&&O!==void 0?O:0,be=H===2?me+le("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:me;var N,Y;b.set(W,be),R[W]?(H===2&&(R[W].value=H),ne>R[W].level&&(R[W].level=ne),re==="remote"&&(R[W].remoteUidCount+=1),R[W].totalTs=(N=b.get(W))!==null&&N!==void 0?N:0):R[W]={value:H,level:ne,remoteUidCount:re==="local"?0:1,totalTs:(Y=b.get(W))!==null&&Y!==void 0?Y:0}}return Object.keys(R).map(W=>{const{level:H,value:ne,totalTs:re}=R[W];return{id:W,level:H,value:ne,totalTs:re}})}(l,i);const v=Date.now(),y=v>s?v:s+1;this.requestUpload&&this.requestUpload(Hb.EXTENSION_USAGE_STATS,{usageStats:c,sendTs:y})},le("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const LSe=le("ICE_RESTART_INTERVAL");let AO=new Map,ES=new Map,Jm=[Io.UDP_TCP_RELAY,Io.TCP_RELAY,Io.RELAY],TU=le("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Xn().supportPCSetConfiguration;function T7(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=AO.get(n.id);s&&(window.clearTimeout(s),AO.delete(n.id));const c=ES.get(n.id);i&&c&&c.index===Jm.length-1&&(x.debug("[".concat(n.id,"] reset ICE restart policy")),ES.delete(n.id))}function b7(n,i,s){if(AO.size===0&&ES.size===0&&(Array.isArray(le("RESTART_SEQUENCE"))&&le("RESTART_SEQUENCE").length>0&&!function(v,y){if(v.length!==y.length)return!1;for(let S=0;S<v.length;S+=1){const b=v[S];if(v.filter(R=>R===b).length!==y.filter(R=>R===b).length)return!1}return!0}(Jm,le("RESTART_SEQUENCE"))&&(Jm=le("RESTART_SEQUENCE").filter(v=>{var y;if(dt(y=Object.values(Io)).call(y,v))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(Jm.join(" => ")))),TU=le("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Xn().supportPCSetConfiguration),Jm.length===0)return void s();let c,{index:l=0,type:h}=ES.get(n.id)||{};if(TU&&h===Io.RELAY)return void s();let p=h&&l>=Jm.length-1;if(TU)h=Io.RELAY;else{if(p)return void s();h?(l++,h=Jm[l]):(h=Jm[0],l=0)}x.debug("[".concat(n.id,"] choose ICE restart policy: ").concat(h,", index: ").concat(l)),i(h),ES.set(n.id,{index:l,type:h}),c=window.setTimeout(()=>b7(n,i,s),LSe),AO.set(n.id,c)}var bn;function w7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function $h(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?w7(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):w7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}function C7(n){var i,s,c,l=2;for(typeof Symbol<"u"&&(s=Kx,c=Symbol.iterator);l--;){if(s&&(i=n[s])!=null)return i.call(n);if(c&&(i=n[c])!=null)return new kO(i.call(n));s="@@asyncIterator",c="@@iterator"}throw new TypeError("Object is not async iterable")}function kO(n){function i(s){if(Object(s)!==s)return pt.reject(new TypeError(s+" is not an object."));var c=s.done;return pt.resolve(s.value).then(function(l){return{value:l,done:c}})}return kO=function(s){this.s=s,this.n=s.next},kO.prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(s){var c=this.s.return;return c===void 0?pt.resolve({value:s,done:!0}):i(c.apply(this.s,arguments))},throw:function(s){var c=this.s.return;return c===void 0?pt.reject(s):i(c.apply(this.s,arguments))}},new kO(n)}let rw=(bn=class extends li{get state(){return this._state}set state(n){const i=this._state;this._state=n,this.emit(Ft.StateChange,i,this._state)}constructor(n,i){super(),ee(this,"isPlanB",void 0),ee(this,"store",void 0),ee(this,"statsUploader",void 0),ee(this,"connection",void 0),ee(this,"localTrackMap",new Map),ee(this,"remoteUserMap",new Map),ee(this,"localDataChannels",[]),ee(this,"remoteDataChannelMap",new Map),ee(this,"pendingLocalTracks",[]),ee(this,"pendingRemoteTracks",[]),ee(this,"pendingLocalDataChannels",[]),ee(this,"pendingRemoteDataChannels",[]),ee(this,"statsCollector",void 0),ee(this,"shouldForwardP2PCreation",void 0),ee(this,"iceFailedCount",0),ee(this,"dtlsFailedCount",0),ee(this,"mutex",void 0),ee(this,"_state",ur.Disconnected),ee(this,"_pcStatsUploadType",le("NEW_ICE_RESTART")?gp.FIRST_CONNECTION:gp.OLD_FIRST_CONNECTION),ee(this,"_isStartRestartIce",!1),ee(this,"_restartTimer",void 0),ee(this,"_isTryConnecting",!1),ee(this,"_iceError",null),ee(this,"_forceTurn",!1),ee(this,"_isWaitPcToRePub",!1),ee(this,"handleMuteLocalTrack",async(s,c,l)=>{const h=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ur.Connected)return void l(new Fe(ie.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const p=this.filterTobeMutedTracks(s);if(p.length===0)return void c();const v=p.find(S=>S[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(p.map(S=>{let[,{id:b}]=S;return b}));const y=this.createMuteMessage(p);await Pr(this,Ft.RequestMuteLocal,y),c()}catch(p){l(p)}finally{h()}}),ee(this,"handleUnmuteLocalTrack",async(s,c,l)=>{const h=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ur.Connected)return void l(new Fe(ie.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const p=this.filterTobeUnmutedTracks(s);if(p.length===0)return void c();const v=p.find(S=>S[0]==="videoLowTrack");if(v){const S=v[1];if(S.track._originMediaStreamTrack.stop(),!le("DISABLE_DUAL_STREAM_USE_ENCODING")&&Xn().supportDualStreamEncoding){const b=s._mediaStreamTrack.clone();S.track._mediaStreamTrack=b,S.track._originMediaStreamTrack=b}else{const b=SU(s,Vb(this,Ft.RequestLowStreamParameter));S.track._mediaStreamTrack=b,S.track._originMediaStreamTrack=b}await new pt((b,R)=>{this.handleReplaceTrack(S.track,b,R,!0)})}await this.connection.unmuteLocal(p.map(S=>{let[,{id:b}]=S;return b}));const y=this.createUnmuteMessage(p);await Pr(this,Ft.RequestUnmuteLocal,y),c()}catch(p){l(p)}finally{h()}}),ee(this,"handleUpdateVideoEncoder",async(s,c,l,h)=>{let p;h||(p=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Qe.LocalVideoTrack);if(!this.connection||!y||y.track!==s||this.state!==ur.Connected)return void c();const{id:S,track:b}=y;await this.connection.updateSendParameters(S,b),await this.connection.updateEncoderConfig(S,b),this.emit(Ft.UpdateVideoEncoder,b),c()}catch(y){l(y)}finally{var v;(v=p)===null||v===void 0||v()}}),ee(this,"handleUpdateVideoSendParameters",async(s,c,l)=>{const h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const p=this.localTrackMap.get(Qe.LocalVideoTrack);if(!this.connection||!p||p.track!==s||this.state!==ur.Connected)return void c();const{id:v,track:y}=p;await this.connection.updateSendParameters(v,y),c()}catch(p){l(p)}finally{h()}}),ee(this,"handleReplaceMixingTrack",async(s,c,l,h)=>{if(!this.connection||this.state!==ur.Connected)return void c();const p=yU([s]);let v;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),typeof h=="boolean"&&h||(v=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,p),c()}catch(S){l(S)}finally{var y;(y=v)===null||y===void 0||y()}}),ee(this,"handleReplaceTrack",async(s,c,l,h)=>{let p;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof h=="boolean"&&h||(p=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var v;const S=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:R}]=b;return s===R});if(!this.connection||!S||this.state!==ur.Connected)return void c();if(await((v=this.connection)===null||v===void 0?void 0:v.replaceTrack(s,S[1].id)),this.isPlanB){const b=S[1];b.id=s._mediaStreamTrack.id,this.localTrackMap.set(S[0],b)}if(S[0]===Qe.LocalVideoTrack&&!le("DISABLE_DUAL_STREAM_USE_ENCODING")&&Xn().supportDualStreamEncoding){const b=this.localTrackMap.get(Qe.LocalVideoLowTrack);if(b){const R=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=R,b.track._originMediaStreamTrack=R,await new pt((O,N)=>{this.handleReplaceTrack(b.track,O,N,!0)})}}c()}catch(S){l(S)}finally{var y;(y=p)===null||y===void 0||y()}}),ee(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),ee(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),ee(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),ee(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),ee(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=n,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new S7(this.store),this.bindStatsUploaderEvents(),this.mutex=new Co("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Xn().supportUnifiedPlan||le("CHROME_FORCE_PLAN_B")&&up(),this.shouldForwardP2PCreation=le("FORWARD_P2P_CREATION")&&Xn().supportPCSetConfiguration&&iM(),this.shouldForwardP2PCreation&&(this.connection=wO(this.store),this.emit(Ft.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(n){var i;this.state=ur.New,this._forceTurn=m7(n),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=wO(this.store,n),this.emit(Ft.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Fe(ie.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=le("NEW_ICE_RESTART")?gp.FIRST_CONNECTION:gp.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(n),this.connection.establishPromise}async connect(n){if(!this.connection)throw new Fe(ie.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");le("ENABLE_PREALLOC_PC")&&this.state===ur.Connected?await this.connection.updateRemoteConnect(n):(this.store.peerConnectionStart(),await this.connection.connect(n),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ur.Connected)}updateRemoteRTPCapabilities(n){const i=Array.from(this.localTrackMap.entries()).filter(l=>{var h;let[p]=l;return dt(h=[Qe.LocalVideoLowTrack,Qe.LocalVideoTrack]).call(h,p)}),s=i.map(l=>{let[,{id:h}]=l;return h}),c=i.map(l=>{let[h]=l;return h});if(this.connection instanceof Kh){if(kt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(c),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(n)}),!dt(n).call(n,this.store.codec)){const l=["vp9","vp8","h264"].find(h=>dt(n).call(n,h));l&&(this.store.codec=l,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(l,".")))}this.connection.updateRemoteRTPCapabilities(s,n)}}async getEstablishParams(){var n;if(this.connection instanceof Kh&&this.connection.peerConnectionState!=="closed"&&dt(n=[ur.New,ur.Connected]).call(n,this.state))return this.connection.establishPromise}async publishDataChannel(n){if(!this.connection||this.state!==ur.Connected){if(this.state===ur.Disconnected)throw new Fe(ie.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return n.forEach(s=>{var c;dt(c=this.pendingLocalDataChannels).call(c,s)||this.pendingLocalDataChannels.push(s)}),[]}const i=this.filterTobePublishedDataChannels(n);return i.length===0?[]:(i.forEach(s=>{const c=Date.now();this.store.publish(s.id.toString(),"datachannel",c)}),await this.connection.createDataChannels(this.store.uid,i),i.forEach(s=>{this.localDataChannels.push(s);const c=Date.now();this.store.publish(s.id+"","datachannel",void 0,c)}),n.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(n,i,s){var c=this;return wl(function*(){const l=yield Wn(c.mutex.lock("From P2PChannel.publish"));try{var h;const p=c.connection&&dt(h=["disconnected","failed"]).call(h,c.connection.peerConnectionState);if(!c.connection||c.state!==ur.Connected||p){if(c.state===ur.Disconnected)throw new Fe(ie.UNEXPECTED_ERROR,"PeerConnection already disconnected.");c.throwIfTrackTypeNotMatch(n);const y=n.filter(S=>c.pendingLocalTracks.indexOf(S)===-1);return c.pendingLocalTracks=c.pendingLocalTracks.concat(y),void(p&&(c._isWaitPcToRePub=!0))}c.store.pubId=c.store.pubId+1,Ao.markPublishStart(c.store.clientId,c.store.pubId);const v=c.filterTobePublishedTracks(n,i,s);if(v.length===0)return void(yield Wn(c.tryToUnmuteAudio(n)));yield*bk(C7(c.doPublish(c.connection,v)))}finally{l()}})()}doPublish(n,i){var s=this;return wl(function*(){i.forEach(O=>{let{track:N,type:Y}=O;const W=Date.now();s.store.publish(N.getTrackId(),Y===Qe.LocalAudioTrack?"audio":"video",W)}),s.bindLocalTrackEvents(i);const c=i.map(O=>{let{track:N}=O;return N}),l=yield Wn(n.send(c,s.store.codec,s.store.audioCodec)),h=(yield Wn(l.next())).value,p=s.createGatewayPublishMessage(i,h);let v;try{v=yield p}catch(O){throw l.throw(O),(O==null?void 0:O.code)===ie.WS_ABORT&&i.forEach(N=>{let{track:Y}=N;s.pendingLocalTracks.indexOf(Y)===-1&&s.pendingLocalTracks.push(Y)}),s.unbindLocalTrackEvents(i),O}const y=s.mapPubResToRemoteConfig(p,v,c),S=(yield Wn(l.next(y))).value;if(s.state===ur.Disconnected)throw new Fe(ie.UNEXPECTED_ERROR,"PeerConnection already disconnected.");le("ENABLE_VIDEO_SEI");const b=le("ENABLE_ENCODED_TRANSFORM"),R=le("ENABLE_AUDIO_METADATA");c.forEach(async O=>{const N=O.getRTCRtpTransceiver();if(!N||!b)return;const{interceptLocalVideoFrame:Y,interceptLocalAudioFrame:W}=vO();O.trackMediaType===bt.VIDEO?await Y(N.sender,O):O.trackMediaType===bt.AUDIO&&await W(N.sender,{metadata:R?()=>{const H=O.metadata.shift();return H&&H.value}:void 0})}),i.forEach(O=>{let{type:N}=O;s.statsCollector.addLocalStats(N)}),s.assignLocalTracks(i,S),s.statsUploader.startUploadOutboundStats(),i.forEach(O=>{let{track:N,type:Y}=O;const W=Date.now();s.store.publish(N.getTrackId(),Y===Qe.LocalAudioTrack?"audio":"video",void 0,W)})})()}async updateVideoStreamParameter(n,i){const s=this.localTrackMap.get(i);if(!s||!this.connection)return;if(!(s.track instanceof qr))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:c}=s,l=function(h,p){const v={};return h.height&&h.width&&(v.scaleResolutionDownBy=rU(h,p)),v.maxFramerate=h.framerate?du(h.framerate):void 0,v.maxBitrate=h.bitrate?1e3*h.bitrate:void 0,v}(n,c);if(c._encoderConfig||(c._encoderConfig={}),i!==Qe.LocalVideoLowTrack||!le("DISABLE_DUAL_STREAM_USE_ENCODING")&&Xn().supportDualStreamEncoding)l.scaleResolutionDownBy!=null&&(c._encoderConfig.scaleResolutionDownBy=l.scaleResolutionDownBy);else{const h=c._originMediaStreamTrack;if(!h.canvas)return x.warn("[".concat(c.getTrackId(),"] no canvas on track"));(function(p,v){const y=p.canvas;v.width&&(y.width=du(v.width)),v.height&&(y.height=du(v.height)),v.framerate&&(y.stopCapture&&y.stopCapture(),y.stopCapture=NM(()=>{!y.startCapture&&y.stopCapture&&y.stopCapture(),y.startCapture&&y.startCapture()},du(v.framerate)))})(h,n)}l.maxBitrate!=null&&(c._encoderConfig.bitrateMax=l.maxBitrate/1e3),l.maxFramerate!=null&&(c._encoderConfig.frameRate&&typeof c._encoderConfig.frameRate=="object"?c._encoderConfig.frameRate.max=l.maxFramerate:c._encoderConfig.frameRate={max:l.maxFramerate}),x.debug("[".concat(c.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(c._encoderConfig))),await this.connection.updateRtpSenderEncodings(c)}publishLowStream(n){var i=this;return wl(function*(){if(!i.connection||i.state!==ur.Connected)return;const s=yield Wn(i.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const l=i.localTrackMap.get(Qe.LocalVideoTrack);if(!l)throw new Fe(ie.UNEXPECTED_ERROR,"Could not find high stream");if(i.localTrackMap.has(Qe.LocalVideoLowTrack))throw new Fe(ie.UNEXPECTED_ERROR,"[".concat(i.store.clientId,"] Can't publish low stream when stream already publish"));const h=[{track:i.getLowVideoTrack(l.track,n),type:Qe.LocalVideoLowTrack}];if(yield*bk(C7(i.doPublish(i.connection,h))),l.track.muted||!l.track.enabled){var c;const p=(c=i.localTrackMap.get(Qe.LocalVideoLowTrack))===null||c===void 0?void 0:c.id;p!==void 0&&(yield Wn(i.connection.muteLocal([p])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ho(this,Ft.RequestRePublish,this.pendingLocalTracks),this.emit(Ft.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ho(this,Ft.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(n){for(let i=this.pendingRemoteTracks.length-1;i>=0;i--){const{user:s,kind:c}=this.pendingRemoteTracks[i];(c!==bt.AUDIO||s._audio_added_&&s._audioSSRC)&&(c!==bt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(i,1)}if(n)await ho(this,Ft.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:i,kind:s}of this.pendingRemoteTracks)await this.subscribe(i,s,s===bt.VIDEO?i._videoSSRC:i._audioSSRC);this.pendingRemoteTracks.forEach(i=>{let{user:s}=i;this.emit(Ft.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(n){if(!this.connection||this.state!==ur.Connected)return void n.forEach(c=>{const l=this.pendingLocalTracks.indexOf(c);l!==-1&&this.pendingLocalTracks.splice(l,1)});const i=this.filterTobeUnpublishedTracks(n);if(i.length===0)return;const s=i.find(c=>c[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,i)}async unpublishDataChannel(n){if(!this.connection||this.state!==ur.Connected)return void n.forEach(s=>{const c=this.pendingLocalDataChannels.indexOf(s);c!==-1&&this.pendingLocalDataChannels.splice(c,1)});const i=this.filterTobeUnpublishedDataChannels(n);return i.length!==0?(i.forEach(s=>{const c=this.localDataChannels.indexOf(s);c!==-1&&this.localDataChannels.splice(c,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),i.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ur.Connected)return;const n=this.localTrackMap.get(Qe.LocalVideoLowTrack);if(!n)return;n.track.close();const i=[[Qe.LocalVideoLowTrack,n]];return this.doUnpublish(this.connection,i)}async doUnpublish(n,i){const s=this.createGatewayUnpublishMessage(i);return await n.stopSending(i.map(c=>{let[,{id:l}]=c;return l})),this.withdrawLocalTracks(i),this.unbindLocalTrackEvents(i.map(c=>{let[l,{track:h}]=c;return{type:l,track:h}})),i.forEach(c=>{let[l]=c;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(n,i){if(!this.connection||this.state!==ur.Connected)throw new Fe(ie.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=i.filter(c=>{var l;return!((l=this.remoteDataChannelMap.get(n))!==null&&l!==void 0&&l.get(c.id))});if(s.length!==0)return await this.connection.createDataChannels(n.uid,s),s.forEach(c=>{var l;this.remoteDataChannelMap.has(n)?(l=this.remoteDataChannelMap.get(n))===null||l===void 0||l.set(c.id,c):this.remoteDataChannelMap.set(n,new Map([[c.id,c]]));const h=this.pendingRemoteDataChannels.findIndex(p=>{let{user:v,id:y}=p;return v.uid===n.uid&&y===c.id});h!==-1&&this.pendingRemoteDataChannels.splice(h,1)}),s.map(c=>c.id)}async subscribe(n,i,s,c,l){var h;if(!this.connection||this.state!==ur.Connected)throw new Fe(ie.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((h=this.remoteUserMap.get(n))!==null&&h!==void 0&&h.has(i))return;let p,v,y;const S=this.connection.getPreMedia(s);if(S)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),y=S.transceiver,p=S.track,v=S.id;else if(l){const O=l.find(Y=>{let{stream_type:W}=Y;return W===i});if(!O)throw new Fe(ie.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(i," for user: ").concat(n.uid," because subscribe answer from gateway does not contain stream_type: ").concat(i,"."));const N=await this.connection.receive(i,O.ssrcs,String(n._uintid),O.attributes);this.connection instanceof Kh&&(y=N.transceiver),p=N.track,v=N.id}else{const O=await this.connection.receive(i,[{ssrcId:s,rtx:c}],String(n._uintid),void 0);this.connection instanceof Kh&&(y=O.transceiver),p=O.track,v=O.id}if(i===bt.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(p):(n._audioTrack=new aS(p,n.uid,n._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),y&&n._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(p):(n._videoTrack=new oS(p,n.uid,n._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),y&&n._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(n,n._videoTrack)),y&&le("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:N}=vO();i==bt.VIDEO?await O(y.receiver,{onSei:le("ENABLE_VIDEO_SEI")&&(Y=>{var W;return(W=n._videoTrack)===null||W===void 0?void 0:W._onSei(Y)})}):i==bt.AUDIO&&await N(y.receiver,{enableTopn:!!le("ENABLE_AUDIO_TOPN"),enableMetadata:!!le("ENABLE_AUDIO_METADATA"),onMetadata:Y=>{this.safeEmit(Ft.AudioMetadata,Y)}})}const b=this.remoteUserMap.get(n);b?b.set(i,v):this.remoteUserMap.set(n,new Map([[i,v]])),this.statsCollector.addRemoteStats(n.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(O=>{let{user:N,kind:Y}=O;return N.uid===n.uid&&i===Y});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(Ft.MediaReconnectEnd,n.uid))}async massSubscribe(n){return this.massSubscribeNoLock(n)}async massSubscribeNoLock(n){if(!this.connection||this.state!==ur.Connected)throw new Fe(ie.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");n=n.filter(l=>{var h;let{user:p,mediaType:v}=l;return!((h=this.remoteUserMap.get(p))!==null&&h!==void 0&&h.has(v))});const i=[],s=new Map;n.forEach(l=>{if(!this.connection)return;const h=this.connection.getPreMedia(l.ssrcId);h?s.set(l.ssrcId,h):i.push(l)});const c=await this.connection.batchReceive(i.map(l=>{let{user:h,mediaType:p,ssrcId:v,rtxSsrcId:y}=l;return{kind:p,ssrcMsg:[{ssrcId:v,rtx:y}],mslabel:String(h._uintid)}}));i.forEach((l,h)=>{s.set(l.ssrcId,c[h])});for(const{user:l,mediaType:h,ssrcId:p}of n){const v=s.get(p);if(!v)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(l.uid," subscribe data,").concat(h,", ").concat(p));const{track:y,id:S,transceiver:b}=v;if(b&&le("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:Y}=vO();h==bt.VIDEO?await N(b.receiver,{onSei:le("ENABLE_VIDEO_SEI")&&(W=>{var H;return(H=l._videoTrack)===null||H===void 0?void 0:H._onSei(W)})}):h==bt.AUDIO&&await Y(b.receiver,{enableTopn:!!le("ENABLE_AUDIO_TOPN"),enableMetadata:!!le("ENABLE_AUDIO_METADATA"),onMetadata:W=>{this.safeEmit(Ft.AudioMetadata,W)}})}if(h===bt.AUDIO?(l._audioTrack?l._audioTrack._updateOriginMediaStreamTrack(y):(l._audioTrack=new aS(y,l.uid,l._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(l._audioTrack.getTrackId()))),b&&l._audioTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(l,l._audioTrack)):(l._videoTrack?l._videoTrack._updateOriginMediaStreamTrack(y):(l._videoTrack=new oS(y,l.uid,l._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(l._videoTrack.getTrackId()))),b&&l._videoTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(l,l._videoTrack)),le("ENABLE_VIDEO_SEI")&&b){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:Y}=vO();h==bt.VIDEO?await N(b.receiver,{onSei:W=>{var H;(H=l._videoTrack)===null||H===void 0||H._onSei(W)}}):h==bt.AUDIO&&await Y(b.receiver)}const R=this.remoteUserMap.get(l);R?R.set(h,S):this.remoteUserMap.set(l,new Map([[h,S]])),this.statsCollector.addRemoteStats(l.uid),this.statsUploader.startUploadInboundStats();const O=this.pendingRemoteTracks.findIndex(N=>{let{user:Y,kind:W}=N;return Y.uid===l.uid&&h===W});O!==-1&&(this.pendingRemoteTracks.splice(O,1),this.emit(Ft.MediaReconnectEnd,l.uid))}}async unsubscribe(n,i,s){const c=this.pendingRemoteTracks.filter(p=>{let{user:v,kind:y}=p;return i!==void 0?v.uid===n.uid&&i===y:v.uid===n.uid});if(c.forEach(p=>{const v=this.pendingRemoteTracks.indexOf(p);this.pendingRemoteTracks.splice(v,1)}),this.connection&&this.state===ur.Connected||s||c.forEach(p=>{let{kind:v}=p;var y;if(v===bt.AUDIO)(y=n._audioTrack)===null||y===void 0||y._destroy(),n._audioTrack=void 0;else if(v===bt.VIDEO){var S;(S=n._videoTrack)===null||S===void 0||S._destroy(),n._videoTrack=void 0}}),!this.connection||this.state!==ur.Connected)return;const l=this.filterTobeUnSubscribedTracks(n,i);if(l.length===0)return;await this.connection.stopReceiving(l.map(p=>{let[,{id:v}]=p;return v}));const h=this.createUnsubscribeMessage(l);return this.withdrawRemoteTracks(l),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),l.forEach(p=>{let[v,{kind:y}]=p;var S,b;if(y===bt.VIDEO&&v._videoSSRC&&((S=this.connection)===null||S===void 0||S.setStatsRemoteVideoIsReady(v._videoSSRC,!1)),y===bt.VIDEO)this.unbindRemoteTrackEvents(v._videoTrack),s||((b=v._videoTrack)===null||b===void 0||b._destroy(),v._videoTrack=void 0);else if(y===bt.AUDIO){var R;this.unbindRemoteTrackEvents(v._audioTrack),!s&&((R=v._audioTrack)===null||R===void 0||R._destroy(),v._audioTrack=void 0)}}),h}async unsubscribeDataChannel(n,i){if(i.forEach(l=>{const h=this.pendingRemoteDataChannels.findIndex(p=>p.id===l.id);h!==-1&&this.pendingRemoteDataChannels.splice(h,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(n,i);if(s.length===0)return;i.forEach(l=>{l._close()});const c=this.remoteDataChannelMap.get(n);return s.forEach(l=>{c&&c.delete(l.id)}),c&&c.size===0&&(this.remoteDataChannelMap.delete(n),await this.connection.stopDataChannels(n.uid)),s.map(l=>l.id)}async massUnsubscribe(n){return this.massUnsubscribeNoLock(n)}async massUnsubscribeNoLock(n){let i=[];for(const{user:l,mediaType:h}of n){const p=this.pendingRemoteTracks.filter(v=>{let{user:y,kind:S}=v;return h!==void 0?y.uid===l.uid&&h===S:y.uid===l.uid});p.forEach(v=>{const y=this.pendingRemoteTracks.indexOf(v);this.pendingRemoteTracks.splice(y,1)}),i=i.concat(p)}if(!this.connection||this.state!==ur.Connected)return void i.forEach(l=>{let{user:h,kind:p}=l;var v;if(p===bt.AUDIO)(v=h._audioTrack)===null||v===void 0||v._destroy(),h._audioTrack=void 0;else if(p===bt.VIDEO){var y;(y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0}});const s=nu(n).call(n,(l,h)=>{let{user:p,mediaType:v}=h;const y=this.filterTobeUnSubscribedTracks(p,v);return l.concat(y)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(l=>{let[,{id:h}]=l;return h}));const c=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(l=>{let[h,{kind:p}]=l;var v,y;if(p===bt.VIDEO&&h._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===bt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),(y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0;else if(p===bt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),(S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0}}),c}isPreSubScribe(n){return!this.connection||this.state!==ur.Connected?!1:!!this.connection.getPreMedia(n)}async muteRemote(n,i){if(!this.connection)return;const s=this.remoteUserMap.get(n);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid,"."));if(!s.get(i))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."));const c=i===bt.VIDEO?n._videoSSRC:n._audioSSRC;c!==void 0&&this.connection.setStatsRemoteVideoIsReady(c,!1)}async unmuteRemote(n,i){return this.unmuteRemoteNoLock(n,i)}async unmuteRemoteNoLock(n,i){if(!this.connection)return;const s=this.remoteUserMap.get(n);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid,"."));s.get(i)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."))}addAudioMetadata(n){const i=this.localTrackMap.get(Qe.LocalAudioTrack),s=i&&i.track;s&&s.metadata.push(n)}getAllTracks(n){const i=this.localTrackMap.get(Qe.LocalAudioTrack);if((i==null?void 0:i.track)instanceof fs){const s=i.track;return Array.from(this.localTrackMap.entries()).filter(c=>{let[l]=c;return l!==Qe.LocalAudioTrack}).filter(c=>{let[l]=c;return!(n&&l===Qe.LocalVideoLowTrack)}).map(c=>{let[,{track:l}]=c;return l}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return!(n&&c===Qe.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(n,i,s,c,l){if(n){const p=this.localTrackMap.get(Qe.LocalAudioTrack),v=c?this.localTrackMap.get(Qe.LocalVideoLowTrack):this.localTrackMap.get(Qe.LocalVideoTrack);kt.publish(this.store.sessionId,{eventElapse:Ao.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:p==null?void 0:p.track.getTrackLabel(),videoName:v==null?void 0:v.track.getTrackLabel(),screenshare:(v==null?void 0:v.track._hints.indexOf(Dr.SCREEN_TRACK))!==-1,audio:!!p,video:!!v,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}else{var h;s||(s=[]);const p=s.find(y=>y instanceof bi),v=c?(h=this.localTrackMap.get(Qe.LocalVideoTrack))===null||h===void 0?void 0:h.track:s.find(y=>y instanceof qr);kt.publish(this.store.sessionId,{eventElapse:Ao.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:p==null?void 0:p.getTrackLabel(),videoName:v==null?void 0:v.getTrackLabel(),screenshare:(v==null?void 0:v._hints.indexOf(Dr.SCREEN_TRACK))!==-1,audio:!!p,video:!!v,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}}reportSubscribeEvent(n,i,s,c){const l=c===bt.VIDEO?s._videoSSRC:s._audioSSRC;l&&kt.subscribe(this.store.sessionId,{succ:n,ec:i,video:c===bt.VIDEO,audio:c===bt.AUDIO,peerid:s.uid,subscribeRequestid:l,p2pid:this.store.p2pId,eventElapse:Ao.measureFromSubscribeStart(this.store.clientId,l),preSsrc:this.isPreSubScribe(l)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Co("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=wO(this.store),this.emit(Ft.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(Qe.LocalAudioTrack);if((n==null?void 0:n.track)instanceof fs){if(n.track.trackList.length>0){const i=n.track;n.track.trackList.forEach(s=>{i.removeAudioTrack(s)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ur.Disconnected}getStats(){var n;return(n=this.connection)===null||n===void 0?void 0:n.getStats()}getRemoteVideoIsReady(n){var i;return((i=this.connection)===null||i===void 0?void 0:i.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(Qe.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(Qe.LocalVideoTrack);if(n)return{width:n.track.videoWidth||0,height:n.track.videoHeight||0}}getEncoderConfig(n){const i=this.localTrackMap.get(n);return i&&i.track instanceof qr||i&&i.track instanceof bi?i.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}async hasRemoteMediaWithLock(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}getRemoteMedia(n){var i;const s=Array.from(zu(i=this.remoteUserMap).call(i)).find(c=>c.uid===n);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(s=>{let[c]=s;return{uid:c.uid,level:c.audioTrack?100*c.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(Qe.LocalAudioTrack);return i&&n.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=Sb(n).call(n,(s,c)=>s.level-c.level),n}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ur.Reconnecting,le("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;var s;i._videoTrack&&i._videoTrack._player&&((s=i._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),i._videoTrack._player.isKeepLastFrame=!0,i._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=wO(this.store),this.emit(Ft.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(n=>{var i;let[s,{track:c}]=n;switch(s){case Qe.LocalVideoTrack:dt(i=c._hints).call(i,Dr.LOW_STREAM)?c.close():this.pendingLocalTracks.push(c);break;case Qe.LocalAudioTrack:c instanceof fs?this.pendingLocalTracks=this.pendingLocalTracks.concat(c.trackList):this.pendingLocalTracks.push(c);case Qe.LocalVideoLowTrack:}}),this.emit(Ft.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;Array.from(zu(s).call(s)).forEach(c=>{this.setPendingRemoteMedia(i,c)}),this.emit(Ft.MediaReconnectStart,i.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(n=>{this.pendingLocalDataChannels.push(n)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(n=>{let[i,s]=n;Array.from(zu(s).call(s)).forEach(c=>{this.setPendingRemoteDataChannel(i,c)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(n,i){for(const s of this.pendingRemoteDataChannels){const{user:c,id:l}=s;if((n instanceof Xm?n.uid:n)===c.uid&&l===i)return!0}return!1}setPendingRemoteDataChannel(n,i){this.hasPendingRemoteDataChannel(n,i)||this.pendingRemoteDataChannels.push({user:n,id:i})}hasPendingRemoteMedia(n,i){for(const s of this.pendingRemoteTracks){const{user:c,kind:l}=s;if((n instanceof Xm?n.uid:n)===c.uid&&i===l)return!0}return!1}setPendingRemoteMedia(n,i){this.hasPendingRemoteMedia(n,i)||this.pendingRemoteTracks.push({user:n,kind:i})}restartICE(n){var i=this;return wl(function*(){if(!i.connection||i.state!==ur.Connected)return;const s=yield Wn(i.mutex.lock("From P2PChannel.restartICE"));let c;try{c=yield Wn(i.connection.restartICE(n));const h=yield Wn(c.next());if(h.done)return;const p=h.value,v=yield p;switch(EU(i.connection)&&i.reportPCStats(Date.now(),!1,i._pcStatsUploadType),n){case Io.UDP_TCP_RELAY:i._pcStatsUploadType=gp.UDP_TCP_RESTART;break;case Io.TCP_RELAY:i._pcStatsUploadType=gp.TCP_RESTART;break;case Io.RELAY:i._pcStatsUploadType=gp.RELAY_RESTART;break;default:i._pcStatsUploadType=gp.OLD_RESTART}i._isTryConnecting=!0,c.next(v)}catch(h){var l;(l=c)===null||l===void 0||l.throw(h)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats(),i=this.localTrackMap.get(Qe.LocalVideoTrack),s=this.localTrackMap.get(Qe.LocalAudioTrack),c=n.videoSend.find(N=>N.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId)),l=n.audioSend.find(N=>N.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!c||!l)return 1;const h=Bu(this,Ft.NeedSignalRTT),p=c?c.rttMs:void 0,v=l?l.rttMs:void 0,y=p&&v?(p+v)/2:p||v,S=(y&&h?(y+h)/2:y||h)||0,b=100*n.sendPacketLossRate*.7/50+.3*S/1500,R=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,O=i==null?void 0:i.track;if(O&&O._encoderConfig&&O._hints.indexOf(Dr.SCREEN_TRACK)===-1){const N=O._encoderConfig.bitrateMax,Y=n.bitrate.actualEncoded;if(N&&Y){const W=(1e3*N-Y)/(1e3*N);return s3[W<.15?0:W<.3?1:W<.45?2:W<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[c]=s;const l=c._audioSSRC,h=c._videoSSRC,p=n.audioRecv.find(Y=>Y.ssrc===l),v=n.videoRecv.find(Y=>Y.ssrc===h);if(!p&&!v)return void(i+=1);const y=Bu(this,Ft.NeedSignalRTT),S=n.rtt,b=(S&&y?(S+y)/2:S||y)||0,R=p?p.jitterMs:void 0,O=n.recvPacketLossRate;let N=.7*O*100/50+.3*b/1500;R&&(N=.6*O*100/50+.2*b/1500+.2*R/400),i+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}async muteLocalTrack(n){return new pt((i,s)=>{this.handleMuteLocalTrack(n,i,s)})}async replaceTrack(n,i){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(n.getTrackId(),"] to [").concat(i.getTrackId(),"]")),!this.connection||this.state!==ur.Connected)return;const c=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:p}]=h;return n===p});if(!c)return;const l=c[0];if(n!==i&&(this.unbindLocalTrackEvents([{track:n,type:l}]),this.bindLocalTrackEvents([{track:i,type:l}]),c[1].track=i),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(i,c[1].id)),this.isPlanB){const h=c[1];h.id=i._mediaStreamTrack.id,this.localTrackMap.set(l,h)}if(l===Qe.LocalVideoTrack&&!le("DISABLE_DUAL_STREAM_USE_ENCODING")&&Xn().supportDualStreamEncoding){const h=this.localTrackMap.get(Qe.LocalVideoLowTrack);if(h){const p=n._mediaStreamTrack.clone();h.track._originMediaStreamTrack.stop(),h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p,await new pt((v,y)=>{this.handleReplaceTrack(h.track,v,y,!0)})}}}filterTobePublishedTracks(n,i,s){const c=[],l=this.getAllTracks();n=qE(n=n.filter(y=>l.indexOf(y)===-1));let h,p=!1;const v=this.localTrackMap.get(Qe.LocalAudioTrack);for(const y of n){if(y instanceof qr&&(this.localTrackMap.has(Qe.LocalVideoTrack)||p?new Fe(ie.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(c.push({track:y,type:Qe.LocalVideoTrack}),p=!0),i)){const S=this.getLowVideoTrack(y,s);c.push({track:S,type:Qe.LocalVideoLowTrack})}if(y instanceof bi)if(v){const S=v.track;if(S instanceof fs)_U([y]),S.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0);else{const b=yU([S,y]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(b.getTrackId(),"]")),this.replaceTrack(S,b)}}else h instanceof fs?(_U([y]),h.addAudioTrack(y)):h||!y._useAudioElement&&Xn().webAudioMediaStreamDest&&!y._bypassWebAudio?h=yU(h?[y,h]:[y]):h=y}return h&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(h.getTrackId(),"]")),c.push({track:h,type:Qe.LocalAudioTrack})),c}filterTobeUnpublishedTracks(n){const i=[],s=this.getAllTracks();n=qE(n=n.filter(c=>s.indexOf(c)!==-1));for(const c of n){if(c instanceof bi){const l=this.localTrackMap.get(Qe.LocalAudioTrack);if(!l)continue;l.track instanceof fs?(l.track.removeAudioTrack(c),this.unbindLocalAudioTrackEvents(c),l.track.trackList.length===0&&(i.push([Qe.LocalAudioTrack,l]),l.track.close())):i.push([Qe.LocalAudioTrack,l])}if(c instanceof qr){const l=this.localTrackMap.get(Qe.LocalVideoTrack);if(!l)continue;i.push([Qe.LocalVideoTrack,l]);const h=this.localTrackMap.get(Qe.LocalVideoLowTrack);h&&i.push([Qe.LocalVideoLowTrack,h])}}return i}filterTobePublishedDataChannels(n){return n=(n=qE(n)).filter(i=>this.localDataChannels.findIndex(s=>s.id===i.id)===-1)}filterTobeUnpublishedDataChannels(n){return n=(n=(n=qE(n)).filter(i=>this.localDataChannels.indexOf(i)!==-1)).filter(i=>i._originDataChannel)}bindLocalTrackEvents(n){n.forEach(i=>{let{track:s,type:c}=i;switch(c){case Qe.LocalVideoTrack:s.addListener(wt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(wt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(wt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(wt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Qe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Qe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(n,i){n instanceof fs?n.trackList.forEach(s=>{s.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(wt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(wt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||(n.addListener(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(wt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(i=>{let[s,{track:c}]=i;return{track:c,type:s}})),n.forEach(i=>{let{track:s,type:c}=i;switch(c){case Qe.LocalVideoTrack:s.off(wt.GET_STATS,this.handleGetLocalVideoStats),s.off(wt.GET_RTC_STATS,this.handleGetRTCStats),s.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(wt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(wt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Qe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Qe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(n){n instanceof fs?n.trackList.forEach(i=>{i.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(wt.GET_STATS,this.handleGetLocalAudioStats),i.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(wt.GET_STATS,this.handleGetLocalAudioStats),n.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(wt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),n.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,i){i instanceof oS&&i.addListener(wt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(n))}),i instanceof aS&&i.addListener(wt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(wt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;s.has(bt.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),s.has(bt.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(n,i){return n.map((s,c)=>{var l;let h,p,{track:v,type:y}=s;switch(y){case Qe.LocalAudioTrack:h=hr.Audio,p={dtx:v instanceof Xk&&v._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Qe.LocalVideoTrack:h=dt(l=v._hints).call(l,Dr.SCREEN_TRACK)?hr.Screen:hr.High,p=$h($h({},b3(v)),{},{codec:this.store.codec,svc_mode:hO()});break;case Qe.LocalVideoLowTrack:h=hr.Low,p=$h($h({},b3(v)),{},{codec:this.store.codec,svc_mode:hO()})}return{stream_type:h,attributes:p,ssrcs:i[c]}})}createGatewayUnpublishMessage(n){return n.map(i=>{var s;let c,[l,{track:h,ssrcs:p,id:v}]=i;switch(l){case Qe.LocalVideoTrack:c=dt(s=h._hints).call(s,Dr.SCREEN_TRACK)?hr.Screen:hr.High;break;case Qe.LocalAudioTrack:c=hr.Audio;break;case Qe.LocalVideoLowTrack:c=hr.Low}return{stream_type:c,ssrcs:p,mid:v}})}assignLocalTracks(n,i){n.forEach((s,c)=>{let{track:l,type:h}=s;this.localTrackMap.set(h,{track:l,id:i[c].id,ssrcs:i[c].localSSRC})})}withdrawLocalTracks(n){n.forEach(i=>{let[s]=i;this.localTrackMap.delete(s)})}bindConnectionEvents(n){n.onConnectionStateChange=async i=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(i,")")),this.emit(Ft.PeerConnectionStateChange,i),i==="connecting"&&n instanceof Kh&&!gi()&&le("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{i==="connecting"&&n.extendCandidate()},le("FIRST_TCP_CANDIDATE_INTERVAL")),i!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),i==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),n instanceof Kh&&T7(n,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=gp.DISCONNECTED_OR_FAILED,Bu(this,Ft.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(l=>l.getTrackId()),c=this.pendingLocalDataChannels.map(l=>"dc_".concat(l.id));kt.reportApiInvoke(this.store.sessionId,{name:is.REPUB_AFTER_PC_CONNECTED,options:s.concat(c),tag:_i.TRACER}).onSuccess(),this.republish()}if(le("NEW_ICE_RESTART")&&n instanceof Kh&&!gi()&&!this._forceTurn){if(dt(g3).call(g3,i)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=l=>{EU(n)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(l)),Bu(this,Ft.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ft.RequestRestartICE,l))},c=()=>{EU(n)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ft.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{b7(n,s,c)},800))}}else{if(i==="disconnected"&&n.iceConnectionState==="disconnected")return setTimeout(()=>{n.iceConnectionState==="disconnected"&&le("ICE_RESTART")&&Bu(this,Ft.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ft.RequestRestartICE)},800),void setTimeout(()=>{n.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ft.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);i==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ft.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},n.onICEConnectionStateChange=i=>{i!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(i,")")),kt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:i,tag:_i.TRACER}).onSuccess(),this.emit(Ft.IceConnectionStateChange,i)},n.onICETransportStateChange=i=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(i,")"))},n.onDTLSTransportStateChange=i=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(i,")"))},n.onDTLSTransportError=i=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(i,")"))},n.onFirstAudioDecoded=i=>{var s;const c=Array.from(zu(s=this.remoteUserMap).call(s)).find(h=>h._audioSSRC===i);var l;c&&(this.store.subscribe(c.uid,"audio",void 0,void 0,void 0,Date.now()),(l=c.audioTrack)===null||l===void 0||l.emit(tS.FIRST_FRAME_DECODED),kt.firstRemoteFrame(this.store.sessionId,Cs.FIRST_AUDIO_DECODE,ni.FIRST_AUDIO_DECODE,{peer:c._uintid,subscribeElapse:Ao.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=i=>{var s;const c=Array.from(zu(s=this.remoteUserMap).call(s)).find(l=>l._audioSSRC===i);c&&kt.firstRemoteFrame(this.store.sessionId,Cs.FIRST_AUDIO_RECEIVED,ni.FIRST_AUDIO_RECEIVED,{peer:c._uintid,subscribeElapse:Ao.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(i,s,c)=>{this.reportVideoFirstFrameDecoded(i,s,c)},n.onFirstVideoReceived=i=>{var s;const c=Array.from(zu(s=this.remoteUserMap).call(s)).find(l=>l._videoSSRC===i);c&&kt.firstRemoteFrame(this.store.sessionId,Cs.FIRST_VIDEO_RECEIVED,ni.FIRST_VIDEO_RECEIVED,{peer:c._uintid,subscribeElapse:Ao.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(i,s)=>{const c=i.candidateType==="relay",l=s.candidateType==="relay";s.candidateType!=="unknown"&&c===l||this.emit(Ft.ConnectionTypeChange,c),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(i)),")"))},n.onSelectedRemoteCandidateChanged=(i,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(i)),")"))},n.onFirstVideoDecodedTimeout=i=>{this.reportVideoFirstFrameDecoded(i,void 0,void 0,!0)},n.getLocalVideoStats=()=>{const i=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return $h($h({},i),s)},n.onICECandidateError=i=>{this._iceError=i}}resetConnection(n){n instanceof Kh&&function(i){ES.delete(i.id),T7(i)}(n),n.close(),this.emit(Ft.PeerConnectionStateChange,"closed"),function(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0,i.getLocalVideoStats=void 0}(n),this._isWaitPcToRePub=!1}filterTobeMutedTracks(n){const i=[];if(this.getAllTracks().indexOf(n)===-1)return i;const s=this.localTrackMap.get(Qe.LocalAudioTrack);if(n instanceof bi&&(s==null?void 0:s.track)instanceof fs)return s.track.isActive||i.push([Qe.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return n===h});if(c&&(i.push(c),c[0]===Qe.LocalVideoTrack)){const l=this.localTrackMap.get(Qe.LocalVideoLowTrack);l&&i.push([Qe.LocalVideoLowTrack,l])}return i}filterTobeUnmutedTracks(n){const i=[],s=this.localTrackMap.get(Qe.LocalAudioTrack);if(n instanceof bi&&(s==null?void 0:s.track)instanceof fs)return s.track.isActive&&i.push([Qe.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return n===h});if(c)if(c[0]===Qe.LocalVideoTrack){i.push(c);const l=this.localTrackMap.get(Qe.LocalVideoLowTrack);l&&i.push([Qe.LocalVideoLowTrack,l])}else i.push(c);return i}createMuteMessage(n){return n.map(i=>{var s;let c,[l,{track:h,ssrcs:p,id:v}]=i;switch(l){case Qe.LocalAudioTrack:c=hr.Audio;break;case Qe.LocalVideoTrack:c=dt(s=h._hints).call(s,Dr.SCREEN_TRACK)?hr.Screen:hr.High;break;case Qe.LocalVideoLowTrack:c=hr.Low}return{stream_type:c,ssrcs:p,mid:v}})}createUnmuteMessage(n){return n.map(i=>{var s;let c,[l,{track:h,ssrcs:p,id:v}]=i;switch(l){case Qe.LocalAudioTrack:c=hr.Audio;break;case Qe.LocalVideoTrack:c=dt(s=h._hints).call(s,Dr.SCREEN_TRACK)?hr.Screen:hr.High;break;case Qe.LocalVideoLowTrack:c=hr.Low}return{stream_type:c,ssrcs:p,mid:v}})}filterTobeUnSubscribedTracks(n,i){const s=[],c=this.remoteUserMap.get(n);if(!c)return s;if(i){const l=c.get(i);if(!l)return s;s.push([n,{kind:i,id:l}])}else Array.from(c.entries()).forEach(l=>{let[h,p]=l;s.push([n,{kind:h,id:p}])});return s}filterTobeUnSubscribedDataChannels(n,i){const s=[];return i.forEach(c=>{var l;(l=this.remoteDataChannelMap.get(n))!==null&&l!==void 0&&l.has(c.id)&&s.push(c)}),s}createUnsubscribeMessage(n){const i=[];return n.forEach(s=>{let[c,{kind:l,id:h}]=s;switch(l){case bt.VIDEO:return void(c._videoSSRC&&i.push({stream_type:bt.VIDEO,ssrcId:c._videoSSRC}));case bt.AUDIO:return void(c._audioSSRC&&i.push({stream_type:bt.AUDIO,ssrcId:c._audioSSRC}))}}),i}createUnsubscribeAllMessage(n){const i=new Map;return n.forEach(s=>{let[c,{kind:l}]=s;if(i.has(c)){let h=i.get(c);l===bt.VIDEO?h|=Rs.Video:h|=Rs.Audio,i.set(c,h)}else l===bt.VIDEO?i.set(c,Rs.Video):i.set(c,Rs.Audio)}),{users:Array.from(i.entries()).map(s=>{let[c,l]=s;return{stream_id:c.uid,stream_type:l}})}}withdrawRemoteTracks(n){n.forEach(i=>{let[s,{kind:c}]=i;const l=this.remoteUserMap.get(s);l&&(l.delete(c),Array.from(l.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(n){const i=this.localTrackMap.get(Qe.LocalVideoTrack),s=this.localTrackMap.get(Qe.LocalVideoLowTrack);i&&(await i.track.setBitrateLimit(n.uplink),await new pt((c,l)=>{this.handleUpdateVideoEncoder(i.track,c,l,!0)})),s&&n.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}),await new pt((c,l)=>{this.handleUpdateVideoEncoder(s.track,c,l,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(n,i,s){return n.map((c,l)=>{var h;let{stream_type:p}=c;const v=(h=i.find(y=>{let{stream_type:S}=y;return p===S}))===null||h===void 0?void 0:h.attributes;if(v&&le("DISABLE_SCREEN_SHARE_REMB")){const y=s[l]._hints;(dt(y).call(y,Dr.SCREEN_TRACK)||dt(y).call(y,Dr.SCREEN_LOW_TRACK))&&(v.remb=!1,x.debug("disable remb for screen share, hints:",y))}return v})}async tryToUnmuteAudio(n){for(let s=0;s<n.length;s++)if(n[s]instanceof bi){var i;const c=this.filterTobeUnmutedTracks(n[s]);if(c.length===0)continue;await((i=this.connection)===null||i===void 0?void 0:i.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p})));const l=this.createUnmuteMessage(c);return void await Pr(this,Ft.RequestUnmuteLocal,l)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var i;return!((i=this.connection)===null||i===void 0||!i.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,i)=>this.emit(Ft.RequestUpload,n,i),this.statsUploader.requestUploadStats=n=>this.emit(Ft.RequestUploadStats,n),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var n;return{connectState:((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await $s(hM(this.dtlsFailedCount,ss)),this.emit(Ft.RequestReconnect)}async reconnectP2P(){const n=Array.from(this.localTrackMap.entries()),i=this.createGatewayUnpublishMessage(n);Array.from(this.remoteUserMap.entries()),i.length>0&&await ho(this,Ft.RequestUnpublishForReconnectPC,i),this.disconnectForReconnect(),this.emit(Ft.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Qe.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof qr)}throwIfTrackTypeNotMatch(n){if(n.filter(i=>i instanceof qr).length>1)throw new Fe(ie.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(i=>i instanceof bi).length>1&&(n.some(i=>i instanceof bi&&i._bypassWebAudio)||!Xn().webAudioMediaStreamDest))throw new Fe(ie.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of n){if(i instanceof qr&&this.pendingLocalTracks.some(s=>s instanceof qr))throw new Fe(ie.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof bi&&this.pendingLocalTracks.some(s=>s instanceof bi)&&(!Xn().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof bi&&s._bypassWebAudio)))throw new Fe(ie.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,i){var s;const c=!le("DISABLE_DUAL_STREAM_USE_ENCODING")&&Xn().supportDualStreamEncoding,l=$h($h({},{width:160,height:120,framerate:15,bitrate:50}),i);let h;h=c?n._mediaStreamTrack.clone():SU(n,l);const p=Nr(8,"track-low-"),v=new qr(h,$h($h({},c&&{scaleResolutionDownBy:rU(l,n)}),{},{frameRate:l.framerate,bitrateMax:l.bitrate,bitrateMin:l.bitrate}),void 0,void 0,p);return v.on(i_.TRANSCEIVER_UPDATED,y=>{n._updateRtpTransceiver(y,ZE.LOW_STREAM)}),v._hints.push(Dr.LOW_STREAM),dt(s=n._hints).call(s,Dr.SCREEN_TRACK)&&v._hints.push(Dr.SCREEN_LOW_TRACK),n.on("sei-to-send",y=>{v.emit("sei-to-send",y)}),n.addListener(wt.NEED_CLOSE,()=>{v.close()}),v}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(n,i,s){let c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Kh){var l,h,p,v;const y=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:S,dtlsTransportState:b,peerConnectionState:R}=this.connection,{local:O,remote:N}=await this.connection.getSelectedCandidatePair();kt.pcStats(this.store.sessionId,{startTime:y,eventElapse:n-y||0,iceconnectionsate:S,dtlsstate:b,connectionstate:R,intSucc:i?1:2,error:this._iceError||c||"",selectedLocalCandidateProtocol:(l=O==null?void 0:O.protocol)!==null&&l!==void 0?l:"",selectedLocalCandidateType:(h=O.candidateType)!==null&&h!==void 0?h:"",selectedLocalCandidateAddress:"".concat(O.address,":").concat(O.port),selectedRemoteCandidateProtocol:(p=N.protocol)!==null&&p!==void 0?p:"",selectedRemoteCandidateType:(v=N.candidateType)!==null&&v!==void 0?v:"",selectedRemoteCandidateAddress:"".concat(N.address,":").concat(N.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(n,i,s,c){var l;const h=Array.from(zu(l=this.remoteUserMap).call(l)).find(p=>p._videoSSRC===n);if(h){c||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,v=p.subscribe.find(y=>y.userId===h.uid&&y.type==="video");kt.firstRemoteVideoDecode(this.store.sessionId,Cs.FIRST_VIDEO_DECODE,ni.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:i,videoheight:s,subscribeElapse:Ao.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:(v==null?void 0:v.subscribeEnd)||0,subscriberStart:(v==null?void 0:v.subscribeStart)||0,videoAddNotify:(v==null?void 0:v.streamAdded)||0,state:c?1:0,firstFrame:(v==null?void 0:v.firstFrame)||0})}}async remoteMediaSsrcChanged(n,i,s){if(!this.connection)return!1;const c=this.remoteUserMap.get(n);if(!c)return!1;const l=c.get(i);if(!l)return!1;const h=await this.connection.getRemoteSSRC(l);return h!==void 0&&h!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:s}]=n;i===Qe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,ZE.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Ct(bn.prototype,"startP2PConnection",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"startP2PConnection"),bn.prototype),Ct(bn.prototype,"connect",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"connect"),bn.prototype),Ct(bn.prototype,"updateRemoteRTPCapabilities",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"updateRemoteRTPCapabilities"),bn.prototype),Ct(bn.prototype,"publishDataChannel",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"publishDataChannel"),bn.prototype),Ct(bn.prototype,"unpublish",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"unpublish"),bn.prototype),Ct(bn.prototype,"unpublishDataChannel",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"unpublishDataChannel"),bn.prototype),Ct(bn.prototype,"unpublishLowStream",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"unpublishLowStream"),bn.prototype),Ct(bn.prototype,"subscribeDataChannel",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"subscribeDataChannel"),bn.prototype),Ct(bn.prototype,"subscribe",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"subscribe"),bn.prototype),Ct(bn.prototype,"massSubscribe",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"massSubscribe"),bn.prototype),Ct(bn.prototype,"unsubscribe",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"unsubscribe"),bn.prototype),Ct(bn.prototype,"unsubscribeDataChannel",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"unsubscribeDataChannel"),bn.prototype),Ct(bn.prototype,"massUnsubscribe",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"massUnsubscribe"),bn.prototype),Ct(bn.prototype,"muteRemote",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"muteRemote"),bn.prototype),Ct(bn.prototype,"unmuteRemote",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteRemote"),bn.prototype),Ct(bn.prototype,"hasRemoteMediaWithLock",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"hasRemoteMediaWithLock"),bn.prototype),Ct(bn.prototype,"disconnectForReconnect",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"disconnectForReconnect"),bn.prototype),Ct(bn.prototype,"updateBitrateLimit",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"updateBitrateLimit"),bn.prototype),Ct(bn.prototype,"remoteMediaSsrcChanged",[ma],Object.getOwnPropertyDescriptor(bn.prototype,"remoteMediaSsrcChanged"),bn.prototype),bn);function ma(n,i,s){const c=n[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const l=this.mutex,h=await l.lock("From P2PChannel.".concat(i));try{for(var p=arguments.length,v=new Array(p),y=0;y<p;y++)v[y]=arguments[y];return await c.apply(this,v)}finally{h()}},s}function R7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function I7(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?R7(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):R7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}const xSe=Date.now(),MSe=20,bU=new Map,OO=new Map;async function A7(n){const i=bU.get(n),s=Array.isArray(i)&&i[i.length-1],c=OO.get(n);if(!s)return void(c.isSyncing=!1);const l={uid:s.uid,payload:s.payload};c.firstRecvTs===0&&(c.firstRecvTs=s.recvTs,c.firstSendTs=s.sendTs);const h=s.sendTs-c.firstSendTs,p=h-(Date.now()-c.firstRecvTs);p>0&&(c.firstRecvTs=Date.now()-h);let v=s.mediaDelay+p;v<=0?(i.pop(),k7(s.context,l),v=0):v=Math.min(v,MSe),setTimeout(()=>i.length&&A7(n),v)}function k7(n,i){n.safeEmit(kn.STREAM_MESSAGE,i.uid,i.payload),n.onStreamMessage&&n.onStreamMessage(i)}function USe(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!n.syncWithAudio)return k7(s,{uid:n.uid,payload:n.payload});const c="".concat(s.id,"-").concat(n.uid),l=bU.get(c)||[],h=l.findIndex(S=>n.sendTs>=S.sendTs),p=I7(I7({},n),{},{context:s,mediaDelay:i,recvTs:Date.now()});h===-1?l.push(p):l.splice(h,0,p),bU.set(c,l);let v=!1;var y;OO.has(c)?v=!((y=OO.get(c))===null||y===void 0||!y.isSyncing):OO.set(c,{isSyncing:v,firstRecvTs:0,firstSendTs:0}),v||A7(c)}const VSe=zn().name;function O7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function P7(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?O7(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):O7(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}const SS="websdk_ng_cache_parameter",FSe=le("MAX_PRELOAD_ASYNC_LENGTH"),jSe=1e4,v_=new Map,__=[];let wU=null,CU=0,RU=0;const PO=new Map,BSe=function(n,i){const s=[];let c=0;const l=async()=>{const h=s.shift();h&&await h(),s.length>0&&c<i?l():c--};return async function(){for(var h=arguments.length,p=new Array(h),v=0;v<h;v++)p[v]=arguments[v];return new pt(async(y,S)=>{s.push(async()=>{try{const b=await n(...p);y(b)}catch(b){S(b)}}),c<i&&(c++,l())})}}(N7,FSe),IU=tc.CancelToken.source();async function N7(n,i,s,c,l,h){try{if(!le("ENABLE_PRELOAD"))return;if(!Xn().supportWebCrypto)return void Bm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Fe(ie.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&qs(s,"token",1,2047),qs(n,"appid",1,2047),aO(i),c&&cO(c);const p=n_();x.debug("preload channel ".concat(i,", uid is ").concat(c));const v={appId:n,cname:i,token:s||n,uid:typeof c!="string"?c:null,sid:p,proxyServer:l};let y,S;typeof c=="string"?(v.stringUid=c,[S,y]=await pt.all([bSe(c,{sid:p,appId:n},IU.token),e7(P7(P7({},v),{},{token:s||n,uid:0}),IU.token)]),v.uid=S.uid,y.gatewayInfo.uid=v.uid,y.gatewayInfo.res.uid=v.uid):(h&&(v.stringUid=h),y=await e7(v,IU.token));const b={sid:p,appId:n,cname:i,token:s||n,uid:v.stringUid||c,intUid:v.uid||y.gatewayInfo.uid,stringUid:v.stringUid,ts:Date.now(),sua:S,ap:y};await async function(R){let O;try{R.uid&&L7({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const N=V7(R),Y=await async function(H,ne){try{const re=await window.crypto.subtle.importKey("raw",w9(ne),"AES-GCM",!1,["encrypt"]),me=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},re,t_(window.btoa(JSON.stringify(H))));return Wm(new Uint8Array(me))}catch{return}}(R,R.token||R.appId);if(!Y)return;O=U7(SS);const W=O?JSON.parse(O):[];W.push({[N]:Y}),W.length>le("AP_CACHE_NUM")&&W.shift(),NO(SS,JSON.stringify(W))}catch(N){x.warn("Error caching server parameters:",N.message),NO(SS,"")}}(b),CU++}catch(p){throw RU++,function(v){wU||(wU=window.setTimeout(()=>{let S="";PO.forEach((b,R)=>{S+="".concat(R,": ").concat(b," ;")}),kt.reportApiInvoke(null,{name:is.PRELOAD,options:{success:CU,failed:RU,err:S}}).onError(v),CU=0,RU=0,PO.clear(),wU=null},jSe));const y=PO.get(v.code)||0;PO.set(v.code,y+1)}(p),p}}async function D7(n){try{if(le("AP_REQUEST_DETAIL")||le("ENABLE_ROLE_SELECT_EDGE"))return;const i=L7(n);if(!i||n.cloudProxyServer!=="disabled")return;const s=await async function(c,l){try{const h=await window.crypto.subtle.importKey("raw",w9(l),"AES-GCM",!1,["decrypt"]),p=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},h,t_(c));return JSON.parse(window.atob(Wm(new Uint8Array(p))))}catch{return}}(i,n.token||n.appId);if(!s||!function(c,l){return c.cname===l.cname&&c.appId===l.appId&&c.token===l.token?l.stringUid?c.stringUid===l.stringUid:typeof l.uid=="number"?c.uid===l.uid:c.uid==l.uid:!1}(s,n))return;if(s&&Date.now()-s.ts<le("AP_CACHE_LIFETIME"))return s}catch(i){x.warn("Error get preloadInfo",i.message)}}function L7(n){let i;try{if(i=U7(SS),!i)return;const s=JSON.parse(i),c=V7(n),l=function(p,v){for(let y=p.length-1;y>=0;y--)if(v(p[y]))return y;return-1}(s,p=>c in p);if(l===-1)return;const h=s.splice(l,1)[0];return NO(SS,JSON.stringify(s)),h[c]}catch(s){x.warn("Error delete preload info: ".concat(i),s.message),NO(SS,"")}}function AU(n){if(n){let i=v_.get(n);i&&(window.clearTimeout(i),i=null,v_.delete(n)),dt(__).call(__,n)||n.cloudProxyServer!=="disabled"||__.push(n)}if(v_.size<le("AP_CACHE_NUM")&&__.length>0){const i=__.shift();v_.set(i,window.setTimeout(async()=>{const{appId:s,cname:c,token:l,stringUid:h,uid:p,proxyServer:v}=i;try{await BSe(s,c,l,p,v,h),v_.has(i)&&AU(i)}catch(y){x.warn("update preload failed",y.message),x7(i)}},le("AP_UPDATE_INTERVAL")))}}function x7(n){const i=__.indexOf(n);i!==-1&&__.splice(i,1);let s=v_.get(n);s&&(window.clearTimeout(s),s=null,v_.delete(n),AU())}function M7(n,i){const s=n.sua,c=n.ap;i&&s&&kt.reqUserAccount(n.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:i,uid:n.intUid,errorCode:null,extend:s.req}),kt.reportResourceTiming(n.ap.url,n.sid),kt.joinWebProxyAP(n.sid,{lts:c.requestTime,elapse:c.elapse,sucess:1,apServerAddr:c.url,turnServerAddrList:c.proxyInfo.addresses.map(l=>l.ip).join(","),eventType:"disabled",unilbsServerIds:[Yi.CHOOSE_SERVER,Yi.CLOUD_PROXY_FALLBACK].toString()}),kt.joinChooseServer(n.sid,{lts:c.requestTime,elapse:c.elapse,succ:!0,csAddr:c.url,opid:c.opid,serverList:c.gatewayInfo.gatewayAddrs.map(l=>l.address),ec:null,cid:c.gatewayInfo.cid.toString(),uid:c.gatewayInfo.uid.toString(),csIp:c.gatewayInfo.csIp,unilbsServerIds:[Yi.CHOOSE_SERVER].toString(),isHttp3:c.isHttp3})}function U7(n){return window.atob(window.localStorage.getItem(n)||"")}function NO(n,i){window.localStorage.setItem(n,window.btoa(i))}function V7(n){let i="".concat(n.appId,"_").concat(n.cname);return typeof n.uid=="string"&&(i+="_s_".concat(n.uid)),typeof n.uid=="number"&&(i+="_".concat(n.uid)),n.token&&(i+="_".concat(n.token)),P9(i)}function WSe(n){let i=function(){const s=HSe.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,c){let l=s.appId;l!==void 0&&(Qi(c,10),Qm(c,l));let h=s.cid;h!==void 0&&(Qi(c,16),Qi(c,h));let p=s.cname;p!==void 0&&(Qi(c,26),Qm(c,p));let v=s.deviceId;v!==void 0&&(Qi(c,34),Qm(c,v));let y=s.elapse;y!==void 0&&(Qi(c,40),Zm(c,y));let S=s.fileSize;S!==void 0&&(Qi(c,48),Zm(c,TS(S)));let b=s.height;b!==void 0&&(Qi(c,56),Zm(c,TS(b)));let R=s.jpg;R!==void 0&&(Qi(c,66),Qi(c,R.length),j7(c,R));let O=s.networkType;O!==void 0&&(Qi(c,72),Zm(c,TS(O)));let N=s.osType;N!==void 0&&(Qi(c,80),Zm(c,TS(N)));let Y=s.requestId;Y!==void 0&&(Qi(c,90),Qm(c,Y));let W=s.sdkVersion;W!==void 0&&(Qi(c,98),Qm(c,W));let H=s.sequence;H!==void 0&&(Qi(c,104),Zm(c,TS(H)));let ne=s.sid;ne!==void 0&&(Qi(c,114),Qm(c,ne));let re=s.timestamp;re!==void 0&&(Qi(c,120),Zm(c,re));let me=s.uid;me!==void 0&&(Qi(c,128),Qi(c,me));let be=s.vid;be!==void 0&&(Qi(c,136),Qi(c,be));let we=s.width;we!==void 0&&(Qi(c,144),Zm(c,TS(we)));let Se=s.service;Se!==void 0&&(Qi(c,152),Qi(c,Se));let Le=s.callbackData;Le!==void 0&&(Qi(c,162),Qi(c,Le.length),j7(c,Le));let et=s.ticket;et!==void 0&&(Qi(c,170),Qm(c,et));let mt=s.vendorConfigs;mt!==void 0&&(Qi(c,178),Qm(c,mt))}(n,i),function(s){let c=s.bytes,l=s.limit;return c.length===l?c:c.subarray(0,l)}(i)}function zSe(n){return function(s){let c={};e:for(;!KSe(s);){let l=iw(s);switch(l>>>3){case 0:break e;case 1:c.code=iw(s);break;case 2:c.msg=B7(s,iw(s));break;case 3:c.requestId=B7(s,iw(s));break;case 4:c.timestamp=qSe(s,!1);break;default:GSe(s,7&l)}}return c}({bytes:i=n,offset:0,limit:i.length});var i}function GSe(n,i){switch(i){case 0:for(;128&hd(n););break;case 2:kU(n,iw(n));break;case 5:kU(n,4);break;case 1:kU(n,8);break;default:throw new Error("Unimplemented type: "+i)}}function TS(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let HSe=[];function kU(n,i){if(n.offset+i>n.limit)throw new Error("Skip past limit");n.offset+=i}function KSe(n){return n.offset>=n.limit}function DO(n,i){let s=n.bytes,c=n.offset,l=n.limit,h=c+i;if(h>s.length){let p=new Uint8Array(2*h);p.set(s),n.bytes=p}return n.offset=h,h>l&&(n.limit=h),c}function F7(n,i){let s=n.offset;if(s+i>n.limit)throw new Error("Read past limit");return n.offset+=i,s}function j7(n,i){let s=DO(n,i.length);n.bytes.set(i,s)}function B7(n,i){let s=F7(n,i),c=String.fromCharCode,l=n.bytes,h="",p="";for(let v=0;v<i;v++){let y,S,b,R,O=l[v+s];(128&O)==0?p+=c(O):(224&O)==192?v+1>=i?p+=h:(y=l[v+s+1],(192&y)!=128?p+=h:(R=(31&O)<<6|63&y,R<128?p+=h:(p+=c(R),v++))):(240&O)==224?v+2>=i?p+=h:(y=l[v+s+1],S=l[v+s+2],(49344&(y|S<<8))!=32896?p+=h:(R=(15&O)<<12|(63&y)<<6|63&S,R<2048||R>=55296&&R<=57343?p+=h:(p+=c(R),v+=2))):(248&O)==240?v+3>=i?p+=h:(y=l[v+s+1],S=l[v+s+2],b=l[v+s+3],(12632256&(y|S<<8|b<<16))!=8421504?p+=h:(R=(7&O)<<18|(63&y)<<12|(63&S)<<6|63&b,R<65536||R>1114111?p+=h:(R-=65536,p+=c(55296+(R>>10),56320+(1023&R)),v+=3))):p+=h}return p}function Qm(n,i){let s=i.length,c=0;for(let p=0;p<s;p++){let v=i.charCodeAt(p);v>=55296&&v<=56319&&p+1<s&&(v=(v<<10)+i.charCodeAt(++p)-56613888),c+=v<128?1:v<2048?2:v<65536?3:4}Qi(n,c);let l=DO(n,c),h=n.bytes;for(let p=0;p<s;p++){let v=i.charCodeAt(p);v>=55296&&v<=56319&&p+1<s&&(v=(v<<10)+i.charCodeAt(++p)-56613888),v<128?h[l++]=v:(v<2048?h[l++]=v>>6&31|192:(v<65536?h[l++]=v>>12&15|224:(h[l++]=v>>18&7|240,h[l++]=v>>12&63|128),h[l++]=v>>6&63|128),h[l++]=63&v|128)}}function hd(n){return n.bytes[F7(n,1)]}function W7(n,i){let s=DO(n,1);n.bytes[s]=i}function iw(n){let i,s=0,c=0;do i=hd(n),s<32&&(c|=(127&i)<<s),s+=7;while(128&i);return c}function Qi(n,i){for(i>>>=0;i>=128;)W7(n,127&i|128),i>>>=7;W7(n,i)}function qSe(n,i){let s,c=0,l=0,h=0;return s=hd(n),c=127&s,128&s&&(s=hd(n),c|=(127&s)<<7,128&s&&(s=hd(n),c|=(127&s)<<14,128&s&&(s=hd(n),c|=(127&s)<<21,128&s&&(s=hd(n),l=127&s,128&s&&(s=hd(n),l|=(127&s)<<7,128&s&&(s=hd(n),l|=(127&s)<<14,128&s&&(s=hd(n),l|=(127&s)<<21,128&s&&(s=hd(n),h=127&s,128&s&&(s=hd(n),h|=(127&s)<<7))))))))),{low:c|l<<28,high:l>>>4|h<<24,unsigned:i}}function Zm(n,i){let s=i.low>>>0,c=(i.low>>>28|i.high<<4)>>>0,l=i.high>>>24,h=l===0?c===0?s<16384?s<128?1:2:s<1<<21?3:4:c<16384?c<128?5:6:c<1<<21?7:8:l<128?9:10,p=DO(n,h),v=n.bytes;switch(h){case 10:v[p+9]=l>>>7&1;case 9:v[p+8]=h!==9?128|l:127&l;case 8:v[p+7]=h!==8?c>>>21|128:c>>>21&127;case 7:v[p+6]=h!==7?c>>>14|128:c>>>14&127;case 6:v[p+5]=h!==6?c>>>7|128:c>>>7&127;case 5:v[p+4]=h!==5?128|c:127&c;case 4:v[p+3]=h!==4?s>>>21|128:s>>>21&127;case 3:v[p+2]=h!==3?s>>>14|128:s>>>14&127;case 2:v[p+1]=h!==2?s>>>7|128:s>>>7&127;case 1:v[p]=h!==1?128|s:127&s}}const z7={},G7={},LO=4294967296,$Se=LO*LO,YSe=$Se/2;K7(0,!0);const H7=K7(0),XSe=sw(0,-2147483648,!1),JSe=sw(-1,2147483647,!1);function K7(n,i){let s,c,l;return i?(l=0<=(n>>>=0)&&n<256)&&(c=G7[n],c)?c:(s=sw(n,0,!0),l&&(G7[n]=s),s):(l=-128<=(n|=0)&&n<128)&&(c=z7[n],c)?c:(s=sw(n,n<0?-1:0,!1),l&&(z7[n]=s),s)}function sw(n,i,s){return{low:0|n,high:0|i,unsigned:!!s}}function q7(n,i){if(isNaN(n))return H7;{if(n<=-9223372036854776e3)return XSe;if(n+1>=YSe)return JSe}return n<0?H7:sw(n%LO|0,n/LO|0,i)}function $7(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}class OU extends li{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const s=this._connectionState;this._connectionState=i,this.emit(th.CONNECTION_STATE_CHANGE,i,s)}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(i){var s;super(),ee(this,"name","AgoraRTCImageModeration"),ee(this,"_connectionState",Al.CONNECTING),ee(this,"_sequence",0),ee(this,"_moderationStartTime",void 0),ee(this,"_workerConnection",void 0),ee(this,"_workerMessageLengthLimit",void 0),ee(this,"_qualityRatio",void 0),ee(this,"_connectInfo",void 0),ee(this,"_cancelTokenSource",tc.CancelToken.source()),ee(this,"_retryConfig",void 0),ee(this,"_moderationInterval",void 0),ee(this,"_moderationTimer",null),ee(this,"_moderationMode",1),ee(this,"_quality",1),ee(this,"_qualityTimer",null),ee(this,"_ticket",void 0),ee(this,"_moderationIntervalMinimum",void 0),ee(this,"_uploadFailedNum",0),ee(this,"_uploadNum",0),ee(this,"_uploadTimer",null),ee(this,"_extraInfo",void 0),ee(this,"_vendor",""),ee(this,"_encoder",new TextEncoder),ee(this,"_moderationId",void 0),ee(this,"inspectImage",()=>{if(this.connectionState!==Al.CONNECTED)throw new Pe(ie.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Al.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Nr(5,"image-moderation-"),this._workerMessageLengthLimit=le("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=le("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=i.interval)!==null&&s!==void 0?s:1e3,i.extraInfo&&(this._extraInfo=this._encoder.encode(i.extraInfo)),i.vendor&&(this._vendor=i.vendor),this._qualityRatio=le("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new $b("worker-"+this._moderationId,ss),this.on(th.STATE_CHANGE,(c,l)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(dS[c]," ").concat(l||""))}),this.handleWorkerEvents()}async init(i,s){this.emit(th.STATE_CHANGE,dS.CONNECT_AP),this._connectInfo=i;const c=this._cancelTokenSource.token;return this._retryConfig=s,new pt((l,h)=>{this.on(th.CONNECTION_STATE_CHANGE,(p,v)=>{p===Al.CONNECTED&&l()}),this.requestAP(i,c,s).then(p=>{this.connectWorker(p)}).catch(p=>{h(p)})})}updateConfig(i){var s;this._moderationInterval=(s=i.interval)!==null&&s!==void 0?s:1e3,i.extraInfo&&(this._extraInfo=this._encoder.encode(i.extraInfo)),i.vendor&&(this._vendor=i.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(i))),this.connectionState===Al.CONNECTED&&this.inspectImage()}async requestAP(i,s,c){const l=le("WEBCS_DOMAIN").map(y=>"https://".concat(y,"/api/v1")),h=await function(y,S,b,R){let{appId:O,areaCode:N,cname:Y,sid:W,token:H,uid:ne}=S;vS++;const re="moderation_plugin",me={service_name:re,json_body:JSON.stringify({appId:O,areaCode:N,cname:Y,command:"allocateEdge",requestId:vS,seq:vS,sid:W,appToken:H,ts:Date.now(),uid:ne+""})};let be,we,Se=y[0];return Jd(async()=>{be=Date.now();const Le=await nh(Se,{data:me,cancelToken:b,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(we=Date.now()-be,Le.code!==0){const Et=new Pe(ie.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Le.code,{retry:!0,responseTime:we});throw x.error(Et.toString()),Et}const et=JSON.parse(Le.json_body);if(et.code!==200){const Et=new Pe(ie.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(et.code,", reason: ").concat(et.reason),{code:et.code,responseTime:we});throw x.error(Et.toString()),Et}if(!et.servers||!Array.isArray(et.servers)||et.servers.length===0){const Et=new Pe(ie.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:et.code,responseTime:we});throw x.error(Et.toString()),Et}if(!et.servers.some(Et=>!!Et.wss)){const Et=new Pe(ie.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:et.code,responseTime:we});throw x.error(Et.toString()),Et}const mt=le("IMAGE_MODERATION_WORKER_HOST");return{addressList:et.servers.map(Et=>{let{address:xn,wss:Mn}=Et;if(xn&&Mn)return"wss://".concat(xn.replace(/\./g,"-"),".").concat(mt,":").concat(Mn,"/moderation")}).filter(Et=>!!Et),workerToken:et.workerToken,vid:et.vid,ticket:et.appTicket,responseTime:we}},(Le,et)=>(kt.apworkerEvent(W,{success:!0,sc:200,serviceName:re,responseDetail:JSON.stringify(Le.addressList),firstSuccess:et===0,responseTime:we,serverIp:y[et%y.length]}),!1),(Le,et)=>(kt.apworkerEvent(W,{success:!1,sc:Le.data&&Le.data.code||200,serviceName:re,responseTime:we,serverIp:y[et%y.length]}),!!(Le.code!==ie.OPERATION_ABORTED&&Le.code!==ie.UNEXPECTED_RESPONSE||Le.data&&Le.data.retry)&&(Se=y[(et+1)%y.length],!0)),R)}(l,i,s,c);this.emit(th.STATE_CHANGE,dS.AP_CONNECTED);const{addressList:p,ticket:v}=h;return this._ticket=v,p}async connectWorker(i){this.emit(th.STATE_CHANGE,dS.CONNECT_WORKER),await this._workerConnection.init(i,1e4)}handleWorkerEvents(){this._workerConnection.on(un.CONNECTED,async()=>{this.emit(th.STATE_CHANGE,dS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Al.CONNECTED}),this._workerConnection.on(un.CLOSED,()=>{this.connectionState=Al.CLOSED}),this._workerConnection.on(un.FAILED,()=>{this.connectionState=Al.CLOSED}),this._workerConnection.on(un.RECONNECTING,()=>{this.connectionState=this.connectionState===Al.CONNECTED?Al.RECONNECTING:Al.CONNECTING}),this._workerConnection.on(un.ON_MESSAGE,async i=>{if(i.data instanceof ArrayBuffer){const s=zSe(new Uint8Array(i.data));le("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{kt.reportApiInvoke(this._connectInfo.sid||null,{name:is.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:_i.TRACER}).onError(new Pe(ie.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},le("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(un.WILL_RECONNECT,(i,s,c)=>{i==="recover"&&c(i),c("tryNext")}),this._workerConnection.on(un.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}async requestToInspectImage(){const i=Bu(this,th.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(i){if(!i.isPlaying)return void(le("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const c=await this.generateRequestData(i,s);this._workerConnection.sendMessage(c,!0,!0)}else le("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(i,s){let{appId:c,cname:l,cid:h,vid:p,sid:v,uid:y}=s;const S=Date.now(),b=await i.getCurrentFrameImage("image/jpeg",this.quality),R=await EK(b,c,l),O=this._sequence+"-"+h+"-"+y+"-"+S+"-"+Nr(12,""),N={appId:c,cid:h,cname:l,deviceId:"",elapse:OU.intToLong(Number(S-this._moderationStartTime)),fileSize:b.buffer.byteLength,height:b.height,width:b.width,jpg:R,networkType:6,osType:7,requestId:O,sdkVersion:"4.23.2",sequence:this._sequence,sid:v,timestamp:q7(S),uid:y,vid:p,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete N.callbackData;const Y=WSe(N);if(Y.byteLength<this._workerMessageLengthLimit){if(le("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const W=function(H){for(var ne=1;ne<arguments.length;ne++){var re=arguments[ne]!=null?arguments[ne]:{};ne%2?$7(Object(re),!0).forEach(function(me){ee(H,me,re[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties(H,Object.getOwnPropertyDescriptors(re)):$7(Object(re)).forEach(function(me){Object.defineProperty(H,me,Object.getOwnPropertyDescriptor(re,me))})}return H}({},N);delete W.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(W))}return Y}{const W=this.quality*this._qualityRatio;return this.quality=W,await this.generateRequestData(i,{appId:c,cname:l,cid:h,vid:p,sid:v,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=tc.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Al.CLOSED,this.emit(th.STATE_CHANGE,dS.CLOSED)}}function Y7(n){if(Tr(n.interval,"interval",1e3,1/0),n&&n.extraInfo&&n.extraInfo.length>1024)throw new Pe(ie.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(n&&n.vendor&&n.vendor.length>1024)throw new Pe(ie.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const QSe={name:"ImageModeration",create:function(n){let{config:i}=n;return Y7(i),new OU(i)}};var X7,J7,Q7,Z7,e$,t$,n$,r$,i$,s$,o$,a$,c$,u$,l$,d$,h$,f$,p$,m$,g$,v$,_$,y$,E$,S$,T$,b$,w$,C$,R$,I$,A$,k$,O$,P$,N$,D$,L$,x$,M$,yt;function U$(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function fd(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?U$(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):U$(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}Co.setLogger(x);let ZSe=(X7=zt(),J7=zt({argsMap:(n,i)=>{if(!Array.isArray(i)){if(!(i instanceof rS))return[i];i=[i]}return i.map(s=>s?Object(s).toString():"null")}}),Q7=zt({argsMap:(n,i)=>(i||(i=[]),Array.isArray(i)||i.trackMediaType!==nS.DATA?(Array.isArray(i)||(i=[i]),i.map(s=>s.getTrackId())):[i.getChannelId()])}),Z7=zt({argsMap:(n,i,s,c)=>[typeof i=="object"?i.uid:i,s,c]}),e$=zt({argsMap:(n,i,s)=>[i,s]}),t$=zt({argsMap:(n,i)=>i.map(s=>{let{user:c,mediaType:l}=s;return[c==null?void 0:c.uid,l]})}),n$=zt({argsMap:(n,i,s,c)=>[typeof i=="object"?i.uid:i,s,c]}),r$=zt({argsMap:(n,i)=>i.map(s=>{let{user:c,mediaType:l}=s;return{uid:c==null?void 0:c.uid,mediaType:l}})}),i$=zt(),s$=zt(),o$=zt(),a$=zt(),c$=zt(),u$=zt(),l$=zt(),d$=zt(),h$=zt(),f$=zt(),p$=zt(),m$=zt(),g$=zt(),v$=zt(),_$=zt(),y$=zt({argsMap:(n,i)=>[i]}),E$=zt(),S$=zt(),T$=zt(),b$=zt(),w$=zt(),C$=zt(),R$=zt(),I$=zt(),A$=zt({argsMap:(n,i)=>(Array.isArray(i)||(i=[i]),[JSON.stringify(i)])}),k$=zt(),O$=zt(),P$=zt(),N$=zt(),D$=zt(),L$=zt(),x$=zt({reportResult:!0}),M$=zt(),yt=class extends li{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var n;return((n=this._config)===null||n===void 0?void 0:n.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(n,i){let s;if(super(),ee(this,"store",void 0),ee(this,"_uid",void 0),ee(this,"_channelName",void 0),ee(this,"_uintUid",void 0),ee(this,"_users",[]),ee(this,"_config",void 0),ee(this,"_clientId",void 0),ee(this,"_appId",void 0),ee(this,"_sessionId",null),ee(this,"_key",void 0),ee(this,"_rtmConfig",{}),ee(this,"_joinInfo",void 0),ee(this,"_gateway",void 0),ee(this,"_statsCollector",void 0),ee(this,"_configDistribute",void 0),ee(this,"_leaveMutex",void 0),ee(this,"_publishMutex",void 0),ee(this,"_renewTokenMutex",void 0),ee(this,"_subscribeMutex",void 0),ee(this,"_encryptionMode","none"),ee(this,"_encryptionSecret",null),ee(this,"_encryptionSalt",null),ee(this,"_encryptDataStream",!1),ee(this,"_encryptDataStreamKey",null),ee(this,"_encryptDataStreamIv",null),ee(this,"_proxyServer",void 0),ee(this,"_turnServer",{servers:[],mode:"auto"}),ee(this,"_cloudProxyServerMode","disabled"),ee(this,"_isDualStreamEnabled",!1),ee(this,"_defaultStreamFallbackType",void 0),ee(this,"_lowStreamParameter",void 0),ee(this,"_streamFallbackTypeCacheMap",new Map),ee(this,"_remoteStreamTypeCacheMap",new Map),ee(this,"_axiosCancelSource",tc.CancelToken.source()),ee(this,"_audioVolumeIndicationInterval",void 0),ee(this,"_networkQualityInterval",void 0),ee(this,"_userOfflineTimeout",void 0),ee(this,"_streamRemovedTimeout",void 0),ee(this,"_liveTranscodeStreamingClient",void 0),ee(this,"_liveRawStreamingClient",void 0),ee(this,"_channelMediaRelayClient",void 0),ee(this,"_networkQualitySensitivity","normal"),ee(this,"_p2pChannel",void 0),ee(this,"_useLocalAccessPoint",!1),ee(this,"_setLocalAPVersion",void 0),ee(this,"_joinAndNotLeaveYet",!1),ee(this,"_numberOfJoinCount",0),ee(this,"_remoteDefaultVideoStreamType",void 0),ee(this,"_inspect",void 0),ee(this,"_moderation",void 0),ee(this,"_license",void 0),ee(this,"_pendingPublishedUsers",[]),ee(this,"ntpAlignErrorCount",0),ee(this,"remoteInboundOffset",0),ee(this,"_peerConnectionState",void 0),ee(this,"_handleLocalTrackEnable",(l,h,p)=>{this.publish(l,!1).then(h).catch(p)}),ee(this,"_handleLocalTrackDisable",(l,h,p)=>{this.unpublish(l).then(h).catch(p)}),ee(this,"_handleUserOnline",l=>{if(le("BLOCK_LOCAL_CLIENT")&&l_(l.uid,this.channelName))return void x.debug("[".concat(l.uid,"] will be ignored in local"));this.isStringUID&&typeof l.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const h=this._users.find(p=>p.uid===l.uid);if(h)h._trust_in_room_=!0,h._is_pre_created&&(h._is_pre_created=!1,this.safeEmit(kn.USER_JOINED,h));else{const p=new Xm(l.uid,l.uint_id||l.uid);this._users.push(p),x.debug("[".concat(this._clientId,"] user online"),l.uid),this.safeEmit(kn.USER_JOINED,p)}}),ee(this,"_handleUserOffline",l=>{if(le("BLOCK_LOCAL_CLIENT")&&l_(l.uid,this.channelName))return;const h=this._users.find(p=>p.uid===l.uid);h&&(this._handleRemoveStream(l),this._handleRemoveDataChannels(l),h._audio_pre_subscribed||h._video_pre_subscribed?h._is_pre_created=!0:Mk(this._users,h),this._remoteStreamTypeCacheMap.delete(h.uid),this._streamFallbackTypeCacheMap.delete(h.uid),x.debug("[".concat(this._clientId,"] user offline"),l.uid,"reason:",l.reason),this.safeEmit(kn.USER_LEAVED,h,l.reason))}),ee(this,"_handleAddAudioOrVideoStream",(l,h,p,v,y,S,b)=>{if(le("BLOCK_LOCAL_CLIENT")&&l_(h,this.channelName))return;const R=this._users.find(N=>N.uid===h);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(h,", type ").concat(l)),this.store.subscribe(R.uid,l,void 0,void 0,void 0,Date.now());const O=l==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=y||h),l==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,l==="audio"?(R._audio_added_=!0,p!==void 0&&(R._audioSSRC=p),v!==void 0&&(R._cname=v),S&&(R._audioOrtc=S)):(R._video_added_=!0,p!==void 0&&(R._videoSSRC=p),v!==void 0&&(R._cname=v),b!==void 0&&(R._rtxSsrcId=b),S&&(R._videoOrtc=S)),(l==="audio"?R.hasAudio:R.hasVideo)&&!O&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(l)),this.safeEmit(kn.USER_PUBLISHED,R,l)),l==="video"?kt.onGatewayStream(this._sessionId,Cs.ON_ADD_VIDEO_STREAM,ni.ON_ADD_VIDEO_STREAM,{peer:y||h,ssrc:R._videoSSRC}):kt.onGatewayStream(this._sessionId,Cs.ON_ADD_AUDIO_STREAM,ni.ON_ADD_AUDIO_STREAM,{peer:y||h,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,l,p).then(N=>{if(N&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof rw))return this._p2pChannel.unsubscribe(R,l,!0).then(()=>this._subscribe(R,l,!0).catch(Y=>{x.error("[".concat(this._clientId,"] resubscribe error"),Y.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,l)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,l,!0).catch(N=>{x.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),ee(this,"_handleRemoveStream",l=>{if(le("BLOCK_LOCAL_CLIENT")&&l_(l.uid,this.channelName))return;const h=this._users.find(v=>v.uid===l.uid);if(!h)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(l.uid));let p=()=>{};h.hasAudio&&h.hasVideo?p=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(h.uid," unpublished audio track")),this.safeEmit(kn.USER_UNPUBLISHED,h,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(h.uid," unpublished video track")),this.safeEmit(kn.USER_UNPUBLISHED,h,"video")}:h.hasVideo?p=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(h.uid," unpublished video track")),this.safeEmit(kn.USER_UNPUBLISHED,h,"video")}:h.hasAudio&&(p=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(h.uid," unpublished audio track")),this.safeEmit(kn.USER_UNPUBLISHED,h,"audio")}),h._video_pre_subscribed||h._audio_pre_subscribed||(h._trust_audio_stream_added_state_=!0,h._trust_video_stream_added_state_=!0,h._audio_added_=!1,h._video_added_=!1,this._p2pChannel instanceof rw&&this._p2pChannel.unsubscribe(h).then(v=>{if(v)return this._gateway.unsubscribe(v,h.uid)}),h._audioSSRC=void 0,h._videoSSRC=void 0,h._audioOrtc=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),kt.onGatewayStream(this._sessionId,Cs.ON_REMOVE_STREAM,ni.ON_REMOVE_STREAM,{peer:l.uint_id||l.uid}),p()}),ee(this,"_handleSetStreamLocalEnable",(l,h,p)=>{if(le("BLOCK_LOCAL_CLIENT")&&l_(h,this.channelName))return;const v=this._users.find(b=>b.uid===h);if(!v)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(l," ").concat(p?"enabled":"disabled"," with uid ").concat(h));const y=l==="audio"?v.hasAudio:v.hasVideo;if(l==="audio"){v._trust_audio_enabled_state_=!0;const b=v._audio_enabled_;if(v._audio_enabled_=p,v._audio_enabled_===b)return;{const R=v._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(h,", msg: ").concat(R)),this.safeEmit(kn.USER_INFO_UPDATED,h,R)}}else{v._trust_video_enabled_state_=!0;const b=v._video_enabled_;if(v._video_enabled_=p,v._video_enabled_===b)return;{const R=v._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(h,", msg: ").concat(R)),this.safeEmit(kn.USER_INFO_UPDATED,h,R)}}const S=l==="audio"?v.hasAudio:v.hasVideo;return y!==S?!y&&S?(x.info("[".concat(this._clientId,"] remote user ").concat(h," published ").concat(l)),void this.safeEmit(kn.USER_PUBLISHED,v,l)):(l==="video"&&v._videoTrack&&v._videoTrack._destroy(),l==="audio"&&v._audioTrack,this._p2pChannel.muteRemote(v,l),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished ").concat(l)),void this.safeEmit(kn.USER_UNPUBLISHED,v,l)):void 0}),ee(this,"_handleMuteStream",(l,h,p)=>{if(le("BLOCK_LOCAL_CLIENT")&&l_(l,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),l,h,p);const v=this._users.find(b=>b.uid===l);if(!v)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(l));const y=h==="audio"?v.hasAudio:v.hasVideo;if(h==="audio"){v._trust_audio_mute_state_=!0;const b=v._audio_muted_;if(v._audio_muted_=p,v._audio_muted_===b)return;{const R=v._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(R)),this.safeEmit(kn.USER_INFO_UPDATED,l,R)}}else{v._trust_video_mute_state_=!0;const b=v._video_muted_;if(v._video_muted_=p,v._video_muted_===b)return;{const R=v._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(R)),this.safeEmit(kn.USER_INFO_UPDATED,l,R)}}const S=h==="audio"?v.hasAudio:v.hasVideo;if(y!==S){if(!y&&S)return(h==="audio"?v._audioSSRC:v._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(h)),void this.safeEmit(kn.USER_PUBLISHED,v,h)):void x.warning("[".concat(this._clientId,"] remote user ").concat(l," receive ").concat(h," unmute message  before add stream message, ").concat(h," SSRC doesn't exist yet."));h==="video"&&v._videoTrack&&!v._video_pre_subscribed&&v._videoTrack._destroy(),h==="audio"&&v._audioTrack,this._p2pChannel.muteRemote(v,h),x.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(h)),this.safeEmit(kn.USER_UNPUBLISHED,v,h)}}),ee(this,"_handleP2PLost",async l=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),l),parseInt(l.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),l)}),ee(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(kn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),ee(this,"_handleBeforeUnload",l=>{l.type==="beforeunload"&&l.returnValue!==void 0&&l.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),ee(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(kn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const l={downlinkNetworkQuality:0,uplinkNetworkQuality:0};l.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),l.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(kn.NETWORK_QUALITY,l)}),ee(this,"_handleP2PAddAudioOrVideoStream",(l,h,p,v)=>{const y=this._users.find(b=>b.uid===h);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(h,", type ").concat(l)),this.store.subscribe(y.uid,l,void 0,void 0,void 0,Date.now());const S=l==="audio"?y.hasAudio:y.hasVideo;l==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,l==="audio"?(y._audio_added_=!0,p!==void 0&&(y._audioSSRC=p),v!==void 0&&(y._audioMid=v)):(y._video_added_=!0,p!==void 0&&(y._videoSSRC=p),v!==void 0&&(y._videoMid=v)),(l==="audio"?y.hasAudio:y.hasVideo)&&!S&&(x.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(l)),this.safeEmit(kn.USER_PUBLISHED,y,l)),this._p2pChannel.hasPendingRemoteMedia(y,l)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,l,!0).catch(b=>{x.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),this._config=n,this._clientId=i||Nr(5,"client-"),this.store=new class{constructor(l,h,p,v){sn(this,"state",void 0),this.state={codec:l,audioCodec:h,mode:p,clientId:v,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:r_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(l){this.state=function(h,p){switch(p.type){case On.SET_SESSION_ID:return Tt(Tt({},h),{},{sessionId:p.sessionId});case On.SET_P2P_ID:return Tt(Tt({},h),{},{p2pId:p.p2pId});case On.SET_UID:return Tt(Tt({},h),{},{uid:p.uid});case On.SET_INT_UID:return Tt(Tt({},h),{},{intUid:p.intUid});case On.SET_PUB_ID:return Tt(Tt({},h),{},{pubId:p.pubId});case On.KEY_METRIC_CLIENT_CREATED:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{clientCreated:p.metric})});case On.KEY_METRIC_JOIN_START:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{joinStart:p.metric})});case On.AVOID_JOIN_START:return Tt(Tt({},h),{},{avoidJoinStart:p.avoidJoinStart});case On.KEY_METRIC_JOIN_END:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{joinEnd:p.metric})});case On.KEY_METRIC_REQUEST_AP_START:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{requestAPStart:p.metric})});case On.KEY_METRIC_REQUEST_AP_END:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{requestAPEnd:p.metric})});case On.KEY_METRIC_JOIN_GATEWAY_START:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{joinGatewayStart:p.metric})});case On.KEY_METRIC_JOIN_GATEWAY_END:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{joinGatewayEnd:p.metric})});case On.KEY_METRIC_PEER_CONNECTION_START:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{peerConnectionStart:p.metric})});case On.KEY_METRIC_PEER_CONNECTION_END:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{peerConnectionEnd:p.metric})});case On.KEY_METRIC_DESCRIPTION_START:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{descriptionStart:p.metric})});case On.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{signalChannelOpen:p.metric})});case On.KEY_METRIC_ICE_CONNECTION_END:return Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{iceConnectionEnd:p.metric})});case On.KEY_METRIC_PUBLISH:{const v=h.keyMetrics.publish,y=v.findIndex(S=>S.trackId===p.metric.trackId);return y!==-1?(v[y]=Tt(Tt({},v[y]),p.metric),Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{publish:[...v]})})):Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{publish:[...h.keyMetrics.publish,p.metric]})})}case On.KEY_METRIC_SUBSCRIBE:{const v=h.keyMetrics.subscribe,y=v.findIndex(S=>S.userId===p.metric.userId&&S.type===p.metric.type);return y!==-1?(v[y]=Tt(Tt({},v[y]),p.metric),Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{subscribe:[...v]})})):Tt(Tt({},h),{},{keyMetrics:Tt(Tt({},h.keyMetrics),{},{subscribe:[...h.keyMetrics.subscribe,p.metric]})})}case On.SET_CLOUD_PROXY_SERVER_MODE:return h.cloudProxyServerMode=p.mode,h;case On.RECORD_JOIN_CHANNEL_SERVICE:return typeof p.index!="number"?h.joinChannelServiceRecords=[...h.joinChannelServiceRecords,p.record]:(h.joinChannelServiceRecords[p.index]=Tt(Tt({},h.joinChannelServiceRecords[p.index]),p.record),h.joinChannelServiceRecords=[...h.joinChannelServiceRecords]),h;case On.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return h.joinChannelServiceRecords=[],h;case On.RESET_KEY_METRICS:return h.keyMetrics={publish:[],subscribe:[]},h;case On.SET_USE_P2P:return Tt(Tt({},h),{},{useP2P:p.val});case On.SET_TRANSPORT_TYPE:return Tt(Tt({},h),{},{p2pTransport:p.val});default:return h}}(this.state,l)}set sessionId(l){this.dispatch({type:On.SET_SESSION_ID,sessionId:l})}get sessionId(){return this.state.sessionId}set cid(l){this.state.cid=l}get cid(){return this.state.cid}set codec(l){this.state.codec=l}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(l){this.dispatch({type:On.SET_P2P_ID,p2pId:l})}get p2pId(){return this.state.p2pId}set dcId(l){this.dispatch({type:On.SET_DC_ID,dcId:l})}get dcId(){return this.state.dcId}set uid(l){this.dispatch({type:On.SET_UID,uid:l})}get uid(){return this.state.uid}set intUid(l){this.dispatch({type:On.SET_INT_UID,intUid:l})}get intUid(){return this.state.intUid}set pubId(l){this.dispatch({type:On.SET_PUB_ID,pubId:l})}get pubId(){return this.state.pubId}set cloudProxyServerMode(l){this.dispatch({type:On.SET_CLOUD_PROXY_SERVER_MODE,mode:l})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(l){this.dispatch({type:On.SET_USE_P2P,val:l})}get useP2P(){return this.state.useP2P}set p2pTransport(l){this.dispatch({type:On.SET_TRANSPORT_TYPE,val:l})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(l){this.state.hasStartJoinChannel=l}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(l){this.state.isABTestSuccess=l}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:On.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:On.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:On.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:On.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:On.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:On.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:On.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:On.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:On.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:On.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:On.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:On.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(l,h,p,v){this.dispatch({type:On.KEY_METRIC_PUBLISH,metric:Tt(Tt({trackId:l,type:h},p&&{publishStart:p}),v&&{publishEnd:v})})}subscribe(l,h,p,v,y,S,b){this.dispatch({type:On.KEY_METRIC_SUBSCRIBE,metric:Tt(Tt(Tt(Tt(Tt({userId:l,type:h},p&&{subscribeStart:p}),v&&{subscribeEnd:v}),y&&{firstFrame:y}),S&&{streamAdded:S}),b&&{firstDecoded:b})})}massSubscribe(l,h,p,v){l.forEach(y=>{this.dispatch({type:On.KEY_METRIC_SUBSCRIBE,metric:Tt(Tt(Tt({userId:y.userId,type:y.type},h&&{subscribeStart:h}),p&&{subscribeEnd:p}),v&&{firstFrame:v})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(l,h){l.service==="gateway"&&Array.isArray(l.urls)&&(l.urls=l.urls.map(p=>p.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof h!="number"?(this.dispatch({type:On.RECORD_JOIN_CHANNEL_SERVICE,record:Tt(Tt({},l),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(h<0||h>=this.state.joinChannelServiceRecords.length||this.dispatch({type:On.RECORD_JOIN_CHANNEL_SERVICE,record:l,index:h}),h)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:On.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:On.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(l){this.dispatch({type:On.AVOID_JOIN_START,avoidJoinStart:l})}}(n.codec,n.audioCodec,n.mode,this._clientId),this._leaveMutex=new Co("client-leave",this._clientId),this._publishMutex=new Co("client-publish",this._clientId),this._renewTokenMutex=new Co("client-renewtoken",this._clientId),this._subscribeMutex=new Co("client-subscribe",this._clientId),this.store.clientCreated(),n.proxyServer&&this.setProxyServer(n.proxyServer,!0),n.turnServer&&this.setTurnServer(n.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Cl," build: ").concat(TM,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),n.clientRoleOptions)try{uM(n.clientRoleOptions),s=Object.assign({},n.clientRoleOptions)}catch(l){x.warning("[".concat(this._clientId,"] ").concat(l.toString()))}var c;this._statsCollector=new tw(this.store),this._statsCollector.onStatsException=(l,h,p)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(l,", msg: ").concat(h,", uid: ").concat(p)),this.safeEmit(kn.EXCEPTION,{code:l,msg:h,uid:p})},this._statsCollector.onUploadPublishDuration=(l,h,p,v)=>{const y=this._users.find(S=>S.uid===l);y&&kt.peerPublishStatus(this._sessionId,{subscribeElapse:v,audioPublishDuration:h,videoPublishDuration:p,peer:y._uintid})},this.store.useP2P=n.mode==="p2p",this._gateway=new vSe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:n.websocketRetryConfig||ss,httpRetryConfig:n.httpRetryConfig||ss,forceWaitGatewayResponse:n.forceWaitGatewayResponse===void 0||n.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:n.role,clientRoleOptions:s}),this._configDistribute=new ISe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(c={store:this.store,statsCollector:this._statsCollector},vp("P2PChannel").create(c)),this._handleP2PEvents()):this._p2pChannel=new rw(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(n,i,s,c,l){let h=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],p=arguments.length>6&&arguments[6]!==void 0&&arguments[6];_r("JOIN_GATEWAY_USE_443PORT_ONLY",h),_r("JOIN_GATEWAY_USE_DUAL_DOMAIN",p);const v=this._gateway.signal.websocket;return v instanceof tU&&(v.use443PortOnly=h,v.tryDoubleDomain=p),async function(y,S,b){Pk.get(y)||Pk.set(y,[]),Nk.get(y)||Nk.set(y,S),Vh.get(y)||Vh.set(y,0);const R=Pk.get(y),O=Nk.get(y);if(!R||!O)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Vh.get(y)===O){const ne=Nb();R.push(ne),await ne.promise}Vh.set(y,Vh.get(y)+1);for(var N=arguments.length,Y=new Array(N>3?N-3:0),W=3;W<N;W++)Y[W-3]=arguments[W];const H=await b(...Y);return Vh.set(y,Vh.get(y)-1),Vh.get(y)===O-1&&R.length>0&&(R[0].resolve(),R.shift()),Vh.get(y)===0&&(Pk.set(y,[]),Nk.set(y,0),Vh.set(y,0)),H}("client.join",le("JOIN_MAX_CONCURRENCY"),this.join.bind(this),n,i,s,c,l)}async join(n,i,s,c,l){const h=++this._numberOfJoinCount;this.store.joinStart(),c&&(this.store.uid=c);const p=(Fk||Fk||(Fk=(window.location.protocol.split(":")[0]||"").toUpperCase(),Fk))==="HTTPS",v=L9()?window.isSecureContext:"Browser Not Support";(!L9()&&!p||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),x.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),kt.setAppId(n);try{if(!s&&s!==null)throw new Pe(ie.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&qs(s,"token",1,2047),qs(n,"appid",1,2047),aO(i),c&&cO(c),l&&qs(l,"optionalInfo",1,2047)}catch(W){throw kt.reportApiInvoke(n_(),{name:is.JOIN,options:[n,i,s,c],states:{isHttps:p,isSecureContext:v},tag:_i.TRACER}).onError(W),W}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const W=new Pe(ie.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw kt.reportApiInvoke(n_(),{name:is.JOIN,options:[n,i,s,c],states:{isHttps:p,isSecureContext:v},tag:_i.TRACER}).onError(W),W}this._gateway.state="CONNECTING";const y=await D7({appId:n,cname:i,uid:c,stringUid:typeof c=="string"?c:void 0,token:s||n,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Pe(ie.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const S=(y==null?void 0:y.sid)||n_();x.info("[".concat(this._clientId,"] start join channel ").concat(i,", join number: ").concat(h)),this._sessionId||(this._sessionId=S,this.store.sessionId=this._sessionId);const b=kt.reportApiInvoke(S,{id:this._clientId,name:is.JOIN,options:[n,i,s,c],states:{isHttps:p,isSecureContext:v},tag:_i.TRACER}),R=fd(fd(fd({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:n,sid:this._sessionId,cname:i,uid:typeof c!="string"?c:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||n,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:l,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:le("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof c=="string"&&(R.stringUid=c,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async W=>{const H=function(be){const we=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Se=new Uint8Array(new ArrayBuffer(we.length));for(let Le=0;Le<we.length;Le+=1)Se[Le]=we.charCodeAt(Le);return Se}(),ne=await window.crypto.subtle.importKey("spki",H,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),re=aM(W),me=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},ne,re);return function(be){let we="";for(let Se=0;Se<be.length;Se+=1)we+=String.fromCharCode(be[Se]);return window.btoa(we)}(new Uint8Array(me))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Pe(ie.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const W=new TextEncoder,H=le("USE_PURE_ENCRYPTION_MASTER_KEY")?W.encode(R.appId+this._encryptionSecret+this._encryptionSecret):W.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(ne,re,me){const be=await window.crypto.subtle.importKey("raw",re,"PBKDF2",!1,["deriveBits","deriveKey"]),we=ne==="aes-128-gcm2"?128:256,Se=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:G9,hash:"SHA-256",salt:me},be,we+qye);return new Uint8Array(Se).subarray(we/8)}(this._encryptionMode,H,t_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(ne,re,me){const be=await window.crypto.subtle.importKey("raw",re,"PBKDF2",!1,["deriveBits","deriveKey"]),we=ne==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:G9,hash:"SHA-256",salt:me},be,{name:"AES-GCM",length:we},!0,["encrypt","decrypt"])}(this._encryptionMode,H,t_(this._encryptionSalt))}else v?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:i,appId:n,stringUid:R.stringUid});const O=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&O===this._sessionId&&kt.joinChannelTimeout(this._sessionId,5)},5e3);try{var N;let W;const H=R.cloudProxyServer;if(dt(N=["proxy3","proxy4","proxy5"]).call(N,H)){const we=le("PROXY_SERVER_TYPE3");Array.isArray(we)?R.proxyServer=we[0]:R.proxyServer=we}if(kt.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),y){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(y.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=y.intUid),W={gatewayInfo:y.ap.gatewayInfo},le("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const we=(await C3(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(Se=>({turnServerURL:Se.address,tcpport:Se.tcpport||fo.tcpport,udpport:Se.udpport||fo.udpport,username:Se.username||fo.username,password:Se.password||fo.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:we}}M7(y,R.stringUid)}else{if(R.stringUid&&!R.uid){let we;[we,W]=await pt.all([Z3(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||ss,this.store),Q3(R,this._axiosCancelSource.token,this._config.httpRetryConfig||ss,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(we)),R.uid=we,W.gatewayInfo.uid=we,W.gatewayInfo.res.uid=we}else W=await Q3(R,this._axiosCancelSource.token,this._config.httpRetryConfig||ss,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Pe(ie.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(Kb.UPDATE_BITRATE_LIMIT,we=>{this._p2pChannel.updateBitrateLimit(we)}),this._configDistribute.on(Kb.UPDATE_CLIENT_ROLE_OPTIONS,we=>{this._setClientRoleOptions(we)})},0),this._key=s||n;const ne=W.gatewayInfo,re=R.uid?R.uid:ne.uid;this._joinInfo=fd(fd({},R),{},{cid:ne.cid,uid:re,vid:ne.vid,apResponse:ne.res,apGatewayAddress:ne.apGatewayAddress,uni_lbs_ip:ne.uni_lbs_ip,gatewayAddrs:ne.gatewayAddrs}),this.store.intUid=re,this.store.cid=ne.cid;const me=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Pe(ie.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));b.onSuccess(me),this._appId=n,this._channelName=R.cname,this._uid=me,this.store.uid=me,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(uo()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const be=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(i,",").concat(be)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),Y=this,dt(u_).call(u_,Y)||u_.push(Y),this._cloudProxyServerMode==="disabled"&&Xn().supportWebCrypto&&le("ENABLE_PRELOAD")&&AU(this._joinInfo),me}catch(W){const H=Array.isArray(W)?W[0]:W;throw H&&H.code===ie.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(h,", Joining channel failed, rollback"),H):x.error("[".concat(this._clientId,"] join number: ").concat(h,", Joining channel failed, rollback"),H),H.code!==ie.OPERATION_ABORTED&&this._numberOfJoinCount===h&&(this._gateway.state="DISCONNECTED",this._reset()),b.onError(H),H}var Y}_joinGateway(){if(!this._joinInfo||!this._key)throw new Pe(ie.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!le("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(uo()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(i){const s=u_.indexOf(i);s!==-1&&u_.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const n=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void n();await this._gateway.leave(this.connectionState!=="CONNECTED",cr.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),n()}async publish(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(n)){if(!(n instanceof rS))return this._publishDataChannel(n);n=[n]}if(n.length===0)throw new Pe(ie.INVALID_PARAMS,"param list is empty");const s=n;if(this._gateway.role==="audience")throw new Pe(ie.INVALID_OPERATION,"audience can not publish stream");for(const l of s){if(!(l instanceof rS))throw new Pe(ie.INVALID_PARAMS,"parameter is not local track");if(!l._enabled&&i)throw new Pe(ie.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(l.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(l=>"".concat(l.getTrackId()," "))));const c=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),i&&s.forEach(l=>{const h=this._configDistribute.getBitrateLimit();l instanceof qr&&h&&l.setBitrateLimit(h.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(l=>"".concat(l.getTrackId()," "))))}catch(l){throw x.error("[".concat(this._clientId,"] publish error"),l.toString()),l}finally{c()}}async _publishDataChannel(n){Tr(n.id,"id",0,65535,!0),lp(n.ordered,"ordered"),qs(n.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(n.id));const i=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(l=>l.id===n.id)!==-1)throw new Pe(ie.INVALID_PARAMS,"Invalid id: ".concat(n.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Pe(ie.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&le("FORCE_TURN")&&!le("TURN_ENABLE_TCP")&&!le("TURN_ENABLE_UDP"))throw new Pe(ie.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(l){return z3(l,!1)}(n),c=await this._p2pChannel.publishDataChannel([s]);if(c.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Pe(ie.CREATE_DATACHANNEL_ERROR);try{await pt.all(c.map(l=>this._uid&&this._gateway.publishDataChannel(this._uid,l,!0))),await s._waitTillOpen()}catch(l){if(l.code!==ie.DISCONNECT_P2P)throw l}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{i()}}async unpublish(n){if(!this._joinInfo||this._uid===void 0)throw new Pe(ie.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let i=[];if(n)if(Array.isArray(n))i=n;else{if(!(n instanceof rS))return this._unpublishDataChannel([n]);i=[n]}else this.store.useP2P||await this._unpublishDataChannel(),i=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(i.map(c=>"".concat(c.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const c=await this._p2pChannel.unpublish(i);c&&await this._gateway.sendExtensionMessage(Ui.UNPUBLISH,{unpubMsg:c},!0)}else{const c=await this._p2pChannel.unpublish(i);c&&await this._gateway.unpublish(c,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(i.map(l=>"".concat(l.getTrackId()))))}}catch(c){throw x.error("[".concat(this._clientId,"] unpublish error"),c.toString()),c}finally{s&&s()}}async _unpublishDataChannel(n){n!==void 0&&n.length!==0||(n=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(n.map(s=>"".concat(s.id," "))," "));const i=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(n);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(n.map(c=>"".concat(c.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{i&&i()}}async subscribe(n,i,s){if(!(n instanceof Xm)){const c=this.remoteUsers.find(l=>l.uid===n);if(!c)throw new Pe(ie.INVALID_REMOTE_USER,"user is not in the channel");n=c}return i==="datachannel"?this._subscribeDataChannel(n,s):this._subscribe(n,i)}async presubscribe(n,i){if(vs(i,"mediaType",["audio","video"]),this.store.useP2P)throw new Pe(ie.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=i===bt.AUDIO,c=i===bt.VIDEO,l=await this._subscribeMutex.lock();try{const{ssrcId:h,ortc:p,rtxSsrcId:v,cname:y,uint_id:S}=await this._gateway.presubscribe(n,i,!0);if(h==null)throw new Pe(ie.UNEXPECTED_RESPONSE,"no ssrc id");let b=this._users.find(O=>O.uid===n);b||(b=new Xm(n,S||n),b._is_pre_created=!0,this._users.push(b)),y&&(b._cname=y),b._uintid||(b._uintid=S||n),s&&(b._audioSSRC=h,b._audio_pre_subscribed=!0,p&&(b._audioOrtc=p)),c&&(b._videoSSRC=h,b._video_pre_subscribed=!0,p&&(b._videoOrtc=p),v!=null&&(b._rtxSsrcId=v)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(h)),await this._p2pChannel.subscribe(b,i,h,v,p);const R=s?b._audioTrack:b._videoTrack;if(!R)throw new Pe(ie.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(b._trust_audio_stream_added_state_=!0,b._audio_added_=!0),c&&(b._trust_video_stream_added_state_=!0,b._video_added_=!0),R}catch(h){throw x.error("[".concat(this._clientId,"] presub user ").concat(n," error"),h),h}finally{l()}}async _subscribeDataChannel(n,i){var s;if(Tr(i,"channelId",0,65535,!0),!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===n))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),new Pe(ie.INVALID_REMOTE_USER,"user is not in the channel");if(!n.hasAudio&&!n.hasVideo&&n._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),new Pe(ie.INVALID_REMOTE_USER,"user is not published");const l=(s=n._dataChannels)===null||s===void 0?void 0:s.find(v=>v.id===i);if(!l)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, remote datachannel is not published")),new Pe(ie.REMOTE_USER_IS_NOT_PUBLISHED);const h=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(n.uid,", mediaType: datachannel"));try{const v=await this._p2pChannel.subscribeDataChannel(n,[l]);if(v&&dt(v).call(v,l.id))try{var p;if(typeof l._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Pe(ie.CREATE_DATACHANNEL_ERROR);const y={id:l.id,datachannelId:l._originDataChannelId,ordered:l.ordered,maxRetransmits:l.maxRetransmits,metadata:(p=l.metadata)!==null&&p!==void 0?p:""};await this._gateway.subscribeDataChannel(n.uid,y,!0),await l._waitTillOpen()}catch(y){if((y==null?void 0:y.code)!==ie.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(n,[l]),y;await this._p2pChannel.unsubscribeDataChannel(n,[l]),this._p2pChannel.setPendingRemoteDataChannel(n,l.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(n.uid,", mediaType: datachannel")),l}finally{h()}}async _p2pSubscribe(n,i,s){if(vs(i,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===n)){const h=new Pe(ie.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),h}if(!n.hasAudio&&!n.hasVideo){const h=new Pe(ie.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),h}if(!s&&(i==="audio"&&!n.hasAudio||i==="video"&&!n.hasVideo)){const h=new Pe(ie.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(i,", remote track is not published")),h}const l=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(i));try{if(await this._p2pChannel.hasRemoteMediaWithLock(n,i))await this._p2pChannel.unmuteRemote(n,i);else try{const p=i==="audio"?n._audioSSRC:n._videoSSRC,v=i==="audio"?n._audioMid:n._videoMid;this.store.subscribe(n.uid,i,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(n,i,p,v)}catch(p){throw p}x.info("[".concat(this._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(i)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(n.uid,this._defaultStreamFallbackType).catch(p=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const h=i==="audio"?n._audioTrack:n._videoTrack;if(!h)throw new Pe(ie.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(n.uid," error"),h),h}finally{l()}}async _subscribe(n,i,s){if(this.store.useP2P)return this._p2pSubscribe(n,i);if(vs(i,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(S=>S===n)){const S=new Pe(ie.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),S}if(!n.hasAudio&&!n.hasVideo){const S=new Pe(ie.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),S}if(!(s||(i!=="audio"||n.hasAudio&&n._audioSSRC!==void 0)&&(i!=="video"||n.hasVideo&&n._videoSSRC!==void 0))){const S=new Pe(ie.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(i,", remote track is not published")),S}let l=i==="audio"?n._audioSSRC:n._videoSSRC,h=i==="audio"?n._audioOrtc:n._videoOrtc,p=i==="video"?n._rtxSsrcId:void 0,v={stream_type:i==="audio"?bt.AUDIO:bt.VIDEO,ssrcId:l};const y=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(i));try{if(await this._p2pChannel.hasRemoteMediaWithLock(n,i))await this._p2pChannel.unmuteRemote(n,i);else try{const b=i==="audio"?n._audioSSRC:n._videoSSRC;b!==void 0&&b!==l&&(l=b,h=i==="audio"?n._audioOrtc:n._videoOrtc,p=i==="video"?n._rtxSsrcId:void 0,v={stream_type:i==="audio"?bt.AUDIO:bt.VIDEO,ssrcId:l}),Ao.markSubscribeStart(this.store.clientId,l),this.store.subscribe(n.uid,i,Date.now()),await this._p2pChannel.subscribe(n,i,l,p,h);try{this._p2pChannel.isPreSubScribe(l)||await this._gateway.subscribe(n.uid,v,!0)}catch(R){if((R==null?void 0:R.code)!==ie.WS_ABORT)throw await this._p2pChannel.unsubscribe(n,i),R;await this._p2pChannel.unsubscribe(n,i,!0),this._p2pChannel.setPendingRemoteMedia(n,i)}this.store.subscribe(n.uid,i,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,n,i)}catch(b){throw this._p2pChannel.reportSubscribeEvent(!1,b==null?void 0:b.code,n,i),b}x.info("[".concat(this._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(i)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(n.uid,this._defaultStreamFallbackType).catch(b=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),b)});const S=i==="audio"?n._audioTrack:n._videoTrack;if(!S)throw new Pe(ie.UNEXPECTED_ERROR,"can not find remote track in user object");return S}catch(S){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(n.uid," error"),S),S}finally{y()}}async massSubscribe(n){if(dp(n,"subscribeList"),!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const i=Date.now(),s=new Map,c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(n.map(v=>{let{user:y,mediaType:S}=v;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(S)}).join("; ")));const l=(n=[...n]).map(v=>{let{user:y,mediaType:S}=v;return{user:y,mediaType:S}}),h=await this._p2pChannel.globalLock();try{var p;for(let y=n.length-1;y>=0;y--){const S=n[y],{user:b,mediaType:R}=S;if(vs(R,"mediaType",["audio","video"]),!b){const W=new Pe(ie.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),W}if(!this._users.find(W=>W===b)){const W=new Pe(ie.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(b.uid,", this user is not in the channel")),l[y].error=W,n.splice(y,1);continue}if(R==="audio"&&(!b.hasAudio||b._audioSSRC===void 0)||R==="video"&&(!b.hasVideo||b._videoSSRC===void 0)){const W=new Pe(ie.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(b.uid," with mediaType ").concat(R,", remote user is not published")),l[y].error=W,n.splice(y,1);continue}const N=Rs.Video|Rs.LwoVideo,Y=s.get(b);if(Y){if(R==="video"?Y&N:Y&Rs.Audio){n.splice(y,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(b.uid,", mediaType:").concat(R," twice"));continue}s.set(b,Y|(R==="video"?N:Rs.Audio))}else s.set(b,R==="video"?N:Rs.Audio)}for(let y=n.length-1;y>=0;y--){const S=n[y],{user:b,mediaType:R}=S,O=Rs.Video|Rs.LwoVideo;if(this._p2pChannel.hasRemoteMedia(b,R)){await this._p2pChannel.unmuteRemoteNoLock(b,R);const N=s.get(b);s.set(b,R==="video"?N^O:N^Rs.Audio),n.splice(y,1)}}this.store.massSubscribe(n.map(y=>({userId:y.user.uid,type:y.mediaType})),i);let v=nu(p=Array.from(s.entries())).call(p,(y,S)=>{let[b,R]=S;if(R===0)return y;const O={stream_id:b.uid,stream_type:R};return R&Rs.Audio&&(O.audio_ssrc=b._audioSSRC),R&Rs.Video&&(O.video_ssrc=b._videoSSRC),y.push(O),y},[]);try{n.length>0&&await this._p2pChannel.massSubscribeNoLock(n.map(S=>{let{user:b,mediaType:R}=S;return{user:b,mediaType:R,ssrcId:R===bt.VIDEO?b._videoSSRC:b._audioSSRC,rtxSsrcId:R===bt.VIDEO?b._rtxSsrcId:void 0}}));const y=new Map;if(v=v.filter(S=>S.video_ssrc&&!this._p2pChannel.isPreSubScribe(S.video_ssrc)||S.audio_ssrc&&!this._p2pChannel.isPreSubScribe(S.audio_ssrc)||!S.video_ssrc&&!S.audio_ssrc),v.length>0){const S=await this._gateway.subscribeAll(v,!0);((S==null?void 0:S.users)||[]).forEach(b=>{let{stream_id:R,video_error_code:O,audio_error_code:N,error_code:Y}=b;(O||N||Y)&&y.set(R,{video_error_code:O,audio_error_code:N,error_code:Y})})}if(Array.from(y.entries()).length>0){const S=[];Array.from(y.entries()).forEach(b=>{let[R,O]=b;const N=this.remoteUsers.find(Y=>Y.uid===R);if(N){let Y;O.error_code||O.video_error_code&&O.audio_error_code?Y=void 0:O.video_error_code?Y=bt.VIDEO:O.audio_error_code&&(Y=bt.AUDIO),S.push({user:N,mediaType:Y})}}),S.length>0&&await this._p2pChannel.massUnsubscribeNoLock(S)}for(const S of l){const b=y.get(S.user.uid);if(b){const R=b.error_code||S.mediaType==="audio"&&b.audio_error_code||S.mediaType==="video"&&b.video_error_code;if(R){const O=qb(R);x.error("user:".concat(S.user.uid," mediaType:").concat(S.mediaType," has massSubscribe error ").concat(O.desc)),S.error=new Pe(ie.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(O.desc))}}S.error||(S.mediaType==="video"?S.track=S.user.videoTrack:S.track=S.user.audioTrack)}return this.store.massSubscribe(l.filter(S=>!S.error).map(S=>({userId:S.user.uid,type:S.mediaType})),void 0,Date.now()),l.forEach(S=>{var b;kt.subscribe(this.store.sessionId,{succ:!!S.error,ec:((b=S.error)===null||b===void 0?void 0:b.code)||null,video:S.mediaType===bt.VIDEO,audio:S.mediaType===bt.AUDIO,peerid:S.user.uid,subscribeRequestid:S.mediaType===bt.VIDEO?S.user._videoSSRC:S.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-i),preSsrc:this._p2pChannel.isPreSubScribe(S.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(n.map(S=>{let{user:b,mediaType:R}=S;return"user: ".concat(b==null?void 0:b.uid,", mediaType: ").concat(R)}).join("; "))),l}catch(y){throw await this._p2pChannel.massUnsubscribeNoLock(n),y}}finally{h(),c()}}async unsubscribe(n,i,s){if(!(n instanceof Xm)){const h=this.remoteUsers.find(p=>p.uid===n);if(!h)throw new Pe(ie.INVALID_REMOTE_USER,"user is not in the channel");n=h}if(i||this.store.useP2P){if(i==="datachannel")return this._unsubscribeDataChannel(n,s)}else await this._unsubscribeDataChannel(n,s);if(i&&vs(i,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(h=>h===n)){const h=new Pe(ie.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),h}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: ").concat(i));const l=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(n,i);else{const h=await this._p2pChannel.unsubscribe(n,i);h&&await this._gateway.unsubscribe(h,n.uid),i&&i!=="audio"||(n._audio_pre_subscribed=!1),i&&i!=="video"||(n._video_pre_subscribed=!1),n._is_pre_created&&Mk(this._users,n),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(n.uid,", mediaType: ").concat(i))}}catch(h){if(h.code===ie.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(n.uid," error"),h.toString()),h}finally{l()}}async _unsubscribeDataChannel(n,i){if(i&&Tr(i,"id",0,65535,!0),!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(l=>l===n)){const l=new Pe(ie.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),l}let c;if(typeof i=="number"){const l=n._dataChannels.find(h=>h.id===i);l&&(c=[l])}else c=n._dataChannels;if(c===void 0){const l=new Pe(ie.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid," with channelId ").concat(i,", remote datachannel is not published")),l}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(c.map(l=>l.id)));try{const l=await this._p2pChannel.unsubscribeDataChannel(n,c);l&&await this._gateway.unsubscribeDataChannel(l,n.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(l))}catch(l){if(l.code===ie.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(n.uid," error"),l.toString()),l}}async massUnsubscribe(n){if(dp(n,"unsubscribeList"),!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(n.map(s=>{let{user:c,mediaType:l}=s;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(l,";")}).join())),n=[...n];const i=new Map;for(let s=n.length-1;s>=0;s--){const{user:c,mediaType:l}=n[s];if(!c){const v=new Pe(ie.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),v}if(vs(l,"mediaType",["video","audio",void 0]),!this._users.find(v=>v===c)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(c.uid,", user is not in the channel")),n.splice(s,1);continue}const p=Rs.Video|Rs.LwoVideo;if(i.has(c)){const v=i.get(c);let y;switch(l){case"video":y=v&p;break;case"audio":y=v&Rs.Audio;break;default:y=v&(Rs.Audio|p)}if(y){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(c.uid,",mediaType:").concat(l," twice.")),n.splice(s,1);continue}l?l==="audio"?i.set(c,v|Rs.Audio):l==="video"&&i.set(c,v|p):i.set(c,v|Rs.Audio|p)}else l?l==="audio"?i.set(c,Rs.Audio):l==="video"&&i.set(c,p):i.set(c,Rs.Audio|p)}try{const s=await this._p2pChannel.massUnsubscribe(n);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(n.map(c=>{let{user:l,mediaType:h}=c;return"user: ".concat(l==null?void 0:l.uid,", mediaType: ").concat(h,";")}).join()))}catch(s){if(s.code===ie.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(n){(function(s){if(!s)throw new Fe(ie.INVALID_PARAMS);vi(s.width)||sM(s.width,"streamParameter.width"),vi(s.height)||sM(s.height,"streamParameter.height"),vi(s.framerate)||sM(s.framerate,"streamParameter.framerate"),vi(s.bitrate)||Tr(s.bitrate,"streamParameter.bitrate")})(n),(!n.width&&n.height||n.width&&!n.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(n));const i=this._configDistribute.getLowStreamConfigDistribute();if(i&&i.bitrate&&n.bitrate&&i.bitrate<n.bitrate&&(n.bitrate=i.bitrate),this._lowStreamParameter=n,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(n,Qe.LocalVideoLowTrack)}async enableDualStream(){if(!Xn().supportDualStream)throw kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Pe(ie.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Pe(ie.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(n){throw kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),n}this._isDualStreamEnabled=!0,kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Qe.LocalVideoLowTrack))try{const n=await this._p2pChannel.unpublishLowStream();n&&await this._gateway.unpublish(n,this._joinInfo.stringUid||this._joinInfo.uid)}catch(n){throw kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),n}this._isDualStreamEnabled=!1,kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(n,i){if(function(c){vs(c,"role",["audience","host"])}(n),i&&uM(i),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Pe(ie.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(i&&i.level&&n==="host")throw new Pe(ie.INVALID_OPERATION,"host mode can not set audience latency level");if(n==="audience"&&this._p2pChannel.hasLocalMedia())throw new Pe(ie.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=n),n!==s&&le("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(n,i),this._config.role=n,this._gateway.reconnect("recover",lo.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(n,i),this._config.role=n),x.info("[".concat(this._clientId,"] set client role to ").concat(n,", level: ").concat(i&&i.level))}async _setClientRoleOptions(n){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let i=!1;try{n&&uM(n),await this._gateway.setClientRole(this._config.role,n),i=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(i?"succeed":"failed",", options is ").concat(n))}}getRemoteInboundOffset(){var n;const i=(n=this._p2pChannel.getStats())===null||n===void 0?void 0:n.audioSend[0];if(!i||!i.timestamp)return 0;const s=i.timestamp-Date.now();return Math.abs(s)>1e3+i.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(n,i){if(qs(n,"proxyServer"),!i){if(this.connectionState!=="DISCONNECTED")throw new Pe(ie.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Pe(ie.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=n,kt.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(i?"by initialize call":""," success."))}setTurnServer(n,i){if(Array.isArray(n)||(n=[n]),!i){if(this.connectionState!=="DISCONNECTED")throw new Pe(ie.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Pe(ie.INVALID_OPERATION,"You have already set the proxy")}if(Ub(n))return this._turnServer={servers:n,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(i?"by initialize call":""," success: ").concat(n.map(s=>s.urls).join(","),"."));n.forEach(s=>T9(s)),this._turnServer={servers:n,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(i?"by initialize call":""," success."))}setLicense(n){if(this.connectionState!=="DISCONNECTED")throw new Pe(ie.INVALID_OPERATION,"you should set license before join channel");if(qs(n,"license",32,32),!/^[A-Za-z\d]+$/.test(n))throw new Pe(ie.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=n,x.info("[".concat(this._clientId,"] set license success"),n)}startProxyServer(n){if(this.connectionState!=="DISCONNECTED")throw new Pe(ie.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Pe(ie.INVALID_OPERATION,"You have already set the proxy");const i=[3,4,5];let s;switch(n===void 0&&(n=3),n){case 1:case 2:throw new Pe(ie.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Pe(ie.INVALID_PARAMS,"proxy server mode must be ".concat(i.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Pe(ie.INVALID_OPERATION,"Stop proxy server after leave channel");kt.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(n){if(!n.accessPoints)throw new Pe(ie.INVALID_PARAMS,"accessPoints is required.");dp(n.accessPoints.serverList,"accessPoints.serverList"),qs(n.accessPoints.domain,"accessPoints.domain");const i=(O,N)=>{Tr(O,N,0,65535,!0)};let s=443;if(n.accessPoints.port&&(i(n.accessPoints.port,"accessPoints.port"),s=n.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Pe(ie.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");le("CLOSE_AFB_FOR_LOCAL_AP")&&(_r("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),_r("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const c=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,l=n.accessPoints.domain,h=n.accessPoints.serverList.map(O=>c.test(O)?"".concat(O.replace(/\./g,"-"),".").concat(l):O),p=h.map(O=>"".concat(O,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,_r("WEBCS_DOMAIN",p),_r("WEBCS_DOMAIN_BACKUP_LIST",p),_r("GATEWAY_DOMAINS",[l]),n.report&&n.report.hostname&&Array.isArray(n.report.hostname)&&n.report.hostname.length?(dp(n.report.hostname,"report.hostname"),_r("EVENT_REPORT_DOMAIN",n.report.hostname[0]),_r("EVENT_REPORT_BACKUP_DOMAIN",n.report.hostname[1]||n.report.hostname[0])):(_r("EVENT_REPORT_DOMAIN",h[0]),_r("EVENT_REPORT_BACKUP_DOMAIN",h[1]||h[0]));let v=6443;n.report&&n.report.port&&(i(n.report.port,"report.port"),v=n.report.port),_r("STATS_COLLECTOR_PORT",v),n.report?_r("ENABLE_EVENT_REPORT",!0):_r("ENABLE_EVENT_REPORT",!1);let y="";n.log&&n.log.hostname&&Array.isArray(n.log.hostname)&&n.log.hostname.length?(dp(n.log.hostname,"log.hostname"),y=n.log.hostname[0]):y=h[0];let S=6444;n.log&&n.log.port&&(i(n.log.port,"log.port"),S=n.log.port),_r("LOG_UPLOAD_SERVER","".concat(y,":").concat(S));let b=[];n.cds&&n.cds.hostname&&Array.isArray(n.cds.hostname)&&n.cds.hostname.length?(dp(n.cds.hostname,"cds.hostname"),b=n.cds.hostname):b=h;let R=443;n.cds&&n.cds.port&&(i(n.cds.port,"cds.port"),R=n.cds.port),_r("CDS_AP",b.map(O=>"".concat(O,":").concat(R))),n.cds?_r("ENABLE_CONFIG_DISTRIBUTE",!0):_r("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(n,i){if(dp(n,"serverList"),qs(i,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Pe(ie.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=n.map(c=>s.test(c)?"".concat(c.replace(/\./g,"-"),".").concat(i):c),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,_r("WEBCS_DOMAIN",n),_r("WEBCS_DOMAIN_BACKUP_LIST",n),_r("GATEWAY_DOMAINS",[i]),_r("EVENT_REPORT_DOMAIN",n[0]),_r("EVENT_REPORT_BACKUP_DOMAIN",n[1]||n[0]),_r("LOG_UPLOAD_SERVER","".concat(n[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(n){if(vs(n,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=n,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(n),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(i){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),i.toString()),i}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(n))}async setRemoteVideoStreamType(n,i){vs(i,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(n,i),setTimeout(()=>{const s=this._users.find(c=>c.uid===n);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(n," video stream type to ").concat(i)),this._remoteStreamTypeCacheMap.set(n,i)}async setStreamFallbackOption(n,i){vs(i,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(n,i)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(n," stream fallback type to ").concat(i)),this._streamFallbackTypeCacheMap.set(n,i)}setEncryptionConfig(n,i,s,c){(function(h){vs(h,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(n),qs(i,"secret");const l=["aes-128-gcm2","aes-256-gcm2"];if(dt(l).call(l,n)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Pe(ie.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Pe(ie.INVALID_PARAMS,"current encrypt mode does not need salt");if(c){if(lp(c,"encryptDataStream"),!dt(l).call(l,n))throw new Pe(ie.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(i)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=n,this._encryptionSecret=i,s&&(this._encryptionSalt=Wm(s))}async renewToken(n){if(qs(n,"token",1,2047),!this._key||!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"renewToken should not be called before user join");const i=this._key;this._key=n,this._joinInfo&&(this._joinInfo.token=n);const s=await this._renewTokenMutex.lock();try{if(le("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const c=await RSe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ss);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:n,ticket:c})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:n});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(c){throw this._key=i,this._joinInfo.token=i,x.error("[".concat(this._clientId,"] renewToken failed"),c.toString()),c}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const n=this._p2pChannel.getAudioLevels();this.safeEmit(kn.VOLUME_INDICATOR,n)},le("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const n=this._statsCollector.getRTCStats(),i=this._gateway.getInChannelInfo();return n.Duration=Math.round(i.duration/1e3),n}async startLiveStreaming(n,i){if(!i){if(this.codec!=="h264")throw new Pe(ie.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Pe(ie.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(n)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(n))throw new Pe(ie.LIVE_STREAMING_TASK_CONFLICT);const s=i?pp.TRANSCODE:pp.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(n,s)}setLiveTranscoding(n){return this._createLiveStreamingClient(pp.TRANSCODE).setTranscodingConfig(n)}async stopLiveStreaming(n){const i=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(n));if(!i.length)throw new Pe(ie.INVALID_PARAMS,"can not find live streaming url to stop");await pt.all(i.map(s=>s&&s.stopLiveStreamingTask(n)))}async startChannelMediaRelay(n){o7(n),await this._createChannelMediaRelayClient().startChannelMediaRelay(n)}async updateChannelMediaRelay(n){o7(n),await this._createChannelMediaRelayClient().updateChannelMediaRelay(n)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(n){this._p2pChannel instanceof rw&&this._p2pChannel.addAudioMetadata(n)}async sendStreamMessage(n){var i;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"can not send data stream, not joined");if((typeof n=="string"||n instanceof Uint8Array)&&(n={payload:n}),typeof n.payload=="string"){const l=new TextEncoder;n.payload=l.encode(n.payload)}let c=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&dt(i=["aes-128-gcm2","aes-256-gcm2"]).call(i,this._encryptionMode)&&(c=!0,n.payload=await async function(l,h,p){var v;const y=nu(v=Array.from(p)).call(v,(W,H)=>W+H,0),S={serverTs:0,seq:$ye++,length:p.length,checkSum:y},b=new Uint8Array(O9(y,2)),R=new ArrayBuffer(XE),O=new DataView(R);O.setUint32(0,S.serverTs),O.setUint16(4,S.seq),O.setUint16(6,S.length),O.setUint16(8,S.checkSum);const N=16-p.length%16;p=C9(p,new Uint8Array(N));const Y=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l,tagLength:z9,additionalData:b},h,p);return C9(new Uint8Array(R),new Uint8Array(Y))}(this._encryptDataStreamIv,this._encryptDataStreamKey,n.payload)),new Blob([n.payload]).size>1024)throw new Pe(ie.INVALID_PARAMS,c?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Jt.DATA_STREAM,{payload:Wm(n.payload),syncWithAudio:n.syncWithAudio,sendTs:Date.now()-xSe},!s)}sendMetadata(n){if(!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([n]).size>1024)throw new Pe(ie.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Jt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Wm(n)})}async sendCustomReportMessage(n){if(Array.isArray(n)||(n=[n]),n.forEach(rEe),!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"can not send custom report, not joined");await kt.sendCustomReportMessage(this._joinInfo.sid,n)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(n,i){vs(i.spatialLayer,"spatialLayer",[0,1,2,3]),vs(i.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(n,i)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(n){const{apRTM:i=!1,rtmFlag:s}=n;if(lp(i,"apRTM"),Tr(s,"rtmFlag",0),this._rtmConfig.apRTM=i,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(n)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=i,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(n){const i=uS.indexOf(n);i!==-1&&uS.splice(i,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=tc.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&x7(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&kt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(n=>{n._audioTrack&&n._audioTrack._destroy(),n._videoTrack&&n._videoTrack._destroy(),n._dataChannels&&(n._dataChannels.forEach(i=>i._close()),n._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Co("client-publish",this._clientId),this._subscribeMutex=new Co("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(n,i){var s;const c=n||n_();n?x.debug("[".concat(this._clientId,"] new Session ").concat(c)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(c));const l=n?"":this._sessionId||"";this._sessionId=c,this.store.sessionId=c,kt.addSid(c);const h={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(i==null?void 0:i.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:l,clientRole:this.role==="audience"?2:1};kt.sessionInit(this._sessionId,fd({cname:i.channel,appid:i.appId},h)),this._joinInfo&&(this._joinInfo.sid=c),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=c)}async _publishHighStream(n){if(!this._joinInfo||this._uid===void 0)throw new Pe(ie.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&le("FORCE_TURN")&&!le("TURN_ENABLE_TCP")&&!le("TURN_ENABLE_UDP"))throw new Pe(ie.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(n,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const c=(await s.next()).value;if(c){try{await this._gateway.sendExtensionMessage(Ui.PUBLISH,c,!0)}catch(l){throw s.throw(l),l}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const c=(await s.next()).value;if(c){var i;let l;try{l=await this._gateway.publish(this._uid,c,!0)}catch(h){if(h.code!==ie.DISCONNECT_P2P)throw s.throw(h),h}await s.next(((i=l)===null||i===void 0?void 0:i.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const l of n)l instanceof qr&&l._encoderConfig&&this._gateway.setVideoProfile(l._encoderConfig).catch(h=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!l.muted&&l.enabled||await this._p2pChannel.muteLocalTrack(l)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,n),(s==null?void 0:s.code)===ie.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Pe(ie.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(ie.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const n=this._configDistribute.getLowStreamConfigDistribute();n&&n.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&n.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=n.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),c=(await s.next()).value;if(c){var i;let l;try{l=await this._gateway.publish(this._uid,c,!0)}catch(h){if(h.code!==ie.DISCONNECT_P2P)throw s.throw(h),h}s.next(((i=l)===null||i===void 0?void 0:i.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===ie.WS_ABORT)return;throw s}}_createLiveStreamingClient(n){const i=()=>{if(!this._joinInfo||!this._appId)return new Pe(ie.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(c={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},vp("LiveStreaming").create(c));var c;return s.onLiveStreamError=(l,h)=>{kt.reportApiInvoke(this._sessionId,{name:is.ON_LIVE_STREAM_ERROR,options:[l,h],tag:_i.TRACER}).onSuccess(),this.safeEmit(kn.LIVE_STREAMING_ERROR,l,h)},s.onLiveStreamWarning=(l,h)=>{kt.reportApiInvoke(this._sessionId,{name:is.ON_LIVE_STREAM_WARNING,options:[l,h],tag:_i.TRACER}).onSuccess(),this.safeEmit(kn.LIVE_STREAMING_WARNING,l,h)},s.on(ZM.REQUEST_WORKER_MANAGER_LIST,(l,h,p)=>{if(!this._joinInfo)return p(new Pe(ie.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(v,y,S,b){const R=le("UAP_AP").slice(0,le("AJAX_REQUEST_CONCURRENT")).map(O=>y.proxyServer?"https://".concat(y.proxyServer,"/ap/?url=").concat(O+"/api/v1?action=uap"):"https://".concat(O,"/api/v1?action=uap"));return await ESe(R,v,y,S,b)})(l,this._joinInfo,this._axiosCancelSource.token,ss).then(h).catch(p)}),s};return n===pp.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||i(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||i(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Pe(ie.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:i,sendResolutionHeight:s}=this.getLocalVideoStats(),c=(n={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:i,height:s}},vp("ChannelMediaRelay").create(n));c.on("state",l=>{l===Dc.RELAY_STATE_FAILURE&&c&&c.dispose(),this.safeEmit(kn.CHANNEL_MEDIA_RELAY_STATE,l)}),c.on("event",l=>{this.safeEmit(kn.CHANNEL_MEDIA_RELAY_EVENT,l)}),this._channelMediaRelayClient=c,this._statsCollector.onStatsChanged=(l,h)=>{var p;l==="resolution"&&((p=this._channelMediaRelayClient)===null||p===void 0||p.setVideoProfile(h))}}var n;return this._channelMediaRelayClient}_handleUpdateDataChannel(n,i){const{added:s,deleted:c}=n,l=[];if(i){const h=[];this._users.forEach(p=>{p._dataChannels.forEach(v=>{s.every(y=>y.uid!==p._uintid||y.stream_id!==v.id)&&h.push({uid:p._uintid,stream_id:v.id,ordered:v.ordered,max_retrans_times:v.maxRetransmits,metadata:v.metadata})})}),h.length>0&&this._handleUpdateDataChannel({added:[],deleted:h})}Array.isArray(s)&&s.length>0&&s.forEach(h=>{const{uid:p,stream_id:v,ordered:y,max_retrans_times:S,metadata:b}=h,R=this._users.find(O=>O._uintid===p);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(p)),dt(l).call(l,R)||l.push(R),R._uintid||(R._uintid=p),R._dataChannels.findIndex(O=>O.id===h.stream_id)===-1){const O={id:v,ordered:!!y,maxRetransmits:S,metadata:b},N=function(Y){return z3(Y,!0)}(O);R._dataChannels.push(N),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),i||this.safeEmit(kn.USER_PUBLISHED,R,"datachannel",O)}this._p2pChannel.hasPendingRemoteDataChannel(R,h.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,h.stream_id).catch(O=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),O.toString())}))}),i&&(this.safeEmit(kn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(c)&&c.length>0&&c.forEach(h=>{const{uid:p,stream_id:v}=h,y=this._users.find(b=>b._uintid===p);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const S=y._dataChannels.find(b=>b.id===h.stream_id);S&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(p)),this._p2pChannel.unsubscribeDataChannel(y,[S]).then(b=>{if(y._dataChannels=y._dataChannels.filter(R=>R!==S),b)return this._gateway.unsubscribeDataChannel(b,y.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(p," unpublished datachannel ,id:").concat(S.id)),this.safeEmit(kn.USER_UNPUBLISHED,y,"datachannel",S._config))})}_handleRemoveDataChannels(n){const i=this._users.find(s=>s.uid===n.uid);if(i){if(i._dataChannels!==void 0&&i._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(n.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished datachannel")),i._dataChannels.forEach(c=>{this.safeEmit(kn.USER_UNPUBLISHED,i,"datachannel",c._config)})};this._p2pChannel.unsubscribeDataChannel(i,i._dataChannels).then(c=>{if(c)return this._gateway.unsubscribeDataChannel(c,i.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Ms.UPDATE_GATEWAY_CONFIG,()=>{(function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void x.error("Error loading sdk config",i.message)}if(n)try{const i=JSON.parse(window.atob(n)),s=Date.now();Object.keys(i).forEach(c=>{const{value:l,type:h,expires:p}=i[c];p&&p<=s||h||KM()||!Object.prototype.hasOwnProperty.call(Wk,c)||(Qd[c]=l,Kr[c]=l,x.debug("Update gateway parameters from config distribute",c,l))})}catch(i){x.error("Error update config from local cache",i.message)}})()}),this._gateway.on(Ms.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Ms.CONNECTION_STATE_CHANGE,(n,i,s)=>{var c;if(s===cr.FALLBACK)return;const l=()=>{this.safeEmit(kn.CONNECTION_STATE_CHANGE,n,i,s)};if(kt.reportApiInvoke(this._sessionId||((c=this._gateway.joinInfo)===null||c===void 0?void 0:c.sid)||null,{name:is.CONNECTION_STATE_CHANGE,options:[n,i,s],tag:_i.TRACER}).onSuccess(JSON.stringify({cur:n,prev:i,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(i," -> ").concat(n)),n==="DISCONNECTED")return this._reset(),void l();if(n==="RECONNECTING")this._users.forEach(p=>{p._trust_in_room_=!1,p._trust_audio_enabled_state_=!1,p._trust_video_enabled_state_=!1,p._trust_audio_mute_state_=!1,p._trust_video_mute_state_=!1,p._trust_audio_stream_added_state_=!1,p._trust_video_stream_added_state_=!1,p._is_pre_created||(p._audio_pre_subscribed||(p._audioSSRC=void 0,p._audioOrtc=void 0),p._video_pre_subscribed||(p._videoSSRC=void 0,p._videoOrtc=void 0,p._rtxSsrcId=void 0),p._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(n==="CONNECTED"){var h;this._streamFallbackTypeCacheMap.forEach((p,v)=>{this._gateway.setStreamFallbackOption(v,p).catch(y=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),y)})}),this._remoteStreamTypeCacheMap.forEach((p,v)=>{this._gateway.setRemoteVideoStreamType(v,p).catch(y=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),y)})}),this._remoteDefaultVideoStreamType!==void 0&&((h=this._joinInfo)===null||h===void 0?void 0:h.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(p=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(p))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(p=>!p._trust_in_room_).forEach(p=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(p.uid)),this._handleUserOffline({uid:p.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(p=>{p._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(p.uid)),this._handleMuteStream(p.uid,bt.AUDIO,!1)),p._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(p.uid)),this._handleMuteStream(p.uid,bt.VIDEO,!1)),p._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(p.uid)),this._handleSetStreamLocalEnable("audio",p.uid,!0)),p._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(p.uid)),this._handleSetStreamLocalEnable("video",p.uid,!0)),p._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(p.uid)),this._handleResetAddStream(p,"video")),p._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(p.uid)),this._handleResetAddStream(p,"audio")),p._video_added_||p._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(p.uid)),this._handleRemoveStream({uid:p.uid,uint_id:p._uintid}))}))},1e3))}l()}),this._gateway.on(Ms.REQUEST_NEW_GATEWAY_LIST,async(n,i)=>{if(!this._joinInfo)return i(new Pe(ie.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const c=await D7(fd(fd({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));c?(s=c.ap,M7(c),this._joinInfo.preload=!0):(s=await mU(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ss,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const l=[];s.gatewayInfo.gatewayAddrs.forEach(h=>{let{address:p}=h;const[v,y]=p.split(":");this._joinInfo&&this._joinInfo.proxyServer?l.push({proxy:this._joinInfo.proxyServer,host:v,port:y}):l.push({host:v,port:y})}),n(l)}catch(s){i(s)}}),this._gateway.on(Ms.NETWORK_QUALITY,n=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(kn.NETWORK_QUALITY,n)}),this._gateway.on(Ms.STREAM_TYPE_CHANGE,(n,i)=>{this.safeEmit(kn.STREAM_TYPE_CHANGED,n,i),kt.reportApiInvoke(this._sessionId,{name:is.STREAM_TYPE_CHANGE,options:[n,i],tag:_i.TRACER}).onSuccess(JSON.stringify({uid:n,streamType:i}))}),this._gateway.on(Ms.IS_P2P_DISCONNECTED,n=>{this._p2pChannel.isP2PDisconnected()?n(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?n(!1):n(!0)}),this._gateway.on(Ms.REQUEST_P2P_CONNECTION_PARAMS,async(n,i,s)=>{try{let c=await this._p2pChannel.getEstablishParams();le("ENABLE_PREALLOC_PC")&&c||(c=await this._p2pChannel.startP2PConnection(n)),i(c)}catch(c){s(c)}}),this._gateway.on(Ms.JOIN_RESPONSE,(n,i)=>{if(this.store.useP2P)return;let s;n.attributes?s=n.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const c=P3(n.ortc,i,s);this._p2pChannel.connect(c)}),this._gateway.on(Ms.PRE_CONNECT_PC,async n=>{const{candidates:i,fingerprint:s}=n;if(this._joinInfo&&i.length>0&&!this._p2pChannel.isPlanB){var c;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:l,cid:h}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(l),icePwd:"".concat(h,"_").concat(l)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(c=le("FINGERPRINT"))!==null&&c!==void 0?c:s}]},candidates:i,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Pn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pn.ON_ADD_AUDIO_STREAM,n=>this._handleAddAudioOrVideoStream("audio",n.uid,n.ssrcId,n.cname,n.uint_id,n.ortc)),this._gateway.signal.on(Pn.ON_ADD_VIDEO_STREAM,n=>this._handleAddAudioOrVideoStream("video",n.uid,n.ssrcId,n.cname,n.uint_id,n.ortc,n.rtxSsrcId)),this._gateway.signal.on(Pn.ON_REMOTE_DATASTREAM_UPDATE,n=>{this._handleUpdateDataChannel(n)}),this._gateway.signal.on(Pn.ON_REMOTE_FULL_DATASTREAM_INFO,n=>{this._handleUpdateDataChannel({added:n.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Pn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pn.MUTE_AUDIO,n=>this._handleMuteStream(n.uid,bt.AUDIO,!0)),this._gateway.signal.on(Pn.UNMUTE_AUDIO,n=>this._handleMuteStream(n.uid,bt.AUDIO,!1)),this._gateway.signal.on(Pn.MUTE_VIDEO,n=>this._handleMuteStream(n.uid,bt.VIDEO,!0)),this._gateway.signal.on(Pn.UNMUTE_VIDEO,n=>this._handleMuteStream(n.uid,bt.VIDEO,!1)),this._gateway.signal.on(Pn.RECEIVE_METADATA,n=>{const i=t_(n.metadata);this.safeEmit(kn.RECEIVE_METADATA,n.uid,i)}),this._gateway.signal.on(Pn.ON_DATA_STREAM,async n=>{var i;if(!n)return;let s=t_(n.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&dt(i=["aes-128-gcm2","aes-256-gcm2"]).call(i,this._encryptionMode)){if(n.payload.length<XE)throw new Pe(ie.UNEXPECTED_RESPONSE,"payload length ".concat(n.payload.length," is less than header length ").concat(XE));s=await async function(h,p,v){const y=v.subarray(0,XE),S=y.slice(8,XE),b=(S[0]<<8)+S[1],R=(y[6]<<8)+y[7],O=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:h,tagLength:z9,additionalData:new Uint8Array(O9(b,2))},p,v.subarray(XE));return new Uint8Array(O).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let c=0;if(n.ordered||n.syncWithAudio){const l=this._p2pChannel.getStats(),h=this.remoteUsers.find(v=>v.uid===n.uid),p=l==null?void 0:l.audioRecv.find(v=>v.ssrc===(h==null?void 0:h._audioSSRC));c=p==null?void 0:p.jitterBufferMs}(c==null||Number.isNaN(c))&&(c=0),USe(fd(fd({},n),{},{payload:s}),c,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Pn.ON_CRYPT_ERROR,()=>{Bm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(kn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Pn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,cr.TOKEN_EXPIRE),this.safeEmit(kn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Pn.ON_STREAM_FALLBACK_UPDATE,n=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(n.stream_id,", attr: ").concat(n.stream_type)),this.safeEmit(kn.STREAM_FALLBACK,n.stream_id,n.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Pn.ON_PUBLISH_STREAM,n=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:n.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(n))))}),this._gateway.signal.on(Pn.ENABLE_LOCAL_VIDEO,n=>{this._handleSetStreamLocalEnable("video",n.uid,!0)}),this._gateway.signal.on(Pn.DISABLE_LOCAL_VIDEO,n=>{this._handleSetStreamLocalEnable("video",n.uid,!1)}),this._gateway.signal.on(en.REQUEST_TIMEOUT,(n,i)=>{if(this._joinInfo)switch(n){case Jt.PUBLISH:{if(!i)return;const l=i.ortc;if(l){var s,c;const h=l.some(y=>{let{stream_type:S}=y;return S===hr.Audio}),p=l.some(y=>{let{stream_type:S}=y;return S!==hr.Audio}),v=l.some(y=>{let{stream_type:S}=y;return S===hr.Screen||S===hr.ScreenLow});i.state==="offer"&&kt.publish(this._joinInfo.sid,{eventElapse:Ao.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:ie.TIMEOUT,audio:h,video:p,p2pid:i.p2p_id,publishRequestid:this.store.pubId,screenshare:v,audioName:h?(s=l.find(y=>{let{stream_type:S}=y;return S===hr.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:p?(c=l.find(y=>{let{stream_type:S}=y;return S!==hr.Audio}))===null||c===void 0||(c=c.ssrcs[0])===null||c===void 0?void 0:c.ssrcId.toString():void 0})}break}case Jt.SUBSCRIBE:i&&kt.subscribe(this._joinInfo.sid,{succ:!1,ec:ie.TIMEOUT,audio:i.stream_type===bt.AUDIO,video:i.stream_type===bt.VIDEO,peerid:i.stream_id,subscribeRequestid:i.ssrcId,p2pid:this.store.p2pId,eventElapse:Ao.measureFromSubscribeStart(this.store.clientId,i.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(i.ssrcId)})}}),this._gateway.signal.on(Pn.ON_P2P_OK,n=>{this.uid,this._uid}),this._gateway.signal.on(Pn.ON_PUBLISHED_USER_LIST,n=>{if(n==null||!n.users)return;le("BLOCK_LOCAL_CLIENT")&&(n.users=n.users.filter(c=>!l_(c.string_id||c.stream_id,this.channelName)));const i=[],s=[];for(const c of n.users){let l=this._users.find(b=>b._uintid===c.stream_id);l?l._trust_in_room_=!0:(l=new Xm(c.string_id||c.stream_id,c.stream_id),this._users.push(l),this.getListeners(kn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),c.stream_id),this.safeEmit(kn.USER_JOINED,l)));const h=Rs.Audio&c.stream_type,p=(Rs.Video|Rs.LwoVideo)&c.stream_type,v=(65280&c.stream_type)!=0,y=h&&l.hasAudio,S=p&&l.hasVideo;p&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0,l._videoSSRC=c.video_ssrc,l._rtxSsrcId=c.video_rtx),h&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0,l._audioSSRC=c.audio_ssrc),h&&!y&&this.getListeners(kn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published audio")),this.safeEmit(kn.USER_PUBLISHED,l,"audio")),p&&!S&&this.getListeners(kn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published video")),this.safeEmit(kn.USER_PUBLISHED,l,"video")),(h&&!y||p&&!S||v)&&i.push(l),p&&this._p2pChannel.hasPendingRemoteMedia(l,"video")&&s.push({user:l,mediaType:"video"}),h&&this._p2pChannel.hasPendingRemoteMedia(l,"audio")&&s.push({user:l,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(c=>"user: ".concat(c.user.uid,", mediaType: ").concat(c.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(c=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),c.toString())})),this.getListeners(kn.PUBLISHED_USER_LIST).length>0?le("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=i:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(i.map(c=>c.uid).join(", "))),this.safeEmit(kn.PUBLISHED_USER_LIST,i)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(i.map(c=>c.uid).join(", ")))}),this._gateway.signal.on(Pn.ON_RTP_CAPABILITY_CHANGE,n=>{const{video_codec:i}=n;this._p2pChannel instanceof rw&&this._p2pChannel.updateRemoteRTPCapabilities(i.map(s=>s.toLowerCase()).filter(s=>{var c;return dt(c=Object.keys(zk)).call(c,s)}))})}_handleP2PEvents(){this._gateway.signal.on(Pn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Ui.PUBLISH,(n,i,s)=>{const{uid:c}=n;n.forEach(l=>{const{kind:h,ssrcs:p,mid:v,isMuted:y}=l;this._handleP2PAddAudioOrVideoStream(h,c,p[0].ssrcId,v);const S=this._users.find(b=>b.uid===c);return S&&this.store.useP2P?this._p2pChannel.mockSubscribe(S,h,p[0].ssrcId,v).then(()=>{i()}).catch(s):i(),this._handleMuteStream(c,h,!!y)})}),this._gateway.signal.on(Ui.CALL,async(n,i,s)=>{if(this.store.useP2P)try{var c;i(await this._p2pChannel.startP2P({turnServer:(c=this._joinInfo)===null||c===void 0?void 0:c.turnServer},n))}catch(l){s(l)}}),this._gateway.signal.on(en.P2P_CONNECTION,async n=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(n)}),this._gateway.signal.on(Ui.UNPUBLISH,async(n,i,s)=>{if(this.store.useP2P){const{unpubMsg:c,uid:l}=n,h=this._users.find(p=>p.uid===l);if(!h)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(l)),void i();try{c.forEach(async p=>{let{stream_type:v}=p;const y=v===hr.Audio?bt.AUDIO:bt.VIDEO;await this._p2pChannel.unsubscribe(h,y),this._handleMuteStream(l,y,!0)}),i()}catch(p){s(p)}}}),this._gateway.signal.on(Ui.CONTROL,async(n,i)=>{const{action:s}=n;switch(s){case Hm.MUTE_LOCAL_VIDEO:this._handleMuteStream(i,bt.VIDEO,!0);break;case Hm.MUTE_LOCAL_AUDIO:this._handleMuteStream(i,bt.AUDIO,!0);break;case Hm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",i),this._handleMuteStream(i,bt.VIDEO,!1);break;case Hm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",i),this._handleMuteStream(i,bt.AUDIO,!1)}}),this._gateway.signal.on(Ui.RESTART_ICE,async(n,i,s)=>{if(this.store.useP2P)try{const{direction:c,iceParameter:l}=n;c!==xa.SEND_ONLY||l?i(await this._p2pChannel.restartICE(c,l)):(this._p2pChannel.handleDisconnect(c),i())}catch(c){s(c)}}),this._gateway.signal.on(Ui.CANDIDATE,n=>{if(this.store.useP2P){const{candidate:i,direction:s}=n;this._p2pChannel.addRemoteCandidate(i,s)}}),this._p2pChannel.on(Ft.RequestP2PRestartICE,async(n,i,s)=>{try{const{direction:c}=n;i(await this._gateway.sendExtensionMessage(Ui.RESTART_ICE,n,c===xa.SEND_ONLY))}catch(c){s(c)}}),this._p2pChannel.on(Ft.LocalCandidate,n=>{this._gateway.sendExtensionMessage(Ui.CANDIDATE,JSON.stringify(n),!0)}),this._p2pChannel.on(Ft.RequestP2PMuteLocal,async(n,i,s)=>{try{await this._gateway.sendExtensionMessage(Ui.CONTROL,n,!0),i()}catch(c){s(c)}}),this._p2pChannel.on(Ft.RequestP2PUnmuteRemote,async(n,i,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(n,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(c){c.code===ie.DISCONNECT_P2P?i():s(c)}else i()}),this._p2pChannel.on(Ft.RequestP2PMuteRemote,async(n,i,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(n,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(c){c.code===ie.DISCONNECT_P2P?i():s(c)}else i()}),this._p2pChannel.on(Ft.StateChange,(n,i)=>{i===ur.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ft.PeerConnectionStateChange,n=>{const i=this._peerConnectionState;n!==i&&(this.safeEmit(kn.PEERCONNECTION_STATE_CHANGE,n,i),this._peerConnectionState=n)}),this._p2pChannel.on(Ft.RequestMuteLocal,async(n,i,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(n,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(c){c.code===ie.DISCONNECT_P2P?i():s(c)}else i()}),this._p2pChannel.on(Ft.RequestUnmuteLocal,async(n,i,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(n,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(c){c.code===ie.DISCONNECT_P2P?i():s(c)}else i()}),this._p2pChannel.on(Ft.RequestRePublish,(n,i,s)=>{this.publish(n,!1).then(i).catch(s)}),this._p2pChannel.on(Ft.RequestRePublishDataChannel,(n,i,s)=>{pt.all(n.map(async c=>{const l=await this._p2pChannel.publishDataChannel([c]);try{l.forEach(h=>{this._uid&&this._gateway.publishDataChannel(this._uid,h,!0)})}catch(h){if(h.code!==ie.DISCONNECT_P2P)throw h}})).then(i).catch(s)}),this._p2pChannel.on(Ft.RequestReSubscribe,async(n,i,s)=>{try{for(const{user:c,kind:l}of n)l===bt.VIDEO?await this.subscribe(c,"video"):await this.subscribe(c,"audio");i()}catch(c){s(c)}}),this._p2pChannel.on(Ft.RequestUpload,(n,i)=>{this._gateway.upload(n,i)}),this._p2pChannel.on(Ft.RequestUploadStats,n=>{this._gateway.uploadWRTCStats(n)}),this._p2pChannel.on(Ft.MediaReconnectStart,n=>{this.safeEmit(kn.MEDIA_RECONNECT_START,n)}),this._p2pChannel.on(Ft.MediaReconnectEnd,n=>{this.safeEmit(kn.MEDIA_RECONNECT_END,n)}),this._p2pChannel.on(Ft.NeedSignalRTT,n=>{n(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ft.RequestRestartICE,async n=>{if(this.store.useP2P)return;const i=await this._p2pChannel.restartICE(n),s=await i.next();if(s.done)return;const c=s.value;let l;try{l=await this._gateway.restartICE({iceParameters:c})}catch(p){return void i.throw(p)}const{iceParameters:h}=function(p){const v=p.iceParameters;return{iceParameters:{iceUfrag:v.iceUfrag,icePwd:v.icePwd}}}(l);await i.next({remoteIceParameters:h})}),this._p2pChannel.on(Ft.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ft.RequestReconnectPC,async()=>{var n;const{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}=await this._p2pChannel.startP2PConnection({turnServer:(n=this._joinInfo)===null||n===void 0?void 0:n.turnServer}),{gatewayEstablishParams:l,gatewayAddress:h}=await this._gateway.reconnectPC({iceParameters:i,dtlsParameters:s,rtpCapabilities:c}),p=P3(l,h);await this._p2pChannel.connect(p),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ft.RequestUnpublishForReconnectPC,async(n,i,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(n,this._uid),i()):s()}),this._p2pChannel.on(Ft.P2PLost,()=>{this.safeEmit(kn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ft.UpdateVideoEncoder,n=>{n._encoderConfig&&this._gateway.setVideoProfile(n._encoderConfig)}),this._p2pChannel.on(Ft.ConnectionTypeChange,n=>{this.safeEmit(kn.IS_USING_CLOUD_PROXY,n)}),this._p2pChannel.on(Ft.RequestLowStreamParameter,n=>{n(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ft.QueryClientConnectionState,n=>{n(this.connectionState)}),this._p2pChannel.on(Ft.AudioMetadata,n=>{this.safeEmit(kn.AUDIO_METADATA,n)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(n){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Pe(ie.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Pe(ie.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(i={config:n},vp("ContentInspect").create(i));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:c,cname:l,sid:h,token:p,uid:v,cid:y,vid:S}=this._joinInfo;await s.init({appId:c,areaCode:"",cname:l,sid:h,token:p,uid:v,cid:y,vid:S?Number(S):0},ss)}catch(s){throw Array.isArray(s)?s[0]:s}var i}handleVideoInspectEvents(n){n.on(Us.CONNECTION_STATE_CHANGE,(i,s)=>{if(this.safeEmit(kn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,i,s),s===ud.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(kn.CONTENT_INSPECT_ERROR,new Pe(ie.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));n.inspectImage()}}),n.on(Us.INSPECT_RESULT,(i,s)=>{var c;if((s==null?void 0:s.code)===ie.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(c=this._inspect)===null||c===void 0||c.close(),void(this._inspect=void 0);this.safeEmit(kn.CONTENT_INSPECT_RESULT,i,s)}),n.on(Us.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Pe(ie.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}async setImageModeration(n,i){if(lp(n,"enabled"),n){if(!i)throw new Pe(ie.INVALID_PARAMS,"config is required");if(Y7(i),!this._joinInfo)throw new Pe(ie.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(i);else{const c=(s={config:i},vp("ImageModeration").create(s));this._moderation=c,this.handleImageModerationEvents(c);const{appId:l,cname:h,sid:p,token:v,uid:y,cid:S,vid:b}=this._joinInfo;await c.init({appId:l,areaCode:"",cname:h,sid:p,token:v,uid:y,cid:S,vid:b?Number(b):0},ss)}}catch(c){throw Array.isArray(c)?c[0]:c}}else{var s;if(!this._moderation)throw new Pe(ie.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(c){throw Array.isArray(c)?c[0]:c}}}handleImageModerationEvents(n){n.on(th.CONNECTION_STATE_CHANGE,(i,s)=>{if(this.safeEmit(kn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,i,s),i===Al.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Pe(ie.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");n.inspectImage()}}),n.on(th.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(n){if(function(i){vs(i,"transport",["default","auto","relay","sd-rtn"])}(n),this.mode!=="p2p")throw new Pe(ie.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=n,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(n))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(n){lp(n,"enabled"),_r("ENABLE_PUBLISH_AUDIO_FILTER",n),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(n)}_handleResetAddStream(n,i){switch(i){case"audio":n._audio_added_=!1,n._trust_audio_stream_added_state_=!0;break;case"video":n._video_added_=!1,n._trust_video_stream_added_state_=!0}}},Ct(yt.prototype,"leave",[X7],Object.getOwnPropertyDescriptor(yt.prototype,"leave"),yt.prototype),Ct(yt.prototype,"publish",[J7],Object.getOwnPropertyDescriptor(yt.prototype,"publish"),yt.prototype),Ct(yt.prototype,"unpublish",[Q7],Object.getOwnPropertyDescriptor(yt.prototype,"unpublish"),yt.prototype),Ct(yt.prototype,"subscribe",[Z7],Object.getOwnPropertyDescriptor(yt.prototype,"subscribe"),yt.prototype),Ct(yt.prototype,"presubscribe",[e$],Object.getOwnPropertyDescriptor(yt.prototype,"presubscribe"),yt.prototype),Ct(yt.prototype,"massSubscribe",[t$],Object.getOwnPropertyDescriptor(yt.prototype,"massSubscribe"),yt.prototype),Ct(yt.prototype,"unsubscribe",[n$],Object.getOwnPropertyDescriptor(yt.prototype,"unsubscribe"),yt.prototype),Ct(yt.prototype,"massUnsubscribe",[r$],Object.getOwnPropertyDescriptor(yt.prototype,"massUnsubscribe"),yt.prototype),Ct(yt.prototype,"setLowStreamParameter",[i$],Object.getOwnPropertyDescriptor(yt.prototype,"setLowStreamParameter"),yt.prototype),Ct(yt.prototype,"enableDualStream",[s$],Object.getOwnPropertyDescriptor(yt.prototype,"enableDualStream"),yt.prototype),Ct(yt.prototype,"disableDualStream",[o$],Object.getOwnPropertyDescriptor(yt.prototype,"disableDualStream"),yt.prototype),Ct(yt.prototype,"setClientRole",[a$],Object.getOwnPropertyDescriptor(yt.prototype,"setClientRole"),yt.prototype),Ct(yt.prototype,"_setClientRoleOptions",[c$],Object.getOwnPropertyDescriptor(yt.prototype,"_setClientRoleOptions"),yt.prototype),Ct(yt.prototype,"setProxyServer",[u$],Object.getOwnPropertyDescriptor(yt.prototype,"setProxyServer"),yt.prototype),Ct(yt.prototype,"setTurnServer",[l$],Object.getOwnPropertyDescriptor(yt.prototype,"setTurnServer"),yt.prototype),Ct(yt.prototype,"setLicense",[d$],Object.getOwnPropertyDescriptor(yt.prototype,"setLicense"),yt.prototype),Ct(yt.prototype,"startProxyServer",[h$],Object.getOwnPropertyDescriptor(yt.prototype,"startProxyServer"),yt.prototype),Ct(yt.prototype,"stopProxyServer",[f$],Object.getOwnPropertyDescriptor(yt.prototype,"stopProxyServer"),yt.prototype),Ct(yt.prototype,"setLocalAccessPointsV2",[p$],Object.getOwnPropertyDescriptor(yt.prototype,"setLocalAccessPointsV2"),yt.prototype),Ct(yt.prototype,"setLocalAccessPoints",[m$],Object.getOwnPropertyDescriptor(yt.prototype,"setLocalAccessPoints"),yt.prototype),Ct(yt.prototype,"setRemoteDefaultVideoStreamType",[g$],Object.getOwnPropertyDescriptor(yt.prototype,"setRemoteDefaultVideoStreamType"),yt.prototype),Ct(yt.prototype,"setRemoteVideoStreamType",[v$],Object.getOwnPropertyDescriptor(yt.prototype,"setRemoteVideoStreamType"),yt.prototype),Ct(yt.prototype,"setStreamFallbackOption",[_$],Object.getOwnPropertyDescriptor(yt.prototype,"setStreamFallbackOption"),yt.prototype),Ct(yt.prototype,"setEncryptionConfig",[y$],Object.getOwnPropertyDescriptor(yt.prototype,"setEncryptionConfig"),yt.prototype),Ct(yt.prototype,"renewToken",[E$],Object.getOwnPropertyDescriptor(yt.prototype,"renewToken"),yt.prototype),Ct(yt.prototype,"enableAudioVolumeIndicator",[S$],Object.getOwnPropertyDescriptor(yt.prototype,"enableAudioVolumeIndicator"),yt.prototype),Ct(yt.prototype,"startLiveStreaming",[T$],Object.getOwnPropertyDescriptor(yt.prototype,"startLiveStreaming"),yt.prototype),Ct(yt.prototype,"setLiveTranscoding",[b$],Object.getOwnPropertyDescriptor(yt.prototype,"setLiveTranscoding"),yt.prototype),Ct(yt.prototype,"stopLiveStreaming",[w$],Object.getOwnPropertyDescriptor(yt.prototype,"stopLiveStreaming"),yt.prototype),Ct(yt.prototype,"startChannelMediaRelay",[C$],Object.getOwnPropertyDescriptor(yt.prototype,"startChannelMediaRelay"),yt.prototype),Ct(yt.prototype,"updateChannelMediaRelay",[R$],Object.getOwnPropertyDescriptor(yt.prototype,"updateChannelMediaRelay"),yt.prototype),Ct(yt.prototype,"stopChannelMediaRelay",[I$],Object.getOwnPropertyDescriptor(yt.prototype,"stopChannelMediaRelay"),yt.prototype),Ct(yt.prototype,"sendCustomReportMessage",[A$],Object.getOwnPropertyDescriptor(yt.prototype,"sendCustomReportMessage"),yt.prototype),Ct(yt.prototype,"pickSVCLayer",[k$],Object.getOwnPropertyDescriptor(yt.prototype,"pickSVCLayer"),yt.prototype),Ct(yt.prototype,"setRTMConfig",[O$],Object.getOwnPropertyDescriptor(yt.prototype,"setRTMConfig"),yt.prototype),Ct(yt.prototype,"enableContentInspect",[P$],Object.getOwnPropertyDescriptor(yt.prototype,"enableContentInspect"),yt.prototype),Ct(yt.prototype,"disableContentInspect",[N$],Object.getOwnPropertyDescriptor(yt.prototype,"disableContentInspect"),yt.prototype),Ct(yt.prototype,"setImageModeration",[D$],Object.getOwnPropertyDescriptor(yt.prototype,"setImageModeration"),yt.prototype),Ct(yt.prototype,"setP2PTransport",[L$],Object.getOwnPropertyDescriptor(yt.prototype,"setP2PTransport"),yt.prototype),Ct(yt.prototype,"getJoinChannelServiceRecords",[x$],Object.getOwnPropertyDescriptor(yt.prototype,"getJoinChannelServiceRecords"),yt.prototype),Ct(yt.prototype,"setPublishAudioFilterEnabled",[M$],Object.getOwnPropertyDescriptor(yt.prototype,"setPublishAudioFilterEnabled"),yt.prototype),yt);class ow{constructor(i,s){ee(this,"id",0),ee(this,"element",void 0),ee(this,"peerPair",void 0),ee(this,"context",void 0),ee(this,"audioPlayerElement",void 0),ee(this,"audioTrack",void 0),ow.count+=1,this.id=ow.count,this.element=i,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=i=>{const s=document.createElement("audio");s.srcObject=new MediaStream([i.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const i=async(c,l)=>{const h=l==="offer"?await c.createOffer():await c.createAnswer();return await c.setLocalDescription(h),c.iceGatheringState==="complete"?c.localDescription:new pt(p=>{c.onicegatheringstatechange=()=>{c.iceGatheringState==="complete"&&p(c.localDescription)}})},s=async(c,l)=>await c.setRemoteDescription(l);try{const c=await i(this.peerPair[0],"offer");await s(this.peerPair[1],c);const l=await i(this.peerPair[1],"answer");await s(this.peerPair[0],l)}catch(c){throw new Pe(ie.LOCAL_AEC_ERROR,c.toString()).print()}}async getTracksFromMediaElement(i){if(this.audioTrack)return this.audioTrack;let s;try{i instanceof HTMLVideoElement&&(i.captureStream?i.captureStream():i.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(i).connect(s)}catch(l){throw new Pe(ie.LOCAL_AEC_ERROR,l.toString()).print()}if(!s)throw new Pe(ie.LOCAL_AEC_ERROR,"no dest node when local aec").print();const c=s.stream.getAudioTracks()[0];return this.audioTrack=c,c}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const i=this.element,s=await this.getTracksFromMediaElement(i);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(i=>{i.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var V$,xO;ee(ow,"count",0);const eTe=window.AudioContext||window.webkitAudioContext,tTe=new(V$=zt({report:kt}),Ct((xO=class{constructor(){ee(this,"units",[]),ee(this,"context",void 0)}processExternalMediaAEC(n){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new eTe);let i=this.units.find(s=>s&&s.getElement()===n);return i||(i=new ow(n,this.context),this.units.push(i)),i.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",i.id),i.id}_doesEnvironmentNeedAEC(){return zn().name!==nr.SAFARI}}).prototype,"processExternalMediaAEC",[V$],Object.getOwnPropertyDescriptor(xO.prototype,"processExternalMediaAEC"),xO.prototype),xO);function F$(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function j$(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?F$(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):F$(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}const PU=window||document;function B$(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!PU)return;const s=os._cspEventHandlerPointer;if(s&&i)return void console.error(s,i);const c=l=>{if(!(l&&l.blockedURI&&(os.onSecurityPolicyViolation||os.getListeners(Gh.SECURITY_POLICY_VIOLATION).length>0)))return;const h=l.blockedURI;le("CSP_DETECTED_HOSTNAME_LIST").some(p=>dt(h).call(h,p))&&(os.onSecurityPolicyViolation&&typeof os.onSecurityPolicyViolation=="function"&&os.onSecurityPolicyViolation(l),os.getListeners(Gh.SECURITY_POLICY_VIOLATION).length>0&&os.safeEmit(Gh.SECURITY_POLICY_VIOLATION,l))};s&&PU.removeEventListener("securitypolicyviolation",s),(i||n&&typeof n=="function"||os.getListeners(Gh.SECURITY_POLICY_VIOLATION).length>0)&&PU.addEventListener("securitypolicyviolation",c),os._cspEventHandlerPointer=c}var nTe=I,rTe=wH,W$=RegExp.prototype,iTe=function(n){return n===W$||nTe(W$,n)?rTe(n):n.flags},ga=a(iTe);function bS(n){let i=n.length;for(;--i>=0;)n[i]=0}const NU=256,z$=286,aw=30,cw=15,DU=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),MO=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),sTe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),G$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ep=new Array(576);bS(Ep);const uw=new Array(60);bS(uw);const lw=new Array(512);bS(lw);const dw=new Array(256);bS(dw);const LU=new Array(29);bS(LU);const UO=new Array(aw);function xU(n,i,s,c,l){this.static_tree=n,this.extra_bits=i,this.extra_base=s,this.elems=c,this.max_length=l,this.has_stree=n&&n.length}let H$,K$,q$;function MU(n,i){this.dyn_tree=n,this.max_code=0,this.stat_desc=i}bS(UO);const $$=n=>n<256?lw[n]:lw[256+(n>>>7)],hw=(n,i)=>{n.pending_buf[n.pending++]=255&i,n.pending_buf[n.pending++]=i>>>8&255},Ju=(n,i,s)=>{n.bi_valid>16-s?(n.bi_buf|=i<<n.bi_valid&65535,hw(n,n.bi_buf),n.bi_buf=i>>16-n.bi_valid,n.bi_valid+=s-16):(n.bi_buf|=i<<n.bi_valid&65535,n.bi_valid+=s)},Yh=(n,i,s)=>{Ju(n,s[2*i],s[2*i+1])},Y$=(n,i)=>{let s=0;do s|=1&n,n>>>=1,s<<=1;while(--i>0);return s>>>1},X$=(n,i,s)=>{const c=new Array(16);let l,h,p=0;for(l=1;l<=cw;l++)p=p+s[l-1]<<1,c[l]=p;for(h=0;h<=i;h++){let v=n[2*h+1];v!==0&&(n[2*h]=Y$(c[v]++,v))}},J$=n=>{let i;for(i=0;i<z$;i++)n.dyn_ltree[2*i]=0;for(i=0;i<aw;i++)n.dyn_dtree[2*i]=0;for(i=0;i<19;i++)n.bl_tree[2*i]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},Q$=n=>{n.bi_valid>8?hw(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},Z$=(n,i,s,c)=>{const l=2*i,h=2*s;return n[l]<n[h]||n[l]===n[h]&&c[i]<=c[s]},UU=(n,i,s)=>{const c=n.heap[s];let l=s<<1;for(;l<=n.heap_len&&(l<n.heap_len&&Z$(i,n.heap[l+1],n.heap[l],n.depth)&&l++,!Z$(i,c,n.heap[l],n.depth));)n.heap[s]=n.heap[l],s=l,l<<=1;n.heap[s]=c},eY=(n,i,s)=>{let c,l,h,p,v=0;if(n.sym_next!==0)do c=255&n.pending_buf[n.sym_buf+v++],c+=(255&n.pending_buf[n.sym_buf+v++])<<8,l=n.pending_buf[n.sym_buf+v++],c===0?Yh(n,l,i):(h=dw[l],Yh(n,h+NU+1,i),p=DU[h],p!==0&&(l-=LU[h],Ju(n,l,p)),c--,h=$$(c),Yh(n,h,s),p=MO[h],p!==0&&(c-=UO[h],Ju(n,c,p)));while(v<n.sym_next);Yh(n,256,i)},VU=(n,i)=>{const s=i.dyn_tree,c=i.stat_desc.static_tree,l=i.stat_desc.has_stree,h=i.stat_desc.elems;let p,v,y,S=-1;for(n.heap_len=0,n.heap_max=573,p=0;p<h;p++)s[2*p]!==0?(n.heap[++n.heap_len]=S=p,n.depth[p]=0):s[2*p+1]=0;for(;n.heap_len<2;)y=n.heap[++n.heap_len]=S<2?++S:0,s[2*y]=1,n.depth[y]=0,n.opt_len--,l&&(n.static_len-=c[2*y+1]);for(i.max_code=S,p=n.heap_len>>1;p>=1;p--)UU(n,s,p);y=h;do p=n.heap[1],n.heap[1]=n.heap[n.heap_len--],UU(n,s,1),v=n.heap[1],n.heap[--n.heap_max]=p,n.heap[--n.heap_max]=v,s[2*y]=s[2*p]+s[2*v],n.depth[y]=(n.depth[p]>=n.depth[v]?n.depth[p]:n.depth[v])+1,s[2*p+1]=s[2*v+1]=y,n.heap[1]=y++,UU(n,s,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((b,R)=>{const O=R.dyn_tree,N=R.max_code,Y=R.stat_desc.static_tree,W=R.stat_desc.has_stree,H=R.stat_desc.extra_bits,ne=R.stat_desc.extra_base,re=R.stat_desc.max_length;let me,be,we,Se,Le,et,mt=0;for(Se=0;Se<=cw;Se++)b.bl_count[Se]=0;for(O[2*b.heap[b.heap_max]+1]=0,me=b.heap_max+1;me<573;me++)be=b.heap[me],Se=O[2*O[2*be+1]+1]+1,Se>re&&(Se=re,mt++),O[2*be+1]=Se,be>N||(b.bl_count[Se]++,Le=0,be>=ne&&(Le=H[be-ne]),et=O[2*be],b.opt_len+=et*(Se+Le),W&&(b.static_len+=et*(Y[2*be+1]+Le)));if(mt!==0){do{for(Se=re-1;b.bl_count[Se]===0;)Se--;b.bl_count[Se]--,b.bl_count[Se+1]+=2,b.bl_count[re]--,mt-=2}while(mt>0);for(Se=re;Se!==0;Se--)for(be=b.bl_count[Se];be!==0;)we=b.heap[--me],we>N||(O[2*we+1]!==Se&&(b.opt_len+=(Se-O[2*we+1])*O[2*we],O[2*we+1]=Se),be--)}})(n,i),X$(s,S,n.bl_count)},tY=(n,i,s)=>{let c,l,h=-1,p=i[1],v=0,y=7,S=4;for(p===0&&(y=138,S=3),i[2*(s+1)+1]=65535,c=0;c<=s;c++)l=p,p=i[2*(c+1)+1],++v<y&&l===p||(v<S?n.bl_tree[2*l]+=v:l!==0?(l!==h&&n.bl_tree[2*l]++,n.bl_tree[32]++):v<=10?n.bl_tree[34]++:n.bl_tree[36]++,v=0,h=l,p===0?(y=138,S=3):l===p?(y=6,S=3):(y=7,S=4))},nY=(n,i,s)=>{let c,l,h=-1,p=i[1],v=0,y=7,S=4;for(p===0&&(y=138,S=3),c=0;c<=s;c++)if(l=p,p=i[2*(c+1)+1],!(++v<y&&l===p)){if(v<S)do Yh(n,l,n.bl_tree);while(--v!=0);else l!==0?(l!==h&&(Yh(n,l,n.bl_tree),v--),Yh(n,16,n.bl_tree),Ju(n,v-3,2)):v<=10?(Yh(n,17,n.bl_tree),Ju(n,v-3,3)):(Yh(n,18,n.bl_tree),Ju(n,v-11,7));v=0,h=l,p===0?(y=138,S=3):l===p?(y=6,S=3):(y=7,S=4)}};let rY=!1;const iY=(n,i,s,c)=>{Ju(n,0+(c?1:0),3),Q$(n),hw(n,s),hw(n,~s),s&&n.pending_buf.set(n.window.subarray(i,i+s),n.pending),n.pending+=s};var oTe=n=>{rY||((()=>{let i,s,c,l,h;const p=new Array(16);for(c=0,l=0;l<28;l++)for(LU[l]=c,i=0;i<1<<DU[l];i++)dw[c++]=l;for(dw[c-1]=l,h=0,l=0;l<16;l++)for(UO[l]=h,i=0;i<1<<MO[l];i++)lw[h++]=l;for(h>>=7;l<aw;l++)for(UO[l]=h<<7,i=0;i<1<<MO[l]-7;i++)lw[256+h++]=l;for(s=0;s<=cw;s++)p[s]=0;for(i=0;i<=143;)Ep[2*i+1]=8,i++,p[8]++;for(;i<=255;)Ep[2*i+1]=9,i++,p[9]++;for(;i<=279;)Ep[2*i+1]=7,i++,p[7]++;for(;i<=287;)Ep[2*i+1]=8,i++,p[8]++;for(X$(Ep,287,p),i=0;i<aw;i++)uw[2*i+1]=5,uw[2*i]=Y$(i,5);H$=new xU(Ep,DU,257,z$,cw),K$=new xU(uw,MO,0,aw,cw),q$=new xU(new Array(0),sTe,0,19,7)})(),rY=!0),n.l_desc=new MU(n.dyn_ltree,H$),n.d_desc=new MU(n.dyn_dtree,K$),n.bl_desc=new MU(n.bl_tree,q$),n.bi_buf=0,n.bi_valid=0,J$(n)},aTe=(n,i,s,c)=>{let l,h,p=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(v=>{let y,S=4093624447;for(y=0;y<=31;y++,S>>>=1)if(1&S&&v.dyn_ltree[2*y]!==0)return 0;if(v.dyn_ltree[18]!==0||v.dyn_ltree[20]!==0||v.dyn_ltree[26]!==0)return 1;for(y=32;y<NU;y++)if(v.dyn_ltree[2*y]!==0)return 1;return 0})(n)),VU(n,n.l_desc),VU(n,n.d_desc),p=(v=>{let y;for(tY(v,v.dyn_ltree,v.l_desc.max_code),tY(v,v.dyn_dtree,v.d_desc.max_code),VU(v,v.bl_desc),y=18;y>=3&&v.bl_tree[2*G$[y]+1]===0;y--);return v.opt_len+=3*(y+1)+5+5+4,y})(n),l=n.opt_len+3+7>>>3,h=n.static_len+3+7>>>3,h<=l&&(l=h)):l=h=s+5,s+4<=l&&i!==-1?iY(n,i,s,c):n.strategy===4||h===l?(Ju(n,2+(c?1:0),3),eY(n,Ep,uw)):(Ju(n,4+(c?1:0),3),((v,y,S,b)=>{let R;for(Ju(v,y-257,5),Ju(v,S-1,5),Ju(v,b-4,4),R=0;R<b;R++)Ju(v,v.bl_tree[2*G$[R]+1],3);nY(v,v.dyn_ltree,y-1),nY(v,v.dyn_dtree,S-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,p+1),eY(n,n.dyn_ltree,n.dyn_dtree)),J$(n),c&&Q$(n)},cTe=(n,i,s)=>(n.pending_buf[n.sym_buf+n.sym_next++]=i,n.pending_buf[n.sym_buf+n.sym_next++]=i>>8,n.pending_buf[n.sym_buf+n.sym_next++]=s,i===0?n.dyn_ltree[2*s]++:(n.matches++,i--,n.dyn_ltree[2*(dw[s]+NU+1)]++,n.dyn_dtree[2*$$(i)]++),n.sym_next===n.sym_end),uTe=n=>{Ju(n,2,3),Yh(n,256,Ep),(i=>{i.bi_valid===16?(hw(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=255&i.bi_buf,i.bi_buf>>=8,i.bi_valid-=8)})(n)},lTe={_tr_init:oTe,_tr_stored_block:iY,_tr_flush_block:aTe,_tr_tally:cTe,_tr_align:uTe},fw=(n,i,s,c)=>{let l=65535&n|0,h=n>>>16&65535|0,p=0;for(;s!==0;){p=s>2e3?2e3:s,s-=p;do l=l+i[c++]|0,h=h+l|0;while(--p);l%=65521,h%=65521}return l|h<<16|0};const dTe=new Uint32Array((()=>{let n,i=[];for(var s=0;s<256;s++){n=s;for(var c=0;c<8;c++)n=1&n?3988292384^n>>>1:n>>>1;i[s]=n}return i})());var Ua=(n,i,s,c)=>{const l=dTe,h=c+s;n^=-1;for(let p=c;p<h;p++)n=n>>>8^l[255&(n^i[p])];return-1^n},y_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},VO={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:hTe,_tr_stored_block:FU,_tr_flush_block:fTe,_tr_tally:eg,_tr_align:pTe}=lTe,{Z_NO_FLUSH:tg,Z_PARTIAL_FLUSH:mTe,Z_FULL_FLUSH:gTe,Z_FINISH:pd,Z_BLOCK:sY,Z_OK:oc,Z_STREAM_END:oY,Z_STREAM_ERROR:Xh,Z_DATA_ERROR:vTe,Z_BUF_ERROR:jU,Z_DEFAULT_COMPRESSION:_Te,Z_FILTERED:yTe,Z_HUFFMAN_ONLY:FO,Z_RLE:ETe,Z_FIXED:STe,Z_DEFAULT_STRATEGY:TTe,Z_UNKNOWN:bTe,Z_DEFLATED:jO}=VO,BU=286,wTe=30,CTe=19,RTe=2*BU+1,ITe=15,E_=258,Jh=262,wS=42,S_=113,pw=666,T_=(n,i)=>(n.msg=y_[i],i),aY=n=>2*n-(n>4?9:0),ng=n=>{let i=n.length;for(;--i>=0;)n[i]=0},ATe=n=>{let i,s,c,l=n.w_size;i=n.hash_size,c=i;do s=n.head[--c],n.head[c]=s>=l?s-l:0;while(--i);i=l,c=i;do s=n.prev[--c],n.prev[c]=s>=l?s-l:0;while(--i)};let rg=(n,i,s)=>(i<<n.hash_shift^s)&n.hash_mask;const Ol=n=>{const i=n.state;let s=i.pending;s>n.avail_out&&(s=n.avail_out),s!==0&&(n.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+s),n.next_out),n.next_out+=s,i.pending_out+=s,n.total_out+=s,n.avail_out-=s,i.pending-=s,i.pending===0&&(i.pending_out=0))},Pl=(n,i)=>{fTe(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,i),n.block_start=n.strstart,Ol(n.strm)},Ai=(n,i)=>{n.pending_buf[n.pending++]=i},mw=(n,i)=>{n.pending_buf[n.pending++]=i>>>8&255,n.pending_buf[n.pending++]=255&i},WU=(n,i,s,c)=>{let l=n.avail_in;return l>c&&(l=c),l===0?0:(n.avail_in-=l,i.set(n.input.subarray(n.next_in,n.next_in+l),s),n.state.wrap===1?n.adler=fw(n.adler,i,l,s):n.state.wrap===2&&(n.adler=Ua(n.adler,i,l,s)),n.next_in+=l,n.total_in+=l,l)},cY=(n,i)=>{let s,c,l=n.max_chain_length,h=n.strstart,p=n.prev_length,v=n.nice_match;const y=n.strstart>n.w_size-Jh?n.strstart-(n.w_size-Jh):0,S=n.window,b=n.w_mask,R=n.prev,O=n.strstart+E_;let N=S[h+p-1],Y=S[h+p];n.prev_length>=n.good_match&&(l>>=2),v>n.lookahead&&(v=n.lookahead);do if(s=i,S[s+p]===Y&&S[s+p-1]===N&&S[s]===S[h]&&S[++s]===S[h+1]){h+=2,s++;do;while(S[++h]===S[++s]&&S[++h]===S[++s]&&S[++h]===S[++s]&&S[++h]===S[++s]&&S[++h]===S[++s]&&S[++h]===S[++s]&&S[++h]===S[++s]&&S[++h]===S[++s]&&h<O);if(c=E_-(O-h),h=O-E_,c>p){if(n.match_start=i,p=c,c>=v)break;N=S[h+p-1],Y=S[h+p]}}while((i=R[i&b])>y&&--l!=0);return p<=n.lookahead?p:n.lookahead},CS=n=>{const i=n.w_size;let s,c,l;do{if(c=n.window_size-n.lookahead-n.strstart,n.strstart>=i+(i-Jh)&&(n.window.set(n.window.subarray(i,i+i-c),0),n.match_start-=i,n.strstart-=i,n.block_start-=i,n.insert>n.strstart&&(n.insert=n.strstart),ATe(n),c+=i),n.strm.avail_in===0)break;if(s=WU(n.strm,n.window,n.strstart+n.lookahead,c),n.lookahead+=s,n.lookahead+n.insert>=3)for(l=n.strstart-n.insert,n.ins_h=n.window[l],n.ins_h=rg(n,n.ins_h,n.window[l+1]);n.insert&&(n.ins_h=rg(n,n.ins_h,n.window[l+3-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<Jh&&n.strm.avail_in!==0)},uY=(n,i)=>{let s,c,l,h=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,p=0,v=n.strm.avail_in;do{if(s=65535,l=n.bi_valid+42>>3,n.strm.avail_out<l||(l=n.strm.avail_out-l,c=n.strstart-n.block_start,s>c+n.strm.avail_in&&(s=c+n.strm.avail_in),s>l&&(s=l),s<h&&(s===0&&i!==pd||i===tg||s!==c+n.strm.avail_in)))break;p=i===pd&&s===c+n.strm.avail_in?1:0,FU(n,0,0,p),n.pending_buf[n.pending-4]=s,n.pending_buf[n.pending-3]=s>>8,n.pending_buf[n.pending-2]=~s,n.pending_buf[n.pending-1]=~s>>8,Ol(n.strm),c&&(c>s&&(c=s),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+c),n.strm.next_out),n.strm.next_out+=c,n.strm.avail_out-=c,n.strm.total_out+=c,n.block_start+=c,s-=c),s&&(WU(n.strm,n.strm.output,n.strm.next_out,s),n.strm.next_out+=s,n.strm.avail_out-=s,n.strm.total_out+=s)}while(p===0);return v-=n.strm.avail_in,v&&(v>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=v&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-v,n.strm.next_in),n.strstart),n.strstart+=v,n.insert+=v>n.w_size-n.insert?n.w_size-n.insert:v),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),p?4:i!==tg&&i!==pd&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(l=n.window_size-n.strstart,n.strm.avail_in>l&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,l+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),l>n.strm.avail_in&&(l=n.strm.avail_in),l&&(WU(n.strm,n.window,n.strstart,l),n.strstart+=l,n.insert+=l>n.w_size-n.insert?n.w_size-n.insert:l),n.high_water<n.strstart&&(n.high_water=n.strstart),l=n.bi_valid+42>>3,l=n.pending_buf_size-l>65535?65535:n.pending_buf_size-l,h=l>n.w_size?n.w_size:l,c=n.strstart-n.block_start,(c>=h||(c||i===pd)&&i!==tg&&n.strm.avail_in===0&&c<=l)&&(s=c>l?l:c,p=i===pd&&n.strm.avail_in===0&&s===c?1:0,FU(n,n.block_start,s,p),n.block_start+=s,Ol(n.strm)),p?3:1)},zU=(n,i)=>{let s,c;for(;;){if(n.lookahead<Jh){if(CS(n),n.lookahead<Jh&&i===tg)return 1;if(n.lookahead===0)break}if(s=0,n.lookahead>=3&&(n.ins_h=rg(n,n.ins_h,n.window[n.strstart+3-1]),s=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),s!==0&&n.strstart-s<=n.w_size-Jh&&(n.match_length=cY(n,s)),n.match_length>=3)if(c=eg(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=rg(n,n.ins_h,n.window[n.strstart+3-1]),s=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=rg(n,n.ins_h,n.window[n.strstart+1]);else c=eg(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(c&&(Pl(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,i===pd?(Pl(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Pl(n,!1),n.strm.avail_out===0)?1:2},RS=(n,i)=>{let s,c,l;for(;;){if(n.lookahead<Jh){if(CS(n),n.lookahead<Jh&&i===tg)return 1;if(n.lookahead===0)break}if(s=0,n.lookahead>=3&&(n.ins_h=rg(n,n.ins_h,n.window[n.strstart+3-1]),s=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,s!==0&&n.prev_length<n.max_lazy_match&&n.strstart-s<=n.w_size-Jh&&(n.match_length=cY(n,s),n.match_length<=5&&(n.strategy===yTe||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){l=n.strstart+n.lookahead-3,c=eg(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=l&&(n.ins_h=rg(n,n.ins_h,n.window[n.strstart+3-1]),s=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,c&&(Pl(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(c=eg(n,0,n.window[n.strstart-1]),c&&Pl(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(c=eg(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,i===pd?(Pl(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Pl(n,!1),n.strm.avail_out===0)?1:2};function Qh(n,i,s,c,l){this.good_length=n,this.max_lazy=i,this.nice_length=s,this.max_chain=c,this.func=l}const gw=[new Qh(0,0,0,0,uY),new Qh(4,4,8,4,zU),new Qh(4,5,16,8,zU),new Qh(4,6,32,32,zU),new Qh(4,4,16,16,RS),new Qh(8,16,32,32,RS),new Qh(8,16,128,128,RS),new Qh(8,32,128,256,RS),new Qh(32,128,258,1024,RS),new Qh(32,258,258,4096,RS)];function kTe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=jO,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*RTe),this.dyn_dtree=new Uint16Array(2*(2*wTe+1)),this.bl_tree=new Uint16Array(2*(2*CTe+1)),ng(this.dyn_ltree),ng(this.dyn_dtree),ng(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ITe+1),this.heap=new Uint16Array(2*BU+1),ng(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*BU+1),ng(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const vw=n=>{if(!n)return 1;const i=n.state;return!i||i.strm!==n||i.status!==wS&&i.status!==57&&i.status!==69&&i.status!==73&&i.status!==91&&i.status!==103&&i.status!==S_&&i.status!==pw?1:0},lY=n=>{if(vw(n))return T_(n,Xh);n.total_in=n.total_out=0,n.data_type=bTe;const i=n.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?57:i.wrap?wS:S_,n.adler=i.wrap===2?0:1,i.last_flush=-2,hTe(i),oc},dY=n=>{const i=lY(n);return i===oc&&(s=>{s.window_size=2*s.w_size,ng(s.head),s.max_lazy_match=gw[s.level].max_lazy,s.good_match=gw[s.level].good_length,s.nice_match=gw[s.level].nice_length,s.max_chain_length=gw[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(n.state),i},hY=(n,i,s,c,l,h)=>{if(!n)return Xh;let p=1;if(i===_Te&&(i=6),c<0?(p=0,c=-c):c>15&&(p=2,c-=16),l<1||l>9||s!==jO||c<8||c>15||i<0||i>9||h<0||h>STe||c===8&&p!==1)return T_(n,Xh);c===8&&(c=9);const v=new kTe;return n.state=v,v.strm=n,v.status=wS,v.wrap=p,v.gzhead=null,v.w_bits=c,v.w_size=1<<v.w_bits,v.w_mask=v.w_size-1,v.hash_bits=l+7,v.hash_size=1<<v.hash_bits,v.hash_mask=v.hash_size-1,v.hash_shift=~~((v.hash_bits+3-1)/3),v.window=new Uint8Array(2*v.w_size),v.head=new Uint16Array(v.hash_size),v.prev=new Uint16Array(v.w_size),v.lit_bufsize=1<<l+6,v.pending_buf_size=4*v.lit_bufsize,v.pending_buf=new Uint8Array(v.pending_buf_size),v.sym_buf=v.lit_bufsize,v.sym_end=3*(v.lit_bufsize-1),v.level=i,v.strategy=h,v.method=s,dY(n)};var OTe=(n,i)=>{if(vw(n)||i>sY||i<0)return n?T_(n,Xh):Xh;const s=n.state;if(!n.output||n.avail_in!==0&&!n.input||s.status===pw&&i!==pd)return T_(n,n.avail_out===0?jU:Xh);const c=s.last_flush;if(s.last_flush=i,s.pending!==0){if(Ol(n),n.avail_out===0)return s.last_flush=-1,oc}else if(n.avail_in===0&&aY(i)<=aY(c)&&i!==pd)return T_(n,jU);if(s.status===pw&&n.avail_in!==0)return T_(n,jU);if(s.status===wS&&s.wrap===0&&(s.status=S_),s.status===wS){let l=jO+(s.w_bits-8<<4)<<8,h=-1;if(h=s.strategy>=FO||s.level<2?0:s.level<6?1:s.level===6?2:3,l|=h<<6,s.strstart!==0&&(l|=32),l+=31-l%31,mw(s,l),s.strstart!==0&&(mw(s,n.adler>>>16),mw(s,65535&n.adler)),n.adler=1,s.status=S_,Ol(n),s.pending!==0)return s.last_flush=-1,oc}if(s.status===57){if(n.adler=0,Ai(s,31),Ai(s,139),Ai(s,8),s.gzhead)Ai(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),Ai(s,255&s.gzhead.time),Ai(s,s.gzhead.time>>8&255),Ai(s,s.gzhead.time>>16&255),Ai(s,s.gzhead.time>>24&255),Ai(s,s.level===9?2:s.strategy>=FO||s.level<2?4:0),Ai(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(Ai(s,255&s.gzhead.extra.length),Ai(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(n.adler=Ua(n.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(Ai(s,0),Ai(s,0),Ai(s,0),Ai(s,0),Ai(s,0),Ai(s,s.level===9?2:s.strategy>=FO||s.level<2?4:0),Ai(s,3),s.status=S_,Ol(n),s.pending!==0)return s.last_flush=-1,oc}if(s.status===69){if(s.gzhead.extra){let l=s.pending,h=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+h>s.pending_buf_size;){let v=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+v),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>l&&(n.adler=Ua(n.adler,s.pending_buf,s.pending-l,l)),s.gzindex+=v,Ol(n),s.pending!==0)return s.last_flush=-1,oc;l=0,h-=v}let p=new Uint8Array(s.gzhead.extra);s.pending_buf.set(p.subarray(s.gzindex,s.gzindex+h),s.pending),s.pending+=h,s.gzhead.hcrc&&s.pending>l&&(n.adler=Ua(n.adler,s.pending_buf,s.pending-l,l)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let l,h=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>h&&(n.adler=Ua(n.adler,s.pending_buf,s.pending-h,h)),Ol(n),s.pending!==0)return s.last_flush=-1,oc;h=0}l=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,Ai(s,l)}while(l!==0);s.gzhead.hcrc&&s.pending>h&&(n.adler=Ua(n.adler,s.pending_buf,s.pending-h,h)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let l,h=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>h&&(n.adler=Ua(n.adler,s.pending_buf,s.pending-h,h)),Ol(n),s.pending!==0)return s.last_flush=-1,oc;h=0}l=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,Ai(s,l)}while(l!==0);s.gzhead.hcrc&&s.pending>h&&(n.adler=Ua(n.adler,s.pending_buf,s.pending-h,h))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Ol(n),s.pending!==0))return s.last_flush=-1,oc;Ai(s,255&n.adler),Ai(s,n.adler>>8&255),n.adler=0}if(s.status=S_,Ol(n),s.pending!==0)return s.last_flush=-1,oc}if(n.avail_in!==0||s.lookahead!==0||i!==tg&&s.status!==pw){let l=s.level===0?uY(s,i):s.strategy===FO?((h,p)=>{let v;for(;;){if(h.lookahead===0&&(CS(h),h.lookahead===0)){if(p===tg)return 1;break}if(h.match_length=0,v=eg(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++,v&&(Pl(h,!1),h.strm.avail_out===0))return 1}return h.insert=0,p===pd?(Pl(h,!0),h.strm.avail_out===0?3:4):h.sym_next&&(Pl(h,!1),h.strm.avail_out===0)?1:2})(s,i):s.strategy===ETe?((h,p)=>{let v,y,S,b;const R=h.window;for(;;){if(h.lookahead<=E_){if(CS(h),h.lookahead<=E_&&p===tg)return 1;if(h.lookahead===0)break}if(h.match_length=0,h.lookahead>=3&&h.strstart>0&&(S=h.strstart-1,y=R[S],y===R[++S]&&y===R[++S]&&y===R[++S])){b=h.strstart+E_;do;while(y===R[++S]&&y===R[++S]&&y===R[++S]&&y===R[++S]&&y===R[++S]&&y===R[++S]&&y===R[++S]&&y===R[++S]&&S<b);h.match_length=E_-(b-S),h.match_length>h.lookahead&&(h.match_length=h.lookahead)}if(h.match_length>=3?(v=eg(h,1,h.match_length-3),h.lookahead-=h.match_length,h.strstart+=h.match_length,h.match_length=0):(v=eg(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++),v&&(Pl(h,!1),h.strm.avail_out===0))return 1}return h.insert=0,p===pd?(Pl(h,!0),h.strm.avail_out===0?3:4):h.sym_next&&(Pl(h,!1),h.strm.avail_out===0)?1:2})(s,i):gw[s.level].func(s,i);if(l!==3&&l!==4||(s.status=pw),l===1||l===3)return n.avail_out===0&&(s.last_flush=-1),oc;if(l===2&&(i===mTe?pTe(s):i!==sY&&(FU(s,0,0,!1),i===gTe&&(ng(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Ol(n),n.avail_out===0))return s.last_flush=-1,oc}return i!==pd?oc:s.wrap<=0?oY:(s.wrap===2?(Ai(s,255&n.adler),Ai(s,n.adler>>8&255),Ai(s,n.adler>>16&255),Ai(s,n.adler>>24&255),Ai(s,255&n.total_in),Ai(s,n.total_in>>8&255),Ai(s,n.total_in>>16&255),Ai(s,n.total_in>>24&255)):(mw(s,n.adler>>>16),mw(s,65535&n.adler)),Ol(n),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?oc:oY)},PTe=(n,i)=>{let s=i.length;if(vw(n))return Xh;const c=n.state,l=c.wrap;if(l===2||l===1&&c.status!==wS||c.lookahead)return Xh;if(l===1&&(n.adler=fw(n.adler,i,s,0)),c.wrap=0,s>=c.w_size){l===0&&(ng(c.head),c.strstart=0,c.block_start=0,c.insert=0);let y=new Uint8Array(c.w_size);y.set(i.subarray(s-c.w_size,s),0),i=y,s=c.w_size}const h=n.avail_in,p=n.next_in,v=n.input;for(n.avail_in=s,n.next_in=0,n.input=i,CS(c);c.lookahead>=3;){let y=c.strstart,S=c.lookahead-2;do c.ins_h=rg(c,c.ins_h,c.window[y+3-1]),c.prev[y&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=y,y++;while(--S);c.strstart=y,c.lookahead=2,CS(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=2,c.match_available=0,n.next_in=p,n.input=v,n.avail_in=h,c.wrap=l,oc},_w={deflateInit:(n,i)=>hY(n,i,jO,15,8,TTe),deflateInit2:hY,deflateReset:dY,deflateResetKeep:lY,deflateSetHeader:(n,i)=>vw(n)||n.state.wrap!==2?Xh:(n.state.gzhead=i,oc),deflate:OTe,deflateEnd:n=>{if(vw(n))return Xh;const i=n.state.status;return n.state=null,i===S_?T_(n,vTe):oc},deflateSetDictionary:PTe,deflateInfo:"pako deflate (from Nodeca project)"};const NTe=(n,i)=>Object.prototype.hasOwnProperty.call(n,i);var BO={assign:function(n){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const s=i.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const c in s)NTe(s,c)&&(n[c]=s[c])}}return n},flattenChunks:n=>{let i=0;for(let c=0,l=n.length;c<l;c++)i+=n[c].length;const s=new Uint8Array(i);for(let c=0,l=0,h=n.length;c<h;c++){let p=n[c];s.set(p,l),l+=p.length}return s}};let fY=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{fY=!1}const yw=new Uint8Array(256);for(let n=0;n<256;n++)yw[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;yw[254]=yw[254]=1;var Ew={string2buf:n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let i,s,c,l,h,p=n.length,v=0;for(l=0;l<p;l++)s=n.charCodeAt(l),(64512&s)==55296&&l+1<p&&(c=n.charCodeAt(l+1),(64512&c)==56320&&(s=65536+(s-55296<<10)+(c-56320),l++)),v+=s<128?1:s<2048?2:s<65536?3:4;for(i=new Uint8Array(v),h=0,l=0;h<v;l++)s=n.charCodeAt(l),(64512&s)==55296&&l+1<p&&(c=n.charCodeAt(l+1),(64512&c)==56320&&(s=65536+(s-55296<<10)+(c-56320),l++)),s<128?i[h++]=s:s<2048?(i[h++]=192|s>>>6,i[h++]=128|63&s):s<65536?(i[h++]=224|s>>>12,i[h++]=128|s>>>6&63,i[h++]=128|63&s):(i[h++]=240|s>>>18,i[h++]=128|s>>>12&63,i[h++]=128|s>>>6&63,i[h++]=128|63&s);return i},buf2string:(n,i)=>{const s=i||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,i));let c,l;const h=new Array(2*s);for(l=0,c=0;c<s;){let p=n[c++];if(p<128){h[l++]=p;continue}let v=yw[p];if(v>4)h[l++]=65533,c+=v-1;else{for(p&=v===2?31:v===3?15:7;v>1&&c<s;)p=p<<6|63&n[c++],v--;v>1?h[l++]=65533:p<65536?h[l++]=p:(p-=65536,h[l++]=55296|p>>10&1023,h[l++]=56320|1023&p)}}return((p,v)=>{if(v<65534&&p.subarray&&fY)return String.fromCharCode.apply(null,p.length===v?p:p.subarray(0,v));let y="";for(let S=0;S<v;S++)y+=String.fromCharCode(p[S]);return y})(h,l)},utf8border:(n,i)=>{(i=i||n.length)>n.length&&(i=n.length);let s=i-1;for(;s>=0&&(192&n[s])==128;)s--;return s<0||s===0?i:s+yw[n[s]]>i?s:i}},pY=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const mY=Object.prototype.toString,{Z_NO_FLUSH:DTe,Z_SYNC_FLUSH:LTe,Z_FULL_FLUSH:xTe,Z_FINISH:MTe,Z_OK:WO,Z_STREAM_END:UTe,Z_DEFAULT_COMPRESSION:VTe,Z_DEFAULT_STRATEGY:FTe,Z_DEFLATED:jTe}=VO;function zO(n){this.options=BO.assign({level:VTe,method:jTe,chunkSize:16384,windowBits:15,memLevel:8,strategy:FTe},n||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new pY,this.strm.avail_out=0;let s=_w.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(s!==WO)throw new Error(y_[s]);if(i.header&&_w.deflateSetHeader(this.strm,i.header),i.dictionary){let c;if(c=typeof i.dictionary=="string"?Ew.string2buf(i.dictionary):mY.call(i.dictionary)==="[object ArrayBuffer]"?new Uint8Array(i.dictionary):i.dictionary,s=_w.deflateSetDictionary(this.strm,c),s!==WO)throw new Error(y_[s]);this._dict_set=!0}}function BTe(n,i){const s=new zO(i);if(s.push(n,!0),s.err)throw s.msg||y_[s.err];return s.result}zO.prototype.push=function(n,i){const s=this.strm,c=this.options.chunkSize;let l,h;if(this.ended)return!1;for(h=i===~~i?i:i===!0?MTe:DTe,typeof n=="string"?s.input=Ew.string2buf(n):mY.call(n)==="[object ArrayBuffer]"?s.input=new Uint8Array(n):s.input=n,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(c),s.next_out=0,s.avail_out=c),(h===LTe||h===xTe)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(l=_w.deflate(s,h),l===UTe)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),l=_w.deflateEnd(this.strm),this.onEnd(l),this.ended=!0,l===WO;if(s.avail_out!==0){if(h>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},zO.prototype.onData=function(n){this.chunks.push(n)},zO.prototype.onEnd=function(n){n===WO&&(this.result=BO.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var WTe={deflate:BTe};const GO=16209;var zTe=function(n,i){let s,c,l,h,p,v,y,S,b,R,O,N,Y,W,H,ne,re,me,be,we,Se,Le,et,mt;const Et=n.state;s=n.next_in,et=n.input,c=s+(n.avail_in-5),l=n.next_out,mt=n.output,h=l-(i-n.avail_out),p=l+(n.avail_out-257),v=Et.dmax,y=Et.wsize,S=Et.whave,b=Et.wnext,R=Et.window,O=Et.hold,N=Et.bits,Y=Et.lencode,W=Et.distcode,H=(1<<Et.lenbits)-1,ne=(1<<Et.distbits)-1;e:do{N<15&&(O+=et[s++]<<N,N+=8,O+=et[s++]<<N,N+=8),re=Y[O&H];t:for(;;){if(me=re>>>24,O>>>=me,N-=me,me=re>>>16&255,me===0)mt[l++]=65535&re;else{if(!(16&me)){if((64&me)==0){re=Y[(65535&re)+(O&(1<<me)-1)];continue t}if(32&me){Et.mode=16191;break e}n.msg="invalid literal/length code",Et.mode=GO;break e}be=65535&re,me&=15,me&&(N<me&&(O+=et[s++]<<N,N+=8),be+=O&(1<<me)-1,O>>>=me,N-=me),N<15&&(O+=et[s++]<<N,N+=8,O+=et[s++]<<N,N+=8),re=W[O&ne];n:for(;;){if(me=re>>>24,O>>>=me,N-=me,me=re>>>16&255,!(16&me)){if((64&me)==0){re=W[(65535&re)+(O&(1<<me)-1)];continue n}n.msg="invalid distance code",Et.mode=GO;break e}if(we=65535&re,me&=15,N<me&&(O+=et[s++]<<N,N+=8,N<me&&(O+=et[s++]<<N,N+=8)),we+=O&(1<<me)-1,we>v){n.msg="invalid distance too far back",Et.mode=GO;break e}if(O>>>=me,N-=me,me=l-h,we>me){if(me=we-me,me>S&&Et.sane){n.msg="invalid distance too far back",Et.mode=GO;break e}if(Se=0,Le=R,b===0){if(Se+=y-me,me<be){be-=me;do mt[l++]=R[Se++];while(--me);Se=l-we,Le=mt}}else if(b<me){if(Se+=y+b-me,me-=b,me<be){be-=me;do mt[l++]=R[Se++];while(--me);if(Se=0,b<be){me=b,be-=me;do mt[l++]=R[Se++];while(--me);Se=l-we,Le=mt}}}else if(Se+=b-me,me<be){be-=me;do mt[l++]=R[Se++];while(--me);Se=l-we,Le=mt}for(;be>2;)mt[l++]=Le[Se++],mt[l++]=Le[Se++],mt[l++]=Le[Se++],be-=3;be&&(mt[l++]=Le[Se++],be>1&&(mt[l++]=Le[Se++]))}else{Se=l-we;do mt[l++]=mt[Se++],mt[l++]=mt[Se++],mt[l++]=mt[Se++],be-=3;while(be>2);be&&(mt[l++]=mt[Se++],be>1&&(mt[l++]=mt[Se++]))}break}}break}}while(s<c&&l<p);be=N>>3,s-=be,N-=be<<3,O&=(1<<N)-1,n.next_in=s,n.next_out=l,n.avail_in=s<c?c-s+5:5-(s-c),n.avail_out=l<p?p-l+257:257-(l-p),Et.hold=O,Et.bits=N};const HO=15,GTe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),HTe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),KTe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),qTe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Sw=(n,i,s,c,l,h,p,v)=>{const y=v.bits;let S,b,R,O,N,Y,W=0,H=0,ne=0,re=0,me=0,be=0,we=0,Se=0,Le=0,et=0,mt=null;const Et=new Uint16Array(16),xn=new Uint16Array(16);let Mn,Lr,Vi,wi=null;for(W=0;W<=HO;W++)Et[W]=0;for(H=0;H<c;H++)Et[i[s+H]]++;for(me=y,re=HO;re>=1&&Et[re]===0;re--);if(me>re&&(me=re),re===0)return l[h++]=20971520,l[h++]=20971520,v.bits=1,0;for(ne=1;ne<re&&Et[ne]===0;ne++);for(me<ne&&(me=ne),Se=1,W=1;W<=HO;W++)if(Se<<=1,Se-=Et[W],Se<0)return-1;if(Se>0&&(n===0||re!==1))return-1;for(xn[1]=0,W=1;W<HO;W++)xn[W+1]=xn[W]+Et[W];for(H=0;H<c;H++)i[s+H]!==0&&(p[xn[i[s+H]]++]=H);if(n===0?(mt=wi=p,Y=20):n===1?(mt=GTe,wi=HTe,Y=257):(mt=KTe,wi=qTe,Y=0),et=0,H=0,W=ne,N=h,be=me,we=0,R=-1,Le=1<<me,O=Le-1,n===1&&Le>852||n===2&&Le>592)return 1;for(;;){Mn=W-we,p[H]+1<Y?(Lr=0,Vi=p[H]):p[H]>=Y?(Lr=wi[p[H]-Y],Vi=mt[p[H]-Y]):(Lr=96,Vi=0),S=1<<W-we,b=1<<be,ne=b;do b-=S,l[N+(et>>we)+b]=Mn<<24|Lr<<16|Vi|0;while(b!==0);for(S=1<<W-1;et&S;)S>>=1;if(S!==0?(et&=S-1,et+=S):et=0,H++,--Et[W]==0){if(W===re)break;W=i[s+p[H]]}if(W>me&&(et&O)!==R){for(we===0&&(we=me),N+=ne,be=W-we,Se=1<<be;be+we<re&&(Se-=Et[be+we],!(Se<=0));)be++,Se<<=1;if(Le+=1<<be,n===1&&Le>852||n===2&&Le>592)return 1;R=et&O,l[R]=me<<24|be<<16|N-h|0}}return et!==0&&(l[N+et]=W-we<<24|64<<16|0),v.bits=me,0};const{Z_FINISH:gY,Z_BLOCK:$Te,Z_TREES:KO,Z_OK:b_,Z_STREAM_END:YTe,Z_NEED_DICT:XTe,Z_STREAM_ERROR:md,Z_DATA_ERROR:vY,Z_MEM_ERROR:_Y,Z_BUF_ERROR:JTe,Z_DEFLATED:yY}=VO,qO=16180,$O=16190,Sp=16191,GU=16192,HU=16194,YO=16199,XO=16200,KU=16206,Vs=16209,EY=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function QTe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const w_=n=>{if(!n)return 1;const i=n.state;return!i||i.strm!==n||i.mode<qO||i.mode>16211?1:0},SY=n=>{if(w_(n))return md;const i=n.state;return n.total_in=n.total_out=i.total=0,n.msg="",i.wrap&&(n.adler=1&i.wrap),i.mode=qO,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,b_},TY=n=>{if(w_(n))return md;const i=n.state;return i.wsize=0,i.whave=0,i.wnext=0,SY(n)},bY=(n,i)=>{let s;if(w_(n))return md;const c=n.state;return i<0?(s=0,i=-i):(s=5+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?md:(c.window!==null&&c.wbits!==i&&(c.window=null),c.wrap=s,c.wbits=i,TY(n))},wY=(n,i)=>{if(!n)return md;const s=new QTe;n.state=s,s.strm=n,s.window=null,s.mode=qO;const c=bY(n,i);return c!==b_&&(n.state=null),c};let qU,$U,CY=!0;const ZTe=n=>{if(CY){qU=new Int32Array(512),$U=new Int32Array(32);let i=0;for(;i<144;)n.lens[i++]=8;for(;i<256;)n.lens[i++]=9;for(;i<280;)n.lens[i++]=7;for(;i<288;)n.lens[i++]=8;for(Sw(1,n.lens,0,288,qU,0,n.work,{bits:9}),i=0;i<32;)n.lens[i++]=5;Sw(2,n.lens,0,32,$U,0,n.work,{bits:5}),CY=!1}n.lencode=qU,n.lenbits=9,n.distcode=$U,n.distbits=5},RY=(n,i,s,c)=>{let l;const h=n.state;return h.window===null&&(h.wsize=1<<h.wbits,h.wnext=0,h.whave=0,h.window=new Uint8Array(h.wsize)),c>=h.wsize?(h.window.set(i.subarray(s-h.wsize,s),0),h.wnext=0,h.whave=h.wsize):(l=h.wsize-h.wnext,l>c&&(l=c),h.window.set(i.subarray(s-c,s-c+l),h.wnext),(c-=l)?(h.window.set(i.subarray(s-c,s),0),h.wnext=c,h.whave=h.wsize):(h.wnext+=l,h.wnext===h.wsize&&(h.wnext=0),h.whave<h.wsize&&(h.whave+=l))),0};var e0e=(n,i)=>{let s,c,l,h,p,v,y,S,b,R,O,N,Y,W,H,ne,re,me,be,we,Se,Le,et=0;const mt=new Uint8Array(4);let Et,xn;const Mn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(w_(n)||!n.output||!n.input&&n.avail_in!==0)return md;s=n.state,s.mode===Sp&&(s.mode=GU),p=n.next_out,l=n.output,y=n.avail_out,h=n.next_in,c=n.input,v=n.avail_in,S=s.hold,b=s.bits,R=v,O=y,Le=b_;e:for(;;)switch(s.mode){case qO:if(s.wrap===0){s.mode=GU;break}for(;b<16;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}if(2&s.wrap&&S===35615){s.wbits===0&&(s.wbits=15),s.check=0,mt[0]=255&S,mt[1]=S>>>8&255,s.check=Ua(s.check,mt,2,0),S=0,b=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&S)<<8)+(S>>8))%31){n.msg="incorrect header check",s.mode=Vs;break}if((15&S)!==yY){n.msg="unknown compression method",s.mode=Vs;break}if(S>>>=4,b-=4,Se=8+(15&S),s.wbits===0&&(s.wbits=Se),Se>15||Se>s.wbits){n.msg="invalid window size",s.mode=Vs;break}s.dmax=1<<s.wbits,s.flags=0,n.adler=s.check=1,s.mode=512&S?16189:Sp,S=0,b=0;break;case 16181:for(;b<16;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}if(s.flags=S,(255&ga(s))!==yY){n.msg="unknown compression method",s.mode=Vs;break}if(57344&ga(s)){n.msg="unknown header flags set",s.mode=Vs;break}s.head&&(s.head.text=S>>8&1),512&ga(s)&&4&s.wrap&&(mt[0]=255&S,mt[1]=S>>>8&255,s.check=Ua(s.check,mt,2,0)),S=0,b=0,s.mode=16182;case 16182:for(;b<32;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}s.head&&(s.head.time=S),512&ga(s)&&4&s.wrap&&(mt[0]=255&S,mt[1]=S>>>8&255,mt[2]=S>>>16&255,mt[3]=S>>>24&255,s.check=Ua(s.check,mt,4,0)),S=0,b=0,s.mode=16183;case 16183:for(;b<16;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}s.head&&(s.head.xflags=255&S,s.head.os=S>>8),512&ga(s)&&4&s.wrap&&(mt[0]=255&S,mt[1]=S>>>8&255,s.check=Ua(s.check,mt,2,0)),S=0,b=0,s.mode=16184;case 16184:if(1024&ga(s)){for(;b<16;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}s.length=S,s.head&&(s.head.extra_len=S),512&ga(s)&&4&s.wrap&&(mt[0]=255&S,mt[1]=S>>>8&255,s.check=Ua(s.check,mt,2,0)),S=0,b=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&ga(s)&&(N=s.length,N>v&&(N=v),N&&(s.head&&(Se=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(c.subarray(h,h+N),Se)),512&ga(s)&&4&s.wrap&&(s.check=Ua(s.check,c,N,h)),v-=N,h+=N,s.length-=N),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&ga(s)){if(v===0)break e;N=0;do Se=c[h+N++],s.head&&Se&&s.length<65536&&(s.head.name+=String.fromCharCode(Se));while(Se&&N<v);if(512&ga(s)&&4&s.wrap&&(s.check=Ua(s.check,c,N,h)),v-=N,h+=N,Se)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&ga(s)){if(v===0)break e;N=0;do Se=c[h+N++],s.head&&Se&&s.length<65536&&(s.head.comment+=String.fromCharCode(Se));while(Se&&N<v);if(512&ga(s)&&4&s.wrap&&(s.check=Ua(s.check,c,N,h)),v-=N,h+=N,Se)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&ga(s)){for(;b<16;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}if(4&s.wrap&&S!==(65535&s.check)){n.msg="header crc mismatch",s.mode=Vs;break}S=0,b=0}s.head&&(s.head.hcrc=ga(s)>>9&1,s.head.done=!0),n.adler=s.check=0,s.mode=Sp;break;case 16189:for(;b<32;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}n.adler=s.check=EY(S),S=0,b=0,s.mode=$O;case $O:if(s.havedict===0)return n.next_out=p,n.avail_out=y,n.next_in=h,n.avail_in=v,s.hold=S,s.bits=b,XTe;n.adler=s.check=1,s.mode=Sp;case Sp:if(i===$Te||i===KO)break e;case GU:if(s.last){S>>>=7&b,b-=7&b,s.mode=KU;break}for(;b<3;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}switch(s.last=1&S,S>>>=1,b-=1,3&S){case 0:s.mode=16193;break;case 1:if(ZTe(s),s.mode=YO,i===KO){S>>>=2,b-=2;break e}break;case 2:s.mode=16196;break;case 3:n.msg="invalid block type",s.mode=Vs}S>>>=2,b-=2;break;case 16193:for(S>>>=7&b,b-=7&b;b<32;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}if((65535&S)!=(S>>>16^65535)){n.msg="invalid stored block lengths",s.mode=Vs;break}if(s.length=65535&S,S=0,b=0,s.mode=HU,i===KO)break e;case HU:s.mode=16195;case 16195:if(N=s.length,N){if(N>v&&(N=v),N>y&&(N=y),N===0)break e;l.set(c.subarray(h,h+N),p),v-=N,h+=N,y-=N,p+=N,s.length-=N;break}s.mode=Sp;break;case 16196:for(;b<14;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}if(s.nlen=257+(31&S),S>>>=5,b-=5,s.ndist=1+(31&S),S>>>=5,b-=5,s.ncode=4+(15&S),S>>>=4,b-=4,s.nlen>286||s.ndist>30){n.msg="too many length or distance symbols",s.mode=Vs;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;b<3;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}s.lens[Mn[s.have++]]=7&S,S>>>=3,b-=3}for(;s.have<19;)s.lens[Mn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,Et={bits:s.lenbits},Le=Sw(0,s.lens,0,19,s.lencode,0,s.work,Et),s.lenbits=Et.bits,Le){n.msg="invalid code lengths set",s.mode=Vs;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;et=s.lencode[S&(1<<s.lenbits)-1],H=et>>>24,ne=et>>>16&255,re=65535&et,!(H<=b);){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}if(re<16)S>>>=H,b-=H,s.lens[s.have++]=re;else{if(re===16){for(xn=H+2;b<xn;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}if(S>>>=H,b-=H,s.have===0){n.msg="invalid bit length repeat",s.mode=Vs;break}Se=s.lens[s.have-1],N=3+(3&S),S>>>=2,b-=2}else if(re===17){for(xn=H+3;b<xn;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}S>>>=H,b-=H,Se=0,N=3+(7&S),S>>>=3,b-=3}else{for(xn=H+7;b<xn;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}S>>>=H,b-=H,Se=0,N=11+(127&S),S>>>=7,b-=7}if(s.have+N>s.nlen+s.ndist){n.msg="invalid bit length repeat",s.mode=Vs;break}for(;N--;)s.lens[s.have++]=Se}}if(s.mode===Vs)break;if(s.lens[256]===0){n.msg="invalid code -- missing end-of-block",s.mode=Vs;break}if(s.lenbits=9,Et={bits:s.lenbits},Le=Sw(1,s.lens,0,s.nlen,s.lencode,0,s.work,Et),s.lenbits=Et.bits,Le){n.msg="invalid literal/lengths set",s.mode=Vs;break}if(s.distbits=6,s.distcode=s.distdyn,Et={bits:s.distbits},Le=Sw(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,Et),s.distbits=Et.bits,Le){n.msg="invalid distances set",s.mode=Vs;break}if(s.mode=YO,i===KO)break e;case YO:s.mode=XO;case XO:if(v>=6&&y>=258){n.next_out=p,n.avail_out=y,n.next_in=h,n.avail_in=v,s.hold=S,s.bits=b,zTe(n,O),p=n.next_out,l=n.output,y=n.avail_out,h=n.next_in,c=n.input,v=n.avail_in,S=s.hold,b=s.bits,s.mode===Sp&&(s.back=-1);break}for(s.back=0;et=s.lencode[S&(1<<s.lenbits)-1],H=et>>>24,ne=et>>>16&255,re=65535&et,!(H<=b);){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}if(ne&&(240&ne)==0){for(me=H,be=ne,we=re;et=s.lencode[we+((S&(1<<me+be)-1)>>me)],H=et>>>24,ne=et>>>16&255,re=65535&et,!(me+H<=b);){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}S>>>=me,b-=me,s.back+=me}if(S>>>=H,b-=H,s.back+=H,s.length=re,ne===0){s.mode=16205;break}if(32&ne){s.back=-1,s.mode=Sp;break}if(64&ne){n.msg="invalid literal/length code",s.mode=Vs;break}s.extra=15&ne,s.mode=16201;case 16201:if(s.extra){for(xn=s.extra;b<xn;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}s.length+=S&(1<<s.extra)-1,S>>>=s.extra,b-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;et=s.distcode[S&(1<<s.distbits)-1],H=et>>>24,ne=et>>>16&255,re=65535&et,!(H<=b);){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}if((240&ne)==0){for(me=H,be=ne,we=re;et=s.distcode[we+((S&(1<<me+be)-1)>>me)],H=et>>>24,ne=et>>>16&255,re=65535&et,!(me+H<=b);){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}S>>>=me,b-=me,s.back+=me}if(S>>>=H,b-=H,s.back+=H,64&ne){n.msg="invalid distance code",s.mode=Vs;break}s.offset=re,s.extra=15&ne,s.mode=16203;case 16203:if(s.extra){for(xn=s.extra;b<xn;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}s.offset+=S&(1<<s.extra)-1,S>>>=s.extra,b-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){n.msg="invalid distance too far back",s.mode=Vs;break}s.mode=16204;case 16204:if(y===0)break e;if(N=O-y,s.offset>N){if(N=s.offset-N,N>s.whave&&s.sane){n.msg="invalid distance too far back",s.mode=Vs;break}N>s.wnext?(N-=s.wnext,Y=s.wsize-N):Y=s.wnext-N,N>s.length&&(N=s.length),W=s.window}else W=l,Y=p-s.offset,N=s.length;N>y&&(N=y),y-=N,s.length-=N;do l[p++]=W[Y++];while(--N);s.length===0&&(s.mode=XO);break;case 16205:if(y===0)break e;l[p++]=s.length,y--,s.mode=XO;break;case KU:if(s.wrap){for(;b<32;){if(v===0)break e;v--,S|=c[h++]<<b,b+=8}if(O-=y,n.total_out+=O,s.total+=O,4&s.wrap&&O&&(n.adler=s.check=ga(s)?Ua(s.check,l,O,p-O):fw(s.check,l,O,p-O)),O=y,4&s.wrap&&(ga(s)?S:EY(S))!==s.check){n.msg="incorrect data check",s.mode=Vs;break}S=0,b=0}s.mode=16207;case 16207:if(s.wrap&&ga(s)){for(;b<32;){if(v===0)break e;v--,S+=c[h++]<<b,b+=8}if(4&s.wrap&&S!==(4294967295&s.total)){n.msg="incorrect length check",s.mode=Vs;break}S=0,b=0}s.mode=16208;case 16208:Le=YTe;break e;case Vs:Le=vY;break e;case 16210:return _Y;default:return md}return n.next_out=p,n.avail_out=y,n.next_in=h,n.avail_in=v,s.hold=S,s.bits=b,(s.wsize||O!==n.avail_out&&s.mode<Vs&&(s.mode<KU||i!==gY))&&RY(n,n.output,n.next_out,O-n.avail_out),R-=n.avail_in,O-=n.avail_out,n.total_in+=R,n.total_out+=O,s.total+=O,4&s.wrap&&O&&(n.adler=s.check=ga(s)?Ua(s.check,l,O,n.next_out-O):fw(s.check,l,O,n.next_out-O)),n.data_type=s.bits+(s.last?64:0)+(s.mode===Sp?128:0)+(s.mode===YO||s.mode===HU?256:0),(R===0&&O===0||i===gY)&&Le===b_&&(Le=JTe),Le},Tp={inflateReset:TY,inflateReset2:bY,inflateResetKeep:SY,inflateInit:n=>wY(n,15),inflateInit2:wY,inflate:e0e,inflateEnd:n=>{if(w_(n))return md;let i=n.state;return i.window&&(i.window=null),n.state=null,b_},inflateGetHeader:(n,i)=>{if(w_(n))return md;const s=n.state;return(2&s.wrap)==0?md:(s.head=i,i.done=!1,b_)},inflateSetDictionary:(n,i)=>{const s=i.length;let c,l,h;return w_(n)?md:(c=n.state,c.wrap!==0&&c.mode!==$O?md:c.mode===$O&&(l=1,l=fw(l,i,s,0),l!==c.check)?vY:(h=RY(n,i,s,s),h?(c.mode=16210,_Y):(c.havedict=1,b_)))},inflateInfo:"pako inflate (from Nodeca project)"},t0e=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const IY=Object.prototype.toString,{Z_NO_FLUSH:n0e,Z_FINISH:r0e,Z_OK:Tw,Z_STREAM_END:YU,Z_NEED_DICT:XU,Z_STREAM_ERROR:i0e,Z_DATA_ERROR:AY,Z_MEM_ERROR:s0e}=VO;function JO(n){this.options=BO.assign({chunkSize:65536,windowBits:15,to:""},n||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||n&&n.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(15&i.windowBits)==0&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new pY,this.strm.avail_out=0;let s=Tp.inflateInit2(this.strm,i.windowBits);if(s!==Tw)throw new Error(y_[s]);if(this.header=new t0e,Tp.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=Ew.string2buf(i.dictionary):IY.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(s=Tp.inflateSetDictionary(this.strm,i.dictionary),s!==Tw)))throw new Error(y_[s])}function o0e(n,i){const s=new JO(i);if(s.push(n),s.err)throw s.msg||y_[s.err];return s.result}JO.prototype.push=function(n,i){const s=this.strm,c=this.options.chunkSize,l=this.options.dictionary;let h,p,v;if(this.ended)return!1;for(p=i===~~i?i:i===!0?r0e:n0e,IY.call(n)==="[object ArrayBuffer]"?s.input=new Uint8Array(n):s.input=n,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(c),s.next_out=0,s.avail_out=c),h=Tp.inflate(s,p),h===XU&&l&&(h=Tp.inflateSetDictionary(s,l),h===Tw?h=Tp.inflate(s,p):h===AY&&(h=XU));s.avail_in>0&&h===YU&&s.state.wrap>0&&n[s.next_in]!==0;)Tp.inflateReset(s),h=Tp.inflate(s,p);switch(h){case i0e:case AY:case XU:case s0e:return this.onEnd(h),this.ended=!0,!1}if(v=s.avail_out,s.next_out&&(s.avail_out===0||h===YU))if(this.options.to==="string"){let y=Ew.utf8border(s.output,s.next_out),S=s.next_out-y,b=Ew.buf2string(s.output,y);s.next_out=S,s.avail_out=c-S,S&&s.output.set(s.output.subarray(y,y+S),0),this.onData(b)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(h!==Tw||v!==0){if(h===YU)return h=Tp.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},JO.prototype.onData=function(n){this.chunks.push(n)},JO.prototype.onEnd=function(n){n===Tw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=BO.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var a0e={inflate:o0e};const{deflate:c0e}=WTe,{inflate:u0e}=a0e;var l0e=c0e,d0e=u0e,kY=function(n){return n[n.ONE_BYTE=0]="ONE_BYTE",n[n.TWO_BYTE=1]="TWO_BYTE",n}(kY||{});class h0e{constructor(){ee(this,"_sequence",0),ee(this,"_startTime",Date.now()),ee(this,"isUseOneByte",!0)}get startTime(){const i=Date.now()-this._startTime;return i<Math.pow(2,16)?i:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(i){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:i};if(i.byteLength>128){const v=new Uint8Array(4);v.set([1,0,0,0]);const y={id:0,length:4,data:v.buffer},S={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[y]};s.commonPacketHeader.extension=1,s.extension=S,s.payload=this.compress(i),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;le("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const c=new ArrayBuffer(s.commonPacketHeader.length),l=new Uint8Array(c),h=new DataView(c);let p=0;if(h.setUint16(p,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),p+=2,h.setUint32(p,s.commonPacketHeader.sequence,!0),p+=4,h.setUint16(p,s.commonStreamHeader,!0),p+=2,s.extension){const v=this.serializeExtension(s.extension);l.set(new Uint8Array(v),p),p+=v.byteLength}if(l.set(new Uint8Array(s.payload),p),p+=s.payload.byteLength,p!==s.commonPacketHeader.length)throw Error("serialize error!");return c}deserialize(i){if(i.byteLength<4)return new ArrayBuffer(0);const s=new DataView(i);let c=0;const l=s.getUint16(c,!0);c+=2;const h={length:16383&l,reserved:(16384&l)>>14,extension:(32768&l)>>15,sequence:s.getUint16(c+2,!0)<<16|s.getUint16(c,!0)};let p,v;if(c+=4,le("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(h))),s.getUint16(c,!0),c+=2,h.extension){v=this.deserializeExtension(i.slice(c)),c+=2+v.length,p=i.slice(c);let y=!1;if(v.datas.length>0){const S=v.datas.find(b=>b.id===0);S&&(y=(1&new DataView(S.data).getUint32(0,!0))==1)}p=y?this.decompress(p):p}else p=i.slice(8);return p}serializeExtension(i){const{profile:s,length:c,datas:l}=i,h=new ArrayBuffer(c+2),p=new Uint8Array(h),v=new DataView(h);let y=0;if(v.setUint8(y++,s),v.setUint8(y++,c),l.forEach(S=>{s?(v.setUint8(y++,S.id),v.setUint8(y++,S.length),p.set(new Uint8Array(S.data),y),y+=S.data.byteLength):(v.setUint8(y++,S.id|S.length<<4),p.set(new Uint8Array(S.data),y),y+=S.data.byteLength)}),y!==c+2)throw Error("serialize extension error, is ".concat(y,"!==").concat(c+2));return h}deserializeExtension(i){const s=new DataView(i);let c=0;const l=s.getUint8(c);c++;const h=s.getUint8(c);c++;const p=l===kY.TWO_BYTE,v=[],y=new DataView(i,2);let S=0;for(;S<h;){let b=0,R=0,O=new ArrayBuffer(0);p?(b=y.getUint8(S),S++,R=y.getUint8(S),S++):(b=15&y.getUint8(S),R=y.getUint8(S)>>4,S++),R>0&&(O=y.buffer.slice(S+2,S+2+R),S+=O.byteLength),v.push({id:b,length:R,data:O})}if(S!==h)throw Error("parse error");return{profile:l,length:h,datas:v}}decompress(i){return d0e(new Uint8Array(i))}compress(i){return l0e(new Uint8Array(i))}}const f0e={name:"DataStream",create:(n,i)=>{const s=i?new EEe(n):new SEe(n);return s.useDataStream(new h0e),s}};class p0e extends li{constructor(i,s,c){super(),ee(this,"ws",void 0),ee(this,"requestId",1),ee(this,"heartBeatTimer",void 0),ee(this,"joinInfo",void 0),ee(this,"clientId",void 0),ee(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),ee(this,"onClose",l=>{this.emit("close"),this.dispose()}),ee(this,"onMessage",l=>{const h=JSON.parse(l.data);if(!h||h.command!=="serverResponse"||!h.requestId)return h&&h.command==="serverStatus"&&h.serverStatus&&h.serverStatus.command?(this.emit("status",h.serverStatus),void this.emit(h.serverStatus.command,h.serverStatus)):void 0;this.emit("req_".concat(h.requestId),h)}),this.joinInfo=i,this.clientId=s,this.ws=new $b("cross-channel-".concat(this.clientId),c),this.ws.on(un.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(un.CONNECTED,this.onOpen),this.ws.on(un.ON_MESSAGE,this.onMessage),this.ws.on(un.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(i){const s=this.requestId++;return i.requestId=s,i.seq=s,this.ws.sendMessage(i),s}waitStatus(i){return new pt((s,c)=>{const l=window.setTimeout(()=>{c(new Pe(ie.TIMEOUT,"wait status timeout, status: ".concat(i)))},5e3);this.once(i,h=>{window.clearTimeout(l),h.state&&h.state!==0?c(new Pe(ie.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(i))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(l),c(new Pe(ie.WS_ABORT))})})}async request(i){if(this.ws.state==="closed")throw new Pe(ie.WS_DISCONNECT);const s=()=>new pt((p,v)=>{this.ws.once(un.CLOSED,()=>v(new Pe(ie.WS_ABORT))),this.ws.once(un.CONNECTED,p)});this.ws.state!=="connected"&&await s();const c=this.sendMessage(i),l=new pt((p,v)=>{const y=()=>{v(new Pe(ie.WS_ABORT))};this.ws.once(un.RECONNECTING,y),this.ws.once(un.CLOSED,y),this.once("req_".concat(c),p),$s(3e3).then(()=>{this.removeAllListeners("req_".concat(c)),this.ws.off(un.RECONNECTING,y),this.ws.off(un.CLOSED,y),v(new Pe(ie.TIMEOUT,"cross channel ws request timeout"))})}),h=await l;if(!h||h.code!==200)throw new Pe(ie.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h}async connect(i){this.ws.removeAllListeners(un.REQUEST_NEW_URLS),this.ws.on(un.REQUEST_NEW_URLS,s=>{s(i)}),await this.ws.init(i)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(i){const s=this.requestId++;return i.requestId=s,this.ws.sendMessage(i),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class m0e extends li{set state(i){i!==this._state&&(i!==Dc.RELAY_STATE_FAILURE&&(this.errorCode=lS.RELAY_OK),this.emit("state",i,this.errorCode),this._state=i)}get state(){return this._state}constructor(i,s,c,l,h){super(),ee(this,"joinInfo",void 0),ee(this,"sid",void 0),ee(this,"clientId",void 0),ee(this,"cancelToken",tc.CancelToken.source()),ee(this,"workerToken",void 0),ee(this,"requestId",0),ee(this,"signal",void 0),ee(this,"prevChannelMediaConfig",void 0),ee(this,"httpRetryConfig",void 0),ee(this,"_resolution",void 0),ee(this,"_state",Dc.RELAY_STATE_IDLE),ee(this,"errorCode",lS.RELAY_OK),ee(this,"onStatus",p=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(p))),p&&p.command&&(p.command==="onAudioPacketReceived"&&this.emit("event",mp.PACKET_RECEIVED_AUDIO_FROM_SRC),p.command==="onVideoPacketReceived"&&this.emit("event",mp.PACKET_RECEIVED_VIDEO_FROM_SRC),p.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=lS.SRC_TOKEN_EXPIRED,this.state=Dc.RELAY_STATE_FAILURE),p.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=lS.DEST_TOKEN_EXPIRED,this.state=Dc.RELAY_STATE_FAILURE))}),ee(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",mp.NETWORK_DISCONNECTED),this.state=Dc.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(p=>{this.state!==Dc.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",p.toString()),this.errorCode=lS.SERVER_CONNECTION_LOST,this.state=Dc.RELAY_STATE_FAILURE)})}),this.joinInfo=i,this.clientId=s,this.sid=n_(),this.signal=new p0e(this.joinInfo,this.clientId,c),this.httpRetryConfig=l,this._resolution=h}async startChannelMediaRelay(i){if(this.state!==Dc.RELAY_STATE_IDLE)throw new Pe(ie.INVALID_OPERATION);this.state=Dc.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(i)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Pe(ie.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Pe(ie.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Pe(ie.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=i}async updateChannelMediaRelay(i){if(this.state!==Dc.RELAY_STATE_RUNNING)throw new Pe(ie.INVALID_OPERATION);await this.sendUpdateMessage(i),this.prevChannelMediaConfig=i}async setVideoProfile(i){if(this._resolution=i,this.state!==Dc.RELAY_STATE_RUNNING)throw new Pe(ie.INVALID_OPERATION);const s=this.genMessage(Ma.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Dc.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=tc.CancelToken.source(),this.state=Dc.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const i=await CSe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=i.workerToken,await this.signal.connect(i.addressList),this.emit("event",mp.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(i){const s=this.genMessage(Ma.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const c=this.genMessage(Ma.SetSdkProfile,i);await this.signal.request(c),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const l=this.genMessage(Ma.SetSourceChannel,i);await this.signal.request(l),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",mp.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=this.genMessage(Ma.SetSourceUserId,i);await this.signal.request(h),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const p=this.genMessage(Ma.SetDestChannel,i);await this.signal.request(p),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",mp.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const v=this.genMessage(Ma.StartPacketTransfer,i);await this.signal.request(v),this.emit("event",mp.PACKET_SENT_TO_DEST_CHANNEL),this.state=Dc.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(i){const s=this.genMessage(Ma.UpdateDestChannel,i);await this.signal.request(s),this.emit("event",mp.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const i=this.genMessage(Ma.StopPacketTransfer);await this.signal.request(i),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(i,s){const c=[],l=[],h=[];this.requestId+=1;const p={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Cl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};p.sdkVersion==="4.23.2"&&(p.sdkVersion="0.0.1");let v=null,y=null;switch(i){case Ma.SetSdkProfile:return p.clientRequest={command:"SetSdkProfile",type:"multi_channel"},p;case Ma.SetSourceChannel:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Pe(ie.UNEXPECTED_ERROR,"can not find source config");return p.clientRequest={command:"SetSourceChannel",uid:"0",channelName:y.channelName,token:y.token||this.joinInfo.appId},p;case Ma.SetSourceUserId:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Pe(ie.UNEXPECTED_ERROR,"can not find source config");return p.clientRequest={command:"SetSourceUserId",uid:y.uid+""},p;case Ma.SetDestChannel:if(v=s&&s.getDestChannelMediaInfo(),!v)throw new Pe(ie.UNEXPECTED_ERROR,"can not find dest config");return v.forEach(S=>{c.push(S.channelName),l.push(S.uid+""),h.push(S.token||this.joinInfo.appId)}),p.clientRequest={command:"SetDestChannel",channelName:c,uid:l,token:h},p;case Ma.StartPacketTransfer:return p.clientRequest={command:"StartPacketTransfer"},p;case Ma.Reconnect:return p.clientRequest={command:"Reconnect"},p;case Ma.StopPacketTransfer:return p.clientRequest={command:"StopPacketTransfer"},p;case Ma.UpdateDestChannel:if(v=s&&s.getDestChannelMediaInfo(),!v)throw new Pe(ie.UNEXPECTED_ERROR,"can not find dest config");return v.forEach(S=>{c.push(S.channelName),l.push(S.uid+""),h.push(S.token||this.joinInfo.appId)}),p.clientRequest={command:"UpdateDestChannel",channelName:c,uid:l,token:h},p;case Ma.SetVideoProfile:p.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return p}}const g0e={name:"ChannelMediaRelay",create:function(n){return new m0e(n.joinInfo,n.clientId,n.websocketRetryConfig||ss,n.httpRetryConfig||ss,n.resolution)}};function OY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function bw(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?OY(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):OY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}class v0e extends li{constructor(i,s,c,l){super(),ee(this,"spec",void 0),ee(this,"token",void 0),ee(this,"websocket",void 0),ee(this,"pingpongTimer",void 0),ee(this,"reconnectMode","retry"),ee(this,"serviceMode",void 0),ee(this,"reqId",0),ee(this,"commandReqId",0),ee(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),ee(this,"handleWebSocketMessage",h=>{if(!h.data)return;const p=JSON.parse(h.data);p.requestId?this.emit("@".concat(p.requestId,"-").concat(p.sid),p):(kt.workerEvent(this.spec.sid,{actionType:"status",serverCode:p.code,workerType:this.serviceMode===pp.TRANSCODE?1:2}),this.emit(Gm.PUBLISH_STREAM_STATUS,p))}),this.spec=s,this.token=i,this.serviceMode=l,this.websocket=new $b("live-streaming",c),this.websocket.on(un.CONNECTED,this.handleWebSocketOpen),this.websocket.on(un.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(un.REQUEST_NEW_URLS,(h,p)=>{ho(this,Gm.REQUEST_NEW_ADDRESS).then(h).catch(p)}),this.websocket.on(un.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(i){return this.websocket.init(i)}async request(i,s,c,l){this.reqId+=1,i==="request"&&(this.commandReqId+=1);const h=this.commandReqId,p=this.reqId;if(!p||!this.websocket)throw new Pe(ie.UNEXPECTED_ERROR);const v=bw({command:i,sdkVersion:Cl==="4.23.2"?"0.0.1":Cl,seq:p,requestId:p,allocate:c,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Pe(ie.WS_DISCONNECT);const y=()=>new pt((O,N)=>{this.websocket.once(un.CLOSED,()=>N(new Pe(ie.WS_ABORT))),this.websocket.once(un.CONNECTED,O)});this.websocket.state!=="connected"&&await y(),v.clientRequest&&(v.clientRequest.workerToken=this.token);const S=new pt((O,N)=>{const Y=()=>{N(new Pe(ie.WS_ABORT))};this.websocket.once(un.RECONNECTING,Y),this.websocket.once(un.CLOSED,Y),this.once("@".concat(p,"-").concat(this.spec.sid),W=>{O(W)})});l&&kt.workerEvent(this.spec.sid,bw(bw({},l),{},{requestId:h,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const b=Date.now();this.websocket.sendMessage(v);let R=null;try{R=await S}catch(O){if(this.websocket.state==="closed")throw O;return await y(),await this.request(i,s,c)}return l&&kt.workerEvent(this.spec.sid,bw(bw({},l),{},{requestId:h,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-b})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const i=Cl==="4.23.2"?"0.0.1":Cl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:i,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(i){switch(i.code){case ps.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case ps.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ps.LIVE_STREAM_RESPONSE_BAD_STREAM:case ps.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Pe(ie.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:i.code}).throw();case ps.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(i.serverResponse.command==="UnpublishStream")return;throw new Pe(ie.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ps.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Pe(ie.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:i.code}).throw();case ps.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Pe(ie.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Gm.WARNING,s,i.serverResponse.url)}case ps.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Pe(ie.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Gm.WARNING,s,i.serverResponse.url)}case ps.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Pe(ie.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ps.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Pe(ie.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:i.code}).throw();case ps.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Pe(ie.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Gm.WARNING,s,i.serverResponse.url)}case ps.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Pe(ie.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code}).throw();case ps.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Pe(ie.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ps.LIVE_STREAM_RESPONSE_WORKER_LOST:case ps.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(i.serverResponse.command==="UnpublishStream")return;throw new Pe(ie.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ps.ERROR_FAIL_SEND_MESSAGE:if(i.serverResponse.command==="UnpublishStream")return;if(i.serverResponse.command==="UpdateTranscoding"||i.serverResponse.command==="ControlStream")return new Pe(ie.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:i.code}).throw();throw new Pe(ie.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ps.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ps.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ps.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ps.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Pe(ie.LIVE_STREAMING_CDN_ERROR,"",{code:i.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Vk)},6e3)}}function PY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function Lc(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?PY(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):PY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}class _0e extends li{constructor(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ss,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ss;super(),ee(this,"onLiveStreamWarning",void 0),ee(this,"onLiveStreamError",void 0),ee(this,"spec",void 0),ee(this,"retryTimeout",1e4),ee(this,"connection",void 0),ee(this,"httpRetryConfig",void 0),ee(this,"wsRetryConfig",void 0),ee(this,"streamingTasks",new Map),ee(this,"isStartingStreamingTask",!1),ee(this,"taskMutex",new Co("live-streaming")),ee(this,"cancelToken",tc.CancelToken.source()),ee(this,"transcodingConfig",void 0),ee(this,"uapResponse",void 0),ee(this,"lastTaskId",1),ee(this,"statusError",new Map),this.spec=i,this.httpRetryConfig=c,this.wsRetryConfig=s}async setTranscodingConfig(i){const s=Lc(Lc({},iSe),i);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(p=>Lc(Lc(Lc({},rSe),p),{},{zOrder:p.zOrder?p.zOrder+1:1}))),function(p){vi(p.width)||Tr(p.width,"config.width",0,1e4),vi(p.height)||Tr(p.height,"config.height",0,1e4),vi(p.videoBitrate)||Tr(p.videoBitrate,"config.videoBitrate",1,1e6),vi(p.videoFrameRate)||Tr(p.videoFrameRate,"config.videoFrameRate"),vi(p.lowLatency)||lp(p.lowLatency,"config.lowLatency"),vi(p.audioSampleRate)||vs(p.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),vi(p.audioBitrate)||Tr(p.audioBitrate,"config.audioBitrate",1,128),vi(p.audioChannels)||vs(p.audioChannels,"config.audioChannels",[1,2,3,4,5]),vi(p.videoGop)||Tr(p.videoGop,"config.videoGop"),vi(p.videoCodecProfile)||vs(p.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),vi(p.userCount)||Tr(p.userCount,"config.userCount",0,17),vi(p.backgroundColor)||Tr(p.backgroundColor,"config.backgroundColor",0,16777215),vi(p.userConfigExtraInfo)||qs(p.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),p.transcodingUsers&&!vi(p.transcodingUsers)&&(dp(p.transcodingUsers,"config.transcodingUsers"),p.transcodingUsers.forEach((v,y)=>{cO(v.uid),vi(v.x)||Tr(v.x,"transcodingUser[".concat(y,"].x"),0,1e4),vi(v.y)||Tr(v.y,"transcodingUser[".concat(y,"].y"),0,1e4),vi(v.width)||Tr(v.width,"transcodingUser[".concat(y,"].width"),0,1e4),vi(v.height)||Tr(v.height,"transcodingUser[".concat(y,"].height"),0,1e4),vi(v.zOrder)||Tr(v.zOrder-1,"transcodingUser[".concat(y,"].zOrder"),0,100),vi(v.alpha)||Tr(v.alpha,"transcodingUser[".concat(y,"].alpha"),0,1,!1)})),vi(p.watermark)||QM(p.watermark,"watermark"),vi(p.backgroundImage)||QM(p.backgroundImage,"backgroundImage"),p.images&&!vi(p.images)&&(dp(p.images,"config.images"),p.images.forEach((v,y)=>{QM(v,"images[".concat(y,"]"))}))}(s);const c=[];s.images&&c.push(...s.images.map(p=>Lc(Lc(Lc({},JM),p),{},{zOrder:255}))),s.backgroundImage&&(c.push(Lc(Lc(Lc({},JM),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(c.push(Lc(Lc(Lc({},JM),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=c,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(p=>Lc({},p)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const l=(s.userConfigs||[]).map(p=>typeof p.uid=="number"?pt.resolve(p.uid):Z3(p.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await pt.all(l)).forEach((p,v)=>{s.userConfigs&&s.userConfigs[v]&&(s.userConfigs[v].uid=p)}),this.transcodingConfig=s,this.connection)try{var h;const p=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Fu(h=this.streamingTasks).call(h)).map(v=>v.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(p.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(p){if(!p.data||!p.data.retry)throw p;p.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(v=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),p.toString(),"try to republish",v.url),this.startLiveStreamingTask(v.url,v.mode,p).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(v.url," success"))}).catch(y=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),v.url,y.toString()),this.onLiveStreamError&&this.onLiveStreamError(v.url,y)})})}}async startLiveStreamingTask(i,s,c){if(!this.transcodingConfig&&s===pp.TRANSCODE)throw new Pe(ie.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const l={command:"PublishStream",ts:Date.now(),url:i,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(i,", mode: ").concat(s));const h=await this.taskMutex.lock();if(!this.connection&&c)return void h();if(this.streamingTasks.get(i)&&!c)return h(),new Pe(ie.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(v){throw h(),v}switch(s){case pp.TRANSCODE:l.transcodingConfig=Lc({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(l.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const p=this.lastTaskId++;try{const v=new pt((S,b)=>{$s(this.retryTimeout).then(()=>{if(c)return b(c);const R=this.statusError.get(i);return R?(this.statusError.delete(i),b(R)):void 0})}),y=await pt.race([this.connection.request("request",{clientRequest:l},!0,{url:i,command:"PublishStream",workerType:s===pp.TRANSCODE?1:2,requestByUser:!c,tid:p.toString()}),v]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(y.code)),this.streamingTasks.set(i,{clientRequest:l,mode:s,url:i,taskId:p}),h()}catch(v){if(h(),this.isStartingStreamingTask=!1,!v.data||!v.data.retry||c)throw v;return v.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(i,s,v)):await this.startLiveStreamingTask(i,s,v)}}stopLiveStreamingTask(i){return new pt((s,c)=>{const l=this.streamingTasks.get(i);if(!l||!this.connection)return new Pe(ie.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const h=l.mode;l.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(i),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:l.url}},!1,{url:i,command:"UnPublishStream",workerType:h===pp.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(p=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(p.code)),this.streamingTasks.delete(i),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(c)})}resetAllTask(){var i;const s=Array.from(Fu(i=this.streamingTasks).call(i));this.terminate();for(const c of s)this.startLiveStreamingTask(c.url,c.mode).catch(l=>{this.onLiveStreamError&&this.onLiveStreamError(c.url,l)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=tc.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(i){if(this.connection)throw new Pe(ie.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await ho(this,ZM.REQUEST_WORKER_MANAGER_LIST,i);return this.uapResponse=s,this.connection=new v0e(s.workerToken,this.spec,this.wsRetryConfig,i),this.connection.on(Gm.WARNING,(c,l)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(l,c)),this.connection.on(Gm.PUBLISH_STREAM_STATUS,c=>this.handlePublishStreamServer(c)),this.connection.on(Gm.REQUEST_NEW_ADDRESS,(c,l)=>{if(!this.connection)return l(new Pe(ie.UNEXPECTED_ERROR,"can not get new live streaming address list"));ho(this,ZM.REQUEST_WORKER_MANAGER_LIST,i).then(h=>{this.uapResponse=h,c(h.addressList)}).catch(l)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(i){const s=i.serverStatus&&i.serverStatus.url||"empty_url",c=this.streamingTasks.get(s),l=i.reason;switch(i.code){case ps.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ps.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ps.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ps.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const p=new Pe(ie.LIVE_STREAMING_CDN_ERROR,"",{code:i.code});if(c)return x.error(p.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,p);if(!this.isStartingStreamingTask)return;this.statusError.set(s,p)}case ps.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const p=new Pe(ie.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,l);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,p)}case ps.LIVE_STREAM_RESPONSE_WORKER_LOST:case ps.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var h;if(!this.connection)return;this.connection.tryNextAddress();const p=Array.from(Fu(h=this.streamingTasks).call(h));for(const v of p)v.abortTask?v.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),i.code,"try to republish",v.url),this.startLiveStreamingTask(v.url,v.mode,new Pe(ie.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),v.url)}).catch(y=>{x.error(y.toString()),this.onLiveStreamError&&this.onLiveStreamError(v.url,y)}));return}}}hasUrl(i){return this.streamingTasks.has(i)}}const y0e={name:"LiveStreaming",create:function(n){return new _0e(n.joinInfo,n.websocketRetryConfig||ss,n.httpRetryConfig||ss)}};function E0e(n){let i=LY();return function(s,c){let l=s.appId;l!==void 0&&(mr(c,10),Zh(c,l));let h=s.cid;h!==void 0&&(mr(c,16),mr(c,h));let p=s.cname;p!==void 0&&(mr(c,26),Zh(c,p));let v=s.deviceId;v!==void 0&&(mr(c,34),Zh(c,v));let y=s.elapse;y!==void 0&&(mr(c,40),ig(c,y));let S=s.fileSize;S!==void 0&&(mr(c,48),ig(c,IS(S)));let b=s.height;b!==void 0&&(mr(c,56),ig(c,IS(b)));let R=s.jpg;R!==void 0&&(mr(c,66),mr(c,R.length),function(ac,Ge){let lt=AS(ac,Ge.length);ac.bytes.set(Ge,lt)}(c,R));let O=s.networkType;O!==void 0&&(mr(c,72),ig(c,IS(O)));let N=s.osType;N!==void 0&&(mr(c,80),ig(c,IS(N)));let Y=s.requestId;Y!==void 0&&(mr(c,90),Zh(c,Y));let W=s.sdkVersion;W!==void 0&&(mr(c,98),Zh(c,W));let H=s.sequence;H!==void 0&&(mr(c,104),ig(c,IS(H)));let ne=s.sid;ne!==void 0&&(mr(c,114),Zh(c,ne));let re=s.timestamp;re!==void 0&&(mr(c,120),ig(c,re));let me=s.uid;me!==void 0&&(mr(c,128),mr(c,me));let be=s.vid;be!==void 0&&(mr(c,136),mr(c,be));let we=s.width;we!==void 0&&(mr(c,144),ig(c,IS(we)));let Se=s.service;Se!==void 0&&(mr(c,152),mr(c,Se));let Le=s.callbackData;Le!==void 0&&(mr(c,162),Zh(c,Le));let et=s.jpgEncryption;et!==void 0&&(mr(c,168),mr(c,et));let mt=s.requestType;mt!==void 0&&(mr(c,176),mr(c,mt));let Et=s.scorePorn;Et!==void 0&&(mr(c,185),tV(c,Et));let xn=s.scoreSexy;xn!==void 0&&(mr(c,193),tV(c,xn));let Mn=s.scoreNeutral;Mn!==void 0&&(mr(c,201),tV(c,Mn));let Lr=s.scene;Lr!==void 0&&(mr(c,208),mr(c,Lr));let Vi=s.ossFilePrefix;Vi!==void 0&&(mr(c,218),Zh(c,Vi));let wi=s.serviceVendor;if(wi!==void 0)for(let ac of wi){mr(c,226);let Ge=LY();b0e(ac,Ge),mr(c,Ge.limit),I0e(c,Ge),R0e(Ge)}}(n,i),function(s){let c=s.bytes,l=s.limit;return c.length===l?c:c.subarray(0,l)}(i)}function S0e(n){return function(s){let c={};e:for(;!xY(s);){let l=ef(s);switch(l>>>3){case 0:break e;case 1:c.code=ef(s);break;case 2:c.msg=MY(s,ef(s));break;case 3:{let h=w0e(s);c.data=T0e(s),s.limit=h;break}default:NY(s,7&l)}}return c}({bytes:i=n,offset:0,limit:i.length});var i}function T0e(n){let i={};e:for(;!xY(n);){let s=ef(n);switch(s>>>3){case 0:break e;case 1:i.requestId=MY(n,ef(n));break;case 2:i.requestType=ef(n)>>>0;break;case 3:i.scorePorn=eV(n);break;case 4:i.scoreSexy=eV(n);break;case 5:i.scoreNeutral=eV(n);break;case 6:i.requestScene=ef(n)>>>0;break;case 7:i.scene=ef(n)>>>0;break;default:NY(n,7&s)}}return i}function b0e(n,i){let s=n.service;s!==void 0&&(mr(i,8),mr(i,s));let c=n.vendor;c!==void 0&&(mr(i,16),mr(i,c));let l=n.token;l!==void 0&&(mr(i,26),Zh(i,l));let h=n.callbackUrl;h!==void 0&&(mr(i,34),Zh(i,h))}function w0e(n){let i=ef(n),s=n.limit;return n.limit=n.offset+i,s}function NY(n,i){switch(i){case 0:for(;128&UY(n););break;case 2:QU(n,ef(n));break;case 5:QU(n,4);break;case 1:QU(n,8);break;default:throw new Error("Unimplemented type: "+i)}}let C0e=new Float32Array(1);new Uint8Array(C0e.buffer);let JU=new Float64Array(1),xc=new Uint8Array(JU.buffer);function IS(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let DY=[];function LY(){const n=DY.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}function R0e(n){DY.push(n)}function QU(n,i){if(n.offset+i>n.limit)throw new Error("Skip past limit");n.offset+=i}function xY(n){return n.offset>=n.limit}function AS(n,i){let s=n.bytes,c=n.offset,l=n.limit,h=c+i;if(h>s.length){let p=new Uint8Array(2*h);p.set(s),n.bytes=p}return n.offset=h,h>l&&(n.limit=h),c}function ZU(n,i){let s=n.offset;if(s+i>n.limit)throw new Error("Read past limit");return n.offset+=i,s}function MY(n,i){let s=ZU(n,i),c=String.fromCharCode,l=n.bytes,h="",p="";for(let v=0;v<i;v++){let y,S,b,R,O=l[v+s];(128&O)==0?p+=c(O):(224&O)==192?v+1>=i?p+=h:(y=l[v+s+1],(192&y)!=128?p+=h:(R=(31&O)<<6|63&y,R<128?p+=h:(p+=c(R),v++))):(240&O)==224?v+2>=i?p+=h:(y=l[v+s+1],S=l[v+s+2],(49344&(y|S<<8))!=32896?p+=h:(R=(15&O)<<12|(63&y)<<6|63&S,R<2048||R>=55296&&R<=57343?p+=h:(p+=c(R),v+=2))):(248&O)==240?v+3>=i?p+=h:(y=l[v+s+1],S=l[v+s+2],b=l[v+s+3],(12632256&(y|S<<8|b<<16))!=8421504?p+=h:(R=(7&O)<<18|(63&y)<<12|(63&S)<<6|63&b,R<65536||R>1114111?p+=h:(R-=65536,p+=c(55296+(R>>10),56320+(1023&R)),v+=3))):p+=h}return p}function Zh(n,i){let s=i.length,c=0;for(let p=0;p<s;p++){let v=i.charCodeAt(p);v>=55296&&v<=56319&&p+1<s&&(v=(v<<10)+i.charCodeAt(++p)-56613888),c+=v<128?1:v<2048?2:v<65536?3:4}mr(n,c);let l=AS(n,c),h=n.bytes;for(let p=0;p<s;p++){let v=i.charCodeAt(p);v>=55296&&v<=56319&&p+1<s&&(v=(v<<10)+i.charCodeAt(++p)-56613888),v<128?h[l++]=v:(v<2048?h[l++]=v>>6&31|192:(v<65536?h[l++]=v>>12&15|224:(h[l++]=v>>18&7|240,h[l++]=v>>12&63|128),h[l++]=v>>6&63|128),h[l++]=63&v|128)}}function I0e(n,i){let s=AS(n,i.limit),c=n.bytes,l=i.bytes;for(let h=0,p=i.limit;h<p;h++)c[h+s]=l[h]}function UY(n){return n.bytes[ZU(n,1)]}function VY(n,i){let s=AS(n,1);n.bytes[s]=i}function eV(n){let i=ZU(n,8),s=n.bytes;return xc[0]=s[i++],xc[1]=s[i++],xc[2]=s[i++],xc[3]=s[i++],xc[4]=s[i++],xc[5]=s[i++],xc[6]=s[i++],xc[7]=s[i++],JU[0]}function tV(n,i){let s=AS(n,8),c=n.bytes;JU[0]=i,c[s++]=xc[0],c[s++]=xc[1],c[s++]=xc[2],c[s++]=xc[3],c[s++]=xc[4],c[s++]=xc[5],c[s++]=xc[6],c[s++]=xc[7]}function ef(n){let i,s=0,c=0;do i=UY(n),s<32&&(c|=(127&i)<<s),s+=7;while(128&i);return c}function mr(n,i){for(i>>>=0;i>=128;)VY(n,127&i|128),i>>>=7;VY(n,i)}function ig(n,i){let s=i.low>>>0,c=(i.low>>>28|i.high<<4)>>>0,l=i.high>>>24,h=l===0?c===0?s<16384?s<128?1:2:s<1<<21?3:4:c<16384?c<128?5:6:c<1<<21?7:8:l<128?9:10,p=AS(n,h),v=n.bytes;switch(h){case 10:v[p+9]=l>>>7&1;case 9:v[p+8]=h!==9?128|l:127&l;case 8:v[p+7]=h!==8?c>>>21|128:c>>>21&127;case 7:v[p+6]=h!==7?c>>>14|128:c>>>14&127;case 6:v[p+5]=h!==6?c>>>7|128:c>>>7&127;case 5:v[p+4]=h!==5?128|c:127&c;case 4:v[p+3]=h!==4?s>>>21|128:s>>>21&127;case 3:v[p+2]=h!==3?s>>>14|128:s>>>14&127;case 2:v[p+1]=h!==2?s>>>7|128:s>>>7&127;case 1:v[p]=h!==1?128|s:127&s}}function FY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}const A0e=new Map([["moderation",1],["supervise",2]]);class k0e extends li{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const s=this._connectionState;this._connectionState=i,this.emit(Us.CONNECTION_STATE_CHANGE,s,i)}get inspectType(){return this._inspectType}set inspectType(i){var s;this._inspectMode=nu(s=i.map(c=>A0e.get(c)||0)).call(s,(c,l)=>c+l),this._inspectType=i}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(i){super(),ee(this,"name","AgoraRTCVideoContentInspect"),ee(this,"_connectionState",ud.CONNECTING),ee(this,"_innerConnectionState",void 0),ee(this,"sequence",0),ee(this,"inspectStartTime",void 0),ee(this,"workerManagerConnection",void 0),ee(this,"workerConnection",void 0),ee(this,"workerMessageLengthLimit",void 0),ee(this,"inspectIntervalMinimum",void 0),ee(this,"qualityRatio",void 0),ee(this,"_connectInfo",void 0),ee(this,"_cancelTokenSource",tc.CancelToken.source()),ee(this,"_retryConfig",void 0),ee(this,"wmSequence",0),ee(this,"inspectInterval",void 0),ee(this,"inspectTimer",null),ee(this,"ossFilePrefix",void 0),ee(this,"extraInfo",void 0),ee(this,"_inspectType",void 0),ee(this,"_inspectMode",void 0),ee(this,"_quality",1),ee(this,"qualityTimer",null),ee(this,"_inspectId",void 0),ee(this,"_needWorkUrlOnly",!1),ee(this,"inspectImage",()=>{if(this.connectionState!==ud.CONNECTED)throw new Pe(ie.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===ud.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Nr(5,"inspect-"),this.workerMessageLengthLimit=le("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=le("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=le("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=i.interval,this.ossFilePrefix=i.ossFilePrefix,this.extraInfo=i.extraInfo,this.inspectType=i.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new $b("worker-manager-"+this._inspectId,ss),this.on(Us.STATE_CHANGE,(s,c)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ld[s]," ").concat(c||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new $b("worker-"+this._inspectId,ss),this.handleWorkerEvents()}async init(i,s){this.emit(Us.STATE_CHANGE,ld.CONNECT_AP),this._connectInfo=i;const c=this._cancelTokenSource.token;return this._retryConfig=s,new pt((l,h)=>{this.on(Us.CONNECTION_STATE_CHANGE,(p,v)=>{v===ud.CONNECTED&&l()}),this.requestAP(i,c,s).then(p=>{this.connectWorkerManager(p)}).catch(p=>{h(p)})})}async requestAP(i,s,c){const l=le("WEBCS_DOMAIN").map(v=>"https://".concat(v,"/api/v1")),h=await function(v,y,S,b){let{appId:R,areaCode:O,cname:N,sid:Y,token:W,uid:H}=y;vS++;const ne="image_moderation_api",re={service_name:ne,json_body:JSON.stringify({appId:R,areaCode:O,cname:N,command:"allocateEdge",requestId:vS,seq:vS,sid:Y,token:W,ts:Date.now(),uid:H+""})};let me,be,we=v[0];return Jd(async()=>{me=Date.now();const Se=await nh(we,{data:re,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(be=Date.now()-me,Se.code!==0){const Et=new Pe(ie.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Se.code,{retry:!0,responseTime:be});throw x.error(Et.toString()),Et}const Le=JSON.parse(Se.json_body);if(Le.code!==200){const Et=new Pe(ie.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Le.code,", reason: ").concat(Le.reason),{code:Le.code,responseTime:be});throw x.error(Et.toString()),Et}if(!Le.servers||!Array.isArray(Le.servers)||Le.servers.length===0){const Et=new Pe(ie.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Le.code,responseTime:be});throw x.error(Et.toString()),Et}const et=le("VIDEO_INSPECT_WORKER_MANAGER_HOST"),mt=le("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Le.servers.map(Et=>{let{address:xn,wss:Mn}=Et;if(xn&&Mn)return"wss://".concat(xn.replace(/\./g,"-"),".").concat(et,":").concat(mt||Mn)}).filter(Et=>!!Et),workerToken:Le.workerToken,vid:Le.vid,responseTime:be}},(Se,Le)=>(kt.apworkerEvent(Y,{success:!0,sc:200,serviceName:ne,responseDetail:JSON.stringify(Se.addressList),firstSuccess:Le===0,responseTime:be,serverIp:v[Le%v.length]}),!1),(Se,Le)=>(kt.apworkerEvent(Y,{success:!1,sc:Se.data&&Se.data.code||200,serviceName:ne,responseTime:be,serverIp:v[Le%v.length]}),!!(Se.code!==ie.OPERATION_ABORTED&&Se.code!==ie.UNEXPECTED_RESPONSE||Se.data&&Se.data.retry)&&(we=v[(Le+1)%v.length],!0)),b)}(l,i,s,c);this.emit(Us.STATE_CHANGE,ld.AP_CONNECTED);const{addressList:p}=h;return this.wmSequence++,p}async connectWorkerManager(i){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(Us.STATE_CHANGE,ld.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(i,1e4)}async connectWorker(i){await this.workerConnection.init([i])}handleWorkerManagerEvents(){this.workerManagerConnection.on(un.CONNECTED,async()=>{this.emit(Us.STATE_CHANGE,ld.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(un.CLOSED,()=>{this._innerConnectionState<ld.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(un.FAILED,()=>{this._innerConnectionState<ld.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(un.RECONNECTING,()=>{this._innerConnectionState<ld.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(un.ON_MESSAGE,async i=>{this.emit(Us.STATE_CHANGE,ld.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const c=JSON.parse(i.data);if(c.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(c.code," from worker manager")),new Pe(ie.UNEXPECTED_RESPONSE,"response code of worker is unexpected",c);if(!(c.serverResponse&&c.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(c))),new Pe(ie.UNEXPECTED_RESPONSE,"response content of worker is unexpected",c);{const l=le("VIDEO_INSPECT_WORKER_PORT")||c.serverResponse.portWss,h=s.replace(/:\d+\/?$/,":".concat(l));this.emit(Us.STATE_CHANGE,ld.CONNECT_WORKER,h),this._needWorkUrlOnly?this.emit(Us.REQUEST_NEW_WORKER_URL,h):await this.connectWorker(h)}}),this.workerManagerConnection.on(un.WILL_RECONNECT,(i,s,c)=>{c(i)}),this.workerManagerConnection.on(un.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}handleWorkerEvents(){this.workerConnection.on(un.CONNECTED,async()=>{this.emit(Us.STATE_CHANGE,ld.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=ud.CONNECTED}),this.workerConnection.on(un.ON_MESSAGE,async i=>{if(i.data instanceof ArrayBuffer){const c=S0e(new Uint8Array(i.data));if(le("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(c)),c.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Us.INSPECT_RESULT,void 0,void 0);if(c.data&&c.data.scorePorn&&c.data.scoreSexy&&c.data.scoreNeutral){var s;const l={porn:c.data.scorePorn,sexy:c.data.scoreSexy,neutral:c.data.scoreNeutral},h=nu(s=Object.keys(l)).call(s,(v,y)=>l[v]>l[y]?v:y,"porn"),p=Object.keys(l).find(v=>v===h);this.emit(Us.INSPECT_RESULT,p)}else this.emit(Us.INSPECT_RESULT,void 0,new Pe(ie.UNEXPECTED_RESPONSE,c.code+"","There is an unexpected data on message"))}else this.emit(Us.INSPECT_RESULT,void 0,new Pe(ie.UNEXPECTED_RESPONSE,c.code+"",c.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Us.INSPECT_RESULT,void 0,new Pe(ie.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(un.CLOSED,()=>{this.connectionState=ud.CLOSED}),this.workerConnection.on(un.FAILED,()=>{this.connectionState=ud.CLOSED}),this.workerConnection.on(un.RECONNECTING,()=>{this.connectionState=this.connectionState===ud.CONNECTED?ud.RECONNECTING:ud.CONNECTING}),this.workerConnection.on(un.WILL_RECONNECT,(i,s,c)=>{i==="recover"&&c(i),c("tryNext")}),this.workerConnection.on(un.REQUEST_NEW_URLS,(i,s)=>{this.workerManagerConnection.close(),this.once(Us.REQUEST_NEW_WORKER_URL,c=>{i([c])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(c=>{this.connectWorkerManager(c,!0)}).catch(c=>{s(c)})})}async requestToInspectImage(){this.sequence++;const i=Bu(this,Us.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(i){if(!i.isPlaying)return void this.emit(Us.INSPECT_RESULT,void 0,new Pe(ie.INVALID_OPERATION,"Only the track being played can be inspected"));const c=await this.generateRequestData(i,s);this.workerConnection.sendMessage(c,!0,!0)}else this.emit(Us.INSPECT_RESULT,void 0,new Pe(ie.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(i,s){let{appId:c,cname:l,cid:h,vid:p,sid:v,uid:y}=s;const S=Date.now(),b=await i.getCurrentFrameImage("image/jpeg",this.quality),R=await EK(b,c,l),O=this.sequence+"-"+h+"-"+y+"-"+S+"-"+Nr(12,""),N={appId:c,cid:h,cname:l,deviceId:"",elapse:(Y=Number(S-this.inspectStartTime),{low:Y|=0,high:Y>>31,unsigned:Y>=0}),fileSize:R.byteLength,jpgEncryption:2,height:b.height,width:b.width,jpg:R,networkType:6,osType:7,requestId:O,sdkVersion:"4.23.2",sequence:this.sequence,sid:v,timestamp:q7(S),uid:y,vid:p,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var Y;this.extraInfo===void 0&&delete N.callbackData,this.ossFilePrefix===void 0&&delete N.ossFilePrefix;const W=E0e(N);if(W.byteLength<this.workerMessageLengthLimit){if(le("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const H=function(ne){for(var re=1;re<arguments.length;re++){var me=arguments[re]!=null?arguments[re]:{};re%2?FY(Object(me),!0).forEach(function(be){ee(ne,be,me[be])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ne,Object.getOwnPropertyDescriptors(me)):FY(Object(me)).forEach(function(be){Object.defineProperty(ne,be,Object.getOwnPropertyDescriptor(me,be))})}return ne}({},N);delete H.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(H))}return W}{const H=this.quality*this.qualityRatio;return this.quality=H,await this.generateRequestData(i,{appId:c,cname:l,cid:h,vid:p,sid:v,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=tc.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=ud.CLOSED,this.emit(Us.STATE_CHANGE,ld.CLOSED)}}const O0e={name:"ContentInspect",create:function(n){let{config:i}=n;return function(s){if(!s)throw new Pe(ie.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Pe(ie.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const c=[...new Set(s.inspectType)];c.forEach(l=>{var h;if(!dt(h=["supervise","moderation"]).call(h,l))throw new Pe(ie.INVALID_PARAMS,"".concat(l," is not a valid inspect type."))}),s.inspectType=c}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Pe(ie.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(i),new k0e(i)}};var jY=a(ct.Object.getOwnPropertySymbols),P0e=cn,N0e=Ja.indexOf,D0e=Ff,nV=ce([].indexOf),BY=!!nV&&1/nV([1],1,-0)<0;P0e({target:"Array",proto:!0,forced:BY||!D0e("indexOf")},{indexOf:function(n){var i=arguments.length>1?arguments[1]:void 0;return BY?nV(this,n,i)||0:N0e(this,n,i)}});var L0e=tu("Array").indexOf,x0e=I,M0e=L0e,rV=Array.prototype,U0e=function(n){var i=n.indexOf;return n===rV||x0e(rV,n)&&i===rV.indexOf?M0e:i},WY=a(U0e);function V0e(n,i){if(n==null)return{};var s,c,l=function(p,v){if(p==null)return{};var y,S,b={},R=c3(p);for(S=0;S<R.length;S++)y=R[S],WY(v).call(v,y)>=0||(b[y]=p[y]);return b}(n,i);if(jY){var h=jY(n);for(c=0;c<h.length;c++)s=h[c],WY(i).call(i,s)>=0||Object.prototype.propertyIsEnumerable.call(n,s)&&(l[s]=n[s])}return l}let zY=class{get localCapabilities(){return yi(this._localCapabilities)}get rtpCapabilities(){return yi(this._rtpCapabilities)}get candidates(){return yi(this._candidates)}get iceParameters(){return yi(this._iceParameters)}get dtlsParameters(){return yi(this._dtlsParameters)}constructor(n){ee(this,"sessionDesc",void 0),ee(this,"_localCapabilities",void 0),ee(this,"_rtpCapabilities",void 0),ee(this,"_candidates",void 0),ee(this,"_iceParameters",void 0),ee(this,"_dtlsParameters",void 0),ee(this,"setup",void 0),ee(this,"currentMidIndex",void 0),ee(this,"cname","o/i14u9pJrxRKAsu"),ee(this,"firefoxSsrcMidMap",new Map),n=yi(n);const{remoteIceParameters:i,remoteDtlsParameters:s,candidates:c,remoteRTPCapabilities:l,localCapabilities:h,direction:p,setup:v,videoCodec:y,audioCodec:S}=n;let b;this.setup=v,b=p===xa.RECEIVE_ONLY?Nc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Nc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=l,this._candidates=c,this._iceParameters=i,this._dtlsParameters=s,this._localCapabilities=h;const R=p===xa.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,O=p===xa.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,N=p===xa.RECEIVE_ONLY?l.send.videoCodecs:Jb(bt.VIDEO,R,O,y),Y=p===xa.RECEIVE_ONLY?l.send.audioCodecs:Jb(bt.AUDIO,R,O,S);for(const W of b.mediaDescriptions)W.attributes.iceUfrag=i.iceUfrag,W.attributes.icePwd=i.icePwd,W.attributes.fingerprints=s.fingerprints,W.attributes.candidates=c,W.attributes.setup=this.setup,W.media.mediaType==="application"&&(W.attributes.sctpPort="5000"),W.media.mediaType==="video"&&(W.media.fmts=N.map(H=>H.payloadType.toString(10)),W.attributes.payloads=N,W.attributes.extmaps=R.videoExtensions),W.media.mediaType==="audio"&&(W.media.fmts=Y.map(H=>H.payloadType.toString(10)),W.attributes.payloads=Y,W.attributes.extmaps=R.audioExtensions,gS(W));this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return zm(this.sessionDesc)}hasMid(n){return Array.isArray(n)?n.every(i=>this.hasMid(i)):this.sessionDesc.mediaDescriptions.some(i=>i.attributes.mid===n)}send(n,i,s,c,l){s=s.replace(/ /g,"-");const{ssrcs:h,ssrcGroups:p}=d_(i,this.cname,le("SYNC_GROUP")?s:void 0),v=this.findPreloadMediaDesc(h);if(v){if(gi()&&this.firefoxSsrcMidMap.set(h[0].ssrcId,v.attributes.mid),l&&(l.twcc||l.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(v);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(v,l),{mid:v.attributes.mid,needExchangeSDP:!0}}return{mid:v.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(n,h,c);let S;return y===-1?(S=this.createOrRecycleSendMedia(n,h,p,"sendonly",c,l),this.updateBundleMids()):(S=yi(this.sessionDesc.mediaDescriptions[y]),S.attributes.direction="sendonly",S.attributes.ssrcs=h,S.attributes.ssrcGroups=p,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(S,l)),gi()&&this.firefoxSsrcMidMap.set(h[0].ssrcId,S.attributes.mid),{needExchangeSDP:!0,mid:S.attributes.mid}}}stopSending(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&n.indexOf(s.attributes.mid)!==-1);if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(n,i,s){const c=[];return n.forEach(l=>{const h=l._mediaStreamTrack.kind,p=this.findAvailableRecvMediaIndex(h);let v,y=!1;p===-1?(y=!0,v=this.createOrRecycleRecvMedia(l,[],"recvonly",i,s),this.updateBundleMids()):(v=yi(this.sessionDesc.mediaDescriptions[p]),v.attributes.direction="recvonly"),c.push({mid:v.attributes.mid,needCreateTransceiver:y})}),c}stopReceiving(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>n.indexOf(s.attributes.mid)!==-1);if(i.length!==n.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(n){const{foundation:i,protocol:s,address:c,port:l,type:h,relatedAddress:p,relatedPort:v,priority:y}=new RTCIceCandidate(n),S={foundation:i??"",componentId:"1",transport:s??"",priority:y?y+"":"",connectionAddress:c??"",port:l?l+"":"",type:h?h+"":"",relAddr:p??"",relPort:v?v+"":"",extension:{}};this.candidates.some(b=>b.priority===S.priority&&b.connectionAddress===S.connectionAddress&&b.port===S.port)||(this._candidates.push(S),this.sessionDesc.mediaDescriptions.forEach(b=>{b.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(n,i,s,c,l){const h=n._mediaStreamTrack.kind,p=this.rtpCapabilities.recv,v=Jb(h,p,this.localCapabilities.send,h===bt.AUDIO?l:c),y=h===bt.VIDEO?p.videoExtensions:p.audioExtensions,S="".concat(++this.currentMidIndex);let b={media:{mediaType:h,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:v.map(O=>O.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:v,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(S)}};b=this.mungRecvMediaDsec(b,n);const R=this.findFirstClosedMedia(h);if(R){const O=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[O]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}muteRemote(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>dt(n).call(n,s.attributes.mid||""));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>dt(n).call(n,s.attributes.mid||""));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(n,i,s){return this.sessionDesc.mediaDescriptions.findIndex(c=>{const l=c.media.mediaType===n&&c.media.port!=="0"&&(c.attributes.direction==="sendonly"||c.attributes.direction==="sendrecv")&&c.attributes.ssrcs.length===0;if(gi()){if(l){const h=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(h||c.attributes.mid!=="0"&&c.attributes.mid!=="1")||!(!h||h!==c.attributes.mid)}return!1}return l&&c.attributes.mid===s})}findAvailableRecvMediaIndex(n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===n&&i.media.port!=="0"&&(i.attributes.direction==="recvonly"||i.attributes.direction==="sendrecv");return i.attributes.mid!=="0"&&i.attributes.mid!=="1"&&s})}predictReceivingMids(n){const i=[];for(let s=0;s<n;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}restartICE(n){n=yi(n),this._iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}createOrRecycleSendMedia(n,i,s,c,l,h){const p=this.rtpCapabilities.send,v=n===bt.VIDEO?p.videoCodecs:p.audioCodecs,y=n===bt.VIDEO?p.videoExtensions:p.audioExtensions;gi()&&(l="".concat(++this.currentMidIndex));let S={media:{mediaType:n,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:v.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:v,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:c,rtcpMux:!0,rtcpRsize:!0,mid:l}};S=this.mungSendMediaDesc(S,h);const b=this.findFirstClosedMedia(n);if(b){const R=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[R]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}mungRecvMediaDsec(n,i,s){const c=yi(n);return iU(c),mS(c,i),sU(c,i),D3(c),mO(c,s,this.localCapabilities.send),c}mungSendMediaDesc(n,i){const s=yi(n);return mO(s,i,this.localCapabilities.recv),gS(s),s}updateRecvMedia(n,i){const s=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===n);if(s!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=c}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(n=>n.media.port!=="0").map(n=>n.attributes.mid)}findPreloadMediaDesc(n){return this.sessionDesc.mediaDescriptions.find(i=>{var s;return((s=i.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===n[0].ssrcId})}findFirstClosedMedia(n){return this.sessionDesc.mediaDescriptions.find(i=>gi()?i.media.port==="0"&&i.media.mediaType===n:i.media.port==="0")}};const F0e=["sdp"];var Wr;function GY(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function sg(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?GY(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):GY(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}let HY=(Wr=class BS extends p3{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,s;return(i=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&i!==void 0?i:null}get localCodecs(){return[]}set isInRestartIce(i){this._isInRestartIce=i}get isInRestartIce(){return this._isInRestartIce}constructor(i,s,c){super(i,s),ee(this,"direction",void 0),ee(this,"name",void 0),ee(this,"store",void 0),ee(this,"spec",void 0),ee(this,"peerConnection",void 0),ee(this,"initialOffer",void 0),ee(this,"transport",void 0),ee(this,"statsFilter",void 0),ee(this,"localCandidateCount",0),ee(this,"_isInRestartIce",!1),ee(this,"mutex",void 0),ee(this,"onLocalCandidate",void 0),ee(this,"remoteSDP",void 0),ee(this,"pendingCandidates",[]),ee(this,"localCapabilities",void 0),ee(this,"isReady",!1),ee(this,"restartCnt",0),ee(this,"curTurnServerIndex",0),this.store=s,this.spec=i,this.mutex=new Co("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(BS.resolvePCConfiguration(i,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=c??xa.SEND_ONLY,this.name=this.direction===xa.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=_M(this.peerConnection,le("STATS_UPDATE_INTERVAL"),void 0,gi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(i){try{const s=await x3();if(this.localCapabilities=gO(s),i){const{sdp:c}=i,l=V0e(i,F0e),h=function(){const b={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=Xb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},Y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(dd(R,b,"videoExtensions",O,N,Y),dd(R,b,"videoCodecs",O,N,Y),dd(R,b,"audioExtensions",O,N,Y),dd(R,b,"audioCodecs",O,N,Y),le("RAISE_H264_BASELINE_PRIORITY")){const W=Y.videoCodecs.findIndex(H=>H.rtpMap&&H.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&H.fmtp&&H.fmtp.parameters["profile-level-id"]==="42001f");if(W!==-1){const H=Y.videoCodecs.findIndex(ne=>ne.rtpMap&&ne.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(H<W){x.debug("raising H264 baseline profile priority");const ne=Y.videoCodecs[W];Y.videoCodecs.splice(W,1),Y.videoCodecs.splice(H,0,ne)}H!==-1&&le("FILTER_SEND_H264_BASELINE")&&(O.videoCodecs=O.videoCodecs.filter(ne=>!(ne.rtpMap&&ne.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&ne.fmtp&&ne.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:O,recv:N,sendrecv:Y}}({},{},c);this.remoteSDP=new zY({remoteIceParameters:l.iceParameters,remoteDtlsParameters:l.dtlsParameters,candidates:[],remoteRTPCapabilities:h,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const p=await this.peerConnection.createAnswer();if(!p.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const v=$m(p.sdp);await this.peerConnection.setLocalDescription(p);const y=await M3({},{},p.sdp);this.localCapabilities=gO(y);const S=this.peerConnection.getTransceivers()[0];return S!=null&&S.receiver&&S.receiver.transport&&this.tryBindTransportEvents(S.receiver.transport),sg(sg({},v),{},{sdp:p.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const c=await this.peerConnection.createOffer();if(!c.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=$m(c.sdp);return this.initialOffer=c,sg(sg({},l),{},{sdp:c.sdp})}}catch(s){throw new Fe(ie.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(i){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:c,dtlsParameters:l}=i,h=await M3({},{},s);this.remoteSDP=new zY({remoteIceParameters:c,remoteDtlsParameters:l,candidates:[],remoteRTPCapabilities:h,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const p=this.peerConnection.getTransceivers()[0];p!=null&&p.sender&&p.sender.transport&&this.tryBindTransportEvents(p.sender.transport)}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(i){try{i&&this.pendingCandidates.push(i),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Fe(ie.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(i,s,c){var l=this;return wl(function*(){const h=yield Wn(l.mutex.lock("From P2PConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const p=[],v=l.remoteSDP.receive(i,s,c);i.forEach((H,ne)=>{if(v[ne].needCreateTransceiver){const re=l.peerConnection.addTransceiver(H._mediaStreamTrack,{direction:"sendonly"});p.push(re),H._updateRtpTransceiver(re)}else{const re=l.peerConnection.getTransceivers().find(me=>me.mid===v[ne].mid);if(!re)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(v[ne].mid));p.push(re),H._updateRtpTransceiver(re)}}),gi()&&le("SIMULCAST")===!0&&(yield Wn(l.applySimulcastForFirefox(p,i)));const y=v.map(H=>H.mid),S=yield Wn(l.peerConnection.createOffer()),b=l.mungSendOfferSDP(S.sdp,i,y),R=Nc(b),O=y.map(H=>{const ne=R.mediaDescriptions.find(re=>re.attributes.mid===H);if(!ne)throw new Error("Cannot extract ssrc from mediaDescription.");return O3(ne,le("USE_PUB_RTX"))}),N=p.map((H,ne)=>{const re=y[ne];return{localSSRC:O[ne],id:re}});yield Wn(l.peerConnection.setLocalDescription({type:"offer",sdp:b}));try{yield N}catch(H){const ne=l.remoteSDP.toString();throw yield Wn(l.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Wn(l.peerConnection.setRemoteDescription({type:"answer",sdp:ne})),yield Wn(l.stopSending(y,!0)),H}yield Wn(l.applySimulcastEncodings(p,i)),yield Wn(l.applySendEncodings(p,i));const Y=l.remoteSDP.toString(),W=l.logSDPExchange(b,"offer","local","send");return W==null||W(Y),yield Wn(l.setRemoteDescription({type:"answer",sdp:Y})),p.map((H,ne)=>{const re=y[ne];return{localSSRC:O[ne],id:re}})}catch(p){throw p instanceof Fe?p:new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(p.toString()))}finally{h()}})()}async stopSending(i,s){const c=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const l=this.peerConnection.getTransceivers().filter(y=>i.indexOf(y.mid)!==-1);if(l.length!==i.length)throw new Error("Transceivers' length (".concat(l.length,") doesn't match mids' length (").concat(i.length,") when trying to call P2PConnection.stopSending."));l.map(y=>{var S;y.direction="inactive",(S=y.stop)===null||S===void 0||S.call(y)});const h=await this.peerConnection.createOffer(),p=this.logSDPExchange(h.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(h),this.remoteSDP.stopReceiving(i);const v=this.remoteSDP.toString();p==null||p(v),await this.setRemoteDescription({type:"answer",sdp:v})}catch(l){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(l.toString()))}finally{c&&c()}}async receive(i,s,c,l){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=this.remoteSDP.send(i,s,c,l);if(p){const y=this.remoteSDP.toString(),S=this.logSDPExchange(y,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:y});const b=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(b.sdp,h,i);S==null||S(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."));const v=this.peerConnection.getTransceivers().find(y=>y.mid===h);if(!v||v.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:v.receiver.track,mid:v.mid,transceiver:v}}catch(h){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}}async mockReceive(i,s,c,l){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=this.remoteSDP.send(i,s,c,l);if(p){const v=this.remoteSDP.toString(),y=this.logSDPExchange(v,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:v});const S=await this.peerConnection.createAnswer(),b=this.mungReceiveAnswerSDP(S.sdp,h,i);y==null||y(b||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:b}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."))}catch(h){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const l=await this.peerConnection.createAnswer();c==null||c(l.sdp||""),await this.peerConnection.setLocalDescription(l)}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(i){try{if(this.store.p2pTransport===r_.Auto&&(this.store.p2pTransport=r_.SdRtn,Xn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(BS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Xn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(BS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!i){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:c}=$m(s.sdp);return this.store.descriptionStart(),this.direction===xa.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),c}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(i),this.store.descriptionStart(),this.direction===xa.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:c}=$m(s.sdp);return await this.peerConnection.setLocalDescription(s),c}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var i;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const c=await this.peerConnection.createOffer(),l=this.mungSendOfferSDP(c.sdp,[s],[i]);this.remoteSDP.updateRecvMedia(i,s);const h=this.remoteSDP.toString(),p=this.logSDPExchange(l,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),p==null||p(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new Fe(ie.EXCHANGE_SDP_FAILED,c.toString())}}async updateSendParameters(i,s){const c=this.peerConnection.getTransceivers().filter(l=>l.mid===i);c.length===1&&(this.isVP8Simulcast(s)?gi()||await this.applySimulcastEncodings(c,[s]):await this.applySendEncodings(c,[s]))}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const c=this.peerConnection.getTransceivers().find(l=>l.mid===s);c&&await c.sender.replaceTrack(i._mediaStreamTrack)}async getSelectedCandidatePair(){const i=this.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const s=i[0].transport.iceTransport,{local:c,remote:l}=s.getSelectedCandidatePair();return{local:sg(sg({},jh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port}),remote:sg(sg({},jh),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i,s;dt(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=i=>{if(i.candidate){var s;i.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,i.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i,s){let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const l={iceServers:[]};var h;return i.iceServers?l.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(Ub(i.turnServer.servers)?l.iceServers=i.turnServer.servers:(l.iceServers&&l.iceServers.push(...BS.turnServerConfigToIceServers(i.turnServer.servers,s,c)),le("USE_TURN_SERVER_OF_GATEWAY")&&l.iceServers&&i.turnServer.serversFromGateway&&l.iceServers.push(...BS.turnServerConfigToIceServers(i.turnServer.serversFromGateway,s,c)),dt(h=[r_.Relay,r_.SdRtn]).call(h,s)&&(l.iceTransportPolicy="relay"),le("FORCE_TURN_TCP")?l.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(p=>{p.forceturn&&(l.iceTransportPolicy="relay")}))),le("ENABLE_ENCODED_TRANSFORM")&&Xn().supportWebRTCEncodedTransform&&(l.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),l}static turnServerConfigToIceServers(i,s){let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const l=[],h=i.filter(v=>v.tcpport);x.debug("P2PConnection turnServers is ".concat(h,", current index is ").concat(c));const p=h.length>c?h[c]:h[0];switch(s){case r_.SdRtn:const v=i.filter(S=>{var b;return dt(b=S.username).call(b,"glb:")&&S.turnServerURL==S.turnServerURL}),y=v.length>c?v[c]:v[0];y&&(l.push({username:y.username,credential:y.password,credentialType:"password",urls:"turn:".concat(Km(y.turnServerURL),":").concat(y.tcpport,"?transport=udp")}),l.push({username:y.username,credential:y.password,credentialType:"password",urls:"turns:".concat(Km(y.turnServerURL),":").concat(y.tcpport,"?transport=tcp")}));break;case r_.Relay:p&&(l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=udp")}),l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(Km(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}));break;default:p&&(l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=udp")}),l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(Km(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}),l.push({username:p.username,credential:p.password,credentialType:"password",urls:"stun:".concat(p.turnServerURL,":").concat(p.tcpport)}))}return l}tryBindTransportEvents(i){if(i){this.transport=i,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var l;c&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:l}=s.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(i,s){var c;if(s||(s=this.peerConnection.getSenders().find(b=>b.track===i._mediaStreamTrack)),!s)return x.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(i))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Xn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},h={};switch(i._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;default:l.degradationPreference="balanced"}if(i._encoderConfig){var p;const{bitrateMax:b,frameRate:R,scaleResolutionDownBy:O}=i._encoderConfig;b&&(h.maxBitrate=1e3*b),dt(p=i._hints).call(p,Dr.LOW_STREAM)&&(R&&(h.maxFramerate=du(R)),O&&O>=1&&(h.scaleResolutionDownBy=O))}if(le("DSCP_TYPE")&&up()){var v;const b=le("DSCP_TYPE");dt(v=["very-low","low","medium","high"]).call(v,b)&&(h.networkPriority=b)}const y=s.getParameters(),S=(c=y.encodings)===null||c===void 0?void 0:c[0];gi()&&!S&&(l.encodings=[h]),S&&Object.assign(S,h),Object.assign(y,l),x.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await s.setParameters(y)}async applySendEncodings(i,s){try{if(!Xn().supportSetRtpSenderParameters||i.length!==s.length)return;for(let c=0;c<i.length;c++){const l=i[c],h=s[c];h instanceof qr&&!this.isVP8Simulcast(h)&&await this.updateRtpSenderEncodings(h,l.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,s,c){const l=Nc(i);return s.forEach((h,p)=>{const v=c[p],y=l.mediaDescriptions.find(S=>S.attributes.mid===v);y&&(mS(y,h),L3(y,h,this.store.codec))}),zm(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,c)=>{var l;(l=this.onFirstVideoDecoded)===null||l===void 0||l.call(this,i,s,c)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var c;(c=this.onSelectedLocalCandidateChanged)===null||c===void 0||c.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var c;(c=this.onSelectedRemoteCandidateChanged)===null||c===void 0||c.call(this,i,s)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,s){if(i.length===s.length)for(let y=0;y<i.length;y++){var c,l,h,p,v;const S=i[y],b=s[y];if(b instanceof qr&&!dt(c=b._hints).call(c,Dr.LOW_STREAM)&&(l=b._encoderConfig)!==null&&l!==void 0&&l.bitrateMax&&((h=b._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)>200&&(p=b._scalabilityMode)!==null&&p!==void 0&&p.numSpatialLayers&&((v=b._scalabilityMode)===null||v===void 0?void 0:v.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},O={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:O.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:O.high}];const N=S.sender.getParameters();await S.sender.setParameters(Object.assign(N,R))}}}async applySimulcastEncodings(i,s){if(!gi()&&i.length===s.length)for(let c=0;c<i.length;c++){const l=s[c];if(l instanceof qr&&this.isVP8Simulcast(l)){const h=i[c],p={},v={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:v.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:v.medium,scaleResolutionDownBy:4}];const y=h.sender.getParameters();await h.sender.setParameters(Object.assign(y,p))}}}isVP8Simulcast(i){var s,c,l,h,p;return!!(i instanceof qr&&le("SIMULCAST")&&this.store.codec==="vp8"&&!dt(s=i._hints).call(s,Dr.LOW_STREAM)&&(c=i._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((l=i._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(h=i._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=i._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1)}logSDPExchange(i,s,c,l){if(le("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(c," ").concat(s," SDP during P2PConnection.").concat(l,`
`),i),s==="offer"?h=>{this.logSDPExchange(h,"answer",c==="local"?"remote":"local",l)}:void 0}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(p=>p.mid&&i.indexOf(p.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(p=>{p.direction="inactive"});const c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(c),this.remoteSDP.muteRemote(i);const h=this.remoteSDP.toString();l==null||l(h),await this.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(p=>p.mid&&i.indexOf(p.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async p=>{p.direction="sendonly"});const c=await this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(c),this.remoteSDP.unmuteRemote(i);const h=this.remoteSDP.toString();l==null||l(h),await this.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(i,s){var c,l;if(s=(c=s)!==null&&c!==void 0?c:(l=this.currentRemoteDescription)===null||l===void 0?void 0:l.sdp){var h;const p=(h=Nc(s).mediaDescriptions.find(v=>v.attributes.mid===i))===null||h===void 0?void 0:h.attributes.ssrcs;return p==null?void 0:p[0].ssrcId}}async setRemoteDescription(i){var s;await this.peerConnection.setRemoteDescription(i),dt(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(i,s,c){const l=Nc(i),h=l.mediaDescriptions.find(p=>p.attributes.mid===s);return h&&c===bt.AUDIO&&h.media.mediaType==="audio"&&gS(h),zm(l)}},Ct(Wr.prototype,"establish",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"establish"),Wr.prototype),Ct(Wr.prototype,"connect",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"connect"),Wr.prototype),Ct(Wr.prototype,"receive",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"receive"),Wr.prototype),Ct(Wr.prototype,"mockReceive",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"mockReceive"),Wr.prototype),Ct(Wr.prototype,"stopReceiving",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"stopReceiving"),Wr.prototype),Ct(Wr.prototype,"restartICE",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"restartICE"),Wr.prototype),Ct(Wr.prototype,"close",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"close"),Wr.prototype),Ct(Wr.prototype,"updateEncoderConfig",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"updateEncoderConfig"),Wr.prototype),Ct(Wr.prototype,"updateSendParameters",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"updateSendParameters"),Wr.prototype),Ct(Wr.prototype,"replaceTrack",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"replaceTrack"),Wr.prototype),Ct(Wr.prototype,"muteLocal",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"muteLocal"),Wr.prototype),Ct(Wr.prototype,"unmuteLocal",[gd],Object.getOwnPropertyDescriptor(Wr.prototype,"unmuteLocal"),Wr.prototype),Wr);function gd(n,i,s){const c=n[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const l=this.mutex,h=await l.lock("From P2PConnection.".concat(i));try{for(var p=arguments.length,v=new Array(p),y=0;y<p;y++)v[y]=arguments[y];return await c.apply(this,v)}finally{h()}},s}let ih=function(n){return n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY",n}({});var KY,qY,$Y,YY,XY,JY,QY,ZY,eX,tX,nX,ii;function rX(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function QO(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?rX(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):rX(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}let j0e=(KY=sh(ih.SEND_ONLY),qY=sh(ih.SEND_ONLY),$Y=sh(),YY=sh(ih.RECEIVE_ONLY),XY=sh(ih.RECEIVE_ONLY),JY=sh(ih.RECEIVE_ONLY),QY=sh(ih.RECEIVE_ONLY),ZY=sh(ih.RECEIVE_ONLY),eX=sh(ih.RECEIVE_ONLY),tX=sh(),nX=sh(ih.RECEIVE_ONLY),ii=class extends li{get state(){return this._state}set state(n){const i=this._state;this._state=n,this.emit(Ft.StateChange,i,this._state)}constructor(n,i){super(),ee(this,"isPlanB",!1),ee(this,"store",void 0),ee(this,"statsUploader",void 0),ee(this,"sendConnection",void 0),ee(this,"recvConnection",void 0),ee(this,"localTrackMap",new Map),ee(this,"remoteUserMap",new Map),ee(this,"localDataChannels",[]),ee(this,"pendingLocalTracks",[]),ee(this,"pendingRemoteTracks",[]),ee(this,"statsCollector",void 0),ee(this,"dtlsFailedCount",0),ee(this,"sendMutex",void 0),ee(this,"recvMutex",void 0),ee(this,"_state",ur.Disconnected),ee(this,"_restartStates",["disconnected","failed"]),ee(this,"reconnectInterval",void 0),ee(this,"uploadUnplinkStarted",!1),ee(this,"uploadDownlinkStarted",!1),ee(this,"uplinkStateUploadInterval",void 0),ee(this,"downlinkStatsUploadInterval",void 0),ee(this,"handleMuteLocalTrack",async(s,c,l)=>{const h=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ur.Connected)return void l(new Fe(ie.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=this.filterTobeMutedTracks(s);if(y.length===0)return void c();const S=y.find(N=>N[0]==="videoLowTrack");S&&S[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(y.map(N=>{let[,{id:Y}]=N;return Y}));let b=!1;var p,v;s.trackMediaType==="video"?b=!((p=this.localTrackMap.get(Qe.LocalAudioTrack))===null||p===void 0||!p.track._muted):b=((v=this.localTrackMap.get(Qe.LocalVideoTrack))===null||v===void 0?void 0:v.id)===void 0;const R=this.createMuteMessage(y);await Pr(this,Ft.RequestMuteLocal,R);const O=s.trackMediaType==="video"?Hm.MUTE_LOCAL_VIDEO:Hm.MUTE_LOCAL_AUDIO;await Pr(this,Ft.RequestP2PMuteLocal,{action:O,message:R,isMuteAll:b}),c()}catch(y){l(y)}finally{h()}}),ee(this,"handleUnmuteLocalTrack",async(s,c,l)=>{const h=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ur.Connected)return void l(new Fe(ie.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const p=this.filterTobeUnmutedTracks(s);if(p.length===0)return void c();await this.sendConnection.unmuteLocal(p.map(S=>{let[,{id:b}]=S;return b}));const v=this.createUnmuteMessage(p),y=s.trackMediaType==="video"?Hm.UNMUTE_LOCAL_VIDEO:Hm.UNMUTE_LOCAL_AUDIO;await Pr(this,Ft.RequestP2PMuteLocal,{action:y,message:v}),c()}catch(p){l(p)}finally{h()}}),ee(this,"handleUpdateVideoEncoder",async(s,c,l,h)=>{let p;typeof h=="boolean"&&h||(p=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Qe.LocalVideoTrack);if(!this.sendConnection||!y||y.track!==s||this.state!==ur.Connected)return void c();const{id:S,track:b}=y;S&&(await this.sendConnection.updateSendParameters(S,b),await this.sendConnection.updateEncoderConfig(S,b),this.emit(Ft.UpdateVideoEncoder,b)),c()}catch(y){l(y)}finally{var v;(v=p)===null||v===void 0||v()}}),ee(this,"handleUpdateVideoSendParameters",async(s,c,l)=>{const h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const p=this.localTrackMap.get(Qe.LocalVideoTrack);if(!this.sendConnection||!p||p.track!==s||this.state!==ur.Connected)return void c();const{id:v,track:y}=p;v&&await this.sendConnection.updateSendParameters(v,y),c()}catch(p){l(p)}finally{h()}}),ee(this,"handleReplaceTrack",async(s,c,l,h)=>{let p;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof h=="boolean"&&h||(p=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var v;const S=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:R}]=b;return s===R});if(!this.sendConnection||!S||S[1].id===void 0||this.state!==ur.Connected)return void c();if(await((v=this.sendConnection)===null||v===void 0?void 0:v.replaceTrack(s,S[1].id)),S[0]===Qe.LocalVideoTrack&&Xn().supportDualStreamEncoding){const b=this.localTrackMap.get(Qe.LocalVideoLowTrack);if(b){const R=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=R,b.track._originMediaStreamTrack=R,await new pt((O,N)=>{this.handleReplaceTrack(b.track,O,N,!0)})}}c()}catch(S){l(S)}finally{var y;(y=p)===null||y===void 0||y()}}),ee(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),ee(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),ee(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),ee(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=n,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new S7(n),this.bindStatsUploaderEvents(),this.sendMutex=new Co("P2PChannel2-send-mutex",n.clientId),this.recvMutex=new Co("P2PChannel2-recv-mutex",n.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},le("ICE_RESTART_INTERVAL"))}async startP2PConnection(n,i){throw new Fe(ie.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(n){throw new Fe(ie.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(n,i){let s;try{if(i){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new HY(n,this.store,xa.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const c=await this.recvConnection.establish(i);return{iceParameters:c.iceParameters,dtlsParameters:c.dtlsParameters,sdp:c.sdp}}{this.state=ur.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new HY(n,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const c=await this.sendConnection.establish();return{iceParameters:c.iceParameters,dtlsParameters:c.dtlsParameters,sdp:c.sdp}}}finally{s&&s()}}async p2pConnect(n){if(!this.sendConnection)throw new Fe(ie.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(n),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ur.Connected}async addRemoteCandidate(n,i){if(i===xa.RECEIVE_ONLY){if(!this.sendConnection)throw new Fe(ie.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(n)}else{if(!this.recvConnection)throw new Fe(ie.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(n)}}publish(n,i,s){var c=this;return wl(function*(){const l=yield Wn(c.sendMutex.lock("From P2PChannel.publish"));try{if(!c.sendConnection||c.state!==ur.Connected){c.throwIfTrackTypeNotMatch(n);const S=n.filter(b=>c.pendingLocalTracks.indexOf(b)===-1);return void(c.pendingLocalTracks=c.pendingLocalTracks.concat(S))}c.store.pubId=c.store.pubId+1,Ao.markPublishStart(c.store.clientId,c.store.pubId);const h=c.filterTobePublishedTracks(n,i,s);if(h.length===0)return void(yield Wn(c.tryToUnmuteAudio(n)));h.forEach(S=>{let{track:b,type:R}=S;const O=Date.now();c.store.publish(b.getTrackId(),R===Qe.LocalAudioTrack?"audio":"video",O)}),c.bindLocalTrackEvents(h);const p=yield Wn(c.sendConnection.send(h.map(S=>{let{track:b}=S;return b}),c.store.codec,c.store.audioCodec)),v=(yield Wn(p.next())).value,y=c.createGatewayPublishMessage(h,v);try{yield y}catch(S){throw p.throw(S),(S==null?void 0:S.code)===ie.WS_ABORT&&h.forEach(b=>{let{track:R}=b;c.pendingLocalTracks.indexOf(R)===-1&&c.pendingLocalTracks.push(R)}),c.unbindLocalTrackEvents(h),S}yield Wn(p.next()),h.forEach(S=>{let{type:b}=S;c.statsCollector.addLocalStats(b)}),c.statsUploader.startUploadOutboundStats(),c.assignLocalTracks(h,v),h.forEach(S=>{let{track:b,type:R}=S;const O=Date.now();c.store.publish(b.getTrackId(),R===Qe.LocalAudioTrack?"audio":"video",void 0,O)}),c.startUploadUplinkState()}finally{l()}})()}async unpublish(n){if(!this.sendConnection||this.state!==ur.Connected)return void(n.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(l=>!dt(n).call(n,l)));const i=this.filterTobeUnpublishedTracks(n);if(i.length===0)return;const s=i.find(l=>l[0]==="videoLowTrack");s&&s[1].track.close();const c=this.createGatewayUnpublishMessage(i);if(await this.sendConnection.stopSending(i.map(l=>{let[,{id:h}]=l;return h})),this.withdrawLocalTracks(i),this.unbindLocalTrackEvents(i.map(l=>{let[h,{track:p}]=l;return{type:h,track:p}})),i.forEach(l=>{let[h]=l;this.statsCollector.removeLocalStats(h)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ur.Connected)return s&&s[1].track.close(),c;n.forEach(l=>{const h=this.pendingLocalTracks.indexOf(l);h!==-1&&this.pendingLocalTracks.splice(h,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const n=()=>{const i=[],s=[];Array.from(this.localTrackMap.entries()).forEach(c=>{let[l,{track:h,ssrcs:p}]=c;const v={stream_type:PSe(h,l),ssrcs:p};h._muted||!h._enabled?i.push(v):s.push(v)}),i.length>0&&i.forEach(c=>{Pr(this,Ft.RequestMuteLocal,[c])}),s.length>0&&s.forEach(c=>{Pr(this,Ft.RequestUnmuteLocal,[c])})};n(),this.uplinkStateUploadInterval=window.setInterval(()=>{n()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(n){return wl(function*(){throw new Fe(ie.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ho(this,Ft.RequestRePublish,this.pendingLocalTracks),this.emit(Ft.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Fe(ie.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(n,i,s,c){var l;if(!this.recvConnection)throw new Fe(ie.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((l=this.remoteUserMap.get(n))!==null&&l!==void 0&&l.has(i))return;const{track:h,mid:p,transceiver:v}=await this.recvConnection.receive(i,[{ssrcId:s}],String(n.uid),c);i===bt.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(h):(n._audioTrack=new aS(h,n.uid,n._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),v&&n._audioTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoSSRC=s,n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(h):(n._videoTrack=new oS(h,n.uid,n._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),v&&n._videoTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(n,n._videoTrack));const y=this.remoteUserMap.get(n);y?y.set(i,p):this.remoteUserMap.set(n,new Map([[i,p]])),this.statsCollector.addRemoteStats(n.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const S=this.pendingRemoteTracks.findIndex(b=>{let{user:R,kind:O}=b;return R.uid===n.uid&&i===O});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(Ft.MediaReconnectEnd,n.uid))}async mockSubscribe(n,i,s,c){if(!this.recvConnection)throw new Fe(ie.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(i,[{ssrcId:s}],String(n.uid),c)}async unsubscribe(n,i,s){const c=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:v}=h;return i!==void 0?p.uid===n.uid&&i===v:p.uid===n.uid});if(c.forEach(h=>{const p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),this.recvConnection||s||c.forEach(h=>{let{kind:p}=h;var v;if(p===bt.AUDIO)(v=n._audioTrack)===null||v===void 0||v._destroy(),n._audioTrack=void 0;else if(p===bt.VIDEO){var y;(y=n._videoTrack)===null||y===void 0||y._destroy(),n._videoTrack=void 0}}),!this.recvConnection)return;const l=this.filterTobeUnSubscribedTracks(n,i);l.length!==0&&(await this.recvConnection.stopReceiving(l.map(h=>{let[,{id:p}]=h;return p})),this.withdrawRemoteTracks(l),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),l.forEach(h=>{let[p,{kind:v}]=h;var y,S;if(v===bt.VIDEO&&p._videoSSRC&&((y=this.recvConnection)===null||y===void 0||y.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),v===bt.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),s||((S=p._videoTrack)===null||S===void 0||S._destroy(),p._videoTrack=void 0);else if(v===bt.AUDIO){var b;this.unbindRemoteTrackEvents(p._audioTrack),!s&&((b=p._audioTrack)===null||b===void 0||b._destroy(),p._audioTrack=void 0)}}),l.forEach(h=>{let[,{kind:p}]=h;Pr(this,Ft.RequestP2PMuteRemote,p)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const n=()=>Array.from(this.remoteUserMap.entries()).forEach(i=>{let[,s]=i;[bt.VIDEO,bt.AUDIO].forEach(c=>{s.has(c)?Pr(this,Ft.RequestP2PUnmuteRemote,c):Pr(this,Ft.RequestP2PMuteRemote,c)})});n(),this.downlinkStatsUploadInterval=window.setInterval(()=>{n()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(n){throw new Fe(ie.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(n){throw new Fe(ie.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(n){throw new Fe(ie.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(n){throw new Fe(ie.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(n,i){if(!this.recvConnection)return;const s=this.remoteUserMap.get(n);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid,"."));if(!s.get(i))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."));const c=i===bt.VIDEO?n._videoSSRC:n._audioSSRC;c!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(c,!1)}async unmuteRemote(n,i){return this.unmuteRemoteNoLock(n,i)}async unmuteRemoteNoLock(n,i){if(!this.recvConnection)return;const s=this.remoteUserMap.get(n);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid,"."));s.get(i)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."))}getAllTracks(n){const i=this.localTrackMap.get(Qe.LocalAudioTrack);if((i==null?void 0:i.track)instanceof fs){const s=i.track;return Array.from(this.localTrackMap.entries()).filter(c=>{let[l]=c;return l!==Qe.LocalAudioTrack}).filter(c=>{let[l]=c;return!(n&&l===Qe.LocalVideoLowTrack)}).map(c=>{let[,{track:l}]=c;return l}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return!(n&&c===Qe.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c})}reportPublishEvent(n,i,s,c,l){if(n){const p=this.localTrackMap.get(Qe.LocalAudioTrack),v=c?this.localTrackMap.get(Qe.LocalVideoLowTrack):this.localTrackMap.get(Qe.LocalVideoTrack);kt.publish(this.store.sessionId,{eventElapse:Ao.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:p==null?void 0:p.track.getTrackLabel(),videoName:v==null?void 0:v.track.getTrackLabel(),screenshare:(v==null?void 0:v.track._hints.indexOf(Dr.SCREEN_TRACK))!==-1,audio:!!p,video:!!v,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}else{var h;s||(s=[]);const p=s.find(y=>y instanceof bi),v=c?(h=this.localTrackMap.get(Qe.LocalVideoTrack))===null||h===void 0?void 0:h.track:s.find(y=>y instanceof qr);kt.publish(this.store.sessionId,{eventElapse:Ao.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:p==null?void 0:p.getTrackLabel(),videoName:v==null?void 0:v.getTrackLabel(),screenshare:(v==null?void 0:v._hints.indexOf(Dr.SCREEN_TRACK))!==-1,audio:!!p,video:!!v,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}}reportSubscribeEvent(n,i,s,c){const l=c===bt.VIDEO?s._videoSSRC:s._audioSSRC;l&&kt.subscribe(this.store.sessionId,{succ:n,ec:i,video:c===bt.VIDEO,audio:c===bt.AUDIO,peerid:s.uid,subscribeRequestid:c===bt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ao.measureFromSubscribeStart(this.store.clientId,l)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Co("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Co("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(Qe.LocalAudioTrack);if((n==null?void 0:n.track)instanceof fs){if(n.track.trackList.length>0){const i=n.track;n.track.trackList.forEach(s=>{i.removeAudioTrack(s)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ur.Disconnected}getStats(n){var i,s;return n?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(i=this.sendConnection)===null||i===void 0?void 0:i.getStats()}getRemoteVideoIsReady(n){var i;return((i=this.recvConnection)===null||i===void 0?void 0:i.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(Qe.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(Qe.LocalVideoTrack);if(n)return{width:n.track.videoWidth||0,height:n.track.videoHeight||0}}getEncoderConfig(n){const i=this.localTrackMap.get(n);return i&&i.track instanceof qr||i&&i.track instanceof bi?i.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}async hasRemoteMediaWithLock(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}getRemoteMedia(n){var i;const s=Array.from(zu(i=this.remoteUserMap).call(i)).find(c=>c.uid===n);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(s=>{let[c]=s;return{uid:c.uid,level:c.audioTrack?100*c.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(Qe.LocalAudioTrack);return i&&n.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=Sb(n).call(n,(s,c)=>s.level-c.level),n}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ur.Reconnecting,le("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;var s;i._videoTrack&&i._videoTrack._player&&((s=i._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),i._videoTrack._player.isKeepLastFrame=!0,i._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(n=>{var i;let[s,{track:c}]=n;switch(s){case Qe.LocalVideoTrack:dt(i=c._hints).call(i,Dr.LOW_STREAM)?c.close():this.pendingLocalTracks.push(c);break;case Qe.LocalAudioTrack:c instanceof fs?this.pendingLocalTracks=this.pendingLocalTracks.concat(c.trackList):this.pendingLocalTracks.push(c);case Qe.LocalVideoLowTrack:}}),this.emit(Ft.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;Array.from(zu(s).call(s)).forEach(c=>{this.setPendingRemoteMedia(i,c)}),this.emit(Ft.MediaReconnectStart,i.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(n,i){for(const s of this.pendingRemoteTracks){const{user:c,kind:l}=s;if((n instanceof Xm?n.uid:n)===c.uid&&i===l)return!0}return!1}setPendingRemoteMedia(n,i){this.hasPendingRemoteMedia(n,i)||this.pendingRemoteTracks.push({user:n,kind:i})}async restartICE(n,i){let s,c;if(n===xa.SEND_ONLY){if(!this.sendConnection)throw new Fe(ie.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),c=this.sendConnection}else{if(!this.recvConnection)throw new Fe(ie.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),c=this.recvConnection}try{if(i){const l=await c.restartICE(i);return c.isInRestartIce=!1,l}{const l=await c.restartICE();if(l){const h=await ho(this,Ft.RequestP2PRestartICE,{direction:xa.RECEIVE_ONLY,iceParameter:l});await c.restartICE(h),c.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const n=this.sendConnection.getStats(),i=this.localTrackMap.get(Qe.LocalVideoTrack),s=this.localTrackMap.get(Qe.LocalAudioTrack),c=n.videoSend.find(N=>{var Y;return N.ssrc===(i==null||(Y=i.ssrcs)===null||Y===void 0?void 0:Y[0].ssrcId)}),l=n.audioSend.find(N=>{var Y;return N.ssrc===(s==null||(Y=s.ssrcs)===null||Y===void 0?void 0:Y[0].ssrcId)});if(!c||!l)return 1;const h=Bu(this,Ft.NeedSignalRTT),p=c?c.rttMs:void 0,v=l?l.rttMs:void 0,y=p&&v?(p+v)/2:p||v,S=(y&&h?(y+h)/2:y||h)||0,b=100*n.sendPacketLossRate*.7/50+.3*S/1500,R=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,O=i==null?void 0:i.track;if(O&&O._encoderConfig&&O._hints.indexOf(Dr.SCREEN_TRACK)===-1){const N=O._encoderConfig.bitrateMax,Y=n.bitrate.actualEncoded;if(N&&Y){const W=(1e3*N-Y)/(1e3*N);return s3[W<.15?0:W<.3?1:W<.45?2:W<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const n=this.recvConnection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[c]=s;const l=c._audioSSRC,h=c._videoSSRC,p=n.audioRecv.find(Y=>Y.ssrc===l),v=n.videoRecv.find(Y=>Y.ssrc===h);if(!p&&!v)return void(i+=1);const y=Bu(this,Ft.NeedSignalRTT),S=n.rtt,b=(S&&y?(S+y)/2:S||y)||0,R=p?p.jitterMs:void 0,O=n.recvPacketLossRate;let N=.7*O*100/50+.3*b/1500;R&&(N=.6*O*100/50+.2*b/1500+.2*R/400),i+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}async muteLocalTrack(n){return new pt((i,s)=>{this.handleMuteLocalTrack(n,i,s)})}filterTobePublishedTracks(n,i,s){const c=[],l=Xn(),h=this.getAllTracks();n=qE(n=n.filter(y=>h.indexOf(y)===-1));let p=!1,v=!1;for(const y of n){if(y instanceof qr&&(this.localTrackMap.has(Qe.LocalVideoTrack)||p?new Fe(ie.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(c.push({track:y,type:Qe.LocalVideoTrack}),p=!0),i)){const S=this.getLowVideoTrack(y,s);c.push({track:S,type:Qe.LocalVideoLowTrack})}if(y instanceof bi){const S=this.localTrackMap.get(Qe.LocalAudioTrack);if(S){if(!(S.track instanceof fs))throw new Fe(ie.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Fe(ie.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0)}else if(v){const b=c.find(R=>{let{type:O}=R;return O===Qe.LocalAudioTrack});if(!(b.track instanceof fs))throw new Fe(ie.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Fe(ie.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");b.track.addAudioTrack(y)}else{if(!l.webAudioMediaStreamDest||y instanceof fs||y._bypassWebAudio)c.push({track:y,type:Qe.LocalAudioTrack});else{const b=new fs;b.addAudioTrack(y),c.push({track:b,type:Qe.LocalAudioTrack})}v=!0}}}return c}filterTobeUnpublishedTracks(n){const i=[],s=this.getAllTracks();n=qE(n=n.filter(c=>s.indexOf(c)!==-1));for(const c of n){if(c instanceof bi){const l=this.localTrackMap.get(Qe.LocalAudioTrack);if(!l)continue;l.track instanceof fs?(l.track.removeAudioTrack(c),this.unbindLocalAudioTrackEvents(c),l.track.trackList.length===0&&(i.push([Qe.LocalAudioTrack,l]),l.track.close())):i.push([Qe.LocalAudioTrack,l])}if(c instanceof qr){const l=this.localTrackMap.get(Qe.LocalVideoTrack);if(!l)continue;i.push([Qe.LocalVideoTrack,l]);const h=this.localTrackMap.get(Qe.LocalVideoLowTrack);h&&i.push([Qe.LocalVideoLowTrack,h])}}return i}bindLocalTrackEvents(n){n.forEach(i=>{let{track:s,type:c}=i;switch(c){case Qe.LocalVideoTrack:s.addListener(wt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(wt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(wt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Qe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Qe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(n,i){n instanceof fs?n.trackList.forEach(s=>{s.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(wt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(wt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||n.addListener(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(i=>{let[s,{track:c}]=i;return{track:c,type:s}})),n.forEach(i=>{let{track:s,type:c}=i;switch(c){case Qe.LocalVideoTrack:s.off(wt.GET_STATS,this.handleGetLocalVideoStats),s.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(wt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(wt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Qe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Qe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(n){n instanceof fs?n.trackList.forEach(i=>{i.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(wt.GET_STATS,this.handleGetLocalAudioStats),i.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(wt.GET_STATS,this.handleGetLocalAudioStats),n.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,i){i instanceof oS&&i.addListener(wt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(n))}),i instanceof aS&&i.addListener(wt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(wt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;s.has(bt.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),s.has(bt.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(n,i){return n.map((s,c)=>{var l;let h,{track:p,type:v}=s;switch(v){case Qe.LocalAudioTrack:h=hr.Audio;break;case Qe.LocalVideoTrack:h=dt(l=p._hints).call(l,Dr.SCREEN_TRACK)?hr.Screen:hr.High;break;case Qe.LocalVideoLowTrack:h=hr.Low}return{kind:v===Qe.LocalAudioTrack?bt.AUDIO:bt.VIDEO,stream_type:h,mid:i[c].id,ssrcs:i[c].localSSRC,isMuted:p.muted||!p.enabled}})}createGatewayUnpublishMessage(n){return n.map(i=>{var s;let c,[l,{track:h,ssrcs:p,id:v}]=i;switch(l){case Qe.LocalVideoTrack:c=dt(s=h._hints).call(s,Dr.SCREEN_TRACK)?hr.Screen:hr.High;break;case Qe.LocalAudioTrack:c=hr.Audio;break;case Qe.LocalVideoLowTrack:c=hr.Low}return{stream_type:c,ssrcs:p,mid:v}})}assignLocalTracks(n,i){n.forEach((s,c)=>{let{track:l,type:h}=s;this.localTrackMap.set(h,{track:l,id:i[c].id,ssrcs:i[c].localSSRC})})}withdrawLocalTracks(n){n.forEach(i=>{let[s]=i;this.localTrackMap.delete(s)})}bindConnectionEvents(n){n.onConnectionStateChange=async i=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(n.name,".onConnectionStateChange(").concat(i,")")),this.emit(Ft.PeerConnectionStateChange,i),i!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),i==="connected"&&(n.isInRestartIce=!1),dt(s=this._restartStates).call(s,i)&&!n.isInRestartIce&&(i==="disconnected"&&await $s(800),n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))},n.onICEConnectionStateChange=i=>{i!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(i,")")),kt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:i,tag:_i.TRACER}).onSuccess(),this.emit(Ft.IceConnectionStateChange,i)},n.onICETransportStateChange=i=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(i,")"))},n.onDTLSTransportStateChange=i=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(i,")"))},n.onDTLSTransportError=i=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(i,")"))},n.onFirstAudioDecoded=i=>{var s;const c=Array.from(zu(s=this.remoteUserMap).call(s)).find(h=>h._audioSSRC===i);var l;c&&(this.store.subscribe(c.uid,"audio",void 0,void 0,void 0,Date.now()),(l=c.audioTrack)===null||l===void 0||l.emit(tS.FIRST_FRAME_DECODED),kt.firstRemoteFrame(this.store.sessionId,Cs.FIRST_AUDIO_DECODE,ni.FIRST_AUDIO_DECODE,{peer:c._uintid,subscribeElapse:Ao.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=i=>{var s;const c=Array.from(zu(s=this.remoteUserMap).call(s)).find(l=>l._audioSSRC===i);c&&kt.firstRemoteFrame(this.store.sessionId,Cs.FIRST_AUDIO_RECEIVED,ni.FIRST_AUDIO_RECEIVED,{peer:c._uintid,subscribeElapse:Ao.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(i,s,c)=>{this.reportVideoFirstFrameDecoded(i,s,c)},n.onFirstVideoReceived=i=>{var s;const c=Array.from(zu(s=this.remoteUserMap).call(s)).find(l=>l._videoSSRC===i);c&&kt.firstRemoteFrame(this.store.sessionId,Cs.FIRST_VIDEO_RECEIVED,ni.FIRST_VIDEO_RECEIVED,{peer:c._uintid,subscribeElapse:Ao.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(i,s)=>{const c=i.candidateType==="relay",l=s.candidateType==="relay";s.candidateType!=="unknown"&&c===l||this.emit(Ft.ConnectionTypeChange,c),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(i)),")"))},n.onSelectedRemoteCandidateChanged=(i,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(i)),")"))},n.onFirstVideoDecodedTimeout=i=>{this.reportVideoFirstFrameDecoded(i,void 0,void 0,!0)},n.onLocalCandidate=i=>{this.emit(Ft.LocalCandidate,{candidate:i,direction:n.direction})}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.onLocalCandidate=void 0}async handleDisconnect(n){const i=n===xa.SEND_ONLY?this.sendConnection:this.recvConnection;i&&!i.isInRestartIce&&(i.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(i.name,"] start use restartICE")),n===xa.SEND_ONLY?this.restartICE(n):ho(this,Ft.RequestP2PRestartICE,{direction:xa.SEND_ONLY}))}filterTobeMutedTracks(n){const i=[];if(this.getAllTracks().indexOf(n)===-1)return i;const s=this.localTrackMap.get(Qe.LocalAudioTrack);if(n instanceof bi&&(s==null?void 0:s.track)instanceof fs)return s.track.isActive||i.push([Qe.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return n===h});if(c&&(i.push(c),c[0]===Qe.LocalVideoTrack)){const l=this.localTrackMap.get(Qe.LocalVideoLowTrack);l&&i.push([Qe.LocalVideoLowTrack,l])}return i}filterTobeUnmutedTracks(n){const i=[],s=this.localTrackMap.get(Qe.LocalAudioTrack);if(n instanceof bi&&(s==null?void 0:s.track)instanceof fs)return s.track.isActive&&i.push([Qe.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return n===h});if(c)if(c[0]===Qe.LocalVideoTrack){i.push(c);const l=this.localTrackMap.get(Qe.LocalVideoLowTrack);l&&i.push([Qe.LocalVideoLowTrack,l])}else i.push(c);return i}createMuteMessage(n){return n.map(i=>{var s;let c,[l,{track:h,ssrcs:p,id:v}]=i;switch(l){case Qe.LocalAudioTrack:c=hr.Audio;break;case Qe.LocalVideoTrack:c=dt(s=h._hints).call(s,Dr.SCREEN_TRACK)?hr.Screen:hr.High;break;case Qe.LocalVideoLowTrack:c=hr.Low}return{stream_type:c,ssrcs:p,mid:v}})}createUnmuteMessage(n){return n.map(i=>{var s;let c,[l,{track:h,ssrcs:p,id:v}]=i;switch(l){case Qe.LocalAudioTrack:c=hr.Audio;break;case Qe.LocalVideoTrack:c=dt(s=h._hints).call(s,Dr.SCREEN_TRACK)?hr.Screen:hr.High;break;case Qe.LocalVideoLowTrack:c=hr.Low}return{stream_type:c,ssrcs:p,mid:v}})}filterTobeUnSubscribedTracks(n,i){const s=[],c=this.remoteUserMap.get(n);if(!c)return s;if(i){const l=c.get(i);if(!l)return s;s.push([n,{kind:i,id:l}])}else Array.from(c.entries()).forEach(l=>{let[h,p]=l;s.push([n,{kind:h,id:p}])});return s}createUnsubscribeMessage(n){const i=[];return n.forEach(s=>{let[c,{kind:l,id:h}]=s;switch(l){case bt.VIDEO:return void(c._videoSSRC&&i.push({stream_type:bt.VIDEO,ssrcId:c._videoSSRC}));case bt.AUDIO:return void(c._audioSSRC&&i.push({stream_type:bt.AUDIO,ssrcId:c._audioSSRC}))}}),i}withdrawRemoteTracks(n){n.forEach(i=>{let[s,{kind:c}]=i;const l=this.remoteUserMap.get(s);l&&(l.delete(c),Array.from(l.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(n){const i=this.localTrackMap.get(Qe.LocalVideoTrack),s=this.localTrackMap.get(Qe.LocalVideoLowTrack);i&&(await i.track.setBitrateLimit(n.uplink),await new pt((c,l)=>{this.handleUpdateVideoEncoder(i.track,c,l,!0)})),s&&n.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}),await new pt((c,l)=>{this.handleUpdateVideoEncoder(s.track,c,l,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const n=this.sendConnection.peerConnectionState,i=this.recvConnection.peerConnectionState;return n!=="connected"&&i!=="connected"}return!0}async tryToUnmuteAudio(n){for(let i=0;i<n.length;i++)if(n[i]instanceof bi){const s=this.filterTobeUnmutedTracks(n[i]);if(s.length===0)continue;const c=this.createUnmuteMessage(s);return void await Pr(this,Ft.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=n=>this.getStats(n),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(n=>{let[,{ssrcs:i}]=n;return!!i}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var i;return!((i=this.recvConnection)===null||i===void 0||!i.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,i)=>this.emit(Ft.RequestUpload,n,i),this.statsUploader.requestUploadStats=n=>this.emit(Ft.RequestUploadStats,n),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await $s(hM(this.dtlsFailedCount,ss)),this.emit(Ft.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Qe.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof qr)}throwIfTrackTypeNotMatch(n){if(n.filter(i=>i instanceof qr).length>1)throw new Fe(ie.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(i=>i instanceof bi).length>1&&(n.some(i=>i instanceof bi&&i._bypassWebAudio)||!Xn().webAudioMediaStreamDest))throw new Fe(ie.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of n){if(i instanceof qr&&this.pendingLocalTracks.some(s=>s instanceof qr))throw new Fe(ie.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof bi&&this.pendingLocalTracks.some(s=>s instanceof bi)&&(!Xn().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof bi&&s._bypassWebAudio)))throw new Fe(ie.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,i){const s=!le("DISABLE_DUAL_STREAM_USE_ENCODING")&&Xn().supportDualStreamEncoding,c=QO(QO({},{width:160,height:120,framerate:15,bitrate:50}),i);let l;l=s?n._mediaStreamTrack.clone():SU(n,c);const h=Nr(8,"track-low-"),p=new qr(l,QO(QO({},s&&{scaleResolutionDownBy:rU(c,n)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return p.on(i_.TRANSCEIVER_UPDATED,v=>{n._updateRtpTransceiver(v,ZE.LOW_STREAM)}),p._hints.push(Dr.LOW_STREAM),n.addListener(wt.NEED_CLOSE,()=>{p.close()}),p}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(n,i,s,c){var l;const h=Array.from(zu(l=this.remoteUserMap).call(l)).find(p=>p._videoSSRC===n);if(h){c||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,v=p.subscribe.find(y=>y.userId===h.uid&&y.type==="video");kt.firstRemoteVideoDecode(this.store.sessionId,Cs.FIRST_VIDEO_DECODE,ni.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:i,videoheight:s,subscribeElapse:Ao.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:(v==null?void 0:v.subscribeEnd)||0,subscriberStart:(v==null?void 0:v.subscribeStart)||0,videoAddNotify:(v==null?void 0:v.streamAdded)||0,state:c?1:0})}}async remoteMediaSsrcChanged(n,i,s){if(!this.recvConnection)return!1;const c=this.remoteUserMap.get(n);if(!c)return!1;const l=c.get(i);if(!l)return!1;const h=await this.recvConnection.getRemoteSSRC(l);return h!==void 0&&h!==s}isPreSubScribe(n){return!1}async publishDataChannel(n){throw new Fe(ie.NOT_SUPPORTED)}async unpublishDataChannel(n){throw new Fe(ie.NOT_SUPPORTED)}async subscribeDataChannel(n,i){throw new Fe(ie.NOT_SUPPORTED)}async unsubscribeDataChannel(n,i){throw new Fe(ie.NOT_SUPPORTED)}hasPendingRemoteDataChannel(n,i){throw new Fe(ie.NOT_SUPPORTED)}setPendingRemoteDataChannel(n,i){throw new Fe(ie.NOT_SUPPORTED)}async preConnect(n){throw new Fe(ie.NOT_SUPPORTED)}getEstablishParams(){throw new Fe(ie.NOT_SUPPORTED)}async reSubscribe(n){throw new Fe(ie.NOT_SUPPORTED)}async updateVideoStreamParameter(n,i){throw new Fe(ie.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:s}]=n;i===Qe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,ZE.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Ct(ii.prototype,"p2pConnect",[KY],Object.getOwnPropertyDescriptor(ii.prototype,"p2pConnect"),ii.prototype),Ct(ii.prototype,"unpublish",[qY],Object.getOwnPropertyDescriptor(ii.prototype,"unpublish"),ii.prototype),Ct(ii.prototype,"unpublishLowStream",[$Y],Object.getOwnPropertyDescriptor(ii.prototype,"unpublishLowStream"),ii.prototype),Ct(ii.prototype,"subscribe",[YY],Object.getOwnPropertyDescriptor(ii.prototype,"subscribe"),ii.prototype),Ct(ii.prototype,"mockSubscribe",[XY],Object.getOwnPropertyDescriptor(ii.prototype,"mockSubscribe"),ii.prototype),Ct(ii.prototype,"unsubscribe",[JY],Object.getOwnPropertyDescriptor(ii.prototype,"unsubscribe"),ii.prototype),Ct(ii.prototype,"muteRemote",[QY],Object.getOwnPropertyDescriptor(ii.prototype,"muteRemote"),ii.prototype),Ct(ii.prototype,"unmuteRemote",[ZY],Object.getOwnPropertyDescriptor(ii.prototype,"unmuteRemote"),ii.prototype),Ct(ii.prototype,"hasRemoteMediaWithLock",[eX],Object.getOwnPropertyDescriptor(ii.prototype,"hasRemoteMediaWithLock"),ii.prototype),Ct(ii.prototype,"disconnectForReconnect",[tX],Object.getOwnPropertyDescriptor(ii.prototype,"disconnectForReconnect"),ii.prototype),Ct(ii.prototype,"remoteMediaSsrcChanged",[nX],Object.getOwnPropertyDescriptor(ii.prototype,"remoteMediaSsrcChanged"),ii.prototype),ii);function sh(n){return function(i,s,c){const l=i[s];if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){for(var h=arguments.length,p=new Array(h),v=0;v<h;v++)p[v]=arguments[v];switch(n){case ih.SEND_ONLY:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await l.apply(this,p)}finally{y()}}case ih.RECEIVE_ONLY:{const y=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await l.apply(this,p)}finally{y()}}default:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s)),S=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await l.apply(this,p)}finally{y(),S()}}}},c}}class C_ extends li{constructor(i,s){super(),ee(this,"signal",void 0),ee(this,"token",void 0),ee(this,"tokenTimeout",void 0),ee(this,"tokenInterval",void 0),ee(this,"_sequence",0),ee(this,"userMap",new Map),ee(this,"encoder",new TextEncoder),this.signal=i,this.token=s;const c=()=>{this.signal.connectionState===Fr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(c,1e3):this.tokenInterval=window.setTimeout(c,3*le("P2P_TOKEN_INTERVAL"))};c()}async send(i,s,c,l,h){var p,v,y;if(this.userMap.size===0)return;const S=Array.from(Fu(p=this.userMap).call(p))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),l=(v=l)!==null&&v!==void 0?v:Nr(6,""),h=(y=h)!==null&&y!==void 0?y:this._sequence++;const b={_id:l,_type:i,_seq:h,_message:s,token:"".concat(this.token,"_").concat(S)};le("SHOW_P2P_LOG")&&x.debug("send message",b,"noNeedResponse : ".concat(c)),this.splitMessage(JSON.stringify(b)).forEach(O=>{this.signal.request(Jt.DATA_STREAM,{payload:Wm(this.encoder.encode(O))})});const R=new pt((O,N)=>{const Y=window.setTimeout(()=>{this.off("res-@".concat(l,"_ack"),W),this.off("res-@".concat(l),ne),this.off(hS.ABORT,H),x.debug("[external-signal] request timeout, type: ".concat(i,", requestId: ").concat(l)),this.userMap.size===0?N(new Fe(ie.INVALID_REMOTE_USER)):N(new Fe(ie.TIMEOUT))},le("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),W=()=>{Y&&window.clearTimeout(Y),this.off(hS.ABORT,H),c&&O()},H=()=>{Y&&window.clearTimeout(Y),this.off("res-@".concat(l,"_ack"),W),this.off("res-@".concat(l),ne),N(new Fe(ie.EXTERNAL_SIGNAL_ABORT,"type: ".concat(i,", requestId: ").concat(l)))};this.once(hS.ABORT,H),this.once("res-@".concat(l,"_ack"),W);const ne=(me,be)=>{re=!0,Y&&window.clearTimeout(Y),this.off("res-@".concat(l,"_ack"),W),this.off(hS.ABORT,H),me==="success"?O(be):N(new Fe(ie.P2P_MESSAGE_FAILED,"request ".concat(i," failed, requestId: ").concat(l)))};let re=!1;c||(this.once("res-@".concat(l),ne),$s(le("SIGNAL_REQUEST_TIMEOUT")).then(()=>{re||x.warning("external_signal request timeout, type: ".concat(i,", requestId: ").concat(l,", ").concat(b))}))});try{return await R}catch(O){if(O.code===ie.TIMEOUT)return await this.send(i,s,c,l,h);throw O}}onMessage(i){var s;const{_uid:c}=i;let l,h=this.userMap.get(c);if(h)l=h.splitMessageMap;else{if(this.userMap.size>0||!("_type"in i)||i._type!==Ui.CHECK)return;const{token:S}=i;l=new Map,h={uid:c,isStart:!0,token:S,splitMessageMap:l,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(c,h),this.signal.emit(Pn.ON_USER_ONLINE,{uid:c}),this.handleUserOnline()}if("id"in i&&"total"in i){var p;const{id:S,total:b}=i,R=(p=l.get(S))!==null&&p!==void 0?p:[];if(R.push(i),l.has(S)||l.set(S,R),R.length!==b)return;{const O=Sb(R).call(R,(N,Y)=>N.index-Y.index).map(N=>N.payload).join("");l.delete(S),(i=JSON.parse(O))._uid=c}}const{_type:v,token:y}=i;if(dt(s=[Ui.ACK,Ui.CHECK]).call(s,v))return v===Ui.CHECK&&this.handleCheckToken(h,y),void this.receiveMessage(i);y==="".concat(h.token,"_").concat(this.token)?this.handleReceivedMessage(i):x.debug('Receive unexpected message", '.concat(y,", cur_token: ").concat(h.token,"_").concat(this.token),i)}check(){const i={_id:Nr(6,""),token:this.token,_type:Ui.CHECK};le("SHOW_P2P_LOG")&&x.debug("send message",i),this.signal.request(Jt.DATA_STREAM,{payload:Wm(this.encoder.encode(JSON.stringify(i)))})}ack(i){const s={_id:i,_type:Ui.ACK,token:this.token};le("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(Jt.DATA_STREAM,{payload:Wm(this.encoder.encode(JSON.stringify(s)))})}response(i,s,c){this.send(Ui.RESPONSE,JSON.stringify({success:!c,message:s}),!0,i)}handleReceivedMessage(i){const s=()=>{this.userMap.forEach(S=>{const{receivedMessagesMap:b,nextExpectedSequenceNumber:R}=S;for(;b.has(R);){const O=b.get(R);b.delete(R),this.receiveMessage(O),S.nextExpectedSequenceNumber++}})};if(!i)return void s();const{_uid:c,_seq:l}=i,h=this.userMap.get(c),{receivedMessagesMap:p,isStart:v,nextExpectedSequenceNumber:y}=h;if(l<y)return this.ack(i._id),void x.debug("[external-signal] receive old message, seq: ".concat(l,", ").concat(i._message));p.set(l,i),v&&l===y&&(this.receiveMessage(i),p.delete(y),h.nextExpectedSequenceNumber++,s())}receiveMessage(i){const{_id:s,_type:c,_message:l,_uid:h}=i;if(le("SHOW_P2P_LOG")&&x.debug("receive message",i),s){let p;switch(i._type!==Ui.ACK&&(l&&(p=JSON.parse(l)),this.ack(i._id)),i._type){case Ui.CANDIDATE:case Ui.CONTROL:this.signal.emit(c,p,h);break;case Ui.PUBLISH:case Ui.UNPUBLISH:case Ui.RESTART_ICE:case Ui.CALL:p.uid=h,ho(this.signal,c,p).then(v=>{this.response(i._id,v)}).catch(()=>{this.response(i._id,void 0,!0)});break;case Ui.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case Ui.RESPONSE:{const{success:v,message:y}=p;this.emit("res-@".concat(s),v?"success":"failed",y);break}}}}splitMessage(i){if(i.length<C_.MAX_MESSAGE_SIZE)return[i];const s=[],{remoteToken:c}=JSON.parse(i),l=Nr(6,"");let h=0,p=800;const v=Math.ceil(i.length/p);for(;i.length>0;){h++;const y={id:l,index:h,total:v,payload:i.slice(0,p),token:"".concat(this.token,"_").concat(c)};JSON.stringify(y).length>C_.MAX_MESSAGE_SIZE?p-=50:(s.push(y),i=i.slice(p))}return s.map(y=>JSON.stringify(y))}handleCheckToken(i,s){return i.token!==s?(x.debug("token changed, from ".concat(i.token," to ").concat(s)),this.reset(i.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(i.uid)},le("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const i=await ho(this.signal,Ui.CALL,void 0),s=await this.send(Ui.CALL,i);this.signal.emit(en.P2P_CONNECTION,s,!0)}async reset(i,s){const c=this.userMap.get(i);c&&(this.emit(hS.ABORT),this.signal.emit(Pn.ON_USER_OFFLINE,{uid:c.uid,reason:sSe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=Nr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(hS.ABORT)}}ee(C_,"MAX_SIZE",1),ee(C_,"MAX_MESSAGE_SIZE",1024);class B0e extends li{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Fr.CONNECTED?this.emit(en.WS_CONNECTED):i===Fr.RECONNECTING?this.emit(en.WS_RECONNECTING,this._websocketReconnectReason):i===Fr.CLOSED&&this.emit(en.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,s){super(),ee(this,"_disconnectedReason",void 0),ee(this,"_websocketReconnectReason",void 0),ee(this,"_connectionState",Fr.CLOSED),ee(this,"reconnectToken",void 0),ee(this,"p2pToken",void 0),ee(this,"websocket",void 0),ee(this,"openConnectionTime",void 0),ee(this,"clientId",void 0),ee(this,"lastMsgTime",Date.now()),ee(this,"uploadCache",[]),ee(this,"uploadCacheInterval",void 0),ee(this,"rttRolling",new D9(5)),ee(this,"pingpongTimer",void 0),ee(this,"pingpongTimeoutCount",0),ee(this,"joinResponse",void 0),ee(this,"multiIpOption",void 0),ee(this,"initError",void 0),ee(this,"spec",void 0),ee(this,"store",void 0),ee(this,"_external_signal",void 0),ee(this,"onWebsocketMessage",c=>{if(c.data instanceof ArrayBuffer)return void this.emit(en.ON_BINARY_DATA,c.data);const l=JSON.parse(c.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const h="res-@".concat(l._id);this.emit(h,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){switch(l._type){case Pn.ON_DATA_STREAM:return void this.handleDataStream(l._message);case Pn.MUTE_AUDIO:case Pn.MUTE_VIDEO:case Pn.ON_P2P_LOST:case Pn.ON_USER_ONLINE:return;case Pn.ON_USER_OFFLINE:const{uid:h}=l._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(h)),void this._external_signal.reset(h)}if(this.emit(l._type,l._message),l._type===Pn.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===Pn.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close(cr.UID_BANNED);break;case 15:this.close(cr.IP_BANNED);break;case 16:this.close(cr.CHANNEL_BANNED)}if(l._type===Pn.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case Bt.ERR_LICENSE_MISSING:this.close(cr.LICENSE_MISSING);break;case Bt.ERR_LICENSE_EXPIRED:this.close(cr.LICENSE_EXPIRED);break;case Bt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(cr.LICENSE_MINUTES_EXCEEDED);break;case Bt.ERR_LICENSE_PERIOD_INVALID:this.close(cr.LICENSE_PERIOD_INVALID);break;case Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(cr.LICENSE_MULTIPLE_SDK_SERVICE);break;case Bt.ERR_LICENSE_ILLEGAL:this.close(cr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=s,this.websocket=new tU("gateway-".concat(this.clientId),this.spec.retryConfig,!0,le("JOIN_GATEWAY_USE_DUAL_DOMAIN"),le("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Fr.CONNECTED&&this.reconnect("retry",lo.OFFLINE)}),this.p2pToken=Nr(6,""),this._external_signal=new C_(this,this.p2pToken)}async request(i,s,c,l){const h=Nr(6,""),p={_id:h,_type:i,_message:s},v=this.websocket.connectionID,y=()=>new pt((Y,W)=>{if(this.connectionState===Fr.CONNECTED)return Y();const H=()=>{this.off(en.WS_CLOSED,ne),Y()},ne=()=>{this.off(en.WS_CONNECTED,H),W(new Fe(ie.WS_ABORT))};this.once(en.WS_CONNECTED,H),this.once(en.WS_CLOSED,ne)});if(this.connectionState!==Fr.CONNECTING&&this.connectionState!==Fr.RECONNECTING||i===Jt.JOIN||i===Jt.REJOIN||await y(),this.websocket.sendMessage(p,!0),l)return;const S=new pt((Y,W)=>{let H=!1;const ne=(me,be)=>{H=!0,Y({isSuccess:me==="success",message:be||{}}),this.off(en.WS_CLOSED,re),this.off(en.WS_RECONNECTING,re),this.emit(en.REQUEST_SUCCESS,i,s)};this.once("res-@".concat(h),ne);const re=()=>{W(new Fe(ie.WS_ABORT,"type: ".concat(i))),this.off(en.WS_CLOSED,re),this.off(en.WS_RECONNECTING,re),this.off("res-@".concat(h),ne)};this.once(en.WS_CLOSED,re),this.once(en.WS_RECONNECTING,re),$s(le("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==v||H||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(i)),this.emit(en.REQUEST_TIMEOUT,i,s))})});let b=null;try{b=await S}catch(Y){if(this.connectionState===Fr.CLOSED||i===Jt.LEAVE)throw new Fe(ie.WS_ABORT);return!this.spec.forceWaitGatewayResponse||c?Y.throw():i===Jt.JOIN||i===Jt.REJOIN?null:(await y(),await this.request(i,s))}if(b.isSuccess)return b.message;const R=Number(b.message.error_code||b.message.code),O=qb(R),N=new Fe(ie.UNEXPECTED_RESPONSE,"".concat(O.desc,": ").concat(b.message.error_str),{code:R,data:b.message,desc:O.desc});return O.action==="success"?b.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(R,", message: ").concat(O.desc,", action: ").concat(O.action)),R===Bt.ERR_TOO_MANY_BROADCASTERS?((i===Jt.JOIN||i===Jt.REJOIN)&&(this.initError=N,this.close()),N.throw()):O.action==="failed"?N.throw():O.action==="quit"?(this.initError=N,this.close(),N.throw()):(R===Bt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",lo.MULTI_IP)):this.reconnect(O.action,lo.SERVER_ERROR),i===Jt.JOIN||i===Jt.REJOIN?null:await this.request(i,s)))}waitMessage(i,s){return new pt(c=>{const l=h=>{(!s||s(h))&&(this.off(i,l),c(h))};this.on(i,l)})}uploadWRTCStats(i){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(Hb.WRTC_STATS,s)}upload(i,s){const c={_type:i,_message:s};try{this.websocket.sendMessage(c)}catch{const h=le("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(c),this.uploadCache.length>h&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Fr.CONNECTED)return;const p=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(p._type,p._message)},le("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,s){const c={_type:i,_message:s};this.websocket.sendMessage(c)}async sendExtensionMessage(i,s,c){return await this._external_signal.send(i,s,c)}init(i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pt((s,c)=>{this.once(en.WS_CONNECTED,()=>s(this.joinResponse)),this.once(en.WS_CLOSED,()=>c(this.initError||new Fe(ie.WS_ABORT))),this.connectionState=Fr.CONNECTING,this.websocket.init(i).catch(c)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=i||cr.LEAVE,this.connectionState=Fr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Nr(6,""),this._external_signal.clear(),this._external_signal=new C_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(en.ABORT_P2P_EXECUTION);const i=await ho(this,en.REQUEST_JOIN_INFO),s=await this.request(Jt.JOIN,i);if(!s)return this.emit(en.REPORT_JOIN_GATEWAY,ie.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(en.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(i,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,s)}handleDataStream(i){try{var s;const c=t_(i.payload),l=new TextDecoder().decode(c),h=JSON.parse(l);"total"in h&&"id"in h||dt(s=Object.values(Ui)).call(s,h._type)?(h._uid=i.uid,this._external_signal.onMessage(h)):this.emit(Pn.ON_DATA_STREAM,i)}catch{this.emit(Pn.ON_DATA_STREAM,i)}}handleNotification(i){x.debug("[".concat(this.clientId,"] receive notification: "),i);const s=qb(i.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(cr.UID_BANNED),void this.close()):void this.reconnect(s.action,lo.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=le("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=i&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>le("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",lo.TIMEOUT):this.request(Jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const c=Date.now()-s;this.rttRolling.add(c),le("REPORT_STATS")&&this.send(Jt.PING_BACK,{pingpongElapse:c})}).catch(c=>{})}handleWebsocketEvents(){this.websocket.on(un.RECONNECT_CREATE_CONNECTION,i=>{this.emit(en.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(un.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(un.CLOSED,()=>{this.connectionState=Fr.CLOSED}),this.websocket.on(un.FAILED,()=>{this._disconnectedReason=cr.NETWORK_ERROR,this.connectionState=Fr.CLOSED}),this.websocket.on(un.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===Fr.CONNECTED?this.connectionState=Fr.RECONNECTING:this.connectionState=Fr.CONNECTING}),this.websocket.on(un.WILL_RECONNECT,(i,s,c)=>{i!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),c(i)}),this.websocket.on(un.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(i=>{if(this.emit(en.REPORT_JOIN_GATEWAY,i,this.url||""),i instanceof Fe&&i.code===ie.UNEXPECTED_RESPONSE&&i.data.code===Bt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",lo.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",lo.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(un.REQUEST_NEW_URLS,(i,s)=>{ho(this,en.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(un.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const W0e={name:"P2PChannel",create:function(n){let{store:i,statsCollector:s}=n;return new j0e(i,s)},createSubmodule:function(n){let{store:i,spec:s}=n;return new B0e(s,i)}};function iX(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function sX(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?iX(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):iX(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}class z0e{constructor(i){ee(this,"sessionDesc",void 0),ee(this,"localCapabilities",void 0),ee(this,"rtpCapabilities",void 0),ee(this,"candidates",void 0),ee(this,"_originCandidates",void 0),ee(this,"iceParameters",void 0),ee(this,"dtlsParameters",void 0),ee(this,"setup",void 0),ee(this,"currentMidIndex",void 0),ee(this,"cname",void 0),i=yi(i);const{iceParameters:s,dtlsParameters:c,candidates:l,rtpCapabilities:h,setup:p,localCapabilities:v,sdkCodec:y,cname:S}=i,b=Nc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=h,this.candidates=l,this._originCandidates=yi(l),this.iceParameters=s,this.dtlsParameters=c,this.setup=p,this.localCapabilities=v,this.cname=S;for(let R=0;R<b.mediaDescriptions.length;R++){const O=b.mediaDescriptions[R];if(O.attributes.iceUfrag=s.iceUfrag,O.attributes.icePwd=s.icePwd,O.attributes.fingerprints=c.fingerprints,O.attributes.candidates=l,O.attributes.setup=p,O.media.mediaType==="video"){O.media.fmts=h.videoCodecs.map(Y=>Y.payloadType.toString(10));let N=h.videoCodecs.filter(Y=>{var W,H;return(W=Y.rtpMap)===null||W===void 0?void 0:dt(H=W.encodingName.toLowerCase()).call(H,y)});N.length===0&&(N=h.videoCodecs),O.attributes.payloads=N,O.attributes.extmaps=h.videoExtensions}O.media.mediaType==="audio"&&(O.media.fmts=h.audioCodecs.map(N=>N.payloadType.toString(10)),O.attributes.payloads=h.audioCodecs,O.attributes.extmaps=h.audioExtensions),b.mediaDescriptions[R]=this.mungMediaDesc(O)}this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return zm(this.sessionDesc)}send(i,s,c){const{ssrcs:l,ssrcGroups:h}=d_(s,this.cname),p=this.sessionDesc.mediaDescriptions.find(S=>i===bt.VIDEO?S.media.mediaType==="video":S.media.mediaType==="audio"),v=l[0].attributes.label,y=l[0].attributes.mslabel;return p.attributes.ssrcs=p.attributes.ssrcs.concat(l),p.attributes.ssrcGroups=p.attributes.ssrcGroups.concat(h),{id:v,mslabel:y}}batchSend(i){return i.map(s=>{let{kind:c,ssrcMsg:l}=s;return this.send(c,l,void 0)})}stopSending(i){this.sessionDesc.mediaDescriptions.forEach(s=>{const c=[],l=[],h=[];s.attributes.ssrcs.forEach(p=>{dt(i).call(i,p.attributes.label||"")?h.push(p):c.push(p)}),s.attributes.ssrcGroups.forEach(p=>{var v;dt(v=h.map(y=>y.ssrcId)).call(v,p.ssrcIds[0])||l.push(p)}),s.attributes.ssrcs=c,s.attributes.ssrcGroups=l})}mute(i){const s=this.sessionDesc.mediaDescriptions.find(c=>c.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(i){const s=this.sessionDesc.mediaDescriptions.find(c=>c.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(i,s,c){i.forEach((l,h)=>{const p=l._mediaStreamTrack,v=this.sessionDesc.mediaDescriptions.findIndex(S=>S.attributes.mid===p.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[v],l);this.sessionDesc.mediaDescriptions[v]=y})}stopReceiving(i){}updateCandidates(i){const s=this._originCandidates.filter(l=>l.transport==="udp"),c=[];if(s.forEach(l=>{c.push(sX(sX({},l),{},{foundation:"tcpcandidate",priority:Number(l.priority)-1+"",transport:"tcp",port:Number(l.port)+90+""}))}),s.length!==0){switch(i){case Io.TCP_RELAY:this.candidates=c;break;case Io.UDP_TCP_RELAY:case Io.RELAY:this.candidates=[...s,...c];break;default:this.candidates=s}for(const l of this.sessionDesc.mediaDescriptions)l.attributes.candidates=this.candidates}}restartICE(i){i=yi(i),this.iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=i.iceUfrag,s.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const s=[];for(let c=0;c<i;c++)s.push((this.currentMidIndex+c+1).toString(10));return s}mungRecvMediaDsec(i,s){const c=yi(i);return mS(c,s),sU(c,s),c}updateRecvMedia(i,s){const c=this.sessionDesc.mediaDescriptions.findIndex(l=>l.attributes.mid===i);if(c!==-1){const l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],s);this.sessionDesc.mediaDescriptions[c]=l}}bumpMid(i){this.currentMidIndex+=i}updateTrackLabel(i,s,c){const l=this.sessionDesc.mediaDescriptions.find(p=>i===bt.VIDEO?p.attributes.mid==="video":p.attributes.mid==="audio");if(l){const p=l.attributes.ssrcs.find(v=>v.attributes.label===s);var h;p&&(p.attributes.label=c,(h=p.attributes.msid)===null||h===void 0||h.replace(s,c))}}mungMediaDesc(i){const s=yi(i);return iU(s),function(c){const l=c.attributes.extmaps.find(h=>pO(h.extensionName));l&&c.attributes.extmaps.splice(c.attributes.extmaps.indexOf(l),1),c.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(v=>v.type==="transport-cc");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}(s),s}getSSRC(i){for(const s of this.sessionDesc.mediaDescriptions)for(const c of s.attributes.ssrcs)if(c.attributes.label===i)return[c]}}var Ir;function oX(n,i){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(n);i&&(c=c.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,c)}return s}function ZO(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?oX(Object(s),!0).forEach(function(c){ee(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):oX(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}let G0e=(Ir=class lC extends m3{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var s;return dt(s=Object.keys(zk)).call(s,i)}))]}constructor(i,s){super(i,s),ee(this,"store",void 0),ee(this,"peerConnection",void 0),ee(this,"remoteSDP",void 0),ee(this,"initialOffer",void 0),ee(this,"statsFilter",void 0),ee(this,"useRTX",!1),ee(this,"localCapabilities",void 0),ee(this,"localCandidateCount",0),ee(this,"allCandidatesReceived",!1),ee(this,"establishPromise",void 0),ee(this,"mutex",void 0),this.store=s,this.mutex=new Co("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(lC.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=_M(this.peerConnection,le("STATS_UPDATE_INTERVAL"),void 0,gi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const i=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=$m(i.sdp),c=Xb(i.sdp,{filterRTX:!this.useRTX,filterVideoFec:le("FILTER_VIDEO_FEC"),filterAudioFec:le("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=c,this.initialOffer=i,ZO(ZO({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:c},offerSDP:i.sdp})}catch(i){throw new Fe(ie.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async updateRemoteConnect(){}async connect(i){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new z0e(ZO(ZO({},i),{},{rtpCapabilities:i.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(i,s){throw new Fe(ie.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(i){}send(i,s){var c=this;return wl(function*(){const l=yield Wn(c.mutex.lock());try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=i.map(O=>c.peerConnection.addTrack(O._mediaStreamTrack)),p=yield Wn(c.peerConnection.createOffer()),v=Nc(p.sdp),y=i.map(O=>{const N=O._mediaStreamTrack,Y=v.mediaDescriptions.find(W=>W.attributes.mid===N.kind);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return function(W,H,ne){const re=W.attributes.ssrcs.filter(be=>be.attributes.label===H),me=W.attributes.ssrcGroups;if(re.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(me&&re.length>1){const be=me.find(we=>we.ssrcIds.indexOf(re[0].ssrcId)!==-1);return be?[{ssrcId:be.ssrcIds[0],rtx:ne?be.ssrcIds[1]:void 0}]:[{ssrcId:re[0].ssrcId}]}return[{ssrcId:re[0].ssrcId}]}(Y,N.id,c.useRTX)});let S;try{S=yield y}catch(O){throw h.forEach(N=>{uo()&&N.replaceTrack(null),c.peerConnection.removeTrack(N)}),O}const b=c.mungSendOfferSDP(p.sdp,i);c.remoteSDP.receive(i,s,S);const R=c.remoteSDP.toString();return yield Wn(c.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Wn(c.applySendEncodings(h,i)),yield Wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:R})),i.map((O,N)=>{const Y=O._mediaStreamTrack.id;return{localSSRC:y[N],id:Y}})}catch(h){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{l()}})()}async stopSending(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(h=>{var p;return i.indexOf(((p=h.track)===null||p===void 0?void 0:p.id)||"")!==-1});if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(h=>{uo()&&h.replaceTrack(null),this.peerConnection.removeTrack(h)});const c=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(i);const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(i,s,c,l){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{id:h,mslabel:p}=this.remoteSDP.send(i,s,l),v=new pt((b,R)=>{const O=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(h)))},1e4),N=Y=>{const W=zn();if((W.name==="Safari"&&Number(W.version)===11||Na())&&Y.track.id!==h&&Y.streams[0].id===p){var H;const ne=Y.streams[0].getTracks()[0];return(H=this.remoteSDP)===null||H===void 0||H.updateTrackLabel(i,h,Y.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(O),void b(ne)}if(Y.track.id===h)return this.peerConnection.removeEventListener("track",N),clearTimeout(O),void b(Y.track)};this.peerConnection.addEventListener("track",N)}),y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(S),{track:await v,id:h}}catch(h){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c)}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(i){}async unmuteRemote(i){}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(c=>{var l;return i.indexOf(((l=c.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(s.length!==i.length)throw new Error("sender' length doesn't match mids' length.");s.map(c=>{if(uo()&&c.track)c.track.enabled=!1;else{const l=c.getParameters();l.encodings.forEach(h=>h.active=!1),c.setParameters(l)}})}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(h=>{var p;return i.indexOf(((p=h.track)===null||p===void 0?void 0:p.id)||"")!==-1});if(s.length!==i.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async h=>{if(uo()&&h.track)h.track.enabled=!0;else{const p=h.getParameters();p.encodings.forEach(v=>v.active=!0),await h.setParameters(p)}});const c=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(c);const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(i){var s=this;return wl(function*(){const c=yield Wn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const l=Xn().supportPCSetConfiguration;if(i===Io.RELAY&&!l)return;if(l){const S=s.peerConnection.getConfiguration(),b=i===Io.RELAY?"relay":"all";S.iceTransportPolicy!==b&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(b,"]")),S.iceTransportPolicy=b,s.peerConnection.setConfiguration(S))}i!==Io.RELAY&&s.remoteSDP.updateCandidates(i);const h=yield Wn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const p=$m(h.sdp),{remoteIceParameters:v}=yield p.iceParameters;s.remoteSDP.restartICE(v);const y=s.remoteSDP.toString();yield Wn(s.peerConnection.setLocalDescription(h)),yield Wn(s.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(l){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),l)}finally{c()}})()}close(){var i;this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const c=await this.peerConnection.createOffer(),l=this.mungSendOfferSDP(c.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const h=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new Fe(ie.EXCHANGE_SDP_FAILED,c.toString())}}async updateSendParameters(i,s){const c=this.peerConnection.getSenders().filter(l=>{var h;return((h=l.track)===null||h===void 0?void 0:h.id)===i});c.length===1&&await this.applySendEncodings(c,[s])}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const c=this.peerConnection.getSenders().find(l=>{var h;return((h=l.track)===null||h===void 0?void 0:h.id)===s});c&&await c.replaceTrack(i._mediaStreamTrack)}createDataChannels(i,s){throw new Fe(ie.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(i){throw new Fe(ie.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},le("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const s={iceServers:[],sdpSemantics:"plan-b"};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(Ub(i.turnServer.servers)?s.iceServers=i.turnServer.servers:(s.iceServers&&s.iceServers.push(...lC.turnServerConfigToIceServers(i.turnServer.servers)),le("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...lC.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(c=>{c.security?c.tcpport&&s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=tcp")}):(c.udpport&&s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.udpport,"?transport=udp")}),c.tcpport&&s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(i,s){var c;if(s||(s=this.peerConnection.getSenders().find(S=>{var b;return((b=S.track)===null||b===void 0?void 0:b.id)===i._mediaStreamTrack.id})),!s)return x.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(!Xn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const l={},h={};if(i instanceof qr)switch(i._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;default:l.degradationPreference="balanced"}if(le("DSCP_TYPE")&&up()){var p;const S=le("DSCP_TYPE");dt(p=["very-low","low","medium","high"]).call(p,S)&&(h.networkPriority=S)}const v=s.getParameters(),y=(c=v.encodings)===null||c===void 0?void 0:c[0];y&&Object.assign(y,h),Object.assign(v,l),x.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(v.encodings))),await s.setParameters(v)}async applySendEncodings(i,s){try{if(!Xn().supportSetRtpSenderParameters||i.length!==s.length)return;for(let c=0;c<i.length;c++){const l=i[c],h=s[c];l&&h&&await this.updateRtpSenderEncodings(h,l)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,s){const c=Nc(i);return s.forEach((l,h)=>{const p=l._mediaStreamTrack,v=c.mediaDescriptions.find(y=>y.attributes.mid===p.kind);v&&mS(v,l)}),zm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,c)=>{var l;(l=this.onFirstVideoDecoded)===null||l===void 0||l.call(this,i,s,c)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var c;(c=this.onSelectedLocalCandidateChanged)===null||c===void 0||c.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var c;(c=this.onSelectedRemoteCandidateChanged)===null||c===void 0||c.call(this,i,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(i).map((h,p)=>{let{id:v,mslabel:y}=h;const{kind:S}=i[p];return new pt((b,R)=>{const O=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(v)))},1e4),N=Y=>{const W=zn();if(W.name==="Safari"&&Number(W.version)===11&&Y.track.id!==v&&Y.streams[0].id===y){var H;const ne=Y.streams[0].getTracks()[0];return(H=this.remoteSDP)===null||H===void 0||H.updateTrackLabel(S,v,Y.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(O),void b({track:ne,id:v})}if(Y.track.id===v)return this.peerConnection.removeEventListener("track",N),clearTimeout(O),void b({track:Y.track,id:v})};this.peerConnection.addEventListener("track",N)})}),c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});const l=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(l),await pt.all(s)}catch(s){throw new Fe(ie.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(i){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(i);return s==null?void 0:s[0].ssrcId}setConfiguration(i){if(Xn().supportPCSetConfiguration){const s=lC.resolvePCConfiguration(i);this.peerConnection.setConfiguration(s)}}},Ct(Ir.prototype,"connect",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"connect"),Ir.prototype),Ct(Ir.prototype,"stopSending",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"stopSending"),Ir.prototype),Ct(Ir.prototype,"receive",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"receive"),Ir.prototype),Ct(Ir.prototype,"stopReceiving",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"stopReceiving"),Ir.prototype),Ct(Ir.prototype,"muteRemote",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"muteRemote"),Ir.prototype),Ct(Ir.prototype,"unmuteRemote",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"unmuteRemote"),Ir.prototype),Ct(Ir.prototype,"muteLocal",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"muteLocal"),Ir.prototype),Ct(Ir.prototype,"unmuteLocal",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"unmuteLocal"),Ir.prototype),Ct(Ir.prototype,"close",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"close"),Ir.prototype),Ct(Ir.prototype,"updateEncoderConfig",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"updateEncoderConfig"),Ir.prototype),Ct(Ir.prototype,"updateSendParameters",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"updateSendParameters"),Ir.prototype),Ct(Ir.prototype,"replaceTrack",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"replaceTrack"),Ir.prototype),Ct(Ir.prototype,"getRemoteSSRC",[Nl],Object.getOwnPropertyDescriptor(Ir.prototype,"getRemoteSSRC"),Ir.prototype),Ir);function Nl(n,i,s){const c=n[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const l=this.mutex,h=await l.lock("Locking from P2PConnection.".concat(i));try{for(var p=arguments.length,v=new Array(p),y=0;y<p;y++)v[y]=arguments[y];return await c.apply(this,v)}finally{h()}},s}const H0e={name:"PlanBConnection",create:function(n){let{store:i,spec:s}=n;return new G0e(s,i)}},K0e={interceptLocalAudioFrame:async function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Xn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(Qk.has(n)||!n.track)return;const s={track:n.track};if(cp()){if(!n.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let l=null;try{l=n.createEncodedStreams()}catch(p){return void x.error("create audio-encoded-streams error",p&&p.message)}const h=new TransformStream({transform(p,v){s.controller||(s.controller=v),n.track&&n.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",c),s.track=n.track,s.track.addEventListener("ended",c));const y=i.metadata&&i.metadata();y?function(S,b){const{chunk:R,controller:O}=b,N=le("ENABLE_AUDIO_PTS_METADATA")?fp.AUDIO_64_BIT_PTS:fp.METADATA;R.data=function(Y,W,H){const ne=H.byteLength,re=ne+WM+Zq,me=jM+BM+re,be=new ArrayBuffer(Y.byteLength+me),we=new DataView(be);we.setUint8(0,Qq),we.setUint16(1,re),we.setUint8(3,W),we.setUint16(4,ne);for(let Le=0;Le<ne;Le++)we.setUint8(6+Le,H[Le]);const Se=new Uint8Array(we.buffer);return Se.set(new Uint8Array(Y),me),Se.buffer}(R.data,N,S),O.enqueue(R)}(y,{chunk:p,controller:v}):v.enqueue(p)}});l.readable.pipeThrough(h).pipeTo(l.writable)}else if(uo()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const l=Jk(),h=new MessageChannel;await new pt(v=>l.onmessage=y=>{y.data==="registered"&&v(void 0)});const p=new RTCRtpScriptTransform(l,{name:"audio-metadata-tx",port:h.port2},[h.port2]);n.transform=p,await new pt(v=>l.onmessage=y=>{y.data==="started"&&v(void 0)}),h.port1.onmessage=v=>{var y;if(v.data.transformed&&n.track&&((y=n.track)===null||y===void 0?void 0:y.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",c),s.track=n.track,s.track.addEventListener("ended",c);else if(v.data.getMetadata){const S=i.metadata&&i.metadata();S&&h.port1.postMessage({metadata:S})}},s.worker=l}function c(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",c)}const l=Qk.get(n);if(l){Qk.delete(n);try{var h,p;(h=l.controller)===null||h===void 0||h.terminate(),(p=l.worker)===null||p===void 0||p.terminate()}catch(v){x.warning(v&&v.message)}}}Qk.set(n,s),n.track.addEventListener("ended",c)},interceptRemoteAudioFrame:async function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Xn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(iO.has(n))return;const s={track:n.track,onMetadata:i.onMetadata};if(cp()){if(!n.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");eM(nr.CHROME,87,116)||(i.enableTopn=!1);let l=null;try{l=n.createEncodedStreams()}catch(p){return void x.error("create audio-encoded-streams error",p&&p.message)}const h=new TransformStream({transform(p,v){s.controller||(s.controller=v),n.track&&n.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",c),s.track=n.track,s.track.addEventListener("ended",c)),i.enableTopn?function(y,S,b){var R;const O=e3(new DataView(S.data));if(!O)return b.enqueue(S);const N=y.track.id;REe.set(N,y.track);const Y=(R=O.tlv.find(be=>be.tag===fp.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let W=0;typeof Y=="number"&&(W=127-Y);const H=Math.round(Math.pow(10,W/60)-1),{selected:ne,speaker:re}=function(be,we){let Se=cS.get(be);if(Se||(Se=function(Le){const et=new n3;return cS.set(Le,et),Zd||(Zd=new wEe(le("TOPN_SILENCE_THRESHOLD")||500),Zd.on("ActiveSpeakerChanged",mt=>{mt!=null&&(tO=mt)})),Zd.addSpeakers([et]),et}(be)),cS.size<=r3)return{selected:!0,speaker:Se};if(!Zd)throw new Error("no active speaker detector");return Zd.levelChanged(Se.id,we),c_=Zd.loudest.map(Le=>Le.id),tO&&!dt(c_).call(c_,tO)&&c_.length>=r3&&c_.pop(),{selected:dt(c_).call(c_,Se.id)||Se.id===tO,speaker:Se}}(y,H),me=function(be,we,Se){const Le=eh.get(be)||new CEe(be,we);return Le.score=Se,eh.set(be,Le),function(et){if(nO.set(et,!0),!rO)return void(rO=Date.now());const mt=Date.now();mt-rO>1e3&&(nO.get(et)?nO.set(et,!1):(i3(et),nO.delete(et)),rO=mt)}(be),Le}(N,y.track,re.energyScore);me.addSample(ne),me.active&&(S.data=O.frame.buffer,b.enqueue(S))}(n,p,v):i.enableMetadata?function(y,S,b){const R=e3(new DataView(y.data));if(!R)return S.enqueue(y);const O=R.tlv.find(N=>N.tag===fp.METADATA||N.tag===fp.AUDIO_64_BIT_PTS);O&&b&&O.value instanceof Uint8Array&&b(O.value),y.data=R.frame.buffer,S.enqueue(y)}(p,v,i.onMetadata):v.enqueue(p)}});l.readable.pipeThrough(h).pipeTo(l.writable)}else if(uo()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const l=Jk(),h=new MessageChannel;await new pt(v=>l.onmessage=y=>{y.data==="registered"&&v(void 0)});const p=new RTCRtpScriptTransform(l,{name:"audio-metadata-rx",port:h.port2},[h.port2]);n.transform=p,await new pt(v=>l.onmessage=y=>{y.data==="started"&&v(void 0)}),h.port1.onmessage=v=>{var y;v.data.transformed&&n.track&&((y=n.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",c),s.track=n.track,s.track.addEventListener("ended",c)):v.data.metadata&&s.onMetadata&&s.onMetadata(v.data.metadata)},s.worker=l}function c(){n.track.removeEventListener("ended",c),function(l){const h=iO.get(l);if(h){(function(y){const S=cS.get(y);S&&(cS.delete(y),Zd&&(Zd.removeSpeakers([S]),cS.size===0&&(Zd.destroy(),Zd=null)))})(l),i3(l.track.id),iO.delete(l);try{var p,v;(p=h.controller)===null||p===void 0||p.terminate(),(v=h.worker)===null||v===void 0||v.terminate()}catch(y){x.warning(y&&y.message)}}}(n)}iO.set(n,s),n.track.addEventListener("ended",c)},interceptLocalVideoFrame:async function(n,i){if(!Xn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(sO.has(n)||!n.track)return;const s={track:n.track};if(cp()){if(!n.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let l=null;try{l=n.createEncodedStreams()}catch(v){return void x.error("create video-encoded-streams error",v&&v.message)}const h=[];i.on("sei-to-send",v=>{h.push(v)});const p=new TransformStream({transform(v,y){s.controller||(s.controller=y),n.track&&n.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",c),s.track=n.track,s.track.addEventListener("ended",c));const S=h.shift();S&&(v.data=function(b,R){const O=function(re){const me=re.length;let be=[],we=0;for(;we<me;)we+2<me&&re[we]===0&&re[we+1]===0&&(re[we+2]===0||re[we+2]===1||re[we+2]===2||re[we+2]===3)?(be.push(re[we],re[we+1],3,re[we+2]),we+=3):(be.push(re[we]),we++);return new Uint8Array(be)}(R),N=O.length,Y=Math.floor(N/255),W=N%255,H=new Uint8Array(6+Y+1+N+b.byteLength);H[0]=0,H[1]=0,H[2]=0,H[3]=1,H[4]=6,H[5]=101;let ne=0;for(;ne<Y;)H[6+ne]=255,ne++;return H[6+ne]=W,ne++,H.set(O,6+ne),H.set(new Uint8Array(b),6+ne+N),H.buffer}(v.data,S)),y.enqueue(v)}});l.readable.pipeThrough(p).pipeTo(l.writable)}else{if(!uo())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const l=Jk(),h=new MessageChannel;await new pt(v=>l.onmessage=y=>{y.data==="registered"&&v(void 0)});const p=new RTCRtpScriptTransform(l,{name:"sei-tx",port:h.port2},[h.port2]);n.transform=p,await new pt(v=>l.onmessage=y=>{y.data==="started"&&v(void 0)}),i.on("sei-to-send",v=>{h.port1.postMessage({sei:v})}),h.port1.onmessage=v=>{var y;v.data.transformed&&n.track&&((y=n.track)===null||y===void 0?void 0:y.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",c),s.track=n.track,s.track.addEventListener("ended",c))},s.worker=l}}function c(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",c)}const l=sO.get(n);if(l){sO.delete(n);try{var h,p;(h=l.controller)===null||h===void 0||h.terminate(),(p=l.worker)===null||p===void 0||p.terminate()}catch(v){x.warning(v&&v.message)}}}sO.set(n,s),n.track.addEventListener("ended",c)},interceptRemoteVideoFrame:async function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Xn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!n.track)return;if(Gb.has(n)){const l=Gb.get(n);return void(l&&(l.onSei=i.onSei))}const s={track:n.track,onSei:i.onSei};if(cp()){if(!n.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let l=null;try{l=n.createEncodedStreams()}catch(p){return void x.error("create video-encoded-streams error",p&&p.message)}const h=new TransformStream({transform(p,v){s.controller||(s.controller=v),n.track&&n.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",c),s.track=n.track,s.track.addEventListener("ended",c));const y=function(S){const b=new DataView(S.data);let R=0;for(;R+4<S.data.byteLength;){if(b.getUint8(R+0)===0&&b.getUint8(R+1)===0&&b.getUint8(R+2)===0&&b.getUint8(R+3)===1&&b.getUint8(R+4)===6){let O=R+6,N=0,Y=0;for(;(Y=b.getUint8(O++))===255;)N+=255;N+=Y;const W=IEe(S.data,O,N);return new Uint8Array(W)}R++}return null}(p);y&&s.onSei&&s.onSei(y),v.enqueue(p)}});l.readable.pipeThrough(h).pipeTo(l.writable)}else if(uo()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const l=Jk(),h=new MessageChannel;await new pt(v=>l.onmessage=y=>{y.data==="registered"&&v(void 0)});const p=new RTCRtpScriptTransform(l,{name:"sei-rx",port:h.port2},[h.port2]);n.transform=p,await new pt(v=>l.onmessage=y=>{y.data==="started"&&v(void 0)}),h.port1.onmessage=v=>{var y;v.data.transformed&&n.track&&((y=n.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(n.track.id)),s.track.removeEventListener("ended",c),s.track=n.track,s.track.addEventListener("ended",c)):v.data.sei&&s.onSei&&s.onSei(v.data.sei)},s.worker=l}function c(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",c)}(function(l){const h=Gb.get(l);if(h){Gb.delete(l);try{var p,v;(p=h.controller)===null||p===void 0||p.terminate(),(v=h.worker)===null||v===void 0||v.terminate()}catch(y){x.warning(y&&y.message)}}})(n)}Gb.set(n,s),n.track.addEventListener("ended",c)}},q0e={name:"InterceptFrame",create:()=>K0e};yM(),_r("PROCESS_ID","process-".concat(Nr(8,""),"-").concat(Nr(4,""),"-").concat(Nr(4,""),"-").concat(Nr(4,""),"-").concat(Nr(12,""))),function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void x.error("Error loading sdk config",i.message)}if(n)try{const i=JSON.parse(window.atob(n)),s=Date.now();x.debug("Loading global parameters from cache",i),Object.keys(i).forEach(c=>{if(Object.prototype.hasOwnProperty.call(Kr,c)){const{value:l,expires:h}=i[c];if(h&&h<=s)return;Qd[c]=l,Kr[c]=l}})}catch(i){x.error("Error loading mutableParamsCache: ".concat(n),i.message)}}(),Array.isArray(Qd.AREAS)&&Qd.AREAS.length>0&&lU(Qd.AREAS,!0);const aX=(n,i,s)=>{x.debug("setParameter key:".concat(n,", value:").concat(JSON.stringify(i))),_r(n,i,s)};Ym(g0e,!1),Ym(y0e,!1),Ym(QSe,!1),Ym(O0e,!1),Ym(f0e,!1),Ym(W0e,!1),Ym(H0e,!1),Ym(q0e,!1);const os=function(n){const i=new li,s=n,c={getListeners:i.getListeners.bind(i),on:(l,h)=>(function(p,v){p===Gh.SECURITY_POLICY_VIOLATION&&B$(v,!0)}(l,h),i.on.bind(i)(l,h)),addListener:i.addListener.bind(i),once:i.once.bind(i),off:i.off.bind(i),removeAllListeners:i.removeAllListeners.bind(i),emit:i.emit.bind(i),safeEmit:i.safeEmit.bind(i)};return j$(j$({},s),c)}({__TRACK_LIST__:QE,VERSION:Cl,BUILD:TM,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:aX,getParameter:le,getSupportedCodec:async function(){let n={audio:[],video:[]};try{let i=new RTCPeerConnection;const s=await async function(c){let l;return Xn().supportUnifiedPlan?(c.addTransceiver("video",{direction:"recvonly"}),c.addTransceiver("audio",{direction:"recvonly"}),l=(await c.createOffer()).sdp):l=(await c.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,l}(i);if(!s)return n;i.close(),i=null,n=function(c){const l={video:[],audio:[]};return c.match(/ VP8/i)&&l.video.push("VP8"),c.match(/ VP9/i)&&l.video.push("VP9"),c.match(/ AV1/i)&&l.video.push("AV1"),c.match(/ H264/i)&&l.video.push("H264"),c.match(/ H265/i)&&l.video.push("H265"),c.match(/ opus/i)&&l.audio.push("OPUS"),c.match(/ PCMU/i)&&l.audio.push("PCMU"),c.match(/ PCMA/i)&&l.audio.push("PCMA"),c.match(/ G722/i)&&l.audio.push("G722"),l}(s)}catch(i){throw new Pe(ie.CREATE_OFFER_FAILED,i.toString&&i.toString()).print()}return n},checkSystemRequirements:function(){const n=kt.reportApiInvoke(null,{name:is.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:_i.TRACER});let i=!1;try{const h=window.RTCPeerConnection,p=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,v=window.WebSocket;i=!!(h&&p&&v),i&&iM()&&c9(75)&&new h().close()}catch(h){return x.error("check system requirement failed: ",h),!1}let s=!1;const c=zn();c.name===nr.CHROME&&Number(c.version)>=58&&(Xd.engine.name!=="WebKit"||function(){const h=zn();if(Lk()){if(h.os===ws.MAC_OS)return!0;if(h.os===ws.IOS){const p=Xd.os.version&&Xd.os.version.split(".");if(p&&Number(p[0])===14&&p[1]&&Number(p[1])>=3||p&&Number(p[0])>14)return!0}}return!1}())&&(s=!0),(c.name===nr.FIREFOX&&Number(c.version)>=56||c.name===nr.OPERA&&Number(c.version)>=45||c.name===nr.SAFARI&&Number(c.version)>=11||c.name==="WebKit"&&(Na()||sd())&&c.osVersion&&Number(c.osVersion.split(".")[0])>=11||p9()||zn().name===nr.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",i,"browser",s);const l=i&&s;return n.onSuccess(l),l},getDevices:function(n){return $u.enumerateDevices(!0,!0,n)},getMicrophones:function(n){return $u.getRecordingDevices(n)},getCameras:function(n){return $u.getCamerasDevices(n)},getElectronScreenSources:cK,getPlaybackDevices:function(n){return $u.getSpeakers(n)},createClient:function(){var n;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=Nr(5,"client-"),c=kt.reportApiInvoke(null,{id:s,name:is.CREATE_CLIENT,options:[i],tag:_i.TRACER});try{(function(l){vs(l.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),vs(l.mode,"config.mode",["rtc","live","p2p"]),l.audioCodec!==void 0&&vs(l.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),l.proxyServer!==void 0&&qs(l.proxyServer,"config.proxyServer",1,1e4),l.turnServer!==void 0&&T9(l.turnServer),l.httpRetryConfig!==void 0&&S9(l.httpRetryConfig),l.websocketRetryConfig!==void 0&&S9(l.websocketRetryConfig)})(i)}catch(l){throw c.onError(l),l}return(l9(16,0)||d9(16,0,!0))&&(i.codec==="vp9"&&(i.codec="vp8",x.debug("browser not support vp9, force use vp8")),_r("UNSUPPORTED_VIDEO_CODEC",["vp9"])),i.audioCodec===void 0&&(i.audioCodec="opus"),c.onSuccess(),new ZSe(fd(fd({forceWaitGatewayResponse:!0},i),{},{role:dt(n=["rtc","p2p"]).call(n,i.mode)?"host":i.role||"audience"}),s)},createCameraVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=le("CAMERA_CAPTURE_CONFIG"),s=Nr(8,"track-cam-"),c=kt.reportApiInvoke(null,{id:s,tag:_i.TRACER,name:is.CREATE_CAM_VIDEO_TRACK,options:[ri({},n),i]});i&&(n.encoderConfig=i);const l=Yk(n);let h=null;x.info("start create camera video track with config",JSON.stringify(n),"trackId",s);try{h=(await qu({video:l},s)).getVideoTracks()[0]||null}catch(v){throw c.onError(v),v}if(!h){const v=new Fe(ie.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(v),v.throw(x)}n.optimizationMode&&FM(s,h,n,Bh(n.encoderConfig));const p=new VM(h,n,l,n.scalabiltyMode?Hk(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,s);return c.onSuccess(p.getTrackId()),x.info("create camera video success, trackId:",s),p},createCustomVideoTrack:function(n){const i=Nr(8,"track-cus-"),s=kt.reportApiInvoke(null,{id:i,tag:_i.TRACER,name:is.CREATE_CUSTOM_VIDEO_TRACK,options:[n]}),c=new qr(n.mediaStreamTrack,{width:n.width,height:n.height,frameRate:n.frameRate,bitrateMax:n.bitrateMax,bitrateMin:n.bitrateMin},n.scalabiltyMode?Hk(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,i,[Dr.CUSTOM_TRACK]);return s.onSuccess(c.getTrackId()),x.info("create custom video track success with config",n,"trackId",c.getTrackId()),c},createScreenVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof i=="object"?function(O){return _K(O)}(i):void 0;s&&(i="auto");const c=Nr(8,"track-scr-v-"),l=kt.reportApiInvoke(null,{id:c,tag:_i.TRACER,name:is.CREATE_SCREEN_VIDEO_TRACK,options:[ri({},n),i]});n.encoderConfig?typeof n.encoderConfig=="string"||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";const h=function(O){const N={};O.screenSourceType&&(N.mediaSource=O.screenSourceType),O.extensionId&&cp()&&(N.extensionId=O.extensionId);const{displaySurface:Y,selfBrowserSurface:W,surfaceSwitching:H,systemAudio:ne,preferCurrentTab:re}=O;(Db(107)||tM(107)||nM(93))&&(Y&&(vs(Y,"displaySurface",["browser","window","monitor"]),N.displaySurface=Y),W?(vs(W,"selfBrowserSurface",["exclude","include"]),N.selfBrowserSurface=W):N.selfBrowserSurface="include",H&&(vs(H,"surfaceSwitching",["exclude","include"]),N.surfaceSwitching=H)),(Db(105)||tM(105)||nM(91))&&ne&&(vs(ne,"systemAudio",["exclude","include"]),N.systemAudio=ne),(Db(94)||tM(94)||nM(80))&&re&&(N.preferCurrentTab=!0),O.electronScreenSourceId&&(N.sourceId=O.electronScreenSourceId);const me=O.encoderConfig?IM(O.encoderConfig):null;return N.mandatory={chromeMediaSource:"desktop",maxWidth:me?me.width:void 0,maxHeight:me?me.height:void 0},me&&(me.frameRate&&(typeof me.frameRate=="number"?(N.mandatory.maxFrameRate=me.frameRate,N.mandatory.minFrameRate=me.frameRate):(N.mandatory.maxFrameRate=me.frameRate.max||me.frameRate.ideal||me.frameRate.exact||void 0,N.mandatory.minFrameRate=me.frameRate.min||me.frameRate.ideal||me.frameRate.exact||void 0),N.frameRate=me.frameRate),me.width&&(N.width=me.width),me.height&&(N.height=me.height)),N}(n);let p=null,v=null;const y=Xn();if(!y.supportShareAudio&&i==="enable"){const O=new Fe(ie.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return l.onError(O),O.throw(x)}x.info("start create screen video track with config",n,"withAudio",i,"trackId",c);const S=y.supportShareAudio&&i!=="disable";try{const O=await qu({screen:h,screenAudio:S?s||!0:void 0},c);p=O.getVideoTracks()[0]||null,v=O.getAudioTracks()[0]||null}catch(O){throw l.onError(O),O}if(!p){const O=new Fe(ie.UNEXPECTED_ERROR,"can not find track in media stream");return l.onError(O),O.throw(x)}if(!v&&i==="enable"){p&&p.stop();const O=new Fe(ie.SHARE_AUDIO_NOT_ALLOWED);return l.onError(O),O.throw(x)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(FM(c,p,n,n.encoderConfig&&IM(n.encoderConfig)||void 0),n.encoderConfig&&typeof n.encoderConfig!="string"&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));const b=new qr(p,n.encoderConfig?IM(n.encoderConfig):{},n.scalabiltyMode?Hk(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c,[Dr.SCREEN_TRACK]);if(!v)return l.onSuccess(b.getTrackId()),x.info("create screen video track success","video:",b.getTrackId()),b;const R=new bi(v,void 0,Nr(8,"track-scr-a-"),!1);return l.onSuccess([b.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",b.getTrackId(),"audio:",R.getTrackId()),[b,R]},createMicrophoneAndCameraTracks:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=le("CAMERA_CAPTURE_CONFIG"),c=Nr(8,"track-mic-"),l=Nr(8,"track-cam-"),h=kt.reportApiInvoke(null,{id:"".concat(c,"-").concat(l),tag:_i.TRACER,name:is.CREATE_MIC_AND_CAM_TRACKS,options:[n,i,s]});s&&(i.encoderConfig=s);const p=Yk(i),v=yK(n);let y=null,S=null;x.info("start create camera video track(".concat(l,") and microphone audio track(").concat(c,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(i)));try{const O=await qu({audio:v,video:p},"".concat(c,"-").concat(l));y=O.getAudioTracks()[0],S=O.getVideoTracks()[0]}catch(O){throw h.onError(O),O}if(!y||!S){const O=new Fe(ie.UNEXPECTED_ERROR,"can not find tracks in media stream");return h.onError(O),O.throw(x)}i.optimizationMode&&FM(l,S,i,Bh(i.encoderConfig));const b=new Xk(y,n,v,c),R=new VM(S,i,p,i.scalabiltyMode?Hk(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,l);return h.onSuccess([b.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(l,") and microphone audio track(").concat(c,") success")),[b,R]},createMicrophoneAudioTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=Nr(8,"track-mic-"),s=kt.reportApiInvoke(null,{id:i,tag:_i.TRACER,name:is.CREATE_MIC_AUDIO_TRACK,options:[n]}),c=yK(n);let l=null;x.info("start create microphone audio track with config",JSON.stringify(n),"trackId",i);try{l=(await qu({audio:c},i)).getAudioTracks()[0]||null}catch(p){throw s.onError(p),p}if(!l){const p=new Fe(ie.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(p),p.throw(x)}const h=new Xk(l,n,c,i);return s.onSuccess(h.getTrackId()),x.info("create microphone audio track success, trackId:",i),h},createCustomAudioTrack:function(n){const i=Nr(8,"track-cus-"),s=kt.reportApiInvoke(null,{id:i,tag:_i.TRACER,name:is.CREATE_CUSTOM_AUDIO_TRACK,options:[n]}),c=new bi(n.mediaStreamTrack,n.encoderConfig?Kk(n.encoderConfig):{},i,!1);return x.info("create custom audio track success with config",n,"trackId",c.getTrackId()),s.onSuccess(c.getTrackId()),c},createBufferSourceAudioTrack:async function(n){var i;const{cacheOnlineFile:s,encoderConfig:c}=n;let{source:l}=n;const h={source:l instanceof AudioBuffer?"AudioBuffer":l instanceof File?(i=File.name)!==null&&i!==void 0?i:"File":l,cacheOnlineFile:s,encoderConfig:c},p=Nr(8,"track-buf-"),v=kt.reportApiInvoke(null,{id:p,tag:_i.TRACER,name:is.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(le("DISABLE_WEBAUDIO"))throw new Fe(ie.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",p);const y=l;if(!(l instanceof AudioBuffer))try{l=await async function(R,O){let N=null;if(typeof R=="string"){const W=sq.get(R);if(W)return x.debug("use cached audio resource: ",R),W;try{N=(await Jd(()=>tc.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(H){throw new Fe(ie.FETCH_AUDIO_FILE_FAILED,H.toString())}}else N=await new pt((H,ne)=>{const re=new FileReader;re.onload=me=>{me.target?H(me.target.result):ne(new Fe(ie.READ_LOCAL_AUDIO_FILE_ERROR))},re.onerror=()=>{ne(new Fe(ie.READ_LOCAL_AUDIO_FILE_ERROR))},re.readAsArrayBuffer(R)});const Y=await function(W){const H=iS();return new pt((ne,re)=>{H.decodeAudioData(W,me=>{ne(me)},me=>{re(new Fe(ie.DECODE_AUDIO_FILE_FAILED,me.toString()))})})}(N);return typeof R=="string"&&O&&sq.set(R,Y),Y}(l,s)}catch(R){return v.onError(R),R.throw(x)}const S=new yEe(l),b=new _Ee(y,S,c?Kk(c):{},p);return x.info("create buffer source audio track success, trackId:",p),v.onSuccess(b.getTrackId()),b},setAppType:function(n){if(x.debug("setAppType: ".concat(n)),!(Number.isInteger(n)&&n>=0))throw x.debug("Invalid appType"),new Pe(ie.INVALID_PARAMS,"invalid app type",n);_r("APP_TYPE",Math.floor(n))},setLogLevel:function(n){x.setLogLevel(n)},enableLogUpload:function(){le("USE_NEW_LOG")?_r("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){le("USE_NEW_LOG")?_r("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new s7},checkAudioTrackIsActive:async function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=kt.reportApiInvoke(null,{tag:_i.TRACER,name:is.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[i]});if(!(n instanceof bi||n instanceof aS)){const y=new Pe(ie.INVALID_TRACK,"the parameter is not a audio track");return s.onError(y),y.throw()}i&&i<1e3&&(i=1e3);const c=n instanceof bi?n.getTrackLabel():"remote_track",l=n.getVolumeLevel();let h=l,p=l;const v=Date.now();return new pt(y=>{const S=setInterval(()=>{const b=n.getVolumeLevel();h=b>h?b:h,p=b<p?b:p;const R=h-p>1e-4,O=Date.now()-v;if(R||O>i){clearInterval(S);const N=R,Y={duration:O,deviceLabel:c,maxVolumeLevel:h,result:N};x.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(Y))),s.onSuccess(Y),y(N)}},200)})},checkVideoTrackIsActive:async function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=kt.reportApiInvoke(null,{tag:_i.TRACER,name:is.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[i]});if(!(n instanceof qr||n instanceof oS)){const R=new Pe(ie.INVALID_TRACK,"the parameter is not a video track");return s.onError(R),R.throw()}i&&i<1e3&&(i=1e3);const c=n instanceof qr?n.getTrackLabel():"remote_track",l=n.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(uo()||Lk())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([l]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let v=0,y=0;try{const R=Date.now();v=await function(O,N,Y,W){let H,ne=0,re=null;return new pt((me,be)=>{function we(){ne>W&&H&&(H(),me(ne));const Se=Y.getContext("2d");if(!Se){const mt=new Pe(ie.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(mt.toString()),void be(mt)}Se.drawImage(O,0,0,160,120);const Le=Se.getImageData(0,0,Y.width,Y.height),et=Math.floor(Le.data.length/3);if(re){for(let mt=0;mt<et;mt+=3)if(Le.data[mt]!==re[mt])return ne+=1,void(re=Le.data);re=Le.data}else re=Le.data}setTimeout(()=>{H&&(H(),me(ne))},N),H=NM(()=>{we()},30)})}(h,i,p,4),y=Date.now()-R}catch(R){throw s.onError(R),R}VSe===nr.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const S=v>4,b={duration:y,changedPicNum:v,deviceLabel:c,result:S};return x.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(b))),s.onSuccess(b),S},setArea:lU,audioElementPlayCenter:nc,resumeAudioContext:function(){nc.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(n){tTe.processExternalMediaAEC(n)},registerExtensions:function(n){const i=le("PLUGIN_INFO")||[];n.forEach(s=>{"name"in s&&!dt(i).call(i,s.name)&&i.push(s.name);const c=s;c.__registered__=!0,c.logger.hookLog=x.extLog,c.reporter.hookApiInvoke=kt.extApiInvoke,c.parameters&&Object.keys(c.parameters).forEach(l=>{c.parameters[l]=le(l)})}),aX("PLUGIN_INFO",i)},ChannelMediaRelayError:lS,ChannelMediaRelayEvent:mp,ChannelMediaRelayState:Dc,RemoteStreamFallbackType:dEe,RemoteStreamType:lEe,ConnectionDisconnectedReason:cr,AudienceLatencyLevelType:Bye,AREAS:rr,preload:async function(n,i,s,c){return N7(n,i,s,c)}});return Object.defineProperties(os,{onAudioAutoplayFailed:{get:()=>Yu.onAudioAutoplayFailed,set:n=>{Yu.onAudioAutoplayFailed=n}},onAutoplayFailed:{get:()=>Yu.onAutoplayFailed,set:n=>{Yu.onAutoplayFailed=n}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>os._onSecurityPolicyViolation,set(n){os._onSecurityPolicyViolation=n,B$(n)}},__CLIENT_LIST__:{get:()=>le("SHOW_GLOBAL_CLIENT_LIST")?u_:[]}}),$u.on(s_.CAMERA_DEVICE_CHANGED,n=>{x.info("camera device changed",JSON.stringify(n)),os.onCameraChanged&&os.onCameraChanged(n),os.safeEmit(Gh.CAMERA_CHANGED,n)}),$u.on(s_.RECORDING_DEVICE_CHANGED,n=>{x.info("microphone device changed",JSON.stringify(n)),os.onMicrophoneChanged&&os.onMicrophoneChanged(n),os.safeEmit(Gh.MICROPHONE_CHANGED,n)}),$u.on(s_.PLAYOUT_DEVICE_CHANGED,n=>{x.debug("playout device changed",JSON.stringify(n)),os.onPlaybackDeviceChanged&&os.onPlaybackDeviceChanged(n),os.safeEmit(Gh.PLAYBACK_DEVICE_CHANGED,n)}),nc.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),Yu.onAudioAutoplayFailed&&Yu.onAudioAutoplayFailed()},yr.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),Yu.onAudioAutoplayFailed&&Yu.onAudioAutoplayFailed(),os.safeEmit(Gh.AUTOPLAY_FAILED)}),yr.on(Xs.STATE_CHANGE,(n,i)=>{x.info("audio context state changed: ".concat(i," => ").concat(n)),os.onAudioContextStateChanged&&os.onAudioContextStateChanged(n,i),os.safeEmit(Gh.AUDIO_CONTEXT_STATE_CHANGED,n,i)}),$i.on(KE.NETWORK_STATE_CHANGE,(n,i)=>{x.info("[network-indicator] network state changed, ".concat(i," => ").concat(n))}),window&&(window.__ARTC__=os),os})}(gN)),gN.exports}var Iqe=Rqe();const mR=HT(Iqe);var mee={};function _j(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,o=Array(e);r<e;r++)o[r]=t[r];return o}function gee(t,e,r,o,a,u,d){try{var f=t[u](d),g=f.value}catch(E){return void r(E)}f.done?e(g):Promise.resolve(g).then(o,a)}function Ue(t){return function(){var e=this,r=arguments;return new Promise(function(o,a){var u=t.apply(e,r);function d(g){gee(u,o,a,d,f,"next",g)}function f(g){gee(u,o,a,d,f,"throw",g)}d(void 0)})}}function Jn(t,e,r){return e=Sy(e),function(o,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}(o)}(t,V5()?Reflect.construct(e,r||[],Sy(t).constructor):e.apply(t,r))}function xe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yue(t,e,r){if(V5())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,e);var a=new(t.bind.apply(t,o));return r&&gR(a,r.prototype),a}function vee(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Eue(o.key),o)}}function Me(t,e,r){return e&&vee(t.prototype,e),r&&vee(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function pn(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=F5(t))||e){r&&(t=r);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(g){throw g},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u,d=!0,f=!1;return{s:function(){r=r.call(t)},n:function(){var g=r.next();return d=g.done,g},e:function(g){f=!0,u=g},f:function(){try{d||r.return==null||r.return()}finally{if(f)throw u}}}}function Lt(t,e,r){return(e=Eue(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function yj(){return yj=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(t,e,r){var o=function(u,d){for(;!{}.hasOwnProperty.call(u,d)&&(u=Sy(u))!==null;);return u}(t,e);if(o){var a=Object.getOwnPropertyDescriptor(o,e);return a.get?a.get.call(arguments.length<3?t:r):a.value}},yj.apply(null,arguments)}function Sy(t){return Sy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Sy(t)}function Qn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gR(t,e)}function V5(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(V5=function(){return!!t})()}function _ee(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,o)}return r}function Ej(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?_ee(Object(r),!0).forEach(function(o){Lt(t,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_ee(Object(r)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(r,o))})}return t}function ue(){ue=function(){return e};var t,e={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(ke,Ne,Re){ke[Ne]=Re.value},u=typeof Symbol=="function"?Symbol:{},d=u.iterator||"@@iterator",f=u.asyncIterator||"@@asyncIterator",g=u.toStringTag||"@@toStringTag";function E(ke,Ne,Re){return Object.defineProperty(ke,Ne,{value:Re,enumerable:!0,configurable:!0,writable:!0}),ke[Ne]}try{E({},"")}catch{E=function(Ne,Re,Ve){return Ne[Re]=Ve}}function T(ke,Ne,Re,Ve){var ve=Ne&&Ne.prototype instanceof se?Ne:se,Be=Object.create(ve.prototype),gt=new qe(Ve||[]);return a(Be,"_invoke",{value:ce(ke,Re,gt)}),Be}function C(ke,Ne,Re){try{return{type:"normal",arg:ke.call(Ne,Re)}}catch(Ve){return{type:"throw",arg:Ve}}}e.wrap=T;var I="suspendedStart",D="suspendedYield",L="executing",B="completed",G={};function se(){}function ae(){}function M(){}var F={};E(F,d,function(){return this});var z=Object.getPrototypeOf,te=z&&z(z(St([])));te&&te!==r&&o.call(te,d)&&(F=te);var j=M.prototype=se.prototype=Object.create(F);function K(ke){["next","throw","return"].forEach(function(Ne){E(ke,Ne,function(Re){return this._invoke(Ne,Re)})})}function Q(ke,Ne){function Re(ve,Be,gt,ze){var _t=C(ke[ve],ke,Be);if(_t.type!=="throw"){var Dt=_t.arg,jt=Dt.value;return jt&&typeof jt=="object"&&o.call(jt,"__await")?Ne.resolve(jt.__await).then(function(Zt){Re("next",Zt,gt,ze)},function(Zt){Re("throw",Zt,gt,ze)}):Ne.resolve(jt).then(function(Zt){Dt.value=Zt,gt(Dt)},function(Zt){return Re("throw",Zt,gt,ze)})}ze(_t.arg)}var Ve;a(this,"_invoke",{value:function(ve,Be){function gt(){return new Ne(function(ze,_t){Re(ve,Be,ze,_t)})}return Ve=Ve?Ve.then(gt,gt):gt()}})}function ce(ke,Ne,Re){var Ve=I;return function(ve,Be){if(Ve===L)throw Error("Generator is already running");if(Ve===B){if(ve==="throw")throw Be;return{value:t,done:!0}}for(Re.method=ve,Re.arg=Be;;){var gt=Re.delegate;if(gt){var ze=Ee(gt,Re);if(ze){if(ze===G)continue;return ze}}if(Re.method==="next")Re.sent=Re._sent=Re.arg;else if(Re.method==="throw"){if(Ve===I)throw Ve=B,Re.arg;Re.dispatchException(Re.arg)}else Re.method==="return"&&Re.abrupt("return",Re.arg);Ve=L;var _t=C(ke,Ne,Re);if(_t.type==="normal"){if(Ve=Re.done?B:D,_t.arg===G)continue;return{value:_t.arg,done:Re.done}}_t.type==="throw"&&(Ve=B,Re.method="throw",Re.arg=_t.arg)}}}function Ee(ke,Ne){var Re=Ne.method,Ve=ke.iterator[Re];if(Ve===t)return Ne.delegate=null,Re==="throw"&&ke.iterator.return&&(Ne.method="return",Ne.arg=t,Ee(ke,Ne),Ne.method==="throw")||Re!=="return"&&(Ne.method="throw",Ne.arg=new TypeError("The iterator does not provide a '"+Re+"' method")),G;var ve=C(Ve,ke.iterator,Ne.arg);if(ve.type==="throw")return Ne.method="throw",Ne.arg=ve.arg,Ne.delegate=null,G;var Be=ve.arg;return Be?Be.done?(Ne[ke.resultName]=Be.value,Ne.next=ke.nextLoc,Ne.method!=="return"&&(Ne.method="next",Ne.arg=t),Ne.delegate=null,G):Be:(Ne.method="throw",Ne.arg=new TypeError("iterator result is not an object"),Ne.delegate=null,G)}function _e(ke){var Ne={tryLoc:ke[0]};1 in ke&&(Ne.catchLoc=ke[1]),2 in ke&&(Ne.finallyLoc=ke[2],Ne.afterLoc=ke[3]),this.tryEntries.push(Ne)}function pe(ke){var Ne=ke.completion||{};Ne.type="normal",delete Ne.arg,ke.completion=Ne}function qe(ke){this.tryEntries=[{tryLoc:"root"}],ke.forEach(_e,this),this.reset(!0)}function St(ke){if(ke||ke===""){var Ne=ke[d];if(Ne)return Ne.call(ke);if(typeof ke.next=="function")return ke;if(!isNaN(ke.length)){var Re=-1,Ve=function ve(){for(;++Re<ke.length;)if(o.call(ke,Re))return ve.value=ke[Re],ve.done=!1,ve;return ve.value=t,ve.done=!0,ve};return Ve.next=Ve}}throw new TypeError(typeof ke+" is not iterable")}return ae.prototype=M,a(j,"constructor",{value:M,configurable:!0}),a(M,"constructor",{value:ae,configurable:!0}),ae.displayName=E(M,g,"GeneratorFunction"),e.isGeneratorFunction=function(ke){var Ne=typeof ke=="function"&&ke.constructor;return!!Ne&&(Ne===ae||(Ne.displayName||Ne.name)==="GeneratorFunction")},e.mark=function(ke){return Object.setPrototypeOf?Object.setPrototypeOf(ke,M):(ke.__proto__=M,E(ke,g,"GeneratorFunction")),ke.prototype=Object.create(j),ke},e.awrap=function(ke){return{__await:ke}},K(Q.prototype),E(Q.prototype,f,function(){return this}),e.AsyncIterator=Q,e.async=function(ke,Ne,Re,Ve,ve){ve===void 0&&(ve=Promise);var Be=new Q(T(ke,Ne,Re,Ve),ve);return e.isGeneratorFunction(Ne)?Be:Be.next().then(function(gt){return gt.done?gt.value:Be.next()})},K(j),E(j,g,"Generator"),E(j,d,function(){return this}),E(j,"toString",function(){return"[object Generator]"}),e.keys=function(ke){var Ne=Object(ke),Re=[];for(var Ve in Ne)Re.push(Ve);return Re.reverse(),function ve(){for(;Re.length;){var Be=Re.pop();if(Be in Ne)return ve.value=Be,ve.done=!1,ve}return ve.done=!0,ve}},e.values=St,qe.prototype={constructor:qe,reset:function(ke){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(pe),!ke)for(var Ne in this)Ne.charAt(0)==="t"&&o.call(this,Ne)&&!isNaN(+Ne.slice(1))&&(this[Ne]=t)},stop:function(){this.done=!0;var ke=this.tryEntries[0].completion;if(ke.type==="throw")throw ke.arg;return this.rval},dispatchException:function(ke){if(this.done)throw ke;var Ne=this;function Re(_t,Dt){return Be.type="throw",Be.arg=ke,Ne.next=_t,Dt&&(Ne.method="next",Ne.arg=t),!!Dt}for(var Ve=this.tryEntries.length-1;Ve>=0;--Ve){var ve=this.tryEntries[Ve],Be=ve.completion;if(ve.tryLoc==="root")return Re("end");if(ve.tryLoc<=this.prev){var gt=o.call(ve,"catchLoc"),ze=o.call(ve,"finallyLoc");if(gt&&ze){if(this.prev<ve.catchLoc)return Re(ve.catchLoc,!0);if(this.prev<ve.finallyLoc)return Re(ve.finallyLoc)}else if(gt){if(this.prev<ve.catchLoc)return Re(ve.catchLoc,!0)}else{if(!ze)throw Error("try statement without catch or finally");if(this.prev<ve.finallyLoc)return Re(ve.finallyLoc)}}}},abrupt:function(ke,Ne){for(var Re=this.tryEntries.length-1;Re>=0;--Re){var Ve=this.tryEntries[Re];if(Ve.tryLoc<=this.prev&&o.call(Ve,"finallyLoc")&&this.prev<Ve.finallyLoc){var ve=Ve;break}}ve&&(ke==="break"||ke==="continue")&&ve.tryLoc<=Ne&&Ne<=ve.finallyLoc&&(ve=null);var Be=ve?ve.completion:{};return Be.type=ke,Be.arg=Ne,ve?(this.method="next",this.next=ve.finallyLoc,G):this.complete(Be)},complete:function(ke,Ne){if(ke.type==="throw")throw ke.arg;return ke.type==="break"||ke.type==="continue"?this.next=ke.arg:ke.type==="return"?(this.rval=this.arg=ke.arg,this.method="return",this.next="end"):ke.type==="normal"&&Ne&&(this.next=Ne),G},finish:function(ke){for(var Ne=this.tryEntries.length-1;Ne>=0;--Ne){var Re=this.tryEntries[Ne];if(Re.finallyLoc===ke)return this.complete(Re.completion,Re.afterLoc),pe(Re),G}},catch:function(ke){for(var Ne=this.tryEntries.length-1;Ne>=0;--Ne){var Re=this.tryEntries[Ne];if(Re.tryLoc===ke){var Ve=Re.completion;if(Ve.type==="throw"){var ve=Ve.arg;pe(Re)}return ve}}throw Error("illegal catch attempt")},delegateYield:function(ke,Ne,Re){return this.delegate={iterator:St(ke),resultName:Ne,nextLoc:Re},this.method==="next"&&(this.arg=t),G}},e}function gR(t,e){return gR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},gR(t,e)}function Gr(t,e){return function(r){if(Array.isArray(r))return r}(t)||function(r,o){var a=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(a!=null){var u,d,f,g,E=[],T=!0,C=!1;try{if(f=(a=a.call(r)).next,o===0){if(Object(a)!==a)return;T=!1}else for(;!(T=(u=f.call(a)).done)&&(E.push(u.value),E.length!==o);T=!0);}catch(I){C=!0,d=I}finally{try{if(!T&&a.return!=null&&(g=a.return(),Object(g)!==g))return}finally{if(C)throw d}}return E}}(t,e)||F5(t,e)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function bf(t,e,r,o){var a=yj(Sy(t.prototype),e,r);return 2&o&&typeof a=="function"?function(u){return a.apply(r,u)}:a}function Ps(t){return function(e){if(Array.isArray(e))return _j(e)}(t)||function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}(t)||F5(t)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Eue(t){var e=function(r,o){if(typeof r!="object"||!r)return r;var a=r[Symbol.toPrimitive];if(a!==void 0){var u=a.call(r,o);if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(r)}(t,"string");return typeof e=="symbol"?e:e+""}function vo(t){return vo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vo(t)}function F5(t,e){if(t){if(typeof t=="string")return _j(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_j(t,e):void 0}}function FT(t){var e=typeof Map=="function"?new Map:void 0;return FT=function(r){if(r===null||!function(a){try{return Function.toString.call(a).indexOf("[native code]")!==-1}catch{return typeof a=="function"}}(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,o)}function o(){return yue(r,arguments,Sy(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),gR(o,r)},FT(t)}var Sue={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},yee=Di.createContext&&Di.createContext(Sue),Ng=function(){return Ng=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},Ng.apply(this,arguments)},Aqe=function(t,e){var r={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(r[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function"){var a=0;for(o=Object.getOwnPropertySymbols(t);a<o.length;a++)e.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(t,o[a])&&(r[o[a]]=t[o[a]])}return r};function Tue(t){return t&&t.map(function(e,r){return Di.createElement(e.tag,Ng({key:r},e.attr),Tue(e.child))})}function bue(t){return function(e){return Di.createElement(kqe,Ng({attr:Ng({},t.attr)},e),Tue(t.child))}}function kqe(t){var e=function(r){var o,a=t.attr,u=t.size,d=t.title,f=Aqe(t,["attr","size","title"]),g=u||r.size||"1em";return r.className&&(o=r.className),t.className&&(o=(o?o+" ":"")+t.className),Di.createElement("svg",Ng({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,a,f,{className:o,style:Ng(Ng({color:t.color||r.color},r.style),t.style),height:g,width:g,xmlns:"http://www.w3.org/2000/svg"}),d&&Di.createElement("title",null,d),t.children)};return yee!==void 0?Di.createElement(yee.Consumer,null,function(r){return e(r)}):e(Sue)}function Oqe(t){return bue({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(t)}function Pqe(t){return bue({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(t)}var mg={exports:{}},Eee,See,Tee,bee;function Nqe(){return See?Eee:(See=1,Eee="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}mg.exports=function(){if(bee)return Tee;bee=1;var t=Nqe();function e(){}function r(){}return r.resetWarningCache=e,Tee=function(){function o(d,f,g,E,T,C){if(C!==t){var I=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw I.name="Invariant Violation",I}}function a(){return o}o.isRequired=o;var u={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:a,element:o,elementType:o,instanceOf:a,node:o,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:r,resetWarningCache:e};return u.PropTypes=u,u}}()();var Dqe=mR.createClient({mode:"rtc",codec:"vp8"}),wue=X.createContext(null),Cue=function(t){var e=t.children,r=t.appId,o=r===void 0?"130dccf9b3554bda87f8cf577f91c8c4":r,a=t.channel,u=a===void 0?null:a,d=t.token,f=d===void 0?null:d,g=t.uid,E=g===void 0?null:g,T=t.enabled,C=T===void 0||T,I=t.startMuted,D=I===void 0||I,L=t.onClientReady,B=L===void 0?function(){}:L,G=Gr(X.useState(!1),2),se=G[0],ae=G[1],M=Gr(X.useState(!1),2),F=M[0],z=M[1],te=Gr(X.useState([]),2),j=te[0],K=te[1],Q=Gr(X.useState(null),2),ce=Q[0],Ee=Q[1],_e=Gr(X.useState(null),2),pe=_e[0],qe=_e[1],St=Gr(X.useState(null),2),ke=St[0],Ne=St[1],Re=Gr(X.useState(!1),2),Ve=Re[0],ve=Re[1],Be=Gr(X.useState(!1),2),gt=Be[0],ze=Be[1],_t=Gr(X.useState(!1),2),Dt=_t[0],jt=_t[1],Zt=Gr(X.useState(null),2),Xt=Zt[0],In=Zt[1],Qt=X.useRef(Dqe),Er=X.useRef({appId:o,channel:u,uid:E,enabled:C}),Tn=X.useRef(!1),Vn=X.useRef(null);X.useRef(null),X.useEffect(function(){Er.current={appId:o,channel:u,uid:E,enabled:C},console.log("AgoraProvider: Updated props ref:",{appId:o,channel:u,uid:E,enabled:C})},[o,u,E,C]),X.useEffect(function(){console.log("AgoraProvider: Props changed:",{appId:o,channel:u,uid:E,enabled:C}),typeof window>"u"||window.agoraClient||(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Qt.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[o,u,E,C]),X.useEffect(function(){console.log("AgoraProvider: Setting current channel:",u),qe(u)},[u]),X.useEffect(function(){if(Qt.current){var at=function(ct){console.log("Connection state changed to: ".concat(ct)),ct==="DISCONNECTED"?(ae(!1),console.log("Disconnected from Agora")):ct==="CONNECTED"&&(ae(!0),Ee(null))};return Qt.current.on("connection-state-change",at),function(){Qt.current.off("connection-state-change",at)}}},[]),X.useEffect(function(){if(u&&C){console.log("AgoraProvider: Initial setup for channel",u,"with UID",E);var at=function(){var It=Ue(ue().mark(function Kt(Un,Fn){return ue().wrap(function(Yr){for(;;)switch(Yr.prev=Yr.next){case 0:return console.log("AgoraProvider: User published:",Un.uid,Fn),Yr.prev=1,Yr.next=4,Qt.current.subscribe(Un,Fn);case 4:console.log("AgoraProvider: Subscribed to user:",Un.uid,"mediaType:",Fn),Fn==="audio"&&(Un.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Un.uid)),K(function(Ns){return Ns.some(function($t){return $t.uid===Un.uid})?Ns:[].concat(Ps(Ns),[Un])}),Yr.next=12;break;case 9:Yr.prev=9,Yr.t0=Yr.catch(1),console.error("AgoraProvider: Error subscribing to user:",Yr.t0);case 12:case"end":return Yr.stop()}},Kt,null,[[1,9]])}));return function(Kt,Un){return It.apply(this,arguments)}}(),ct=function(It,Kt){console.log("AgoraProvider: User unpublished:",It.uid,Kt),Kt==="audio"&&It.audioTrack&&(It.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",It.uid))},Ke=function(It){console.log("AgoraProvider: User joined:",It.uid),K(function(Kt){return Kt.some(function(Un){return Un.uid===It.uid})?Kt:[].concat(Ps(Kt),[It])})},nt=function(It){console.log("AgoraProvider: User left:",It.uid),K(function(Kt){return Kt.filter(function(Un){return Un.uid!==It.uid})})};Qt.current.on("user-published",at),Qt.current.on("user-unpublished",ct),Qt.current.on("user-joined",Ke),Qt.current.on("user-left",nt);var At=function(){var It=Ue(ue().mark(function Kt(){var Un;return ue().wrap(function(Fn){for(;;)switch(Fn.prev=Fn.next){case 0:if(!Tn.current){Fn.next=3;break}return console.log("AgoraProvider: Already initializing, skipping duplicate initialization"),Fn.abrupt("return");case 3:return Tn.current=!0,Fn.prev=4,console.log("AgoraProvider: Initializing microphone"),Fn.next=8,wr();case 8:if(Un=Fn.sent,console.log("AgoraProvider: Microphone initialized:",!!Un),!se||Vn.current!==u){Fn.next=15;break}return console.log("AgoraProvider: Already joined to channel",u),ve(!0),B(Qt.current),Fn.abrupt("return");case 15:if(Qt.current.connectionState!=="CONNECTING"&&Qt.current.connectionState!=="CONNECTED"){Fn.next=36;break}if(console.log("AgoraProvider: Client already in connecting/connected state:",Qt.current.connectionState),!Vn.current||Vn.current===u){Fn.next=29;break}return console.log("AgoraProvider: Connected to different channel, leaving first"),Fn.prev=19,Fn.next=22,wn();case 22:Fn.next=27;break;case 24:Fn.prev=24,Fn.t0=Fn.catch(19),console.error("AgoraProvider: Error leaving channel:",Fn.t0);case 27:Fn.next=36;break;case 29:return console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),ae(!0),ve(!0),Vn.current=u,B(Qt.current),Fn.abrupt("return");case 36:return console.log("AgoraProvider: Joining channel",u,"current joined channel:",Vn.current),Fn.next=39,Pt();case 39:console.log("AgoraProvider: Join channel completed"),Fn.next=45;break;case 42:Fn.prev=42,Fn.t1=Fn.catch(4),console.error("AgoraProvider: Error during initialization:",Fn.t1);case 45:return Fn.prev=45,Tn.current=!1,Fn.finish(45);case 48:case"end":return Fn.stop()}},Kt,null,[[4,42,45,48],[19,24]])}));return function(){return It.apply(this,arguments)}}();return console.log("AgoraProvider: Running initialization"),At(),function(){console.log("AgoraProvider: Cleaning up event listeners"),Qt.current.off("user-published",at),Qt.current.off("user-unpublished",ct),Qt.current.off("user-joined",Ke),Qt.current.off("user-left",nt)}}console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:u,enabled:C})},[u,C,E,B,se]);var wr=function(){var at=Ue(ue().mark(function ct(){var Ke;return ue().wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:if(C&&!ke){nt.next=2;break}return nt.abrupt("return",ke);case 2:return console.log("Initializing microphone"),nt.prev=3,nt.next=6,mR.createMicrophoneAudioTrack();case 6:return Ke=nt.sent,nt.next=9,Ke.setMuted(D);case 9:return Ne(Ke),console.log("Microphone initialized successfully"),nt.abrupt("return",Ke);case 14:return nt.prev=14,nt.t0=nt.catch(3),console.error("Error initializing microphone:",nt.t0),Ee("Failed to initialize microphone. Please check your permissions."),nt.abrupt("return",null);case 19:case"end":return nt.stop()}},ct,null,[[3,14]])}));return function(){return at.apply(this,arguments)}}(),Pt=function(){var at=Ue(ue().mark(function ct(){var Ke,nt;return ue().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:if(C){At.next=3;break}return console.log("AgoraProvider: Agora is disabled, not joining channel"),At.abrupt("return",!1);case 3:if(u){At.next=7;break}return console.error("AgoraProvider: No channel specified"),Ee("No channel specified"),At.abrupt("return",!1);case 7:if(console.log("AgoraProvider: joinChannel called for channel",u,"with UID",E),console.log("AgoraProvider: Current state:",{isJoined:se,isJoining:gt,connectionState:Qt.current.connectionState,joinedChannel:Vn.current}),!se||Vn.current!==u){At.next=12;break}return console.log("AgoraProvider: Already joined to channel:",u),At.abrupt("return",!0);case 12:if(!gt){At.next=15;break}return console.log("AgoraProvider: Already in the process of joining"),At.abrupt("return",!1);case 15:if(Qt.current.connectionState!=="CONNECTED"){At.next=35;break}if(!Vn.current||Vn.current===u){At.next=28;break}return console.log("AgoraProvider: Connected to different channel, leaving first"),At.prev=18,At.next=21,wn();case 21:At.next=26;break;case 23:At.prev=23,At.t0=At.catch(18),console.error("AgoraProvider: Error leaving channel:",At.t0);case 26:At.next=35;break;case 28:return console.log("AgoraProvider: Client already connected, setting joined state to true"),ae(!0),ve(!0),Vn.current=u,B(Qt.current),At.abrupt("return",!0);case 35:if(Qt.current.connectionState!=="CONNECTING"){At.next=39;break}return console.log("AgoraProvider: Client already connecting, waiting for connection"),ze(!0),At.abrupt("return",new Promise(function(It){var Kt=setInterval(function(){Qt.current.connectionState==="CONNECTED"&&(clearInterval(Kt),ae(!0),ze(!1),ve(!0),Vn.current=u,B(Qt.current),It(!0))},500);setTimeout(function(){clearInterval(Kt),console.log("AgoraProvider: Connection timeout, considering join failed"),ze(!1),It(!1)},1e4)}));case 39:return At.prev=39,console.log("AgoraProvider: Joining channel:",u,"with UID:",E||"random"),ze(!0),Ke=E||Math.floor(1e6*Math.random()),At.next=45,Qt.current.join(o,u,f,Ke);case 45:if(console.log("AgoraProvider: Joined channel successfully with UID:",Qt.current.uid),ke){At.next=57;break}return At.next=49,wr();case 49:if(nt=At.sent,console.log("AgoraProvider: Microphone initialized in joinChannel:",!!nt),!nt||D){At.next=55;break}return At.next=54,Qt.current.publish(nt);case 54:console.log("AgoraProvider: Published microphone track");case 55:At.next=67;break;case 57:if(ke.muted||!F){At.next=67;break}return At.prev=58,At.next=61,Qt.current.publish(ke);case 61:console.log("AgoraProvider: Published existing microphone track"),At.next=67;break;case 64:At.prev=64,At.t1=At.catch(58),At.t1.message&&At.t1.message.includes("already published")?console.log("AgoraProvider: Microphone track already published"):console.error("AgoraProvider: Error publishing microphone track:",At.t1);case 67:return ae(!0),ze(!1),ve(!0),Vn.current=u,B(Qt.current),At.abrupt("return",!0);case 76:if(At.prev=76,At.t2=At.catch(39),console.error("AgoraProvider: Error joining channel:",At.t2),!At.t2.message||!At.t2.message.includes("already in connecting/connected state")&&!At.t2.message.includes("INVALID_OPERATION")){At.next=90;break}return console.log("AgoraProvider: Client already connected, considering join successful"),ae(!0),ze(!1),ve(!0),Vn.current=u,B(Qt.current),At.abrupt("return",!0);case 90:return Ee("Failed to join channel: ".concat(At.t2.message)),ze(!1),At.abrupt("return",!1);case 93:case"end":return At.stop()}},ct,null,[[18,23],[39,76],[58,64]])}));return function(){return at.apply(this,arguments)}}(),wn=function(){var at=Ue(ue().mark(function ct(){return ue().wrap(function(Ke){for(;;)switch(Ke.prev=Ke.next){case 0:if(se){Ke.next=2;break}return Ke.abrupt("return");case 2:if(Ke.prev=2,!ke){Ke.next=6;break}return Ke.next=6,Qt.current.unpublish(ke);case 6:return Ke.next=8,Qt.current.leave();case 8:Vn.current=null,console.log("Left channel successfully"),ae(!1),K([]),Ke.next=19;break;case 15:Ke.prev=15,Ke.t0=Ke.catch(2),console.error("Error leaving channel:",Ke.t0),Ee(Ke.t0.message||"Failed to leave channel");case 19:case"end":return Ke.stop()}},ct,null,[[2,15]])}));return function(){return at.apply(this,arguments)}}();X.useEffect(function(){return function(){ke&&ke.close()}},[]),X.useEffect(function(){!C||!u||se&&Vn.current===u||wr().then(function(){Pt()})},[C,u,se]),X.useEffect(function(){var at=function(){var Ke=function(){if(!ke)return!1;try{return ke.isActive&&!ke.muted}catch(nt){return console.error("Error checking microphone status:",nt),!1}}();Ke!==F&&(console.log("Syncing microphone state:",{actualStatus:Ke,currentState:F}),z(Ke),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Ke}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ke,window.agoraClient.microphoneTrack=ke))};ke&&at();var ct=setInterval(at,1e3);return function(){clearInterval(ct)}},[ke,F]);var Dn=function(){var at=Ue(ue().mark(function ct(){var Ke,nt,At;return ue().wrap(function(It){for(;;)switch(It.prev=It.next){case 0:if(It.prev=0,Ke=F!==void 0?F:!!ke&&!ke.muted,console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:F,currentState:Ke,hasMicTrack:!!ke,trackMuted:ke==null?void 0:ke.muted}),ke){It.next=11;break}return console.log("AgoraProvider: No microphone track, initializing..."),It.next=7,wr();case 7:if(It.sent){It.next=11;break}return console.error("AgoraProvider: Failed to initialize microphone"),It.abrupt("return",Ke);case 11:if(nt=!Ke,console.log("AgoraProvider: New voice state will be:",nt),!Ke){It.next=32;break}if(!ke){It.next=30;break}return It.prev=15,console.log("AgoraProvider: Muting microphone track"),It.next=19,ke.setMuted(!0);case 19:if(ke.muted){It.next=23;break}return console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),It.next=23,ke.setEnabled(!1);case 23:console.log("AgoraProvider: Microphone track muted successfully, muted state:",ke.muted),It.next=30;break;case 26:return It.prev=26,It.t0=It.catch(15),console.error("Error muting track:",It.t0),It.abrupt("return",Ke);case 30:It.next=53;break;case 32:if(!ke){It.next=53;break}if(It.prev=33,!Qt.current||!se||(At=Qt.current.localTracks)!==null&&At!==void 0&&At.includes(ke)){It.next=39;break}return console.log("AgoraProvider: Publishing microphone track"),It.next=38,Qt.current.publish(ke);case 38:console.log("AgoraProvider: Microphone track published successfully");case 39:return console.log("AgoraProvider: Unmuting microphone track"),It.next=42,ke.setMuted(!1);case 42:if(!ke.muted){It.next=46;break}return console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),It.next=46,ke.setEnabled(!0);case 46:console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",ke.muted),It.next=53;break;case 49:return It.prev=49,It.t1=It.catch(33),console.error("Error unmuting track:",It.t1),It.abrupt("return",Ke);case 53:return console.log("AgoraProvider: Setting voice enabled state to:",nt),z(nt),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=nt,window.agoraClient.microphoneTrack=ke,window.agoraClient.client=Qt.current,console.log("AgoraProvider: Updated window.agoraClient with new state:",nt)),typeof window<"u"&&(window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:nt}})),console.log("AgoraProvider: Dispatched VoiceToggled event with enabled:",nt)),It.next=59,new Promise(function(Kt){return setTimeout(Kt,100)});case 59:return It.abrupt("return",nt);case 62:return It.prev=62,It.t2=It.catch(0),console.error("Error toggling voice:",It.t2),It.abrupt("return",F);case 66:case"end":return It.stop()}},ct,null,[[0,62],[15,26],[33,49]])}));return function(){return at.apply(this,arguments)}}(),Ae=function(){var at=Ue(ue().mark(function ct(Ke){return ue().wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:nt.prev=0,Ne(Ke),console.log("Microphone track updated successfully"),nt.next=9;break;case 5:throw nt.prev=5,nt.t0=nt.catch(0),console.error("Error updating microphone track:",nt.t0),nt.t0;case 9:case"end":return nt.stop()}},ct,null,[[0,5]])}));return function(ct){return at.apply(this,arguments)}}(),$e=function(){var at=Ue(ue().mark(function ct(){var Ke;return ue().wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:if(Qt.current&&u){nt.next=3;break}return console.error("AgoraProvider: Voice chat not connected"),nt.abrupt("return",!1);case 3:if(nt.prev=3,!Dt){nt.next=23;break}if(console.log("AgoraProvider: Stopping screen share"),!Xt){nt.next=17;break}if(!Array.isArray(Xt)){nt.next=13;break}return nt.next=10,Qt.current.unpublish(Xt);case 10:Xt.forEach(function(At){return At.close()}),nt.next=16;break;case 13:return nt.next=15,Qt.current.unpublish(Xt);case 15:Xt.close();case 16:In(null);case 17:return jt(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),nt.abrupt("return",!1);case 23:return console.log("AgoraProvider: Starting screen share"),nt.prev=24,nt.next=27,mR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});case 27:return Ke=nt.sent,console.log("AgoraProvider: Screen track created:",Ke),Ke.on("track-ended",function(){console.log("AgoraProvider: Screen sharing ended by browser UI"),Qt.current.unpublish(Ke),Ke.close(),In(null),jt(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),nt.next=32,Qt.current.publish(Ke);case 32:return In(Ke),jt(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=Ke,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),nt.abrupt("return",!0);case 39:return nt.prev=39,nt.t0=nt.catch(24),console.error("AgoraProvider: Error creating screen track:",nt.t0),jt(!1),In(null),nt.abrupt("return",!1);case 45:nt.next=53;break;case 47:return nt.prev=47,nt.t1=nt.catch(3),console.error("AgoraProvider: Error toggling screen share:",nt.t1),jt(!1),In(null),nt.abrupt("return",!1);case 53:case"end":return nt.stop()}},ct,null,[[3,47],[24,39]])}));return function(){return at.apply(this,arguments)}}();X.useEffect(function(){if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Qt.current,isScreenSharing:!1,screenTrack:null};var at=function(Ke){console.log("AgoraProvider: Received ToggleScreenShare event"),$e().then(function(nt){Ke.detail&&Ke.detail.callback&&Ke.detail.callback(!0,nt)}).catch(function(nt){console.error("AgoraProvider: Error handling ToggleScreenShare event:",nt),Ke.detail&&Ke.detail.callback&&Ke.detail.callback(!1,Dt)})},ct=function(Ke){console.log("AgoraProvider: Received JoinVoiceChat event"),Pt().then(function(nt){Ke.detail&&Ke.detail.callback&&Ke.detail.callback(nt)}).catch(function(nt){console.error("AgoraProvider: Error handling JoinVoiceChat event:",nt),Ke.detail&&Ke.detail.callback&&Ke.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",at),window.addEventListener("JoinVoiceChat",ct),function(){window.removeEventListener("ToggleScreenShare",at),window.removeEventListener("JoinVoiceChat",ct),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return function(){typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),X.useEffect(function(){console.log("AgoraProvider: Voice enabled state changed:",F),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=F,window.agoraClient.microphoneTrack=ke,window.agoraClient.client=Qt.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:F}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:F}))},[F,ke]);var rt={client:Qt.current,isJoined:se,isVoiceEnabled:F,users:j,error:ce,channel:pe,appId:o,toggleVoice:Dn,leaveChannel:wn,joinChannel:Pt,microphoneTrack:ke,isReady:Ve,createMicrophoneTrack:Ae,isScreenSharing:Dt,screenTrack:Xt,toggleScreenShare:$e};return $.jsx(wue.Provider,{value:rt,children:e})},Rue=function(){var t=X.useContext(wue);if(!t)throw new Error("useAgoraContext must be used within an AgoraProvider");return t};Cue.propTypes={children:mg.exports.node.isRequired,appId:mg.exports.string.isRequired,channel:mg.exports.string.isRequired,token:mg.exports.string,uid:mg.exports.oneOfType([mg.exports.string,mg.exports.number])};var Lqe=function(){var t,e,r=Rue(),o=r.client,a=r.isVoiceEnabled,u=r.isJoined,d=r.users,f=r.error,g=r.microphoneTrack,E=r.isReady,T=r.channel,C=r.appId,I=r.toggleVoice,D=r.joinChannel,L=r.leaveChannel,B=r.createMicrophoneTrack,G=r.isScreenSharing,se=r.screenTrack,ae=r.toggleScreenShare,M=Gr(X.useState(a!==void 0?a:((t=window.agoraClient)===null||t===void 0?void 0:t.isVoiceEnabled)||!1),2),F=M[0],z=M[1],te=Gr(X.useState(G!==void 0?G:((e=window.agoraClient)===null||e===void 0?void 0:e.isScreenSharing)||!1),2),j=te[0],K=te[1],Q=Gr(X.useState(!0),2),ce=Q[0],Ee=Q[1];X.useEffect(function(){var Ve;a!==void 0?z(a):((Ve=window.agoraClient)===null||Ve===void 0?void 0:Ve.isVoiceEnabled)!==void 0?z(window.agoraClient.isVoiceEnabled):g&&z(!g.muted)},[a,g]),X.useEffect(function(){var Ve;G!==void 0?K(G):((Ve=window.agoraClient)===null||Ve===void 0?void 0:Ve.isScreenSharing)!==void 0&&K(window.agoraClient.isScreenSharing)},[G]);var _e=X.useRef({isVoiceEnabled:F,isScreenSharing:j,isJoined:u,users:d,error:f,isReady:E,channel:T,appId:C});X.useEffect(function(){_e.current={isVoiceEnabled:F,isScreenSharing:j,isJoined:u,users:d,error:f,isReady:E,channel:T,appId:C}},[F,j,u,d,f,E,T,C]),X.useEffect(function(){var Ve=setTimeout(function(){Ee(!1)},5e3);return function(){return clearTimeout(Ve)}},[]),X.useEffect(function(){E&&Ee(!1)},[E]),X.useEffect(function(){console.log("useVoiceChat context:",{contextIsVoiceEnabled:a,localVoiceEnabled:F,contextIsScreenSharing:G,localScreenSharing:j,isJoined:u,users:d.length,error:f,isReady:E,channel:T,appId:C,hasMicrophoneTrack:!!g,trackMuted:g==null?void 0:g.muted,hasScreenTrack:!!se})},[a,F,G,j,u,d,f,E,T,C,g,se]);var pe=function(){var Ve=Ue(ue().mark(function ve(){var Be,gt;return ue().wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:return ze.prev=0,console.log("useVoiceChat: Toggling voice from:",F),ze.next=4,I();case 4:return Be=ze.sent,console.log("useVoiceChat: Toggle result:",Be),Be!==void 0?z(Be):(z(gt=!F),window.agoraClient&&(window.agoraClient.isVoiceEnabled=gt)),ze.abrupt("return",Be!==void 0?Be:!F);case 10:return ze.prev=10,ze.t0=ze.catch(0),console.error("useVoiceChat: Error toggling voice:",ze.t0),ze.abrupt("return",F);case 14:case"end":return ze.stop()}},ve,null,[[0,10]])}));return function(){return Ve.apply(this,arguments)}}(),qe=function(){var Ve=Ue(ue().mark(function ve(){var Be,gt;return ue().wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:return ze.prev=0,console.log("useVoiceChat: Toggling screen share from:",j),ze.next=4,ae();case 4:return Be=ze.sent,console.log("useVoiceChat: Screen share toggle result:",Be),Be!==void 0?K(Be):(K(gt=!j),window.agoraClient&&(window.agoraClient.isScreenSharing=gt)),ze.abrupt("return",Be!==void 0?Be:!j);case 10:return ze.prev=10,ze.t0=ze.catch(0),console.error("useVoiceChat: Error toggling screen share:",ze.t0),ze.abrupt("return",j);case 14:case"end":return ze.stop()}},ve,null,[[0,10]])}));return function(){return Ve.apply(this,arguments)}}(),St=function(){var Ve=Ue(ue().mark(function ve(){return ue().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:if(!F||!g){Be.next=3;break}return Be.next=3,pe();case 3:case"end":return Be.stop()}},ve)}));return function(){return Ve.apply(this,arguments)}}(),ke=function(){var Ve=Ue(ue().mark(function ve(){return ue().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:if(F||!g){Be.next=3;break}return Be.next=3,pe();case 3:case"end":return Be.stop()}},ve)}));return function(){return Ve.apply(this,arguments)}}(),Ne=X.useCallback(function(){if(!g||!F)return 0;try{return g.getVolumeLevel()}catch(Ve){return console.error("Error getting volume level:",Ve),0}},[g,F]),Re=function(){var Ve=Ue(ue().mark(function ve(Be){var gt;return ue().wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:if(ze.prev=0,Be){ze.next=4;break}return console.error("No device ID provided"),ze.abrupt("return");case 4:if(o&&u){ze.next=7;break}return console.error("Client not initialized or not joined to a channel"),ze.abrupt("return");case 7:if(!g){ze.next=13;break}if(!F){ze.next=11;break}return ze.next=11,o.unpublish(g);case 11:return ze.next=13,g.close();case 13:return ze.next=15,mR.createMicrophoneAudioTrack({microphoneId:Be,encoderConfig:"music_standard"});case 15:if(gt=ze.sent,!B){ze.next=19;break}return ze.next=19,B(gt);case 19:if(!F){ze.next=22;break}return ze.next=22,o.publish(gt);case 22:console.log("Microphone device changed successfully"),ze.next=29;break;case 25:throw ze.prev=25,ze.t0=ze.catch(0),console.error("Error changing microphone device:",ze.t0),ze.t0;case 29:case"end":return ze.stop()}},ve,null,[[0,25]])}));return function(ve){return Ve.apply(this,arguments)}}();return{isVoiceEnabled:F,isScreenSharing:j,isJoined:u,users:d,error:f,toggleVoice:pe,toggleScreenShare:qe,mute:St,unmute:ke,isUserSpeaking:function(Ve){return d.some(function(ve){var Be;return ve.uid===Ve&&((Be=ve.audioTrack)===null||Be===void 0?void 0:Be.isPlaying)})},getVolumeLevel:Ne,microphoneTrack:g,screenTrack:se,isLoading:ce,channel:T,appId:C,joinChannel:D,leaveChannel:L,client:o,setMicrophoneDevice:Re}},Iue=function(){var t=new Date,e=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0"),o=t.getSeconds().toString().padStart(2,"0"),a=t.getMilliseconds().toString().padStart(3,"0");return"".concat(e,":").concat(r,":").concat(o,".").concat(a)},c1=function(){for(var t,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];var a=r.map(function(u,d){return d===0&&typeof u=="string"?`
`.concat(u):u});(t=console).log.apply(t,["[LOG] [".concat(Iue(),"] ")].concat(Ps(a)))},wee=function(){for(var t,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];var a=r.map(function(u,d){return d===0&&typeof u=="string"?`
`.concat(u):u});(t=console).error.apply(t,["[ERROR] [".concat(Iue(),"] ")].concat(Ps(a)))},xqe=function(t){var e=t.size,r=e===void 0?"md":e,o=t.tooltipPlacement,a=o===void 0?"top":o;t.defaultMuted;var u=t.joinOnClick,d=u===void 0||u,f=t.className,g=f===void 0?"voice-button":f,E=Lqe(),T=E.isVoiceEnabled,C=E.toggleVoice,I=E.isJoined,D=E.joinChannel,L=E.channel,B=E.client,G=Gr(X.useState(!1),2),se=G[0],ae=G[1],M=Gr(X.useState(!1),2),F=M[0],z=M[1];X.useEffect(function(){var j=function(){c1("VoiceButton: Player instantiated, showing button"),z(!0)};return window.addEventListener("PlayerInstantiated",j),window.isPlayerInstantiated&&(c1("VoiceButton: Player was already instantiated"),z(!0)),function(){window.removeEventListener("PlayerInstantiated",j)}},[]),X.useEffect(function(){console.log("VoiceButton: State:",{isVoiceEnabled:T,isJoined:I,channel:L,hasClient:!!B,clientState:B==null?void 0:B.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:F})},[T,I,L,B,F]);var te=function(){var j=Ue(ue().mark(function K(){var Q;return ue().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(!se){ce.next=2;break}return ce.abrupt("return");case 2:if(ae(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:T,isJoined:I}),ce.prev=4,I||!d){ce.next=16;break}return ce.prev=6,console.log("VoiceButton: Not joined, attempting to join channel"),ce.next=10,D();case 10:console.log("VoiceButton: Joined channel successfully"),ce.next=16;break;case 13:ce.prev=13,ce.t0=ce.catch(6),ce.t0.message&&ce.t0.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",ce.t0);case 16:return console.log("VoiceButton: Toggling voice state from:",T),ce.next=19,C();case 19:Q=ce.sent,console.log("VoiceButton: Voice toggled, new state:",Q),ce.next=26;break;case 23:ce.prev=23,ce.t1=ce.catch(4),console.error("VoiceButton: Error toggling voice:",ce.t1);case 26:return ce.prev=26,ae(!1),ce.finish(26);case 29:case"end":return ce.stop()}},K,null,[[4,23,26,29],[6,13]])}));return function(){return j.apply(this,arguments)}}();return F?$.jsx(FR,{label:F?se?"Processing...":I?T?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...",placement:a,hasArrow:!0,children:$.jsxs(sr,{position:"relative",cursor:"pointer",onClick:te,children:[$.jsx(cy,{size:r,borderRadius:"full",bg:T?"green.500":"red.500",icon:$.jsx(T?Pqe:Oqe,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:g,"data-testid":"voice-button"}),se&&$.jsx(sr,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:$.jsx(NR,{size:"sm",color:"white"})})]})}):null},Aue=function(t){for(var e=[],r=0,o=0;o<t.length;o++){var a=t.charCodeAt(o);a<128?e[r++]=a:a<2048?(e[r++]=a>>6|192,e[r++]=63&a|128):(64512&a)==55296&&o+1<t.length&&(64512&t.charCodeAt(o+1))==56320?(a=65536+((1023&a)<<10)+(1023&t.charCodeAt(++o)),e[r++]=a>>18|240,e[r++]=a>>12&63|128,e[r++]=a>>6&63|128,e[r++]=63&a|128):(e[r++]=a>>12|224,e[r++]=a>>6&63|128,e[r++]=63&a|128)}return e},kue={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[],a=0;a<t.length;a+=3){var u=t[a],d=a+1<t.length,f=d?t[a+1]:0,g=a+2<t.length,E=g?t[a+2]:0,T=u>>2,C=(3&u)<<4|f>>4,I=(15&f)<<2|E>>6,D=63&E;g||(D=64,d||(I=64)),o.push(r[T],r[C],r[I],r[D])}return o.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Aue(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(r){for(var o=[],a=0,u=0;a<r.length;){var d=r[a++];if(d<128)o[u++]=String.fromCharCode(d);else if(d>191&&d<224){var f=r[a++];o[u++]=String.fromCharCode((31&d)<<6|63&f)}else if(d>239&&d<365){var g=((7&d)<<18|(63&r[a++])<<12|(63&r[a++])<<6|63&r[a++])-65536;o[u++]=String.fromCharCode(55296+(g>>10)),o[u++]=String.fromCharCode(56320+(1023&g))}else{var E=r[a++],T=r[a++];o[u++]=String.fromCharCode((15&d)<<12|(63&E)<<6|63&T)}}return o.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var r=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[],a=0;a<t.length;){var u=r[t.charAt(a++)],d=a<t.length?r[t.charAt(a)]:0,f=++a<t.length?r[t.charAt(a)]:64,g=++a<t.length?r[t.charAt(a)]:64;if(++a,u==null||d==null||f==null||g==null)throw new Mqe;var E=u<<2|d>>4;if(o.push(E),f!==64){var T=d<<4&240|f>>2;if(o.push(T),g!==64){var C=f<<6&192|g;o.push(C)}}}return o},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},Mqe=function(){function t(){var e;return xe(this,t),(e=Jn(this,t,arguments)).name="DecodeBase64StringError",e}return Qn(t,FT(Error)),Me(t)}(),u1=function(t){return function(e){var r=Aue(e);return kue.encodeByteArray(r,!0)}(t).replace(/\./g,"")},Oue=function(t){try{return kue.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Uqe=function(){/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */return function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__},_D=function(){try{return Uqe()||function(){if(typeof process<"u"&&mee!==void 0){var t=mee.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0}}()||function(){if(typeof document<"u"){var t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}var e=t&&Oue(t[1]);return e&&JSON.parse(e)}}()}catch(t){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(t))}},Pue=function(t){var e,r;return(r=(e=_D())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[t]},Nue=function(){var t;return(t=_D())===null||t===void 0?void 0:t.config},Due=function(t){var e;return(e=_D())===null||e===void 0?void 0:e["_".concat(t)]},Vqe=function(){return Me(function t(){var e=this;xe(this,t),this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(r,o){e.resolve=r,e.reject=o})},[{key:"wrapCallback",value:function(t){var e=this;return function(r,o){r?e.reject(r):e.resolve(o),typeof t=="function"&&(e.promise.catch(function(){}),t.length===1?t(r):t(r,o))}}}])}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $c(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Fqe(){return!function(){var t,e=(t=_D())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function jqe(){try{return(typeof indexedDB>"u"?"undefined":vo(indexedDB))==="object"}catch{return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ky=function(){function t(e,r,o){var a;return xe(this,t),(a=Jn(this,t,[r])).code=e,a.customData=o,a.name="FirebaseError",Object.setPrototypeOf(a,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(a,nI.prototype.create),a}return Qn(t,FT(Error)),Me(t)}(),nI=function(){return Me(function t(e,r,o){xe(this,t),this.service=e,this.serviceName=r,this.errors=o},[{key:"create",value:function(t){var e=(arguments.length<=1?void 0:arguments[1])||{},r="".concat(this.service,"/").concat(t),o=this.errors[t],a=o?function(d,f){return d.replace(Bqe,function(g,E){var T=f[E];return T!=null?String(T):"<".concat(E,"?>")})}(o,e):"Error",u="".concat(this.serviceName,": ").concat(a," (").concat(r,").");return new ky(r,u,e)}}])}(),Bqe=/\{\$([^}]+)}/g;function Wqe(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function l1(t,e){if(t===e)return!0;for(var r=Object.keys(t),o=Object.keys(e),a=0,u=r;a<u.length;a++){var d=u[a];if(!o.includes(d))return!1;var f=t[d],g=e[d];if(Cee(f)&&Cee(g)){if(!l1(f,g))return!1}else if(f!==g)return!1}for(var E=0,T=o;E<T.length;E++){var C=T[E];if(!r.includes(C))return!1}return!0}function Cee(t){return t!==null&&vo(t)==="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rI(t){for(var e=[],r=function(){var u=Gr(a[o],2),d=u[0],f=u[1];Array.isArray(f)?f.forEach(function(g){e.push(encodeURIComponent(d)+"="+encodeURIComponent(g))}):e.push(encodeURIComponent(d)+"="+encodeURIComponent(f))},o=0,a=Object.entries(t);o<a.length;o++)r();return e.length?"&"+e.join("&"):""}function Gw(t){var e={};return t.replace(/^\?/,"").split("&").forEach(function(r){if(r){var o=Gr(r.split("="),2),a=o[0],u=o[1];e[decodeURIComponent(a)]=decodeURIComponent(u)}}),e}function Hw(t){var e=t.indexOf("?");if(!e)return"";var r=t.indexOf("#",e);return t.substring(e,r>0?r:void 0)}var zqe=function(){return Me(function t(e,r){var o=this;xe(this,t),this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(function(){e(o)}).catch(function(a){o.error(a)})},[{key:"next",value:function(t){this.forEachObserver(function(e){e.next(t)})}},{key:"error",value:function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)}},{key:"complete",value:function(){this.forEachObserver(function(t){t.complete()}),this.close()}},{key:"subscribe",value:function(t,e,r){var o,a=this;if(t===void 0&&e===void 0&&r===void 0)throw new Error("Missing Observer.");(o=function(d,f){if(vo(d)!=="object"||d===null)return!1;var g,E=pn(f);try{for(E.s();!(g=E.n()).done;){var T=g.value;if(T in d&&typeof d[T]=="function")return!0}}catch(C){E.e(C)}finally{E.f()}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:r}).next===void 0&&(o.next=O2),o.error===void 0&&(o.error=O2),o.complete===void 0&&(o.complete=O2);var u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{a.finalError?o.error(a.finalError):o.complete()}catch{}}),this.observers.push(o),u}},{key:"unsubscribeOne",value:function(t){this.observers!==void 0&&this.observers[t]!==void 0&&(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}},{key:"forEachObserver",value:function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)}},{key:"sendOne",value:function(t,e){var r=this;this.task.then(function(){if(r.observers!==void 0&&r.observers[t]!==void 0)try{e(r.observers[t])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}},{key:"close",value:function(t){var e=this;this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))}}])}();function O2(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gg(t){return t&&t._delegate?t._delegate:t}var Ty=function(){return Me(function t(e,r,o){xe(this,t),this.name=e,this.instanceFactory=r,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null},[{key:"setInstantiationMode",value:function(t){return this.instantiationMode=t,this}},{key:"setMultipleInstances",value:function(t){return this.multipleInstances=t,this}},{key:"setServiceProps",value:function(t){return this.serviceProps=t,this}},{key:"setInstanceCreatedCallback",value:function(t){return this.onInstanceCreated=t,this}}])}(),O_="[DEFAULT]",Gqe=function(){return Me(function e(r,o){xe(this,e),this.name=r,this.container=o,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map},[{key:"get",value:function(e){var r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){var o=new Vqe;if(this.instancesDeferred.set(r,o),this.isInitialized(r)||this.shouldAutoInitialize())try{var a=this.getOrInitializeService({instanceIdentifier:r});a&&o.resolve(a)}catch{}}return this.instancesDeferred.get(r).promise}},{key:"getImmediate",value:function(e){var r,o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(r=e==null?void 0:e.optional)!==null&&r!==void 0&&r;if(!this.isInitialized(o)&&!this.shouldAutoInitialize()){if(a)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:o})}catch(u){if(a)return null;throw u}}},{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(E){return E.instantiationMode==="EAGER"}(e))try{this.getOrInitializeService({instanceIdentifier:O_})}catch{}var r,o=pn(this.instancesDeferred.entries());try{for(o.s();!(r=o.n()).done;){var a=Gr(r.value,2),u=a[0],d=a[1],f=this.normalizeInstanceIdentifier(u);try{var g=this.getOrInitializeService({instanceIdentifier:f});d.resolve(g)}catch{}}}catch(E){o.e(E)}finally{o.f()}}}},{key:"clearInstance",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:O_;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}},{key:"delete",value:(t=Ue(ue().mark(function e(){var r;return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return r=Array.from(this.instances.values()),o.next=3,Promise.all([].concat(Ps(r.filter(function(a){return"INTERNAL"in a}).map(function(a){return a.INTERNAL.delete()})),Ps(r.filter(function(a){return"_delete"in a}).map(function(a){return a._delete()}))));case 3:case"end":return o.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"isComponentSet",value:function(){return this.component!=null}},{key:"isInitialized",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:O_;return this.instances.has(e)}},{key:"getOptions",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:O_;return this.instancesOptions.get(e)||{}}},{key:"initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.options,o=r===void 0?{}:r,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error("".concat(this.name,"(").concat(a,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));var u,d=this.getOrInitializeService({instanceIdentifier:a,options:o}),f=pn(this.instancesDeferred.entries());try{for(f.s();!(u=f.n()).done;){var g=Gr(u.value,2),E=g[0],T=g[1];a===this.normalizeInstanceIdentifier(E)&&T.resolve(d)}}catch(C){f.e(C)}finally{f.f()}return d}},{key:"onInit",value:function(e,r){var o,a=this.normalizeInstanceIdentifier(r),u=(o=this.onInitCallbacks.get(a))!==null&&o!==void 0?o:new Set;u.add(e),this.onInitCallbacks.set(a,u);var d=this.instances.get(a);return d&&e(d,a),function(){u.delete(e)}}},{key:"invokeOnInitCallbacks",value:function(e,r){var o=this.onInitCallbacks.get(r);if(o){var a,u=pn(o);try{for(u.s();!(a=u.n()).done;){var d=a.value;try{d(e,r)}catch{}}}catch(f){u.e(f)}finally{u.f()}}}},{key:"getOrInitializeService",value:function(e){var r,o=e.instanceIdentifier,a=e.options,u=a===void 0?{}:a,d=this.instances.get(o);if(!d&&this.component&&(d=this.component.instanceFactory(this.container,{instanceIdentifier:(r=o,r===O_?void 0:r),options:u}),this.instances.set(o,d),this.instancesOptions.set(o,u),this.invokeOnInitCallbacks(d,o),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,o,d)}catch{}return d||null}},{key:"normalizeInstanceIdentifier",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:O_;return this.component?this.component.multipleInstances?e:O_:e}},{key:"shouldAutoInitialize",value:function(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}]);var t}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ai,Hqe=function(){return Me(function t(e){xe(this,t),this.name=e,this.providers=new Map},[{key:"addComponent",value:function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component ".concat(t.name," has already been registered with ").concat(this.name));e.setComponent(t)}},{key:"addOrOverwriteComponent",value:function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}},{key:"getProvider",value:function(t){if(this.providers.has(t))return this.providers.get(t);var e=new Gqe(t,this);return this.providers.set(t,e),e}},{key:"getProviders",value:function(){return Array.from(this.providers.values())}}])}();(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ai||(ai={}));var Ree,Iee,Kqe={debug:ai.DEBUG,verbose:ai.VERBOSE,info:ai.INFO,warn:ai.WARN,error:ai.ERROR,silent:ai.SILENT},qqe=ai.INFO,$qe=Lt(Lt(Lt(Lt(Lt({},ai.DEBUG,"log"),ai.VERBOSE,"log"),ai.INFO,"info"),ai.WARN,"warn"),ai.ERROR,"error"),Yqe=function(t,e){if(!(e<t.logLevel)){var r=new Date().toISOString(),o=$qe[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(e,")"));for(var a,u=arguments.length,d=new Array(u>2?u-2:0),f=2;f<u;f++)d[f-2]=arguments[f];(a=console)[o].apply(a,["[".concat(r,"]  ").concat(t.name,":")].concat(d))}},j5=function(){return Me(function t(e){xe(this,t),this.name=e,this._logLevel=qqe,this._logHandler=Yqe,this._userLogHandler=null},[{key:"logLevel",get:function(){return this._logLevel},set:function(t){if(!(t in ai))throw new TypeError('Invalid value "'.concat(t,'" assigned to `logLevel`'));this._logLevel=t}},{key:"setLogLevel",value:function(t){this._logLevel=typeof t=="string"?Kqe[t]:t}},{key:"logHandler",get:function(){return this._logHandler},set:function(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}},{key:"userLogHandler",get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t}},{key:"debug",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this._userLogHandler&&this._userLogHandler.apply(this,[this,ai.DEBUG].concat(e)),this._logHandler.apply(this,[this,ai.DEBUG].concat(e))}},{key:"log",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this._userLogHandler&&this._userLogHandler.apply(this,[this,ai.VERBOSE].concat(e)),this._logHandler.apply(this,[this,ai.VERBOSE].concat(e))}},{key:"info",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this._userLogHandler&&this._userLogHandler.apply(this,[this,ai.INFO].concat(e)),this._logHandler.apply(this,[this,ai.INFO].concat(e))}},{key:"warn",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this._userLogHandler&&this._userLogHandler.apply(this,[this,ai.WARN].concat(e)),this._logHandler.apply(this,[this,ai.WARN].concat(e))}},{key:"error",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this._userLogHandler&&this._userLogHandler.apply(this,[this,ai.ERROR].concat(e)),this._logHandler.apply(this,[this,ai.ERROR].concat(e))}}])}(),Lue=new WeakMap,Sj=new WeakMap,xue=new WeakMap,P2=new WeakMap,Tj=new WeakMap,bj={get:function(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return Sj.get(t);if(e==="objectStoreNames")return t.objectStoreNames||xue.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Dg(t[e])},set:function(t,e,r){return t[e]=r,!0},has:function(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")||e in t}};function Xqe(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Iee||(Iee=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return t.apply(N2(this),r),Dg(Lue.get(this))}:function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return Dg(t.apply(N2(this),r))}:function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];var u=t.call.apply(t,[N2(this),e].concat(o));return xue.set(u,e.sort?e.sort():[e]),Dg(u)}}function Jqe(t){return typeof t=="function"?Xqe(t):(t instanceof IDBTransaction&&function(r){if(!Sj.has(r)){var o=new Promise(function(a,u){var d=function(){r.removeEventListener("complete",f),r.removeEventListener("error",g),r.removeEventListener("abort",g)},f=function(){a(),d()},g=function(){u(r.error||new DOMException("AbortError","AbortError")),d()};r.addEventListener("complete",f),r.addEventListener("error",g),r.addEventListener("abort",g)});Sj.set(r,o)}}(t),e=t,(Ree||(Ree=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(function(r){return e instanceof r})?new Proxy(t,bj):t);var e}function Dg(t){if(t instanceof IDBRequest)return e=t,(r=new Promise(function(a,u){var d=function(){e.removeEventListener("success",f),e.removeEventListener("error",g)},f=function(){a(Dg(e.result)),d()},g=function(){u(e.error),d()};e.addEventListener("success",f),e.addEventListener("error",g)})).then(function(a){a instanceof IDBCursor&&Lue.set(a,e)}).catch(function(){}),Tj.set(r,e),r;var e,r;if(P2.has(t))return P2.get(t);var o=Jqe(t);return o!==t&&(P2.set(t,o),Tj.set(o,t)),o}var N2=function(t){return Tj.get(t)},D2,Aee,Qqe=["get","getKey","getAll","getAllKeys","count"],Zqe=["put","add","delete","clear"],L2=new Map;function kee(t,e){if(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"){if(L2.get(e))return L2.get(e);var r=e.replace(/FromIndex$/,""),o=e!==r,a=Zqe.includes(r);if(r in(o?IDBIndex:IDBObjectStore).prototype&&(a||Qqe.includes(r))){var u=function(){var d=Ue(ue().mark(function f(g){var E,T,C,I,D,L,B=arguments;return ue().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:for(T=this.transaction(g,a?"readwrite":"readonly"),C=T.store,I=B.length,D=new Array(I>1?I-1:0),L=1;L<I;L++)D[L-1]=B[L];return o&&(C=C.index(D.shift())),G.next=6,Promise.all([(E=C)[r].apply(E,D),a&&T.done]);case 6:return G.abrupt("return",G.sent[0]);case 7:case"end":return G.stop()}},f,this)}));return function(f){return d.apply(this,arguments)}}();return L2.set(e,u),u}}}bj=function(t){return Ej(Ej({},t),{},{get:function(e,r,o){return kee(e,r)||t.get(e,r,o)},has:function(e,r){return!!kee(e,r)||t.has(e,r)}})}(bj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var e3e=function(){return Me(function t(e){xe(this,t),this.container=e},[{key:"getPlatformInfoString",value:function(){return this.container.getProviders().map(function(t){if(function(r){var o=r.getComponent();return(o==null?void 0:o.type)==="VERSION"}(t)){var e=t.getImmediate();return"".concat(e.library,"/").concat(e.version)}return null}).filter(function(t){return t}).join(" ")}}])}(),wj="@firebase/app",Oee="0.10.13",Zp=new j5("@firebase/app"),Cj="[DEFAULT]",t3e=(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(D2={},wj,"fire-core"),"@firebase/app-compat","fire-core-compat"),"@firebase/analytics","fire-analytics"),"@firebase/analytics-compat","fire-analytics-compat"),"@firebase/app-check","fire-app-check"),"@firebase/app-check-compat","fire-app-check-compat"),"@firebase/auth","fire-auth"),"@firebase/auth-compat","fire-auth-compat"),"@firebase/database","fire-rtdb"),"@firebase/data-connect","fire-data-connect"),Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(D2,"@firebase/database-compat","fire-rtdb-compat"),"@firebase/functions","fire-fn"),"@firebase/functions-compat","fire-fn-compat"),"@firebase/installations","fire-iid"),"@firebase/installations-compat","fire-iid-compat"),"@firebase/messaging","fire-fcm"),"@firebase/messaging-compat","fire-fcm-compat"),"@firebase/performance","fire-perf"),"@firebase/performance-compat","fire-perf-compat"),"@firebase/remote-config","fire-rc"),Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(D2,"@firebase/remote-config-compat","fire-rc-compat"),"@firebase/storage","fire-gcs"),"@firebase/storage-compat","fire-gcs-compat"),"@firebase/firestore","fire-fst"),"@firebase/firestore-compat","fire-fst-compat"),"@firebase/vertexai-preview","fire-vertex"),"fire-js","fire-js"),"firebase","fire-js-all")),d1=new Map,n3e=new Map,Rj=new Map;function Pee(t,e){try{t.container.addComponent(e)}catch(r){Zp.debug("Component ".concat(e.name," failed to register with FirebaseApp ").concat(t.name),r)}}function jT(t){var e=t.name;if(Rj.has(e))return Zp.debug("There were multiple attempts to register component ".concat(e,".")),!1;Rj.set(e,t);var r,o=pn(d1.values());try{for(o.s();!(r=o.n()).done;)Pee(r.value,t)}catch(d){o.e(d)}finally{o.f()}var a,u=pn(n3e.values());try{for(u.s();!(a=u.n()).done;)Pee(a.value,t)}catch(d){u.e(d)}finally{u.f()}return!0}function Ij(t,e){var r=t.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),t.container.getProvider(e)}function Cg(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var r3e=(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Aee={},"no-app","No Firebase App '{$appName}' has been created - call initializeApp() first"),"bad-app-name","Illegal App name: '{$appName}'"),"duplicate-app","Firebase App named '{$appName}' already exists with different options or config"),"app-deleted","Firebase App named '{$appName}' already deleted"),"server-app-deleted","Firebase Server App has been deleted"),"no-options","Need to provide options, when not being deployed to hosting via source."),"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),"invalid-log-argument","First argument to `onLog` must be null or a function."),"idb-open","Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}."),"idb-get","Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}."),Lt(Lt(Lt(Lt(Aee,"idb-set","Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}."),"idb-delete","Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."),"finalization-registry-not-supported","FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry."),"invalid-server-app-environment","FirebaseServerApp is not for use in browser environments.")),Lg=new nI("app","Firebase",r3e),i3e=function(){return Me(function t(e,r,o){var a=this;xe(this,t),this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new Ty("app",function(){return a},"PUBLIC"))},[{key:"automaticDataCollectionEnabled",get:function(){return this.checkDestroyed(),this._automaticDataCollectionEnabled},set:function(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}},{key:"name",get:function(){return this.checkDestroyed(),this._name}},{key:"options",get:function(){return this.checkDestroyed(),this._options}},{key:"config",get:function(){return this.checkDestroyed(),this._config}},{key:"container",get:function(){return this._container}},{key:"isDeleted",get:function(){return this._isDeleted},set:function(t){this._isDeleted=t}},{key:"checkDestroyed",value:function(){if(this.isDeleted)throw Lg.create("app-deleted",{appName:this._name})}}])}(),r0="10.14.1";function Mue(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t;vo(e)!=="object"&&(e={name:e});var o=Object.assign({name:Cj,automaticDataCollectionEnabled:!1},e),a=o.name;if(typeof a!="string"||!a)throw Lg.create("bad-app-name",{appName:String(a)});if(r||(r=Nue()),!r)throw Lg.create("no-options");var u=d1.get(a);if(u){if(l1(r,u.options)&&l1(o,u.config))return u;throw Lg.create("duplicate-app",{appName:a})}var d,f=new Hqe(a),g=pn(Rj.values());try{for(g.s();!(d=g.n()).done;){var E=d.value;f.addComponent(E)}}catch(C){g.e(C)}finally{g.f()}var T=new i3e(r,o,f);return d1.set(a,T),T}function Uue(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Cj,e=d1.get(t);if(!e&&t===Cj&&Nue())return Mue();if(!e)throw Lg.create("no-app",{appName:t});return e}function xg(t,e,r){var o,a=(o=t3e[t])!==null&&o!==void 0?o:t;r&&(a+="-".concat(r));var u=a.match(/\s|\//),d=e.match(/\s|\//);if(u||d){var f=['Unable to register library "'.concat(a,'" with version "').concat(e,'":')];return u&&f.push('library name "'.concat(a,'" contains illegal characters (whitespace or "/")')),u&&d&&f.push("and"),d&&f.push('version name "'.concat(e,'" contains illegal characters (whitespace or "/")')),void Zp.warn(f.join(" "))}jT(new Ty("".concat(a,"-version"),function(){return{library:a,version:e}},"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vR="firebase-heartbeat-store",x2=null;function Vue(){return x2||(x2=function(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=r.blocked,a=r.upgrade,u=r.blocking,d=r.terminated,f=indexedDB.open(t,e),g=Dg(f);return a&&f.addEventListener("upgradeneeded",function(E){a(Dg(f.result),E.oldVersion,E.newVersion,Dg(f.transaction),E)}),o&&f.addEventListener("blocked",function(E){return o(E.oldVersion,E.newVersion,E)}),g.then(function(E){d&&E.addEventListener("close",function(){return d()}),u&&E.addEventListener("versionchange",function(T){return u(T.oldVersion,T.newVersion,T)})}).catch(function(){}),g}("firebase-heartbeat-database",1,{upgrade:function(t,e){if(e===0)try{t.createObjectStore(vR)}catch(r){console.warn(r)}}}).catch(function(t){throw Lg.create("idb-open",{originalErrorMessage:t.message})})),x2}function s3e(t){return Aj.apply(this,arguments)}function Aj(){return Aj=Ue(ue().mark(function t(e){var r,o,a,u;return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,d.next=3,Vue();case 3:return r=d.sent,o=r.transaction(vR),d.next=7,o.objectStore(vR).get(Fue(e));case 7:return a=d.sent,d.next=10,o.done;case 10:return d.abrupt("return",a);case 13:d.prev=13,d.t0=d.catch(0),d.t0 instanceof ky?Zp.warn(d.t0.message):(u=Lg.create("idb-get",{originalErrorMessage:d.t0===null||d.t0===void 0?void 0:d.t0.message}),Zp.warn(u.message));case 16:case"end":return d.stop()}},t,null,[[0,13]])})),Aj.apply(this,arguments)}function Nee(t,e){return kj.apply(this,arguments)}function kj(){return kj=Ue(ue().mark(function t(e,r){var o,a,u,d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,Vue();case 3:return o=f.sent,a=o.transaction(vR,"readwrite"),u=a.objectStore(vR),f.next=8,u.put(r,Fue(e));case 8:return f.next=10,a.done;case 10:f.next=15;break;case 12:f.prev=12,f.t0=f.catch(0),f.t0 instanceof ky?Zp.warn(f.t0.message):(d=Lg.create("idb-set",{originalErrorMessage:f.t0===null||f.t0===void 0?void 0:f.t0.message}),Zp.warn(d.message));case 15:case"end":return f.stop()}},t,null,[[0,12]])})),kj.apply(this,arguments)}function Fue(t){return"".concat(t.name,"!").concat(t.options.appId)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var o3e=function(){return Me(function r(o){var a=this;xe(this,r),this.container=o,this._heartbeatsCache=null;var u=this.container.getProvider("app").getImmediate();this._storage=new c3e(u),this._heartbeatsCachePromise=this._storage.read().then(function(d){return a._heartbeatsCache=d,d})},[{key:"triggerHeartbeat",value:(e=Ue(ue().mark(function r(){var o,a,u,d,f;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(g.prev=0,u=this.container.getProvider("platform-logger").getImmediate(),d=u.getPlatformInfoString(),f=Dee(),((o=this._heartbeatsCache)===null||o===void 0?void 0:o.heartbeats)!=null){g.next=10;break}return g.next=7,this._heartbeatsCachePromise;case 7:if(this._heartbeatsCache=g.sent,((a=this._heartbeatsCache)===null||a===void 0?void 0:a.heartbeats)!=null){g.next=10;break}return g.abrupt("return");case 10:if(this._heartbeatsCache.lastSentHeartbeatDate!==f&&!this._heartbeatsCache.heartbeats.some(function(E){return E.date===f})){g.next=14;break}return g.abrupt("return");case 14:this._heartbeatsCache.heartbeats.push({date:f,agent:d});case 15:return this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(function(E){var T=new Date(E.date).valueOf();return Date.now()-T<=2592e6}),g.abrupt("return",this._storage.overwrite(this._heartbeatsCache));case 19:g.prev=19,g.t0=g.catch(0),Zp.warn(g.t0);case 22:case"end":return g.stop()}},r,this,[[0,19]])})),function(){return e.apply(this,arguments)})},{key:"getHeartbeatsHeader",value:(t=Ue(ue().mark(function r(){var o,a,u,d,f,g;return ue().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(E.prev=0,this._heartbeatsCache!==null){E.next=4;break}return E.next=4,this._heartbeatsCachePromise;case 4:if(((o=this._heartbeatsCache)===null||o===void 0?void 0:o.heartbeats)!=null&&this._heartbeatsCache.heartbeats.length!==0){E.next=6;break}return E.abrupt("return","");case 6:if(a=Dee(),u=a3e(this._heartbeatsCache.heartbeats),d=u.heartbeatsToSend,f=u.unsentEntries,g=u1(JSON.stringify({version:2,heartbeats:d})),this._heartbeatsCache.lastSentHeartbeatDate=a,!(f.length>0)){E.next=16;break}return this._heartbeatsCache.heartbeats=f,E.next=14,this._storage.overwrite(this._heartbeatsCache);case 14:E.next=18;break;case 16:this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache);case 18:return E.abrupt("return",g);case 21:return E.prev=21,E.t0=E.catch(0),Zp.warn(E.t0),E.abrupt("return","");case 25:case"end":return E.stop()}},r,this,[[0,21]])})),function(){return t.apply(this,arguments)})}]);var t,e}();function Dee(){return new Date().toISOString().substring(0,10)}function a3e(t){var e,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1024,o=[],a=t.slice(),u=pn(t);try{var d=function(){var f=e.value,g=o.find(function(E){return E.agent===f.agent});if(g){if(g.dates.push(f.date),xee(o)>r)return g.dates.pop(),0}else if(o.push({agent:f.agent,dates:[f.date]}),xee(o)>r)return o.pop(),0;a=a.slice(1)};for(u.s();!(e=u.n()).done&&d()!==0;);}catch(f){u.e(f)}finally{u.f()}return{heartbeatsToSend:o,unsentEntries:a}}var Lee,c3e=function(){return Me(function a(u){xe(this,a),this.app=u,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()},[{key:"runIndexedDBEnvironmentCheck",value:(o=Ue(ue().mark(function a(){return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(jqe()){u.next=4;break}return u.abrupt("return",!1);case 4:return u.abrupt("return",new Promise(function(d,f){try{var g=!0,E="validate-browser-context-for-indexeddb-analytics-module",T=self.indexedDB.open(E);T.onsuccess=function(){T.result.close(),g||self.indexedDB.deleteDatabase(E),d(!0)},T.onupgradeneeded=function(){g=!1},T.onerror=function(){var C;f(((C=T.error)===null||C===void 0?void 0:C.message)||"")}}catch(C){f(C)}}).then(function(){return!0}).catch(function(){return!1}));case 5:case"end":return u.stop()}},a)})),function(){return o.apply(this,arguments)})},{key:"read",value:(r=Ue(ue().mark(function a(){var u;return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this._canUseIndexedDBPromise;case 2:if(d.sent){d.next=7;break}return d.abrupt("return",{heartbeats:[]});case 7:return d.next=9,s3e(this.app);case 9:if(!((u=d.sent)!=null&&u.heartbeats)){d.next=14;break}return d.abrupt("return",u);case 14:return d.abrupt("return",{heartbeats:[]});case 15:case"end":return d.stop()}},a,this)})),function(){return r.apply(this,arguments)})},{key:"overwrite",value:(e=Ue(ue().mark(function a(u){var d,f;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this._canUseIndexedDBPromise;case 2:if(g.sent){g.next=7;break}return g.abrupt("return");case 7:return g.next=9,this.read();case 9:return f=g.sent,g.abrupt("return",Nee(this.app,{lastSentHeartbeatDate:(d=u.lastSentHeartbeatDate)!==null&&d!==void 0?d:f.lastSentHeartbeatDate,heartbeats:u.heartbeats}));case 11:case"end":return g.stop()}},a,this)})),function(a){return e.apply(this,arguments)})},{key:"add",value:(t=Ue(ue().mark(function a(u){var d,f;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this._canUseIndexedDBPromise;case 2:if(g.sent){g.next=7;break}return g.abrupt("return");case 7:return g.next=9,this.read();case 9:return f=g.sent,g.abrupt("return",Nee(this.app,{lastSentHeartbeatDate:(d=u.lastSentHeartbeatDate)!==null&&d!==void 0?d:f.lastSentHeartbeatDate,heartbeats:[].concat(Ps(f.heartbeats),Ps(u.heartbeats))}));case 11:case"end":return g.stop()}},a,this)})),function(a){return t.apply(this,arguments)})}]);var t,e,r,o}();function xee(t){return u1(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Lee="",jT(new Ty("platform-logger",function(t){return new e3e(t)},"PRIVATE")),jT(new Ty("heartbeat",function(t){return new o3e(t)},"PRIVATE")),xg(wj,Oee,Lee),xg(wj,Oee,"esm2017"),xg("fire-js","");var ny,jue,Mee=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/(function(){var t;/** @license
         Copyright The Closure Library Authors.
         SPDX-License-Identifier: Apache-2.0
         */function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function r(M,F,z){z||(z=0);var te=Array(16);if(typeof F=="string")for(var j=0;16>j;++j)te[j]=F.charCodeAt(z++)|F.charCodeAt(z++)<<8|F.charCodeAt(z++)<<16|F.charCodeAt(z++)<<24;else for(j=0;16>j;++j)te[j]=F[z++]|F[z++]<<8|F[z++]<<16|F[z++]<<24;F=M.g[0],z=M.g[1],j=M.g[2];var K=M.g[3],Q=F+(K^z&(j^K))+te[0]+3614090360&4294967295;Q=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=(z=(j=(K=(F=z+(Q<<7&4294967295|Q>>>25))+((Q=K+(j^F&(z^j))+te[1]+3905402710&4294967295)<<12&4294967295|Q>>>20))+((Q=j+(z^K&(F^z))+te[2]+606105819&4294967295)<<17&4294967295|Q>>>15))+((Q=z+(F^j&(K^F))+te[3]+3250441966&4294967295)<<22&4294967295|Q>>>10))+((Q=F+(K^z&(j^K))+te[4]+4118548399&4294967295)<<7&4294967295|Q>>>25))+((Q=K+(j^F&(z^j))+te[5]+1200080426&4294967295)<<12&4294967295|Q>>>20))+((Q=j+(z^K&(F^z))+te[6]+2821735955&4294967295)<<17&4294967295|Q>>>15))+((Q=z+(F^j&(K^F))+te[7]+4249261313&4294967295)<<22&4294967295|Q>>>10))+((Q=F+(K^z&(j^K))+te[8]+1770035416&4294967295)<<7&4294967295|Q>>>25))+((Q=K+(j^F&(z^j))+te[9]+2336552879&4294967295)<<12&4294967295|Q>>>20))+((Q=j+(z^K&(F^z))+te[10]+4294925233&4294967295)<<17&4294967295|Q>>>15))+((Q=z+(F^j&(K^F))+te[11]+2304563134&4294967295)<<22&4294967295|Q>>>10))+((Q=F+(K^z&(j^K))+te[12]+1804603682&4294967295)<<7&4294967295|Q>>>25))+((Q=K+(j^F&(z^j))+te[13]+4254626195&4294967295)<<12&4294967295|Q>>>20))+((Q=j+(z^K&(F^z))+te[14]+2792965006&4294967295)<<17&4294967295|Q>>>15))+((Q=z+(F^j&(K^F))+te[15]+1236535329&4294967295)<<22&4294967295|Q>>>10))+((Q=F+(j^K&(z^j))+te[1]+4129170786&4294967295)<<5&4294967295|Q>>>27))+((Q=K+(z^j&(F^z))+te[6]+3225465664&4294967295)<<9&4294967295|Q>>>23))+((Q=j+(F^z&(K^F))+te[11]+643717713&4294967295)<<14&4294967295|Q>>>18))+((Q=z+(K^F&(j^K))+te[0]+3921069994&4294967295)<<20&4294967295|Q>>>12))+((Q=F+(j^K&(z^j))+te[5]+3593408605&4294967295)<<5&4294967295|Q>>>27))+((Q=K+(z^j&(F^z))+te[10]+38016083&4294967295)<<9&4294967295|Q>>>23))+((Q=j+(F^z&(K^F))+te[15]+3634488961&4294967295)<<14&4294967295|Q>>>18))+((Q=z+(K^F&(j^K))+te[4]+3889429448&4294967295)<<20&4294967295|Q>>>12))+((Q=F+(j^K&(z^j))+te[9]+568446438&4294967295)<<5&4294967295|Q>>>27))+((Q=K+(z^j&(F^z))+te[14]+3275163606&4294967295)<<9&4294967295|Q>>>23))+((Q=j+(F^z&(K^F))+te[3]+4107603335&4294967295)<<14&4294967295|Q>>>18))+((Q=z+(K^F&(j^K))+te[8]+1163531501&4294967295)<<20&4294967295|Q>>>12))+((Q=F+(j^K&(z^j))+te[13]+2850285829&4294967295)<<5&4294967295|Q>>>27))+((Q=K+(z^j&(F^z))+te[2]+4243563512&4294967295)<<9&4294967295|Q>>>23))+((Q=j+(F^z&(K^F))+te[7]+1735328473&4294967295)<<14&4294967295|Q>>>18))+((Q=z+(K^F&(j^K))+te[12]+2368359562&4294967295)<<20&4294967295|Q>>>12))+((Q=F+(z^j^K)+te[5]+4294588738&4294967295)<<4&4294967295|Q>>>28))+((Q=K+(F^z^j)+te[8]+2272392833&4294967295)<<11&4294967295|Q>>>21))+((Q=j+(K^F^z)+te[11]+1839030562&4294967295)<<16&4294967295|Q>>>16))+((Q=z+(j^K^F)+te[14]+4259657740&4294967295)<<23&4294967295|Q>>>9))+((Q=F+(z^j^K)+te[1]+2763975236&4294967295)<<4&4294967295|Q>>>28))+((Q=K+(F^z^j)+te[4]+1272893353&4294967295)<<11&4294967295|Q>>>21))+((Q=j+(K^F^z)+te[7]+4139469664&4294967295)<<16&4294967295|Q>>>16))+((Q=z+(j^K^F)+te[10]+3200236656&4294967295)<<23&4294967295|Q>>>9))+((Q=F+(z^j^K)+te[13]+681279174&4294967295)<<4&4294967295|Q>>>28))+((Q=K+(F^z^j)+te[0]+3936430074&4294967295)<<11&4294967295|Q>>>21))+((Q=j+(K^F^z)+te[3]+3572445317&4294967295)<<16&4294967295|Q>>>16))+((Q=z+(j^K^F)+te[6]+76029189&4294967295)<<23&4294967295|Q>>>9))+((Q=F+(z^j^K)+te[9]+3654602809&4294967295)<<4&4294967295|Q>>>28))+((Q=K+(F^z^j)+te[12]+3873151461&4294967295)<<11&4294967295|Q>>>21))+((Q=j+(K^F^z)+te[15]+530742520&4294967295)<<16&4294967295|Q>>>16))+((Q=z+(j^K^F)+te[2]+3299628645&4294967295)<<23&4294967295|Q>>>9))+((Q=F+(j^(z|~K))+te[0]+4096336452&4294967295)<<6&4294967295|Q>>>26))+((Q=K+(z^(F|~j))+te[7]+1126891415&4294967295)<<10&4294967295|Q>>>22))+((Q=j+(F^(K|~z))+te[14]+2878612391&4294967295)<<15&4294967295|Q>>>17))+((Q=z+(K^(j|~F))+te[5]+4237533241&4294967295)<<21&4294967295|Q>>>11))+((Q=F+(j^(z|~K))+te[12]+1700485571&4294967295)<<6&4294967295|Q>>>26))+((Q=K+(z^(F|~j))+te[3]+2399980690&4294967295)<<10&4294967295|Q>>>22))+((Q=j+(F^(K|~z))+te[10]+4293915773&4294967295)<<15&4294967295|Q>>>17))+((Q=z+(K^(j|~F))+te[1]+2240044497&4294967295)<<21&4294967295|Q>>>11))+((Q=F+(j^(z|~K))+te[8]+1873313359&4294967295)<<6&4294967295|Q>>>26))+((Q=K+(z^(F|~j))+te[15]+4264355552&4294967295)<<10&4294967295|Q>>>22))+((Q=j+(F^(K|~z))+te[6]+2734768916&4294967295)<<15&4294967295|Q>>>17))+((Q=z+(K^(j|~F))+te[13]+1309151649&4294967295)<<21&4294967295|Q>>>11))+((K=(F=z+((Q=F+(j^(z|~K))+te[4]+4149444226&4294967295)<<6&4294967295|Q>>>26))+((Q=K+(z^(F|~j))+te[11]+3174756917&4294967295)<<10&4294967295|Q>>>22))^((j=K+((Q=j+(F^(K|~z))+te[2]+718787259&4294967295)<<15&4294967295|Q>>>17))|~F))+te[9]+3951481745&4294967295,M.g[0]=M.g[0]+F&4294967295,M.g[1]=M.g[1]+(j+(Q<<21&4294967295|Q>>>11))&4294967295,M.g[2]=M.g[2]+j&4294967295,M.g[3]=M.g[3]+K&4294967295}function o(M,F){this.h=F;for(var z=[],te=!0,j=M.length-1;0<=j;j--){var K=0|M[j];te&&K==F||(z[j]=K,te=!1)}this.g=z}(function(M,F){function z(){}z.prototype=F.prototype,M.D=F.prototype,M.prototype=new z,M.prototype.constructor=M,M.C=function(te,j,K){for(var Q=Array(arguments.length-2),ce=2;ce<arguments.length;ce++)Q[ce-2]=arguments[ce];return F.prototype[j].apply(te,Q)}})(e,function(){this.blockSize=-1}),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(M,F){F===void 0&&(F=M.length);for(var z=F-this.blockSize,te=this.B,j=this.h,K=0;K<F;){if(j==0)for(;K<=z;)r(this,M,K),K+=this.blockSize;if(typeof M=="string"){for(;K<F;)if(te[j++]=M.charCodeAt(K++),j==this.blockSize){r(this,te),j=0;break}}else for(;K<F;)if(te[j++]=M[K++],j==this.blockSize){r(this,te),j=0;break}}this.h=j,this.o+=F},e.prototype.v=function(){var M=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);M[0]=128;for(var F=1;F<M.length-8;++F)M[F]=0;var z=8*this.o;for(F=M.length-8;F<M.length;++F)M[F]=255&z,z/=256;for(this.u(M),M=Array(16),F=z=0;4>F;++F)for(var te=0;32>te;te+=8)M[z++]=this.g[F]>>>te&255;return M};var a={};function u(M){return-128<=M&&128>M?function(F,z){var te=a;return Object.prototype.hasOwnProperty.call(te,F)?te[F]:te[F]=z(F)}(M,function(F){return new o([0|F],0>F?-1:0)}):new o([0|M],0>M?-1:0)}function d(M){if(isNaN(M)||!isFinite(M))return f;if(0>M)return I(d(-M));for(var F=[],z=1,te=0;M>=z;te++)F[te]=M/z|0,z*=4294967296;return new o(F,0)}var f=u(0),g=u(1),E=u(16777216);function T(M){if(M.h!=0)return!1;for(var F=0;F<M.g.length;F++)if(M.g[F]!=0)return!1;return!0}function C(M){return M.h==-1}function I(M){for(var F=M.g.length,z=[],te=0;te<F;te++)z[te]=~M.g[te];return new o(z,~M.h).add(g)}function D(M,F){return M.add(I(F))}function L(M,F){for(;(65535&M[F])!=M[F];)M[F+1]+=M[F]>>>16,M[F]&=65535,F++}function B(M,F){this.g=M,this.h=F}function G(M,F){if(T(F))throw Error("division by zero");if(T(M))return new B(f,f);if(C(M))return F=G(I(M),F),new B(I(F.g),I(F.h));if(C(F))return F=G(M,I(F)),new B(I(F.g),F.h);if(30<M.g.length){if(C(M)||C(F))throw Error("slowDivide_ only works with positive integers.");for(var z=g,te=F;0>=te.l(M);)z=se(z),te=se(te);var j=ae(z,1),K=ae(te,1);for(te=ae(te,2),z=ae(z,2);!T(te);){var Q=K.add(te);0>=Q.l(M)&&(j=j.add(z),K=Q),te=ae(te,1),z=ae(z,1)}return F=D(M,j.j(F)),new B(j,F)}for(j=f;0<=M.l(F);){for(z=Math.max(1,Math.floor(M.m()/F.m())),te=48>=(te=Math.ceil(Math.log(z)/Math.LN2))?1:Math.pow(2,te-48),Q=(K=d(z)).j(F);C(Q)||0<Q.l(M);)Q=(K=d(z-=te)).j(F);T(K)&&(K=g),j=j.add(K),M=D(M,Q)}return new B(j,M)}function se(M){for(var F=M.g.length+1,z=[],te=0;te<F;te++)z[te]=M.i(te)<<1|M.i(te-1)>>>31;return new o(z,M.h)}function ae(M,F){var z=F>>5;F%=32;for(var te=M.g.length-z,j=[],K=0;K<te;K++)j[K]=0<F?M.i(K+z)>>>F|M.i(K+z+1)<<32-F:M.i(K+z);return new o(j,M.h)}(t=o.prototype).m=function(){if(C(this))return-I(this).m();for(var M=0,F=1,z=0;z<this.g.length;z++){var te=this.i(z);M+=(0<=te?te:4294967296+te)*F,F*=4294967296}return M},t.toString=function(M){if(2>(M=M||10)||36<M)throw Error("radix out of range: "+M);if(T(this))return"0";if(C(this))return"-"+I(this).toString(M);for(var F=d(Math.pow(M,6)),z=this,te="";;){var j=G(z,F).g,K=((0<(z=D(z,j.j(F))).g.length?z.g[0]:z.h)>>>0).toString(M);if(T(z=j))return K+te;for(;6>K.length;)K="0"+K;te=K+te}},t.i=function(M){return 0>M?0:M<this.g.length?this.g[M]:this.h},t.l=function(M){return C(M=D(this,M))?-1:T(M)?0:1},t.abs=function(){return C(this)?I(this):this},t.add=function(M){for(var F=Math.max(this.g.length,M.g.length),z=[],te=0,j=0;j<=F;j++){var K=te+(65535&this.i(j))+(65535&M.i(j)),Q=(K>>>16)+(this.i(j)>>>16)+(M.i(j)>>>16);te=Q>>>16,K&=65535,Q&=65535,z[j]=Q<<16|K}return new o(z,-2147483648&z[z.length-1]?-1:0)},t.j=function(M){if(T(this)||T(M))return f;if(C(this))return C(M)?I(this).j(I(M)):I(I(this).j(M));if(C(M))return I(this.j(I(M)));if(0>this.l(E)&&0>M.l(E))return d(this.m()*M.m());for(var F=this.g.length+M.g.length,z=[],te=0;te<2*F;te++)z[te]=0;for(te=0;te<this.g.length;te++)for(var j=0;j<M.g.length;j++){var K=this.i(te)>>>16,Q=65535&this.i(te),ce=M.i(j)>>>16,Ee=65535&M.i(j);z[2*te+2*j]+=Q*Ee,L(z,2*te+2*j),z[2*te+2*j+1]+=K*Ee,L(z,2*te+2*j+1),z[2*te+2*j+1]+=Q*ce,L(z,2*te+2*j+1),z[2*te+2*j+2]+=K*ce,L(z,2*te+2*j+2)}for(te=0;te<F;te++)z[te]=z[2*te+1]<<16|z[2*te];for(te=F;te<2*F;te++)z[te]=0;return new o(z,0)},t.A=function(M){return G(this,M).h},t.and=function(M){for(var F=Math.max(this.g.length,M.g.length),z=[],te=0;te<F;te++)z[te]=this.i(te)&M.i(te);return new o(z,this.h&M.h)},t.or=function(M){for(var F=Math.max(this.g.length,M.g.length),z=[],te=0;te<F;te++)z[te]=this.i(te)|M.i(te);return new o(z,this.h|M.h)},t.xor=function(M){for(var F=Math.max(this.g.length,M.g.length),z=[],te=0;te<F;te++)z[te]=this.i(te)^M.i(te);return new o(z,this.h^M.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,jue=e,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=function M(F,z){if(F.length==0)throw Error("number format error: empty string");if(2>(z=z||10)||36<z)throw Error("radix out of range: "+z);if(F.charAt(0)=="-")return I(M(F.substring(1),z));if(0<=F.indexOf("-"))throw Error('number format error: interior "-" character');for(var te=d(Math.pow(z,8)),j=f,K=0;K<F.length;K+=8){var Q=Math.min(8,F.length-K),ce=parseInt(F.substring(K,K+Q),z);8>Q?(Q=d(Math.pow(z,Q)),j=j.j(Q).add(d(ce))):j=(j=j.j(te)).add(d(ce))}return j},ny=o}).apply(Mee!==void 0?Mee:typeof self<"u"?self:typeof window<"u"?window:{});var Bue,dC,Wue,vN,Oj,zue,Gue,Hue,PP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(k,Z,he){return k==Array.prototype||k==Object.prototype||(k[Z]=he.value),k},r=function(k){k=[(typeof globalThis>"u"?"undefined":vo(globalThis))=="object"&&globalThis,k,(typeof window>"u"?"undefined":vo(window))=="object"&&window,(typeof self>"u"?"undefined":vo(self))=="object"&&self,vo(PP)=="object"&&PP];for(var Z=0;Z<k.length;++Z){var he=k[Z];if(he&&he.Math==Math)return he}throw Error("Cannot find global object")}(this);(function(k,Z){if(Z)e:{var he=r;k=k.split(".");for(var Te=0;Te<k.length-1;Te++){var Ye=k[Te];if(!(Ye in he))break e;he=he[Ye]}(Z=Z(Te=he[k=k[k.length-1]]))!=Te&&Z!=null&&e(he,k,{configurable:!0,writable:!0,value:Z})}})("Array.prototype.values",function(k){return k||function(){return function(Z,he){Z instanceof String&&(Z+="");var Te=0,Ye=!1,tt={next:function(){if(!Ye&&Te<Z.length){var vt=Te++;return{value:he(vt,Z[vt]),done:!1}}return Ye=!0,{done:!0,value:void 0}}};return tt[Symbol.iterator]=function(){return tt},tt}(this,function(Z,he){return he})}});/** @license
      Copyright The Closure Library Authors.
      SPDX-License-Identifier: Apache-2.0
      */var o=o||{},a=this||self;function u(k){var Z=vo(k);return(Z=Z!="object"?Z:k?Array.isArray(k)?"array":Z:"null")=="array"||Z=="object"&&typeof k.length=="number"}function d(k){var Z=vo(k);return Z=="object"&&k!=null||Z=="function"}function f(k,Z,he){return k.call.apply(k.bind,arguments)}function g(k,Z,he){if(!k)throw Error();if(2<arguments.length){var Te=Array.prototype.slice.call(arguments,2);return function(){var Ye=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ye,Te),k.apply(Z,Ye)}}return function(){return k.apply(Z,arguments)}}function E(k,Z,he){return(E=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g).apply(null,arguments)}function T(k,Z){var he=Array.prototype.slice.call(arguments,1);return function(){var Te=he.slice();return Te.push.apply(Te,arguments),k.apply(this,Te)}}function C(k,Z){function he(){}he.prototype=Z.prototype,k.aa=Z.prototype,k.prototype=new he,k.prototype.constructor=k,k.Qb=function(Te,Ye,tt){for(var vt=Array(arguments.length-2),rn=2;rn<arguments.length;rn++)vt[rn-2]=arguments[rn];return Z.prototype[Ye].apply(Te,vt)}}function I(k){var Z=k.length;if(0<Z){for(var he=Array(Z),Te=0;Te<Z;Te++)he[Te]=k[Te];return he}return[]}function D(k,Z){for(var he=1;he<arguments.length;he++){var Te=arguments[he];if(u(Te)){var Ye=k.length||0,tt=Te.length||0;k.length=Ye+tt;for(var vt=0;vt<tt;vt++)k[Ye+vt]=Te[vt]}else k.push(Te)}}var L=function(){return Me(function k(Z,he){xe(this,k),this.i=Z,this.j=he,this.h=0,this.g=null},[{key:"get",value:function(){var k;return 0<this.h?(this.h--,k=this.g,this.g=k.next,k.next=null):k=this.i(),k}}])}();function B(k){return/^[\s\xa0]*$/.test(k)}function G(){var k=a.navigator;return k&&(k=k.userAgent)?k:""}function se(k){return se[" "](k),k}se[" "]=function(){};var ae=!(G().indexOf("Gecko")==-1||G().toLowerCase().indexOf("webkit")!=-1&&G().indexOf("Edge")==-1||G().indexOf("Trident")!=-1||G().indexOf("MSIE")!=-1||G().indexOf("Edge")!=-1);function M(k,Z,he){for(var Te in k)Z.call(he,k[Te],Te,k)}function F(k){var Z={};for(var he in k)Z[he]=k[he];return Z}var z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(k,Z){for(var he,Te,Ye=1;Ye<arguments.length;Ye++){for(he in Te=arguments[Ye])k[he]=Te[he];for(var tt=0;tt<z.length;tt++)he=z[tt],Object.prototype.hasOwnProperty.call(Te,he)&&(k[he]=Te[he])}}function j(k){var Z=1;k=k.split(":");for(var he=[];0<Z&&k.length;)he.push(k.shift()),Z--;return k.length&&he.push(k.join(":")),he}function K(k){a.setTimeout(function(){throw k},0)}function Q(){var k=St,Z=null;return k.g&&(Z=k.g,k.g=k.g.next,k.g||(k.h=null),Z.next=null),Z}var ce,Ee=function(){return Me(function k(){xe(this,k),this.h=this.g=null},[{key:"add",value:function(k,Z){var he=_e.get();he.set(k,Z),this.h?this.h.next=he:this.g=he,this.h=he}}])}(),_e=new L(function(){return new pe},function(k){return k.reset()}),pe=function(){return Me(function k(){xe(this,k),this.next=this.g=this.h=null},[{key:"set",value:function(k,Z){this.h=k,this.g=Z,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}])}(),qe=!1,St=new Ee,ke=function(){var k=a.Promise.resolve(void 0);ce=function(){k.then(Ne)}},Ne=function(){for(var k;k=Q();){try{k.h.call(k.g)}catch(he){K(he)}var Z=_e;Z.j(k),100>Z.h&&(Z.h++,k.next=Z.g,Z.g=k)}qe=!1};function Re(){this.s=this.s,this.C=this.C}function Ve(k,Z){this.type=k,this.g=this.target=Z,this.defaultPrevented=!1}Re.prototype.s=!1,Re.prototype.ma=function(){this.s||(this.s=!0,this.N())},Re.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Ve.prototype.h=function(){this.defaultPrevented=!0};var ve=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var k=!1,Z=Object.defineProperty({},"passive",{get:function(){k=!0}});try{var he=function(){};a.addEventListener("test",he,Z),a.removeEventListener("test",he,Z)}catch{}return k}();function Be(k,Z){if(Ve.call(this,k?k.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,k){var he=this.type=k.type,Te=k.changedTouches&&k.changedTouches.length?k.changedTouches[0]:null;if(this.target=k.target||k.srcElement,this.g=Z,Z=k.relatedTarget){if(ae){e:{try{se(Z.nodeName);var Ye=!0;break e}catch{}Ye=!1}Ye||(Z=null)}}else he=="mouseover"?Z=k.fromElement:he=="mouseout"&&(Z=k.toElement);this.relatedTarget=Z,Te?(this.clientX=Te.clientX!==void 0?Te.clientX:Te.pageX,this.clientY=Te.clientY!==void 0?Te.clientY:Te.pageY,this.screenX=Te.screenX||0,this.screenY=Te.screenY||0):(this.clientX=k.clientX!==void 0?k.clientX:k.pageX,this.clientY=k.clientY!==void 0?k.clientY:k.pageY,this.screenX=k.screenX||0,this.screenY=k.screenY||0),this.button=k.button,this.key=k.key||"",this.ctrlKey=k.ctrlKey,this.altKey=k.altKey,this.shiftKey=k.shiftKey,this.metaKey=k.metaKey,this.pointerId=k.pointerId||0,this.pointerType=typeof k.pointerType=="string"?k.pointerType:gt[k.pointerType]||"",this.state=k.state,this.i=k,k.defaultPrevented&&Be.aa.h.call(this)}}C(Be,Ve);var gt={2:"touch",3:"pen",4:"mouse"};Be.prototype.h=function(){Be.aa.h.call(this);var k=this.i;k.preventDefault?k.preventDefault():k.returnValue=!1};var ze="closure_listenable_"+(1e6*Math.random()|0),_t=0;function Dt(k,Z,he,Te,Ye){this.listener=k,this.proxy=null,this.src=Z,this.type=he,this.capture=!!Te,this.ha=Ye,this.key=++_t,this.da=this.fa=!1}function jt(k){k.da=!0,k.listener=null,k.proxy=null,k.src=null,k.ha=null}function Zt(k){this.src=k,this.g={},this.h=0}function Xt(k,Z){var he=Z.type;if(he in k.g){var Te,Ye=k.g[he],tt=Array.prototype.indexOf.call(Ye,Z,void 0);(Te=0<=tt)&&Array.prototype.splice.call(Ye,tt,1),Te&&(jt(Z),k.g[he].length==0&&(delete k.g[he],k.h--))}}function In(k,Z,he,Te){for(var Ye=0;Ye<k.length;++Ye){var tt=k[Ye];if(!tt.da&&tt.listener==Z&&tt.capture==!!he&&tt.ha==Te)return Ye}return-1}Zt.prototype.add=function(k,Z,he,Te,Ye){var tt=k.toString();(k=this.g[tt])||(k=this.g[tt]=[],this.h++);var vt=In(k,Z,Te,Ye);return-1<vt?(Z=k[vt],he||(Z.fa=!1)):((Z=new Dt(Z,this.src,tt,!!Te,Ye)).fa=he,k.push(Z)),Z};var Qt="closure_lm_"+(1e6*Math.random()|0),Er={};function Tn(k,Z,he,Te,Ye){if(Array.isArray(Z)){for(var tt=0;tt<Z.length;tt++)Tn(k,Z[tt],he,Te,Ye);return null}return he=rt(he),k&&k[ze]?k.K(Z,he,d(Te)?!!Te.capture:!1,Ye):Vn(k,Z,he,!1,Te,Ye)}function Vn(k,Z,he,Te,Ye,tt){if(!Z)throw Error("Invalid event type");var vt=d(Ye)?!!Ye.capture:!!Ye,rn=Ae(k);if(rn||(k[Qt]=rn=new Zt(k)),(he=rn.add(Z,he,Te,vt,tt)).proxy)return he;if(Te=function(){function vn(cn){return Rr.call(vn.src,vn.listener,cn)}var Rr=Dn;return vn}(),he.proxy=Te,Te.src=k,Te.listener=he,k.addEventListener)ve||(Ye=vt),Ye===void 0&&(Ye=!1),k.addEventListener(Z.toString(),Te,Ye);else if(k.attachEvent)k.attachEvent(wn(Z.toString()),Te);else{if(!k.addListener||!k.removeListener)throw Error("addEventListener and attachEvent are unavailable.");k.addListener(Te)}return he}function wr(k,Z,he,Te,Ye){if(Array.isArray(Z))for(var tt=0;tt<Z.length;tt++)wr(k,Z[tt],he,Te,Ye);else Te=d(Te)?!!Te.capture:!!Te,he=rt(he),k&&k[ze]?(k=k.i,(Z=String(Z).toString())in k.g&&-1<(he=In(tt=k.g[Z],he,Te,Ye))&&(jt(tt[he]),Array.prototype.splice.call(tt,he,1),tt.length==0&&(delete k.g[Z],k.h--))):k&&(k=Ae(k))&&(Z=k.g[Z.toString()],k=-1,Z&&(k=In(Z,he,Te,Ye)),(he=-1<k?Z[k]:null)&&Pt(he))}function Pt(k){if(typeof k!="number"&&k&&!k.da){var Z=k.src;if(Z&&Z[ze])Xt(Z.i,k);else{var he=k.type,Te=k.proxy;Z.removeEventListener?Z.removeEventListener(he,Te,k.capture):Z.detachEvent?Z.detachEvent(wn(he),Te):Z.addListener&&Z.removeListener&&Z.removeListener(Te),(he=Ae(Z))?(Xt(he,k),he.h==0&&(he.src=null,Z[Qt]=null)):jt(k)}}}function wn(k){return k in Er?Er[k]:Er[k]="on"+k}function Dn(k,Z){if(k.da)k=!0;else{Z=new Be(Z,this);var he=k.listener,Te=k.ha||k.src;k.fa&&Pt(k),k=he.call(Te,Z)}return k}function Ae(k){return(k=k[Qt])instanceof Zt?k:null}var $e="__closure_events_fn_"+(1e9*Math.random()>>>0);function rt(k){return typeof k=="function"?k:(k[$e]||(k[$e]=function(Z){return k.handleEvent(Z)}),k[$e])}function at(){Re.call(this),this.i=new Zt(this),this.M=this,this.F=null}function ct(k,Z){var he,Te=k.F;if(Te)for(he=[];Te;Te=Te.F)he.push(Te);if(k=k.M,Te=Z.type||Z,typeof Z=="string")Z=new Ve(Z,k);else if(Z instanceof Ve)Z.target=Z.target||k;else{var Ye=Z;te(Z=new Ve(Te,k),Ye)}if(Ye=!0,he)for(var tt=he.length-1;0<=tt;tt--){var vt=Z.g=he[tt];Ye=Ke(vt,Te,!0,Z)&&Ye}if(Ye=Ke(vt=Z.g=k,Te,!0,Z)&&Ye,Ye=Ke(vt,Te,!1,Z)&&Ye,he)for(tt=0;tt<he.length;tt++)Ye=Ke(vt=Z.g=he[tt],Te,!1,Z)&&Ye}function Ke(k,Z,he,Te){if(!(Z=k.i.g[String(Z)]))return!0;Z=Z.concat();for(var Ye=!0,tt=0;tt<Z.length;++tt){var vt=Z[tt];if(vt&&!vt.da&&vt.capture==he){var rn=vt.listener,vn=vt.ha||vt.src;vt.fa&&Xt(k.i,vt),Ye=rn.call(vn,Te)!==!1&&Ye}}return Ye&&!Te.defaultPrevented}function nt(k,Z,he){if(typeof k=="function")he&&(k=E(k,he));else{if(!k||typeof k.handleEvent!="function")throw Error("Invalid listener argument");k=E(k.handleEvent,k)}return 2147483647<Number(Z)?-1:a.setTimeout(k,Z||0)}function At(k){k.g=nt(function(){k.g=null,k.i&&(k.i=!1,At(k))},k.l);var Z=k.h;k.h=null,k.m.apply(null,Z)}C(at,Re),at.prototype[ze]=!0,at.prototype.removeEventListener=function(k,Z,he,Te){wr(this,k,Z,he,Te)},at.prototype.N=function(){if(at.aa.N.call(this),this.i){var k,Z=this.i;for(k in Z.g){for(var he=Z.g[k],Te=0;Te<he.length;Te++)jt(he[Te]);delete Z.g[k],Z.h--}}this.F=null},at.prototype.K=function(k,Z,he,Te){return this.i.add(String(k),Z,!1,he,Te)},at.prototype.L=function(k,Z,he,Te){return this.i.add(String(k),Z,!0,he,Te)};var It=function(k){function Z(he,Te){var Ye;return xe(this,Z),(Ye=Jn(this,Z)).m=he,Ye.l=Te,Ye.h=null,Ye.i=!1,Ye.g=null,Ye}return Qn(Z,k),Me(Z,[{key:"j",value:function(he){this.h=arguments,this.g?this.i=!0:At(this)}},{key:"N",value:function(){bf(Z,"N",this,3)([]),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}])}(Re);function Kt(k){Re.call(this),this.h=k,this.g={}}C(Kt,Re);var Un=[];function Fn(k){M(k.g,function(Z,he){this.g.hasOwnProperty(he)&&Pt(Z)},k),k.g={}}Kt.prototype.N=function(){Kt.aa.N.call(this),Fn(this)},Kt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Yr=a.JSON.stringify,Ns=a.JSON.parse,$t=function(){return Me(function k(){xe(this,k)},[{key:"stringify",value:function(k){return a.JSON.stringify(k,void 0)}},{key:"parse",value:function(k){return a.JSON.parse(k,void 0)}}])}();function Cn(){}function yo(k){return k.h||(k.h=k.i())}function Cr(){}Cn.prototype.h=null;var Bi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function za(){Ve.call(this,"d")}function ba(){Ve.call(this,"c")}C(za,Ve),C(ba,Ve);var ys={},Ga=null;function Wi(){return Ga=Ga||new at}function Ws(k){Ve.call(this,ys.La,k)}function Eo(k){var Z=Wi();ct(Z,new Ws(Z))}function Ha(k,Z){Ve.call(this,ys.STAT_EVENT,k),this.stat=Z}function zi(k){var Z=Wi();ct(Z,new Ha(Z,k))}function _u(k,Z){Ve.call(this,ys.Ma,k),this.size=Z}function Do(k,Z){if(typeof k!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){k()},Z)}function wa(){this.g=!0}function Ds(k,Z,he,Te){k.info(function(){return"XMLHTTP TEXT ("+Z+"): "+function(Ye,tt){if(!Ye.g)return tt;if(!tt)return null;try{var vt=JSON.parse(tt);if(vt){for(Ye=0;Ye<vt.length;Ye++)if(Array.isArray(vt[Ye])){var rn=vt[Ye];if(!(2>rn.length)){var vn=rn[1];if(Array.isArray(vn)&&!(1>vn.length)){var Rr=vn[0];if(Rr!="noop"&&Rr!="stop"&&Rr!="close")for(var cn=1;cn<vn.length;cn++)vn[cn]=""}}}}return Yr(vt)}catch{return tt}}(k,he)+(Te?" "+Te:"")})}ys.La="serverreachability",C(Ws,Ve),ys.STAT_EVENT="statevent",C(Ha,Ve),ys.Ma="timingevent",C(_u,Ve),wa.prototype.xa=function(){this.g=!1},wa.prototype.info=function(){};var Gi,us={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ca={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function vc(){}function zs(k,Z,he,Te){this.j=k,this.i=Z,this.l=he,this.R=Te||1,this.U=new Kt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Zo}function Zo(){this.i=null,this.g="",this.h=!1}C(vc,Cn),vc.prototype.g=function(){return new XMLHttpRequest},vc.prototype.i=function(){return{}},Gi=new vc;var ea={},yu={};function kd(k,Z,he){k.L=1,k.v=Xc(es(Z)),k.m=he,k.P=!0,Eu(k,null)}function Eu(k,Z){k.F=Date.now(),_c(k),k.A=es(k.v);var he=k.A,Te=k.R;Array.isArray(Te)||(Te=[String(Te)]),qa(he.i,"t",Te),k.C=0,he=k.j.J,k.h=new Zo,k.g=ml(k.j,he?Z:null,!k.m),0<k.O&&(k.M=new It(E(k.Y,k,k.g),k.O)),Z=k.U,he=k.g,Te=k.ca;var Ye="readystatechange";Array.isArray(Ye)||(Ye&&(Un[0]=Ye.toString()),Ye=Un);for(var tt=0;tt<Ye.length;tt++){var vt=Tn(he,Ye[tt],Te||Z.handleEvent,!1,Z.h||Z);if(!vt)break;Z.g[vt.key]=vt}Z=k.H?F(k.H):{},k.m?(k.u||(k.u="POST"),Z["Content-Type"]="application/x-www-form-urlencoded",k.g.ea(k.A,k.u,k.m,Z)):(k.u="GET",k.g.ea(k.A,k.u,null,Z)),Eo(),function(rn,vn,Rr,cn,ts,ci){rn.info(function(){if(rn.g)if(ci)for(var Vr="",Bo=ci.split("&"),ns=0;ns<Bo.length;ns++){var A=Bo[ns].split("=");if(1<A.length){var q=A[0];A=A[1];var oe=q.split("_");Vr=2<=oe.length&&oe[1]=="type"?Vr+(q+"=")+A+"&":Vr+(q+"=redacted&")}}else Vr=null;else Vr=ci;return"XMLHTTP REQ ("+cn+") [attempt "+ts+"]: "+vn+`
`+Rr+`
`+Vr})}(k.i,k.u,k.A,k.l,k.R,k.m)}function Wl(k){return!!k.g&&k.u=="GET"&&k.L!=2&&k.j.Ca}function to(k,Z){var he=k.C,Te=Z.indexOf(`
`,he);return Te==-1?yu:(he=Number(Z.substring(he,Te)),isNaN(he)?ea:(Te+=1)+he>Z.length?yu:(Z=Z.slice(Te,Te+he),k.C=Te+he,Z))}function _c(k){k.S=Date.now()+k.I,ta(k,k.I)}function ta(k,Z){if(k.B!=null)throw Error("WatchDog timer not null");k.B=Do(E(k.ba,k),Z)}function Su(k){k.B&&(a.clearTimeout(k.B),k.B=null)}function yc(k){k.j.G==0||k.J||Vo(k.j,k)}function Gs(k){Su(k);var Z=k.M;Z&&typeof Z.ma=="function"&&Z.ma(),k.M=null,Fn(k.U),k.g&&(Z=k.g,k.g=null,Z.abort(),Z.ma())}function Tu(k,Z){try{var he=k.j;if(he.G!=0&&(he.g==k||Ti(he.h,k))){if(!k.K&&Ti(he.h,k)&&he.G==3){try{var Te=he.Da.g.parse(Z)}catch{Te=null}if(Array.isArray(Te)&&Te.length==3){var Ye=Te;if(Ye[0]==0){e:if(!he.u){if(he.g){if(!(he.g.F+3e3<k.F))break e;ms(he),Ce(he)}hn(he),zi(18)}}else he.za=Ye[1],0<he.za-he.T&&37500>Ye[2]&&he.F&&he.v==0&&!he.C&&(he.C=Do(E(he.Za,he),6e3));if(1>=Zr(he.h)&&he.ca){try{he.ca()}catch{}he.ca=void 0}}else oa(he,11)}else if((k.K||he.g==k)&&ms(he),!B(Z))for(Ye=he.Da.g.parse(Z),Z=0;Z<Ye.length;Z++){var tt=Ye[Z];if(he.T=tt[0],tt=tt[1],he.G==2)if(tt[0]=="c"){he.K=tt[1],he.ia=tt[2];var vt=tt[3];vt!=null&&(he.la=vt,he.j.info("VER="+he.la));var rn=tt[4];rn!=null&&(he.Aa=rn,he.j.info("SVER="+he.Aa));var vn=tt[5];vn!=null&&typeof vn=="number"&&0<vn&&(Te=1.5*vn,he.L=Te,he.j.info("backChannelRequestTimeoutMs_="+Te)),Te=he;var Rr=k.g;if(Rr){var cn=Rr.g?Rr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(cn){var ts=Te.h;ts.g||cn.indexOf("spdy")==-1&&cn.indexOf("quic")==-1&&cn.indexOf("h2")==-1||(ts.j=ts.l,ts.g=new Set,ts.h&&(Ra(ts,ts.h),ts.h=null))}if(Te.D){var ci=Rr.g?Rr.g.getResponseHeader("X-HTTP-Session-Id"):null;ci&&(Te.ya=ci,Mr(Te.I,Te.D,ci))}}he.G=3,he.l&&he.l.ua(),he.ba&&(he.R=Date.now()-k.F,he.j.info("Handshake RTT: "+he.R+"ms"));var Vr=k;if((Te=he).qa=wc(Te,Te.J?Te.ia:null,Te.W),Vr.K){Ec(Te.h,Vr);var Bo=Vr,ns=Te.L;ns&&(Bo.I=ns),Bo.B&&(Su(Bo),_c(Bo)),Te.g=Vr}else ei(Te);0<he.i.length&&st(he)}else tt[0]!="stop"&&tt[0]!="close"||oa(he,7);else he.G==3&&(tt[0]=="stop"||tt[0]=="close"?tt[0]=="stop"?oa(he,7):Ya(he):tt[0]!="noop"&&he.l&&he.l.ta(tt),he.v=0)}}Eo()}catch{}}zs.prototype.ca=function(k){k=k.target;var Z=this.M;Z&&no(k)==3?Z.j():this.Y(k)},zs.prototype.Y=function(k){try{if(k==this.g)e:{var Z=no(this.g),he=this.g.Ba();if(this.g.Z(),!(3>Z)&&(Z!=3||this.g&&(this.h.h||this.g.oa()||Pd(this.g)))){this.J||Z!=4||he==7||Eo(),Su(this);var Te=this.g.Z();this.X=Te;t:if(Wl(this)){var Ye=Pd(this.g);k="";var tt=Ye.length,vt=no(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Gs(this),yc(this);var rn="";break t}this.h.i=new a.TextDecoder}for(he=0;he<tt;he++)this.h.h=!0,k+=this.h.i.decode(Ye[he],{stream:!(vt&&he==tt-1)});Ye.length=0,this.h.g+=k,this.C=0,rn=this.h.g}else rn=this.g.oa();if(this.o=Te==200,function(Vr,Bo,ns,A,q,oe,ye){Vr.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+q+"]: "+Bo+`
`+ns+`
`+oe+" "+ye})}(this.i,this.u,this.A,this.l,this.R,Z,Te),this.o){if(this.T&&!this.K){t:{if(this.g){var vn,Rr=this.g;if((vn=Rr.g?Rr.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(vn)){var cn=vn;break t}}cn=null}if(!(Te=cn)){this.o=!1,this.s=3,zi(12),Gs(this),yc(this);break e}Ds(this.i,this.l,Te,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Tu(this,Te)}if(this.P){var ts;for(Te=!0;!this.J&&this.C<rn.length;){if((ts=to(this,rn))==yu){Z==4&&(this.s=4,zi(14),Te=!1),Ds(this.i,this.l,null,"[Incomplete Response]");break}if(ts==ea){this.s=4,zi(15),Ds(this.i,this.l,rn,"[Invalid Chunk]"),Te=!1;break}Ds(this.i,this.l,ts,null),Tu(this,ts)}if(Wl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Z!=4||rn.length!=0||this.h.h||(this.s=1,zi(16),Te=!1),this.o=this.o&&Te,Te){if(0<rn.length&&!this.W){this.W=!0;var ci=this.j;ci.g==this&&ci.ba&&!ci.M&&(ci.j.info("Great, no buffering proxy detected. Bytes received: "+rn.length),Hr(ci),ci.M=!0,zi(11))}}else Ds(this.i,this.l,rn,"[Invalid Chunked Response]"),Gs(this),yc(this)}else Ds(this.i,this.l,rn,null),Tu(this,rn);Z==4&&Gs(this),this.o&&!this.J&&(Z==4?Vo(this.j,this):(this.o=!1,_c(this)))}else(function(Vr){var Bo={};Vr=(Vr.g&&2<=no(Vr)&&Vr.g.getAllResponseHeaders()||"").split(`\r
`);for(var ns=0;ns<Vr.length;ns++)if(!B(Vr[ns])){var A=j(Vr[ns]),q=A[0];if(typeof(A=A[1])=="string"){A=A.trim();var oe=Bo[q]||[];Bo[q]=oe,oe.push(A)}}(function(ye,Je){for(var ht in ye)Je.call(void 0,ye[ht],ht,ye)})(Bo,function(ye){return ye.join(", ")})})(this.g),Te==400&&0<rn.indexOf("Unknown SID")?(this.s=3,zi(12)):(this.s=0,zi(13)),Gs(this),yc(this)}}}catch{}},zs.prototype.cancel=function(){this.J=!0,Gs(this)},zs.prototype.ba=function(){this.B=null;var k=Date.now();0<=k-this.S?(function(Z,he){Z.info(function(){return"TIMEOUT: "+he})}(this.i,this.A),this.L!=2&&(Eo(),zi(17)),Gs(this),this.s=2,yc(this)):ta(this,this.S-k)};var ul=Me(function k(Z,he){xe(this,k),this.g=Z,this.map=he});function Lo(k){this.l=k||10,a.PerformanceNavigationTiming?k=0<(k=a.performance.getEntriesByType("navigation")).length&&(k[0].nextHopProtocol=="hq"||k[0].nextHopProtocol=="h2"):k=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=k?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ll(k){return!!k.h||!!k.g&&k.g.size>=k.j}function Zr(k){return k.h?1:k.g?k.g.size:0}function Ti(k,Z){return k.h?k.h==Z:!!k.g&&k.g.has(Z)}function Ra(k,Z){k.g?k.g.add(Z):k.h=Z}function Ec(k,Z){k.h&&k.h==Z?k.h=null:k.g&&k.g.has(Z)&&k.g.delete(Z)}function na(k){if(k.h!=null)return k.i.concat(k.h.D);if(k.g!=null&&k.g.size!==0){var Z,he=k.i,Te=pn(k.g.values());try{for(Te.s();!(Z=Te.n()).done;){var Ye=Z.value;he=he.concat(Ye.D)}}catch(tt){Te.e(tt)}finally{Te.f()}return he}return I(k.i)}function zl(k,Z){if(k.forEach&&typeof k.forEach=="function")k.forEach(Z,void 0);else if(u(k)||typeof k=="string")Array.prototype.forEach.call(k,Z,void 0);else for(var he=function(vt){if(vt.na&&typeof vt.na=="function")return vt.na();if(!vt.V||typeof vt.V!="function"){if(typeof Map<"u"&&vt instanceof Map)return Array.from(vt.keys());if(!(typeof Set<"u"&&vt instanceof Set)){if(u(vt)||typeof vt=="string"){var rn=[];vt=vt.length;for(var vn=0;vn<vt;vn++)rn.push(vn);return rn}for(var Rr in rn=[],vn=0,vt)rn[vn++]=Rr;return rn}}}(k),Te=function(vt){if(vt.V&&typeof vt.V=="function")return vt.V();if(typeof Map<"u"&&vt instanceof Map||typeof Set<"u"&&vt instanceof Set)return Array.from(vt.values());if(typeof vt=="string")return vt.split("");if(u(vt)){for(var rn=[],vn=vt.length,Rr=0;Rr<vn;Rr++)rn.push(vt[Rr]);return rn}for(Rr in rn=[],vn=0,vt)rn[vn++]=vt[Rr];return rn}(k),Ye=Te.length,tt=0;tt<Ye;tt++)Z.call(void 0,Te[tt],he&&he[tt],k)}Lo.prototype.cancel=function(){if(this.i=na(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){var k,Z=pn(this.g.values());try{for(Z.s();!(k=Z.n()).done;)k.value.cancel()}catch(he){Z.e(he)}finally{Z.f()}this.g.clear()}};var dl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xo(k){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,k instanceof xo){this.h=k.h,hl(this,k.j),this.o=k.o,this.g=k.g,Ls(this,k.s),this.l=k.l;var Z=k.i,he=new Ia;he.i=Z.i,Z.g&&(he.g=new Map(Z.g),he.h=Z.h),Gl(this,he),this.m=k.m}else k&&(Z=String(k).match(dl))?(this.h=!1,hl(this,Z[1]||"",!0),this.o=Sc(Z[2]||""),this.g=Sc(Z[3]||"",!0),Ls(this,Z[4]),this.l=Sc(Z[5]||"",!0),Gl(this,Z[6]||"",!0),this.m=Sc(Z[7]||"")):(this.h=!1,this.i=new Ia(null,this.h))}function es(k){return new xo(k)}function hl(k,Z,he){k.j=he?Sc(Z,!0):Z,k.j&&(k.j=k.j.replace(/:$/,""))}function Ls(k,Z){if(Z){if(Z=Number(Z),isNaN(Z)||0>Z)throw Error("Bad port number "+Z);k.s=Z}else k.s=null}function Gl(k,Z,he){Z instanceof Ia?(k.i=Z,function(Te,Ye){Ye&&!Te.j&&(kr(Te),Te.i=null,Te.g.forEach(function(tt,vt){var rn=vt.toLowerCase();vt!=rn&&(Aa(this,vt),qa(this,rn,tt))},Te)),Te.j=Ye}(k.i,k.h)):(he||(Z=fr(Z,fl)),k.i=new Ia(Z,k.h))}function Mr(k,Z,he){k.i.set(Z,he)}function Xc(k){return Mr(k,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),k}function Sc(k,Z){return k?Z?decodeURI(k.replace(/%25/g,"%2525")):decodeURIComponent(k):""}function fr(k,Z,he){return typeof k=="string"?(k=encodeURI(k).replace(Z,bu),he&&(k=k.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),k):null}function bu(k){return"%"+((k=k.charCodeAt(0))>>4&15).toString(16)+(15&k).toString(16)}xo.prototype.toString=function(){var k=[],Z=this.j;Z&&k.push(fr(Z,wu,!0),":");var he=this.g;return(he||Z=="file")&&(k.push("//"),(Z=this.o)&&k.push(fr(Z,wu,!0),"@"),k.push(encodeURIComponent(String(he)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),(he=this.s)!=null&&k.push(":",String(he))),(he=this.l)&&(this.g&&he.charAt(0)!="/"&&k.push("/"),k.push(fr(he,he.charAt(0)=="/"?ra:Ka,!0))),(he=this.i.toString())&&k.push("?",he),(he=this.m)&&k.push("#",fr(he,Qc)),k.join("")};var Jc,wu=/[#\/\?@]/g,Ka=/[#\?:]/g,ra=/[#\?]/g,fl=/[#\?@]/g,Qc=/#/g;function Ia(k,Z){this.h=this.g=null,this.i=k||null,this.j=!!Z}function kr(k){k.g||(k.g=new Map,k.h=0,k.i&&function(Z,he){if(Z){Z=Z.split("&");for(var Te=0;Te<Z.length;Te++){var Ye=Z[Te].indexOf("="),tt=null;if(0<=Ye){var vt=Z[Te].substring(0,Ye);tt=Z[Te].substring(Ye+1)}else vt=Z[Te];he(vt,tt?decodeURIComponent(tt.replace(/\+/g," ")):"")}}}(k.i,function(Z,he){k.add(decodeURIComponent(Z.replace(/\+/g," ")),he)}))}function Aa(k,Z){kr(k),Z=Zc(k,Z),k.g.has(Z)&&(k.i=null,k.h-=k.g.get(Z).length,k.g.delete(Z))}function pr(k,Z){return kr(k),Z=Zc(k,Z),k.g.has(Z)}function qa(k,Z,he){Aa(k,Z),0<he.length&&(k.i=null,k.g.set(Zc(k,Z),I(he)),k.h+=he.length)}function Zc(k,Z){return Z=String(Z),k.j&&(Z=Z.toLowerCase()),Z}function So(k,Z,he,Te,Ye){try{Ye&&(Ye.onload=null,Ye.onerror=null,Ye.onabort=null,Ye.ontimeout=null),Te(he)}catch{}}function Hl(){this.g=new $t}function Od(k,Z,he){var Te=he||"";try{zl(k,function(Ye,tt){var vt=Ye;d(Ye)&&(vt=Yr(Ye)),Z.push(Te+tt+"="+encodeURIComponent(vt))})}catch(Ye){throw Z.push(Te+"type="+encodeURIComponent("_badmap")),Ye}}function pl(k){this.l=k.Ub||null,this.j=k.eb||!1}function Cu(k,Z){at.call(this),this.D=k,this.o=Z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Mo(k){k.j.read().then(k.Pa.bind(k)).catch(k.ga.bind(k))}function Hi(k){k.readyState=4,k.l=null,k.j=null,k.v=null,Hs(k)}function Hs(k){k.onreadystatechange&&k.onreadystatechange.call(k)}function Uo(k){var Z="";return M(k,function(he,Te){Z+=Te,Z+=":",Z+=he,Z+=`\r
`}),Z}function Tc(k,Z,he){e:{for(Te in he){var Te=!1;break e}Te=!0}Te||(he=Uo(he),typeof k=="string"?he!=null&&encodeURIComponent(String(he)):Mr(k,Z,he))}function Or(k){at.call(this),this.headers=new Map,this.o=k||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=Ia.prototype).add=function(k,Z){kr(this),this.i=null,k=Zc(this,k);var he=this.g.get(k);return he||this.g.set(k,he=[]),he.push(Z),this.h+=1,this},t.forEach=function(k,Z){kr(this),this.g.forEach(function(he,Te){he.forEach(function(Ye){k.call(Z,Ye,Te,this)},this)},this)},t.na=function(){kr(this);for(var k=Array.from(this.g.values()),Z=Array.from(this.g.keys()),he=[],Te=0;Te<Z.length;Te++)for(var Ye=k[Te],tt=0;tt<Ye.length;tt++)he.push(Z[Te]);return he},t.V=function(k){kr(this);var Z=[];if(typeof k=="string")pr(this,k)&&(Z=Z.concat(this.g.get(Zc(this,k))));else{k=Array.from(this.g.values());for(var he=0;he<k.length;he++)Z=Z.concat(k[he])}return Z},t.set=function(k,Z){return kr(this),this.i=null,pr(this,k=Zc(this,k))&&(this.h-=this.g.get(k).length),this.g.set(k,[Z]),this.h+=1,this},t.get=function(k,Z){return k&&0<(k=this.V(k)).length?String(k[0]):Z},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var k=[],Z=Array.from(this.g.keys()),he=0;he<Z.length;he++){var Te=Z[he],Ye=encodeURIComponent(String(Te)),tt=this.V(Te);for(Te=0;Te<tt.length;Te++){var vt=Ye;tt[Te]!==""&&(vt+="="+encodeURIComponent(String(tt[Te]))),k.push(vt)}}return this.i=k.join("&")},C(pl,Cn),pl.prototype.g=function(){return new Cu(this.l,this.j)},pl.prototype.i=(Jc={},function(){return Jc}),C(Cu,at),(t=Cu.prototype).open=function(k,Z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=k,this.A=Z,this.readyState=1,Hs(this)},t.send=function(k){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;var Z={headers:this.u,method:this.B,credentials:this.m,cache:void 0};k&&(Z.body=k),(this.D||a).fetch(new Request(this.A,Z)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(function(){}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Hi(this)),this.readyState=0},t.Sa=function(k){if(this.g&&(this.l=k,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=k.headers,this.readyState=2,Hs(this)),this.g&&(this.readyState=3,Hs(this),this.g)))if(this.responseType==="arraybuffer")k.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(a.ReadableStream!==void 0&&"body"in k){if(this.j=k.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Mo(this)}else k.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(k){if(this.g){if(this.o&&k.value)this.response.push(k.value);else if(!this.o){var Z=k.value?k.value:new Uint8Array(0);(Z=this.v.decode(Z,{stream:!k.done}))&&(this.response=this.responseText+=Z)}k.done?Hi(this):Hs(this),this.readyState==3&&Mo(this)}},t.Ra=function(k){this.g&&(this.response=this.responseText=k,Hi(this))},t.Qa=function(k){this.g&&(this.response=k,Hi(this))},t.ga=function(){this.g&&Hi(this)},t.setRequestHeader=function(k,Z){this.u.append(k,Z)},t.getResponseHeader=function(k){return this.h&&this.h.get(k.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";for(var k=[],Z=this.h.entries(),he=Z.next();!he.done;)he=he.value,k.push(he[0]+": "+he[1]),he=Z.next();return k.join(`\r
`)},Object.defineProperty(Cu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(k){this.m=k?"include":"same-origin"}}),C(Or,at);var ia=/^https?$/i,vh=["POST","PUT"];function $a(k,Z){k.h=!1,k.g&&(k.j=!0,k.g.abort(),k.j=!1),k.l=Z,k.m=5,Es(k),Iu(k)}function Es(k){k.A||(k.A=!0,ct(k,"complete"),ct(k,"error"))}function Ru(k){if(k.h&&o!==void 0&&(!k.v[1]||no(k)!=4||k.Z()!=2)){if(k.u&&no(k)==4)nt(k.Ea,0,k);else if(ct(k,"readystatechange"),no(k)==4){k.h=!1;try{var Z,he=k.Z();e:switch(he){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var Te=!0;break e;default:Te=!1}if(!(Z=Te)){var Ye;if(Ye=he===0){var tt=String(k.D).match(dl)[1]||null;!tt&&a.self&&a.self.location&&(tt=a.self.location.protocol.slice(0,-1)),Ye=!ia.test(tt?tt.toLowerCase():"")}Z=Ye}if(Z)ct(k,"complete"),ct(k,"success");else{k.m=6;try{var vt=2<no(k)?k.g.statusText:""}catch{vt=""}k.l=vt+" ["+k.Z()+"]",Es(k)}}finally{Iu(k)}}}}function Iu(k,Z){if(k.g){bc(k);var he=k.g,Te=k.v[0]?function(){}:null;k.g=null,k.v=null,Z||ct(k,"ready");try{he.onreadystatechange=Te}catch{}}}function bc(k){k.I&&(a.clearTimeout(k.I),k.I=null)}function no(k){return k.g?k.g.readyState:0}function Pd(k){try{if(!k.g)return null;if("response"in k.g)return k.g.response;switch(k.H){case"":case"text":return k.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in k.g)return k.g.mozResponseArrayBuffer}return null}catch{return null}}function ro(k,Z,he){return he&&he.internalChannelParams&&he.internalChannelParams[k]||Z}function sa(k){this.Aa=0,this.i=[],this.j=new wa,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ro("failFast",!1,k),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ro("baseRetryDelayMs",5e3,k),this.cb=ro("retryDelaySeedMs",1e4,k),this.Wa=ro("forwardChannelMaxRetries",2,k),this.wa=ro("forwardChannelRequestTimeoutMs",2e4,k),this.pa=k&&k.xmlHttpFactory||void 0,this.Xa=k&&k.Tb||void 0,this.Ca=k&&k.useFetchStreams||!1,this.L=void 0,this.J=k&&k.supportsCrossDomainXhr||!1,this.K="",this.h=new Lo(k&&k.concurrentRequestLimit),this.Da=new Hl,this.P=k&&k.fastHandshake||!1,this.O=k&&k.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=k&&k.Rb||!1,k&&k.xa&&this.j.xa(),k&&k.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&k&&k.detectBufferingProxy||!1,this.ja=void 0,k&&k.longPollingTimeout&&0<k.longPollingTimeout&&(this.ja=k.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Ya(k){if(De(k),k.G==3){var Z=k.U++,he=es(k.I);if(Mr(he,"SID",k.K),Mr(he,"RID",Z),Mr(he,"TYPE","terminate"),Zn(k,he),(Z=new zs(k,k.j,Z)).L=2,Z.v=Xc(es(he)),he=!1,a.navigator&&a.navigator.sendBeacon)try{he=a.navigator.sendBeacon(Z.v.toString(),"")}catch{}!he&&a.Image&&(new Image().src=Z.v,he=!0),he||(Z.g=ml(Z.j,null),Z.g.ea(Z.v)),Z.F=Date.now(),_c(Z)}ls(k)}function Ce(k){k.g&&(Hr(k),k.g.cancel(),k.g=null)}function De(k){Ce(k),k.u&&(a.clearTimeout(k.u),k.u=null),ms(k),k.h.cancel(),k.s&&(typeof k.s=="number"&&a.clearTimeout(k.s),k.s=null)}function st(k){if(!ll(k.h)&&!k.s){k.s=!0;var Z=k.Ga;ce||ke(),qe||(ce(),qe=!0),St.add(Z,k),k.B=0}}function nn(k,Z){var he;he=Z?Z.l:k.U++;var Te=es(k.I);Mr(Te,"SID",k.K),Mr(Te,"RID",he),Mr(Te,"AID",k.T),Zn(k,Te),k.m&&k.o&&Tc(Te,k.m,k.o),he=new zs(k,k.j,he,k.B+1),k.m===null&&(he.H=k.o),Z&&(k.i=Z.D.concat(k.i)),Z=Ur(k,he,1e3),he.I=Math.round(.5*k.wa)+Math.round(.5*k.wa*Math.random()),Ra(k.h,he),kd(he,Te,Z)}function Zn(k,Z){k.H&&M(k.H,function(he,Te){Mr(Z,Te,he)}),k.l&&zl({},function(he,Te){Mr(Z,Te,he)})}function Ur(k,Z,he){he=Math.min(k.i.length,he);var Te=k.l?E(k.l.Na,k.l,k):null;e:for(var Ye=k.i,tt=-1;;){var vt=["count="+he];tt==-1?0<he?(tt=Ye[0].g,vt.push("ofs="+tt)):tt=0:vt.push("ofs="+tt);for(var rn=!0,vn=0;vn<he;vn++){var Rr=Ye[vn].g,cn=Ye[vn].map;if(0>(Rr-=tt))tt=Math.max(0,Ye[vn].g-100),rn=!1;else try{Od(cn,vt,"req"+Rr+"_")}catch{Te&&Te(cn)}}if(rn){Te=vt.join("&");break e}}return k=k.i.splice(0,he),Z.D=k,Te}function ei(k){if(!k.g&&!k.u){k.Y=1;var Z=k.Fa;ce||ke(),qe||(ce(),qe=!0),St.add(Z,k),k.v=0}}function hn(k){return!(k.g||k.u||3<=k.v)&&(k.Y++,k.u=Do(E(k.Fa,k),Fo(k,k.v)),k.v++,!0)}function Hr(k){k.A!=null&&(a.clearTimeout(k.A),k.A=null)}function Ri(k){k.g=new zs(k,k.j,"rpc",k.Y),k.m===null&&(k.g.H=k.o),k.g.O=0;var Z=es(k.qa);Mr(Z,"RID","rpc"),Mr(Z,"SID",k.K),Mr(Z,"AID",k.T),Mr(Z,"CI",k.F?"0":"1"),!k.F&&k.ja&&Mr(Z,"TO",k.ja),Mr(Z,"TYPE","xmlhttp"),Zn(k,Z),k.m&&k.o&&Tc(Z,k.m,k.o),k.L&&(k.g.I=k.L);var he=k.g;k=k.ia,he.L=1,he.v=Xc(es(Z)),he.m=null,he.P=!0,Eu(he,k)}function ms(k){k.C!=null&&(a.clearTimeout(k.C),k.C=null)}function Vo(k,Z){var he=null;if(k.g==Z){ms(k),Hr(k),k.g=null;var Te=2}else{if(!Ti(k.h,Z))return;he=Z.D,Ec(k.h,Z),Te=1}if(k.G!=0){if(Z.o)if(Te==1){he=Z.m?Z.m.length:0,Z=Date.now()-Z.F;var Ye=k.B;ct(Te=Wi(),new _u(Te,he)),st(k)}else ei(k);else if((Ye=Z.s)==3||Ye==0&&0<Z.X||!(Te==1&&function(tt,vt){return!(Zr(tt.h)>=tt.h.j-(tt.s?1:0)||(tt.s?(tt.i=vt.D.concat(tt.i),0):tt.G==1||tt.G==2||tt.B>=(tt.Va?0:tt.Wa)||(tt.s=Do(E(tt.Ga,tt,vt),Fo(tt,tt.B)),tt.B++,0)))}(k,Z)||Te==2&&hn(k)))switch(he&&0<he.length&&(Z=k.h,Z.i=Z.i.concat(he)),Ye){case 1:oa(k,5);break;case 4:oa(k,10);break;case 3:oa(k,6);break;default:oa(k,2)}}}function Fo(k,Z){var he=k.Ta+Math.floor(Math.random()*k.cb);return k.isActive()||(he*=2),he*Z}function oa(k,Z){if(k.j.info("Error code "+Z),Z==2){var he=E(k.fb,k),Te=k.Xa,Ye=!Te;Te=new xo(Te||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||hl(Te,"https"),Xc(Te),Ye?function(tt,vt){var rn=new wa;if(a.Image){var vn=new Image;vn.onload=T(So,rn,"TestLoadImage: loaded",!0,vt,vn),vn.onerror=T(So,rn,"TestLoadImage: error",!1,vt,vn),vn.onabort=T(So,rn,"TestLoadImage: abort",!1,vt,vn),vn.ontimeout=T(So,rn,"TestLoadImage: timeout",!1,vt,vn),a.setTimeout(function(){vn.ontimeout&&vn.ontimeout()},1e4),vn.src=tt}else vt(!1)}(Te.toString(),he):function(tt,vt){var rn=new AbortController,vn=setTimeout(function(){rn.abort(),So(0,0,!1,vt)},1e4);fetch(tt,{signal:rn.signal}).then(function(Rr){clearTimeout(vn),Rr.ok?So(0,0,!0,vt):So(0,0,!1,vt)}).catch(function(){clearTimeout(vn),So(0,0,!1,vt)})}(Te.toString(),he)}else zi(2);k.G=0,k.l&&k.l.sa(Z),ls(k),De(k)}function ls(k){if(k.G=0,k.ka=[],k.l){var Z=na(k.h);Z.length==0&&k.i.length==0||(D(k.ka,Z),D(k.ka,k.i),k.h.i.length=0,I(k.i),k.i.length=0),k.l.ra()}}function wc(k,Z,he){var Te=he instanceof xo?es(he):new xo(he);if(Te.g!="")Z&&(Te.g=Z+"."+Te.g),Ls(Te,Te.s);else{var Ye=a.location;Te=Ye.protocol,Z=Z?Z+"."+Ye.hostname:Ye.hostname,Ye=+Ye.port;var tt=new xo(null);Te&&hl(tt,Te),Z&&(tt.g=Z),Ye&&Ls(tt,Ye),he&&(tt.l=he),Te=tt}return he=k.D,Z=k.ya,he&&Z&&Mr(Te,he,Z),Mr(Te,"VER",k.la),Zn(k,Te),Te}function ml(k,Z,he){if(Z&&!k.J)throw Error("Can't create secondary domain capable XhrIo object.");return(Z=k.Ca&&!k.pa?new Or(new pl({eb:he})):new Or(k.pa)).Ha(k.J),Z}function Xa(){}function Kl(){}function io(k,Z){at.call(this),this.g=new sa(Z),this.l=k,this.h=Z&&Z.messageUrlParams||null,k=Z&&Z.messageHeaders||null,Z&&Z.clientProtocolHeaderRequired&&(k?k["X-Client-Protocol"]="webchannel":k={"X-Client-Protocol":"webchannel"}),this.g.o=k,k=Z&&Z.initMessageHeaders||null,Z&&Z.messageContentType&&(k?k["X-WebChannel-Content-Type"]=Z.messageContentType:k={"X-WebChannel-Content-Type":Z.messageContentType}),Z&&Z.va&&(k?k["X-WebChannel-Client-Profile"]=Z.va:k={"X-WebChannel-Client-Profile":Z.va}),this.g.S=k,(k=Z&&Z.Sb)&&!B(k)&&(this.g.m=k),this.v=Z&&Z.supportsCrossDomainXhr||!1,this.u=Z&&Z.sendRawJson||!1,(Z=Z&&Z.httpSessionIdParam)&&!B(Z)&&(this.g.D=Z,(k=this.h)!==null&&Z in k&&Z in(k=this.h)&&delete k[Z]),this.j=new aa(this)}function Au(k){za.call(this),k.__headers__&&(this.headers=k.__headers__,this.statusCode=k.__status__,delete k.__headers__,delete k.__status__);var Z=k.__sm__;if(Z){e:{for(var he in Z){k=he;break e}k=void 0}(this.i=k)&&(k=this.i,Z=Z!==null&&k in Z?Z[k]:void 0),this.data=Z}else this.data=k}function jo(){ba.call(this),this.status=1}function aa(k){this.g=k}(t=Or.prototype).Ha=function(k){this.J=k},t.ea=function(k,Z,he,Te){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+k);Z=Z?Z.toUpperCase():"GET",this.D=k,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Gi.g(),this.v=this.o?yo(this.o):yo(Gi),this.g.onreadystatechange=E(this.Ea,this);try{this.B=!0,this.g.open(Z,String(k),!0),this.B=!1}catch(Vr){return void $a(this,Vr)}if(k=he||"",he=new Map(this.headers),Te)if(Object.getPrototypeOf(Te)===Object.prototype)for(var Ye in Te)he.set(Ye,Te[Ye]);else{if(typeof Te.keys!="function"||typeof Te.get!="function")throw Error("Unknown input type for opt_headers: "+String(Te));var tt,vt=pn(Te.keys());try{for(vt.s();!(tt=vt.n()).done;){var rn=tt.value;he.set(rn,Te.get(rn))}}catch(Vr){vt.e(Vr)}finally{vt.f()}}Te=Array.from(he.keys()).find(function(Vr){return Vr.toLowerCase()=="content-type"}),Ye=a.FormData&&k instanceof a.FormData,!(0<=Array.prototype.indexOf.call(vh,Z,void 0))||Te||Ye||he.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");var vn,Rr=pn(he);try{for(Rr.s();!(vn=Rr.n()).done;){var cn=Gr(vn.value,2),ts=cn[0],ci=cn[1];this.g.setRequestHeader(ts,ci)}}catch(Vr){Rr.e(Vr)}finally{Rr.f()}this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{bc(this),this.u=!0,this.g.send(k),this.u=!1}catch(Vr){$a(this,Vr)}},t.abort=function(k){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=k||7,ct(this,"complete"),ct(this,"abort"),Iu(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Iu(this,!0)),Or.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Ru(this):this.bb())},t.bb=function(){Ru(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<no(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(k){if(this.g){var Z=this.g.responseText;return k&&Z.indexOf(k)==0&&(Z=Z.substring(k.length)),Ns(Z)}},t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)},(t=sa.prototype).la=8,t.G=1,t.connect=function(k,Z,he,Te){zi(0),this.W=k,this.H=Z||{},he&&Te!==void 0&&(this.H.OSID=he,this.H.OAID=Te),this.F=this.X,this.I=wc(this,null,this.W),st(this)},t.Ga=function(k){if(this.s)if(this.s=null,this.G==1){if(!k){this.U=Math.floor(1e5*Math.random()),k=this.U++;var Z=new zs(this,this.j,k),he=this.o;if(this.S&&(he?te(he=F(he),this.S):he=this.S),this.m!==null||this.O||(Z.H=he,he=null),this.P)e:{for(var Te=0,Ye=0;Ye<this.i.length;Ye++){var tt=this.i[Ye];if((tt="__data__"in tt.map&&typeof(tt=tt.map.__data__)=="string"?tt.length:void 0)===void 0)break;if(4096<(Te+=tt)){Te=Ye;break e}if(Te===4096||Ye===this.i.length-1){Te=Ye+1;break e}}Te=1e3}else Te=1e3;Te=Ur(this,Z,Te),Mr(Ye=es(this.I),"RID",k),Mr(Ye,"CVER",22),this.D&&Mr(Ye,"X-HTTP-Session-Id",this.D),Zn(this,Ye),he&&(this.O?Te="headers="+encodeURIComponent(String(Uo(he)))+"&"+Te:this.m&&Tc(Ye,this.m,he)),Ra(this.h,Z),this.Ua&&Mr(Ye,"TYPE","init"),this.P?(Mr(Ye,"$req",Te),Mr(Ye,"SID","null"),Z.T=!0,kd(Z,Ye,null)):kd(Z,Ye,Te),this.G=2}}else this.G==3&&(k?nn(this,k):this.i.length==0||ll(this.h)||nn(this))},t.Fa=function(){if(this.u=null,Ri(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var k=2*this.R;this.j.info("BP detection timer enabled: "+k),this.A=Do(E(this.ab,this),k)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,zi(10),Ce(this),Ri(this))},t.Za=function(){this.C!=null&&(this.C=null,Ce(this),hn(this),zi(19))},t.fb=function(k){k?(this.j.info("Successfully pinged google.com"),zi(2)):(this.j.info("Failed to ping google.com"),zi(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=Xa.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},Kl.prototype.g=function(k,Z){return new io(k,Z)},C(io,at),io.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},io.prototype.close=function(){Ya(this.g)},io.prototype.o=function(k){var Z=this.g;if(typeof k=="string"){var he={};he.__data__=k,k=he}else this.u&&((he={}).__data__=Yr(k),k=he);Z.i.push(new ul(Z.Ya++,k)),Z.G==3&&st(Z)},io.prototype.N=function(){this.g.l=null,delete this.j,Ya(this.g),delete this.g,io.aa.N.call(this)},C(Au,za),C(jo,ba),C(aa,Xa),aa.prototype.ua=function(){ct(this.g,"a")},aa.prototype.ta=function(k){ct(this.g,new Au(k))},aa.prototype.sa=function(k){ct(this.g,new jo)},aa.prototype.ra=function(){ct(this.g,"b")},Kl.prototype.createWebChannel=Kl.prototype.g,io.prototype.send=io.prototype.o,io.prototype.open=io.prototype.m,io.prototype.close=io.prototype.close,Hue=function(){return new Kl},Gue=function(){return Wi()},zue=ys,Oj={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},us.NO_ERROR=0,us.TIMEOUT=8,us.HTTP_ERROR=6,vN=us,Ca.COMPLETE="complete",Wue=Ca,Cr.EventType=Bi,Bi.OPEN="a",Bi.CLOSE="b",Bi.ERROR="c",Bi.MESSAGE="d",at.prototype.listen=at.prototype.K,dC=Cr,Or.prototype.listenOnce=Or.prototype.L,Or.prototype.getLastError=Or.prototype.Ka,Or.prototype.getLastErrorCode=Or.prototype.Ba,Or.prototype.getStatus=Or.prototype.Z,Or.prototype.getResponseJson=Or.prototype.Oa,Or.prototype.getResponseText=Or.prototype.oa,Or.prototype.send=Or.prototype.ea,Or.prototype.setWithCredentials=Or.prototype.Ha,Bue=Or}).apply(PP!==void 0?PP:typeof self<"u"?self:typeof window<"u"?window:{});var Uee="@firebase/firestore",zc=function(){return Me(function t(e){xe(this,t),this.uid=e},[{key:"isAuthenticated",value:function(){return this.uid!=null}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(t){return t.uid===this.uid}}])}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zc.UNAUTHENTICATED=new zc(null),zc.GOOGLE_CREDENTIALS=new zc("google-credentials-uid"),zc.FIRST_PARTY=new zc("first-party-uid"),zc.MOCK_USER=new zc("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var i0="10.14.0",wf=new j5("@firebase/firestore");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kw(){return wf.logLevel}function Sn(t){if(wf.logLevel<=ai.DEBUG){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];var a=r.map(B5);wf.debug.apply(wf,["Firestore (".concat(i0,"): ").concat(t)].concat(Ps(a)))}}function em(t){if(wf.logLevel<=ai.ERROR){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];var a=r.map(B5);wf.error.apply(wf,["Firestore (".concat(i0,"): ").concat(t)].concat(Ps(a)))}}function BT(t){if(wf.logLevel<=ai.WARN){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];var a=r.map(B5);wf.warn.apply(wf,["Firestore (".concat(i0,"): ").concat(t)].concat(Ps(a)))}}function B5(t){if(typeof t=="string")return t;try{/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */return function(e){return JSON.stringify(e)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ar(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"Unexpected state",e="FIRESTORE (".concat(i0,") INTERNAL ASSERTION FAILED: ")+t;throw em(e),new Error(e)}function _o(t,e){t||Ar()}function pi(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},tr=function(){function t(e,r){var o;return xe(this,t),(o=Jn(this,t,[e,r])).code=e,o.message=r,o.toString=function(){return"".concat(o.name,": [code=").concat(o.code,"]: ").concat(o.message)},o}return Qn(t,ky),Me(t)}(),ry=Me(function t(){var e=this;xe(this,t),this.promise=new Promise(function(r,o){e.resolve=r,e.reject=o})}),Kue=Me(function t(e,r){xe(this,t),this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}),u3e=function(){return Me(function t(){xe(this,t)},[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(t,e){t.enqueueRetryable(function(){return e(zc.UNAUTHENTICATED)})}},{key:"shutdown",value:function(){}}])}(),l3e=function(){return Me(function t(e){xe(this,t),this.token=e,this.changeListener=null},[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(t,e){var r=this;this.changeListener=e,t.enqueueRetryable(function(){return e(r.token.user)})}},{key:"shutdown",value:function(){this.changeListener=null}}])}(),d3e=function(){return Me(function t(e){xe(this,t),this.t=e,this.currentUser=zc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null},[{key:"start",value:function(t,e){var r=this;_o(this.o===void 0);var o=this.i,a=function(g){return r.i!==o?(o=r.i,e(g)):Promise.resolve()},u=new ry;this.o=function(){r.i++,r.currentUser=r.u(),u.resolve(),u=new ry,t.enqueueRetryable(function(){return a(r.currentUser)})};var d=function(){var g=u;t.enqueueRetryable(Ue(ue().mark(function E(){return ue().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,g.promise;case 2:return T.next=4,a(r.currentUser);case 4:case"end":return T.stop()}},E)})))},f=function(g){Sn("FirebaseAuthCredentialsProvider","Auth detected"),r.auth=g,r.o&&(r.auth.addAuthTokenListener(r.o),d())};this.t.onInit(function(g){return f(g)}),setTimeout(function(){if(!r.auth){var g=r.t.getImmediate({optional:!0});g?f(g):(Sn("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new ry)}},0),d()}},{key:"getToken",value:function(){var t=this,e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(function(o){return t.i!==e?(Sn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),t.getToken()):o?(_o(typeof o.accessToken=="string"),new Kue(o.accessToken,t.currentUser)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}},{key:"u",value:function(){var t=this.auth&&this.auth.getUid();return _o(t===null||typeof t=="string"),new zc(t)}}])}(),h3e=function(){return Me(function t(e,r,o){xe(this,t),this.l=e,this.h=r,this.P=o,this.type="FirstParty",this.user=zc.FIRST_PARTY,this.I=new Map},[{key:"T",value:function(){return this.P?this.P():null}},{key:"headers",get:function(){this.I.set("X-Goog-AuthUser",this.l);var t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}])}(),f3e=function(){return Me(function t(e,r,o){xe(this,t),this.l=e,this.h=r,this.P=o},[{key:"getToken",value:function(){return Promise.resolve(new h3e(this.l,this.h,this.P))}},{key:"start",value:function(t,e){t.enqueueRetryable(function(){return e(zc.FIRST_PARTY)})}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}])}(),p3e=Me(function t(e){xe(this,t),this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}),m3e=function(){return Me(function t(e){xe(this,t),this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null},[{key:"start",value:function(t,e){var r=this;_o(this.o===void 0);var o=function(u){u.error!=null&&Sn("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(u.error.message));var d=u.token!==r.R;return r.R=u.token,Sn("FirebaseAppCheckTokenProvider","Received ".concat(d?"new":"existing"," token.")),d?e(u.token):Promise.resolve()};this.o=function(u){t.enqueueRetryable(function(){return o(u)})};var a=function(u){Sn("FirebaseAppCheckTokenProvider","AppCheck detected"),r.appCheck=u,r.o&&r.appCheck.addTokenListener(r.o)};this.A.onInit(function(u){return a(u)}),setTimeout(function(){if(!r.appCheck){var u=r.A.getImmediate({optional:!0});u?a(u):Sn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}},{key:"getToken",value:function(){var t=this,e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(function(r){return r?(_o(typeof r.token=="string"),t.R=r.token,new p3e(r.token)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}])}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g3e(t){var e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(var o=0;o<t;o++)r[o]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var que=function(){return Me(function t(){xe(this,t)},null,[{key:"newId",value:function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(256/62),r="";r.length<20;)for(var o=g3e(40),a=0;a<o.length;++a)r.length<20&&o[a]<e&&(r+=t.charAt(o[a]%62));return r}}])}();function Ni(t,e){return t<e?-1:t>e?1:0}function WT(t,e,r){return t.length===e.length&&t.every(function(o,a){return r(o,e[a])})}var Cf=function(){function t(e,r){if(xe(this,t),this.seconds=e,this.nanoseconds=r,r<0)throw new tr(tn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new tr(tn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new tr(tn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new tr(tn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}return Me(t,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?Ni(this.nanoseconds,e.nanoseconds):Ni(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return t.fromMillis(Date.now())}},{key:"fromDate",value:function(e){return t.fromMillis(e.getTime())}},{key:"fromMillis",value:function(e){var r=Math.floor(e/1e3);return new t(r,Math.floor(1e6*(e-1e3*r)))}}])}(),jr=function(){function t(e){xe(this,t),this.timestamp=e}return Me(t,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(e){return new t(e)}},{key:"min",value:function(){return new t(new Cf(0,0))}},{key:"max",value:function(){return new t(new Cf(253402300799,999999999))}}])}(),$ue=function(){function t(e,r,o){xe(this,t),r===void 0?r=0:r>e.length&&Ar(),o===void 0?o=e.length-r:o>e.length-r&&Ar(),this.segments=e,this.offset=r,this.len=o}return Me(t,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(e){return t.comparator(this,e)===0}},{key:"child",value:function(e){var r=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(o){r.push(o)}):r.push(e),this.construct(r)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return this.length===0}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}},{key:"forEach",value:function(e){for(var r=this.offset,o=this.limit();r<o;r++)e(this.segments[r])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,r){for(var o=Math.min(e.length,r.length),a=0;a<o;a++){var u=e.get(a),d=r.get(a);if(u<d)return-1;if(u>d)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}])}(),Jo=function(){function t(){return xe(this,t),Jn(this,t,arguments)}return Qn(t,$ue),Me(t,[{key:"construct",value:function(e,r,o){return new t(e,r,o)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"toUriEncodedString",value:function(){return this.toArray().map(encodeURIComponent).join("/")}}],[{key:"fromString",value:function(){for(var e=[],r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];for(var u=0,d=o;u<d.length;u++){var f=d[u];if(f.indexOf("//")>=0)throw new tr(tn.INVALID_ARGUMENT,"Invalid segment (".concat(f,"). Paths must not contain // in them."));e.push.apply(e,Ps(f.split("/").filter(function(g){return g.length>0})))}return new t(e)}},{key:"emptyPath",value:function(){return new t([])}}])}(),v3e=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Hp=function(){function t(){return xe(this,t),Jn(this,t,arguments)}return Qn(t,$ue),Me(t,[{key:"construct",value:function(e,r,o){return new t(e,r,o)}},{key:"canonicalString",value:function(){return this.toArray().map(function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(e)||(e="`"+e+"`"),e}).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return this.length===1&&this.get(0)==="__name__"}}],[{key:"isValidIdentifier",value:function(e){return v3e.test(e)}},{key:"keyField",value:function(){return new t(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var r=[],o="",a=0,u=function(){if(o.length===0)throw new tr(tn.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));r.push(o),o=""},d=!1;a<e.length;){var f=e[a];if(f==="\\"){if(a+1===e.length)throw new tr(tn.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var g=e[a+1];if(g!=="\\"&&g!=="."&&g!=="`")throw new tr(tn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=g,a+=2}else f==="`"?(d=!d,a++):f!=="."||d?(o+=f,a++):(u(),a++)}if(u(),d)throw new tr(tn.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new t(r)}},{key:"emptyPath",value:function(){return new t([])}}])}(),ar=function(){function t(e){xe(this,t),this.path=e}return Me(t,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return e!==null&&Jo.comparator(this.path,e.path)===0}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(e){return new t(Jo.fromString(e))}},{key:"fromName",value:function(e){return new t(Jo.fromString(e).popFirst(5))}},{key:"empty",value:function(){return new t(Jo.emptyPath())}},{key:"comparator",value:function(e,r){return Jo.comparator(e.path,r.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(e){return new t(new Jo(e.slice()))}}])}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _3e(t){return new _R(t.readTime,t.key,-1)}Me(function t(e,r,o,a){xe(this,t),this.indexId=e,this.collectionGroup=r,this.fields=o,this.indexState=a}).UNKNOWN_ID=-1;var _R=function(){function t(e,r,o){xe(this,t),this.readTime=e,this.documentKey=r,this.largestBatchId=o}return Me(t,null,[{key:"min",value:function(){return new t(jr.min(),ar.empty(),-1)}},{key:"max",value:function(){return new t(jr.max(),ar.empty(),-1)}}])}();function y3e(t,e){var r=t.readTime.compareTo(e.readTime);return r!==0||(r=ar.comparator(t.documentKey,e.documentKey))!==0?r:Ni(t.largestBatchId,e.largestBatchId);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var E3e=function(){return Me(function t(){xe(this,t),this.onCommittedListeners=[]},[{key:"addOnCommittedListener",value:function(t){this.onCommittedListeners.push(t)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach(function(t){return t()})}}])}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W5(t){return Yue.apply(this,arguments)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yue(){return(Yue=Ue(ue().mark(function t(e){return ue().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e.code===tn.FAILED_PRECONDITION&&e.message==="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."){r.next=2;break}throw e;case 2:Sn("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return r.stop()}},t)}))).apply(this,arguments)}var Ht=function(){function t(e){var r=this;xe(this,t),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(function(o){r.isDone=!0,r.result=o,r.nextCallback&&r.nextCallback(o)},function(o){r.isDone=!0,r.error=o,r.catchCallback&&r.catchCallback(o)})}return Me(t,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(e,r){var o=this;return this.callbackAttached&&Ar(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new t(function(a,u){o.nextCallback=function(d){o.wrapSuccess(e,d).next(a,u)},o.catchCallback=function(d){o.wrapFailure(r,d).next(a,u)}})}},{key:"toPromise",value:function(){var e=this;return new Promise(function(r,o){e.next(r,o)})}},{key:"wrapUserFunction",value:function(e){try{var r=e();return r instanceof t?r:t.resolve(r)}catch(o){return t.reject(o)}}},{key:"wrapSuccess",value:function(e,r){return e?this.wrapUserFunction(function(){return e(r)}):t.resolve(r)}},{key:"wrapFailure",value:function(e,r){return e?this.wrapUserFunction(function(){return e(r)}):t.reject(r)}}],[{key:"resolve",value:function(e){return new t(function(r,o){r(e)})}},{key:"reject",value:function(e){return new t(function(r,o){o(e)})}},{key:"waitFor",value:function(e){return new t(function(r,o){var a=0,u=0,d=!1;e.forEach(function(f){++a,f.next(function(){++u,d&&u===a&&r()},function(g){return o(g)})}),d=!0,u===a&&r()})}},{key:"or",value:function(e){var r,o=t.resolve(!1),a=pn(e);try{var u=function(){var d=r.value;o=o.next(function(f){return f?t.resolve(f):d()})};for(a.s();!(r=a.n()).done;)u()}catch(d){a.e(d)}finally{a.f()}return o}},{key:"forEach",value:function(e,r){var o=this,a=[];return e.forEach(function(u,d){a.push(r.call(o,u,d))}),this.waitFor(a)}},{key:"mapArray",value:function(e,r){return new t(function(o,a){for(var u=e.length,d=new Array(u),f=0,g=function(){var T=E;r(e[T]).next(function(C){d[T]=C,++f===u&&o(d)},function(C){return a(C)})},E=0;E<u;E++)g()})}},{key:"doWhile",value:function(e,r){return new t(function(o,a){var u=function(d){function f(){return d.apply(this,arguments)}return f.toString=function(){return d.toString()},f}(function(){e()===!0?r().next(function(){u()},a):o()});u()})}}])}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iI(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var z5=function(){return Me(function t(e,r){var o=this;xe(this,t),this.previousValue=e,r&&(r.sequenceNumberHandler=function(a){return o.ie(a)},this.se=function(a){return r.writeSequenceNumber(a)})},[{key:"ie",value:function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}},{key:"next",value:function(){var t=++this.previousValue;return this.se&&this.se(t),t}}])}();function yD(t){return t==null}function h1(t){return t===0&&1/t==-1/0}z5.oe=-1;var S3e=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"].concat(["clientMetadata"]).concat(["remoteDocumentGlobal"]).concat(["collectionParents"]).concat(["bundles","namedQueries"]);[].concat(Ps(S3e),["documentOverlays"]);var T3e=[].concat(["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],["indexConfiguration","indexState","indexEntries"]);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vee(t){var e=0;for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function ED(t,e){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])}[].concat(Ps(T3e),["globals"]);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sa=function(){function t(e,r){xe(this,t),this.comparator=e,this.root=r||Tg.EMPTY}return Me(t,[{key:"insert",value:function(e,r){return new t(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,Tg.BLACK,null,null))}},{key:"remove",value:function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Tg.BLACK,null,null))}},{key:"get",value:function(e){for(var r=this.root;!r.isEmpty();){var o=this.comparator(e,r.key);if(o===0)return r.value;o<0?r=r.left:o>0&&(r=r.right)}return null}},{key:"indexOf",value:function(e){for(var r=0,o=this.root;!o.isEmpty();){var a=this.comparator(e,o.key);if(a===0)return r+o.left.size;a<0?o=o.left:(r+=o.left.size+1,o=o.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal(function(r,o){return e(r,o),!1})}},{key:"toString",value:function(){var e=[];return this.inorderTraversal(function(r,o){return e.push("".concat(r,":").concat(o)),!1}),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new NP(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new NP(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new NP(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new NP(this.root,e,this.comparator,!0)}}])}(),NP=function(){return Me(function t(e,r,o,a){xe(this,t),this.isReverse=a,this.nodeStack=[];for(var u=1;!e.isEmpty();)if(u=r?o(e.key,r):1,r&&a&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}},[{key:"getNext",value:function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(this.nodeStack.length===0)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}])}(),Tg=function(){function t(e,r,o,a,u){xe(this,t),this.key=e,this.value=r,this.color=o??t.RED,this.left=a??t.EMPTY,this.right=u??t.EMPTY,this.size=this.left.size+1+this.right.size}return Me(t,[{key:"copy",value:function(e,r,o,a,u){return new t(e??this.key,r??this.value,o??this.color,a??this.left,u??this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,r,o){var a=this,u=o(e,a.key);return(a=u<0?a.copy(null,null,null,a.left.insert(e,r,o),null):u===0?a.copy(null,r,null,null,null):a.copy(null,null,null,null,a.right.insert(e,r,o))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(e,r){var o,a=this;if(r(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,r),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),r(e,a.key)===0){if(a.right.isEmpty())return t.EMPTY;o=a.right.min(),a=a.copy(o.key,o.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,r))}return a.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}},{key:"rotateRight",value:function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ar();var e=this.left.check();if(e!==this.right.check())throw Ar();return e+(this.isRed()?0:1)}}])}();Tg.EMPTY=null,Tg.RED=!0,Tg.BLACK=!1,Tg.EMPTY=new(function(){return Me(function t(){xe(this,t),this.size=0},[{key:"key",get:function(){throw Ar()}},{key:"value",get:function(){throw Ar()}},{key:"color",get:function(){throw Ar()}},{key:"left",get:function(){throw Ar()}},{key:"right",get:function(){throw Ar()}},{key:"copy",value:function(t,e,r,o,a){return this}},{key:"insert",value:function(t,e,r){return new Tg(t,e)}},{key:"remove",value:function(t,e){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(t){return!1}},{key:"reverseTraversal",value:function(t){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}])}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sl=function(){function t(e){xe(this,t),this.comparator=e,this.data=new Sa(this.comparator)}return Me(t,[{key:"has",value:function(e){return this.data.get(e)!==null}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal(function(r,o){return e(r),!1})}},{key:"forEachInRange",value:function(e,r){for(var o=this.data.getIteratorFrom(e[0]);o.hasNext();){var a=o.getNext();if(this.comparator(a.key,e[1])>=0)return;r(a.key)}}},{key:"forEachWhile",value:function(e,r){var o;for(o=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}},{key:"getIterator",value:function(){return new Fee(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new Fee(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var r=this;return r.size<e.size&&(r=e,e=this),e.forEach(function(o){r=r.add(o)}),r}},{key:"isEqual",value:function(e){if(!(e instanceof t)||this.size!==e.size)return!1;for(var r=this.data.getIterator(),o=e.data.getIterator();r.hasNext();){var a=r.getNext().key,u=o.getNext().key;if(this.comparator(a,u)!==0)return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach(function(r){e.push(r)}),e}},{key:"toString",value:function(){var e=[];return this.forEach(function(r){return e.push(r)}),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(e){var r=new t(this.comparator);return r.data=e,r}}])}(),Fee=function(){return Me(function t(e){xe(this,t),this.iter=e},[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}])}(),hC=function(){function t(e){xe(this,t),this.fields=e,e.sort(Hp.comparator)}return Me(t,[{key:"unionWith",value:function(e){var r,o=new sl(Hp.comparator),a=pn(this.fields);try{for(a.s();!(r=a.n()).done;){var u=r.value;o=o.add(u)}}catch(E){a.e(E)}finally{a.f()}var d,f=pn(e);try{for(f.s();!(d=f.n()).done;){var g=d.value;o=o.add(g)}}catch(E){f.e(E)}finally{f.f()}return new t(o.toArray())}},{key:"covers",value:function(e){var r,o=pn(this.fields);try{for(o.s();!(r=o.n()).done;)if(r.value.isPrefixOf(e))return!0}catch(a){o.e(a)}finally{o.f()}return!1}},{key:"isEqual",value:function(e){return WT(this.fields,e.fields,function(r,o){return r.isEqual(o)})}}],[{key:"empty",value:function(){return new t([])}}])}(),Xue=function(){function t(){var e;return xe(this,t),(e=Jn(this,t,arguments)).name="Base64DecodeError",e}return Qn(t,FT(Error)),Me(t)}(),al=function(){function t(e){xe(this,t),this.binaryString=e}return Me(t,[{key:Symbol.iterator,value:function(){var e=this,r=0;return{next:function(){return r<e.binaryString.length?{value:e.binaryString.charCodeAt(r++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var r=new Uint8Array(e.length),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);return r}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return Ni(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){var r=function(o){try{return atob(o)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new Xue("Invalid base64 string: "+a):a}}(e);return new t(r)}},{key:"fromUint8Array",value:function(e){var r=function(o){for(var a="",u=0;u<o.length;++u)a+=String.fromCharCode(o[u]);return a}(e);return new t(r)}}])}();al.EMPTY_BYTE_STRING=new al("");var b3e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tm(t){if(_o(!!t),typeof t=="string"){var e=0,r=b3e.exec(t);if(_o(!!r),r[1]){var o=r[1];o=(o+"000000000").substr(0,9),e=Number(o)}var a=new Date(t);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:Fs(t.seconds),nanos:Fs(t.nanos)}}function Fs(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Hg(t){return typeof t=="string"?al.fromBase64String(t):al.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G5(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function H5(t){var e=t.mapValue.fields.__previous_value__;return G5(e)?H5(e):e}function yR(t){var e=tm(t.mapValue.fields.__local_write_time__.timestampValue);return new Cf(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var w3e=Me(function t(e,r,o,a,u,d,f,g,E){xe(this,t),this.databaseId=e,this.appId=r,this.persistenceKey=o,this.host=a,this.ssl=u,this.forceLongPolling=d,this.autoDetectLongPolling=f,this.longPollingOptions=g,this.useFetchStreams=E}),Jue=function(){function t(e,r){xe(this,t),this.projectId=e,this.database=r||"(default)"}return Me(t,[{key:"isDefaultDatabase",get:function(){return this.database==="(default)"}},{key:"isEqual",value:function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database}}],[{key:"empty",value:function(){return new t("","")}}])}(),DP={};function by(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?G5(t)?4:Zue(t)?9007199254740991:Que(t)?10:11:Ar()}function Df(t,e){if(t===e)return!0;var r=by(t);if(r!==by(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return yR(t).isEqual(yR(e));case 3:return function(o,a){if(typeof o.timestampValue=="string"&&typeof a.timestampValue=="string"&&o.timestampValue.length===a.timestampValue.length)return o.timestampValue===a.timestampValue;var u=tm(o.timestampValue),d=tm(a.timestampValue);return u.seconds===d.seconds&&u.nanos===d.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(o,a){return Hg(o.bytesValue).isEqual(Hg(a.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(o,a){return Fs(o.geoPointValue.latitude)===Fs(a.geoPointValue.latitude)&&Fs(o.geoPointValue.longitude)===Fs(a.geoPointValue.longitude)}(t,e);case 2:return function(o,a){if("integerValue"in o&&"integerValue"in a)return Fs(o.integerValue)===Fs(a.integerValue);if("doubleValue"in o&&"doubleValue"in a){var u=Fs(o.doubleValue),d=Fs(a.doubleValue);return u===d?h1(u)===h1(d):isNaN(u)&&isNaN(d)}return!1}(t,e);case 9:return WT(t.arrayValue.values||[],e.arrayValue.values||[],Df);case 10:case 11:return function(o,a){var u=o.mapValue.fields||{},d=a.mapValue.fields||{};if(Vee(u)!==Vee(d))return!1;for(var f in u)if(u.hasOwnProperty(f)&&(d[f]===void 0||!Df(u[f],d[f])))return!1;return!0}(t,e);default:return Ar()}}function ER(t,e){return(t.values||[]).find(function(r){return Df(r,e)})!==void 0}function zT(t,e){if(t===e)return 0;var r=by(t),o=by(e);if(r!==o)return Ni(r,o);switch(r){case 0:case 9007199254740991:return 0;case 1:return Ni(t.booleanValue,e.booleanValue);case 2:return function(a,u){var d=Fs(a.integerValue||a.doubleValue),f=Fs(u.integerValue||u.doubleValue);return d<f?-1:d>f?1:d===f?0:isNaN(d)?isNaN(f)?0:-1:1}(t,e);case 3:return jee(t.timestampValue,e.timestampValue);case 4:return jee(yR(t),yR(e));case 5:return Ni(t.stringValue,e.stringValue);case 6:return function(a,u){var d=Hg(a),f=Hg(u);return d.compareTo(f)}(t.bytesValue,e.bytesValue);case 7:return function(a,u){for(var d=a.split("/"),f=u.split("/"),g=0;g<d.length&&g<f.length;g++){var E=Ni(d[g],f[g]);if(E!==0)return E}return Ni(d.length,f.length)}(t.referenceValue,e.referenceValue);case 8:return function(a,u){var d=Ni(Fs(a.latitude),Fs(u.latitude));return d!==0?d:Ni(Fs(a.longitude),Fs(u.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Bee(t.arrayValue,e.arrayValue);case 10:return function(a,u){var d,f,g,E,T=a.fields||{},C=u.fields||{},I=(d=T.value)===null||d===void 0?void 0:d.arrayValue,D=(f=C.value)===null||f===void 0?void 0:f.arrayValue,L=Ni(((g=I==null?void 0:I.values)===null||g===void 0?void 0:g.length)||0,((E=D==null?void 0:D.values)===null||E===void 0?void 0:E.length)||0);return L!==0?L:Bee(I,D)}(t.mapValue,e.mapValue);case 11:return function(a,u){if(a===DP&&u===DP)return 0;if(a===DP)return 1;if(u===DP)return-1;var d=a.fields||{},f=Object.keys(d),g=u.fields||{},E=Object.keys(g);f.sort(),E.sort();for(var T=0;T<f.length&&T<E.length;++T){var C=Ni(f[T],E[T]);if(C!==0)return C;var I=zT(d[f[T]],g[E[T]]);if(I!==0)return I}return Ni(f.length,E.length)}(t.mapValue,e.mapValue);default:throw Ar()}}function jee(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ni(t,e);var r=tm(t),o=tm(e),a=Ni(r.seconds,o.seconds);return a!==0?a:Ni(r.nanos,o.nanos)}function Bee(t,e){for(var r=t.values||[],o=e.values||[],a=0;a<r.length&&a<o.length;++a){var u=zT(r[a],o[a]);if(u)return u}return Ni(r.length,o.length)}function GT(t){return Pj(t)}function Pj(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(e){var r=tm(e);return"time(".concat(r.seconds,",").concat(r.nanos,")")}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(e){return Hg(e).toBase64()}(t.bytesValue):"referenceValue"in t?function(e){return ar.fromName(e).toString()}(t.referenceValue):"geoPointValue"in t?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(t.geoPointValue):"arrayValue"in t?function(e){var r,o="[",a=!0,u=pn(e.values||[]);try{for(u.s();!(r=u.n()).done;){var d=r.value;a?a=!1:o+=",",o+=Pj(d)}}catch(f){u.e(f)}finally{u.f()}return o+"]"}(t.arrayValue):"mapValue"in t?function(e){var r,o="{",a=!0,u=pn(Object.keys(e.fields||{}).sort());try{for(u.s();!(r=u.n()).done;){var d=r.value;a?a=!1:o+=",",o+="".concat(d,":").concat(Pj(e.fields[d]))}}catch(f){u.e(f)}finally{u.f()}return o+"}"}(t.mapValue):Ar()}function M2(t){return!!t&&"integerValue"in t}function K5(t){return!!t&&"arrayValue"in t}function Wee(t){return!!t&&"nullValue"in t}function zee(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function U2(t){return!!t&&"mapValue"in t}function Que(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function LC(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&vo(t.timestampValue)=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return ED(t.mapValue.fields,function(a,u){return e.mapValue.fields[a]=LC(u)}),e}if(t.arrayValue){for(var r={arrayValue:{values:[]}},o=0;o<(t.arrayValue.values||[]).length;++o)r.arrayValue.values[o]=LC(t.arrayValue.values[o]);return r}return Object.assign({},t)}function Zue(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var F_=function(){function t(e){xe(this,t),this.value=e}return Me(t,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var r=this.value,o=0;o<e.length-1;++o)if(!U2(r=(r.mapValue.fields||{})[e.get(o)]))return null;return(r=(r.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=LC(r)}},{key:"setAll",value:function(e){var r=this,o=Hp.emptyPath(),a={},u=[];e.forEach(function(f,g){if(!o.isImmediateParentOf(g)){var E=r.getFieldsMap(o);r.applyChanges(E,a,u),a={},u=[],o=g.popLast()}f?a[g.lastSegment()]=LC(f):u.push(g.lastSegment())});var d=this.getFieldsMap(o);this.applyChanges(d,a,u)}},{key:"delete",value:function(e){var r=this.field(e.popLast());U2(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return Df(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(var o=0;o<e.length;++o){var a=r.mapValue.fields[e.get(o)];U2(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},r.mapValue.fields[e.get(o)]=a),r=a}return r.mapValue.fields}},{key:"applyChanges",value:function(e,r,o){ED(r,function(f,g){return e[f]=g});var a,u=pn(o);try{for(u.s();!(a=u.n()).done;){var d=a.value;delete e[d]}}catch(f){u.e(f)}finally{u.f()}}},{key:"clone",value:function(){return new t(LC(this.value))}}],[{key:"empty",value:function(){return new t({mapValue:{}})}}])}(),nm=function(){function t(e,r,o,a,u,d,f){xe(this,t),this.key=e,this.documentType=r,this.version=o,this.readTime=a,this.createTime=u,this.data=d,this.documentState=f}return Me(t,[{key:"convertToFoundDocument",value:function(e,r){return!this.createTime.isEqual(jr.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=F_.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=F_.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=jr.min(),this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return this.documentState===1}},{key:"hasCommittedMutations",get:function(){return this.documentState===2}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return this.documentType!==0}},{key:"isFoundDocument",value:function(){return this.documentType===1}},{key:"isNoDocument",value:function(){return this.documentType===2}},{key:"isUnknownDocument",value:function(){return this.documentType===3}},{key:"isEqual",value:function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}},{key:"mutableCopy",value:function(){return new t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(e){return new t(e,0,jr.min(),jr.min(),jr.min(),F_.empty(),0)}},{key:"newFoundDocument",value:function(e,r,o,a){return new t(e,1,r,jr.min(),o,a,0)}},{key:"newNoDocument",value:function(e,r){return new t(e,2,r,jr.min(),jr.min(),F_.empty(),0)}},{key:"newUnknownDocument",value:function(e,r){return new t(e,3,r,jr.min(),jr.min(),F_.empty(),2)}}])}(),f1=Me(function t(e,r){xe(this,t),this.position=e,this.inclusive=r});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gee(t,e,r){for(var o=0,a=0;a<t.position.length;a++){var u=e[a],d=t.position[a];if(o=u.field.isKeyField()?ar.comparator(ar.fromName(d.referenceValue),r.key):zT(d,r.data.field(u.field)),u.dir==="desc"&&(o*=-1),o!==0)break}return o}function Hee(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(var r=0;r<t.position.length;r++)if(!Df(t.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var p1=Me(function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"asc";xe(this,t),this.field=e,this.dir=r});function C3e(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ele=Me(function t(){xe(this,t)}),pc=function(){function t(e,r,o){var a;return xe(this,t),(a=Jn(this,t)).field=e,a.op=r,a.value=o,a}return Qn(t,ele),Me(t,[{key:"matches",value:function(e){var r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(zT(r,this.value)):r!==null&&by(this.value)===by(r)&&this.matchesComparison(zT(r,this.value))}},{key:"matchesComparison",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ar()}}},{key:"isInequality",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}},{key:"getFlattenedFilters",value:function(){return[this]}},{key:"getFilters",value:function(){return[this]}}],[{key:"create",value:function(e,r,o){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,o):new R3e(e,r,o):r==="array-contains"?new k3e(e,o):r==="in"?new O3e(e,o):r==="not-in"?new P3e(e,o):r==="array-contains-any"?new N3e(e,o):new t(e,r,o)}},{key:"createKeyFieldInFilter",value:function(e,r,o){return r==="in"?new I3e(e,o):new A3e(e,o)}}])}(),Kg=function(){function t(e,r){var o;return xe(this,t),(o=Jn(this,t)).filters=e,o.op=r,o.ae=null,o}return Qn(t,ele),Me(t,[{key:"matches",value:function(e){return tle(this)?this.filters.find(function(r){return!r.matches(e)})===void 0:this.filters.find(function(r){return r.matches(e)})!==void 0}},{key:"getFlattenedFilters",value:function(){return this.ae!==null||(this.ae=this.filters.reduce(function(e,r){return e.concat(r.getFlattenedFilters())},[])),this.ae}},{key:"getFilters",value:function(){return Object.assign([],this.filters)}}],[{key:"create",value:function(e,r){return new t(e,r)}}])}();function tle(t){return t.op==="and"}function nle(t){return function(e){var r,o=pn(e.filters);try{for(o.s();!(r=o.n()).done;)if(r.value instanceof Kg)return!1}catch(a){o.e(a)}finally{o.f()}return!0}(t)&&tle(t)}function Nj(t){if(t instanceof pc)return t.field.canonicalString()+t.op.toString()+GT(t.value);if(nle(t))return t.filters.map(function(r){return Nj(r)}).join(",");var e=t.filters.map(function(r){return Nj(r)}).join(",");return"".concat(t.op,"(").concat(e,")")}function rle(t,e){return t instanceof pc?function(r,o){return o instanceof pc&&r.op===o.op&&r.field.isEqual(o.field)&&Df(r.value,o.value)}(t,e):t instanceof Kg?function(r,o){return o instanceof Kg&&r.op===o.op&&r.filters.length===o.filters.length&&r.filters.reduce(function(a,u,d){return a&&rle(u,o.filters[d])},!0)}(t,e):void Ar()}function ile(t){return t instanceof pc?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(GT(e.value))}(t):t instanceof Kg?function(e){return e.op.toString()+" {"+e.getFilters().map(ile).join(" ,")+"}"}(t):"Filter"}var R3e=function(){function t(e,r,o){var a;return xe(this,t),(a=Jn(this,t,[e,r,o])).key=ar.fromName(o.referenceValue),a}return Qn(t,pc),Me(t,[{key:"matches",value:function(e){var r=ar.comparator(e.key,this.key);return this.matchesComparison(r)}}])}(),I3e=function(){function t(e,r){var o;return xe(this,t),(o=Jn(this,t,[e,"in",r])).keys=sle("in",r),o}return Qn(t,pc),Me(t,[{key:"matches",value:function(e){return this.keys.some(function(r){return r.isEqual(e.key)})}}])}(),A3e=function(){function t(e,r){var o;return xe(this,t),(o=Jn(this,t,[e,"not-in",r])).keys=sle("not-in",r),o}return Qn(t,pc),Me(t,[{key:"matches",value:function(e){return!this.keys.some(function(r){return r.isEqual(e.key)})}}])}();function sle(t,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(function(o){return ar.fromName(o.referenceValue)})}var k3e=function(){function t(e,r){return xe(this,t),Jn(this,t,[e,"array-contains",r])}return Qn(t,pc),Me(t,[{key:"matches",value:function(e){var r=e.data.field(this.field);return K5(r)&&ER(r.arrayValue,this.value)}}])}(),O3e=function(){function t(e,r){return xe(this,t),Jn(this,t,[e,"in",r])}return Qn(t,pc),Me(t,[{key:"matches",value:function(e){var r=e.data.field(this.field);return r!==null&&ER(this.value.arrayValue,r)}}])}(),P3e=function(){function t(e,r){return xe(this,t),Jn(this,t,[e,"not-in",r])}return Qn(t,pc),Me(t,[{key:"matches",value:function(e){if(ER(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var r=e.data.field(this.field);return r!==null&&!ER(this.value.arrayValue,r)}}])}(),N3e=function(){function t(e,r){return xe(this,t),Jn(this,t,[e,"array-contains-any",r])}return Qn(t,pc),Me(t,[{key:"matches",value:function(e){var r=this,o=e.data.field(this.field);return!(!K5(o)||!o.arrayValue.values)&&o.arrayValue.values.some(function(a){return ER(r.value.arrayValue,a)})}}])}(),D3e=Me(function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,d=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,f=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;xe(this,t),this.path=e,this.collectionGroup=r,this.orderBy=o,this.filters=a,this.limit=u,this.startAt=d,this.endAt=f,this.ue=null});function Kee(t){return new D3e(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,arguments.length>6&&arguments[6]!==void 0?arguments[6]:null)}function q5(t){var e=pi(t);if(e.ue===null){var r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(function(o){return Nj(o)}).join(","),r+="|ob:",r+=e.orderBy.map(function(o){return function(a){return a.field.canonicalString()+a.dir}(o)}).join(","),yD(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(function(o){return GT(o)}).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(function(o){return GT(o)}).join(",")),e.ue=r}return e.ue}function $5(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(var r=0;r<t.orderBy.length;r++)if(!C3e(t.orderBy[r],e.orderBy[r]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o=0;o<t.filters.length;o++)if(!rle(t.filters[o],e.filters[o]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Hee(t.startAt,e.startAt)&&Hee(t.endAt,e.endAt)}function Dj(t){return ar.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var SD=Me(function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,d=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"F",f=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,g=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null;xe(this,t),this.path=e,this.collectionGroup=r,this.explicitOrderBy=o,this.filters=a,this.limit=u,this.limitType=d,this.startAt=f,this.endAt=g,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt});function Y5(t){return new SD(t)}function qee(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function xC(t){var e=pi(t);if(e.ce===null){e.ce=[];var r,o=new Set,a=pn(e.explicitOrderBy);try{for(a.s();!(r=a.n()).done;){var u=r.value;e.ce.push(u),o.add(u.field.canonicalString())}}catch(g){a.e(g)}finally{a.f()}var d=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",f=function(g){var E=new sl(Hp.comparator);return g.filters.forEach(function(T){T.getFlattenedFilters().forEach(function(C){C.isInequality()&&(E=E.add(C.field))})}),E}(e);f.forEach(function(g){o.has(g.canonicalString())||g.isKeyField()||e.ce.push(new p1(g,d))}),o.has(Hp.keyField().canonicalString())||e.ce.push(new p1(Hp.keyField(),d))}return e.ce}function Rf(t){var e=pi(t);return e.le||(e.le=function(r,o){if(r.limitType==="F")return Kee(r.path,r.collectionGroup,o,r.filters,r.limit,r.startAt,r.endAt);o=o.map(function(d){var f=d.dir==="desc"?"asc":"desc";return new p1(d.field,f)});var a=r.endAt?new f1(r.endAt.position,r.endAt.inclusive):null,u=r.startAt?new f1(r.startAt.position,r.startAt.inclusive):null;return Kee(r.path,r.collectionGroup,o,r.filters,r.limit,a,u)}(e,xC(t))),e.le}function Lj(t,e,r){return new SD(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,r,t.startAt,t.endAt)}function TD(t,e){return $5(Rf(t),Rf(e))&&t.limitType===e.limitType}function ole(t){return"".concat(q5(Rf(t)),"|lt:").concat(t.limitType)}function WS(t){return"Query(target=".concat(function(e){var r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=", filters: [".concat(e.filters.map(function(o){return ile(o)}).join(", "),"]")),yD(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=", orderBy: [".concat(e.orderBy.map(function(o){return function(a){return"".concat(a.field.canonicalString()," (").concat(a.dir,")")}(o)}).join(", "),"]")),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(function(o){return GT(o)}).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(function(o){return GT(o)}).join(",")),"Target(".concat(r,")")}(Rf(t)),"; limitType=").concat(t.limitType,")")}function bD(t,e){return e.isFoundDocument()&&function(r,o){var a=o.key.path;return r.collectionGroup!==null?o.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(a):ar.isDocumentKey(r.path)?r.path.isEqual(a):r.path.isImmediateParentOf(a)}(t,e)&&function(r,o){var a,u=pn(xC(r));try{for(u.s();!(a=u.n()).done;){var d=a.value;if(!d.field.isKeyField()&&o.data.field(d.field)===null)return!1}}catch(f){u.e(f)}finally{u.f()}return!0}(t,e)&&function(r,o){var a,u=pn(r.filters);try{for(u.s();!(a=u.n()).done;)if(!a.value.matches(o))return!1}catch(d){u.e(d)}finally{u.f()}return!0}(t,e)&&function(r,o){return!(r.startAt&&!function(a,u,d){var f=Gee(a,u,d);return a.inclusive?f<=0:f<0}(r.startAt,xC(r),o))&&!(r.endAt&&!function(a,u,d){var f=Gee(a,u,d);return a.inclusive?f>=0:f>0}(r.endAt,xC(r),o))}(t,e)}function ale(t){return function(e,r){var o,a=!1,u=pn(xC(t));try{for(u.s();!(o=u.n()).done;){var d=o.value,f=L3e(d,e,r);if(f!==0)return f;a=a||d.field.isKeyField()}}catch(g){u.e(g)}finally{u.f()}return 0}}function L3e(t,e,r){var o=t.field.isKeyField()?ar.comparator(e.key,r.key):function(a,u,d){var f=u.data.field(a),g=d.data.field(a);return f!==null&&g!==null?zT(f,g):Ar()}(t.field,e,r);switch(t.dir){case"asc":return o;case"desc":return-1*o;default:return Ar()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var s0=function(){return Me(function t(e,r){xe(this,t),this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0},[{key:"get",value:function(t){var e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){var o,a=pn(r);try{for(a.s();!(o=a.n()).done;){var u=Gr(o.value,2),d=u[0],f=u[1];if(this.equalsFn(d,t))return f}}catch(g){a.e(g)}finally{a.f()}}}},{key:"has",value:function(t){return this.get(t)!==void 0}},{key:"set",value:function(t,e){var r=this.mapKeyFn(t),o=this.inner[r];if(o===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(var a=0;a<o.length;a++)if(this.equalsFn(o[a][0],t))return void(o[a]=[t,e]);o.push([t,e]),this.innerSize++}},{key:"delete",value:function(t){var e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(var o=0;o<r.length;o++)if(this.equalsFn(r[o][0],t))return r.length===1?delete this.inner[e]:r.splice(o,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(t){ED(this.inner,function(e,r){var o,a=pn(r);try{for(a.s();!(o=a.n()).done;){var u=Gr(o.value,2),d=u[0],f=u[1];t(d,f)}}catch(g){a.e(g)}finally{a.f()}})}},{key:"isEmpty",value:function(){return function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(this.inner)}},{key:"size",value:function(){return this.innerSize}}])}(),x3e=new Sa(ar.comparator);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qg(){return x3e}var cle=new Sa(ar.comparator);function fC(){for(var t=cle,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];for(var a=0,u=r;a<u.length;a++){var d=u[a];t=t.insert(d.key,d)}return t}function M3e(t){var e=cle;return t.forEach(function(r,o){return e=e.insert(r,o.overlayedDocument)}),e}function H_(){return MC()}function ule(){return MC()}function MC(){return new s0(function(t){return t.toString()},function(t,e){return t.isEqual(e)})}new Sa(ar.comparator);var U3e=new sl(ar.comparator);function Si(){for(var t=U3e,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];for(var a=0,u=r;a<u.length;a++){var d=u[a];t=t.add(d)}return t}var V3e=new sl(Ni);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var wD=Me(function t(){xe(this,t),this._=void 0});function F3e(t,e,r){return t instanceof xj?function(o,a){var u={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return a&&G5(a)&&(a=H5(a)),a&&(u.fields.__previous_value__=a),{mapValue:u}}(r,e):t instanceof m1?lle(t,e):t instanceof g1?dle(t,e):function(o,a){var u=function(f,g){return f instanceof Mj?function(E){return M2(E)||function(T){return!!T&&"doubleValue"in T}(E)}(g)?g:{integerValue:0}:null}(o,a),d=$ee(u)+$ee(o.Pe);return M2(u)&&M2(o.Pe)?function(f){return{integerValue:""+f}}(d):function(f,g){if(f.useProto3Json){if(isNaN(g))return{doubleValue:"NaN"};if(g===1/0)return{doubleValue:"Infinity"};if(g===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:h1(g)?"-0":g}}(o.serializer,d)}(t,e)}function j3e(t,e,r){return t instanceof m1?lle(t,e):t instanceof g1?dle(t,e):r}var xj=function(){function t(){return xe(this,t),Jn(this,t,arguments)}return Qn(t,wD),Me(t)}(),m1=function(){function t(e){var r;return xe(this,t),(r=Jn(this,t)).elements=e,r}return Qn(t,wD),Me(t)}();function lle(t,e){var r,o=hle(e),a=pn(t.elements);try{var u=function(){var d=r.value;o.some(function(f){return Df(f,d)})||o.push(d)};for(a.s();!(r=a.n()).done;)u()}catch(d){a.e(d)}finally{a.f()}return{arrayValue:{values:o}}}var g1=function(){function t(e){var r;return xe(this,t),(r=Jn(this,t)).elements=e,r}return Qn(t,wD),Me(t)}();function dle(t,e){var r,o=hle(e),a=pn(t.elements);try{var u=function(){var d=r.value;o=o.filter(function(f){return!Df(f,d)})};for(a.s();!(r=a.n()).done;)u()}catch(d){a.e(d)}finally{a.f()}return{arrayValue:{values:o}}}var Mj=function(){function t(e,r){var o;return xe(this,t),(o=Jn(this,t)).serializer=e,o.Pe=r,o}return Qn(t,wD),Me(t)}();function $ee(t){return Fs(t.integerValue||t.doubleValue)}function hle(t){return K5(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var V2=function(){function t(e,r){xe(this,t),this.updateTime=e,this.exists=r}return Me(t,[{key:"isNone",get:function(){return this.updateTime===void 0&&this.exists===void 0}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new t}},{key:"exists",value:function(e){return new t(void 0,e)}},{key:"updateTime",value:function(e){return new t(e)}}])}();function _N(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}var X5=Me(function t(){xe(this,t)});function fle(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new W3e(t.key,V2.none()):new J5(t.key,t.data,V2.none());var r,o=t.data,a=F_.empty(),u=new sl(Hp.comparator),d=pn(e.fields);try{for(d.s();!(r=d.n()).done;){var f=r.value;if(!u.has(f)){var g=o.field(f);g===null&&f.length>1&&(f=f.popLast(),g=o.field(f)),g===null?a.delete(f):a.set(f,g),u=u.add(f)}}}catch(E){d.e(E)}finally{d.f()}return new CD(t.key,a,new hC(u.toArray()),V2.none())}function B3e(t,e,r){t instanceof J5?function(o,a,u){var d=o.value.clone(),f=Xee(o.fieldTransforms,a,u.transformResults);d.setAll(f),a.convertToFoundDocument(u.version,d).setHasCommittedMutations()}(t,e,r):t instanceof CD?function(o,a,u){if(_N(o.precondition,a)){var d=Xee(o.fieldTransforms,a,u.transformResults),f=a.data;f.setAll(ple(o)),f.setAll(d),a.convertToFoundDocument(u.version,f).setHasCommittedMutations()}else a.convertToUnknownDocument(u.version)}(t,e,r):function(o,a,u){a.convertToNoDocument(u.version).setHasCommittedMutations()}(0,e,r)}function UC(t,e,r,o){return t instanceof J5?function(a,u,d,f){if(!_N(a.precondition,u))return d;var g=a.value.clone(),E=Jee(a.fieldTransforms,f,u);return g.setAll(E),u.convertToFoundDocument(u.version,g).setHasLocalMutations(),null}(t,e,r,o):t instanceof CD?function(a,u,d,f){if(!_N(a.precondition,u))return d;var g=Jee(a.fieldTransforms,f,u),E=u.data;return E.setAll(ple(a)),E.setAll(g),u.convertToFoundDocument(u.version,E).setHasLocalMutations(),d===null?null:d.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(function(T){return T.field}))}(t,e,r,o):function(a,u,d){return _N(a.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):d}(t,e,r)}function Yee(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,o){return r===void 0&&o===void 0||!(!r||!o)&&WT(r,o,function(a,u){return function(d,f){return d.field.isEqual(f.field)&&function(g,E){return g instanceof m1&&E instanceof m1||g instanceof g1&&E instanceof g1?WT(g.elements,E.elements,Df):g instanceof Mj&&E instanceof Mj?Df(g.Pe,E.Pe):g instanceof xj&&E instanceof xj}(d.transform,f.transform)}(a,u)})}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}var J5=function(){function t(e,r,o){var a,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];return xe(this,t),(a=Jn(this,t)).key=e,a.value=r,a.precondition=o,a.fieldTransforms=u,a.type=0,a}return Qn(t,X5),Me(t,[{key:"getFieldMask",value:function(){return null}}])}(),CD=function(){function t(e,r,o,a){var u,d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[];return xe(this,t),(u=Jn(this,t)).key=e,u.data=r,u.fieldMask=o,u.precondition=a,u.fieldTransforms=d,u.type=1,u}return Qn(t,X5),Me(t,[{key:"getFieldMask",value:function(){return this.fieldMask}}])}();function ple(t){var e=new Map;return t.fieldMask.fields.forEach(function(r){if(!r.isEmpty()){var o=t.data.field(r);e.set(r,o)}}),e}function Xee(t,e,r){var o=new Map;_o(t.length===r.length);for(var a=0;a<r.length;a++){var u=t[a],d=u.transform,f=e.data.field(u.field);o.set(u.field,j3e(d,f,r[a]))}return o}function Jee(t,e,r){var o,a=new Map,u=pn(t);try{for(u.s();!(o=u.n()).done;){var d=o.value,f=d.transform,g=r.data.field(d.field);a.set(d.field,F3e(f,g,e))}}catch(E){u.e(E)}finally{u.f()}return a}var $o,fi,W3e=function(){function t(e,r){var o;return xe(this,t),(o=Jn(this,t)).key=e,o.precondition=r,o.type=2,o.fieldTransforms=[],o}return Qn(t,X5),Me(t,[{key:"getFieldMask",value:function(){return null}}])}(),z3e=function(){return Me(function t(e,r,o,a){xe(this,t),this.batchId=e,this.localWriteTime=r,this.baseMutations=o,this.mutations=a},[{key:"applyToRemoteDocument",value:function(t,e){for(var r=e.mutationResults,o=0;o<this.mutations.length;o++){var a=this.mutations[o];a.key.isEqual(t.key)&&B3e(a,t,r[o])}}},{key:"applyToLocalView",value:function(t,e){var r,o=pn(this.baseMutations);try{for(o.s();!(r=o.n()).done;){var a=r.value;a.key.isEqual(t.key)&&(e=UC(a,t,e,this.localWriteTime))}}catch(g){o.e(g)}finally{o.f()}var u,d=pn(this.mutations);try{for(d.s();!(u=d.n()).done;){var f=u.value;f.key.isEqual(t.key)&&(e=UC(f,t,e,this.localWriteTime))}}catch(g){d.e(g)}finally{d.f()}return e}},{key:"applyToLocalDocumentSet",value:function(t,e){var r=this,o=ule();return this.mutations.forEach(function(a){var u=t.get(a.key),d=u.overlayedDocument,f=r.applyToLocalView(d,u.mutatedFields),g=fle(d,f=e.has(a.key)?null:f);g!==null&&o.set(a.key,g),d.isValidDocument()||d.convertToNoDocument(jr.min())}),o}},{key:"keys",value:function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Si())}},{key:"isEqual",value:function(t){return this.batchId===t.batchId&&WT(this.mutations,t.mutations,function(e,r){return Yee(e,r)})&&WT(this.baseMutations,t.baseMutations,function(e,r){return Yee(e,r)})}}])}(),G3e=function(){return Me(function t(e,r){xe(this,t),this.largestBatchId=e,this.mutation=r},[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(t){return t!==null&&this.mutation===t.mutation}},{key:"toString",value:function(){return`Overlay{
      largestBatchId: `.concat(this.largestBatchId,`,
      mutation: `).concat(this.mutation.toString(),`
    }`)}}])}(),H3e=Me(function t(e,r){xe(this,t),this.count=e,this.unchangedNames=r});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mle(t){if(t===void 0)return em("GRPC error has no .code"),tn.UNKNOWN;switch(t){case $o.OK:return tn.OK;case $o.CANCELLED:return tn.CANCELLED;case $o.UNKNOWN:return tn.UNKNOWN;case $o.DEADLINE_EXCEEDED:return tn.DEADLINE_EXCEEDED;case $o.RESOURCE_EXHAUSTED:return tn.RESOURCE_EXHAUSTED;case $o.INTERNAL:return tn.INTERNAL;case $o.UNAVAILABLE:return tn.UNAVAILABLE;case $o.UNAUTHENTICATED:return tn.UNAUTHENTICATED;case $o.INVALID_ARGUMENT:return tn.INVALID_ARGUMENT;case $o.NOT_FOUND:return tn.NOT_FOUND;case $o.ALREADY_EXISTS:return tn.ALREADY_EXISTS;case $o.PERMISSION_DENIED:return tn.PERMISSION_DENIED;case $o.FAILED_PRECONDITION:return tn.FAILED_PRECONDITION;case $o.ABORTED:return tn.ABORTED;case $o.OUT_OF_RANGE:return tn.OUT_OF_RANGE;case $o.UNIMPLEMENTED:return tn.UNIMPLEMENTED;case $o.DATA_LOSS:return tn.DATA_LOSS;default:return Ar()}}(fi=$o||($o={}))[fi.OK=0]="OK",fi[fi.CANCELLED=1]="CANCELLED",fi[fi.UNKNOWN=2]="UNKNOWN",fi[fi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fi[fi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fi[fi.NOT_FOUND=5]="NOT_FOUND",fi[fi.ALREADY_EXISTS=6]="ALREADY_EXISTS",fi[fi.PERMISSION_DENIED=7]="PERMISSION_DENIED",fi[fi.UNAUTHENTICATED=16]="UNAUTHENTICATED",fi[fi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fi[fi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fi[fi.ABORTED=10]="ABORTED",fi[fi.OUT_OF_RANGE=11]="OUT_OF_RANGE",fi[fi.UNIMPLEMENTED=12]="UNIMPLEMENTED",fi[fi.INTERNAL=13]="INTERNAL",fi[fi.UNAVAILABLE=14]="UNAVAILABLE",fi[fi.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var K3e=new ny([4294967295,4294967295],0);function Qee(t){var e=new TextEncoder().encode(t),r=new jue;return r.update(e),new Uint8Array(r.digest())}function Zee(t){var e=new DataView(t.buffer),r=e.getUint32(0,!0),o=e.getUint32(4,!0),a=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new ny([r,o],0),new ny([a,u],0)]}var q3e=function(){function t(e,r,o){if(xe(this,t),this.bitmap=e,this.padding=r,this.hashCount=o,r<0||r>=8)throw new pC("Invalid padding: ".concat(r));if(o<0)throw new pC("Invalid hash count: ".concat(o));if(e.length>0&&this.hashCount===0)throw new pC("Invalid hash count: ".concat(o));if(e.length===0&&r!==0)throw new pC("Invalid padding when bitmap length is 0: ".concat(r));this.Ie=8*e.length-r,this.Te=ny.fromNumber(this.Ie)}return Me(t,[{key:"Ee",value:function(e,r,o){var a=e.add(r.multiply(ny.fromNumber(o)));return a.compare(K3e)===1&&(a=new ny([a.getBits(0),a.getBits(1)],0)),a.modulo(this.Te).toNumber()}},{key:"de",value:function(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}},{key:"mightContain",value:function(e){if(this.Ie===0)return!1;for(var r=Gr(Zee(Qee(e)),2),o=r[0],a=r[1],u=0;u<this.hashCount;u++){var d=this.Ee(o,a,u);if(!this.de(d))return!1}return!0}},{key:"insert",value:function(e){if(this.Ie!==0)for(var r=Gr(Zee(Qee(e)),2),o=r[0],a=r[1],u=0;u<this.hashCount;u++){var d=this.Ee(o,a,u);this.Ae(d)}}},{key:"Ae",value:function(e){var r=Math.floor(e/8),o=e%8;this.bitmap[r]|=1<<o}}],[{key:"create",value:function(e,r,o){var a=e%8==0?0:8-e%8,u=new t(new Uint8Array(Math.ceil(e/8)),a,r);return o.forEach(function(d){return u.insert(d)}),u}}])}(),pC=function(){function t(){var e;return xe(this,t),(e=Jn(this,t,arguments)).name="BloomFilterError",e}return Qn(t,FT(Error)),Me(t)}(),gle=function(){function t(e,r,o,a,u){xe(this,t),this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=o,this.documentUpdates=a,this.resolvedLimboDocuments=u}return Me(t,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(e,r,o){var a=new Map;return a.set(e,Q5.createSynthesizedTargetChangeForCurrentChange(e,r,o)),new t(jr.min(),a,new Sa(Ni),qg(),Si())}}])}(),Q5=function(){function t(e,r,o,a,u){xe(this,t),this.resumeToken=e,this.current=r,this.addedDocuments=o,this.modifiedDocuments=a,this.removedDocuments=u}return Me(t,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(e,r,o){return new t(o,r,Si(),Si(),Si())}}])}(),yN=Me(function t(e,r,o,a){xe(this,t),this.Re=e,this.removedTargetIds=r,this.key=o,this.Ve=a}),vle=Me(function t(e,r){xe(this,t),this.targetId=e,this.me=r}),_le=Me(function t(e,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:al.EMPTY_BYTE_STRING,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;xe(this,t),this.state=e,this.targetIds=r,this.resumeToken=o,this.cause=a}),ete=function(){return Me(function t(){xe(this,t),this.fe=0,this.ge=nte(),this.pe=al.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0},[{key:"current",get:function(){return this.ye}},{key:"resumeToken",get:function(){return this.pe}},{key:"Se",get:function(){return this.fe!==0}},{key:"be",get:function(){return this.we}},{key:"De",value:function(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}},{key:"ve",value:function(){var t=Si(),e=Si(),r=Si();return this.ge.forEach(function(o,a){switch(a){case 0:t=t.add(o);break;case 2:e=e.add(o);break;case 1:r=r.add(o);break;default:Ar()}}),new Q5(this.pe,this.ye,t,e,r)}},{key:"Ce",value:function(){this.we=!1,this.ge=nte()}},{key:"Fe",value:function(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}},{key:"Me",value:function(t){this.we=!0,this.ge=this.ge.remove(t)}},{key:"xe",value:function(){this.fe+=1}},{key:"Oe",value:function(){this.fe-=1,_o(this.fe>=0)}},{key:"Ne",value:function(){this.we=!0,this.ye=!0}}])}(),$3e=function(){return Me(function t(e){xe(this,t),this.Le=e,this.Be=new Map,this.ke=qg(),this.qe=tte(),this.Qe=new Sa(Ni)},[{key:"Ke",value:function(t){var e,r=pn(t.Re);try{for(r.s();!(e=r.n()).done;){var o=e.value;t.Ve&&t.Ve.isFoundDocument()?this.$e(o,t.Ve):this.Ue(o,t.key,t.Ve)}}catch(f){r.e(f)}finally{r.f()}var a,u=pn(t.removedTargetIds);try{for(u.s();!(a=u.n()).done;){var d=a.value;this.Ue(d,t.key,t.Ve)}}catch(f){u.e(f)}finally{u.f()}}},{key:"We",value:function(t){var e=this;this.forEachTarget(t,function(r){var o=e.Ge(r);switch(t.state){case 0:e.ze(r)&&o.De(t.resumeToken);break;case 1:o.Oe(),o.Se||o.Ce(),o.De(t.resumeToken);break;case 2:o.Oe(),o.Se||e.removeTarget(r);break;case 3:e.ze(r)&&(o.Ne(),o.De(t.resumeToken));break;case 4:e.ze(r)&&(e.je(r),o.De(t.resumeToken));break;default:Ar()}})}},{key:"forEachTarget",value:function(t,e){var r=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach(function(o,a){r.ze(a)&&e(a)})}},{key:"He",value:function(t){var e=t.targetId,r=t.me.count,o=this.Je(e);if(o){var a=o.target;if(Dj(a))if(r===0){var u=new ar(a.path);this.Ue(e,u,nm.newNoDocument(u,jr.min()))}else _o(r===1);else{var d=this.Ye(e);if(d!==r){var f=this.Ze(t),g=f?this.Xe(f,t,d):1;if(g!==0){this.je(e);var E=g===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,E)}}}}}},{key:"Ze",value:function(t){var e=t.me.unchangedNames;if(!e||!e.bits)return null;var r,o,a=e.bits,u=a.bitmap,d=u===void 0?"":u,f=a.padding,g=f===void 0?0:f,E=e.hashCount,T=E===void 0?0:E;try{r=Hg(d).toUint8Array()}catch(C){if(C instanceof Xue)return BT("Decoding the base64 bloom filter in existence filter failed ("+C.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw C}try{o=new q3e(r,g,T)}catch(C){return BT(C instanceof pC?"BloomFilter error: ":"Applying bloom filter failed: ",C),null}return o.Ie===0?null:o}},{key:"Xe",value:function(t,e,r){return e.me.count===r-this.nt(t,e.targetId)?0:2}},{key:"nt",value:function(t,e){var r=this,o=this.Le.getRemoteKeysForTarget(e),a=0;return o.forEach(function(u){var d=r.Le.tt(),f="projects/".concat(d.projectId,"/databases/").concat(d.database,"/documents/").concat(u.path.canonicalString());t.mightContain(f)||(r.Ue(e,u,null),a++)}),a}},{key:"rt",value:function(t){var e=this,r=new Map;this.Be.forEach(function(u,d){var f=e.Je(d);if(f){if(u.current&&Dj(f.target)){var g=new ar(f.target.path);e.ke.get(g)!==null||e.it(d,g)||e.Ue(d,g,nm.newNoDocument(g,t))}u.be&&(r.set(d,u.ve()),u.Ce())}});var o=Si();this.qe.forEach(function(u,d){var f=!0;d.forEachWhile(function(g){var E=e.Je(g);return!E||E.purpose==="TargetPurposeLimboResolution"||(f=!1,!1)}),f&&(o=o.add(u))}),this.ke.forEach(function(u,d){return d.setReadTime(t)});var a=new gle(t,r,this.Qe,this.ke,o);return this.ke=qg(),this.qe=tte(),this.Qe=new Sa(Ni),a}},{key:"$e",value:function(t,e){if(this.ze(t)){var r=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,r),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}}},{key:"Ue",value:function(t,e,r){if(this.ze(t)){var o=this.Ge(t);this.it(t,e)?o.Fe(e,1):o.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),r&&(this.ke=this.ke.insert(e,r))}}},{key:"removeTarget",value:function(t){this.Be.delete(t)}},{key:"Ye",value:function(t){var e=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}},{key:"xe",value:function(t){this.Ge(t).xe()}},{key:"Ge",value:function(t){var e=this.Be.get(t);return e||(e=new ete,this.Be.set(t,e)),e}},{key:"st",value:function(t){var e=this.qe.get(t);return e||(e=new sl(Ni),this.qe=this.qe.insert(t,e)),e}},{key:"ze",value:function(t){var e=this.Je(t)!==null;return e||Sn("WatchChangeAggregator","Detected inactive target",t),e}},{key:"Je",value:function(t){var e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}},{key:"je",value:function(t){var e=this;this.Be.set(t,new ete),this.Le.getRemoteKeysForTarget(t).forEach(function(r){e.Ue(t,r,null)})}},{key:"it",value:function(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}])}();function tte(){return new Sa(ar.comparator)}function nte(){return new Sa(ar.comparator)}var Y3e={asc:"ASCENDING",desc:"DESCENDING"},X3e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},J3e={and:"AND",or:"OR"},Q3e=Me(function t(e,r){xe(this,t),this.databaseId=e,this.useProto3Json=r});function Uj(t,e){return t.useProto3Json||yD(e)?e:{value:e}}function iT(t){return _o(!!t),jr.fromTimestamp(function(e){var r=tm(e);return new Cf(r.seconds,r.nanos)}(t))}function Vj(t,e){var r=function(o){return new Jo(["projects",o.projectId,"databases",o.database])}(t).child("documents");return e===void 0?r:r.child(e)}function yle(t){var e=Jo.fromString(t);return _o(wle(e)),e}function F2(t,e){var r=yle(e);if(r.get(1)!==t.databaseId.projectId)throw new tr(tn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+t.databaseId.projectId);if(r.get(3)!==t.databaseId.database)throw new tr(tn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+t.databaseId.database);return new ar(Sle(r))}function Ele(t,e){return function(r,o){return Vj(r,o).canonicalString()}(t.databaseId,e)}function rte(t){return new Jo(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Sle(t){return _o(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Z3e(t,e){return{documents:[Ele(t,e.path)]}}function e7e(t,e){var r,o={structuredQuery:{}},a=e.path;e.collectionGroup!==null?(r=a,o.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=a.popLast(),o.structuredQuery.from=[{collectionId:a.lastSegment()}]),o.parent=Ele(t,r);var u=function(g){if(g.length!==0)return ble(Kg.create(g,"and"))}(e.filters);u&&(o.structuredQuery.where=u);var d=function(g){if(g.length!==0)return g.map(function(E){return function(T){return{field:zS(T.field),direction:n7e(T.dir)}}(E)})}(e.orderBy);d&&(o.structuredQuery.orderBy=d);var f=Uj(t,e.limit);return f!==null&&(o.structuredQuery.limit=f),e.startAt&&(o.structuredQuery.startAt=function(g){return{before:g.inclusive,values:g.position}}(e.startAt)),e.endAt&&(o.structuredQuery.endAt=function(g){return{before:!g.inclusive,values:g.position}}(e.endAt)),{_t:o,parent:r}}function t7e(t){var e=function(C){var I=yle(C);return I.length===4?Jo.emptyPath():Sle(I)}(t.parent),r=t.structuredQuery,o=r.from?r.from.length:0,a=null;if(o>0){_o(o===1);var u=r.from[0];u.allDescendants?a=u.collectionId:e=e.child(u.collectionId)}var d=[];r.where&&(d=function(C){var I=Tle(C);return I instanceof Kg&&nle(I)?I.getFilters():[I]}(r.where));var f=[];r.orderBy&&(f=function(C){return C.map(function(I){return function(D){return new p1(GS(D.field),function(L){switch(L){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(D.direction))}(I)})}(r.orderBy));var g=null;r.limit&&(g=function(C){var I;return yD(I=vo(C)=="object"?C.value:C)?null:I}(r.limit));var E=null;r.startAt&&(E=function(C){var I=!!C.before,D=C.values||[];return new f1(D,I)}(r.startAt));var T=null;return r.endAt&&(T=function(C){var I=!C.before,D=C.values||[];return new f1(D,I)}(r.endAt)),function(C,I,D,L,B,G,se,ae){return new SD(C,I,D,L,B,G,se,ae)}(e,a,f,d,g,"F",E,T)}function Tle(t){return t.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":var r=GS(e.unaryFilter.field);return pc.create(r,"==",{doubleValue:NaN});case"IS_NULL":var o=GS(e.unaryFilter.field);return pc.create(o,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var a=GS(e.unaryFilter.field);return pc.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var u=GS(e.unaryFilter.field);return pc.create(u,"!=",{nullValue:"NULL_VALUE"});default:return Ar()}}(t):t.fieldFilter!==void 0?function(e){return pc.create(GS(e.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ar()}}(e.fieldFilter.op),e.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(e){return Kg.create(e.compositeFilter.filters.map(function(r){return Tle(r)}),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Ar()}}(e.compositeFilter.op))}(t):Ar()}function n7e(t){return Y3e[t]}function r7e(t){return X3e[t]}function i7e(t){return J3e[t]}function zS(t){return{fieldPath:t.canonicalString()}}function GS(t){return Hp.fromServerFormat(t.fieldPath)}function ble(t){return t instanceof pc?function(e){if(e.op==="=="){if(zee(e.value))return{unaryFilter:{field:zS(e.field),op:"IS_NAN"}};if(Wee(e.value))return{unaryFilter:{field:zS(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(zee(e.value))return{unaryFilter:{field:zS(e.field),op:"IS_NOT_NAN"}};if(Wee(e.value))return{unaryFilter:{field:zS(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zS(e.field),op:r7e(e.op),value:e.value}}}(t):t instanceof Kg?function(e){var r=e.getFilters().map(function(o){return ble(o)});return r.length===1?r[0]:{compositeFilter:{op:i7e(e.op),filters:r}}}(t):Ar()}function wle(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Z5=function(){function t(e,r,o,a){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:jr.min(),d=arguments.length>5&&arguments[5]!==void 0?arguments[5]:jr.min(),f=arguments.length>6&&arguments[6]!==void 0?arguments[6]:al.EMPTY_BYTE_STRING,g=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null;xe(this,t),this.target=e,this.targetId=r,this.purpose=o,this.sequenceNumber=a,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=d,this.resumeToken=f,this.expectedCount=g}return Me(t,[{key:"withSequenceNumber",value:function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}},{key:"withResumeToken",value:function(e,r){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}},{key:"withExpectedCount",value:function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}},{key:"withLastLimboFreeSnapshotVersion",value:function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}])}(),s7e=Me(function t(e){xe(this,t),this.ct=e});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o7e(t){var e=t7e({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Lj(e,e.limit,"L"):e}var ite=function(){return Me(function t(){xe(this,t)},[{key:"It",value:function(t,e){this.Tt(t,e),e.Et()}},{key:"Tt",value:function(t,e){if("nullValue"in t)this.dt(e,5);else if("booleanValue"in t)this.dt(e,10),e.At(t.booleanValue?1:0);else if("integerValue"in t)this.dt(e,15),e.At(Fs(t.integerValue));else if("doubleValue"in t){var r=Fs(t.doubleValue);isNaN(r)?this.dt(e,13):(this.dt(e,15),h1(r)?e.At(0):e.At(r))}else if("timestampValue"in t){var o=t.timestampValue;this.dt(e,20),typeof o=="string"&&(o=tm(o)),e.Rt("".concat(o.seconds||"")),e.At(o.nanos||0)}else if("stringValue"in t)this.Vt(t.stringValue,e),this.ft(e);else if("bytesValue"in t)this.dt(e,30),e.gt(Hg(t.bytesValue)),this.ft(e);else if("referenceValue"in t)this.yt(t.referenceValue,e);else if("geoPointValue"in t){var a=t.geoPointValue;this.dt(e,45),e.At(a.latitude||0),e.At(a.longitude||0)}else"mapValue"in t?Zue(t)?this.dt(e,Number.MAX_SAFE_INTEGER):Que(t)?this.wt(t.mapValue,e):(this.St(t.mapValue,e),this.ft(e)):"arrayValue"in t?(this.bt(t.arrayValue,e),this.ft(e)):Ar()}},{key:"Vt",value:function(t,e){this.dt(e,25),this.Dt(t,e)}},{key:"Dt",value:function(t,e){e.Rt(t)}},{key:"St",value:function(t,e){var r=t.fields||{};this.dt(e,55);for(var o=0,a=Object.keys(r);o<a.length;o++){var u=a[o];this.Vt(u,e),this.Tt(r[u],e)}}},{key:"wt",value:function(t,e){var r,o,a=t.fields||{};this.dt(e,53);var u="value",d=((o=(r=a[u].arrayValue)===null||r===void 0?void 0:r.values)===null||o===void 0?void 0:o.length)||0;this.dt(e,15),e.At(Fs(d)),this.Vt(u,e),this.Tt(a[u],e)}},{key:"bt",value:function(t,e){var r=t.values||[];this.dt(e,50);var o,a=pn(r);try{for(a.s();!(o=a.n()).done;){var u=o.value;this.Tt(u,e)}}catch(d){a.e(d)}finally{a.f()}}},{key:"yt",value:function(t,e){var r=this;this.dt(e,37),ar.fromName(t).path.forEach(function(o){r.dt(e,60),r.Dt(o,e)})}},{key:"dt",value:function(t,e){t.At(e)}},{key:"ft",value:function(t){t.At(2)}}])}();ite.vt=new ite;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var a7e=function(){return Me(function t(){xe(this,t),this.un=new c7e},[{key:"addToCollectionParentIndex",value:function(t,e){return this.un.add(e),Ht.resolve()}},{key:"getCollectionParents",value:function(t,e){return Ht.resolve(this.un.getEntries(e))}},{key:"addFieldIndex",value:function(t,e){return Ht.resolve()}},{key:"deleteFieldIndex",value:function(t,e){return Ht.resolve()}},{key:"deleteAllFieldIndexes",value:function(t){return Ht.resolve()}},{key:"createTargetIndexes",value:function(t,e){return Ht.resolve()}},{key:"getDocumentsMatchingTarget",value:function(t,e){return Ht.resolve(null)}},{key:"getIndexType",value:function(t,e){return Ht.resolve(0)}},{key:"getFieldIndexes",value:function(t,e){return Ht.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(t){return Ht.resolve(null)}},{key:"getMinOffset",value:function(t,e){return Ht.resolve(_R.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(t,e){return Ht.resolve(_R.min())}},{key:"updateCollectionGroup",value:function(t,e,r){return Ht.resolve()}},{key:"updateIndexEntries",value:function(t,e){return Ht.resolve()}}])}(),c7e=function(){return Me(function t(){xe(this,t),this.index={}},[{key:"add",value:function(t){var e=t.lastSegment(),r=t.popLast(),o=this.index[e]||new sl(Jo.comparator),a=!o.has(r);return this.index[e]=o.add(r),a}},{key:"has",value:function(t){var e=t.lastSegment(),r=t.popLast(),o=this.index[e];return o&&o.has(r)}},{key:"getEntries",value:function(t){return(this.index[t]||new sl(Jo.comparator)).toArray()}}])}(),hg=function(){function t(e,r,o){xe(this,t),this.cacheSizeCollectionThreshold=e,this.percentileToCollect=r,this.maximumSequenceNumbersToCollect=o}return Me(t,null,[{key:"withCacheSize",value:function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}])}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */hg.DEFAULT_COLLECTION_PERCENTILE=10,hg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hg.DEFAULT=new hg(41943040,hg.DEFAULT_COLLECTION_PERCENTILE,hg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hg.DISABLED=new hg(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fj=function(){function t(e){xe(this,t),this.Ln=e}return Me(t,[{key:"next",value:function(){return this.Ln+=2,this.Ln}}],[{key:"Bn",value:function(){return new t(0)}},{key:"kn",value:function(){return new t(-1)}}])}(),u7e=function(){return Me(function t(){xe(this,t),this.changes=new s0(function(e){return e.toString()},function(e,r){return e.isEqual(r)}),this.changesApplied=!1},[{key:"addEntry",value:function(t){this.assertNotApplied(),this.changes.set(t.key,t)}},{key:"removeEntry",value:function(t,e){this.assertNotApplied(),this.changes.set(t,nm.newInvalidDocument(t).setReadTime(e))}},{key:"getEntry",value:function(t,e){this.assertNotApplied();var r=this.changes.get(e);return r!==void 0?Ht.resolve(r):this.getFromCache(t,e)}},{key:"getEntries",value:function(t,e){return this.getAllFromCache(t,e)}},{key:"apply",value:function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}},{key:"assertNotApplied",value:function(){}}])}(),l7e=Me(function t(e,r){xe(this,t),this.overlayedDocument=e,this.mutatedFields=r}),d7e=function(){return Me(function t(e,r,o,a){xe(this,t),this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=o,this.indexManager=a},[{key:"getDocument",value:function(t,e){var r=this,o=null;return this.documentOverlayCache.getOverlay(t,e).next(function(a){return o=a,r.remoteDocumentCache.getEntry(t,e)}).next(function(a){return o!==null&&UC(o.mutation,a,hC.empty(),Cf.now()),a})}},{key:"getDocuments",value:function(t,e){var r=this;return this.remoteDocumentCache.getEntries(t,e).next(function(o){return r.getLocalViewOfDocuments(t,o,Si()).next(function(){return o})})}},{key:"getLocalViewOfDocuments",value:function(t,e){var r=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Si(),a=H_();return this.populateOverlays(t,a,e).next(function(){return r.computeViews(t,e,a,o).next(function(u){var d=fC();return u.forEach(function(f,g){d=d.insert(f,g.overlayedDocument)}),d})})}},{key:"getOverlayedDocuments",value:function(t,e){var r=this,o=H_();return this.populateOverlays(t,o,e).next(function(){return r.computeViews(t,e,o,Si())})}},{key:"populateOverlays",value:function(t,e,r){var o=[];return r.forEach(function(a){e.has(a)||o.push(a)}),this.documentOverlayCache.getOverlays(t,o).next(function(a){a.forEach(function(u,d){e.set(u,d)})})}},{key:"computeViews",value:function(t,e,r,o){var a=qg(),u=MC(),d=MC();return e.forEach(function(f,g){var E=r.get(g.key);o.has(g.key)&&(E===void 0||E.mutation instanceof CD)?a=a.insert(g.key,g):E!==void 0?(u.set(g.key,E.mutation.getFieldMask()),UC(E.mutation,g,E.mutation.getFieldMask(),Cf.now())):u.set(g.key,hC.empty())}),this.recalculateAndSaveOverlays(t,a).next(function(f){return f.forEach(function(g,E){return u.set(g,E)}),e.forEach(function(g,E){var T;return d.set(g,new l7e(E,(T=u.get(g))!==null&&T!==void 0?T:null))}),d})}},{key:"recalculateAndSaveOverlays",value:function(t,e){var r=this,o=MC(),a=new Sa(function(d,f){return d-f}),u=Si();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(d){var f,g=pn(d);try{var E=function(){var T=f.value;T.keys().forEach(function(C){var I=e.get(C);if(I!==null){var D=o.get(C)||hC.empty();D=T.applyToLocalView(I,D),o.set(C,D);var L=(a.get(T.batchId)||Si()).add(C);a=a.insert(T.batchId,L)}})};for(g.s();!(f=g.n()).done;)E()}catch(T){g.e(T)}finally{g.f()}}).next(function(){for(var d=[],f=a.getReverseIterator(),g=function(){var E=f.getNext(),T=E.key,C=E.value,I=ule();C.forEach(function(D){if(!u.has(D)){var L=fle(e.get(D),o.get(D));L!==null&&I.set(D,L),u=u.add(D)}}),d.push(r.documentOverlayCache.saveOverlays(t,T,I))};f.hasNext();)g();return Ht.waitFor(d)}).next(function(){return o})}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(t,e){var r=this;return this.remoteDocumentCache.getEntries(t,e).next(function(o){return r.recalculateAndSaveOverlays(t,o)})}},{key:"getDocumentsMatchingQuery",value:function(t,e,r,o){return function(a){return ar.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(a){return a.collectionGroup!==null}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,o):this.getDocumentsMatchingCollectionQuery(t,e,r,o)}},{key:"getNextDocuments",value:function(t,e,r,o){var a=this;return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,o).next(function(u){var d=o-u.size>0?a.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,o-u.size):Ht.resolve(H_()),f=-1,g=u;return d.next(function(E){return Ht.forEach(E,function(T,C){return f<C.largestBatchId&&(f=C.largestBatchId),u.get(T)?Ht.resolve():a.remoteDocumentCache.getEntry(t,T).next(function(I){g=g.insert(T,I)})}).next(function(){return a.populateOverlays(t,E,u)}).next(function(){return a.computeViews(t,g,E,Si())}).next(function(T){return{batchId:f,changes:M3e(T)}})})})}},{key:"getDocumentsMatchingDocumentQuery",value:function(t,e){return this.getDocument(t,new ar(e)).next(function(r){var o=fC();return r.isFoundDocument()&&(o=o.insert(r.key,r)),o})}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(t,e,r,o){var a=this,u=e.collectionGroup,d=fC();return this.indexManager.getCollectionParents(t,u).next(function(f){return Ht.forEach(f,function(g){var E=function(T,C){return new SD(C,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt)}(e,g.child(u));return a.getDocumentsMatchingCollectionQuery(t,E,r,o).next(function(T){T.forEach(function(C,I){d=d.insert(C,I)})})}).next(function(){return d})})}},{key:"getDocumentsMatchingCollectionQuery",value:function(t,e,r,o){var a,u=this;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(function(d){return a=d,u.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,a,o)}).next(function(d){a.forEach(function(g,E){var T=E.getKey();d.get(T)===null&&(d=d.insert(T,nm.newInvalidDocument(T)))});var f=fC();return d.forEach(function(g,E){var T=a.get(g);T!==void 0&&UC(T.mutation,E,hC.empty(),Cf.now()),bD(e,E)&&(f=f.insert(g,E))}),f})}}])}(),h7e=function(){return Me(function t(e){xe(this,t),this.serializer=e,this.hr=new Map,this.Pr=new Map},[{key:"getBundleMetadata",value:function(t,e){return Ht.resolve(this.hr.get(e))}},{key:"saveBundleMetadata",value:function(t,e){return this.hr.set(e.id,function(r){return{id:r.id,version:r.version,createTime:iT(r.createTime)}}(e)),Ht.resolve()}},{key:"getNamedQuery",value:function(t,e){return Ht.resolve(this.Pr.get(e))}},{key:"saveNamedQuery",value:function(t,e){return this.Pr.set(e.name,function(r){return{name:r.name,query:o7e(r.bundledQuery),readTime:iT(r.readTime)}}(e)),Ht.resolve()}}])}(),f7e=function(){return Me(function t(){xe(this,t),this.overlays=new Sa(ar.comparator),this.Ir=new Map},[{key:"getOverlay",value:function(t,e){return Ht.resolve(this.overlays.get(e))}},{key:"getOverlays",value:function(t,e){var r=this,o=H_();return Ht.forEach(e,function(a){return r.getOverlay(t,a).next(function(u){u!==null&&o.set(a,u)})}).next(function(){return o})}},{key:"saveOverlays",value:function(t,e,r){var o=this;return r.forEach(function(a,u){o.ht(t,e,u)}),Ht.resolve()}},{key:"removeOverlaysForBatchId",value:function(t,e,r){var o=this,a=this.Ir.get(r);return a!==void 0&&(a.forEach(function(u){return o.overlays=o.overlays.remove(u)}),this.Ir.delete(r)),Ht.resolve()}},{key:"getOverlaysForCollection",value:function(t,e,r){for(var o=H_(),a=e.length+1,u=new ar(e.child("")),d=this.overlays.getIteratorFrom(u);d.hasNext();){var f=d.getNext().value,g=f.getKey();if(!e.isPrefixOf(g.path))break;g.path.length===a&&f.largestBatchId>r&&o.set(f.getKey(),f)}return Ht.resolve(o)}},{key:"getOverlaysForCollectionGroup",value:function(t,e,r,o){for(var a=new Sa(function(T,C){return T-C}),u=this.overlays.getIterator();u.hasNext();){var d=u.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>r){var f=a.get(d.largestBatchId);f===null&&(f=H_(),a=a.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}for(var g=H_(),E=a.getIterator();E.hasNext()&&(E.getNext().value.forEach(function(T,C){return g.set(T,C)}),!(g.size()>=o)););return Ht.resolve(g)}},{key:"ht",value:function(t,e,r){var o=this.overlays.get(r.key);if(o!==null){var a=this.Ir.get(o.largestBatchId).delete(r.key);this.Ir.set(o.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new G3e(e,r));var u=this.Ir.get(e);u===void 0&&(u=Si(),this.Ir.set(e,u)),this.Ir.set(e,u.add(r.key))}}])}(),p7e=function(){return Me(function t(){xe(this,t),this.sessionToken=al.EMPTY_BYTE_STRING},[{key:"getSessionToken",value:function(t){return Ht.resolve(this.sessionToken)}},{key:"setSessionToken",value:function(t,e){return this.sessionToken=e,Ht.resolve()}}])}(),e6=function(){return Me(function t(){xe(this,t),this.Tr=new sl(Fa.Er),this.dr=new sl(Fa.Ar)},[{key:"isEmpty",value:function(){return this.Tr.isEmpty()}},{key:"addReference",value:function(t,e){var r=new Fa(t,e);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}},{key:"Rr",value:function(t,e){var r=this;t.forEach(function(o){return r.addReference(o,e)})}},{key:"removeReference",value:function(t,e){this.Vr(new Fa(t,e))}},{key:"mr",value:function(t,e){var r=this;t.forEach(function(o){return r.removeReference(o,e)})}},{key:"gr",value:function(t){var e=this,r=new ar(new Jo([])),o=new Fa(r,t),a=new Fa(r,t+1),u=[];return this.dr.forEachInRange([o,a],function(d){e.Vr(d),u.push(d.key)}),u}},{key:"pr",value:function(){var t=this;this.Tr.forEach(function(e){return t.Vr(e)})}},{key:"Vr",value:function(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}},{key:"yr",value:function(t){var e=new ar(new Jo([])),r=new Fa(e,t),o=new Fa(e,t+1),a=Si();return this.dr.forEachInRange([r,o],function(u){a=a.add(u.key)}),a}},{key:"containsKey",value:function(t){var e=new Fa(t,0),r=this.Tr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}}])}(),Fa=function(){return Me(function t(e,r){xe(this,t),this.key=e,this.wr=r},null,[{key:"Er",value:function(t,e){return ar.comparator(t.key,e.key)||Ni(t.wr,e.wr)}},{key:"Ar",value:function(t,e){return Ni(t.wr,e.wr)||ar.comparator(t.key,e.key)}}])}(),m7e=function(){return Me(function t(e,r){xe(this,t),this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new sl(Fa.Er)},[{key:"checkEmpty",value:function(t){return Ht.resolve(this.mutationQueue.length===0)}},{key:"addMutationBatch",value:function(t,e,r,o){var a=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var u=new z3e(a,e,r,o);this.mutationQueue.push(u);var d,f=pn(o);try{for(f.s();!(d=f.n()).done;){var g=d.value;this.br=this.br.add(new Fa(g.key,a)),this.indexManager.addToCollectionParentIndex(t,g.key.path.popLast())}}catch(E){f.e(E)}finally{f.f()}return Ht.resolve(u)}},{key:"lookupMutationBatch",value:function(t,e){return Ht.resolve(this.Dr(e))}},{key:"getNextMutationBatchAfterBatchId",value:function(t,e){var r=e+1,o=this.vr(r),a=o<0?0:o;return Ht.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return Ht.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}},{key:"getAllMutationBatches",value:function(t){return Ht.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(t,e){var r=this,o=new Fa(e,0),a=new Fa(e,Number.POSITIVE_INFINITY),u=[];return this.br.forEachInRange([o,a],function(d){var f=r.Dr(d.wr);u.push(f)}),Ht.resolve(u)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(t,e){var r=this,o=new sl(Ni);return e.forEach(function(a){var u=new Fa(a,0),d=new Fa(a,Number.POSITIVE_INFINITY);r.br.forEachInRange([u,d],function(f){o=o.add(f.wr)})}),Ht.resolve(this.Cr(o))}},{key:"getAllMutationBatchesAffectingQuery",value:function(t,e){var r=e.path,o=r.length+1,a=r;ar.isDocumentKey(a)||(a=a.child(""));var u=new Fa(new ar(a),0),d=new sl(Ni);return this.br.forEachWhile(function(f){var g=f.key.path;return!!r.isPrefixOf(g)&&(g.length===o&&(d=d.add(f.wr)),!0)},u),Ht.resolve(this.Cr(d))}},{key:"Cr",value:function(t){var e=this,r=[];return t.forEach(function(o){var a=e.Dr(o);a!==null&&r.push(a)}),r}},{key:"removeMutationBatch",value:function(t,e){var r=this;_o(this.Fr(e.batchId,"removed")===0),this.mutationQueue.shift();var o=this.br;return Ht.forEach(e.mutations,function(a){var u=new Fa(a.key,e.batchId);return o=o.delete(u),r.referenceDelegate.markPotentiallyOrphaned(t,a.key)}).next(function(){r.br=o})}},{key:"On",value:function(t){}},{key:"containsKey",value:function(t,e){var r=new Fa(e,0),o=this.br.firstAfterOrEqual(r);return Ht.resolve(e.isEqual(o&&o.key))}},{key:"performConsistencyCheck",value:function(t){return this.mutationQueue.length,Ht.resolve()}},{key:"Fr",value:function(t,e){return this.vr(t)}},{key:"vr",value:function(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}},{key:"Dr",value:function(t){var e=this.vr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}])}(),g7e=function(){return Me(function t(e){xe(this,t),this.Mr=e,this.docs=new Sa(ar.comparator),this.size=0},[{key:"setIndexManager",value:function(t){this.indexManager=t}},{key:"addEntry",value:function(t,e){var r=e.key,o=this.docs.get(r),a=o?o.size:0,u=this.Mr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:u}),this.size+=u-a,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}},{key:"removeEntry",value:function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}},{key:"getEntry",value:function(t,e){var r=this.docs.get(e);return Ht.resolve(r?r.document.mutableCopy():nm.newInvalidDocument(e))}},{key:"getEntries",value:function(t,e){var r=this,o=qg();return e.forEach(function(a){var u=r.docs.get(a);o=o.insert(a,u?u.document.mutableCopy():nm.newInvalidDocument(a))}),Ht.resolve(o)}},{key:"getDocumentsMatchingQuery",value:function(t,e,r,o){for(var a=qg(),u=e.path,d=new ar(u.child("")),f=this.docs.getIteratorFrom(d);f.hasNext();){var g=f.getNext(),E=g.key,T=g.value.document;if(!u.isPrefixOf(E.path))break;E.path.length>u.length+1||y3e(_3e(T),r)<=0||(o.has(T.key)||bD(e,T))&&(a=a.insert(T.key,T.mutableCopy()))}return Ht.resolve(a)}},{key:"getAllFromCollectionGroup",value:function(t,e,r,o){Ar()}},{key:"Or",value:function(t,e){return Ht.forEach(this.docs,function(r){return e(r)})}},{key:"newChangeBuffer",value:function(t){return new v7e(this)}},{key:"getSize",value:function(t){return Ht.resolve(this.size)}}])}(),v7e=function(){function t(e){var r;return xe(this,t),(r=Jn(this,t)).cr=e,r}return Qn(t,u7e),Me(t,[{key:"applyChanges",value:function(e){var r=this,o=[];return this.changes.forEach(function(a,u){u.isValidDocument()?o.push(r.cr.addEntry(e,u)):r.cr.removeEntry(a)}),Ht.waitFor(o)}},{key:"getFromCache",value:function(e,r){return this.cr.getEntry(e,r)}},{key:"getAllFromCache",value:function(e,r){return this.cr.getEntries(e,r)}}])}(),_7e=function(){return Me(function t(e){xe(this,t),this.persistence=e,this.Nr=new s0(function(r){return q5(r)},$5),this.lastRemoteSnapshotVersion=jr.min(),this.highestTargetId=0,this.Lr=0,this.Br=new e6,this.targetCount=0,this.kr=Fj.Bn()},[{key:"forEachTarget",value:function(t,e){return this.Nr.forEach(function(r,o){return e(o)}),Ht.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(t){return Ht.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(t){return Ht.resolve(this.Lr)}},{key:"allocateTargetId",value:function(t){return this.highestTargetId=this.kr.next(),Ht.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.Lr&&(this.Lr=e),Ht.resolve()}},{key:"Kn",value:function(t){this.Nr.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.kr=new Fj(e),this.highestTargetId=e),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}},{key:"addTargetData",value:function(t,e){return this.Kn(e),this.targetCount+=1,Ht.resolve()}},{key:"updateTargetData",value:function(t,e){return this.Kn(e),Ht.resolve()}},{key:"removeTargetData",value:function(t,e){return this.Nr.delete(e.target),this.Br.gr(e.targetId),this.targetCount-=1,Ht.resolve()}},{key:"removeTargets",value:function(t,e,r){var o=this,a=0,u=[];return this.Nr.forEach(function(d,f){f.sequenceNumber<=e&&r.get(f.targetId)===null&&(o.Nr.delete(d),u.push(o.removeMatchingKeysForTargetId(t,f.targetId)),a++)}),Ht.waitFor(u).next(function(){return a})}},{key:"getTargetCount",value:function(t){return Ht.resolve(this.targetCount)}},{key:"getTargetData",value:function(t,e){var r=this.Nr.get(e)||null;return Ht.resolve(r)}},{key:"addMatchingKeys",value:function(t,e,r){return this.Br.Rr(e,r),Ht.resolve()}},{key:"removeMatchingKeys",value:function(t,e,r){this.Br.mr(e,r);var o=this.persistence.referenceDelegate,a=[];return o&&e.forEach(function(u){a.push(o.markPotentiallyOrphaned(t,u))}),Ht.waitFor(a)}},{key:"removeMatchingKeysForTargetId",value:function(t,e){return this.Br.gr(e),Ht.resolve()}},{key:"getMatchingKeysForTargetId",value:function(t,e){var r=this.Br.yr(e);return Ht.resolve(r)}},{key:"containsKey",value:function(t,e){return Ht.resolve(this.Br.containsKey(e))}}])}(),y7e=function(){return Me(function t(e,r){var o=this;xe(this,t),this.qr={},this.overlays={},this.Qr=new z5(0),this.Kr=!1,this.Kr=!0,this.$r=new p7e,this.referenceDelegate=e(this),this.Ur=new _7e(this),this.indexManager=new a7e,this.remoteDocumentCache=function(a){return new g7e(a)}(function(a){return o.referenceDelegate.Wr(a)}),this.serializer=new s7e(r),this.Gr=new h7e(this.serializer)},[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.Kr=!1,Promise.resolve()}},{key:"started",get:function(){return this.Kr}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(t){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(t){var e=this.overlays[t.toKey()];return e||(e=new f7e,this.overlays[t.toKey()]=e),e}},{key:"getMutationQueue",value:function(t,e){var r=this.qr[t.toKey()];return r||(r=new m7e(e,this.referenceDelegate),this.qr[t.toKey()]=r),r}},{key:"getGlobalsCache",value:function(){return this.$r}},{key:"getTargetCache",value:function(){return this.Ur}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.Gr}},{key:"runTransaction",value:function(t,e,r){var o=this;Sn("MemoryPersistence","Starting transaction:",t);var a=new E7e(this.Qr.next());return this.referenceDelegate.zr(),r(a).next(function(u){return o.referenceDelegate.jr(a).next(function(){return u})}).toPromise().then(function(u){return a.raiseOnCommittedEvent(),u})}},{key:"Hr",value:function(t,e){return Ht.or(Object.values(this.qr).map(function(r){return function(){return r.containsKey(t,e)}}))}}])}(),E7e=function(){function t(e){var r;return xe(this,t),(r=Jn(this,t)).currentSequenceNumber=e,r}return Qn(t,E3e),Me(t)}(),S7e=function(){function t(e){xe(this,t),this.persistence=e,this.Jr=new e6,this.Yr=null}return Me(t,[{key:"Xr",get:function(){if(this.Yr)return this.Yr;throw Ar()}},{key:"addReference",value:function(e,r,o){return this.Jr.addReference(o,r),this.Xr.delete(o.toString()),Ht.resolve()}},{key:"removeReference",value:function(e,r,o){return this.Jr.removeReference(o,r),this.Xr.add(o.toString()),Ht.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,r){return this.Xr.add(r.toString()),Ht.resolve()}},{key:"removeTarget",value:function(e,r){var o=this;this.Jr.gr(r.targetId).forEach(function(u){return o.Xr.add(u.toString())});var a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,r.targetId).next(function(u){u.forEach(function(d){return o.Xr.add(d.toString())})}).next(function(){return a.removeTargetData(e,r)})}},{key:"zr",value:function(){this.Yr=new Set}},{key:"jr",value:function(e){var r=this,o=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ht.forEach(this.Xr,function(a){var u=ar.fromPath(a);return r.ei(e,u).next(function(d){d||o.removeEntry(u,jr.min())})}).next(function(){return r.Yr=null,o.apply(e)})}},{key:"updateLimboDocument",value:function(e,r){var o=this;return this.ei(e,r).next(function(a){a?o.Xr.delete(r.toString()):o.Xr.add(r.toString())})}},{key:"Wr",value:function(e){return 0}},{key:"ei",value:function(e,r){var o=this;return Ht.or([function(){return Ht.resolve(o.Jr.containsKey(r))},function(){return o.persistence.getTargetCache().containsKey(e,r)},function(){return o.persistence.Hr(e,r)}])}}],[{key:"Zr",value:function(e){return new t(e)}}])}(),T7e=function(){function t(e,r,o,a){xe(this,t),this.targetId=e,this.fromCache=r,this.$i=o,this.Ui=a}return Me(t,null,[{key:"Wi",value:function(e,r){var o,a=Si(),u=Si(),d=pn(r.docChanges);try{for(d.s();!(o=d.n()).done;){var f=o.value;switch(f.type){case 0:a=a.add(f.doc.key);break;case 1:u=u.add(f.doc.key)}}}catch(g){d.e(g)}finally{d.f()}return new t(e,r.fromCache,a,u)}}])}(),b7e=function(){return Me(function t(){xe(this,t),this._documentReadCount=0},[{key:"documentReadCount",get:function(){return this._documentReadCount}},{key:"incrementDocumentReadCount",value:function(t){this._documentReadCount+=t}}])}(),w7e=function(){return Me(function t(){var e,r,o;xe(this,t),this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=Fqe()?8:(e=$c(),r=e.match(/Android ([\d.]+)/i),o=r?r[1].split(".").slice(0,2).join("."):"-1",Number(o)>0?6:4)},[{key:"initialize",value:function(t,e){this.Ji=t,this.indexManager=e,this.Gi=!0}},{key:"getDocumentsMatchingQuery",value:function(t,e,r,o){var a=this,u={result:null};return this.Yi(t,e).next(function(d){u.result=d}).next(function(){if(!u.result)return a.Zi(t,e,o,r).next(function(d){u.result=d})}).next(function(){if(!u.result){var d=new b7e;return a.Xi(t,e,d).next(function(f){if(u.result=f,a.zi)return a.es(t,e,d,f.size)})}}).next(function(){return u.result})}},{key:"es",value:function(t,e,r,o){return r.documentReadCount<this.ji?(Kw()<=ai.DEBUG&&Sn("QueryEngine","SDK will not create cache indexes for query:",WS(e),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Ht.resolve()):(Kw()<=ai.DEBUG&&Sn("QueryEngine","Query:",WS(e),"scans",r.documentReadCount,"local documents and returns",o,"documents as results."),r.documentReadCount>this.Hi*o?(Kw()<=ai.DEBUG&&Sn("QueryEngine","The SDK decides to create cache indexes for query:",WS(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Rf(e))):Ht.resolve())}},{key:"Yi",value:function(t,e){var r=this;if(qee(e))return Ht.resolve(null);var o=Rf(e);return this.indexManager.getIndexType(t,o).next(function(a){return a===0?null:(e.limit!==null&&a===1&&(e=Lj(e,null,"F"),o=Rf(e)),r.indexManager.getDocumentsMatchingTarget(t,o).next(function(u){var d=Si.apply(void 0,Ps(u));return r.Ji.getDocuments(t,d).next(function(f){return r.indexManager.getMinOffset(t,o).next(function(g){var E=r.ts(e,f);return r.ns(e,E,d,g.readTime)?r.Yi(t,Lj(e,null,"F")):r.rs(t,E,e,g)})})}))})}},{key:"Zi",value:function(t,e,r,o){var a=this;return qee(e)||o.isEqual(jr.min())?Ht.resolve(null):this.Ji.getDocuments(t,r).next(function(u){var d=a.ts(e,u);return a.ns(e,d,r,o)?Ht.resolve(null):(Kw()<=ai.DEBUG&&Sn("QueryEngine","Re-using previous result from %s to execute query: %s",o.toString(),WS(e)),a.rs(t,d,e,function(f,g){var E=f.toTimestamp().seconds,T=f.toTimestamp().nanoseconds+1,C=jr.fromTimestamp(T===1e9?new Cf(E+1,0):new Cf(E,T));return new _R(C,ar.empty(),g)}(o,-1)).next(function(f){return f}))})}},{key:"ts",value:function(t,e){var r=new sl(ale(t));return e.forEach(function(o,a){bD(t,a)&&(r=r.add(a))}),r}},{key:"ns",value:function(t,e,r,o){if(t.limit===null)return!1;if(r.size!==e.size)return!0;var a=t.limitType==="F"?e.last():e.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(o)>0)}},{key:"Xi",value:function(t,e,r){return Kw()<=ai.DEBUG&&Sn("QueryEngine","Using full collection scan to execute query:",WS(e)),this.Ji.getDocumentsMatchingQuery(t,e,_R.min(),r)}},{key:"rs",value:function(t,e,r,o){return this.Ji.getDocumentsMatchingQuery(t,r,o).next(function(a){return e.forEach(function(u){a=a.insert(u.key,u)}),a})}}])}(),C7e=function(){return Me(function t(e,r,o,a){xe(this,t),this.persistence=e,this.ss=r,this.serializer=a,this.os=new Sa(Ni),this._s=new s0(function(u){return q5(u)},$5),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(o)},[{key:"ls",value:function(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new d7e(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(r){return t.collect(r,e.os)})}}])}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cle(t,e){return Rle.apply(this,arguments)}function Rle(){return(Rle=Ue(ue().mark(function t(e,r){var o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o=pi(e),a.next=3,o.persistence.runTransaction("Handle user change","readonly",function(u){var d;return o.mutationQueue.getAllMutationBatches(u).next(function(f){return d=f,o.ls(r),o.mutationQueue.getAllMutationBatches(u)}).next(function(f){var g,E=[],T=[],C=Si(),I=pn(d);try{for(I.s();!(g=I.n()).done;){var D=g.value;E.push(D.batchId);var L,B=pn(D.mutations);try{for(B.s();!(L=B.n()).done;){var G=L.value;C=C.add(G.key)}}catch(j){B.e(j)}finally{B.f()}}}catch(j){I.e(j)}finally{I.f()}var se,ae=pn(f);try{for(ae.s();!(se=ae.n()).done;){var M=se.value;T.push(M.batchId);var F,z=pn(M.mutations);try{for(z.s();!(F=z.n()).done;){var te=F.value;C=C.add(te.key)}}catch(j){z.e(j)}finally{z.f()}}}catch(j){ae.e(j)}finally{ae.f()}return o.localDocuments.getDocuments(u,C).next(function(j){return{hs:j,removedBatchIds:E,addedBatchIds:T}})})});case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}},t)}))).apply(this,arguments)}function Ile(t){var e=pi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(r){return e.Ur.getLastRemoteSnapshotVersion(r)})}function R7e(t,e){var r=pi(t),o=e.snapshotVersion,a=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",function(u){var d=r.cs.newChangeBuffer({trackRemovals:!0});a=r.os;var f=[];e.targetChanges.forEach(function(C,I){var D=a.get(I);if(D){f.push(r.Ur.removeMatchingKeys(u,C.removedDocuments,I).next(function(){return r.Ur.addMatchingKeys(u,C.addedDocuments,I)}));var L=D.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(I)!==null?L=L.withResumeToken(al.EMPTY_BYTE_STRING,jr.min()).withLastLimboFreeSnapshotVersion(jr.min()):C.resumeToken.approximateByteSize()>0&&(L=L.withResumeToken(C.resumeToken,o)),a=a.insert(I,L),function(B,G,se){return B.resumeToken.approximateByteSize()===0||G.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=3e8||se.addedDocuments.size+se.modifiedDocuments.size+se.removedDocuments.size>0}(D,L,C)&&f.push(r.Ur.updateTargetData(u,L))}});var g=qg(),E=Si();if(e.documentUpdates.forEach(function(C){e.resolvedLimboDocuments.has(C)&&f.push(r.persistence.referenceDelegate.updateLimboDocument(u,C))}),f.push(function(C,I,D){var L=Si(),B=Si();return D.forEach(function(G){return L=L.add(G)}),I.getEntries(C,L).next(function(G){var se=qg();return D.forEach(function(ae,M){var F=G.get(ae);M.isFoundDocument()!==F.isFoundDocument()&&(B=B.add(ae)),M.isNoDocument()&&M.version.isEqual(jr.min())?(I.removeEntry(ae,M.readTime),se=se.insert(ae,M)):!F.isValidDocument()||M.version.compareTo(F.version)>0||M.version.compareTo(F.version)===0&&F.hasPendingWrites?(I.addEntry(M),se=se.insert(ae,M)):Sn("LocalStore","Ignoring outdated watch update for ",ae,". Current version:",F.version," Watch version:",M.version)}),{Ps:se,Is:B}})}(u,d,e.documentUpdates).next(function(C){g=C.Ps,E=C.Is})),!o.isEqual(jr.min())){var T=r.Ur.getLastRemoteSnapshotVersion(u).next(function(C){return r.Ur.setTargetsMetadata(u,u.currentSequenceNumber,o)});f.push(T)}return Ht.waitFor(f).next(function(){return d.apply(u)}).next(function(){return r.localDocuments.getLocalViewOfDocuments(u,g,E)}).next(function(){return g})}).then(function(u){return r.os=a,u})}function I7e(t,e){var r=pi(t);return r.persistence.runTransaction("Allocate target","readwrite",function(o){var a;return r.Ur.getTargetData(o,e).next(function(u){return u?(a=u,Ht.resolve(a)):r.Ur.allocateTargetId(o).next(function(d){return a=new Z5(e,d,"TargetPurposeListen",o.currentSequenceNumber),r.Ur.addTargetData(o,a).next(function(){return a})})})}).then(function(o){var a=r.os.get(o.targetId);return(a===null||o.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(r.os=r.os.insert(o.targetId,o),r._s.set(e,o.targetId)),o})}function jj(t,e,r){return Ale.apply(this,arguments)}function Ale(){return(Ale=Ue(ue().mark(function t(e,r,o){var a,u,d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(a=pi(e),u=a.os.get(r),d=o?"readwrite":"readwrite-primary",f.prev=1,f.t0=o,f.t0){f.next=6;break}return f.next=6,a.persistence.runTransaction("Release target",d,function(g){return a.persistence.referenceDelegate.removeTarget(g,u)});case 6:f.next=13;break;case 8:if(f.prev=8,f.t1=f.catch(1),iI(f.t1)){f.next=12;break}throw f.t1;case 12:Sn("LocalStore","Failed to update sequence numbers for target ".concat(r,": ").concat(f.t1));case 13:a.os=a.os.remove(r),a._s.delete(u.target);case 14:case"end":return f.stop()}},t,null,[[1,8]])}))).apply(this,arguments)}function ste(t,e,r){var o=pi(t),a=jr.min(),u=Si();return o.persistence.runTransaction("Execute query","readwrite",function(d){return function(f,g,E){var T=pi(f),C=T._s.get(E);return C!==void 0?Ht.resolve(T.os.get(C)):T.Ur.getTargetData(g,E)}(o,d,Rf(e)).next(function(f){if(f)return a=f.lastLimboFreeSnapshotVersion,o.Ur.getMatchingKeysForTargetId(d,f.targetId).next(function(g){u=g})}).next(function(){return o.ss.getDocumentsMatchingQuery(d,e,r?a:jr.min(),r?u:Si())}).next(function(f){return function(g,E,T){var C=g.us.get(E)||jr.min();T.forEach(function(I,D){D.readTime.compareTo(C)>0&&(C=D.readTime)}),g.us.set(E,C)}(o,function(g){return g.collectionGroup||(g.path.length%2==1?g.path.lastSegment():g.path.get(g.path.length-2))}(e),f),{documents:f,Ts:u}})})}var ote=function(){return Me(function t(){xe(this,t),this.activeTargetIds=V3e},[{key:"fs",value:function(t){this.activeTargetIds=this.activeTargetIds.add(t)}},{key:"gs",value:function(t){this.activeTargetIds=this.activeTargetIds.delete(t)}},{key:"Vs",value:function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}])}(),A7e=function(){return Me(function t(){xe(this,t),this.so=new ote,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null},[{key:"addPendingMutation",value:function(t){}},{key:"updateMutationState",value:function(t,e,r){}},{key:"addLocalQueryTarget",value:function(t){return(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&this.so.fs(t),this.oo[t]||"not-current"}},{key:"updateQueryState",value:function(t,e,r){this.oo[t]=e}},{key:"removeLocalQueryTarget",value:function(t){this.so.gs(t)}},{key:"isLocalQueryTarget",value:function(t){return this.so.activeTargetIds.has(t)}},{key:"clearQueryState",value:function(t){delete this.oo[t]}},{key:"getAllActiveQueryTargets",value:function(){return this.so.activeTargetIds}},{key:"isActiveQueryTarget",value:function(t){return this.so.activeTargetIds.has(t)}},{key:"start",value:function(){return this.so=new ote,Promise.resolve()}},{key:"handleUserChange",value:function(t,e,r){}},{key:"setOnlineState",value:function(t){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(t){}},{key:"notifyBundleLoaded",value:function(t){}}])}(),k7e=function(){return Me(function t(){xe(this,t)},[{key:"_o",value:function(t){}},{key:"shutdown",value:function(){}}])}(),ate=function(){return Me(function t(){var e=this;xe(this,t),this.ao=function(){return e.uo()},this.co=function(){return e.lo()},this.ho=[],this.Po()},[{key:"_o",value:function(t){this.ho.push(t)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}},{key:"Po",value:function(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}},{key:"uo",value:function(){Sn("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var t,e=pn(this.ho);try{for(e.s();!(t=e.n()).done;)(0,t.value)(0)}catch(r){e.e(r)}finally{e.f()}}},{key:"lo",value:function(){Sn("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var t,e=pn(this.ho);try{for(e.s();!(t=e.n()).done;)(0,t.value)(1)}catch(r){e.e(r)}finally{e.f()}}}],[{key:"D",value:function(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}])}(),LP=null;function j2(){return LP===null?LP=268435456+Math.round(2147483648*Math.random()):LP++,"0x"+LP.toString(16);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var O7e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},P7e=function(){return Me(function t(e){xe(this,t),this.Io=e.Io,this.To=e.To},[{key:"Eo",value:function(t){this.Ao=t}},{key:"Ro",value:function(t){this.Vo=t}},{key:"mo",value:function(t){this.fo=t}},{key:"onMessage",value:function(t){this.po=t}},{key:"close",value:function(){this.To()}},{key:"send",value:function(t){this.Io(t)}},{key:"yo",value:function(){this.Ao()}},{key:"wo",value:function(){this.Vo()}},{key:"So",value:function(t){this.fo(t)}},{key:"bo",value:function(t){this.po(t)}}])}(),Fc="WebChannelConnection",N7e=function(t){function e(r){var o;return xe(this,e),(o=Jn(this,e,[r])).forceLongPolling=r.forceLongPolling,o.autoDetectLongPolling=r.autoDetectLongPolling,o.useFetchStreams=r.useFetchStreams,o.longPollingOptions=r.longPollingOptions,o}return Qn(e,t),Me(e,[{key:"No",value:function(r,o,a,u){var d=j2();return new Promise(function(f,g){var E=new Bue;E.setWithCredentials(!0),E.listenOnce(Wue.COMPLETE,function(){try{switch(E.getLastErrorCode()){case vN.NO_ERROR:var C=E.getResponseJson();Sn(Fc,"XHR for RPC '".concat(r,"' ").concat(d," received:"),JSON.stringify(C)),f(C);break;case vN.TIMEOUT:Sn(Fc,"RPC '".concat(r,"' ").concat(d," timed out")),g(new tr(tn.DEADLINE_EXCEEDED,"Request time out"));break;case vN.HTTP_ERROR:var I=E.getStatus();if(Sn(Fc,"RPC '".concat(r,"' ").concat(d," failed with status:"),I,"response text:",E.getResponseText()),I>0){var D=E.getResponseJson();Array.isArray(D)&&(D=D[0]);var L=D==null?void 0:D.error;if(L&&L.status&&L.message){var B=function(G){var se=G.toLowerCase().replace(/_/g,"-");return Object.values(tn).indexOf(se)>=0?se:tn.UNKNOWN}(L.status);g(new tr(B,L.message))}else g(new tr(tn.UNKNOWN,"Server responded with status "+E.getStatus()))}else g(new tr(tn.UNAVAILABLE,"Connection failed."));break;default:Ar()}}finally{Sn(Fc,"RPC '".concat(r,"' ").concat(d," completed."))}});var T=JSON.stringify(u);Sn(Fc,"RPC '".concat(r,"' ").concat(d," sending request:"),u),E.send(o,"POST",T,a,15)})}},{key:"Bo",value:function(r,o,a){var u=j2(),d=[this.Do,"/","google.firestore.v1.Firestore","/",r,"/channel"],f=Hue(),g=Gue(),E={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},T=this.longPollingOptions.timeoutSeconds;T!==void 0&&(E.longPollingTimeout=Math.round(1e3*T)),this.useFetchStreams&&(E.useFetchStreams=!0),this.Oo(E.initMessageHeaders,o,a),E.encodeInitMessageHeaders=!0;var C=d.join("");Sn(Fc,"Creating RPC '".concat(r,"' stream ").concat(u,": ").concat(C),E);var I=f.createWebChannel(C,E),D=!1,L=!1,B=new P7e({Io:function(se){L?Sn(Fc,"Not sending because RPC '".concat(r,"' stream ").concat(u," is closed:"),se):(D||(Sn(Fc,"Opening RPC '".concat(r,"' stream ").concat(u," transport.")),I.open(),D=!0),Sn(Fc,"RPC '".concat(r,"' stream ").concat(u," sending:"),se),I.send(se))},To:function(){return I.close()}}),G=function(se,ae,M){se.listen(ae,function(F){try{M(F)}catch(z){setTimeout(function(){throw z},0)}})};return G(I,dC.EventType.OPEN,function(){L||(Sn(Fc,"RPC '".concat(r,"' stream ").concat(u," transport opened.")),B.yo())}),G(I,dC.EventType.CLOSE,function(){L||(L=!0,Sn(Fc,"RPC '".concat(r,"' stream ").concat(u," transport closed")),B.So())}),G(I,dC.EventType.ERROR,function(se){L||(L=!0,BT(Fc,"RPC '".concat(r,"' stream ").concat(u," transport errored:"),se),B.So(new tr(tn.UNAVAILABLE,"The operation could not be completed")))}),G(I,dC.EventType.MESSAGE,function(se){var ae;if(!L){var M=se.data[0];_o(!!M);var F=M,z=F.error||((ae=F[0])===null||ae===void 0?void 0:ae.error);if(z){Sn(Fc,"RPC '".concat(r,"' stream ").concat(u," received error:"),z);var te=z.status,j=function(Q){var ce=$o[Q];if(ce!==void 0)return mle(ce)}(te),K=z.message;j===void 0&&(j=tn.INTERNAL,K="Unknown error status: "+te+" with message "+z.message),L=!0,B.So(new tr(j,K)),I.close()}else Sn(Fc,"RPC '".concat(r,"' stream ").concat(u," received:"),M),B.bo(M)}}),G(g,zue.STAT_EVENT,function(se){se.stat===Oj.PROXY?Sn(Fc,"RPC '".concat(r,"' stream ").concat(u," detected buffering proxy")):se.stat===Oj.NOPROXY&&Sn(Fc,"RPC '".concat(r,"' stream ").concat(u," detected no buffering proxy"))}),setTimeout(function(){B.wo()},0),B}}])}(function(){return Me(function t(e){xe(this,t),this.databaseInfo=e,this.databaseId=e.databaseId;var r=e.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+e.host,this.vo="projects/".concat(o,"/databases/").concat(a),this.Co=this.databaseId.database==="(default)"?"project_id=".concat(o):"project_id=".concat(o,"&database_id=").concat(a)},[{key:"Fo",get:function(){return!1}},{key:"Mo",value:function(t,e,r,o,a){var u=j2(),d=this.xo(t,e.toUriEncodedString());Sn("RestConnection","Sending RPC '".concat(t,"' ").concat(u,":"),d,r);var f={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(f,o,a),this.No(t,d,f,r).then(function(g){return Sn("RestConnection","Received RPC '".concat(t,"' ").concat(u,": "),g),g},function(g){throw BT("RestConnection","RPC '".concat(t,"' ").concat(u," failed with error: "),g,"url: ",d,"request:",r),g})}},{key:"Lo",value:function(t,e,r,o,a,u){return this.Mo(t,e,r,o,a)}},{key:"Oo",value:function(t,e,r){t["X-Goog-Api-Client"]="gl-js/ fire/"+i0,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(function(o,a){return t[a]=o}),r&&r.headers.forEach(function(o,a){return t[a]=o})}},{key:"xo",value:function(t,e){var r=O7e[t];return"".concat(this.Do,"/v1/").concat(e,":").concat(r)}},{key:"terminate",value:function(){}}])}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B2(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kle(t){return new Q3e(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ole=function(){return Me(function t(e,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1.5,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:6e4;xe(this,t),this.ui=e,this.timerId=r,this.ko=o,this.qo=a,this.Qo=u,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()},[{key:"reset",value:function(){this.Ko=0}},{key:"Wo",value:function(){this.Ko=this.Qo}},{key:"Go",value:function(t){var e=this;this.cancel();var r=Math.floor(this.Ko+this.zo()),o=Math.max(0,Date.now()-this.Uo),a=Math.max(0,r-o);a>0&&Sn("ExponentialBackoff","Backing off for ".concat(a," ms (base delay: ").concat(this.Ko," ms, delay with jitter: ").concat(r," ms, last attempt: ").concat(o," ms ago)")),this.$o=this.ui.enqueueAfterDelay(this.timerId,a,function(){return e.Uo=Date.now(),t()}),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}},{key:"jo",value:function(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}},{key:"cancel",value:function(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}},{key:"zo",value:function(){return(Math.random()-.5)*this.Ko}}])}(),D7e=function(){return Me(function o(a,u,d,f,g,E,T,C){xe(this,o),this.ui=a,this.Ho=d,this.Jo=f,this.connection=g,this.authCredentialsProvider=E,this.appCheckCredentialsProvider=T,this.listener=C,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Ole(a,u)},[{key:"n_",value:function(){return this.state===1||this.state===5||this.r_()}},{key:"r_",value:function(){return this.state===2||this.state===3}},{key:"start",value:function(){this.e_=0,this.state!==4?this.auth():this.i_()}},{key:"stop",value:(r=Ue(ue().mark(function o(){return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.t0=this.n_(),!a.t0){a.next=4;break}return a.next=4,this.close(0);case 4:case"end":return a.stop()}},o,this)})),function(){return r.apply(this,arguments)})},{key:"s_",value:function(){this.state=0,this.t_.reset()}},{key:"o_",value:function(){var o=this;this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,function(){return o.__()}))}},{key:"a_",value:function(o){this.u_(),this.stream.send(o)}},{key:"__",value:(e=Ue(ue().mark(function o(){return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this.r_()){a.next=2;break}return a.abrupt("return",this.close(0));case 2:case"end":return a.stop()}},o,this)})),function(){return e.apply(this,arguments)})},{key:"u_",value:function(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}},{key:"c_",value:function(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}},{key:"close",value:(t=Ue(ue().mark(function o(a,u){return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return this.u_(),this.c_(),this.t_.cancel(),this.Yo++,a!==4?this.t_.reset():u&&u.code===tn.RESOURCE_EXHAUSTED?(em(u.toString()),em("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):u&&u.code===tn.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=a,d.next=9,this.listener.mo(u);case 9:case"end":return d.stop()}},o,this)})),function(o,a){return t.apply(this,arguments)})},{key:"l_",value:function(){}},{key:"auth",value:function(){var o=this;this.state=1;var a=this.h_(this.Yo),u=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(function(d){var f=Gr(d,2),g=f[0],E=f[1];o.Yo===u&&o.P_(g,E)},function(d){a(function(){var f=new tr(tn.UNKNOWN,"Fetching auth token failed: "+d.message);return o.I_(f)})})}},{key:"P_",value:function(o,a){var u=this,d=this.h_(this.Yo);this.stream=this.T_(o,a),this.stream.Eo(function(){d(function(){return u.listener.Eo()})}),this.stream.Ro(function(){d(function(){return u.state=2,u.Xo=u.ui.enqueueAfterDelay(u.Jo,1e4,function(){return u.r_()&&(u.state=3),Promise.resolve()}),u.listener.Ro()})}),this.stream.mo(function(f){d(function(){return u.I_(f)})}),this.stream.onMessage(function(f){d(function(){return++u.e_==1?u.E_(f):u.onNext(f)})})}},{key:"i_",value:function(){var o=this;this.state=5,this.t_.Go(Ue(ue().mark(function a(){return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:o.state=0,o.start();case 1:case"end":return u.stop()}},a)})))}},{key:"I_",value:function(o){return Sn("PersistentStream","close with error: ".concat(o)),this.stream=null,this.close(4,o)}},{key:"h_",value:function(o){var a=this;return function(u){a.ui.enqueueAndForget(function(){return a.Yo===o?u():(Sn("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}}}]);var t,e,r}(),L7e=function(){function t(e,r,o,a,u,d){var f;return xe(this,t),(f=Jn(this,t,[e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,o,a,d])).serializer=u,f}return Qn(t,D7e),Me(t,[{key:"T_",value:function(e,r){return this.connection.Bo("Listen",e,r)}},{key:"E_",value:function(e){return this.onNext(e)}},{key:"onNext",value:function(e){this.t_.reset();var r=function(a,u){var d;if("targetChange"in u){u.targetChange;var f=function(Re){return Re==="NO_CHANGE"?0:Re==="ADD"?1:Re==="REMOVE"?2:Re==="CURRENT"?3:Re==="RESET"?4:Ar()}(u.targetChange.targetChangeType||"NO_CHANGE"),g=u.targetChange.targetIds||[],E=function(Re,Ve){return Re.useProto3Json?(_o(Ve===void 0||typeof Ve=="string"),al.fromBase64String(Ve||"")):(_o(Ve===void 0||Ve instanceof Buffer||Ve instanceof Uint8Array),al.fromUint8Array(Ve||new Uint8Array))}(a,u.targetChange.resumeToken),T=u.targetChange.cause,C=T&&function(Re){var Ve=Re.code===void 0?tn.UNKNOWN:mle(Re.code);return new tr(Ve,Re.message||"")}(T);d=new _le(f,g,E,C||null)}else if("documentChange"in u){u.documentChange;var I=u.documentChange;I.document,I.document.name,I.document.updateTime;var D=F2(a,I.document.name),L=iT(I.document.updateTime),B=I.document.createTime?iT(I.document.createTime):jr.min(),G=new F_({mapValue:{fields:I.document.fields}}),se=nm.newFoundDocument(D,L,B,G),ae=I.targetIds||[],M=I.removedTargetIds||[];d=new yN(ae,M,se.key,se)}else if("documentDelete"in u){u.documentDelete;var F=u.documentDelete;F.document;var z=F2(a,F.document),te=F.readTime?iT(F.readTime):jr.min(),j=nm.newNoDocument(z,te),K=F.removedTargetIds||[];d=new yN([],K,j.key,j)}else if("documentRemove"in u){u.documentRemove;var Q=u.documentRemove;Q.document;var ce=F2(a,Q.document),Ee=Q.removedTargetIds||[];d=new yN([],Ee,ce,null)}else{if(!("filter"in u))return Ar();u.filter;var _e=u.filter;_e.targetId;var pe=_e.count,qe=pe===void 0?0:pe,St=_e.unchangedNames,ke=new H3e(qe,St),Ne=_e.targetId;d=new vle(Ne,ke)}return d}(this.serializer,e),o=function(a){if(!("targetChange"in a))return jr.min();var u=a.targetChange;return u.targetIds&&u.targetIds.length?jr.min():u.readTime?iT(u.readTime):jr.min()}(e);return this.listener.d_(r,o)}},{key:"A_",value:function(e){var r={};r.database=rte(this.serializer),r.addTarget=function(a,u){var d,f=u.target;if((d=Dj(f)?{documents:Z3e(a,f)}:{query:e7e(a,f)._t}).targetId=u.targetId,u.resumeToken.approximateByteSize()>0){d.resumeToken=function(T,C){return T.useProto3Json?C.toBase64():C.toUint8Array()}(a,u.resumeToken);var g=Uj(a,u.expectedCount);g!==null&&(d.expectedCount=g)}else if(u.snapshotVersion.compareTo(jr.min())>0){d.readTime=function(T,C){return T.useProto3Json?"".concat(new Date(1e3*C.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+C.nanoseconds).slice(-9),"Z"):{seconds:""+C.seconds,nanos:C.nanoseconds}}(a,u.snapshotVersion.toTimestamp());var E=Uj(a,u.expectedCount);E!==null&&(d.expectedCount=E)}return d}(this.serializer,e);var o=function(a,u){var d=function(f){switch(f){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ar()}}(u.purpose);return d==null?null:{"goog-listen-tags":d}}(this.serializer,e);o&&(r.labels=o),this.a_(r)}},{key:"R_",value:function(e){var r={};r.database=rte(this.serializer),r.removeTarget=e,this.a_(r)}}])}(),x7e=function(t){function e(r,o,a,u){var d;return xe(this,e),(d=Jn(this,e)).authCredentials=r,d.appCheckCredentials=o,d.connection=a,d.serializer=u,d.y_=!1,d}return Qn(e,t),Me(e,[{key:"w_",value:function(){if(this.y_)throw new tr(tn.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"Mo",value:function(r,o,a,u){var d=this;return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(f){var g=Gr(f,2),E=g[0],T=g[1];return d.connection.Mo(r,Vj(o,a),u,E,T)}).catch(function(f){throw f.name==="FirebaseError"?(f.code===tn.UNAUTHENTICATED&&(d.authCredentials.invalidateToken(),d.appCheckCredentials.invalidateToken()),f):new tr(tn.UNKNOWN,f.toString())})}},{key:"Lo",value:function(r,o,a,u,d){var f=this;return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(g){var E=Gr(g,2),T=E[0],C=E[1];return f.connection.Lo(r,Vj(o,a),u,T,C,d)}).catch(function(g){throw g.name==="FirebaseError"?(g.code===tn.UNAUTHENTICATED&&(f.authCredentials.invalidateToken(),f.appCheckCredentials.invalidateToken()),g):new tr(tn.UNKNOWN,g.toString())})}},{key:"terminate",value:function(){this.y_=!0,this.connection.terminate()}}])}(Me(function t(){xe(this,t)})),M7e=function(){return Me(function t(e,r){xe(this,t),this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0},[{key:"v_",value:function(){var t=this;this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.b_=null,t.F_("Backend didn't respond within 10 seconds."),t.C_("Offline"),Promise.resolve()}))}},{key:"M_",value:function(t){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_("Connection failed 1 times. Most recent error: ".concat(t.toString())),this.C_("Offline")))}},{key:"set",value:function(t){this.x_(),this.S_=0,t==="Online"&&(this.D_=!1),this.C_(t)}},{key:"C_",value:function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}},{key:"F_",value:function(t){var e="Could not reach Cloud Firestore backend. ".concat(t,`
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`);this.D_?(em(e),this.D_=!1):Sn("OnlineStateTracker",e)}},{key:"x_",value:function(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}])}(),U7e=Me(function t(e,r,o,a,u){var d=this;xe(this,t),this.localStore=e,this.datastore=r,this.asyncQueue=o,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=u,this.k_._o(function(f){o.enqueueAndForget(Ue(ue().mark(function g(){return ue().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(E.t0=oI(d),!E.t0){E.next=5;break}return Sn("RemoteStore","Restarting streams for network reachability change."),E.next=5,function(){var T=Ue(ue().mark(function C(I){var D;return ue().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return(D=pi(I)).L_.add(4),L.next=4,sI(D);case 4:return D.q_.set("Unknown"),D.L_.delete(4),L.next=8,RD(D);case 8:case"end":return L.stop()}},C)}));return function(C){return T.apply(this,arguments)}}()(d);case 5:case"end":return E.stop()}},g)})))}),this.q_=new M7e(o,a)});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RD(t){return Ple.apply(this,arguments)}function Ple(){return(Ple=Ue(ue().mark(function t(e){var r,o,a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!oI(e)){u.next=18;break}r=pn(e.B_),u.prev=2,r.s();case 4:if((o=r.n()).done){u.next=10;break}return a=o.value,u.next=8,a(!0);case 8:u.next=4;break;case 10:u.next=15;break;case 12:u.prev=12,u.t0=u.catch(2),r.e(u.t0);case 15:return u.prev=15,r.f(),u.finish(15);case 18:case"end":return u.stop()}},t,null,[[2,12,15,18]])}))).apply(this,arguments)}function sI(t){return Nle.apply(this,arguments)}function Nle(){return(Nle=Ue(ue().mark(function t(e){var r,o,a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:r=pn(e.B_),u.prev=1,r.s();case 3:if((o=r.n()).done){u.next=9;break}return a=o.value,u.next=7,a(!1);case 7:u.next=3;break;case 9:u.next=14;break;case 11:u.prev=11,u.t0=u.catch(1),r.e(u.t0);case 14:return u.prev=14,r.f(),u.finish(14);case 17:case"end":return u.stop()}},t,null,[[1,11,14,17]])}))).apply(this,arguments)}function Dle(t,e){var r=pi(t);r.N_.has(e.targetId)||(r.N_.set(e.targetId,e),i6(r)?r6(r):o0(r).r_()&&n6(r,e))}function t6(t,e){var r=pi(t),o=o0(r);r.N_.delete(e),o.r_()&&Lle(r,e),r.N_.size===0&&(o.r_()?o.o_():oI(r)&&r.q_.set("Unknown"))}function n6(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(jr.min())>0){var r=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}o0(t).A_(e)}function Lle(t,e){t.Q_.xe(e),o0(t).R_(e)}function r6(t){t.Q_=new $3e({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},ot:function(e){return t.N_.get(e)||null},tt:function(){return t.datastore.serializer.databaseId}}),o0(t).start(),t.q_.v_()}function i6(t){return oI(t)&&!o0(t).n_()&&t.N_.size>0}function oI(t){return pi(t).L_.size===0}function xle(t){t.Q_=void 0}function V7e(t){return Mle.apply(this,arguments)}function Mle(){return(Mle=Ue(ue().mark(function t(e){return ue().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e.q_.set("Online");case 1:case"end":return r.stop()}},t)}))).apply(this,arguments)}function F7e(t){return Ule.apply(this,arguments)}function Ule(){return(Ule=Ue(ue().mark(function t(e){return ue().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e.N_.forEach(function(o,a){n6(e,o)});case 1:case"end":return r.stop()}},t)}))).apply(this,arguments)}function j7e(t,e){return Vle.apply(this,arguments)}function Vle(){return(Vle=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:xle(e),i6(e)?(e.q_.M_(r),r6(e)):e.q_.set("Unknown");case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}function B7e(t,e,r){return Bj.apply(this,arguments)}function Bj(){return Bj=Ue(ue().mark(function t(e,r,o){var a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(e.q_.set("Online"),!(r instanceof _le&&r.state===2&&r.cause)){u.next=13;break}return u.prev=1,u.next=4,function(){var d=Ue(ue().mark(function f(g,E){var T,C,I,D;return ue().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:T=E.cause,C=pn(E.targetIds),L.prev=2,C.s();case 4:if((I=C.n()).done){L.next=14;break}if(D=I.value,L.t0=g.N_.has(D),!L.t0){L.next=12;break}return L.next=10,g.remoteSyncer.rejectListen(D,T);case 10:g.N_.delete(D),g.Q_.removeTarget(D);case 12:L.next=4;break;case 14:L.next=19;break;case 16:L.prev=16,L.t1=L.catch(2),C.e(L.t1);case 19:return L.prev=19,C.f(),L.finish(19);case 22:case"end":return L.stop()}},f,null,[[2,16,19,22]])}));return function(f,g){return d.apply(this,arguments)}}()(e,r);case 4:u.next=11;break;case 6:return u.prev=6,u.t0=u.catch(1),Sn("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),u.t0),u.next=11,cte(e,u.t0);case 11:case 22:u.next=29;break;case 13:if(r instanceof yN?e.Q_.Ke(r):r instanceof vle?e.Q_.He(r):e.Q_.We(r),o.isEqual(jr.min())){u.next=29;break}return u.prev=14,u.next=17,Ile(e.localStore);case 17:if(a=u.sent,u.t1=o.compareTo(a)>=0,!u.t1){u.next=22;break}return u.next=22,function(d,f){var g=d.Q_.rt(f);return g.targetChanges.forEach(function(E,T){if(E.resumeToken.approximateByteSize()>0){var C=d.N_.get(T);C&&d.N_.set(T,C.withResumeToken(E.resumeToken,f))}}),g.targetMismatches.forEach(function(E,T){var C=d.N_.get(E);if(C){d.N_.set(E,C.withResumeToken(al.EMPTY_BYTE_STRING,C.snapshotVersion)),Lle(d,E);var I=new Z5(C.target,E,T,C.sequenceNumber);n6(d,I)}}),d.remoteSyncer.applyRemoteEvent(g)}(e,o);case 24:return u.prev=24,u.t2=u.catch(14),Sn("RemoteStore","Failed to raise snapshot:",u.t2),u.next=29,cte(e,u.t2);case 29:case"end":return u.stop()}},t,null,[[1,6],[14,24]])})),Bj.apply(this,arguments)}function cte(t,e,r){return Fle.apply(this,arguments)}function Fle(){return(Fle=Ue(ue().mark(function t(e,r,o){return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(iI(r)){a.next=2;break}throw r;case 2:return e.L_.add(1),a.next=5,sI(e);case 5:e.q_.set("Offline"),o||(o=function(){return Ile(e.localStore)}),e.asyncQueue.enqueueRetryable(Ue(ue().mark(function u(){return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return Sn("RemoteStore","Retrying IndexedDB access"),d.next=3,o();case 3:return e.L_.delete(1),d.next=6,RD(e);case 6:case"end":return d.stop()}},u)})));case 8:case"end":return a.stop()}},t)}))).apply(this,arguments)}function ute(t,e){return jle.apply(this,arguments)}function jle(){return(jle=Ue(ue().mark(function t(e,r){var o,a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return(o=pi(e)).asyncQueue.verifyOperationInProgress(),Sn("RemoteStore","RemoteStore received new credentials"),a=oI(o),o.L_.add(3),u.next=6,sI(o);case 6:return a&&o.q_.set("Unknown"),u.next=9,o.remoteSyncer.handleCredentialChange(r);case 9:return o.L_.delete(3),u.next=12,RD(o);case 12:case"end":return u.stop()}},t)}))).apply(this,arguments)}function W7e(t,e){return Ble.apply(this,arguments)}function Ble(){return(Ble=Ue(ue().mark(function t(e,r){var o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(o=pi(e),!r){a.next=7;break}return o.L_.delete(2),a.next=5,RD(o);case 5:a.next=13;break;case 7:if(a.t0=r,a.t0){a.next=13;break}return o.L_.add(2),a.next=12,sI(o);case 12:o.q_.set("Unknown");case 13:case"end":return a.stop()}},t)}))).apply(this,arguments)}function o0(t){return t.K_||(t.K_=function(e,r,o){var a=pi(e);return a.w_(),new L7e(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,o);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}(t.datastore,t.asyncQueue,{Eo:V7e.bind(null,t),Ro:F7e.bind(null,t),mo:j7e.bind(null,t),d_:B7e.bind(null,t)}),t.B_.push(function(){var e=Ue(ue().mark(function r(o){return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!o){a.next=4;break}t.K_.s_(),i6(t)?r6(t):t.q_.set("Unknown"),a.next=7;break;case 4:return a.next=6,t.K_.stop();case 6:xle(t);case 7:case"end":return a.stop()}},r)}));return function(r){return e.apply(this,arguments)}}())),t.K_;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var z7e=function(){function t(e,r,o,a,u){xe(this,t),this.asyncQueue=e,this.timerId=r,this.targetTimeMs=o,this.op=a,this.removalCallback=u,this.deferred=new ry,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(d){})}return Me(t,[{key:"promise",get:function(){return this.deferred.promise}},{key:"start",value:function(e){var r=this;this.timerHandle=setTimeout(function(){return r.handleDelayElapsed()},e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new tr(tn.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return e.timerHandle!==null?(e.clearTimeout(),e.op().then(function(r){return e.deferred.resolve(r)})):Promise.resolve()})}},{key:"clearTimeout",value:function(e){function r(){return e.apply(this,arguments)}return r.toString=function(){return e.toString()},r}(function(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)})}],[{key:"createAndSchedule",value:function(e,r,o,a,u){var d=new t(e,r,Date.now()+o,a,u);return d.start(o),d}}])}();function Wle(t,e){if(em("AsyncQueue","".concat(e,": ").concat(t)),iI(t))return new tr(tn.UNAVAILABLE,"".concat(e,": ").concat(t));throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wj,lte,zle=function(){function t(e){xe(this,t),this.comparator=e?function(r,o){return e(r,o)||ar.comparator(r.key,o.key)}:function(r,o){return ar.comparator(r.key,o.key)},this.keyedMap=fC(),this.sortedSet=new Sa(this.comparator)}return Me(t,[{key:"has",value:function(e){return this.keyedMap.get(e)!=null}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal(function(r,o){return e(r),!1})}},{key:"add",value:function(e){var r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}},{key:"isEqual",value:function(e){if(!(e instanceof t)||this.size!==e.size)return!1;for(var r=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();r.hasNext();){var a=r.getNext().key,u=o.getNext().key;if(!a.isEqual(u))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach(function(r){e.push(r.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}},{key:"copy",value:function(e,r){var o=new t;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=r,o}}],[{key:"emptySet",value:function(e){return new t(e.comparator)}}])}(),dte=function(){return Me(function t(){xe(this,t),this.W_=new Sa(ar.comparator)},[{key:"track",value:function(t){var e=t.doc.key,r=this.W_.get(e);r?t.type!==0&&r.type===3?this.W_=this.W_.insert(e,t):t.type===3&&r.type!==1?this.W_=this.W_.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.W_=this.W_.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.W_=this.W_.remove(e):t.type===1&&r.type===2?this.W_=this.W_.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):Ar():this.W_=this.W_.insert(e,t)}},{key:"G_",value:function(){var t=[];return this.W_.inorderTraversal(function(e,r){t.push(r)}),t}}])}(),v1=function(){function t(e,r,o,a,u,d,f,g,E){xe(this,t),this.query=e,this.docs=r,this.oldDocs=o,this.docChanges=a,this.mutatedKeys=u,this.fromCache=d,this.syncStateChanged=f,this.excludesMetadataChanges=g,this.hasCachedResults=E}return Me(t,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&TD(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var r=this.docChanges,o=e.docChanges;if(r.length!==o.length)return!1;for(var a=0;a<r.length;a++)if(r[a].type!==o[a].type||!r[a].doc.isEqual(o[a].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(e,r,o,a,u){var d=[];return r.forEach(function(f){d.push({type:0,doc:f})}),new t(e,r,zle.emptySet(r),d,o,a,!0,!1,u)}}])}(),G7e=function(){return Me(function t(){xe(this,t),this.z_=void 0,this.j_=[]},[{key:"H_",value:function(){return this.j_.some(function(t){return t.J_()})}}])}(),H7e=function(){return Me(function t(){xe(this,t),this.queries=hte(),this.onlineState="Unknown",this.Y_=new Set},[{key:"terminate",value:function(){var t,e,r,o;t=this,e=new tr(tn.ABORTED,"Firestore shutting down"),r=pi(t),o=r.queries,r.queries=hte(),o.forEach(function(a,u){var d,f=pn(u.j_);try{for(f.s();!(d=f.n()).done;)d.value.onError(e)}catch(g){f.e(g)}finally{f.f()}})}}])}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hte(){return new s0(function(t){return ole(t)},TD)}function K7e(t,e){return Gle.apply(this,arguments)}function Gle(){return(Gle=Ue(ue().mark(function t(e,r){var o,a,u,d,f;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:o=pi(e),a=3,u=r.query,(d=o.queries.get(u))?!d.H_()&&r.J_()&&(a=2):(d=new G7e,a=r.J_()?0:1),g.prev=5,g.t0=a,g.next=g.t0===0?9:g.t0===1?13:g.t0===2?17:19;break;case 9:return g.next=11,o.onListen(u,!0);case 11:return d.z_=g.sent,g.abrupt("break",19);case 13:return g.next=15,o.onListen(u,!1);case 15:return d.z_=g.sent,g.abrupt("break",19);case 17:return g.next=19,o.onFirstRemoteStoreListen(u);case 19:g.next=25;break;case 21:return g.prev=21,g.t1=g.catch(5),f=Wle(g.t1,"Initialization of query '".concat(WS(r.query),"' failed")),g.abrupt("return",void r.onError(f));case 25:o.queries.set(u,d),d.j_.push(r),r.Z_(o.onlineState),d.z_&&r.X_(d.z_)&&s6(o);case 26:case"end":return g.stop()}},t,null,[[5,21]])}))).apply(this,arguments)}function q7e(t,e){return Hle.apply(this,arguments)}function Hle(){return(Hle=Ue(ue().mark(function t(e,r){var o,a,u,d,f;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:o=pi(e),a=r.query,u=3,(d=o.queries.get(a))&&(f=d.j_.indexOf(r))>=0&&(d.j_.splice(f,1),d.j_.length===0?u=r.J_()?0:1:!d.H_()&&r.J_()&&(u=2)),g.t0=u,g.next=g.t0===0?7:g.t0===1?8:g.t0===2?9:10;break;case 7:return g.abrupt("return",(o.queries.delete(a),o.onUnlisten(a,!0)));case 8:return g.abrupt("return",(o.queries.delete(a),o.onUnlisten(a,!1)));case 9:return g.abrupt("return",o.onLastRemoteStoreUnlisten(a));case 10:return g.abrupt("return");case 11:case"end":return g.stop()}},t)}))).apply(this,arguments)}function $7e(t,e){var r,o=pi(t),a=!1,u=pn(e);try{for(u.s();!(r=u.n()).done;){var d=r.value,f=d.query,g=o.queries.get(f);if(g){var E,T=pn(g.j_);try{for(T.s();!(E=T.n()).done;)E.value.X_(d)&&(a=!0)}catch(C){T.e(C)}finally{T.f()}g.z_=d}}}catch(C){u.e(C)}finally{u.f()}a&&s6(o)}function Y7e(t,e,r){var o=pi(t),a=o.queries.get(e);if(a){var u,d=pn(a.j_);try{for(d.s();!(u=d.n()).done;)u.value.onError(r)}catch(f){d.e(f)}finally{d.f()}}o.queries.delete(e)}function s6(t){t.Y_.forEach(function(e){e.next()})}(lte=Wj||(Wj={})).ea="default",lte.Cache="cache";var X7e=function(){return Me(function t(e,r,o){xe(this,t),this.query=e,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=o||{}},[{key:"X_",value:function(t){if(!this.options.includeMetadataChanges){var e,r=[],o=pn(t.docChanges);try{for(o.s();!(e=o.n()).done;){var a=e.value;a.type!==3&&r.push(a)}}catch(d){o.e(d)}finally{o.f()}t=new v1(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}var u=!1;return this.na?this.ia(t)&&(this.ta.next(t),u=!0):this.sa(t,this.onlineState)&&(this.oa(t),u=!0),this.ra=t,u}},{key:"onError",value:function(t){this.ta.error(t)}},{key:"Z_",value:function(t){this.onlineState=t;var e=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),e=!0),e}},{key:"sa",value:function(t,e){if(!t.fromCache||!this.J_())return!0;var r=e!=="Offline";return(!this.options._a||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}},{key:"ia",value:function(t){if(t.docChanges.length>0)return!0;var e=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}},{key:"oa",value:function(t){t=v1.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}},{key:"J_",value:function(){return this.options.source!==Wj.Cache}}])}(),Kle=Me(function t(e){xe(this,t),this.key=e}),qle=Me(function t(e){xe(this,t),this.key=e}),J7e=function(){return Me(function t(e,r){xe(this,t),this.query=e,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Si(),this.mutatedKeys=Si(),this.Aa=ale(e),this.Ra=new zle(this.Aa)},[{key:"Va",get:function(){return this.Ta}},{key:"ma",value:function(t,e){var r=this,o=e?e.fa:new dte,a=e?e.Ra:this.Ra,u=e?e.mutatedKeys:this.mutatedKeys,d=a,f=!1,g=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,E=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(t.inorderTraversal(function(C,I){var D=a.get(C),L=bD(r.query,I)?I:null,B=!!D&&r.mutatedKeys.has(D.key),G=!!L&&(L.hasLocalMutations||r.mutatedKeys.has(L.key)&&L.hasCommittedMutations),se=!1;D&&L?D.data.isEqual(L.data)?B!==G&&(o.track({type:3,doc:L}),se=!0):r.ga(D,L)||(o.track({type:2,doc:L}),se=!0,(g&&r.Aa(L,g)>0||E&&r.Aa(L,E)<0)&&(f=!0)):!D&&L?(o.track({type:0,doc:L}),se=!0):D&&!L&&(o.track({type:1,doc:D}),se=!0,(g||E)&&(f=!0)),se&&(L?(d=d.add(L),u=G?u.add(C):u.delete(C)):(d=d.delete(C),u=u.delete(C)))}),this.query.limit!==null)for(;d.size>this.query.limit;){var T=this.query.limitType==="F"?d.last():d.first();d=d.delete(T.key),u=u.delete(T.key),o.track({type:1,doc:T})}return{Ra:d,fa:o,ns:f,mutatedKeys:u}}},{key:"ga",value:function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}},{key:"applyChanges",value:function(t,e,r,o){var a=this,u=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;var d=t.fa.G_();d.sort(function(T,C){return function(I,D){var L=function(B){switch(B){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ar()}};return L(I)-L(D)}(T.type,C.type)||a.Aa(T.doc,C.doc)}),this.pa(r),o=o!=null&&o;var f=e&&!o?this.ya():[],g=this.da.size===0&&this.current&&!o?1:0,E=g!==this.Ea;return this.Ea=g,d.length!==0||E?{snapshot:new v1(this.query,t.Ra,u,d,t.mutatedKeys,g===0,E,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:f}:{wa:f}}},{key:"Z_",value:function(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new dte,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}},{key:"Sa",value:function(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}},{key:"pa",value:function(t){var e=this;t&&(t.addedDocuments.forEach(function(r){return e.Ta=e.Ta.add(r)}),t.modifiedDocuments.forEach(function(r){}),t.removedDocuments.forEach(function(r){return e.Ta=e.Ta.delete(r)}),this.current=t.current)}},{key:"ya",value:function(){var t=this;if(!this.current)return[];var e=this.da;this.da=Si(),this.Ra.forEach(function(o){t.Sa(o.key)&&(t.da=t.da.add(o.key))});var r=[];return e.forEach(function(o){t.da.has(o)||r.push(new qle(o))}),this.da.forEach(function(o){e.has(o)||r.push(new Kle(o))}),r}},{key:"ba",value:function(t){this.Ta=t.Ts,this.da=Si();var e=this.ma(t.documents);return this.applyChanges(e,!0)}},{key:"Da",value:function(){return v1.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}])}(),Q7e=Me(function t(e,r,o){xe(this,t),this.query=e,this.targetId=r,this.view=o}),Z7e=Me(function t(e){xe(this,t),this.key=e,this.va=!1}),e$e=function(){return Me(function t(e,r,o,a,u,d){xe(this,t),this.localStore=e,this.remoteStore=r,this.eventManager=o,this.sharedClientState=a,this.currentUser=u,this.maxConcurrentLimboResolutions=d,this.Ca={},this.Fa=new s0(function(f){return ole(f)},TD),this.Ma=new Map,this.xa=new Set,this.Oa=new Sa(ar.comparator),this.Na=new Map,this.La=new e6,this.Ba={},this.ka=new Map,this.qa=Fj.kn(),this.onlineState="Unknown",this.Qa=void 0},[{key:"isPrimaryClient",get:function(){return this.Qa===!0}}])}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t$e(t,e){return zj.apply(this,arguments)}function zj(){return zj=Ue(ue().mark(function t(e,r){var o,a,u,d,f=arguments;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(o=!(f.length>2&&f[2]!==void 0)||f[2],a=sde(e),!(d=a.Fa.get(r))){g.next=7;break}a.sharedClientState.addLocalQueryTarget(d.targetId),u=d.view.Da(),g.next=10;break;case 7:return g.next=9,Yle(a,r,o,!0);case 9:u=g.sent;case 10:return g.abrupt("return",u);case 11:case"end":return g.stop()}},t)})),zj.apply(this,arguments)}function n$e(t,e){return $le.apply(this,arguments)}function $le(){return($le=Ue(ue().mark(function t(e,r){var o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o=sde(e),a.next=3,Yle(o,r,!0,!1);case 3:case"end":return a.stop()}},t)}))).apply(this,arguments)}function Yle(t,e,r,o){return Xle.apply(this,arguments)}function Xle(){return(Xle=Ue(ue().mark(function t(e,r,o,a){var u,d,f,g;return ue().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,I7e(e.localStore,Rf(r));case 2:if(u=E.sent,d=u.targetId,f=e.sharedClientState.addLocalQueryTarget(d,o),E.t0=a,!E.t0){E.next=10;break}return E.next=9,r$e(e,r,d,f==="current",u.resumeToken);case 9:g=E.sent;case 10:return e.isPrimaryClient&&o&&Dle(e.remoteStore,u),E.abrupt("return",g);case 12:case"end":return E.stop()}},t)}))).apply(this,arguments)}function r$e(t,e,r,o,a){return Gj.apply(this,arguments)}function Gj(){return Gj=Ue(ue().mark(function t(e,r,o,a,u){var d,f,g,E,T,C;return ue().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return e.Ka=function(D,L,B){return(G=Ue(ue().mark(function se(ae,M,F,z){var te,j,K,Q;return ue().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(te=M.view.ma(F),ce.t0=te.ns,!ce.t0){ce.next=6;break}return ce.next=5,ste(ae.localStore,M.query,!1).then(function(Ee){var _e=Ee.documents;return M.view.ma(_e,te)});case 5:te=ce.sent;case 6:return j=z&&z.targetChanges.get(M.targetId),K=z&&z.targetMismatches.get(M.targetId)!=null,Q=M.view.applyChanges(te,ae.isPrimaryClient,j,K),ce.abrupt("return",(pte(ae,M.targetId,Q.wa),Q.snapshot));case 8:case"end":return ce.stop()}},se)})),function(se,ae,M,F){return G.apply(this,arguments)})(e,D,L,B);var G},I.next=3,ste(e.localStore,r,!0);case 3:return d=I.sent,f=new J7e(r,d.Ts),g=f.ma(d.documents),E=Q5.createSynthesizedTargetChangeForCurrentChange(o,a&&e.onlineState!=="Offline",u),T=f.applyChanges(g,e.isPrimaryClient,E),pte(e,o,T.wa),C=new Q7e(r,o,f),I.abrupt("return",(e.Fa.set(r,C),e.Ma.has(o)?e.Ma.get(o).push(r):e.Ma.set(o,[r]),T.snapshot));case 11:case"end":return I.stop()}},t)})),Gj.apply(this,arguments)}function i$e(t,e,r){return Jle.apply(this,arguments)}function Jle(){return(Jle=Ue(ue().mark(function t(e,r,o){var a,u,d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(a=pi(e),u=a.Fa.get(r),!((d=a.Ma.get(u.targetId)).length>1)){f.next=3;break}return f.abrupt("return",(a.Ma.set(u.targetId,d.filter(function(g){return!TD(g,r)})),void a.Fa.delete(r)));case 3:if(!a.isPrimaryClient){f.next=11;break}if(a.sharedClientState.removeLocalQueryTarget(u.targetId),f.t0=a.sharedClientState.isActiveQueryTarget(u.targetId),f.t0){f.next=9;break}return f.next=9,jj(a.localStore,u.targetId,!1).then(function(){a.sharedClientState.clearQueryState(u.targetId),o&&t6(a.remoteStore,u.targetId),Hj(a,u.targetId)}).catch(W5);case 9:f.next=14;break;case 11:return Hj(a,u.targetId),f.next=14,jj(a.localStore,u.targetId,!0);case 14:case"end":return f.stop()}},t)}))).apply(this,arguments)}function s$e(t,e){return Qle.apply(this,arguments)}function Qle(){return(Qle=Ue(ue().mark(function t(e,r){var o,a,u;return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:o=pi(e),a=o.Fa.get(r),u=o.Ma.get(a.targetId),o.isPrimaryClient&&u.length===1&&(o.sharedClientState.removeLocalQueryTarget(a.targetId),t6(o.remoteStore,a.targetId));case 2:case"end":return d.stop()}},t)}))).apply(this,arguments)}function Zle(t,e){return ede.apply(this,arguments)}function ede(){return(ede=Ue(ue().mark(function t(e,r){var o,a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return o=pi(e),u.prev=1,u.next=4,R7e(o.localStore,r);case 4:return a=u.sent,r.targetChanges.forEach(function(d,f){var g=o.Na.get(f);g&&(_o(d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size<=1),d.addedDocuments.size>0?g.va=!0:d.modifiedDocuments.size>0?_o(g.va):d.removedDocuments.size>0&&(_o(g.va),g.va=!1))}),u.next=8,rde(o,a,r);case 8:u.next=14;break;case 10:return u.prev=10,u.t0=u.catch(1),u.next=14,W5(u.t0);case 14:case"end":return u.stop()}},t,null,[[1,10]])}))).apply(this,arguments)}function fte(t,e,r){var o=pi(t);if(o.isPrimaryClient&&r===0||!o.isPrimaryClient&&r===1){var a=[];o.Fa.forEach(function(u,d){var f=d.view.Z_(e);f.snapshot&&a.push(f.snapshot)}),function(u,d){var f=pi(u);f.onlineState=d;var g=!1;f.queries.forEach(function(E,T){var C,I=pn(T.j_);try{for(I.s();!(C=I.n()).done;)C.value.Z_(d)&&(g=!0)}catch(D){I.e(D)}finally{I.f()}}),g&&s6(f)}(o.eventManager,e),a.length&&o.Ca.d_(a),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}function o$e(t,e,r){return tde.apply(this,arguments)}function tde(){return(tde=Ue(ue().mark(function t(e,r,o){var a,u,d,f,g,E;return ue().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if((a=pi(e)).sharedClientState.updateQueryState(r,"rejected",o),u=a.Na.get(r),!(d=u&&u.key)){T.next=14;break}return f=(f=new Sa(ar.comparator)).insert(d,nm.newNoDocument(d,jr.min())),g=Si().add(d),E=new gle(jr.min(),new Map,new Sa(Ni),f,g),T.next=9,Zle(a,E);case 9:a.Oa=a.Oa.remove(d),a.Na.delete(r),o6(a),T.next=16;break;case 14:return T.next=16,jj(a.localStore,r,!1).then(function(){return Hj(a,r,o)}).catch(W5);case 16:case"end":return T.stop()}},t)}))).apply(this,arguments)}function Hj(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;t.sharedClientState.removeLocalQueryTarget(e);var o,a=pn(t.Ma.get(e));try{for(a.s();!(o=a.n()).done;){var u=o.value;t.Fa.delete(u),r&&t.Ca.$a(u,r)}}catch(d){a.e(d)}finally{a.f()}t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(function(d){t.La.containsKey(d)||nde(t,d)})}function nde(t,e){t.xa.delete(e.path.canonicalString());var r=t.Oa.get(e);r!==null&&(t6(t.remoteStore,r),t.Oa=t.Oa.remove(e),t.Na.delete(r),o6(t))}function pte(t,e,r){var o,a=pn(r);try{for(a.s();!(o=a.n()).done;){var u=o.value;u instanceof Kle?(t.La.addReference(u.key,e),a$e(t,u)):u instanceof qle?(Sn("SyncEngine","Document no longer in limbo: "+u.key),t.La.removeReference(u.key,e),t.La.containsKey(u.key)||nde(t,u.key)):Ar()}}catch(d){a.e(d)}finally{a.f()}}function a$e(t,e){var r=e.key,o=r.path.canonicalString();t.Oa.get(r)||t.xa.has(o)||(Sn("SyncEngine","New document in limbo: "+r),t.xa.add(o),o6(t))}function o6(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){var e=t.xa.values().next().value;t.xa.delete(e);var r=new ar(Jo.fromString(e)),o=t.qa.next();t.Na.set(o,new Z7e(r)),t.Oa=t.Oa.insert(r,o),Dle(t.remoteStore,new Z5(Rf(Y5(r.path)),o,"TargetPurposeLimboResolution",z5.oe))}}function rde(t,e,r){return Kj.apply(this,arguments)}function Kj(){return Kj=Ue(ue().mark(function t(e,r,o){var a,u,d,f;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(a=pi(e),u=[],d=[],f=[],g.t0=a.Fa.isEmpty(),g.t0){g.next=9;break}return a.Fa.forEach(function(E,T){f.push(a.Ka(T,r,o).then(function(C){var I;if((C||o)&&a.isPrimaryClient){var D=C?!C.fromCache:(I=o==null?void 0:o.targetChanges.get(T.targetId))===null||I===void 0?void 0:I.current;a.sharedClientState.updateQueryState(T.targetId,D?"current":"not-current")}if(C){u.push(C);var L=T7e.Wi(T.targetId,C);d.push(L)}}))}),g.next=6,Promise.all(f);case 6:return a.Ca.d_(u),g.next=9,function(){var E=Ue(ue().mark(function T(C,I){var D,L,B,G,se,ae,M,F;return ue().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return D=pi(C),z.prev=1,z.next=4,D.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(te){return Ht.forEach(I,function(j){return Ht.forEach(j.$i,function(K){return D.persistence.referenceDelegate.addReference(te,j.targetId,K)}).next(function(){return Ht.forEach(j.Ui,function(K){return D.persistence.referenceDelegate.removeReference(te,j.targetId,K)})})})});case 4:z.next=11;break;case 6:if(z.prev=6,z.t0=z.catch(1),iI(z.t0)){z.next=10;break}throw z.t0;case 10:Sn("LocalStore","Failed to update sequence numbers: "+z.t0);case 11:L=pn(I);try{for(L.s();!(B=L.n()).done;)G=B.value,se=G.targetId,G.fromCache||(ae=D.os.get(se),M=ae.snapshotVersion,F=ae.withLastLimboFreeSnapshotVersion(M),D.os=D.os.insert(se,F))}catch(te){L.e(te)}finally{L.f()}case 13:case"end":return z.stop()}},T,null,[[1,6]])}));return function(T,C){return E.apply(this,arguments)}}()(a.localStore,d);case 9:case"end":return g.stop()}},t)})),Kj.apply(this,arguments)}function c$e(t,e){return ide.apply(this,arguments)}function ide(){return(ide=Ue(ue().mark(function t(e,r){var o,a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if((o=pi(e)).currentUser.isEqual(r)){u.next=11;break}return Sn("SyncEngine","User change. New user:",r.toKey()),u.next=5,Cle(o.localStore,r);case 5:return a=u.sent,o.currentUser=r,function(d,f){d.ka.forEach(function(g){g.forEach(function(E){E.reject(new tr(tn.CANCELLED,f))})}),d.ka.clear()}(o,"'waitForPendingWrites' promise is rejected due to a user change."),o.sharedClientState.handleUserChange(r,a.removedBatchIds,a.addedBatchIds),u.next=11,rde(o,a.hs);case 11:case"end":return u.stop()}},t)}))).apply(this,arguments)}function u$e(t,e){var r=pi(t),o=r.Na.get(e);if(o&&o.va)return Si().add(o.key);var a=Si(),u=r.Ma.get(e);if(!u)return a;var d,f=pn(u);try{for(f.s();!(d=f.n()).done;){var g=d.value,E=r.Fa.get(g);a=a.unionWith(E.view.Va)}}catch(T){f.e(T)}finally{f.f()}return a}function sde(t){var e=pi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Zle.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=u$e.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=o$e.bind(null,e),e.Ca.d_=$7e.bind(null,e.eventManager),e.Ca.$a=Y7e.bind(null,e.eventManager),e}var _1=function(){return Me(function r(){xe(this,r),this.kind="memory",this.synchronizeTabs=!1},[{key:"initialize",value:(e=Ue(ue().mark(function r(o){return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.serializer=kle(o.databaseInfo.databaseId),this.sharedClientState=this.Wa(o),this.persistence=this.Ga(o),a.next=5,this.persistence.start();case 5:this.localStore=this.za(o),this.gcScheduler=this.ja(o,this.localStore),this.indexBackfillerScheduler=this.Ha(o,this.localStore);case 8:case"end":return a.stop()}},r,this)})),function(r){return e.apply(this,arguments)})},{key:"ja",value:function(r,o){return null}},{key:"Ha",value:function(r,o){return null}},{key:"za",value:function(r){return function(o,a,u,d){return new C7e(o,a,u,d)}(this.persistence,new w7e,r.initialUser,this.serializer)}},{key:"Ga",value:function(r){return new y7e(S7e.Zr,this.serializer)}},{key:"Wa",value:function(r){return new A7e}},{key:"terminate",value:(t=Ue(ue().mark(function r(){var o,a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return(o=this.gcScheduler)===null||o===void 0||o.stop(),(a=this.indexBackfillerScheduler)===null||a===void 0||a.stop(),this.sharedClientState.shutdown(),u.next=5,this.persistence.shutdown();case 5:case"end":return u.stop()}},r,this)})),function(){return t.apply(this,arguments)})}]);var t,e}();_1.provider={build:function(){return new _1}};var qj=function(){return Me(function r(){xe(this,r)},[{key:"initialize",value:(e=Ue(ue().mark(function r(o,a){var u=this;return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(d.t0=this.localStore,d.t0){d.next=12;break}return this.localStore=o.localStore,this.sharedClientState=o.sharedClientState,this.datastore=this.createDatastore(a),this.remoteStore=this.createRemoteStore(a),this.eventManager=this.createEventManager(a),this.syncEngine=this.createSyncEngine(a,!o.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(f){return fte(u.syncEngine,f,1)},this.remoteStore.remoteSyncer.handleCredentialChange=c$e.bind(null,this.syncEngine),d.next=12,W7e(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return d.stop()}},r,this)})),function(r,o){return e.apply(this,arguments)})},{key:"createEventManager",value:function(r){return new H7e}},{key:"createDatastore",value:function(r){var o=kle(r.databaseInfo.databaseId),a=function(u){return new N7e(u)}(r.databaseInfo);return function(u,d,f,g){return new x7e(u,d,f,g)}(r.authCredentials,r.appCheckCredentials,a,o)}},{key:"createRemoteStore",value:function(r){var o=this;return function(a,u,d,f,g){return new U7e(a,u,d,f,g)}(this.localStore,this.datastore,r.asyncQueue,function(a){return fte(o.syncEngine,a,0)},ate.D()?new ate:new k7e)}},{key:"createSyncEngine",value:function(r,o){return function(a,u,d,f,g,E,T){var C=new e$e(a,u,d,f,g,E);return T&&(C.Qa=!0),C}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,r.initialUser,r.maxConcurrentLimboResolutions,o)}},{key:"terminate",value:(t=Ue(ue().mark(function r(){var o,a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,function(){var d=Ue(ue().mark(function f(g){var E;return ue().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return E=pi(g),Sn("RemoteStore","RemoteStore shutting down."),E.L_.add(5),T.next=5,sI(E);case 5:E.k_.shutdown(),E.q_.set("Unknown");case 7:case"end":return T.stop()}},f)}));return function(f){return d.apply(this,arguments)}}()(this.remoteStore);case 2:(o=this.datastore)===null||o===void 0||o.terminate(),(a=this.eventManager)===null||a===void 0||a.terminate();case 4:case"end":return u.stop()}},r,this)})),function(){return t.apply(this,arguments)})}]);var t,e}();qj.provider={build:function(){return new qj}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var l$e=function(){return Me(function t(e){xe(this,t),this.observer=e,this.muted=!1},[{key:"next",value:function(t){this.muted||this.observer.next&&this.Ya(this.observer.next,t)}},{key:"error",value:function(t){this.muted||(this.observer.error?this.Ya(this.observer.error,t):em("Uncaught Error in snapshot listener:",t.toString()))}},{key:"Za",value:function(){this.muted=!0}},{key:"Ya",value:function(t,e){var r=this;setTimeout(function(){r.muted||t(e)},0)}}])}(),d$e=function(){return Me(function t(e,r,o,a,u){var d=this;xe(this,t),this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=o,this.databaseInfo=a,this.user=zc.UNAUTHENTICATED,this.clientId=que.newId(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this._uninitializedComponentsProvider=u,this.authCredentials.start(o,function(){var f=Ue(ue().mark(function g(E){return ue().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return Sn("FirestoreClient","Received user=",E.uid),T.next=3,d.authCredentialListener(E);case 3:d.user=E;case 4:case"end":return T.stop()}},g)}));return function(g){return f.apply(this,arguments)}}()),this.appCheckCredentials.start(o,function(f){return Sn("FirestoreClient","Received new app check token=",f),d.appCheckCredentialListener(f,d.user)})},[{key:"configuration",get:function(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}},{key:"setCredentialChangeListener",value:function(t){this.authCredentialListener=t}},{key:"setAppCheckTokenChangeListener",value:function(t){this.appCheckCredentialListener=t}},{key:"terminate",value:function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new ry;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(Ue(ue().mark(function r(){var o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,a.t0=t._onlineComponents,!a.t0){a.next=5;break}return a.next=5,t._onlineComponents.terminate();case 5:if(a.t1=t._offlineComponents,!a.t1){a.next=9;break}return a.next=9,t._offlineComponents.terminate();case 9:t.authCredentials.shutdown(),t.appCheckCredentials.shutdown(),e.resolve(),a.next=18;break;case 14:a.prev=14,a.t2=a.catch(0),o=Wle(a.t2,"Failed to shutdown persistence"),e.reject(o);case 18:case"end":return a.stop()}},r,null,[[0,14]])}))),e.promise}}])}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W2(t,e){return $j.apply(this,arguments)}function $j(){return $j=Ue(ue().mark(function t(e,r){var o,a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return e.asyncQueue.verifyOperationInProgress(),Sn("FirestoreClient","Initializing OfflineComponentProvider"),o=e.configuration,u.next=4,r.initialize(o);case 4:a=o.initialUser,e.setCredentialChangeListener(function(){var d=Ue(ue().mark(function f(g){return ue().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(E.t0=a.isEqual(g),E.t0){E.next=5;break}return E.next=4,Cle(r.localStore,g);case 4:a=g;case 5:case"end":return E.stop()}},f)}));return function(f){return d.apply(this,arguments)}}()),r.persistence.setDatabaseDeletedListener(function(){return e.terminate()}),e._offlineComponents=r;case 6:case"end":return u.stop()}},t)})),$j.apply(this,arguments)}function mte(t,e){return ode.apply(this,arguments)}function ode(){return(ode=Ue(ue().mark(function t(e,r){var o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e.asyncQueue.verifyOperationInProgress(),a.next=3,h$e(e);case 3:return o=a.sent,Sn("FirestoreClient","Initializing OnlineComponentProvider"),a.next=7,r.initialize(o,e.configuration);case 7:e.setCredentialChangeListener(function(u){return ute(r.remoteStore,u)}),e.setAppCheckTokenChangeListener(function(u,d){return ute(r.remoteStore,d)}),e._onlineComponents=r;case 10:case"end":return a.stop()}},t)}))).apply(this,arguments)}function h$e(t){return ade.apply(this,arguments)}function ade(){return(ade=Ue(ue().mark(function t(e){var r;return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e._offlineComponents){o.next=21;break}if(!e._uninitializedComponentsProvider){o.next=18;break}return Sn("FirestoreClient","Using user provided OfflineComponentProvider"),o.prev=3,o.next=6,W2(e,e._uninitializedComponentsProvider._offline);case 6:o.next=16;break;case 8:if(o.prev=8,o.t0=o.catch(3),function(a){return a.name==="FirebaseError"?a.code===tn.FAILED_PRECONDITION||a.code===tn.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(r=o.t0)){o.next=13;break}throw r;case 13:return BT("Error using user provided cache. Falling back to memory cache: "+r),o.next=16,W2(e,new _1);case 16:o.next=21;break;case 18:return Sn("FirestoreClient","Using default OfflineComponentProvider"),o.next=21,W2(e,new _1);case 21:return o.abrupt("return",e._offlineComponents);case 22:case"end":return o.stop()}},t,null,[[3,8]])}))).apply(this,arguments)}function f$e(t){return cde.apply(this,arguments)}function cde(){return(cde=Ue(ue().mark(function t(e){return ue().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=e._onlineComponents,r.t0){r.next=11;break}if(!e._uninitializedComponentsProvider){r.next=8;break}return Sn("FirestoreClient","Using user provided OnlineComponentProvider"),r.next=6,mte(e,e._uninitializedComponentsProvider._online);case 6:r.next=11;break;case 8:return Sn("FirestoreClient","Using default OnlineComponentProvider"),r.next=11,mte(e,new qj);case 11:return r.abrupt("return",e._onlineComponents);case 12:case"end":return r.stop()}},t)}))).apply(this,arguments)}function p$e(t){return ude.apply(this,arguments)}function ude(){return(ude=Ue(ue().mark(function t(e){var r,o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,f$e(e);case 2:return r=a.sent,o=r.eventManager,a.abrupt("return",(o.onListen=t$e.bind(null,r.syncEngine),o.onUnlisten=i$e.bind(null,r.syncEngine),o.onFirstRemoteStoreListen=n$e.bind(null,r.syncEngine),o.onLastRemoteStoreUnlisten=s$e.bind(null,r.syncEngine),o));case 5:case"end":return a.stop()}},t)}))).apply(this,arguments)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lde(t){var e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var gte=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vte(t){if(!ar.isDocumentKey(t))throw new tr(tn.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(t," has ").concat(t.length,"."))}function Yj(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new tr(tn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var r=function(o){if(o===void 0)return"undefined";if(o===null)return"null";if(typeof o=="string")return o.length>20&&(o="".concat(o.substring(0,20),"...")),JSON.stringify(o);if(typeof o=="number"||typeof o=="boolean")return""+o;if(vo(o)=="object"){if(o instanceof Array)return"an array";var a=function(u){return u.constructor?u.constructor.name:null}(o);return a?"a custom ".concat(a," object"):"an object"}return typeof o=="function"?"a function":Ar()}(t);throw new tr(tn.INVALID_ARGUMENT,"Expected type '".concat(e.name,"', but it was: ").concat(r))}return t}var _te=function(){return Me(function t(e){var r,o;if(xe(this,t),e.host===void 0){if(e.ssl!==void 0)throw new tr(tn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new tr(tn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(a,u,d,f){if(u===!0&&f===!0)throw new tr(tn.INVALID_ARGUMENT,"".concat(a," and ").concat(d," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lde((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new tr(tn.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(a.timeoutSeconds," (must not be NaN)"));if(a.timeoutSeconds<5)throw new tr(tn.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(a.timeoutSeconds," (minimum allowed value is 5)"));if(a.timeoutSeconds>30)throw new tr(tn.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(a.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams},[{key:"isEqual",value:function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(e,r){return e.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}])}(),a6=function(){return Me(function e(r,o,a,u){xe(this,e),this._authCredentials=r,this._appCheckCredentials=o,this._databaseId=a,this._app=u,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new _te({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"},[{key:"app",get:function(){if(!this._app)throw new tr(tn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return this._terminateTask!=="notTerminated"}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new tr(tn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new _te(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new u3e;switch(r.type){case"firstParty":return new f3e(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new tr(tn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}},{key:"_restart",value:(t=Ue(ue().mark(function e(){return ue().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this._terminateTask!=="notTerminated"){r.next=5;break}return r.next=3,this._terminate();case 3:r.next=6;break;case 5:this._terminateTask="notTerminated";case 6:case"end":return r.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return e=this,(r=gte.get(e))&&(Sn("ComponentProvider","Removing Datastore"),gte.delete(e),r.terminate()),Promise.resolve();var e,r}}]);var t}();function m$e(t,e,r){var o,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},u=(t=Yj(t,a6))._getSettings(),d="".concat(e,":").concat(r);if(u.host!=="firestore.googleapis.com"&&u.host!==d&&BT("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},u),{host:d,ssl:!1})),a.mockUserToken){var f,g;if(typeof a.mockUserToken=="string")f=a.mockUserToken,g=zc.MOCK_USER;else{f=function(T,C){if(T.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var I=C||"demo-project",D=T.iat||0,L=T.sub||T.user_id;if(!L)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var B=Object.assign({iss:"https://securetoken.google.com/".concat(I),aud:I,iat:D,exp:D+3600,auth_time:D,sub:L,user_id:L,firebase:{sign_in_provider:"custom",identities:{}}},T);return[u1(JSON.stringify({alg:"none",type:"JWT"})),u1(JSON.stringify(B)),""].join(".")}(a.mockUserToken,(o=t._app)===null||o===void 0?void 0:o.options.projectId);var E=a.mockUserToken.sub||a.mockUserToken.user_id;if(!E)throw new tr(tn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new zc(E)}t._authCredentials=new l3e(new Kue(f,g))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var g$e=function(){function t(e,r,o){xe(this,t),this.converter=r,this._query=o,this.type="query",this.firestore=e}return Me(t,[{key:"withConverter",value:function(e){return new t(this.firestore,e,this._query)}}])}(),iy=function(){function t(e,r,o){xe(this,t),this.converter=r,this._key=o,this.type="document",this.firestore=e}return Me(t,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new Xj(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(e){return new t(this.firestore,e,this._key)}}])}(),Xj=function(){function t(e,r,o){var a;return xe(this,t),(a=Jn(this,t,[e,r,Y5(o)]))._path=o,a.type="collection",a}return Qn(t,g$e),Me(t,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new iy(this.firestore,null,new ar(e))}},{key:"withConverter",value:function(e){return new t(this.firestore,e,this._path)}}])}();function v$e(t,e){for(var r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];if(t=Gg(t),arguments.length===1&&(e=que.newId()),function(f,g,E){if(!E)throw new tr(tn.INVALID_ARGUMENT,"Function ".concat(f,"() cannot be called with an empty ").concat(g,"."))}("doc","path",e),t instanceof a6){var u=Jo.fromString.apply(Jo,[e].concat(o));return vte(u),new iy(t,null,new ar(u))}if(!(t instanceof iy||t instanceof Xj))throw new tr(tn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var d=t._path.child(Jo.fromString.apply(Jo,[e].concat(o)));return vte(d),new iy(t.firestore,t instanceof Xj?t.converter:null,new ar(d))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yte=function(){return Me(function r(){var o=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Promise.resolve();xe(this,r),this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Ole(this,"async_queue_retry"),this.Vu=function(){var d=B2();d&&Sn("AsyncQueue","Visibility state changed to "+d.visibilityState),o.t_.jo()},this.mu=a;var u=B2();u&&typeof u.addEventListener=="function"&&u.addEventListener("visibilitychange",this.Vu)},[{key:"isShuttingDown",get:function(){return this.Iu}},{key:"enqueueAndForget",value:function(r){this.enqueue(r)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(r){this.fu(),this.gu(r)}},{key:"enterRestrictedMode",value:function(r){if(!this.Iu){this.Iu=!0,this.Au=r||!1;var o=B2();o&&typeof o.removeEventListener=="function"&&o.removeEventListener("visibilitychange",this.Vu)}}},{key:"enqueue",value:function(r){var o=this;if(this.fu(),this.Iu)return new Promise(function(){});var a=new ry;return this.gu(function(){return o.Iu&&o.Au?Promise.resolve():(r().then(a.resolve,a.reject),a.promise)}).then(function(){return a.promise})}},{key:"enqueueRetryable",value:function(r){var o=this;this.enqueueAndForget(function(){return o.Pu.push(r),o.pu()})}},{key:"pu",value:(e=Ue(ue().mark(function r(){var o=this;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this.Pu.length===0){a.next=14;break}return a.prev=1,a.next=4,this.Pu[0]();case 4:this.Pu.shift(),this.t_.reset(),a.next=13;break;case 8:if(a.prev=8,a.t0=a.catch(1),iI(a.t0)){a.next=12;break}throw a.t0;case 12:Sn("AsyncQueue","Operation failed with retryable error: "+a.t0);case 13:this.Pu.length>0&&this.t_.Go(function(){return o.pu()});case 14:case"end":return a.stop()}},r,this,[[1,8]])})),function(){return e.apply(this,arguments)})},{key:"gu",value:function(r){var o=this,a=this.mu.then(function(){return o.du=!0,r().catch(function(u){o.Eu=u,o.du=!1;var d=function(f){var g=f.message||"";return f.stack&&(g=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),g}(u);throw em("INTERNAL UNHANDLED ERROR: ",d),u}).then(function(u){return o.du=!1,u})});return this.mu=a,a}},{key:"enqueueAfterDelay",value:function(r,o,a){var u=this;this.fu(),this.Ru.indexOf(r)>-1&&(o=0);var d=z7e.createAndSchedule(this,r,o,a,function(f){return u.yu(f)});return this.Tu.push(d),d}},{key:"fu",value:function(){this.Eu&&Ar()}},{key:"verifyOperationInProgress",value:function(){}},{key:"wu",value:(t=Ue(ue().mark(function r(){var o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o=this.mu,a.next=3,o;case 3:if(o!==this.mu){a.next=0;break}case 4:case"end":return a.stop()}},r,this)})),function(){return t.apply(this,arguments)})},{key:"Su",value:function(r){var o,a=pn(this.Tu);try{for(a.s();!(o=a.n()).done;)if(o.value.timerId===r)return!0}catch(u){a.e(u)}finally{a.f()}return!1}},{key:"bu",value:function(r){var o=this;return this.wu().then(function(){o.Tu.sort(function(f,g){return f.targetTimeMs-g.targetTimeMs});var a,u=pn(o.Tu);try{for(u.s();!(a=u.n()).done;){var d=a.value;if(d.skipDelay(),r!=="all"&&d.timerId===r)break}}catch(f){u.e(f)}finally{u.f()}return o.wu()})}},{key:"Du",value:function(r){this.Ru.push(r)}},{key:"yu",value:function(r){var o=this.Tu.indexOf(r);this.Tu.splice(o,1)}}]);var t,e}(),dde=function(){function t(r,o,a,u){var d;return xe(this,t),(d=Jn(this,t,[r,o,a,u])).type="firestore",d._queue=new yte,d._persistenceKey=(u==null?void 0:u.name)||"[DEFAULT]",d}return Qn(t,a6),Me(t,[{key:"_terminate",value:(e=Ue(ue().mark(function r(){var o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this._firestoreClient){a.next=6;break}return o=this._firestoreClient.terminate(),this._queue=new yte(o),this._firestoreClient=void 0,a.next=6,o;case 6:case"end":return a.stop()}},r,this)})),function(){return e.apply(this,arguments)})}]);var e}();function _$e(t){if(t._terminated)throw new tr(tn.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||function(e){var r,o,a,u=e._freezeSettings(),d=function(f,g,E,T){return new w3e(f,g,E,T.host,T.ssl,T.experimentalForceLongPolling,T.experimentalAutoDetectLongPolling,lde(T.experimentalLongPollingOptions),T.useFetchStreams)}(e._databaseId,((r=e._app)===null||r===void 0?void 0:r.options.appId)||"",e._persistenceKey,u);e._componentsProvider||!((o=u.localCache)===null||o===void 0)&&o._offlineComponentProvider&&(!((a=u.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(e._componentsProvider={_offline:u.localCache._offlineComponentProvider,_online:u.localCache._onlineComponentProvider}),e._firestoreClient=new d$e(e._authCredentials,e._appCheckCredentials,e._queue,d,e._componentsProvider&&function(f){var g=f==null?void 0:f._online.build();return{_offline:f==null?void 0:f._offline.build(g),_online:g}}(e._componentsProvider))}(t),t._firestoreClient}var y$e=function(){function t(e){xe(this,t),this._byteString=e}return Me(t,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(e){try{return new t(al.fromBase64String(e))}catch(r){throw new tr(tn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}},{key:"fromUint8Array",value:function(e){return new t(al.fromUint8Array(e))}}])}(),Ete=function(){return Me(function t(){xe(this,t);for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];for(var a=0;a<r.length;++a)if(r[a].length===0)throw new tr(tn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Hp(r)},[{key:"isEqual",value:function(t){return this._internalPath.isEqual(t._internalPath)}}])}(),E$e=function(){return Me(function t(e,r){if(xe(this,t),!isFinite(e)||e<-90||e>90)throw new tr(tn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new tr(tn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r},[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(t){return this._lat===t._lat&&this._long===t._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(t){return Ni(this._lat,t._lat)||Ni(this._long,t._long)}}])}(),S$e=function(){return Me(function t(e){xe(this,t),this._values=(e||[]).map(function(r){return r})},[{key:"toArray",value:function(){return this._values.map(function(t){return t})}},{key:"isEqual",value:function(t){return function(e,r){if(e.length!==r.length)return!1;for(var o=0;o<e.length;++o)if(e[o]!==r[o])return!1;return!0}(this._values,t._values)}}])}(),T$e=new RegExp("[~\\*/\\[\\]]");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ste(t,e,r,o,a){var u="Function ".concat(e,"() called with invalid data");u+=". ";var d="";return new tr(tn.INVALID_ARGUMENT,u+t+d);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var hde=function(){return Me(function t(e,r,o,a,u){xe(this,t),this._firestore=e,this._userDataWriter=r,this._key=o,this._document=a,this._converter=u},[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new iy(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return this._document!==null}},{key:"data",value:function(){if(this._document){if(this._converter){var t=new b$e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(t){if(this._document){var e=this._document.data.field(fde("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}])}(),b$e=function(){function t(){return xe(this,t),Jn(this,t,arguments)}return Qn(t,hde),Me(t,[{key:"data",value:function(){return bf(t,"data",this,3)([])}}])}();function fde(t,e){return typeof e=="string"?function(r,o,a){if(o.search(T$e)>=0)throw Ste("Invalid field path (".concat(o,"). Paths must not contain '~', '*', '/', '[', or ']'"),r);try{return yue(Ete,Ps(o.split(".")))._internalPath}catch{throw Ste("Invalid field path (".concat(o,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),r)}}(t,e):e instanceof Ete?e._internalPath:e._delegate._internalPath}var w$e=function(){return Me(function t(){xe(this,t)},[{key:"convertValue",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none";switch(by(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Fs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Hg(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw Ar()}}},{key:"convertObject",value:function(t,e){return this.convertObjectMap(t.fields,e)}},{key:"convertObjectMap",value:function(t){var e=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",o={};return ED(t,function(a,u){o[a]=e.convertValue(u,r)}),o}},{key:"convertVectorValue",value:function(t){var e,r,o,a=(o=(r=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||r===void 0?void 0:r.values)===null||o===void 0?void 0:o.map(function(u){return Fs(u.doubleValue)});return new S$e(a)}},{key:"convertGeoPoint",value:function(t){return new E$e(Fs(t.latitude),Fs(t.longitude))}},{key:"convertArray",value:function(t,e){var r=this;return(t.values||[]).map(function(o){return r.convertValue(o,e)})}},{key:"convertServerTimestamp",value:function(t,e){switch(e){case"previous":var r=H5(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(yR(t));default:return null}}},{key:"convertTimestamp",value:function(t){var e=tm(t);return new Cf(e.seconds,e.nanos)}},{key:"convertDocumentKey",value:function(t,e){var r=Jo.fromString(t);_o(wle(r));var o=new Jue(r.get(1),r.get(3)),a=new ar(r.popFirst(5));return o.isEqual(e)||em("Document ".concat(a," contains a document reference within a different database (").concat(o.projectId,"/").concat(o.database,") which is not supported. It will be treated as a reference in the current database (").concat(e.projectId,"/").concat(e.database,") instead.")),a}}])}(),C$e=function(){return Me(function t(e,r){xe(this,t),this.hasPendingWrites=e,this.fromCache=r},[{key:"isEqual",value:function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}])}(),pde=function(){function t(e,r,o,a,u,d){var f;return xe(this,t),(f=Jn(this,t,[e,r,o,a,d]))._firestore=e,f._firestoreImpl=e,f.metadata=u,f}return Qn(t,hde),Me(t,[{key:"exists",value:function(){return bf(t,"exists",this,3)([])}},{key:"data",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._document){if(this._converter){var r=new R$e(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this._document){var o=this._document.data.field(fde("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,r.serverTimestamps)}}}])}(),R$e=function(){function t(){return xe(this,t),Jn(this,t,arguments)}return Qn(t,pde),Me(t,[{key:"data",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return bf(t,"data",this,3)([e])}}])}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I$e(t){t=Yj(t,iy);var e=Yj(t.firestore,dde);return function(r,o){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=new ry;return r.asyncQueue.enqueueAndForget(Ue(ue().mark(function d(){return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.t0=function(g,E,T,C,I){var D=new l$e({next:function(B){D.Za(),E.enqueueAndForget(function(){return q7e(g,L)});var G=B.docs.has(T);!G&&B.fromCache?I.reject(new tr(tn.UNAVAILABLE,"Failed to get document because the client is offline.")):G&&B.fromCache&&C&&C.source==="server"?I.reject(new tr(tn.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):I.resolve(B)},error:function(B){return I.reject(B)}}),L=new X7e(Y5(T.path),D,{includeMetadataChanges:!0,_a:!0});return K7e(g,L)},f.next=3,p$e(r);case 3:return f.t1=f.sent,f.t2=r.asyncQueue,f.t3=o,f.t4=a,f.t5=u,f.abrupt("return",(0,f.t0)(f.t1,f.t2,f.t3,f.t4,f.t5));case 9:case"end":return f.stop()}},d)}))),u.promise}(_$e(e),t._key).then(function(r){return function(o,a,u){var d=u.docs.get(a._key),f=new A$e(o);return new pde(o,f,a._key,d,new C$e(u.hasPendingWrites,u.fromCache),a.converter)}(e,t,r)})}var qw,A$e=function(){function t(e){var r;return xe(this,t),(r=Jn(this,t)).firestore=e,r}return Qn(t,w$e),Me(t,[{key:"convertBytes",value:function(e){return new y$e(e)}},{key:"convertReference",value:function(e){var r=this.convertDocumentKey(e,this.firestore._databaseId);return new iy(this.firestore,null,r)}}])}();function c6(t,e){var r={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(r[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function"){var a=0;for(o=Object.getOwnPropertySymbols(t);a<o.length;a++)e.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(t,o[a])&&(r[o[a]]=t[o[a]])}return r}function mde(){return Lt({},"dependent-sdk-initialized-before-auth","Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.")}(function(t){var e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];(function(r){i0=r})(r0),jT(new Ty("firestore",function(r,o){var a=o.instanceIdentifier,u=o.options,d=r.getProvider("app").getImmediate(),f=new dde(new d3e(r.getProvider("auth-internal")),new m3e(r.getProvider("app-check-internal")),function(g,E){if(!Object.prototype.hasOwnProperty.apply(g.options,["projectId"]))throw new tr(tn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Jue(g.options.projectId,E)}(d,a),d);return u=Object.assign({useFetchStreams:e},u),f._setSettings(u),f},"PUBLIC").setMultipleInstances(!0)),xg(Uee,"4.7.3",t),xg(Uee,"4.7.3","esm2017")})(),typeof SuppressedError=="function"&&SuppressedError;var k$e=mde,Jj=new nI("auth","Firebase",mde()),yT=new j5("@firebase/auth");function O$e(t){if(yT.logLevel<=ai.WARN){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];yT.warn.apply(yT,["Auth (".concat(r0,"): ").concat(t)].concat(r))}}function EN(t){if(yT.logLevel<=ai.ERROR){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];yT.error.apply(yT,["Auth (".concat(r0,"): ").concat(t)].concat(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];throw u6.apply(void 0,[t].concat(r))}function If(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];return u6.apply(void 0,[t].concat(r))}function gde(t,e,r){var o=Object.assign(Object.assign({},k$e()),Lt({},e,r));return new nI("auth","Firebase",o).create(e,{appName:t.name})}function sy(t){return gde(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function u6(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];if(typeof t!="string"){var a,u=r[0],d=Ps(r.slice(1));return d[0]&&(d[0].appName=t.name),(a=t._errorFactory).create.apply(a,[u].concat(Ps(d)))}return Jj.create.apply(Jj,[t].concat(r))}function Nn(t,e){if(!t){for(var r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];throw u6.apply(void 0,[e].concat(o))}}function hf(t){var e="INTERNAL ASSERTION FAILED: "+t;throw EN(e),new Error(e)}function rm(t,e){t||hf(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qj(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Tte(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P$e(){return typeof navigator>"u"||!navigator||!("onLine"in navigator)||typeof navigator.onLine!="boolean"||Tte()!=="http:"&&Tte()!=="https:"&&(t=(typeof chrome>"u"?"undefined":vo(chrome))==="object"?chrome.runtime:(typeof browser>"u"?"undefined":vo(browser))==="object"?browser.runtime:void 0,vo(t)!=="object"||t.id===void 0)&&!("connection"in navigator)||navigator.onLine;var t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var aI=function(){return Me(function t(e,r){xe(this,t),this.shortDelay=e,this.longDelay=r,rm(r>e,"Short delay should be less than long delay!"),this.isMobile=typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($c())||(typeof navigator>"u"?"undefined":vo(navigator))==="object"&&navigator.product==="ReactNative"},[{key:"get",value:function(){return P$e()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}])}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l6(t,e){rm(t.emulator,"Emulator should always be set here");var r=t.emulator.url;return e?"".concat(r).concat(e.startsWith("/")?e.slice(1):e):r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vde=function(){return Me(function t(){xe(this,t)},null,[{key:"initialize",value:function(t,e,r){this.fetchImpl=t,e&&(this.headersImpl=e),r&&(this.responseImpl=r)}},{key:"fetch",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void hf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")})},{key:"headers",value:function(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void hf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}},{key:"response",value:function(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void hf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}])}(),N$e=(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(qw={},"CREDENTIAL_MISMATCH","custom-token-mismatch"),"MISSING_CUSTOM_TOKEN","internal-error"),"INVALID_IDENTIFIER","invalid-email"),"MISSING_CONTINUE_URI","internal-error"),"INVALID_PASSWORD","wrong-password"),"MISSING_PASSWORD","missing-password"),"INVALID_LOGIN_CREDENTIALS","invalid-credential"),"EMAIL_EXISTS","email-already-in-use"),"PASSWORD_LOGIN_DISABLED","operation-not-allowed"),"INVALID_IDP_RESPONSE","invalid-credential"),Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(qw,"INVALID_PENDING_TOKEN","invalid-credential"),"FEDERATED_USER_ID_ALREADY_LINKED","credential-already-in-use"),"MISSING_REQ_TYPE","internal-error"),"EMAIL_NOT_FOUND","user-not-found"),"RESET_PASSWORD_EXCEED_LIMIT","too-many-requests"),"EXPIRED_OOB_CODE","expired-action-code"),"INVALID_OOB_CODE","invalid-action-code"),"MISSING_OOB_CODE","internal-error"),"CREDENTIAL_TOO_OLD_LOGIN_AGAIN","requires-recent-login"),"INVALID_ID_TOKEN","invalid-user-token"),Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(qw,"TOKEN_EXPIRED","user-token-expired"),"USER_NOT_FOUND","user-token-expired"),"TOO_MANY_ATTEMPTS_TRY_LATER","too-many-requests"),"PASSWORD_DOES_NOT_MEET_REQUIREMENTS","password-does-not-meet-requirements"),"INVALID_CODE","invalid-verification-code"),"INVALID_SESSION_INFO","invalid-verification-id"),"INVALID_TEMPORARY_PROOF","invalid-credential"),"MISSING_SESSION_INFO","missing-verification-id"),"SESSION_EXPIRED","code-expired"),"MISSING_ANDROID_PACKAGE_NAME","missing-android-pkg-name"),Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(qw,"UNAUTHORIZED_DOMAIN","unauthorized-continue-uri"),"INVALID_OAUTH_CLIENT_ID","invalid-oauth-client-id"),"ADMIN_ONLY_OPERATION","admin-restricted-operation"),"INVALID_MFA_PENDING_CREDENTIAL","invalid-multi-factor-session"),"MFA_ENROLLMENT_NOT_FOUND","multi-factor-info-not-found"),"MISSING_MFA_ENROLLMENT_ID","missing-multi-factor-info"),"MISSING_MFA_PENDING_CREDENTIAL","missing-multi-factor-session"),"SECOND_FACTOR_EXISTS","second-factor-already-in-use"),"SECOND_FACTOR_LIMIT_EXCEEDED","maximum-second-factor-count-exceeded"),"BLOCKING_FUNCTION_ERROR_RESPONSE","internal-error"),Lt(Lt(Lt(Lt(Lt(Lt(Lt(Lt(qw,"RECAPTCHA_NOT_ENABLED","recaptcha-not-enabled"),"MISSING_RECAPTCHA_TOKEN","missing-recaptcha-token"),"INVALID_RECAPTCHA_TOKEN","invalid-recaptcha-token"),"INVALID_RECAPTCHA_ACTION","invalid-recaptcha-action"),"MISSING_CLIENT_TYPE","missing-client-type"),"MISSING_RECAPTCHA_VERSION","missing-recaptcha-version"),"INVALID_RECAPTCHA_VERSION","invalid-recaptcha-version"),"INVALID_REQ_TYPE","invalid-req-type")),D$e=new aI(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ba(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}function Yc(t,e,r,o){return Zj.apply(this,arguments)}function Zj(){return Zj=Ue(ue().mark(function t(e,r,o,a){var u,d=arguments;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return u=d.length>4&&d[4]!==void 0?d[4]:{},f.abrupt("return",_de(e,u,Ue(ue().mark(function g(){var E,T,C,I,D;return ue().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return E={},T={},a&&(r==="GET"?T=a:E={body:JSON.stringify(a)}),C=rI(Object.assign({key:e.config.apiKey},T)).slice(1),L.next=6,e._getAdditionalHeaders();case 6:return(I=L.sent)["Content-Type"]="application/json",e.languageCode&&(I["X-Firebase-Locale"]=e.languageCode),D=Object.assign({method:r,headers:I},E),typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||(D.referrerPolicy="no-referrer"),L.abrupt("return",vde.fetch()(Ede(e,e.config.apiHost,o,C),D));case 12:case"end":return L.stop()}},g)}))));case 2:case"end":return f.stop()}},t)})),Zj.apply(this,arguments)}function _de(t,e,r){return yde.apply(this,arguments)}function yde(){return(yde=Ue(ue().mark(function t(e,r,o){var a,u,d,f,g,E,T,C,I,D;return ue().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return e._canInitEmulator=!1,a=Object.assign(Object.assign({},N$e),r),L.prev=2,u=new x$e(e),L.next=6,Promise.race([o(),u.promise]);case 6:return d=L.sent,u.clearNetworkTimeout(),L.next=10,d.json();case 10:if(!("needConfirmation"in(f=L.sent))){L.next=13;break}throw mC(e,"account-exists-with-different-credential",f);case 13:if(!d.ok||"errorMessage"in f){L.next=17;break}return L.abrupt("return",f);case 17:if(g=d.ok?f.errorMessage:f.error.message,E=g.split(" : "),T=Gr(E,2),C=T[0],I=T[1],C!=="FEDERATED_USER_ID_ALREADY_LINKED"){L.next=23;break}throw mC(e,"credential-already-in-use",f);case 23:if(C!=="EMAIL_EXISTS"){L.next=27;break}throw mC(e,"email-already-in-use",f);case 27:if(C!=="USER_DISABLED"){L.next=29;break}throw mC(e,"user-disabled",f);case 29:if(D=a[C]||C.toLowerCase().replace(/[_\s]+/g,"-"),!I){L.next=34;break}throw gde(e,D,I);case 34:ph(e,D);case 35:L.next=42;break;case 37:if(L.prev=37,L.t0=L.catch(2),!(L.t0 instanceof ky)){L.next=41;break}throw L.t0;case 41:ph(e,"network-request-failed",{message:String(L.t0)});case 42:case"end":return L.stop()}},t,null,[[2,37]])}))).apply(this,arguments)}function Oy(t,e,r,o){return eB.apply(this,arguments)}function eB(){return eB=Ue(ue().mark(function t(e,r,o,a){var u,d,f=arguments;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return u=f.length>4&&f[4]!==void 0?f[4]:{},g.next=3,Yc(e,r,o,a,u);case 3:return"mfaPendingCredential"in(d=g.sent)&&ph(e,"multi-factor-auth-required",{_serverResponse:d}),g.abrupt("return",d);case 6:case"end":return g.stop()}},t)})),eB.apply(this,arguments)}function Ede(t,e,r,o){var a="".concat(e).concat(r,"?").concat(o);return t.config.emulator?l6(t.config,a):"".concat(t.config.apiScheme,"://").concat(a)}function L$e(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var x$e=function(){return Me(function t(e){var r=this;xe(this,t),this.auth=e,this.timer=null,this.promise=new Promise(function(o,a){r.timer=setTimeout(function(){return a(If(r.auth,"network-request-failed"))},D$e.get())})},[{key:"clearNetworkTimeout",value:function(){clearTimeout(this.timer)}}])}();function mC(t,e,r){var o={appName:t.name};r.email&&(o.email=r.email),r.phoneNumber&&(o.phoneNumber=r.phoneNumber);var a=If(t,e,o);return a.customData._tokenResponse=r,a}function bte(t){return t!==void 0&&t.enterprise!==void 0}var M$e=function(){return Me(function t(e){if(xe(this,t),this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState},[{key:"getProviderEnforcementState",value:function(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;var e,r=pn(this.recaptchaEnforcementState);try{for(r.s();!(e=r.n()).done;){var o=e.value;if(o.provider&&o.provider===t)return L$e(o.enforcementState)}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"isProviderEnabled",value:function(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}}])}();function U$e(t,e){return Sde.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sde(){return(Sde=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Yc(e,"GET","/v2/recaptchaConfig",Ba(e,r)));case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}function V$e(t,e){return Tde.apply(this,arguments)}function Tde(){return(Tde=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Yc(e,"POST","/v1/accounts:delete",r));case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}function bde(t,e){return wde.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wde(){return(wde=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Yc(e,"POST","/v1/accounts:lookup",r));case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}function VC(t){if(t)try{var e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function tB(){return tB=Ue(ue().mark(function t(e){var r,o,a,u,d,f,g=arguments;return ue().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return r=g.length>1&&g[1]!==void 0&&g[1],o=Gg(e),E.next=4,o.getIdToken(r);case 4:return a=E.sent,Nn((u=d6(a))&&u.exp&&u.auth_time&&u.iat,o.auth,"internal-error"),d=vo(u.firebase)==="object"?u.firebase:void 0,f=d==null?void 0:d.sign_in_provider,E.abrupt("return",{claims:u,token:a,authTime:VC(z2(u.auth_time)),issuedAtTime:VC(z2(u.iat)),expirationTime:VC(z2(u.exp)),signInProvider:f||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null});case 10:case"end":return E.stop()}},t)})),tB.apply(this,arguments)}function z2(t){return 1e3*Number(t)}function d6(t){var e=Gr(t.split("."),3),r=e[0],o=e[1],a=e[2];if(r===void 0||o===void 0||a===void 0)return EN("JWT malformed, contained fewer than 3 sections"),null;try{var u=Oue(o);return u?JSON.parse(u):(EN("Failed to decode base64 JWT payload"),null)}catch(d){return EN("Caught error parsing JWT payload as JSON",d==null?void 0:d.toString()),null}}function wte(t){var e=d6(t);return Nn(e,"internal-error"),Nn(e.exp!==void 0,"internal-error"),Nn(e.iat!==void 0,"internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SR(t,e){return nB.apply(this,arguments)}function nB(){return nB=Ue(ue().mark(function t(e,r){var o=arguments;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!(o.length>2&&o[2]!==void 0&&o[2])){a.next=3;break}return a.abrupt("return",r);case 3:return a.prev=3,a.next=6,r;case 6:return a.abrupt("return",a.sent);case 9:if(a.prev=9,a.t0=a.catch(3),!(a.t0 instanceof ky&&(u=a.t0,d=void 0,d=u.code,d==="auth/".concat("user-disabled")||d==="auth/".concat("user-token-expired")))){a.next=15;break}if(e.auth.currentUser!==e){a.next=15;break}return a.next=15,e.auth.signOut();case 15:throw a.t0;case 16:case"end":return a.stop()}var u,d;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */},t,null,[[3,9]])})),nB.apply(this,arguments)}var F$e=function(){return Me(function e(r){xe(this,e),this.user=r,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4},[{key:"_start",value:function(){this.isRunning||(this.isRunning=!0,this.schedule())}},{key:"_stop",value:function(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}},{key:"getInterval",value:function(e){var r;if(e){var o=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),o}this.errorBackoff=3e4;var a=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,a)}},{key:"schedule",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isRunning){var o=this.getInterval(r);this.timerId=setTimeout(Ue(ue().mark(function a(){return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,e.iteration();case 2:case"end":return u.stop()}},a)})),o)}}},{key:"iteration",value:(t=Ue(ue().mark(function e(){return ue().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.user.getIdToken(!0);case 3:r.next=9;break;case 5:return r.prev=5,r.t0=r.catch(0),(r.t0===null||r.t0===void 0?void 0:r.t0.code)==="auth/".concat("network-request-failed")&&this.schedule(!0),r.abrupt("return");case 9:this.schedule();case 10:case"end":return r.stop()}},e,this,[[0,5]])})),function(){return t.apply(this,arguments)})}]);var t}(),rB=function(){return Me(function t(e,r){xe(this,t),this.createdAt=e,this.lastLoginAt=r,this._initializeTime()},[{key:"_initializeTime",value:function(){this.lastSignInTime=VC(this.lastLoginAt),this.creationTime=VC(this.createdAt)}},{key:"_copy",value:function(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}},{key:"toJSON",value:function(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}])}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y1(t){return Cde.apply(this,arguments)}function Cde(){return(Cde=Ue(ue().mark(function t(e){var r,o,a,u,d,f,g,E,T,C,I;return ue().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return o=e.auth,D.next=3,e.getIdToken();case 3:return a=D.sent,D.next=6,SR(e,bde(o,{idToken:a}));case 6:Nn((u=D.sent)==null?void 0:u.users.length,o,"internal-error"),d=u.users[0],e._notifyReloadListener(d),f=!((r=d.providerUserInfo)===null||r===void 0)&&r.length?Ide(d.providerUserInfo):[],g=j$e(e.providerData,f),E=e.isAnonymous,T=!(e.email&&d.passwordHash||g!=null&&g.length),C=!!E&&T,I={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:g,metadata:new rB(d.createdAt,d.lastLoginAt),isAnonymous:C},Object.assign(e,I);case 17:case"end":return D.stop()}},t)}))).apply(this,arguments)}function Rde(){return(Rde=Ue(ue().mark(function t(e){var r;return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return r=Gg(e),o.next=3,y1(r);case 3:return o.next=5,r.auth._persistUserIfCurrent(r);case 5:r.auth._notifyListenersIfCurrent(r);case 6:case"end":return o.stop()}},t)}))).apply(this,arguments)}function j$e(t,e){var r=t.filter(function(o){return!e.some(function(a){return a.providerId===o.providerId})});return[].concat(Ps(r),Ps(e))}function Ide(t){return t.map(function(e){var r=e.providerId,o=c6(e,["providerId"]);return{providerId:r,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B$e(t,e){return Ade.apply(this,arguments)}function Ade(){return(Ade=Ue(ue().mark(function t(e,r){var o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,_de(e,{},Ue(ue().mark(function u(){var d,f,g,E,T,C;return ue().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return d=rI({grant_type:"refresh_token",refresh_token:r}).slice(1),f=e.config,g=f.tokenApiHost,E=f.apiKey,T=Ede(e,g,"/v1/token","key=".concat(E)),I.next=5,e._getAdditionalHeaders();case 5:return(C=I.sent)["Content-Type"]="application/x-www-form-urlencoded",I.abrupt("return",vde.fetch()(T,{method:"POST",headers:C,body:d}));case 8:case"end":return I.stop()}},u)})));case 2:return o=a.sent,a.abrupt("return",{accessToken:o.access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token});case 4:case"end":return a.stop()}},t)}))).apply(this,arguments)}function W$e(t,e){return kde.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kde(){return(kde=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Yc(e,"POST","/v2/accounts:revokeToken",Ba(e,r)));case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}var G2=function(){function t(){xe(this,t),this.refreshToken=null,this.accessToken=null,this.expirationTime=null}return Me(t,[{key:"isExpired",get:function(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}},{key:"updateFromServerResponse",value:function(o){Nn(o.idToken,"internal-error"),Nn(o.idToken!==void 0,"internal-error"),Nn(o.refreshToken!==void 0,"internal-error");var a="expiresIn"in o&&o.expiresIn!==void 0?Number(o.expiresIn):wte(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}},{key:"updateFromIdToken",value:function(o){Nn(o.length!==0,"internal-error");var a=wte(o);this.updateTokensAndExpiration(o,null,a)}},{key:"getToken",value:(r=Ue(ue().mark(function o(a){var u=arguments;return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(u.length>1&&u[1]!==void 0&&u[1]||!this.accessToken||this.isExpired){d.next=3;break}return d.abrupt("return",this.accessToken);case 3:if(Nn(this.refreshToken,a,"user-token-expired"),!this.refreshToken){d.next=8;break}return d.next=7,this.refresh(a,this.refreshToken);case 7:return d.abrupt("return",this.accessToken);case 8:return d.abrupt("return",null);case 9:case"end":return d.stop()}},o,this)})),function(o){return r.apply(this,arguments)})},{key:"clearRefreshToken",value:function(){this.refreshToken=null}},{key:"refresh",value:(e=Ue(ue().mark(function o(a,u){var d,f,g,E;return ue().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,B$e(a,u);case 2:d=T.sent,f=d.accessToken,g=d.refreshToken,E=d.expiresIn,this.updateTokensAndExpiration(f,g,Number(E));case 7:case"end":return T.stop()}},o,this)})),function(o,a){return e.apply(this,arguments)})},{key:"updateTokensAndExpiration",value:function(o,a,u){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*u}},{key:"toJSON",value:function(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}},{key:"_assign",value:function(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}},{key:"_clone",value:function(){return Object.assign(new t,this.toJSON())}},{key:"_performRefresh",value:function(){return hf("not implemented")}}],[{key:"fromJSON",value:function(o,a){var u=a.refreshToken,d=a.accessToken,f=a.expirationTime,g=new t;return u&&(Nn(typeof u=="string","internal-error",{appName:o}),g.refreshToken=u),d&&(Nn(typeof d=="string","internal-error",{appName:o}),g.accessToken=d),f&&(Nn(typeof f=="number","internal-error",{appName:o}),g.expirationTime=f),g}}]);var e,r}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fg(t,e){Nn(typeof t=="string"||t===void 0,"internal-error",{appName:e})}var E1=function(){function t(d){xe(this,t);var f=d.uid,g=d.auth,E=d.stsTokenManager,T=c6(d,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new F$e(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=f,this.auth=g,this.stsTokenManager=E,this.accessToken=E.accessToken,this.displayName=T.displayName||null,this.email=T.email||null,this.emailVerified=T.emailVerified||!1,this.phoneNumber=T.phoneNumber||null,this.photoURL=T.photoURL||null,this.isAnonymous=T.isAnonymous||!1,this.tenantId=T.tenantId||null,this.providerData=T.providerData?Ps(T.providerData):[],this.metadata=new rB(T.createdAt||void 0,T.lastLoginAt||void 0)}return Me(t,[{key:"getIdToken",value:(u=Ue(ue().mark(function d(f){var g;return ue().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,SR(this,this.stsTokenManager.getToken(this.auth,f));case 2:if(Nn(g=E.sent,this.auth,"internal-error"),this.accessToken===g){E.next=9;break}return this.accessToken=g,E.next=8,this.auth._persistUserIfCurrent(this);case 8:this.auth._notifyListenersIfCurrent(this);case 9:return E.abrupt("return",g);case 10:case"end":return E.stop()}},d,this)})),function(d){return u.apply(this,arguments)})},{key:"getIdTokenResult",value:function(d){return function(f){return tB.apply(this,arguments)}(this,d)}},{key:"reload",value:function(){return function(d){return Rde.apply(this,arguments)}(this)}},{key:"_assign",value:function(d){this!==d&&(Nn(this.uid===d.uid,this.auth,"internal-error"),this.displayName=d.displayName,this.photoURL=d.photoURL,this.email=d.email,this.emailVerified=d.emailVerified,this.phoneNumber=d.phoneNumber,this.isAnonymous=d.isAnonymous,this.tenantId=d.tenantId,this.providerData=d.providerData.map(function(f){return Object.assign({},f)}),this.metadata._copy(d.metadata),this.stsTokenManager._assign(d.stsTokenManager))}},{key:"_clone",value:function(d){var f=new t(Object.assign(Object.assign({},this),{auth:d,stsTokenManager:this.stsTokenManager._clone()}));return f.metadata._copy(this.metadata),f}},{key:"_onReload",value:function(d){Nn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=d,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}},{key:"_notifyReloadListener",value:function(d){this.reloadListener?this.reloadListener(d):this.reloadUserInfo=d}},{key:"_startProactiveRefresh",value:function(){this.proactiveRefresh._start()}},{key:"_stopProactiveRefresh",value:function(){this.proactiveRefresh._stop()}},{key:"_updateTokensIfNecessary",value:(a=Ue(ue().mark(function d(f){var g,E,T=arguments;return ue().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(g=T.length>1&&T[1]!==void 0&&T[1],E=!1,f.idToken&&f.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(f),E=!0),!g){C.next=6;break}return C.next=6,y1(this);case 6:return C.next=8,this.auth._persistUserIfCurrent(this);case 8:E&&this.auth._notifyListenersIfCurrent(this);case 9:case"end":return C.stop()}},d,this)})),function(d){return a.apply(this,arguments)})},{key:"delete",value:(o=Ue(ue().mark(function d(){var f;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!Cg(this.auth.app)){g.next=2;break}return g.abrupt("return",Promise.reject(sy(this.auth)));case 2:return g.next=4,this.getIdToken();case 4:return f=g.sent,g.next=7,SR(this,V$e(this.auth,{idToken:f}));case 7:return this.stsTokenManager.clearRefreshToken(),g.abrupt("return",this.auth.signOut());case 9:case"end":return g.stop()}},d,this)})),function(){return o.apply(this,arguments)})},{key:"toJSON",value:function(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(function(d){return Object.assign({},d)}),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}},{key:"refreshToken",get:function(){return this.stsTokenManager.refreshToken||""}}],[{key:"_fromJSON",value:function(d,f){var g,E,T,C,I,D,L,B,G=(g=f.displayName)!==null&&g!==void 0?g:void 0,se=(E=f.email)!==null&&E!==void 0?E:void 0,ae=(T=f.phoneNumber)!==null&&T!==void 0?T:void 0,M=(C=f.photoURL)!==null&&C!==void 0?C:void 0,F=(I=f.tenantId)!==null&&I!==void 0?I:void 0,z=(D=f._redirectEventId)!==null&&D!==void 0?D:void 0,te=(L=f.createdAt)!==null&&L!==void 0?L:void 0,j=(B=f.lastLoginAt)!==null&&B!==void 0?B:void 0,K=f.uid,Q=f.emailVerified,ce=f.isAnonymous,Ee=f.providerData,_e=f.stsTokenManager;Nn(K&&_e,d,"internal-error");var pe=G2.fromJSON(this.name,_e);Nn(typeof K=="string",d,"internal-error"),fg(G,d.name),fg(se,d.name),Nn(typeof Q=="boolean",d,"internal-error"),Nn(typeof ce=="boolean",d,"internal-error"),fg(ae,d.name),fg(M,d.name),fg(F,d.name),fg(z,d.name),fg(te,d.name),fg(j,d.name);var qe=new t({uid:K,auth:d,email:se,emailVerified:Q,displayName:G,isAnonymous:ce,photoURL:M,phoneNumber:ae,tenantId:F,stsTokenManager:pe,createdAt:te,lastLoginAt:j});return Ee&&Array.isArray(Ee)&&(qe.providerData=Ee.map(function(St){return Object.assign({},St)})),z&&(qe._redirectEventId=z),qe}},{key:"_fromIdTokenResponse",value:(r=Ue(ue().mark(function d(f,g){var E,T,C,I=arguments;return ue().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return E=I.length>2&&I[2]!==void 0&&I[2],(T=new G2).updateFromServerResponse(g),C=new t({uid:g.localId,auth:f,stsTokenManager:T,isAnonymous:E}),D.next=6,y1(C);case 6:return D.abrupt("return",C);case 7:case"end":return D.stop()}},d)})),function(d,f){return r.apply(this,arguments)})},{key:"_fromGetAccountInfoResponse",value:(e=Ue(ue().mark(function d(f,g,E){var T,C,I,D,L,B;return ue().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return Nn((T=g.users[0]).localId!==void 0,"internal-error"),C=T.providerUserInfo!==void 0?Ide(T.providerUserInfo):[],I=!(T.email&&T.passwordHash||C!=null&&C.length),(D=new G2).updateFromIdToken(E),L=new t({uid:T.localId,auth:f,stsTokenManager:D,isAnonymous:I}),B={uid:T.localId,displayName:T.displayName||null,photoURL:T.photoUrl||null,email:T.email||null,emailVerified:T.emailVerified||!1,phoneNumber:T.phoneNumber||null,tenantId:T.tenantId||null,providerData:C,metadata:new rB(T.createdAt,T.lastLoginAt),isAnonymous:!(T.email&&T.passwordHash||C!=null&&C.length)},Object.assign(L,B),G.abrupt("return",L);case 10:case"end":return G.stop()}},d)})),function(d,f,g){return e.apply(this,arguments)})}]);var e,r,o,a,u}(),Cte=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Up(t){rm(t instanceof Function,"Expected a class definition");var e=Cte.get(t);return e?(rm(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Cte.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ode=function(){return Me(function a(){xe(this,a),this.type="NONE",this.storage={}},[{key:"_isAvailable",value:(o=Ue(ue().mark(function a(){return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",!0);case 1:case"end":return u.stop()}},a)})),function(){return o.apply(this,arguments)})},{key:"_set",value:(r=Ue(ue().mark(function a(u,d){return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:this.storage[u]=d;case 1:case"end":return f.stop()}},a,this)})),function(a,u){return r.apply(this,arguments)})},{key:"_get",value:(e=Ue(ue().mark(function a(u){var d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return d=this.storage[u],f.abrupt("return",d===void 0?null:d);case 2:case"end":return f.stop()}},a,this)})),function(a){return e.apply(this,arguments)})},{key:"_remove",value:(t=Ue(ue().mark(function a(u){return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:delete this.storage[u];case 1:case"end":return d.stop()}},a,this)})),function(a){return t.apply(this,arguments)})},{key:"_addListener",value:function(a,u){}},{key:"_removeListener",value:function(a,u){}}]);var t,e,r,o}();Ode.type="NONE";var Rte=Ode;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SN(t,e,r){return"firebase".concat(":",t,":").concat(e,":").concat(r)}var Ite=function(){function t(a,u,d){xe(this,t),this.persistence=a,this.auth=u,this.userKey=d;var f=this.auth,g=f.config,E=f.name;this.fullUserKey=SN(this.userKey,g.apiKey,E),this.fullPersistenceKey=SN("persistence",g.apiKey,E),this.boundEventHandler=u._onStorageEvent.bind(u),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}return Me(t,[{key:"setCurrentUser",value:function(a){return this.persistence._set(this.fullUserKey,a.toJSON())}},{key:"getCurrentUser",value:(o=Ue(ue().mark(function a(){var u;return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.persistence._get(this.fullUserKey);case 2:return u=d.sent,d.abrupt("return",u?E1._fromJSON(this.auth,u):null);case 4:case"end":return d.stop()}},a,this)})),function(){return o.apply(this,arguments)})},{key:"removeCurrentUser",value:function(){return this.persistence._remove(this.fullUserKey)}},{key:"savePersistenceForRedirect",value:function(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}},{key:"setPersistence",value:(r=Ue(ue().mark(function a(u){var d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.persistence!==u){f.next=2;break}return f.abrupt("return");case 2:return f.next=4,this.getCurrentUser();case 4:return d=f.sent,f.next=7,this.removeCurrentUser();case 7:if(this.persistence=u,!d){f.next=10;break}return f.abrupt("return",this.setCurrentUser(d));case 10:case"end":return f.stop()}},a,this)})),function(a){return r.apply(this,arguments)})},{key:"delete",value:function(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}}],[{key:"create",value:(e=Ue(ue().mark(function a(u,d){var f,g,E,T,C,I,D,L,B,G,se,ae=arguments;return ue().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(f=ae.length>2&&ae[2]!==void 0?ae[2]:"authUser",d.length){M.next=3;break}return M.abrupt("return",new t(Up(Rte),u,f));case 3:return M.next=5,Promise.all(d.map(function(){var F=Ue(ue().mark(function z(te){return ue().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,te._isAvailable();case 2:if(!j.sent){j.next=4;break}return j.abrupt("return",te);case 4:return j.abrupt("return",void 0);case 5:case"end":return j.stop()}},z)}));return function(z){return F.apply(this,arguments)}}()));case 5:g=M.sent.filter(function(F){return F}),E=g[0]||Up(Rte),T=SN(f,u.config.apiKey,u.name),C=null,I=pn(d),M.prev=10,I.s();case 12:if((D=I.n()).done){M.next=29;break}return L=D.value,M.prev=14,M.next=17,L._get(T);case 17:if(!(B=M.sent)){M.next=23;break}return G=E1._fromJSON(u,B),L!==E&&(C=G),E=L,M.abrupt("break",29);case 23:M.next=27;break;case 25:M.prev=25,M.t0=M.catch(14);case 27:M.next=12;break;case 29:M.next=34;break;case 31:M.prev=31,M.t1=M.catch(10),I.e(M.t1);case 34:return M.prev=34,I.f(),M.finish(34);case 37:if(se=g.filter(function(F){return F._shouldAllowMigration}),E._shouldAllowMigration&&se.length){M.next=40;break}return M.abrupt("return",new t(E,u,f));case 40:if(E=se[0],!C){M.next=44;break}return M.next=44,E._set(T,C.toJSON());case 44:return M.next=46,Promise.all(d.map(function(){var F=Ue(ue().mark(function z(te){return ue().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(te===E){j.next=8;break}return j.prev=1,j.next=4,te._remove(T);case 4:j.next=8;break;case 6:j.prev=6,j.t0=j.catch(1);case 8:case"end":return j.stop()}},z,null,[[1,6]])}));return function(z){return F.apply(this,arguments)}}()));case 46:return M.abrupt("return",new t(E,u,f));case 47:case"end":return M.stop()}},a,null,[[10,31,34,37],[14,25]])})),function(a,u){return e.apply(this,arguments)})}]);var e,r,o}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ate(t){var e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Lde(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Pde(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Mde(e))return"Blackberry";if(Ude(e))return"Webos";if(Nde(e))return"Safari";if((e.includes("chrome/")||Dde(e))&&!e.includes("edge/"))return"Chrome";if(xde(e))return"Android";var r=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return(r==null?void 0:r.length)===2?r[1]:"Other"}function Pde(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$c();return/firefox\//i.test(t)}function Nde(){var t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:$c()).toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Dde(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$c();return/crios\//i.test(t)}function Lde(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$c();return/iemobile/i.test(t)}function xde(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$c();return/android/i.test(t)}function Mde(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$c();return/blackberry/i.test(t)}function Ude(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$c();return/webos/i.test(t)}function h6(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$c();return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function z$e(){return((t=$c()).indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0)&&document.documentMode===10;var t}function Vde(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$c();return h6(t)||xde(t)||Ude(t)||Mde(t)||/windows phone/i.test(t)||Lde(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fde(t){var e,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];switch(t){case"Browser":e=Ate($c());break;case"Worker":e="".concat(Ate($c()),"-").concat(t);break;default:e=t}var o=r.length?r.join(","):"FirebaseCore-web";return"".concat(e,"/","JsCore","/").concat(r0,"/").concat(o)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var G$e=function(){return Me(function e(r){xe(this,e),this.auth=r,this.queue=[]},[{key:"pushCallback",value:function(e,r){var o=this,a=function(d){return new Promise(function(f,g){try{f(e(d))}catch(E){g(E)}})};a.onAbort=r,this.queue.push(a);var u=this.queue.length-1;return function(){o.queue[u]=function(){return Promise.resolve()}}}},{key:"runMiddleware",value:(t=Ue(ue().mark(function e(r){var o,a,u,d,f,g,E;return ue().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(this.auth.currentUser!==r){T.next=2;break}return T.abrupt("return");case 2:o=[],T.prev=3,a=pn(this.queue),T.prev=5,a.s();case 7:if((u=a.n()).done){T.next=14;break}return d=u.value,T.next=11,d(r);case 11:d.onAbort&&o.push(d.onAbort);case 12:T.next=7;break;case 14:T.next=19;break;case 16:T.prev=16,T.t0=T.catch(5),a.e(T.t0);case 19:return T.prev=19,a.f(),T.finish(19);case 22:T.next=30;break;case 24:T.prev=24,T.t1=T.catch(3),o.reverse(),f=pn(o);try{for(f.s();!(g=f.n()).done;){E=g.value;try{E()}catch{}}}catch(C){f.e(C)}finally{f.f()}throw this.auth._errorFactory.create("login-blocked",{originalMessage:T.t1===null||T.t1===void 0?void 0:T.t1.message});case 30:case"end":return T.stop()}},e,this,[[3,24],[5,16,19,22]])})),function(e){return t.apply(this,arguments)})}]);var t}();/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H$e(t){return iB.apply(this,arguments)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iB(){return iB=Ue(ue().mark(function t(e){var r,o=arguments;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r=o.length>1&&o[1]!==void 0?o[1]:{},a.abrupt("return",Yc(e,"GET","/v2/passwordPolicy",Ba(e,r)));case 2:case"end":return a.stop()}},t)})),iB.apply(this,arguments)}var K$e=function(){return Me(function t(e){var r,o,a,u;xe(this,t);var d=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=d.minPasswordLength)!==null&&r!==void 0?r:6,d.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=d.maxPasswordLength),d.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=d.containsLowercaseCharacter),d.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=d.containsUppercaseCharacter),d.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=d.containsNumericCharacter),d.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=d.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(a=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&a!==void 0?a:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0&&u,this.schemaVersion=e.schemaVersion},[{key:"validatePassword",value:function(t){var e,r,o,a,u,d,f={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,f),this.validatePasswordCharacterOptions(t,f),f.isValid&&(f.isValid=(e=f.meetsMinPasswordLength)===null||e===void 0||e),f.isValid&&(f.isValid=(r=f.meetsMaxPasswordLength)===null||r===void 0||r),f.isValid&&(f.isValid=(o=f.containsLowercaseLetter)===null||o===void 0||o),f.isValid&&(f.isValid=(a=f.containsUppercaseLetter)===null||a===void 0||a),f.isValid&&(f.isValid=(u=f.containsNumericCharacter)===null||u===void 0||u),f.isValid&&(f.isValid=(d=f.containsNonAlphanumericCharacter)===null||d===void 0||d),f}},{key:"validatePasswordLengthOptions",value:function(t,e){var r=this.customStrengthOptions.minPasswordLength,o=this.customStrengthOptions.maxPasswordLength;r&&(e.meetsMinPasswordLength=t.length>=r),o&&(e.meetsMaxPasswordLength=t.length<=o)}},{key:"validatePasswordCharacterOptions",value:function(t,e){var r;this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);for(var o=0;o<t.length;o++)r=t.charAt(o),this.updatePasswordCharacterOptionsStatuses(e,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}},{key:"updatePasswordCharacterOptionsStatuses",value:function(t,e,r,o,a){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=o)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=a))}}])}(),q$e=function(){return Me(function M(F,z,te,j){xe(this,M),this.app=F,this.heartbeatServiceProvider=z,this.appCheckServiceProvider=te,this.config=j,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new kte(this),this.idTokenSubscription=new kte(this),this.beforeStateQueue=new G$e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Jj,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=F.name,this.clientVersion=j.sdkClientVersion},[{key:"_initializeWithPersistence",value:function(M,F){var z=this;return F&&(this._popupRedirectResolver=Up(F)),this._initializationPromise=this.queue(Ue(ue().mark(function te(){var j,K;return ue().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(!z._deleted){Q.next=2;break}return Q.abrupt("return");case 2:return Q.next=4,Ite.create(z,M);case 4:if(z.persistenceManager=Q.sent,!z._deleted){Q.next=7;break}return Q.abrupt("return");case 7:if(!(!((j=z._popupRedirectResolver)===null||j===void 0)&&j._shouldInitProactively)){Q.next=15;break}return Q.prev=8,Q.next=11,z._popupRedirectResolver._initialize(z);case 11:Q.next=15;break;case 13:Q.prev=13,Q.t0=Q.catch(8);case 15:return Q.next=17,z.initializeCurrentUser(F);case 17:if(z.lastNotifiedUid=((K=z.currentUser)===null||K===void 0?void 0:K.uid)||null,!z._deleted){Q.next=20;break}return Q.abrupt("return");case 20:z._isInitialized=!0;case 21:case"end":return Q.stop()}},te,null,[[8,13]])}))),this._initializationPromise}},{key:"_onStorageEvent",value:(ae=Ue(ue().mark(function M(){var F;return ue().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(!this._deleted){z.next=2;break}return z.abrupt("return");case 2:return z.next=4,this.assertedPersistence.getCurrentUser();case 4:if(F=z.sent,this.currentUser||F){z.next=7;break}return z.abrupt("return");case 7:if(!this.currentUser||!F||this.currentUser.uid!==F.uid){z.next=12;break}return this._currentUser._assign(F),z.next=11,this.currentUser.getIdToken();case 11:return z.abrupt("return");case 12:return z.next=14,this._updateCurrentUser(F,!0);case 14:case"end":return z.stop()}},M,this)})),function(){return ae.apply(this,arguments)})},{key:"initializeCurrentUserFromIdToken",value:(se=Ue(ue().mark(function M(F){var z,te;return ue().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.prev=0,j.next=3,bde(this,{idToken:F});case 3:return z=j.sent,j.next=6,E1._fromGetAccountInfoResponse(this,z,F);case 6:return te=j.sent,j.next=9,this.directlySetCurrentUser(te);case 9:j.next=16;break;case 11:return j.prev=11,j.t0=j.catch(0),console.warn("FirebaseServerApp could not login user with provided authIdToken: ",j.t0),j.next=16,this.directlySetCurrentUser(null);case 16:case"end":return j.stop()}},M,this,[[0,11]])})),function(M){return se.apply(this,arguments)})},{key:"initializeCurrentUser",value:(G=Ue(ue().mark(function M(F){var z,te,j,K,Q,ce,Ee,_e,pe=this;return ue().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:if(!Cg(this.app)){qe.next=7;break}if(!(te=this.app.settings.authIdToken)){qe.next=6;break}return qe.abrupt("return",new Promise(function(St){setTimeout(function(){return pe.initializeCurrentUserFromIdToken(te).then(St,St)})}));case 6:return qe.abrupt("return",this.directlySetCurrentUser(null));case 7:return qe.next=9,this.assertedPersistence.getCurrentUser();case 9:if(j=qe.sent,K=j,Q=!1,!F||!this.config.authDomain){qe.next=21;break}return qe.next=15,this.getOrInitRedirectPersistenceManager();case 15:return ce=(z=this.redirectUser)===null||z===void 0?void 0:z._redirectEventId,Ee=K==null?void 0:K._redirectEventId,qe.next=19,this.tryRedirectSignIn(F);case 19:_e=qe.sent,ce&&ce!==Ee||!(_e!=null&&_e.user)||(K=_e.user,Q=!0);case 21:if(K){qe.next=23;break}return qe.abrupt("return",this.directlySetCurrentUser(null));case 23:if(K._redirectEventId){qe.next=39;break}if(!Q){qe.next=34;break}return qe.prev=25,qe.next=28,this.beforeStateQueue.runMiddleware(K);case 28:qe.next=34;break;case 30:qe.prev=30,qe.t0=qe.catch(25),K=j,this._popupRedirectResolver._overrideRedirectResult(this,function(){return Promise.reject(qe.t0)});case 34:if(!K){qe.next=38;break}return qe.abrupt("return",this.reloadAndSetCurrentUserOrClear(K));case 38:return qe.abrupt("return",this.directlySetCurrentUser(null));case 39:return Nn(this._popupRedirectResolver,this,"argument-error"),qe.next=42,this.getOrInitRedirectPersistenceManager();case 42:if(!this.redirectUser||this.redirectUser._redirectEventId!==K._redirectEventId){qe.next=44;break}return qe.abrupt("return",this.directlySetCurrentUser(K));case 44:return qe.abrupt("return",this.reloadAndSetCurrentUserOrClear(K));case 45:case"end":return qe.stop()}},M,this,[[25,30]])})),function(M){return G.apply(this,arguments)})},{key:"tryRedirectSignIn",value:(B=Ue(ue().mark(function M(F){var z;return ue().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return z=null,te.prev=1,te.next=4,this._popupRedirectResolver._completeRedirectFn(this,F,!0);case 4:z=te.sent,te.next=11;break;case 7:return te.prev=7,te.t0=te.catch(1),te.next=11,this._setRedirectUser(null);case 11:return te.abrupt("return",z);case 12:case"end":return te.stop()}},M,this,[[1,7]])})),function(M){return B.apply(this,arguments)})},{key:"reloadAndSetCurrentUserOrClear",value:(L=Ue(ue().mark(function M(F){return ue().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.prev=0,z.next=3,y1(F);case 3:z.next=9;break;case 5:if(z.prev=5,z.t0=z.catch(0),(z.t0===null||z.t0===void 0?void 0:z.t0.code)==="auth/".concat("network-request-failed")){z.next=9;break}return z.abrupt("return",this.directlySetCurrentUser(null));case 9:return z.abrupt("return",this.directlySetCurrentUser(F));case 10:case"end":return z.stop()}},M,this,[[0,5]])})),function(M){return L.apply(this,arguments)})},{key:"useDeviceLanguage",value:function(){this.languageCode=function(){if(typeof navigator>"u")return null;var M=navigator;return M.languages&&M.languages[0]||M.language||null}()}},{key:"_delete",value:(D=Ue(ue().mark(function M(){return ue().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:this._deleted=!0;case 1:case"end":return F.stop()}},M,this)})),function(){return D.apply(this,arguments)})},{key:"updateCurrentUser",value:(I=Ue(ue().mark(function M(F){var z;return ue().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:if(!Cg(this.app)){te.next=2;break}return te.abrupt("return",Promise.reject(sy(this)));case 2:return(z=F?Gg(F):null)&&Nn(z.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),te.abrupt("return",this._updateCurrentUser(z&&z._clone(this)));case 5:case"end":return te.stop()}},M,this)})),function(M){return I.apply(this,arguments)})},{key:"_updateCurrentUser",value:(C=Ue(ue().mark(function M(F){var z,te=this,j=arguments;return ue().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(z=j.length>1&&j[1]!==void 0&&j[1],!this._deleted){K.next=3;break}return K.abrupt("return");case 3:if(F&&Nn(this.tenantId===F.tenantId,this,"tenant-id-mismatch"),z){K.next=7;break}return K.next=7,this.beforeStateQueue.runMiddleware(F);case 7:return K.abrupt("return",this.queue(Ue(ue().mark(function Q(){return ue().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ce.next=2,te.directlySetCurrentUser(F);case 2:te.notifyAuthListeners();case 3:case"end":return ce.stop()}},Q)}))));case 8:case"end":return K.stop()}},M,this)})),function(M){return C.apply(this,arguments)})},{key:"signOut",value:(T=Ue(ue().mark(function M(){return ue().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(!Cg(this.app)){F.next=2;break}return F.abrupt("return",Promise.reject(sy(this)));case 2:return F.next=4,this.beforeStateQueue.runMiddleware(null);case 4:if(!this.redirectPersistenceManager&&!this._popupRedirectResolver){F.next=7;break}return F.next=7,this._setRedirectUser(null);case 7:return F.abrupt("return",this._updateCurrentUser(null,!0));case 8:case"end":return F.stop()}},M,this)})),function(){return T.apply(this,arguments)})},{key:"setPersistence",value:function(M){var F=this;return Cg(this.app)?Promise.reject(sy(this)):this.queue(Ue(ue().mark(function z(){return ue().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,F.assertedPersistence.setPersistence(Up(M));case 2:case"end":return te.stop()}},z)})))}},{key:"_getRecaptchaConfig",value:function(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}},{key:"validatePassword",value:(E=Ue(ue().mark(function M(F){var z;return ue().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:if(this._getPasswordPolicyInternal()){te.next=3;break}return te.next=3,this._updatePasswordPolicy();case 3:if((z=this._getPasswordPolicyInternal()).schemaVersion===this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION){te.next=6;break}return te.abrupt("return",Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})));case 6:return te.abrupt("return",z.validatePassword(F));case 7:case"end":return te.stop()}},M,this)})),function(M){return E.apply(this,arguments)})},{key:"_getPasswordPolicyInternal",value:function(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}},{key:"_updatePasswordPolicy",value:(g=Ue(ue().mark(function M(){var F,z;return ue().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,H$e(this);case 2:F=te.sent,z=new K$e(F),this.tenantId===null?this._projectPasswordPolicy=z:this._tenantPasswordPolicies[this.tenantId]=z;case 5:case"end":return te.stop()}},M,this)})),function(){return g.apply(this,arguments)})},{key:"_getPersistence",value:function(){return this.assertedPersistence.persistence.type}},{key:"_updateErrorMap",value:function(M){this._errorFactory=new nI("auth","Firebase",M())}},{key:"onAuthStateChanged",value:function(M,F,z){return this.registerStateListener(this.authStateSubscription,M,F,z)}},{key:"beforeAuthStateChanged",value:function(M,F){return this.beforeStateQueue.pushCallback(M,F)}},{key:"onIdTokenChanged",value:function(M,F,z){return this.registerStateListener(this.idTokenSubscription,M,F,z)}},{key:"authStateReady",value:function(){var M=this;return new Promise(function(F,z){if(M.currentUser)F();else var te=M.onAuthStateChanged(function(){te(),F()},z)})}},{key:"revokeAccessToken",value:(f=Ue(ue().mark(function M(F){var z,te;return ue().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!this.currentUser){j.next=8;break}return j.next=3,this.currentUser.getIdToken();case 3:return z=j.sent,te={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:F,idToken:z},this.tenantId!=null&&(te.tenantId=this.tenantId),j.next=8,W$e(this,te);case 8:case"end":return j.stop()}},M,this)})),function(M){return f.apply(this,arguments)})},{key:"toJSON",value:function(){var M;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(M=this._currentUser)===null||M===void 0?void 0:M.toJSON()}}},{key:"_setRedirectUser",value:(d=Ue(ue().mark(function M(F,z){var te;return ue().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,this.getOrInitRedirectPersistenceManager(z);case 2:return te=j.sent,j.abrupt("return",F===null?te.removeCurrentUser():te.setCurrentUser(F));case 4:case"end":return j.stop()}},M,this)})),function(M,F){return d.apply(this,arguments)})},{key:"getOrInitRedirectPersistenceManager",value:(u=Ue(ue().mark(function M(F){var z;return ue().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:if(this.redirectPersistenceManager){te.next=9;break}return Nn(z=F&&Up(F)||this._popupRedirectResolver,this,"argument-error"),te.next=5,Ite.create(this,[Up(z._redirectPersistence)],"redirectUser");case 5:return this.redirectPersistenceManager=te.sent,te.next=8,this.redirectPersistenceManager.getCurrentUser();case 8:this.redirectUser=te.sent;case 9:return te.abrupt("return",this.redirectPersistenceManager);case 10:case"end":return te.stop()}},M,this)})),function(M){return u.apply(this,arguments)})},{key:"_redirectUserForId",value:(a=Ue(ue().mark(function M(F){var z,te;return ue().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!this._isInitialized){j.next=3;break}return j.next=3,this.queue(Ue(ue().mark(function K(){return ue().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:case"end":return Q.stop()}},K)})));case 3:if(((z=this._currentUser)===null||z===void 0?void 0:z._redirectEventId)!==F){j.next=5;break}return j.abrupt("return",this._currentUser);case 5:if(((te=this.redirectUser)===null||te===void 0?void 0:te._redirectEventId)!==F){j.next=7;break}return j.abrupt("return",this.redirectUser);case 7:return j.abrupt("return",null);case 8:case"end":return j.stop()}},M,this)})),function(M){return a.apply(this,arguments)})},{key:"_persistUserIfCurrent",value:(o=Ue(ue().mark(function M(F){var z=this;return ue().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:if(F!==this.currentUser){te.next=2;break}return te.abrupt("return",this.queue(Ue(ue().mark(function j(){return ue().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.abrupt("return",z.directlySetCurrentUser(F));case 1:case"end":return K.stop()}},j)}))));case 2:case"end":return te.stop()}},M,this)})),function(M){return o.apply(this,arguments)})},{key:"_notifyListenersIfCurrent",value:function(M){M===this.currentUser&&this.notifyAuthListeners()}},{key:"_key",value:function(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}},{key:"_startProactiveRefresh",value:function(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}},{key:"_stopProactiveRefresh",value:function(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}},{key:"_currentUser",get:function(){return this.currentUser}},{key:"notifyAuthListeners",value:function(){var M,F;if(this._isInitialized){this.idTokenSubscription.next(this.currentUser);var z=(F=(M=this.currentUser)===null||M===void 0?void 0:M.uid)!==null&&F!==void 0?F:null;this.lastNotifiedUid!==z&&(this.lastNotifiedUid=z,this.authStateSubscription.next(this.currentUser))}}},{key:"registerStateListener",value:function(M,F,z,te){var j=this;if(this._deleted)return function(){};var K=typeof F=="function"?F:F.next.bind(F),Q=!1,ce=this._isInitialized?Promise.resolve():this._initializationPromise;if(Nn(ce,this,"internal-error"),ce.then(function(){Q||K(j.currentUser)}),typeof F=="function"){var Ee=M.addObserver(F,z,te);return function(){Q=!0,Ee()}}var _e=M.addObserver(F);return function(){Q=!0,_e()}}},{key:"directlySetCurrentUser",value:(r=Ue(ue().mark(function M(F){return ue().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(this.currentUser&&this.currentUser!==F&&this._currentUser._stopProactiveRefresh(),F&&this.isProactiveRefreshEnabled&&F._startProactiveRefresh(),this.currentUser=F,!F){z.next=8;break}return z.next=6,this.assertedPersistence.setCurrentUser(F);case 6:z.next=10;break;case 8:return z.next=10,this.assertedPersistence.removeCurrentUser();case 10:case"end":return z.stop()}},M,this)})),function(M){return r.apply(this,arguments)})},{key:"queue",value:function(M){return this.operations=this.operations.then(M,M),this.operations}},{key:"assertedPersistence",get:function(){return Nn(this.persistenceManager,this,"internal-error"),this.persistenceManager}},{key:"_logFramework",value:function(M){M&&!this.frameworks.includes(M)&&(this.frameworks.push(M),this.frameworks.sort(),this.clientVersion=Fde(this.config.clientPlatform,this._getFrameworks()))}},{key:"_getFrameworks",value:function(){return this.frameworks}},{key:"_getAdditionalHeaders",value:(e=Ue(ue().mark(function M(){var F,z,te,j;return ue().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return z=Lt({},"X-Client-Version",this.clientVersion),this.app.options.appId&&(z["X-Firebase-gmpid"]=this.app.options.appId),K.next=4,(F=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||F===void 0?void 0:F.getHeartbeatsHeader();case 4:return(te=K.sent)&&(z["X-Firebase-Client"]=te),K.next=8,this._getAppCheckToken();case 8:return(j=K.sent)&&(z["X-Firebase-AppCheck"]=j),K.abrupt("return",z);case 11:case"end":return K.stop()}},M,this)})),function(){return e.apply(this,arguments)})},{key:"_getAppCheckToken",value:(t=Ue(ue().mark(function M(){var F,z;return ue().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,(F=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||F===void 0?void 0:F.getToken();case 2:return(z=te.sent)!=null&&z.error&&O$e("Error while retrieving App Check token: ".concat(z.error)),te.abrupt("return",z==null?void 0:z.token);case 5:case"end":return te.stop()}},M,this)})),function(){return t.apply(this,arguments)})}]);var t,e,r,o,a,u,d,f,g,E,T,C,I,D,L,B,G,se,ae}();function cI(t){return Gg(t)}var kte=function(){return Me(function t(e){var r,o,a=this;xe(this,t),this.auth=e,this.observer=null,this.addObserver=(o=new zqe(function(u){return a.observer=u},r)).subscribe.bind(o)},[{key:"next",get:function(){return Nn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}])}(),ID={loadJS:function(){return Ue(ue().mark(function t(){return ue().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Unable to load external scripts");case 1:case"end":return e.stop()}},t)}))()},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jde(t){return ID.loadJS(t)}var $$e=function(){return Me(function e(r){xe(this,e),this.type="recaptcha-enterprise",this.auth=cI(r)},[{key:"verify",value:(t=Ue(ue().mark(function e(){var r,o,a,u,d,f=this,g=arguments;return ue().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return d=function(T,C,I){var D=window.grecaptcha;bte(D)?D.enterprise.ready(function(){D.enterprise.execute(T,{action:r}).then(function(L){C(L)}).catch(function(){C("NO_RECAPTCHA")})}):I(Error("No reCAPTCHA enterprise script loaded."))},u=function(){return u=Ue(ue().mark(function T(C){return ue().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(o){I.next=5;break}if(C.tenantId!=null||C._agentRecaptchaConfig==null){I.next=3;break}return I.abrupt("return",C._agentRecaptchaConfig.siteKey);case 3:if(C.tenantId==null||C._tenantRecaptchaConfigs[C.tenantId]===void 0){I.next=5;break}return I.abrupt("return",C._tenantRecaptchaConfigs[C.tenantId].siteKey);case 5:return I.abrupt("return",new Promise(function(){var D=Ue(ue().mark(function L(B,G){return ue().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:U$e(C,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(function(ae){if(ae.recaptchaKey!==void 0){var M=new M$e(ae);return C.tenantId==null?C._agentRecaptchaConfig=M:C._tenantRecaptchaConfigs[C.tenantId]=M,B(M.siteKey)}G(new Error("recaptcha Enterprise site key undefined"))}).catch(function(ae){G(ae)});case 1:case"end":return se.stop()}},L)}));return function(L,B){return D.apply(this,arguments)}}()));case 6:case"end":return I.stop()}},T)})),u.apply(this,arguments)},a=function(T){return u.apply(this,arguments)},r=g.length>0&&g[0]!==void 0?g[0]:"verify",o=g.length>1&&g[1]!==void 0&&g[1],E.abrupt("return",new Promise(function(T,C){a(f.auth).then(function(I){if(!o&&bte(window.grecaptcha))d(I,T,C);else{if(typeof window>"u")return void C(new Error("RecaptchaVerifier is only supported in browser"));var D=ID.recaptchaEnterpriseScript;D.length!==0&&(D+=I),jde(D).then(function(){d(I,T,C)}).catch(function(L){C(L)})}}).catch(function(I){C(I)})}));case 6:case"end":return E.stop()}},e)})),function(){return t.apply(this,arguments)})}]);var t}();function Ote(t,e,r){return sB.apply(this,arguments)}function sB(){return sB=Ue(ue().mark(function t(e,r,o){var a,u,d,f,g=arguments;return ue().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return a=g.length>3&&g[3]!==void 0&&g[3],u=new $$e(e),E.prev=2,E.next=5,u.verify(o);case 5:d=E.sent,E.next=13;break;case 8:return E.prev=8,E.t0=E.catch(2),E.next=12,u.verify(o,!0);case 12:d=E.sent;case 13:return f=Object.assign({},r),a?Object.assign(f,{captchaResp:d}):Object.assign(f,{captchaResponse:d}),Object.assign(f,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(f,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E.abrupt("return",f);case 18:case"end":return E.stop()}},t,null,[[2,8]])})),sB.apply(this,arguments)}function Pte(t,e,r,o){return oB.apply(this,arguments)}function oB(){return oB=Ue(ue().mark(function t(e,r,o,a){var u,d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(!((u=e._getRecaptchaConfig())===null||u===void 0)&&u.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))){f.next=7;break}return f.next=3,Ote(e,r,o,o==="getOobCode");case 3:return d=f.sent,f.abrupt("return",a(e,d));case 7:return f.abrupt("return",a(e,r).catch(function(){var g=Ue(ue().mark(function E(T){var C;return ue().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(T.code!=="auth/".concat("missing-recaptcha-token")){I.next=8;break}return console.log("".concat(o," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.")),I.next=4,Ote(e,r,o,o==="getOobCode");case 4:return C=I.sent,I.abrupt("return",a(e,C));case 8:return I.abrupt("return",Promise.reject(T));case 9:case"end":return I.stop()}},E)}));return function(E){return g.apply(this,arguments)}}()));case 8:case"end":return f.stop()}},t)})),oB.apply(this,arguments)}function Y$e(t,e,r){var o=cI(t);Nn(o._canInitEmulator,o,"emulator-config-failed"),Nn(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");var a=!1,u=Nte(e),d=function(T){var C=Nte(T),I=/(\/\/)?([^?#/]+)/.exec(T.substr(C.length));if(!I)return{host:"",port:null};var D=I[2].split("@").pop()||"",L=/^(\[[^\]]+\])(:|$)/.exec(D);if(L){var B=L[1];return{host:B,port:Dte(D.substr(B.length+1))}}var G=Gr(D.split(":"),2);return{host:G[0],port:Dte(G[1])}}(e),f=d.host,g=d.port,E=g===null?"":":".concat(g);o.config.emulator={url:"".concat(u,"//").concat(f).concat(E,"/")},o.settings.appVerificationDisabledForTesting=!0,o.emulatorConfig=Object.freeze({host:f,port:g,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:a})}),function(){function T(){var C=document.createElement("p"),I=C.style;C.innerText="Running in emulator mode. Do not use with production credentials.",I.position="fixed",I.width="100%",I.backgroundColor="#ffffff",I.border=".1em solid #000000",I.color="#b50000",I.bottom="0px",I.left="0px",I.margin="0px",I.zIndex="10000",I.textAlign="center",C.classList.add("firebase-emulator-warning"),document.body.appendChild(C)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",T):T())}()}function Nte(t){var e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Dte(t){if(!t)return null;var e=Number(t);return isNaN(e)?null:e}var AD=function(){return Me(function t(e,r){xe(this,t),this.providerId=e,this.signInMethod=r},[{key:"toJSON",value:function(){return hf("not implemented")}},{key:"_getIdTokenResponse",value:function(t){return hf("not implemented")}},{key:"_linkToIdToken",value:function(t,e){return hf("not implemented")}},{key:"_getReauthenticationResolver",value:function(t){return hf("not implemented")}}])}();function X$e(t,e){return Bde.apply(this,arguments)}function Bde(){return(Bde=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Yc(e,"POST","/v1/accounts:signUp",r));case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}function J$e(t,e){return Wde.apply(this,arguments)}function Wde(){return(Wde=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Oy(e,"POST","/v1/accounts:signInWithPassword",Ba(e,r)));case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}function Q$e(t,e){return zde.apply(this,arguments)}function zde(){return(zde=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Oy(e,"POST","/v1/accounts:signInWithEmailLink",Ba(e,r)));case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}function Z$e(t,e){return Gde.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gde(){return(Gde=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Oy(e,"POST","/v1/accounts:signInWithEmailLink",Ba(e,r)));case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}var Lte=function(){function t(o,a,u){var d,f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return xe(this,t),(d=Jn(this,t,["password",u]))._email=o,d._password=a,d._tenantId=f,d}return Qn(t,AD),Me(t,[{key:"toJSON",value:function(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}},{key:"_getIdTokenResponse",value:(r=Ue(ue().mark(function o(a){var u;return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:d.t0=this.signInMethod,d.next=d.t0==="password"?3:d.t0==="emailLink"?5:6;break;case 3:return u={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},d.abrupt("return",Pte(a,u,"signInWithPassword",J$e));case 5:return d.abrupt("return",Q$e(a,{email:this._email,oobCode:this._password}));case 6:ph(a,"internal-error");case 7:case"end":return d.stop()}},o,this)})),function(o){return r.apply(this,arguments)})},{key:"_linkToIdToken",value:(e=Ue(ue().mark(function o(a,u){var d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:f.t0=this.signInMethod,f.next=f.t0==="password"?3:f.t0==="emailLink"?5:6;break;case 3:return d={idToken:u,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},f.abrupt("return",Pte(a,d,"signUpPassword",X$e));case 5:return f.abrupt("return",Z$e(a,{idToken:u,email:this._email,oobCode:this._password}));case 6:ph(a,"internal-error");case 7:case"end":return f.stop()}},o,this)})),function(o,a){return e.apply(this,arguments)})},{key:"_getReauthenticationResolver",value:function(o){return this._getIdTokenResponse(o)}}],[{key:"_fromEmailAndPassword",value:function(o,a){return new t(o,a,"password")}},{key:"_fromEmailAndCode",value:function(o,a){return new t(o,a,"emailLink",arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)}},{key:"fromJSON",value:function(o){var a=typeof o=="string"?JSON.parse(o):o;if(a!=null&&a.email&&(a!=null&&a.password)){if(a.signInMethod==="password")return this._fromEmailAndPassword(a.email,a.password);if(a.signInMethod==="emailLink")return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}}]);var e,r}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ET(t,e){return Hde.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hde(){return(Hde=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Oy(e,"POST","/v1/accounts:signInWithIdp",Ba(e,r)));case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}var kD=function(){function t(){var e;return xe(this,t),(e=Jn(this,t,arguments)).pendingToken=null,e}return Qn(t,AD),Me(t,[{key:"toJSON",value:function(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}},{key:"_getIdTokenResponse",value:function(e){return ET(e,this.buildRequest())}},{key:"_linkToIdToken",value:function(e,r){var o=this.buildRequest();return o.idToken=r,ET(e,o)}},{key:"_getReauthenticationResolver",value:function(e){var r=this.buildRequest();return r.autoCreate=!1,ET(e,r)}},{key:"buildRequest",value:function(){var e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{var r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=rI(r)}return e}}],[{key:"_fromParams",value:function(e){var r=new t(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):ph("argument-error"),r}},{key:"fromJSON",value:function(e){var r=typeof e=="string"?JSON.parse(e):e,o=r.providerId,a=r.signInMethod,u=c6(r,["providerId","signInMethod"]);if(!o||!a)return null;var d=new t(o,a);return d.idToken=u.idToken||void 0,d.accessToken=u.accessToken||void 0,d.secret=u.secret,d.nonce=u.nonce,d.pendingToken=u.pendingToken||null,d}}])}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eYe(t,e){return Kde.apply(this,arguments)}function Kde(){return(Kde=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Yc(e,"POST","/v1/accounts:sendVerificationCode",Ba(e,r)));case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}function qde(){return(qde=Ue(ue().mark(function t(e,r){return ue().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Oy(e,"POST","/v1/accounts:signInWithPhoneNumber",Ba(e,r)));case 1:case"end":return o.stop()}},t)}))).apply(this,arguments)}function $de(){return($de=Ue(ue().mark(function t(e,r){var o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Oy(e,"POST","/v1/accounts:signInWithPhoneNumber",Ba(e,r));case 2:if(!(o=a.sent).temporaryProof){a.next=5;break}throw mC(e,"account-exists-with-different-credential",o);case 5:return a.abrupt("return",o);case 6:case"end":return a.stop()}},t)}))).apply(this,arguments)}var tYe=Lt({},"USER_NOT_FOUND","user-not-found");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yde(){return(Yde=Ue(ue().mark(function t(e,r){var o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o=Object.assign(Object.assign({},r),{operation:"REAUTH"}),a.abrupt("return",Oy(e,"POST","/v1/accounts:signInWithPhoneNumber",Ba(e,o),tYe));case 2:case"end":return a.stop()}},t)}))).apply(this,arguments)}var xte=function(){function t(e){var r;return xe(this,t),(r=Jn(this,t,["phone","phone"])).params=e,r}return Qn(t,AD),Me(t,[{key:"_getIdTokenResponse",value:function(e){return function(r,o){return qde.apply(this,arguments)}(e,this._makeVerificationRequest())}},{key:"_linkToIdToken",value:function(e,r){return function(o,a){return $de.apply(this,arguments)}(e,Object.assign({idToken:r},this._makeVerificationRequest()))}},{key:"_getReauthenticationResolver",value:function(e){return function(r,o){return Yde.apply(this,arguments)}(e,this._makeVerificationRequest())}},{key:"_makeVerificationRequest",value:function(){var e=this.params,r=e.temporaryProof,o=e.phoneNumber,a=e.verificationId,u=e.verificationCode;return r&&o?{temporaryProof:r,phoneNumber:o}:{sessionInfo:a,code:u}}},{key:"toJSON",value:function(){var e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}}],[{key:"_fromVerification",value:function(e,r){return new t({verificationId:e,verificationCode:r})}},{key:"_fromTokenResponse",value:function(e,r){return new t({phoneNumber:e,temporaryProof:r})}},{key:"fromJSON",value:function(e){typeof e=="string"&&(e=JSON.parse(e));var r=e,o=r.verificationId,a=r.verificationCode,u=r.phoneNumber,d=r.temporaryProof;return a||o||u||d?new t({verificationId:o,verificationCode:a,phoneNumber:u,temporaryProof:d}):null}}])}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nYe=function(){function t(e){var r,o,a,u,d,f;xe(this,t);var g=Gw(Hw(e)),E=(r=g.apiKey)!==null&&r!==void 0?r:null,T=(o=g.oobCode)!==null&&o!==void 0?o:null,C=function(I){switch(I){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}((a=g.mode)!==null&&a!==void 0?a:null);Nn(E&&T&&C,"argument-error"),this.apiKey=E,this.operation=C,this.code=T,this.continueUrl=(u=g.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(d=g.languageCode)!==null&&d!==void 0?d:null,this.tenantId=(f=g.tenantId)!==null&&f!==void 0?f:null}return Me(t,null,[{key:"parseLink",value:function(e){var r=function(o){var a=Gw(Hw(o)).link,u=a?Gw(Hw(a)).deep_link_id:null,d=Gw(Hw(o)).deep_link_id;return(d?Gw(Hw(d)).link:null)||d||u||a||o}(e);try{return new t(r)}catch{return null}}}])}(),H2=function(){return Me(function t(){xe(this,t),this.providerId=t.PROVIDER_ID},null,[{key:"credential",value:function(t,e){return Lte._fromEmailAndPassword(t,e)}},{key:"credentialWithLink",value:function(t,e){var r=nYe.parseLink(e);return Nn(r,"argument-error"),Lte._fromEmailAndCode(t,r.code,r.tenantId)}}])}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */H2.PROVIDER_ID="password",H2.EMAIL_PASSWORD_SIGN_IN_METHOD="password",H2.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xde=function(){return Me(function t(e){xe(this,t),this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}},[{key:"setDefaultLanguage",value:function(t){this.defaultLanguageCode=t}},{key:"setCustomParameters",value:function(t){return this.customParameters=t,this}},{key:"getCustomParameters",value:function(){return this.customParameters}}])}(),uI=function(){function t(){var e;return xe(this,t),(e=Jn(this,t,arguments)).scopes=[],e}return Qn(t,Xde),Me(t,[{key:"addScope",value:function(e){return this.scopes.includes(e)||this.scopes.push(e),this}},{key:"getScopes",value:function(){return Ps(this.scopes)}}])}(),Mte=function(){function t(){return xe(this,t),Jn(this,t,["facebook.com"])}return Qn(t,uI),Me(t,null,[{key:"credential",value:function(e){return kD._fromParams({providerId:t.PROVIDER_ID,signInMethod:t.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}},{key:"credentialFromResult",value:function(e){return t.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return t.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var r=e._tokenResponse;if(!r||!("oauthAccessToken"in r)||!r.oauthAccessToken)return null;try{return t.credential(r.oauthAccessToken)}catch{return null}}}])}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Mte.FACEBOOK_SIGN_IN_METHOD="facebook.com",Mte.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ute=function(){function t(){var e;return xe(this,t),(e=Jn(this,t,["google.com"])).addScope("profile"),e}return Qn(t,uI),Me(t,null,[{key:"credential",value:function(e,r){return kD._fromParams({providerId:t.PROVIDER_ID,signInMethod:t.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}},{key:"credentialFromResult",value:function(e){return t.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return t.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var r=e._tokenResponse;if(!r)return null;var o=r.oauthIdToken,a=r.oauthAccessToken;if(!o&&!a)return null;try{return t.credential(o,a)}catch{return null}}}])}();Ute.GOOGLE_SIGN_IN_METHOD="google.com",Ute.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vte=function(){function t(){return xe(this,t),Jn(this,t,["github.com"])}return Qn(t,uI),Me(t,null,[{key:"credential",value:function(e){return kD._fromParams({providerId:t.PROVIDER_ID,signInMethod:t.GITHUB_SIGN_IN_METHOD,accessToken:e})}},{key:"credentialFromResult",value:function(e){return t.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return t.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var r=e._tokenResponse;if(!r||!("oauthAccessToken"in r)||!r.oauthAccessToken)return null;try{return t.credential(r.oauthAccessToken)}catch{return null}}}])}();Vte.GITHUB_SIGN_IN_METHOD="github.com",Vte.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fte=function(){function t(){return xe(this,t),Jn(this,t,["twitter.com"])}return Qn(t,uI),Me(t,null,[{key:"credential",value:function(e,r){return kD._fromParams({providerId:t.PROVIDER_ID,signInMethod:t.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}},{key:"credentialFromResult",value:function(e){return t.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return t.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var r=e._tokenResponse;if(!r)return null;var o=r.oauthAccessToken,a=r.oauthTokenSecret;if(!o||!a)return null;try{return t.credential(o,a)}catch{return null}}}])}();Fte.TWITTER_SIGN_IN_METHOD="twitter.com",Fte.PROVIDER_ID="twitter.com";var f6=function(){function t(o){xe(this,t),this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}return Me(t,null,[{key:"_fromIdTokenResponse",value:(r=Ue(ue().mark(function o(a,u,d){var f,g,E,T,C=arguments;return ue().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return f=C.length>3&&C[3]!==void 0&&C[3],I.next=3,E1._fromIdTokenResponse(a,d,f);case 3:return g=I.sent,E=jte(d),T=new t({user:g,providerId:E,_tokenResponse:d,operationType:u}),I.abrupt("return",T);case 7:case"end":return I.stop()}},o)})),function(o,a,u){return r.apply(this,arguments)})},{key:"_forOperation",value:(e=Ue(ue().mark(function o(a,u,d){var f;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,a._updateTokensIfNecessary(d,!0);case 2:return f=jte(d),g.abrupt("return",new t({user:a,providerId:f,_tokenResponse:d,operationType:u}));case 4:case"end":return g.stop()}},o)})),function(o,a,u){return e.apply(this,arguments)})}]);var e,r}();function jte(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}var rYe=function(){function t(e,r,o,a){var u,d;return xe(this,t),(u=Jn(this,t,[r.code,r.message])).operationType=o,u.user=a,Object.setPrototypeOf(u,t.prototype),u.customData={appName:e.name,tenantId:(d=e.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:r.customData._serverResponse,operationType:o},u}return Qn(t,ky),Me(t,null,[{key:"_fromErrorAndOperation",value:function(e,r,o,a){return new t(e,r,o,a)}}])}();function Jde(t,e,r,o){return(e==="reauthenticate"?r._getReauthenticationResolver(t):r._getIdTokenResponse(t)).catch(function(a){throw a.code==="auth/".concat("multi-factor-auth-required")?rYe._fromErrorAndOperation(t,a,e,o):a})}function iYe(t,e){return aB.apply(this,arguments)}function aB(){return aB=Ue(ue().mark(function t(e,r){var o,a,u=arguments;return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return o=u.length>2&&u[2]!==void 0&&u[2],d.t0=SR,d.t1=e,d.t2=r,d.t3=e.auth,d.next=7,e.getIdToken();case 7:return d.t4=d.sent,d.t5=d.t2._linkToIdToken.call(d.t2,d.t3,d.t4),d.t6=o,d.next=12,(0,d.t0)(d.t1,d.t5,d.t6);case 12:return a=d.sent,d.abrupt("return",f6._forOperation(e,"link",a));case 14:case"end":return d.stop()}},t)})),aB.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cB(){return cB=Ue(ue().mark(function t(e,r){var o,a,u,d,f,g,E=arguments;return ue().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(o=E.length>2&&E[2]!==void 0&&E[2],!Cg((a=e.auth).app)){T.next=4;break}return T.abrupt("return",Promise.reject(sy(a)));case 4:return u="reauthenticate",T.prev=5,T.next=8,SR(e,Jde(a,u,r,e),o);case 8:return Nn((d=T.sent).idToken,a,"internal-error"),Nn(f=d6(d.idToken),a,"internal-error"),g=f.sub,Nn(e.uid===g,a,"user-mismatch"),T.abrupt("return",f6._forOperation(e,u,d));case 17:throw T.prev=17,T.t0=T.catch(5),(T.t0===null||T.t0===void 0?void 0:T.t0.code)==="auth/".concat("user-not-found")&&ph(a,"user-mismatch"),T.t0;case 21:case"end":return T.stop()}},t,null,[[5,17]])})),cB.apply(this,arguments)}function uB(){return uB=Ue(ue().mark(function t(e,r){var o,a,u,d,f=arguments;return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(o=f.length>2&&f[2]!==void 0&&f[2],!Cg(e.app)){g.next=3;break}return g.abrupt("return",Promise.reject(sy(e)));case 3:return a="signIn",g.next=6,Jde(e,a,r);case 6:return u=g.sent,g.next=9,f6._fromIdTokenResponse(e,a,u);case 9:if(d=g.sent,o){g.next=13;break}return g.next=13,e._updateCurrentUser(d.user);case 13:return g.abrupt("return",d);case 14:case"end":return g.stop()}},t)})),uB.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sYe(t,e){return Yc(t,"POST","/v2/accounts/mfaEnrollment:start",Ba(t,e))}function oYe(t,e){return Yc(t,"POST","/v2/accounts/mfaEnrollment:finalize",Ba(t,e))}var S1="__sak",Qde=function(){return Me(function t(e,r){xe(this,t),this.storageRetriever=e,this.type=r},[{key:"_isAvailable",value:function(){try{return this.storage?(this.storage.setItem(S1,"1"),this.storage.removeItem(S1),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}},{key:"_set",value:function(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}},{key:"_get",value:function(t){var e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}},{key:"_remove",value:function(t){return this.storage.removeItem(t),Promise.resolve()}},{key:"storage",get:function(){return this.storageRetriever()}}])}(),Zde=function(){function t(){var a;return xe(this,t),(a=Jn(this,t,[function(){return window.localStorage},"LOCAL"])).boundEventHandler=function(u,d){return a.onStorageEvent(u,d)},a.listeners={},a.localCache={},a.pollTimer=null,a.fallbackToPolling=Vde(),a._shouldAllowMigration=!0,a}return Qn(t,Qde),Me(t,[{key:"forAllChangedKeys",value:function(a){for(var u=0,d=Object.keys(this.listeners);u<d.length;u++){var f=d[u],g=this.storage.getItem(f),E=this.localCache[f];g!==E&&a(f,E,g)}}},{key:"onStorageEvent",value:function(a){var u=this,d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(a.key){var f=a.key;d?this.detachListener():this.stopPolling();var g=function(){var T=u.storage.getItem(f);(d||u.localCache[f]!==T)&&u.notifyListeners(f,T)},E=this.storage.getItem(f);z$e()&&E!==a.newValue&&a.newValue!==a.oldValue?setTimeout(g,10):g()}else this.forAllChangedKeys(function(T,C,I){u.notifyListeners(T,I)})}},{key:"notifyListeners",value:function(a,u){this.localCache[a]=u;var d=this.listeners[a];if(d)for(var f=0,g=Array.from(d);f<g.length;f++)(0,g[f])(u&&JSON.parse(u))}},{key:"startPolling",value:function(){var a=this;this.stopPolling(),this.pollTimer=setInterval(function(){a.forAllChangedKeys(function(u,d,f){a.onStorageEvent(new StorageEvent("storage",{key:u,oldValue:d,newValue:f}),!0)})},1e3)}},{key:"stopPolling",value:function(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}},{key:"attachListener",value:function(){window.addEventListener("storage",this.boundEventHandler)}},{key:"detachListener",value:function(){window.removeEventListener("storage",this.boundEventHandler)}},{key:"_addListener",value:function(a,u){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(u)}},{key:"_removeListener",value:function(a,u){this.listeners[a]&&(this.listeners[a].delete(u),this.listeners[a].size===0&&delete this.listeners[a]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}},{key:"_set",value:(o=Ue(ue().mark(function a(u,d){return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,bf(t,"_set",this,3)([u,d]);case 2:this.localCache[u]=JSON.stringify(d);case 3:case"end":return f.stop()}},a,this)})),function(a,u){return o.apply(this,arguments)})},{key:"_get",value:(r=Ue(ue().mark(function a(u){var d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,bf(t,"_get",this,3)([u]);case 2:return d=f.sent,this.localCache[u]=JSON.stringify(d),f.abrupt("return",d);case 5:case"end":return f.stop()}},a,this)})),function(a){return r.apply(this,arguments)})},{key:"_remove",value:(e=Ue(ue().mark(function a(u){return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,bf(t,"_remove",this,3)([u]);case 2:delete this.localCache[u];case 3:case"end":return d.stop()}},a,this)})),function(a){return e.apply(this,arguments)})}]);var e,r,o}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zde.type="LOCAL";var aYe=Zde,ehe=function(){function t(){return xe(this,t),Jn(this,t,[function(){return window.sessionStorage},"SESSION"])}return Qn(t,Qde),Me(t,[{key:"_addListener",value:function(e,r){}},{key:"_removeListener",value:function(e,r){}}])}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ehe.type="SESSION";var the=ehe;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cYe(t){return Promise.all(t.map(function(){var e=Ue(ue().mark(function r(o){var a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,o;case 3:return a=u.sent,u.abrupt("return",{fulfilled:!0,value:a});case 7:return u.prev=7,u.t0=u.catch(0),u.abrupt("return",{fulfilled:!1,reason:u.t0});case 10:case"end":return u.stop()}},r,null,[[0,7]])}));return function(r){return e.apply(this,arguments)}}()))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nhe=function(){function t(r){xe(this,t),this.eventTarget=r,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}return Me(t,[{key:"isListeningto",value:function(r){return this.eventTarget===r}},{key:"handleEvent",value:(e=Ue(ue().mark(function r(o){var a,u,d,f,g,E,T,C;return ue().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(u=(a=o).data,d=u.eventId,f=u.eventType,g=u.data,(E=this.handlersMap[f])==null?void 0:E.size){I.next=5;break}return I.abrupt("return");case 5:return a.ports[0].postMessage({status:"ack",eventId:d,eventType:f}),T=Array.from(E).map(function(){var D=Ue(ue().mark(function L(B){return ue().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.abrupt("return",B(a.origin,g));case 1:case"end":return G.stop()}},L)}));return function(L){return D.apply(this,arguments)}}()),I.next=9,cYe(T);case 9:C=I.sent,a.ports[0].postMessage({status:"done",eventId:d,eventType:f,response:C});case 11:case"end":return I.stop()}},r,this)})),function(r){return e.apply(this,arguments)})},{key:"_subscribe",value:function(r,o){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[r]||(this.handlersMap[r]=new Set),this.handlersMap[r].add(o)}},{key:"_unsubscribe",value:function(r,o){this.handlersMap[r]&&o&&this.handlersMap[r].delete(o),o&&this.handlersMap[r].size!==0||delete this.handlersMap[r],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}],[{key:"_getInstance",value:function(r){var o=this.receivers.find(function(u){return u.isListeningto(r)});if(o)return o;var a=new t(r);return this.receivers.push(a),a}}]);var e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p6(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,r="",o=0;o<e;o++)r+=Math.floor(10*Math.random());return t+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nhe.receivers=[];var uYe=function(){return Me(function e(r){xe(this,e),this.target=r,this.handlers=new Set},[{key:"removeMessageHandler",value:function(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}},{key:"_send",value:(t=Ue(ue().mark(function e(r,o){var a,u,d,f,g=this,E=arguments;return ue().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(a=E.length>2&&E[2]!==void 0?E[2]:50,u=typeof MessageChannel<"u"?new MessageChannel:null){T.next=4;break}throw new Error("connection_unavailable");case 4:return T.abrupt("return",new Promise(function(C,I){var D=p6("",20);u.port1.start();var L=setTimeout(function(){I(new Error("unsupported_event"))},a);f={messageChannel:u,onMessage:function(B){var G=B;if(G.data.eventId===D)switch(G.data.status){case"ack":clearTimeout(L),d=setTimeout(function(){I(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),C(G.data.response);break;default:clearTimeout(L),clearTimeout(d),I(new Error("invalid_response"))}}},g.handlers.add(f),u.port1.addEventListener("message",f.onMessage),g.target.postMessage({eventType:r,eventId:D,data:o},[u.port2])}).finally(function(){f&&g.removeMessageHandler(f)}));case 5:case"end":return T.stop()}},e)})),function(e,r){return t.apply(this,arguments)})}]);var t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Af(){return window}function lYe(t){Af().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bte(){return Af().WorkerGlobalScope!==void 0&&typeof Af().importScripts=="function"}function dYe(){return rhe.apply(this,arguments)}function rhe(){return(rhe=Ue(ue().mark(function t(){var e;return ue().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(navigator!=null&&navigator.serviceWorker){r.next=2;break}return r.abrupt("return",null);case 2:return r.prev=2,r.next=5,navigator.serviceWorker.ready;case 5:return e=r.sent,r.abrupt("return",e.active);case 9:return r.prev=9,r.t0=r.catch(2),r.abrupt("return",null);case 12:case"end":return r.stop()}},t,null,[[2,9]])}))).apply(this,arguments)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ihe="firebaseLocalStorageDb",T1="firebaseLocalStorage",she="fbase_key",lI=function(){return Me(function t(e){xe(this,t),this.request=e},[{key:"toPromise",value:function(){var t=this;return new Promise(function(e,r){t.request.addEventListener("success",function(){e(t.request.result)}),t.request.addEventListener("error",function(){r(t.request.error)})})}}])}();function OD(t,e){return t.transaction([T1],e?"readwrite":"readonly").objectStore(T1)}function hYe(){var t=indexedDB.deleteDatabase(ihe);return new lI(t).toPromise()}function lB(){var t=indexedDB.open(ihe,1);return new Promise(function(e,r){t.addEventListener("error",function(){r(t.error)}),t.addEventListener("upgradeneeded",function(){var o=t.result;try{o.createObjectStore(T1,{keyPath:she})}catch(a){r(a)}}),t.addEventListener("success",Ue(ue().mark(function o(){var a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if((a=t.result).objectStoreNames.contains(T1)){u.next=12;break}return a.close(),u.next=5,hYe();case 5:return u.t0=e,u.next=8,lB();case 8:u.t1=u.sent,(0,u.t0)(u.t1),u.next=13;break;case 12:e(a);case 13:case"end":return u.stop()}},o)})))})}function Wte(t,e,r){return dB.apply(this,arguments)}function dB(){return dB=Ue(ue().mark(function t(e,r,o){var a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return a=OD(e,!0).put(Lt(Lt({},she,r),"value",o)),u.abrupt("return",new lI(a).toPromise());case 2:case"end":return u.stop()}},t)})),dB.apply(this,arguments)}function fYe(t,e){return hB.apply(this,arguments)}function hB(){return hB=Ue(ue().mark(function t(e,r){var o,a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return o=OD(e,!1).get(r),u.next=3,new lI(o).toPromise();case 3:return a=u.sent,u.abrupt("return",a===void 0?null:a.value);case 5:case"end":return u.stop()}},t)})),hB.apply(this,arguments)}function zte(t,e){var r=OD(t,!0).delete(e);return new lI(r).toPromise()}var ohe=function(){return Me(function I(){xe(this,I),this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(function(){},function(){})},[{key:"_openDb",value:(C=Ue(ue().mark(function I(){return ue().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!this.db){D.next=2;break}return D.abrupt("return",this.db);case 2:return D.next=4,lB();case 4:return this.db=D.sent,D.abrupt("return",this.db);case 6:case"end":return D.stop()}},I,this)})),function(){return C.apply(this,arguments)})},{key:"_withRetries",value:(T=Ue(ue().mark(function I(D){var L,B;return ue().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:L=0;case 1:return G.prev=2,G.next=5,this._openDb();case 5:return B=G.sent,G.next=8,D(B);case 8:return G.abrupt("return",G.sent);case 11:if(G.prev=11,G.t0=G.catch(2),!(L++>3)){G.next=15;break}throw G.t0;case 15:this.db&&(this.db.close(),this.db=void 0);case 16:G.next=1;break;case 18:case"end":return G.stop()}},I,this,[[2,11]])})),function(I){return T.apply(this,arguments)})},{key:"initializeServiceWorkerMessaging",value:(E=Ue(ue().mark(function I(){return ue().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.abrupt("return",Bte()?this.initializeReceiver():this.initializeSender());case 1:case"end":return D.stop()}},I,this)})),function(){return E.apply(this,arguments)})},{key:"initializeReceiver",value:(g=Ue(ue().mark(function I(){var D=this;return ue().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:this.receiver=nhe._getInstance(Bte()?self:null),this.receiver._subscribe("keyChanged",function(){var B=Ue(ue().mark(function G(se,ae){var M;return ue().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,D._poll();case 2:return M=F.sent,F.abrupt("return",{keyProcessed:M.includes(ae.key)});case 4:case"end":return F.stop()}},G)}));return function(G,se){return B.apply(this,arguments)}}()),this.receiver._subscribe("ping",function(){var B=Ue(ue().mark(function G(se,ae){return ue().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.abrupt("return",["keyChanged"]);case 1:case"end":return M.stop()}},G)}));return function(G,se){return B.apply(this,arguments)}}());case 3:case"end":return L.stop()}},I,this)})),function(){return g.apply(this,arguments)})},{key:"initializeSender",value:(f=Ue(ue().mark(function I(){var D,L,B;return ue().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,dYe();case 2:if(this.activeServiceWorker=G.sent,this.activeServiceWorker){G.next=5;break}return G.abrupt("return");case 5:return this.sender=new uYe(this.activeServiceWorker),G.next=8,this.sender._send("ping",{},800);case 8:if(B=G.sent){G.next=11;break}return G.abrupt("return");case 11:!((D=B[0])===null||D===void 0)&&D.fulfilled&&(!((L=B[0])===null||L===void 0)&&L.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0);case 12:case"end":return G.stop()}},I,this)})),function(){return f.apply(this,arguments)})},{key:"notifyServiceWorker",value:(d=Ue(ue().mark(function I(D){return ue().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(this.sender&&this.activeServiceWorker&&(B=void 0,(((B=navigator==null?void 0:navigator.serviceWorker)===null||B===void 0?void 0:B.controller)||null)===this.activeServiceWorker)){L.next=2;break}return L.abrupt("return");case 2:return L.prev=2,L.next=5,this.sender._send("keyChanged",{key:D},this.serviceWorkerReceiverAvailable?800:50);case 5:L.next=9;break;case 7:L.prev=7,L.t0=L.catch(2);case 9:case"end":return L.stop()}var B},I,this,[[2,7]])})),function(I){return d.apply(this,arguments)})},{key:"_isAvailable",value:(u=Ue(ue().mark(function I(){var D;return ue().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(L.prev=0,indexedDB){L.next=3;break}return L.abrupt("return",!1);case 3:return L.next=5,lB();case 5:return D=L.sent,L.next=8,Wte(D,S1,"1");case 8:return L.next=10,zte(D,S1);case 10:return L.abrupt("return",!0);case 13:L.prev=13,L.t0=L.catch(0);case 15:return L.abrupt("return",!1);case 16:case"end":return L.stop()}},I,null,[[0,13]])})),function(){return u.apply(this,arguments)})},{key:"_withPendingWrite",value:(a=Ue(ue().mark(function I(D){return ue().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return this.pendingWrites++,L.prev=1,L.next=4,D();case 4:return L.prev=4,this.pendingWrites--,L.finish(4);case 7:case"end":return L.stop()}},I,this,[[1,,4,7]])})),function(I){return a.apply(this,arguments)})},{key:"_set",value:(o=Ue(ue().mark(function I(D,L){var B=this;return ue().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.abrupt("return",this._withPendingWrite(Ue(ue().mark(function se(){return ue().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return ae.next=2,B._withRetries(function(M){return Wte(M,D,L)});case 2:return B.localCache[D]=L,ae.abrupt("return",B.notifyServiceWorker(D));case 4:case"end":return ae.stop()}},se)}))));case 1:case"end":return G.stop()}},I,this)})),function(I,D){return o.apply(this,arguments)})},{key:"_get",value:(r=Ue(ue().mark(function I(D){var L;return ue().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,this._withRetries(function(G){return fYe(G,D)});case 2:return L=B.sent,this.localCache[D]=L,B.abrupt("return",L);case 5:case"end":return B.stop()}},I,this)})),function(I){return r.apply(this,arguments)})},{key:"_remove",value:(e=Ue(ue().mark(function I(D){var L=this;return ue().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.abrupt("return",this._withPendingWrite(Ue(ue().mark(function G(){return ue().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return se.next=2,L._withRetries(function(ae){return zte(ae,D)});case 2:return delete L.localCache[D],se.abrupt("return",L.notifyServiceWorker(D));case 4:case"end":return se.stop()}},G)}))));case 1:case"end":return B.stop()}},I,this)})),function(I){return e.apply(this,arguments)})},{key:"_poll",value:(t=Ue(ue().mark(function I(){var D,L,B,G,se,ae,M,F,z,te,j;return ue().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,this._withRetries(function(Q){var ce=OD(Q,!1).getAll();return new lI(ce).toPromise()});case 2:if(D=K.sent){K.next=5;break}return K.abrupt("return",[]);case 5:if(this.pendingWrites===0){K.next=7;break}return K.abrupt("return",[]);case 7:if(L=[],B=new Set,D.length!==0){G=pn(D);try{for(G.s();!(se=G.n()).done;)ae=se.value,M=ae.fbase_key,F=ae.value,B.add(M),JSON.stringify(this.localCache[M])!==JSON.stringify(F)&&(this.notifyListeners(M,F),L.push(M))}catch(Q){G.e(Q)}finally{G.f()}}for(z=0,te=Object.keys(this.localCache);z<te.length;z++)j=te[z],this.localCache[j]&&!B.has(j)&&(this.notifyListeners(j,null),L.push(j));return K.abrupt("return",L);case 12:case"end":return K.stop()}},I,this)})),function(){return t.apply(this,arguments)})},{key:"notifyListeners",value:function(I,D){this.localCache[I]=D;var L=this.listeners[I];if(L)for(var B=0,G=Array.from(L);B<G.length;B++)(0,G[B])(D)}},{key:"startPolling",value:function(){var I=this;this.stopPolling(),this.pollTimer=setInterval(Ue(ue().mark(function D(){return ue().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",I._poll());case 1:case"end":return L.stop()}},D)})),800)}},{key:"stopPolling",value:function(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}},{key:"_addListener",value:function(I,D){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[I]||(this.listeners[I]=new Set,this._get(I)),this.listeners[I].add(D)}},{key:"_removeListener",value:function(I,D){this.listeners[I]&&(this.listeners[I].delete(D),this.listeners[I].size===0&&delete this.listeners[I]),Object.keys(this.listeners).length===0&&this.stopPolling()}}]);var t,e,r,o,a,u,d,f,g,E,T,C}();ohe.type="LOCAL";var pYe=ohe;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mYe(t,e){return Yc(t,"POST","/v2/accounts/mfaSignIn:start",Ba(t,e))}function gYe(t,e){return Yc(t,"POST","/v2/accounts/mfaSignIn:finalize",Ba(t,e))}new aI(3e4,6e4);function ahe(){return(ahe=Ue(ue().mark(function t(e,r,o){var a,u,d,f,g,E,T,C,I;return ue().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,o.verify();case 2:if(u=D.sent,D.prev=3,Nn(typeof u=="string",e,"argument-error"),Nn(o.type==="recaptcha",e,"argument-error"),!("session"in(d=typeof r=="string"?{phoneNumber:r}:r))){D.next=26;break}if(f=d.session,!("phoneNumber"in d)){D.next=17;break}return Nn(f.type==="enroll",e,"internal-error"),D.next=13,sYe(e,{idToken:f.credential,phoneEnrollmentInfo:{phoneNumber:d.phoneNumber,recaptchaToken:u}});case 13:return g=D.sent,D.abrupt("return",g.phoneSessionInfo.sessionInfo);case 17:return Nn(f.type==="signin",e,"internal-error"),Nn(E=((a=d.multiFactorHint)===null||a===void 0?void 0:a.uid)||d.multiFactorUid,e,"missing-multi-factor-info"),D.next=22,mYe(e,{mfaPendingCredential:f.credential,mfaEnrollmentId:E,phoneSignInInfo:{recaptchaToken:u}});case 22:return T=D.sent,D.abrupt("return",T.phoneResponseInfo.sessionInfo);case 24:D.next=31;break;case 26:return D.next=28,eYe(e,{phoneNumber:d.phoneNumber,recaptchaToken:u});case 28:return C=D.sent,I=C.sessionInfo,D.abrupt("return",I);case 31:return D.prev=31,o._reset(),D.finish(31);case 34:case"end":return D.stop()}},t,null,[[3,,31,34]])}))).apply(this,arguments)}var Gte=function(){function t(e){xe(this,t),this.providerId=t.PROVIDER_ID,this.auth=cI(e)}return Me(t,[{key:"verifyPhoneNumber",value:function(e,r){return function(o,a,u){return ahe.apply(this,arguments)}(this.auth,e,Gg(r))}}],[{key:"credential",value:function(e,r){return xte._fromVerification(e,r)}},{key:"credentialFromResult",value:function(e){var r=e;return t.credentialFromTaggedObject(r)}},{key:"credentialFromError",value:function(e){return t.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var r=e._tokenResponse;if(!r)return null;var o=r.phoneNumber,a=r.temporaryProof;return o&&a?xte._fromTokenResponse(o,a):null}}])}();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vYe(t,e){return e?Up(e):(Nn(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Gte.PROVIDER_ID="phone",Gte.PHONE_SIGN_IN_METHOD="phone";var m6=function(){function t(e){var r;return xe(this,t),(r=Jn(this,t,["custom","custom"])).params=e,r}return Qn(t,AD),Me(t,[{key:"_getIdTokenResponse",value:function(e){return ET(e,this._buildIdpRequest())}},{key:"_linkToIdToken",value:function(e,r){return ET(e,this._buildIdpRequest(r))}},{key:"_getReauthenticationResolver",value:function(e){return ET(e,this._buildIdpRequest())}},{key:"_buildIdpRequest",value:function(e){var r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}])}();function _Ye(t){return function(e,r){return uB.apply(this,arguments)}(t.auth,new m6(t),t.bypassAuthState)}function yYe(t){var e=t.auth,r=t.user;return Nn(r,e,"internal-error"),function(o,a){return cB.apply(this,arguments)}(r,new m6(t),t.bypassAuthState)}function EYe(t){return che.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function che(){return(che=Ue(ue().mark(function t(e){var r,o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r=e.auth,Nn(o=e.user,r,"internal-error"),a.abrupt("return",iYe(o,new m6(e),e.bypassAuthState));case 3:case"end":return a.stop()}},t)}))).apply(this,arguments)}var uhe=function(){return Me(function e(r,o,a,u){var d=arguments.length>4&&arguments[4]!==void 0&&arguments[4];xe(this,e),this.auth=r,this.resolver=a,this.user=u,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(o)?o:[o]},[{key:"execute",value:function(){var e=this;return new Promise(function(){var r=Ue(ue().mark(function o(a,u){return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return e.pendingPromise={resolve:a,reject:u},d.prev=1,d.next=4,e.resolver._initialize(e.auth);case 4:return e.eventManager=d.sent,d.next=7,e.onExecution();case 7:e.eventManager.registerConsumer(e),d.next=13;break;case 10:d.prev=10,d.t0=d.catch(1),e.reject(d.t0);case 13:case"end":return d.stop()}},o,null,[[1,10]])}));return function(o,a){return r.apply(this,arguments)}}())}},{key:"onAuthEvent",value:(t=Ue(ue().mark(function e(r){var o,a,u,d,f,g,E;return ue().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(o=r.urlResponse,a=r.sessionId,u=r.postBody,d=r.tenantId,f=r.error,g=r.type,!f){T.next=4;break}return this.reject(f),T.abrupt("return");case 4:return E={auth:this.auth,requestUri:o,sessionId:a,tenantId:d||void 0,postBody:u||void 0,user:this.user,bypassAuthState:this.bypassAuthState},T.prev=5,T.t0=this,T.next=9,this.getIdpTask(g)(E);case 9:T.t1=T.sent,T.t0.resolve.call(T.t0,T.t1),T.next=16;break;case 13:T.prev=13,T.t2=T.catch(5),this.reject(T.t2);case 16:case"end":return T.stop()}},e,this,[[5,13]])})),function(e){return t.apply(this,arguments)})},{key:"onError",value:function(e){this.reject(e)}},{key:"getIdpTask",value:function(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return _Ye;case"linkViaPopup":case"linkViaRedirect":return EYe;case"reauthViaPopup":case"reauthViaRedirect":return yYe;default:ph(this.auth,"internal-error")}}},{key:"resolve",value:function(e){rm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}},{key:"reject",value:function(e){rm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}},{key:"unregisterAndCleanUp",value:function(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}]);var t}(),SYe=new aI(2e3,1e4);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(){function t(o,a,u,d,f){var g;return xe(this,t),(g=Jn(this,t,[o,a,d,f])).provider=u,g.authWindow=null,g.pollId=null,t.currentPopupAction&&t.currentPopupAction.cancel(),t.currentPopupAction=g,g}return Qn(t,uhe),Me(t,[{key:"executeNotNull",value:(r=Ue(ue().mark(function o(){var a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.execute();case 2:return Nn(a=u.sent,this.auth,"internal-error"),u.abrupt("return",a);case 5:case"end":return u.stop()}},o,this)})),function(){return r.apply(this,arguments)})},{key:"onExecution",value:(e=Ue(ue().mark(function o(){var a,u=this;return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return rm(this.filter.length===1,"Popup operations only handle one event"),a=p6(),d.next=4,this.resolver._openPopup(this.auth,this.provider,this.filter[0],a);case 4:this.authWindow=d.sent,this.authWindow.associatedEvent=a,this.resolver._originValidation(this.auth).catch(function(f){u.reject(f)}),this.resolver._isIframeWebStorageSupported(this.auth,function(f){f||u.reject(If(u.auth,"web-storage-unsupported"))}),this.pollUserCancellation();case 9:case"end":return d.stop()}},o,this)})),function(){return e.apply(this,arguments)})},{key:"eventId",get:function(){var o;return((o=this.authWindow)===null||o===void 0?void 0:o.associatedEvent)||null}},{key:"cancel",value:function(){this.reject(If(this.auth,"cancelled-popup-request"))}},{key:"cleanUp",value:function(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,t.currentPopupAction=null}},{key:"pollUserCancellation",value:function(){var o=this,a=function(){var u,d;!((d=(u=o.authWindow)===null||u===void 0?void 0:u.window)===null||d===void 0)&&d.closed?o.pollId=window.setTimeout(function(){o.pollId=null,o.reject(If(o.auth,"popup-closed-by-user"))},8e3):o.pollId=window.setTimeout(a,SYe.get())};a()}}]);var e,r})().currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var TN=new Map,TYe=function(){function t(a,u){var d,f=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return xe(this,t),(d=Jn(this,t,[a,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],u,void 0,f])).eventId=null,d}return Qn(t,uhe),Me(t,[{key:"execute",value:(o=Ue(ue().mark(function a(){var u,d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(u=TN.get(this.auth._key())){f.next=21;break}return f.prev=2,f.next=5,bYe(this.resolver,this.auth);case 5:if(!f.sent){f.next=12;break}return f.next=9,bf(t,"execute",this,3)([]);case 9:f.t0=f.sent,f.next=13;break;case 12:f.t0=null;case 13:d=f.t0,u=function(){return Promise.resolve(d)},f.next=20;break;case 17:f.prev=17,f.t1=f.catch(2),u=function(){return Promise.reject(f.t1)};case 20:TN.set(this.auth._key(),u);case 21:return this.bypassAuthState||TN.set(this.auth._key(),function(){return Promise.resolve(null)}),f.abrupt("return",u());case 23:case"end":return f.stop()}},a,this,[[2,17]])})),function(){return o.apply(this,arguments)})},{key:"onAuthEvent",value:(r=Ue(ue().mark(function a(u){var d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(u.type!=="signInViaRedirect"){f.next=4;break}return f.abrupt("return",bf(t,"onAuthEvent",this,3)([u]));case 4:if(u.type!=="unknown"){f.next=7;break}return this.resolve(null),f.abrupt("return");case 7:if(!u.eventId){f.next=17;break}return f.next=10,this.auth._redirectUserForId(u.eventId);case 10:if(!(d=f.sent)){f.next=16;break}return this.user=d,f.abrupt("return",bf(t,"onAuthEvent",this,3)([u]));case 16:this.resolve(null);case 17:case"end":return f.stop()}},a,this)})),function(a){return r.apply(this,arguments)})},{key:"onExecution",value:(e=Ue(ue().mark(function a(){return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:case"end":return u.stop()}},a)})),function(){return e.apply(this,arguments)})},{key:"cleanUp",value:function(){}}]);var e,r,o}();function bYe(t,e){return lhe.apply(this,arguments)}function lhe(){return(lhe=Ue(ue().mark(function t(e,r){var o,a,u;return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return o=RYe(r),a=CYe(e),d.next=4,a._isAvailable();case 4:if(d.sent){d.next=6;break}return d.abrupt("return",!1);case 6:return d.next=8,a._get(o);case 8:return d.t0=d.sent,u=d.t0==="true",d.next=12,a._remove(o);case 12:return d.abrupt("return",u);case 13:case"end":return d.stop()}},t)}))).apply(this,arguments)}function wYe(t,e){TN.set(t._key(),e)}function CYe(t){return Up(t._redirectPersistence)}function RYe(t){return SN("pendingRedirect",t.config.apiKey,t.name)}function IYe(t,e){return fB.apply(this,arguments)}function fB(){return fB=Ue(ue().mark(function t(e,r){var o,a,u,d,f,g=arguments;return ue().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(o=g.length>2&&g[2]!==void 0&&g[2],!Cg(e.app)){E.next=3;break}return E.abrupt("return",Promise.reject(sy(e)));case 3:return a=cI(e),u=vYe(a,r),d=new TYe(a,u,o),E.next=8,d.execute();case 8:if(!(f=E.sent)||o){E.next=15;break}return delete f.user._redirectEventId,E.next=13,a._persistUserIfCurrent(f.user);case 13:return E.next=15,a._setRedirectUser(null,r);case 15:return E.abrupt("return",f);case 16:case"end":return E.stop()}},t)})),fB.apply(this,arguments)}var AYe=function(){return Me(function t(e){xe(this,t),this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()},[{key:"registerConsumer",value:function(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}},{key:"unregisterConsumer",value:function(t){this.consumers.delete(t)}},{key:"onEvent",value:function(t){var e=this;if(this.hasEventBeenHandled(t))return!1;var r=!1;return this.consumers.forEach(function(o){e.isEventForConsumer(t,o)&&(r=!0,e.sendToConsumer(t,o),e.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(o){switch(o.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Kte(o);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=t,r=!0)),r}},{key:"sendToConsumer",value:function(t,e){var r;if(t.error&&!Kte(t)){var o=((r=t.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";e.onError(If(this.auth,o))}else e.onAuthEvent(t)}},{key:"isEventForConsumer",value:function(t,e){var r=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&r}},{key:"hasEventBeenHandled",value:function(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Hte(t))}},{key:"saveEventToCache",value:function(t){this.cachedEventUids.add(Hte(t)),this.lastProcessedEventTime=Date.now()}}])}();function Hte(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(function(e){return e}).join("-")}function Kte(t){var e=t.type,r=t.error;return e==="unknown"&&(r==null?void 0:r.code)==="auth/".concat("no-auth-event")}function kYe(t){return pB.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pB(){return pB=Ue(ue().mark(function t(e){var r,o=arguments;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r=o.length>1&&o[1]!==void 0?o[1]:{},a.abrupt("return",Yc(e,"GET","/v1/projects",r));case 2:case"end":return a.stop()}},t)})),pB.apply(this,arguments)}var OYe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,PYe=/^https?/;function dhe(){return(dhe=Ue(ue().mark(function t(e){var r,o,a,u,d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!e.config.emulator){f.next=2;break}return f.abrupt("return");case 2:return f.next=4,kYe(e);case 4:r=f.sent,o=r.authorizedDomains,a=pn(o),f.prev=7,a.s();case 9:if((u=a.n()).done){f.next=20;break}if(d=u.value,f.prev=11,!NYe(d)){f.next=14;break}return f.abrupt("return");case 14:f.next=18;break;case 16:f.prev=16,f.t0=f.catch(11);case 18:f.next=9;break;case 20:f.next=25;break;case 22:f.prev=22,f.t1=f.catch(7),a.e(f.t1);case 25:return f.prev=25,a.f(),f.finish(25);case 28:ph(e,"unauthorized-domain");case 29:case"end":return f.stop()}},t,null,[[7,22,25,28],[11,16]])}))).apply(this,arguments)}function NYe(t){var e=Qj(),r=new URL(e),o=r.protocol,a=r.hostname;if(t.startsWith("chrome-extension://")){var u=new URL(t);return u.hostname===""&&a===""?o==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):o==="chrome-extension:"&&u.hostname===a}if(!PYe.test(o))return!1;if(OYe.test(t))return a===t;var d=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+d+"|"+d+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var DYe=new aI(3e4,6e4);function qte(){var t=Af().___jsl;if(t!=null&&t.H)for(var e=0,r=Object.keys(t.H);e<r.length;e++){var o=r[e];if(t.H[o].r=t.H[o].r||[],t.H[o].L=t.H[o].L||[],t.H[o].r=Ps(t.H[o].L),t.CP)for(var a=0;a<t.CP.length;a++)t.CP[a]=null}}function LYe(t){return new Promise(function(e,r){var o,a,u;function d(){qte(),gapi.load("gapi.iframes",{callback:function(){e(gapi.iframes.getContext())},ontimeout:function(){qte(),r(If(t,"network-request-failed"))},timeout:DYe.get()})}if(!((a=(o=Af().gapi)===null||o===void 0?void 0:o.iframes)===null||a===void 0)&&a.Iframe)e(gapi.iframes.getContext());else{if(!(!((u=Af().gapi)===null||u===void 0)&&u.load)){var f="__".concat("iframefcb").concat(Math.floor(1e6*Math.random()));return Af()[f]=function(){gapi.load?d():r(If(t,"network-request-failed"))},jde("".concat(ID.gapiScript,"?onload=").concat(f)).catch(function(g){return r(g)})}d()}}).catch(function(e){throw mB=null,e})}var mB=null;function xYe(t){return mB=mB||LYe(t)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var MYe=new aI(5e3,15e3),UYe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},VYe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function FYe(t){var e=t.config;Nn(e.authDomain,t,"auth-domain-config-required");var r=e.emulator?l6(e,"emulator/auth/iframe"):"https://".concat(t.config.authDomain,"/").concat("__/auth/iframe"),o={apiKey:e.apiKey,appName:t.name,v:r0},a=VYe.get(t.config.apiHost);a&&(o.eid=a);var u=t._getFrameworks();return u.length&&(o.fw=u.join(",")),"".concat(r,"?").concat(rI(o).slice(1))}function jYe(t){return gB.apply(this,arguments)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gB(){return gB=Ue(ue().mark(function t(e){var r,o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,xYe(e);case 2:return r=a.sent,Nn(o=Af().gapi,e,"internal-error"),a.abrupt("return",r.open({where:document.body,url:FYe(e),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:UYe,dontclear:!0},function(u){return new Promise(function(){var d=Ue(ue().mark(function f(g,E){var T,C,I;return ue().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return I=function(){Af().clearTimeout(C),g(u)},D.next=3,u.restyle({setHideOnLeave:!1});case 3:T=If(e,"network-request-failed"),C=Af().setTimeout(function(){E(T)},MYe.get()),u.ping(I).then(I,function(){E(T)});case 6:case"end":return D.stop()}},f)}));return function(f,g){return d.apply(this,arguments)}}())}));case 6:case"end":return a.stop()}},t)})),gB.apply(this,arguments)}var BYe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},$te=function(){return Me(function t(e){xe(this,t),this.window=e,this.associatedEvent=null},[{key:"close",value:function(){if(this.window)try{this.window.close()}catch{}}}])}();function WYe(t,e,r){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:600,u=Math.max((window.screen.availHeight-a)/2,0).toString(),d=Math.max((window.screen.availWidth-o)/2,0).toString(),f="",g=Object.assign(Object.assign({},BYe),{width:o.toString(),height:a.toString(),top:u,left:d}),E=$c().toLowerCase();r&&(f=Dde(E)?"_blank":r),Pde(E)&&(e=e||"http://localhost",g.scrollbars="yes");var T=Object.entries(g).reduce(function(I,D){var L=Gr(D,2),B=L[0],G=L[1];return"".concat(I).concat(B,"=").concat(G,",")},"");if(function(){var I;return h6(arguments.length>0&&arguments[0]!==void 0?arguments[0]:$c())&&!!(!((I=window.navigator)===null||I===void 0)&&I.standalone)}(E)&&f!=="_self")return function(I,D){var L=document.createElement("a");L.href=I,L.target=D;var B=document.createEvent("MouseEvent");B.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),L.dispatchEvent(B)}(e||"",f),new $te(null);var C=window.open(e||"",f,T);Nn(C,t,"popup-blocked");try{C.focus()}catch{}return new $te(C)}var zYe=encodeURIComponent("fac");function Yte(t,e,r,o,a,u){return hhe.apply(this,arguments)}function hhe(){return(hhe=Ue(ue().mark(function t(e,r,o,a,u,d){var f,g,E,T,C,I,D,L,B,G,se,ae,M;return ue().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(Nn(e.config.authDomain,e,"auth-domain-config-required"),Nn(e.config.apiKey,e,"invalid-api-key"),f={apiKey:e.config.apiKey,appName:e.name,authType:o,redirectUrl:a,v:r0,eventId:u},r instanceof Xde)for(r.setDefaultLanguage(e.languageCode),f.providerId=r.providerId||"",Wqe(r.getCustomParameters())||(f.customParameters=JSON.stringify(r.getCustomParameters())),g=0,E=Object.entries(d||{});g<E.length;g++)T=Gr(E[g],2),C=T[0],I=T[1],f[C]=I;for(r instanceof uI&&(D=r.getScopes().filter(function(z){return z!==""})).length>0&&(f.scopes=D.join(",")),e.tenantId&&(f.tid=e.tenantId),L=f,B=0,G=Object.keys(L);B<G.length;B++)se=G[B],L[se]===void 0&&delete L[se];return F.next=10,e._getAppCheckToken();case 10:return ae=F.sent,M=ae?"#".concat(zYe,"=").concat(encodeURIComponent(ae)):"",F.abrupt("return","".concat(GYe(e),"?").concat(rI(L).slice(1)).concat(M));case 13:case"end":return F.stop()}},t)}))).apply(this,arguments)}function GYe(t){var e=t.config;return e.emulator?l6(e,"emulator/auth/handler"):"https://".concat(e.authDomain,"/").concat("__/auth/handler")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var K2="webStorageSupport",HYe=function(){return Me(function o(){xe(this,o),this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=the,this._completeRedirectFn=IYe,this._overrideRedirectResult=wYe},[{key:"_openPopup",value:(r=Ue(ue().mark(function o(a,u,d,f){var g,E;return ue().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return rm((g=this.eventManagers[a._key()])===null||g===void 0?void 0:g.manager,"_initialize() not called before _openPopup()"),T.next=3,Yte(a,u,d,Qj(),f);case 3:return E=T.sent,T.abrupt("return",WYe(a,E,p6()));case 5:case"end":return T.stop()}},o,this)})),function(o,a,u,d){return r.apply(this,arguments)})},{key:"_openRedirect",value:(e=Ue(ue().mark(function o(a,u,d,f){return ue().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this._originValidation(a);case 2:return g.next=4,Yte(a,u,d,Qj(),f);case 4:return lYe(g.sent),g.abrupt("return",new Promise(function(){}));case 7:case"end":return g.stop()}},o,this)})),function(o,a,u,d){return e.apply(this,arguments)})},{key:"_initialize",value:function(o){var a=this,u=o._key();if(this.eventManagers[u]){var d=this.eventManagers[u],f=d.manager,g=d.promise;return f?Promise.resolve(f):(rm(g,"If manager is not set, promise should be"),g)}var E=this.initAndGetManager(o);return this.eventManagers[u]={promise:E},E.catch(function(){delete a.eventManagers[u]}),E}},{key:"initAndGetManager",value:(t=Ue(ue().mark(function o(a){var u,d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,jYe(a);case 2:return u=f.sent,d=new AYe(a),u.register("authEvent",function(g){return Nn(g==null?void 0:g.authEvent,a,"invalid-auth-event"),{status:d.onEvent(g.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[a._key()]={manager:d},this.iframes[a._key()]=u,f.abrupt("return",d);case 8:case"end":return f.stop()}},o,this)})),function(o){return t.apply(this,arguments)})},{key:"_isIframeWebStorageSupported",value:function(o,a){this.iframes[o._key()].send(K2,{type:K2},function(u){var d,f=(d=u==null?void 0:u[0])===null||d===void 0?void 0:d[K2];f!==void 0&&a(!!f),ph(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}},{key:"_originValidation",value:function(o){var a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function(u){return dhe.apply(this,arguments)}(o)),this.originValidationPromises[a]}},{key:"_shouldInitProactively",get:function(){return Vde()||Nde()||h6()}}]);var t,e,r}(),fhe=function(){return Me(function t(e){xe(this,t),this.factorId=e},[{key:"_process",value:function(t,e,r){switch(e.type){case"enroll":return this._finalizeEnroll(t,e.credential,r);case"signin":return this._finalizeSignIn(t,e.credential);default:return hf("unexpected MultiFactorSessionType")}}}])}(),KYe=function(){function t(e){var r;return xe(this,t),(r=Jn(this,t,["phone"])).credential=e,r}return Qn(t,fhe),Me(t,[{key:"_finalizeEnroll",value:function(e,r,o){return function(a,u){return Yc(a,"POST","/v2/accounts/mfaEnrollment:finalize",Ba(a,u))}(e,{idToken:r,displayName:o,phoneVerificationInfo:this.credential._makeVerificationRequest()})}},{key:"_finalizeSignIn",value:function(e,r){return function(o,a){return Yc(o,"POST","/v2/accounts/mfaSignIn:finalize",Ba(o,a))}(e,{mfaPendingCredential:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}],[{key:"_fromCredential",value:function(e){return new t(e)}}])}();(function(){return Me(function t(){xe(this,t)},null,[{key:"assertion",value:function(t){return KYe._fromCredential(t)}}])})().FACTOR_ID="phone",function(){return Me(function e(){xe(this,e)},null,[{key:"assertionForEnrollment",value:function(e,r){return Xte._fromSecret(e,r)}},{key:"assertionForSignIn",value:function(e,r){return Xte._fromEnrollmentId(e,r)}},{key:"generateSecret",value:(t=Ue(ue().mark(function e(r){var o,a,u;return ue().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return Nn(((o=(a=r).user)===null||o===void 0?void 0:o.auth)!==void 0,"internal-error"),d.next=4,f=a.user.auth,g={idToken:a.credential,totpEnrollmentInfo:{}},Yc(f,"POST","/v2/accounts/mfaEnrollment:start",Ba(f,g));case 4:return u=d.sent,d.abrupt("return",qYe._fromStartTotpMfaEnrollmentResponse(u,a.user.auth));case 6:case"end":return d.stop()}var f,g},e)})),function(e){return t.apply(this,arguments)})}]);var t}().FACTOR_ID="totp";var Xte=function(){function t(o,a,u){var d;return xe(this,t),(d=Jn(this,t,["totp"])).otp=o,d.enrollmentId=a,d.secret=u,d}return Qn(t,fhe),Me(t,[{key:"_finalizeEnroll",value:(r=Ue(ue().mark(function o(a,u,d){return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return Nn(this.secret!==void 0,a,"argument-error"),f.abrupt("return",oYe(a,{idToken:u,displayName:d,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)}));case 2:case"end":return f.stop()}},o,this)})),function(o,a,u){return r.apply(this,arguments)})},{key:"_finalizeSignIn",value:(e=Ue(ue().mark(function o(a,u){var d;return ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return Nn(this.enrollmentId!==void 0&&this.otp!==void 0,a,"argument-error"),d={verificationCode:this.otp},f.abrupt("return",gYe(a,{mfaPendingCredential:u,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:d}));case 3:case"end":return f.stop()}},o,this)})),function(o,a){return e.apply(this,arguments)})}],[{key:"_fromSecret",value:function(o,a){return new t(a,void 0,o)}},{key:"_fromEnrollmentId",value:function(o,a){return new t(a,o)}}]);var e,r}(),qYe=function(){function t(e,r,o,a,u,d,f){xe(this,t),this.sessionInfo=d,this.auth=f,this.secretKey=e,this.hashingAlgorithm=r,this.codeLength=o,this.codeIntervalSeconds=a,this.enrollmentCompletionDeadline=u}return Me(t,[{key:"_makeTotpVerificationInfo",value:function(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}},{key:"generateQrCodeUrl",value:function(e,r){var o,a=!1;return(xP(e)||xP(r))&&(a=!0),a&&(xP(e)&&(e=((o=this.auth.currentUser)===null||o===void 0?void 0:o.email)||"unknownuser"),xP(r)&&(r=this.auth.name)),"otpauth://totp/".concat(r,":").concat(e,"?secret=").concat(this.secretKey,"&issuer=").concat(r,"&algorithm=").concat(this.hashingAlgorithm,"&digits=").concat(this.codeLength)}}],[{key:"_fromStartTotpMfaEnrollmentResponse",value:function(e,r){return new t(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,r)}}])}();function xP(t){return t===void 0||(t==null?void 0:t.length)===0}var Jte="@firebase/auth",Qte="1.7.9",$Ye=function(){return Me(function e(r){xe(this,e),this.auth=r,this.internalListeners=new Map},[{key:"getUid",value:function(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}},{key:"getToken",value:(t=Ue(ue().mark(function e(r){var o;return ue().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.assertAuthConfigured(),a.next=3,this.auth._initializationPromise;case 3:if(this.auth.currentUser){a.next=5;break}return a.abrupt("return",null);case 5:return a.next=7,this.auth.currentUser.getIdToken(r);case 7:return o=a.sent,a.abrupt("return",{accessToken:o});case 9:case"end":return a.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"addAuthTokenListener",value:function(e){if(this.assertAuthConfigured(),!this.internalListeners.has(e)){var r=this.auth.onIdTokenChanged(function(o){e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}}},{key:"removeAuthTokenListener",value:function(e){this.assertAuthConfigured();var r=this.internalListeners.get(e);r&&(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}},{key:"assertAuthConfigured",value:function(){Nn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}},{key:"updateProactiveRefresh",value:function(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}]);var t}();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var MP,YYe=Due("authIdTokenMaxAge")||300,Zte=null;ID={loadJS:function(t){return new Promise(function(e,r){var o,a,u=document.createElement("script");u.setAttribute("src",t),u.onload=e,u.onerror=function(d){var f=If("internal-error");f.customData=d,r(f)},u.type="text/javascript",u.charset="UTF-8",((a=(o=document.getElementsByTagName("head"))===null||o===void 0?void 0:o[0])!==null&&a!==void 0?a:document).appendChild(u)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},MP="Browser",jT(new Ty("auth",function(t,e){var r=e.options,o=t.getProvider("app").getImmediate(),a=t.getProvider("heartbeat"),u=t.getProvider("app-check-internal"),d=o.options,f=d.apiKey,g=d.authDomain;Nn(f&&!f.includes(":"),"invalid-api-key",{appName:o.name});var E={apiKey:f,authDomain:g,clientPlatform:MP,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Fde(MP)},T=new q$e(o,a,u,E);return function(C,I){var D=(I==null?void 0:I.persistence)||[],L=(Array.isArray(D)?D:[D]).map(Up);I!=null&&I.errorMap&&C._updateErrorMap(I.errorMap),C._initializeWithPersistence(L,I==null?void 0:I.popupRedirectResolver)}(T,r),T},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(function(t,e,r){t.getProvider("auth-internal").initialize()})),jT(new Ty("auth-internal",function(t){return function(e){return new $Ye(e)}(cI(t.getProvider("auth").getImmediate()))},"PRIVATE").setInstantiationMode("EXPLICIT")),xg(Jte,Qte,function(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(MP)),xg(Jte,Qte,"esm2017");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */xg("firebase","10.14.1","app");var phe=Mue({apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"});(function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Uue(),e=Ij(t,"auth");if(e.isInitialized())return e.getImmediate();var r,o=function(g,E){var T=Ij(g,"auth");if(T.isInitialized()){var C=T.getImmediate();if(l1(T.getOptions(),E??{}))return C;ph(C,"already-initialized")}return T.initialize({options:E})}(t,{popupRedirectResolver:HYe,persistence:[pYe,aYe,the]}),a=Due("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){var u=new URL(a,location.origin);if(location.origin===u.origin){var d=(r=u.toString(),function(){var g=Ue(ue().mark(function E(T){var C,I,D;return ue().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(L.t0=T,!L.t0){L.next=5;break}return L.next=4,T.getIdTokenResult();case 4:L.t0=L.sent;case 5:if(C=L.t0,!((I=C&&(new Date().getTime()-Date.parse(C.issuedAtTime))/1e3)&&I>YYe)){L.next=9;break}return L.abrupt("return");case 9:if(D=C==null?void 0:C.token,Zte!==D){L.next=12;break}return L.abrupt("return");case 12:return Zte=D,L.next=15,fetch(r,{method:D?"POST":"DELETE",headers:D?{Authorization:"Bearer ".concat(D)}:{}});case 15:case"end":return L.stop()}},E)}));return function(E){return g.apply(this,arguments)}}());(function(g,E,T){Gg(g).beforeAuthStateChanged(E,T)})(o,d,function(){return d(o.currentUser)}),function(g,E,T,C){Gg(g).onIdTokenChanged(E,T,C)}(o,function(g){return d(g)})}}var f=Pue("auth");f&&Y$e(o,"http://".concat(f))})(phe);var XYe=function(t,e){var r=typeof t=="string"?t:"(default)",o=Ij(vo(t)=="object"?t:Uue(),"firestore").getImmediate({identifier:r});if(!o._initialized){var a=function(u){var d=Pue(u);if(d){var f=d.lastIndexOf(":");if(f<=0||f+1===d.length)throw new Error("Invalid host ".concat(d," with no separate hostname and port!"));var g=parseInt(d.substring(f+1),10);return d[0]==="["?[d.substring(1,f-1),g]:[d.substring(0,f),g]}}("firestore");a&&m$e.apply(void 0,[o].concat(Ps(a)))}return o}(phe),JYe=function(){var t=Ue(ue().mark(function e(r){var o,a;return ue().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,c1("userFirestore: Get user Profile data for user ID: "+r),o=v$e(XYe,"users",r),u.next=5,I$e(o);case 5:if(!(a=u.sent).exists()){u.next=11;break}return c1("userFirestore: Found Profile for : "+a.data().Nickname),u.abrupt("return",a.data());case 11:return wee("userFirestore: user profile document not found"),u.abrupt("return",null);case 13:u.next=19;break;case 15:throw u.prev=15,u.t0=u.catch(0),wee("userFirestore: Error fetching user profile data:",u.t0),u.t0;case 19:case"end":return u.stop()}},e,null,[[0,15]])}));return function(e){return t.apply(this,arguments)}}(),QYe=Di.createContext({user:null}),ZYe=function(t){var e=t.userNickname,r=Rue(),o=r.client,a=r.channel,u=r.screenTrack,d=r.isScreenSharing,f=r.toggleScreenShare,g=Gr(X.useState([]),2),E=g[0],T=g[1],C=Gr(X.useState(!1),2),I=C[0],D=C[1],L=Gr(X.useState(!0),2),B=L[0],G=L[1];X.useRef({});var se=X.useRef(null),ae=(X.useContext(QYe)||{user:null}).user,M=Gr(X.useState({}),2),F=M[0],z=M[1],te=X.useRef(u);return X.useEffect(function(){te.current=u},[u]),X.useEffect(function(){if(o&&a){var j=setTimeout(function(){G(!1)},5e3);console.log("Setting up screen share display with existing client:",o),console.log("Current channel:",a);var K=o.connectionState;if(console.log("Current connection state:",K),K!=="CONNECTED"){D(!1);var Q=function(ce){console.log("Connection state changed:",ce),ce==="CONNECTED"?(D(!0),G(!1)):D(!1)};return o.on("connection-state-change",Q),function(){o.off("connection-state-change",Q),clearTimeout(j)}}return D(!0),G(!1),function(){clearTimeout(j)}}D(!1)},[o,a]),X.useEffect(function(){var j=function(){var K=Ue(ue().mark(function Q(){var ce,Ee,_e,pe,qe,St,ke,Ne;return ue().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:ce=Ej({},F),Ee=!1,_e=pn(E),Re.prev=3,_e.s();case 5:if((pe=_e.n()).done){Re.next=30;break}if(qe=pe.value,!F[qe.uid]){Re.next=9;break}return Re.abrupt("continue",28);case 9:if(St=null,typeof(ke=qe.uid)=="string"&&(ke.includes("-")?(St=ke.split("-")[0],ke=ke.split("-")[1]):ke.includes("_")&&(St=ke.split("_")[0],ke=ke.split("_")[1])),!ke){Re.next=27;break}return Re.prev=13,console.log("Trying to fetch nickname for user ID:",ke),Re.next=17,JYe(ke);case 17:(Ne=Re.sent)&&Ne.Nickname?(console.log("Found nickname in Firebase for user ID:",ke,"Nickname:",Ne.Nickname),ce[qe.uid]=Ne.Nickname,Ee=!0):St?(console.log("Using extracted name for user ID:",ke,"Name:",St),ce[qe.uid]=St,Ee=!0):(ce[qe.uid]="User",Ee=!0),Re.next=25;break;case 21:Re.prev=21,Re.t0=Re.catch(13),console.error("Error fetching user profile:",Re.t0),St?(ce[qe.uid]=St,Ee=!0):(ce[qe.uid]="User",Ee=!0);case 25:Re.next=28;break;case 27:St?(ce[qe.uid]=St,Ee=!0):(ce[qe.uid]="User",Ee=!0);case 28:Re.next=5;break;case 30:Re.next=35;break;case 32:Re.prev=32,Re.t1=Re.catch(3),_e.e(Re.t1);case 35:return Re.prev=35,_e.f(),Re.finish(35);case 38:Ee&&z(ce);case 39:case"end":return Re.stop()}},Q,null,[[3,32,35,38],[13,21]])}));return function(){return K.apply(this,arguments)}}();E.length>0&&j()},[E,F]),X.useEffect(function(){if(o&&a&&I){console.log("Setting up screen share event handlers");var j=function(){var ce=Ue(ue().mark(function Ee(_e,pe){return ue().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:if(console.log("User published:",_e.uid,pe,_e),pe!=="video"){qe.next=13;break}return console.log("Remote video track detected:",_e.uid),qe.prev=3,qe.next=6,o.subscribe(_e,pe);case 6:console.log("Subscribed to remote video track:",_e.uid),T(function(St){return St.some(function(ke){return ke.uid===_e.uid})?St:[].concat(Ps(St),[_e])}),qe.next=13;break;case 10:qe.prev=10,qe.t0=qe.catch(3),console.error("Error subscribing to remote video track:",qe.t0);case 13:case"end":return qe.stop()}},Ee,null,[[3,10]])}));return function(Ee,_e){return ce.apply(this,arguments)}}(),K=function(ce,Ee){if(console.log("User unpublished:",ce.uid,Ee),Ee==="video"){if(console.log("Remote video track unpublished:",ce.uid),ce.videoTrack)try{ce.videoTrack.stop()}catch(_e){console.error("Error stopping video track:",_e)}if(T(function(_e){return _e.filter(function(pe){return pe.uid!==ce.uid})}),d&&te.current&&se.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),te.current.play(se.current)}catch(_e){console.error("Error replaying local screen track:",_e)}}},Q=function(ce){console.log("User left:",ce.uid);var Ee=E.find(function(_e){return _e.uid===ce.uid});if(Ee&&Ee.videoTrack)try{Ee.videoTrack.stop()}catch(_e){console.error("Error stopping video track:",_e)}if(T(function(_e){return _e.filter(function(pe){return pe.uid!==ce.uid})}),d&&te.current&&se.current)try{console.log("Ensuring local screen track is still playing after remote user left"),te.current.play(se.current)}catch(_e){console.error("Error replaying local screen track:",_e)}};return o.on("user-published",j),o.on("user-unpublished",K),o.on("user-left",Q),function(){o.off("user-published",j),o.off("user-unpublished",K),o.off("user-left",Q)}}},[o,a,I,E,d]),X.useEffect(function(){if(console.log("Remote screens changed:",E.length,E),E.forEach(function(j){if(j.videoTrack)try{console.log("Playing video track for:",j.uid),j.videoTrack.play("video-container-".concat(j.uid))}catch(K){console.error("Error playing video track:",K)}}),d&&te.current&&se.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),te.current.play(se.current)}catch(j){console.error("Error replaying local screen track:",j)}},[E,d]),X.useEffect(function(){if(console.log("Local screen sharing state changed:",d,u),d&&u&&se.current)try{console.log("Playing local screen track"),u.play(se.current)}catch(j){console.error("Error playing local screen track:",j)}},[d,u]),X.useEffect(function(){return function(){if(E.forEach(function(j){if(j.videoTrack)try{j.videoTrack.stop()}catch(K){console.error("Error stopping video track on unmount:",K)}}),u)try{u.stop()}catch(j){console.error("Error stopping local screen track on unmount:",j)}}},[E,u]),I?B&&E.length===0&&!d?null:E.length!==0||d?$.jsxs(sr,{position:"fixed",top:"70px",right:"20px",zIndex:1e4,maxWidth:"80vw",maxHeight:"80vh",overflow:"auto",children:[d&&u&&$.jsxs(sr,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"640px",height:"360px",children:[$.jsx(sr,{position:"absolute",top:2,right:2,zIndex:10,children:$.jsx(ZC,{size:"sm",bg:"rgba(0,0,0,0.5)",color:"white",onClick:function(){console.log("Stopping local screen share"),f()}})}),$.jsx(sr,{ref:se,width:"100%",height:"100%",position:"relative",id:"local-screen-container"}),$.jsx(sr,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:e?"".concat(e,"'s Screen"):"Your Screen"})]}),E.map(function(j){var K,Q=F[j.uid]||(K=j.uid,console.log("Getting display name for UID:",K,"type:",vo(K)),d&&ae&&(K===ae.uid||K===(o==null?void 0:o.uid))?e||"You":F[K]?F[K]:typeof K=="string"?K.includes("-")?K.split("-")[0]:K.includes("_")?K.split("_")[0]:K:"User");return $.jsxs(sr,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"640px",height:"360px",children:[$.jsx(sr,{position:"absolute",top:2,right:2,zIndex:10,children:$.jsx(ZC,{size:"sm",bg:"rgba(0,0,0,0.5)",color:"white",onClick:function(){return function(ce){console.log("Closing screen share for:",ce);var Ee=E.find(function(_e){return _e.uid===ce});if(Ee&&Ee.videoTrack)try{Ee.videoTrack.stop()}catch(_e){console.error("Error stopping video track:",_e)}if(T(function(_e){return _e.filter(function(pe){return pe.uid!==ce})}),d&&te.current&&se.current)try{console.log("Ensuring local screen track is still playing after closing remote screen"),te.current.play(se.current)}catch(_e){console.error("Error replaying local screen track:",_e)}}(j.uid)}})}),$.jsx(sr,{id:"video-container-".concat(j.uid),width:"100%",height:"100%",position:"relative"}),$.jsx(sr,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:"".concat(Q,"'s Screen")})]},j.uid)})]}):null:null},eXe=function(t){var e=t.onClose,r=DR(),o=Gr(X.useState(!1),2),a=o[0],u=o[1],d=Gr(X.useState(!1),2),f=d[0],g=d[1];X.useEffect(function(){var C=function(){window.agoraClient&&g(!!window.agoraClient.isScreenSharing)};C();var I=setInterval(C,1e3),D=function(){C()};return window.addEventListener("ScreenShareToggled",D),function(){clearInterval(I),window.removeEventListener("ScreenShareToggled",D)}},[]);var E=function(){var C=Ue(ue().mark(function I(D){var L;return ue().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(D.preventDefault(),D.stopPropagation(),e&&e(),window.agoraClient&&window.agoraClient.client){B.next=6;break}return r({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0}),B.abrupt("return");case 6:try{u(!0),window.agoraClient.isJoined?T():(console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically"),L=new CustomEvent("JoinVoiceChat",{detail:{callback:function(G){if(!G)return console.error("ScreenShareMenuOption: Failed to join voice chat"),r({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),void u(!1);T()}}}),window.dispatchEvent(L))}catch(G){console.error("Error in screen share handler:",G),u(!1),r({title:"Screen sharing error",description:G.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}case 7:case"end":return B.stop()}},I)}));return function(I){return C.apply(this,arguments)}}(),T=function(){var C=Ue(ue().mark(function I(){var D;return ue().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:try{D=new CustomEvent("ToggleScreenShare",{detail:{callback:function(B,G){u(!1),B?(g(G),r(G?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):r({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}}),window.dispatchEvent(D)}catch(B){console.error("Error toggling screen share:",B),u(!1),r({title:"Screen sharing error",description:B.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}case 1:case"end":return L.stop()}},I)}));return function(){return C.apply(this,arguments)}}();return $.jsx(Br,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:E,color:f?"red.300":"white",children:a?"Connecting...":f?"Stop Screen Sharing":"Share Screen"})};function tXe({open:t,onClose:e}){return $.jsxs(sm,{isOpen:t,onClose:e,size:"lg",isCentered:!0,children:[$.jsx(am,{}),$.jsxs(om,{bg:"gray.900",color:"white",borderRadius:"lg",children:[$.jsx(Jg,{children:"Controls"}),$.jsx(um,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),$.jsx(cm,{children:$.jsxs(vu,{spacing:4,children:[$.jsxs(sr,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[$.jsx(Br,{fontSize:"xl",fontWeight:"bold",children:"Getting Started"}),$.jsxs(sr,{mt:2,children:[$.jsx(Br,{children:"WASD to move"}),$.jsx(Br,{children:"Shift to run"}),$.jsx(Br,{children:"Spacebar to jump/double jump"}),$.jsx(Br,{children:"Click to move around"})]})]}),$.jsxs(sr,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[$.jsx(Br,{fontSize:"xl",fontWeight:"bold",children:"Camera Movements"}),$.jsx(sr,{mt:2,children:$.jsx(Br,{children:"Click & drag to rotate camera"})})]}),$.jsxs(sr,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[$.jsx(Br,{fontSize:"xl",fontWeight:"bold",children:"##########"}),$.jsx(sr,{mt:2,children:$.jsx(Br,{children:"Type something here"})})]})]})})]})]})}const nXe=()=>{const[t,e]=X.useState([]),[r,o]=X.useState(""),[a,u]=X.useState(0),[d,f]=X.useState(100),[g,E]=X.useState(100),[T,C]=X.useState(!0),[I,D]=X.useState(!0),[L,B]=X.useState(!1);X.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const z=await mR.getMicrophones();e(z),z.length>0&&o(z[0].deviceId)}catch(z){console.error("Error getting audio devices:",z)}})()},[]),X.useEffect(()=>{const F=setInterval(()=>{u(L?Math.random()*50:0)},100);return()=>clearInterval(F)},[L]);const G=F=>{const z=F.target.value;o(z),console.log("Microphone changed to:",z)},se=F=>{f(F),console.log("Microphone volume set to:",F)},ae=F=>{E(F),console.log("Speaker volume set to:",F)},M=()=>{B(!L)};return $.jsxs(vu,{spacing:6,align:"stretch",children:[$.jsxs(lc,{children:[$.jsxs(L_,{children:["Microphone",$.jsx(Ase,{ml:2,colorScheme:L?"green":"red",children:L?"Enabled":"Muted"})]}),$.jsxs(coe,{value:r,onChange:G,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[t.map(F=>$.jsx("option",{value:F.deviceId,children:F.label||`Microphone ${F.deviceId.slice(0,5)}...`},F.deviceId)),t.length===0&&$.jsx("option",{value:"",children:"No microphones found"})]})]}),$.jsxs(sr,{children:[$.jsx(Br,{mb:2,children:"Microphone Level"}),$.jsx(j4,{value:a,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:a>20,isAnimated:a>20})]}),$.jsxs(lc,{children:[$.jsxs(L_,{children:["Microphone Volume: ",d,"%"]}),$.jsxs(FF,{value:d,onChange:se,min:0,max:100,step:1,colorScheme:"blue",children:[$.jsx(BF,{bg:"gray.700",children:$.jsx(WF,{})}),$.jsx(jF,{boxSize:6})]})]}),$.jsxs(lc,{children:[$.jsxs(L_,{children:["Speaker Volume: ",g,"%"]}),$.jsxs(FF,{value:g,onChange:ae,min:0,max:100,step:1,colorScheme:"blue",children:[$.jsx(BF,{bg:"gray.700",children:$.jsx(WF,{})}),$.jsx(jF,{boxSize:6})]})]}),$.jsxs(lc,{display:"flex",alignItems:"center",children:[$.jsx(L_,{mb:"0",children:"Microphone Enabled"}),$.jsx(iN,{isChecked:L,onChange:M,colorScheme:"green",size:"lg"})]}),$.jsxs(lc,{display:"flex",alignItems:"center",children:[$.jsx(L_,{mb:"0",children:"Echo Cancellation"}),$.jsx(iN,{isChecked:T,onChange:()=>C(!T),colorScheme:"green",size:"lg"})]}),$.jsxs(lc,{display:"flex",alignItems:"center",children:[$.jsx(L_,{mb:"0",children:"Noise Suppression"}),$.jsx(iN,{isChecked:I,onChange:()=>D(!I),colorScheme:"green",size:"lg"})]}),$.jsxs(j1,{status:"info",borderRadius:"md",children:[$.jsx(F1,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function rXe({open:t,onClose:e,containerRef:r}){return $.jsx(mh,{containerRef:r,children:$.jsxs(sm,{isOpen:t,onClose:e,size:"lg",isCentered:!0,children:[$.jsx(am,{}),$.jsxs(om,{bg:"gray.900",color:"white",borderRadius:"lg",children:[$.jsx(Jg,{children:"Settings"}),$.jsx(um,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),$.jsx(cm,{children:$.jsxs(moe,{variant:"enclosed",children:[$.jsxs(goe,{mb:4,children:[$.jsx(GF,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),$.jsx(GF,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),$.jsxs(voe,{children:[$.jsx(zF,{children:$.jsx(sr,{p:4,bg:"gray.800",borderRadius:"md",children:$.jsx(nXe,{})})}),$.jsx(zF,{children:$.jsx(sr,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}const iXe=({onTogglePlayerList:t,spaceID:e})=>{const{fullscreenRef:r}=lm(),[o,a]=X.useState(!0),[u,d]=X.useState(!1),[f,g]=X.useState(!1),[E,T]=X.useState(!1),[C,I]=X.useState(!1),[D,L]=X.useState(null),{user:B}=X.useContext(Ad),G=(B==null?void 0:B.Nickname)||"Unknown",se=async()=>{if(B!=null&&B.uid)try{const j=await yy(B.uid);L({rpmURL:j.rpmURL?j.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null})}catch(j){console.error("Error fetching profile data:",j)}};X.useEffect(()=>{se()},[B==null?void 0:B.uid]),X.useEffect(()=>{const j=()=>{a(!0)};return window.addEventListener("PlayerInstantiated",j),()=>{window.removeEventListener("PlayerInstantiated",j)}},[]);const ae=()=>g(!f),M=()=>T(!E),F=()=>{I(!1),se()},z=j=>{j.stopPropagation(),typeof t=="function"&&(Gt.log("CanvasMainMenu: Toggling player list"),t())},te=()=>{d(!1)};return $.jsxs($.Fragment,{children:[$.jsxs(zse,{isOpen:u,onClose:()=>d(!1),children:[$.jsx(Hse,{as:xl,icon:$.jsx(oqe,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:u?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:u?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>d(!u)}),$.jsx(mh,{containerRef:r,children:$.jsx(Gse,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:$.jsxs(vu,{align:"stretch",spacing:4,children:[$.jsxs(RT,{children:[$.jsx(cy,{size:"md",src:D==null?void 0:D.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),$.jsxs(vu,{align:"start",spacing:0,children:[$.jsx(Br,{fontWeight:"bold",children:G}),$.jsx(Br,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),$.jsxs(RT,{spacing:4,justify:"center",children:[$.jsx(xl,{icon:$.jsx(mqe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:z}),$.jsx(xl,{icon:$.jsx(sr,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),$.jsx(xl,{icon:$.jsx(sr,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),$.jsx(k4,{borderColor:"whiteAlpha.300"}),$.jsxs(vu,{align:"stretch",spacing:2,children:[B&&e&&$.jsx(eXe,{onClose:te}),$.jsx(Br,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:ae,children:"Settings"}),$.jsx(Br,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:M,children:"Controls"}),$.jsx(Br,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),$.jsx(Br,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),E&&$.jsx(tXe,{open:E,onClose:M}),f&&$.jsx(rXe,{open:f,onClose:ae}),C&&$.jsx(gue,{open:C,onClose:F})]})},g6=X.forwardRef(({settings:t},e)=>{const{unityProvider:r,isLoaded:o}=n0(),a=DKe();xKe();const u=vD(),d=VKe(a),{user:f}=X.useContext(Ad),[g,E]=X.useState(!1),[T,C]=X.useState(window.devicePixelRatio),[I,D]=UKe();tue().find(pe=>pe.isLocalPlayer);const[B,G]=X.useState(!0),[se,ae]=X.useState(!0),[M,F]=X.useState(!1),z=t.spaceID||"default",te=X.useMemo(()=>{const St=new URLSearchParams(window.location.search).get("sessionId")||z;return console.log("WebGLRenderer: Using session ID:",St),St},[z]),[j,K]=X.useState(null);X.useEffect(()=>{f!=null&&f.uid&&yy(f.uid).then(pe=>{K(pe),console.log("WebGLRenderer: User profile loaded:",(pe==null?void 0:pe.Nickname)||"Unknown")}).catch(pe=>{console.error("Error fetching user profile:",pe)})},[f==null?void 0:f.uid]),X.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const pe=()=>{console.log("WebGLRenderer: Player instantiated event received"),ae(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),ae(!0)),uC.subscribe(cC.playerInstantiated,pe);const qe=setTimeout(()=>{se||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),ae(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{uC.unsubscribe(cC.playerInstantiated,pe),clearTimeout(qe)}},[se]),X.useEffect(()=>{o||a?setTimeout(()=>{E(!0),Gt.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):Gt.warn("WebGLRenderer: Unity is NOT ready yet.")},[o,a]),X.useEffect(()=>{const pe=qe=>{Gt.log("WebGLRenderer: Received 'sendUserToUnity' event"),u("FirebaseUserFromReact",qe)};return uC.subscribe(cC.sendUserToUnity,pe),()=>uC.unsubscribe(cC.sendUserToUnity,pe)},[u]);const{setFullscreenRef:Q,fullscreenRef:ce}=lm();X.useEffect(()=>{Q(e.current)},[e,Q]);const Ee=()=>{G(!B)},_e=f&&t.enableVoiceChat;return console.log("WebGLRenderer: Render with state:",{user:!!f,userId:f==null?void 0:f.uid,isPlayerInstantiated:se,showVoiceChat:_e,sessionId:te}),$.jsx(sr,{className:"webgl-renderer",children:$.jsx(SB,{containerRef:ce.current?ce:document.body,children:$.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"16/9",position:"relative"},children:[$.jsxs(sr,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[t.showAuthButton&&$.jsx(lqe,{}),_e&&$.jsxs(Cue,{appId:"130dccf9b3554bda87f8cf577f91c8c4",channel:te,uid:f==null?void 0:f.uid,enabled:!0,children:[$.jsx(xqe,{size:"md",defaultMuted:!0,joinOnClick:!0}),$.jsx(ZYe,{userNickname:j==null?void 0:j.Nickname})]}),$.jsx(vqe,{}),$.jsx(sr,{position:"relative",zIndex:"9999",children:$.jsx(iXe,{onTogglePlayerList:Ee,spaceID:z})})]}),$.jsxs(sr,{position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",bgImage:t.urlLoadingBackground?`url('${t.urlLoadingBackground}')`:"",children:[$.jsx(uqe,{}),$.jsx(sr,{...d,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:$.jsx(jce.Unity,{unityProvider:r,style:{width:"100%",height:"100%"},devicePixelRatio:T})}),$.jsx(Sqe,{})]}),$.jsx(sr,{...d,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:t.showDisruptiveLogo&&$.jsx(l4,{src:t.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),$.jsx(sr,{...d,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),$.jsxs(sr,{...d,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[t.showHelpButton&&$.jsx(dqe,{}),$.jsx(Eqe,{})]}),$.jsx(Tqe,{}),$.jsx(bqe,{isOpen:I!==null,onClose:()=>{console.log(" Closing nameplate modal"),D()},playerName:(I==null?void 0:I.playerName)||"Unknown Player",playerId:(I==null?void 0:I.playerId)||"Unknown ID"}),$.jsx(wqe,{isVisible:B,onToggleVisibility:G})]})})})});g6.displayName="WebGLRenderer";g6.propTypes={settings:go.shape({urlLoadingBackground:go.string,showAuthButton:go.bool,showDisruptiveLogo:go.bool,urlDisruptiveLogo:go.string,showHelpButton:go.bool,enableVoiceChat:go.bool,spaceID:go.string})};const mhe=({spaceID:t,overrideSettings:e})=>{const r=X.useRef(null),[o,a]=X.useState(!0),[u,d]=X.useState({spaceID:t,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[f,g]=X.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:t});return X.useEffect(()=>{(async()=>{try{const T=await OKe(t);if(T){d(I=>({...I,spaceID:t,loaderUrl:T.loaderUrl,dataUrl:T.dataUrl,frameworkUrl:T.frameworkUrl,codeUrl:T.codeUrl}));const C=await Zce(f.urlDisruptiveLogo);g(I=>({...I,urlLoadingBackground:T.gsUrlLoadingBackground||"",showAuthButton:T.showAuthButton!==void 0?T.showAuthButton:!0,showDisruptiveLogo:T.showDisruptiveLogo!==void 0?T.showDisruptiveLogo:!0,showHelpButton:T.showHelpButton!==void 0?T.showHelpButton:!0,enableVoiceChat:T.enableVoiceChat!==void 0?T.enableVoiceChat:!0,urlDisruptiveLogo:C,spaceID:t,...e||{}})),a(!1)}else Gt.error(`WebGLLoader: No configuration found for spaceID: ${t}`)}catch(T){Gt.error("WebGLLoader: Error fetching space data:",T)}finally{a(!1)}})()},[t,f.urlDisruptiveLogo,e]),X.useEffect(()=>{o||(Gt.log("WebGLLoader: Unity config from Firebase",u),Gt.log("WebGLLoader: Space settings from Firebase",f))},[o]),$.jsx($.Fragment,{children:o?$.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):$.jsx(R9e,{...u,children:$.jsx(g6,{ref:r,settings:f})})})};mhe.propTypes={spaceID:go.string.isRequired,overrideSettings:go.object};const UP=document.getElementById("webgl-root");if(UP){const t=UP.getAttribute("data-space-id"),e=UP.getAttribute("data-theme")||"default",r=()=>{const[o,a]=X.useState(null);return X.useEffect(()=>{f4e(e).then(a)},[]),o?$.jsx(bMe,{theme:o,children:$.jsx(m9e,{children:$.jsx(g9e,{children:$.jsx(mhe,{spaceID:t})})})}):$.jsx("div",{children:"Loading theme..."})};rbe.createRoot(UP).render($.jsx(r,{}))}else console.error("Root element 'webgl-root' not found.");export{vRe as a,pRe as b,_s as c,oXe as d,sXe as e,oRe as f,hh as i,uf as m,QPe as t};
